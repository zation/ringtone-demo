(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_link_index_js"],{

/***/ "./node_modules/tinymce/plugins/link/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/index.js ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "link" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/link')
//   ES2015:
//     import 'tinymce/plugins/link'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/link/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/plugin.js ***!
  \*****************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var global$1 = tinymce.util.Tools.resolve('tinymce.util.VK');

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var eq = function (t) {
      return function (a) {
        return t === a;
      };
    };
    var isString = isType('string');
    var isArray = isType('array');
    var isNull = eq(null);
    var isBoolean = isSimpleType('boolean');
    var isFunction = isSimpleType('function');

    var assumeExternalTargets = function (editor) {
      var externalTargets = editor.getParam('link_assume_external_targets', false);
      if (isBoolean(externalTargets) && externalTargets) {
        return 1;
      } else if (isString(externalTargets) && (externalTargets === 'http' || externalTargets === 'https')) {
        return externalTargets;
      }
      return 0;
    };
    var hasContextToolbar = function (editor) {
      return editor.getParam('link_context_toolbar', false, 'boolean');
    };
    var getLinkList = function (editor) {
      return editor.getParam('link_list');
    };
    var getDefaultLinkTarget = function (editor) {
      return editor.getParam('default_link_target');
    };
    var getTargetList = function (editor) {
      return editor.getParam('target_list', true);
    };
    var getRelList = function (editor) {
      return editor.getParam('rel_list', [], 'array');
    };
    var getLinkClassList = function (editor) {
      return editor.getParam('link_class_list', [], 'array');
    };
    var shouldShowLinkTitle = function (editor) {
      return editor.getParam('link_title', true, 'boolean');
    };
    var allowUnsafeLinkTarget = function (editor) {
      return editor.getParam('allow_unsafe_link_target', false, 'boolean');
    };
    var useQuickLink = function (editor) {
      return editor.getParam('link_quicklink', false, 'boolean');
    };
    var getDefaultLinkProtocol = function (editor) {
      return editor.getParam('link_default_protocol', 'http', 'string');
    };

    var noop = function () {
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var never = constant(false);
    var always = constant(true);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var nativeIndexOf = Array.prototype.indexOf;
    var nativePush = Array.prototype.push;
    var rawIndexOf = function (ts, t) {
      return nativeIndexOf.call(ts, t);
    };
    var contains = function (xs, x) {
      return rawIndexOf(xs, x) > -1;
    };
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var foldl = function (xs, f, acc) {
      each(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var bind = function (xs, f) {
      return flatten(map(xs, f));
    };
    var findMap = function (arr, f) {
      for (var i = 0; i < arr.length; i++) {
        var r = f(arr[i], i);
        if (r.isSome()) {
          return r;
        }
      }
      return Optional.none();
    };

    var cat = function (arr) {
      var r = [];
      var push = function (x) {
        r.push(x);
      };
      for (var i = 0; i < arr.length; i++) {
        arr[i].each(push);
      }
      return r;
    };
    var someIf = function (b, a) {
      return b ? Optional.some(a) : Optional.none();
    };

    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var getValue = function (item) {
      return isString(item.value) ? item.value : '';
    };
    var getText = function (item) {
      if (isString(item.text)) {
        return item.text;
      } else if (isString(item.title)) {
        return item.title;
      } else {
        return '';
      }
    };
    var sanitizeList = function (list, extractValue) {
      var out = [];
      global$2.each(list, function (item) {
        var text = getText(item);
        if (item.menu !== undefined) {
          var items = sanitizeList(item.menu, extractValue);
          out.push({
            text: text,
            items: items
          });
        } else {
          var value = extractValue(item);
          out.push({
            text: text,
            value: value
          });
        }
      });
      return out;
    };
    var sanitizeWith = function (extracter) {
      if (extracter === void 0) {
        extracter = getValue;
      }
      return function (list) {
        return Optional.from(list).map(function (list) {
          return sanitizeList(list, extracter);
        });
      };
    };
    var sanitize = function (list) {
      return sanitizeWith(getValue)(list);
    };
    var createUi = function (name, label) {
      return function (items) {
        return {
          name: name,
          type: 'listbox',
          label: label,
          items: items
        };
      };
    };
    var ListOptions = {
      sanitize: sanitize,
      sanitizeWith: sanitizeWith,
      createUi: createUi,
      getValue: getValue
    };

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };

    var keys = Object.keys;
    var hasOwnProperty = Object.hasOwnProperty;
    var each$1 = function (obj, f) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        f(x, i);
      }
    };
    var objAcc = function (r) {
      return function (x, i) {
        r[i] = x;
      };
    };
    var internalFilter = function (obj, pred, onTrue, onFalse) {
      var r = {};
      each$1(obj, function (x, i) {
        (pred(x, i) ? onTrue : onFalse)(x, i);
      });
      return r;
    };
    var filter = function (obj, pred) {
      var t = {};
      internalFilter(obj, pred, objAcc(t), noop);
      return t;
    };
    var has = function (obj, key) {
      return hasOwnProperty.call(obj, key);
    };
    var hasNonNullableKey = function (obj, key) {
      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;
    };

    var global$3 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');

    var isAnchor = function (elm) {
      return elm && elm.nodeName.toLowerCase() === 'a';
    };
    var isLink = function (elm) {
      return isAnchor(elm) && !!getHref(elm);
    };
    var collectNodesInRange = function (rng, predicate) {
      if (rng.collapsed) {
        return [];
      } else {
        var contents = rng.cloneContents();
        var walker = new global$3(contents.firstChild, contents);
        var elements = [];
        var current = contents.firstChild;
        do {
          if (predicate(current)) {
            elements.push(current);
          }
        } while (current = walker.next());
        return elements;
      }
    };
    var hasProtocol = function (url) {
      return /^\w+:/i.test(url);
    };
    var getHref = function (elm) {
      var href = elm.getAttribute('data-mce-href');
      return href ? href : elm.getAttribute('href');
    };
    var applyRelTargetRules = function (rel, isUnsafe) {
      var rules = ['noopener'];
      var rels = rel ? rel.split(/\s+/) : [];
      var toString = function (rels) {
        return global$2.trim(rels.sort().join(' '));
      };
      var addTargetRules = function (rels) {
        rels = removeTargetRules(rels);
        return rels.length > 0 ? rels.concat(rules) : rules;
      };
      var removeTargetRules = function (rels) {
        return rels.filter(function (val) {
          return global$2.inArray(rules, val) === -1;
        });
      };
      var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);
      return newRels.length > 0 ? toString(newRels) : '';
    };
    var trimCaretContainers = function (text) {
      return text.replace(/\uFEFF/g, '');
    };
    var getAnchorElement = function (editor, selectedElm) {
      selectedElm = selectedElm || editor.selection.getNode();
      if (isImageFigure(selectedElm)) {
        return editor.dom.select('a[href]', selectedElm)[0];
      } else {
        return editor.dom.getParent(selectedElm, 'a[href]');
      }
    };
    var getAnchorText = function (selection, anchorElm) {
      var text = anchorElm ? anchorElm.innerText || anchorElm.textContent : selection.getContent({ format: 'text' });
      return trimCaretContainers(text);
    };
    var hasLinks = function (elements) {
      return global$2.grep(elements, isLink).length > 0;
    };
    var hasLinksInSelection = function (rng) {
      return collectNodesInRange(rng, isLink).length > 0;
    };
    var isOnlyTextSelected = function (editor) {
      var inlineTextElements = editor.schema.getTextInlineElements();
      var isElement = function (elm) {
        return elm.nodeType === 1 && !isAnchor(elm) && !has(inlineTextElements, elm.nodeName.toLowerCase());
      };
      var elements = collectNodesInRange(editor.selection.getRng(), isElement);
      return elements.length === 0;
    };
    var isImageFigure = function (elm) {
      return elm && elm.nodeName === 'FIGURE' && /\bimage\b/i.test(elm.className);
    };
    var getLinkAttrs = function (data) {
      return foldl([
        'title',
        'rel',
        'class',
        'target'
      ], function (acc, key) {
        data[key].each(function (value) {
          acc[key] = value.length > 0 ? value : null;
        });
        return acc;
      }, { href: data.href });
    };
    var handleExternalTargets = function (href, assumeExternalTargets) {
      if ((assumeExternalTargets === 'http' || assumeExternalTargets === 'https') && !hasProtocol(href)) {
        return assumeExternalTargets + '://' + href;
      }
      return href;
    };
    var applyLinkOverrides = function (editor, linkAttrs) {
      var newLinkAttrs = __assign({}, linkAttrs);
      if (!(getRelList(editor).length > 0) && allowUnsafeLinkTarget(editor) === false) {
        var newRel = applyRelTargetRules(newLinkAttrs.rel, newLinkAttrs.target === '_blank');
        newLinkAttrs.rel = newRel ? newRel : null;
      }
      if (Optional.from(newLinkAttrs.target).isNone() && getTargetList(editor) === false) {
        newLinkAttrs.target = getDefaultLinkTarget(editor);
      }
      newLinkAttrs.href = handleExternalTargets(newLinkAttrs.href, assumeExternalTargets(editor));
      return newLinkAttrs;
    };
    var updateLink = function (editor, anchorElm, text, linkAttrs) {
      text.each(function (text) {
        if (anchorElm.hasOwnProperty('innerText')) {
          anchorElm.innerText = text;
        } else {
          anchorElm.textContent = text;
        }
      });
      editor.dom.setAttribs(anchorElm, linkAttrs);
      editor.selection.select(anchorElm);
    };
    var createLink = function (editor, selectedElm, text, linkAttrs) {
      if (isImageFigure(selectedElm)) {
        linkImageFigure(editor, selectedElm, linkAttrs);
      } else {
        text.fold(function () {
          editor.execCommand('mceInsertLink', false, linkAttrs);
        }, function (text) {
          editor.insertContent(editor.dom.createHTML('a', linkAttrs, editor.dom.encode(text)));
        });
      }
    };
    var linkDomMutation = function (editor, attachState, data) {
      var selectedElm = editor.selection.getNode();
      var anchorElm = getAnchorElement(editor, selectedElm);
      var linkAttrs = applyLinkOverrides(editor, getLinkAttrs(data));
      editor.undoManager.transact(function () {
        if (data.href === attachState.href) {
          attachState.attach();
        }
        if (anchorElm) {
          editor.focus();
          updateLink(editor, anchorElm, data.text, linkAttrs);
        } else {
          createLink(editor, selectedElm, data.text, linkAttrs);
        }
      });
    };
    var unlinkSelection = function (editor) {
      var dom = editor.dom, selection = editor.selection;
      var bookmark = selection.getBookmark();
      var rng = selection.getRng().cloneRange();
      var startAnchorElm = dom.getParent(rng.startContainer, 'a[href]', editor.getBody());
      var endAnchorElm = dom.getParent(rng.endContainer, 'a[href]', editor.getBody());
      if (startAnchorElm) {
        rng.setStartBefore(startAnchorElm);
      }
      if (endAnchorElm) {
        rng.setEndAfter(endAnchorElm);
      }
      selection.setRng(rng);
      editor.execCommand('unlink');
      selection.moveToBookmark(bookmark);
    };
    var unlinkDomMutation = function (editor) {
      editor.undoManager.transact(function () {
        var node = editor.selection.getNode();
        if (isImageFigure(node)) {
          unlinkImageFigure(editor, node);
        } else {
          unlinkSelection(editor);
        }
        editor.focus();
      });
    };
    var unwrapOptions = function (data) {
      var cls = data.class, href = data.href, rel = data.rel, target = data.target, text = data.text, title = data.title;
      return filter({
        class: cls.getOrNull(),
        href: href,
        rel: rel.getOrNull(),
        target: target.getOrNull(),
        text: text.getOrNull(),
        title: title.getOrNull()
      }, function (v, _k) {
        return isNull(v) === false;
      });
    };
    var link = function (editor, attachState, data) {
      editor.hasPlugin('rtc', true) ? editor.execCommand('createlink', false, unwrapOptions(data)) : linkDomMutation(editor, attachState, data);
    };
    var unlink = function (editor) {
      editor.hasPlugin('rtc', true) ? editor.execCommand('unlink') : unlinkDomMutation(editor);
    };
    var unlinkImageFigure = function (editor, fig) {
      var img = editor.dom.select('img', fig)[0];
      if (img) {
        var a = editor.dom.getParents(img, 'a[href]', fig)[0];
        if (a) {
          a.parentNode.insertBefore(img, a);
          editor.dom.remove(a);
        }
      }
    };
    var linkImageFigure = function (editor, fig, attrs) {
      var img = editor.dom.select('img', fig)[0];
      if (img) {
        var a = editor.dom.create('a', attrs);
        img.parentNode.insertBefore(a, img);
        a.appendChild(img);
      }
    };

    var isListGroup = function (item) {
      return hasNonNullableKey(item, 'items');
    };
    var findTextByValue = function (value, catalog) {
      return findMap(catalog, function (item) {
        if (isListGroup(item)) {
          return findTextByValue(value, item.items);
        } else {
          return someIf(item.value === value, item);
        }
      });
    };
    var getDelta = function (persistentText, fieldName, catalog, data) {
      var value = data[fieldName];
      var hasPersistentText = persistentText.length > 0;
      return value !== undefined ? findTextByValue(value, catalog).map(function (i) {
        return {
          url: {
            value: i.value,
            meta: {
              text: hasPersistentText ? persistentText : i.text,
              attach: noop
            }
          },
          text: hasPersistentText ? persistentText : i.text
        };
      }) : Optional.none();
    };
    var findCatalog = function (catalogs, fieldName) {
      if (fieldName === 'link') {
        return catalogs.link;
      } else if (fieldName === 'anchor') {
        return catalogs.anchor;
      } else {
        return Optional.none();
      }
    };
    var init = function (initialData, linkCatalog) {
      var persistentData = {
        text: initialData.text,
        title: initialData.title
      };
      var getTitleFromUrlChange = function (url) {
        return someIf(persistentData.title.length <= 0, Optional.from(url.meta.title).getOr(''));
      };
      var getTextFromUrlChange = function (url) {
        return someIf(persistentData.text.length <= 0, Optional.from(url.meta.text).getOr(url.value));
      };
      var onUrlChange = function (data) {
        var text = getTextFromUrlChange(data.url);
        var title = getTitleFromUrlChange(data.url);
        if (text.isSome() || title.isSome()) {
          return Optional.some(__assign(__assign({}, text.map(function (text) {
            return { text: text };
          }).getOr({})), title.map(function (title) {
            return { title: title };
          }).getOr({})));
        } else {
          return Optional.none();
        }
      };
      var onCatalogChange = function (data, change) {
        var catalog = findCatalog(linkCatalog, change.name).getOr([]);
        return getDelta(persistentData.text, change.name, catalog, data);
      };
      var onChange = function (getData, change) {
        var name = change.name;
        if (name === 'url') {
          return onUrlChange(getData());
        } else if (contains([
            'anchor',
            'link'
          ], name)) {
          return onCatalogChange(getData(), change);
        } else if (name === 'text' || name === 'title') {
          persistentData[name] = getData()[name];
          return Optional.none();
        } else {
          return Optional.none();
        }
      };
      return { onChange: onChange };
    };
    var DialogChanges = {
      init: init,
      getDelta: getDelta
    };

    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Delay');

    var global$5 = tinymce.util.Tools.resolve('tinymce.util.Promise');

    var delayedConfirm = function (editor, message, callback) {
      var rng = editor.selection.getRng();
      global$4.setEditorTimeout(editor, function () {
        editor.windowManager.confirm(message, function (state) {
          editor.selection.setRng(rng);
          callback(state);
        });
      });
    };
    var tryEmailTransform = function (data) {
      var url = data.href;
      var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('/') === -1 && url.indexOf('mailto:') === -1;
      return suggestMailTo ? Optional.some({
        message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',
        preprocess: function (oldData) {
          return __assign(__assign({}, oldData), { href: 'mailto:' + url });
        }
      }) : Optional.none();
    };
    var tryProtocolTransform = function (assumeExternalTargets, defaultLinkProtocol) {
      return function (data) {
        var url = data.href;
        var suggestProtocol = assumeExternalTargets === 1 && !hasProtocol(url) || assumeExternalTargets === 0 && /^\s*www(\.|\d\.)/i.test(url);
        return suggestProtocol ? Optional.some({
          message: 'The URL you entered seems to be an external link. Do you want to add the required ' + defaultLinkProtocol + ':// prefix?',
          preprocess: function (oldData) {
            return __assign(__assign({}, oldData), { href: defaultLinkProtocol + '://' + url });
          }
        }) : Optional.none();
      };
    };
    var preprocess = function (editor, data) {
      return findMap([
        tryEmailTransform,
        tryProtocolTransform(assumeExternalTargets(editor), getDefaultLinkProtocol(editor))
      ], function (f) {
        return f(data);
      }).fold(function () {
        return global$5.resolve(data);
      }, function (transform) {
        return new global$5(function (callback) {
          delayedConfirm(editor, transform.message, function (state) {
            callback(state ? transform.preprocess(data) : data);
          });
        });
      });
    };
    var DialogConfirms = { preprocess: preprocess };

    var getAnchors = function (editor) {
      var anchorNodes = editor.dom.select('a:not([href])');
      var anchors = bind(anchorNodes, function (anchor) {
        var id = anchor.name || anchor.id;
        return id ? [{
            text: id,
            value: '#' + id
          }] : [];
      });
      return anchors.length > 0 ? Optional.some([{
          text: 'None',
          value: ''
        }].concat(anchors)) : Optional.none();
    };
    var AnchorListOptions = { getAnchors: getAnchors };

    var getClasses = function (editor) {
      var list = getLinkClassList(editor);
      if (list.length > 0) {
        return ListOptions.sanitize(list);
      }
      return Optional.none();
    };
    var ClassListOptions = { getClasses: getClasses };

    var global$6 = tinymce.util.Tools.resolve('tinymce.util.XHR');

    var parseJson = function (text) {
      try {
        return Optional.some(JSON.parse(text));
      } catch (err) {
        return Optional.none();
      }
    };
    var getLinks = function (editor) {
      var extractor = function (item) {
        return editor.convertURL(item.value || item.url, 'href');
      };
      var linkList = getLinkList(editor);
      return new global$5(function (callback) {
        if (isString(linkList)) {
          global$6.send({
            url: linkList,
            success: function (text) {
              return callback(parseJson(text));
            },
            error: function (_) {
              return callback(Optional.none());
            }
          });
        } else if (isFunction(linkList)) {
          linkList(function (output) {
            return callback(Optional.some(output));
          });
        } else {
          callback(Optional.from(linkList));
        }
      }).then(function (optItems) {
        return optItems.bind(ListOptions.sanitizeWith(extractor)).map(function (items) {
          if (items.length > 0) {
            var noneItem = [{
                text: 'None',
                value: ''
              }];
            return noneItem.concat(items);
          } else {
            return items;
          }
        });
      });
    };
    var LinkListOptions = { getLinks: getLinks };

    var getRels = function (editor, initialTarget) {
      var list = getRelList(editor);
      if (list.length > 0) {
        var isTargetBlank_1 = initialTarget.is('_blank');
        var enforceSafe = allowUnsafeLinkTarget(editor) === false;
        var safeRelExtractor = function (item) {
          return applyRelTargetRules(ListOptions.getValue(item), isTargetBlank_1);
        };
        var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;
        return sanitizer(list);
      }
      return Optional.none();
    };
    var RelOptions = { getRels: getRels };

    var fallbacks = [
      {
        text: 'Current window',
        value: ''
      },
      {
        text: 'New window',
        value: '_blank'
      }
    ];
    var getTargets = function (editor) {
      var list = getTargetList(editor);
      if (isArray(list)) {
        return ListOptions.sanitize(list).orThunk(function () {
          return Optional.some(fallbacks);
        });
      } else if (list === false) {
        return Optional.none();
      }
      return Optional.some(fallbacks);
    };
    var TargetOptions = { getTargets: getTargets };

    var nonEmptyAttr = function (dom, elem, name) {
      var val = dom.getAttrib(elem, name);
      return val !== null && val.length > 0 ? Optional.some(val) : Optional.none();
    };
    var extractFromAnchor = function (editor, anchor) {
      var dom = editor.dom;
      var onlyText = isOnlyTextSelected(editor);
      var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)) : Optional.none();
      var url = anchor ? Optional.some(dom.getAttrib(anchor, 'href')) : Optional.none();
      var target = anchor ? Optional.from(dom.getAttrib(anchor, 'target')) : Optional.none();
      var rel = nonEmptyAttr(dom, anchor, 'rel');
      var linkClass = nonEmptyAttr(dom, anchor, 'class');
      var title = nonEmptyAttr(dom, anchor, 'title');
      return {
        url: url,
        text: text,
        title: title,
        target: target,
        rel: rel,
        linkClass: linkClass
      };
    };
    var collect = function (editor, linkNode) {
      return LinkListOptions.getLinks(editor).then(function (links) {
        var anchor = extractFromAnchor(editor, linkNode);
        return {
          anchor: anchor,
          catalogs: {
            targets: TargetOptions.getTargets(editor),
            rels: RelOptions.getRels(editor, anchor.target),
            classes: ClassListOptions.getClasses(editor),
            anchor: AnchorListOptions.getAnchors(editor),
            link: links
          },
          optNode: Optional.from(linkNode),
          flags: { titleEnabled: shouldShowLinkTitle(editor) }
        };
      });
    };
    var DialogInfo = { collect: collect };

    var handleSubmit = function (editor, info) {
      return function (api) {
        var data = api.getData();
        if (!data.url.value) {
          unlink(editor);
          api.close();
          return;
        }
        var getChangedValue = function (key) {
          return Optional.from(data[key]).filter(function (value) {
            return !info.anchor[key].is(value);
          });
        };
        var changedData = {
          href: data.url.value,
          text: getChangedValue('text'),
          target: getChangedValue('target'),
          rel: getChangedValue('rel'),
          class: getChangedValue('linkClass'),
          title: getChangedValue('title')
        };
        var attachState = {
          href: data.url.value,
          attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : noop
        };
        DialogConfirms.preprocess(editor, changedData).then(function (pData) {
          link(editor, attachState, pData);
        });
        api.close();
      };
    };
    var collectData = function (editor) {
      var anchorNode = getAnchorElement(editor);
      return DialogInfo.collect(editor, anchorNode);
    };
    var getInitialData = function (info, defaultTarget) {
      var anchor = info.anchor;
      var url = anchor.url.getOr('');
      return {
        url: {
          value: url,
          meta: { original: { value: url } }
        },
        text: anchor.text.getOr(''),
        title: anchor.title.getOr(''),
        anchor: url,
        link: url,
        rel: anchor.rel.getOr(''),
        target: anchor.target.or(defaultTarget).getOr(''),
        linkClass: anchor.linkClass.getOr('')
      };
    };
    var makeDialog = function (settings, onSubmit, editor) {
      var urlInput = [{
          name: 'url',
          type: 'urlinput',
          filetype: 'file',
          label: 'URL'
        }];
      var displayText = settings.anchor.text.map(function () {
        return {
          name: 'text',
          type: 'input',
          label: 'Text to display'
        };
      }).toArray();
      var titleText = settings.flags.titleEnabled ? [{
          name: 'title',
          type: 'input',
          label: 'Title'
        }] : [];
      var defaultTarget = Optional.from(getDefaultLinkTarget(editor));
      var initialData = getInitialData(settings, defaultTarget);
      var catalogs = settings.catalogs;
      var dialogDelta = DialogChanges.init(initialData, catalogs);
      var body = {
        type: 'panel',
        items: flatten([
          urlInput,
          displayText,
          titleText,
          cat([
            catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')),
            catalogs.rels.map(ListOptions.createUi('rel', 'Rel')),
            catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')),
            catalogs.link.map(ListOptions.createUi('link', 'Link list')),
            catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))
          ])
        ])
      };
      return {
        title: 'Insert/Edit Link',
        size: 'normal',
        body: body,
        buttons: [
          {
            type: 'cancel',
            name: 'cancel',
            text: 'Cancel'
          },
          {
            type: 'submit',
            name: 'save',
            text: 'Save',
            primary: true
          }
        ],
        initialData: initialData,
        onChange: function (api, _a) {
          var name = _a.name;
          dialogDelta.onChange(api.getData, { name: name }).each(function (newData) {
            api.setData(newData);
          });
        },
        onSubmit: onSubmit
      };
    };
    var open = function (editor) {
      var data = collectData(editor);
      data.then(function (info) {
        var onSubmit = handleSubmit(editor, info);
        return makeDialog(info, onSubmit, editor);
      }).then(function (spec) {
        editor.windowManager.open(spec);
      });
    };

    var appendClickRemove = function (link, evt) {
      document.body.appendChild(link);
      link.dispatchEvent(evt);
      document.body.removeChild(link);
    };
    var open$1 = function (url) {
      var link = document.createElement('a');
      link.target = '_blank';
      link.href = url;
      link.rel = 'noreferrer noopener';
      var evt = document.createEvent('MouseEvents');
      evt.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
      appendClickRemove(link, evt);
    };

    var getLink = function (editor, elm) {
      return editor.dom.getParent(elm, 'a[href]');
    };
    var getSelectedLink = function (editor) {
      return getLink(editor, editor.selection.getStart());
    };
    var hasOnlyAltModifier = function (e) {
      return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;
    };
    var gotoLink = function (editor, a) {
      if (a) {
        var href = getHref(a);
        if (/^#/.test(href)) {
          var targetEl = editor.$(href);
          if (targetEl.length) {
            editor.selection.scrollIntoView(targetEl[0], true);
          }
        } else {
          open$1(a.href);
        }
      }
    };
    var openDialog = function (editor) {
      return function () {
        open(editor);
      };
    };
    var gotoSelectedLink = function (editor) {
      return function () {
        gotoLink(editor, getSelectedLink(editor));
      };
    };
    var setupGotoLinks = function (editor) {
      editor.on('click', function (e) {
        var link = getLink(editor, e.target);
        if (link && global$1.metaKeyPressed(e)) {
          e.preventDefault();
          gotoLink(editor, link);
        }
      });
      editor.on('keydown', function (e) {
        var link = getSelectedLink(editor);
        if (link && e.keyCode === 13 && hasOnlyAltModifier(e)) {
          e.preventDefault();
          gotoLink(editor, link);
        }
      });
    };
    var toggleState = function (editor, toggler) {
      editor.on('NodeChange', toggler);
      return function () {
        return editor.off('NodeChange', toggler);
      };
    };
    var toggleActiveState = function (editor) {
      return function (api) {
        return toggleState(editor, function () {
          api.setActive(!editor.mode.isReadOnly() && getAnchorElement(editor, editor.selection.getNode()) !== null);
        });
      };
    };
    var toggleEnabledState = function (editor) {
      return function (api) {
        var updateState = function () {
          return api.setDisabled(getAnchorElement(editor, editor.selection.getNode()) === null);
        };
        updateState();
        return toggleState(editor, updateState);
      };
    };
    var toggleUnlinkState = function (editor) {
      return function (api) {
        var hasLinks$1 = function (parents) {
          return hasLinks(parents) || hasLinksInSelection(editor.selection.getRng());
        };
        var parents = editor.dom.getParents(editor.selection.getStart());
        api.setDisabled(!hasLinks$1(parents));
        return toggleState(editor, function (e) {
          return api.setDisabled(!hasLinks$1(e.parents));
        });
      };
    };

    var register = function (editor) {
      editor.addCommand('mceLink', function () {
        if (useQuickLink(editor)) {
          editor.fire('contexttoolbar-show', { toolbarKey: 'quicklink' });
        } else {
          openDialog(editor)();
        }
      });
    };

    var setup = function (editor) {
      editor.addShortcut('Meta+K', '', function () {
        editor.execCommand('mceLink');
      });
    };

    var setupButtons = function (editor) {
      editor.ui.registry.addToggleButton('link', {
        icon: 'link',
        tooltip: 'Insert/edit link',
        onAction: openDialog(editor),
        onSetup: toggleActiveState(editor)
      });
      editor.ui.registry.addButton('openlink', {
        icon: 'new-tab',
        tooltip: 'Open link',
        onAction: gotoSelectedLink(editor),
        onSetup: toggleEnabledState(editor)
      });
      editor.ui.registry.addButton('unlink', {
        icon: 'unlink',
        tooltip: 'Remove link',
        onAction: function () {
          return unlink(editor);
        },
        onSetup: toggleUnlinkState(editor)
      });
    };
    var setupMenuItems = function (editor) {
      editor.ui.registry.addMenuItem('openlink', {
        text: 'Open link',
        icon: 'new-tab',
        onAction: gotoSelectedLink(editor),
        onSetup: toggleEnabledState(editor)
      });
      editor.ui.registry.addMenuItem('link', {
        icon: 'link',
        text: 'Link...',
        shortcut: 'Meta+K',
        onAction: openDialog(editor)
      });
      editor.ui.registry.addMenuItem('unlink', {
        icon: 'unlink',
        text: 'Remove link',
        onAction: function () {
          return unlink(editor);
        },
        onSetup: toggleUnlinkState(editor)
      });
    };
    var setupContextMenu = function (editor) {
      var inLink = 'link unlink openlink';
      var noLink = 'link';
      editor.ui.registry.addContextMenu('link', {
        update: function (element) {
          return hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;
        }
      });
    };
    var setupContextToolbars = function (editor) {
      var collapseSelectionToEnd = function (editor) {
        editor.selection.collapse(false);
      };
      var onSetupLink = function (buttonApi) {
        var node = editor.selection.getNode();
        buttonApi.setDisabled(!getAnchorElement(editor, node));
        return noop;
      };
      editor.ui.registry.addContextForm('quicklink', {
        launch: {
          type: 'contextformtogglebutton',
          icon: 'link',
          tooltip: 'Link',
          onSetup: toggleActiveState(editor)
        },
        label: 'Link',
        predicate: function (node) {
          return !!getAnchorElement(editor, node) && hasContextToolbar(editor);
        },
        initValue: function () {
          var elm = getAnchorElement(editor);
          return !!elm ? getHref(elm) : '';
        },
        commands: [
          {
            type: 'contextformtogglebutton',
            icon: 'link',
            tooltip: 'Link',
            primary: true,
            onSetup: function (buttonApi) {
              var node = editor.selection.getNode();
              buttonApi.setActive(!!getAnchorElement(editor, node));
              return toggleActiveState(editor)(buttonApi);
            },
            onAction: function (formApi) {
              var anchor = getAnchorElement(editor);
              var value = formApi.getValue();
              if (!anchor) {
                var attachState = {
                  href: value,
                  attach: noop
                };
                var onlyText = isOnlyTextSelected(editor);
                var text = onlyText ? Optional.some(getAnchorText(editor.selection, anchor)).filter(function (t) {
                  return t.length > 0;
                }).or(Optional.from(value)) : Optional.none();
                link(editor, attachState, {
                  href: value,
                  text: text,
                  title: Optional.none(),
                  rel: Optional.none(),
                  target: Optional.none(),
                  class: Optional.none()
                });
                formApi.hide();
              } else {
                editor.undoManager.transact(function () {
                  editor.dom.setAttrib(anchor, 'href', value);
                  collapseSelectionToEnd(editor);
                  formApi.hide();
                });
              }
            }
          },
          {
            type: 'contextformbutton',
            icon: 'unlink',
            tooltip: 'Remove link',
            onSetup: onSetupLink,
            onAction: function (formApi) {
              unlink(editor);
              formApi.hide();
            }
          },
          {
            type: 'contextformbutton',
            icon: 'new-tab',
            tooltip: 'Open link',
            onSetup: onSetupLink,
            onAction: function (formApi) {
              gotoSelectedLink(editor)();
              formApi.hide();
            }
          }
        ]
      });
    };

    function Plugin () {
      global.add('link', function (editor) {
        setupButtons(editor);
        setupMenuItems(editor);
        setupContextMenu(editor);
        setupContextToolbars(editor);
        setupGotoLinks(editor);
        register(editor);
        setup(editor);
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX2xpbmtfaW5kZXhfanMuY2h1bmsuanMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL2xpbmsvaW5kZXguanMiLCIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy9saW5rL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcImxpbmtcIiBwbHVnaW4gZm9yIHVzYWdlIHdpdGggbW9kdWxlIGxvYWRlcnNcbi8vIFVzYWdlOlxuLy8gICBDb21tb25KUzpcbi8vICAgICByZXF1aXJlKCd0aW55bWNlL3BsdWdpbnMvbGluaycpXG4vLyAgIEVTMjAxNTpcbi8vICAgICBpbXBvcnQgJ3RpbnltY2UvcGx1Z2lucy9saW5rJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIGdsb2JhbCQxID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5WSycpO1xuXG4gICAgdmFyIHR5cGVPZiA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgdCA9IHR5cGVvZiB4O1xuICAgICAgaWYgKHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICdudWxsJztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKEFycmF5LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHgpIHx8IHguY29uc3RydWN0b3IgJiYgeC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQXJyYXknKSkge1xuICAgICAgICByZXR1cm4gJ2FycmF5JztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKFN0cmluZy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZih4KSB8fCB4LmNvbnN0cnVjdG9yICYmIHguY29uc3RydWN0b3IubmFtZSA9PT0gJ1N0cmluZycpKSB7XG4gICAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlT2YodmFsdWUpID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1NpbXBsZVR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBlcSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuIHQgPT09IGE7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzU3RyaW5nID0gaXNUeXBlKCdzdHJpbmcnKTtcbiAgICB2YXIgaXNBcnJheSA9IGlzVHlwZSgnYXJyYXknKTtcbiAgICB2YXIgaXNOdWxsID0gZXEobnVsbCk7XG4gICAgdmFyIGlzQm9vbGVhbiA9IGlzU2ltcGxlVHlwZSgnYm9vbGVhbicpO1xuICAgIHZhciBpc0Z1bmN0aW9uID0gaXNTaW1wbGVUeXBlKCdmdW5jdGlvbicpO1xuXG4gICAgdmFyIGFzc3VtZUV4dGVybmFsVGFyZ2V0cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBleHRlcm5hbFRhcmdldHMgPSBlZGl0b3IuZ2V0UGFyYW0oJ2xpbmtfYXNzdW1lX2V4dGVybmFsX3RhcmdldHMnLCBmYWxzZSk7XG4gICAgICBpZiAoaXNCb29sZWFuKGV4dGVybmFsVGFyZ2V0cykgJiYgZXh0ZXJuYWxUYXJnZXRzKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgfSBlbHNlIGlmIChpc1N0cmluZyhleHRlcm5hbFRhcmdldHMpICYmIChleHRlcm5hbFRhcmdldHMgPT09ICdodHRwJyB8fCBleHRlcm5hbFRhcmdldHMgPT09ICdodHRwcycpKSB7XG4gICAgICAgIHJldHVybiBleHRlcm5hbFRhcmdldHM7XG4gICAgICB9XG4gICAgICByZXR1cm4gMDtcbiAgICB9O1xuICAgIHZhciBoYXNDb250ZXh0VG9vbGJhciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2xpbmtfY29udGV4dF90b29sYmFyJywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TGlua0xpc3QgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdsaW5rX2xpc3QnKTtcbiAgICB9O1xuICAgIHZhciBnZXREZWZhdWx0TGlua1RhcmdldCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2RlZmF1bHRfbGlua190YXJnZXQnKTtcbiAgICB9O1xuICAgIHZhciBnZXRUYXJnZXRMaXN0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndGFyZ2V0X2xpc3QnLCB0cnVlKTtcbiAgICB9O1xuICAgIHZhciBnZXRSZWxMaXN0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncmVsX2xpc3QnLCBbXSwgJ2FycmF5Jyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TGlua0NsYXNzTGlzdCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2xpbmtfY2xhc3NfbGlzdCcsIFtdLCAnYXJyYXknKTtcbiAgICB9O1xuICAgIHZhciBzaG91bGRTaG93TGlua1RpdGxlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnbGlua190aXRsZScsIHRydWUsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgYWxsb3dVbnNhZmVMaW5rVGFyZ2V0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnYWxsb3dfdW5zYWZlX2xpbmtfdGFyZ2V0JywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgdXNlUXVpY2tMaW5rID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnbGlua19xdWlja2xpbmsnLCBmYWxzZSwgJ2Jvb2xlYW4nKTtcbiAgICB9O1xuICAgIHZhciBnZXREZWZhdWx0TGlua1Byb3RvY29sID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnbGlua19kZWZhdWx0X3Byb3RvY29sJywgJ2h0dHAnLCAnc3RyaW5nJyk7XG4gICAgfTtcblxuICAgIHZhciBub29wID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgdmFyIGNvbnN0YW50ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG5ldmVyID0gY29uc3RhbnQoZmFsc2UpO1xuICAgIHZhciBhbHdheXMgPSBjb25zdGFudCh0cnVlKTtcblxuICAgIHZhciBub25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE5PTkU7XG4gICAgfTtcbiAgICB2YXIgTk9ORSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlcSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHJldHVybiBvLmlzTm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBjYWxsID0gZnVuY3Rpb24gKHRodW5rKSB7XG4gICAgICAgIHJldHVybiB0aHVuaygpO1xuICAgICAgfTtcbiAgICAgIHZhciBpZCA9IGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIHJldHVybiBuO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIF9zKSB7XG4gICAgICAgICAgcmV0dXJuIG4oKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IG5ldmVyLFxuICAgICAgICBpc1NvbWU6IG5ldmVyLFxuICAgICAgICBpc05vbmU6IGFsd2F5cyxcbiAgICAgICAgZ2V0T3I6IGlkLFxuICAgICAgICBnZXRPclRodW5rOiBjYWxsLFxuICAgICAgICBnZXRPckRpZTogZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cgfHwgJ2Vycm9yOiBnZXRPckRpZSBjYWxsZWQgb24gbm9uZS4nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0T3JOdWxsOiBjb25zdGFudChudWxsKSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50KHVuZGVmaW5lZCksXG4gICAgICAgIG9yOiBpZCxcbiAgICAgICAgb3JUaHVuazogY2FsbCxcbiAgICAgICAgbWFwOiBub25lLFxuICAgICAgICBlYWNoOiBub29wLFxuICAgICAgICBiaW5kOiBub25lLFxuICAgICAgICBleGlzdHM6IG5ldmVyLFxuICAgICAgICBmb3JhbGw6IGFsd2F5cyxcbiAgICAgICAgZmlsdGVyOiBub25lLFxuICAgICAgICBlcXVhbHM6IGVxLFxuICAgICAgICBlcXVhbHNfOiBlcSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9TdHJpbmc6IGNvbnN0YW50KCdub25lKCknKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9KCk7XG4gICAgdmFyIHNvbWUgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgdmFyIGNvbnN0YW50X2EgPSBjb25zdGFudChhKTtcbiAgICAgIHZhciBzZWxmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbWU7XG4gICAgICB9O1xuICAgICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZihhKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWUgPSB7XG4gICAgICAgIGZvbGQ6IGZ1bmN0aW9uIChuLCBzKSB7XG4gICAgICAgICAgcmV0dXJuIHMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzOiBmdW5jdGlvbiAodikge1xuICAgICAgICAgIHJldHVybiBhID09PSB2O1xuICAgICAgICB9LFxuICAgICAgICBpc1NvbWU6IGFsd2F5cyxcbiAgICAgICAgaXNOb25lOiBuZXZlcixcbiAgICAgICAgZ2V0T3I6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yVGh1bms6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yRGllOiBjb25zdGFudF9hLFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yVW5kZWZpbmVkOiBjb25zdGFudF9hLFxuICAgICAgICBvcjogc2VsZixcbiAgICAgICAgb3JUaHVuazogc2VsZixcbiAgICAgICAgbWFwOiBmdW5jdGlvbiAoZikge1xuICAgICAgICAgIHJldHVybiBzb21lKGYoYSkpO1xuICAgICAgICB9LFxuICAgICAgICBlYWNoOiBmdW5jdGlvbiAoZikge1xuICAgICAgICAgIGYoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmQ6IGJpbmQsXG4gICAgICAgIGV4aXN0czogYmluZCxcbiAgICAgICAgZm9yYWxsOiBiaW5kLFxuICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIGYoYSkgPyBtZSA6IE5PTkU7XG4gICAgICAgIH0sXG4gICAgICAgIHRvQXJyYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gW2FdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAnc29tZSgnICsgYSArICcpJztcbiAgICAgICAgfSxcbiAgICAgICAgZXF1YWxzOiBmdW5jdGlvbiAobykge1xuICAgICAgICAgIHJldHVybiBvLmlzKGEpO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHNfOiBmdW5jdGlvbiAobywgZWxlbWVudEVxKSB7XG4gICAgICAgICAgcmV0dXJuIG8uZm9sZChuZXZlciwgZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50RXEoYSwgYik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gbWU7XG4gICAgfTtcbiAgICB2YXIgZnJvbSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgPyBOT05FIDogc29tZSh2YWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgT3B0aW9uYWwgPSB7XG4gICAgICBzb21lOiBzb21lLFxuICAgICAgbm9uZTogbm9uZSxcbiAgICAgIGZyb206IGZyb21cbiAgICB9O1xuXG4gICAgdmFyIG5hdGl2ZUluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZjtcbiAgICB2YXIgbmF0aXZlUHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICAgIHZhciByYXdJbmRleE9mID0gZnVuY3Rpb24gKHRzLCB0KSB7XG4gICAgICByZXR1cm4gbmF0aXZlSW5kZXhPZi5jYWxsKHRzLCB0KTtcbiAgICB9O1xuICAgIHZhciBjb250YWlucyA9IGZ1bmN0aW9uICh4cywgeCkge1xuICAgICAgcmV0dXJuIHJhd0luZGV4T2YoeHMsIHgpID4gLTE7XG4gICAgfTtcbiAgICB2YXIgbWFwID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICB2YXIgbGVuID0geHMubGVuZ3RoO1xuICAgICAgdmFyIHIgPSBuZXcgQXJyYXkobGVuKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgcltpXSA9IGYoeCwgaSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBlYWNoID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgZih4LCBpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBmb2xkbCA9IGZ1bmN0aW9uICh4cywgZiwgYWNjKSB7XG4gICAgICBlYWNoKHhzLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBhY2MgPSBmKGFjYywgeCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfTtcbiAgICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICBpZiAoIWlzQXJyYXkoeHNbaV0pKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcnIuZmxhdHRlbiBpdGVtICcgKyBpICsgJyB3YXMgbm90IGFuIGFycmF5LCBpbnB1dDogJyArIHhzKTtcbiAgICAgICAgfVxuICAgICAgICBuYXRpdmVQdXNoLmFwcGx5KHIsIHhzW2ldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHJldHVybiBmbGF0dGVuKG1hcCh4cywgZikpO1xuICAgIH07XG4gICAgdmFyIGZpbmRNYXAgPSBmdW5jdGlvbiAoYXJyLCBmKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgciA9IGYoYXJyW2ldLCBpKTtcbiAgICAgICAgaWYgKHIuaXNTb21lKCkpIHtcbiAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuXG4gICAgdmFyIGNhdCA9IGZ1bmN0aW9uIChhcnIpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICB2YXIgcHVzaCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHIucHVzaCh4KTtcbiAgICAgIH07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBhcnJbaV0uZWFjaChwdXNoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIHNvbWVJZiA9IGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICByZXR1cm4gYiA/IE9wdGlvbmFsLnNvbWUoYSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkMiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVG9vbHMnKTtcblxuICAgIHZhciBnZXRWYWx1ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gaXNTdHJpbmcoaXRlbS52YWx1ZSkgPyBpdGVtLnZhbHVlIDogJyc7XG4gICAgfTtcbiAgICB2YXIgZ2V0VGV4dCA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpZiAoaXNTdHJpbmcoaXRlbS50ZXh0KSkge1xuICAgICAgICByZXR1cm4gaXRlbS50ZXh0O1xuICAgICAgfSBlbHNlIGlmIChpc1N0cmluZyhpdGVtLnRpdGxlKSkge1xuICAgICAgICByZXR1cm4gaXRlbS50aXRsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzYW5pdGl6ZUxpc3QgPSBmdW5jdGlvbiAobGlzdCwgZXh0cmFjdFZhbHVlKSB7XG4gICAgICB2YXIgb3V0ID0gW107XG4gICAgICBnbG9iYWwkMi5lYWNoKGxpc3QsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gZ2V0VGV4dChpdGVtKTtcbiAgICAgICAgaWYgKGl0ZW0ubWVudSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdmFyIGl0ZW1zID0gc2FuaXRpemVMaXN0KGl0ZW0ubWVudSwgZXh0cmFjdFZhbHVlKTtcbiAgICAgICAgICBvdXQucHVzaCh7XG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHZhbHVlID0gZXh0cmFjdFZhbHVlKGl0ZW0pO1xuICAgICAgICAgIG91dC5wdXNoKHtcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gb3V0O1xuICAgIH07XG4gICAgdmFyIHNhbml0aXplV2l0aCA9IGZ1bmN0aW9uIChleHRyYWN0ZXIpIHtcbiAgICAgIGlmIChleHRyYWN0ZXIgPT09IHZvaWQgMCkge1xuICAgICAgICBleHRyYWN0ZXIgPSBnZXRWYWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShsaXN0KS5tYXAoZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgICByZXR1cm4gc2FuaXRpemVMaXN0KGxpc3QsIGV4dHJhY3Rlcik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzYW5pdGl6ZSA9IGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgICByZXR1cm4gc2FuaXRpemVXaXRoKGdldFZhbHVlKShsaXN0KTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVVaSA9IGZ1bmN0aW9uIChuYW1lLCBsYWJlbCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgdHlwZTogJ2xpc3Rib3gnLFxuICAgICAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgICAgICBpdGVtczogaXRlbXNcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgTGlzdE9wdGlvbnMgPSB7XG4gICAgICBzYW5pdGl6ZTogc2FuaXRpemUsXG4gICAgICBzYW5pdGl6ZVdpdGg6IHNhbml0aXplV2l0aCxcbiAgICAgIGNyZWF0ZVVpOiBjcmVhdGVVaSxcbiAgICAgIGdldFZhbHVlOiBnZXRWYWx1ZVxuICAgIH07XG5cbiAgICB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgICAgIGZvciAodmFyIHAgaW4gcylcbiAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfTtcbiAgICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG5cbiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzO1xuICAgIHZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5oYXNPd25Qcm9wZXJ0eTtcbiAgICB2YXIgZWFjaCQxID0gZnVuY3Rpb24gKG9iaiwgZikge1xuICAgICAgdmFyIHByb3BzID0ga2V5cyhvYmopO1xuICAgICAgZm9yICh2YXIgayA9IDAsIGxlbiA9IHByb3BzLmxlbmd0aDsgayA8IGxlbjsgaysrKSB7XG4gICAgICAgIHZhciBpID0gcHJvcHNba107XG4gICAgICAgIHZhciB4ID0gb2JqW2ldO1xuICAgICAgICBmKHgsIGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG9iakFjYyA9IGZ1bmN0aW9uIChyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgcltpXSA9IHg7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGludGVybmFsRmlsdGVyID0gZnVuY3Rpb24gKG9iaiwgcHJlZCwgb25UcnVlLCBvbkZhbHNlKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgZWFjaCQxKG9iaiwgZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgKHByZWQoeCwgaSkgPyBvblRydWUgOiBvbkZhbHNlKSh4LCBpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZmlsdGVyID0gZnVuY3Rpb24gKG9iaiwgcHJlZCkge1xuICAgICAgdmFyIHQgPSB7fTtcbiAgICAgIGludGVybmFsRmlsdGVyKG9iaiwgcHJlZCwgb2JqQWNjKHQpLCBub29wKTtcbiAgICAgIHJldHVybiB0O1xuICAgIH07XG4gICAgdmFyIGhhcyA9IGZ1bmN0aW9uIChvYmosIGtleSkge1xuICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpO1xuICAgIH07XG4gICAgdmFyIGhhc05vbk51bGxhYmxlS2V5ID0gZnVuY3Rpb24gKG9iaiwga2V5KSB7XG4gICAgICByZXR1cm4gaGFzKG9iaiwga2V5KSAmJiBvYmpba2V5XSAhPT0gdW5kZWZpbmVkICYmIG9ialtrZXldICE9PSBudWxsO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5kb20uVHJlZVdhbGtlcicpO1xuXG4gICAgdmFyIGlzQW5jaG9yID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGVsbSAmJiBlbG0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2EnO1xuICAgIH07XG4gICAgdmFyIGlzTGluayA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBpc0FuY2hvcihlbG0pICYmICEhZ2V0SHJlZihlbG0pO1xuICAgIH07XG4gICAgdmFyIGNvbGxlY3ROb2Rlc0luUmFuZ2UgPSBmdW5jdGlvbiAocm5nLCBwcmVkaWNhdGUpIHtcbiAgICAgIGlmIChybmcuY29sbGFwc2VkKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBjb250ZW50cyA9IHJuZy5jbG9uZUNvbnRlbnRzKCk7XG4gICAgICAgIHZhciB3YWxrZXIgPSBuZXcgZ2xvYmFsJDMoY29udGVudHMuZmlyc3RDaGlsZCwgY29udGVudHMpO1xuICAgICAgICB2YXIgZWxlbWVudHMgPSBbXTtcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBjb250ZW50cy5maXJzdENoaWxkO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgaWYgKHByZWRpY2F0ZShjdXJyZW50KSkge1xuICAgICAgICAgICAgZWxlbWVudHMucHVzaChjdXJyZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gd2hpbGUgKGN1cnJlbnQgPSB3YWxrZXIubmV4dCgpKTtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGhhc1Byb3RvY29sID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgcmV0dXJuIC9eXFx3KzovaS50ZXN0KHVybCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SHJlZiA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHZhciBocmVmID0gZWxtLmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtaHJlZicpO1xuICAgICAgcmV0dXJuIGhyZWYgPyBocmVmIDogZWxtLmdldEF0dHJpYnV0ZSgnaHJlZicpO1xuICAgIH07XG4gICAgdmFyIGFwcGx5UmVsVGFyZ2V0UnVsZXMgPSBmdW5jdGlvbiAocmVsLCBpc1Vuc2FmZSkge1xuICAgICAgdmFyIHJ1bGVzID0gWydub29wZW5lciddO1xuICAgICAgdmFyIHJlbHMgPSByZWwgPyByZWwuc3BsaXQoL1xccysvKSA6IFtdO1xuICAgICAgdmFyIHRvU3RyaW5nID0gZnVuY3Rpb24gKHJlbHMpIHtcbiAgICAgICAgcmV0dXJuIGdsb2JhbCQyLnRyaW0ocmVscy5zb3J0KCkuam9pbignICcpKTtcbiAgICAgIH07XG4gICAgICB2YXIgYWRkVGFyZ2V0UnVsZXMgPSBmdW5jdGlvbiAocmVscykge1xuICAgICAgICByZWxzID0gcmVtb3ZlVGFyZ2V0UnVsZXMocmVscyk7XG4gICAgICAgIHJldHVybiByZWxzLmxlbmd0aCA+IDAgPyByZWxzLmNvbmNhdChydWxlcykgOiBydWxlcztcbiAgICAgIH07XG4gICAgICB2YXIgcmVtb3ZlVGFyZ2V0UnVsZXMgPSBmdW5jdGlvbiAocmVscykge1xuICAgICAgICByZXR1cm4gcmVscy5maWx0ZXIoZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgIHJldHVybiBnbG9iYWwkMi5pbkFycmF5KHJ1bGVzLCB2YWwpID09PSAtMTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG5ld1JlbHMgPSBpc1Vuc2FmZSA/IGFkZFRhcmdldFJ1bGVzKHJlbHMpIDogcmVtb3ZlVGFyZ2V0UnVsZXMocmVscyk7XG4gICAgICByZXR1cm4gbmV3UmVscy5sZW5ndGggPiAwID8gdG9TdHJpbmcobmV3UmVscykgOiAnJztcbiAgICB9O1xuICAgIHZhciB0cmltQ2FyZXRDb250YWluZXJzID0gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xcdUZFRkYvZywgJycpO1xuICAgIH07XG4gICAgdmFyIGdldEFuY2hvckVsZW1lbnQgPSBmdW5jdGlvbiAoZWRpdG9yLCBzZWxlY3RlZEVsbSkge1xuICAgICAgc2VsZWN0ZWRFbG0gPSBzZWxlY3RlZEVsbSB8fCBlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKTtcbiAgICAgIGlmIChpc0ltYWdlRmlndXJlKHNlbGVjdGVkRWxtKSkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmRvbS5zZWxlY3QoJ2FbaHJlZl0nLCBzZWxlY3RlZEVsbSlbMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmRvbS5nZXRQYXJlbnQoc2VsZWN0ZWRFbG0sICdhW2hyZWZdJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0QW5jaG9yVGV4dCA9IGZ1bmN0aW9uIChzZWxlY3Rpb24sIGFuY2hvckVsbSkge1xuICAgICAgdmFyIHRleHQgPSBhbmNob3JFbG0gPyBhbmNob3JFbG0uaW5uZXJUZXh0IHx8IGFuY2hvckVsbS50ZXh0Q29udGVudCA6IHNlbGVjdGlvbi5nZXRDb250ZW50KHsgZm9ybWF0OiAndGV4dCcgfSk7XG4gICAgICByZXR1cm4gdHJpbUNhcmV0Q29udGFpbmVycyh0ZXh0KTtcbiAgICB9O1xuICAgIHZhciBoYXNMaW5rcyA9IGZ1bmN0aW9uIChlbGVtZW50cykge1xuICAgICAgcmV0dXJuIGdsb2JhbCQyLmdyZXAoZWxlbWVudHMsIGlzTGluaykubGVuZ3RoID4gMDtcbiAgICB9O1xuICAgIHZhciBoYXNMaW5rc0luU2VsZWN0aW9uID0gZnVuY3Rpb24gKHJuZykge1xuICAgICAgcmV0dXJuIGNvbGxlY3ROb2Rlc0luUmFuZ2Uocm5nLCBpc0xpbmspLmxlbmd0aCA+IDA7XG4gICAgfTtcbiAgICB2YXIgaXNPbmx5VGV4dFNlbGVjdGVkID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGlubGluZVRleHRFbGVtZW50cyA9IGVkaXRvci5zY2hlbWEuZ2V0VGV4dElubGluZUVsZW1lbnRzKCk7XG4gICAgICB2YXIgaXNFbGVtZW50ID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICByZXR1cm4gZWxtLm5vZGVUeXBlID09PSAxICYmICFpc0FuY2hvcihlbG0pICYmICFoYXMoaW5saW5lVGV4dEVsZW1lbnRzLCBlbG0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGVsZW1lbnRzID0gY29sbGVjdE5vZGVzSW5SYW5nZShlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpLCBpc0VsZW1lbnQpO1xuICAgICAgcmV0dXJuIGVsZW1lbnRzLmxlbmd0aCA9PT0gMDtcbiAgICB9O1xuICAgIHZhciBpc0ltYWdlRmlndXJlID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGVsbSAmJiBlbG0ubm9kZU5hbWUgPT09ICdGSUdVUkUnICYmIC9cXGJpbWFnZVxcYi9pLnRlc3QoZWxtLmNsYXNzTmFtZSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TGlua0F0dHJzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIHJldHVybiBmb2xkbChbXG4gICAgICAgICd0aXRsZScsXG4gICAgICAgICdyZWwnLFxuICAgICAgICAnY2xhc3MnLFxuICAgICAgICAndGFyZ2V0J1xuICAgICAgXSwgZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgICAgIGRhdGFba2V5XS5lYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGFjY1trZXldID0gdmFsdWUubGVuZ3RoID4gMCA/IHZhbHVlIDogbnVsbDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCB7IGhyZWY6IGRhdGEuaHJlZiB9KTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVFeHRlcm5hbFRhcmdldHMgPSBmdW5jdGlvbiAoaHJlZiwgYXNzdW1lRXh0ZXJuYWxUYXJnZXRzKSB7XG4gICAgICBpZiAoKGFzc3VtZUV4dGVybmFsVGFyZ2V0cyA9PT0gJ2h0dHAnIHx8IGFzc3VtZUV4dGVybmFsVGFyZ2V0cyA9PT0gJ2h0dHBzJykgJiYgIWhhc1Byb3RvY29sKGhyZWYpKSB7XG4gICAgICAgIHJldHVybiBhc3N1bWVFeHRlcm5hbFRhcmdldHMgKyAnOi8vJyArIGhyZWY7XG4gICAgICB9XG4gICAgICByZXR1cm4gaHJlZjtcbiAgICB9O1xuICAgIHZhciBhcHBseUxpbmtPdmVycmlkZXMgPSBmdW5jdGlvbiAoZWRpdG9yLCBsaW5rQXR0cnMpIHtcbiAgICAgIHZhciBuZXdMaW5rQXR0cnMgPSBfX2Fzc2lnbih7fSwgbGlua0F0dHJzKTtcbiAgICAgIGlmICghKGdldFJlbExpc3QoZWRpdG9yKS5sZW5ndGggPiAwKSAmJiBhbGxvd1Vuc2FmZUxpbmtUYXJnZXQoZWRpdG9yKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIG5ld1JlbCA9IGFwcGx5UmVsVGFyZ2V0UnVsZXMobmV3TGlua0F0dHJzLnJlbCwgbmV3TGlua0F0dHJzLnRhcmdldCA9PT0gJ19ibGFuaycpO1xuICAgICAgICBuZXdMaW5rQXR0cnMucmVsID0gbmV3UmVsID8gbmV3UmVsIDogbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChPcHRpb25hbC5mcm9tKG5ld0xpbmtBdHRycy50YXJnZXQpLmlzTm9uZSgpICYmIGdldFRhcmdldExpc3QoZWRpdG9yKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgbmV3TGlua0F0dHJzLnRhcmdldCA9IGdldERlZmF1bHRMaW5rVGFyZ2V0KGVkaXRvcik7XG4gICAgICB9XG4gICAgICBuZXdMaW5rQXR0cnMuaHJlZiA9IGhhbmRsZUV4dGVybmFsVGFyZ2V0cyhuZXdMaW5rQXR0cnMuaHJlZiwgYXNzdW1lRXh0ZXJuYWxUYXJnZXRzKGVkaXRvcikpO1xuICAgICAgcmV0dXJuIG5ld0xpbmtBdHRycztcbiAgICB9O1xuICAgIHZhciB1cGRhdGVMaW5rID0gZnVuY3Rpb24gKGVkaXRvciwgYW5jaG9yRWxtLCB0ZXh0LCBsaW5rQXR0cnMpIHtcbiAgICAgIHRleHQuZWFjaChmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICBpZiAoYW5jaG9yRWxtLmhhc093blByb3BlcnR5KCdpbm5lclRleHQnKSkge1xuICAgICAgICAgIGFuY2hvckVsbS5pbm5lclRleHQgPSB0ZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFuY2hvckVsbS50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLmRvbS5zZXRBdHRyaWJzKGFuY2hvckVsbSwgbGlua0F0dHJzKTtcbiAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2VsZWN0KGFuY2hvckVsbSk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlTGluayA9IGZ1bmN0aW9uIChlZGl0b3IsIHNlbGVjdGVkRWxtLCB0ZXh0LCBsaW5rQXR0cnMpIHtcbiAgICAgIGlmIChpc0ltYWdlRmlndXJlKHNlbGVjdGVkRWxtKSkge1xuICAgICAgICBsaW5rSW1hZ2VGaWd1cmUoZWRpdG9yLCBzZWxlY3RlZEVsbSwgbGlua0F0dHJzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRleHQuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VJbnNlcnRMaW5rJywgZmFsc2UsIGxpbmtBdHRycyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgZWRpdG9yLmluc2VydENvbnRlbnQoZWRpdG9yLmRvbS5jcmVhdGVIVE1MKCdhJywgbGlua0F0dHJzLCBlZGl0b3IuZG9tLmVuY29kZSh0ZXh0KSkpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBsaW5rRG9tTXV0YXRpb24gPSBmdW5jdGlvbiAoZWRpdG9yLCBhdHRhY2hTdGF0ZSwgZGF0YSkge1xuICAgICAgdmFyIHNlbGVjdGVkRWxtID0gZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCk7XG4gICAgICB2YXIgYW5jaG9yRWxtID0gZ2V0QW5jaG9yRWxlbWVudChlZGl0b3IsIHNlbGVjdGVkRWxtKTtcbiAgICAgIHZhciBsaW5rQXR0cnMgPSBhcHBseUxpbmtPdmVycmlkZXMoZWRpdG9yLCBnZXRMaW5rQXR0cnMoZGF0YSkpO1xuICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRhdGEuaHJlZiA9PT0gYXR0YWNoU3RhdGUuaHJlZikge1xuICAgICAgICAgIGF0dGFjaFN0YXRlLmF0dGFjaCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhbmNob3JFbG0pIHtcbiAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICB1cGRhdGVMaW5rKGVkaXRvciwgYW5jaG9yRWxtLCBkYXRhLnRleHQsIGxpbmtBdHRycyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3JlYXRlTGluayhlZGl0b3IsIHNlbGVjdGVkRWxtLCBkYXRhLnRleHQsIGxpbmtBdHRycyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHVubGlua1NlbGVjdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tLCBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uO1xuICAgICAgdmFyIGJvb2ttYXJrID0gc2VsZWN0aW9uLmdldEJvb2ttYXJrKCk7XG4gICAgICB2YXIgcm5nID0gc2VsZWN0aW9uLmdldFJuZygpLmNsb25lUmFuZ2UoKTtcbiAgICAgIHZhciBzdGFydEFuY2hvckVsbSA9IGRvbS5nZXRQYXJlbnQocm5nLnN0YXJ0Q29udGFpbmVyLCAnYVtocmVmXScsIGVkaXRvci5nZXRCb2R5KCkpO1xuICAgICAgdmFyIGVuZEFuY2hvckVsbSA9IGRvbS5nZXRQYXJlbnQocm5nLmVuZENvbnRhaW5lciwgJ2FbaHJlZl0nLCBlZGl0b3IuZ2V0Qm9keSgpKTtcbiAgICAgIGlmIChzdGFydEFuY2hvckVsbSkge1xuICAgICAgICBybmcuc2V0U3RhcnRCZWZvcmUoc3RhcnRBbmNob3JFbG0pO1xuICAgICAgfVxuICAgICAgaWYgKGVuZEFuY2hvckVsbSkge1xuICAgICAgICBybmcuc2V0RW5kQWZ0ZXIoZW5kQW5jaG9yRWxtKTtcbiAgICAgIH1cbiAgICAgIHNlbGVjdGlvbi5zZXRSbmcocm5nKTtcbiAgICAgIGVkaXRvci5leGVjQ29tbWFuZCgndW5saW5rJyk7XG4gICAgICBzZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuICAgIH07XG4gICAgdmFyIHVubGlua0RvbU11dGF0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKTtcbiAgICAgICAgaWYgKGlzSW1hZ2VGaWd1cmUobm9kZSkpIHtcbiAgICAgICAgICB1bmxpbmtJbWFnZUZpZ3VyZShlZGl0b3IsIG5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVubGlua1NlbGVjdGlvbihlZGl0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdW53cmFwT3B0aW9ucyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgY2xzID0gZGF0YS5jbGFzcywgaHJlZiA9IGRhdGEuaHJlZiwgcmVsID0gZGF0YS5yZWwsIHRhcmdldCA9IGRhdGEudGFyZ2V0LCB0ZXh0ID0gZGF0YS50ZXh0LCB0aXRsZSA9IGRhdGEudGl0bGU7XG4gICAgICByZXR1cm4gZmlsdGVyKHtcbiAgICAgICAgY2xhc3M6IGNscy5nZXRPck51bGwoKSxcbiAgICAgICAgaHJlZjogaHJlZixcbiAgICAgICAgcmVsOiByZWwuZ2V0T3JOdWxsKCksXG4gICAgICAgIHRhcmdldDogdGFyZ2V0LmdldE9yTnVsbCgpLFxuICAgICAgICB0ZXh0OiB0ZXh0LmdldE9yTnVsbCgpLFxuICAgICAgICB0aXRsZTogdGl0bGUuZ2V0T3JOdWxsKClcbiAgICAgIH0sIGZ1bmN0aW9uICh2LCBfaykge1xuICAgICAgICByZXR1cm4gaXNOdWxsKHYpID09PSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGxpbmsgPSBmdW5jdGlvbiAoZWRpdG9yLCBhdHRhY2hTdGF0ZSwgZGF0YSkge1xuICAgICAgZWRpdG9yLmhhc1BsdWdpbigncnRjJywgdHJ1ZSkgPyBlZGl0b3IuZXhlY0NvbW1hbmQoJ2NyZWF0ZWxpbmsnLCBmYWxzZSwgdW53cmFwT3B0aW9ucyhkYXRhKSkgOiBsaW5rRG9tTXV0YXRpb24oZWRpdG9yLCBhdHRhY2hTdGF0ZSwgZGF0YSk7XG4gICAgfTtcbiAgICB2YXIgdW5saW5rID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLmhhc1BsdWdpbigncnRjJywgdHJ1ZSkgPyBlZGl0b3IuZXhlY0NvbW1hbmQoJ3VubGluaycpIDogdW5saW5rRG9tTXV0YXRpb24oZWRpdG9yKTtcbiAgICB9O1xuICAgIHZhciB1bmxpbmtJbWFnZUZpZ3VyZSA9IGZ1bmN0aW9uIChlZGl0b3IsIGZpZykge1xuICAgICAgdmFyIGltZyA9IGVkaXRvci5kb20uc2VsZWN0KCdpbWcnLCBmaWcpWzBdO1xuICAgICAgaWYgKGltZykge1xuICAgICAgICB2YXIgYSA9IGVkaXRvci5kb20uZ2V0UGFyZW50cyhpbWcsICdhW2hyZWZdJywgZmlnKVswXTtcbiAgICAgICAgaWYgKGEpIHtcbiAgICAgICAgICBhLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGltZywgYSk7XG4gICAgICAgICAgZWRpdG9yLmRvbS5yZW1vdmUoYSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBsaW5rSW1hZ2VGaWd1cmUgPSBmdW5jdGlvbiAoZWRpdG9yLCBmaWcsIGF0dHJzKSB7XG4gICAgICB2YXIgaW1nID0gZWRpdG9yLmRvbS5zZWxlY3QoJ2ltZycsIGZpZylbMF07XG4gICAgICBpZiAoaW1nKSB7XG4gICAgICAgIHZhciBhID0gZWRpdG9yLmRvbS5jcmVhdGUoJ2EnLCBhdHRycyk7XG4gICAgICAgIGltZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBpbWcpO1xuICAgICAgICBhLmFwcGVuZENoaWxkKGltZyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBpc0xpc3RHcm91cCA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gaGFzTm9uTnVsbGFibGVLZXkoaXRlbSwgJ2l0ZW1zJyk7XG4gICAgfTtcbiAgICB2YXIgZmluZFRleHRCeVZhbHVlID0gZnVuY3Rpb24gKHZhbHVlLCBjYXRhbG9nKSB7XG4gICAgICByZXR1cm4gZmluZE1hcChjYXRhbG9nLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICBpZiAoaXNMaXN0R3JvdXAoaXRlbSkpIHtcbiAgICAgICAgICByZXR1cm4gZmluZFRleHRCeVZhbHVlKHZhbHVlLCBpdGVtLml0ZW1zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gc29tZUlmKGl0ZW0udmFsdWUgPT09IHZhbHVlLCBpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGVsdGEgPSBmdW5jdGlvbiAocGVyc2lzdGVudFRleHQsIGZpZWxkTmFtZSwgY2F0YWxvZywgZGF0YSkge1xuICAgICAgdmFyIHZhbHVlID0gZGF0YVtmaWVsZE5hbWVdO1xuICAgICAgdmFyIGhhc1BlcnNpc3RlbnRUZXh0ID0gcGVyc2lzdGVudFRleHQubGVuZ3RoID4gMDtcbiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gZmluZFRleHRCeVZhbHVlKHZhbHVlLCBjYXRhbG9nKS5tYXAoZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1cmw6IHtcbiAgICAgICAgICAgIHZhbHVlOiBpLnZhbHVlLFxuICAgICAgICAgICAgbWV0YToge1xuICAgICAgICAgICAgICB0ZXh0OiBoYXNQZXJzaXN0ZW50VGV4dCA/IHBlcnNpc3RlbnRUZXh0IDogaS50ZXh0LFxuICAgICAgICAgICAgICBhdHRhY2g6IG5vb3BcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHQ6IGhhc1BlcnNpc3RlbnRUZXh0ID8gcGVyc2lzdGVudFRleHQgOiBpLnRleHRcbiAgICAgICAgfTtcbiAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGZpbmRDYXRhbG9nID0gZnVuY3Rpb24gKGNhdGFsb2dzLCBmaWVsZE5hbWUpIHtcbiAgICAgIGlmIChmaWVsZE5hbWUgPT09ICdsaW5rJykge1xuICAgICAgICByZXR1cm4gY2F0YWxvZ3MubGluaztcbiAgICAgIH0gZWxzZSBpZiAoZmllbGROYW1lID09PSAnYW5jaG9yJykge1xuICAgICAgICByZXR1cm4gY2F0YWxvZ3MuYW5jaG9yO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKGluaXRpYWxEYXRhLCBsaW5rQ2F0YWxvZykge1xuICAgICAgdmFyIHBlcnNpc3RlbnREYXRhID0ge1xuICAgICAgICB0ZXh0OiBpbml0aWFsRGF0YS50ZXh0LFxuICAgICAgICB0aXRsZTogaW5pdGlhbERhdGEudGl0bGVcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VGl0bGVGcm9tVXJsQ2hhbmdlID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgICByZXR1cm4gc29tZUlmKHBlcnNpc3RlbnREYXRhLnRpdGxlLmxlbmd0aCA8PSAwLCBPcHRpb25hbC5mcm9tKHVybC5tZXRhLnRpdGxlKS5nZXRPcignJykpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRUZXh0RnJvbVVybENoYW5nZSA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIHNvbWVJZihwZXJzaXN0ZW50RGF0YS50ZXh0Lmxlbmd0aCA8PSAwLCBPcHRpb25hbC5mcm9tKHVybC5tZXRhLnRleHQpLmdldE9yKHVybC52YWx1ZSkpO1xuICAgICAgfTtcbiAgICAgIHZhciBvblVybENoYW5nZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gZ2V0VGV4dEZyb21VcmxDaGFuZ2UoZGF0YS51cmwpO1xuICAgICAgICB2YXIgdGl0bGUgPSBnZXRUaXRsZUZyb21VcmxDaGFuZ2UoZGF0YS51cmwpO1xuICAgICAgICBpZiAodGV4dC5pc1NvbWUoKSB8fCB0aXRsZS5pc1NvbWUoKSkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKF9fYXNzaWduKF9fYXNzaWduKHt9LCB0ZXh0Lm1hcChmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGV4dDogdGV4dCB9O1xuICAgICAgICAgIH0pLmdldE9yKHt9KSksIHRpdGxlLm1hcChmdW5jdGlvbiAodGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHRpdGxlOiB0aXRsZSB9O1xuICAgICAgICAgIH0pLmdldE9yKHt9KSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgb25DYXRhbG9nQ2hhbmdlID0gZnVuY3Rpb24gKGRhdGEsIGNoYW5nZSkge1xuICAgICAgICB2YXIgY2F0YWxvZyA9IGZpbmRDYXRhbG9nKGxpbmtDYXRhbG9nLCBjaGFuZ2UubmFtZSkuZ2V0T3IoW10pO1xuICAgICAgICByZXR1cm4gZ2V0RGVsdGEocGVyc2lzdGVudERhdGEudGV4dCwgY2hhbmdlLm5hbWUsIGNhdGFsb2csIGRhdGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uIChnZXREYXRhLCBjaGFuZ2UpIHtcbiAgICAgICAgdmFyIG5hbWUgPSBjaGFuZ2UubmFtZTtcbiAgICAgICAgaWYgKG5hbWUgPT09ICd1cmwnKSB7XG4gICAgICAgICAgcmV0dXJuIG9uVXJsQ2hhbmdlKGdldERhdGEoKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29udGFpbnMoW1xuICAgICAgICAgICAgJ2FuY2hvcicsXG4gICAgICAgICAgICAnbGluaydcbiAgICAgICAgICBdLCBuYW1lKSkge1xuICAgICAgICAgIHJldHVybiBvbkNhdGFsb2dDaGFuZ2UoZ2V0RGF0YSgpLCBjaGFuZ2UpO1xuICAgICAgICB9IGVsc2UgaWYgKG5hbWUgPT09ICd0ZXh0JyB8fCBuYW1lID09PSAndGl0bGUnKSB7XG4gICAgICAgICAgcGVyc2lzdGVudERhdGFbbmFtZV0gPSBnZXREYXRhKClbbmFtZV07XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHsgb25DaGFuZ2U6IG9uQ2hhbmdlIH07XG4gICAgfTtcbiAgICB2YXIgRGlhbG9nQ2hhbmdlcyA9IHtcbiAgICAgIGluaXQ6IGluaXQsXG4gICAgICBnZXREZWx0YTogZ2V0RGVsdGFcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCQ0ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5EZWxheScpO1xuXG4gICAgdmFyIGdsb2JhbCQ1ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5Qcm9taXNlJyk7XG5cbiAgICB2YXIgZGVsYXllZENvbmZpcm0gPSBmdW5jdGlvbiAoZWRpdG9yLCBtZXNzYWdlLCBjYWxsYmFjaykge1xuICAgICAgdmFyIHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG4gICAgICBnbG9iYWwkNC5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5jb25maXJtKG1lc3NhZ2UsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG4gICAgICAgICAgY2FsbGJhY2soc3RhdGUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRyeUVtYWlsVHJhbnNmb3JtID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIHZhciB1cmwgPSBkYXRhLmhyZWY7XG4gICAgICB2YXIgc3VnZ2VzdE1haWxUbyA9IHVybC5pbmRleE9mKCdAJykgPiAwICYmIHVybC5pbmRleE9mKCcvJykgPT09IC0xICYmIHVybC5pbmRleE9mKCdtYWlsdG86JykgPT09IC0xO1xuICAgICAgcmV0dXJuIHN1Z2dlc3RNYWlsVG8gPyBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgbWVzc2FnZTogJ1RoZSBVUkwgeW91IGVudGVyZWQgc2VlbXMgdG8gYmUgYW4gZW1haWwgYWRkcmVzcy4gRG8geW91IHdhbnQgdG8gYWRkIHRoZSByZXF1aXJlZCBtYWlsdG86IHByZWZpeD8nLFxuICAgICAgICBwcmVwcm9jZXNzOiBmdW5jdGlvbiAob2xkRGF0YSkge1xuICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgb2xkRGF0YSksIHsgaHJlZjogJ21haWx0bzonICsgdXJsIH0pO1xuICAgICAgICB9XG4gICAgICB9KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciB0cnlQcm90b2NvbFRyYW5zZm9ybSA9IGZ1bmN0aW9uIChhc3N1bWVFeHRlcm5hbFRhcmdldHMsIGRlZmF1bHRMaW5rUHJvdG9jb2wpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgdXJsID0gZGF0YS5ocmVmO1xuICAgICAgICB2YXIgc3VnZ2VzdFByb3RvY29sID0gYXNzdW1lRXh0ZXJuYWxUYXJnZXRzID09PSAxICYmICFoYXNQcm90b2NvbCh1cmwpIHx8IGFzc3VtZUV4dGVybmFsVGFyZ2V0cyA9PT0gMCAmJiAvXlxccyp3d3coXFwufFxcZFxcLikvaS50ZXN0KHVybCk7XG4gICAgICAgIHJldHVybiBzdWdnZXN0UHJvdG9jb2wgPyBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVGhlIFVSTCB5b3UgZW50ZXJlZCBzZWVtcyB0byBiZSBhbiBleHRlcm5hbCBsaW5rLiBEbyB5b3Ugd2FudCB0byBhZGQgdGhlIHJlcXVpcmVkICcgKyBkZWZhdWx0TGlua1Byb3RvY29sICsgJzovLyBwcmVmaXg/JyxcbiAgICAgICAgICBwcmVwcm9jZXNzOiBmdW5jdGlvbiAob2xkRGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBvbGREYXRhKSwgeyBocmVmOiBkZWZhdWx0TGlua1Byb3RvY29sICsgJzovLycgKyB1cmwgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcHJlcHJvY2VzcyA9IGZ1bmN0aW9uIChlZGl0b3IsIGRhdGEpIHtcbiAgICAgIHJldHVybiBmaW5kTWFwKFtcbiAgICAgICAgdHJ5RW1haWxUcmFuc2Zvcm0sXG4gICAgICAgIHRyeVByb3RvY29sVHJhbnNmb3JtKGFzc3VtZUV4dGVybmFsVGFyZ2V0cyhlZGl0b3IpLCBnZXREZWZhdWx0TGlua1Byb3RvY29sKGVkaXRvcikpXG4gICAgICBdLCBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZihkYXRhKTtcbiAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2xvYmFsJDUucmVzb2x2ZShkYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uICh0cmFuc2Zvcm0pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBnbG9iYWwkNShmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICBkZWxheWVkQ29uZmlybShlZGl0b3IsIHRyYW5zZm9ybS5tZXNzYWdlLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHN0YXRlID8gdHJhbnNmb3JtLnByZXByb2Nlc3MoZGF0YSkgOiBkYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBEaWFsb2dDb25maXJtcyA9IHsgcHJlcHJvY2VzczogcHJlcHJvY2VzcyB9O1xuXG4gICAgdmFyIGdldEFuY2hvcnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgYW5jaG9yTm9kZXMgPSBlZGl0b3IuZG9tLnNlbGVjdCgnYTpub3QoW2hyZWZdKScpO1xuICAgICAgdmFyIGFuY2hvcnMgPSBiaW5kKGFuY2hvck5vZGVzLCBmdW5jdGlvbiAoYW5jaG9yKSB7XG4gICAgICAgIHZhciBpZCA9IGFuY2hvci5uYW1lIHx8IGFuY2hvci5pZDtcbiAgICAgICAgcmV0dXJuIGlkID8gW3tcbiAgICAgICAgICAgIHRleHQ6IGlkLFxuICAgICAgICAgICAgdmFsdWU6ICcjJyArIGlkXG4gICAgICAgICAgfV0gOiBbXTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFuY2hvcnMubGVuZ3RoID4gMCA/IE9wdGlvbmFsLnNvbWUoW3tcbiAgICAgICAgICB0ZXh0OiAnTm9uZScsXG4gICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgIH1dLmNvbmNhdChhbmNob3JzKSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgQW5jaG9yTGlzdE9wdGlvbnMgPSB7IGdldEFuY2hvcnM6IGdldEFuY2hvcnMgfTtcblxuICAgIHZhciBnZXRDbGFzc2VzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGxpc3QgPSBnZXRMaW5rQ2xhc3NMaXN0KGVkaXRvcik7XG4gICAgICBpZiAobGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBMaXN0T3B0aW9ucy5zYW5pdGl6ZShsaXN0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgQ2xhc3NMaXN0T3B0aW9ucyA9IHsgZ2V0Q2xhc3NlczogZ2V0Q2xhc3NlcyB9O1xuXG4gICAgdmFyIGdsb2JhbCQ2ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5YSFInKTtcblxuICAgIHZhciBwYXJzZUpzb24gPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoSlNPTi5wYXJzZSh0ZXh0KSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRMaW5rcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBleHRyYWN0b3IgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmNvbnZlcnRVUkwoaXRlbS52YWx1ZSB8fCBpdGVtLnVybCwgJ2hyZWYnKTtcbiAgICAgIH07XG4gICAgICB2YXIgbGlua0xpc3QgPSBnZXRMaW5rTGlzdChlZGl0b3IpO1xuICAgICAgcmV0dXJuIG5ldyBnbG9iYWwkNShmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGlzU3RyaW5nKGxpbmtMaXN0KSkge1xuICAgICAgICAgIGdsb2JhbCQ2LnNlbmQoe1xuICAgICAgICAgICAgdXJsOiBsaW5rTGlzdCxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhwYXJzZUpzb24odGV4dCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoXykge1xuICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChpc0Z1bmN0aW9uKGxpbmtMaXN0KSkge1xuICAgICAgICAgIGxpbmtMaXN0KGZ1bmN0aW9uIChvdXRwdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhPcHRpb25hbC5zb21lKG91dHB1dCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhbGxiYWNrKE9wdGlvbmFsLmZyb20obGlua0xpc3QpKTtcbiAgICAgICAgfVxuICAgICAgfSkudGhlbihmdW5jdGlvbiAob3B0SXRlbXMpIHtcbiAgICAgICAgcmV0dXJuIG9wdEl0ZW1zLmJpbmQoTGlzdE9wdGlvbnMuc2FuaXRpemVXaXRoKGV4dHJhY3RvcikpLm1hcChmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIG5vbmVJdGVtID0gW3tcbiAgICAgICAgICAgICAgICB0ZXh0OiAnTm9uZScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgICAgICAgIH1dO1xuICAgICAgICAgICAgcmV0dXJuIG5vbmVJdGVtLmNvbmNhdChpdGVtcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtcztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgTGlua0xpc3RPcHRpb25zID0geyBnZXRMaW5rczogZ2V0TGlua3MgfTtcblxuICAgIHZhciBnZXRSZWxzID0gZnVuY3Rpb24gKGVkaXRvciwgaW5pdGlhbFRhcmdldCkge1xuICAgICAgdmFyIGxpc3QgPSBnZXRSZWxMaXN0KGVkaXRvcik7XG4gICAgICBpZiAobGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciBpc1RhcmdldEJsYW5rXzEgPSBpbml0aWFsVGFyZ2V0LmlzKCdfYmxhbmsnKTtcbiAgICAgICAgdmFyIGVuZm9yY2VTYWZlID0gYWxsb3dVbnNhZmVMaW5rVGFyZ2V0KGVkaXRvcikgPT09IGZhbHNlO1xuICAgICAgICB2YXIgc2FmZVJlbEV4dHJhY3RvciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIGFwcGx5UmVsVGFyZ2V0UnVsZXMoTGlzdE9wdGlvbnMuZ2V0VmFsdWUoaXRlbSksIGlzVGFyZ2V0QmxhbmtfMSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzYW5pdGl6ZXIgPSBlbmZvcmNlU2FmZSA/IExpc3RPcHRpb25zLnNhbml0aXplV2l0aChzYWZlUmVsRXh0cmFjdG9yKSA6IExpc3RPcHRpb25zLnNhbml0aXplO1xuICAgICAgICByZXR1cm4gc2FuaXRpemVyKGxpc3QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBSZWxPcHRpb25zID0geyBnZXRSZWxzOiBnZXRSZWxzIH07XG5cbiAgICB2YXIgZmFsbGJhY2tzID0gW1xuICAgICAge1xuICAgICAgICB0ZXh0OiAnQ3VycmVudCB3aW5kb3cnLFxuICAgICAgICB2YWx1ZTogJydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRleHQ6ICdOZXcgd2luZG93JyxcbiAgICAgICAgdmFsdWU6ICdfYmxhbmsnXG4gICAgICB9XG4gICAgXTtcbiAgICB2YXIgZ2V0VGFyZ2V0cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBsaXN0ID0gZ2V0VGFyZ2V0TGlzdChlZGl0b3IpO1xuICAgICAgaWYgKGlzQXJyYXkobGlzdCkpIHtcbiAgICAgICAgcmV0dXJuIExpc3RPcHRpb25zLnNhbml0aXplKGxpc3QpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGZhbGxiYWNrcyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChsaXN0ID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZmFsbGJhY2tzKTtcbiAgICB9O1xuICAgIHZhciBUYXJnZXRPcHRpb25zID0geyBnZXRUYXJnZXRzOiBnZXRUYXJnZXRzIH07XG5cbiAgICB2YXIgbm9uRW1wdHlBdHRyID0gZnVuY3Rpb24gKGRvbSwgZWxlbSwgbmFtZSkge1xuICAgICAgdmFyIHZhbCA9IGRvbS5nZXRBdHRyaWIoZWxlbSwgbmFtZSk7XG4gICAgICByZXR1cm4gdmFsICE9PSBudWxsICYmIHZhbC5sZW5ndGggPiAwID8gT3B0aW9uYWwuc29tZSh2YWwpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGV4dHJhY3RGcm9tQW5jaG9yID0gZnVuY3Rpb24gKGVkaXRvciwgYW5jaG9yKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBvbmx5VGV4dCA9IGlzT25seVRleHRTZWxlY3RlZChlZGl0b3IpO1xuICAgICAgdmFyIHRleHQgPSBvbmx5VGV4dCA/IE9wdGlvbmFsLnNvbWUoZ2V0QW5jaG9yVGV4dChlZGl0b3Iuc2VsZWN0aW9uLCBhbmNob3IpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIHZhciB1cmwgPSBhbmNob3IgPyBPcHRpb25hbC5zb21lKGRvbS5nZXRBdHRyaWIoYW5jaG9yLCAnaHJlZicpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIHZhciB0YXJnZXQgPSBhbmNob3IgPyBPcHRpb25hbC5mcm9tKGRvbS5nZXRBdHRyaWIoYW5jaG9yLCAndGFyZ2V0JykpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIHJlbCA9IG5vbkVtcHR5QXR0cihkb20sIGFuY2hvciwgJ3JlbCcpO1xuICAgICAgdmFyIGxpbmtDbGFzcyA9IG5vbkVtcHR5QXR0cihkb20sIGFuY2hvciwgJ2NsYXNzJyk7XG4gICAgICB2YXIgdGl0bGUgPSBub25FbXB0eUF0dHIoZG9tLCBhbmNob3IsICd0aXRsZScpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgIHJlbDogcmVsLFxuICAgICAgICBsaW5rQ2xhc3M6IGxpbmtDbGFzc1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjb2xsZWN0ID0gZnVuY3Rpb24gKGVkaXRvciwgbGlua05vZGUpIHtcbiAgICAgIHJldHVybiBMaW5rTGlzdE9wdGlvbnMuZ2V0TGlua3MoZWRpdG9yKS50aGVuKGZ1bmN0aW9uIChsaW5rcykge1xuICAgICAgICB2YXIgYW5jaG9yID0gZXh0cmFjdEZyb21BbmNob3IoZWRpdG9yLCBsaW5rTm9kZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiBhbmNob3IsXG4gICAgICAgICAgY2F0YWxvZ3M6IHtcbiAgICAgICAgICAgIHRhcmdldHM6IFRhcmdldE9wdGlvbnMuZ2V0VGFyZ2V0cyhlZGl0b3IpLFxuICAgICAgICAgICAgcmVsczogUmVsT3B0aW9ucy5nZXRSZWxzKGVkaXRvciwgYW5jaG9yLnRhcmdldCksXG4gICAgICAgICAgICBjbGFzc2VzOiBDbGFzc0xpc3RPcHRpb25zLmdldENsYXNzZXMoZWRpdG9yKSxcbiAgICAgICAgICAgIGFuY2hvcjogQW5jaG9yTGlzdE9wdGlvbnMuZ2V0QW5jaG9ycyhlZGl0b3IpLFxuICAgICAgICAgICAgbGluazogbGlua3NcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdE5vZGU6IE9wdGlvbmFsLmZyb20obGlua05vZGUpLFxuICAgICAgICAgIGZsYWdzOiB7IHRpdGxlRW5hYmxlZDogc2hvdWxkU2hvd0xpbmtUaXRsZShlZGl0b3IpIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIERpYWxvZ0luZm8gPSB7IGNvbGxlY3Q6IGNvbGxlY3QgfTtcblxuICAgIHZhciBoYW5kbGVTdWJtaXQgPSBmdW5jdGlvbiAoZWRpdG9yLCBpbmZvKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICAgIGlmICghZGF0YS51cmwudmFsdWUpIHtcbiAgICAgICAgICB1bmxpbmsoZWRpdG9yKTtcbiAgICAgICAgICBhcGkuY2xvc2UoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGdldENoYW5nZWRWYWx1ZSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShkYXRhW2tleV0pLmZpbHRlcihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiAhaW5mby5hbmNob3Jba2V5XS5pcyh2YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBjaGFuZ2VkRGF0YSA9IHtcbiAgICAgICAgICBocmVmOiBkYXRhLnVybC52YWx1ZSxcbiAgICAgICAgICB0ZXh0OiBnZXRDaGFuZ2VkVmFsdWUoJ3RleHQnKSxcbiAgICAgICAgICB0YXJnZXQ6IGdldENoYW5nZWRWYWx1ZSgndGFyZ2V0JyksXG4gICAgICAgICAgcmVsOiBnZXRDaGFuZ2VkVmFsdWUoJ3JlbCcpLFxuICAgICAgICAgIGNsYXNzOiBnZXRDaGFuZ2VkVmFsdWUoJ2xpbmtDbGFzcycpLFxuICAgICAgICAgIHRpdGxlOiBnZXRDaGFuZ2VkVmFsdWUoJ3RpdGxlJylcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGF0dGFjaFN0YXRlID0ge1xuICAgICAgICAgIGhyZWY6IGRhdGEudXJsLnZhbHVlLFxuICAgICAgICAgIGF0dGFjaDogZGF0YS51cmwubWV0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEudXJsLm1ldGEuYXR0YWNoID8gZGF0YS51cmwubWV0YS5hdHRhY2ggOiBub29wXG4gICAgICAgIH07XG4gICAgICAgIERpYWxvZ0NvbmZpcm1zLnByZXByb2Nlc3MoZWRpdG9yLCBjaGFuZ2VkRGF0YSkudGhlbihmdW5jdGlvbiAocERhdGEpIHtcbiAgICAgICAgICBsaW5rKGVkaXRvciwgYXR0YWNoU3RhdGUsIHBEYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGFwaS5jbG9zZSgpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjb2xsZWN0RGF0YSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBhbmNob3JOb2RlID0gZ2V0QW5jaG9yRWxlbWVudChlZGl0b3IpO1xuICAgICAgcmV0dXJuIERpYWxvZ0luZm8uY29sbGVjdChlZGl0b3IsIGFuY2hvck5vZGUpO1xuICAgIH07XG4gICAgdmFyIGdldEluaXRpYWxEYXRhID0gZnVuY3Rpb24gKGluZm8sIGRlZmF1bHRUYXJnZXQpIHtcbiAgICAgIHZhciBhbmNob3IgPSBpbmZvLmFuY2hvcjtcbiAgICAgIHZhciB1cmwgPSBhbmNob3IudXJsLmdldE9yKCcnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVybDoge1xuICAgICAgICAgIHZhbHVlOiB1cmwsXG4gICAgICAgICAgbWV0YTogeyBvcmlnaW5hbDogeyB2YWx1ZTogdXJsIH0gfVxuICAgICAgICB9LFxuICAgICAgICB0ZXh0OiBhbmNob3IudGV4dC5nZXRPcignJyksXG4gICAgICAgIHRpdGxlOiBhbmNob3IudGl0bGUuZ2V0T3IoJycpLFxuICAgICAgICBhbmNob3I6IHVybCxcbiAgICAgICAgbGluazogdXJsLFxuICAgICAgICByZWw6IGFuY2hvci5yZWwuZ2V0T3IoJycpLFxuICAgICAgICB0YXJnZXQ6IGFuY2hvci50YXJnZXQub3IoZGVmYXVsdFRhcmdldCkuZ2V0T3IoJycpLFxuICAgICAgICBsaW5rQ2xhc3M6IGFuY2hvci5saW5rQ2xhc3MuZ2V0T3IoJycpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1ha2VEaWFsb2cgPSBmdW5jdGlvbiAoc2V0dGluZ3MsIG9uU3VibWl0LCBlZGl0b3IpIHtcbiAgICAgIHZhciB1cmxJbnB1dCA9IFt7XG4gICAgICAgICAgbmFtZTogJ3VybCcsXG4gICAgICAgICAgdHlwZTogJ3VybGlucHV0JyxcbiAgICAgICAgICBmaWxldHlwZTogJ2ZpbGUnLFxuICAgICAgICAgIGxhYmVsOiAnVVJMJ1xuICAgICAgICB9XTtcbiAgICAgIHZhciBkaXNwbGF5VGV4dCA9IHNldHRpbmdzLmFuY2hvci50ZXh0Lm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogJ3RleHQnLFxuICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgbGFiZWw6ICdUZXh0IHRvIGRpc3BsYXknXG4gICAgICAgIH07XG4gICAgICB9KS50b0FycmF5KCk7XG4gICAgICB2YXIgdGl0bGVUZXh0ID0gc2V0dGluZ3MuZmxhZ3MudGl0bGVFbmFibGVkID8gW3tcbiAgICAgICAgICBuYW1lOiAndGl0bGUnLFxuICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgbGFiZWw6ICdUaXRsZSdcbiAgICAgICAgfV0gOiBbXTtcbiAgICAgIHZhciBkZWZhdWx0VGFyZ2V0ID0gT3B0aW9uYWwuZnJvbShnZXREZWZhdWx0TGlua1RhcmdldChlZGl0b3IpKTtcbiAgICAgIHZhciBpbml0aWFsRGF0YSA9IGdldEluaXRpYWxEYXRhKHNldHRpbmdzLCBkZWZhdWx0VGFyZ2V0KTtcbiAgICAgIHZhciBjYXRhbG9ncyA9IHNldHRpbmdzLmNhdGFsb2dzO1xuICAgICAgdmFyIGRpYWxvZ0RlbHRhID0gRGlhbG9nQ2hhbmdlcy5pbml0KGluaXRpYWxEYXRhLCBjYXRhbG9ncyk7XG4gICAgICB2YXIgYm9keSA9IHtcbiAgICAgICAgdHlwZTogJ3BhbmVsJyxcbiAgICAgICAgaXRlbXM6IGZsYXR0ZW4oW1xuICAgICAgICAgIHVybElucHV0LFxuICAgICAgICAgIGRpc3BsYXlUZXh0LFxuICAgICAgICAgIHRpdGxlVGV4dCxcbiAgICAgICAgICBjYXQoW1xuICAgICAgICAgICAgY2F0YWxvZ3MuYW5jaG9yLm1hcChMaXN0T3B0aW9ucy5jcmVhdGVVaSgnYW5jaG9yJywgJ0FuY2hvcnMnKSksXG4gICAgICAgICAgICBjYXRhbG9ncy5yZWxzLm1hcChMaXN0T3B0aW9ucy5jcmVhdGVVaSgncmVsJywgJ1JlbCcpKSxcbiAgICAgICAgICAgIGNhdGFsb2dzLnRhcmdldHMubWFwKExpc3RPcHRpb25zLmNyZWF0ZVVpKCd0YXJnZXQnLCAnT3BlbiBsaW5rIGluLi4uJykpLFxuICAgICAgICAgICAgY2F0YWxvZ3MubGluay5tYXAoTGlzdE9wdGlvbnMuY3JlYXRlVWkoJ2xpbmsnLCAnTGluayBsaXN0JykpLFxuICAgICAgICAgICAgY2F0YWxvZ3MuY2xhc3Nlcy5tYXAoTGlzdE9wdGlvbnMuY3JlYXRlVWkoJ2xpbmtDbGFzcycsICdDbGFzcycpKVxuICAgICAgICAgIF0pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGl0bGU6ICdJbnNlcnQvRWRpdCBMaW5rJyxcbiAgICAgICAgc2l6ZTogJ25vcm1hbCcsXG4gICAgICAgIGJvZHk6IGJvZHksXG4gICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY2FuY2VsJyxcbiAgICAgICAgICAgIG5hbWU6ICdjYW5jZWwnLFxuICAgICAgICAgICAgdGV4dDogJ0NhbmNlbCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdzdWJtaXQnLFxuICAgICAgICAgICAgbmFtZTogJ3NhdmUnLFxuICAgICAgICAgICAgdGV4dDogJ1NhdmUnLFxuICAgICAgICAgICAgcHJpbWFyeTogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgaW5pdGlhbERhdGE6IGluaXRpYWxEYXRhLFxuICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGFwaSwgX2EpIHtcbiAgICAgICAgICB2YXIgbmFtZSA9IF9hLm5hbWU7XG4gICAgICAgICAgZGlhbG9nRGVsdGEub25DaGFuZ2UoYXBpLmdldERhdGEsIHsgbmFtZTogbmFtZSB9KS5lYWNoKGZ1bmN0aW9uIChuZXdEYXRhKSB7XG4gICAgICAgICAgICBhcGkuc2V0RGF0YShuZXdEYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TdWJtaXQ6IG9uU3VibWl0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG9wZW4gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgZGF0YSA9IGNvbGxlY3REYXRhKGVkaXRvcik7XG4gICAgICBkYXRhLnRoZW4oZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgdmFyIG9uU3VibWl0ID0gaGFuZGxlU3VibWl0KGVkaXRvciwgaW5mbyk7XG4gICAgICAgIHJldHVybiBtYWtlRGlhbG9nKGluZm8sIG9uU3VibWl0LCBlZGl0b3IpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbiAoc3BlYykge1xuICAgICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHNwZWMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBhcHBlbmRDbGlja1JlbW92ZSA9IGZ1bmN0aW9uIChsaW5rLCBldnQpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XG4gICAgICBsaW5rLmRpc3BhdGNoRXZlbnQoZXZ0KTtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XG4gICAgfTtcbiAgICB2YXIgb3BlbiQxID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICBsaW5rLnRhcmdldCA9ICdfYmxhbmsnO1xuICAgICAgbGluay5ocmVmID0gdXJsO1xuICAgICAgbGluay5yZWwgPSAnbm9yZWZlcnJlciBub29wZW5lcic7XG4gICAgICB2YXIgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7XG4gICAgICBldnQuaW5pdE1vdXNlRXZlbnQoJ2NsaWNrJywgdHJ1ZSwgdHJ1ZSwgd2luZG93LCAwLCAwLCAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7XG4gICAgICBhcHBlbmRDbGlja1JlbW92ZShsaW5rLCBldnQpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0TGluayA9IGZ1bmN0aW9uIChlZGl0b3IsIGVsbSkge1xuICAgICAgcmV0dXJuIGVkaXRvci5kb20uZ2V0UGFyZW50KGVsbSwgJ2FbaHJlZl0nKTtcbiAgICB9O1xuICAgIHZhciBnZXRTZWxlY3RlZExpbmsgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2V0TGluayhlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKSk7XG4gICAgfTtcbiAgICB2YXIgaGFzT25seUFsdE1vZGlmaWVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBlLmFsdEtleSA9PT0gdHJ1ZSAmJiBlLnNoaWZ0S2V5ID09PSBmYWxzZSAmJiBlLmN0cmxLZXkgPT09IGZhbHNlICYmIGUubWV0YUtleSA9PT0gZmFsc2U7XG4gICAgfTtcbiAgICB2YXIgZ290b0xpbmsgPSBmdW5jdGlvbiAoZWRpdG9yLCBhKSB7XG4gICAgICBpZiAoYSkge1xuICAgICAgICB2YXIgaHJlZiA9IGdldEhyZWYoYSk7XG4gICAgICAgIGlmICgvXiMvLnRlc3QoaHJlZikpIHtcbiAgICAgICAgICB2YXIgdGFyZ2V0RWwgPSBlZGl0b3IuJChocmVmKTtcbiAgICAgICAgICBpZiAodGFyZ2V0RWwubGVuZ3RoKSB7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNjcm9sbEludG9WaWV3KHRhcmdldEVsWzBdLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3BlbiQxKGEuaHJlZik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBvcGVuRGlhbG9nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb3BlbihlZGl0b3IpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnb3RvU2VsZWN0ZWRMaW5rID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ290b0xpbmsoZWRpdG9yLCBnZXRTZWxlY3RlZExpbmsoZWRpdG9yKSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNldHVwR290b0xpbmtzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBsaW5rID0gZ2V0TGluayhlZGl0b3IsIGUudGFyZ2V0KTtcbiAgICAgICAgaWYgKGxpbmsgJiYgZ2xvYmFsJDEubWV0YUtleVByZXNzZWQoZSkpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZ290b0xpbmsoZWRpdG9yLCBsaW5rKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBlZGl0b3Iub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgbGluayA9IGdldFNlbGVjdGVkTGluayhlZGl0b3IpO1xuICAgICAgICBpZiAobGluayAmJiBlLmtleUNvZGUgPT09IDEzICYmIGhhc09ubHlBbHRNb2RpZmllcihlKSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBnb3RvTGluayhlZGl0b3IsIGxpbmspO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB0b2dnbGVTdGF0ZSA9IGZ1bmN0aW9uIChlZGl0b3IsIHRvZ2dsZXIpIHtcbiAgICAgIGVkaXRvci5vbignTm9kZUNoYW5nZScsIHRvZ2dsZXIpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGVkaXRvci5vZmYoJ05vZGVDaGFuZ2UnLCB0b2dnbGVyKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdG9nZ2xlQWN0aXZlU3RhdGUgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICByZXR1cm4gdG9nZ2xlU3RhdGUoZWRpdG9yLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYXBpLnNldEFjdGl2ZSghZWRpdG9yLm1vZGUuaXNSZWFkT25seSgpICYmIGdldEFuY2hvckVsZW1lbnQoZWRpdG9yLCBlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKSkgIT09IG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdG9nZ2xlRW5hYmxlZFN0YXRlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgdmFyIHVwZGF0ZVN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBhcGkuc2V0RGlzYWJsZWQoZ2V0QW5jaG9yRWxlbWVudChlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpKSA9PT0gbnVsbCk7XG4gICAgICAgIH07XG4gICAgICAgIHVwZGF0ZVN0YXRlKCk7XG4gICAgICAgIHJldHVybiB0b2dnbGVTdGF0ZShlZGl0b3IsIHVwZGF0ZVN0YXRlKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdG9nZ2xlVW5saW5rU3RhdGUgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICB2YXIgaGFzTGlua3MkMSA9IGZ1bmN0aW9uIChwYXJlbnRzKSB7XG4gICAgICAgICAgcmV0dXJuIGhhc0xpbmtzKHBhcmVudHMpIHx8IGhhc0xpbmtzSW5TZWxlY3Rpb24oZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBwYXJlbnRzID0gZWRpdG9yLmRvbS5nZXRQYXJlbnRzKGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKSk7XG4gICAgICAgIGFwaS5zZXREaXNhYmxlZCghaGFzTGlua3MkMShwYXJlbnRzKSk7XG4gICAgICAgIHJldHVybiB0b2dnbGVTdGF0ZShlZGl0b3IsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaS5zZXREaXNhYmxlZCghaGFzTGlua3MkMShlLnBhcmVudHMpKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IuYWRkQ29tbWFuZCgnbWNlTGluaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHVzZVF1aWNrTGluayhlZGl0b3IpKSB7XG4gICAgICAgICAgZWRpdG9yLmZpcmUoJ2NvbnRleHR0b29sYmFyLXNob3cnLCB7IHRvb2xiYXJLZXk6ICdxdWlja2xpbmsnIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9wZW5EaWFsb2coZWRpdG9yKSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHNldHVwID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLmFkZFNob3J0Y3V0KCdNZXRhK0snLCAnJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZUxpbmsnKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgc2V0dXBCdXR0b25zID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZFRvZ2dsZUJ1dHRvbignbGluaycsIHtcbiAgICAgICAgaWNvbjogJ2xpbmsnLFxuICAgICAgICB0b29sdGlwOiAnSW5zZXJ0L2VkaXQgbGluaycsXG4gICAgICAgIG9uQWN0aW9uOiBvcGVuRGlhbG9nKGVkaXRvciksXG4gICAgICAgIG9uU2V0dXA6IHRvZ2dsZUFjdGl2ZVN0YXRlKGVkaXRvcilcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbignb3BlbmxpbmsnLCB7XG4gICAgICAgIGljb246ICduZXctdGFiJyxcbiAgICAgICAgdG9vbHRpcDogJ09wZW4gbGluaycsXG4gICAgICAgIG9uQWN0aW9uOiBnb3RvU2VsZWN0ZWRMaW5rKGVkaXRvciksXG4gICAgICAgIG9uU2V0dXA6IHRvZ2dsZUVuYWJsZWRTdGF0ZShlZGl0b3IpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRCdXR0b24oJ3VubGluaycsIHtcbiAgICAgICAgaWNvbjogJ3VubGluaycsXG4gICAgICAgIHRvb2x0aXA6ICdSZW1vdmUgbGluaycsXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHVubGluayhlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBvblNldHVwOiB0b2dnbGVVbmxpbmtTdGF0ZShlZGl0b3IpXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzZXR1cE1lbnVJdGVtcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgnb3BlbmxpbmsnLCB7XG4gICAgICAgIHRleHQ6ICdPcGVuIGxpbmsnLFxuICAgICAgICBpY29uOiAnbmV3LXRhYicsXG4gICAgICAgIG9uQWN0aW9uOiBnb3RvU2VsZWN0ZWRMaW5rKGVkaXRvciksXG4gICAgICAgIG9uU2V0dXA6IHRvZ2dsZUVuYWJsZWRTdGF0ZShlZGl0b3IpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgnbGluaycsIHtcbiAgICAgICAgaWNvbjogJ2xpbmsnLFxuICAgICAgICB0ZXh0OiAnTGluay4uLicsXG4gICAgICAgIHNob3J0Y3V0OiAnTWV0YStLJyxcbiAgICAgICAgb25BY3Rpb246IG9wZW5EaWFsb2coZWRpdG9yKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3VubGluaycsIHtcbiAgICAgICAgaWNvbjogJ3VubGluaycsXG4gICAgICAgIHRleHQ6ICdSZW1vdmUgbGluaycsXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHVubGluayhlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBvblNldHVwOiB0b2dnbGVVbmxpbmtTdGF0ZShlZGl0b3IpXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzZXR1cENvbnRleHRNZW51ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGluTGluayA9ICdsaW5rIHVubGluayBvcGVubGluayc7XG4gICAgICB2YXIgbm9MaW5rID0gJ2xpbmsnO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZENvbnRleHRNZW51KCdsaW5rJywge1xuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGhhc0xpbmtzKGVkaXRvci5kb20uZ2V0UGFyZW50cyhlbGVtZW50LCAnYScpKSA/IGluTGluayA6IG5vTGluaztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0dXBDb250ZXh0VG9vbGJhcnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgY29sbGFwc2VTZWxlY3Rpb25Ub0VuZCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5jb2xsYXBzZShmYWxzZSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uU2V0dXBMaW5rID0gZnVuY3Rpb24gKGJ1dHRvbkFwaSkge1xuICAgICAgICB2YXIgbm9kZSA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpO1xuICAgICAgICBidXR0b25BcGkuc2V0RGlzYWJsZWQoIWdldEFuY2hvckVsZW1lbnQoZWRpdG9yLCBub2RlKSk7XG4gICAgICAgIHJldHVybiBub29wO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRDb250ZXh0Rm9ybSgncXVpY2tsaW5rJywge1xuICAgICAgICBsYXVuY2g6IHtcbiAgICAgICAgICB0eXBlOiAnY29udGV4dGZvcm10b2dnbGVidXR0b24nLFxuICAgICAgICAgIGljb246ICdsaW5rJyxcbiAgICAgICAgICB0b29sdGlwOiAnTGluaycsXG4gICAgICAgICAgb25TZXR1cDogdG9nZ2xlQWN0aXZlU3RhdGUoZWRpdG9yKVxuICAgICAgICB9LFxuICAgICAgICBsYWJlbDogJ0xpbmsnLFxuICAgICAgICBwcmVkaWNhdGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgcmV0dXJuICEhZ2V0QW5jaG9yRWxlbWVudChlZGl0b3IsIG5vZGUpICYmIGhhc0NvbnRleHRUb29sYmFyKGVkaXRvcik7XG4gICAgICAgIH0sXG4gICAgICAgIGluaXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBlbG0gPSBnZXRBbmNob3JFbGVtZW50KGVkaXRvcik7XG4gICAgICAgICAgcmV0dXJuICEhZWxtID8gZ2V0SHJlZihlbG0pIDogJyc7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbW1hbmRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2NvbnRleHRmb3JtdG9nZ2xlYnV0dG9uJyxcbiAgICAgICAgICAgIGljb246ICdsaW5rJyxcbiAgICAgICAgICAgIHRvb2x0aXA6ICdMaW5rJyxcbiAgICAgICAgICAgIHByaW1hcnk6IHRydWUsXG4gICAgICAgICAgICBvblNldHVwOiBmdW5jdGlvbiAoYnV0dG9uQXBpKSB7XG4gICAgICAgICAgICAgIHZhciBub2RlID0gZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCk7XG4gICAgICAgICAgICAgIGJ1dHRvbkFwaS5zZXRBY3RpdmUoISFnZXRBbmNob3JFbGVtZW50KGVkaXRvciwgbm9kZSkpO1xuICAgICAgICAgICAgICByZXR1cm4gdG9nZ2xlQWN0aXZlU3RhdGUoZWRpdG9yKShidXR0b25BcGkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoZm9ybUFwaSkge1xuICAgICAgICAgICAgICB2YXIgYW5jaG9yID0gZ2V0QW5jaG9yRWxlbWVudChlZGl0b3IpO1xuICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBmb3JtQXBpLmdldFZhbHVlKCk7XG4gICAgICAgICAgICAgIGlmICghYW5jaG9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dGFjaFN0YXRlID0ge1xuICAgICAgICAgICAgICAgICAgaHJlZjogdmFsdWUsXG4gICAgICAgICAgICAgICAgICBhdHRhY2g6IG5vb3BcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciBvbmx5VGV4dCA9IGlzT25seVRleHRTZWxlY3RlZChlZGl0b3IpO1xuICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gb25seVRleHQgPyBPcHRpb25hbC5zb21lKGdldEFuY2hvclRleHQoZWRpdG9yLnNlbGVjdGlvbiwgYW5jaG9yKSkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdC5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgIH0pLm9yKE9wdGlvbmFsLmZyb20odmFsdWUpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICAgICAgICBsaW5rKGVkaXRvciwgYXR0YWNoU3RhdGUsIHtcbiAgICAgICAgICAgICAgICAgIGhyZWY6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgICAgICAgICAgICByZWw6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgICAgICAgICAgIHRhcmdldDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgICAgICAgICAgY2xhc3M6IE9wdGlvbmFsLm5vbmUoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGZvcm1BcGkuaGlkZSgpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVkaXRvci51bmRvTWFuYWdlci50cmFuc2FjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICBlZGl0b3IuZG9tLnNldEF0dHJpYihhbmNob3IsICdocmVmJywgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgY29sbGFwc2VTZWxlY3Rpb25Ub0VuZChlZGl0b3IpO1xuICAgICAgICAgICAgICAgICAgZm9ybUFwaS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdjb250ZXh0Zm9ybWJ1dHRvbicsXG4gICAgICAgICAgICBpY29uOiAndW5saW5rJyxcbiAgICAgICAgICAgIHRvb2x0aXA6ICdSZW1vdmUgbGluaycsXG4gICAgICAgICAgICBvblNldHVwOiBvblNldHVwTGluayxcbiAgICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoZm9ybUFwaSkge1xuICAgICAgICAgICAgICB1bmxpbmsoZWRpdG9yKTtcbiAgICAgICAgICAgICAgZm9ybUFwaS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY29udGV4dGZvcm1idXR0b24nLFxuICAgICAgICAgICAgaWNvbjogJ25ldy10YWInLFxuICAgICAgICAgICAgdG9vbHRpcDogJ09wZW4gbGluaycsXG4gICAgICAgICAgICBvblNldHVwOiBvblNldHVwTGluayxcbiAgICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoZm9ybUFwaSkge1xuICAgICAgICAgICAgICBnb3RvU2VsZWN0ZWRMaW5rKGVkaXRvcikoKTtcbiAgICAgICAgICAgICAgZm9ybUFwaS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUGx1Z2luICgpIHtcbiAgICAgIGdsb2JhbC5hZGQoJ2xpbmsnLCBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICAgIHNldHVwQnV0dG9ucyhlZGl0b3IpO1xuICAgICAgICBzZXR1cE1lbnVJdGVtcyhlZGl0b3IpO1xuICAgICAgICBzZXR1cENvbnRleHRNZW51KGVkaXRvcik7XG4gICAgICAgIHNldHVwQ29udGV4dFRvb2xiYXJzKGVkaXRvcik7XG4gICAgICAgIHNldHVwR290b0xpbmtzKGVkaXRvcik7XG4gICAgICAgIHJlZ2lzdGVyKGVkaXRvcik7XG4gICAgICAgIHNldHVwKGVkaXRvcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBQbHVnaW4oKTtcblxufSgpKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7Ozs7Ozs7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBOztBIiwic291cmNlUm9vdCI6IiJ9