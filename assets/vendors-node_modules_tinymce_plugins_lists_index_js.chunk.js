(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_lists_index_js"],{

/***/ "./node_modules/tinymce/plugins/lists/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/lists/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "lists" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/lists')
//   ES2015:
//     import 'tinymce/plugins/lists'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/lists/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/lists/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/lists/plugin.js ***!
  \******************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var isString = isType('string');
    var isObject = isType('object');
    var isArray = isType('array');
    var isBoolean = isSimpleType('boolean');
    var isFunction = isSimpleType('function');
    var isNumber = isSimpleType('number');

    var noop = function () {
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var not = function (f) {
      return function (t) {
        return !f(t);
      };
    };
    var never = constant(false);
    var always = constant(true);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var nativeSlice = Array.prototype.slice;
    var nativePush = Array.prototype.push;
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var filter = function (xs, pred) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          r.push(x);
        }
      }
      return r;
    };
    var groupBy = function (xs, f) {
      if (xs.length === 0) {
        return [];
      } else {
        var wasType = f(xs[0]);
        var r = [];
        var group = [];
        for (var i = 0, len = xs.length; i < len; i++) {
          var x = xs[i];
          var type = f(x);
          if (type !== wasType) {
            r.push(group);
            group = [];
          }
          wasType = type;
          group.push(x);
        }
        if (group.length !== 0) {
          r.push(group);
        }
        return r;
      }
    };
    var foldl = function (xs, f, acc) {
      each(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var findUntil = function (xs, pred, until) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return Optional.some(x);
        } else if (until(x, i)) {
          break;
        }
      }
      return Optional.none();
    };
    var find = function (xs, pred) {
      return findUntil(xs, pred, never);
    };
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var bind = function (xs, f) {
      return flatten(map(xs, f));
    };
    var reverse = function (xs) {
      var r = nativeSlice.call(xs, 0);
      r.reverse();
      return r;
    };
    var get = function (xs, i) {
      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();
    };
    var head = function (xs) {
      return get(xs, 0);
    };
    var last = function (xs) {
      return get(xs, xs.length - 1);
    };

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };
    function __spreadArrays() {
      for (var s = 0, i = 0, il = arguments.length; i < il; i++)
        s += arguments[i].length;
      for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
          r[k] = a[j];
      return r;
    }

    var cached = function (f) {
      var called = false;
      var r;
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        if (!called) {
          called = true;
          r = f.apply(null, args);
        }
        return r;
      };
    };

    var DeviceType = function (os, browser, userAgent, mediaMatch) {
      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;
      var isiPhone = os.isiOS() && !isiPad;
      var isMobile = os.isiOS() || os.isAndroid();
      var isTouch = isMobile || mediaMatch('(pointer:coarse)');
      var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');
      var isPhone = isiPhone || isMobile && !isTablet;
      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;
      var isDesktop = !isPhone && !isTablet && !iOSwebview;
      return {
        isiPad: constant(isiPad),
        isiPhone: constant(isiPhone),
        isTablet: constant(isTablet),
        isPhone: constant(isPhone),
        isTouch: constant(isTouch),
        isAndroid: os.isAndroid,
        isiOS: os.isiOS,
        isWebView: constant(iOSwebview),
        isDesktop: constant(isDesktop)
      };
    };

    var firstMatch = function (regexes, s) {
      for (var i = 0; i < regexes.length; i++) {
        var x = regexes[i];
        if (x.test(s)) {
          return x;
        }
      }
      return undefined;
    };
    var find$1 = function (regexes, agent) {
      var r = firstMatch(regexes, agent);
      if (!r) {
        return {
          major: 0,
          minor: 0
        };
      }
      var group = function (i) {
        return Number(agent.replace(r, '$' + i));
      };
      return nu(group(1), group(2));
    };
    var detect = function (versionRegexes, agent) {
      var cleanedAgent = String(agent).toLowerCase();
      if (versionRegexes.length === 0) {
        return unknown();
      }
      return find$1(versionRegexes, cleanedAgent);
    };
    var unknown = function () {
      return nu(0, 0);
    };
    var nu = function (major, minor) {
      return {
        major: major,
        minor: minor
      };
    };
    var Version = {
      nu: nu,
      detect: detect,
      unknown: unknown
    };

    var detect$1 = function (candidates, userAgent) {
      var agent = String(userAgent).toLowerCase();
      return find(candidates, function (candidate) {
        return candidate.search(agent);
      });
    };
    var detectBrowser = function (browsers, userAgent) {
      return detect$1(browsers, userAgent).map(function (browser) {
        var version = Version.detect(browser.versionRegexes, userAgent);
        return {
          current: browser.name,
          version: version
        };
      });
    };
    var detectOs = function (oses, userAgent) {
      return detect$1(oses, userAgent).map(function (os) {
        var version = Version.detect(os.versionRegexes, userAgent);
        return {
          current: os.name,
          version: version
        };
      });
    };
    var UaString = {
      detectBrowser: detectBrowser,
      detectOs: detectOs
    };

    var contains = function (str, substr) {
      return str.indexOf(substr) !== -1;
    };
    var blank = function (r) {
      return function (s) {
        return s.replace(r, '');
      };
    };
    var trim = blank(/^\s+|\s+$/g);
    var isNotEmpty = function (s) {
      return s.length > 0;
    };
    var isEmpty = function (s) {
      return !isNotEmpty(s);
    };

    var normalVersionRegex = /.*?version\/\ ?([0-9]+)\.([0-9]+).*/;
    var checkContains = function (target) {
      return function (uastring) {
        return contains(uastring, target);
      };
    };
    var browsers = [
      {
        name: 'Edge',
        versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],
        search: function (uastring) {
          return contains(uastring, 'edge/') && contains(uastring, 'chrome') && contains(uastring, 'safari') && contains(uastring, 'applewebkit');
        }
      },
      {
        name: 'Chrome',
        versionRegexes: [
          /.*?chrome\/([0-9]+)\.([0-9]+).*/,
          normalVersionRegex
        ],
        search: function (uastring) {
          return contains(uastring, 'chrome') && !contains(uastring, 'chromeframe');
        }
      },
      {
        name: 'IE',
        versionRegexes: [
          /.*?msie\ ?([0-9]+)\.([0-9]+).*/,
          /.*?rv:([0-9]+)\.([0-9]+).*/
        ],
        search: function (uastring) {
          return contains(uastring, 'msie') || contains(uastring, 'trident');
        }
      },
      {
        name: 'Opera',
        versionRegexes: [
          normalVersionRegex,
          /.*?opera\/([0-9]+)\.([0-9]+).*/
        ],
        search: checkContains('opera')
      },
      {
        name: 'Firefox',
        versionRegexes: [/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],
        search: checkContains('firefox')
      },
      {
        name: 'Safari',
        versionRegexes: [
          normalVersionRegex,
          /.*?cpu os ([0-9]+)_([0-9]+).*/
        ],
        search: function (uastring) {
          return (contains(uastring, 'safari') || contains(uastring, 'mobile/')) && contains(uastring, 'applewebkit');
        }
      }
    ];
    var oses = [
      {
        name: 'Windows',
        search: checkContains('win'),
        versionRegexes: [/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name: 'iOS',
        search: function (uastring) {
          return contains(uastring, 'iphone') || contains(uastring, 'ipad');
        },
        versionRegexes: [
          /.*?version\/\ ?([0-9]+)\.([0-9]+).*/,
          /.*cpu os ([0-9]+)_([0-9]+).*/,
          /.*cpu iphone os ([0-9]+)_([0-9]+).*/
        ]
      },
      {
        name: 'Android',
        search: checkContains('android'),
        versionRegexes: [/.*?android\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name: 'OSX',
        search: checkContains('mac os x'),
        versionRegexes: [/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]
      },
      {
        name: 'Linux',
        search: checkContains('linux'),
        versionRegexes: []
      },
      {
        name: 'Solaris',
        search: checkContains('sunos'),
        versionRegexes: []
      },
      {
        name: 'FreeBSD',
        search: checkContains('freebsd'),
        versionRegexes: []
      },
      {
        name: 'ChromeOS',
        search: checkContains('cros'),
        versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/]
      }
    ];
    var PlatformInfo = {
      browsers: constant(browsers),
      oses: constant(oses)
    };

    var edge = 'Edge';
    var chrome = 'Chrome';
    var ie = 'IE';
    var opera = 'Opera';
    var firefox = 'Firefox';
    var safari = 'Safari';
    var unknown$1 = function () {
      return nu$1({
        current: undefined,
        version: Version.unknown()
      });
    };
    var nu$1 = function (info) {
      var current = info.current;
      var version = info.version;
      var isBrowser = function (name) {
        return function () {
          return current === name;
        };
      };
      return {
        current: current,
        version: version,
        isEdge: isBrowser(edge),
        isChrome: isBrowser(chrome),
        isIE: isBrowser(ie),
        isOpera: isBrowser(opera),
        isFirefox: isBrowser(firefox),
        isSafari: isBrowser(safari)
      };
    };
    var Browser = {
      unknown: unknown$1,
      nu: nu$1,
      edge: constant(edge),
      chrome: constant(chrome),
      ie: constant(ie),
      opera: constant(opera),
      firefox: constant(firefox),
      safari: constant(safari)
    };

    var windows = 'Windows';
    var ios = 'iOS';
    var android = 'Android';
    var linux = 'Linux';
    var osx = 'OSX';
    var solaris = 'Solaris';
    var freebsd = 'FreeBSD';
    var chromeos = 'ChromeOS';
    var unknown$2 = function () {
      return nu$2({
        current: undefined,
        version: Version.unknown()
      });
    };
    var nu$2 = function (info) {
      var current = info.current;
      var version = info.version;
      var isOS = function (name) {
        return function () {
          return current === name;
        };
      };
      return {
        current: current,
        version: version,
        isWindows: isOS(windows),
        isiOS: isOS(ios),
        isAndroid: isOS(android),
        isOSX: isOS(osx),
        isLinux: isOS(linux),
        isSolaris: isOS(solaris),
        isFreeBSD: isOS(freebsd),
        isChromeOS: isOS(chromeos)
      };
    };
    var OperatingSystem = {
      unknown: unknown$2,
      nu: nu$2,
      windows: constant(windows),
      ios: constant(ios),
      android: constant(android),
      linux: constant(linux),
      osx: constant(osx),
      solaris: constant(solaris),
      freebsd: constant(freebsd),
      chromeos: constant(chromeos)
    };

    var detect$2 = function (userAgent, mediaMatch) {
      var browsers = PlatformInfo.browsers();
      var oses = PlatformInfo.oses();
      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);
      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);
      var deviceType = DeviceType(os, browser, userAgent, mediaMatch);
      return {
        browser: browser,
        os: os,
        deviceType: deviceType
      };
    };
    var PlatformDetection = { detect: detect$2 };

    var mediaMatch = function (query) {
      return window.matchMedia(query).matches;
    };
    var platform = cached(function () {
      return PlatformDetection.detect(navigator.userAgent, mediaMatch);
    });
    var detect$3 = function () {
      return platform();
    };

    var compareDocumentPosition = function (a, b, match) {
      return (a.compareDocumentPosition(b) & match) !== 0;
    };
    var documentPositionContainedBy = function (a, b) {
      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);
    };

    var ELEMENT = 1;

    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw new Error('HTML must have a single root node');
      }
      return fromDom(div.childNodes[0]);
    };
    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };
    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };
    var fromDom = function (node) {
      if (node === null || node === undefined) {
        throw new Error('Node cannot be null or undefined');
      }
      return { dom: node };
    };
    var fromPoint = function (docElm, x, y) {
      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);
    };
    var SugarElement = {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom,
      fromPoint: fromPoint
    };

    var is = function (element, selector) {
      var dom = element.dom;
      if (dom.nodeType !== ELEMENT) {
        return false;
      } else {
        var elem = dom;
        if (elem.matches !== undefined) {
          return elem.matches(selector);
        } else if (elem.msMatchesSelector !== undefined) {
          return elem.msMatchesSelector(selector);
        } else if (elem.webkitMatchesSelector !== undefined) {
          return elem.webkitMatchesSelector(selector);
        } else if (elem.mozMatchesSelector !== undefined) {
          return elem.mozMatchesSelector(selector);
        } else {
          throw new Error('Browser lacks native selectors');
        }
      }
    };

    var eq = function (e1, e2) {
      return e1.dom === e2.dom;
    };
    var regularContains = function (e1, e2) {
      var d1 = e1.dom;
      var d2 = e2.dom;
      return d1 === d2 ? false : d1.contains(d2);
    };
    var ieContains = function (e1, e2) {
      return documentPositionContainedBy(e1.dom, e2.dom);
    };
    var contains$1 = function (e1, e2) {
      return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);
    };
    var is$1 = is;

    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');

    var global$2 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');

    var global$3 = tinymce.util.Tools.resolve('tinymce.util.VK');

    var keys = Object.keys;
    var each$1 = function (obj, f) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        f(x, i);
      }
    };
    var objAcc = function (r) {
      return function (x, i) {
        r[i] = x;
      };
    };
    var internalFilter = function (obj, pred, onTrue, onFalse) {
      var r = {};
      each$1(obj, function (x, i) {
        (pred(x, i) ? onTrue : onFalse)(x, i);
      });
      return r;
    };
    var filter$1 = function (obj, pred) {
      var t = {};
      internalFilter(obj, pred, objAcc(t), noop);
      return t;
    };

    var Global = typeof window !== 'undefined' ? window : Function('return this;')();

    var name = function (element) {
      var r = element.dom.nodeName;
      return r.toLowerCase();
    };
    var type = function (element) {
      return element.dom.nodeType;
    };
    var isType$1 = function (t) {
      return function (element) {
        return type(element) === t;
      };
    };
    var isElement = isType$1(ELEMENT);

    var rawSet = function (dom, key, value) {
      if (isString(value) || isBoolean(value) || isNumber(value)) {
        dom.setAttribute(key, value + '');
      } else {
        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);
        throw new Error('Attribute value was not simple');
      }
    };
    var setAll = function (element, attrs) {
      var dom = element.dom;
      each$1(attrs, function (v, k) {
        rawSet(dom, k, v);
      });
    };
    var clone = function (element) {
      return foldl(element.dom.attributes, function (acc, attr) {
        acc[attr.name] = attr.value;
        return acc;
      }, {});
    };

    var parent = function (element) {
      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);
    };
    var children = function (element) {
      return map(element.dom.childNodes, SugarElement.fromDom);
    };
    var child = function (element, index) {
      var cs = element.dom.childNodes;
      return Optional.from(cs[index]).map(SugarElement.fromDom);
    };
    var firstChild = function (element) {
      return child(element, 0);
    };
    var lastChild = function (element) {
      return child(element, element.dom.childNodes.length - 1);
    };

    var before = function (marker, element) {
      var parent$1 = parent(marker);
      parent$1.each(function (v) {
        v.dom.insertBefore(element.dom, marker.dom);
      });
    };
    var append = function (parent, element) {
      parent.dom.appendChild(element.dom);
    };

    var before$1 = function (marker, elements) {
      each(elements, function (x) {
        before(marker, x);
      });
    };
    var append$1 = function (parent, elements) {
      each(elements, function (x) {
        append(parent, x);
      });
    };

    var remove = function (element) {
      var dom = element.dom;
      if (dom.parentNode !== null) {
        dom.parentNode.removeChild(dom);
      }
    };

    var clone$1 = function (original, isDeep) {
      return SugarElement.fromDom(original.dom.cloneNode(isDeep));
    };
    var deep = function (original) {
      return clone$1(original, true);
    };
    var shallowAs = function (original, tag) {
      var nu = SugarElement.fromTag(tag);
      var attributes = clone(original);
      setAll(nu, attributes);
      return nu;
    };
    var mutate = function (original, tag) {
      var nu = shallowAs(original, tag);
      before(original, nu);
      var children$1 = children(original);
      append$1(nu, children$1);
      remove(original);
      return nu;
    };

    var global$4 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');

    var global$5 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var matchNodeName = function (name) {
      return function (node) {
        return node && node.nodeName.toLowerCase() === name;
      };
    };
    var matchNodeNames = function (regex) {
      return function (node) {
        return node && regex.test(node.nodeName);
      };
    };
    var isTextNode = function (node) {
      return node && node.nodeType === 3;
    };
    var isListNode = matchNodeNames(/^(OL|UL|DL)$/);
    var isOlUlNode = matchNodeNames(/^(OL|UL)$/);
    var isOlNode = matchNodeName('ol');
    var isListItemNode = matchNodeNames(/^(LI|DT|DD)$/);
    var isDlItemNode = matchNodeNames(/^(DT|DD)$/);
    var isTableCellNode = matchNodeNames(/^(TH|TD)$/);
    var isBr = matchNodeName('br');
    var isFirstChild = function (node) {
      return node.parentNode.firstChild === node;
    };
    var isTextBlock = function (editor, node) {
      return node && !!editor.schema.getTextBlockElements()[node.nodeName];
    };
    var isBlock = function (node, blockElements) {
      return node && node.nodeName in blockElements;
    };
    var isBogusBr = function (dom, node) {
      if (!isBr(node)) {
        return false;
      }
      return dom.isBlock(node.nextSibling) && !isBr(node.previousSibling);
    };
    var isEmpty$1 = function (dom, elm, keepBookmarks) {
      var empty = dom.isEmpty(elm);
      if (keepBookmarks && dom.select('span[data-mce-type=bookmark]', elm).length > 0) {
        return false;
      }
      return empty;
    };
    var isChildOfBody = function (dom, elm) {
      return dom.isChildOf(elm, dom.getRoot());
    };

    var shouldIndentOnTab = function (editor) {
      return editor.getParam('lists_indent_on_tab', true);
    };
    var getForcedRootBlock = function (editor) {
      var block = editor.getParam('forced_root_block', 'p');
      if (block === false) {
        return '';
      } else if (block === true) {
        return 'p';
      } else {
        return block;
      }
    };
    var getForcedRootBlockAttrs = function (editor) {
      return editor.getParam('forced_root_block_attrs', {});
    };

    var createTextBlock = function (editor, contentNode) {
      var dom = editor.dom;
      var blockElements = editor.schema.getBlockElements();
      var fragment = dom.createFragment();
      var blockName = getForcedRootBlock(editor);
      var node, textBlock, hasContentNode;
      if (blockName) {
        textBlock = dom.create(blockName);
        if (textBlock.tagName === blockName.toUpperCase()) {
          dom.setAttribs(textBlock, getForcedRootBlockAttrs(editor));
        }
        if (!isBlock(contentNode.firstChild, blockElements)) {
          fragment.appendChild(textBlock);
        }
      }
      if (contentNode) {
        while (node = contentNode.firstChild) {
          var nodeName = node.nodeName;
          if (!hasContentNode && (nodeName !== 'SPAN' || node.getAttribute('data-mce-type') !== 'bookmark')) {
            hasContentNode = true;
          }
          if (isBlock(node, blockElements)) {
            fragment.appendChild(node);
            textBlock = null;
          } else {
            if (blockName) {
              if (!textBlock) {
                textBlock = dom.create(blockName);
                fragment.appendChild(textBlock);
              }
              textBlock.appendChild(node);
            } else {
              fragment.appendChild(node);
            }
          }
        }
      }
      if (!blockName) {
        fragment.appendChild(dom.create('br'));
      } else {
        if (!hasContentNode) {
          textBlock.appendChild(dom.create('br', { 'data-mce-bogus': '1' }));
        }
      }
      return fragment;
    };

    var DOM = global$4.DOM;
    var splitList = function (editor, ul, li) {
      var removeAndKeepBookmarks = function (targetNode) {
        global$5.each(bookmarks, function (node) {
          targetNode.parentNode.insertBefore(node, li.parentNode);
        });
        DOM.remove(targetNode);
      };
      var bookmarks = DOM.select('span[data-mce-type="bookmark"]', ul);
      var newBlock = createTextBlock(editor, li);
      var tmpRng = DOM.createRng();
      tmpRng.setStartAfter(li);
      tmpRng.setEndAfter(ul);
      var fragment = tmpRng.extractContents();
      for (var node = fragment.firstChild; node; node = node.firstChild) {
        if (node.nodeName === 'LI' && editor.dom.isEmpty(node)) {
          DOM.remove(node);
          break;
        }
      }
      if (!editor.dom.isEmpty(fragment)) {
        DOM.insertAfter(fragment, ul);
      }
      DOM.insertAfter(newBlock, ul);
      if (isEmpty$1(editor.dom, li.parentNode)) {
        removeAndKeepBookmarks(li.parentNode);
      }
      DOM.remove(li);
      if (isEmpty$1(editor.dom, ul)) {
        DOM.remove(ul);
      }
    };

    var outdentDlItem = function (editor, item) {
      if (is$1(item, 'dd')) {
        mutate(item, 'dt');
      } else if (is$1(item, 'dt')) {
        parent(item).each(function (dl) {
          return splitList(editor, dl.dom, item.dom);
        });
      }
    };
    var indentDlItem = function (item) {
      if (is$1(item, 'dt')) {
        mutate(item, 'dd');
      }
    };
    var dlIndentation = function (editor, indentation, dlItems) {
      if (indentation === 'Indent') {
        each(dlItems, indentDlItem);
      } else {
        each(dlItems, function (item) {
          return outdentDlItem(editor, item);
        });
      }
    };

    var getNormalizedPoint = function (container, offset) {
      if (isTextNode(container)) {
        return {
          container: container,
          offset: offset
        };
      }
      var node = global$1.getNode(container, offset);
      if (isTextNode(node)) {
        return {
          container: node,
          offset: offset >= container.childNodes.length ? node.data.length : 0
        };
      } else if (node.previousSibling && isTextNode(node.previousSibling)) {
        return {
          container: node.previousSibling,
          offset: node.previousSibling.data.length
        };
      } else if (node.nextSibling && isTextNode(node.nextSibling)) {
        return {
          container: node.nextSibling,
          offset: 0
        };
      }
      return {
        container: container,
        offset: offset
      };
    };
    var normalizeRange = function (rng) {
      var outRng = rng.cloneRange();
      var rangeStart = getNormalizedPoint(rng.startContainer, rng.startOffset);
      outRng.setStart(rangeStart.container, rangeStart.offset);
      var rangeEnd = getNormalizedPoint(rng.endContainer, rng.endOffset);
      outRng.setEnd(rangeEnd.container, rangeEnd.offset);
      return outRng;
    };

    var global$6 = tinymce.util.Tools.resolve('tinymce.dom.DomQuery');

    var getParentList = function (editor, node) {
      var selectionStart = node || editor.selection.getStart(true);
      return editor.dom.getParent(selectionStart, 'OL,UL,DL', getClosestListRootElm(editor, selectionStart));
    };
    var isParentListSelected = function (parentList, selectedBlocks) {
      return parentList && selectedBlocks.length === 1 && selectedBlocks[0] === parentList;
    };
    var findSubLists = function (parentList) {
      return global$5.grep(parentList.querySelectorAll('ol,ul,dl'), function (elm) {
        return isListNode(elm);
      });
    };
    var getSelectedSubLists = function (editor) {
      var parentList = getParentList(editor);
      var selectedBlocks = editor.selection.getSelectedBlocks();
      if (isParentListSelected(parentList, selectedBlocks)) {
        return findSubLists(parentList);
      } else {
        return global$5.grep(selectedBlocks, function (elm) {
          return isListNode(elm) && parentList !== elm;
        });
      }
    };
    var findParentListItemsNodes = function (editor, elms) {
      var listItemsElms = global$5.map(elms, function (elm) {
        var parentLi = editor.dom.getParent(elm, 'li,dd,dt', getClosestListRootElm(editor, elm));
        return parentLi ? parentLi : elm;
      });
      return global$6.unique(listItemsElms);
    };
    var getSelectedListItems = function (editor) {
      var selectedBlocks = editor.selection.getSelectedBlocks();
      return global$5.grep(findParentListItemsNodes(editor, selectedBlocks), function (block) {
        return isListItemNode(block);
      });
    };
    var getSelectedDlItems = function (editor) {
      return filter(getSelectedListItems(editor), isDlItemNode);
    };
    var getClosestListRootElm = function (editor, elm) {
      var parentTableCell = editor.dom.getParents(elm, 'TD,TH');
      var root = parentTableCell.length > 0 ? parentTableCell[0] : editor.getBody();
      return root;
    };
    var findLastParentListNode = function (editor, elm) {
      var parentLists = editor.dom.getParents(elm, 'ol,ul', getClosestListRootElm(editor, elm));
      return last(parentLists);
    };
    var getSelectedLists = function (editor) {
      var firstList = findLastParentListNode(editor, editor.selection.getStart());
      var subsequentLists = filter(editor.selection.getSelectedBlocks(), isOlUlNode);
      return firstList.toArray().concat(subsequentLists);
    };
    var getSelectedListRoots = function (editor) {
      var selectedLists = getSelectedLists(editor);
      return getUniqueListRoots(editor, selectedLists);
    };
    var getUniqueListRoots = function (editor, lists) {
      var listRoots = map(lists, function (list) {
        return findLastParentListNode(editor, list).getOr(list);
      });
      return global$6.unique(listRoots);
    };

    var lift2 = function (oa, ob, f) {
      return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();
    };

    var fromElements = function (elements, scope) {
      var doc = scope || document;
      var fragment = doc.createDocumentFragment();
      each(elements, function (element) {
        fragment.appendChild(element.dom);
      });
      return SugarElement.fromDom(fragment);
    };

    var fireListEvent = function (editor, action, element) {
      return editor.fire('ListMutation', {
        action: action,
        element: element
      });
    };

    var isSupported = function (dom) {
      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);
    };

    var internalSet = function (dom, property, value) {
      if (!isString(value)) {
        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);
        throw new Error('CSS value must be a string: ' + value);
      }
      if (isSupported(dom)) {
        dom.style.setProperty(property, value);
      }
    };
    var set = function (element, property, value) {
      var dom = element.dom;
      internalSet(dom, property, value);
    };

    var joinSegment = function (parent, child) {
      append(parent.item, child.list);
    };
    var joinSegments = function (segments) {
      for (var i = 1; i < segments.length; i++) {
        joinSegment(segments[i - 1], segments[i]);
      }
    };
    var appendSegments = function (head$1, tail) {
      lift2(last(head$1), head(tail), joinSegment);
    };
    var createSegment = function (scope, listType) {
      var segment = {
        list: SugarElement.fromTag(listType, scope),
        item: SugarElement.fromTag('li', scope)
      };
      append(segment.list, segment.item);
      return segment;
    };
    var createSegments = function (scope, entry, size) {
      var segments = [];
      for (var i = 0; i < size; i++) {
        segments.push(createSegment(scope, entry.listType));
      }
      return segments;
    };
    var populateSegments = function (segments, entry) {
      for (var i = 0; i < segments.length - 1; i++) {
        set(segments[i].item, 'list-style-type', 'none');
      }
      last(segments).each(function (segment) {
        setAll(segment.list, entry.listAttributes);
        setAll(segment.item, entry.itemAttributes);
        append$1(segment.item, entry.content);
      });
    };
    var normalizeSegment = function (segment, entry) {
      if (name(segment.list) !== entry.listType) {
        segment.list = mutate(segment.list, entry.listType);
      }
      setAll(segment.list, entry.listAttributes);
    };
    var createItem = function (scope, attr, content) {
      var item = SugarElement.fromTag('li', scope);
      setAll(item, attr);
      append$1(item, content);
      return item;
    };
    var appendItem = function (segment, item) {
      append(segment.list, item);
      segment.item = item;
    };
    var writeShallow = function (scope, cast, entry) {
      var newCast = cast.slice(0, entry.depth);
      last(newCast).each(function (segment) {
        var item = createItem(scope, entry.itemAttributes, entry.content);
        appendItem(segment, item);
        normalizeSegment(segment, entry);
      });
      return newCast;
    };
    var writeDeep = function (scope, cast, entry) {
      var segments = createSegments(scope, entry, entry.depth - cast.length);
      joinSegments(segments);
      populateSegments(segments, entry);
      appendSegments(cast, segments);
      return cast.concat(segments);
    };
    var composeList = function (scope, entries) {
      var cast = foldl(entries, function (cast, entry) {
        return entry.depth > cast.length ? writeDeep(scope, cast, entry) : writeShallow(scope, cast, entry);
      }, []);
      return head(cast).map(function (segment) {
        return segment.list;
      });
    };

    var isList = function (el) {
      return is$1(el, 'OL,UL');
    };
    var hasFirstChildList = function (el) {
      return firstChild(el).map(isList).getOr(false);
    };
    var hasLastChildList = function (el) {
      return lastChild(el).map(isList).getOr(false);
    };

    var isIndented = function (entry) {
      return entry.depth > 0;
    };
    var isSelected = function (entry) {
      return entry.isSelected;
    };
    var cloneItemContent = function (li) {
      var children$1 = children(li);
      var content = hasLastChildList(li) ? children$1.slice(0, -1) : children$1;
      return map(content, deep);
    };
    var createEntry = function (li, depth, isSelected) {
      return parent(li).filter(isElement).map(function (list) {
        return {
          depth: depth,
          dirty: false,
          isSelected: isSelected,
          content: cloneItemContent(li),
          itemAttributes: clone(li),
          listAttributes: clone(list),
          listType: name(list)
        };
      });
    };

    var indentEntry = function (indentation, entry) {
      switch (indentation) {
      case 'Indent':
        entry.depth++;
        break;
      case 'Outdent':
        entry.depth--;
        break;
      case 'Flatten':
        entry.depth = 0;
      }
      entry.dirty = true;
    };

    var cloneListProperties = function (target, source) {
      target.listType = source.listType;
      target.listAttributes = __assign({}, source.listAttributes);
    };
    var cleanListProperties = function (entry) {
      entry.listAttributes = filter$1(entry.listAttributes, function (_value, key) {
        return key !== 'start';
      });
    };
    var closestSiblingEntry = function (entries, start) {
      var depth = entries[start].depth;
      var matches = function (entry) {
        return entry.depth === depth && !entry.dirty;
      };
      var until = function (entry) {
        return entry.depth < depth;
      };
      return findUntil(reverse(entries.slice(0, start)), matches, until).orThunk(function () {
        return findUntil(entries.slice(start + 1), matches, until);
      });
    };
    var normalizeEntries = function (entries) {
      each(entries, function (entry, i) {
        closestSiblingEntry(entries, i).fold(function () {
          if (entry.dirty) {
            cleanListProperties(entry);
          }
        }, function (matchingEntry) {
          return cloneListProperties(entry, matchingEntry);
        });
      });
      return entries;
    };

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var parseItem = function (depth, itemSelection, selectionState, item) {
      return firstChild(item).filter(isList).fold(function () {
        itemSelection.each(function (selection) {
          if (eq(selection.start, item)) {
            selectionState.set(true);
          }
        });
        var currentItemEntry = createEntry(item, depth, selectionState.get());
        itemSelection.each(function (selection) {
          if (eq(selection.end, item)) {
            selectionState.set(false);
          }
        });
        var childListEntries = lastChild(item).filter(isList).map(function (list) {
          return parseList(depth, itemSelection, selectionState, list);
        }).getOr([]);
        return currentItemEntry.toArray().concat(childListEntries);
      }, function (list) {
        return parseList(depth, itemSelection, selectionState, list);
      });
    };
    var parseList = function (depth, itemSelection, selectionState, list) {
      return bind(children(list), function (element) {
        var parser = isList(element) ? parseList : parseItem;
        var newDepth = depth + 1;
        return parser(newDepth, itemSelection, selectionState, element);
      });
    };
    var parseLists = function (lists, itemSelection) {
      var selectionState = Cell(false);
      var initialDepth = 0;
      return map(lists, function (list) {
        return {
          sourceList: list,
          entries: parseList(initialDepth, itemSelection, selectionState, list)
        };
      });
    };

    var outdentedComposer = function (editor, entries) {
      var normalizedEntries = normalizeEntries(entries);
      return map(normalizedEntries, function (entry) {
        var content = fromElements(entry.content);
        return SugarElement.fromDom(createTextBlock(editor, content.dom));
      });
    };
    var indentedComposer = function (editor, entries) {
      var normalizedEntries = normalizeEntries(entries);
      return composeList(editor.contentDocument, normalizedEntries).toArray();
    };
    var composeEntries = function (editor, entries) {
      return bind(groupBy(entries, isIndented), function (entries) {
        var groupIsIndented = head(entries).map(isIndented).getOr(false);
        return groupIsIndented ? indentedComposer(editor, entries) : outdentedComposer(editor, entries);
      });
    };
    var indentSelectedEntries = function (entries, indentation) {
      each(filter(entries, isSelected), function (entry) {
        return indentEntry(indentation, entry);
      });
    };
    var getItemSelection = function (editor) {
      var selectedListItems = map(getSelectedListItems(editor), SugarElement.fromDom);
      return lift2(find(selectedListItems, not(hasFirstChildList)), find(reverse(selectedListItems), not(hasFirstChildList)), function (start, end) {
        return {
          start: start,
          end: end
        };
      });
    };
    var listIndentation = function (editor, lists, indentation) {
      var entrySets = parseLists(lists, getItemSelection(editor));
      each(entrySets, function (entrySet) {
        indentSelectedEntries(entrySet.entries, indentation);
        var composedLists = composeEntries(editor, entrySet.entries);
        each(composedLists, function (composedList) {
          fireListEvent(editor, indentation === 'Indent' ? 'IndentList' : 'OutdentList', composedList.dom);
        });
        before$1(entrySet.sourceList, composedLists);
        remove(entrySet.sourceList);
      });
    };

    var selectionIndentation = function (editor, indentation) {
      var lists = map(getSelectedListRoots(editor), SugarElement.fromDom);
      var dlItems = map(getSelectedDlItems(editor), SugarElement.fromDom);
      var isHandled = false;
      if (lists.length || dlItems.length) {
        var bookmark = editor.selection.getBookmark();
        listIndentation(editor, lists, indentation);
        dlIndentation(editor, indentation, dlItems);
        editor.selection.moveToBookmark(bookmark);
        editor.selection.setRng(normalizeRange(editor.selection.getRng()));
        editor.nodeChanged();
        isHandled = true;
      }
      return isHandled;
    };
    var indentListSelection = function (editor) {
      return selectionIndentation(editor, 'Indent');
    };
    var outdentListSelection = function (editor) {
      return selectionIndentation(editor, 'Outdent');
    };
    var flattenListSelection = function (editor) {
      return selectionIndentation(editor, 'Flatten');
    };

    var global$7 = tinymce.util.Tools.resolve('tinymce.dom.BookmarkManager');

    var DOM$1 = global$4.DOM;
    var createBookmark = function (rng) {
      var bookmark = {};
      var setupEndPoint = function (start) {
        var offsetNode, container, offset;
        container = rng[start ? 'startContainer' : 'endContainer'];
        offset = rng[start ? 'startOffset' : 'endOffset'];
        if (container.nodeType === 1) {
          offsetNode = DOM$1.create('span', { 'data-mce-type': 'bookmark' });
          if (container.hasChildNodes()) {
            offset = Math.min(offset, container.childNodes.length - 1);
            if (start) {
              container.insertBefore(offsetNode, container.childNodes[offset]);
            } else {
              DOM$1.insertAfter(offsetNode, container.childNodes[offset]);
            }
          } else {
            container.appendChild(offsetNode);
          }
          container = offsetNode;
          offset = 0;
        }
        bookmark[start ? 'startContainer' : 'endContainer'] = container;
        bookmark[start ? 'startOffset' : 'endOffset'] = offset;
      };
      setupEndPoint(true);
      if (!rng.collapsed) {
        setupEndPoint();
      }
      return bookmark;
    };
    var resolveBookmark = function (bookmark) {
      var restoreEndPoint = function (start) {
        var container, offset, node;
        var nodeIndex = function (container) {
          var node = container.parentNode.firstChild, idx = 0;
          while (node) {
            if (node === container) {
              return idx;
            }
            if (node.nodeType !== 1 || node.getAttribute('data-mce-type') !== 'bookmark') {
              idx++;
            }
            node = node.nextSibling;
          }
          return -1;
        };
        container = node = bookmark[start ? 'startContainer' : 'endContainer'];
        offset = bookmark[start ? 'startOffset' : 'endOffset'];
        if (!container) {
          return;
        }
        if (container.nodeType === 1) {
          offset = nodeIndex(container);
          container = container.parentNode;
          DOM$1.remove(node);
          if (!container.hasChildNodes() && DOM$1.isBlock(container)) {
            container.appendChild(DOM$1.create('br'));
          }
        }
        bookmark[start ? 'startContainer' : 'endContainer'] = container;
        bookmark[start ? 'startOffset' : 'endOffset'] = offset;
      };
      restoreEndPoint(true);
      restoreEndPoint();
      var rng = DOM$1.createRng();
      rng.setStart(bookmark.startContainer, bookmark.startOffset);
      if (bookmark.endContainer) {
        rng.setEnd(bookmark.endContainer, bookmark.endOffset);
      }
      return normalizeRange(rng);
    };

    var listToggleActionFromListName = function (listName) {
      switch (listName) {
      case 'UL':
        return 'ToggleUlList';
      case 'OL':
        return 'ToggleOlList';
      case 'DL':
        return 'ToggleDLList';
      }
    };

    var isCustomList = function (list) {
      return /\btox\-/.test(list.className);
    };
    var listState = function (editor, listName, activate) {
      var nodeChangeHandler = function (e) {
        var inList = findUntil(e.parents, isListNode, isTableCellNode).filter(function (list) {
          return list.nodeName === listName && !isCustomList(list);
        }).isSome();
        activate(inList);
      };
      var parents = editor.dom.getParents(editor.selection.getNode());
      nodeChangeHandler({ parents: parents });
      editor.on('NodeChange', nodeChangeHandler);
      return function () {
        return editor.off('NodeChange', nodeChangeHandler);
      };
    };

    var updateListStyle = function (dom, el, detail) {
      var type = detail['list-style-type'] ? detail['list-style-type'] : null;
      dom.setStyle(el, 'list-style-type', type);
    };
    var setAttribs = function (elm, attrs) {
      global$5.each(attrs, function (value, key) {
        elm.setAttribute(key, value);
      });
    };
    var updateListAttrs = function (dom, el, detail) {
      setAttribs(el, detail['list-attributes']);
      global$5.each(dom.select('li', el), function (li) {
        setAttribs(li, detail['list-item-attributes']);
      });
    };
    var updateListWithDetails = function (dom, el, detail) {
      updateListStyle(dom, el, detail);
      updateListAttrs(dom, el, detail);
    };
    var removeStyles = function (dom, element, styles) {
      global$5.each(styles, function (style) {
        var _a;
        return dom.setStyle(element, (_a = {}, _a[style] = '', _a));
      });
    };
    var getEndPointNode = function (editor, rng, start, root) {
      var container = rng[start ? 'startContainer' : 'endContainer'];
      var offset = rng[start ? 'startOffset' : 'endOffset'];
      if (container.nodeType === 1) {
        container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;
      }
      if (!start && isBr(container.nextSibling)) {
        container = container.nextSibling;
      }
      while (container.parentNode !== root) {
        if (isTextBlock(editor, container)) {
          return container;
        }
        if (/^(TD|TH)$/.test(container.parentNode.nodeName)) {
          return container;
        }
        container = container.parentNode;
      }
      return container;
    };
    var getSelectedTextBlocks = function (editor, rng, root) {
      var textBlocks = [], dom = editor.dom;
      var startNode = getEndPointNode(editor, rng, true, root);
      var endNode = getEndPointNode(editor, rng, false, root);
      var block;
      var siblings = [];
      for (var node = startNode; node; node = node.nextSibling) {
        siblings.push(node);
        if (node === endNode) {
          break;
        }
      }
      global$5.each(siblings, function (node) {
        if (isTextBlock(editor, node)) {
          textBlocks.push(node);
          block = null;
          return;
        }
        if (dom.isBlock(node) || isBr(node)) {
          if (isBr(node)) {
            dom.remove(node);
          }
          block = null;
          return;
        }
        var nextSibling = node.nextSibling;
        if (global$7.isBookmarkNode(node)) {
          if (isListNode(nextSibling) || isTextBlock(editor, nextSibling) || !nextSibling && node.parentNode === root) {
            block = null;
            return;
          }
        }
        if (!block) {
          block = dom.create('p');
          node.parentNode.insertBefore(block, node);
          textBlocks.push(block);
        }
        block.appendChild(node);
      });
      return textBlocks;
    };
    var hasCompatibleStyle = function (dom, sib, detail) {
      var sibStyle = dom.getStyle(sib, 'list-style-type');
      var detailStyle = detail ? detail['list-style-type'] : '';
      detailStyle = detailStyle === null ? '' : detailStyle;
      return sibStyle === detailStyle;
    };
    var applyList = function (editor, listName, detail) {
      var rng = editor.selection.getRng();
      var listItemName = 'LI';
      var root = getClosestListRootElm(editor, editor.selection.getStart(true));
      var dom = editor.dom;
      if (dom.getContentEditable(editor.selection.getNode()) === 'false') {
        return;
      }
      listName = listName.toUpperCase();
      if (listName === 'DL') {
        listItemName = 'DT';
      }
      var bookmark = createBookmark(rng);
      var selectedTextBlocks = getSelectedTextBlocks(editor, rng, root);
      global$5.each(selectedTextBlocks, function (block) {
        var listBlock;
        var sibling = block.previousSibling;
        var parent = block.parentNode;
        if (!isListItemNode(parent)) {
          if (sibling && isListNode(sibling) && sibling.nodeName === listName && hasCompatibleStyle(dom, sibling, detail)) {
            listBlock = sibling;
            block = dom.rename(block, listItemName);
            sibling.appendChild(block);
          } else {
            listBlock = dom.create(listName);
            block.parentNode.insertBefore(listBlock, block);
            listBlock.appendChild(block);
            block = dom.rename(block, listItemName);
          }
          removeStyles(dom, block, [
            'margin',
            'margin-right',
            'margin-bottom',
            'margin-left',
            'margin-top',
            'padding',
            'padding-right',
            'padding-bottom',
            'padding-left',
            'padding-top'
          ]);
          updateListWithDetails(dom, listBlock, detail);
          mergeWithAdjacentLists(editor.dom, listBlock);
        }
      });
      editor.selection.setRng(resolveBookmark(bookmark));
    };
    var isValidLists = function (list1, list2) {
      return list1 && list2 && isListNode(list1) && list1.nodeName === list2.nodeName;
    };
    var hasSameListStyle = function (dom, list1, list2) {
      var targetStyle = dom.getStyle(list1, 'list-style-type', true);
      var style = dom.getStyle(list2, 'list-style-type', true);
      return targetStyle === style;
    };
    var hasSameClasses = function (elm1, elm2) {
      return elm1.className === elm2.className;
    };
    var shouldMerge = function (dom, list1, list2) {
      return isValidLists(list1, list2) && hasSameListStyle(dom, list1, list2) && hasSameClasses(list1, list2);
    };
    var mergeWithAdjacentLists = function (dom, listBlock) {
      var sibling, node;
      sibling = listBlock.nextSibling;
      if (shouldMerge(dom, listBlock, sibling)) {
        while (node = sibling.firstChild) {
          listBlock.appendChild(node);
        }
        dom.remove(sibling);
      }
      sibling = listBlock.previousSibling;
      if (shouldMerge(dom, listBlock, sibling)) {
        while (node = sibling.lastChild) {
          listBlock.insertBefore(node, listBlock.firstChild);
        }
        dom.remove(sibling);
      }
    };
    var updateList = function (editor, list, listName, detail) {
      if (list.nodeName !== listName) {
        var newList = editor.dom.rename(list, listName);
        updateListWithDetails(editor.dom, newList, detail);
        fireListEvent(editor, listToggleActionFromListName(listName), newList);
      } else {
        updateListWithDetails(editor.dom, list, detail);
        fireListEvent(editor, listToggleActionFromListName(listName), list);
      }
    };
    var toggleMultipleLists = function (editor, parentList, lists, listName, detail) {
      var parentIsList = isListNode(parentList);
      if (parentIsList && parentList.nodeName === listName && !hasListStyleDetail(detail)) {
        flattenListSelection(editor);
      } else {
        applyList(editor, listName, detail);
        var bookmark = createBookmark(editor.selection.getRng(true));
        var allLists = parentIsList ? __spreadArrays([parentList], lists) : lists;
        global$5.each(allLists, function (elm) {
          updateList(editor, elm, listName, detail);
        });
        editor.selection.setRng(resolveBookmark(bookmark));
      }
    };
    var hasListStyleDetail = function (detail) {
      return 'list-style-type' in detail;
    };
    var toggleSingleList = function (editor, parentList, listName, detail) {
      if (parentList === editor.getBody()) {
        return;
      }
      if (parentList) {
        if (parentList.nodeName === listName && !hasListStyleDetail(detail) && !isCustomList(parentList)) {
          flattenListSelection(editor);
        } else {
          var bookmark = createBookmark(editor.selection.getRng(true));
          updateListWithDetails(editor.dom, parentList, detail);
          var newList = editor.dom.rename(parentList, listName);
          mergeWithAdjacentLists(editor.dom, newList);
          editor.selection.setRng(resolveBookmark(bookmark));
          applyList(editor, listName, detail);
          fireListEvent(editor, listToggleActionFromListName(listName), newList);
        }
      } else {
        applyList(editor, listName, detail);
        fireListEvent(editor, listToggleActionFromListName(listName), parentList);
      }
    };
    var toggleList = function (editor, listName, _detail) {
      var parentList = getParentList(editor);
      var selectedSubLists = getSelectedSubLists(editor);
      var detail = isObject(_detail) ? _detail : {};
      if (selectedSubLists.length > 0) {
        toggleMultipleLists(editor, parentList, selectedSubLists, listName, detail);
      } else {
        toggleSingleList(editor, parentList, listName, detail);
      }
    };

    var DOM$2 = global$4.DOM;
    var normalizeList = function (dom, ul) {
      var sibling;
      var parentNode = ul.parentNode;
      if (parentNode.nodeName === 'LI' && parentNode.firstChild === ul) {
        sibling = parentNode.previousSibling;
        if (sibling && sibling.nodeName === 'LI') {
          sibling.appendChild(ul);
          if (isEmpty$1(dom, parentNode)) {
            DOM$2.remove(parentNode);
          }
        } else {
          DOM$2.setStyle(parentNode, 'listStyleType', 'none');
        }
      }
      if (isListNode(parentNode)) {
        sibling = parentNode.previousSibling;
        if (sibling && sibling.nodeName === 'LI') {
          sibling.appendChild(ul);
        }
      }
    };
    var normalizeLists = function (dom, element) {
      global$5.each(global$5.grep(dom.select('ol,ul', element)), function (ul) {
        normalizeList(dom, ul);
      });
    };

    var findNextCaretContainer = function (editor, rng, isForward, root) {
      var node = rng.startContainer;
      var offset = rng.startOffset;
      if (isTextNode(node) && (isForward ? offset < node.data.length : offset > 0)) {
        return node;
      }
      var nonEmptyBlocks = editor.schema.getNonEmptyElements();
      if (node.nodeType === 1) {
        node = global$1.getNode(node, offset);
      }
      var walker = new global$2(node, root);
      if (isForward) {
        if (isBogusBr(editor.dom, node)) {
          walker.next();
        }
      }
      while (node = walker[isForward ? 'next' : 'prev2']()) {
        if (node.nodeName === 'LI' && !node.hasChildNodes()) {
          return node;
        }
        if (nonEmptyBlocks[node.nodeName]) {
          return node;
        }
        if (isTextNode(node) && node.data.length > 0) {
          return node;
        }
      }
    };
    var hasOnlyOneBlockChild = function (dom, elm) {
      var childNodes = elm.childNodes;
      return childNodes.length === 1 && !isListNode(childNodes[0]) && dom.isBlock(childNodes[0]);
    };
    var unwrapSingleBlockChild = function (dom, elm) {
      if (hasOnlyOneBlockChild(dom, elm)) {
        dom.remove(elm.firstChild, true);
      }
    };
    var moveChildren = function (dom, fromElm, toElm) {
      var node;
      var targetElm = hasOnlyOneBlockChild(dom, toElm) ? toElm.firstChild : toElm;
      unwrapSingleBlockChild(dom, fromElm);
      if (!isEmpty$1(dom, fromElm, true)) {
        while (node = fromElm.firstChild) {
          targetElm.appendChild(node);
        }
      }
    };
    var mergeLiElements = function (dom, fromElm, toElm) {
      var listNode;
      var ul = fromElm.parentNode;
      if (!isChildOfBody(dom, fromElm) || !isChildOfBody(dom, toElm)) {
        return;
      }
      if (isListNode(toElm.lastChild)) {
        listNode = toElm.lastChild;
      }
      if (ul === toElm.lastChild) {
        if (isBr(ul.previousSibling)) {
          dom.remove(ul.previousSibling);
        }
      }
      var node = toElm.lastChild;
      if (node && isBr(node) && fromElm.hasChildNodes()) {
        dom.remove(node);
      }
      if (isEmpty$1(dom, toElm, true)) {
        dom.$(toElm).empty();
      }
      moveChildren(dom, fromElm, toElm);
      if (listNode) {
        toElm.appendChild(listNode);
      }
      var contains = contains$1(SugarElement.fromDom(toElm), SugarElement.fromDom(fromElm));
      var nestedLists = contains ? dom.getParents(fromElm, isListNode, toElm) : [];
      dom.remove(fromElm);
      each(nestedLists, function (list) {
        if (isEmpty$1(dom, list) && list !== dom.getRoot()) {
          dom.remove(list);
        }
      });
    };
    var mergeIntoEmptyLi = function (editor, fromLi, toLi) {
      editor.dom.$(toLi).empty();
      mergeLiElements(editor.dom, fromLi, toLi);
      editor.selection.setCursorLocation(toLi, 0);
    };
    var mergeForward = function (editor, rng, fromLi, toLi) {
      var dom = editor.dom;
      if (dom.isEmpty(toLi)) {
        mergeIntoEmptyLi(editor, fromLi, toLi);
      } else {
        var bookmark = createBookmark(rng);
        mergeLiElements(dom, fromLi, toLi);
        editor.selection.setRng(resolveBookmark(bookmark));
      }
    };
    var mergeBackward = function (editor, rng, fromLi, toLi) {
      var bookmark = createBookmark(rng);
      mergeLiElements(editor.dom, fromLi, toLi);
      var resolvedBookmark = resolveBookmark(bookmark);
      editor.selection.setRng(resolvedBookmark);
    };
    var backspaceDeleteFromListToListCaret = function (editor, isForward) {
      var dom = editor.dom, selection = editor.selection;
      var selectionStartElm = selection.getStart();
      var root = getClosestListRootElm(editor, selectionStartElm);
      var li = dom.getParent(selection.getStart(), 'LI', root);
      if (li) {
        var ul = li.parentNode;
        if (ul === editor.getBody() && isEmpty$1(dom, ul)) {
          return true;
        }
        var rng_1 = normalizeRange(selection.getRng());
        var otherLi_1 = dom.getParent(findNextCaretContainer(editor, rng_1, isForward, root), 'LI', root);
        if (otherLi_1 && otherLi_1 !== li) {
          editor.undoManager.transact(function () {
            if (isForward) {
              mergeForward(editor, rng_1, otherLi_1, li);
            } else {
              if (isFirstChild(li)) {
                outdentListSelection(editor);
              } else {
                mergeBackward(editor, rng_1, li, otherLi_1);
              }
            }
          });
          return true;
        } else if (!otherLi_1) {
          if (!isForward && rng_1.startOffset === 0 && rng_1.endOffset === 0) {
            editor.undoManager.transact(function () {
              flattenListSelection(editor);
            });
            return true;
          }
        }
      }
      return false;
    };
    var removeBlock = function (dom, block, root) {
      var parentBlock = dom.getParent(block.parentNode, dom.isBlock, root);
      dom.remove(block);
      if (parentBlock && dom.isEmpty(parentBlock)) {
        dom.remove(parentBlock);
      }
    };
    var backspaceDeleteIntoListCaret = function (editor, isForward) {
      var dom = editor.dom;
      var selectionStartElm = editor.selection.getStart();
      var root = getClosestListRootElm(editor, selectionStartElm);
      var block = dom.getParent(selectionStartElm, dom.isBlock, root);
      if (block && dom.isEmpty(block)) {
        var rng = normalizeRange(editor.selection.getRng());
        var otherLi_2 = dom.getParent(findNextCaretContainer(editor, rng, isForward, root), 'LI', root);
        if (otherLi_2) {
          editor.undoManager.transact(function () {
            removeBlock(dom, block, root);
            mergeWithAdjacentLists(dom, otherLi_2.parentNode);
            editor.selection.select(otherLi_2, true);
            editor.selection.collapse(isForward);
          });
          return true;
        }
      }
      return false;
    };
    var backspaceDeleteCaret = function (editor, isForward) {
      return backspaceDeleteFromListToListCaret(editor, isForward) || backspaceDeleteIntoListCaret(editor, isForward);
    };
    var backspaceDeleteRange = function (editor) {
      var selectionStartElm = editor.selection.getStart();
      var root = getClosestListRootElm(editor, selectionStartElm);
      var startListParent = editor.dom.getParent(selectionStartElm, 'LI,DT,DD', root);
      if (startListParent || getSelectedListItems(editor).length > 0) {
        editor.undoManager.transact(function () {
          editor.execCommand('Delete');
          normalizeLists(editor.dom, editor.getBody());
        });
        return true;
      }
      return false;
    };
    var backspaceDelete = function (editor, isForward) {
      return editor.selection.isCollapsed() ? backspaceDeleteCaret(editor, isForward) : backspaceDeleteRange(editor);
    };
    var setup = function (editor) {
      editor.on('keydown', function (e) {
        if (e.keyCode === global$3.BACKSPACE) {
          if (backspaceDelete(editor, false)) {
            e.preventDefault();
          }
        } else if (e.keyCode === global$3.DELETE) {
          if (backspaceDelete(editor, true)) {
            e.preventDefault();
          }
        }
      });
    };

    var get$1 = function (editor) {
      return {
        backspaceDelete: function (isForward) {
          backspaceDelete(editor, isForward);
        }
      };
    };

    var updateList$1 = function (editor, update) {
      var parentList = getParentList(editor);
      editor.undoManager.transact(function () {
        if (isObject(update.styles)) {
          editor.dom.setStyles(parentList, update.styles);
        }
        if (isObject(update.attrs)) {
          each$1(update.attrs, function (v, k) {
            return editor.dom.setAttrib(parentList, k, v);
          });
        }
      });
    };

    var parseAlphabeticBase26 = function (str) {
      var chars = reverse(trim(str).split(''));
      var values = map(chars, function (char, i) {
        var charValue = char.toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0) + 1;
        return Math.pow(26, i) * charValue;
      });
      return foldl(values, function (sum, v) {
        return sum + v;
      }, 0);
    };
    var composeAlphabeticBase26 = function (value) {
      value--;
      if (value < 0) {
        return '';
      } else {
        var remainder = value % 26;
        var quotient = Math.floor(value / 26);
        var rest = composeAlphabeticBase26(quotient);
        var char = String.fromCharCode('A'.charCodeAt(0) + remainder);
        return rest + char;
      }
    };
    var isUppercase = function (str) {
      return /^[A-Z]+$/.test(str);
    };
    var isLowercase = function (str) {
      return /^[a-z]+$/.test(str);
    };
    var isNumeric = function (str) {
      return /^[0-9]+$/.test(str);
    };
    var deduceListType = function (start) {
      if (isNumeric(start)) {
        return 2;
      } else if (isUppercase(start)) {
        return 0;
      } else if (isLowercase(start)) {
        return 1;
      } else if (isEmpty(start)) {
        return 3;
      } else {
        return 4;
      }
    };
    var parseStartValue = function (start) {
      switch (deduceListType(start)) {
      case 2:
        return Optional.some({
          listStyleType: Optional.none(),
          start: start
        });
      case 0:
        return Optional.some({
          listStyleType: Optional.some('upper-alpha'),
          start: parseAlphabeticBase26(start).toString()
        });
      case 1:
        return Optional.some({
          listStyleType: Optional.some('lower-alpha'),
          start: parseAlphabeticBase26(start).toString()
        });
      case 3:
        return Optional.some({
          listStyleType: Optional.none(),
          start: ''
        });
      case 4:
        return Optional.none();
      }
    };
    var parseDetail = function (detail) {
      var start = parseInt(detail.start, 10);
      if (detail.listStyleType.is('upper-alpha')) {
        return composeAlphabeticBase26(start);
      } else if (detail.listStyleType.is('lower-alpha')) {
        return composeAlphabeticBase26(start).toLowerCase();
      } else {
        return detail.start;
      }
    };

    var open = function (editor) {
      var currentList = getParentList(editor);
      if (!isOlNode(currentList)) {
        return;
      }
      editor.windowManager.open({
        title: 'List Properties',
        body: {
          type: 'panel',
          items: [{
              type: 'input',
              name: 'start',
              label: 'Start list at number',
              inputMode: 'numeric'
            }]
        },
        initialData: {
          start: parseDetail({
            start: editor.dom.getAttrib(currentList, 'start', '1'),
            listStyleType: Optional.some(editor.dom.getStyle(currentList, 'list-style-type'))
          })
        },
        buttons: [
          {
            type: 'cancel',
            name: 'cancel',
            text: 'Cancel'
          },
          {
            type: 'submit',
            name: 'save',
            text: 'Save',
            primary: true
          }
        ],
        onSubmit: function (api) {
          var data = api.getData();
          parseStartValue(data.start).each(function (detail) {
            editor.execCommand('mceListUpdate', false, {
              attrs: { start: detail.start === '1' ? '' : detail.start },
              styles: { 'list-style-type': detail.listStyleType.getOr('') }
            });
          });
          api.close();
        }
      });
    };

    var queryListCommandState = function (editor, listName) {
      return function () {
        var parentList = getParentList(editor);
        return parentList && parentList.nodeName === listName;
      };
    };
    var registerDialog = function (editor) {
      editor.addCommand('mceListProps', function () {
        open(editor);
      });
    };
    var register = function (editor) {
      editor.on('BeforeExecCommand', function (e) {
        var cmd = e.command.toLowerCase();
        if (cmd === 'indent') {
          indentListSelection(editor);
        } else if (cmd === 'outdent') {
          outdentListSelection(editor);
        }
      });
      editor.addCommand('InsertUnorderedList', function (ui, detail) {
        toggleList(editor, 'UL', detail);
      });
      editor.addCommand('InsertOrderedList', function (ui, detail) {
        toggleList(editor, 'OL', detail);
      });
      editor.addCommand('InsertDefinitionList', function (ui, detail) {
        toggleList(editor, 'DL', detail);
      });
      editor.addCommand('RemoveList', function () {
        flattenListSelection(editor);
      });
      registerDialog(editor);
      editor.addCommand('mceListUpdate', function (ui, detail) {
        if (isObject(detail)) {
          updateList$1(editor, detail);
        }
      });
      editor.addQueryStateHandler('InsertUnorderedList', queryListCommandState(editor, 'UL'));
      editor.addQueryStateHandler('InsertOrderedList', queryListCommandState(editor, 'OL'));
      editor.addQueryStateHandler('InsertDefinitionList', queryListCommandState(editor, 'DL'));
    };

    var setupTabKey = function (editor) {
      editor.on('keydown', function (e) {
        if (e.keyCode !== global$3.TAB || global$3.metaKeyPressed(e)) {
          return;
        }
        editor.undoManager.transact(function () {
          if (e.shiftKey ? outdentListSelection(editor) : indentListSelection(editor)) {
            e.preventDefault();
          }
        });
      });
    };
    var setup$1 = function (editor) {
      if (shouldIndentOnTab(editor)) {
        setupTabKey(editor);
      }
      setup(editor);
    };

    var register$1 = function (editor) {
      var exec = function (command) {
        return function () {
          return editor.execCommand(command);
        };
      };
      if (!editor.hasPlugin('advlist')) {
        editor.ui.registry.addToggleButton('numlist', {
          icon: 'ordered-list',
          active: false,
          tooltip: 'Numbered list',
          onAction: exec('InsertOrderedList'),
          onSetup: function (api) {
            return listState(editor, 'OL', api.setActive);
          }
        });
        editor.ui.registry.addToggleButton('bullist', {
          icon: 'unordered-list',
          active: false,
          tooltip: 'Bullet list',
          onAction: exec('InsertUnorderedList'),
          onSetup: function (api) {
            return listState(editor, 'UL', api.setActive);
          }
        });
      }
    };

    var register$2 = function (editor) {
      var listProperties = {
        text: 'List properties...',
        icon: 'ordered-list',
        onAction: function () {
          return editor.execCommand('mceListProps');
        },
        onSetup: function (api) {
          return listState(editor, 'OL', function (active) {
            return api.setDisabled(!active);
          });
        }
      };
      editor.ui.registry.addMenuItem('listprops', listProperties);
      editor.ui.registry.addContextMenu('lists', {
        update: function (node) {
          var parentList = getParentList(editor, node);
          return isOlNode(parentList) ? ['listprops'] : [];
        }
      });
    };

    function Plugin () {
      global.add('lists', function (editor) {
        if (editor.hasPlugin('rtc', true) === false) {
          setup$1(editor);
          register(editor);
        } else {
          registerDialog(editor);
        }
        register$1(editor);
        register$2(editor);
        return get$1(editor);
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX2xpc3RzX2luZGV4X2pzLmNodW5rLmpzIiwic291cmNlcyI6WyIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy9saXN0cy9pbmRleC5qcyIsIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL2xpc3RzL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcImxpc3RzXCIgcGx1Z2luIGZvciB1c2FnZSB3aXRoIG1vZHVsZSBsb2FkZXJzXG4vLyBVc2FnZTpcbi8vICAgQ29tbW9uSlM6XG4vLyAgICAgcmVxdWlyZSgndGlueW1jZS9wbHVnaW5zL2xpc3RzJylcbi8vICAgRVMyMDE1OlxuLy8gICAgIGltcG9ydCAndGlueW1jZS9wbHVnaW5zL2xpc3RzJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIHR5cGVPZiA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgdCA9IHR5cGVvZiB4O1xuICAgICAgaWYgKHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICdudWxsJztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKEFycmF5LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHgpIHx8IHguY29uc3RydWN0b3IgJiYgeC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQXJyYXknKSkge1xuICAgICAgICByZXR1cm4gJ2FycmF5JztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKFN0cmluZy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZih4KSB8fCB4LmNvbnN0cnVjdG9yICYmIHguY29uc3RydWN0b3IubmFtZSA9PT0gJ1N0cmluZycpKSB7XG4gICAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlT2YodmFsdWUpID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1NpbXBsZVR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1N0cmluZyA9IGlzVHlwZSgnc3RyaW5nJyk7XG4gICAgdmFyIGlzT2JqZWN0ID0gaXNUeXBlKCdvYmplY3QnKTtcbiAgICB2YXIgaXNBcnJheSA9IGlzVHlwZSgnYXJyYXknKTtcbiAgICB2YXIgaXNCb29sZWFuID0gaXNTaW1wbGVUeXBlKCdib29sZWFuJyk7XG4gICAgdmFyIGlzRnVuY3Rpb24gPSBpc1NpbXBsZVR5cGUoJ2Z1bmN0aW9uJyk7XG4gICAgdmFyIGlzTnVtYmVyID0gaXNTaW1wbGVUeXBlKCdudW1iZXInKTtcblxuICAgIHZhciBub29wID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgdmFyIGNvbnN0YW50ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG5vdCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuICFmKHQpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBuZXZlciA9IGNvbnN0YW50KGZhbHNlKTtcbiAgICB2YXIgYWx3YXlzID0gY29uc3RhbnQodHJ1ZSk7XG5cbiAgICB2YXIgbm9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBOT05FO1xuICAgIH07XG4gICAgdmFyIE5PTkUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZXEgPSBmdW5jdGlvbiAobykge1xuICAgICAgICByZXR1cm4gby5pc05vbmUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2FsbCA9IGZ1bmN0aW9uICh0aHVuaykge1xuICAgICAgICByZXR1cm4gdGh1bmsoKTtcbiAgICAgIH07XG4gICAgICB2YXIgaWQgPSBmdW5jdGlvbiAobikge1xuICAgICAgICByZXR1cm4gbjtcbiAgICAgIH07XG4gICAgICB2YXIgbWUgPSB7XG4gICAgICAgIGZvbGQ6IGZ1bmN0aW9uIChuLCBfcykge1xuICAgICAgICAgIHJldHVybiBuKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzOiBuZXZlcixcbiAgICAgICAgaXNTb21lOiBuZXZlcixcbiAgICAgICAgaXNOb25lOiBhbHdheXMsXG4gICAgICAgIGdldE9yOiBpZCxcbiAgICAgICAgZ2V0T3JUaHVuazogY2FsbCxcbiAgICAgICAgZ2V0T3JEaWU6IGZ1bmN0aW9uIChtc2cpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnIHx8ICdlcnJvcjogZ2V0T3JEaWUgY2FsbGVkIG9uIG5vbmUuJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldE9yTnVsbDogY29uc3RhbnQobnVsbCksXG4gICAgICAgIGdldE9yVW5kZWZpbmVkOiBjb25zdGFudCh1bmRlZmluZWQpLFxuICAgICAgICBvcjogaWQsXG4gICAgICAgIG9yVGh1bms6IGNhbGwsXG4gICAgICAgIG1hcDogbm9uZSxcbiAgICAgICAgZWFjaDogbm9vcCxcbiAgICAgICAgYmluZDogbm9uZSxcbiAgICAgICAgZXhpc3RzOiBuZXZlcixcbiAgICAgICAgZm9yYWxsOiBhbHdheXMsXG4gICAgICAgIGZpbHRlcjogbm9uZSxcbiAgICAgICAgZXF1YWxzOiBlcSxcbiAgICAgICAgZXF1YWxzXzogZXEsXG4gICAgICAgIHRvQXJyYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH0sXG4gICAgICAgIHRvU3RyaW5nOiBjb25zdGFudCgnbm9uZSgpJylcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWU7XG4gICAgfSgpO1xuICAgIHZhciBzb21lID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIHZhciBjb25zdGFudF9hID0gY29uc3RhbnQoYSk7XG4gICAgICB2YXIgc2VsZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG1lO1xuICAgICAgfTtcbiAgICAgIHZhciBiaW5kID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYoYSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBmb2xkOiBmdW5jdGlvbiAobiwgcykge1xuICAgICAgICAgIHJldHVybiBzKGEpO1xuICAgICAgICB9LFxuICAgICAgICBpczogZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICByZXR1cm4gYSA9PT0gdjtcbiAgICAgICAgfSxcbiAgICAgICAgaXNTb21lOiBhbHdheXMsXG4gICAgICAgIGlzTm9uZTogbmV2ZXIsXG4gICAgICAgIGdldE9yOiBjb25zdGFudF9hLFxuICAgICAgICBnZXRPclRodW5rOiBjb25zdGFudF9hLFxuICAgICAgICBnZXRPckRpZTogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JOdWxsOiBjb25zdGFudF9hLFxuICAgICAgICBnZXRPclVuZGVmaW5lZDogY29uc3RhbnRfYSxcbiAgICAgICAgb3I6IHNlbGYsXG4gICAgICAgIG9yVGh1bms6IHNlbGYsXG4gICAgICAgIG1hcDogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gc29tZShmKGEpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZWFjaDogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICBmKGEpO1xuICAgICAgICB9LFxuICAgICAgICBiaW5kOiBiaW5kLFxuICAgICAgICBleGlzdHM6IGJpbmQsXG4gICAgICAgIGZvcmFsbDogYmluZCxcbiAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiAoZikge1xuICAgICAgICAgIHJldHVybiBmKGEpID8gbWUgOiBOT05FO1xuICAgICAgICB9LFxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFthXTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gJ3NvbWUoJyArIGEgKyAnKSc7XG4gICAgICAgIH0sXG4gICAgICAgIGVxdWFsczogZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICByZXR1cm4gby5pcyhhKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXF1YWxzXzogZnVuY3Rpb24gKG8sIGVsZW1lbnRFcSkge1xuICAgICAgICAgIHJldHVybiBvLmZvbGQobmV2ZXIsIGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudEVxKGEsIGIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH07XG4gICAgdmFyIGZyb20gPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gTk9ORSA6IHNvbWUodmFsdWUpO1xuICAgIH07XG4gICAgdmFyIE9wdGlvbmFsID0ge1xuICAgICAgc29tZTogc29tZSxcbiAgICAgIG5vbmU6IG5vbmUsXG4gICAgICBmcm9tOiBmcm9tXG4gICAgfTtcblxuICAgIHZhciBuYXRpdmVTbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcbiAgICB2YXIgbmF0aXZlUHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICAgIHZhciBtYXAgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHZhciBsZW4gPSB4cy5sZW5ndGg7XG4gICAgICB2YXIgciA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICByW2ldID0gZih4LCBpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBmKHgsIGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGZpbHRlciA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBpZiAocHJlZCh4LCBpKSkge1xuICAgICAgICAgIHIucHVzaCh4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZ3JvdXBCeSA9IGZ1bmN0aW9uICh4cywgZikge1xuICAgICAgaWYgKHhzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgd2FzVHlwZSA9IGYoeHNbMF0pO1xuICAgICAgICB2YXIgciA9IFtdO1xuICAgICAgICB2YXIgZ3JvdXAgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgICB2YXIgdHlwZSA9IGYoeCk7XG4gICAgICAgICAgaWYgKHR5cGUgIT09IHdhc1R5cGUpIHtcbiAgICAgICAgICAgIHIucHVzaChncm91cCk7XG4gICAgICAgICAgICBncm91cCA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB3YXNUeXBlID0gdHlwZTtcbiAgICAgICAgICBncm91cC5wdXNoKHgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChncm91cC5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICByLnB1c2goZ3JvdXApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGZvbGRsID0gZnVuY3Rpb24gKHhzLCBmLCBhY2MpIHtcbiAgICAgIGVhY2goeHMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGFjYyA9IGYoYWNjLCB4KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9O1xuICAgIHZhciBmaW5kVW50aWwgPSBmdW5jdGlvbiAoeHMsIHByZWQsIHVudGlsKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgaWYgKHByZWQoeCwgaSkpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh4KTtcbiAgICAgICAgfSBlbHNlIGlmICh1bnRpbCh4LCBpKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGZpbmQgPSBmdW5jdGlvbiAoeHMsIHByZWQpIHtcbiAgICAgIHJldHVybiBmaW5kVW50aWwoeHMsIHByZWQsIG5ldmVyKTtcbiAgICB9O1xuICAgIHZhciBmbGF0dGVuID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICB2YXIgciA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIGlmICghaXNBcnJheSh4c1tpXSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Fyci5mbGF0dGVuIGl0ZW0gJyArIGkgKyAnIHdhcyBub3QgYW4gYXJyYXksIGlucHV0OiAnICsgeHMpO1xuICAgICAgICB9XG4gICAgICAgIG5hdGl2ZVB1c2guYXBwbHkociwgeHNbaV0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgYmluZCA9IGZ1bmN0aW9uICh4cywgZikge1xuICAgICAgcmV0dXJuIGZsYXR0ZW4obWFwKHhzLCBmKSk7XG4gICAgfTtcbiAgICB2YXIgcmV2ZXJzZSA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHIgPSBuYXRpdmVTbGljZS5jYWxsKHhzLCAwKTtcbiAgICAgIHIucmV2ZXJzZSgpO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKHhzLCBpKSB7XG4gICAgICByZXR1cm4gaSA+PSAwICYmIGkgPCB4cy5sZW5ndGggPyBPcHRpb25hbC5zb21lKHhzW2ldKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBoZWFkID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICByZXR1cm4gZ2V0KHhzLCAwKTtcbiAgICB9O1xuICAgIHZhciBsYXN0ID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICByZXR1cm4gZ2V0KHhzLCB4cy5sZW5ndGggLSAxKTtcbiAgICB9O1xuXG4gICAgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpXG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH07XG4gICAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXlzKCkge1xuICAgICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKVxuICAgICAgICBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfVxuXG4gICAgdmFyIGNhY2hlZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICB2YXIgY2FsbGVkID0gZmFsc2U7XG4gICAgICB2YXIgcjtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2FsbGVkKSB7XG4gICAgICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgICAgICByID0gZi5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcjtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBEZXZpY2VUeXBlID0gZnVuY3Rpb24gKG9zLCBicm93c2VyLCB1c2VyQWdlbnQsIG1lZGlhTWF0Y2gpIHtcbiAgICAgIHZhciBpc2lQYWQgPSBvcy5pc2lPUygpICYmIC9pcGFkL2kudGVzdCh1c2VyQWdlbnQpID09PSB0cnVlO1xuICAgICAgdmFyIGlzaVBob25lID0gb3MuaXNpT1MoKSAmJiAhaXNpUGFkO1xuICAgICAgdmFyIGlzTW9iaWxlID0gb3MuaXNpT1MoKSB8fCBvcy5pc0FuZHJvaWQoKTtcbiAgICAgIHZhciBpc1RvdWNoID0gaXNNb2JpbGUgfHwgbWVkaWFNYXRjaCgnKHBvaW50ZXI6Y29hcnNlKScpO1xuICAgICAgdmFyIGlzVGFibGV0ID0gaXNpUGFkIHx8ICFpc2lQaG9uZSAmJiBpc01vYmlsZSAmJiBtZWRpYU1hdGNoKCcobWluLWRldmljZS13aWR0aDo3NjhweCknKTtcbiAgICAgIHZhciBpc1Bob25lID0gaXNpUGhvbmUgfHwgaXNNb2JpbGUgJiYgIWlzVGFibGV0O1xuICAgICAgdmFyIGlPU3dlYnZpZXcgPSBicm93c2VyLmlzU2FmYXJpKCkgJiYgb3MuaXNpT1MoKSAmJiAvc2FmYXJpL2kudGVzdCh1c2VyQWdlbnQpID09PSBmYWxzZTtcbiAgICAgIHZhciBpc0Rlc2t0b3AgPSAhaXNQaG9uZSAmJiAhaXNUYWJsZXQgJiYgIWlPU3dlYnZpZXc7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc2lQYWQ6IGNvbnN0YW50KGlzaVBhZCksXG4gICAgICAgIGlzaVBob25lOiBjb25zdGFudChpc2lQaG9uZSksXG4gICAgICAgIGlzVGFibGV0OiBjb25zdGFudChpc1RhYmxldCksXG4gICAgICAgIGlzUGhvbmU6IGNvbnN0YW50KGlzUGhvbmUpLFxuICAgICAgICBpc1RvdWNoOiBjb25zdGFudChpc1RvdWNoKSxcbiAgICAgICAgaXNBbmRyb2lkOiBvcy5pc0FuZHJvaWQsXG4gICAgICAgIGlzaU9TOiBvcy5pc2lPUyxcbiAgICAgICAgaXNXZWJWaWV3OiBjb25zdGFudChpT1N3ZWJ2aWV3KSxcbiAgICAgICAgaXNEZXNrdG9wOiBjb25zdGFudChpc0Rlc2t0b3ApXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZmlyc3RNYXRjaCA9IGZ1bmN0aW9uIChyZWdleGVzLCBzKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlZ2V4ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSByZWdleGVzW2ldO1xuICAgICAgICBpZiAoeC50ZXN0KHMpKSB7XG4gICAgICAgICAgcmV0dXJuIHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICB2YXIgZmluZCQxID0gZnVuY3Rpb24gKHJlZ2V4ZXMsIGFnZW50KSB7XG4gICAgICB2YXIgciA9IGZpcnN0TWF0Y2gocmVnZXhlcywgYWdlbnQpO1xuICAgICAgaWYgKCFyKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbWFqb3I6IDAsXG4gICAgICAgICAgbWlub3I6IDBcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHZhciBncm91cCA9IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHJldHVybiBOdW1iZXIoYWdlbnQucmVwbGFjZShyLCAnJCcgKyBpKSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG51KGdyb3VwKDEpLCBncm91cCgyKSk7XG4gICAgfTtcbiAgICB2YXIgZGV0ZWN0ID0gZnVuY3Rpb24gKHZlcnNpb25SZWdleGVzLCBhZ2VudCkge1xuICAgICAgdmFyIGNsZWFuZWRBZ2VudCA9IFN0cmluZyhhZ2VudCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmICh2ZXJzaW9uUmVnZXhlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHVua25vd24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmaW5kJDEodmVyc2lvblJlZ2V4ZXMsIGNsZWFuZWRBZ2VudCk7XG4gICAgfTtcbiAgICB2YXIgdW5rbm93biA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBudSgwLCAwKTtcbiAgICB9O1xuICAgIHZhciBudSA9IGZ1bmN0aW9uIChtYWpvciwgbWlub3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1ham9yOiBtYWpvcixcbiAgICAgICAgbWlub3I6IG1pbm9yXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFZlcnNpb24gPSB7XG4gICAgICBudTogbnUsXG4gICAgICBkZXRlY3Q6IGRldGVjdCxcbiAgICAgIHVua25vd246IHVua25vd25cbiAgICB9O1xuXG4gICAgdmFyIGRldGVjdCQxID0gZnVuY3Rpb24gKGNhbmRpZGF0ZXMsIHVzZXJBZ2VudCkge1xuICAgICAgdmFyIGFnZW50ID0gU3RyaW5nKHVzZXJBZ2VudCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiBmaW5kKGNhbmRpZGF0ZXMsIGZ1bmN0aW9uIChjYW5kaWRhdGUpIHtcbiAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZS5zZWFyY2goYWdlbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZGV0ZWN0QnJvd3NlciA9IGZ1bmN0aW9uIChicm93c2VycywgdXNlckFnZW50KSB7XG4gICAgICByZXR1cm4gZGV0ZWN0JDEoYnJvd3NlcnMsIHVzZXJBZ2VudCkubWFwKGZ1bmN0aW9uIChicm93c2VyKSB7XG4gICAgICAgIHZhciB2ZXJzaW9uID0gVmVyc2lvbi5kZXRlY3QoYnJvd3Nlci52ZXJzaW9uUmVnZXhlcywgdXNlckFnZW50KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjdXJyZW50OiBicm93c2VyLm5hbWUsXG4gICAgICAgICAgdmVyc2lvbjogdmVyc2lvblxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZGV0ZWN0T3MgPSBmdW5jdGlvbiAob3NlcywgdXNlckFnZW50KSB7XG4gICAgICByZXR1cm4gZGV0ZWN0JDEob3NlcywgdXNlckFnZW50KS5tYXAoZnVuY3Rpb24gKG9zKSB7XG4gICAgICAgIHZhciB2ZXJzaW9uID0gVmVyc2lvbi5kZXRlY3Qob3MudmVyc2lvblJlZ2V4ZXMsIHVzZXJBZ2VudCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY3VycmVudDogb3MubmFtZSxcbiAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBVYVN0cmluZyA9IHtcbiAgICAgIGRldGVjdEJyb3dzZXI6IGRldGVjdEJyb3dzZXIsXG4gICAgICBkZXRlY3RPczogZGV0ZWN0T3NcbiAgICB9O1xuXG4gICAgdmFyIGNvbnRhaW5zID0gZnVuY3Rpb24gKHN0ciwgc3Vic3RyKSB7XG4gICAgICByZXR1cm4gc3RyLmluZGV4T2Yoc3Vic3RyKSAhPT0gLTE7XG4gICAgfTtcbiAgICB2YXIgYmxhbmsgPSBmdW5jdGlvbiAocikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzLnJlcGxhY2UociwgJycpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0cmltID0gYmxhbmsoL15cXHMrfFxccyskL2cpO1xuICAgIHZhciBpc05vdEVtcHR5ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgIHJldHVybiBzLmxlbmd0aCA+IDA7XG4gICAgfTtcbiAgICB2YXIgaXNFbXB0eSA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICByZXR1cm4gIWlzTm90RW1wdHkocyk7XG4gICAgfTtcblxuICAgIHZhciBub3JtYWxWZXJzaW9uUmVnZXggPSAvLio/dmVyc2lvblxcL1xcID8oWzAtOV0rKVxcLihbMC05XSspLiovO1xuICAgIHZhciBjaGVja0NvbnRhaW5zID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh1YXN0cmluZykge1xuICAgICAgICByZXR1cm4gY29udGFpbnModWFzdHJpbmcsIHRhcmdldCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGJyb3dzZXJzID0gW1xuICAgICAge1xuICAgICAgICBuYW1lOiAnRWRnZScsXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2VkZ2VcXC8gPyhbMC05XSspXFwuKFswLTldKykkL10sXG4gICAgICAgIHNlYXJjaDogZnVuY3Rpb24gKHVhc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5zKHVhc3RyaW5nLCAnZWRnZS8nKSAmJiBjb250YWlucyh1YXN0cmluZywgJ2Nocm9tZScpICYmIGNvbnRhaW5zKHVhc3RyaW5nLCAnc2FmYXJpJykgJiYgY29udGFpbnModWFzdHJpbmcsICdhcHBsZXdlYmtpdCcpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnQ2hyb21lJyxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtcbiAgICAgICAgICAvLio/Y2hyb21lXFwvKFswLTldKylcXC4oWzAtOV0rKS4qLyxcbiAgICAgICAgICBub3JtYWxWZXJzaW9uUmVnZXhcbiAgICAgICAgXSxcbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbnModWFzdHJpbmcsICdjaHJvbWUnKSAmJiAhY29udGFpbnModWFzdHJpbmcsICdjaHJvbWVmcmFtZScpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnSUUnLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIC8uKj9tc2llXFwgPyhbMC05XSspXFwuKFswLTldKykuKi8sXG4gICAgICAgICAgLy4qP3J2OihbMC05XSspXFwuKFswLTldKykuKi9cbiAgICAgICAgXSxcbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbnModWFzdHJpbmcsICdtc2llJykgfHwgY29udGFpbnModWFzdHJpbmcsICd0cmlkZW50Jyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdPcGVyYScsXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXG4gICAgICAgICAgbm9ybWFsVmVyc2lvblJlZ2V4LFxuICAgICAgICAgIC8uKj9vcGVyYVxcLyhbMC05XSspXFwuKFswLTldKykuKi9cbiAgICAgICAgXSxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdvcGVyYScpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnRmlyZWZveCcsXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2ZpcmVmb3hcXC9cXCA/KFswLTldKylcXC4oWzAtOV0rKS4qL10sXG4gICAgICAgIHNlYXJjaDogY2hlY2tDb250YWlucygnZmlyZWZveCcpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnU2FmYXJpJyxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtcbiAgICAgICAgICBub3JtYWxWZXJzaW9uUmVnZXgsXG4gICAgICAgICAgLy4qP2NwdSBvcyAoWzAtOV0rKV8oWzAtOV0rKS4qL1xuICAgICAgICBdLFxuICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uICh1YXN0cmluZykge1xuICAgICAgICAgIHJldHVybiAoY29udGFpbnModWFzdHJpbmcsICdzYWZhcmknKSB8fCBjb250YWlucyh1YXN0cmluZywgJ21vYmlsZS8nKSkgJiYgY29udGFpbnModWFzdHJpbmcsICdhcHBsZXdlYmtpdCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgXTtcbiAgICB2YXIgb3NlcyA9IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1dpbmRvd3MnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ3dpbicpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj93aW5kb3dzXFwgbnRcXCA/KFswLTldKylcXC4oWzAtOV0rKS4qL11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdpT1MnLFxuICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uICh1YXN0cmluZykge1xuICAgICAgICAgIHJldHVybiBjb250YWlucyh1YXN0cmluZywgJ2lwaG9uZScpIHx8IGNvbnRhaW5zKHVhc3RyaW5nLCAnaXBhZCcpO1xuICAgICAgICB9LFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIC8uKj92ZXJzaW9uXFwvXFwgPyhbMC05XSspXFwuKFswLTldKykuKi8sXG4gICAgICAgICAgLy4qY3B1IG9zIChbMC05XSspXyhbMC05XSspLiovLFxuICAgICAgICAgIC8uKmNwdSBpcGhvbmUgb3MgKFswLTldKylfKFswLTldKykuKi9cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0FuZHJvaWQnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ2FuZHJvaWQnKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/YW5kcm9pZFxcID8oWzAtOV0rKVxcLihbMC05XSspLiovXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ09TWCcsXG4gICAgICAgIHNlYXJjaDogY2hlY2tDb250YWlucygnbWFjIG9zIHgnKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/bWFjXFwgb3NcXCB4XFwgPyhbMC05XSspXyhbMC05XSspLiovXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0xpbnV4JyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdsaW51eCcpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdTb2xhcmlzJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdzdW5vcycpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdGcmVlQlNEJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdmcmVlYnNkJyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0Nocm9tZU9TJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdjcm9zJyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2Nocm9tZVxcLyhbMC05XSspXFwuKFswLTldKykuKi9dXG4gICAgICB9XG4gICAgXTtcbiAgICB2YXIgUGxhdGZvcm1JbmZvID0ge1xuICAgICAgYnJvd3NlcnM6IGNvbnN0YW50KGJyb3dzZXJzKSxcbiAgICAgIG9zZXM6IGNvbnN0YW50KG9zZXMpXG4gICAgfTtcblxuICAgIHZhciBlZGdlID0gJ0VkZ2UnO1xuICAgIHZhciBjaHJvbWUgPSAnQ2hyb21lJztcbiAgICB2YXIgaWUgPSAnSUUnO1xuICAgIHZhciBvcGVyYSA9ICdPcGVyYSc7XG4gICAgdmFyIGZpcmVmb3ggPSAnRmlyZWZveCc7XG4gICAgdmFyIHNhZmFyaSA9ICdTYWZhcmknO1xuICAgIHZhciB1bmtub3duJDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbnUkMSh7XG4gICAgICAgIGN1cnJlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdmVyc2lvbjogVmVyc2lvbi51bmtub3duKClcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG51JDEgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgdmFyIGN1cnJlbnQgPSBpbmZvLmN1cnJlbnQ7XG4gICAgICB2YXIgdmVyc2lvbiA9IGluZm8udmVyc2lvbjtcbiAgICAgIHZhciBpc0Jyb3dzZXIgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50ID09PSBuYW1lO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnQ6IGN1cnJlbnQsXG4gICAgICAgIHZlcnNpb246IHZlcnNpb24sXG4gICAgICAgIGlzRWRnZTogaXNCcm93c2VyKGVkZ2UpLFxuICAgICAgICBpc0Nocm9tZTogaXNCcm93c2VyKGNocm9tZSksXG4gICAgICAgIGlzSUU6IGlzQnJvd3NlcihpZSksXG4gICAgICAgIGlzT3BlcmE6IGlzQnJvd3NlcihvcGVyYSksXG4gICAgICAgIGlzRmlyZWZveDogaXNCcm93c2VyKGZpcmVmb3gpLFxuICAgICAgICBpc1NhZmFyaTogaXNCcm93c2VyKHNhZmFyaSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgQnJvd3NlciA9IHtcbiAgICAgIHVua25vd246IHVua25vd24kMSxcbiAgICAgIG51OiBudSQxLFxuICAgICAgZWRnZTogY29uc3RhbnQoZWRnZSksXG4gICAgICBjaHJvbWU6IGNvbnN0YW50KGNocm9tZSksXG4gICAgICBpZTogY29uc3RhbnQoaWUpLFxuICAgICAgb3BlcmE6IGNvbnN0YW50KG9wZXJhKSxcbiAgICAgIGZpcmVmb3g6IGNvbnN0YW50KGZpcmVmb3gpLFxuICAgICAgc2FmYXJpOiBjb25zdGFudChzYWZhcmkpXG4gICAgfTtcblxuICAgIHZhciB3aW5kb3dzID0gJ1dpbmRvd3MnO1xuICAgIHZhciBpb3MgPSAnaU9TJztcbiAgICB2YXIgYW5kcm9pZCA9ICdBbmRyb2lkJztcbiAgICB2YXIgbGludXggPSAnTGludXgnO1xuICAgIHZhciBvc3ggPSAnT1NYJztcbiAgICB2YXIgc29sYXJpcyA9ICdTb2xhcmlzJztcbiAgICB2YXIgZnJlZWJzZCA9ICdGcmVlQlNEJztcbiAgICB2YXIgY2hyb21lb3MgPSAnQ2hyb21lT1MnO1xuICAgIHZhciB1bmtub3duJDIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbnUkMih7XG4gICAgICAgIGN1cnJlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdmVyc2lvbjogVmVyc2lvbi51bmtub3duKClcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG51JDIgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgdmFyIGN1cnJlbnQgPSBpbmZvLmN1cnJlbnQ7XG4gICAgICB2YXIgdmVyc2lvbiA9IGluZm8udmVyc2lvbjtcbiAgICAgIHZhciBpc09TID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudCA9PT0gbmFtZTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjdXJyZW50OiBjdXJyZW50LFxuICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICBpc1dpbmRvd3M6IGlzT1Mod2luZG93cyksXG4gICAgICAgIGlzaU9TOiBpc09TKGlvcyksXG4gICAgICAgIGlzQW5kcm9pZDogaXNPUyhhbmRyb2lkKSxcbiAgICAgICAgaXNPU1g6IGlzT1Mob3N4KSxcbiAgICAgICAgaXNMaW51eDogaXNPUyhsaW51eCksXG4gICAgICAgIGlzU29sYXJpczogaXNPUyhzb2xhcmlzKSxcbiAgICAgICAgaXNGcmVlQlNEOiBpc09TKGZyZWVic2QpLFxuICAgICAgICBpc0Nocm9tZU9TOiBpc09TKGNocm9tZW9zKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBPcGVyYXRpbmdTeXN0ZW0gPSB7XG4gICAgICB1bmtub3duOiB1bmtub3duJDIsXG4gICAgICBudTogbnUkMixcbiAgICAgIHdpbmRvd3M6IGNvbnN0YW50KHdpbmRvd3MpLFxuICAgICAgaW9zOiBjb25zdGFudChpb3MpLFxuICAgICAgYW5kcm9pZDogY29uc3RhbnQoYW5kcm9pZCksXG4gICAgICBsaW51eDogY29uc3RhbnQobGludXgpLFxuICAgICAgb3N4OiBjb25zdGFudChvc3gpLFxuICAgICAgc29sYXJpczogY29uc3RhbnQoc29sYXJpcyksXG4gICAgICBmcmVlYnNkOiBjb25zdGFudChmcmVlYnNkKSxcbiAgICAgIGNocm9tZW9zOiBjb25zdGFudChjaHJvbWVvcylcbiAgICB9O1xuXG4gICAgdmFyIGRldGVjdCQyID0gZnVuY3Rpb24gKHVzZXJBZ2VudCwgbWVkaWFNYXRjaCkge1xuICAgICAgdmFyIGJyb3dzZXJzID0gUGxhdGZvcm1JbmZvLmJyb3dzZXJzKCk7XG4gICAgICB2YXIgb3NlcyA9IFBsYXRmb3JtSW5mby5vc2VzKCk7XG4gICAgICB2YXIgYnJvd3NlciA9IFVhU3RyaW5nLmRldGVjdEJyb3dzZXIoYnJvd3NlcnMsIHVzZXJBZ2VudCkuZm9sZChCcm93c2VyLnVua25vd24sIEJyb3dzZXIubnUpO1xuICAgICAgdmFyIG9zID0gVWFTdHJpbmcuZGV0ZWN0T3Mob3NlcywgdXNlckFnZW50KS5mb2xkKE9wZXJhdGluZ1N5c3RlbS51bmtub3duLCBPcGVyYXRpbmdTeXN0ZW0ubnUpO1xuICAgICAgdmFyIGRldmljZVR5cGUgPSBEZXZpY2VUeXBlKG9zLCBicm93c2VyLCB1c2VyQWdlbnQsIG1lZGlhTWF0Y2gpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYnJvd3NlcjogYnJvd3NlcixcbiAgICAgICAgb3M6IG9zLFxuICAgICAgICBkZXZpY2VUeXBlOiBkZXZpY2VUeXBlXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFBsYXRmb3JtRGV0ZWN0aW9uID0geyBkZXRlY3Q6IGRldGVjdCQyIH07XG5cbiAgICB2YXIgbWVkaWFNYXRjaCA9IGZ1bmN0aW9uIChxdWVyeSkge1xuICAgICAgcmV0dXJuIHdpbmRvdy5tYXRjaE1lZGlhKHF1ZXJ5KS5tYXRjaGVzO1xuICAgIH07XG4gICAgdmFyIHBsYXRmb3JtID0gY2FjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBQbGF0Zm9ybURldGVjdGlvbi5kZXRlY3QobmF2aWdhdG9yLnVzZXJBZ2VudCwgbWVkaWFNYXRjaCk7XG4gICAgfSk7XG4gICAgdmFyIGRldGVjdCQzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHBsYXRmb3JtKCk7XG4gICAgfTtcblxuICAgIHZhciBjb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA9IGZ1bmN0aW9uIChhLCBiLCBtYXRjaCkge1xuICAgICAgcmV0dXJuIChhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgbWF0Y2gpICE9PSAwO1xuICAgIH07XG4gICAgdmFyIGRvY3VtZW50UG9zaXRpb25Db250YWluZWRCeSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gY29tcGFyZURvY3VtZW50UG9zaXRpb24oYSwgYiwgTm9kZS5ET0NVTUVOVF9QT1NJVElPTl9DT05UQUlORURfQlkpO1xuICAgIH07XG5cbiAgICB2YXIgRUxFTUVOVCA9IDE7XG5cbiAgICB2YXIgZnJvbUh0bWwgPSBmdW5jdGlvbiAoaHRtbCwgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBkaXYgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBkaXYuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgIGlmICghZGl2Lmhhc0NoaWxkTm9kZXMoKSB8fCBkaXYuY2hpbGROb2Rlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0hUTUwgZG9lcyBub3QgaGF2ZSBhIHNpbmdsZSByb290IG5vZGUnLCBodG1sKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIVE1MIG11c3QgaGF2ZSBhIHNpbmdsZSByb290IG5vZGUnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmcm9tRG9tKGRpdi5jaGlsZE5vZGVzWzBdKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGFnID0gZnVuY3Rpb24gKHRhZywgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBub2RlID0gZG9jLmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgIHJldHVybiBmcm9tRG9tKG5vZGUpO1xuICAgIH07XG4gICAgdmFyIGZyb21UZXh0ID0gZnVuY3Rpb24gKHRleHQsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgbm9kZSA9IGRvYy5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcbiAgICAgIHJldHVybiBmcm9tRG9tKG5vZGUpO1xuICAgIH07XG4gICAgdmFyIGZyb21Eb20gPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm9kZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IGRvbTogbm9kZSB9O1xuICAgIH07XG4gICAgdmFyIGZyb21Qb2ludCA9IGZ1bmN0aW9uIChkb2NFbG0sIHgsIHkpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGRvY0VsbS5kb20uZWxlbWVudEZyb21Qb2ludCh4LCB5KSkubWFwKGZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIFN1Z2FyRWxlbWVudCA9IHtcbiAgICAgIGZyb21IdG1sOiBmcm9tSHRtbCxcbiAgICAgIGZyb21UYWc6IGZyb21UYWcsXG4gICAgICBmcm9tVGV4dDogZnJvbVRleHQsXG4gICAgICBmcm9tRG9tOiBmcm9tRG9tLFxuICAgICAgZnJvbVBvaW50OiBmcm9tUG9pbnRcbiAgICB9O1xuXG4gICAgdmFyIGlzID0gZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBpZiAoZG9tLm5vZGVUeXBlICE9PSBFTEVNRU5UKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBlbGVtID0gZG9tO1xuICAgICAgICBpZiAoZWxlbS5tYXRjaGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbS5tYXRjaGVzKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLm1zTWF0Y2hlc1NlbGVjdG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbS5tc01hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLndlYmtpdE1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbS5tb3pNYXRjaGVzU2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLm1vek1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCcm93c2VyIGxhY2tzIG5hdGl2ZSBzZWxlY3RvcnMnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZXEgPSBmdW5jdGlvbiAoZTEsIGUyKSB7XG4gICAgICByZXR1cm4gZTEuZG9tID09PSBlMi5kb207XG4gICAgfTtcbiAgICB2YXIgcmVndWxhckNvbnRhaW5zID0gZnVuY3Rpb24gKGUxLCBlMikge1xuICAgICAgdmFyIGQxID0gZTEuZG9tO1xuICAgICAgdmFyIGQyID0gZTIuZG9tO1xuICAgICAgcmV0dXJuIGQxID09PSBkMiA/IGZhbHNlIDogZDEuY29udGFpbnMoZDIpO1xuICAgIH07XG4gICAgdmFyIGllQ29udGFpbnMgPSBmdW5jdGlvbiAoZTEsIGUyKSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnRQb3NpdGlvbkNvbnRhaW5lZEJ5KGUxLmRvbSwgZTIuZG9tKTtcbiAgICB9O1xuICAgIHZhciBjb250YWlucyQxID0gZnVuY3Rpb24gKGUxLCBlMikge1xuICAgICAgcmV0dXJuIGRldGVjdCQzKCkuYnJvd3Nlci5pc0lFKCkgPyBpZUNvbnRhaW5zKGUxLCBlMikgOiByZWd1bGFyQ29udGFpbnMoZTEsIGUyKTtcbiAgICB9O1xuICAgIHZhciBpcyQxID0gaXM7XG5cbiAgICB2YXIgZ2xvYmFsJDEgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5kb20uUmFuZ2VVdGlscycpO1xuXG4gICAgdmFyIGdsb2JhbCQyID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuZG9tLlRyZWVXYWxrZXInKTtcblxuICAgIHZhciBnbG9iYWwkMyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVksnKTtcblxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXM7XG4gICAgdmFyIGVhY2gkMSA9IGZ1bmN0aW9uIChvYmosIGYpIHtcbiAgICAgIHZhciBwcm9wcyA9IGtleXMob2JqKTtcbiAgICAgIGZvciAodmFyIGsgPSAwLCBsZW4gPSBwcm9wcy5sZW5ndGg7IGsgPCBsZW47IGsrKykge1xuICAgICAgICB2YXIgaSA9IHByb3BzW2tdO1xuICAgICAgICB2YXIgeCA9IG9ialtpXTtcbiAgICAgICAgZih4LCBpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBvYmpBY2MgPSBmdW5jdGlvbiAocikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh4LCBpKSB7XG4gICAgICAgIHJbaV0gPSB4O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpbnRlcm5hbEZpbHRlciA9IGZ1bmN0aW9uIChvYmosIHByZWQsIG9uVHJ1ZSwgb25GYWxzZSkge1xuICAgICAgdmFyIHIgPSB7fTtcbiAgICAgIGVhY2gkMShvYmosIGZ1bmN0aW9uICh4LCBpKSB7XG4gICAgICAgIChwcmVkKHgsIGkpID8gb25UcnVlIDogb25GYWxzZSkoeCwgaSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGZpbHRlciQxID0gZnVuY3Rpb24gKG9iaiwgcHJlZCkge1xuICAgICAgdmFyIHQgPSB7fTtcbiAgICAgIGludGVybmFsRmlsdGVyKG9iaiwgcHJlZCwgb2JqQWNjKHQpLCBub29wKTtcbiAgICAgIHJldHVybiB0O1xuICAgIH07XG5cbiAgICB2YXIgR2xvYmFsID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBGdW5jdGlvbigncmV0dXJuIHRoaXM7JykoKTtcblxuICAgIHZhciBuYW1lID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciByID0gZWxlbWVudC5kb20ubm9kZU5hbWU7XG4gICAgICByZXR1cm4gci50b0xvd2VyQ2FzZSgpO1xuICAgIH07XG4gICAgdmFyIHR5cGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLm5vZGVUeXBlO1xuICAgIH07XG4gICAgdmFyIGlzVHlwZSQxID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdHlwZShlbGVtZW50KSA9PT0gdDtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNFbGVtZW50ID0gaXNUeXBlJDEoRUxFTUVOVCk7XG5cbiAgICB2YXIgcmF3U2V0ID0gZnVuY3Rpb24gKGRvbSwga2V5LCB2YWx1ZSkge1xuICAgICAgaWYgKGlzU3RyaW5nKHZhbHVlKSB8fCBpc0Jvb2xlYW4odmFsdWUpIHx8IGlzTnVtYmVyKHZhbHVlKSkge1xuICAgICAgICBkb20uc2V0QXR0cmlidXRlKGtleSwgdmFsdWUgKyAnJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGNhbGwgdG8gQXR0cmlidXRlLnNldC4gS2V5ICcsIGtleSwgJzo6IFZhbHVlICcsIHZhbHVlLCAnOjogRWxlbWVudCAnLCBkb20pO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F0dHJpYnV0ZSB2YWx1ZSB3YXMgbm90IHNpbXBsZScpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHNldEFsbCA9IGZ1bmN0aW9uIChlbGVtZW50LCBhdHRycykge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgZWFjaCQxKGF0dHJzLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICByYXdTZXQoZG9tLCBrLCB2KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNsb25lID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBmb2xkbChlbGVtZW50LmRvbS5hdHRyaWJ1dGVzLCBmdW5jdGlvbiAoYWNjLCBhdHRyKSB7XG4gICAgICAgIGFjY1thdHRyLm5hbWVdID0gYXR0ci52YWx1ZTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sIHt9KTtcbiAgICB9O1xuXG4gICAgdmFyIHBhcmVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShlbGVtZW50LmRvbS5wYXJlbnROb2RlKS5tYXAoU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIGNoaWxkcmVuID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBtYXAoZWxlbWVudC5kb20uY2hpbGROb2RlcywgU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIGNoaWxkID0gZnVuY3Rpb24gKGVsZW1lbnQsIGluZGV4KSB7XG4gICAgICB2YXIgY3MgPSBlbGVtZW50LmRvbS5jaGlsZE5vZGVzO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oY3NbaW5kZXhdKS5tYXAoU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIGZpcnN0Q2hpbGQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGNoaWxkKGVsZW1lbnQsIDApO1xuICAgIH07XG4gICAgdmFyIGxhc3RDaGlsZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gY2hpbGQoZWxlbWVudCwgZWxlbWVudC5kb20uY2hpbGROb2Rlcy5sZW5ndGggLSAxKTtcbiAgICB9O1xuXG4gICAgdmFyIGJlZm9yZSA9IGZ1bmN0aW9uIChtYXJrZXIsIGVsZW1lbnQpIHtcbiAgICAgIHZhciBwYXJlbnQkMSA9IHBhcmVudChtYXJrZXIpO1xuICAgICAgcGFyZW50JDEuZWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICB2LmRvbS5pbnNlcnRCZWZvcmUoZWxlbWVudC5kb20sIG1hcmtlci5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXBwZW5kID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudCkge1xuICAgICAgcGFyZW50LmRvbS5hcHBlbmRDaGlsZChlbGVtZW50LmRvbSk7XG4gICAgfTtcblxuICAgIHZhciBiZWZvcmUkMSA9IGZ1bmN0aW9uIChtYXJrZXIsIGVsZW1lbnRzKSB7XG4gICAgICBlYWNoKGVsZW1lbnRzLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBiZWZvcmUobWFya2VyLCB4KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFwcGVuZCQxID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudHMpIHtcbiAgICAgIGVhY2goZWxlbWVudHMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGFwcGVuZChwYXJlbnQsIHgpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZW1vdmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgaWYgKGRvbS5wYXJlbnROb2RlICE9PSBudWxsKSB7XG4gICAgICAgIGRvbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRvbSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBjbG9uZSQxID0gZnVuY3Rpb24gKG9yaWdpbmFsLCBpc0RlZXApIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShvcmlnaW5hbC5kb20uY2xvbmVOb2RlKGlzRGVlcCkpO1xuICAgIH07XG4gICAgdmFyIGRlZXAgPSBmdW5jdGlvbiAob3JpZ2luYWwpIHtcbiAgICAgIHJldHVybiBjbG9uZSQxKG9yaWdpbmFsLCB0cnVlKTtcbiAgICB9O1xuICAgIHZhciBzaGFsbG93QXMgPSBmdW5jdGlvbiAob3JpZ2luYWwsIHRhZykge1xuICAgICAgdmFyIG51ID0gU3VnYXJFbGVtZW50LmZyb21UYWcodGFnKTtcbiAgICAgIHZhciBhdHRyaWJ1dGVzID0gY2xvbmUob3JpZ2luYWwpO1xuICAgICAgc2V0QWxsKG51LCBhdHRyaWJ1dGVzKTtcbiAgICAgIHJldHVybiBudTtcbiAgICB9O1xuICAgIHZhciBtdXRhdGUgPSBmdW5jdGlvbiAob3JpZ2luYWwsIHRhZykge1xuICAgICAgdmFyIG51ID0gc2hhbGxvd0FzKG9yaWdpbmFsLCB0YWcpO1xuICAgICAgYmVmb3JlKG9yaWdpbmFsLCBudSk7XG4gICAgICB2YXIgY2hpbGRyZW4kMSA9IGNoaWxkcmVuKG9yaWdpbmFsKTtcbiAgICAgIGFwcGVuZCQxKG51LCBjaGlsZHJlbiQxKTtcbiAgICAgIHJlbW92ZShvcmlnaW5hbCk7XG4gICAgICByZXR1cm4gbnU7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkNCA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5ET01VdGlscycpO1xuXG4gICAgdmFyIGdsb2JhbCQ1ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5Ub29scycpO1xuXG4gICAgdmFyIG1hdGNoTm9kZU5hbWUgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlICYmIG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbWF0Y2hOb2RlTmFtZXMgPSBmdW5jdGlvbiAocmVnZXgpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICByZXR1cm4gbm9kZSAmJiByZWdleC50ZXN0KG5vZGUubm9kZU5hbWUpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1RleHROb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHJldHVybiBub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IDM7XG4gICAgfTtcbiAgICB2YXIgaXNMaXN0Tm9kZSA9IG1hdGNoTm9kZU5hbWVzKC9eKE9MfFVMfERMKSQvKTtcbiAgICB2YXIgaXNPbFVsTm9kZSA9IG1hdGNoTm9kZU5hbWVzKC9eKE9MfFVMKSQvKTtcbiAgICB2YXIgaXNPbE5vZGUgPSBtYXRjaE5vZGVOYW1lKCdvbCcpO1xuICAgIHZhciBpc0xpc3RJdGVtTm9kZSA9IG1hdGNoTm9kZU5hbWVzKC9eKExJfERUfEREKSQvKTtcbiAgICB2YXIgaXNEbEl0ZW1Ob2RlID0gbWF0Y2hOb2RlTmFtZXMoL14oRFR8REQpJC8pO1xuICAgIHZhciBpc1RhYmxlQ2VsbE5vZGUgPSBtYXRjaE5vZGVOYW1lcygvXihUSHxURCkkLyk7XG4gICAgdmFyIGlzQnIgPSBtYXRjaE5vZGVOYW1lKCdicicpO1xuICAgIHZhciBpc0ZpcnN0Q2hpbGQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUucGFyZW50Tm9kZS5maXJzdENoaWxkID09PSBub2RlO1xuICAgIH07XG4gICAgdmFyIGlzVGV4dEJsb2NrID0gZnVuY3Rpb24gKGVkaXRvciwgbm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUgJiYgISFlZGl0b3Iuc2NoZW1hLmdldFRleHRCbG9ja0VsZW1lbnRzKClbbm9kZS5ub2RlTmFtZV07XG4gICAgfTtcbiAgICB2YXIgaXNCbG9jayA9IGZ1bmN0aW9uIChub2RlLCBibG9ja0VsZW1lbnRzKSB7XG4gICAgICByZXR1cm4gbm9kZSAmJiBub2RlLm5vZGVOYW1lIGluIGJsb2NrRWxlbWVudHM7XG4gICAgfTtcbiAgICB2YXIgaXNCb2d1c0JyID0gZnVuY3Rpb24gKGRvbSwgbm9kZSkge1xuICAgICAgaWYgKCFpc0JyKG5vZGUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkb20uaXNCbG9jayhub2RlLm5leHRTaWJsaW5nKSAmJiAhaXNCcihub2RlLnByZXZpb3VzU2libGluZyk7XG4gICAgfTtcbiAgICB2YXIgaXNFbXB0eSQxID0gZnVuY3Rpb24gKGRvbSwgZWxtLCBrZWVwQm9va21hcmtzKSB7XG4gICAgICB2YXIgZW1wdHkgPSBkb20uaXNFbXB0eShlbG0pO1xuICAgICAgaWYgKGtlZXBCb29rbWFya3MgJiYgZG9tLnNlbGVjdCgnc3BhbltkYXRhLW1jZS10eXBlPWJvb2ttYXJrXScsIGVsbSkubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gZW1wdHk7XG4gICAgfTtcbiAgICB2YXIgaXNDaGlsZE9mQm9keSA9IGZ1bmN0aW9uIChkb20sIGVsbSkge1xuICAgICAgcmV0dXJuIGRvbS5pc0NoaWxkT2YoZWxtLCBkb20uZ2V0Um9vdCgpKTtcbiAgICB9O1xuXG4gICAgdmFyIHNob3VsZEluZGVudE9uVGFiID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnbGlzdHNfaW5kZW50X29uX3RhYicsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIGdldEZvcmNlZFJvb3RCbG9jayA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBibG9jayA9IGVkaXRvci5nZXRQYXJhbSgnZm9yY2VkX3Jvb3RfYmxvY2snLCAncCcpO1xuICAgICAgaWYgKGJsb2NrID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9IGVsc2UgaWYgKGJsb2NrID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiAncCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYmxvY2s7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0Rm9yY2VkUm9vdEJsb2NrQXR0cnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdmb3JjZWRfcm9vdF9ibG9ja19hdHRycycsIHt9KTtcbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZVRleHRCbG9jayA9IGZ1bmN0aW9uIChlZGl0b3IsIGNvbnRlbnROb2RlKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBibG9ja0VsZW1lbnRzID0gZWRpdG9yLnNjaGVtYS5nZXRCbG9ja0VsZW1lbnRzKCk7XG4gICAgICB2YXIgZnJhZ21lbnQgPSBkb20uY3JlYXRlRnJhZ21lbnQoKTtcbiAgICAgIHZhciBibG9ja05hbWUgPSBnZXRGb3JjZWRSb290QmxvY2soZWRpdG9yKTtcbiAgICAgIHZhciBub2RlLCB0ZXh0QmxvY2ssIGhhc0NvbnRlbnROb2RlO1xuICAgICAgaWYgKGJsb2NrTmFtZSkge1xuICAgICAgICB0ZXh0QmxvY2sgPSBkb20uY3JlYXRlKGJsb2NrTmFtZSk7XG4gICAgICAgIGlmICh0ZXh0QmxvY2sudGFnTmFtZSA9PT0gYmxvY2tOYW1lLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgICBkb20uc2V0QXR0cmlicyh0ZXh0QmxvY2ssIGdldEZvcmNlZFJvb3RCbG9ja0F0dHJzKGVkaXRvcikpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNCbG9jayhjb250ZW50Tm9kZS5maXJzdENoaWxkLCBibG9ja0VsZW1lbnRzKSkge1xuICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHRCbG9jayk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjb250ZW50Tm9kZSkge1xuICAgICAgICB3aGlsZSAobm9kZSA9IGNvbnRlbnROb2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlLm5vZGVOYW1lO1xuICAgICAgICAgIGlmICghaGFzQ29udGVudE5vZGUgJiYgKG5vZGVOYW1lICE9PSAnU1BBTicgfHwgbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLXR5cGUnKSAhPT0gJ2Jvb2ttYXJrJykpIHtcbiAgICAgICAgICAgIGhhc0NvbnRlbnROb2RlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGlzQmxvY2sobm9kZSwgYmxvY2tFbGVtZW50cykpIHtcbiAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgICAgICAgdGV4dEJsb2NrID0gbnVsbDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGJsb2NrTmFtZSkge1xuICAgICAgICAgICAgICBpZiAoIXRleHRCbG9jaykge1xuICAgICAgICAgICAgICAgIHRleHRCbG9jayA9IGRvbS5jcmVhdGUoYmxvY2tOYW1lKTtcbiAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0ZXh0QmxvY2spO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRleHRCbG9jay5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFibG9ja05hbWUpIHtcbiAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9tLmNyZWF0ZSgnYnInKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIWhhc0NvbnRlbnROb2RlKSB7XG4gICAgICAgICAgdGV4dEJsb2NrLmFwcGVuZENoaWxkKGRvbS5jcmVhdGUoJ2JyJywgeyAnZGF0YS1tY2UtYm9ndXMnOiAnMScgfSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfTtcblxuICAgIHZhciBET00gPSBnbG9iYWwkNC5ET007XG4gICAgdmFyIHNwbGl0TGlzdCA9IGZ1bmN0aW9uIChlZGl0b3IsIHVsLCBsaSkge1xuICAgICAgdmFyIHJlbW92ZUFuZEtlZXBCb29rbWFya3MgPSBmdW5jdGlvbiAodGFyZ2V0Tm9kZSkge1xuICAgICAgICBnbG9iYWwkNS5lYWNoKGJvb2ttYXJrcywgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICB0YXJnZXROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGxpLnBhcmVudE5vZGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgRE9NLnJlbW92ZSh0YXJnZXROb2RlKTtcbiAgICAgIH07XG4gICAgICB2YXIgYm9va21hcmtzID0gRE9NLnNlbGVjdCgnc3BhbltkYXRhLW1jZS10eXBlPVwiYm9va21hcmtcIl0nLCB1bCk7XG4gICAgICB2YXIgbmV3QmxvY2sgPSBjcmVhdGVUZXh0QmxvY2soZWRpdG9yLCBsaSk7XG4gICAgICB2YXIgdG1wUm5nID0gRE9NLmNyZWF0ZVJuZygpO1xuICAgICAgdG1wUm5nLnNldFN0YXJ0QWZ0ZXIobGkpO1xuICAgICAgdG1wUm5nLnNldEVuZEFmdGVyKHVsKTtcbiAgICAgIHZhciBmcmFnbWVudCA9IHRtcFJuZy5leHRyYWN0Q29udGVudHMoKTtcbiAgICAgIGZvciAodmFyIG5vZGUgPSBmcmFnbWVudC5maXJzdENoaWxkOyBub2RlOyBub2RlID0gbm9kZS5maXJzdENoaWxkKSB7XG4gICAgICAgIGlmIChub2RlLm5vZGVOYW1lID09PSAnTEknICYmIGVkaXRvci5kb20uaXNFbXB0eShub2RlKSkge1xuICAgICAgICAgIERPTS5yZW1vdmUobm9kZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghZWRpdG9yLmRvbS5pc0VtcHR5KGZyYWdtZW50KSkge1xuICAgICAgICBET00uaW5zZXJ0QWZ0ZXIoZnJhZ21lbnQsIHVsKTtcbiAgICAgIH1cbiAgICAgIERPTS5pbnNlcnRBZnRlcihuZXdCbG9jaywgdWwpO1xuICAgICAgaWYgKGlzRW1wdHkkMShlZGl0b3IuZG9tLCBsaS5wYXJlbnROb2RlKSkge1xuICAgICAgICByZW1vdmVBbmRLZWVwQm9va21hcmtzKGxpLnBhcmVudE5vZGUpO1xuICAgICAgfVxuICAgICAgRE9NLnJlbW92ZShsaSk7XG4gICAgICBpZiAoaXNFbXB0eSQxKGVkaXRvci5kb20sIHVsKSkge1xuICAgICAgICBET00ucmVtb3ZlKHVsKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIG91dGRlbnREbEl0ZW0gPSBmdW5jdGlvbiAoZWRpdG9yLCBpdGVtKSB7XG4gICAgICBpZiAoaXMkMShpdGVtLCAnZGQnKSkge1xuICAgICAgICBtdXRhdGUoaXRlbSwgJ2R0Jyk7XG4gICAgICB9IGVsc2UgaWYgKGlzJDEoaXRlbSwgJ2R0JykpIHtcbiAgICAgICAgcGFyZW50KGl0ZW0pLmVhY2goZnVuY3Rpb24gKGRsKSB7XG4gICAgICAgICAgcmV0dXJuIHNwbGl0TGlzdChlZGl0b3IsIGRsLmRvbSwgaXRlbS5kb20pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpbmRlbnREbEl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgaWYgKGlzJDEoaXRlbSwgJ2R0JykpIHtcbiAgICAgICAgbXV0YXRlKGl0ZW0sICdkZCcpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGRsSW5kZW50YXRpb24gPSBmdW5jdGlvbiAoZWRpdG9yLCBpbmRlbnRhdGlvbiwgZGxJdGVtcykge1xuICAgICAgaWYgKGluZGVudGF0aW9uID09PSAnSW5kZW50Jykge1xuICAgICAgICBlYWNoKGRsSXRlbXMsIGluZGVudERsSXRlbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlYWNoKGRsSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIG91dGRlbnREbEl0ZW0oZWRpdG9yLCBpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBnZXROb3JtYWxpemVkUG9pbnQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBvZmZzZXQpIHtcbiAgICAgIGlmIChpc1RleHROb2RlKGNvbnRhaW5lcikpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcixcbiAgICAgICAgICBvZmZzZXQ6IG9mZnNldFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdmFyIG5vZGUgPSBnbG9iYWwkMS5nZXROb2RlKGNvbnRhaW5lciwgb2Zmc2V0KTtcbiAgICAgIGlmIChpc1RleHROb2RlKG5vZGUpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29udGFpbmVyOiBub2RlLFxuICAgICAgICAgIG9mZnNldDogb2Zmc2V0ID49IGNvbnRhaW5lci5jaGlsZE5vZGVzLmxlbmd0aCA/IG5vZGUuZGF0YS5sZW5ndGggOiAwXG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKG5vZGUucHJldmlvdXNTaWJsaW5nICYmIGlzVGV4dE5vZGUobm9kZS5wcmV2aW91c1NpYmxpbmcpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29udGFpbmVyOiBub2RlLnByZXZpb3VzU2libGluZyxcbiAgICAgICAgICBvZmZzZXQ6IG5vZGUucHJldmlvdXNTaWJsaW5nLmRhdGEubGVuZ3RoXG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKG5vZGUubmV4dFNpYmxpbmcgJiYgaXNUZXh0Tm9kZShub2RlLm5leHRTaWJsaW5nKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvbnRhaW5lcjogbm9kZS5uZXh0U2libGluZyxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLFxuICAgICAgICBvZmZzZXQ6IG9mZnNldFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBub3JtYWxpemVSYW5nZSA9IGZ1bmN0aW9uIChybmcpIHtcbiAgICAgIHZhciBvdXRSbmcgPSBybmcuY2xvbmVSYW5nZSgpO1xuICAgICAgdmFyIHJhbmdlU3RhcnQgPSBnZXROb3JtYWxpemVkUG9pbnQocm5nLnN0YXJ0Q29udGFpbmVyLCBybmcuc3RhcnRPZmZzZXQpO1xuICAgICAgb3V0Um5nLnNldFN0YXJ0KHJhbmdlU3RhcnQuY29udGFpbmVyLCByYW5nZVN0YXJ0Lm9mZnNldCk7XG4gICAgICB2YXIgcmFuZ2VFbmQgPSBnZXROb3JtYWxpemVkUG9pbnQocm5nLmVuZENvbnRhaW5lciwgcm5nLmVuZE9mZnNldCk7XG4gICAgICBvdXRSbmcuc2V0RW5kKHJhbmdlRW5kLmNvbnRhaW5lciwgcmFuZ2VFbmQub2Zmc2V0KTtcbiAgICAgIHJldHVybiBvdXRSbmc7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkNiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5Eb21RdWVyeScpO1xuXG4gICAgdmFyIGdldFBhcmVudExpc3QgPSBmdW5jdGlvbiAoZWRpdG9yLCBub2RlKSB7XG4gICAgICB2YXIgc2VsZWN0aW9uU3RhcnQgPSBub2RlIHx8IGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQodHJ1ZSk7XG4gICAgICByZXR1cm4gZWRpdG9yLmRvbS5nZXRQYXJlbnQoc2VsZWN0aW9uU3RhcnQsICdPTCxVTCxETCcsIGdldENsb3Nlc3RMaXN0Um9vdEVsbShlZGl0b3IsIHNlbGVjdGlvblN0YXJ0KSk7XG4gICAgfTtcbiAgICB2YXIgaXNQYXJlbnRMaXN0U2VsZWN0ZWQgPSBmdW5jdGlvbiAocGFyZW50TGlzdCwgc2VsZWN0ZWRCbG9ja3MpIHtcbiAgICAgIHJldHVybiBwYXJlbnRMaXN0ICYmIHNlbGVjdGVkQmxvY2tzLmxlbmd0aCA9PT0gMSAmJiBzZWxlY3RlZEJsb2Nrc1swXSA9PT0gcGFyZW50TGlzdDtcbiAgICB9O1xuICAgIHZhciBmaW5kU3ViTGlzdHMgPSBmdW5jdGlvbiAocGFyZW50TGlzdCkge1xuICAgICAgcmV0dXJuIGdsb2JhbCQ1LmdyZXAocGFyZW50TGlzdC5xdWVyeVNlbGVjdG9yQWxsKCdvbCx1bCxkbCcpLCBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgIHJldHVybiBpc0xpc3ROb2RlKGVsbSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRTZWxlY3RlZFN1Ykxpc3RzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHBhcmVudExpc3QgPSBnZXRQYXJlbnRMaXN0KGVkaXRvcik7XG4gICAgICB2YXIgc2VsZWN0ZWRCbG9ja3MgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCk7XG4gICAgICBpZiAoaXNQYXJlbnRMaXN0U2VsZWN0ZWQocGFyZW50TGlzdCwgc2VsZWN0ZWRCbG9ja3MpKSB7XG4gICAgICAgIHJldHVybiBmaW5kU3ViTGlzdHMocGFyZW50TGlzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZ2xvYmFsJDUuZ3JlcChzZWxlY3RlZEJsb2NrcywgZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICAgIHJldHVybiBpc0xpc3ROb2RlKGVsbSkgJiYgcGFyZW50TGlzdCAhPT0gZWxtO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBmaW5kUGFyZW50TGlzdEl0ZW1zTm9kZXMgPSBmdW5jdGlvbiAoZWRpdG9yLCBlbG1zKSB7XG4gICAgICB2YXIgbGlzdEl0ZW1zRWxtcyA9IGdsb2JhbCQ1Lm1hcChlbG1zLCBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgIHZhciBwYXJlbnRMaSA9IGVkaXRvci5kb20uZ2V0UGFyZW50KGVsbSwgJ2xpLGRkLGR0JywgZ2V0Q2xvc2VzdExpc3RSb290RWxtKGVkaXRvciwgZWxtKSk7XG4gICAgICAgIHJldHVybiBwYXJlbnRMaSA/IHBhcmVudExpIDogZWxtO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZ2xvYmFsJDYudW5pcXVlKGxpc3RJdGVtc0VsbXMpO1xuICAgIH07XG4gICAgdmFyIGdldFNlbGVjdGVkTGlzdEl0ZW1zID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHNlbGVjdGVkQmxvY2tzID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpO1xuICAgICAgcmV0dXJuIGdsb2JhbCQ1LmdyZXAoZmluZFBhcmVudExpc3RJdGVtc05vZGVzKGVkaXRvciwgc2VsZWN0ZWRCbG9ja3MpLCBmdW5jdGlvbiAoYmxvY2spIHtcbiAgICAgICAgcmV0dXJuIGlzTGlzdEl0ZW1Ob2RlKGJsb2NrKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFNlbGVjdGVkRGxJdGVtcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmaWx0ZXIoZ2V0U2VsZWN0ZWRMaXN0SXRlbXMoZWRpdG9yKSwgaXNEbEl0ZW1Ob2RlKTtcbiAgICB9O1xuICAgIHZhciBnZXRDbG9zZXN0TGlzdFJvb3RFbG0gPSBmdW5jdGlvbiAoZWRpdG9yLCBlbG0pIHtcbiAgICAgIHZhciBwYXJlbnRUYWJsZUNlbGwgPSBlZGl0b3IuZG9tLmdldFBhcmVudHMoZWxtLCAnVEQsVEgnKTtcbiAgICAgIHZhciByb290ID0gcGFyZW50VGFibGVDZWxsLmxlbmd0aCA+IDAgPyBwYXJlbnRUYWJsZUNlbGxbMF0gOiBlZGl0b3IuZ2V0Qm9keSgpO1xuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfTtcbiAgICB2YXIgZmluZExhc3RQYXJlbnRMaXN0Tm9kZSA9IGZ1bmN0aW9uIChlZGl0b3IsIGVsbSkge1xuICAgICAgdmFyIHBhcmVudExpc3RzID0gZWRpdG9yLmRvbS5nZXRQYXJlbnRzKGVsbSwgJ29sLHVsJywgZ2V0Q2xvc2VzdExpc3RSb290RWxtKGVkaXRvciwgZWxtKSk7XG4gICAgICByZXR1cm4gbGFzdChwYXJlbnRMaXN0cyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U2VsZWN0ZWRMaXN0cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBmaXJzdExpc3QgPSBmaW5kTGFzdFBhcmVudExpc3ROb2RlKGVkaXRvciwgZWRpdG9yLnNlbGVjdGlvbi5nZXRTdGFydCgpKTtcbiAgICAgIHZhciBzdWJzZXF1ZW50TGlzdHMgPSBmaWx0ZXIoZWRpdG9yLnNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpLCBpc09sVWxOb2RlKTtcbiAgICAgIHJldHVybiBmaXJzdExpc3QudG9BcnJheSgpLmNvbmNhdChzdWJzZXF1ZW50TGlzdHMpO1xuICAgIH07XG4gICAgdmFyIGdldFNlbGVjdGVkTGlzdFJvb3RzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHNlbGVjdGVkTGlzdHMgPSBnZXRTZWxlY3RlZExpc3RzKGVkaXRvcik7XG4gICAgICByZXR1cm4gZ2V0VW5pcXVlTGlzdFJvb3RzKGVkaXRvciwgc2VsZWN0ZWRMaXN0cyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VW5pcXVlTGlzdFJvb3RzID0gZnVuY3Rpb24gKGVkaXRvciwgbGlzdHMpIHtcbiAgICAgIHZhciBsaXN0Um9vdHMgPSBtYXAobGlzdHMsIGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgICAgIHJldHVybiBmaW5kTGFzdFBhcmVudExpc3ROb2RlKGVkaXRvciwgbGlzdCkuZ2V0T3IobGlzdCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBnbG9iYWwkNi51bmlxdWUobGlzdFJvb3RzKTtcbiAgICB9O1xuXG4gICAgdmFyIGxpZnQyID0gZnVuY3Rpb24gKG9hLCBvYiwgZikge1xuICAgICAgcmV0dXJuIG9hLmlzU29tZSgpICYmIG9iLmlzU29tZSgpID8gT3B0aW9uYWwuc29tZShmKG9hLmdldE9yRGllKCksIG9iLmdldE9yRGllKCkpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuXG4gICAgdmFyIGZyb21FbGVtZW50cyA9IGZ1bmN0aW9uIChlbGVtZW50cywgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBmcmFnbWVudCA9IGRvYy5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICBlYWNoKGVsZW1lbnRzLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChlbGVtZW50LmRvbSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShmcmFnbWVudCk7XG4gICAgfTtcblxuICAgIHZhciBmaXJlTGlzdEV2ZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgYWN0aW9uLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmZpcmUoJ0xpc3RNdXRhdGlvbicsIHtcbiAgICAgICAgYWN0aW9uOiBhY3Rpb24sXG4gICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoZG9tKSB7XG4gICAgICByZXR1cm4gZG9tLnN0eWxlICE9PSB1bmRlZmluZWQgJiYgaXNGdW5jdGlvbihkb20uc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSk7XG4gICAgfTtcblxuICAgIHZhciBpbnRlcm5hbFNldCA9IGZ1bmN0aW9uIChkb20sIHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgaWYgKCFpc1N0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBjYWxsIHRvIENTUy5zZXQuIFByb3BlcnR5ICcsIHByb3BlcnR5LCAnOjogVmFsdWUgJywgdmFsdWUsICc6OiBFbGVtZW50ICcsIGRvbSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ1NTIHZhbHVlIG11c3QgYmUgYSBzdHJpbmc6ICcgKyB2YWx1ZSk7XG4gICAgICB9XG4gICAgICBpZiAoaXNTdXBwb3J0ZWQoZG9tKSkge1xuICAgICAgICBkb20uc3R5bGUuc2V0UHJvcGVydHkocHJvcGVydHksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCwgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBpbnRlcm5hbFNldChkb20sIHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgfTtcblxuICAgIHZhciBqb2luU2VnbWVudCA9IGZ1bmN0aW9uIChwYXJlbnQsIGNoaWxkKSB7XG4gICAgICBhcHBlbmQocGFyZW50Lml0ZW0sIGNoaWxkLmxpc3QpO1xuICAgIH07XG4gICAgdmFyIGpvaW5TZWdtZW50cyA9IGZ1bmN0aW9uIChzZWdtZW50cykge1xuICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBqb2luU2VnbWVudChzZWdtZW50c1tpIC0gMV0sIHNlZ21lbnRzW2ldKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBhcHBlbmRTZWdtZW50cyA9IGZ1bmN0aW9uIChoZWFkJDEsIHRhaWwpIHtcbiAgICAgIGxpZnQyKGxhc3QoaGVhZCQxKSwgaGVhZCh0YWlsKSwgam9pblNlZ21lbnQpO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoc2NvcGUsIGxpc3RUeXBlKSB7XG4gICAgICB2YXIgc2VnbWVudCA9IHtcbiAgICAgICAgbGlzdDogU3VnYXJFbGVtZW50LmZyb21UYWcobGlzdFR5cGUsIHNjb3BlKSxcbiAgICAgICAgaXRlbTogU3VnYXJFbGVtZW50LmZyb21UYWcoJ2xpJywgc2NvcGUpXG4gICAgICB9O1xuICAgICAgYXBwZW5kKHNlZ21lbnQubGlzdCwgc2VnbWVudC5pdGVtKTtcbiAgICAgIHJldHVybiBzZWdtZW50O1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKHNjb3BlLCBlbnRyeSwgc2l6ZSkge1xuICAgICAgdmFyIHNlZ21lbnRzID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykge1xuICAgICAgICBzZWdtZW50cy5wdXNoKGNyZWF0ZVNlZ21lbnQoc2NvcGUsIGVudHJ5Lmxpc3RUeXBlKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc2VnbWVudHM7XG4gICAgfTtcbiAgICB2YXIgcG9wdWxhdGVTZWdtZW50cyA9IGZ1bmN0aW9uIChzZWdtZW50cywgZW50cnkpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VnbWVudHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgIHNldChzZWdtZW50c1tpXS5pdGVtLCAnbGlzdC1zdHlsZS10eXBlJywgJ25vbmUnKTtcbiAgICAgIH1cbiAgICAgIGxhc3Qoc2VnbWVudHMpLmVhY2goZnVuY3Rpb24gKHNlZ21lbnQpIHtcbiAgICAgICAgc2V0QWxsKHNlZ21lbnQubGlzdCwgZW50cnkubGlzdEF0dHJpYnV0ZXMpO1xuICAgICAgICBzZXRBbGwoc2VnbWVudC5pdGVtLCBlbnRyeS5pdGVtQXR0cmlidXRlcyk7XG4gICAgICAgIGFwcGVuZCQxKHNlZ21lbnQuaXRlbSwgZW50cnkuY29udGVudCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBub3JtYWxpemVTZWdtZW50ID0gZnVuY3Rpb24gKHNlZ21lbnQsIGVudHJ5KSB7XG4gICAgICBpZiAobmFtZShzZWdtZW50Lmxpc3QpICE9PSBlbnRyeS5saXN0VHlwZSkge1xuICAgICAgICBzZWdtZW50Lmxpc3QgPSBtdXRhdGUoc2VnbWVudC5saXN0LCBlbnRyeS5saXN0VHlwZSk7XG4gICAgICB9XG4gICAgICBzZXRBbGwoc2VnbWVudC5saXN0LCBlbnRyeS5saXN0QXR0cmlidXRlcyk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlSXRlbSA9IGZ1bmN0aW9uIChzY29wZSwgYXR0ciwgY29udGVudCkge1xuICAgICAgdmFyIGl0ZW0gPSBTdWdhckVsZW1lbnQuZnJvbVRhZygnbGknLCBzY29wZSk7XG4gICAgICBzZXRBbGwoaXRlbSwgYXR0cik7XG4gICAgICBhcHBlbmQkMShpdGVtLCBjb250ZW50KTtcbiAgICAgIHJldHVybiBpdGVtO1xuICAgIH07XG4gICAgdmFyIGFwcGVuZEl0ZW0gPSBmdW5jdGlvbiAoc2VnbWVudCwgaXRlbSkge1xuICAgICAgYXBwZW5kKHNlZ21lbnQubGlzdCwgaXRlbSk7XG4gICAgICBzZWdtZW50Lml0ZW0gPSBpdGVtO1xuICAgIH07XG4gICAgdmFyIHdyaXRlU2hhbGxvdyA9IGZ1bmN0aW9uIChzY29wZSwgY2FzdCwgZW50cnkpIHtcbiAgICAgIHZhciBuZXdDYXN0ID0gY2FzdC5zbGljZSgwLCBlbnRyeS5kZXB0aCk7XG4gICAgICBsYXN0KG5ld0Nhc3QpLmVhY2goZnVuY3Rpb24gKHNlZ21lbnQpIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBjcmVhdGVJdGVtKHNjb3BlLCBlbnRyeS5pdGVtQXR0cmlidXRlcywgZW50cnkuY29udGVudCk7XG4gICAgICAgIGFwcGVuZEl0ZW0oc2VnbWVudCwgaXRlbSk7XG4gICAgICAgIG5vcm1hbGl6ZVNlZ21lbnQoc2VnbWVudCwgZW50cnkpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gbmV3Q2FzdDtcbiAgICB9O1xuICAgIHZhciB3cml0ZURlZXAgPSBmdW5jdGlvbiAoc2NvcGUsIGNhc3QsIGVudHJ5KSB7XG4gICAgICB2YXIgc2VnbWVudHMgPSBjcmVhdGVTZWdtZW50cyhzY29wZSwgZW50cnksIGVudHJ5LmRlcHRoIC0gY2FzdC5sZW5ndGgpO1xuICAgICAgam9pblNlZ21lbnRzKHNlZ21lbnRzKTtcbiAgICAgIHBvcHVsYXRlU2VnbWVudHMoc2VnbWVudHMsIGVudHJ5KTtcbiAgICAgIGFwcGVuZFNlZ21lbnRzKGNhc3QsIHNlZ21lbnRzKTtcbiAgICAgIHJldHVybiBjYXN0LmNvbmNhdChzZWdtZW50cyk7XG4gICAgfTtcbiAgICB2YXIgY29tcG9zZUxpc3QgPSBmdW5jdGlvbiAoc2NvcGUsIGVudHJpZXMpIHtcbiAgICAgIHZhciBjYXN0ID0gZm9sZGwoZW50cmllcywgZnVuY3Rpb24gKGNhc3QsIGVudHJ5KSB7XG4gICAgICAgIHJldHVybiBlbnRyeS5kZXB0aCA+IGNhc3QubGVuZ3RoID8gd3JpdGVEZWVwKHNjb3BlLCBjYXN0LCBlbnRyeSkgOiB3cml0ZVNoYWxsb3coc2NvcGUsIGNhc3QsIGVudHJ5KTtcbiAgICAgIH0sIFtdKTtcbiAgICAgIHJldHVybiBoZWFkKGNhc3QpLm1hcChmdW5jdGlvbiAoc2VnbWVudCkge1xuICAgICAgICByZXR1cm4gc2VnbWVudC5saXN0O1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBpc0xpc3QgPSBmdW5jdGlvbiAoZWwpIHtcbiAgICAgIHJldHVybiBpcyQxKGVsLCAnT0wsVUwnKTtcbiAgICB9O1xuICAgIHZhciBoYXNGaXJzdENoaWxkTGlzdCA9IGZ1bmN0aW9uIChlbCkge1xuICAgICAgcmV0dXJuIGZpcnN0Q2hpbGQoZWwpLm1hcChpc0xpc3QpLmdldE9yKGZhbHNlKTtcbiAgICB9O1xuICAgIHZhciBoYXNMYXN0Q2hpbGRMaXN0ID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXR1cm4gbGFzdENoaWxkKGVsKS5tYXAoaXNMaXN0KS5nZXRPcihmYWxzZSk7XG4gICAgfTtcblxuICAgIHZhciBpc0luZGVudGVkID0gZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICByZXR1cm4gZW50cnkuZGVwdGggPiAwO1xuICAgIH07XG4gICAgdmFyIGlzU2VsZWN0ZWQgPSBmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgIHJldHVybiBlbnRyeS5pc1NlbGVjdGVkO1xuICAgIH07XG4gICAgdmFyIGNsb25lSXRlbUNvbnRlbnQgPSBmdW5jdGlvbiAobGkpIHtcbiAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4obGkpO1xuICAgICAgdmFyIGNvbnRlbnQgPSBoYXNMYXN0Q2hpbGRMaXN0KGxpKSA/IGNoaWxkcmVuJDEuc2xpY2UoMCwgLTEpIDogY2hpbGRyZW4kMTtcbiAgICAgIHJldHVybiBtYXAoY29udGVudCwgZGVlcCk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlRW50cnkgPSBmdW5jdGlvbiAobGksIGRlcHRoLCBpc1NlbGVjdGVkKSB7XG4gICAgICByZXR1cm4gcGFyZW50KGxpKS5maWx0ZXIoaXNFbGVtZW50KS5tYXAoZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkZXB0aDogZGVwdGgsXG4gICAgICAgICAgZGlydHk6IGZhbHNlLFxuICAgICAgICAgIGlzU2VsZWN0ZWQ6IGlzU2VsZWN0ZWQsXG4gICAgICAgICAgY29udGVudDogY2xvbmVJdGVtQ29udGVudChsaSksXG4gICAgICAgICAgaXRlbUF0dHJpYnV0ZXM6IGNsb25lKGxpKSxcbiAgICAgICAgICBsaXN0QXR0cmlidXRlczogY2xvbmUobGlzdCksXG4gICAgICAgICAgbGlzdFR5cGU6IG5hbWUobGlzdClcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgaW5kZW50RW50cnkgPSBmdW5jdGlvbiAoaW5kZW50YXRpb24sIGVudHJ5KSB7XG4gICAgICBzd2l0Y2ggKGluZGVudGF0aW9uKSB7XG4gICAgICBjYXNlICdJbmRlbnQnOlxuICAgICAgICBlbnRyeS5kZXB0aCsrO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ091dGRlbnQnOlxuICAgICAgICBlbnRyeS5kZXB0aC0tO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0ZsYXR0ZW4nOlxuICAgICAgICBlbnRyeS5kZXB0aCA9IDA7XG4gICAgICB9XG4gICAgICBlbnRyeS5kaXJ0eSA9IHRydWU7XG4gICAgfTtcblxuICAgIHZhciBjbG9uZUxpc3RQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG4gICAgICB0YXJnZXQubGlzdFR5cGUgPSBzb3VyY2UubGlzdFR5cGU7XG4gICAgICB0YXJnZXQubGlzdEF0dHJpYnV0ZXMgPSBfX2Fzc2lnbih7fSwgc291cmNlLmxpc3RBdHRyaWJ1dGVzKTtcbiAgICB9O1xuICAgIHZhciBjbGVhbkxpc3RQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICBlbnRyeS5saXN0QXR0cmlidXRlcyA9IGZpbHRlciQxKGVudHJ5Lmxpc3RBdHRyaWJ1dGVzLCBmdW5jdGlvbiAoX3ZhbHVlLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuIGtleSAhPT0gJ3N0YXJ0JztcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNsb3Nlc3RTaWJsaW5nRW50cnkgPSBmdW5jdGlvbiAoZW50cmllcywgc3RhcnQpIHtcbiAgICAgIHZhciBkZXB0aCA9IGVudHJpZXNbc3RhcnRdLmRlcHRoO1xuICAgICAgdmFyIG1hdGNoZXMgPSBmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgcmV0dXJuIGVudHJ5LmRlcHRoID09PSBkZXB0aCAmJiAhZW50cnkuZGlydHk7XG4gICAgICB9O1xuICAgICAgdmFyIHVudGlsID0gZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgIHJldHVybiBlbnRyeS5kZXB0aCA8IGRlcHRoO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmaW5kVW50aWwocmV2ZXJzZShlbnRyaWVzLnNsaWNlKDAsIHN0YXJ0KSksIG1hdGNoZXMsIHVudGlsKS5vclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRVbnRpbChlbnRyaWVzLnNsaWNlKHN0YXJ0ICsgMSksIG1hdGNoZXMsIHVudGlsKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZUVudHJpZXMgPSBmdW5jdGlvbiAoZW50cmllcykge1xuICAgICAgZWFjaChlbnRyaWVzLCBmdW5jdGlvbiAoZW50cnksIGkpIHtcbiAgICAgICAgY2xvc2VzdFNpYmxpbmdFbnRyeShlbnRyaWVzLCBpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoZW50cnkuZGlydHkpIHtcbiAgICAgICAgICAgIGNsZWFuTGlzdFByb3BlcnRpZXMoZW50cnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKG1hdGNoaW5nRW50cnkpIHtcbiAgICAgICAgICByZXR1cm4gY2xvbmVMaXN0UHJvcGVydGllcyhlbnRyeSwgbWF0Y2hpbmdFbnRyeSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZW50cmllcztcbiAgICB9O1xuXG4gICAgdmFyIENlbGwgPSBmdW5jdGlvbiAoaW5pdGlhbCkge1xuICAgICAgdmFyIHZhbHVlID0gaW5pdGlhbDtcbiAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdmFsdWUgPSB2O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGdldDogZ2V0LFxuICAgICAgICBzZXQ6IHNldFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHBhcnNlSXRlbSA9IGZ1bmN0aW9uIChkZXB0aCwgaXRlbVNlbGVjdGlvbiwgc2VsZWN0aW9uU3RhdGUsIGl0ZW0pIHtcbiAgICAgIHJldHVybiBmaXJzdENoaWxkKGl0ZW0pLmZpbHRlcihpc0xpc3QpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICBpdGVtU2VsZWN0aW9uLmVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICAgIGlmIChlcShzZWxlY3Rpb24uc3RhcnQsIGl0ZW0pKSB7XG4gICAgICAgICAgICBzZWxlY3Rpb25TdGF0ZS5zZXQodHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGN1cnJlbnRJdGVtRW50cnkgPSBjcmVhdGVFbnRyeShpdGVtLCBkZXB0aCwgc2VsZWN0aW9uU3RhdGUuZ2V0KCkpO1xuICAgICAgICBpdGVtU2VsZWN0aW9uLmVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICAgIGlmIChlcShzZWxlY3Rpb24uZW5kLCBpdGVtKSkge1xuICAgICAgICAgICAgc2VsZWN0aW9uU3RhdGUuc2V0KGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgY2hpbGRMaXN0RW50cmllcyA9IGxhc3RDaGlsZChpdGVtKS5maWx0ZXIoaXNMaXN0KS5tYXAoZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgICByZXR1cm4gcGFyc2VMaXN0KGRlcHRoLCBpdGVtU2VsZWN0aW9uLCBzZWxlY3Rpb25TdGF0ZSwgbGlzdCk7XG4gICAgICAgIH0pLmdldE9yKFtdKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRJdGVtRW50cnkudG9BcnJheSgpLmNvbmNhdChjaGlsZExpc3RFbnRyaWVzKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgICAgIHJldHVybiBwYXJzZUxpc3QoZGVwdGgsIGl0ZW1TZWxlY3Rpb24sIHNlbGVjdGlvblN0YXRlLCBsaXN0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHBhcnNlTGlzdCA9IGZ1bmN0aW9uIChkZXB0aCwgaXRlbVNlbGVjdGlvbiwgc2VsZWN0aW9uU3RhdGUsIGxpc3QpIHtcbiAgICAgIHJldHVybiBiaW5kKGNoaWxkcmVuKGxpc3QpLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICB2YXIgcGFyc2VyID0gaXNMaXN0KGVsZW1lbnQpID8gcGFyc2VMaXN0IDogcGFyc2VJdGVtO1xuICAgICAgICB2YXIgbmV3RGVwdGggPSBkZXB0aCArIDE7XG4gICAgICAgIHJldHVybiBwYXJzZXIobmV3RGVwdGgsIGl0ZW1TZWxlY3Rpb24sIHNlbGVjdGlvblN0YXRlLCBlbGVtZW50KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHBhcnNlTGlzdHMgPSBmdW5jdGlvbiAobGlzdHMsIGl0ZW1TZWxlY3Rpb24pIHtcbiAgICAgIHZhciBzZWxlY3Rpb25TdGF0ZSA9IENlbGwoZmFsc2UpO1xuICAgICAgdmFyIGluaXRpYWxEZXB0aCA9IDA7XG4gICAgICByZXR1cm4gbWFwKGxpc3RzLCBmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNvdXJjZUxpc3Q6IGxpc3QsXG4gICAgICAgICAgZW50cmllczogcGFyc2VMaXN0KGluaXRpYWxEZXB0aCwgaXRlbVNlbGVjdGlvbiwgc2VsZWN0aW9uU3RhdGUsIGxpc3QpXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG91dGRlbnRlZENvbXBvc2VyID0gZnVuY3Rpb24gKGVkaXRvciwgZW50cmllcykge1xuICAgICAgdmFyIG5vcm1hbGl6ZWRFbnRyaWVzID0gbm9ybWFsaXplRW50cmllcyhlbnRyaWVzKTtcbiAgICAgIHJldHVybiBtYXAobm9ybWFsaXplZEVudHJpZXMsIGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICB2YXIgY29udGVudCA9IGZyb21FbGVtZW50cyhlbnRyeS5jb250ZW50KTtcbiAgICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGNyZWF0ZVRleHRCbG9jayhlZGl0b3IsIGNvbnRlbnQuZG9tKSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpbmRlbnRlZENvbXBvc2VyID0gZnVuY3Rpb24gKGVkaXRvciwgZW50cmllcykge1xuICAgICAgdmFyIG5vcm1hbGl6ZWRFbnRyaWVzID0gbm9ybWFsaXplRW50cmllcyhlbnRyaWVzKTtcbiAgICAgIHJldHVybiBjb21wb3NlTGlzdChlZGl0b3IuY29udGVudERvY3VtZW50LCBub3JtYWxpemVkRW50cmllcykudG9BcnJheSgpO1xuICAgIH07XG4gICAgdmFyIGNvbXBvc2VFbnRyaWVzID0gZnVuY3Rpb24gKGVkaXRvciwgZW50cmllcykge1xuICAgICAgcmV0dXJuIGJpbmQoZ3JvdXBCeShlbnRyaWVzLCBpc0luZGVudGVkKSwgZnVuY3Rpb24gKGVudHJpZXMpIHtcbiAgICAgICAgdmFyIGdyb3VwSXNJbmRlbnRlZCA9IGhlYWQoZW50cmllcykubWFwKGlzSW5kZW50ZWQpLmdldE9yKGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIGdyb3VwSXNJbmRlbnRlZCA/IGluZGVudGVkQ29tcG9zZXIoZWRpdG9yLCBlbnRyaWVzKSA6IG91dGRlbnRlZENvbXBvc2VyKGVkaXRvciwgZW50cmllcyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpbmRlbnRTZWxlY3RlZEVudHJpZXMgPSBmdW5jdGlvbiAoZW50cmllcywgaW5kZW50YXRpb24pIHtcbiAgICAgIGVhY2goZmlsdGVyKGVudHJpZXMsIGlzU2VsZWN0ZWQpLCBmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgcmV0dXJuIGluZGVudEVudHJ5KGluZGVudGF0aW9uLCBlbnRyeSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRJdGVtU2VsZWN0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHNlbGVjdGVkTGlzdEl0ZW1zID0gbWFwKGdldFNlbGVjdGVkTGlzdEl0ZW1zKGVkaXRvciksIFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICAgIHJldHVybiBsaWZ0MihmaW5kKHNlbGVjdGVkTGlzdEl0ZW1zLCBub3QoaGFzRmlyc3RDaGlsZExpc3QpKSwgZmluZChyZXZlcnNlKHNlbGVjdGVkTGlzdEl0ZW1zKSwgbm90KGhhc0ZpcnN0Q2hpbGRMaXN0KSksIGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgIGVuZDogZW5kXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBsaXN0SW5kZW50YXRpb24gPSBmdW5jdGlvbiAoZWRpdG9yLCBsaXN0cywgaW5kZW50YXRpb24pIHtcbiAgICAgIHZhciBlbnRyeVNldHMgPSBwYXJzZUxpc3RzKGxpc3RzLCBnZXRJdGVtU2VsZWN0aW9uKGVkaXRvcikpO1xuICAgICAgZWFjaChlbnRyeVNldHMsIGZ1bmN0aW9uIChlbnRyeVNldCkge1xuICAgICAgICBpbmRlbnRTZWxlY3RlZEVudHJpZXMoZW50cnlTZXQuZW50cmllcywgaW5kZW50YXRpb24pO1xuICAgICAgICB2YXIgY29tcG9zZWRMaXN0cyA9IGNvbXBvc2VFbnRyaWVzKGVkaXRvciwgZW50cnlTZXQuZW50cmllcyk7XG4gICAgICAgIGVhY2goY29tcG9zZWRMaXN0cywgZnVuY3Rpb24gKGNvbXBvc2VkTGlzdCkge1xuICAgICAgICAgIGZpcmVMaXN0RXZlbnQoZWRpdG9yLCBpbmRlbnRhdGlvbiA9PT0gJ0luZGVudCcgPyAnSW5kZW50TGlzdCcgOiAnT3V0ZGVudExpc3QnLCBjb21wb3NlZExpc3QuZG9tKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJlZm9yZSQxKGVudHJ5U2V0LnNvdXJjZUxpc3QsIGNvbXBvc2VkTGlzdHMpO1xuICAgICAgICByZW1vdmUoZW50cnlTZXQuc291cmNlTGlzdCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHNlbGVjdGlvbkluZGVudGF0aW9uID0gZnVuY3Rpb24gKGVkaXRvciwgaW5kZW50YXRpb24pIHtcbiAgICAgIHZhciBsaXN0cyA9IG1hcChnZXRTZWxlY3RlZExpc3RSb290cyhlZGl0b3IpLCBTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgICB2YXIgZGxJdGVtcyA9IG1hcChnZXRTZWxlY3RlZERsSXRlbXMoZWRpdG9yKSwgU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgICAgdmFyIGlzSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgaWYgKGxpc3RzLmxlbmd0aCB8fCBkbEl0ZW1zLmxlbmd0aCkge1xuICAgICAgICB2YXIgYm9va21hcmsgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldEJvb2ttYXJrKCk7XG4gICAgICAgIGxpc3RJbmRlbnRhdGlvbihlZGl0b3IsIGxpc3RzLCBpbmRlbnRhdGlvbik7XG4gICAgICAgIGRsSW5kZW50YXRpb24oZWRpdG9yLCBpbmRlbnRhdGlvbiwgZGxJdGVtcyk7XG4gICAgICAgIGVkaXRvci5zZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhub3JtYWxpemVSYW5nZShlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpKSk7XG4gICAgICAgIGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuICAgICAgICBpc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGlzSGFuZGxlZDtcbiAgICB9O1xuICAgIHZhciBpbmRlbnRMaXN0U2VsZWN0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIHNlbGVjdGlvbkluZGVudGF0aW9uKGVkaXRvciwgJ0luZGVudCcpO1xuICAgIH07XG4gICAgdmFyIG91dGRlbnRMaXN0U2VsZWN0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIHNlbGVjdGlvbkluZGVudGF0aW9uKGVkaXRvciwgJ091dGRlbnQnKTtcbiAgICB9O1xuICAgIHZhciBmbGF0dGVuTGlzdFNlbGVjdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBzZWxlY3Rpb25JbmRlbnRhdGlvbihlZGl0b3IsICdGbGF0dGVuJyk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkNyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5Cb29rbWFya01hbmFnZXInKTtcblxuICAgIHZhciBET00kMSA9IGdsb2JhbCQ0LkRPTTtcbiAgICB2YXIgY3JlYXRlQm9va21hcmsgPSBmdW5jdGlvbiAocm5nKSB7XG4gICAgICB2YXIgYm9va21hcmsgPSB7fTtcbiAgICAgIHZhciBzZXR1cEVuZFBvaW50ID0gZnVuY3Rpb24gKHN0YXJ0KSB7XG4gICAgICAgIHZhciBvZmZzZXROb2RlLCBjb250YWluZXIsIG9mZnNldDtcbiAgICAgICAgY29udGFpbmVyID0gcm5nW3N0YXJ0ID8gJ3N0YXJ0Q29udGFpbmVyJyA6ICdlbmRDb250YWluZXInXTtcbiAgICAgICAgb2Zmc2V0ID0gcm5nW3N0YXJ0ID8gJ3N0YXJ0T2Zmc2V0JyA6ICdlbmRPZmZzZXQnXTtcbiAgICAgICAgaWYgKGNvbnRhaW5lci5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgIG9mZnNldE5vZGUgPSBET00kMS5jcmVhdGUoJ3NwYW4nLCB7ICdkYXRhLW1jZS10eXBlJzogJ2Jvb2ttYXJrJyB9KTtcbiAgICAgICAgICBpZiAoY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICAgICAgb2Zmc2V0ID0gTWF0aC5taW4ob2Zmc2V0LCBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIGlmIChzdGFydCkge1xuICAgICAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKG9mZnNldE5vZGUsIGNvbnRhaW5lci5jaGlsZE5vZGVzW29mZnNldF0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgRE9NJDEuaW5zZXJ0QWZ0ZXIob2Zmc2V0Tm9kZSwgY29udGFpbmVyLmNoaWxkTm9kZXNbb2Zmc2V0XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChvZmZzZXROb2RlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGFpbmVyID0gb2Zmc2V0Tm9kZTtcbiAgICAgICAgICBvZmZzZXQgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGJvb2ttYXJrW3N0YXJ0ID8gJ3N0YXJ0Q29udGFpbmVyJyA6ICdlbmRDb250YWluZXInXSA9IGNvbnRhaW5lcjtcbiAgICAgICAgYm9va21hcmtbc3RhcnQgPyAnc3RhcnRPZmZzZXQnIDogJ2VuZE9mZnNldCddID0gb2Zmc2V0O1xuICAgICAgfTtcbiAgICAgIHNldHVwRW5kUG9pbnQodHJ1ZSk7XG4gICAgICBpZiAoIXJuZy5jb2xsYXBzZWQpIHtcbiAgICAgICAgc2V0dXBFbmRQb2ludCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJvb2ttYXJrO1xuICAgIH07XG4gICAgdmFyIHJlc29sdmVCb29rbWFyayA9IGZ1bmN0aW9uIChib29rbWFyaykge1xuICAgICAgdmFyIHJlc3RvcmVFbmRQb2ludCA9IGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgICB2YXIgY29udGFpbmVyLCBvZmZzZXQsIG5vZGU7XG4gICAgICAgIHZhciBub2RlSW5kZXggPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgdmFyIG5vZGUgPSBjb250YWluZXIucGFyZW50Tm9kZS5maXJzdENoaWxkLCBpZHggPSAwO1xuICAgICAgICAgIHdoaWxlIChub2RlKSB7XG4gICAgICAgICAgICBpZiAobm9kZSA9PT0gY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBpZHg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSAhPT0gMSB8fCBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtdHlwZScpICE9PSAnYm9va21hcmsnKSB7XG4gICAgICAgICAgICAgIGlkeCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfTtcbiAgICAgICAgY29udGFpbmVyID0gbm9kZSA9IGJvb2ttYXJrW3N0YXJ0ID8gJ3N0YXJ0Q29udGFpbmVyJyA6ICdlbmRDb250YWluZXInXTtcbiAgICAgICAgb2Zmc2V0ID0gYm9va21hcmtbc3RhcnQgPyAnc3RhcnRPZmZzZXQnIDogJ2VuZE9mZnNldCddO1xuICAgICAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGFpbmVyLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgb2Zmc2V0ID0gbm9kZUluZGV4KGNvbnRhaW5lcik7XG4gICAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyLnBhcmVudE5vZGU7XG4gICAgICAgICAgRE9NJDEucmVtb3ZlKG5vZGUpO1xuICAgICAgICAgIGlmICghY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSAmJiBET00kMS5pc0Jsb2NrKGNvbnRhaW5lcikpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChET00kMS5jcmVhdGUoJ2JyJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBib29rbWFya1tzdGFydCA/ICdzdGFydENvbnRhaW5lcicgOiAnZW5kQ29udGFpbmVyJ10gPSBjb250YWluZXI7XG4gICAgICAgIGJvb2ttYXJrW3N0YXJ0ID8gJ3N0YXJ0T2Zmc2V0JyA6ICdlbmRPZmZzZXQnXSA9IG9mZnNldDtcbiAgICAgIH07XG4gICAgICByZXN0b3JlRW5kUG9pbnQodHJ1ZSk7XG4gICAgICByZXN0b3JlRW5kUG9pbnQoKTtcbiAgICAgIHZhciBybmcgPSBET00kMS5jcmVhdGVSbmcoKTtcbiAgICAgIHJuZy5zZXRTdGFydChib29rbWFyay5zdGFydENvbnRhaW5lciwgYm9va21hcmsuc3RhcnRPZmZzZXQpO1xuICAgICAgaWYgKGJvb2ttYXJrLmVuZENvbnRhaW5lcikge1xuICAgICAgICBybmcuc2V0RW5kKGJvb2ttYXJrLmVuZENvbnRhaW5lciwgYm9va21hcmsuZW5kT2Zmc2V0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub3JtYWxpemVSYW5nZShybmcpO1xuICAgIH07XG5cbiAgICB2YXIgbGlzdFRvZ2dsZUFjdGlvbkZyb21MaXN0TmFtZSA9IGZ1bmN0aW9uIChsaXN0TmFtZSkge1xuICAgICAgc3dpdGNoIChsaXN0TmFtZSkge1xuICAgICAgY2FzZSAnVUwnOlxuICAgICAgICByZXR1cm4gJ1RvZ2dsZVVsTGlzdCc7XG4gICAgICBjYXNlICdPTCc6XG4gICAgICAgIHJldHVybiAnVG9nZ2xlT2xMaXN0JztcbiAgICAgIGNhc2UgJ0RMJzpcbiAgICAgICAgcmV0dXJuICdUb2dnbGVETExpc3QnO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaXNDdXN0b21MaXN0ID0gZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgIHJldHVybiAvXFxidG94XFwtLy50ZXN0KGxpc3QuY2xhc3NOYW1lKTtcbiAgICB9O1xuICAgIHZhciBsaXN0U3RhdGUgPSBmdW5jdGlvbiAoZWRpdG9yLCBsaXN0TmFtZSwgYWN0aXZhdGUpIHtcbiAgICAgIHZhciBub2RlQ2hhbmdlSGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBpbkxpc3QgPSBmaW5kVW50aWwoZS5wYXJlbnRzLCBpc0xpc3ROb2RlLCBpc1RhYmxlQ2VsbE5vZGUpLmZpbHRlcihmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICAgIHJldHVybiBsaXN0Lm5vZGVOYW1lID09PSBsaXN0TmFtZSAmJiAhaXNDdXN0b21MaXN0KGxpc3QpO1xuICAgICAgICB9KS5pc1NvbWUoKTtcbiAgICAgICAgYWN0aXZhdGUoaW5MaXN0KTtcbiAgICAgIH07XG4gICAgICB2YXIgcGFyZW50cyA9IGVkaXRvci5kb20uZ2V0UGFyZW50cyhlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKSk7XG4gICAgICBub2RlQ2hhbmdlSGFuZGxlcih7IHBhcmVudHM6IHBhcmVudHMgfSk7XG4gICAgICBlZGl0b3Iub24oJ05vZGVDaGFuZ2UnLCBub2RlQ2hhbmdlSGFuZGxlcik7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLm9mZignTm9kZUNoYW5nZScsIG5vZGVDaGFuZ2VIYW5kbGVyKTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciB1cGRhdGVMaXN0U3R5bGUgPSBmdW5jdGlvbiAoZG9tLCBlbCwgZGV0YWlsKSB7XG4gICAgICB2YXIgdHlwZSA9IGRldGFpbFsnbGlzdC1zdHlsZS10eXBlJ10gPyBkZXRhaWxbJ2xpc3Qtc3R5bGUtdHlwZSddIDogbnVsbDtcbiAgICAgIGRvbS5zZXRTdHlsZShlbCwgJ2xpc3Qtc3R5bGUtdHlwZScsIHR5cGUpO1xuICAgIH07XG4gICAgdmFyIHNldEF0dHJpYnMgPSBmdW5jdGlvbiAoZWxtLCBhdHRycykge1xuICAgICAgZ2xvYmFsJDUuZWFjaChhdHRycywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgZWxtLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHVwZGF0ZUxpc3RBdHRycyA9IGZ1bmN0aW9uIChkb20sIGVsLCBkZXRhaWwpIHtcbiAgICAgIHNldEF0dHJpYnMoZWwsIGRldGFpbFsnbGlzdC1hdHRyaWJ1dGVzJ10pO1xuICAgICAgZ2xvYmFsJDUuZWFjaChkb20uc2VsZWN0KCdsaScsIGVsKSwgZnVuY3Rpb24gKGxpKSB7XG4gICAgICAgIHNldEF0dHJpYnMobGksIGRldGFpbFsnbGlzdC1pdGVtLWF0dHJpYnV0ZXMnXSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB1cGRhdGVMaXN0V2l0aERldGFpbHMgPSBmdW5jdGlvbiAoZG9tLCBlbCwgZGV0YWlsKSB7XG4gICAgICB1cGRhdGVMaXN0U3R5bGUoZG9tLCBlbCwgZGV0YWlsKTtcbiAgICAgIHVwZGF0ZUxpc3RBdHRycyhkb20sIGVsLCBkZXRhaWwpO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZVN0eWxlcyA9IGZ1bmN0aW9uIChkb20sIGVsZW1lbnQsIHN0eWxlcykge1xuICAgICAgZ2xvYmFsJDUuZWFjaChzdHlsZXMsIGZ1bmN0aW9uIChzdHlsZSkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiBkb20uc2V0U3R5bGUoZWxlbWVudCwgKF9hID0ge30sIF9hW3N0eWxlXSA9ICcnLCBfYSkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RW5kUG9pbnROb2RlID0gZnVuY3Rpb24gKGVkaXRvciwgcm5nLCBzdGFydCwgcm9vdCkge1xuICAgICAgdmFyIGNvbnRhaW5lciA9IHJuZ1tzdGFydCA/ICdzdGFydENvbnRhaW5lcicgOiAnZW5kQ29udGFpbmVyJ107XG4gICAgICB2YXIgb2Zmc2V0ID0gcm5nW3N0YXJ0ID8gJ3N0YXJ0T2Zmc2V0JyA6ICdlbmRPZmZzZXQnXTtcbiAgICAgIGlmIChjb250YWluZXIubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyLmNoaWxkTm9kZXNbTWF0aC5taW4ob2Zmc2V0LCBjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggLSAxKV0gfHwgY29udGFpbmVyO1xuICAgICAgfVxuICAgICAgaWYgKCFzdGFydCAmJiBpc0JyKGNvbnRhaW5lci5uZXh0U2libGluZykpIHtcbiAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyLm5leHRTaWJsaW5nO1xuICAgICAgfVxuICAgICAgd2hpbGUgKGNvbnRhaW5lci5wYXJlbnROb2RlICE9PSByb290KSB7XG4gICAgICAgIGlmIChpc1RleHRCbG9jayhlZGl0b3IsIGNvbnRhaW5lcikpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICgvXihURHxUSCkkLy50ZXN0KGNvbnRhaW5lci5wYXJlbnROb2RlLm5vZGVOYW1lKSkge1xuICAgICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgICAgIH1cbiAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyLnBhcmVudE5vZGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH07XG4gICAgdmFyIGdldFNlbGVjdGVkVGV4dEJsb2NrcyA9IGZ1bmN0aW9uIChlZGl0b3IsIHJuZywgcm9vdCkge1xuICAgICAgdmFyIHRleHRCbG9ja3MgPSBbXSwgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBzdGFydE5vZGUgPSBnZXRFbmRQb2ludE5vZGUoZWRpdG9yLCBybmcsIHRydWUsIHJvb3QpO1xuICAgICAgdmFyIGVuZE5vZGUgPSBnZXRFbmRQb2ludE5vZGUoZWRpdG9yLCBybmcsIGZhbHNlLCByb290KTtcbiAgICAgIHZhciBibG9jaztcbiAgICAgIHZhciBzaWJsaW5ncyA9IFtdO1xuICAgICAgZm9yICh2YXIgbm9kZSA9IHN0YXJ0Tm9kZTsgbm9kZTsgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgc2libGluZ3MucHVzaChub2RlKTtcbiAgICAgICAgaWYgKG5vZGUgPT09IGVuZE5vZGUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZ2xvYmFsJDUuZWFjaChzaWJsaW5ncywgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgaWYgKGlzVGV4dEJsb2NrKGVkaXRvciwgbm9kZSkpIHtcbiAgICAgICAgICB0ZXh0QmxvY2tzLnB1c2gobm9kZSk7XG4gICAgICAgICAgYmxvY2sgPSBudWxsO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9tLmlzQmxvY2sobm9kZSkgfHwgaXNCcihub2RlKSkge1xuICAgICAgICAgIGlmIChpc0JyKG5vZGUpKSB7XG4gICAgICAgICAgICBkb20ucmVtb3ZlKG5vZGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBibG9jayA9IG51bGw7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBuZXh0U2libGluZyA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICAgIGlmIChnbG9iYWwkNy5pc0Jvb2ttYXJrTm9kZShub2RlKSkge1xuICAgICAgICAgIGlmIChpc0xpc3ROb2RlKG5leHRTaWJsaW5nKSB8fCBpc1RleHRCbG9jayhlZGl0b3IsIG5leHRTaWJsaW5nKSB8fCAhbmV4dFNpYmxpbmcgJiYgbm9kZS5wYXJlbnROb2RlID09PSByb290KSB7XG4gICAgICAgICAgICBibG9jayA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghYmxvY2spIHtcbiAgICAgICAgICBibG9jayA9IGRvbS5jcmVhdGUoJ3AnKTtcbiAgICAgICAgICBub2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJsb2NrLCBub2RlKTtcbiAgICAgICAgICB0ZXh0QmxvY2tzLnB1c2goYmxvY2spO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGV4dEJsb2NrcztcbiAgICB9O1xuICAgIHZhciBoYXNDb21wYXRpYmxlU3R5bGUgPSBmdW5jdGlvbiAoZG9tLCBzaWIsIGRldGFpbCkge1xuICAgICAgdmFyIHNpYlN0eWxlID0gZG9tLmdldFN0eWxlKHNpYiwgJ2xpc3Qtc3R5bGUtdHlwZScpO1xuICAgICAgdmFyIGRldGFpbFN0eWxlID0gZGV0YWlsID8gZGV0YWlsWydsaXN0LXN0eWxlLXR5cGUnXSA6ICcnO1xuICAgICAgZGV0YWlsU3R5bGUgPSBkZXRhaWxTdHlsZSA9PT0gbnVsbCA/ICcnIDogZGV0YWlsU3R5bGU7XG4gICAgICByZXR1cm4gc2liU3R5bGUgPT09IGRldGFpbFN0eWxlO1xuICAgIH07XG4gICAgdmFyIGFwcGx5TGlzdCA9IGZ1bmN0aW9uIChlZGl0b3IsIGxpc3ROYW1lLCBkZXRhaWwpIHtcbiAgICAgIHZhciBybmcgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuICAgICAgdmFyIGxpc3RJdGVtTmFtZSA9ICdMSSc7XG4gICAgICB2YXIgcm9vdCA9IGdldENsb3Nlc3RMaXN0Um9vdEVsbShlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQodHJ1ZSkpO1xuICAgICAgdmFyIGRvbSA9IGVkaXRvci5kb207XG4gICAgICBpZiAoZG9tLmdldENvbnRlbnRFZGl0YWJsZShlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKSkgPT09ICdmYWxzZScpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGlzdE5hbWUgPSBsaXN0TmFtZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKGxpc3ROYW1lID09PSAnREwnKSB7XG4gICAgICAgIGxpc3RJdGVtTmFtZSA9ICdEVCc7XG4gICAgICB9XG4gICAgICB2YXIgYm9va21hcmsgPSBjcmVhdGVCb29rbWFyayhybmcpO1xuICAgICAgdmFyIHNlbGVjdGVkVGV4dEJsb2NrcyA9IGdldFNlbGVjdGVkVGV4dEJsb2NrcyhlZGl0b3IsIHJuZywgcm9vdCk7XG4gICAgICBnbG9iYWwkNS5lYWNoKHNlbGVjdGVkVGV4dEJsb2NrcywgZnVuY3Rpb24gKGJsb2NrKSB7XG4gICAgICAgIHZhciBsaXN0QmxvY2s7XG4gICAgICAgIHZhciBzaWJsaW5nID0gYmxvY2sucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICB2YXIgcGFyZW50ID0gYmxvY2sucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKCFpc0xpc3RJdGVtTm9kZShwYXJlbnQpKSB7XG4gICAgICAgICAgaWYgKHNpYmxpbmcgJiYgaXNMaXN0Tm9kZShzaWJsaW5nKSAmJiBzaWJsaW5nLm5vZGVOYW1lID09PSBsaXN0TmFtZSAmJiBoYXNDb21wYXRpYmxlU3R5bGUoZG9tLCBzaWJsaW5nLCBkZXRhaWwpKSB7XG4gICAgICAgICAgICBsaXN0QmxvY2sgPSBzaWJsaW5nO1xuICAgICAgICAgICAgYmxvY2sgPSBkb20ucmVuYW1lKGJsb2NrLCBsaXN0SXRlbU5hbWUpO1xuICAgICAgICAgICAgc2libGluZy5hcHBlbmRDaGlsZChibG9jayk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpc3RCbG9jayA9IGRvbS5jcmVhdGUobGlzdE5hbWUpO1xuICAgICAgICAgICAgYmxvY2sucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobGlzdEJsb2NrLCBibG9jayk7XG4gICAgICAgICAgICBsaXN0QmxvY2suYXBwZW5kQ2hpbGQoYmxvY2spO1xuICAgICAgICAgICAgYmxvY2sgPSBkb20ucmVuYW1lKGJsb2NrLCBsaXN0SXRlbU5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZW1vdmVTdHlsZXMoZG9tLCBibG9jaywgW1xuICAgICAgICAgICAgJ21hcmdpbicsXG4gICAgICAgICAgICAnbWFyZ2luLXJpZ2h0JyxcbiAgICAgICAgICAgICdtYXJnaW4tYm90dG9tJyxcbiAgICAgICAgICAgICdtYXJnaW4tbGVmdCcsXG4gICAgICAgICAgICAnbWFyZ2luLXRvcCcsXG4gICAgICAgICAgICAncGFkZGluZycsXG4gICAgICAgICAgICAncGFkZGluZy1yaWdodCcsXG4gICAgICAgICAgICAncGFkZGluZy1ib3R0b20nLFxuICAgICAgICAgICAgJ3BhZGRpbmctbGVmdCcsXG4gICAgICAgICAgICAncGFkZGluZy10b3AnXG4gICAgICAgICAgXSk7XG4gICAgICAgICAgdXBkYXRlTGlzdFdpdGhEZXRhaWxzKGRvbSwgbGlzdEJsb2NrLCBkZXRhaWwpO1xuICAgICAgICAgIG1lcmdlV2l0aEFkamFjZW50TGlzdHMoZWRpdG9yLmRvbSwgbGlzdEJsb2NrKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhyZXNvbHZlQm9va21hcmsoYm9va21hcmspKTtcbiAgICB9O1xuICAgIHZhciBpc1ZhbGlkTGlzdHMgPSBmdW5jdGlvbiAobGlzdDEsIGxpc3QyKSB7XG4gICAgICByZXR1cm4gbGlzdDEgJiYgbGlzdDIgJiYgaXNMaXN0Tm9kZShsaXN0MSkgJiYgbGlzdDEubm9kZU5hbWUgPT09IGxpc3QyLm5vZGVOYW1lO1xuICAgIH07XG4gICAgdmFyIGhhc1NhbWVMaXN0U3R5bGUgPSBmdW5jdGlvbiAoZG9tLCBsaXN0MSwgbGlzdDIpIHtcbiAgICAgIHZhciB0YXJnZXRTdHlsZSA9IGRvbS5nZXRTdHlsZShsaXN0MSwgJ2xpc3Qtc3R5bGUtdHlwZScsIHRydWUpO1xuICAgICAgdmFyIHN0eWxlID0gZG9tLmdldFN0eWxlKGxpc3QyLCAnbGlzdC1zdHlsZS10eXBlJywgdHJ1ZSk7XG4gICAgICByZXR1cm4gdGFyZ2V0U3R5bGUgPT09IHN0eWxlO1xuICAgIH07XG4gICAgdmFyIGhhc1NhbWVDbGFzc2VzID0gZnVuY3Rpb24gKGVsbTEsIGVsbTIpIHtcbiAgICAgIHJldHVybiBlbG0xLmNsYXNzTmFtZSA9PT0gZWxtMi5jbGFzc05hbWU7XG4gICAgfTtcbiAgICB2YXIgc2hvdWxkTWVyZ2UgPSBmdW5jdGlvbiAoZG9tLCBsaXN0MSwgbGlzdDIpIHtcbiAgICAgIHJldHVybiBpc1ZhbGlkTGlzdHMobGlzdDEsIGxpc3QyKSAmJiBoYXNTYW1lTGlzdFN0eWxlKGRvbSwgbGlzdDEsIGxpc3QyKSAmJiBoYXNTYW1lQ2xhc3NlcyhsaXN0MSwgbGlzdDIpO1xuICAgIH07XG4gICAgdmFyIG1lcmdlV2l0aEFkamFjZW50TGlzdHMgPSBmdW5jdGlvbiAoZG9tLCBsaXN0QmxvY2spIHtcbiAgICAgIHZhciBzaWJsaW5nLCBub2RlO1xuICAgICAgc2libGluZyA9IGxpc3RCbG9jay5uZXh0U2libGluZztcbiAgICAgIGlmIChzaG91bGRNZXJnZShkb20sIGxpc3RCbG9jaywgc2libGluZykpIHtcbiAgICAgICAgd2hpbGUgKG5vZGUgPSBzaWJsaW5nLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICBsaXN0QmxvY2suYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZG9tLnJlbW92ZShzaWJsaW5nKTtcbiAgICAgIH1cbiAgICAgIHNpYmxpbmcgPSBsaXN0QmxvY2sucHJldmlvdXNTaWJsaW5nO1xuICAgICAgaWYgKHNob3VsZE1lcmdlKGRvbSwgbGlzdEJsb2NrLCBzaWJsaW5nKSkge1xuICAgICAgICB3aGlsZSAobm9kZSA9IHNpYmxpbmcubGFzdENoaWxkKSB7XG4gICAgICAgICAgbGlzdEJsb2NrLmluc2VydEJlZm9yZShub2RlLCBsaXN0QmxvY2suZmlyc3RDaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgZG9tLnJlbW92ZShzaWJsaW5nKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB1cGRhdGVMaXN0ID0gZnVuY3Rpb24gKGVkaXRvciwgbGlzdCwgbGlzdE5hbWUsIGRldGFpbCkge1xuICAgICAgaWYgKGxpc3Qubm9kZU5hbWUgIT09IGxpc3ROYW1lKSB7XG4gICAgICAgIHZhciBuZXdMaXN0ID0gZWRpdG9yLmRvbS5yZW5hbWUobGlzdCwgbGlzdE5hbWUpO1xuICAgICAgICB1cGRhdGVMaXN0V2l0aERldGFpbHMoZWRpdG9yLmRvbSwgbmV3TGlzdCwgZGV0YWlsKTtcbiAgICAgICAgZmlyZUxpc3RFdmVudChlZGl0b3IsIGxpc3RUb2dnbGVBY3Rpb25Gcm9tTGlzdE5hbWUobGlzdE5hbWUpLCBuZXdMaXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVwZGF0ZUxpc3RXaXRoRGV0YWlscyhlZGl0b3IuZG9tLCBsaXN0LCBkZXRhaWwpO1xuICAgICAgICBmaXJlTGlzdEV2ZW50KGVkaXRvciwgbGlzdFRvZ2dsZUFjdGlvbkZyb21MaXN0TmFtZShsaXN0TmFtZSksIGxpc3QpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHRvZ2dsZU11bHRpcGxlTGlzdHMgPSBmdW5jdGlvbiAoZWRpdG9yLCBwYXJlbnRMaXN0LCBsaXN0cywgbGlzdE5hbWUsIGRldGFpbCkge1xuICAgICAgdmFyIHBhcmVudElzTGlzdCA9IGlzTGlzdE5vZGUocGFyZW50TGlzdCk7XG4gICAgICBpZiAocGFyZW50SXNMaXN0ICYmIHBhcmVudExpc3Qubm9kZU5hbWUgPT09IGxpc3ROYW1lICYmICFoYXNMaXN0U3R5bGVEZXRhaWwoZGV0YWlsKSkge1xuICAgICAgICBmbGF0dGVuTGlzdFNlbGVjdGlvbihlZGl0b3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXBwbHlMaXN0KGVkaXRvciwgbGlzdE5hbWUsIGRldGFpbCk7XG4gICAgICAgIHZhciBib29rbWFyayA9IGNyZWF0ZUJvb2ttYXJrKGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKHRydWUpKTtcbiAgICAgICAgdmFyIGFsbExpc3RzID0gcGFyZW50SXNMaXN0ID8gX19zcHJlYWRBcnJheXMoW3BhcmVudExpc3RdLCBsaXN0cykgOiBsaXN0cztcbiAgICAgICAgZ2xvYmFsJDUuZWFjaChhbGxMaXN0cywgZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICAgIHVwZGF0ZUxpc3QoZWRpdG9yLCBlbG0sIGxpc3ROYW1lLCBkZXRhaWwpO1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocmVzb2x2ZUJvb2ttYXJrKGJvb2ttYXJrKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaGFzTGlzdFN0eWxlRGV0YWlsID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuICdsaXN0LXN0eWxlLXR5cGUnIGluIGRldGFpbDtcbiAgICB9O1xuICAgIHZhciB0b2dnbGVTaW5nbGVMaXN0ID0gZnVuY3Rpb24gKGVkaXRvciwgcGFyZW50TGlzdCwgbGlzdE5hbWUsIGRldGFpbCkge1xuICAgICAgaWYgKHBhcmVudExpc3QgPT09IGVkaXRvci5nZXRCb2R5KCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmVudExpc3QpIHtcbiAgICAgICAgaWYgKHBhcmVudExpc3Qubm9kZU5hbWUgPT09IGxpc3ROYW1lICYmICFoYXNMaXN0U3R5bGVEZXRhaWwoZGV0YWlsKSAmJiAhaXNDdXN0b21MaXN0KHBhcmVudExpc3QpKSB7XG4gICAgICAgICAgZmxhdHRlbkxpc3RTZWxlY3Rpb24oZWRpdG9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgYm9va21hcmsgPSBjcmVhdGVCb29rbWFyayhlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZyh0cnVlKSk7XG4gICAgICAgICAgdXBkYXRlTGlzdFdpdGhEZXRhaWxzKGVkaXRvci5kb20sIHBhcmVudExpc3QsIGRldGFpbCk7XG4gICAgICAgICAgdmFyIG5ld0xpc3QgPSBlZGl0b3IuZG9tLnJlbmFtZShwYXJlbnRMaXN0LCBsaXN0TmFtZSk7XG4gICAgICAgICAgbWVyZ2VXaXRoQWRqYWNlbnRMaXN0cyhlZGl0b3IuZG9tLCBuZXdMaXN0KTtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhyZXNvbHZlQm9va21hcmsoYm9va21hcmspKTtcbiAgICAgICAgICBhcHBseUxpc3QoZWRpdG9yLCBsaXN0TmFtZSwgZGV0YWlsKTtcbiAgICAgICAgICBmaXJlTGlzdEV2ZW50KGVkaXRvciwgbGlzdFRvZ2dsZUFjdGlvbkZyb21MaXN0TmFtZShsaXN0TmFtZSksIG5ld0xpc3QpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcHBseUxpc3QoZWRpdG9yLCBsaXN0TmFtZSwgZGV0YWlsKTtcbiAgICAgICAgZmlyZUxpc3RFdmVudChlZGl0b3IsIGxpc3RUb2dnbGVBY3Rpb25Gcm9tTGlzdE5hbWUobGlzdE5hbWUpLCBwYXJlbnRMaXN0KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB0b2dnbGVMaXN0ID0gZnVuY3Rpb24gKGVkaXRvciwgbGlzdE5hbWUsIF9kZXRhaWwpIHtcbiAgICAgIHZhciBwYXJlbnRMaXN0ID0gZ2V0UGFyZW50TGlzdChlZGl0b3IpO1xuICAgICAgdmFyIHNlbGVjdGVkU3ViTGlzdHMgPSBnZXRTZWxlY3RlZFN1Ykxpc3RzKGVkaXRvcik7XG4gICAgICB2YXIgZGV0YWlsID0gaXNPYmplY3QoX2RldGFpbCkgPyBfZGV0YWlsIDoge307XG4gICAgICBpZiAoc2VsZWN0ZWRTdWJMaXN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRvZ2dsZU11bHRpcGxlTGlzdHMoZWRpdG9yLCBwYXJlbnRMaXN0LCBzZWxlY3RlZFN1Ykxpc3RzLCBsaXN0TmFtZSwgZGV0YWlsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvZ2dsZVNpbmdsZUxpc3QoZWRpdG9yLCBwYXJlbnRMaXN0LCBsaXN0TmFtZSwgZGV0YWlsKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIERPTSQyID0gZ2xvYmFsJDQuRE9NO1xuICAgIHZhciBub3JtYWxpemVMaXN0ID0gZnVuY3Rpb24gKGRvbSwgdWwpIHtcbiAgICAgIHZhciBzaWJsaW5nO1xuICAgICAgdmFyIHBhcmVudE5vZGUgPSB1bC5wYXJlbnROb2RlO1xuICAgICAgaWYgKHBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdMSScgJiYgcGFyZW50Tm9kZS5maXJzdENoaWxkID09PSB1bCkge1xuICAgICAgICBzaWJsaW5nID0gcGFyZW50Tm9kZS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgIGlmIChzaWJsaW5nICYmIHNpYmxpbmcubm9kZU5hbWUgPT09ICdMSScpIHtcbiAgICAgICAgICBzaWJsaW5nLmFwcGVuZENoaWxkKHVsKTtcbiAgICAgICAgICBpZiAoaXNFbXB0eSQxKGRvbSwgcGFyZW50Tm9kZSkpIHtcbiAgICAgICAgICAgIERPTSQyLnJlbW92ZShwYXJlbnROb2RlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgRE9NJDIuc2V0U3R5bGUocGFyZW50Tm9kZSwgJ2xpc3RTdHlsZVR5cGUnLCAnbm9uZScpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoaXNMaXN0Tm9kZShwYXJlbnROb2RlKSkge1xuICAgICAgICBzaWJsaW5nID0gcGFyZW50Tm9kZS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgIGlmIChzaWJsaW5nICYmIHNpYmxpbmcubm9kZU5hbWUgPT09ICdMSScpIHtcbiAgICAgICAgICBzaWJsaW5nLmFwcGVuZENoaWxkKHVsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZUxpc3RzID0gZnVuY3Rpb24gKGRvbSwgZWxlbWVudCkge1xuICAgICAgZ2xvYmFsJDUuZWFjaChnbG9iYWwkNS5ncmVwKGRvbS5zZWxlY3QoJ29sLHVsJywgZWxlbWVudCkpLCBmdW5jdGlvbiAodWwpIHtcbiAgICAgICAgbm9ybWFsaXplTGlzdChkb20sIHVsKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZmluZE5leHRDYXJldENvbnRhaW5lciA9IGZ1bmN0aW9uIChlZGl0b3IsIHJuZywgaXNGb3J3YXJkLCByb290KSB7XG4gICAgICB2YXIgbm9kZSA9IHJuZy5zdGFydENvbnRhaW5lcjtcbiAgICAgIHZhciBvZmZzZXQgPSBybmcuc3RhcnRPZmZzZXQ7XG4gICAgICBpZiAoaXNUZXh0Tm9kZShub2RlKSAmJiAoaXNGb3J3YXJkID8gb2Zmc2V0IDwgbm9kZS5kYXRhLmxlbmd0aCA6IG9mZnNldCA+IDApKSB7XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgICAgfVxuICAgICAgdmFyIG5vbkVtcHR5QmxvY2tzID0gZWRpdG9yLnNjaGVtYS5nZXROb25FbXB0eUVsZW1lbnRzKCk7XG4gICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICBub2RlID0gZ2xvYmFsJDEuZ2V0Tm9kZShub2RlLCBvZmZzZXQpO1xuICAgICAgfVxuICAgICAgdmFyIHdhbGtlciA9IG5ldyBnbG9iYWwkMihub2RlLCByb290KTtcbiAgICAgIGlmIChpc0ZvcndhcmQpIHtcbiAgICAgICAgaWYgKGlzQm9ndXNCcihlZGl0b3IuZG9tLCBub2RlKSkge1xuICAgICAgICAgIHdhbGtlci5uZXh0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHdoaWxlIChub2RlID0gd2Fsa2VyW2lzRm9yd2FyZCA/ICduZXh0JyA6ICdwcmV2MiddKCkpIHtcbiAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09ICdMSScgJiYgIW5vZGUuaGFzQ2hpbGROb2RlcygpKSB7XG4gICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vbkVtcHR5QmxvY2tzW25vZGUubm9kZU5hbWVdKSB7XG4gICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzVGV4dE5vZGUobm9kZSkgJiYgbm9kZS5kYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGhhc09ubHlPbmVCbG9ja0NoaWxkID0gZnVuY3Rpb24gKGRvbSwgZWxtKSB7XG4gICAgICB2YXIgY2hpbGROb2RlcyA9IGVsbS5jaGlsZE5vZGVzO1xuICAgICAgcmV0dXJuIGNoaWxkTm9kZXMubGVuZ3RoID09PSAxICYmICFpc0xpc3ROb2RlKGNoaWxkTm9kZXNbMF0pICYmIGRvbS5pc0Jsb2NrKGNoaWxkTm9kZXNbMF0pO1xuICAgIH07XG4gICAgdmFyIHVud3JhcFNpbmdsZUJsb2NrQ2hpbGQgPSBmdW5jdGlvbiAoZG9tLCBlbG0pIHtcbiAgICAgIGlmIChoYXNPbmx5T25lQmxvY2tDaGlsZChkb20sIGVsbSkpIHtcbiAgICAgICAgZG9tLnJlbW92ZShlbG0uZmlyc3RDaGlsZCwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbW92ZUNoaWxkcmVuID0gZnVuY3Rpb24gKGRvbSwgZnJvbUVsbSwgdG9FbG0pIHtcbiAgICAgIHZhciBub2RlO1xuICAgICAgdmFyIHRhcmdldEVsbSA9IGhhc09ubHlPbmVCbG9ja0NoaWxkKGRvbSwgdG9FbG0pID8gdG9FbG0uZmlyc3RDaGlsZCA6IHRvRWxtO1xuICAgICAgdW53cmFwU2luZ2xlQmxvY2tDaGlsZChkb20sIGZyb21FbG0pO1xuICAgICAgaWYgKCFpc0VtcHR5JDEoZG9tLCBmcm9tRWxtLCB0cnVlKSkge1xuICAgICAgICB3aGlsZSAobm9kZSA9IGZyb21FbG0uZmlyc3RDaGlsZCkge1xuICAgICAgICAgIHRhcmdldEVsbS5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG1lcmdlTGlFbGVtZW50cyA9IGZ1bmN0aW9uIChkb20sIGZyb21FbG0sIHRvRWxtKSB7XG4gICAgICB2YXIgbGlzdE5vZGU7XG4gICAgICB2YXIgdWwgPSBmcm9tRWxtLnBhcmVudE5vZGU7XG4gICAgICBpZiAoIWlzQ2hpbGRPZkJvZHkoZG9tLCBmcm9tRWxtKSB8fCAhaXNDaGlsZE9mQm9keShkb20sIHRvRWxtKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoaXNMaXN0Tm9kZSh0b0VsbS5sYXN0Q2hpbGQpKSB7XG4gICAgICAgIGxpc3ROb2RlID0gdG9FbG0ubGFzdENoaWxkO1xuICAgICAgfVxuICAgICAgaWYgKHVsID09PSB0b0VsbS5sYXN0Q2hpbGQpIHtcbiAgICAgICAgaWYgKGlzQnIodWwucHJldmlvdXNTaWJsaW5nKSkge1xuICAgICAgICAgIGRvbS5yZW1vdmUodWwucHJldmlvdXNTaWJsaW5nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIG5vZGUgPSB0b0VsbS5sYXN0Q2hpbGQ7XG4gICAgICBpZiAobm9kZSAmJiBpc0JyKG5vZGUpICYmIGZyb21FbG0uaGFzQ2hpbGROb2RlcygpKSB7XG4gICAgICAgIGRvbS5yZW1vdmUobm9kZSk7XG4gICAgICB9XG4gICAgICBpZiAoaXNFbXB0eSQxKGRvbSwgdG9FbG0sIHRydWUpKSB7XG4gICAgICAgIGRvbS4kKHRvRWxtKS5lbXB0eSgpO1xuICAgICAgfVxuICAgICAgbW92ZUNoaWxkcmVuKGRvbSwgZnJvbUVsbSwgdG9FbG0pO1xuICAgICAgaWYgKGxpc3ROb2RlKSB7XG4gICAgICAgIHRvRWxtLmFwcGVuZENoaWxkKGxpc3ROb2RlKTtcbiAgICAgIH1cbiAgICAgIHZhciBjb250YWlucyA9IGNvbnRhaW5zJDEoU3VnYXJFbGVtZW50LmZyb21Eb20odG9FbG0pLCBTdWdhckVsZW1lbnQuZnJvbURvbShmcm9tRWxtKSk7XG4gICAgICB2YXIgbmVzdGVkTGlzdHMgPSBjb250YWlucyA/IGRvbS5nZXRQYXJlbnRzKGZyb21FbG0sIGlzTGlzdE5vZGUsIHRvRWxtKSA6IFtdO1xuICAgICAgZG9tLnJlbW92ZShmcm9tRWxtKTtcbiAgICAgIGVhY2gobmVzdGVkTGlzdHMsIGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgICAgIGlmIChpc0VtcHR5JDEoZG9tLCBsaXN0KSAmJiBsaXN0ICE9PSBkb20uZ2V0Um9vdCgpKSB7XG4gICAgICAgICAgZG9tLnJlbW92ZShsaXN0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWVyZ2VJbnRvRW1wdHlMaSA9IGZ1bmN0aW9uIChlZGl0b3IsIGZyb21MaSwgdG9MaSkge1xuICAgICAgZWRpdG9yLmRvbS4kKHRvTGkpLmVtcHR5KCk7XG4gICAgICBtZXJnZUxpRWxlbWVudHMoZWRpdG9yLmRvbSwgZnJvbUxpLCB0b0xpKTtcbiAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24odG9MaSwgMCk7XG4gICAgfTtcbiAgICB2YXIgbWVyZ2VGb3J3YXJkID0gZnVuY3Rpb24gKGVkaXRvciwgcm5nLCBmcm9tTGksIHRvTGkpIHtcbiAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tO1xuICAgICAgaWYgKGRvbS5pc0VtcHR5KHRvTGkpKSB7XG4gICAgICAgIG1lcmdlSW50b0VtcHR5TGkoZWRpdG9yLCBmcm9tTGksIHRvTGkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGJvb2ttYXJrID0gY3JlYXRlQm9va21hcmsocm5nKTtcbiAgICAgICAgbWVyZ2VMaUVsZW1lbnRzKGRvbSwgZnJvbUxpLCB0b0xpKTtcbiAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocmVzb2x2ZUJvb2ttYXJrKGJvb2ttYXJrKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbWVyZ2VCYWNrd2FyZCA9IGZ1bmN0aW9uIChlZGl0b3IsIHJuZywgZnJvbUxpLCB0b0xpKSB7XG4gICAgICB2YXIgYm9va21hcmsgPSBjcmVhdGVCb29rbWFyayhybmcpO1xuICAgICAgbWVyZ2VMaUVsZW1lbnRzKGVkaXRvci5kb20sIGZyb21MaSwgdG9MaSk7XG4gICAgICB2YXIgcmVzb2x2ZWRCb29rbWFyayA9IHJlc29sdmVCb29rbWFyayhib29rbWFyayk7XG4gICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhyZXNvbHZlZEJvb2ttYXJrKTtcbiAgICB9O1xuICAgIHZhciBiYWNrc3BhY2VEZWxldGVGcm9tTGlzdFRvTGlzdENhcmV0ID0gZnVuY3Rpb24gKGVkaXRvciwgaXNGb3J3YXJkKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbSwgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjtcbiAgICAgIHZhciBzZWxlY3Rpb25TdGFydEVsbSA9IHNlbGVjdGlvbi5nZXRTdGFydCgpO1xuICAgICAgdmFyIHJvb3QgPSBnZXRDbG9zZXN0TGlzdFJvb3RFbG0oZWRpdG9yLCBzZWxlY3Rpb25TdGFydEVsbSk7XG4gICAgICB2YXIgbGkgPSBkb20uZ2V0UGFyZW50KHNlbGVjdGlvbi5nZXRTdGFydCgpLCAnTEknLCByb290KTtcbiAgICAgIGlmIChsaSkge1xuICAgICAgICB2YXIgdWwgPSBsaS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodWwgPT09IGVkaXRvci5nZXRCb2R5KCkgJiYgaXNFbXB0eSQxKGRvbSwgdWwpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJuZ18xID0gbm9ybWFsaXplUmFuZ2Uoc2VsZWN0aW9uLmdldFJuZygpKTtcbiAgICAgICAgdmFyIG90aGVyTGlfMSA9IGRvbS5nZXRQYXJlbnQoZmluZE5leHRDYXJldENvbnRhaW5lcihlZGl0b3IsIHJuZ18xLCBpc0ZvcndhcmQsIHJvb3QpLCAnTEknLCByb290KTtcbiAgICAgICAgaWYgKG90aGVyTGlfMSAmJiBvdGhlckxpXzEgIT09IGxpKSB7XG4gICAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChpc0ZvcndhcmQpIHtcbiAgICAgICAgICAgICAgbWVyZ2VGb3J3YXJkKGVkaXRvciwgcm5nXzEsIG90aGVyTGlfMSwgbGkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKGlzRmlyc3RDaGlsZChsaSkpIHtcbiAgICAgICAgICAgICAgICBvdXRkZW50TGlzdFNlbGVjdGlvbihlZGl0b3IpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1lcmdlQmFja3dhcmQoZWRpdG9yLCBybmdfMSwgbGksIG90aGVyTGlfMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmICghb3RoZXJMaV8xKSB7XG4gICAgICAgICAgaWYgKCFpc0ZvcndhcmQgJiYgcm5nXzEuc3RhcnRPZmZzZXQgPT09IDAgJiYgcm5nXzEuZW5kT2Zmc2V0ID09PSAwKSB7XG4gICAgICAgICAgICBlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBmbGF0dGVuTGlzdFNlbGVjdGlvbihlZGl0b3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHZhciByZW1vdmVCbG9jayA9IGZ1bmN0aW9uIChkb20sIGJsb2NrLCByb290KSB7XG4gICAgICB2YXIgcGFyZW50QmxvY2sgPSBkb20uZ2V0UGFyZW50KGJsb2NrLnBhcmVudE5vZGUsIGRvbS5pc0Jsb2NrLCByb290KTtcbiAgICAgIGRvbS5yZW1vdmUoYmxvY2spO1xuICAgICAgaWYgKHBhcmVudEJsb2NrICYmIGRvbS5pc0VtcHR5KHBhcmVudEJsb2NrKSkge1xuICAgICAgICBkb20ucmVtb3ZlKHBhcmVudEJsb2NrKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBiYWNrc3BhY2VEZWxldGVJbnRvTGlzdENhcmV0ID0gZnVuY3Rpb24gKGVkaXRvciwgaXNGb3J3YXJkKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBzZWxlY3Rpb25TdGFydEVsbSA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKTtcbiAgICAgIHZhciByb290ID0gZ2V0Q2xvc2VzdExpc3RSb290RWxtKGVkaXRvciwgc2VsZWN0aW9uU3RhcnRFbG0pO1xuICAgICAgdmFyIGJsb2NrID0gZG9tLmdldFBhcmVudChzZWxlY3Rpb25TdGFydEVsbSwgZG9tLmlzQmxvY2ssIHJvb3QpO1xuICAgICAgaWYgKGJsb2NrICYmIGRvbS5pc0VtcHR5KGJsb2NrKSkge1xuICAgICAgICB2YXIgcm5nID0gbm9ybWFsaXplUmFuZ2UoZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKSk7XG4gICAgICAgIHZhciBvdGhlckxpXzIgPSBkb20uZ2V0UGFyZW50KGZpbmROZXh0Q2FyZXRDb250YWluZXIoZWRpdG9yLCBybmcsIGlzRm9yd2FyZCwgcm9vdCksICdMSScsIHJvb3QpO1xuICAgICAgICBpZiAob3RoZXJMaV8yKSB7XG4gICAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlbW92ZUJsb2NrKGRvbSwgYmxvY2ssIHJvb3QpO1xuICAgICAgICAgICAgbWVyZ2VXaXRoQWRqYWNlbnRMaXN0cyhkb20sIG90aGVyTGlfMi5wYXJlbnROb2RlKTtcbiAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2VsZWN0KG90aGVyTGlfMiwgdHJ1ZSk7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLmNvbGxhcHNlKGlzRm9yd2FyZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBiYWNrc3BhY2VEZWxldGVDYXJldCA9IGZ1bmN0aW9uIChlZGl0b3IsIGlzRm9yd2FyZCkge1xuICAgICAgcmV0dXJuIGJhY2tzcGFjZURlbGV0ZUZyb21MaXN0VG9MaXN0Q2FyZXQoZWRpdG9yLCBpc0ZvcndhcmQpIHx8IGJhY2tzcGFjZURlbGV0ZUludG9MaXN0Q2FyZXQoZWRpdG9yLCBpc0ZvcndhcmQpO1xuICAgIH07XG4gICAgdmFyIGJhY2tzcGFjZURlbGV0ZVJhbmdlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHNlbGVjdGlvblN0YXJ0RWxtID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRTdGFydCgpO1xuICAgICAgdmFyIHJvb3QgPSBnZXRDbG9zZXN0TGlzdFJvb3RFbG0oZWRpdG9yLCBzZWxlY3Rpb25TdGFydEVsbSk7XG4gICAgICB2YXIgc3RhcnRMaXN0UGFyZW50ID0gZWRpdG9yLmRvbS5nZXRQYXJlbnQoc2VsZWN0aW9uU3RhcnRFbG0sICdMSSxEVCxERCcsIHJvb3QpO1xuICAgICAgaWYgKHN0YXJ0TGlzdFBhcmVudCB8fCBnZXRTZWxlY3RlZExpc3RJdGVtcyhlZGl0b3IpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ0RlbGV0ZScpO1xuICAgICAgICAgIG5vcm1hbGl6ZUxpc3RzKGVkaXRvci5kb20sIGVkaXRvci5nZXRCb2R5KCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICB2YXIgYmFja3NwYWNlRGVsZXRlID0gZnVuY3Rpb24gKGVkaXRvciwgaXNGb3J3YXJkKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLnNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpID8gYmFja3NwYWNlRGVsZXRlQ2FyZXQoZWRpdG9yLCBpc0ZvcndhcmQpIDogYmFja3NwYWNlRGVsZXRlUmFuZ2UoZWRpdG9yKTtcbiAgICB9O1xuICAgIHZhciBzZXR1cCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGVkaXRvci5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IGdsb2JhbCQzLkJBQ0tTUEFDRSkge1xuICAgICAgICAgIGlmIChiYWNrc3BhY2VEZWxldGUoZWRpdG9yLCBmYWxzZSkpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBnbG9iYWwkMy5ERUxFVEUpIHtcbiAgICAgICAgICBpZiAoYmFja3NwYWNlRGVsZXRlKGVkaXRvciwgdHJ1ZSkpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0JDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBiYWNrc3BhY2VEZWxldGU6IGZ1bmN0aW9uIChpc0ZvcndhcmQpIHtcbiAgICAgICAgICBiYWNrc3BhY2VEZWxldGUoZWRpdG9yLCBpc0ZvcndhcmQpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgdXBkYXRlTGlzdCQxID0gZnVuY3Rpb24gKGVkaXRvciwgdXBkYXRlKSB7XG4gICAgICB2YXIgcGFyZW50TGlzdCA9IGdldFBhcmVudExpc3QoZWRpdG9yKTtcbiAgICAgIGVkaXRvci51bmRvTWFuYWdlci50cmFuc2FjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChpc09iamVjdCh1cGRhdGUuc3R5bGVzKSkge1xuICAgICAgICAgIGVkaXRvci5kb20uc2V0U3R5bGVzKHBhcmVudExpc3QsIHVwZGF0ZS5zdHlsZXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc09iamVjdCh1cGRhdGUuYXR0cnMpKSB7XG4gICAgICAgICAgZWFjaCQxKHVwZGF0ZS5hdHRycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgICAgIHJldHVybiBlZGl0b3IuZG9tLnNldEF0dHJpYihwYXJlbnRMaXN0LCBrLCB2KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBwYXJzZUFscGhhYmV0aWNCYXNlMjYgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgICB2YXIgY2hhcnMgPSByZXZlcnNlKHRyaW0oc3RyKS5zcGxpdCgnJykpO1xuICAgICAgdmFyIHZhbHVlcyA9IG1hcChjaGFycywgZnVuY3Rpb24gKGNoYXIsIGkpIHtcbiAgICAgICAgdmFyIGNoYXJWYWx1ZSA9IGNoYXIudG9VcHBlckNhc2UoKS5jaGFyQ29kZUF0KDApIC0gJ0EnLmNoYXJDb2RlQXQoMCkgKyAxO1xuICAgICAgICByZXR1cm4gTWF0aC5wb3coMjYsIGkpICogY2hhclZhbHVlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZm9sZGwodmFsdWVzLCBmdW5jdGlvbiAoc3VtLCB2KSB7XG4gICAgICAgIHJldHVybiBzdW0gKyB2O1xuICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICB2YXIgY29tcG9zZUFscGhhYmV0aWNCYXNlMjYgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhbHVlLS07XG4gICAgICBpZiAodmFsdWUgPCAwKSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByZW1haW5kZXIgPSB2YWx1ZSAlIDI2O1xuICAgICAgICB2YXIgcXVvdGllbnQgPSBNYXRoLmZsb29yKHZhbHVlIC8gMjYpO1xuICAgICAgICB2YXIgcmVzdCA9IGNvbXBvc2VBbHBoYWJldGljQmFzZTI2KHF1b3RpZW50KTtcbiAgICAgICAgdmFyIGNoYXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCdBJy5jaGFyQ29kZUF0KDApICsgcmVtYWluZGVyKTtcbiAgICAgICAgcmV0dXJuIHJlc3QgKyBjaGFyO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzVXBwZXJjYXNlID0gZnVuY3Rpb24gKHN0cikge1xuICAgICAgcmV0dXJuIC9eW0EtWl0rJC8udGVzdChzdHIpO1xuICAgIH07XG4gICAgdmFyIGlzTG93ZXJjYXNlID0gZnVuY3Rpb24gKHN0cikge1xuICAgICAgcmV0dXJuIC9eW2Etel0rJC8udGVzdChzdHIpO1xuICAgIH07XG4gICAgdmFyIGlzTnVtZXJpYyA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgIHJldHVybiAvXlswLTldKyQvLnRlc3Qoc3RyKTtcbiAgICB9O1xuICAgIHZhciBkZWR1Y2VMaXN0VHlwZSA9IGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgaWYgKGlzTnVtZXJpYyhzdGFydCkpIHtcbiAgICAgICAgcmV0dXJuIDI7XG4gICAgICB9IGVsc2UgaWYgKGlzVXBwZXJjYXNlKHN0YXJ0KSkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH0gZWxzZSBpZiAoaXNMb3dlcmNhc2Uoc3RhcnQpKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgfSBlbHNlIGlmIChpc0VtcHR5KHN0YXJ0KSkge1xuICAgICAgICByZXR1cm4gMztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiA0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHBhcnNlU3RhcnRWYWx1ZSA9IGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgc3dpdGNoIChkZWR1Y2VMaXN0VHlwZShzdGFydCkpIHtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgIGxpc3RTdHlsZVR5cGU6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgICBzdGFydDogc3RhcnRcbiAgICAgICAgfSk7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBsaXN0U3R5bGVUeXBlOiBPcHRpb25hbC5zb21lKCd1cHBlci1hbHBoYScpLFxuICAgICAgICAgIHN0YXJ0OiBwYXJzZUFscGhhYmV0aWNCYXNlMjYoc3RhcnQpLnRvU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBsaXN0U3R5bGVUeXBlOiBPcHRpb25hbC5zb21lKCdsb3dlci1hbHBoYScpLFxuICAgICAgICAgIHN0YXJ0OiBwYXJzZUFscGhhYmV0aWNCYXNlMjYoc3RhcnQpLnRvU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBsaXN0U3R5bGVUeXBlOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgICAgc3RhcnQ6ICcnXG4gICAgICAgIH0pO1xuICAgICAgY2FzZSA0OlxuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHBhcnNlRGV0YWlsID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgdmFyIHN0YXJ0ID0gcGFyc2VJbnQoZGV0YWlsLnN0YXJ0LCAxMCk7XG4gICAgICBpZiAoZGV0YWlsLmxpc3RTdHlsZVR5cGUuaXMoJ3VwcGVyLWFscGhhJykpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBvc2VBbHBoYWJldGljQmFzZTI2KHN0YXJ0KTtcbiAgICAgIH0gZWxzZSBpZiAoZGV0YWlsLmxpc3RTdHlsZVR5cGUuaXMoJ2xvd2VyLWFscGhhJykpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBvc2VBbHBoYWJldGljQmFzZTI2KHN0YXJ0KS50b0xvd2VyQ2FzZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRldGFpbC5zdGFydDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIG9wZW4gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgY3VycmVudExpc3QgPSBnZXRQYXJlbnRMaXN0KGVkaXRvcik7XG4gICAgICBpZiAoIWlzT2xOb2RlKGN1cnJlbnRMaXN0KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHtcbiAgICAgICAgdGl0bGU6ICdMaXN0IFByb3BlcnRpZXMnLFxuICAgICAgICBib2R5OiB7XG4gICAgICAgICAgdHlwZTogJ3BhbmVsJyxcbiAgICAgICAgICBpdGVtczogW3tcbiAgICAgICAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgICAgICAgbmFtZTogJ3N0YXJ0JyxcbiAgICAgICAgICAgICAgbGFiZWw6ICdTdGFydCBsaXN0IGF0IG51bWJlcicsXG4gICAgICAgICAgICAgIGlucHV0TW9kZTogJ251bWVyaWMnXG4gICAgICAgICAgICB9XVxuICAgICAgICB9LFxuICAgICAgICBpbml0aWFsRGF0YToge1xuICAgICAgICAgIHN0YXJ0OiBwYXJzZURldGFpbCh7XG4gICAgICAgICAgICBzdGFydDogZWRpdG9yLmRvbS5nZXRBdHRyaWIoY3VycmVudExpc3QsICdzdGFydCcsICcxJyksXG4gICAgICAgICAgICBsaXN0U3R5bGVUeXBlOiBPcHRpb25hbC5zb21lKGVkaXRvci5kb20uZ2V0U3R5bGUoY3VycmVudExpc3QsICdsaXN0LXN0eWxlLXR5cGUnKSlcbiAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2NhbmNlbCcsXG4gICAgICAgICAgICBuYW1lOiAnY2FuY2VsJyxcbiAgICAgICAgICAgIHRleHQ6ICdDYW5jZWwnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnc3VibWl0JyxcbiAgICAgICAgICAgIG5hbWU6ICdzYXZlJyxcbiAgICAgICAgICAgIHRleHQ6ICdTYXZlJyxcbiAgICAgICAgICAgIHByaW1hcnk6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIG9uU3VibWl0OiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgICAgIHBhcnNlU3RhcnRWYWx1ZShkYXRhLnN0YXJ0KS5lYWNoKGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICAgIGVkaXRvci5leGVjQ29tbWFuZCgnbWNlTGlzdFVwZGF0ZScsIGZhbHNlLCB7XG4gICAgICAgICAgICAgIGF0dHJzOiB7IHN0YXJ0OiBkZXRhaWwuc3RhcnQgPT09ICcxJyA/ICcnIDogZGV0YWlsLnN0YXJ0IH0sXG4gICAgICAgICAgICAgIHN0eWxlczogeyAnbGlzdC1zdHlsZS10eXBlJzogZGV0YWlsLmxpc3RTdHlsZVR5cGUuZ2V0T3IoJycpIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGFwaS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHF1ZXJ5TGlzdENvbW1hbmRTdGF0ZSA9IGZ1bmN0aW9uIChlZGl0b3IsIGxpc3ROYW1lKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFyZW50TGlzdCA9IGdldFBhcmVudExpc3QoZWRpdG9yKTtcbiAgICAgICAgcmV0dXJuIHBhcmVudExpc3QgJiYgcGFyZW50TGlzdC5ub2RlTmFtZSA9PT0gbGlzdE5hbWU7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyRGlhbG9nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLmFkZENvbW1hbmQoJ21jZUxpc3RQcm9wcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb3BlbihlZGl0b3IpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3Iub24oJ0JlZm9yZUV4ZWNDb21tYW5kJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGNtZCA9IGUuY29tbWFuZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoY21kID09PSAnaW5kZW50Jykge1xuICAgICAgICAgIGluZGVudExpc3RTZWxlY3Rpb24oZWRpdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChjbWQgPT09ICdvdXRkZW50Jykge1xuICAgICAgICAgIG91dGRlbnRMaXN0U2VsZWN0aW9uKGVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLmFkZENvbW1hbmQoJ0luc2VydFVub3JkZXJlZExpc3QnLCBmdW5jdGlvbiAodWksIGRldGFpbCkge1xuICAgICAgICB0b2dnbGVMaXN0KGVkaXRvciwgJ1VMJywgZGV0YWlsKTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLmFkZENvbW1hbmQoJ0luc2VydE9yZGVyZWRMaXN0JywgZnVuY3Rpb24gKHVpLCBkZXRhaWwpIHtcbiAgICAgICAgdG9nZ2xlTGlzdChlZGl0b3IsICdPTCcsIGRldGFpbCk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdJbnNlcnREZWZpbml0aW9uTGlzdCcsIGZ1bmN0aW9uICh1aSwgZGV0YWlsKSB7XG4gICAgICAgIHRvZ2dsZUxpc3QoZWRpdG9yLCAnREwnLCBkZXRhaWwpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IuYWRkQ29tbWFuZCgnUmVtb3ZlTGlzdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZmxhdHRlbkxpc3RTZWxlY3Rpb24oZWRpdG9yKTtcbiAgICAgIH0pO1xuICAgICAgcmVnaXN0ZXJEaWFsb2coZWRpdG9yKTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VMaXN0VXBkYXRlJywgZnVuY3Rpb24gKHVpLCBkZXRhaWwpIHtcbiAgICAgICAgaWYgKGlzT2JqZWN0KGRldGFpbCkpIHtcbiAgICAgICAgICB1cGRhdGVMaXN0JDEoZWRpdG9yLCBkZXRhaWwpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5hZGRRdWVyeVN0YXRlSGFuZGxlcignSW5zZXJ0VW5vcmRlcmVkTGlzdCcsIHF1ZXJ5TGlzdENvbW1hbmRTdGF0ZShlZGl0b3IsICdVTCcpKTtcbiAgICAgIGVkaXRvci5hZGRRdWVyeVN0YXRlSGFuZGxlcignSW5zZXJ0T3JkZXJlZExpc3QnLCBxdWVyeUxpc3RDb21tYW5kU3RhdGUoZWRpdG9yLCAnT0wnKSk7XG4gICAgICBlZGl0b3IuYWRkUXVlcnlTdGF0ZUhhbmRsZXIoJ0luc2VydERlZmluaXRpb25MaXN0JywgcXVlcnlMaXN0Q29tbWFuZFN0YXRlKGVkaXRvciwgJ0RMJykpO1xuICAgIH07XG5cbiAgICB2YXIgc2V0dXBUYWJLZXkgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3Iub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoZS5rZXlDb2RlICE9PSBnbG9iYWwkMy5UQUIgfHwgZ2xvYmFsJDMubWV0YUtleVByZXNzZWQoZSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoZS5zaGlmdEtleSA/IG91dGRlbnRMaXN0U2VsZWN0aW9uKGVkaXRvcikgOiBpbmRlbnRMaXN0U2VsZWN0aW9uKGVkaXRvcikpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0dXAkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGlmIChzaG91bGRJbmRlbnRPblRhYihlZGl0b3IpKSB7XG4gICAgICAgIHNldHVwVGFiS2V5KGVkaXRvcik7XG4gICAgICB9XG4gICAgICBzZXR1cChlZGl0b3IpO1xuICAgIH07XG5cbiAgICB2YXIgcmVnaXN0ZXIkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBleGVjID0gZnVuY3Rpb24gKGNvbW1hbmQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIGlmICghZWRpdG9yLmhhc1BsdWdpbignYWR2bGlzdCcpKSB7XG4gICAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24oJ251bWxpc3QnLCB7XG4gICAgICAgICAgaWNvbjogJ29yZGVyZWQtbGlzdCcsXG4gICAgICAgICAgYWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICB0b29sdGlwOiAnTnVtYmVyZWQgbGlzdCcsXG4gICAgICAgICAgb25BY3Rpb246IGV4ZWMoJ0luc2VydE9yZGVyZWRMaXN0JyksXG4gICAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgICAgcmV0dXJuIGxpc3RTdGF0ZShlZGl0b3IsICdPTCcsIGFwaS5zZXRBY3RpdmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24oJ2J1bGxpc3QnLCB7XG4gICAgICAgICAgaWNvbjogJ3Vub3JkZXJlZC1saXN0JyxcbiAgICAgICAgICBhY3RpdmU6IGZhbHNlLFxuICAgICAgICAgIHRvb2x0aXA6ICdCdWxsZXQgbGlzdCcsXG4gICAgICAgICAgb25BY3Rpb246IGV4ZWMoJ0luc2VydFVub3JkZXJlZExpc3QnKSxcbiAgICAgICAgICBvblNldHVwOiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdFN0YXRlKGVkaXRvciwgJ1VMJywgYXBpLnNldEFjdGl2ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHJlZ2lzdGVyJDIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgbGlzdFByb3BlcnRpZXMgPSB7XG4gICAgICAgIHRleHQ6ICdMaXN0IHByb3BlcnRpZXMuLi4nLFxuICAgICAgICBpY29uOiAnb3JkZXJlZC1saXN0JyxcbiAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VMaXN0UHJvcHMnKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgIHJldHVybiBsaXN0U3RhdGUoZWRpdG9yLCAnT0wnLCBmdW5jdGlvbiAoYWN0aXZlKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBpLnNldERpc2FibGVkKCFhY3RpdmUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCdsaXN0cHJvcHMnLCBsaXN0UHJvcGVydGllcyk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQ29udGV4dE1lbnUoJ2xpc3RzJywge1xuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgdmFyIHBhcmVudExpc3QgPSBnZXRQYXJlbnRMaXN0KGVkaXRvciwgbm9kZSk7XG4gICAgICAgICAgcmV0dXJuIGlzT2xOb2RlKHBhcmVudExpc3QpID8gWydsaXN0cHJvcHMnXSA6IFtdO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUGx1Z2luICgpIHtcbiAgICAgIGdsb2JhbC5hZGQoJ2xpc3RzJywgZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgICBpZiAoZWRpdG9yLmhhc1BsdWdpbigncnRjJywgdHJ1ZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgc2V0dXAkMShlZGl0b3IpO1xuICAgICAgICAgIHJlZ2lzdGVyKGVkaXRvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVnaXN0ZXJEaWFsb2coZWRpdG9yKTtcbiAgICAgICAgfVxuICAgICAgICByZWdpc3RlciQxKGVkaXRvcik7XG4gICAgICAgIHJlZ2lzdGVyJDIoZWRpdG9yKTtcbiAgICAgICAgcmV0dXJuIGdldCQxKGVkaXRvcik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBQbHVnaW4oKTtcblxufSgpKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7Ozs7Ozs7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBOztBIiwic291cmNlUm9vdCI6IiJ9