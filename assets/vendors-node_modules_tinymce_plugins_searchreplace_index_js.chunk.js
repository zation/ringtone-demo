(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_searchreplace_index_js"],{

/***/ "./node_modules/tinymce/plugins/searchreplace/index.js":
/*!*************************************************************!*\
  !*** ./node_modules/tinymce/plugins/searchreplace/index.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "searchreplace" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/searchreplace')
//   ES2015:
//     import 'tinymce/plugins/searchreplace'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/searchreplace/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/searchreplace/plugin.js":
/*!**************************************************************!*\
  !*** ./node_modules/tinymce/plugins/searchreplace/plugin.js ***!
  \**************************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var isString = isType('string');
    var isArray = isType('array');
    var isBoolean = isSimpleType('boolean');
    var isNumber = isSimpleType('number');

    var noop = function () {
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var never = constant(false);
    var always = constant(true);

    var punctuationStr = '[!-#%-*,-\\/:;?@\\[-\\]_{}\xA1\xAB\xB7\xBB\xBF;\xB7\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1361-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u3008\u3009\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30\u2E31\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uff3f\uFF5B\uFF5D\uFF5F-\uFF65]';

    var punctuation = constant(punctuationStr);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var punctuation$1 = punctuation;

    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var nativeSlice = Array.prototype.slice;
    var nativePush = Array.prototype.push;
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var eachr = function (xs, f) {
      for (var i = xs.length - 1; i >= 0; i--) {
        var x = xs[i];
        f(x, i);
      }
    };
    var groupBy = function (xs, f) {
      if (xs.length === 0) {
        return [];
      } else {
        var wasType = f(xs[0]);
        var r = [];
        var group = [];
        for (var i = 0, len = xs.length; i < len; i++) {
          var x = xs[i];
          var type = f(x);
          if (type !== wasType) {
            r.push(group);
            group = [];
          }
          wasType = type;
          group.push(x);
        }
        if (group.length !== 0) {
          r.push(group);
        }
        return r;
      }
    };
    var foldl = function (xs, f, acc) {
      each(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var bind = function (xs, f) {
      return flatten(map(xs, f));
    };
    var sort = function (xs, comparator) {
      var copy = nativeSlice.call(xs, 0);
      copy.sort(comparator);
      return copy;
    };

    var hasOwnProperty = Object.hasOwnProperty;
    var has = function (obj, key) {
      return hasOwnProperty.call(obj, key);
    };

    var Global = typeof window !== 'undefined' ? window : Function('return this;')();

    var DOCUMENT = 9;
    var DOCUMENT_FRAGMENT = 11;
    var ELEMENT = 1;
    var TEXT = 3;

    var type = function (element) {
      return element.dom.nodeType;
    };
    var isType$1 = function (t) {
      return function (element) {
        return type(element) === t;
      };
    };
    var isText = isType$1(TEXT);

    var rawSet = function (dom, key, value) {
      if (isString(value) || isBoolean(value) || isNumber(value)) {
        dom.setAttribute(key, value + '');
      } else {
        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);
        throw new Error('Attribute value was not simple');
      }
    };
    var set = function (element, key, value) {
      rawSet(element.dom, key, value);
    };

    var compareDocumentPosition = function (a, b, match) {
      return (a.compareDocumentPosition(b) & match) !== 0;
    };
    var documentPositionPreceding = function (a, b) {
      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_PRECEDING);
    };

    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw new Error('HTML must have a single root node');
      }
      return fromDom(div.childNodes[0]);
    };
    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };
    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };
    var fromDom = function (node) {
      if (node === null || node === undefined) {
        throw new Error('Node cannot be null or undefined');
      }
      return { dom: node };
    };
    var fromPoint = function (docElm, x, y) {
      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);
    };
    var SugarElement = {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom,
      fromPoint: fromPoint
    };

    var bypassSelector = function (dom) {
      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;
    };
    var all = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom;
      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);
    };

    var parent = function (element) {
      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);
    };
    var children = function (element) {
      return map(element.dom.childNodes, SugarElement.fromDom);
    };
    var spot = function (element, offset) {
      return {
        element: element,
        offset: offset
      };
    };
    var leaf = function (element, offset) {
      var cs = children(element);
      return cs.length > 0 && offset < cs.length ? spot(cs[offset], 0) : spot(element, offset);
    };

    var before = function (marker, element) {
      var parent$1 = parent(marker);
      parent$1.each(function (v) {
        v.dom.insertBefore(element.dom, marker.dom);
      });
    };
    var append = function (parent, element) {
      parent.dom.appendChild(element.dom);
    };
    var wrap = function (element, wrapper) {
      before(element, wrapper);
      append(wrapper, element);
    };

    var NodeValue = function (is, name) {
      var get = function (element) {
        if (!is(element)) {
          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');
        }
        return getOption(element).getOr('');
      };
      var getOption = function (element) {
        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();
      };
      var set = function (element, value) {
        if (!is(element)) {
          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');
        }
        element.dom.nodeValue = value;
      };
      return {
        get: get,
        getOption: getOption,
        set: set
      };
    };

    var api = NodeValue(isText, 'text');
    var get = function (element) {
      return api.get(element);
    };

    var descendants = function (scope, selector) {
      return all(selector, scope);
    };

    var global$2 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');

    var isSimpleBoundary = function (dom, node) {
      return dom.isBlock(node) || has(dom.schema.getShortEndedElements(), node.nodeName);
    };
    var isContentEditableFalse = function (dom, node) {
      return dom.getContentEditable(node) === 'false';
    };
    var isContentEditableTrueInCef = function (dom, node) {
      return dom.getContentEditable(node) === 'true' && dom.getContentEditableParent(node.parentNode) === 'false';
    };
    var isHidden = function (dom, node) {
      return !dom.isBlock(node) && has(dom.schema.getWhiteSpaceElements(), node.nodeName);
    };
    var isBoundary = function (dom, node) {
      return isSimpleBoundary(dom, node) || isContentEditableFalse(dom, node) || isHidden(dom, node) || isContentEditableTrueInCef(dom, node);
    };
    var isText$1 = function (node) {
      return node.nodeType === 3;
    };
    var nuSection = function () {
      return {
        sOffset: 0,
        fOffset: 0,
        elements: []
      };
    };
    var toLeaf = function (node, offset) {
      return leaf(SugarElement.fromDom(node), offset);
    };
    var walk = function (dom, walkerFn, startNode, callbacks, endNode, skipStart) {
      if (skipStart === void 0) {
        skipStart = true;
      }
      var next = skipStart ? walkerFn(false) : startNode;
      while (next) {
        var isCefNode = isContentEditableFalse(dom, next);
        if (isCefNode || isHidden(dom, next)) {
          var stopWalking = isCefNode ? callbacks.cef(next) : callbacks.boundary(next);
          if (stopWalking) {
            break;
          } else {
            next = walkerFn(true);
            continue;
          }
        } else if (isSimpleBoundary(dom, next)) {
          if (callbacks.boundary(next)) {
            break;
          }
        } else if (isText$1(next)) {
          callbacks.text(next);
        }
        if (next === endNode) {
          break;
        } else {
          next = walkerFn(false);
        }
      }
    };
    var collectTextToBoundary = function (dom, section, node, rootNode, forwards) {
      if (isBoundary(dom, node)) {
        return;
      }
      var rootBlock = dom.getParent(rootNode, dom.isBlock);
      var walker = new global$2(node, rootBlock);
      var walkerFn = forwards ? walker.next.bind(walker) : walker.prev.bind(walker);
      walk(dom, walkerFn, node, {
        boundary: always,
        cef: always,
        text: function (next) {
          if (forwards) {
            section.fOffset += next.length;
          } else {
            section.sOffset += next.length;
          }
          section.elements.push(SugarElement.fromDom(next));
        }
      });
    };
    var collect = function (dom, rootNode, startNode, endNode, callbacks, skipStart) {
      if (skipStart === void 0) {
        skipStart = true;
      }
      var walker = new global$2(startNode, rootNode);
      var sections = [];
      var current = nuSection();
      collectTextToBoundary(dom, current, startNode, rootNode, false);
      var finishSection = function () {
        if (current.elements.length > 0) {
          sections.push(current);
          current = nuSection();
        }
        return false;
      };
      walk(dom, walker.next.bind(walker), startNode, {
        boundary: finishSection,
        cef: function (node) {
          finishSection();
          if (callbacks) {
            sections.push.apply(sections, callbacks.cef(node));
          }
          return false;
        },
        text: function (next) {
          current.elements.push(SugarElement.fromDom(next));
          if (callbacks) {
            callbacks.text(next, current);
          }
        }
      }, endNode, skipStart);
      if (endNode) {
        collectTextToBoundary(dom, current, endNode, rootNode, true);
      }
      finishSection();
      return sections;
    };
    var collectRangeSections = function (dom, rng) {
      var start = toLeaf(rng.startContainer, rng.startOffset);
      var startNode = start.element.dom;
      var end = toLeaf(rng.endContainer, rng.endOffset);
      var endNode = end.element.dom;
      return collect(dom, rng.commonAncestorContainer, startNode, endNode, {
        text: function (node, section) {
          if (node === endNode) {
            section.fOffset += node.length - end.offset;
          } else if (node === startNode) {
            section.sOffset += start.offset;
          }
        },
        cef: function (node) {
          var sections = bind(descendants(SugarElement.fromDom(node), '*[contenteditable=true]'), function (e) {
            var ceTrueNode = e.dom;
            return collect(dom, ceTrueNode, ceTrueNode);
          });
          return sort(sections, function (a, b) {
            return documentPositionPreceding(a.elements[0].dom, b.elements[0].dom) ? 1 : -1;
          });
        }
      }, false);
    };
    var fromRng = function (dom, rng) {
      return rng.collapsed ? [] : collectRangeSections(dom, rng);
    };
    var fromNode = function (dom, node) {
      var rng = dom.createRng();
      rng.selectNode(node);
      return fromRng(dom, rng);
    };
    var fromNodes = function (dom, nodes) {
      return bind(nodes, function (node) {
        return fromNode(dom, node);
      });
    };

    var find = function (text, pattern, start, finish) {
      if (start === void 0) {
        start = 0;
      }
      if (finish === void 0) {
        finish = text.length;
      }
      var regex = pattern.regex;
      regex.lastIndex = start;
      var results = [];
      var match;
      while (match = regex.exec(text)) {
        var matchedText = match[pattern.matchIndex];
        var matchStart = match.index + match[0].indexOf(matchedText);
        var matchFinish = matchStart + matchedText.length;
        if (matchFinish > finish) {
          break;
        }
        results.push({
          start: matchStart,
          finish: matchFinish
        });
        regex.lastIndex = matchFinish;
      }
      return results;
    };
    var extract = function (elements, matches) {
      var nodePositions = foldl(elements, function (acc, element) {
        var content = get(element);
        var start = acc.last;
        var finish = start + content.length;
        var positions = bind(matches, function (match, matchIdx) {
          if (match.start < finish && match.finish > start) {
            return [{
                element: element,
                start: Math.max(start, match.start) - start,
                finish: Math.min(finish, match.finish) - start,
                matchId: matchIdx
              }];
          } else {
            return [];
          }
        });
        return {
          results: acc.results.concat(positions),
          last: finish
        };
      }, {
        results: [],
        last: 0
      }).results;
      return groupBy(nodePositions, function (position) {
        return position.matchId;
      });
    };

    var find$1 = function (pattern, sections) {
      return bind(sections, function (section) {
        var elements = section.elements;
        var content = map(elements, get).join('');
        var positions = find(content, pattern, section.sOffset, content.length - section.fOffset);
        return extract(elements, positions);
      });
    };
    var mark = function (matches, replacementNode) {
      eachr(matches, function (match, idx) {
        eachr(match, function (pos) {
          var wrapper = SugarElement.fromDom(replacementNode.cloneNode(false));
          set(wrapper, 'data-mce-index', idx);
          var textNode = pos.element.dom;
          if (textNode.length === pos.finish && pos.start === 0) {
            wrap(pos.element, wrapper);
          } else {
            if (textNode.length !== pos.finish) {
              textNode.splitText(pos.finish);
            }
            var matchNode = textNode.splitText(pos.start);
            wrap(SugarElement.fromDom(matchNode), wrapper);
          }
        });
      });
    };
    var findAndMark = function (dom, pattern, node, replacementNode) {
      var textSections = fromNode(dom, node);
      var matches = find$1(pattern, textSections);
      mark(matches, replacementNode);
      return matches.length;
    };
    var findAndMarkInSelection = function (dom, pattern, selection, replacementNode) {
      var bookmark = selection.getBookmark();
      var nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');
      var textSections = nodes.length > 0 ? fromNodes(dom, nodes) : fromRng(dom, selection.getRng());
      var matches = find$1(pattern, textSections);
      mark(matches, replacementNode);
      selection.moveToBookmark(bookmark);
      return matches.length;
    };

    var getElmIndex = function (elm) {
      var value = elm.getAttribute('data-mce-index');
      if (typeof value === 'number') {
        return '' + value;
      }
      return value;
    };
    var markAllMatches = function (editor, currentSearchState, pattern, inSelection) {
      var marker = editor.dom.create('span', { 'data-mce-bogus': 1 });
      marker.className = 'mce-match-marker';
      var node = editor.getBody();
      done(editor, currentSearchState, false);
      if (inSelection) {
        return findAndMarkInSelection(editor.dom, pattern, editor.selection, marker);
      } else {
        return findAndMark(editor.dom, pattern, node, marker);
      }
    };
    var unwrap = function (node) {
      var parentNode = node.parentNode;
      if (node.firstChild) {
        parentNode.insertBefore(node.firstChild, node);
      }
      node.parentNode.removeChild(node);
    };
    var findSpansByIndex = function (editor, index) {
      var spans = [];
      var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));
      if (nodes.length) {
        for (var i = 0; i < nodes.length; i++) {
          var nodeIndex = getElmIndex(nodes[i]);
          if (nodeIndex === null || !nodeIndex.length) {
            continue;
          }
          if (nodeIndex === index.toString()) {
            spans.push(nodes[i]);
          }
        }
      }
      return spans;
    };
    var moveSelection = function (editor, currentSearchState, forward) {
      var searchState = currentSearchState.get();
      var testIndex = searchState.index;
      var dom = editor.dom;
      forward = forward !== false;
      if (forward) {
        if (testIndex + 1 === searchState.count) {
          testIndex = 0;
        } else {
          testIndex++;
        }
      } else {
        if (testIndex - 1 === -1) {
          testIndex = searchState.count - 1;
        } else {
          testIndex--;
        }
      }
      dom.removeClass(findSpansByIndex(editor, searchState.index), 'mce-match-marker-selected');
      var spans = findSpansByIndex(editor, testIndex);
      if (spans.length) {
        dom.addClass(findSpansByIndex(editor, testIndex), 'mce-match-marker-selected');
        editor.selection.scrollIntoView(spans[0]);
        return testIndex;
      }
      return -1;
    };
    var removeNode = function (dom, node) {
      var parent = node.parentNode;
      dom.remove(node);
      if (dom.isEmpty(parent)) {
        dom.remove(parent);
      }
    };
    var escapeSearchText = function (text, wholeWord) {
      var escapedText = text.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&').replace(/\s/g, '[^\\S\\r\\n\\uFEFF]');
      var wordRegex = '(' + escapedText + ')';
      return wholeWord ? '(?:^|\\s|' + punctuation$1() + ')' + wordRegex + ('(?=$|\\s|' + punctuation$1() + ')') : wordRegex;
    };
    var find$2 = function (editor, currentSearchState, text, matchCase, wholeWord, inSelection) {
      var escapedText = escapeSearchText(text, wholeWord);
      var pattern = {
        regex: new RegExp(escapedText, matchCase ? 'g' : 'gi'),
        matchIndex: 1
      };
      var count = markAllMatches(editor, currentSearchState, pattern, inSelection);
      if (count) {
        var newIndex = moveSelection(editor, currentSearchState, true);
        currentSearchState.set({
          index: newIndex,
          count: count,
          text: text,
          matchCase: matchCase,
          wholeWord: wholeWord,
          inSelection: inSelection
        });
      }
      return count;
    };
    var next = function (editor, currentSearchState) {
      var index = moveSelection(editor, currentSearchState, true);
      currentSearchState.set(__assign(__assign({}, currentSearchState.get()), { index: index }));
    };
    var prev = function (editor, currentSearchState) {
      var index = moveSelection(editor, currentSearchState, false);
      currentSearchState.set(__assign(__assign({}, currentSearchState.get()), { index: index }));
    };
    var isMatchSpan = function (node) {
      var matchIndex = getElmIndex(node);
      return matchIndex !== null && matchIndex.length > 0;
    };
    var replace = function (editor, currentSearchState, text, forward, all) {
      var searchState = currentSearchState.get();
      var currentIndex = searchState.index;
      var currentMatchIndex, nextIndex = currentIndex;
      forward = forward !== false;
      var node = editor.getBody();
      var nodes = global$1.grep(global$1.toArray(node.getElementsByTagName('span')), isMatchSpan);
      for (var i = 0; i < nodes.length; i++) {
        var nodeIndex = getElmIndex(nodes[i]);
        var matchIndex = currentMatchIndex = parseInt(nodeIndex, 10);
        if (all || matchIndex === searchState.index) {
          if (text.length) {
            nodes[i].firstChild.nodeValue = text;
            unwrap(nodes[i]);
          } else {
            removeNode(editor.dom, nodes[i]);
          }
          while (nodes[++i]) {
            matchIndex = parseInt(getElmIndex(nodes[i]), 10);
            if (matchIndex === currentMatchIndex) {
              removeNode(editor.dom, nodes[i]);
            } else {
              i--;
              break;
            }
          }
          if (forward) {
            nextIndex--;
          }
        } else if (currentMatchIndex > currentIndex) {
          nodes[i].setAttribute('data-mce-index', String(currentMatchIndex - 1));
        }
      }
      currentSearchState.set(__assign(__assign({}, searchState), {
        count: all ? 0 : searchState.count - 1,
        index: nextIndex
      }));
      if (forward) {
        next(editor, currentSearchState);
      } else {
        prev(editor, currentSearchState);
      }
      return !all && currentSearchState.get().count > 0;
    };
    var done = function (editor, currentSearchState, keepEditorSelection) {
      var i, startContainer, endContainer;
      var searchState = currentSearchState.get();
      var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));
      for (i = 0; i < nodes.length; i++) {
        var nodeIndex = getElmIndex(nodes[i]);
        if (nodeIndex !== null && nodeIndex.length) {
          if (nodeIndex === searchState.index.toString()) {
            if (!startContainer) {
              startContainer = nodes[i].firstChild;
            }
            endContainer = nodes[i].firstChild;
          }
          unwrap(nodes[i]);
        }
      }
      currentSearchState.set(__assign(__assign({}, searchState), {
        index: -1,
        count: 0,
        text: ''
      }));
      if (startContainer && endContainer) {
        var rng = editor.dom.createRng();
        rng.setStart(startContainer, 0);
        rng.setEnd(endContainer, endContainer.data.length);
        if (keepEditorSelection !== false) {
          editor.selection.setRng(rng);
        }
        return rng;
      }
    };
    var hasNext = function (editor, currentSearchState) {
      return currentSearchState.get().count > 1;
    };
    var hasPrev = function (editor, currentSearchState) {
      return currentSearchState.get().count > 1;
    };

    var get$1 = function (editor, currentState) {
      var done$1 = function (keepEditorSelection) {
        return done(editor, currentState, keepEditorSelection);
      };
      var find = function (text, matchCase, wholeWord, inSelection) {
        if (inSelection === void 0) {
          inSelection = false;
        }
        return find$2(editor, currentState, text, matchCase, wholeWord, inSelection);
      };
      var next$1 = function () {
        return next(editor, currentState);
      };
      var prev$1 = function () {
        return prev(editor, currentState);
      };
      var replace$1 = function (text, forward, all) {
        return replace(editor, currentState, text, forward, all);
      };
      return {
        done: done$1,
        find: find,
        next: next$1,
        prev: prev$1,
        replace: replace$1
      };
    };

    var value = function () {
      var subject = Cell(Optional.none());
      var clear = function () {
        return subject.set(Optional.none());
      };
      var set = function (s) {
        return subject.set(Optional.some(s));
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var on = function (f) {
        return subject.get().each(f);
      };
      return {
        clear: clear,
        set: set,
        isSet: isSet,
        on: on
      };
    };

    var global$3 = tinymce.util.Tools.resolve('tinymce.Env');

    var open = function (editor, currentSearchState) {
      var dialogApi = value();
      editor.undoManager.add();
      var selectedText = global$1.trim(editor.selection.getContent({ format: 'text' }));
      var updateButtonStates = function (api) {
        var updateNext = hasNext(editor, currentSearchState) ? api.enable : api.disable;
        updateNext('next');
        var updatePrev = hasPrev(editor, currentSearchState) ? api.enable : api.disable;
        updatePrev('prev');
      };
      var updateSearchState = function (api) {
        var data = api.getData();
        var current = currentSearchState.get();
        currentSearchState.set(__assign(__assign({}, current), {
          matchCase: data.matchcase,
          wholeWord: data.wholewords,
          inSelection: data.inselection
        }));
      };
      var disableAll = function (api, disable) {
        var buttons = [
          'replace',
          'replaceall',
          'prev',
          'next'
        ];
        var toggle = disable ? api.disable : api.enable;
        each(buttons, toggle);
      };
      var notFoundAlert = function (api) {
        editor.windowManager.alert('Could not find the specified string.', function () {
          api.focus('findtext');
        });
      };
      var focusButtonIfRequired = function (api, name) {
        if (global$3.browser.isSafari() && global$3.deviceType.isTouch() && (name === 'find' || name === 'replace' || name === 'replaceall')) {
          api.focus(name);
        }
      };
      var reset = function (api) {
        done(editor, currentSearchState, false);
        disableAll(api, true);
        updateButtonStates(api);
      };
      var doFind = function (api) {
        var data = api.getData();
        var last = currentSearchState.get();
        if (!data.findtext.length) {
          reset(api);
          return;
        }
        if (last.text === data.findtext && last.matchCase === data.matchcase && last.wholeWord === data.wholewords) {
          next(editor, currentSearchState);
        } else {
          var count = find$2(editor, currentSearchState, data.findtext, data.matchcase, data.wholewords, data.inselection);
          if (count <= 0) {
            notFoundAlert(api);
          }
          disableAll(api, count === 0);
        }
        updateButtonStates(api);
      };
      var initialState = currentSearchState.get();
      var initialData = {
        findtext: selectedText,
        replacetext: '',
        wholewords: initialState.wholeWord,
        matchcase: initialState.matchCase,
        inselection: initialState.inSelection
      };
      var spec = {
        title: 'Find and Replace',
        size: 'normal',
        body: {
          type: 'panel',
          items: [
            {
              type: 'bar',
              items: [
                {
                  type: 'input',
                  name: 'findtext',
                  placeholder: 'Find',
                  maximized: true,
                  inputMode: 'search'
                },
                {
                  type: 'button',
                  name: 'prev',
                  text: 'Previous',
                  icon: 'action-prev',
                  disabled: true,
                  borderless: true
                },
                {
                  type: 'button',
                  name: 'next',
                  text: 'Next',
                  icon: 'action-next',
                  disabled: true,
                  borderless: true
                }
              ]
            },
            {
              type: 'input',
              name: 'replacetext',
              placeholder: 'Replace with',
              inputMode: 'search'
            }
          ]
        },
        buttons: [
          {
            type: 'menu',
            name: 'options',
            icon: 'preferences',
            tooltip: 'Preferences',
            align: 'start',
            items: [
              {
                type: 'togglemenuitem',
                name: 'matchcase',
                text: 'Match case'
              },
              {
                type: 'togglemenuitem',
                name: 'wholewords',
                text: 'Find whole words only'
              },
              {
                type: 'togglemenuitem',
                name: 'inselection',
                text: 'Find in selection'
              }
            ]
          },
          {
            type: 'custom',
            name: 'find',
            text: 'Find',
            primary: true
          },
          {
            type: 'custom',
            name: 'replace',
            text: 'Replace',
            disabled: true
          },
          {
            type: 'custom',
            name: 'replaceall',
            text: 'Replace all',
            disabled: true
          }
        ],
        initialData: initialData,
        onChange: function (api, details) {
          if (details.name === 'findtext' && currentSearchState.get().count > 0) {
            reset(api);
          }
        },
        onAction: function (api, details) {
          var data = api.getData();
          switch (details.name) {
          case 'find':
            doFind(api);
            break;
          case 'replace':
            if (!replace(editor, currentSearchState, data.replacetext)) {
              reset(api);
            } else {
              updateButtonStates(api);
            }
            break;
          case 'replaceall':
            replace(editor, currentSearchState, data.replacetext, true, true);
            reset(api);
            break;
          case 'prev':
            prev(editor, currentSearchState);
            updateButtonStates(api);
            break;
          case 'next':
            next(editor, currentSearchState);
            updateButtonStates(api);
            break;
          case 'matchcase':
          case 'wholewords':
          case 'inselection':
            updateSearchState(api);
            reset(api);
            break;
          }
          focusButtonIfRequired(api, details.name);
        },
        onSubmit: function (api) {
          doFind(api);
          focusButtonIfRequired(api, 'find');
        },
        onClose: function () {
          editor.focus();
          done(editor, currentSearchState);
          editor.undoManager.add();
        }
      };
      dialogApi.set(editor.windowManager.open(spec, { inline: 'toolbar' }));
    };

    var register = function (editor, currentSearchState) {
      editor.addCommand('SearchReplace', function () {
        open(editor, currentSearchState);
      });
    };

    var showDialog = function (editor, currentSearchState) {
      return function () {
        open(editor, currentSearchState);
      };
    };
    var register$1 = function (editor, currentSearchState) {
      editor.ui.registry.addMenuItem('searchreplace', {
        text: 'Find and replace...',
        shortcut: 'Meta+F',
        onAction: showDialog(editor, currentSearchState),
        icon: 'search'
      });
      editor.ui.registry.addButton('searchreplace', {
        tooltip: 'Find and replace',
        onAction: showDialog(editor, currentSearchState),
        icon: 'search'
      });
      editor.shortcuts.add('Meta+F', '', showDialog(editor, currentSearchState));
    };

    function Plugin () {
      global.add('searchreplace', function (editor) {
        var currentSearchState = Cell({
          index: -1,
          count: 0,
          text: '',
          matchCase: false,
          wholeWord: false,
          inSelection: false
        });
        register(editor, currentSearchState);
        register$1(editor, currentSearchState);
        return get$1(editor, currentSearchState);
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX3NlYXJjaHJlcGxhY2VfaW5kZXhfanMuY2h1bmsuanMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL3NlYXJjaHJlcGxhY2UvaW5kZXguanMiLCIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy9zZWFyY2hyZXBsYWNlL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcInNlYXJjaHJlcGxhY2VcIiBwbHVnaW4gZm9yIHVzYWdlIHdpdGggbW9kdWxlIGxvYWRlcnNcbi8vIFVzYWdlOlxuLy8gICBDb21tb25KUzpcbi8vICAgICByZXF1aXJlKCd0aW55bWNlL3BsdWdpbnMvc2VhcmNocmVwbGFjZScpXG4vLyAgIEVTMjAxNTpcbi8vICAgICBpbXBvcnQgJ3RpbnltY2UvcGx1Z2lucy9zZWFyY2hyZXBsYWNlJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgQ2VsbCA9IGZ1bmN0aW9uIChpbml0aWFsKSB7XG4gICAgICB2YXIgdmFsdWUgPSBpbml0aWFsO1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB2YWx1ZSA9IHY7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpXG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH07XG4gICAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgdmFyIHR5cGVPZiA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgdCA9IHR5cGVvZiB4O1xuICAgICAgaWYgKHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICdudWxsJztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKEFycmF5LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHgpIHx8IHguY29uc3RydWN0b3IgJiYgeC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQXJyYXknKSkge1xuICAgICAgICByZXR1cm4gJ2FycmF5JztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKFN0cmluZy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZih4KSB8fCB4LmNvbnN0cnVjdG9yICYmIHguY29uc3RydWN0b3IubmFtZSA9PT0gJ1N0cmluZycpKSB7XG4gICAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlT2YodmFsdWUpID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1NpbXBsZVR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1N0cmluZyA9IGlzVHlwZSgnc3RyaW5nJyk7XG4gICAgdmFyIGlzQXJyYXkgPSBpc1R5cGUoJ2FycmF5Jyk7XG4gICAgdmFyIGlzQm9vbGVhbiA9IGlzU2ltcGxlVHlwZSgnYm9vbGVhbicpO1xuICAgIHZhciBpc051bWJlciA9IGlzU2ltcGxlVHlwZSgnbnVtYmVyJyk7XG5cbiAgICB2YXIgbm9vcCA9IGZ1bmN0aW9uICgpIHtcbiAgICB9O1xuICAgIHZhciBjb25zdGFudCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBuZXZlciA9IGNvbnN0YW50KGZhbHNlKTtcbiAgICB2YXIgYWx3YXlzID0gY29uc3RhbnQodHJ1ZSk7XG5cbiAgICB2YXIgcHVuY3R1YXRpb25TdHIgPSAnWyEtIyUtKiwtXFxcXC86Oz9AXFxcXFstXFxcXF1fe31cXHhBMVxceEFCXFx4QjdcXHhCQlxceEJGO1xceEI3XFx1MDU1QS1cXHUwNTVGXFx1MDU4OVxcdTA1OEFcXHUwNUJFXFx1MDVDMFxcdTA1QzNcXHUwNUM2XFx1MDVGM1xcdTA1RjRcXHUwNjA5XFx1MDYwQVxcdTA2MENcXHUwNjBEXFx1MDYxQlxcdTA2MUVcXHUwNjFGXFx1MDY2QS1cXHUwNjZEXFx1MDZENFxcdTA3MDAtXFx1MDcwRFxcdTA3RjctXFx1MDdGOVxcdTA4MzAtXFx1MDgzRVxcdTA4NUVcXHUwOTY0XFx1MDk2NVxcdTA5NzBcXHUwREY0XFx1MEU0RlxcdTBFNUFcXHUwRTVCXFx1MEYwNC1cXHUwRjEyXFx1MEYzQS1cXHUwRjNEXFx1MEY4NVxcdTBGRDAtXFx1MEZENFxcdTBGRDlcXHUwRkRBXFx1MTA0QS1cXHUxMDRGXFx1MTBGQlxcdTEzNjEtXFx1MTM2OFxcdTE0MDBcXHUxNjZEXFx1MTY2RVxcdTE2OUJcXHUxNjlDXFx1MTZFQi1cXHUxNkVEXFx1MTczNVxcdTE3MzZcXHUxN0Q0LVxcdTE3RDZcXHUxN0Q4LVxcdTE3REFcXHUxODAwLVxcdTE4MEFcXHUxOTQ0XFx1MTk0NVxcdTFBMUVcXHUxQTFGXFx1MUFBMC1cXHUxQUE2XFx1MUFBOC1cXHUxQUFEXFx1MUI1QS1cXHUxQjYwXFx1MUJGQy1cXHUxQkZGXFx1MUMzQi1cXHUxQzNGXFx1MUM3RVxcdTFDN0ZcXHUxQ0QzXFx1MjAxMC1cXHUyMDI3XFx1MjAzMC1cXHUyMDQzXFx1MjA0NS1cXHUyMDUxXFx1MjA1My1cXHUyMDVFXFx1MjA3RFxcdTIwN0VcXHUyMDhEXFx1MjA4RVxcdTMwMDhcXHUzMDA5XFx1Mjc2OC1cXHUyNzc1XFx1MjdDNVxcdTI3QzZcXHUyN0U2LVxcdTI3RUZcXHUyOTgzLVxcdTI5OThcXHUyOUQ4LVxcdTI5REJcXHUyOUZDXFx1MjlGRFxcdTJDRjktXFx1MkNGQ1xcdTJDRkVcXHUyQ0ZGXFx1MkQ3MFxcdTJFMDAtXFx1MkUyRVxcdTJFMzBcXHUyRTMxXFx1MzAwMS1cXHUzMDAzXFx1MzAwOC1cXHUzMDExXFx1MzAxNC1cXHUzMDFGXFx1MzAzMFxcdTMwM0RcXHUzMEEwXFx1MzBGQlxcdUE0RkVcXHVBNEZGXFx1QTYwRC1cXHVBNjBGXFx1QTY3M1xcdUE2N0VcXHVBNkYyLVxcdUE2RjdcXHVBODc0LVxcdUE4NzdcXHVBOENFXFx1QThDRlxcdUE4RjgtXFx1QThGQVxcdUE5MkVcXHVBOTJGXFx1QTk1RlxcdUE5QzEtXFx1QTlDRFxcdUE5REVcXHVBOURGXFx1QUE1Qy1cXHVBQTVGXFx1QUFERVxcdUFBREZcXHVBQkVCXFx1RkQzRVxcdUZEM0ZcXHVGRTEwLVxcdUZFMTlcXHVGRTMwLVxcdUZFNTJcXHVGRTU0LVxcdUZFNjFcXHVGRTYzXFx1RkU2OFxcdUZFNkFcXHVGRTZCXFx1RkYwMS1cXHVGRjAzXFx1RkYwNS1cXHVGRjBBXFx1RkYwQy1cXHVGRjBGXFx1RkYxQVxcdUZGMUJcXHVGRjFGXFx1RkYyMFxcdUZGM0ItXFx1RkYzRFxcdWZmM2ZcXHVGRjVCXFx1RkY1RFxcdUZGNUYtXFx1RkY2NV0nO1xuXG4gICAgdmFyIHB1bmN0dWF0aW9uID0gY29uc3RhbnQocHVuY3R1YXRpb25TdHIpO1xuXG4gICAgdmFyIG5vbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gTk9ORTtcbiAgICB9O1xuICAgIHZhciBOT05FID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVxID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIG8uaXNOb25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAodGh1bmspIHtcbiAgICAgICAgcmV0dXJuIHRodW5rKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGlkID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBmb2xkOiBmdW5jdGlvbiAobiwgX3MpIHtcbiAgICAgICAgICByZXR1cm4gbigpO1xuICAgICAgICB9LFxuICAgICAgICBpczogbmV2ZXIsXG4gICAgICAgIGlzU29tZTogbmV2ZXIsXG4gICAgICAgIGlzTm9uZTogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWQsXG4gICAgICAgIGdldE9yVGh1bms6IGNhbGwsXG4gICAgICAgIGdldE9yRGllOiBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyB8fCAnZXJyb3I6IGdldE9yRGllIGNhbGxlZCBvbiBub25lLicpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50KG51bGwpLFxuICAgICAgICBnZXRPclVuZGVmaW5lZDogY29uc3RhbnQodW5kZWZpbmVkKSxcbiAgICAgICAgb3I6IGlkLFxuICAgICAgICBvclRodW5rOiBjYWxsLFxuICAgICAgICBtYXA6IG5vbmUsXG4gICAgICAgIGVhY2g6IG5vb3AsXG4gICAgICAgIGJpbmQ6IG5vbmUsXG4gICAgICAgIGV4aXN0czogbmV2ZXIsXG4gICAgICAgIGZvcmFsbDogYWx3YXlzLFxuICAgICAgICBmaWx0ZXI6IG5vbmUsXG4gICAgICAgIGVxdWFsczogZXEsXG4gICAgICAgIGVxdWFsc186IGVxLFxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogY29uc3RhbnQoJ25vbmUoKScpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH0oKTtcbiAgICB2YXIgc29tZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICB2YXIgY29uc3RhbnRfYSA9IGNvbnN0YW50KGEpO1xuICAgICAgdmFyIHNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtZTtcbiAgICAgIH07XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIHMpIHtcbiAgICAgICAgICByZXR1cm4gcyhhKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IHY7XG4gICAgICAgIH0sXG4gICAgICAgIGlzU29tZTogYWx3YXlzLFxuICAgICAgICBpc05vbmU6IG5ldmVyLFxuICAgICAgICBnZXRPcjogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JEaWU6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yTnVsbDogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50X2EsXG4gICAgICAgIG9yOiBzZWxmLFxuICAgICAgICBvclRodW5rOiBzZWxmLFxuICAgICAgICBtYXA6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIHNvbWUoZihhKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVhY2g6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgZihhKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgZXhpc3RzOiBiaW5kLFxuICAgICAgICBmb3JhbGw6IGJpbmQsXG4gICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gZihhKSA/IG1lIDogTk9ORTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbYV07XG4gICAgICAgIH0sXG4gICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdzb21lKCcgKyBhICsgJyknO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgcmV0dXJuIG8uaXMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVxdWFsc186IGZ1bmN0aW9uIChvLCBlbGVtZW50RXEpIHtcbiAgICAgICAgICByZXR1cm4gby5mb2xkKG5ldmVyLCBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRFcShhLCBiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9O1xuICAgIHZhciBmcm9tID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IE5PTkUgOiBzb21lKHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBPcHRpb25hbCA9IHtcbiAgICAgIHNvbWU6IHNvbWUsXG4gICAgICBub25lOiBub25lLFxuICAgICAgZnJvbTogZnJvbVxuICAgIH07XG5cbiAgICB2YXIgcHVuY3R1YXRpb24kMSA9IHB1bmN0dWF0aW9uO1xuXG4gICAgdmFyIGdsb2JhbCQxID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5Ub29scycpO1xuXG4gICAgdmFyIG5hdGl2ZVNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xuICAgIHZhciBuYXRpdmVQdXNoID0gQXJyYXkucHJvdG90eXBlLnB1c2g7XG4gICAgdmFyIG1hcCA9IGZ1bmN0aW9uICh4cywgZikge1xuICAgICAgdmFyIGxlbiA9IHhzLmxlbmd0aDtcbiAgICAgIHZhciByID0gbmV3IEFycmF5KGxlbik7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIHJbaV0gPSBmKHgsIGkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZWFjaCA9IGZ1bmN0aW9uICh4cywgZikge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIGYoeCwgaSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZWFjaHIgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIGZvciAodmFyIGkgPSB4cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBmKHgsIGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGdyb3VwQnkgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIGlmICh4cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHdhc1R5cGUgPSBmKHhzWzBdKTtcbiAgICAgICAgdmFyIHIgPSBbXTtcbiAgICAgICAgdmFyIGdyb3VwID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgICAgdmFyIHR5cGUgPSBmKHgpO1xuICAgICAgICAgIGlmICh0eXBlICE9PSB3YXNUeXBlKSB7XG4gICAgICAgICAgICByLnB1c2goZ3JvdXApO1xuICAgICAgICAgICAgZ3JvdXAgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgd2FzVHlwZSA9IHR5cGU7XG4gICAgICAgICAgZ3JvdXAucHVzaCh4KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ3JvdXAubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgci5wdXNoKGdyb3VwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcjtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBmb2xkbCA9IGZ1bmN0aW9uICh4cywgZiwgYWNjKSB7XG4gICAgICBlYWNoKHhzLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBhY2MgPSBmKGFjYywgeCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfTtcbiAgICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICBpZiAoIWlzQXJyYXkoeHNbaV0pKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcnIuZmxhdHRlbiBpdGVtICcgKyBpICsgJyB3YXMgbm90IGFuIGFycmF5LCBpbnB1dDogJyArIHhzKTtcbiAgICAgICAgfVxuICAgICAgICBuYXRpdmVQdXNoLmFwcGx5KHIsIHhzW2ldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHJldHVybiBmbGF0dGVuKG1hcCh4cywgZikpO1xuICAgIH07XG4gICAgdmFyIHNvcnQgPSBmdW5jdGlvbiAoeHMsIGNvbXBhcmF0b3IpIHtcbiAgICAgIHZhciBjb3B5ID0gbmF0aXZlU2xpY2UuY2FsbCh4cywgMCk7XG4gICAgICBjb3B5LnNvcnQoY29tcGFyYXRvcik7XG4gICAgICByZXR1cm4gY29weTtcbiAgICB9O1xuXG4gICAgdmFyIGhhc093blByb3BlcnR5ID0gT2JqZWN0Lmhhc093blByb3BlcnR5O1xuICAgIHZhciBoYXMgPSBmdW5jdGlvbiAob2JqLCBrZXkpIHtcbiAgICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTtcbiAgICB9O1xuXG4gICAgdmFyIEdsb2JhbCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogRnVuY3Rpb24oJ3JldHVybiB0aGlzOycpKCk7XG5cbiAgICB2YXIgRE9DVU1FTlQgPSA5O1xuICAgIHZhciBET0NVTUVOVF9GUkFHTUVOVCA9IDExO1xuICAgIHZhciBFTEVNRU5UID0gMTtcbiAgICB2YXIgVEVYVCA9IDM7XG5cbiAgICB2YXIgdHlwZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5kb20ubm9kZVR5cGU7XG4gICAgfTtcbiAgICB2YXIgaXNUeXBlJDEgPSBmdW5jdGlvbiAodCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0eXBlKGVsZW1lbnQpID09PSB0O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1RleHQgPSBpc1R5cGUkMShURVhUKTtcblxuICAgIHZhciByYXdTZXQgPSBmdW5jdGlvbiAoZG9tLCBrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoaXNTdHJpbmcodmFsdWUpIHx8IGlzQm9vbGVhbih2YWx1ZSkgfHwgaXNOdW1iZXIodmFsdWUpKSB7XG4gICAgICAgIGRvbS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSArICcnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgY2FsbCB0byBBdHRyaWJ1dGUuc2V0LiBLZXkgJywga2V5LCAnOjogVmFsdWUgJywgdmFsdWUsICc6OiBFbGVtZW50ICcsIGRvbSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXR0cmlidXRlIHZhbHVlIHdhcyBub3Qgc2ltcGxlJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSwgdmFsdWUpIHtcbiAgICAgIHJhd1NldChlbGVtZW50LmRvbSwga2V5LCB2YWx1ZSk7XG4gICAgfTtcblxuICAgIHZhciBjb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA9IGZ1bmN0aW9uIChhLCBiLCBtYXRjaCkge1xuICAgICAgcmV0dXJuIChhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgbWF0Y2gpICE9PSAwO1xuICAgIH07XG4gICAgdmFyIGRvY3VtZW50UG9zaXRpb25QcmVjZWRpbmcgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGEsIGIsIE5vZGUuRE9DVU1FTlRfUE9TSVRJT05fUFJFQ0VESU5HKTtcbiAgICB9O1xuXG4gICAgdmFyIGZyb21IdG1sID0gZnVuY3Rpb24gKGh0bWwsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgZGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICBpZiAoIWRpdi5oYXNDaGlsZE5vZGVzKCkgfHwgZGl2LmNoaWxkTm9kZXMubGVuZ3RoID4gMSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdIVE1MIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlJywgaHRtbCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSFRNTCBtdXN0IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJvbURvbShkaXYuY2hpbGROb2Rlc1swXSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbVRhZyA9IGZ1bmN0aW9uICh0YWcsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgbm9kZSA9IGRvYy5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICByZXR1cm4gZnJvbURvbShub2RlKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGV4dCA9IGZ1bmN0aW9uICh0ZXh0LCBzY29wZSkge1xuICAgICAgdmFyIGRvYyA9IHNjb3BlIHx8IGRvY3VtZW50O1xuICAgICAgdmFyIG5vZGUgPSBkb2MuY3JlYXRlVGV4dE5vZGUodGV4dCk7XG4gICAgICByZXR1cm4gZnJvbURvbShub2RlKTtcbiAgICB9O1xuICAgIHZhciBmcm9tRG9tID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vZGUgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyBkb206IG5vZGUgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tUG9pbnQgPSBmdW5jdGlvbiAoZG9jRWxtLCB4LCB5KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShkb2NFbG0uZG9tLmVsZW1lbnRGcm9tUG9pbnQoeCwgeSkpLm1hcChmcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBTdWdhckVsZW1lbnQgPSB7XG4gICAgICBmcm9tSHRtbDogZnJvbUh0bWwsXG4gICAgICBmcm9tVGFnOiBmcm9tVGFnLFxuICAgICAgZnJvbVRleHQ6IGZyb21UZXh0LFxuICAgICAgZnJvbURvbTogZnJvbURvbSxcbiAgICAgIGZyb21Qb2ludDogZnJvbVBvaW50XG4gICAgfTtcblxuICAgIHZhciBieXBhc3NTZWxlY3RvciA9IGZ1bmN0aW9uIChkb20pIHtcbiAgICAgIHJldHVybiBkb20ubm9kZVR5cGUgIT09IEVMRU1FTlQgJiYgZG9tLm5vZGVUeXBlICE9PSBET0NVTUVOVCAmJiBkb20ubm9kZVR5cGUgIT09IERPQ1VNRU5UX0ZSQUdNRU5UIHx8IGRvbS5jaGlsZEVsZW1lbnRDb3VudCA9PT0gMDtcbiAgICB9O1xuICAgIHZhciBhbGwgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHNjb3BlKSB7XG4gICAgICB2YXIgYmFzZSA9IHNjb3BlID09PSB1bmRlZmluZWQgPyBkb2N1bWVudCA6IHNjb3BlLmRvbTtcbiAgICAgIHJldHVybiBieXBhc3NTZWxlY3RvcihiYXNlKSA/IFtdIDogbWFwKGJhc2UucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvciksIFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuXG4gICAgdmFyIHBhcmVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShlbGVtZW50LmRvbS5wYXJlbnROb2RlKS5tYXAoU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIGNoaWxkcmVuID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBtYXAoZWxlbWVudC5kb20uY2hpbGROb2RlcywgU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIHNwb3QgPSBmdW5jdGlvbiAoZWxlbWVudCwgb2Zmc2V0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICBvZmZzZXQ6IG9mZnNldFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBsZWFmID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9mZnNldCkge1xuICAgICAgdmFyIGNzID0gY2hpbGRyZW4oZWxlbWVudCk7XG4gICAgICByZXR1cm4gY3MubGVuZ3RoID4gMCAmJiBvZmZzZXQgPCBjcy5sZW5ndGggPyBzcG90KGNzW29mZnNldF0sIDApIDogc3BvdChlbGVtZW50LCBvZmZzZXQpO1xuICAgIH07XG5cbiAgICB2YXIgYmVmb3JlID0gZnVuY3Rpb24gKG1hcmtlciwgZWxlbWVudCkge1xuICAgICAgdmFyIHBhcmVudCQxID0gcGFyZW50KG1hcmtlcik7XG4gICAgICBwYXJlbnQkMS5lYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHYuZG9tLmluc2VydEJlZm9yZShlbGVtZW50LmRvbSwgbWFya2VyLmRvbSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBhcHBlbmQgPSBmdW5jdGlvbiAocGFyZW50LCBlbGVtZW50KSB7XG4gICAgICBwYXJlbnQuZG9tLmFwcGVuZENoaWxkKGVsZW1lbnQuZG9tKTtcbiAgICB9O1xuICAgIHZhciB3cmFwID0gZnVuY3Rpb24gKGVsZW1lbnQsIHdyYXBwZXIpIHtcbiAgICAgIGJlZm9yZShlbGVtZW50LCB3cmFwcGVyKTtcbiAgICAgIGFwcGVuZCh3cmFwcGVyLCBlbGVtZW50KTtcbiAgICB9O1xuXG4gICAgdmFyIE5vZGVWYWx1ZSA9IGZ1bmN0aW9uIChpcywgbmFtZSkge1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIGlmICghaXMoZWxlbWVudCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBvbmx5IGdldCAnICsgbmFtZSArICcgdmFsdWUgb2YgYSAnICsgbmFtZSArICcgbm9kZScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBnZXRPcHRpb24oZWxlbWVudCkuZ2V0T3IoJycpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRPcHRpb24gPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gaXMoZWxlbWVudCkgPyBPcHRpb25hbC5mcm9tKGVsZW1lbnQuZG9tLm5vZGVWYWx1ZSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldCA9IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZSkge1xuICAgICAgICBpZiAoIWlzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW4gb25seSBzZXQgcmF3ICcgKyBuYW1lICsgJyB2YWx1ZSBvZiBhICcgKyBuYW1lICsgJyBub2RlJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudC5kb20ubm9kZVZhbHVlID0gdmFsdWU7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIGdldE9wdGlvbjogZ2V0T3B0aW9uLFxuICAgICAgICBzZXQ6IHNldFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGFwaSA9IE5vZGVWYWx1ZShpc1RleHQsICd0ZXh0Jyk7XG4gICAgdmFyIGdldCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYXBpLmdldChlbGVtZW50KTtcbiAgICB9O1xuXG4gICAgdmFyIGRlc2NlbmRhbnRzID0gZnVuY3Rpb24gKHNjb3BlLCBzZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGFsbChzZWxlY3Rvciwgc2NvcGUpO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDIgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5kb20uVHJlZVdhbGtlcicpO1xuXG4gICAgdmFyIGlzU2ltcGxlQm91bmRhcnkgPSBmdW5jdGlvbiAoZG9tLCBub2RlKSB7XG4gICAgICByZXR1cm4gZG9tLmlzQmxvY2sobm9kZSkgfHwgaGFzKGRvbS5zY2hlbWEuZ2V0U2hvcnRFbmRlZEVsZW1lbnRzKCksIG5vZGUubm9kZU5hbWUpO1xuICAgIH07XG4gICAgdmFyIGlzQ29udGVudEVkaXRhYmxlRmFsc2UgPSBmdW5jdGlvbiAoZG9tLCBub2RlKSB7XG4gICAgICByZXR1cm4gZG9tLmdldENvbnRlbnRFZGl0YWJsZShub2RlKSA9PT0gJ2ZhbHNlJztcbiAgICB9O1xuICAgIHZhciBpc0NvbnRlbnRFZGl0YWJsZVRydWVJbkNlZiA9IGZ1bmN0aW9uIChkb20sIG5vZGUpIHtcbiAgICAgIHJldHVybiBkb20uZ2V0Q29udGVudEVkaXRhYmxlKG5vZGUpID09PSAndHJ1ZScgJiYgZG9tLmdldENvbnRlbnRFZGl0YWJsZVBhcmVudChub2RlLnBhcmVudE5vZGUpID09PSAnZmFsc2UnO1xuICAgIH07XG4gICAgdmFyIGlzSGlkZGVuID0gZnVuY3Rpb24gKGRvbSwgbm9kZSkge1xuICAgICAgcmV0dXJuICFkb20uaXNCbG9jayhub2RlKSAmJiBoYXMoZG9tLnNjaGVtYS5nZXRXaGl0ZVNwYWNlRWxlbWVudHMoKSwgbm9kZS5ub2RlTmFtZSk7XG4gICAgfTtcbiAgICB2YXIgaXNCb3VuZGFyeSA9IGZ1bmN0aW9uIChkb20sIG5vZGUpIHtcbiAgICAgIHJldHVybiBpc1NpbXBsZUJvdW5kYXJ5KGRvbSwgbm9kZSkgfHwgaXNDb250ZW50RWRpdGFibGVGYWxzZShkb20sIG5vZGUpIHx8IGlzSGlkZGVuKGRvbSwgbm9kZSkgfHwgaXNDb250ZW50RWRpdGFibGVUcnVlSW5DZWYoZG9tLCBub2RlKTtcbiAgICB9O1xuICAgIHZhciBpc1RleHQkMSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gMztcbiAgICB9O1xuICAgIHZhciBudVNlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzT2Zmc2V0OiAwLFxuICAgICAgICBmT2Zmc2V0OiAwLFxuICAgICAgICBlbGVtZW50czogW11cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdG9MZWFmID0gZnVuY3Rpb24gKG5vZGUsIG9mZnNldCkge1xuICAgICAgcmV0dXJuIGxlYWYoU3VnYXJFbGVtZW50LmZyb21Eb20obm9kZSksIG9mZnNldCk7XG4gICAgfTtcbiAgICB2YXIgd2FsayA9IGZ1bmN0aW9uIChkb20sIHdhbGtlckZuLCBzdGFydE5vZGUsIGNhbGxiYWNrcywgZW5kTm9kZSwgc2tpcFN0YXJ0KSB7XG4gICAgICBpZiAoc2tpcFN0YXJ0ID09PSB2b2lkIDApIHtcbiAgICAgICAgc2tpcFN0YXJ0ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHZhciBuZXh0ID0gc2tpcFN0YXJ0ID8gd2Fsa2VyRm4oZmFsc2UpIDogc3RhcnROb2RlO1xuICAgICAgd2hpbGUgKG5leHQpIHtcbiAgICAgICAgdmFyIGlzQ2VmTm9kZSA9IGlzQ29udGVudEVkaXRhYmxlRmFsc2UoZG9tLCBuZXh0KTtcbiAgICAgICAgaWYgKGlzQ2VmTm9kZSB8fCBpc0hpZGRlbihkb20sIG5leHQpKSB7XG4gICAgICAgICAgdmFyIHN0b3BXYWxraW5nID0gaXNDZWZOb2RlID8gY2FsbGJhY2tzLmNlZihuZXh0KSA6IGNhbGxiYWNrcy5ib3VuZGFyeShuZXh0KTtcbiAgICAgICAgICBpZiAoc3RvcFdhbGtpbmcpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBuZXh0ID0gd2Fsa2VyRm4odHJ1ZSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaXNTaW1wbGVCb3VuZGFyeShkb20sIG5leHQpKSB7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrcy5ib3VuZGFyeShuZXh0KSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGlzVGV4dCQxKG5leHQpKSB7XG4gICAgICAgICAgY2FsbGJhY2tzLnRleHQobmV4dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5leHQgPT09IGVuZE5vZGUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXh0ID0gd2Fsa2VyRm4oZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgY29sbGVjdFRleHRUb0JvdW5kYXJ5ID0gZnVuY3Rpb24gKGRvbSwgc2VjdGlvbiwgbm9kZSwgcm9vdE5vZGUsIGZvcndhcmRzKSB7XG4gICAgICBpZiAoaXNCb3VuZGFyeShkb20sIG5vZGUpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciByb290QmxvY2sgPSBkb20uZ2V0UGFyZW50KHJvb3ROb2RlLCBkb20uaXNCbG9jayk7XG4gICAgICB2YXIgd2Fsa2VyID0gbmV3IGdsb2JhbCQyKG5vZGUsIHJvb3RCbG9jayk7XG4gICAgICB2YXIgd2Fsa2VyRm4gPSBmb3J3YXJkcyA/IHdhbGtlci5uZXh0LmJpbmQod2Fsa2VyKSA6IHdhbGtlci5wcmV2LmJpbmQod2Fsa2VyKTtcbiAgICAgIHdhbGsoZG9tLCB3YWxrZXJGbiwgbm9kZSwge1xuICAgICAgICBib3VuZGFyeTogYWx3YXlzLFxuICAgICAgICBjZWY6IGFsd2F5cyxcbiAgICAgICAgdGV4dDogZnVuY3Rpb24gKG5leHQpIHtcbiAgICAgICAgICBpZiAoZm9yd2FyZHMpIHtcbiAgICAgICAgICAgIHNlY3Rpb24uZk9mZnNldCArPSBuZXh0Lmxlbmd0aDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VjdGlvbi5zT2Zmc2V0ICs9IG5leHQubGVuZ3RoO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWN0aW9uLmVsZW1lbnRzLnB1c2goU3VnYXJFbGVtZW50LmZyb21Eb20obmV4dCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjb2xsZWN0ID0gZnVuY3Rpb24gKGRvbSwgcm9vdE5vZGUsIHN0YXJ0Tm9kZSwgZW5kTm9kZSwgY2FsbGJhY2tzLCBza2lwU3RhcnQpIHtcbiAgICAgIGlmIChza2lwU3RhcnQgPT09IHZvaWQgMCkge1xuICAgICAgICBza2lwU3RhcnQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdmFyIHdhbGtlciA9IG5ldyBnbG9iYWwkMihzdGFydE5vZGUsIHJvb3ROb2RlKTtcbiAgICAgIHZhciBzZWN0aW9ucyA9IFtdO1xuICAgICAgdmFyIGN1cnJlbnQgPSBudVNlY3Rpb24oKTtcbiAgICAgIGNvbGxlY3RUZXh0VG9Cb3VuZGFyeShkb20sIGN1cnJlbnQsIHN0YXJ0Tm9kZSwgcm9vdE5vZGUsIGZhbHNlKTtcbiAgICAgIHZhciBmaW5pc2hTZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY3VycmVudC5lbGVtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgc2VjdGlvbnMucHVzaChjdXJyZW50KTtcbiAgICAgICAgICBjdXJyZW50ID0gbnVTZWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfTtcbiAgICAgIHdhbGsoZG9tLCB3YWxrZXIubmV4dC5iaW5kKHdhbGtlciksIHN0YXJ0Tm9kZSwge1xuICAgICAgICBib3VuZGFyeTogZmluaXNoU2VjdGlvbixcbiAgICAgICAgY2VmOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIGZpbmlzaFNlY3Rpb24oKTtcbiAgICAgICAgICBpZiAoY2FsbGJhY2tzKSB7XG4gICAgICAgICAgICBzZWN0aW9ucy5wdXNoLmFwcGx5KHNlY3Rpb25zLCBjYWxsYmFja3MuY2VmKG5vZGUpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICB0ZXh0OiBmdW5jdGlvbiAobmV4dCkge1xuICAgICAgICAgIGN1cnJlbnQuZWxlbWVudHMucHVzaChTdWdhckVsZW1lbnQuZnJvbURvbShuZXh0KSk7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrcykge1xuICAgICAgICAgICAgY2FsbGJhY2tzLnRleHQobmV4dCwgY3VycmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCBlbmROb2RlLCBza2lwU3RhcnQpO1xuICAgICAgaWYgKGVuZE5vZGUpIHtcbiAgICAgICAgY29sbGVjdFRleHRUb0JvdW5kYXJ5KGRvbSwgY3VycmVudCwgZW5kTm9kZSwgcm9vdE5vZGUsIHRydWUpO1xuICAgICAgfVxuICAgICAgZmluaXNoU2VjdGlvbigpO1xuICAgICAgcmV0dXJuIHNlY3Rpb25zO1xuICAgIH07XG4gICAgdmFyIGNvbGxlY3RSYW5nZVNlY3Rpb25zID0gZnVuY3Rpb24gKGRvbSwgcm5nKSB7XG4gICAgICB2YXIgc3RhcnQgPSB0b0xlYWYocm5nLnN0YXJ0Q29udGFpbmVyLCBybmcuc3RhcnRPZmZzZXQpO1xuICAgICAgdmFyIHN0YXJ0Tm9kZSA9IHN0YXJ0LmVsZW1lbnQuZG9tO1xuICAgICAgdmFyIGVuZCA9IHRvTGVhZihybmcuZW5kQ29udGFpbmVyLCBybmcuZW5kT2Zmc2V0KTtcbiAgICAgIHZhciBlbmROb2RlID0gZW5kLmVsZW1lbnQuZG9tO1xuICAgICAgcmV0dXJuIGNvbGxlY3QoZG9tLCBybmcuY29tbW9uQW5jZXN0b3JDb250YWluZXIsIHN0YXJ0Tm9kZSwgZW5kTm9kZSwge1xuICAgICAgICB0ZXh0OiBmdW5jdGlvbiAobm9kZSwgc2VjdGlvbikge1xuICAgICAgICAgIGlmIChub2RlID09PSBlbmROb2RlKSB7XG4gICAgICAgICAgICBzZWN0aW9uLmZPZmZzZXQgKz0gbm9kZS5sZW5ndGggLSBlbmQub2Zmc2V0O1xuICAgICAgICAgIH0gZWxzZSBpZiAobm9kZSA9PT0gc3RhcnROb2RlKSB7XG4gICAgICAgICAgICBzZWN0aW9uLnNPZmZzZXQgKz0gc3RhcnQub2Zmc2V0O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY2VmOiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIHZhciBzZWN0aW9ucyA9IGJpbmQoZGVzY2VuZGFudHMoU3VnYXJFbGVtZW50LmZyb21Eb20obm9kZSksICcqW2NvbnRlbnRlZGl0YWJsZT10cnVlXScpLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgdmFyIGNlVHJ1ZU5vZGUgPSBlLmRvbTtcbiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0KGRvbSwgY2VUcnVlTm9kZSwgY2VUcnVlTm9kZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHNvcnQoc2VjdGlvbnMsIGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnRQb3NpdGlvblByZWNlZGluZyhhLmVsZW1lbnRzWzBdLmRvbSwgYi5lbGVtZW50c1swXS5kb20pID8gMSA6IC0xO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LCBmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbVJuZyA9IGZ1bmN0aW9uIChkb20sIHJuZykge1xuICAgICAgcmV0dXJuIHJuZy5jb2xsYXBzZWQgPyBbXSA6IGNvbGxlY3RSYW5nZVNlY3Rpb25zKGRvbSwgcm5nKTtcbiAgICB9O1xuICAgIHZhciBmcm9tTm9kZSA9IGZ1bmN0aW9uIChkb20sIG5vZGUpIHtcbiAgICAgIHZhciBybmcgPSBkb20uY3JlYXRlUm5nKCk7XG4gICAgICBybmcuc2VsZWN0Tm9kZShub2RlKTtcbiAgICAgIHJldHVybiBmcm9tUm5nKGRvbSwgcm5nKTtcbiAgICB9O1xuICAgIHZhciBmcm9tTm9kZXMgPSBmdW5jdGlvbiAoZG9tLCBub2Rlcykge1xuICAgICAgcmV0dXJuIGJpbmQobm9kZXMsIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiBmcm9tTm9kZShkb20sIG5vZGUpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBmaW5kID0gZnVuY3Rpb24gKHRleHQsIHBhdHRlcm4sIHN0YXJ0LCBmaW5pc2gpIHtcbiAgICAgIGlmIChzdGFydCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgIH1cbiAgICAgIGlmIChmaW5pc2ggPT09IHZvaWQgMCkge1xuICAgICAgICBmaW5pc2ggPSB0ZXh0Lmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIHZhciByZWdleCA9IHBhdHRlcm4ucmVnZXg7XG4gICAgICByZWdleC5sYXN0SW5kZXggPSBzdGFydDtcbiAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICB2YXIgbWF0Y2g7XG4gICAgICB3aGlsZSAobWF0Y2ggPSByZWdleC5leGVjKHRleHQpKSB7XG4gICAgICAgIHZhciBtYXRjaGVkVGV4dCA9IG1hdGNoW3BhdHRlcm4ubWF0Y2hJbmRleF07XG4gICAgICAgIHZhciBtYXRjaFN0YXJ0ID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5pbmRleE9mKG1hdGNoZWRUZXh0KTtcbiAgICAgICAgdmFyIG1hdGNoRmluaXNoID0gbWF0Y2hTdGFydCArIG1hdGNoZWRUZXh0Lmxlbmd0aDtcbiAgICAgICAgaWYgKG1hdGNoRmluaXNoID4gZmluaXNoKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICBzdGFydDogbWF0Y2hTdGFydCxcbiAgICAgICAgICBmaW5pc2g6IG1hdGNoRmluaXNoXG4gICAgICAgIH0pO1xuICAgICAgICByZWdleC5sYXN0SW5kZXggPSBtYXRjaEZpbmlzaDtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH07XG4gICAgdmFyIGV4dHJhY3QgPSBmdW5jdGlvbiAoZWxlbWVudHMsIG1hdGNoZXMpIHtcbiAgICAgIHZhciBub2RlUG9zaXRpb25zID0gZm9sZGwoZWxlbWVudHMsIGZ1bmN0aW9uIChhY2MsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBnZXQoZWxlbWVudCk7XG4gICAgICAgIHZhciBzdGFydCA9IGFjYy5sYXN0O1xuICAgICAgICB2YXIgZmluaXNoID0gc3RhcnQgKyBjb250ZW50Lmxlbmd0aDtcbiAgICAgICAgdmFyIHBvc2l0aW9ucyA9IGJpbmQobWF0Y2hlcywgZnVuY3Rpb24gKG1hdGNoLCBtYXRjaElkeCkge1xuICAgICAgICAgIGlmIChtYXRjaC5zdGFydCA8IGZpbmlzaCAmJiBtYXRjaC5maW5pc2ggPiBzdGFydCkge1xuICAgICAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICBzdGFydDogTWF0aC5tYXgoc3RhcnQsIG1hdGNoLnN0YXJ0KSAtIHN0YXJ0LFxuICAgICAgICAgICAgICAgIGZpbmlzaDogTWF0aC5taW4oZmluaXNoLCBtYXRjaC5maW5pc2gpIC0gc3RhcnQsXG4gICAgICAgICAgICAgICAgbWF0Y2hJZDogbWF0Y2hJZHhcbiAgICAgICAgICAgICAgfV07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJlc3VsdHM6IGFjYy5yZXN1bHRzLmNvbmNhdChwb3NpdGlvbnMpLFxuICAgICAgICAgIGxhc3Q6IGZpbmlzaFxuICAgICAgICB9O1xuICAgICAgfSwge1xuICAgICAgICByZXN1bHRzOiBbXSxcbiAgICAgICAgbGFzdDogMFxuICAgICAgfSkucmVzdWx0cztcbiAgICAgIHJldHVybiBncm91cEJ5KG5vZGVQb3NpdGlvbnMsIGZ1bmN0aW9uIChwb3NpdGlvbikge1xuICAgICAgICByZXR1cm4gcG9zaXRpb24ubWF0Y2hJZDtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZmluZCQxID0gZnVuY3Rpb24gKHBhdHRlcm4sIHNlY3Rpb25zKSB7XG4gICAgICByZXR1cm4gYmluZChzZWN0aW9ucywgZnVuY3Rpb24gKHNlY3Rpb24pIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gc2VjdGlvbi5lbGVtZW50cztcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBtYXAoZWxlbWVudHMsIGdldCkuam9pbignJyk7XG4gICAgICAgIHZhciBwb3NpdGlvbnMgPSBmaW5kKGNvbnRlbnQsIHBhdHRlcm4sIHNlY3Rpb24uc09mZnNldCwgY29udGVudC5sZW5ndGggLSBzZWN0aW9uLmZPZmZzZXQpO1xuICAgICAgICByZXR1cm4gZXh0cmFjdChlbGVtZW50cywgcG9zaXRpb25zKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1hcmsgPSBmdW5jdGlvbiAobWF0Y2hlcywgcmVwbGFjZW1lbnROb2RlKSB7XG4gICAgICBlYWNocihtYXRjaGVzLCBmdW5jdGlvbiAobWF0Y2gsIGlkeCkge1xuICAgICAgICBlYWNocihtYXRjaCwgZnVuY3Rpb24gKHBvcykge1xuICAgICAgICAgIHZhciB3cmFwcGVyID0gU3VnYXJFbGVtZW50LmZyb21Eb20ocmVwbGFjZW1lbnROb2RlLmNsb25lTm9kZShmYWxzZSkpO1xuICAgICAgICAgIHNldCh3cmFwcGVyLCAnZGF0YS1tY2UtaW5kZXgnLCBpZHgpO1xuICAgICAgICAgIHZhciB0ZXh0Tm9kZSA9IHBvcy5lbGVtZW50LmRvbTtcbiAgICAgICAgICBpZiAodGV4dE5vZGUubGVuZ3RoID09PSBwb3MuZmluaXNoICYmIHBvcy5zdGFydCA9PT0gMCkge1xuICAgICAgICAgICAgd3JhcChwb3MuZWxlbWVudCwgd3JhcHBlcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0ZXh0Tm9kZS5sZW5ndGggIT09IHBvcy5maW5pc2gpIHtcbiAgICAgICAgICAgICAgdGV4dE5vZGUuc3BsaXRUZXh0KHBvcy5maW5pc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG1hdGNoTm9kZSA9IHRleHROb2RlLnNwbGl0VGV4dChwb3Muc3RhcnQpO1xuICAgICAgICAgICAgd3JhcChTdWdhckVsZW1lbnQuZnJvbURvbShtYXRjaE5vZGUpLCB3cmFwcGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmluZEFuZE1hcmsgPSBmdW5jdGlvbiAoZG9tLCBwYXR0ZXJuLCBub2RlLCByZXBsYWNlbWVudE5vZGUpIHtcbiAgICAgIHZhciB0ZXh0U2VjdGlvbnMgPSBmcm9tTm9kZShkb20sIG5vZGUpO1xuICAgICAgdmFyIG1hdGNoZXMgPSBmaW5kJDEocGF0dGVybiwgdGV4dFNlY3Rpb25zKTtcbiAgICAgIG1hcmsobWF0Y2hlcywgcmVwbGFjZW1lbnROb2RlKTtcbiAgICAgIHJldHVybiBtYXRjaGVzLmxlbmd0aDtcbiAgICB9O1xuICAgIHZhciBmaW5kQW5kTWFya0luU2VsZWN0aW9uID0gZnVuY3Rpb24gKGRvbSwgcGF0dGVybiwgc2VsZWN0aW9uLCByZXBsYWNlbWVudE5vZGUpIHtcbiAgICAgIHZhciBib29rbWFyayA9IHNlbGVjdGlvbi5nZXRCb29rbWFyaygpO1xuICAgICAgdmFyIG5vZGVzID0gZG9tLnNlbGVjdCgndGRbZGF0YS1tY2Utc2VsZWN0ZWRdLHRoW2RhdGEtbWNlLXNlbGVjdGVkXScpO1xuICAgICAgdmFyIHRleHRTZWN0aW9ucyA9IG5vZGVzLmxlbmd0aCA+IDAgPyBmcm9tTm9kZXMoZG9tLCBub2RlcykgOiBmcm9tUm5nKGRvbSwgc2VsZWN0aW9uLmdldFJuZygpKTtcbiAgICAgIHZhciBtYXRjaGVzID0gZmluZCQxKHBhdHRlcm4sIHRleHRTZWN0aW9ucyk7XG4gICAgICBtYXJrKG1hdGNoZXMsIHJlcGxhY2VtZW50Tm9kZSk7XG4gICAgICBzZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuICAgICAgcmV0dXJuIG1hdGNoZXMubGVuZ3RoO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0RWxtSW5kZXggPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICB2YXIgdmFsdWUgPSBlbG0uZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1pbmRleCcpO1xuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuICcnICsgdmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfTtcbiAgICB2YXIgbWFya0FsbE1hdGNoZXMgPSBmdW5jdGlvbiAoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUsIHBhdHRlcm4sIGluU2VsZWN0aW9uKSB7XG4gICAgICB2YXIgbWFya2VyID0gZWRpdG9yLmRvbS5jcmVhdGUoJ3NwYW4nLCB7ICdkYXRhLW1jZS1ib2d1cyc6IDEgfSk7XG4gICAgICBtYXJrZXIuY2xhc3NOYW1lID0gJ21jZS1tYXRjaC1tYXJrZXInO1xuICAgICAgdmFyIG5vZGUgPSBlZGl0b3IuZ2V0Qm9keSgpO1xuICAgICAgZG9uZShlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSwgZmFsc2UpO1xuICAgICAgaWYgKGluU2VsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmaW5kQW5kTWFya0luU2VsZWN0aW9uKGVkaXRvci5kb20sIHBhdHRlcm4sIGVkaXRvci5zZWxlY3Rpb24sIG1hcmtlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmluZEFuZE1hcmsoZWRpdG9yLmRvbSwgcGF0dGVybiwgbm9kZSwgbWFya2VyKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB1bndyYXAgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgdmFyIHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICBpZiAobm9kZS5maXJzdENoaWxkKSB7XG4gICAgICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUuZmlyc3RDaGlsZCwgbm9kZSk7XG4gICAgICB9XG4gICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XG4gICAgfTtcbiAgICB2YXIgZmluZFNwYW5zQnlJbmRleCA9IGZ1bmN0aW9uIChlZGl0b3IsIGluZGV4KSB7XG4gICAgICB2YXIgc3BhbnMgPSBbXTtcbiAgICAgIHZhciBub2RlcyA9IGdsb2JhbCQxLnRvQXJyYXkoZWRpdG9yLmdldEJvZHkoKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3BhbicpKTtcbiAgICAgIGlmIChub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBub2RlSW5kZXggPSBnZXRFbG1JbmRleChub2Rlc1tpXSk7XG4gICAgICAgICAgaWYgKG5vZGVJbmRleCA9PT0gbnVsbCB8fCAhbm9kZUluZGV4Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChub2RlSW5kZXggPT09IGluZGV4LnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICAgIHNwYW5zLnB1c2gobm9kZXNbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHNwYW5zO1xuICAgIH07XG4gICAgdmFyIG1vdmVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUsIGZvcndhcmQpIHtcbiAgICAgIHZhciBzZWFyY2hTdGF0ZSA9IGN1cnJlbnRTZWFyY2hTdGF0ZS5nZXQoKTtcbiAgICAgIHZhciB0ZXN0SW5kZXggPSBzZWFyY2hTdGF0ZS5pbmRleDtcbiAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tO1xuICAgICAgZm9yd2FyZCA9IGZvcndhcmQgIT09IGZhbHNlO1xuICAgICAgaWYgKGZvcndhcmQpIHtcbiAgICAgICAgaWYgKHRlc3RJbmRleCArIDEgPT09IHNlYXJjaFN0YXRlLmNvdW50KSB7XG4gICAgICAgICAgdGVzdEluZGV4ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0ZXN0SW5kZXgrKztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRlc3RJbmRleCAtIDEgPT09IC0xKSB7XG4gICAgICAgICAgdGVzdEluZGV4ID0gc2VhcmNoU3RhdGUuY291bnQgLSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRlc3RJbmRleC0tO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBkb20ucmVtb3ZlQ2xhc3MoZmluZFNwYW5zQnlJbmRleChlZGl0b3IsIHNlYXJjaFN0YXRlLmluZGV4KSwgJ21jZS1tYXRjaC1tYXJrZXItc2VsZWN0ZWQnKTtcbiAgICAgIHZhciBzcGFucyA9IGZpbmRTcGFuc0J5SW5kZXgoZWRpdG9yLCB0ZXN0SW5kZXgpO1xuICAgICAgaWYgKHNwYW5zLmxlbmd0aCkge1xuICAgICAgICBkb20uYWRkQ2xhc3MoZmluZFNwYW5zQnlJbmRleChlZGl0b3IsIHRlc3RJbmRleCksICdtY2UtbWF0Y2gtbWFya2VyLXNlbGVjdGVkJyk7XG4gICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2Nyb2xsSW50b1ZpZXcoc3BhbnNbMF0pO1xuICAgICAgICByZXR1cm4gdGVzdEluZGV4O1xuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZU5vZGUgPSBmdW5jdGlvbiAoZG9tLCBub2RlKSB7XG4gICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgZG9tLnJlbW92ZShub2RlKTtcbiAgICAgIGlmIChkb20uaXNFbXB0eShwYXJlbnQpKSB7XG4gICAgICAgIGRvbS5yZW1vdmUocGFyZW50KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBlc2NhcGVTZWFyY2hUZXh0ID0gZnVuY3Rpb24gKHRleHQsIHdob2xlV29yZCkge1xuICAgICAgdmFyIGVzY2FwZWRUZXh0ID0gdGV4dC5yZXBsYWNlKC9bXFwtXFxbXFxdXFwvXFx7XFx9XFwoXFwpXFwqXFwrXFw/XFwuXFxcXFxcXlxcJFxcfF0vZywgJ1xcXFwkJicpLnJlcGxhY2UoL1xccy9nLCAnW15cXFxcU1xcXFxyXFxcXG5cXFxcdUZFRkZdJyk7XG4gICAgICB2YXIgd29yZFJlZ2V4ID0gJygnICsgZXNjYXBlZFRleHQgKyAnKSc7XG4gICAgICByZXR1cm4gd2hvbGVXb3JkID8gJyg/Ol58XFxcXHN8JyArIHB1bmN0dWF0aW9uJDEoKSArICcpJyArIHdvcmRSZWdleCArICgnKD89JHxcXFxcc3wnICsgcHVuY3R1YXRpb24kMSgpICsgJyknKSA6IHdvcmRSZWdleDtcbiAgICB9O1xuICAgIHZhciBmaW5kJDIgPSBmdW5jdGlvbiAoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUsIHRleHQsIG1hdGNoQ2FzZSwgd2hvbGVXb3JkLCBpblNlbGVjdGlvbikge1xuICAgICAgdmFyIGVzY2FwZWRUZXh0ID0gZXNjYXBlU2VhcmNoVGV4dCh0ZXh0LCB3aG9sZVdvcmQpO1xuICAgICAgdmFyIHBhdHRlcm4gPSB7XG4gICAgICAgIHJlZ2V4OiBuZXcgUmVnRXhwKGVzY2FwZWRUZXh0LCBtYXRjaENhc2UgPyAnZycgOiAnZ2knKSxcbiAgICAgICAgbWF0Y2hJbmRleDogMVxuICAgICAgfTtcbiAgICAgIHZhciBjb3VudCA9IG1hcmtBbGxNYXRjaGVzKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlLCBwYXR0ZXJuLCBpblNlbGVjdGlvbik7XG4gICAgICBpZiAoY291bnQpIHtcbiAgICAgICAgdmFyIG5ld0luZGV4ID0gbW92ZVNlbGVjdGlvbihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSwgdHJ1ZSk7XG4gICAgICAgIGN1cnJlbnRTZWFyY2hTdGF0ZS5zZXQoe1xuICAgICAgICAgIGluZGV4OiBuZXdJbmRleCxcbiAgICAgICAgICBjb3VudDogY291bnQsXG4gICAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgICBtYXRjaENhc2U6IG1hdGNoQ2FzZSxcbiAgICAgICAgICB3aG9sZVdvcmQ6IHdob2xlV29yZCxcbiAgICAgICAgICBpblNlbGVjdGlvbjogaW5TZWxlY3Rpb25cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY291bnQ7XG4gICAgfTtcbiAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIChlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSkge1xuICAgICAgdmFyIGluZGV4ID0gbW92ZVNlbGVjdGlvbihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSwgdHJ1ZSk7XG4gICAgICBjdXJyZW50U2VhcmNoU3RhdGUuc2V0KF9fYXNzaWduKF9fYXNzaWduKHt9LCBjdXJyZW50U2VhcmNoU3RhdGUuZ2V0KCkpLCB7IGluZGV4OiBpbmRleCB9KSk7XG4gICAgfTtcbiAgICB2YXIgcHJldiA9IGZ1bmN0aW9uIChlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSkge1xuICAgICAgdmFyIGluZGV4ID0gbW92ZVNlbGVjdGlvbihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSwgZmFsc2UpO1xuICAgICAgY3VycmVudFNlYXJjaFN0YXRlLnNldChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgY3VycmVudFNlYXJjaFN0YXRlLmdldCgpKSwgeyBpbmRleDogaW5kZXggfSkpO1xuICAgIH07XG4gICAgdmFyIGlzTWF0Y2hTcGFuID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHZhciBtYXRjaEluZGV4ID0gZ2V0RWxtSW5kZXgobm9kZSk7XG4gICAgICByZXR1cm4gbWF0Y2hJbmRleCAhPT0gbnVsbCAmJiBtYXRjaEluZGV4Lmxlbmd0aCA+IDA7XG4gICAgfTtcbiAgICB2YXIgcmVwbGFjZSA9IGZ1bmN0aW9uIChlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSwgdGV4dCwgZm9yd2FyZCwgYWxsKSB7XG4gICAgICB2YXIgc2VhcmNoU3RhdGUgPSBjdXJyZW50U2VhcmNoU3RhdGUuZ2V0KCk7XG4gICAgICB2YXIgY3VycmVudEluZGV4ID0gc2VhcmNoU3RhdGUuaW5kZXg7XG4gICAgICB2YXIgY3VycmVudE1hdGNoSW5kZXgsIG5leHRJbmRleCA9IGN1cnJlbnRJbmRleDtcbiAgICAgIGZvcndhcmQgPSBmb3J3YXJkICE9PSBmYWxzZTtcbiAgICAgIHZhciBub2RlID0gZWRpdG9yLmdldEJvZHkoKTtcbiAgICAgIHZhciBub2RlcyA9IGdsb2JhbCQxLmdyZXAoZ2xvYmFsJDEudG9BcnJheShub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJykpLCBpc01hdGNoU3Bhbik7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBub2RlSW5kZXggPSBnZXRFbG1JbmRleChub2Rlc1tpXSk7XG4gICAgICAgIHZhciBtYXRjaEluZGV4ID0gY3VycmVudE1hdGNoSW5kZXggPSBwYXJzZUludChub2RlSW5kZXgsIDEwKTtcbiAgICAgICAgaWYgKGFsbCB8fCBtYXRjaEluZGV4ID09PSBzZWFyY2hTdGF0ZS5pbmRleCkge1xuICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgbm9kZXNbaV0uZmlyc3RDaGlsZC5ub2RlVmFsdWUgPSB0ZXh0O1xuICAgICAgICAgICAgdW53cmFwKG5vZGVzW2ldKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVtb3ZlTm9kZShlZGl0b3IuZG9tLCBub2Rlc1tpXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHdoaWxlIChub2Rlc1srK2ldKSB7XG4gICAgICAgICAgICBtYXRjaEluZGV4ID0gcGFyc2VJbnQoZ2V0RWxtSW5kZXgobm9kZXNbaV0pLCAxMCk7XG4gICAgICAgICAgICBpZiAobWF0Y2hJbmRleCA9PT0gY3VycmVudE1hdGNoSW5kZXgpIHtcbiAgICAgICAgICAgICAgcmVtb3ZlTm9kZShlZGl0b3IuZG9tLCBub2Rlc1tpXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpLS07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZm9yd2FyZCkge1xuICAgICAgICAgICAgbmV4dEluZGV4LS07XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRNYXRjaEluZGV4ID4gY3VycmVudEluZGV4KSB7XG4gICAgICAgICAgbm9kZXNbaV0uc2V0QXR0cmlidXRlKCdkYXRhLW1jZS1pbmRleCcsIFN0cmluZyhjdXJyZW50TWF0Y2hJbmRleCAtIDEpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY3VycmVudFNlYXJjaFN0YXRlLnNldChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc2VhcmNoU3RhdGUpLCB7XG4gICAgICAgIGNvdW50OiBhbGwgPyAwIDogc2VhcmNoU3RhdGUuY291bnQgLSAxLFxuICAgICAgICBpbmRleDogbmV4dEluZGV4XG4gICAgICB9KSk7XG4gICAgICBpZiAoZm9yd2FyZCkge1xuICAgICAgICBuZXh0KGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByZXYoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuICFhbGwgJiYgY3VycmVudFNlYXJjaFN0YXRlLmdldCgpLmNvdW50ID4gMDtcbiAgICB9O1xuICAgIHZhciBkb25lID0gZnVuY3Rpb24gKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlLCBrZWVwRWRpdG9yU2VsZWN0aW9uKSB7XG4gICAgICB2YXIgaSwgc3RhcnRDb250YWluZXIsIGVuZENvbnRhaW5lcjtcbiAgICAgIHZhciBzZWFyY2hTdGF0ZSA9IGN1cnJlbnRTZWFyY2hTdGF0ZS5nZXQoKTtcbiAgICAgIHZhciBub2RlcyA9IGdsb2JhbCQxLnRvQXJyYXkoZWRpdG9yLmdldEJvZHkoKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3BhbicpKTtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbm9kZUluZGV4ID0gZ2V0RWxtSW5kZXgobm9kZXNbaV0pO1xuICAgICAgICBpZiAobm9kZUluZGV4ICE9PSBudWxsICYmIG5vZGVJbmRleC5sZW5ndGgpIHtcbiAgICAgICAgICBpZiAobm9kZUluZGV4ID09PSBzZWFyY2hTdGF0ZS5pbmRleC50b1N0cmluZygpKSB7XG4gICAgICAgICAgICBpZiAoIXN0YXJ0Q29udGFpbmVyKSB7XG4gICAgICAgICAgICAgIHN0YXJ0Q29udGFpbmVyID0gbm9kZXNbaV0uZmlyc3RDaGlsZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVuZENvbnRhaW5lciA9IG5vZGVzW2ldLmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVud3JhcChub2Rlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGN1cnJlbnRTZWFyY2hTdGF0ZS5zZXQoX19hc3NpZ24oX19hc3NpZ24oe30sIHNlYXJjaFN0YXRlKSwge1xuICAgICAgICBpbmRleDogLTEsXG4gICAgICAgIGNvdW50OiAwLFxuICAgICAgICB0ZXh0OiAnJ1xuICAgICAgfSkpO1xuICAgICAgaWYgKHN0YXJ0Q29udGFpbmVyICYmIGVuZENvbnRhaW5lcikge1xuICAgICAgICB2YXIgcm5nID0gZWRpdG9yLmRvbS5jcmVhdGVSbmcoKTtcbiAgICAgICAgcm5nLnNldFN0YXJ0KHN0YXJ0Q29udGFpbmVyLCAwKTtcbiAgICAgICAgcm5nLnNldEVuZChlbmRDb250YWluZXIsIGVuZENvbnRhaW5lci5kYXRhLmxlbmd0aCk7XG4gICAgICAgIGlmIChrZWVwRWRpdG9yU2VsZWN0aW9uICE9PSBmYWxzZSkge1xuICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJuZztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBoYXNOZXh0ID0gZnVuY3Rpb24gKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKSB7XG4gICAgICByZXR1cm4gY3VycmVudFNlYXJjaFN0YXRlLmdldCgpLmNvdW50ID4gMTtcbiAgICB9O1xuICAgIHZhciBoYXNQcmV2ID0gZnVuY3Rpb24gKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKSB7XG4gICAgICByZXR1cm4gY3VycmVudFNlYXJjaFN0YXRlLmdldCgpLmNvdW50ID4gMTtcbiAgICB9O1xuXG4gICAgdmFyIGdldCQxID0gZnVuY3Rpb24gKGVkaXRvciwgY3VycmVudFN0YXRlKSB7XG4gICAgICB2YXIgZG9uZSQxID0gZnVuY3Rpb24gKGtlZXBFZGl0b3JTZWxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGRvbmUoZWRpdG9yLCBjdXJyZW50U3RhdGUsIGtlZXBFZGl0b3JTZWxlY3Rpb24pO1xuICAgICAgfTtcbiAgICAgIHZhciBmaW5kID0gZnVuY3Rpb24gKHRleHQsIG1hdGNoQ2FzZSwgd2hvbGVXb3JkLCBpblNlbGVjdGlvbikge1xuICAgICAgICBpZiAoaW5TZWxlY3Rpb24gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGluU2VsZWN0aW9uID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbmQkMihlZGl0b3IsIGN1cnJlbnRTdGF0ZSwgdGV4dCwgbWF0Y2hDYXNlLCB3aG9sZVdvcmQsIGluU2VsZWN0aW9uKTtcbiAgICAgIH07XG4gICAgICB2YXIgbmV4dCQxID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV4dChlZGl0b3IsIGN1cnJlbnRTdGF0ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHByZXYkMSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByZXYoZWRpdG9yLCBjdXJyZW50U3RhdGUpO1xuICAgICAgfTtcbiAgICAgIHZhciByZXBsYWNlJDEgPSBmdW5jdGlvbiAodGV4dCwgZm9yd2FyZCwgYWxsKSB7XG4gICAgICAgIHJldHVybiByZXBsYWNlKGVkaXRvciwgY3VycmVudFN0YXRlLCB0ZXh0LCBmb3J3YXJkLCBhbGwpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbmU6IGRvbmUkMSxcbiAgICAgICAgZmluZDogZmluZCxcbiAgICAgICAgbmV4dDogbmV4dCQxLFxuICAgICAgICBwcmV2OiBwcmV2JDEsXG4gICAgICAgIHJlcGxhY2U6IHJlcGxhY2UkMVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN1YmplY3QgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5zZXQoT3B0aW9uYWwuc29tZShzKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5lYWNoKGYpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGlzU2V0OiBpc1NldCxcbiAgICAgICAgb246IG9uXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5FbnYnKTtcblxuICAgIHZhciBvcGVuID0gZnVuY3Rpb24gKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKSB7XG4gICAgICB2YXIgZGlhbG9nQXBpID0gdmFsdWUoKTtcbiAgICAgIGVkaXRvci51bmRvTWFuYWdlci5hZGQoKTtcbiAgICAgIHZhciBzZWxlY3RlZFRleHQgPSBnbG9iYWwkMS50cmltKGVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCh7IGZvcm1hdDogJ3RleHQnIH0pKTtcbiAgICAgIHZhciB1cGRhdGVCdXR0b25TdGF0ZXMgPSBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgIHZhciB1cGRhdGVOZXh0ID0gaGFzTmV4dChlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSkgPyBhcGkuZW5hYmxlIDogYXBpLmRpc2FibGU7XG4gICAgICAgIHVwZGF0ZU5leHQoJ25leHQnKTtcbiAgICAgICAgdmFyIHVwZGF0ZVByZXYgPSBoYXNQcmV2KGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKSA/IGFwaS5lbmFibGUgOiBhcGkuZGlzYWJsZTtcbiAgICAgICAgdXBkYXRlUHJldigncHJldicpO1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGVTZWFyY2hTdGF0ZSA9IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgICB2YXIgY3VycmVudCA9IGN1cnJlbnRTZWFyY2hTdGF0ZS5nZXQoKTtcbiAgICAgICAgY3VycmVudFNlYXJjaFN0YXRlLnNldChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgY3VycmVudCksIHtcbiAgICAgICAgICBtYXRjaENhc2U6IGRhdGEubWF0Y2hjYXNlLFxuICAgICAgICAgIHdob2xlV29yZDogZGF0YS53aG9sZXdvcmRzLFxuICAgICAgICAgIGluU2VsZWN0aW9uOiBkYXRhLmluc2VsZWN0aW9uXG4gICAgICAgIH0pKTtcbiAgICAgIH07XG4gICAgICB2YXIgZGlzYWJsZUFsbCA9IGZ1bmN0aW9uIChhcGksIGRpc2FibGUpIHtcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSBbXG4gICAgICAgICAgJ3JlcGxhY2UnLFxuICAgICAgICAgICdyZXBsYWNlYWxsJyxcbiAgICAgICAgICAncHJldicsXG4gICAgICAgICAgJ25leHQnXG4gICAgICAgIF07XG4gICAgICAgIHZhciB0b2dnbGUgPSBkaXNhYmxlID8gYXBpLmRpc2FibGUgOiBhcGkuZW5hYmxlO1xuICAgICAgICBlYWNoKGJ1dHRvbnMsIHRvZ2dsZSk7XG4gICAgICB9O1xuICAgICAgdmFyIG5vdEZvdW5kQWxlcnQgPSBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgIGVkaXRvci53aW5kb3dNYW5hZ2VyLmFsZXJ0KCdDb3VsZCBub3QgZmluZCB0aGUgc3BlY2lmaWVkIHN0cmluZy4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYXBpLmZvY3VzKCdmaW5kdGV4dCcpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZm9jdXNCdXR0b25JZlJlcXVpcmVkID0gZnVuY3Rpb24gKGFwaSwgbmFtZSkge1xuICAgICAgICBpZiAoZ2xvYmFsJDMuYnJvd3Nlci5pc1NhZmFyaSgpICYmIGdsb2JhbCQzLmRldmljZVR5cGUuaXNUb3VjaCgpICYmIChuYW1lID09PSAnZmluZCcgfHwgbmFtZSA9PT0gJ3JlcGxhY2UnIHx8IG5hbWUgPT09ICdyZXBsYWNlYWxsJykpIHtcbiAgICAgICAgICBhcGkuZm9jdXMobmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgcmVzZXQgPSBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgIGRvbmUoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUsIGZhbHNlKTtcbiAgICAgICAgZGlzYWJsZUFsbChhcGksIHRydWUpO1xuICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoYXBpKTtcbiAgICAgIH07XG4gICAgICB2YXIgZG9GaW5kID0gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICAgIHZhciBsYXN0ID0gY3VycmVudFNlYXJjaFN0YXRlLmdldCgpO1xuICAgICAgICBpZiAoIWRhdGEuZmluZHRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgcmVzZXQoYXBpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhc3QudGV4dCA9PT0gZGF0YS5maW5kdGV4dCAmJiBsYXN0Lm1hdGNoQ2FzZSA9PT0gZGF0YS5tYXRjaGNhc2UgJiYgbGFzdC53aG9sZVdvcmQgPT09IGRhdGEud2hvbGV3b3Jkcykge1xuICAgICAgICAgIG5leHQoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBjb3VudCA9IGZpbmQkMihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSwgZGF0YS5maW5kdGV4dCwgZGF0YS5tYXRjaGNhc2UsIGRhdGEud2hvbGV3b3JkcywgZGF0YS5pbnNlbGVjdGlvbik7XG4gICAgICAgICAgaWYgKGNvdW50IDw9IDApIHtcbiAgICAgICAgICAgIG5vdEZvdW5kQWxlcnQoYXBpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGlzYWJsZUFsbChhcGksIGNvdW50ID09PSAwKTtcbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoYXBpKTtcbiAgICAgIH07XG4gICAgICB2YXIgaW5pdGlhbFN0YXRlID0gY3VycmVudFNlYXJjaFN0YXRlLmdldCgpO1xuICAgICAgdmFyIGluaXRpYWxEYXRhID0ge1xuICAgICAgICBmaW5kdGV4dDogc2VsZWN0ZWRUZXh0LFxuICAgICAgICByZXBsYWNldGV4dDogJycsXG4gICAgICAgIHdob2xld29yZHM6IGluaXRpYWxTdGF0ZS53aG9sZVdvcmQsXG4gICAgICAgIG1hdGNoY2FzZTogaW5pdGlhbFN0YXRlLm1hdGNoQ2FzZSxcbiAgICAgICAgaW5zZWxlY3Rpb246IGluaXRpYWxTdGF0ZS5pblNlbGVjdGlvblxuICAgICAgfTtcbiAgICAgIHZhciBzcGVjID0ge1xuICAgICAgICB0aXRsZTogJ0ZpbmQgYW5kIFJlcGxhY2UnLFxuICAgICAgICBzaXplOiAnbm9ybWFsJyxcbiAgICAgICAgYm9keToge1xuICAgICAgICAgIHR5cGU6ICdwYW5lbCcsXG4gICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogJ2JhcicsXG4gICAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgICAgICAgICAgIG5hbWU6ICdmaW5kdGV4dCcsXG4gICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ0ZpbmQnLFxuICAgICAgICAgICAgICAgICAgbWF4aW1pemVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgaW5wdXRNb2RlOiAnc2VhcmNoJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICBuYW1lOiAncHJldicsXG4gICAgICAgICAgICAgICAgICB0ZXh0OiAnUHJldmlvdXMnLFxuICAgICAgICAgICAgICAgICAgaWNvbjogJ2FjdGlvbi1wcmV2JyxcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgYm9yZGVybGVzczogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICBuYW1lOiAnbmV4dCcsXG4gICAgICAgICAgICAgICAgICB0ZXh0OiAnTmV4dCcsXG4gICAgICAgICAgICAgICAgICBpY29uOiAnYWN0aW9uLW5leHQnLFxuICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICBib3JkZXJsZXNzOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICAgICAgICBuYW1lOiAncmVwbGFjZXRleHQnLFxuICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ1JlcGxhY2Ugd2l0aCcsXG4gICAgICAgICAgICAgIGlucHV0TW9kZTogJ3NlYXJjaCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnbWVudScsXG4gICAgICAgICAgICBuYW1lOiAnb3B0aW9ucycsXG4gICAgICAgICAgICBpY29uOiAncHJlZmVyZW5jZXMnLFxuICAgICAgICAgICAgdG9vbHRpcDogJ1ByZWZlcmVuY2VzJyxcbiAgICAgICAgICAgIGFsaWduOiAnc3RhcnQnLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6ICd0b2dnbGVtZW51aXRlbScsXG4gICAgICAgICAgICAgICAgbmFtZTogJ21hdGNoY2FzZScsXG4gICAgICAgICAgICAgICAgdGV4dDogJ01hdGNoIGNhc2UnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAndG9nZ2xlbWVudWl0ZW0nLFxuICAgICAgICAgICAgICAgIG5hbWU6ICd3aG9sZXdvcmRzJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnRmluZCB3aG9sZSB3b3JkcyBvbmx5J1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3RvZ2dsZW1lbnVpdGVtJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW5zZWxlY3Rpb24nLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdGaW5kIGluIHNlbGVjdGlvbidcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2N1c3RvbScsXG4gICAgICAgICAgICBuYW1lOiAnZmluZCcsXG4gICAgICAgICAgICB0ZXh0OiAnRmluZCcsXG4gICAgICAgICAgICBwcmltYXJ5OiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY3VzdG9tJyxcbiAgICAgICAgICAgIG5hbWU6ICdyZXBsYWNlJyxcbiAgICAgICAgICAgIHRleHQ6ICdSZXBsYWNlJyxcbiAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY3VzdG9tJyxcbiAgICAgICAgICAgIG5hbWU6ICdyZXBsYWNlYWxsJyxcbiAgICAgICAgICAgIHRleHQ6ICdSZXBsYWNlIGFsbCcsXG4gICAgICAgICAgICBkaXNhYmxlZDogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgaW5pdGlhbERhdGE6IGluaXRpYWxEYXRhLFxuICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGFwaSwgZGV0YWlscykge1xuICAgICAgICAgIGlmIChkZXRhaWxzLm5hbWUgPT09ICdmaW5kdGV4dCcgJiYgY3VycmVudFNlYXJjaFN0YXRlLmdldCgpLmNvdW50ID4gMCkge1xuICAgICAgICAgICAgcmVzZXQoYXBpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoYXBpLCBkZXRhaWxzKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgICAgIHN3aXRjaCAoZGV0YWlscy5uYW1lKSB7XG4gICAgICAgICAgY2FzZSAnZmluZCc6XG4gICAgICAgICAgICBkb0ZpbmQoYXBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3JlcGxhY2UnOlxuICAgICAgICAgICAgaWYgKCFyZXBsYWNlKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlLCBkYXRhLnJlcGxhY2V0ZXh0KSkge1xuICAgICAgICAgICAgICByZXNldChhcGkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGVzKGFwaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdyZXBsYWNlYWxsJzpcbiAgICAgICAgICAgIHJlcGxhY2UoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUsIGRhdGEucmVwbGFjZXRleHQsIHRydWUsIHRydWUpO1xuICAgICAgICAgICAgcmVzZXQoYXBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3ByZXYnOlxuICAgICAgICAgICAgcHJldihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSk7XG4gICAgICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoYXBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ25leHQnOlxuICAgICAgICAgICAgbmV4dChlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSk7XG4gICAgICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZXMoYXBpKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ21hdGNoY2FzZSc6XG4gICAgICAgICAgY2FzZSAnd2hvbGV3b3Jkcyc6XG4gICAgICAgICAgY2FzZSAnaW5zZWxlY3Rpb24nOlxuICAgICAgICAgICAgdXBkYXRlU2VhcmNoU3RhdGUoYXBpKTtcbiAgICAgICAgICAgIHJlc2V0KGFwaSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9jdXNCdXR0b25JZlJlcXVpcmVkKGFwaSwgZGV0YWlscy5uYW1lKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICBkb0ZpbmQoYXBpKTtcbiAgICAgICAgICBmb2N1c0J1dHRvbklmUmVxdWlyZWQoYXBpLCAnZmluZCcpO1xuICAgICAgICB9LFxuICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgZG9uZShlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSk7XG4gICAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLmFkZCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZGlhbG9nQXBpLnNldChlZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHNwZWMsIHsgaW5saW5lOiAndG9vbGJhcicgfSkpO1xuICAgIH07XG5cbiAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUpIHtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdTZWFyY2hSZXBsYWNlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBvcGVuKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgc2hvd0RpYWxvZyA9IGZ1bmN0aW9uIChlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgb3BlbihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyJDEgPSBmdW5jdGlvbiAoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUpIHtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgnc2VhcmNocmVwbGFjZScsIHtcbiAgICAgICAgdGV4dDogJ0ZpbmQgYW5kIHJlcGxhY2UuLi4nLFxuICAgICAgICBzaG9ydGN1dDogJ01ldGErRicsXG4gICAgICAgIG9uQWN0aW9uOiBzaG93RGlhbG9nKGVkaXRvciwgY3VycmVudFNlYXJjaFN0YXRlKSxcbiAgICAgICAgaWNvbjogJ3NlYXJjaCdcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbignc2VhcmNocmVwbGFjZScsIHtcbiAgICAgICAgdG9vbHRpcDogJ0ZpbmQgYW5kIHJlcGxhY2UnLFxuICAgICAgICBvbkFjdGlvbjogc2hvd0RpYWxvZyhlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSksXG4gICAgICAgIGljb246ICdzZWFyY2gnXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5zaG9ydGN1dHMuYWRkKCdNZXRhK0YnLCAnJywgc2hvd0RpYWxvZyhlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSkpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBQbHVnaW4gKCkge1xuICAgICAgZ2xvYmFsLmFkZCgnc2VhcmNocmVwbGFjZScsIGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRTZWFyY2hTdGF0ZSA9IENlbGwoe1xuICAgICAgICAgIGluZGV4OiAtMSxcbiAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICB0ZXh0OiAnJyxcbiAgICAgICAgICBtYXRjaENhc2U6IGZhbHNlLFxuICAgICAgICAgIHdob2xlV29yZDogZmFsc2UsXG4gICAgICAgICAgaW5TZWxlY3Rpb246IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICByZWdpc3RlcihlZGl0b3IsIGN1cnJlbnRTZWFyY2hTdGF0ZSk7XG4gICAgICAgIHJlZ2lzdGVyJDEoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUpO1xuICAgICAgICByZXR1cm4gZ2V0JDEoZWRpdG9yLCBjdXJyZW50U2VhcmNoU3RhdGUpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgUGx1Z2luKCk7XG5cbn0oKSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBOzs7Ozs7OztBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7O0EiLCJzb3VyY2VSb290IjoiIn0=