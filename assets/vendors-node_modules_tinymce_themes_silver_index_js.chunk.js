(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_themes_silver_index_js"],{

/***/ "./node_modules/tinymce/themes/silver/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "silver" theme for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/themes/silver')
//   ES2015:
//     import 'tinymce/themes/silver'
__webpack_require__(/*! ./theme.js */ "./node_modules/tinymce/themes/silver/theme.js");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/theme.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/theme.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var eq = function (t) {
      return function (a) {
        return t === a;
      };
    };
    var isString = isType('string');
    var isObject = isType('object');
    var isArray = isType('array');
    var isBoolean = isSimpleType('boolean');
    var isUndefined = eq(undefined);
    var isNullable = function (a) {
      return a === null || a === undefined;
    };
    var isNonNullable = function (a) {
      return !isNullable(a);
    };
    var isFunction = isSimpleType('function');
    var isNumber = isSimpleType('number');
    var isArrayOf = function (value, pred) {
      if (isArray(value)) {
        for (var i = 0, len = value.length; i < len; ++i) {
          if (!pred(value[i])) {
            return false;
          }
        }
        return true;
      }
      return false;
    };

    var noop = function () {
    };
    var noarg = function (f) {
      return function () {
        return f();
      };
    };
    var compose = function (fa, fb) {
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        return fa(fb.apply(null, args));
      };
    };
    var compose1 = function (fbc, fab) {
      return function (a) {
        return fbc(fab(a));
      };
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var identity = function (x) {
      return x;
    };
    function curry(fn) {
      var initialArgs = [];
      for (var _i = 1; _i < arguments.length; _i++) {
        initialArgs[_i - 1] = arguments[_i];
      }
      return function () {
        var restArgs = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          restArgs[_i] = arguments[_i];
        }
        var all = initialArgs.concat(restArgs);
        return fn.apply(null, all);
      };
    }
    var not = function (f) {
      return function (t) {
        return !f(t);
      };
    };
    var die = function (msg) {
      return function () {
        throw new Error(msg);
      };
    };
    var never = constant(false);
    var always = constant(true);

    var global$1 = tinymce.util.Tools.resolve('tinymce.ThemeManager');

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };
    function __rest(s, e) {
      var t = {};
      for (var p in s)
        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
          t[p] = s[p];
      if (s != null && typeof Object.getOwnPropertySymbols === 'function')
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
            t[p[i]] = s[p[i]];
        }
      return t;
    }
    function __spreadArrays() {
      for (var s = 0, i = 0, il = arguments.length; i < il; i++)
        s += arguments[i].length;
      for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
          r[k] = a[j];
      return r;
    }

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var nativeSlice = Array.prototype.slice;
    var nativeIndexOf = Array.prototype.indexOf;
    var nativePush = Array.prototype.push;
    var rawIndexOf = function (ts, t) {
      return nativeIndexOf.call(ts, t);
    };
    var indexOf = function (xs, x) {
      var r = rawIndexOf(xs, x);
      return r === -1 ? Optional.none() : Optional.some(r);
    };
    var contains = function (xs, x) {
      return rawIndexOf(xs, x) > -1;
    };
    var exists = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return true;
        }
      }
      return false;
    };
    var range = function (num, f) {
      var r = [];
      for (var i = 0; i < num; i++) {
        r.push(f(i));
      }
      return r;
    };
    var chunk = function (array, size) {
      var r = [];
      for (var i = 0; i < array.length; i += size) {
        var s = nativeSlice.call(array, i, i + size);
        r.push(s);
      }
      return r;
    };
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var eachr = function (xs, f) {
      for (var i = xs.length - 1; i >= 0; i--) {
        var x = xs[i];
        f(x, i);
      }
    };
    var partition = function (xs, pred) {
      var pass = [];
      var fail = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        var arr = pred(x, i) ? pass : fail;
        arr.push(x);
      }
      return {
        pass: pass,
        fail: fail
      };
    };
    var filter = function (xs, pred) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          r.push(x);
        }
      }
      return r;
    };
    var foldr = function (xs, f, acc) {
      eachr(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var foldl = function (xs, f, acc) {
      each(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var findUntil = function (xs, pred, until) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return Optional.some(x);
        } else if (until(x, i)) {
          break;
        }
      }
      return Optional.none();
    };
    var find = function (xs, pred) {
      return findUntil(xs, pred, never);
    };
    var findIndex = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return Optional.some(i);
        }
      }
      return Optional.none();
    };
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var bind = function (xs, f) {
      return flatten(map(xs, f));
    };
    var forall = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; ++i) {
        var x = xs[i];
        if (pred(x, i) !== true) {
          return false;
        }
      }
      return true;
    };
    var reverse = function (xs) {
      var r = nativeSlice.call(xs, 0);
      r.reverse();
      return r;
    };
    var difference = function (a1, a2) {
      return filter(a1, function (x) {
        return !contains(a2, x);
      });
    };
    var mapToObject = function (xs, f) {
      var r = {};
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        r[String(x)] = f(x, i);
      }
      return r;
    };
    var sort = function (xs, comparator) {
      var copy = nativeSlice.call(xs, 0);
      copy.sort(comparator);
      return copy;
    };
    var get = function (xs, i) {
      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();
    };
    var head = function (xs) {
      return get(xs, 0);
    };
    var last = function (xs) {
      return get(xs, xs.length - 1);
    };
    var from$1 = isFunction(Array.from) ? Array.from : function (x) {
      return nativeSlice.call(x);
    };
    var findMap = function (arr, f) {
      for (var i = 0; i < arr.length; i++) {
        var r = f(arr[i], i);
        if (r.isSome()) {
          return r;
        }
      }
      return Optional.none();
    };

    var value = function (o) {
      var is = function (v) {
        return o === v;
      };
      var or = function (_opt) {
        return value(o);
      };
      var orThunk = function (_f) {
        return value(o);
      };
      var map = function (f) {
        return value(f(o));
      };
      var mapError = function (_f) {
        return value(o);
      };
      var each = function (f) {
        f(o);
      };
      var bind = function (f) {
        return f(o);
      };
      var fold = function (_, onValue) {
        return onValue(o);
      };
      var exists = function (f) {
        return f(o);
      };
      var forall = function (f) {
        return f(o);
      };
      var toOptional = function () {
        return Optional.some(o);
      };
      return {
        is: is,
        isValue: always,
        isError: never,
        getOr: constant(o),
        getOrThunk: constant(o),
        getOrDie: constant(o),
        or: or,
        orThunk: orThunk,
        fold: fold,
        map: map,
        mapError: mapError,
        each: each,
        bind: bind,
        exists: exists,
        forall: forall,
        toOptional: toOptional
      };
    };
    var error = function (message) {
      var getOrThunk = function (f) {
        return f();
      };
      var getOrDie = function () {
        return die(String(message))();
      };
      var or = function (opt) {
        return opt;
      };
      var orThunk = function (f) {
        return f();
      };
      var map = function (_f) {
        return error(message);
      };
      var mapError = function (f) {
        return error(f(message));
      };
      var bind = function (_f) {
        return error(message);
      };
      var fold = function (onError, _) {
        return onError(message);
      };
      return {
        is: never,
        isValue: never,
        isError: always,
        getOr: identity,
        getOrThunk: getOrThunk,
        getOrDie: getOrDie,
        or: or,
        orThunk: orThunk,
        fold: fold,
        map: map,
        mapError: mapError,
        each: noop,
        bind: bind,
        exists: never,
        forall: always,
        toOptional: Optional.none
      };
    };
    var fromOption = function (opt, err) {
      return opt.fold(function () {
        return error(err);
      }, value);
    };
    var Result = {
      value: value,
      error: error,
      fromOption: fromOption
    };

    var SimpleResultType;
    (function (SimpleResultType) {
      SimpleResultType[SimpleResultType['Error'] = 0] = 'Error';
      SimpleResultType[SimpleResultType['Value'] = 1] = 'Value';
    }(SimpleResultType || (SimpleResultType = {})));
    var fold = function (res, onError, onValue) {
      return res.stype === SimpleResultType.Error ? onError(res.serror) : onValue(res.svalue);
    };
    var partition$1 = function (results) {
      var values = [];
      var errors = [];
      each(results, function (obj) {
        fold(obj, function (err) {
          return errors.push(err);
        }, function (val) {
          return values.push(val);
        });
      });
      return {
        values: values,
        errors: errors
      };
    };
    var mapError = function (res, f) {
      if (res.stype === SimpleResultType.Error) {
        return {
          stype: SimpleResultType.Error,
          serror: f(res.serror)
        };
      } else {
        return res;
      }
    };
    var map$1 = function (res, f) {
      if (res.stype === SimpleResultType.Value) {
        return {
          stype: SimpleResultType.Value,
          svalue: f(res.svalue)
        };
      } else {
        return res;
      }
    };
    var bind$1 = function (res, f) {
      if (res.stype === SimpleResultType.Value) {
        return f(res.svalue);
      } else {
        return res;
      }
    };
    var bindError = function (res, f) {
      if (res.stype === SimpleResultType.Error) {
        return f(res.serror);
      } else {
        return res;
      }
    };
    var svalue = function (v) {
      return {
        stype: SimpleResultType.Value,
        svalue: v
      };
    };
    var serror = function (e) {
      return {
        stype: SimpleResultType.Error,
        serror: e
      };
    };
    var toResult = function (res) {
      return fold(res, Result.error, Result.value);
    };
    var fromResult = function (res) {
      return res.fold(serror, svalue);
    };
    var SimpleResult = {
      fromResult: fromResult,
      toResult: toResult,
      svalue: svalue,
      partition: partition$1,
      serror: serror,
      bind: bind$1,
      bindError: bindError,
      map: map$1,
      mapError: mapError,
      fold: fold
    };

    var keys = Object.keys;
    var hasOwnProperty = Object.hasOwnProperty;
    var each$1 = function (obj, f) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        f(x, i);
      }
    };
    var map$2 = function (obj, f) {
      return tupleMap(obj, function (x, i) {
        return {
          k: i,
          v: f(x, i)
        };
      });
    };
    var tupleMap = function (obj, f) {
      var r = {};
      each$1(obj, function (x, i) {
        var tuple = f(x, i);
        r[tuple.k] = tuple.v;
      });
      return r;
    };
    var objAcc = function (r) {
      return function (x, i) {
        r[i] = x;
      };
    };
    var internalFilter = function (obj, pred, onTrue, onFalse) {
      var r = {};
      each$1(obj, function (x, i) {
        (pred(x, i) ? onTrue : onFalse)(x, i);
      });
      return r;
    };
    var filter$1 = function (obj, pred) {
      var t = {};
      internalFilter(obj, pred, objAcc(t), noop);
      return t;
    };
    var mapToArray = function (obj, f) {
      var r = [];
      each$1(obj, function (value, name) {
        r.push(f(value, name));
      });
      return r;
    };
    var find$1 = function (obj, pred) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        if (pred(x, i, obj)) {
          return Optional.some(x);
        }
      }
      return Optional.none();
    };
    var values = function (obj) {
      return mapToArray(obj, function (v) {
        return v;
      });
    };
    var get$1 = function (obj, key) {
      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();
    };
    var has = function (obj, key) {
      return hasOwnProperty.call(obj, key);
    };
    var hasNonNullableKey = function (obj, key) {
      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;
    };

    var generate = function (cases) {
      if (!isArray(cases)) {
        throw new Error('cases must be an array');
      }
      if (cases.length === 0) {
        throw new Error('there must be at least one case');
      }
      var constructors = [];
      var adt = {};
      each(cases, function (acase, count) {
        var keys$1 = keys(acase);
        if (keys$1.length !== 1) {
          throw new Error('one and only one name per case');
        }
        var key = keys$1[0];
        var value = acase[key];
        if (adt[key] !== undefined) {
          throw new Error('duplicate key detected:' + key);
        } else if (key === 'cata') {
          throw new Error('cannot have a case named cata (sorry)');
        } else if (!isArray(value)) {
          throw new Error('case arguments must be an array');
        }
        constructors.push(key);
        adt[key] = function () {
          var args = [];
          for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
          }
          var argLength = args.length;
          if (argLength !== value.length) {
            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);
          }
          var match = function (branches) {
            var branchKeys = keys(branches);
            if (constructors.length !== branchKeys.length) {
              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\nActual: ' + branchKeys.join(','));
            }
            var allReqd = forall(constructors, function (reqKey) {
              return contains(branchKeys, reqKey);
            });
            if (!allReqd) {
              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\nRequired: ' + constructors.join(', '));
            }
            return branches[key].apply(null, args);
          };
          return {
            fold: function () {
              var foldArgs = [];
              for (var _i = 0; _i < arguments.length; _i++) {
                foldArgs[_i] = arguments[_i];
              }
              if (foldArgs.length !== cases.length) {
                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + foldArgs.length);
              }
              var target = foldArgs[count];
              return target.apply(null, args);
            },
            match: match,
            log: function (label) {
              console.log(label, {
                constructors: constructors,
                constructor: key,
                params: args
              });
            }
          };
        };
      });
      return adt;
    };
    var Adt = { generate: generate };

    var hasOwnProperty$1 = Object.prototype.hasOwnProperty;
    var shallow = function (old, nu) {
      return nu;
    };
    var deep = function (old, nu) {
      var bothObjects = isObject(old) && isObject(nu);
      return bothObjects ? deepMerge(old, nu) : nu;
    };
    var baseMerge = function (merger) {
      return function () {
        var objects = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          objects[_i] = arguments[_i];
        }
        if (objects.length === 0) {
          throw new Error('Can\'t merge zero objects');
        }
        var ret = {};
        for (var j = 0; j < objects.length; j++) {
          var curObject = objects[j];
          for (var key in curObject) {
            if (hasOwnProperty$1.call(curObject, key)) {
              ret[key] = merger(ret[key], curObject[key]);
            }
          }
        }
        return ret;
      };
    };
    var deepMerge = baseMerge(deep);
    var merge = baseMerge(shallow);

    var cached = function (f) {
      var called = false;
      var r;
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        if (!called) {
          called = true;
          r = f.apply(null, args);
        }
        return r;
      };
    };

    var adt = Adt.generate([
      { strict: [] },
      { defaultedThunk: ['fallbackThunk'] },
      { asOption: [] },
      { asDefaultedOptionThunk: ['fallbackThunk'] },
      { mergeWithThunk: ['baseThunk'] }
    ]);
    var defaulted = function (fallback) {
      return adt.defaultedThunk(constant(fallback));
    };
    var mergeWith = function (base) {
      return adt.mergeWithThunk(constant(base));
    };
    var strict = adt.strict;
    var asOption = adt.asOption;
    var defaultedThunk = adt.defaultedThunk;
    var asDefaultedOptionThunk = adt.asDefaultedOptionThunk;
    var mergeWithThunk = adt.mergeWithThunk;

    var comparison = Adt.generate([
      {
        bothErrors: [
          'error1',
          'error2'
        ]
      },
      {
        firstError: [
          'error1',
          'value2'
        ]
      },
      {
        secondError: [
          'value1',
          'error2'
        ]
      },
      {
        bothValues: [
          'value1',
          'value2'
        ]
      }
    ]);
    var partition$2 = function (results) {
      var errors = [];
      var values = [];
      each(results, function (result) {
        result.fold(function (err) {
          errors.push(err);
        }, function (value) {
          values.push(value);
        });
      });
      return {
        errors: errors,
        values: values
      };
    };

    var exclude = function (obj, fields) {
      var r = {};
      each$1(obj, function (v, k) {
        if (!contains(fields, k)) {
          r[k] = v;
        }
      });
      return r;
    };

    var wrap = function (key, value) {
      var _a;
      return _a = {}, _a[key] = value, _a;
    };
    var wrapAll = function (keyvalues) {
      var r = {};
      each(keyvalues, function (kv) {
        r[kv.key] = kv.value;
      });
      return r;
    };

    var exclude$1 = function (obj, fields) {
      return exclude(obj, fields);
    };
    var wrap$1 = function (key, value) {
      return wrap(key, value);
    };
    var wrapAll$1 = function (keyvalues) {
      return wrapAll(keyvalues);
    };
    var mergeValues = function (values, base) {
      return values.length === 0 ? Result.value(base) : Result.value(deepMerge(base, merge.apply(undefined, values)));
    };
    var mergeErrors = function (errors) {
      return Result.error(flatten(errors));
    };
    var consolidate = function (objs, base) {
      var partitions = partition$2(objs);
      return partitions.errors.length > 0 ? mergeErrors(partitions.errors) : mergeValues(partitions.values, base);
    };

    var mergeValues$1 = function (values, base) {
      return values.length > 0 ? SimpleResult.svalue(deepMerge(base, merge.apply(undefined, values))) : SimpleResult.svalue(base);
    };
    var mergeErrors$1 = function (errors) {
      return compose(SimpleResult.serror, flatten)(errors);
    };
    var consolidateObj = function (objects, base) {
      var partition = SimpleResult.partition(objects);
      return partition.errors.length > 0 ? mergeErrors$1(partition.errors) : mergeValues$1(partition.values, base);
    };
    var consolidateArr = function (objects) {
      var partitions = SimpleResult.partition(objects);
      return partitions.errors.length > 0 ? mergeErrors$1(partitions.errors) : SimpleResult.svalue(partitions.values);
    };
    var ResultCombine = {
      consolidateObj: consolidateObj,
      consolidateArr: consolidateArr
    };

    var formatObj = function (input) {
      return isObject(input) && keys(input).length > 100 ? ' removed due to size' : JSON.stringify(input, null, 2);
    };
    var formatErrors = function (errors) {
      var es = errors.length > 10 ? errors.slice(0, 10).concat([{
          path: [],
          getErrorInfo: function () {
            return '... (only showing first ten failures)';
          }
        }]) : errors;
      return map(es, function (e) {
        return 'Failed path: (' + e.path.join(' > ') + ')\n' + e.getErrorInfo();
      });
    };

    var nu = function (path, getErrorInfo) {
      return SimpleResult.serror([{
          path: path,
          getErrorInfo: getErrorInfo
        }]);
    };
    var missingStrict = function (path, key, obj) {
      return nu(path, function () {
        return 'Could not find valid *strict* value for "' + key + '" in ' + formatObj(obj);
      });
    };
    var missingKey = function (path, key) {
      return nu(path, function () {
        return 'Choice schema did not contain choice key: "' + key + '"';
      });
    };
    var missingBranch = function (path, branches, branch) {
      return nu(path, function () {
        return 'The chosen schema: "' + branch + '" did not exist in branches: ' + formatObj(branches);
      });
    };
    var unsupportedFields = function (path, unsupported) {
      return nu(path, function () {
        return 'There are unsupported fields: [' + unsupported.join(', ') + '] specified';
      });
    };
    var custom = function (path, err) {
      return nu(path, function () {
        return err;
      });
    };

    var adt$1 = Adt.generate([
      {
        field: [
          'key',
          'okey',
          'presence',
          'prop'
        ]
      },
      {
        state: [
          'okey',
          'instantiator'
        ]
      }
    ]);
    var strictAccess = function (path, obj, key) {
      return get$1(obj, key).fold(function () {
        return missingStrict(path, key, obj);
      }, SimpleResult.svalue);
    };
    var fallbackAccess = function (obj, key, fallbackThunk) {
      var v = get$1(obj, key).fold(function () {
        return fallbackThunk(obj);
      }, identity);
      return SimpleResult.svalue(v);
    };
    var optionAccess = function (obj, key) {
      return SimpleResult.svalue(get$1(obj, key));
    };
    var optionDefaultedAccess = function (obj, key, fallback) {
      var opt = get$1(obj, key).map(function (val) {
        return val === true ? fallback(obj) : val;
      });
      return SimpleResult.svalue(opt);
    };
    var cExtractOne = function (path, obj, field, strength) {
      return field.fold(function (key, okey, presence, prop) {
        var bundle = function (av) {
          var result = prop.extract(path.concat([key]), strength, av);
          return SimpleResult.map(result, function (res) {
            return wrap(okey, strength(res));
          });
        };
        var bundleAsOption = function (optValue) {
          return optValue.fold(function () {
            var outcome = wrap(okey, strength(Optional.none()));
            return SimpleResult.svalue(outcome);
          }, function (ov) {
            var result = prop.extract(path.concat([key]), strength, ov);
            return SimpleResult.map(result, function (res) {
              return wrap(okey, strength(Optional.some(res)));
            });
          });
        };
        return function () {
          return presence.fold(function () {
            return SimpleResult.bind(strictAccess(path, obj, key), bundle);
          }, function (fallbackThunk) {
            return SimpleResult.bind(fallbackAccess(obj, key, fallbackThunk), bundle);
          }, function () {
            return SimpleResult.bind(optionAccess(obj, key), bundleAsOption);
          }, function (fallbackThunk) {
            return SimpleResult.bind(optionDefaultedAccess(obj, key, fallbackThunk), bundleAsOption);
          }, function (baseThunk) {
            var base = baseThunk(obj);
            var result = SimpleResult.map(fallbackAccess(obj, key, constant({})), function (v) {
              return deepMerge(base, v);
            });
            return SimpleResult.bind(result, bundle);
          });
        }();
      }, function (okey, instantiator) {
        var state = instantiator(obj);
        return SimpleResult.svalue(wrap(okey, strength(state)));
      });
    };
    var cExtract = function (path, obj, fields, strength) {
      var results = map(fields, function (field) {
        return cExtractOne(path, obj, field, strength);
      });
      return ResultCombine.consolidateObj(results, {});
    };
    var valueThunk = function (getDelegate) {
      var extract = function (path, strength, val) {
        return getDelegate().extract(path, strength, val);
      };
      var toString = function () {
        return getDelegate().toString();
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var value$1 = function (validator) {
      var extract = function (path, strength, val) {
        return SimpleResult.bindError(validator(val, strength), function (err) {
          return custom(path, err);
        });
      };
      var toString = function () {
        return 'val';
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var getSetKeys = function (obj) {
      return keys(filter$1(obj, function (value) {
        return value !== undefined && value !== null;
      }));
    };
    var objOfOnly = function (fields) {
      var delegate = objOf(fields);
      var fieldNames = foldr(fields, function (acc, f) {
        return f.fold(function (key) {
          return deepMerge(acc, wrap$1(key, true));
        }, constant(acc));
      }, {});
      var extract = function (path, strength, o) {
        var keys = isBoolean(o) ? [] : getSetKeys(o);
        var extra = filter(keys, function (k) {
          return !hasNonNullableKey(fieldNames, k);
        });
        return extra.length === 0 ? delegate.extract(path, strength, o) : unsupportedFields(path, extra);
      };
      return {
        extract: extract,
        toString: delegate.toString
      };
    };
    var objOf = function (fields) {
      var extract = function (path, strength, o) {
        return cExtract(path, o, fields, strength);
      };
      var toString = function () {
        var fieldStrings = map(fields, function (field) {
          return field.fold(function (key, okey, presence, prop) {
            return key + ' -> ' + prop.toString();
          }, function (okey, _instantiator) {
            return 'state(' + okey + ')';
          });
        });
        return 'obj{\n' + fieldStrings.join('\n') + '}';
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var arrOf = function (prop) {
      var extract = function (path, strength, array) {
        var results = map(array, function (a, i) {
          return prop.extract(path.concat(['[' + i + ']']), strength, a);
        });
        return ResultCombine.consolidateArr(results);
      };
      var toString = function () {
        return 'array(' + prop.toString() + ')';
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var oneOf = function (props) {
      var extract = function (path, strength, val) {
        var errors = [];
        for (var _i = 0, props_1 = props; _i < props_1.length; _i++) {
          var prop = props_1[_i];
          var res = prop.extract(path, strength, val);
          if (res.stype === SimpleResultType.Value) {
            return res;
          }
          errors.push(res);
        }
        return ResultCombine.consolidateArr(errors);
      };
      var toString = function () {
        return 'oneOf(' + map(props, function (prop) {
          return prop.toString();
        }).join(', ') + ')';
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var setOf = function (validator, prop) {
      var validateKeys = function (path, keys) {
        return arrOf(value$1(validator)).extract(path, identity, keys);
      };
      var extract = function (path, strength, o) {
        var keys$1 = keys(o);
        var validatedKeys = validateKeys(path, keys$1);
        return SimpleResult.bind(validatedKeys, function (validKeys) {
          var schema = map(validKeys, function (vk) {
            return adt$1.field(vk, vk, strict(), prop);
          });
          return objOf(schema).extract(path, strength, o);
        });
      };
      var toString = function () {
        return 'setOf(' + prop.toString() + ')';
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var thunk = function (desc, processor) {
      var getP = cached(function () {
        return processor();
      });
      var extract = function (path, strength, val) {
        return getP().extract(path, strength, val);
      };
      var toString = function () {
        return getP().toString();
      };
      return {
        extract: extract,
        toString: toString
      };
    };
    var anyValue = constant(value$1(SimpleResult.svalue));
    var arrOfObj = compose(arrOf, objOf);
    var state = adt$1.state;
    var field = adt$1.field;

    var chooseFrom = function (path, strength, input, branches, ch) {
      var fields = get$1(branches, ch);
      return fields.fold(function () {
        return missingBranch(path, branches, ch);
      }, function (vp) {
        return vp.extract(path.concat(['branch: ' + ch]), strength, input);
      });
    };
    var choose = function (key, branches) {
      var extract = function (path, strength, input) {
        var choice = get$1(input, key);
        return choice.fold(function () {
          return missingKey(path, key);
        }, function (chosen) {
          return chooseFrom(path, strength, input, branches, chosen);
        });
      };
      var toString = function () {
        return 'chooseOn(' + key + '). Possible values: ' + keys(branches);
      };
      return {
        extract: extract,
        toString: toString
      };
    };

    var _anyValue = value$1(SimpleResult.svalue);
    var arrOfObj$1 = function (objFields) {
      return arrOfObj(objFields);
    };
    var arrOfVal = function () {
      return arrOf(_anyValue);
    };
    var valueThunkOf = valueThunk;
    var valueOf = function (validator) {
      return value$1(function (v) {
        return validator(v).fold(SimpleResult.serror, SimpleResult.svalue);
      });
    };
    var setOf$1 = function (validator, prop) {
      return setOf(function (v) {
        return SimpleResult.fromResult(validator(v));
      }, prop);
    };
    var extract = function (label, prop, strength, obj) {
      var res = prop.extract([label], strength, obj);
      return SimpleResult.mapError(res, function (errs) {
        return {
          input: obj,
          errors: errs
        };
      });
    };
    var asRaw = function (label, prop, obj) {
      return SimpleResult.toResult(extract(label, prop, identity, obj));
    };
    var getOrDie = function (extraction) {
      return extraction.fold(function (errInfo) {
        throw new Error(formatError(errInfo));
      }, identity);
    };
    var asRawOrDie = function (label, prop, obj) {
      return getOrDie(asRaw(label, prop, obj));
    };
    var formatError = function (errInfo) {
      return 'Errors: \n' + formatErrors(errInfo.errors).join('\n') + '\n\nInput object: ' + formatObj(errInfo.input);
    };
    var chooseProcessor = function (key, branches) {
      return choose(key, branches);
    };
    var choose$1 = function (key, branches) {
      return choose(key, map$2(branches, objOf));
    };
    var thunkOf = function (desc, schema) {
      return thunk(desc, schema);
    };
    var anyValue$1 = constant(_anyValue);
    var typedValue = function (validator, expectedType) {
      return value$1(function (a) {
        var actualType = typeof a;
        return validator(a) ? SimpleResult.svalue(a) : SimpleResult.serror('Expected type: ' + expectedType + ' but got: ' + actualType);
      });
    };
    var number = typedValue(isNumber, 'number');
    var string = typedValue(isString, 'string');
    var boolean = typedValue(isBoolean, 'boolean');
    var functionProcessor = typedValue(isFunction, 'function');
    var isPostMessageable = function (val) {
      var every = function (iter, callbackFn) {
        var result = iter.next();
        while (!result.done) {
          if (!callbackFn(result.value)) {
            return false;
          }
          result = iter.next();
        }
        return true;
      };
      if (Object(val) !== val) {
        return true;
      }
      switch ({}.toString.call(val).slice(8, -1)) {
      case 'Boolean':
      case 'Number':
      case 'String':
      case 'Date':
      case 'RegExp':
      case 'Blob':
      case 'FileList':
      case 'ImageData':
      case 'ImageBitmap':
      case 'ArrayBuffer':
        return true;
      case 'Array':
      case 'Object':
        return Object.keys(val).every(function (prop) {
          return isPostMessageable(val[prop]);
        });
      case 'Map':
        return every(val.keys(), isPostMessageable) && every(val.values(), isPostMessageable);
      case 'Set':
        return every(val.keys(), isPostMessageable);
      default:
        return false;
      }
    };
    var postMessageable = value$1(function (a) {
      return isPostMessageable(a) ? SimpleResult.svalue(a) : SimpleResult.serror('Expected value to be acceptable for sending via postMessage');
    });

    var validateEnum = function (values) {
      return valueOf(function (value) {
        return contains(values, value) ? Result.value(value) : Result.error('Unsupported value: "' + value + '", choose one of "' + values.join(', ') + '".');
      });
    };
    var strict$1 = function (key) {
      return field(key, key, strict(), anyValue());
    };
    var strictOf = function (key, schema) {
      return field(key, key, strict(), schema);
    };
    var strictNumber = function (key) {
      return strictOf(key, number);
    };
    var strictString = function (key) {
      return strictOf(key, string);
    };
    var strictStringEnum = function (key, values) {
      return field(key, key, strict(), validateEnum(values));
    };
    var strictBoolean = function (key) {
      return strictOf(key, boolean);
    };
    var strictFunction = function (key) {
      return strictOf(key, functionProcessor);
    };
    var forbid = function (key, message) {
      return field(key, key, asOption(), value$1(function (_v) {
        return SimpleResult.serror('The field: ' + key + ' is forbidden. ' + message);
      }));
    };
    var strictObjOf = function (key, objSchema) {
      return field(key, key, strict(), objOf(objSchema));
    };
    var strictArrayOfObj = function (key, objFields) {
      return field(key, key, strict(), arrOfObj(objFields));
    };
    var strictArrayOf = function (key, schema) {
      return field(key, key, strict(), arrOf(schema));
    };
    var option = function (key) {
      return field(key, key, asOption(), anyValue());
    };
    var optionOf = function (key, schema) {
      return field(key, key, asOption(), schema);
    };
    var optionNumber = function (key) {
      return optionOf(key, number);
    };
    var optionString = function (key) {
      return optionOf(key, string);
    };
    var optionFunction = function (key) {
      return optionOf(key, functionProcessor);
    };
    var optionArrayOf = function (key, schema) {
      return optionOf(key, arrOf(schema));
    };
    var optionObjOf = function (key, objSchema) {
      return optionOf(key, objOf(objSchema));
    };
    var optionObjOfOnly = function (key, objSchema) {
      return optionOf(key, objOfOnly(objSchema));
    };
    var defaulted$1 = function (key, fallback) {
      return field(key, key, defaulted(fallback), anyValue());
    };
    var defaultedOf = function (key, fallback, schema) {
      return field(key, key, defaulted(fallback), schema);
    };
    var defaultedNumber = function (key, fallback) {
      return defaultedOf(key, fallback, number);
    };
    var defaultedString = function (key, fallback) {
      return defaultedOf(key, fallback, string);
    };
    var defaultedStringEnum = function (key, fallback, values) {
      return defaultedOf(key, fallback, validateEnum(values));
    };
    var defaultedBoolean = function (key, fallback) {
      return defaultedOf(key, fallback, boolean);
    };
    var defaultedFunction = function (key, fallback) {
      return defaultedOf(key, fallback, functionProcessor);
    };
    var defaultedPostMsg = function (key, fallback) {
      return defaultedOf(key, fallback, postMessageable);
    };
    var defaultedArrayOf = function (key, fallback, schema) {
      return defaultedOf(key, fallback, arrOf(schema));
    };
    var defaultedObjOf = function (key, fallback, objSchema) {
      return defaultedOf(key, fallback, objOf(objSchema));
    };
    var state$1 = function (okey, instantiator) {
      return state(okey, instantiator);
    };

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw new Error('HTML must have a single root node');
      }
      return fromDom(div.childNodes[0]);
    };
    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };
    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };
    var fromDom = function (node) {
      if (node === null || node === undefined) {
        throw new Error('Node cannot be null or undefined');
      }
      return { dom: node };
    };
    var fromPoint = function (docElm, x, y) {
      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);
    };
    var SugarElement = {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom,
      fromPoint: fromPoint
    };

    var DeviceType = function (os, browser, userAgent, mediaMatch) {
      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;
      var isiPhone = os.isiOS() && !isiPad;
      var isMobile = os.isiOS() || os.isAndroid();
      var isTouch = isMobile || mediaMatch('(pointer:coarse)');
      var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');
      var isPhone = isiPhone || isMobile && !isTablet;
      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;
      var isDesktop = !isPhone && !isTablet && !iOSwebview;
      return {
        isiPad: constant(isiPad),
        isiPhone: constant(isiPhone),
        isTablet: constant(isTablet),
        isPhone: constant(isPhone),
        isTouch: constant(isTouch),
        isAndroid: os.isAndroid,
        isiOS: os.isiOS,
        isWebView: constant(iOSwebview),
        isDesktop: constant(isDesktop)
      };
    };

    var firstMatch = function (regexes, s) {
      for (var i = 0; i < regexes.length; i++) {
        var x = regexes[i];
        if (x.test(s)) {
          return x;
        }
      }
      return undefined;
    };
    var find$2 = function (regexes, agent) {
      var r = firstMatch(regexes, agent);
      if (!r) {
        return {
          major: 0,
          minor: 0
        };
      }
      var group = function (i) {
        return Number(agent.replace(r, '$' + i));
      };
      return nu$1(group(1), group(2));
    };
    var detect = function (versionRegexes, agent) {
      var cleanedAgent = String(agent).toLowerCase();
      if (versionRegexes.length === 0) {
        return unknown();
      }
      return find$2(versionRegexes, cleanedAgent);
    };
    var unknown = function () {
      return nu$1(0, 0);
    };
    var nu$1 = function (major, minor) {
      return {
        major: major,
        minor: minor
      };
    };
    var Version = {
      nu: nu$1,
      detect: detect,
      unknown: unknown
    };

    var detect$1 = function (candidates, userAgent) {
      var agent = String(userAgent).toLowerCase();
      return find(candidates, function (candidate) {
        return candidate.search(agent);
      });
    };
    var detectBrowser = function (browsers, userAgent) {
      return detect$1(browsers, userAgent).map(function (browser) {
        var version = Version.detect(browser.versionRegexes, userAgent);
        return {
          current: browser.name,
          version: version
        };
      });
    };
    var detectOs = function (oses, userAgent) {
      return detect$1(oses, userAgent).map(function (os) {
        var version = Version.detect(os.versionRegexes, userAgent);
        return {
          current: os.name,
          version: version
        };
      });
    };
    var UaString = {
      detectBrowser: detectBrowser,
      detectOs: detectOs
    };

    var checkRange = function (str, substr, start) {
      return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;
    };
    var contains$1 = function (str, substr) {
      return str.indexOf(substr) !== -1;
    };
    var endsWith = function (str, suffix) {
      return checkRange(str, suffix, str.length - suffix.length);
    };
    var blank = function (r) {
      return function (s) {
        return s.replace(r, '');
      };
    };
    var trim = blank(/^\s+|\s+$/g);

    var normalVersionRegex = /.*?version\/\ ?([0-9]+)\.([0-9]+).*/;
    var checkContains = function (target) {
      return function (uastring) {
        return contains$1(uastring, target);
      };
    };
    var browsers = [
      {
        name: 'Edge',
        versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],
        search: function (uastring) {
          return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');
        }
      },
      {
        name: 'Chrome',
        versionRegexes: [
          /.*?chrome\/([0-9]+)\.([0-9]+).*/,
          normalVersionRegex
        ],
        search: function (uastring) {
          return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');
        }
      },
      {
        name: 'IE',
        versionRegexes: [
          /.*?msie\ ?([0-9]+)\.([0-9]+).*/,
          /.*?rv:([0-9]+)\.([0-9]+).*/
        ],
        search: function (uastring) {
          return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');
        }
      },
      {
        name: 'Opera',
        versionRegexes: [
          normalVersionRegex,
          /.*?opera\/([0-9]+)\.([0-9]+).*/
        ],
        search: checkContains('opera')
      },
      {
        name: 'Firefox',
        versionRegexes: [/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],
        search: checkContains('firefox')
      },
      {
        name: 'Safari',
        versionRegexes: [
          normalVersionRegex,
          /.*?cpu os ([0-9]+)_([0-9]+).*/
        ],
        search: function (uastring) {
          return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');
        }
      }
    ];
    var oses = [
      {
        name: 'Windows',
        search: checkContains('win'),
        versionRegexes: [/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name: 'iOS',
        search: function (uastring) {
          return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');
        },
        versionRegexes: [
          /.*?version\/\ ?([0-9]+)\.([0-9]+).*/,
          /.*cpu os ([0-9]+)_([0-9]+).*/,
          /.*cpu iphone os ([0-9]+)_([0-9]+).*/
        ]
      },
      {
        name: 'Android',
        search: checkContains('android'),
        versionRegexes: [/.*?android\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name: 'OSX',
        search: checkContains('mac os x'),
        versionRegexes: [/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]
      },
      {
        name: 'Linux',
        search: checkContains('linux'),
        versionRegexes: []
      },
      {
        name: 'Solaris',
        search: checkContains('sunos'),
        versionRegexes: []
      },
      {
        name: 'FreeBSD',
        search: checkContains('freebsd'),
        versionRegexes: []
      },
      {
        name: 'ChromeOS',
        search: checkContains('cros'),
        versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/]
      }
    ];
    var PlatformInfo = {
      browsers: constant(browsers),
      oses: constant(oses)
    };

    var edge = 'Edge';
    var chrome = 'Chrome';
    var ie = 'IE';
    var opera = 'Opera';
    var firefox = 'Firefox';
    var safari = 'Safari';
    var unknown$1 = function () {
      return nu$2({
        current: undefined,
        version: Version.unknown()
      });
    };
    var nu$2 = function (info) {
      var current = info.current;
      var version = info.version;
      var isBrowser = function (name) {
        return function () {
          return current === name;
        };
      };
      return {
        current: current,
        version: version,
        isEdge: isBrowser(edge),
        isChrome: isBrowser(chrome),
        isIE: isBrowser(ie),
        isOpera: isBrowser(opera),
        isFirefox: isBrowser(firefox),
        isSafari: isBrowser(safari)
      };
    };
    var Browser = {
      unknown: unknown$1,
      nu: nu$2,
      edge: constant(edge),
      chrome: constant(chrome),
      ie: constant(ie),
      opera: constant(opera),
      firefox: constant(firefox),
      safari: constant(safari)
    };

    var windows = 'Windows';
    var ios = 'iOS';
    var android = 'Android';
    var linux = 'Linux';
    var osx = 'OSX';
    var solaris = 'Solaris';
    var freebsd = 'FreeBSD';
    var chromeos = 'ChromeOS';
    var unknown$2 = function () {
      return nu$3({
        current: undefined,
        version: Version.unknown()
      });
    };
    var nu$3 = function (info) {
      var current = info.current;
      var version = info.version;
      var isOS = function (name) {
        return function () {
          return current === name;
        };
      };
      return {
        current: current,
        version: version,
        isWindows: isOS(windows),
        isiOS: isOS(ios),
        isAndroid: isOS(android),
        isOSX: isOS(osx),
        isLinux: isOS(linux),
        isSolaris: isOS(solaris),
        isFreeBSD: isOS(freebsd),
        isChromeOS: isOS(chromeos)
      };
    };
    var OperatingSystem = {
      unknown: unknown$2,
      nu: nu$3,
      windows: constant(windows),
      ios: constant(ios),
      android: constant(android),
      linux: constant(linux),
      osx: constant(osx),
      solaris: constant(solaris),
      freebsd: constant(freebsd),
      chromeos: constant(chromeos)
    };

    var detect$2 = function (userAgent, mediaMatch) {
      var browsers = PlatformInfo.browsers();
      var oses = PlatformInfo.oses();
      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);
      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);
      var deviceType = DeviceType(os, browser, userAgent, mediaMatch);
      return {
        browser: browser,
        os: os,
        deviceType: deviceType
      };
    };
    var PlatformDetection = { detect: detect$2 };

    var mediaMatch = function (query) {
      return window.matchMedia(query).matches;
    };
    var platform = cached(function () {
      return PlatformDetection.detect(navigator.userAgent, mediaMatch);
    });
    var detect$3 = function () {
      return platform();
    };

    var compareDocumentPosition = function (a, b, match) {
      return (a.compareDocumentPosition(b) & match) !== 0;
    };
    var documentPositionContainedBy = function (a, b) {
      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);
    };

    var DOCUMENT = 9;
    var DOCUMENT_FRAGMENT = 11;
    var ELEMENT = 1;
    var TEXT = 3;

    var is = function (element, selector) {
      var dom = element.dom;
      if (dom.nodeType !== ELEMENT) {
        return false;
      } else {
        var elem = dom;
        if (elem.matches !== undefined) {
          return elem.matches(selector);
        } else if (elem.msMatchesSelector !== undefined) {
          return elem.msMatchesSelector(selector);
        } else if (elem.webkitMatchesSelector !== undefined) {
          return elem.webkitMatchesSelector(selector);
        } else if (elem.mozMatchesSelector !== undefined) {
          return elem.mozMatchesSelector(selector);
        } else {
          throw new Error('Browser lacks native selectors');
        }
      }
    };
    var bypassSelector = function (dom) {
      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;
    };
    var all = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom;
      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);
    };
    var one = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom;
      return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);
    };

    var eq$1 = function (e1, e2) {
      return e1.dom === e2.dom;
    };
    var regularContains = function (e1, e2) {
      var d1 = e1.dom;
      var d2 = e2.dom;
      return d1 === d2 ? false : d1.contains(d2);
    };
    var ieContains = function (e1, e2) {
      return documentPositionContainedBy(e1.dom, e2.dom);
    };
    var contains$2 = function (e1, e2) {
      return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);
    };

    var ensureIsRoot = function (isRoot) {
      return isFunction(isRoot) ? isRoot : never;
    };
    var ancestor = function (scope, transform, isRoot) {
      var element = scope.dom;
      var stop = ensureIsRoot(isRoot);
      while (element.parentNode) {
        element = element.parentNode;
        var el = SugarElement.fromDom(element);
        var transformed = transform(el);
        if (transformed.isSome()) {
          return transformed;
        } else if (stop(el)) {
          break;
        }
      }
      return Optional.none();
    };
    var closest = function (scope, transform, isRoot) {
      var current = transform(scope);
      var stop = ensureIsRoot(isRoot);
      return current.orThunk(function () {
        return stop(scope) ? Optional.none() : ancestor(scope, transform, stop);
      });
    };

    var isSource = function (component, simulatedEvent) {
      return eq$1(component.element, simulatedEvent.event.target);
    };

    var nu$4 = function (parts) {
      if (!hasNonNullableKey(parts, 'can') && !hasNonNullableKey(parts, 'abort') && !hasNonNullableKey(parts, 'run')) {
        throw new Error('EventHandler defined by: ' + JSON.stringify(parts, null, 2) + ' does not have can, abort, or run!');
      }
      return asRawOrDie('Extracting event.handler', objOfOnly([
        defaulted$1('can', always),
        defaulted$1('abort', never),
        defaulted$1('run', noop)
      ]), parts);
    };
    var all$1 = function (handlers, f) {
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        return foldl(handlers, function (acc, handler) {
          return acc && f(handler).apply(undefined, args);
        }, true);
      };
    };
    var any = function (handlers, f) {
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        return foldl(handlers, function (acc, handler) {
          return acc || f(handler).apply(undefined, args);
        }, false);
      };
    };
    var read = function (handler) {
      return isFunction(handler) ? {
        can: always,
        abort: never,
        run: handler
      } : handler;
    };
    var fuse = function (handlers) {
      var can = all$1(handlers, function (handler) {
        return handler.can;
      });
      var abort = any(handlers, function (handler) {
        return handler.abort;
      });
      var run = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        each(handlers, function (handler) {
          handler.run.apply(undefined, args);
        });
      };
      return nu$4({
        can: can,
        abort: abort,
        run: run
      });
    };

    var constant$1 = constant;
    var touchstart = constant$1('touchstart');
    var touchmove = constant$1('touchmove');
    var touchend = constant$1('touchend');
    var touchcancel = constant$1('touchcancel');
    var mousedown = constant$1('mousedown');
    var mousemove = constant$1('mousemove');
    var mouseout = constant$1('mouseout');
    var mouseup = constant$1('mouseup');
    var mouseover = constant$1('mouseover');
    var focusin = constant$1('focusin');
    var focusout = constant$1('focusout');
    var keydown = constant$1('keydown');
    var keyup = constant$1('keyup');
    var input = constant$1('input');
    var change = constant$1('change');
    var click = constant$1('click');
    var transitionend = constant$1('transitionend');
    var selectstart = constant$1('selectstart');

    var prefixName = function (name) {
      return constant('alloy.' + name);
    };
    var alloy = { tap: prefixName('tap') };
    var focus = prefixName('focus');
    var postBlur = prefixName('blur.post');
    var postPaste = prefixName('paste.post');
    var receive = prefixName('receive');
    var execute = prefixName('execute');
    var focusItem = prefixName('focus.item');
    var tap = alloy.tap;
    var longpress = prefixName('longpress');
    var sandboxClose = prefixName('sandbox.close');
    var typeaheadCancel = prefixName('typeahead.cancel');
    var systemInit = prefixName('system.init');
    var documentTouchmove = prefixName('system.touchmove');
    var documentTouchend = prefixName('system.touchend');
    var windowScroll = prefixName('system.scroll');
    var windowResize = prefixName('system.resize');
    var attachedToDom = prefixName('system.attached');
    var detachedFromDom = prefixName('system.detached');
    var dismissRequested = prefixName('system.dismissRequested');
    var repositionRequested = prefixName('system.repositionRequested');
    var focusShifted = prefixName('focusmanager.shifted');
    var slotVisibility = prefixName('slotcontainer.visibility');
    var changeTab = prefixName('change.tab');
    var dismissTab = prefixName('dismiss.tab');
    var highlight = prefixName('highlight');
    var dehighlight = prefixName('dehighlight');

    var emit = function (component, event) {
      dispatchWith(component, component.element, event, {});
    };
    var emitWith = function (component, event, properties) {
      dispatchWith(component, component.element, event, properties);
    };
    var emitExecute = function (component) {
      emit(component, execute());
    };
    var dispatch = function (component, target, event) {
      dispatchWith(component, target, event, {});
    };
    var dispatchWith = function (component, target, event, properties) {
      var data = __assign({ target: target }, properties);
      component.getSystem().triggerEvent(event, target, data);
    };
    var dispatchEvent = function (component, target, event, simulatedEvent) {
      component.getSystem().triggerEvent(event, target, simulatedEvent.event);
    };

    var derive = function (configs) {
      return wrapAll$1(configs);
    };
    var abort = function (name, predicate) {
      return {
        key: name,
        value: nu$4({ abort: predicate })
      };
    };
    var can = function (name, predicate) {
      return {
        key: name,
        value: nu$4({ can: predicate })
      };
    };
    var preventDefault = function (name) {
      return {
        key: name,
        value: nu$4({
          run: function (component, simulatedEvent) {
            simulatedEvent.event.prevent();
          }
        })
      };
    };
    var run = function (name, handler) {
      return {
        key: name,
        value: nu$4({ run: handler })
      };
    };
    var runActionExtra = function (name, action, extra) {
      return {
        key: name,
        value: nu$4({
          run: function (component, simulatedEvent) {
            action.apply(undefined, [
              component,
              simulatedEvent
            ].concat(extra));
          }
        })
      };
    };
    var runOnName = function (name) {
      return function (handler) {
        return run(name, handler);
      };
    };
    var runOnSourceName = function (name) {
      return function (handler) {
        return {
          key: name,
          value: nu$4({
            run: function (component, simulatedEvent) {
              if (isSource(component, simulatedEvent)) {
                handler(component, simulatedEvent);
              }
            }
          })
        };
      };
    };
    var redirectToUid = function (name, uid) {
      return run(name, function (component, simulatedEvent) {
        component.getSystem().getByUid(uid).each(function (redirectee) {
          dispatchEvent(redirectee, redirectee.element, name, simulatedEvent);
        });
      });
    };
    var redirectToPart = function (name, detail, partName) {
      var uid = detail.partUids[partName];
      return redirectToUid(name, uid);
    };
    var runWithTarget = function (name, f) {
      return run(name, function (component, simulatedEvent) {
        var ev = simulatedEvent.event;
        var target = component.getSystem().getByDom(ev.target).fold(function () {
          var closest$1 = closest(ev.target, function (el) {
            return component.getSystem().getByDom(el).toOptional();
          }, never);
          return closest$1.getOr(component);
        }, function (c) {
          return c;
        });
        f(component, target, simulatedEvent);
      });
    };
    var cutter = function (name) {
      return run(name, function (component, simulatedEvent) {
        simulatedEvent.cut();
      });
    };
    var stopper = function (name) {
      return run(name, function (component, simulatedEvent) {
        simulatedEvent.stop();
      });
    };
    var runOnSource = function (name, f) {
      return runOnSourceName(name)(f);
    };
    var runOnAttached = runOnSourceName(attachedToDom());
    var runOnDetached = runOnSourceName(detachedFromDom());
    var runOnInit = runOnSourceName(systemInit());
    var runOnExecute = runOnName(execute());

    var Global = typeof window !== 'undefined' ? window : Function('return this;')();

    var name = function (element) {
      var r = element.dom.nodeName;
      return r.toLowerCase();
    };
    var type = function (element) {
      return element.dom.nodeType;
    };
    var isType$1 = function (t) {
      return function (element) {
        return type(element) === t;
      };
    };
    var isElement = isType$1(ELEMENT);
    var isText = isType$1(TEXT);
    var isDocument = isType$1(DOCUMENT);
    var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);

    var owner = function (element) {
      return SugarElement.fromDom(element.dom.ownerDocument);
    };
    var documentOrOwner = function (dos) {
      return isDocument(dos) ? dos : owner(dos);
    };
    var documentElement = function (element) {
      return SugarElement.fromDom(documentOrOwner(element).dom.documentElement);
    };
    var defaultView = function (element) {
      return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);
    };
    var parent = function (element) {
      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);
    };
    var parentNode = function (element) {
      return parent(element);
    };
    var offsetParent = function (element) {
      return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom);
    };
    var nextSibling = function (element) {
      return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);
    };
    var children = function (element) {
      return map(element.dom.childNodes, SugarElement.fromDom);
    };
    var child = function (element, index) {
      var cs = element.dom.childNodes;
      return Optional.from(cs[index]).map(SugarElement.fromDom);
    };
    var firstChild = function (element) {
      return child(element, 0);
    };

    var isShadowRoot = function (dos) {
      return isDocumentFragment(dos) && isNonNullable(dos.dom.host);
    };
    var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);
    var isSupported = constant(supported);
    var getRootNode = supported ? function (e) {
      return SugarElement.fromDom(e.dom.getRootNode());
    } : documentOrOwner;
    var getContentContainer = function (dos) {
      return isShadowRoot(dos) ? dos : SugarElement.fromDom(documentOrOwner(dos).dom.body);
    };
    var isInShadowRoot = function (e) {
      return getShadowRoot(e).isSome();
    };
    var getShadowRoot = function (e) {
      var r = getRootNode(e);
      return isShadowRoot(r) ? Optional.some(r) : Optional.none();
    };
    var getShadowHost = function (e) {
      return SugarElement.fromDom(e.dom.host);
    };
    var getOriginalEventTarget = function (event) {
      if (isSupported() && isNonNullable(event.target)) {
        var el = SugarElement.fromDom(event.target);
        if (isElement(el) && isOpenShadowHost(el)) {
          if (event.composed && event.composedPath) {
            var composedPath = event.composedPath();
            if (composedPath) {
              return head(composedPath);
            }
          }
        }
      }
      return Optional.from(event.target);
    };
    var isOpenShadowHost = function (element) {
      return isNonNullable(element.dom.shadowRoot);
    };

    var before = function (marker, element) {
      var parent$1 = parent(marker);
      parent$1.each(function (v) {
        v.dom.insertBefore(element.dom, marker.dom);
      });
    };
    var after = function (marker, element) {
      var sibling = nextSibling(marker);
      sibling.fold(function () {
        var parent$1 = parent(marker);
        parent$1.each(function (v) {
          append(v, element);
        });
      }, function (v) {
        before(v, element);
      });
    };
    var prepend = function (parent, element) {
      var firstChild$1 = firstChild(parent);
      firstChild$1.fold(function () {
        append(parent, element);
      }, function (v) {
        parent.dom.insertBefore(element.dom, v.dom);
      });
    };
    var append = function (parent, element) {
      parent.dom.appendChild(element.dom);
    };
    var appendAt = function (parent, element, index) {
      child(parent, index).fold(function () {
        append(parent, element);
      }, function (v) {
        before(v, element);
      });
    };

    var before$1 = function (marker, elements) {
      each(elements, function (x) {
        before(marker, x);
      });
    };
    var append$1 = function (parent, elements) {
      each(elements, function (x) {
        append(parent, x);
      });
    };

    var empty = function (element) {
      element.dom.textContent = '';
      each(children(element), function (rogue) {
        remove(rogue);
      });
    };
    var remove = function (element) {
      var dom = element.dom;
      if (dom.parentNode !== null) {
        dom.parentNode.removeChild(dom);
      }
    };
    var unwrap = function (wrapper) {
      var children$1 = children(wrapper);
      if (children$1.length > 0) {
        before$1(wrapper, children$1);
      }
      remove(wrapper);
    };

    var fromHtml$1 = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      return children(SugarElement.fromDom(div));
    };

    var get$2 = function (element) {
      return element.dom.innerHTML;
    };
    var set = function (element, content) {
      var owner$1 = owner(element);
      var docDom = owner$1.dom;
      var fragment = SugarElement.fromDom(docDom.createDocumentFragment());
      var contentElements = fromHtml$1(content, docDom);
      append$1(fragment, contentElements);
      empty(element);
      append(element, fragment);
    };
    var getOuter = function (element) {
      var container = SugarElement.fromTag('div');
      var clone = SugarElement.fromDom(element.dom.cloneNode(true));
      append(container, clone);
      return get$2(container);
    };

    var rawSet = function (dom, key, value) {
      if (isString(value) || isBoolean(value) || isNumber(value)) {
        dom.setAttribute(key, value + '');
      } else {
        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);
        throw new Error('Attribute value was not simple');
      }
    };
    var set$1 = function (element, key, value) {
      rawSet(element.dom, key, value);
    };
    var setAll = function (element, attrs) {
      var dom = element.dom;
      each$1(attrs, function (v, k) {
        rawSet(dom, k, v);
      });
    };
    var get$3 = function (element, key) {
      var v = element.dom.getAttribute(key);
      return v === null ? undefined : v;
    };
    var getOpt = function (element, key) {
      return Optional.from(get$3(element, key));
    };
    var has$1 = function (element, key) {
      var dom = element.dom;
      return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;
    };
    var remove$1 = function (element, key) {
      element.dom.removeAttribute(key);
    };

    var clone = function (original, isDeep) {
      return SugarElement.fromDom(original.dom.cloneNode(isDeep));
    };
    var shallow$1 = function (original) {
      return clone(original, false);
    };

    var getHtml = function (element) {
      if (isShadowRoot(element)) {
        return '#shadow-root';
      } else {
        var clone = shallow$1(element);
        return getOuter(clone);
      }
    };

    var element = function (elem) {
      return getHtml(elem);
    };

    var isRecursive = function (component, originator, target) {
      return eq$1(originator, component.element) && !eq$1(originator, target);
    };
    var events = derive([can(focus(), function (component, simulatedEvent) {
        var event = simulatedEvent.event;
        var originator = event.originator;
        var target = event.target;
        if (isRecursive(component, originator, target)) {
          console.warn(focus() + ' did not get interpreted by the desired target. ' + '\nOriginator: ' + element(originator) + '\nTarget: ' + element(target) + '\nCheck the ' + focus() + ' event handlers');
          return false;
        } else {
          return true;
        }
      })]);

    var DefaultEvents = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events
    });

    var unique = 0;
    var generate$1 = function (prefix) {
      var date = new Date();
      var time = date.getTime();
      var random = Math.floor(Math.random() * 1000000000);
      unique++;
      return prefix + '_' + random + unique + String(time);
    };

    var prefix = constant('alloy-id-');
    var idAttr = constant('data-alloy-id');

    var prefix$1 = prefix();
    var idAttr$1 = idAttr();
    var write = function (label, elem) {
      var id = generate$1(prefix$1 + label);
      writeOnly(elem, id);
      return id;
    };
    var writeOnly = function (elem, uid) {
      Object.defineProperty(elem.dom, idAttr$1, {
        value: uid,
        writable: true
      });
    };
    var read$1 = function (elem) {
      var id = isElement(elem) ? elem.dom[idAttr$1] : null;
      return Optional.from(id);
    };
    var generate$2 = function (prefix) {
      return generate$1(prefix);
    };

    var make = identity;

    var NoContextApi = function (getComp) {
      var fail = function (event) {
        return function () {
          throw new Error('The component must be in a context to send: ' + event + (getComp ? '\n' + element(getComp().element) + ' is not in context.' : ''));
        };
      };
      return {
        debugInfo: constant('fake'),
        triggerEvent: fail('triggerEvent'),
        triggerFocus: fail('triggerFocus'),
        triggerEscape: fail('triggerEscape'),
        build: fail('build'),
        addToWorld: fail('addToWorld'),
        removeFromWorld: fail('removeFromWorld'),
        addToGui: fail('addToGui'),
        removeFromGui: fail('removeFromGui'),
        getByUid: fail('getByUid'),
        getByDom: fail('getByDom'),
        broadcast: fail('broadcast'),
        broadcastOn: fail('broadcastOn'),
        broadcastEvent: fail('broadcastEvent'),
        isConnected: never
      };
    };
    var singleton = NoContextApi();

    var markAsBehaviourApi = function (f, apiName, apiFunction) {
      var delegate = apiFunction.toString();
      var endIndex = delegate.indexOf(')') + 1;
      var openBracketIndex = delegate.indexOf('(');
      var parameters = delegate.substring(openBracketIndex + 1, endIndex - 1).split(/,\s*/);
      f.toFunctionAnnotation = function () {
        return {
          name: apiName,
          parameters: cleanParameters(parameters.slice(0, 1).concat(parameters.slice(3)))
        };
      };
      return f;
    };
    var cleanParameters = function (parameters) {
      return map(parameters, function (p) {
        return endsWith(p, '/*') ? p.substring(0, p.length - '/*'.length) : p;
      });
    };
    var markAsExtraApi = function (f, extraName) {
      var delegate = f.toString();
      var endIndex = delegate.indexOf(')') + 1;
      var openBracketIndex = delegate.indexOf('(');
      var parameters = delegate.substring(openBracketIndex + 1, endIndex - 1).split(/,\s*/);
      f.toFunctionAnnotation = function () {
        return {
          name: extraName,
          parameters: cleanParameters(parameters)
        };
      };
      return f;
    };
    var markAsSketchApi = function (f, apiFunction) {
      var delegate = apiFunction.toString();
      var endIndex = delegate.indexOf(')') + 1;
      var openBracketIndex = delegate.indexOf('(');
      var parameters = delegate.substring(openBracketIndex + 1, endIndex - 1).split(/,\s*/);
      f.toFunctionAnnotation = function () {
        return {
          name: 'OVERRIDE',
          parameters: cleanParameters(parameters.slice(1))
        };
      };
      return f;
    };

    var premadeTag = generate$1('alloy-premade');
    var premade = function (comp) {
      return wrap$1(premadeTag, comp);
    };
    var getPremade = function (spec) {
      return get$1(spec, premadeTag);
    };
    var makeApi = function (f) {
      return markAsSketchApi(function (component) {
        var rest = [];
        for (var _i = 1; _i < arguments.length; _i++) {
          rest[_i - 1] = arguments[_i];
        }
        return f.apply(void 0, __spreadArrays([
          component.getApis(),
          component
        ], rest));
      }, f);
    };

    var NoState = {
      init: function () {
        return nu$5({
          readState: function () {
            return 'No State required';
          }
        });
      }
    };
    var nu$5 = function (spec) {
      return spec;
    };

    var generateFrom = function (spec, all) {
      var schema = map(all, function (a) {
        return optionObjOf(a.name(), [
          strict$1('config'),
          defaulted$1('state', NoState)
        ]);
      });
      var validated = asRaw('component.behaviours', objOf(schema), spec.behaviours).fold(function (errInfo) {
        throw new Error(formatError(errInfo) + '\nComplete spec:\n' + JSON.stringify(spec, null, 2));
      }, function (v) {
        return v;
      });
      return {
        list: all,
        data: map$2(validated, function (optBlobThunk) {
          var output = optBlobThunk.map(function (blob) {
            return {
              config: blob.config,
              state: blob.state.init(blob.config)
            };
          });
          return function () {
            return output;
          };
        })
      };
    };
    var getBehaviours = function (bData) {
      return bData.list;
    };
    var getData = function (bData) {
      return bData.data;
    };

    var byInnerKey = function (data, tuple) {
      var r = {};
      each$1(data, function (detail, key) {
        each$1(detail, function (value, indexKey) {
          var chain = get$1(r, indexKey).getOr([]);
          r[indexKey] = chain.concat([tuple(key, value)]);
        });
      });
      return r;
    };

    var nu$6 = function (s) {
      return {
        classes: s.classes !== undefined ? s.classes : [],
        attributes: s.attributes !== undefined ? s.attributes : {},
        styles: s.styles !== undefined ? s.styles : {}
      };
    };
    var merge$1 = function (defnA, mod) {
      return __assign(__assign({}, defnA), {
        attributes: __assign(__assign({}, defnA.attributes), mod.attributes),
        styles: __assign(__assign({}, defnA.styles), mod.styles),
        classes: defnA.classes.concat(mod.classes)
      });
    };

    var combine = function (info, baseMod, behaviours, base) {
      var modsByBehaviour = __assign({}, baseMod);
      each(behaviours, function (behaviour) {
        modsByBehaviour[behaviour.name()] = behaviour.exhibit(info, base);
      });
      var byAspect = byInnerKey(modsByBehaviour, function (name, modification) {
        return {
          name: name,
          modification: modification
        };
      });
      var combineObjects = function (objects) {
        return foldr(objects, function (b, a) {
          return __assign(__assign({}, a.modification), b);
        }, {});
      };
      var combinedClasses = foldr(byAspect.classes, function (b, a) {
        return a.modification.concat(b);
      }, []);
      var combinedAttributes = combineObjects(byAspect.attributes);
      var combinedStyles = combineObjects(byAspect.styles);
      return nu$6({
        classes: combinedClasses,
        attributes: combinedAttributes,
        styles: combinedStyles
      });
    };

    var sortKeys = function (label, keyName, array, order) {
      try {
        var sorted = sort(array, function (a, b) {
          var aKey = a[keyName];
          var bKey = b[keyName];
          var aIndex = order.indexOf(aKey);
          var bIndex = order.indexOf(bKey);
          if (aIndex === -1) {
            throw new Error('The ordering for ' + label + ' does not have an entry for ' + aKey + '.\nOrder specified: ' + JSON.stringify(order, null, 2));
          }
          if (bIndex === -1) {
            throw new Error('The ordering for ' + label + ' does not have an entry for ' + bKey + '.\nOrder specified: ' + JSON.stringify(order, null, 2));
          }
          if (aIndex < bIndex) {
            return -1;
          } else if (bIndex < aIndex) {
            return 1;
          } else {
            return 0;
          }
        });
        return Result.value(sorted);
      } catch (err) {
        return Result.error([err]);
      }
    };

    var uncurried = function (handler, purpose) {
      return {
        handler: handler,
        purpose: purpose
      };
    };
    var curried = function (handler, purpose) {
      return {
        cHandler: handler,
        purpose: purpose
      };
    };
    var curryArgs = function (descHandler, extraArgs) {
      return curried(curry.apply(undefined, [descHandler.handler].concat(extraArgs)), descHandler.purpose);
    };
    var getCurried = function (descHandler) {
      return descHandler.cHandler;
    };

    var behaviourTuple = function (name, handler) {
      return {
        name: name,
        handler: handler
      };
    };
    var nameToHandlers = function (behaviours, info) {
      var r = {};
      each(behaviours, function (behaviour) {
        r[behaviour.name()] = behaviour.handlers(info);
      });
      return r;
    };
    var groupByEvents = function (info, behaviours, base) {
      var behaviourEvents = __assign(__assign({}, base), nameToHandlers(behaviours, info));
      return byInnerKey(behaviourEvents, behaviourTuple);
    };
    var combine$1 = function (info, eventOrder, behaviours, base) {
      var byEventName = groupByEvents(info, behaviours, base);
      return combineGroups(byEventName, eventOrder);
    };
    var assemble = function (rawHandler) {
      var handler = read(rawHandler);
      return function (component, simulatedEvent) {
        var rest = [];
        for (var _i = 2; _i < arguments.length; _i++) {
          rest[_i - 2] = arguments[_i];
        }
        var args = [
          component,
          simulatedEvent
        ].concat(rest);
        if (handler.abort.apply(undefined, args)) {
          simulatedEvent.stop();
        } else if (handler.can.apply(undefined, args)) {
          handler.run.apply(undefined, args);
        }
      };
    };
    var missingOrderError = function (eventName, tuples) {
      return Result.error(['The event (' + eventName + ') has more than one behaviour that listens to it.\nWhen this occurs, you must ' + 'specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that ' + 'can trigger it are: ' + JSON.stringify(map(tuples, function (c) {
          return c.name;
        }), null, 2)]);
    };
    var fuse$1 = function (tuples, eventOrder, eventName) {
      var order = eventOrder[eventName];
      if (!order) {
        return missingOrderError(eventName, tuples);
      } else {
        return sortKeys('Event: ' + eventName, 'name', tuples, order).map(function (sortedTuples) {
          var handlers = map(sortedTuples, function (tuple) {
            return tuple.handler;
          });
          return fuse(handlers);
        });
      }
    };
    var combineGroups = function (byEventName, eventOrder) {
      var r = mapToArray(byEventName, function (tuples, eventName) {
        var combined = tuples.length === 1 ? Result.value(tuples[0].handler) : fuse$1(tuples, eventOrder, eventName);
        return combined.map(function (handler) {
          var assembled = assemble(handler);
          var purpose = tuples.length > 1 ? filter(eventOrder[eventName], function (o) {
            return exists(tuples, function (t) {
              return t.name === o;
            });
          }).join(' > ') : tuples[0].name;
          return wrap$1(eventName, uncurried(assembled, purpose));
        });
      });
      return consolidate(r, {});
    };

    var baseBehaviour = 'alloy.base.behaviour';
    var toInfo = function (spec) {
      var _a;
      return asRaw('custom.definition', objOf([
        field('dom', 'dom', strict(), objOf([
          strict$1('tag'),
          defaulted$1('styles', {}),
          defaulted$1('classes', []),
          defaulted$1('attributes', {}),
          option('value'),
          option('innerHtml')
        ])),
        strict$1('components'),
        strict$1('uid'),
        defaulted$1('events', {}),
        defaulted$1('apis', {}),
        field('eventOrder', 'eventOrder', mergeWith((_a = {}, _a[execute()] = [
          'disabling',
          baseBehaviour,
          'toggling',
          'typeaheadevents'
        ], _a[focus()] = [
          baseBehaviour,
          'focusing',
          'keying'
        ], _a[systemInit()] = [
          baseBehaviour,
          'disabling',
          'toggling',
          'representing'
        ], _a[input()] = [
          baseBehaviour,
          'representing',
          'streaming',
          'invalidating'
        ], _a[detachedFromDom()] = [
          baseBehaviour,
          'representing',
          'item-events',
          'tooltipping'
        ], _a[mousedown()] = [
          'focusing',
          baseBehaviour,
          'item-type-events'
        ], _a[touchstart()] = [
          'focusing',
          baseBehaviour,
          'item-type-events'
        ], _a[mouseover()] = [
          'item-type-events',
          'tooltipping'
        ], _a[receive()] = [
          'receiving',
          'reflecting',
          'tooltipping'
        ], _a)), anyValue$1()),
        option('domModification')
      ]), spec);
    };
    var toDefinition = function (detail) {
      return __assign(__assign({}, detail.dom), {
        uid: detail.uid,
        domChildren: map(detail.components, function (comp) {
          return comp.element;
        })
      });
    };
    var toModification = function (detail) {
      return detail.domModification.fold(function () {
        return nu$6({});
      }, nu$6);
    };
    var toEvents = function (info) {
      return info.events;
    };

    var read$2 = function (element, attr) {
      var value = get$3(element, attr);
      return value === undefined || value === '' ? [] : value.split(' ');
    };
    var add = function (element, attr, id) {
      var old = read$2(element, attr);
      var nu = old.concat([id]);
      set$1(element, attr, nu.join(' '));
      return true;
    };
    var remove$2 = function (element, attr, id) {
      var nu = filter(read$2(element, attr), function (v) {
        return v !== id;
      });
      if (nu.length > 0) {
        set$1(element, attr, nu.join(' '));
      } else {
        remove$1(element, attr);
      }
      return false;
    };

    var supports = function (element) {
      return element.dom.classList !== undefined;
    };
    var get$4 = function (element) {
      return read$2(element, 'class');
    };
    var add$1 = function (element, clazz) {
      return add(element, 'class', clazz);
    };
    var remove$3 = function (element, clazz) {
      return remove$2(element, 'class', clazz);
    };

    var add$2 = function (element, clazz) {
      if (supports(element)) {
        element.dom.classList.add(clazz);
      } else {
        add$1(element, clazz);
      }
    };
    var cleanClass = function (element) {
      var classList = supports(element) ? element.dom.classList : get$4(element);
      if (classList.length === 0) {
        remove$1(element, 'class');
      }
    };
    var remove$4 = function (element, clazz) {
      if (supports(element)) {
        var classList = element.dom.classList;
        classList.remove(clazz);
      } else {
        remove$3(element, clazz);
      }
      cleanClass(element);
    };
    var has$2 = function (element, clazz) {
      return supports(element) && element.dom.classList.contains(clazz);
    };

    var add$3 = function (element, classes) {
      each(classes, function (x) {
        add$2(element, x);
      });
    };
    var remove$5 = function (element, classes) {
      each(classes, function (x) {
        remove$4(element, x);
      });
    };

    var isSupported$1 = function (dom) {
      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);
    };

    var inBody = function (element) {
      var dom = isText(element) ? element.dom.parentNode : element.dom;
      if (dom === undefined || dom === null || dom.ownerDocument === null) {
        return false;
      }
      var doc = dom.ownerDocument;
      return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {
        return doc.body.contains(dom);
      }, compose1(inBody, getShadowHost));
    };
    var body = function () {
      return getBody(SugarElement.fromDom(document));
    };
    var getBody = function (doc) {
      var b = doc.dom.body;
      if (b === null || b === undefined) {
        throw new Error('Body is not available yet');
      }
      return SugarElement.fromDom(b);
    };

    var internalSet = function (dom, property, value) {
      if (!isString(value)) {
        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);
        throw new Error('CSS value must be a string: ' + value);
      }
      if (isSupported$1(dom)) {
        dom.style.setProperty(property, value);
      }
    };
    var internalRemove = function (dom, property) {
      if (isSupported$1(dom)) {
        dom.style.removeProperty(property);
      }
    };
    var set$2 = function (element, property, value) {
      var dom = element.dom;
      internalSet(dom, property, value);
    };
    var setAll$1 = function (element, css) {
      var dom = element.dom;
      each$1(css, function (v, k) {
        internalSet(dom, k, v);
      });
    };
    var setOptions = function (element, css) {
      var dom = element.dom;
      each$1(css, function (v, k) {
        v.fold(function () {
          internalRemove(dom, k);
        }, function (value) {
          internalSet(dom, k, value);
        });
      });
    };
    var get$5 = function (element, property) {
      var dom = element.dom;
      var styles = window.getComputedStyle(dom);
      var r = styles.getPropertyValue(property);
      return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;
    };
    var getUnsafeProperty = function (dom, property) {
      return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';
    };
    var getRaw = function (element, property) {
      var dom = element.dom;
      var raw = getUnsafeProperty(dom, property);
      return Optional.from(raw).filter(function (r) {
        return r.length > 0;
      });
    };
    var getAllRaw = function (element) {
      var css = {};
      var dom = element.dom;
      if (isSupported$1(dom)) {
        for (var i = 0; i < dom.style.length; i++) {
          var ruleName = dom.style.item(i);
          css[ruleName] = dom.style[ruleName];
        }
      }
      return css;
    };
    var isValidValue = function (tag, property, value) {
      var element = SugarElement.fromTag(tag);
      set$2(element, property, value);
      var style = getRaw(element, property);
      return style.isSome();
    };
    var remove$6 = function (element, property) {
      var dom = element.dom;
      internalRemove(dom, property);
      if (getOpt(element, 'style').map(trim).is('')) {
        remove$1(element, 'style');
      }
    };
    var reflow = function (e) {
      return e.dom.offsetWidth;
    };

    var get$6 = function (element) {
      return element.dom.value;
    };
    var set$3 = function (element, value) {
      if (value === undefined) {
        throw new Error('Value.set was undefined');
      }
      element.dom.value = value;
    };

    var renderToDom = function (definition) {
      var subject = SugarElement.fromTag(definition.tag);
      setAll(subject, definition.attributes);
      add$3(subject, definition.classes);
      setAll$1(subject, definition.styles);
      definition.innerHtml.each(function (html) {
        return set(subject, html);
      });
      var children = definition.domChildren;
      append$1(subject, children);
      definition.value.each(function (value) {
        set$3(subject, value);
      });
      if (!definition.uid) {
        debugger;
      }
      writeOnly(subject, definition.uid);
      return subject;
    };

    var getBehaviours$1 = function (spec) {
      var behaviours = get$1(spec, 'behaviours').getOr({});
      var keys$1 = filter(keys(behaviours), function (k) {
        return behaviours[k] !== undefined;
      });
      return map(keys$1, function (k) {
        return behaviours[k].me;
      });
    };
    var generateFrom$1 = function (spec, all) {
      return generateFrom(spec, all);
    };
    var generate$3 = function (spec) {
      var all = getBehaviours$1(spec);
      return generateFrom$1(spec, all);
    };

    var getDomDefinition = function (info, bList, bData) {
      var definition = toDefinition(info);
      var infoModification = toModification(info);
      var baseModification = { 'alloy.base.modification': infoModification };
      var modification = bList.length > 0 ? combine(bData, baseModification, bList, definition) : infoModification;
      return merge$1(definition, modification);
    };
    var getEvents = function (info, bList, bData) {
      var baseEvents = { 'alloy.base.behaviour': toEvents(info) };
      return combine$1(bData, info.eventOrder, bList, baseEvents).getOrDie();
    };
    var build = function (spec) {
      var getMe = function () {
        return me;
      };
      var systemApi = Cell(singleton);
      var info = getOrDie(toInfo(spec));
      var bBlob = generate$3(spec);
      var bList = getBehaviours(bBlob);
      var bData = getData(bBlob);
      var modDefinition = getDomDefinition(info, bList, bData);
      var item = renderToDom(modDefinition);
      var events = getEvents(info, bList, bData);
      var subcomponents = Cell(info.components);
      var connect = function (newApi) {
        systemApi.set(newApi);
      };
      var disconnect = function () {
        systemApi.set(NoContextApi(getMe));
      };
      var syncComponents = function () {
        var children$1 = children(item);
        var subs = bind(children$1, function (child) {
          return systemApi.get().getByDom(child).fold(function () {
            return [];
          }, function (c) {
            return [c];
          });
        });
        subcomponents.set(subs);
      };
      var config = function (behaviour) {
        var b = bData;
        var f = isFunction(b[behaviour.name()]) ? b[behaviour.name()] : function () {
          throw new Error('Could not find ' + behaviour.name() + ' in ' + JSON.stringify(spec, null, 2));
        };
        return f();
      };
      var hasConfigured = function (behaviour) {
        return isFunction(bData[behaviour.name()]);
      };
      var getApis = function () {
        return info.apis;
      };
      var readState = function (behaviourName) {
        return bData[behaviourName]().map(function (b) {
          return b.state.readState();
        }).getOr('not enabled');
      };
      var me = {
        getSystem: systemApi.get,
        config: config,
        hasConfigured: hasConfigured,
        spec: spec,
        readState: readState,
        getApis: getApis,
        connect: connect,
        disconnect: disconnect,
        element: item,
        syncComponents: syncComponents,
        components: subcomponents.get,
        events: events
      };
      return me;
    };

    var buildSubcomponents = function (spec) {
      var components = get$1(spec, 'components').getOr([]);
      return map(components, build$1);
    };
    var buildFromSpec = function (userSpec) {
      var _a = make(userSpec), specEvents = _a.events, spec = __rest(_a, ['events']);
      var components = buildSubcomponents(spec);
      var completeSpec = __assign(__assign({}, spec), {
        events: __assign(__assign({}, DefaultEvents), specEvents),
        components: components
      });
      return Result.value(build(completeSpec));
    };
    var text = function (textContent) {
      var element = SugarElement.fromText(textContent);
      return external({ element: element });
    };
    var external = function (spec) {
      var extSpec = asRawOrDie('external.component', objOfOnly([
        strict$1('element'),
        option('uid')
      ]), spec);
      var systemApi = Cell(NoContextApi());
      var connect = function (newApi) {
        systemApi.set(newApi);
      };
      var disconnect = function () {
        systemApi.set(NoContextApi(function () {
          return me;
        }));
      };
      extSpec.uid.each(function (uid) {
        writeOnly(extSpec.element, uid);
      });
      var me = {
        getSystem: systemApi.get,
        config: Optional.none,
        hasConfigured: never,
        connect: connect,
        disconnect: disconnect,
        getApis: function () {
          return {};
        },
        element: extSpec.element,
        spec: spec,
        readState: constant('No state'),
        syncComponents: noop,
        components: constant([]),
        events: {}
      };
      return premade(me);
    };
    var uids = generate$2;
    var build$1 = function (spec) {
      return getPremade(spec).fold(function () {
        var userSpecWithUid = spec.hasOwnProperty('uid') ? spec : __assign({ uid: uids('') }, spec);
        return buildFromSpec(userSpecWithUid).getOrDie();
      }, function (prebuilt) {
        return prebuilt;
      });
    };
    var premade$1 = premade;

    var Dimension = function (name, getOffset) {
      var set = function (element, h) {
        if (!isNumber(h) && !h.match(/^[0-9]+$/)) {
          throw new Error(name + '.set accepts only positive integer values. Value was ' + h);
        }
        var dom = element.dom;
        if (isSupported$1(dom)) {
          dom.style[name] = h + 'px';
        }
      };
      var get = function (element) {
        var r = getOffset(element);
        if (r <= 0 || r === null) {
          var css = get$5(element, name);
          return parseFloat(css) || 0;
        }
        return r;
      };
      var getOuter = get;
      var aggregate = function (element, properties) {
        return foldl(properties, function (acc, property) {
          var val = get$5(element, property);
          var value = val === undefined ? 0 : parseInt(val, 10);
          return isNaN(value) ? acc : acc + value;
        }, 0);
      };
      var max = function (element, value, properties) {
        var cumulativeInclusions = aggregate(element, properties);
        var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;
        return absoluteMax;
      };
      return {
        set: set,
        get: get,
        getOuter: getOuter,
        aggregate: aggregate,
        max: max
      };
    };

    var api = Dimension('height', function (element) {
      var dom = element.dom;
      return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;
    });
    var get$7 = function (element) {
      return api.get(element);
    };
    var getOuter$1 = function (element) {
      return api.getOuter(element);
    };
    var setMax = function (element, value) {
      var inclusions = [
        'margin-top',
        'border-top-width',
        'padding-top',
        'padding-bottom',
        'border-bottom-width',
        'margin-bottom'
      ];
      var absMax = api.max(element, value, inclusions);
      set$2(element, 'max-height', absMax + 'px');
    };

    var r = function (left, top) {
      var translate = function (x, y) {
        return r(left + x, top + y);
      };
      return {
        left: left,
        top: top,
        translate: translate
      };
    };
    var SugarPosition = r;

    var boxPosition = function (dom) {
      var box = dom.getBoundingClientRect();
      return SugarPosition(box.left, box.top);
    };
    var firstDefinedOrZero = function (a, b) {
      if (a !== undefined) {
        return a;
      } else {
        return b !== undefined ? b : 0;
      }
    };
    var absolute = function (element) {
      var doc = element.dom.ownerDocument;
      var body = doc.body;
      var win = doc.defaultView;
      var html = doc.documentElement;
      if (body === element.dom) {
        return SugarPosition(body.offsetLeft, body.offsetTop);
      }
      var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);
      var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);
      var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);
      var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);
      return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);
    };
    var viewport = function (element) {
      var dom = element.dom;
      var doc = dom.ownerDocument;
      var body = doc.body;
      if (body === dom) {
        return SugarPosition(body.offsetLeft, body.offsetTop);
      }
      if (!inBody(element)) {
        return SugarPosition(0, 0);
      }
      return boxPosition(dom);
    };

    var api$1 = Dimension('width', function (element) {
      return element.dom.offsetWidth;
    });
    var set$4 = function (element, h) {
      return api$1.set(element, h);
    };
    var get$8 = function (element) {
      return api$1.get(element);
    };
    var getOuter$2 = function (element) {
      return api$1.getOuter(element);
    };
    var setMax$1 = function (element, value) {
      var inclusions = [
        'margin-left',
        'border-left-width',
        'padding-left',
        'padding-right',
        'border-right-width',
        'margin-right'
      ];
      var absMax = api$1.max(element, value, inclusions);
      set$2(element, 'max-width', absMax + 'px');
    };

    var mkEvent = function (target, x, y, stop, prevent, kill, raw) {
      return {
        target: target,
        x: x,
        y: y,
        stop: stop,
        prevent: prevent,
        kill: kill,
        raw: raw
      };
    };
    var fromRawEvent = function (rawEvent) {
      var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));
      var stop = function () {
        return rawEvent.stopPropagation();
      };
      var prevent = function () {
        return rawEvent.preventDefault();
      };
      var kill = compose(prevent, stop);
      return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);
    };
    var handle = function (filter, handler) {
      return function (rawEvent) {
        if (filter(rawEvent)) {
          handler(fromRawEvent(rawEvent));
        }
      };
    };
    var binder = function (element, event, filter, handler, useCapture) {
      var wrapped = handle(filter, handler);
      element.dom.addEventListener(event, wrapped, useCapture);
      return { unbind: curry(unbind, element, event, wrapped, useCapture) };
    };
    var bind$2 = function (element, event, filter, handler) {
      return binder(element, event, filter, handler, false);
    };
    var capture = function (element, event, filter, handler) {
      return binder(element, event, filter, handler, true);
    };
    var unbind = function (element, event, handler, useCapture) {
      element.dom.removeEventListener(event, handler, useCapture);
    };

    var get$9 = function (_DOC) {
      var doc = _DOC !== undefined ? _DOC.dom : document;
      var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;
      var y = doc.body.scrollTop || doc.documentElement.scrollTop;
      return SugarPosition(x, y);
    };
    var to = function (x, y, _DOC) {
      var doc = _DOC !== undefined ? _DOC.dom : document;
      var win = doc.defaultView;
      if (win) {
        win.scrollTo(x, y);
      }
    };

    var get$a = function (_win) {
      var win = _win === undefined ? window : _win;
      return Optional.from(win['visualViewport']);
    };
    var bounds = function (x, y, width, height) {
      return {
        x: x,
        y: y,
        width: width,
        height: height,
        right: x + width,
        bottom: y + height
      };
    };
    var getBounds = function (_win) {
      var win = _win === undefined ? window : _win;
      var doc = win.document;
      var scroll = get$9(SugarElement.fromDom(doc));
      return get$a(win).fold(function () {
        var html = win.document.documentElement;
        var width = html.clientWidth;
        var height = html.clientHeight;
        return bounds(scroll.left, scroll.top, width, height);
      }, function (visualViewport) {
        return bounds(Math.max(visualViewport.pageLeft, scroll.left), Math.max(visualViewport.pageTop, scroll.top), visualViewport.width, visualViewport.height);
      });
    };

    var walkUp = function (navigation, doc) {
      var frame = navigation.view(doc);
      return frame.fold(constant([]), function (f) {
        var parent = navigation.owner(f);
        var rest = walkUp(navigation, parent);
        return [f].concat(rest);
      });
    };
    var pathTo = function (element, navigation) {
      var d = navigation.owner(element);
      var paths = walkUp(navigation, d);
      return Optional.some(paths);
    };

    var view = function (doc) {
      var _a;
      var element = doc.dom === document ? Optional.none() : Optional.from((_a = doc.dom.defaultView) === null || _a === void 0 ? void 0 : _a.frameElement);
      return element.map(SugarElement.fromDom);
    };
    var owner$1 = function (element) {
      return owner(element);
    };

    var Navigation = /*#__PURE__*/Object.freeze({
        __proto__: null,
        view: view,
        owner: owner$1
    });

    var find$3 = function (element) {
      var doc = SugarElement.fromDom(document);
      var scroll = get$9(doc);
      var path = pathTo(element, Navigation);
      return path.fold(curry(absolute, element), function (frames) {
        var offset = viewport(element);
        var r = foldr(frames, function (b, a) {
          var loc = viewport(a);
          return {
            left: b.left + loc.left,
            top: b.top + loc.top
          };
        }, {
          left: 0,
          top: 0
        });
        return SugarPosition(r.left + offset.left + scroll.left, r.top + offset.top + scroll.top);
      });
    };

    var pointed = function (point, width, height) {
      return {
        point: point,
        width: width,
        height: height
      };
    };
    var rect = function (x, y, width, height) {
      return {
        x: x,
        y: y,
        width: width,
        height: height
      };
    };
    var bounds$1 = function (x, y, width, height) {
      return {
        x: x,
        y: y,
        width: width,
        height: height,
        right: x + width,
        bottom: y + height
      };
    };
    var box = function (element) {
      var xy = absolute(element);
      var w = getOuter$2(element);
      var h = getOuter$1(element);
      return bounds$1(xy.left, xy.top, w, h);
    };
    var absolute$1 = function (element) {
      var position = find$3(element);
      var width = getOuter$2(element);
      var height = getOuter$1(element);
      return bounds$1(position.left, position.top, width, height);
    };
    var win = function () {
      return getBounds(window);
    };

    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {
      if (is(scope, a)) {
        return Optional.some(scope);
      } else if (isFunction(isRoot) && isRoot(scope)) {
        return Optional.none();
      } else {
        return ancestor(scope, a, isRoot);
      }
    }

    var ancestor$1 = function (scope, predicate, isRoot) {
      var element = scope.dom;
      var stop = isFunction(isRoot) ? isRoot : never;
      while (element.parentNode) {
        element = element.parentNode;
        var el = SugarElement.fromDom(element);
        if (predicate(el)) {
          return Optional.some(el);
        } else if (stop(el)) {
          break;
        }
      }
      return Optional.none();
    };
    var closest$1 = function (scope, predicate, isRoot) {
      var is = function (s, test) {
        return test(s);
      };
      return ClosestOrAncestor(is, ancestor$1, scope, predicate, isRoot);
    };
    var descendant = function (scope, predicate) {
      var descend = function (node) {
        for (var i = 0; i < node.childNodes.length; i++) {
          var child_1 = SugarElement.fromDom(node.childNodes[i]);
          if (predicate(child_1)) {
            return Optional.some(child_1);
          }
          var res = descend(node.childNodes[i]);
          if (res.isSome()) {
            return res;
          }
        }
        return Optional.none();
      };
      return descend(scope.dom);
    };

    var closest$2 = function (scope, predicate, isRoot) {
      return closest$1(scope, predicate, isRoot).isSome();
    };

    var ancestor$2 = function (scope, selector, isRoot) {
      return ancestor$1(scope, function (e) {
        return is(e, selector);
      }, isRoot);
    };
    var descendant$1 = function (scope, selector) {
      return one(selector, scope);
    };
    var closest$3 = function (scope, selector, isRoot) {
      var is$1 = function (element, selector) {
        return is(element, selector);
      };
      return ClosestOrAncestor(is$1, ancestor$2, scope, selector, isRoot);
    };

    var find$4 = function (queryElem) {
      var dependent = closest$1(queryElem, function (elem) {
        if (!isElement(elem)) {
          return false;
        }
        var id = get$3(elem, 'id');
        return id !== undefined && id.indexOf('aria-owns') > -1;
      });
      return dependent.bind(function (dep) {
        var id = get$3(dep, 'id');
        var dos = getRootNode(dep);
        return descendant$1(dos, '[aria-owns="' + id + '"]');
      });
    };
    var manager = function () {
      var ariaId = generate$1('aria-owns');
      var link = function (elem) {
        set$1(elem, 'aria-owns', ariaId);
      };
      var unlink = function (elem) {
        remove$1(elem, 'aria-owns');
      };
      return {
        id: ariaId,
        link: link,
        unlink: unlink
      };
    };

    var isAriaPartOf = function (component, queryElem) {
      return find$4(queryElem).exists(function (owner) {
        return isPartOf(component, owner);
      });
    };
    var isPartOf = function (component, queryElem) {
      return closest$2(queryElem, function (el) {
        return eq$1(el, component.element);
      }, never) || isAriaPartOf(component, queryElem);
    };

    var unknown$3 = 'unknown';
    var EventConfiguration;
    (function (EventConfiguration) {
      EventConfiguration[EventConfiguration['STOP'] = 0] = 'STOP';
      EventConfiguration[EventConfiguration['NORMAL'] = 1] = 'NORMAL';
      EventConfiguration[EventConfiguration['LOGGING'] = 2] = 'LOGGING';
    }(EventConfiguration || (EventConfiguration = {})));
    var eventConfig = Cell({});
    var makeEventLogger = function (eventName, initialTarget) {
      var sequence = [];
      var startTime = new Date().getTime();
      return {
        logEventCut: function (_name, target, purpose) {
          sequence.push({
            outcome: 'cut',
            target: target,
            purpose: purpose
          });
        },
        logEventStopped: function (_name, target, purpose) {
          sequence.push({
            outcome: 'stopped',
            target: target,
            purpose: purpose
          });
        },
        logNoParent: function (_name, target, purpose) {
          sequence.push({
            outcome: 'no-parent',
            target: target,
            purpose: purpose
          });
        },
        logEventNoHandlers: function (_name, target) {
          sequence.push({
            outcome: 'no-handlers-left',
            target: target
          });
        },
        logEventResponse: function (_name, target, purpose) {
          sequence.push({
            outcome: 'response',
            purpose: purpose,
            target: target
          });
        },
        write: function () {
          var finishTime = new Date().getTime();
          if (contains([
              'mousemove',
              'mouseover',
              'mouseout',
              systemInit()
            ], eventName)) {
            return;
          }
          console.log(eventName, {
            event: eventName,
            time: finishTime - startTime,
            target: initialTarget.dom,
            sequence: map(sequence, function (s) {
              if (!contains([
                  'cut',
                  'stopped',
                  'response'
                ], s.outcome)) {
                return s.outcome;
              } else {
                return '{' + s.purpose + '} ' + s.outcome + ' at (' + element(s.target) + ')';
              }
            })
          });
        }
      };
    };
    var processEvent = function (eventName, initialTarget, f) {
      var status = get$1(eventConfig.get(), eventName).orThunk(function () {
        var patterns = keys(eventConfig.get());
        return findMap(patterns, function (p) {
          return eventName.indexOf(p) > -1 ? Optional.some(eventConfig.get()[p]) : Optional.none();
        });
      }).getOr(EventConfiguration.NORMAL);
      switch (status) {
      case EventConfiguration.NORMAL:
        return f(noLogger());
      case EventConfiguration.LOGGING: {
          var logger = makeEventLogger(eventName, initialTarget);
          var output = f(logger);
          logger.write();
          return output;
        }
      case EventConfiguration.STOP:
        return true;
      }
    };
    var path = [
      'alloy/data/Fields',
      'alloy/debugging/Debugging'
    ];
    var getTrace = function () {
      var err = new Error();
      if (err.stack !== undefined) {
        var lines = err.stack.split('\n');
        return find(lines, function (line) {
          return line.indexOf('alloy') > 0 && !exists(path, function (p) {
            return line.indexOf(p) > -1;
          });
        }).getOr(unknown$3);
      } else {
        return unknown$3;
      }
    };
    var ignoreEvent = {
      logEventCut: noop,
      logEventStopped: noop,
      logNoParent: noop,
      logEventNoHandlers: noop,
      logEventResponse: noop,
      write: noop
    };
    var monitorEvent = function (eventName, initialTarget, f) {
      return processEvent(eventName, initialTarget, f);
    };
    var noLogger = constant(ignoreEvent);

    var menuFields = constant([
      strict$1('menu'),
      strict$1('selectedMenu')
    ]);
    var itemFields = constant([
      strict$1('item'),
      strict$1('selectedItem')
    ]);
    var schema = constant(objOf(itemFields().concat(menuFields())));
    var itemSchema = constant(objOf(itemFields()));

    var _initSize = strictObjOf('initSize', [
      strict$1('numColumns'),
      strict$1('numRows')
    ]);
    var itemMarkers = function () {
      return strictOf('markers', itemSchema());
    };
    var tieredMenuMarkers = function () {
      return strictObjOf('markers', [strict$1('backgroundMenu')].concat(menuFields()).concat(itemFields()));
    };
    var markers = function (required) {
      return strictObjOf('markers', map(required, strict$1));
    };
    var onPresenceHandler = function (label, fieldName, presence) {
      var trace = getTrace();
      return field(fieldName, fieldName, presence, valueOf(function (f) {
        return Result.value(function () {
          var args = [];
          for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
          }
          return f.apply(undefined, args);
        });
      }));
    };
    var onHandler = function (fieldName) {
      return onPresenceHandler('onHandler', fieldName, defaulted(noop));
    };
    var onKeyboardHandler = function (fieldName) {
      return onPresenceHandler('onKeyboardHandler', fieldName, defaulted(Optional.none));
    };
    var onStrictHandler = function (fieldName) {
      return onPresenceHandler('onHandler', fieldName, strict());
    };
    var onStrictKeyboardHandler = function (fieldName) {
      return onPresenceHandler('onKeyboardHandler', fieldName, strict());
    };
    var output = function (name, value) {
      return state$1(name, constant(value));
    };
    var snapshot = function (name) {
      return state$1(name, identity);
    };
    var initSize = constant(_initSize);

    var nu$7 = function (x, y, bubble, direction, boundsRestriction, label) {
      return {
        x: x,
        y: y,
        bubble: bubble,
        direction: direction,
        boundsRestriction: boundsRestriction,
        label: label
      };
    };

    var adt$2 = Adt.generate([
      { southeast: [] },
      { southwest: [] },
      { northeast: [] },
      { northwest: [] },
      { south: [] },
      { north: [] },
      { east: [] },
      { west: [] }
    ]);
    var cata = function (subject, southeast, southwest, northeast, northwest, south, north, east, west) {
      return subject.fold(southeast, southwest, northeast, northwest, south, north, east, west);
    };
    var cataVertical = function (subject, south, middle, north) {
      return subject.fold(south, south, north, north, south, north, middle, middle);
    };
    var cataHorizontal = function (subject, east, middle, west) {
      return subject.fold(east, west, east, west, middle, middle, east, west);
    };
    var southeast = adt$2.southeast;
    var southwest = adt$2.southwest;
    var northeast = adt$2.northeast;
    var northwest = adt$2.northwest;
    var south = adt$2.south;
    var north = adt$2.north;
    var east = adt$2.east;
    var west = adt$2.west;

    var getRestriction = function (anchor, restriction) {
      switch (restriction) {
      case 1:
        return anchor.x;
      case 0:
        return anchor.x + anchor.width;
      case 2:
        return anchor.y;
      case 3:
        return anchor.y + anchor.height;
      }
    };
    var boundsRestriction = function (anchor, restrictions) {
      return mapToObject([
        'left',
        'right',
        'top',
        'bottom'
      ], function (dir) {
        return get$1(restrictions, dir).map(function (restriction) {
          return getRestriction(anchor, restriction);
        });
      });
    };
    var adjustBounds = function (bounds, boundsRestrictions, bubbleOffsets) {
      var applyRestriction = function (dir, current) {
        var bubbleOffset = dir === 'top' || dir === 'bottom' ? bubbleOffsets.top : bubbleOffsets.left;
        return get$1(boundsRestrictions, dir).bind(identity).bind(function (restriction) {
          if (dir === 'left' || dir === 'top') {
            return restriction >= current ? Optional.some(restriction) : Optional.none();
          } else {
            return restriction <= current ? Optional.some(restriction) : Optional.none();
          }
        }).map(function (restriction) {
          return restriction + bubbleOffset;
        }).getOr(current);
      };
      var adjustedLeft = applyRestriction('left', bounds.x);
      var adjustedTop = applyRestriction('top', bounds.y);
      var adjustedRight = applyRestriction('right', bounds.right);
      var adjustedBottom = applyRestriction('bottom', bounds.bottom);
      return bounds$1(adjustedLeft, adjustedTop, adjustedRight - adjustedLeft, adjustedBottom - adjustedTop);
    };

    var eastX = function (anchor) {
      return anchor.x;
    };
    var middleX = function (anchor, element) {
      return anchor.x + anchor.width / 2 - element.width / 2;
    };
    var westX = function (anchor, element) {
      return anchor.x + anchor.width - element.width;
    };
    var northY = function (anchor, element) {
      return anchor.y - element.height;
    };
    var southY = function (anchor) {
      return anchor.y + anchor.height;
    };
    var centreY = function (anchor, element) {
      return anchor.y + anchor.height / 2 - element.height / 2;
    };
    var eastEdgeX = function (anchor) {
      return anchor.x + anchor.width;
    };
    var westEdgeX = function (anchor, element) {
      return anchor.x - element.width;
    };
    var southeast$1 = function (anchor, element, bubbles) {
      return nu$7(eastX(anchor), southY(anchor), bubbles.southeast(), southeast(), boundsRestriction(anchor, {
        left: 1,
        top: 3
      }), 'layout-se');
    };
    var southwest$1 = function (anchor, element, bubbles) {
      return nu$7(westX(anchor, element), southY(anchor), bubbles.southwest(), southwest(), boundsRestriction(anchor, {
        right: 0,
        top: 3
      }), 'layout-sw');
    };
    var northeast$1 = function (anchor, element, bubbles) {
      return nu$7(eastX(anchor), northY(anchor, element), bubbles.northeast(), northeast(), boundsRestriction(anchor, {
        left: 1,
        bottom: 2
      }), 'layout-ne');
    };
    var northwest$1 = function (anchor, element, bubbles) {
      return nu$7(westX(anchor, element), northY(anchor, element), bubbles.northwest(), northwest(), boundsRestriction(anchor, {
        right: 0,
        bottom: 2
      }), 'layout-nw');
    };
    var north$1 = function (anchor, element, bubbles) {
      return nu$7(middleX(anchor, element), northY(anchor, element), bubbles.north(), north(), boundsRestriction(anchor, { bottom: 2 }), 'layout-n');
    };
    var south$1 = function (anchor, element, bubbles) {
      return nu$7(middleX(anchor, element), southY(anchor), bubbles.south(), south(), boundsRestriction(anchor, { top: 3 }), 'layout-s');
    };
    var east$1 = function (anchor, element, bubbles) {
      return nu$7(eastEdgeX(anchor), centreY(anchor, element), bubbles.east(), east(), boundsRestriction(anchor, { left: 0 }), 'layout-e');
    };
    var west$1 = function (anchor, element, bubbles) {
      return nu$7(westEdgeX(anchor, element), centreY(anchor, element), bubbles.west(), west(), boundsRestriction(anchor, { right: 1 }), 'layout-w');
    };
    var all$2 = function () {
      return [
        southeast$1,
        southwest$1,
        northeast$1,
        northwest$1,
        south$1,
        north$1,
        east$1,
        west$1
      ];
    };
    var allRtl = function () {
      return [
        southwest$1,
        southeast$1,
        northwest$1,
        northeast$1,
        south$1,
        north$1,
        east$1,
        west$1
      ];
    };
    var aboveOrBelow = function () {
      return [
        northeast$1,
        northwest$1,
        southeast$1,
        southwest$1,
        north$1,
        south$1
      ];
    };
    var aboveOrBelowRtl = function () {
      return [
        northwest$1,
        northeast$1,
        southwest$1,
        southeast$1,
        north$1,
        south$1
      ];
    };
    var belowOrAbove = function () {
      return [
        southeast$1,
        southwest$1,
        northeast$1,
        northwest$1,
        south$1,
        north$1
      ];
    };
    var belowOrAboveRtl = function () {
      return [
        southwest$1,
        southeast$1,
        northwest$1,
        northeast$1,
        south$1,
        north$1
      ];
    };

    var chooseChannels = function (channels, message) {
      return message.universal ? channels : filter(channels, function (ch) {
        return contains(message.channels, ch);
      });
    };
    var events$1 = function (receiveConfig) {
      return derive([run(receive(), function (component, message) {
          var channelMap = receiveConfig.channels;
          var channels = keys(channelMap);
          var receivingData = message;
          var targetChannels = chooseChannels(channels, receivingData);
          each(targetChannels, function (ch) {
            var channelInfo = channelMap[ch];
            var channelSchema = channelInfo.schema;
            var data = asRawOrDie('channel[' + ch + '] data\nReceiver: ' + element(component.element), channelSchema, receivingData.data);
            channelInfo.onReceive(component, data);
          });
        })]);
    };

    var ActiveReceiving = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$1
    });

    var ReceivingSchema = [strictOf('channels', setOf$1(Result.value, objOfOnly([
        onStrictHandler('onReceive'),
        defaulted$1('schema', anyValue$1())
      ])))];

    var executeEvent = function (bConfig, bState, executor) {
      return runOnExecute(function (component) {
        executor(component, bConfig, bState);
      });
    };
    var loadEvent = function (bConfig, bState, f) {
      return runOnInit(function (component, _simulatedEvent) {
        f(component, bConfig, bState);
      });
    };
    var create = function (schema, name, active, apis, extra, state) {
      var configSchema = objOfOnly(schema);
      var schemaSchema = optionObjOf(name, [optionObjOfOnly('config', schema)]);
      return doCreate(configSchema, schemaSchema, name, active, apis, extra, state);
    };
    var createModes = function (modes, name, active, apis, extra, state) {
      var configSchema = modes;
      var schemaSchema = optionObjOf(name, [optionOf('config', modes)]);
      return doCreate(configSchema, schemaSchema, name, active, apis, extra, state);
    };
    var wrapApi = function (bName, apiFunction, apiName) {
      var f = function (component) {
        var rest = [];
        for (var _i = 1; _i < arguments.length; _i++) {
          rest[_i - 1] = arguments[_i];
        }
        var args = [component].concat(rest);
        return component.config({ name: constant(bName) }).fold(function () {
          throw new Error('We could not find any behaviour configuration for: ' + bName + '. Using API: ' + apiName);
        }, function (info) {
          var rest = Array.prototype.slice.call(args, 1);
          return apiFunction.apply(undefined, [
            component,
            info.config,
            info.state
          ].concat(rest));
        });
      };
      return markAsBehaviourApi(f, apiName, apiFunction);
    };
    var revokeBehaviour = function (name) {
      return {
        key: name,
        value: undefined
      };
    };
    var doCreate = function (configSchema, schemaSchema, name, active, apis, extra, state) {
      var getConfig = function (info) {
        return hasNonNullableKey(info, name) ? info[name]() : Optional.none();
      };
      var wrappedApis = map$2(apis, function (apiF, apiName) {
        return wrapApi(name, apiF, apiName);
      });
      var wrappedExtra = map$2(extra, function (extraF, extraName) {
        return markAsExtraApi(extraF, extraName);
      });
      var me = __assign(__assign(__assign({}, wrappedExtra), wrappedApis), {
        revoke: curry(revokeBehaviour, name),
        config: function (spec) {
          var prepared = asRawOrDie(name + '-config', configSchema, spec);
          return {
            key: name,
            value: {
              config: prepared,
              me: me,
              configAsRaw: cached(function () {
                return asRawOrDie(name + '-config', configSchema, spec);
              }),
              initialConfig: spec,
              state: state
            }
          };
        },
        schema: constant(schemaSchema),
        exhibit: function (info, base) {
          return getConfig(info).bind(function (behaviourInfo) {
            return get$1(active, 'exhibit').map(function (exhibitor) {
              return exhibitor(base, behaviourInfo.config, behaviourInfo.state);
            });
          }).getOr(nu$6({}));
        },
        name: constant(name),
        handlers: function (info) {
          return getConfig(info).map(function (behaviourInfo) {
            var getEvents = get$1(active, 'events').getOr(function () {
              return {};
            });
            return getEvents(behaviourInfo.config, behaviourInfo.state);
          }).getOr({});
        }
      });
      return me;
    };

    var derive$1 = function (capabilities) {
      return wrapAll$1(capabilities);
    };
    var simpleSchema = objOfOnly([
      strict$1('fields'),
      strict$1('name'),
      defaulted$1('active', {}),
      defaulted$1('apis', {}),
      defaulted$1('state', NoState),
      defaulted$1('extra', {})
    ]);
    var create$1 = function (data) {
      var value = asRawOrDie('Creating behaviour: ' + data.name, simpleSchema, data);
      return create(value.fields, value.name, value.active, value.apis, value.extra, value.state);
    };
    var modeSchema = objOfOnly([
      strict$1('branchKey'),
      strict$1('branches'),
      strict$1('name'),
      defaulted$1('active', {}),
      defaulted$1('apis', {}),
      defaulted$1('state', NoState),
      defaulted$1('extra', {})
    ]);
    var createModes$1 = function (data) {
      var value = asRawOrDie('Creating behaviour: ' + data.name, modeSchema, data);
      return createModes(choose$1(value.branchKey, value.branches), value.name, value.active, value.apis, value.extra, value.state);
    };
    var revoke = constant(undefined);

    var Receiving = create$1({
      fields: ReceivingSchema,
      name: 'receiving',
      active: ActiveReceiving
    });

    var exhibit = function (base, posConfig) {
      return nu$6({
        classes: [],
        styles: posConfig.useFixed() ? {} : { position: 'relative' }
      });
    };

    var ActivePosition = /*#__PURE__*/Object.freeze({
        __proto__: null,
        exhibit: exhibit
    });

    var getDocument = function () {
      return SugarElement.fromDom(document);
    };

    var focus$1 = function (element) {
      return element.dom.focus();
    };
    var blur = function (element) {
      return element.dom.blur();
    };
    var hasFocus = function (element) {
      var root = getRootNode(element).dom;
      return element.dom === root.activeElement;
    };
    var active = function (root) {
      if (root === void 0) {
        root = getDocument();
      }
      return Optional.from(root.dom.activeElement).map(SugarElement.fromDom);
    };
    var search = function (element) {
      return active(getRootNode(element)).filter(function (e) {
        return element.dom.contains(e.dom);
      });
    };

    var preserve = function (f, container) {
      var dos = getRootNode(container);
      var refocus = active(dos).bind(function (focused) {
        var hasFocus = function (elem) {
          return eq$1(focused, elem);
        };
        return hasFocus(container) ? Optional.some(container) : descendant(container, hasFocus);
      });
      var result = f(container);
      refocus.each(function (oldFocus) {
        active(dos).filter(function (newFocus) {
          return eq$1(newFocus, oldFocus);
        }).fold(function () {
          focus$1(oldFocus);
        }, noop);
      });
      return result;
    };

    var NuPositionCss = function (position, left, top, right, bottom) {
      return {
        position: position,
        left: left,
        top: top,
        right: right,
        bottom: bottom
      };
    };
    var applyPositionCss = function (element, position) {
      var addPx = function (num) {
        return num + 'px';
      };
      setOptions(element, {
        position: Optional.some(position.position),
        left: position.left.map(addPx),
        top: position.top.map(addPx),
        right: position.right.map(addPx),
        bottom: position.bottom.map(addPx)
      });
    };

    var adt$3 = Adt.generate([
      { none: [] },
      {
        relative: [
          'x',
          'y',
          'width',
          'height'
        ]
      },
      {
        fixed: [
          'x',
          'y',
          'width',
          'height'
        ]
      }
    ]);
    var positionWithDirection = function (posName, decision, x, y, width, height) {
      var decisionX = decision.x - x;
      var decisionY = decision.y - y;
      var decisionWidth = decision.width;
      var decisionHeight = decision.height;
      var decisionRight = width - (decisionX + decisionWidth);
      var decisionBottom = height - (decisionY + decisionHeight);
      var left = Optional.some(decisionX);
      var top = Optional.some(decisionY);
      var right = Optional.some(decisionRight);
      var bottom = Optional.some(decisionBottom);
      var none = Optional.none();
      return cata(decision.direction, function () {
        return NuPositionCss(posName, left, top, none, none);
      }, function () {
        return NuPositionCss(posName, none, top, right, none);
      }, function () {
        return NuPositionCss(posName, left, none, none, bottom);
      }, function () {
        return NuPositionCss(posName, none, none, right, bottom);
      }, function () {
        return NuPositionCss(posName, left, top, none, none);
      }, function () {
        return NuPositionCss(posName, left, none, none, bottom);
      }, function () {
        return NuPositionCss(posName, left, top, none, none);
      }, function () {
        return NuPositionCss(posName, none, top, right, none);
      });
    };
    var reposition = function (origin, decision) {
      return origin.fold(function () {
        return NuPositionCss('absolute', Optional.some(decision.x), Optional.some(decision.y), Optional.none(), Optional.none());
      }, function (x, y, width, height) {
        return positionWithDirection('absolute', decision, x, y, width, height);
      }, function (x, y, width, height) {
        return positionWithDirection('fixed', decision, x, y, width, height);
      });
    };
    var toBox = function (origin, element) {
      var rel = curry(find$3, element);
      var position = origin.fold(rel, rel, function () {
        var scroll = get$9();
        return find$3(element).translate(-scroll.left, -scroll.top);
      });
      var width = getOuter$2(element);
      var height = getOuter$1(element);
      return bounds$1(position.left, position.top, width, height);
    };
    var viewport$1 = function (origin, getBounds) {
      return getBounds.fold(function () {
        return origin.fold(win, win, bounds$1);
      }, function (b) {
        return origin.fold(b, b, function () {
          var bounds = b();
          var pos = translate(origin, bounds.x, bounds.y);
          return bounds$1(pos.left, pos.top, bounds.width, bounds.height);
        });
      });
    };
    var translate = function (origin, x, y) {
      var pos = SugarPosition(x, y);
      var removeScroll = function () {
        var outerScroll = get$9();
        return pos.translate(-outerScroll.left, -outerScroll.top);
      };
      return origin.fold(constant(pos), constant(pos), removeScroll);
    };
    var cata$1 = function (subject, onNone, onRelative, onFixed) {
      return subject.fold(onNone, onRelative, onFixed);
    };
    var none$1 = adt$3.none;
    var relative = adt$3.relative;
    var fixed = adt$3.fixed;

    var anchor = function (anchorBox, origin) {
      return {
        anchorBox: anchorBox,
        origin: origin
      };
    };
    var box$1 = function (anchorBox, origin) {
      return anchor(anchorBox, origin);
    };

    var cycleBy = function (value, delta, min, max) {
      var r = value + delta;
      if (r > max) {
        return min;
      } else if (r < min) {
        return max;
      } else {
        return r;
      }
    };
    var clamp = function (value, min, max) {
      return Math.min(Math.max(value, min), max);
    };

    var adt$4 = Adt.generate([
      { fit: ['reposition'] },
      {
        nofit: [
          'reposition',
          'deltaW',
          'deltaH'
        ]
      }
    ]);
    var calcReposition = function (newX, newY, width, height, bounds) {
      var boundsX = bounds.x;
      var boundsY = bounds.y;
      var boundsWidth = bounds.width;
      var boundsHeight = bounds.height;
      var xInBounds = newX >= boundsX;
      var yInBounds = newY >= boundsY;
      var originInBounds = xInBounds && yInBounds;
      var xFit = newX + width <= boundsX + boundsWidth;
      var yFit = newY + height <= boundsY + boundsHeight;
      var sizeInBounds = xFit && yFit;
      var deltaW = Math.abs(Math.min(width, xInBounds ? boundsX + boundsWidth - newX : boundsX - (newX + width)));
      var deltaH = Math.abs(Math.min(height, yInBounds ? boundsY + boundsHeight - newY : boundsY - (newY + height)));
      var maxX = Math.max(bounds.x, bounds.right - width);
      var maxY = Math.max(bounds.y, bounds.bottom - height);
      var limitX = clamp(newX, bounds.x, maxX);
      var limitY = clamp(newY, bounds.y, maxY);
      return {
        originInBounds: originInBounds,
        sizeInBounds: sizeInBounds,
        limitX: limitX,
        limitY: limitY,
        deltaW: deltaW,
        deltaH: deltaH
      };
    };
    var attempt = function (candidate, width, height, bounds) {
      var candidateX = candidate.x;
      var candidateY = candidate.y;
      var bubbleOffsets = candidate.bubble.offset;
      var bubbleLeft = bubbleOffsets.left;
      var bubbleTop = bubbleOffsets.top;
      var adjustedBounds = adjustBounds(bounds, candidate.boundsRestriction, bubbleOffsets);
      var boundsY = adjustedBounds.y;
      var boundsBottom = adjustedBounds.bottom;
      var boundsX = adjustedBounds.x;
      var boundsRight = adjustedBounds.right;
      var newX = candidateX + bubbleLeft;
      var newY = candidateY + bubbleTop;
      var _a = calcReposition(newX, newY, width, height, adjustedBounds), originInBounds = _a.originInBounds, sizeInBounds = _a.sizeInBounds, limitX = _a.limitX, limitY = _a.limitY, deltaW = _a.deltaW, deltaH = _a.deltaH;
      var upAvailable = constant(limitY + deltaH - boundsY);
      var downAvailable = constant(boundsBottom - limitY);
      var maxHeight = cataVertical(candidate.direction, downAvailable, downAvailable, upAvailable);
      var westAvailable = constant(limitX + deltaW - boundsX);
      var eastAvailable = constant(boundsRight - limitX);
      var maxWidth = cataHorizontal(candidate.direction, eastAvailable, eastAvailable, westAvailable);
      var reposition = {
        x: limitX,
        y: limitY,
        width: deltaW,
        height: deltaH,
        maxHeight: maxHeight,
        maxWidth: maxWidth,
        direction: candidate.direction,
        classes: {
          on: candidate.bubble.classesOn,
          off: candidate.bubble.classesOff
        },
        label: candidate.label,
        candidateYforTest: newY
      };
      return originInBounds && sizeInBounds ? adt$4.fit(reposition) : adt$4.nofit(reposition, deltaW, deltaH);
    };
    var attempts = function (candidates, anchorBox, elementBox, bubbles, bounds) {
      var panelWidth = elementBox.width;
      var panelHeight = elementBox.height;
      var attemptBestFit = function (layout, reposition, deltaW, deltaH) {
        var next = layout(anchorBox, elementBox, bubbles);
        var attemptLayout = attempt(next, panelWidth, panelHeight, bounds);
        return attemptLayout.fold(adt$4.fit, function (newReposition, newDeltaW, newDeltaH) {
          var improved = newDeltaH > deltaH || newDeltaW > deltaW;
          return improved ? adt$4.nofit(newReposition, newDeltaW, newDeltaH) : adt$4.nofit(reposition, deltaW, deltaH);
        });
      };
      var abc = foldl(candidates, function (b, a) {
        var bestNext = curry(attemptBestFit, a);
        return b.fold(adt$4.fit, bestNext);
      }, adt$4.nofit({
        x: anchorBox.x,
        y: anchorBox.y,
        width: elementBox.width,
        height: elementBox.height,
        maxHeight: elementBox.height,
        maxWidth: elementBox.width,
        direction: southeast(),
        classes: {
          on: [],
          off: []
        },
        label: 'none',
        candidateYforTest: anchorBox.y
      }, -1, -1));
      return abc.fold(identity, identity);
    };

    var elementSize = function (p) {
      return {
        width: getOuter$2(p),
        height: getOuter$1(p)
      };
    };
    var layout = function (anchorBox, element, bubbles, options) {
      remove$6(element, 'max-height');
      remove$6(element, 'max-width');
      var elementBox = elementSize(element);
      return attempts(options.preference, anchorBox, elementBox, bubbles, options.bounds);
    };
    var setClasses = function (element, decision) {
      var classInfo = decision.classes;
      remove$5(element, classInfo.off);
      add$3(element, classInfo.on);
    };
    var setHeight = function (element, decision, options) {
      var maxHeightFunction = options.maxHeightFunction;
      maxHeightFunction(element, decision.maxHeight);
    };
    var setWidth = function (element, decision, options) {
      var maxWidthFunction = options.maxWidthFunction;
      maxWidthFunction(element, decision.maxWidth);
    };
    var position = function (element, decision, options) {
      applyPositionCss(element, reposition(options.origin, decision));
    };

    var setMaxHeight = function (element, maxHeight) {
      setMax(element, Math.floor(maxHeight));
    };
    var anchored = constant(function (element, available) {
      setMaxHeight(element, available);
      setAll$1(element, {
        'overflow-x': 'hidden',
        'overflow-y': 'auto'
      });
    });
    var expandable = constant(function (element, available) {
      setMaxHeight(element, available);
    });

    var defaultOr = function (options, key, dephault) {
      return options[key] === undefined ? dephault : options[key];
    };
    var simple = function (anchor, element, bubble, layouts, getBounds, overrideOptions) {
      var maxHeightFunction = defaultOr(overrideOptions, 'maxHeightFunction', anchored());
      var maxWidthFunction = defaultOr(overrideOptions, 'maxWidthFunction', noop);
      var anchorBox = anchor.anchorBox;
      var origin = anchor.origin;
      var options = {
        bounds: viewport$1(origin, getBounds),
        origin: origin,
        preference: layouts,
        maxHeightFunction: maxHeightFunction,
        maxWidthFunction: maxWidthFunction
      };
      go(anchorBox, element, bubble, options);
    };
    var go = function (anchorBox, element, bubble, options) {
      var decision = layout(anchorBox, element, bubble, options);
      position(element, decision, options);
      setClasses(element, decision);
      setHeight(element, decision, options);
      setWidth(element, decision, options);
    };

    var allAlignments = [
      'valignCentre',
      'alignLeft',
      'alignRight',
      'alignCentre',
      'top',
      'bottom',
      'left',
      'right'
    ];
    var nu$8 = function (width, yoffset, classes) {
      var getClasses = function (prop) {
        return get$1(classes, prop).getOr([]);
      };
      var make = function (xDelta, yDelta, alignmentsOn) {
        var alignmentsOff = difference(allAlignments, alignmentsOn);
        return {
          offset: SugarPosition(xDelta, yDelta),
          classesOn: bind(alignmentsOn, getClasses),
          classesOff: bind(alignmentsOff, getClasses)
        };
      };
      return {
        southeast: function () {
          return make(-width, yoffset, [
            'top',
            'alignLeft'
          ]);
        },
        southwest: function () {
          return make(width, yoffset, [
            'top',
            'alignRight'
          ]);
        },
        south: function () {
          return make(-width / 2, yoffset, [
            'top',
            'alignCentre'
          ]);
        },
        northeast: function () {
          return make(-width, -yoffset, [
            'bottom',
            'alignLeft'
          ]);
        },
        northwest: function () {
          return make(width, -yoffset, [
            'bottom',
            'alignRight'
          ]);
        },
        north: function () {
          return make(-width / 2, -yoffset, [
            'bottom',
            'alignCentre'
          ]);
        },
        east: function () {
          return make(width, -yoffset / 2, [
            'valignCentre',
            'left'
          ]);
        },
        west: function () {
          return make(-width, -yoffset / 2, [
            'valignCentre',
            'right'
          ]);
        },
        innerNorthwest: function () {
          return make(-width, yoffset, [
            'top',
            'alignRight'
          ]);
        },
        innerNortheast: function () {
          return make(width, yoffset, [
            'top',
            'alignLeft'
          ]);
        },
        innerNorth: function () {
          return make(-width / 2, yoffset, [
            'top',
            'alignCentre'
          ]);
        },
        innerSouthwest: function () {
          return make(-width, -yoffset, [
            'bottom',
            'alignRight'
          ]);
        },
        innerSoutheast: function () {
          return make(width, -yoffset, [
            'bottom',
            'alignLeft'
          ]);
        },
        innerSouth: function () {
          return make(-width / 2, -yoffset, [
            'bottom',
            'alignCentre'
          ]);
        },
        innerWest: function () {
          return make(width, -yoffset / 2, [
            'valignCentre',
            'right'
          ]);
        },
        innerEast: function () {
          return make(-width, -yoffset / 2, [
            'valignCentre',
            'left'
          ]);
        }
      };
    };
    var fallback = function () {
      return nu$8(0, 0, {});
    };

    var nu$9 = function (x) {
      return x;
    };

    var onDirection = function (isLtr, isRtl) {
      return function (element) {
        return getDirection(element) === 'rtl' ? isRtl : isLtr;
      };
    };
    var getDirection = function (element) {
      return get$5(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';
    };

    var AttributeValue;
    (function (AttributeValue) {
      AttributeValue['TopToBottom'] = 'toptobottom';
      AttributeValue['BottomToTop'] = 'bottomtotop';
    }(AttributeValue || (AttributeValue = {})));
    var Attribute = 'data-alloy-vertical-dir';
    var isBottomToTopDir = function (el) {
      return closest$2(el, function (current) {
        return isElement(current) && get$3(current, 'data-alloy-vertical-dir') === AttributeValue.BottomToTop;
      });
    };

    var schema$1 = function () {
      return optionObjOf('layouts', [
        strict$1('onLtr'),
        strict$1('onRtl'),
        option('onBottomLtr'),
        option('onBottomRtl')
      ]);
    };
    var get$b = function (elem, info, defaultLtr, defaultRtl, defaultBottomLtr, defaultBottomRtl, dirElement) {
      var isBottomToTop = dirElement.map(isBottomToTopDir).getOr(false);
      var customLtr = info.layouts.map(function (ls) {
        return ls.onLtr(elem);
      });
      var customRtl = info.layouts.map(function (ls) {
        return ls.onRtl(elem);
      });
      var ltr = isBottomToTop ? info.layouts.bind(function (ls) {
        return ls.onBottomLtr.map(function (f) {
          return f(elem);
        });
      }).or(customLtr).getOr(defaultBottomLtr) : customLtr.getOr(defaultLtr);
      var rtl = isBottomToTop ? info.layouts.bind(function (ls) {
        return ls.onBottomRtl.map(function (f) {
          return f(elem);
        });
      }).or(customRtl).getOr(defaultBottomRtl) : customRtl.getOr(defaultRtl);
      var f = onDirection(ltr, rtl);
      return f(elem);
    };

    var placement = function (component, anchorInfo, origin) {
      var hotspot = anchorInfo.hotspot;
      var anchorBox = toBox(origin, hotspot.element);
      var layouts = get$b(component.element, anchorInfo, belowOrAbove(), belowOrAboveRtl(), aboveOrBelow(), aboveOrBelowRtl(), Optional.some(anchorInfo.hotspot.element));
      return Optional.some(nu$9({
        anchorBox: anchorBox,
        bubble: anchorInfo.bubble.getOr(fallback()),
        overrides: anchorInfo.overrides,
        layouts: layouts,
        placer: Optional.none()
      }));
    };
    var HotspotAnchor = [
      strict$1('hotspot'),
      option('bubble'),
      defaulted$1('overrides', {}),
      schema$1(),
      output('placement', placement)
    ];

    var placement$1 = function (component, anchorInfo, origin) {
      var pos = translate(origin, anchorInfo.x, anchorInfo.y);
      var anchorBox = bounds$1(pos.left, pos.top, anchorInfo.width, anchorInfo.height);
      var layouts = get$b(component.element, anchorInfo, all$2(), allRtl(), all$2(), allRtl(), Optional.none());
      return Optional.some(nu$9({
        anchorBox: anchorBox,
        bubble: anchorInfo.bubble,
        overrides: anchorInfo.overrides,
        layouts: layouts,
        placer: Optional.none()
      }));
    };
    var MakeshiftAnchor = [
      strict$1('x'),
      strict$1('y'),
      defaulted$1('height', 0),
      defaulted$1('width', 0),
      defaulted$1('bubble', fallback()),
      defaulted$1('overrides', {}),
      schema$1(),
      output('placement', placement$1)
    ];

    var adt$5 = Adt.generate([
      { screen: ['point'] },
      {
        absolute: [
          'point',
          'scrollLeft',
          'scrollTop'
        ]
      }
    ]);
    var toFixed = function (pos) {
      return pos.fold(identity, function (point, scrollLeft, scrollTop) {
        return point.translate(-scrollLeft, -scrollTop);
      });
    };
    var toAbsolute = function (pos) {
      return pos.fold(identity, identity);
    };
    var sum = function (points) {
      return foldl(points, function (b, a) {
        return b.translate(a.left, a.top);
      }, SugarPosition(0, 0));
    };
    var sumAsFixed = function (positions) {
      var points = map(positions, toFixed);
      return sum(points);
    };
    var sumAsAbsolute = function (positions) {
      var points = map(positions, toAbsolute);
      return sum(points);
    };
    var screen = adt$5.screen;
    var absolute$2 = adt$5.absolute;

    var getOffset = function (component, origin, anchorInfo) {
      var win = defaultView(anchorInfo.root).dom;
      var hasSameOwner = function (frame) {
        var frameOwner = owner(frame);
        var compOwner = owner(component.element);
        return eq$1(frameOwner, compOwner);
      };
      return Optional.from(win.frameElement).map(SugarElement.fromDom).filter(hasSameOwner).map(absolute);
    };
    var getRootPoint = function (component, origin, anchorInfo) {
      var doc = owner(component.element);
      var outerScroll = get$9(doc);
      var offset = getOffset(component, origin, anchorInfo).getOr(outerScroll);
      return absolute$2(offset, outerScroll.left, outerScroll.top);
    };

    var capRect = function (left, top, width, height) {
      var newLeft = left, newTop = top, newWidth = width, newHeight = height;
      if (left < 0) {
        newLeft = 0;
        newWidth = width + left;
      }
      if (top < 0) {
        newTop = 0;
        newHeight = height + top;
      }
      var point = screen(SugarPosition(newLeft, newTop));
      return Optional.some(pointed(point, newWidth, newHeight));
    };
    var calcNewAnchor = function (optBox, rootPoint, anchorInfo, origin, elem) {
      return optBox.map(function (box) {
        var points = [
          rootPoint,
          box.point
        ];
        var topLeft = cata$1(origin, function () {
          return sumAsAbsolute(points);
        }, function () {
          return sumAsAbsolute(points);
        }, function () {
          return sumAsFixed(points);
        });
        var anchorBox = rect(topLeft.left, topLeft.top, box.width, box.height);
        var layoutsLtr = anchorInfo.showAbove ? aboveOrBelow() : belowOrAbove();
        var layoutsRtl = anchorInfo.showAbove ? aboveOrBelowRtl() : belowOrAboveRtl();
        var layouts = get$b(elem, anchorInfo, layoutsLtr, layoutsRtl, layoutsLtr, layoutsRtl, Optional.none());
        return nu$9({
          anchorBox: anchorBox,
          bubble: anchorInfo.bubble.getOr(fallback()),
          overrides: anchorInfo.overrides,
          layouts: layouts,
          placer: Optional.none()
        });
      });
    };

    var placement$2 = function (component, anchorInfo, origin) {
      var rootPoint = getRootPoint(component, origin, anchorInfo);
      return anchorInfo.node.filter(inBody).bind(function (target) {
        var rect = target.dom.getBoundingClientRect();
        var nodeBox = capRect(rect.left, rect.top, rect.width, rect.height);
        var elem = anchorInfo.node.getOr(component.element);
        return calcNewAnchor(nodeBox, rootPoint, anchorInfo, origin, elem);
      });
    };
    var NodeAnchor = [
      strict$1('node'),
      strict$1('root'),
      option('bubble'),
      schema$1(),
      defaulted$1('overrides', {}),
      defaulted$1('showAbove', false),
      output('placement', placement$2)
    ];

    var zeroWidth = '\uFEFF';
    var nbsp = '\xA0';

    var create$2 = function (start, soffset, finish, foffset) {
      return {
        start: start,
        soffset: soffset,
        finish: finish,
        foffset: foffset
      };
    };
    var SimRange = { create: create$2 };

    var adt$6 = Adt.generate([
      { before: ['element'] },
      {
        on: [
          'element',
          'offset'
        ]
      },
      { after: ['element'] }
    ]);
    var cata$2 = function (subject, onBefore, onOn, onAfter) {
      return subject.fold(onBefore, onOn, onAfter);
    };
    var getStart = function (situ) {
      return situ.fold(identity, identity, identity);
    };
    var before$2 = adt$6.before;
    var on = adt$6.on;
    var after$1 = adt$6.after;
    var Situ = {
      before: before$2,
      on: on,
      after: after$1,
      cata: cata$2,
      getStart: getStart
    };

    var adt$7 = Adt.generate([
      { domRange: ['rng'] },
      {
        relative: [
          'startSitu',
          'finishSitu'
        ]
      },
      {
        exact: [
          'start',
          'soffset',
          'finish',
          'foffset'
        ]
      }
    ]);
    var exactFromRange = function (simRange) {
      return adt$7.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);
    };
    var getStart$1 = function (selection) {
      return selection.match({
        domRange: function (rng) {
          return SugarElement.fromDom(rng.startContainer);
        },
        relative: function (startSitu, _finishSitu) {
          return Situ.getStart(startSitu);
        },
        exact: function (start, _soffset, _finish, _foffset) {
          return start;
        }
      });
    };
    var domRange = adt$7.domRange;
    var relative$1 = adt$7.relative;
    var exact = adt$7.exact;
    var getWin = function (selection) {
      var start = getStart$1(selection);
      return defaultView(start);
    };
    var range$1 = SimRange.create;
    var SimSelection = {
      domRange: domRange,
      relative: relative$1,
      exact: exact,
      exactFromRange: exactFromRange,
      getWin: getWin,
      range: range$1
    };

    var setStart = function (rng, situ) {
      situ.fold(function (e) {
        rng.setStartBefore(e.dom);
      }, function (e, o) {
        rng.setStart(e.dom, o);
      }, function (e) {
        rng.setStartAfter(e.dom);
      });
    };
    var setFinish = function (rng, situ) {
      situ.fold(function (e) {
        rng.setEndBefore(e.dom);
      }, function (e, o) {
        rng.setEnd(e.dom, o);
      }, function (e) {
        rng.setEndAfter(e.dom);
      });
    };
    var relativeToNative = function (win, startSitu, finishSitu) {
      var range = win.document.createRange();
      setStart(range, startSitu);
      setFinish(range, finishSitu);
      return range;
    };
    var exactToNative = function (win, start, soffset, finish, foffset) {
      var rng = win.document.createRange();
      rng.setStart(start.dom, soffset);
      rng.setEnd(finish.dom, foffset);
      return rng;
    };
    var toRect = function (rect) {
      return {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height
      };
    };
    var getFirstRect = function (rng) {
      var rects = rng.getClientRects();
      var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();
      return rect.width > 0 || rect.height > 0 ? Optional.some(rect).map(toRect) : Optional.none();
    };

    var adt$8 = Adt.generate([
      {
        ltr: [
          'start',
          'soffset',
          'finish',
          'foffset'
        ]
      },
      {
        rtl: [
          'start',
          'soffset',
          'finish',
          'foffset'
        ]
      }
    ]);
    var fromRange = function (win, type, range) {
      return type(SugarElement.fromDom(range.startContainer), range.startOffset, SugarElement.fromDom(range.endContainer), range.endOffset);
    };
    var getRanges = function (win, selection) {
      return selection.match({
        domRange: function (rng) {
          return {
            ltr: constant(rng),
            rtl: Optional.none
          };
        },
        relative: function (startSitu, finishSitu) {
          return {
            ltr: cached(function () {
              return relativeToNative(win, startSitu, finishSitu);
            }),
            rtl: cached(function () {
              return Optional.some(relativeToNative(win, finishSitu, startSitu));
            })
          };
        },
        exact: function (start, soffset, finish, foffset) {
          return {
            ltr: cached(function () {
              return exactToNative(win, start, soffset, finish, foffset);
            }),
            rtl: cached(function () {
              return Optional.some(exactToNative(win, finish, foffset, start, soffset));
            })
          };
        }
      });
    };
    var doDiagnose = function (win, ranges) {
      var rng = ranges.ltr();
      if (rng.collapsed) {
        var reversed = ranges.rtl().filter(function (rev) {
          return rev.collapsed === false;
        });
        return reversed.map(function (rev) {
          return adt$8.rtl(SugarElement.fromDom(rev.endContainer), rev.endOffset, SugarElement.fromDom(rev.startContainer), rev.startOffset);
        }).getOrThunk(function () {
          return fromRange(win, adt$8.ltr, rng);
        });
      } else {
        return fromRange(win, adt$8.ltr, rng);
      }
    };
    var diagnose = function (win, selection) {
      var ranges = getRanges(win, selection);
      return doDiagnose(win, ranges);
    };
    var asLtrRange = function (win, selection) {
      var diagnosis = diagnose(win, selection);
      return diagnosis.match({
        ltr: function (start, soffset, finish, foffset) {
          var rng = win.document.createRange();
          rng.setStart(start.dom, soffset);
          rng.setEnd(finish.dom, foffset);
          return rng;
        },
        rtl: function (start, soffset, finish, foffset) {
          var rng = win.document.createRange();
          rng.setStart(finish.dom, foffset);
          rng.setEnd(start.dom, soffset);
          return rng;
        }
      });
    };
    var ltr = adt$8.ltr;
    var rtl = adt$8.rtl;

    var NodeValue = function (is, name) {
      var get = function (element) {
        if (!is(element)) {
          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');
        }
        return getOption(element).getOr('');
      };
      var getOption = function (element) {
        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();
      };
      var set = function (element, value) {
        if (!is(element)) {
          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');
        }
        element.dom.nodeValue = value;
      };
      return {
        get: get,
        getOption: getOption,
        set: set
      };
    };

    var api$2 = NodeValue(isText, 'text');
    var get$c = function (element) {
      return api$2.get(element);
    };
    var getOption = function (element) {
      return api$2.getOption(element);
    };

    var getEnd = function (element) {
      return name(element) === 'img' ? 1 : getOption(element).fold(function () {
        return children(element).length;
      }, function (v) {
        return v.length;
      });
    };
    var isTextNodeWithCursorPosition = function (el) {
      return getOption(el).filter(function (text) {
        return text.trim().length !== 0 || text.indexOf(nbsp) > -1;
      }).isSome();
    };
    var elementsWithCursorPosition = [
      'img',
      'br'
    ];
    var isCursorPosition = function (elem) {
      var hasCursorPosition = isTextNodeWithCursorPosition(elem);
      return hasCursorPosition || contains(elementsWithCursorPosition, name(elem));
    };

    var last$1 = function (element) {
      return descendantRtl(element, isCursorPosition);
    };
    var descendantRtl = function (scope, predicate) {
      var descend = function (element) {
        var children$1 = children(element);
        for (var i = children$1.length - 1; i >= 0; i--) {
          var child = children$1[i];
          if (predicate(child)) {
            return Optional.some(child);
          }
          var res = descend(child);
          if (res.isSome()) {
            return res;
          }
        }
        return Optional.none();
      };
      return descend(scope);
    };

    var descendants = function (scope, selector) {
      return all(selector, scope);
    };

    var makeRange = function (start, soffset, finish, foffset) {
      var doc = owner(start);
      var rng = doc.dom.createRange();
      rng.setStart(start.dom, soffset);
      rng.setEnd(finish.dom, foffset);
      return rng;
    };
    var after$2 = function (start, soffset, finish, foffset) {
      var r = makeRange(start, soffset, finish, foffset);
      var same = eq$1(start, finish) && soffset === foffset;
      return r.collapsed && !same;
    };

    var getNativeSelection = function (win) {
      return Optional.from(win.getSelection());
    };
    var readRange = function (selection) {
      if (selection.rangeCount > 0) {
        var firstRng = selection.getRangeAt(0);
        var lastRng = selection.getRangeAt(selection.rangeCount - 1);
        return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer), firstRng.startOffset, SugarElement.fromDom(lastRng.endContainer), lastRng.endOffset));
      } else {
        return Optional.none();
      }
    };
    var doGetExact = function (selection) {
      if (selection.anchorNode === null || selection.focusNode === null) {
        return readRange(selection);
      } else {
        var anchor = SugarElement.fromDom(selection.anchorNode);
        var focus_1 = SugarElement.fromDom(selection.focusNode);
        return after$2(anchor, selection.anchorOffset, focus_1, selection.focusOffset) ? Optional.some(SimRange.create(anchor, selection.anchorOffset, focus_1, selection.focusOffset)) : readRange(selection);
      }
    };
    var getExact = function (win) {
      return getNativeSelection(win).filter(function (sel) {
        return sel.rangeCount > 0;
      }).bind(doGetExact);
    };
    var getFirstRect$1 = function (win, selection) {
      var rng = asLtrRange(win, selection);
      return getFirstRect(rng);
    };

    var point = function (element, offset) {
      return {
        element: element,
        offset: offset
      };
    };
    var descendOnce = function (element, offset) {
      var children$1 = children(element);
      if (children$1.length === 0) {
        return point(element, offset);
      } else if (offset < children$1.length) {
        return point(children$1[offset], 0);
      } else {
        var last = children$1[children$1.length - 1];
        var len = isText(last) ? get$c(last).length : children(last).length;
        return point(last, len);
      }
    };

    var descendOnce$1 = function (element, offset) {
      return isText(element) ? point(element, offset) : descendOnce(element, offset);
    };
    var getAnchorSelection = function (win, anchorInfo) {
      var getSelection = anchorInfo.getSelection.getOrThunk(function () {
        return function () {
          return getExact(win);
        };
      });
      return getSelection().map(function (sel) {
        var modStart = descendOnce$1(sel.start, sel.soffset);
        var modFinish = descendOnce$1(sel.finish, sel.foffset);
        return SimSelection.range(modStart.element, modStart.offset, modFinish.element, modFinish.offset);
      });
    };
    var placement$3 = function (component, anchorInfo, origin) {
      var win = defaultView(anchorInfo.root).dom;
      var rootPoint = getRootPoint(component, origin, anchorInfo);
      var selectionBox = getAnchorSelection(win, anchorInfo).bind(function (sel) {
        var optRect = getFirstRect$1(win, SimSelection.exactFromRange(sel)).orThunk(function () {
          var x = SugarElement.fromText(zeroWidth);
          before(sel.start, x);
          return getFirstRect$1(win, SimSelection.exact(x, 0, x, 1)).map(function (rect) {
            remove(x);
            return rect;
          });
        });
        return optRect.bind(function (rawRect) {
          return capRect(rawRect.left, rawRect.top, rawRect.width, rawRect.height);
        });
      });
      var targetElement = getAnchorSelection(win, anchorInfo).bind(function (sel) {
        return isElement(sel.start) ? Optional.some(sel.start) : parentNode(sel.start);
      });
      var elem = targetElement.getOr(component.element);
      return calcNewAnchor(selectionBox, rootPoint, anchorInfo, origin, elem);
    };
    var SelectionAnchor = [
      option('getSelection'),
      strict$1('root'),
      option('bubble'),
      schema$1(),
      defaulted$1('overrides', {}),
      defaulted$1('showAbove', false),
      output('placement', placement$3)
    ];

    var eastX$1 = function (anchor) {
      return anchor.x + anchor.width;
    };
    var westX$1 = function (anchor, element) {
      return anchor.x - element.width;
    };
    var northY$1 = function (anchor, element) {
      return anchor.y - element.height + anchor.height;
    };
    var southY$1 = function (anchor) {
      return anchor.y;
    };
    var southeast$2 = function (anchor, element, bubbles) {
      return nu$7(eastX$1(anchor), southY$1(anchor), bubbles.southeast(), southeast(), boundsRestriction(anchor, {
        left: 0,
        top: 2
      }), 'link-layout-se');
    };
    var southwest$2 = function (anchor, element, bubbles) {
      return nu$7(westX$1(anchor, element), southY$1(anchor), bubbles.southwest(), southwest(), boundsRestriction(anchor, {
        right: 1,
        top: 2
      }), 'link-layout-sw');
    };
    var northeast$2 = function (anchor, element, bubbles) {
      return nu$7(eastX$1(anchor), northY$1(anchor, element), bubbles.northeast(), northeast(), boundsRestriction(anchor, {
        left: 0,
        bottom: 3
      }), 'link-layout-ne');
    };
    var northwest$2 = function (anchor, element, bubbles) {
      return nu$7(westX$1(anchor, element), northY$1(anchor, element), bubbles.northwest(), northwest(), boundsRestriction(anchor, {
        right: 1,
        bottom: 3
      }), 'link-layout-nw');
    };
    var all$3 = function () {
      return [
        southeast$2,
        southwest$2,
        northeast$2,
        northwest$2
      ];
    };
    var allRtl$1 = function () {
      return [
        southwest$2,
        southeast$2,
        northwest$2,
        northeast$2
      ];
    };

    var placement$4 = function (component, submenuInfo, origin) {
      var anchorBox = toBox(origin, submenuInfo.item.element);
      var layouts = get$b(component.element, submenuInfo, all$3(), allRtl$1(), all$3(), allRtl$1(), Optional.none());
      return Optional.some(nu$9({
        anchorBox: anchorBox,
        bubble: fallback(),
        overrides: submenuInfo.overrides,
        layouts: layouts,
        placer: Optional.none()
      }));
    };
    var SubmenuAnchor = [
      strict$1('item'),
      schema$1(),
      defaulted$1('overrides', {}),
      output('placement', placement$4)
    ];

    var AnchorSchema = choose$1('anchor', {
      selection: SelectionAnchor,
      node: NodeAnchor,
      hotspot: HotspotAnchor,
      submenu: SubmenuAnchor,
      makeshift: MakeshiftAnchor
    });

    var getFixedOrigin = function () {
      var html = document.documentElement;
      return fixed(0, 0, html.clientWidth, html.clientHeight);
    };
    var getRelativeOrigin = function (component) {
      var position = absolute(component.element);
      var bounds = component.element.dom.getBoundingClientRect();
      return relative(position.left, position.top, bounds.width, bounds.height);
    };
    var place = function (component, origin, anchoring, getBounds, placee) {
      var anchor = box$1(anchoring.anchorBox, origin);
      simple(anchor, placee.element, anchoring.bubble, anchoring.layouts, getBounds, anchoring.overrides);
    };
    var position$1 = function (component, posConfig, posState, anchor, placee) {
      positionWithin(component, posConfig, posState, anchor, placee, Optional.none());
    };
    var positionWithin = function (component, posConfig, posState, anchor, placee, boxElement) {
      var boundsBox = boxElement.map(box);
      return positionWithinBounds(component, posConfig, posState, anchor, placee, boundsBox);
    };
    var positionWithinBounds = function (component, posConfig, posState, anchor, placee, bounds) {
      var anchorage = asRawOrDie('positioning anchor.info', AnchorSchema, anchor);
      preserve(function () {
        set$2(placee.element, 'position', 'fixed');
        var oldVisibility = getRaw(placee.element, 'visibility');
        set$2(placee.element, 'visibility', 'hidden');
        var origin = posConfig.useFixed() ? getFixedOrigin() : getRelativeOrigin(component);
        var placer = anchorage.placement;
        var getBounds = bounds.map(constant).or(posConfig.getBounds);
        placer(component, anchorage, origin).each(function (anchoring) {
          var doPlace = anchoring.placer.getOr(place);
          doPlace(component, origin, anchoring, getBounds, placee);
        });
        oldVisibility.fold(function () {
          remove$6(placee.element, 'visibility');
        }, function (vis) {
          set$2(placee.element, 'visibility', vis);
        });
        if (getRaw(placee.element, 'left').isNone() && getRaw(placee.element, 'top').isNone() && getRaw(placee.element, 'right').isNone() && getRaw(placee.element, 'bottom').isNone() && getRaw(placee.element, 'position').is('fixed')) {
          remove$6(placee.element, 'position');
        }
      }, placee.element);
    };
    var getMode = function (component, pConfig, _pState) {
      return pConfig.useFixed() ? 'fixed' : 'absolute';
    };

    var PositionApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        position: position$1,
        positionWithin: positionWithin,
        positionWithinBounds: positionWithinBounds,
        getMode: getMode
    });

    var PositionSchema = [
      defaulted$1('useFixed', never),
      option('getBounds')
    ];

    var Positioning = create$1({
      fields: PositionSchema,
      name: 'positioning',
      active: ActivePosition,
      apis: PositionApis
    });

    var fireDetaching = function (component) {
      emit(component, detachedFromDom());
      var children = component.components();
      each(children, fireDetaching);
    };
    var fireAttaching = function (component) {
      var children = component.components();
      each(children, fireAttaching);
      emit(component, attachedToDom());
    };
    var attach = function (parent, child) {
      append(parent.element, child.element);
    };
    var detachChildren = function (component) {
      each(component.components(), function (childComp) {
        return remove(childComp.element);
      });
      empty(component.element);
      component.syncComponents();
    };
    var replaceChildren = function (component, newChildren) {
      var subs = component.components();
      detachChildren(component);
      var deleted = difference(subs, newChildren);
      each(deleted, function (comp) {
        fireDetaching(comp);
        component.getSystem().removeFromWorld(comp);
      });
      each(newChildren, function (childComp) {
        if (!childComp.getSystem().isConnected()) {
          component.getSystem().addToWorld(childComp);
          attach(component, childComp);
          if (inBody(component.element)) {
            fireAttaching(childComp);
          }
        } else {
          attach(component, childComp);
        }
        component.syncComponents();
      });
    };

    var attach$1 = function (parent, child) {
      attachWith(parent, child, append);
    };
    var attachWith = function (parent, child, insertion) {
      parent.getSystem().addToWorld(child);
      insertion(parent.element, child.element);
      if (inBody(parent.element)) {
        fireAttaching(child);
      }
      parent.syncComponents();
    };
    var doDetach = function (component) {
      fireDetaching(component);
      remove(component.element);
      component.getSystem().removeFromWorld(component);
    };
    var detach = function (component) {
      var parent$1 = parent(component.element).bind(function (p) {
        return component.getSystem().getByDom(p).toOptional();
      });
      doDetach(component);
      parent$1.each(function (p) {
        p.syncComponents();
      });
    };
    var detachChildren$1 = function (component) {
      var subs = component.components();
      each(subs, doDetach);
      empty(component.element);
      component.syncComponents();
    };
    var attachSystem = function (element, guiSystem) {
      attachSystemWith(element, guiSystem, append);
    };
    var attachSystemAfter = function (element, guiSystem) {
      attachSystemWith(element, guiSystem, after);
    };
    var attachSystemWith = function (element, guiSystem, inserter) {
      inserter(element, guiSystem.element);
      var children$1 = children(guiSystem.element);
      each(children$1, function (child) {
        guiSystem.getByDom(child).each(fireAttaching);
      });
    };
    var detachSystem = function (guiSystem) {
      var children$1 = children(guiSystem.element);
      each(children$1, function (child) {
        guiSystem.getByDom(child).each(fireDetaching);
      });
      remove(guiSystem.element);
    };

    var rebuild = function (sandbox, sConfig, sState, data) {
      sState.get().each(function (_data) {
        detachChildren$1(sandbox);
      });
      var point = sConfig.getAttachPoint(sandbox);
      attach$1(point, sandbox);
      var built = sandbox.getSystem().build(data);
      attach$1(sandbox, built);
      sState.set(built);
      return built;
    };
    var open = function (sandbox, sConfig, sState, data) {
      var newState = rebuild(sandbox, sConfig, sState, data);
      sConfig.onOpen(sandbox, newState);
      return newState;
    };
    var setContent = function (sandbox, sConfig, sState, data) {
      return sState.get().map(function () {
        return rebuild(sandbox, sConfig, sState, data);
      });
    };
    var openWhileCloaked = function (sandbox, sConfig, sState, data, transaction) {
      cloak(sandbox, sConfig);
      open(sandbox, sConfig, sState, data);
      transaction();
      decloak(sandbox, sConfig);
    };
    var close = function (sandbox, sConfig, sState) {
      sState.get().each(function (data) {
        detachChildren$1(sandbox);
        detach(sandbox);
        sConfig.onClose(sandbox, data);
        sState.clear();
      });
    };
    var isOpen = function (_sandbox, _sConfig, sState) {
      return sState.isOpen();
    };
    var isPartOf$1 = function (sandbox, sConfig, sState, queryElem) {
      return isOpen(sandbox, sConfig, sState) && sState.get().exists(function (data) {
        return sConfig.isPartOf(sandbox, data, queryElem);
      });
    };
    var getState = function (_sandbox, _sConfig, sState) {
      return sState.get();
    };
    var store = function (sandbox, cssKey, attr, newValue) {
      getRaw(sandbox.element, cssKey).fold(function () {
        remove$1(sandbox.element, attr);
      }, function (v) {
        set$1(sandbox.element, attr, v);
      });
      set$2(sandbox.element, cssKey, newValue);
    };
    var restore = function (sandbox, cssKey, attr) {
      getOpt(sandbox.element, attr).fold(function () {
        return remove$6(sandbox.element, cssKey);
      }, function (oldValue) {
        return set$2(sandbox.element, cssKey, oldValue);
      });
    };
    var cloak = function (sandbox, sConfig, _sState) {
      var sink = sConfig.getAttachPoint(sandbox);
      set$2(sandbox.element, 'position', Positioning.getMode(sink));
      store(sandbox, 'visibility', sConfig.cloakVisibilityAttr, 'hidden');
    };
    var hasPosition = function (element) {
      return exists([
        'top',
        'left',
        'right',
        'bottom'
      ], function (pos) {
        return getRaw(element, pos).isSome();
      });
    };
    var decloak = function (sandbox, sConfig, _sState) {
      if (!hasPosition(sandbox.element)) {
        remove$6(sandbox.element, 'position');
      }
      restore(sandbox, 'visibility', sConfig.cloakVisibilityAttr);
    };

    var SandboxApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        cloak: cloak,
        decloak: decloak,
        open: open,
        openWhileCloaked: openWhileCloaked,
        close: close,
        isOpen: isOpen,
        isPartOf: isPartOf$1,
        getState: getState,
        setContent: setContent
    });

    var events$2 = function (sandboxConfig, sandboxState) {
      return derive([run(sandboxClose(), function (sandbox, _simulatedEvent) {
          close(sandbox, sandboxConfig, sandboxState);
        })]);
    };

    var ActiveSandbox = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$2
    });

    var SandboxSchema = [
      onHandler('onOpen'),
      onHandler('onClose'),
      strict$1('isPartOf'),
      strict$1('getAttachPoint'),
      defaulted$1('cloakVisibilityAttr', 'data-precloak-visibility')
    ];

    var init = function () {
      var contents = Cell(Optional.none());
      var readState = constant('not-implemented');
      var isOpen = function () {
        return contents.get().isSome();
      };
      var set = function (comp) {
        contents.set(Optional.some(comp));
      };
      var get = function () {
        return contents.get();
      };
      var clear = function () {
        contents.set(Optional.none());
      };
      return nu$5({
        readState: readState,
        isOpen: isOpen,
        clear: clear,
        set: set,
        get: get
      });
    };

    var SandboxState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init
    });

    var Sandboxing = create$1({
      fields: SandboxSchema,
      name: 'sandboxing',
      active: ActiveSandbox,
      apis: SandboxApis,
      state: SandboxState
    });

    var dismissPopups = constant('dismiss.popups');
    var repositionPopups = constant('reposition.popups');
    var mouseReleased = constant('mouse.released');

    var schema$2 = objOfOnly([
      defaulted$1('isExtraPart', never),
      optionObjOf('fireEventInstead', [defaulted$1('event', dismissRequested())])
    ]);
    var receivingChannel = function (rawSpec) {
      var _a;
      var detail = asRawOrDie('Dismissal', schema$2, rawSpec);
      return _a = {}, _a[dismissPopups()] = {
        schema: objOfOnly([strict$1('target')]),
        onReceive: function (sandbox, data) {
          if (Sandboxing.isOpen(sandbox)) {
            var isPart = Sandboxing.isPartOf(sandbox, data.target) || detail.isExtraPart(sandbox, data.target);
            if (!isPart) {
              detail.fireEventInstead.fold(function () {
                return Sandboxing.close(sandbox);
              }, function (fe) {
                return emit(sandbox, fe.event);
              });
            }
          }
        }
      }, _a;
    };

    var schema$3 = objOfOnly([
      optionObjOf('fireEventInstead', [defaulted$1('event', repositionRequested())]),
      strictFunction('doReposition')
    ]);
    var receivingChannel$1 = function (rawSpec) {
      var _a;
      var detail = asRawOrDie('Reposition', schema$3, rawSpec);
      return _a = {}, _a[repositionPopups()] = {
        onReceive: function (sandbox) {
          if (Sandboxing.isOpen(sandbox)) {
            detail.fireEventInstead.fold(function () {
              return detail.doReposition(sandbox);
            }, function (fe) {
              return emit(sandbox, fe.event);
            });
          }
        }
      }, _a;
    };

    var onLoad = function (component, repConfig, repState) {
      repConfig.store.manager.onLoad(component, repConfig, repState);
    };
    var onUnload = function (component, repConfig, repState) {
      repConfig.store.manager.onUnload(component, repConfig, repState);
    };
    var setValue = function (component, repConfig, repState, data) {
      repConfig.store.manager.setValue(component, repConfig, repState, data);
    };
    var getValue = function (component, repConfig, repState) {
      return repConfig.store.manager.getValue(component, repConfig, repState);
    };
    var getState$1 = function (component, repConfig, repState) {
      return repState;
    };

    var RepresentApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        onLoad: onLoad,
        onUnload: onUnload,
        setValue: setValue,
        getValue: getValue,
        getState: getState$1
    });

    var events$3 = function (repConfig, repState) {
      var es = repConfig.resetOnDom ? [
        runOnAttached(function (comp, _se) {
          onLoad(comp, repConfig, repState);
        }),
        runOnDetached(function (comp, _se) {
          onUnload(comp, repConfig, repState);
        })
      ] : [loadEvent(repConfig, repState, onLoad)];
      return derive(es);
    };

    var ActiveRepresenting = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$3
    });

    var memory = function () {
      var data = Cell(null);
      var readState = function () {
        return {
          mode: 'memory',
          value: data.get()
        };
      };
      var isNotSet = function () {
        return data.get() === null;
      };
      var clear = function () {
        data.set(null);
      };
      return nu$5({
        set: data.set,
        get: data.get,
        isNotSet: isNotSet,
        clear: clear,
        readState: readState
      });
    };
    var manual = function () {
      var readState = noop;
      return nu$5({ readState: readState });
    };
    var dataset = function () {
      var dataByValue = Cell({});
      var dataByText = Cell({});
      var readState = function () {
        return {
          mode: 'dataset',
          dataByValue: dataByValue.get(),
          dataByText: dataByText.get()
        };
      };
      var clear = function () {
        dataByValue.set({});
        dataByText.set({});
      };
      var lookup = function (itemString) {
        return get$1(dataByValue.get(), itemString).orThunk(function () {
          return get$1(dataByText.get(), itemString);
        });
      };
      var update = function (items) {
        var currentDataByValue = dataByValue.get();
        var currentDataByText = dataByText.get();
        var newDataByValue = {};
        var newDataByText = {};
        each(items, function (item) {
          newDataByValue[item.value] = item;
          get$1(item, 'meta').each(function (meta) {
            get$1(meta, 'text').each(function (text) {
              newDataByText[text] = item;
            });
          });
        });
        dataByValue.set(__assign(__assign({}, currentDataByValue), newDataByValue));
        dataByText.set(__assign(__assign({}, currentDataByText), newDataByText));
      };
      return nu$5({
        readState: readState,
        lookup: lookup,
        update: update,
        clear: clear
      });
    };
    var init$1 = function (spec) {
      return spec.store.manager.state(spec);
    };

    var RepresentState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        memory: memory,
        dataset: dataset,
        manual: manual,
        init: init$1
    });

    var setValue$1 = function (component, repConfig, repState, data) {
      var store = repConfig.store;
      repState.update([data]);
      store.setValue(component, data);
      repConfig.onSetValue(component, data);
    };
    var getValue$1 = function (component, repConfig, repState) {
      var store = repConfig.store;
      var key = store.getDataKey(component);
      return repState.lookup(key).fold(function () {
        return store.getFallbackEntry(key);
      }, function (data) {
        return data;
      });
    };
    var onLoad$1 = function (component, repConfig, repState) {
      var store = repConfig.store;
      store.initialValue.each(function (data) {
        setValue$1(component, repConfig, repState, data);
      });
    };
    var onUnload$1 = function (component, repConfig, repState) {
      repState.clear();
    };
    var DatasetStore = [
      option('initialValue'),
      strict$1('getFallbackEntry'),
      strict$1('getDataKey'),
      strict$1('setValue'),
      output('manager', {
        setValue: setValue$1,
        getValue: getValue$1,
        onLoad: onLoad$1,
        onUnload: onUnload$1,
        state: dataset
      })
    ];

    var getValue$2 = function (component, repConfig, _repState) {
      return repConfig.store.getValue(component);
    };
    var setValue$2 = function (component, repConfig, _repState, data) {
      repConfig.store.setValue(component, data);
      repConfig.onSetValue(component, data);
    };
    var onLoad$2 = function (component, repConfig, _repState) {
      repConfig.store.initialValue.each(function (data) {
        repConfig.store.setValue(component, data);
      });
    };
    var ManualStore = [
      strict$1('getValue'),
      defaulted$1('setValue', noop),
      option('initialValue'),
      output('manager', {
        setValue: setValue$2,
        getValue: getValue$2,
        onLoad: onLoad$2,
        onUnload: noop,
        state: NoState.init
      })
    ];

    var setValue$3 = function (component, repConfig, repState, data) {
      repState.set(data);
      repConfig.onSetValue(component, data);
    };
    var getValue$3 = function (component, repConfig, repState) {
      return repState.get();
    };
    var onLoad$3 = function (component, repConfig, repState) {
      repConfig.store.initialValue.each(function (initVal) {
        if (repState.isNotSet()) {
          repState.set(initVal);
        }
      });
    };
    var onUnload$2 = function (component, repConfig, repState) {
      repState.clear();
    };
    var MemoryStore = [
      option('initialValue'),
      output('manager', {
        setValue: setValue$3,
        getValue: getValue$3,
        onLoad: onLoad$3,
        onUnload: onUnload$2,
        state: memory
      })
    ];

    var RepresentSchema = [
      defaultedOf('store', { mode: 'memory' }, choose$1('mode', {
        memory: MemoryStore,
        manual: ManualStore,
        dataset: DatasetStore
      })),
      onHandler('onSetValue'),
      defaulted$1('resetOnDom', false)
    ];

    var Representing = create$1({
      fields: RepresentSchema,
      name: 'representing',
      active: ActiveRepresenting,
      apis: RepresentApis,
      extra: {
        setValueFrom: function (component, source) {
          var value = Representing.getValue(source);
          Representing.setValue(component, value);
        }
      },
      state: RepresentState
    });

    var field$1 = function (name, forbidden) {
      return defaultedObjOf(name, {}, map(forbidden, function (f) {
        return forbid(f.name(), 'Cannot configure ' + f.name() + ' for ' + name);
      }).concat([state$1('dump', identity)]));
    };
    var get$d = function (data) {
      return data.dump;
    };
    var augment = function (data, original) {
      return __assign(__assign({}, data.dump), derive$1(original));
    };
    var SketchBehaviours = {
      field: field$1,
      augment: augment,
      get: get$d
    };

    var _placeholder = 'placeholder';
    var adt$9 = Adt.generate([
      {
        single: [
          'required',
          'valueThunk'
        ]
      },
      {
        multiple: [
          'required',
          'valueThunks'
        ]
      }
    ]);
    var isSubstituted = function (spec) {
      return has(spec, 'uiType');
    };
    var subPlaceholder = function (owner, detail, compSpec, placeholders) {
      if (owner.exists(function (o) {
          return o !== compSpec.owner;
        })) {
        return adt$9.single(true, constant(compSpec));
      }
      return get$1(placeholders, compSpec.name).fold(function () {
        throw new Error('Unknown placeholder component: ' + compSpec.name + '\nKnown: [' + keys(placeholders) + ']\nNamespace: ' + owner.getOr('none') + '\nSpec: ' + JSON.stringify(compSpec, null, 2));
      }, function (newSpec) {
        return newSpec.replace();
      });
    };
    var scan = function (owner, detail, compSpec, placeholders) {
      if (isSubstituted(compSpec) && compSpec.uiType === _placeholder) {
        return subPlaceholder(owner, detail, compSpec, placeholders);
      } else {
        return adt$9.single(false, constant(compSpec));
      }
    };
    var substitute = function (owner, detail, compSpec, placeholders) {
      var base = scan(owner, detail, compSpec, placeholders);
      return base.fold(function (req, valueThunk) {
        var value = isSubstituted(compSpec) ? valueThunk(detail, compSpec.config, compSpec.validated) : valueThunk(detail);
        var childSpecs = get$1(value, 'components').getOr([]);
        var substituted = bind(childSpecs, function (c) {
          return substitute(owner, detail, c, placeholders);
        });
        return [__assign(__assign({}, value), { components: substituted })];
      }, function (req, valuesThunk) {
        if (isSubstituted(compSpec)) {
          var values = valuesThunk(detail, compSpec.config, compSpec.validated);
          var preprocessor = compSpec.validated.preprocess.getOr(identity);
          return preprocessor(values);
        } else {
          return valuesThunk(detail);
        }
      });
    };
    var substituteAll = function (owner, detail, components, placeholders) {
      return bind(components, function (c) {
        return substitute(owner, detail, c, placeholders);
      });
    };
    var oneReplace = function (label, replacements) {
      var called = false;
      var used = function () {
        return called;
      };
      var replace = function () {
        if (called) {
          throw new Error('Trying to use the same placeholder more than once: ' + label);
        }
        called = true;
        return replacements;
      };
      var required = function () {
        return replacements.fold(function (req, _) {
          return req;
        }, function (req, _) {
          return req;
        });
      };
      return {
        name: constant(label),
        required: required,
        used: used,
        replace: replace
      };
    };
    var substitutePlaces = function (owner, detail, components, placeholders) {
      var ps = map$2(placeholders, function (ph, name) {
        return oneReplace(name, ph);
      });
      var outcome = substituteAll(owner, detail, components, ps);
      each$1(ps, function (p) {
        if (p.used() === false && p.required()) {
          throw new Error('Placeholder: ' + p.name() + ' was not found in components list\nNamespace: ' + owner.getOr('none') + '\nComponents: ' + JSON.stringify(detail.components, null, 2));
        }
      });
      return outcome;
    };
    var single = adt$9.single;
    var multiple = adt$9.multiple;
    var placeholder = constant(_placeholder);

    var adt$a = Adt.generate([
      { required: ['data'] },
      { external: ['data'] },
      { optional: ['data'] },
      { group: ['data'] }
    ]);
    var fFactory = defaulted$1('factory', { sketch: identity });
    var fSchema = defaulted$1('schema', []);
    var fName = strict$1('name');
    var fPname = field('pname', 'pname', defaultedThunk(function (typeSpec) {
      return '<alloy.' + generate$1(typeSpec.name) + '>';
    }), anyValue$1());
    var fGroupSchema = state$1('schema', function () {
      return [option('preprocess')];
    });
    var fDefaults = defaulted$1('defaults', constant({}));
    var fOverrides = defaulted$1('overrides', constant({}));
    var requiredSpec = objOf([
      fFactory,
      fSchema,
      fName,
      fPname,
      fDefaults,
      fOverrides
    ]);
    var externalSpec = objOf([
      fFactory,
      fSchema,
      fName,
      fDefaults,
      fOverrides
    ]);
    var optionalSpec = objOf([
      fFactory,
      fSchema,
      fName,
      fPname,
      fDefaults,
      fOverrides
    ]);
    var groupSpec = objOf([
      fFactory,
      fGroupSchema,
      fName,
      strict$1('unit'),
      fPname,
      fDefaults,
      fOverrides
    ]);
    var asNamedPart = function (part) {
      return part.fold(Optional.some, Optional.none, Optional.some, Optional.some);
    };
    var name$1 = function (part) {
      var get = function (data) {
        return data.name;
      };
      return part.fold(get, get, get, get);
    };
    var asCommon = function (part) {
      return part.fold(identity, identity, identity, identity);
    };
    var convert = function (adtConstructor, partSchema) {
      return function (spec) {
        var data = asRawOrDie('Converting part type', partSchema, spec);
        return adtConstructor(data);
      };
    };
    var required = convert(adt$a.required, requiredSpec);
    var external$1 = convert(adt$a.external, externalSpec);
    var optional = convert(adt$a.optional, optionalSpec);
    var group = convert(adt$a.group, groupSpec);
    var original = constant('entirety');

    var PartType = /*#__PURE__*/Object.freeze({
        __proto__: null,
        required: required,
        external: external$1,
        optional: optional,
        group: group,
        asNamedPart: asNamedPart,
        name: name$1,
        asCommon: asCommon,
        original: original
    });

    var combine$2 = function (detail, data, partSpec, partValidated) {
      return deepMerge(data.defaults(detail, partSpec, partValidated), partSpec, { uid: detail.partUids[data.name] }, data.overrides(detail, partSpec, partValidated));
    };
    var subs = function (owner, detail, parts) {
      var internals = {};
      var externals = {};
      each(parts, function (part) {
        part.fold(function (data) {
          internals[data.pname] = single(true, function (detail, partSpec, partValidated) {
            return data.factory.sketch(combine$2(detail, data, partSpec, partValidated));
          });
        }, function (data) {
          var partSpec = detail.parts[data.name];
          externals[data.name] = constant(data.factory.sketch(combine$2(detail, data, partSpec[original()]), partSpec));
        }, function (data) {
          internals[data.pname] = single(false, function (detail, partSpec, partValidated) {
            return data.factory.sketch(combine$2(detail, data, partSpec, partValidated));
          });
        }, function (data) {
          internals[data.pname] = multiple(true, function (detail, _partSpec, _partValidated) {
            var units = detail[data.name];
            return map(units, function (u) {
              return data.factory.sketch(deepMerge(data.defaults(detail, u, _partValidated), u, data.overrides(detail, u)));
            });
          });
        });
      });
      return {
        internals: constant(internals),
        externals: constant(externals)
      };
    };

    var generate$4 = function (owner, parts) {
      var r = {};
      each(parts, function (part) {
        asNamedPart(part).each(function (np) {
          var g = doGenerateOne(owner, np.pname);
          r[np.name] = function (config) {
            var validated = asRawOrDie('Part: ' + np.name + ' in ' + owner, objOf(np.schema), config);
            return __assign(__assign({}, g), {
              config: config,
              validated: validated
            });
          };
        });
      });
      return r;
    };
    var doGenerateOne = function (owner, pname) {
      return {
        uiType: placeholder(),
        owner: owner,
        name: pname
      };
    };
    var generateOne = function (owner, pname, config) {
      return {
        uiType: placeholder(),
        owner: owner,
        name: pname,
        config: config,
        validated: {}
      };
    };
    var schemas = function (parts) {
      return bind(parts, function (part) {
        return part.fold(Optional.none, Optional.some, Optional.none, Optional.none).map(function (data) {
          return strictObjOf(data.name, data.schema.concat([snapshot(original())]));
        }).toArray();
      });
    };
    var names = function (parts) {
      return map(parts, name$1);
    };
    var substitutes = function (owner, detail, parts) {
      return subs(owner, detail, parts);
    };
    var components = function (owner, detail, internals) {
      return substitutePlaces(Optional.some(owner), detail, detail.components, internals);
    };
    var getPart = function (component, detail, partKey) {
      var uid = detail.partUids[partKey];
      return component.getSystem().getByUid(uid).toOptional();
    };
    var getPartOrDie = function (component, detail, partKey) {
      return getPart(component, detail, partKey).getOrDie('Could not find part: ' + partKey);
    };
    var getParts = function (component, detail, partKeys) {
      var r = {};
      var uids = detail.partUids;
      var system = component.getSystem();
      each(partKeys, function (pk) {
        r[pk] = constant(system.getByUid(uids[pk]));
      });
      return r;
    };
    var getAllParts = function (component, detail) {
      var system = component.getSystem();
      return map$2(detail.partUids, function (pUid, _k) {
        return constant(system.getByUid(pUid));
      });
    };
    var getAllPartNames = function (detail) {
      return keys(detail.partUids);
    };
    var getPartsOrDie = function (component, detail, partKeys) {
      var r = {};
      var uids = detail.partUids;
      var system = component.getSystem();
      each(partKeys, function (pk) {
        r[pk] = constant(system.getByUid(uids[pk]).getOrDie());
      });
      return r;
    };
    var defaultUids = function (baseUid, partTypes) {
      var partNames = names(partTypes);
      return wrapAll$1(map(partNames, function (pn) {
        return {
          key: pn,
          value: baseUid + '-' + pn
        };
      }));
    };
    var defaultUidsSchema = function (partTypes) {
      return field('partUids', 'partUids', mergeWithThunk(function (spec) {
        return defaultUids(spec.uid, partTypes);
      }), anyValue$1());
    };

    var AlloyParts = /*#__PURE__*/Object.freeze({
        __proto__: null,
        generate: generate$4,
        generateOne: generateOne,
        schemas: schemas,
        names: names,
        substitutes: substitutes,
        components: components,
        defaultUids: defaultUids,
        defaultUidsSchema: defaultUidsSchema,
        getAllParts: getAllParts,
        getAllPartNames: getAllPartNames,
        getPart: getPart,
        getPartOrDie: getPartOrDie,
        getParts: getParts,
        getPartsOrDie: getPartsOrDie
    });

    var base = function (partSchemas, partUidsSchemas) {
      var ps = partSchemas.length > 0 ? [strictObjOf('parts', partSchemas)] : [];
      return ps.concat([
        strict$1('uid'),
        defaulted$1('dom', {}),
        defaulted$1('components', []),
        snapshot('originalSpec'),
        defaulted$1('debug.sketcher', {})
      ]).concat(partUidsSchemas);
    };
    var asRawOrDie$1 = function (label, schema, spec, partSchemas, partUidsSchemas) {
      var baseS = base(partSchemas, partUidsSchemas);
      return asRawOrDie(label + ' [SpecSchema]', objOfOnly(baseS.concat(schema)), spec);
    };

    var single$1 = function (owner, schema, factory, spec) {
      var specWithUid = supplyUid(spec);
      var detail = asRawOrDie$1(owner, schema, specWithUid, [], []);
      return factory(detail, specWithUid);
    };
    var composite = function (owner, schema, partTypes, factory, spec) {
      var specWithUid = supplyUid(spec);
      var partSchemas = schemas(partTypes);
      var partUidsSchema = defaultUidsSchema(partTypes);
      var detail = asRawOrDie$1(owner, schema, specWithUid, partSchemas, [partUidsSchema]);
      var subs = substitutes(owner, detail, partTypes);
      var components$1 = components(owner, detail, subs.internals());
      return factory(detail, components$1, specWithUid, subs.externals());
    };
    var hasUid = function (spec) {
      return has(spec, 'uid');
    };
    var supplyUid = function (spec) {
      return hasUid(spec) ? spec : __assign(__assign({}, spec), { uid: generate$2('uid') });
    };

    var isSketchSpec = function (spec) {
      return spec.uid !== undefined;
    };
    var singleSchema = objOfOnly([
      strict$1('name'),
      strict$1('factory'),
      strict$1('configFields'),
      defaulted$1('apis', {}),
      defaulted$1('extraApis', {})
    ]);
    var compositeSchema = objOfOnly([
      strict$1('name'),
      strict$1('factory'),
      strict$1('configFields'),
      strict$1('partFields'),
      defaulted$1('apis', {}),
      defaulted$1('extraApis', {})
    ]);
    var single$2 = function (rawConfig) {
      var config = asRawOrDie('Sketcher for ' + rawConfig.name, singleSchema, rawConfig);
      var sketch = function (spec) {
        return single$1(config.name, config.configFields, config.factory, spec);
      };
      var apis = map$2(config.apis, makeApi);
      var extraApis = map$2(config.extraApis, function (f, k) {
        return markAsExtraApi(f, k);
      });
      return __assign(__assign({
        name: config.name,
        configFields: config.configFields,
        sketch: sketch
      }, apis), extraApis);
    };
    var composite$1 = function (rawConfig) {
      var config = asRawOrDie('Sketcher for ' + rawConfig.name, compositeSchema, rawConfig);
      var sketch = function (spec) {
        return composite(config.name, config.configFields, config.partFields, config.factory, spec);
      };
      var parts = generate$4(config.name, config.partFields);
      var apis = map$2(config.apis, makeApi);
      var extraApis = map$2(config.extraApis, function (f, k) {
        return markAsExtraApi(f, k);
      });
      return __assign(__assign({
        name: config.name,
        partFields: config.partFields,
        configFields: config.configFields,
        sketch: sketch,
        parts: parts
      }, apis), extraApis);
    };

    var cat = function (arr) {
      var r = [];
      var push = function (x) {
        r.push(x);
      };
      for (var i = 0; i < arr.length; i++) {
        arr[i].each(push);
      }
      return r;
    };
    var sequence = function (arr) {
      var r = [];
      for (var i = 0; i < arr.length; i++) {
        var x = arr[i];
        if (x.isSome()) {
          r.push(x.getOrDie());
        } else {
          return Optional.none();
        }
      }
      return Optional.some(r);
    };
    var lift2 = function (oa, ob, f) {
      return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();
    };
    var lift3 = function (oa, ob, oc, f) {
      return oa.isSome() && ob.isSome() && oc.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie(), oc.getOrDie())) : Optional.none();
    };
    var mapFrom = function (a, f) {
      return a !== undefined && a !== null ? Optional.some(f(a)) : Optional.none();
    };
    var someIf = function (b, a) {
      return b ? Optional.some(a) : Optional.none();
    };

    var inside = function (target) {
      return name(target) === 'input' && get$3(target, 'type') !== 'radio' || name(target) === 'textarea';
    };

    var getCurrent = function (component, composeConfig, _composeState) {
      return composeConfig.find(component);
    };

    var ComposeApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        getCurrent: getCurrent
    });

    var ComposeSchema = [strict$1('find')];

    var Composing = create$1({
      fields: ComposeSchema,
      name: 'composing',
      apis: ComposeApis
    });

    var dehighlightAllExcept = function (component, hConfig, hState, skip) {
      var highlighted = descendants(component.element, '.' + hConfig.highlightClass);
      each(highlighted, function (h) {
        if (!exists(skip, function (skipComp) {
            return skipComp.element === h;
          })) {
          remove$4(h, hConfig.highlightClass);
          component.getSystem().getByDom(h).each(function (target) {
            hConfig.onDehighlight(component, target);
            emit(target, dehighlight());
          });
        }
      });
    };
    var dehighlightAll = function (component, hConfig, hState) {
      return dehighlightAllExcept(component, hConfig, hState, []);
    };
    var dehighlight$1 = function (component, hConfig, hState, target) {
      if (isHighlighted(component, hConfig, hState, target)) {
        remove$4(target.element, hConfig.highlightClass);
        hConfig.onDehighlight(component, target);
        emit(target, dehighlight());
      }
    };
    var highlight$1 = function (component, hConfig, hState, target) {
      dehighlightAllExcept(component, hConfig, hState, [target]);
      if (!isHighlighted(component, hConfig, hState, target)) {
        add$2(target.element, hConfig.highlightClass);
        hConfig.onHighlight(component, target);
        emit(target, highlight());
      }
    };
    var highlightFirst = function (component, hConfig, hState) {
      getFirst(component, hConfig).each(function (firstComp) {
        highlight$1(component, hConfig, hState, firstComp);
      });
    };
    var highlightLast = function (component, hConfig, hState) {
      getLast(component, hConfig).each(function (lastComp) {
        highlight$1(component, hConfig, hState, lastComp);
      });
    };
    var highlightAt = function (component, hConfig, hState, index) {
      getByIndex(component, hConfig, hState, index).fold(function (err) {
        throw err;
      }, function (firstComp) {
        highlight$1(component, hConfig, hState, firstComp);
      });
    };
    var highlightBy = function (component, hConfig, hState, predicate) {
      var candidates = getCandidates(component, hConfig);
      var targetComp = find(candidates, predicate);
      targetComp.each(function (c) {
        highlight$1(component, hConfig, hState, c);
      });
    };
    var isHighlighted = function (component, hConfig, hState, queryTarget) {
      return has$2(queryTarget.element, hConfig.highlightClass);
    };
    var getHighlighted = function (component, hConfig, _hState) {
      return descendant$1(component.element, '.' + hConfig.highlightClass).bind(function (e) {
        return component.getSystem().getByDom(e).toOptional();
      });
    };
    var getByIndex = function (component, hConfig, hState, index) {
      var items = descendants(component.element, '.' + hConfig.itemClass);
      return Optional.from(items[index]).fold(function () {
        return Result.error(new Error('No element found with index ' + index));
      }, component.getSystem().getByDom);
    };
    var getFirst = function (component, hConfig, _hState) {
      return descendant$1(component.element, '.' + hConfig.itemClass).bind(function (e) {
        return component.getSystem().getByDom(e).toOptional();
      });
    };
    var getLast = function (component, hConfig, _hState) {
      var items = descendants(component.element, '.' + hConfig.itemClass);
      var last = items.length > 0 ? Optional.some(items[items.length - 1]) : Optional.none();
      return last.bind(function (c) {
        return component.getSystem().getByDom(c).toOptional();
      });
    };
    var getDelta = function (component, hConfig, hState, delta) {
      var items = descendants(component.element, '.' + hConfig.itemClass);
      var current = findIndex(items, function (item) {
        return has$2(item, hConfig.highlightClass);
      });
      return current.bind(function (selected) {
        var dest = cycleBy(selected, delta, 0, items.length - 1);
        return component.getSystem().getByDom(items[dest]).toOptional();
      });
    };
    var getPrevious = function (component, hConfig, hState) {
      return getDelta(component, hConfig, hState, -1);
    };
    var getNext = function (component, hConfig, hState) {
      return getDelta(component, hConfig, hState, +1);
    };
    var getCandidates = function (component, hConfig, _hState) {
      var items = descendants(component.element, '.' + hConfig.itemClass);
      return cat(map(items, function (i) {
        return component.getSystem().getByDom(i).toOptional();
      }));
    };

    var HighlightApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        dehighlightAll: dehighlightAll,
        dehighlight: dehighlight$1,
        highlight: highlight$1,
        highlightFirst: highlightFirst,
        highlightLast: highlightLast,
        highlightAt: highlightAt,
        highlightBy: highlightBy,
        isHighlighted: isHighlighted,
        getHighlighted: getHighlighted,
        getFirst: getFirst,
        getLast: getLast,
        getPrevious: getPrevious,
        getNext: getNext,
        getCandidates: getCandidates
    });

    var HighlightSchema = [
      strict$1('highlightClass'),
      strict$1('itemClass'),
      onHandler('onHighlight'),
      onHandler('onDehighlight')
    ];

    var Highlighting = create$1({
      fields: HighlightSchema,
      name: 'highlighting',
      apis: HighlightApis
    });

    var BACKSPACE = [8];
    var TAB = [9];
    var ENTER = [13];
    var ESCAPE = [27];
    var SPACE = [32];
    var LEFT = [37];
    var UP = [38];
    var RIGHT = [39];
    var DOWN = [40];

    var cyclePrev = function (values, index, predicate) {
      var before = reverse(values.slice(0, index));
      var after = reverse(values.slice(index + 1));
      return find(before.concat(after), predicate);
    };
    var tryPrev = function (values, index, predicate) {
      var before = reverse(values.slice(0, index));
      return find(before, predicate);
    };
    var cycleNext = function (values, index, predicate) {
      var before = values.slice(0, index);
      var after = values.slice(index + 1);
      return find(after.concat(before), predicate);
    };
    var tryNext = function (values, index, predicate) {
      var after = values.slice(index + 1);
      return find(after, predicate);
    };

    var inSet = function (keys) {
      return function (event) {
        var raw = event.raw;
        return contains(keys, raw.which);
      };
    };
    var and = function (preds) {
      return function (event) {
        return forall(preds, function (pred) {
          return pred(event);
        });
      };
    };
    var isShift = function (event) {
      var raw = event.raw;
      return raw.shiftKey === true;
    };
    var isControl = function (event) {
      var raw = event.raw;
      return raw.ctrlKey === true;
    };
    var isNotShift = not(isShift);

    var rule = function (matches, action) {
      return {
        matches: matches,
        classification: action
      };
    };
    var choose$2 = function (transitions, event) {
      var transition = find(transitions, function (t) {
        return t.matches(event);
      });
      return transition.map(function (t) {
        return t.classification;
      });
    };

    var reportFocusShifting = function (component, prevFocus, newFocus) {
      var noChange = prevFocus.exists(function (p) {
        return newFocus.exists(function (n) {
          return eq$1(n, p);
        });
      });
      if (!noChange) {
        emitWith(component, focusShifted(), {
          prevFocus: prevFocus,
          newFocus: newFocus
        });
      }
    };
    var dom = function () {
      var get = function (component) {
        return search(component.element);
      };
      var set = function (component, focusee) {
        var prevFocus = get(component);
        component.getSystem().triggerFocus(focusee, component.element);
        var newFocus = get(component);
        reportFocusShifting(component, prevFocus, newFocus);
      };
      return {
        get: get,
        set: set
      };
    };
    var highlights = function () {
      var get = function (component) {
        return Highlighting.getHighlighted(component).map(function (item) {
          return item.element;
        });
      };
      var set = function (component, element) {
        var prevFocus = get(component);
        component.getSystem().getByDom(element).fold(noop, function (item) {
          Highlighting.highlight(component, item);
        });
        var newFocus = get(component);
        reportFocusShifting(component, prevFocus, newFocus);
      };
      return {
        get: get,
        set: set
      };
    };

    var FocusInsideModes;
    (function (FocusInsideModes) {
      FocusInsideModes['OnFocusMode'] = 'onFocus';
      FocusInsideModes['OnEnterOrSpaceMode'] = 'onEnterOrSpace';
      FocusInsideModes['OnApiMode'] = 'onApi';
    }(FocusInsideModes || (FocusInsideModes = {})));

    var typical = function (infoSchema, stateInit, getKeydownRules, getKeyupRules, optFocusIn) {
      var schema = function () {
        return infoSchema.concat([
          defaulted$1('focusManager', dom()),
          defaultedOf('focusInside', 'onFocus', valueOf(function (val) {
            return contains([
              'onFocus',
              'onEnterOrSpace',
              'onApi'
            ], val) ? Result.value(val) : Result.error('Invalid value for focusInside');
          })),
          output('handler', me),
          output('state', stateInit),
          output('sendFocusIn', optFocusIn)
        ]);
      };
      var processKey = function (component, simulatedEvent, getRules, keyingConfig, keyingState) {
        var rules = getRules(component, simulatedEvent, keyingConfig, keyingState);
        return choose$2(rules, simulatedEvent.event).bind(function (rule) {
          return rule(component, simulatedEvent, keyingConfig, keyingState);
        });
      };
      var toEvents = function (keyingConfig, keyingState) {
        var onFocusHandler = keyingConfig.focusInside !== FocusInsideModes.OnFocusMode ? Optional.none() : optFocusIn(keyingConfig).map(function (focusIn) {
          return run(focus(), function (component, simulatedEvent) {
            focusIn(component, keyingConfig, keyingState);
            simulatedEvent.stop();
          });
        });
        var tryGoInsideComponent = function (component, simulatedEvent) {
          var isEnterOrSpace = inSet(SPACE.concat(ENTER))(simulatedEvent.event);
          if (keyingConfig.focusInside === FocusInsideModes.OnEnterOrSpaceMode && isEnterOrSpace && isSource(component, simulatedEvent)) {
            optFocusIn(keyingConfig).each(function (focusIn) {
              focusIn(component, keyingConfig, keyingState);
              simulatedEvent.stop();
            });
          }
        };
        var keyboardEvents = [
          run(keydown(), function (component, simulatedEvent) {
            processKey(component, simulatedEvent, getKeydownRules, keyingConfig, keyingState).fold(function () {
              tryGoInsideComponent(component, simulatedEvent);
            }, function (_) {
              simulatedEvent.stop();
            });
          }),
          run(keyup(), function (component, simulatedEvent) {
            processKey(component, simulatedEvent, getKeyupRules, keyingConfig, keyingState).each(function (_) {
              simulatedEvent.stop();
            });
          })
        ];
        return derive(onFocusHandler.toArray().concat(keyboardEvents));
      };
      var me = {
        schema: schema,
        processKey: processKey,
        toEvents: toEvents
      };
      return me;
    };

    var create$3 = function (cyclicField) {
      var schema = [
        option('onEscape'),
        option('onEnter'),
        defaulted$1('selector', '[data-alloy-tabstop="true"]:not(:disabled)'),
        defaulted$1('firstTabstop', 0),
        defaulted$1('useTabstopAt', always),
        option('visibilitySelector')
      ].concat([cyclicField]);
      var isVisible = function (tabbingConfig, element) {
        var target = tabbingConfig.visibilitySelector.bind(function (sel) {
          return closest$3(element, sel);
        }).getOr(element);
        return get$7(target) > 0;
      };
      var findInitial = function (component, tabbingConfig) {
        var tabstops = descendants(component.element, tabbingConfig.selector);
        var visibles = filter(tabstops, function (elem) {
          return isVisible(tabbingConfig, elem);
        });
        return Optional.from(visibles[tabbingConfig.firstTabstop]);
      };
      var findCurrent = function (component, tabbingConfig) {
        return tabbingConfig.focusManager.get(component).bind(function (elem) {
          return closest$3(elem, tabbingConfig.selector);
        });
      };
      var isTabstop = function (tabbingConfig, element) {
        return isVisible(tabbingConfig, element) && tabbingConfig.useTabstopAt(element);
      };
      var focusIn = function (component, tabbingConfig, _tabbingState) {
        findInitial(component, tabbingConfig).each(function (target) {
          tabbingConfig.focusManager.set(component, target);
        });
      };
      var goFromTabstop = function (component, tabstops, stopIndex, tabbingConfig, cycle) {
        return cycle(tabstops, stopIndex, function (elem) {
          return isTabstop(tabbingConfig, elem);
        }).fold(function () {
          return tabbingConfig.cyclic ? Optional.some(true) : Optional.none();
        }, function (target) {
          tabbingConfig.focusManager.set(component, target);
          return Optional.some(true);
        });
      };
      var go = function (component, _simulatedEvent, tabbingConfig, cycle) {
        var tabstops = descendants(component.element, tabbingConfig.selector);
        return findCurrent(component, tabbingConfig).bind(function (tabstop) {
          var optStopIndex = findIndex(tabstops, curry(eq$1, tabstop));
          return optStopIndex.bind(function (stopIndex) {
            return goFromTabstop(component, tabstops, stopIndex, tabbingConfig, cycle);
          });
        });
      };
      var goBackwards = function (component, simulatedEvent, tabbingConfig) {
        var navigate = tabbingConfig.cyclic ? cyclePrev : tryPrev;
        return go(component, simulatedEvent, tabbingConfig, navigate);
      };
      var goForwards = function (component, simulatedEvent, tabbingConfig) {
        var navigate = tabbingConfig.cyclic ? cycleNext : tryNext;
        return go(component, simulatedEvent, tabbingConfig, navigate);
      };
      var execute = function (component, simulatedEvent, tabbingConfig) {
        return tabbingConfig.onEnter.bind(function (f) {
          return f(component, simulatedEvent);
        });
      };
      var exit = function (component, simulatedEvent, tabbingConfig) {
        return tabbingConfig.onEscape.bind(function (f) {
          return f(component, simulatedEvent);
        });
      };
      var getKeydownRules = constant([
        rule(and([
          isShift,
          inSet(TAB)
        ]), goBackwards),
        rule(inSet(TAB), goForwards),
        rule(inSet(ESCAPE), exit),
        rule(and([
          isNotShift,
          inSet(ENTER)
        ]), execute)
      ]);
      var getKeyupRules = constant([]);
      return typical(schema, NoState.init, getKeydownRules, getKeyupRules, function () {
        return Optional.some(focusIn);
      });
    };

    var AcyclicType = create$3(state$1('cyclic', never));

    var CyclicType = create$3(state$1('cyclic', always));

    var doDefaultExecute = function (component, _simulatedEvent, focused) {
      dispatch(component, focused, execute());
      return Optional.some(true);
    };
    var defaultExecute = function (component, simulatedEvent, focused) {
      var isComplex = inside(focused) && inSet(SPACE)(simulatedEvent.event);
      return isComplex ? Optional.none() : doDefaultExecute(component, simulatedEvent, focused);
    };
    var stopEventForFirefox = function (_component, _simulatedEvent) {
      return Optional.some(true);
    };

    var schema$4 = [
      defaulted$1('execute', defaultExecute),
      defaulted$1('useSpace', false),
      defaulted$1('useEnter', true),
      defaulted$1('useControlEnter', false),
      defaulted$1('useDown', false)
    ];
    var execute$1 = function (component, simulatedEvent, executeConfig) {
      return executeConfig.execute(component, simulatedEvent, component.element);
    };
    var getKeydownRules = function (component, _simulatedEvent, executeConfig, _executeState) {
      var spaceExec = executeConfig.useSpace && !inside(component.element) ? SPACE : [];
      var enterExec = executeConfig.useEnter ? ENTER : [];
      var downExec = executeConfig.useDown ? DOWN : [];
      var execKeys = spaceExec.concat(enterExec).concat(downExec);
      return [rule(inSet(execKeys), execute$1)].concat(executeConfig.useControlEnter ? [rule(and([
          isControl,
          inSet(ENTER)
        ]), execute$1)] : []);
    };
    var getKeyupRules = function (component, _simulatedEvent, executeConfig, _executeState) {
      return executeConfig.useSpace && !inside(component.element) ? [rule(inSet(SPACE), stopEventForFirefox)] : [];
    };
    var ExecutionType = typical(schema$4, NoState.init, getKeydownRules, getKeyupRules, function () {
      return Optional.none();
    });

    var flatgrid = function () {
      var dimensions = Cell(Optional.none());
      var setGridSize = function (numRows, numColumns) {
        dimensions.set(Optional.some({
          numRows: numRows,
          numColumns: numColumns
        }));
      };
      var getNumRows = function () {
        return dimensions.get().map(function (d) {
          return d.numRows;
        });
      };
      var getNumColumns = function () {
        return dimensions.get().map(function (d) {
          return d.numColumns;
        });
      };
      return nu$5({
        readState: function () {
          return dimensions.get().map(function (d) {
            return {
              numRows: String(d.numRows),
              numColumns: String(d.numColumns)
            };
          }).getOr({
            numRows: '?',
            numColumns: '?'
          });
        },
        setGridSize: setGridSize,
        getNumRows: getNumRows,
        getNumColumns: getNumColumns
      });
    };
    var init$2 = function (spec) {
      return spec.state(spec);
    };

    var KeyingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        flatgrid: flatgrid,
        init: init$2
    });

    var useH = function (movement) {
      return function (component, simulatedEvent, config, state) {
        var move = movement(component.element);
        return use(move, component, simulatedEvent, config, state);
      };
    };
    var west$2 = function (moveLeft, moveRight) {
      var movement = onDirection(moveLeft, moveRight);
      return useH(movement);
    };
    var east$2 = function (moveLeft, moveRight) {
      var movement = onDirection(moveRight, moveLeft);
      return useH(movement);
    };
    var useV = function (move) {
      return function (component, simulatedEvent, config, state) {
        return use(move, component, simulatedEvent, config, state);
      };
    };
    var use = function (move, component, simulatedEvent, config, state) {
      var outcome = config.focusManager.get(component).bind(function (focused) {
        return move(component.element, focused, config, state);
      });
      return outcome.map(function (newFocus) {
        config.focusManager.set(component, newFocus);
        return true;
      });
    };
    var north$2 = useV;
    var south$2 = useV;
    var move = useV;

    var isHidden = function (dom) {
      return dom.offsetWidth <= 0 && dom.offsetHeight <= 0;
    };
    var isVisible = function (element) {
      return !isHidden(element.dom);
    };

    var locate = function (candidates, predicate) {
      return findIndex(candidates, predicate).map(function (index) {
        return {
          index: index,
          candidates: candidates
        };
      });
    };

    var locateVisible = function (container, current, selector) {
      var predicate = function (x) {
        return eq$1(x, current);
      };
      var candidates = descendants(container, selector);
      var visible = filter(candidates, isVisible);
      return locate(visible, predicate);
    };
    var findIndex$1 = function (elements, target) {
      return findIndex(elements, function (elem) {
        return eq$1(target, elem);
      });
    };

    var withGrid = function (values, index, numCols, f) {
      var oldRow = Math.floor(index / numCols);
      var oldColumn = index % numCols;
      return f(oldRow, oldColumn).bind(function (address) {
        var newIndex = address.row * numCols + address.column;
        return newIndex >= 0 && newIndex < values.length ? Optional.some(values[newIndex]) : Optional.none();
      });
    };
    var cycleHorizontal = function (values, index, numRows, numCols, delta) {
      return withGrid(values, index, numCols, function (oldRow, oldColumn) {
        var onLastRow = oldRow === numRows - 1;
        var colsInRow = onLastRow ? values.length - oldRow * numCols : numCols;
        var newColumn = cycleBy(oldColumn, delta, 0, colsInRow - 1);
        return Optional.some({
          row: oldRow,
          column: newColumn
        });
      });
    };
    var cycleVertical = function (values, index, numRows, numCols, delta) {
      return withGrid(values, index, numCols, function (oldRow, oldColumn) {
        var newRow = cycleBy(oldRow, delta, 0, numRows - 1);
        var onLastRow = newRow === numRows - 1;
        var colsInRow = onLastRow ? values.length - newRow * numCols : numCols;
        var newCol = clamp(oldColumn, 0, colsInRow - 1);
        return Optional.some({
          row: newRow,
          column: newCol
        });
      });
    };
    var cycleRight = function (values, index, numRows, numCols) {
      return cycleHorizontal(values, index, numRows, numCols, +1);
    };
    var cycleLeft = function (values, index, numRows, numCols) {
      return cycleHorizontal(values, index, numRows, numCols, -1);
    };
    var cycleUp = function (values, index, numRows, numCols) {
      return cycleVertical(values, index, numRows, numCols, -1);
    };
    var cycleDown = function (values, index, numRows, numCols) {
      return cycleVertical(values, index, numRows, numCols, +1);
    };

    var schema$5 = [
      strict$1('selector'),
      defaulted$1('execute', defaultExecute),
      onKeyboardHandler('onEscape'),
      defaulted$1('captureTab', false),
      initSize()
    ];
    var focusIn = function (component, gridConfig, _gridState) {
      descendant$1(component.element, gridConfig.selector).each(function (first) {
        gridConfig.focusManager.set(component, first);
      });
    };
    var findCurrent = function (component, gridConfig) {
      return gridConfig.focusManager.get(component).bind(function (elem) {
        return closest$3(elem, gridConfig.selector);
      });
    };
    var execute$2 = function (component, simulatedEvent, gridConfig, _gridState) {
      return findCurrent(component, gridConfig).bind(function (focused) {
        return gridConfig.execute(component, simulatedEvent, focused);
      });
    };
    var doMove = function (cycle) {
      return function (element, focused, gridConfig, gridState) {
        return locateVisible(element, focused, gridConfig.selector).bind(function (identified) {
          return cycle(identified.candidates, identified.index, gridState.getNumRows().getOr(gridConfig.initSize.numRows), gridState.getNumColumns().getOr(gridConfig.initSize.numColumns));
        });
      };
    };
    var handleTab = function (_component, _simulatedEvent, gridConfig) {
      return gridConfig.captureTab ? Optional.some(true) : Optional.none();
    };
    var doEscape = function (component, simulatedEvent, gridConfig) {
      return gridConfig.onEscape(component, simulatedEvent);
    };
    var moveLeft = doMove(cycleLeft);
    var moveRight = doMove(cycleRight);
    var moveNorth = doMove(cycleUp);
    var moveSouth = doMove(cycleDown);
    var getKeydownRules$1 = constant([
      rule(inSet(LEFT), west$2(moveLeft, moveRight)),
      rule(inSet(RIGHT), east$2(moveLeft, moveRight)),
      rule(inSet(UP), north$2(moveNorth)),
      rule(inSet(DOWN), south$2(moveSouth)),
      rule(and([
        isShift,
        inSet(TAB)
      ]), handleTab),
      rule(and([
        isNotShift,
        inSet(TAB)
      ]), handleTab),
      rule(inSet(ESCAPE), doEscape),
      rule(inSet(SPACE.concat(ENTER)), execute$2)
    ]);
    var getKeyupRules$1 = constant([rule(inSet(SPACE), stopEventForFirefox)]);
    var FlatgridType = typical(schema$5, flatgrid, getKeydownRules$1, getKeyupRules$1, function () {
      return Optional.some(focusIn);
    });

    var horizontal = function (container, selector, current, delta) {
      var isDisabledButton = function (candidate) {
        return name(candidate) === 'button' && get$3(candidate, 'disabled') === 'disabled';
      };
      var tryCycle = function (initial, index, candidates) {
        var newIndex = cycleBy(index, delta, 0, candidates.length - 1);
        if (newIndex === initial) {
          return Optional.none();
        } else {
          return isDisabledButton(candidates[newIndex]) ? tryCycle(initial, newIndex, candidates) : Optional.from(candidates[newIndex]);
        }
      };
      return locateVisible(container, current, selector).bind(function (identified) {
        var index = identified.index;
        var candidates = identified.candidates;
        return tryCycle(index, index, candidates);
      });
    };

    var schema$6 = [
      strict$1('selector'),
      defaulted$1('getInitial', Optional.none),
      defaulted$1('execute', defaultExecute),
      onKeyboardHandler('onEscape'),
      defaulted$1('executeOnMove', false),
      defaulted$1('allowVertical', true)
    ];
    var findCurrent$1 = function (component, flowConfig) {
      return flowConfig.focusManager.get(component).bind(function (elem) {
        return closest$3(elem, flowConfig.selector);
      });
    };
    var execute$3 = function (component, simulatedEvent, flowConfig) {
      return findCurrent$1(component, flowConfig).bind(function (focused) {
        return flowConfig.execute(component, simulatedEvent, focused);
      });
    };
    var focusIn$1 = function (component, flowConfig, _state) {
      flowConfig.getInitial(component).orThunk(function () {
        return descendant$1(component.element, flowConfig.selector);
      }).each(function (first) {
        flowConfig.focusManager.set(component, first);
      });
    };
    var moveLeft$1 = function (element, focused, info) {
      return horizontal(element, info.selector, focused, -1);
    };
    var moveRight$1 = function (element, focused, info) {
      return horizontal(element, info.selector, focused, +1);
    };
    var doMove$1 = function (movement) {
      return function (component, simulatedEvent, flowConfig, flowState) {
        return movement(component, simulatedEvent, flowConfig, flowState).bind(function () {
          return flowConfig.executeOnMove ? execute$3(component, simulatedEvent, flowConfig) : Optional.some(true);
        });
      };
    };
    var doEscape$1 = function (component, simulatedEvent, flowConfig) {
      return flowConfig.onEscape(component, simulatedEvent);
    };
    var getKeydownRules$2 = function (_component, _se, flowConfig, _flowState) {
      var westMovers = LEFT.concat(flowConfig.allowVertical ? UP : []);
      var eastMovers = RIGHT.concat(flowConfig.allowVertical ? DOWN : []);
      return [
        rule(inSet(westMovers), doMove$1(west$2(moveLeft$1, moveRight$1))),
        rule(inSet(eastMovers), doMove$1(east$2(moveLeft$1, moveRight$1))),
        rule(inSet(ENTER), execute$3),
        rule(inSet(SPACE), execute$3),
        rule(inSet(ESCAPE), doEscape$1)
      ];
    };
    var getKeyupRules$2 = constant([rule(inSet(SPACE), stopEventForFirefox)]);
    var FlowType = typical(schema$6, NoState.init, getKeydownRules$2, getKeyupRules$2, function () {
      return Optional.some(focusIn$1);
    });

    var toCell = function (matrix, rowIndex, columnIndex) {
      return Optional.from(matrix[rowIndex]).bind(function (row) {
        return Optional.from(row[columnIndex]).map(function (cell) {
          return {
            rowIndex: rowIndex,
            columnIndex: columnIndex,
            cell: cell
          };
        });
      });
    };
    var cycleHorizontal$1 = function (matrix, rowIndex, startCol, deltaCol) {
      var row = matrix[rowIndex];
      var colsInRow = row.length;
      var newColIndex = cycleBy(startCol, deltaCol, 0, colsInRow - 1);
      return toCell(matrix, rowIndex, newColIndex);
    };
    var cycleVertical$1 = function (matrix, colIndex, startRow, deltaRow) {
      var nextRowIndex = cycleBy(startRow, deltaRow, 0, matrix.length - 1);
      var colsInNextRow = matrix[nextRowIndex].length;
      var nextColIndex = clamp(colIndex, 0, colsInNextRow - 1);
      return toCell(matrix, nextRowIndex, nextColIndex);
    };
    var moveHorizontal = function (matrix, rowIndex, startCol, deltaCol) {
      var row = matrix[rowIndex];
      var colsInRow = row.length;
      var newColIndex = clamp(startCol + deltaCol, 0, colsInRow - 1);
      return toCell(matrix, rowIndex, newColIndex);
    };
    var moveVertical = function (matrix, colIndex, startRow, deltaRow) {
      var nextRowIndex = clamp(startRow + deltaRow, 0, matrix.length - 1);
      var colsInNextRow = matrix[nextRowIndex].length;
      var nextColIndex = clamp(colIndex, 0, colsInNextRow - 1);
      return toCell(matrix, nextRowIndex, nextColIndex);
    };
    var cycleRight$1 = function (matrix, startRow, startCol) {
      return cycleHorizontal$1(matrix, startRow, startCol, +1);
    };
    var cycleLeft$1 = function (matrix, startRow, startCol) {
      return cycleHorizontal$1(matrix, startRow, startCol, -1);
    };
    var cycleUp$1 = function (matrix, startRow, startCol) {
      return cycleVertical$1(matrix, startCol, startRow, -1);
    };
    var cycleDown$1 = function (matrix, startRow, startCol) {
      return cycleVertical$1(matrix, startCol, startRow, +1);
    };
    var moveLeft$2 = function (matrix, startRow, startCol) {
      return moveHorizontal(matrix, startRow, startCol, -1);
    };
    var moveRight$2 = function (matrix, startRow, startCol) {
      return moveHorizontal(matrix, startRow, startCol, +1);
    };
    var moveUp = function (matrix, startRow, startCol) {
      return moveVertical(matrix, startCol, startRow, -1);
    };
    var moveDown = function (matrix, startRow, startCol) {
      return moveVertical(matrix, startCol, startRow, +1);
    };

    var schema$7 = [
      strictObjOf('selectors', [
        strict$1('row'),
        strict$1('cell')
      ]),
      defaulted$1('cycles', true),
      defaulted$1('previousSelector', Optional.none),
      defaulted$1('execute', defaultExecute)
    ];
    var focusIn$2 = function (component, matrixConfig, _state) {
      var focused = matrixConfig.previousSelector(component).orThunk(function () {
        var selectors = matrixConfig.selectors;
        return descendant$1(component.element, selectors.cell);
      });
      focused.each(function (cell) {
        matrixConfig.focusManager.set(component, cell);
      });
    };
    var execute$4 = function (component, simulatedEvent, matrixConfig) {
      return search(component.element).bind(function (focused) {
        return matrixConfig.execute(component, simulatedEvent, focused);
      });
    };
    var toMatrix = function (rows, matrixConfig) {
      return map(rows, function (row) {
        return descendants(row, matrixConfig.selectors.cell);
      });
    };
    var doMove$2 = function (ifCycle, ifMove) {
      return function (element, focused, matrixConfig) {
        var move = matrixConfig.cycles ? ifCycle : ifMove;
        return closest$3(focused, matrixConfig.selectors.row).bind(function (inRow) {
          var cellsInRow = descendants(inRow, matrixConfig.selectors.cell);
          return findIndex$1(cellsInRow, focused).bind(function (colIndex) {
            var allRows = descendants(element, matrixConfig.selectors.row);
            return findIndex$1(allRows, inRow).bind(function (rowIndex) {
              var matrix = toMatrix(allRows, matrixConfig);
              return move(matrix, rowIndex, colIndex).map(function (next) {
                return next.cell;
              });
            });
          });
        });
      };
    };
    var moveLeft$3 = doMove$2(cycleLeft$1, moveLeft$2);
    var moveRight$3 = doMove$2(cycleRight$1, moveRight$2);
    var moveNorth$1 = doMove$2(cycleUp$1, moveUp);
    var moveSouth$1 = doMove$2(cycleDown$1, moveDown);
    var getKeydownRules$3 = constant([
      rule(inSet(LEFT), west$2(moveLeft$3, moveRight$3)),
      rule(inSet(RIGHT), east$2(moveLeft$3, moveRight$3)),
      rule(inSet(UP), north$2(moveNorth$1)),
      rule(inSet(DOWN), south$2(moveSouth$1)),
      rule(inSet(SPACE.concat(ENTER)), execute$4)
    ]);
    var getKeyupRules$3 = constant([rule(inSet(SPACE), stopEventForFirefox)]);
    var MatrixType = typical(schema$7, NoState.init, getKeydownRules$3, getKeyupRules$3, function () {
      return Optional.some(focusIn$2);
    });

    var schema$8 = [
      strict$1('selector'),
      defaulted$1('execute', defaultExecute),
      defaulted$1('moveOnTab', false)
    ];
    var execute$5 = function (component, simulatedEvent, menuConfig) {
      return menuConfig.focusManager.get(component).bind(function (focused) {
        return menuConfig.execute(component, simulatedEvent, focused);
      });
    };
    var focusIn$3 = function (component, menuConfig, _state) {
      descendant$1(component.element, menuConfig.selector).each(function (first) {
        menuConfig.focusManager.set(component, first);
      });
    };
    var moveUp$1 = function (element, focused, info) {
      return horizontal(element, info.selector, focused, -1);
    };
    var moveDown$1 = function (element, focused, info) {
      return horizontal(element, info.selector, focused, +1);
    };
    var fireShiftTab = function (component, simulatedEvent, menuConfig, menuState) {
      return menuConfig.moveOnTab ? move(moveUp$1)(component, simulatedEvent, menuConfig, menuState) : Optional.none();
    };
    var fireTab = function (component, simulatedEvent, menuConfig, menuState) {
      return menuConfig.moveOnTab ? move(moveDown$1)(component, simulatedEvent, menuConfig, menuState) : Optional.none();
    };
    var getKeydownRules$4 = constant([
      rule(inSet(UP), move(moveUp$1)),
      rule(inSet(DOWN), move(moveDown$1)),
      rule(and([
        isShift,
        inSet(TAB)
      ]), fireShiftTab),
      rule(and([
        isNotShift,
        inSet(TAB)
      ]), fireTab),
      rule(inSet(ENTER), execute$5),
      rule(inSet(SPACE), execute$5)
    ]);
    var getKeyupRules$4 = constant([rule(inSet(SPACE), stopEventForFirefox)]);
    var MenuType = typical(schema$8, NoState.init, getKeydownRules$4, getKeyupRules$4, function () {
      return Optional.some(focusIn$3);
    });

    var schema$9 = [
      onKeyboardHandler('onSpace'),
      onKeyboardHandler('onEnter'),
      onKeyboardHandler('onShiftEnter'),
      onKeyboardHandler('onLeft'),
      onKeyboardHandler('onRight'),
      onKeyboardHandler('onTab'),
      onKeyboardHandler('onShiftTab'),
      onKeyboardHandler('onUp'),
      onKeyboardHandler('onDown'),
      onKeyboardHandler('onEscape'),
      defaulted$1('stopSpaceKeyup', false),
      option('focusIn')
    ];
    var getKeydownRules$5 = function (component, simulatedEvent, specialInfo) {
      return [
        rule(inSet(SPACE), specialInfo.onSpace),
        rule(and([
          isNotShift,
          inSet(ENTER)
        ]), specialInfo.onEnter),
        rule(and([
          isShift,
          inSet(ENTER)
        ]), specialInfo.onShiftEnter),
        rule(and([
          isShift,
          inSet(TAB)
        ]), specialInfo.onShiftTab),
        rule(and([
          isNotShift,
          inSet(TAB)
        ]), specialInfo.onTab),
        rule(inSet(UP), specialInfo.onUp),
        rule(inSet(DOWN), specialInfo.onDown),
        rule(inSet(LEFT), specialInfo.onLeft),
        rule(inSet(RIGHT), specialInfo.onRight),
        rule(inSet(SPACE), specialInfo.onSpace),
        rule(inSet(ESCAPE), specialInfo.onEscape)
      ];
    };
    var getKeyupRules$5 = function (component, simulatedEvent, specialInfo) {
      return specialInfo.stopSpaceKeyup ? [rule(inSet(SPACE), stopEventForFirefox)] : [];
    };
    var SpecialType = typical(schema$9, NoState.init, getKeydownRules$5, getKeyupRules$5, function (specialInfo) {
      return specialInfo.focusIn;
    });

    var acyclic = AcyclicType.schema();
    var cyclic = CyclicType.schema();
    var flow = FlowType.schema();
    var flatgrid$1 = FlatgridType.schema();
    var matrix = MatrixType.schema();
    var execution = ExecutionType.schema();
    var menu = MenuType.schema();
    var special = SpecialType.schema();

    var KeyboardBranches = /*#__PURE__*/Object.freeze({
        __proto__: null,
        acyclic: acyclic,
        cyclic: cyclic,
        flow: flow,
        flatgrid: flatgrid$1,
        matrix: matrix,
        execution: execution,
        menu: menu,
        special: special
    });

    var isFlatgridState = function (keyState) {
      return hasNonNullableKey(keyState, 'setGridSize');
    };
    var Keying = createModes$1({
      branchKey: 'mode',
      branches: KeyboardBranches,
      name: 'keying',
      active: {
        events: function (keyingConfig, keyingState) {
          var handler = keyingConfig.handler;
          return handler.toEvents(keyingConfig, keyingState);
        }
      },
      apis: {
        focusIn: function (component, keyConfig, keyState) {
          keyConfig.sendFocusIn(keyConfig).fold(function () {
            component.getSystem().triggerFocus(component.element, component.element);
          }, function (sendFocusIn) {
            sendFocusIn(component, keyConfig, keyState);
          });
        },
        setGridSize: function (component, keyConfig, keyState, numRows, numColumns) {
          if (!isFlatgridState(keyState)) {
            console.error('Layout does not support setGridSize');
          } else {
            keyState.setGridSize(numRows, numColumns);
          }
        }
      },
      state: KeyingState
    });

    var set$5 = function (component, replaceConfig, replaceState, data) {
      preserve(function () {
        var newChildren = map(data, component.getSystem().build);
        replaceChildren(component, newChildren);
      }, component.element);
    };
    var insert = function (component, replaceConfig, insertion, childSpec) {
      var child = component.getSystem().build(childSpec);
      attachWith(component, child, insertion);
    };
    var append$2 = function (component, replaceConfig, replaceState, appendee) {
      insert(component, replaceConfig, append, appendee);
    };
    var prepend$1 = function (component, replaceConfig, replaceState, prependee) {
      insert(component, replaceConfig, prepend, prependee);
    };
    var remove$7 = function (component, replaceConfig, replaceState, removee) {
      var children = contents(component);
      var foundChild = find(children, function (child) {
        return eq$1(removee.element, child.element);
      });
      foundChild.each(detach);
    };
    var contents = function (component, _replaceConfig) {
      return component.components();
    };
    var replaceAt = function (component, replaceConfig, replaceState, replaceeIndex, replacer) {
      var children = contents(component);
      return Optional.from(children[replaceeIndex]).map(function (replacee) {
        remove$7(component, replaceConfig, replaceState, replacee);
        replacer.each(function (r) {
          insert(component, replaceConfig, function (p, c) {
            appendAt(p, c, replaceeIndex);
          }, r);
        });
        return replacee;
      });
    };
    var replaceBy = function (component, replaceConfig, replaceState, replaceePred, replacer) {
      var children = contents(component);
      return findIndex(children, replaceePred).bind(function (replaceeIndex) {
        return replaceAt(component, replaceConfig, replaceState, replaceeIndex, replacer);
      });
    };

    var ReplaceApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        append: append$2,
        prepend: prepend$1,
        remove: remove$7,
        replaceAt: replaceAt,
        replaceBy: replaceBy,
        set: set$5,
        contents: contents
    });

    var Replacing = create$1({
      fields: [],
      name: 'replacing',
      apis: ReplaceApis
    });

    var events$4 = function (name, eventHandlers) {
      var events = derive(eventHandlers);
      return create$1({
        fields: [strict$1('enabled')],
        name: name,
        active: { events: constant(events) }
      });
    };
    var config = function (name, eventHandlers) {
      var me = events$4(name, eventHandlers);
      return {
        key: name,
        value: {
          config: {},
          me: me,
          configAsRaw: constant({}),
          initialConfig: {},
          state: NoState
        }
      };
    };

    var focus$2 = function (component, focusConfig) {
      if (!focusConfig.ignore) {
        focus$1(component.element);
        focusConfig.onFocus(component);
      }
    };
    var blur$1 = function (component, focusConfig) {
      if (!focusConfig.ignore) {
        blur(component.element);
      }
    };
    var isFocused = function (component) {
      return hasFocus(component.element);
    };

    var FocusApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        focus: focus$2,
        blur: blur$1,
        isFocused: isFocused
    });

    var exhibit$1 = function (base, focusConfig) {
      var mod = focusConfig.ignore ? {} : { attributes: { tabindex: '-1' } };
      return nu$6(mod);
    };
    var events$5 = function (focusConfig) {
      return derive([run(focus(), function (component, simulatedEvent) {
          focus$2(component, focusConfig);
          simulatedEvent.stop();
        })].concat(focusConfig.stopMousedown ? [run(mousedown(), function (_, simulatedEvent) {
          simulatedEvent.event.prevent();
        })] : []));
    };

    var ActiveFocus = /*#__PURE__*/Object.freeze({
        __proto__: null,
        exhibit: exhibit$1,
        events: events$5
    });

    var FocusSchema = [
      onHandler('onFocus'),
      defaulted$1('stopMousedown', false),
      defaulted$1('ignore', false)
    ];

    var Focusing = create$1({
      fields: FocusSchema,
      name: 'focusing',
      active: ActiveFocus,
      apis: FocusApis
    });

    var SetupBehaviourCellState = function (initialState) {
      var init = function () {
        var cell = Cell(initialState);
        var get = function () {
          return cell.get();
        };
        var set = function (newState) {
          return cell.set(newState);
        };
        var clear = function () {
          return cell.set(initialState);
        };
        var readState = function () {
          return cell.get();
        };
        return {
          get: get,
          set: set,
          clear: clear,
          readState: readState
        };
      };
      return { init: init };
    };

    var updateAriaState = function (component, toggleConfig, toggleState) {
      var ariaInfo = toggleConfig.aria;
      ariaInfo.update(component, ariaInfo, toggleState.get());
    };
    var updateClass = function (component, toggleConfig, toggleState) {
      toggleConfig.toggleClass.each(function (toggleClass) {
        if (toggleState.get()) {
          add$2(component.element, toggleClass);
        } else {
          remove$4(component.element, toggleClass);
        }
      });
    };
    var toggle = function (component, toggleConfig, toggleState) {
      set$6(component, toggleConfig, toggleState, !toggleState.get());
    };
    var on$1 = function (component, toggleConfig, toggleState) {
      toggleState.set(true);
      updateClass(component, toggleConfig, toggleState);
      updateAriaState(component, toggleConfig, toggleState);
    };
    var off = function (component, toggleConfig, toggleState) {
      toggleState.set(false);
      updateClass(component, toggleConfig, toggleState);
      updateAriaState(component, toggleConfig, toggleState);
    };
    var set$6 = function (component, toggleConfig, toggleState, state) {
      var action = state ? on$1 : off;
      action(component, toggleConfig, toggleState);
    };
    var isOn = function (component, toggleConfig, toggleState) {
      return toggleState.get();
    };
    var onLoad$4 = function (component, toggleConfig, toggleState) {
      set$6(component, toggleConfig, toggleState, toggleConfig.selected);
    };

    var ToggleApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        onLoad: onLoad$4,
        toggle: toggle,
        isOn: isOn,
        on: on$1,
        off: off,
        set: set$6
    });

    var exhibit$2 = function () {
      return nu$6({});
    };
    var events$6 = function (toggleConfig, toggleState) {
      var execute = executeEvent(toggleConfig, toggleState, toggle);
      var load = loadEvent(toggleConfig, toggleState, onLoad$4);
      return derive(flatten([
        toggleConfig.toggleOnExecute ? [execute] : [],
        [load]
      ]));
    };

    var ActiveToggle = /*#__PURE__*/Object.freeze({
        __proto__: null,
        exhibit: exhibit$2,
        events: events$6
    });

    var updatePressed = function (component, ariaInfo, status) {
      set$1(component.element, 'aria-pressed', status);
      if (ariaInfo.syncWithExpanded) {
        updateExpanded(component, ariaInfo, status);
      }
    };
    var updateSelected = function (component, ariaInfo, status) {
      set$1(component.element, 'aria-selected', status);
    };
    var updateChecked = function (component, ariaInfo, status) {
      set$1(component.element, 'aria-checked', status);
    };
    var updateExpanded = function (component, ariaInfo, status) {
      set$1(component.element, 'aria-expanded', status);
    };

    var ToggleSchema = [
      defaulted$1('selected', false),
      option('toggleClass'),
      defaulted$1('toggleOnExecute', true),
      defaultedOf('aria', { mode: 'none' }, choose$1('mode', {
        pressed: [
          defaulted$1('syncWithExpanded', false),
          output('update', updatePressed)
        ],
        checked: [output('update', updateChecked)],
        expanded: [output('update', updateExpanded)],
        selected: [output('update', updateSelected)],
        none: [output('update', noop)]
      }))
    ];

    var Toggling = create$1({
      fields: ToggleSchema,
      name: 'toggling',
      active: ActiveToggle,
      apis: ToggleApis,
      state: SetupBehaviourCellState(false)
    });

    var pointerEvents = function () {
      var onClick = function (component, simulatedEvent) {
        simulatedEvent.stop();
        emitExecute(component);
      };
      return [
        run(click(), onClick),
        run(tap(), onClick),
        cutter(touchstart()),
        cutter(mousedown())
      ];
    };
    var events$7 = function (optAction) {
      var executeHandler = function (action) {
        return runOnExecute(function (component, simulatedEvent) {
          action(component);
          simulatedEvent.stop();
        });
      };
      return derive(flatten([
        optAction.map(executeHandler).toArray(),
        pointerEvents()
      ]));
    };

    var hoverEvent = 'alloy.item-hover';
    var focusEvent = 'alloy.item-focus';
    var onHover = function (item) {
      if (search(item.element).isNone() || Focusing.isFocused(item)) {
        if (!Focusing.isFocused(item)) {
          Focusing.focus(item);
        }
        emitWith(item, hoverEvent, { item: item });
      }
    };
    var onFocus = function (item) {
      emitWith(item, focusEvent, { item: item });
    };
    var hover = constant(hoverEvent);
    var focus$3 = constant(focusEvent);

    var builder = function (detail) {
      return {
        dom: detail.dom,
        domModification: __assign(__assign({}, detail.domModification), { attributes: __assign(__assign(__assign({ 'role': detail.toggling.isSome() ? 'menuitemcheckbox' : 'menuitem' }, detail.domModification.attributes), { 'aria-haspopup': detail.hasSubmenu }), detail.hasSubmenu ? { 'aria-expanded': false } : {}) }),
        behaviours: SketchBehaviours.augment(detail.itemBehaviours, [
          detail.toggling.fold(Toggling.revoke, function (tConfig) {
            return Toggling.config(__assign({ aria: { mode: 'checked' } }, tConfig));
          }),
          Focusing.config({
            ignore: detail.ignoreFocus,
            stopMousedown: detail.ignoreFocus,
            onFocus: function (component) {
              onFocus(component);
            }
          }),
          Keying.config({ mode: 'execution' }),
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: detail.data
            }
          }),
          config('item-type-events', __spreadArrays(pointerEvents(), [
            run(mouseover(), onHover),
            run(focusItem(), Focusing.focus)
          ]))
        ]),
        components: detail.components,
        eventOrder: detail.eventOrder
      };
    };
    var schema$a = [
      strict$1('data'),
      strict$1('components'),
      strict$1('dom'),
      defaulted$1('hasSubmenu', false),
      option('toggling'),
      SketchBehaviours.field('itemBehaviours', [
        Toggling,
        Focusing,
        Keying,
        Representing
      ]),
      defaulted$1('ignoreFocus', false),
      defaulted$1('domModification', {}),
      output('builder', builder),
      defaulted$1('eventOrder', {})
    ];

    var builder$1 = function (detail) {
      return {
        dom: detail.dom,
        components: detail.components,
        events: derive([stopper(focusItem())])
      };
    };
    var schema$b = [
      strict$1('dom'),
      strict$1('components'),
      output('builder', builder$1)
    ];

    var owner$2 = constant('item-widget');
    var parts = constant([required({
        name: 'widget',
        overrides: function (detail) {
          return {
            behaviours: derive$1([Representing.config({
                store: {
                  mode: 'manual',
                  getValue: function (_component) {
                    return detail.data;
                  },
                  setValue: noop
                }
              })])
          };
        }
      })]);

    var builder$2 = function (detail) {
      var subs = substitutes(owner$2(), detail, parts());
      var components$1 = components(owner$2(), detail, subs.internals());
      var focusWidget = function (component) {
        return getPart(component, detail, 'widget').map(function (widget) {
          Keying.focusIn(widget);
          return widget;
        });
      };
      var onHorizontalArrow = function (component, simulatedEvent) {
        return inside(simulatedEvent.event.target) ? Optional.none() : function () {
          if (detail.autofocus) {
            simulatedEvent.setSource(component.element);
            return Optional.none();
          } else {
            return Optional.none();
          }
        }();
      };
      return {
        dom: detail.dom,
        components: components$1,
        domModification: detail.domModification,
        events: derive([
          runOnExecute(function (component, simulatedEvent) {
            focusWidget(component).each(function (_widget) {
              simulatedEvent.stop();
            });
          }),
          run(mouseover(), onHover),
          run(focusItem(), function (component, _simulatedEvent) {
            if (detail.autofocus) {
              focusWidget(component);
            } else {
              Focusing.focus(component);
            }
          })
        ]),
        behaviours: SketchBehaviours.augment(detail.widgetBehaviours, [
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: detail.data
            }
          }),
          Focusing.config({
            ignore: detail.ignoreFocus,
            onFocus: function (component) {
              onFocus(component);
            }
          }),
          Keying.config({
            mode: 'special',
            focusIn: detail.autofocus ? function (component) {
              focusWidget(component);
            } : revoke(),
            onLeft: onHorizontalArrow,
            onRight: onHorizontalArrow,
            onEscape: function (component, simulatedEvent) {
              if (!Focusing.isFocused(component) && !detail.autofocus) {
                Focusing.focus(component);
                return Optional.some(true);
              } else if (detail.autofocus) {
                simulatedEvent.setSource(component.element);
                return Optional.none();
              } else {
                return Optional.none();
              }
            }
          })
        ])
      };
    };
    var schema$c = [
      strict$1('uid'),
      strict$1('data'),
      strict$1('components'),
      strict$1('dom'),
      defaulted$1('autofocus', false),
      defaulted$1('ignoreFocus', false),
      SketchBehaviours.field('widgetBehaviours', [
        Representing,
        Focusing,
        Keying
      ]),
      defaulted$1('domModification', {}),
      defaultUidsSchema(parts()),
      output('builder', builder$2)
    ];

    var itemSchema$1 = choose$1('type', {
      widget: schema$c,
      item: schema$a,
      separator: schema$b
    });
    var configureGrid = function (detail, movementInfo) {
      return {
        mode: 'flatgrid',
        selector: '.' + detail.markers.item,
        initSize: {
          numColumns: movementInfo.initSize.numColumns,
          numRows: movementInfo.initSize.numRows
        },
        focusManager: detail.focusManager
      };
    };
    var configureMatrix = function (detail, movementInfo) {
      return {
        mode: 'matrix',
        selectors: {
          row: movementInfo.rowSelector,
          cell: '.' + detail.markers.item
        },
        focusManager: detail.focusManager
      };
    };
    var configureMenu = function (detail, movementInfo) {
      return {
        mode: 'menu',
        selector: '.' + detail.markers.item,
        moveOnTab: movementInfo.moveOnTab,
        focusManager: detail.focusManager
      };
    };
    var parts$1 = constant([group({
        factory: {
          sketch: function (spec) {
            var itemInfo = asRawOrDie('menu.spec item', itemSchema$1, spec);
            return itemInfo.builder(itemInfo);
          }
        },
        name: 'items',
        unit: 'item',
        defaults: function (detail, u) {
          return u.hasOwnProperty('uid') ? u : __assign(__assign({}, u), { uid: generate$2('item') });
        },
        overrides: function (detail, u) {
          return {
            type: u.type,
            ignoreFocus: detail.fakeFocus,
            domModification: { classes: [detail.markers.item] }
          };
        }
      })]);
    var schema$d = constant([
      strict$1('value'),
      strict$1('items'),
      strict$1('dom'),
      strict$1('components'),
      defaulted$1('eventOrder', {}),
      field$1('menuBehaviours', [
        Highlighting,
        Representing,
        Composing,
        Keying
      ]),
      defaultedOf('movement', {
        mode: 'menu',
        moveOnTab: true
      }, choose$1('mode', {
        grid: [
          initSize(),
          output('config', configureGrid)
        ],
        matrix: [
          output('config', configureMatrix),
          strict$1('rowSelector')
        ],
        menu: [
          defaulted$1('moveOnTab', true),
          output('config', configureMenu)
        ]
      })),
      itemMarkers(),
      defaulted$1('fakeFocus', false),
      defaulted$1('focusManager', dom()),
      onHandler('onHighlight')
    ]);

    var focus$4 = constant('alloy.menu-focus');

    var make$1 = function (detail, components, _spec, _externals) {
      return {
        uid: detail.uid,
        dom: detail.dom,
        markers: detail.markers,
        behaviours: augment(detail.menuBehaviours, [
          Highlighting.config({
            highlightClass: detail.markers.selectedItem,
            itemClass: detail.markers.item,
            onHighlight: detail.onHighlight
          }),
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: detail.value
            }
          }),
          Composing.config({ find: Optional.some }),
          Keying.config(detail.movement.config(detail, detail.movement))
        ]),
        events: derive([
          run(focus$3(), function (menu, simulatedEvent) {
            var event = simulatedEvent.event;
            menu.getSystem().getByDom(event.target).each(function (item) {
              Highlighting.highlight(menu, item);
              simulatedEvent.stop();
              emitWith(menu, focus$4(), {
                menu: menu,
                item: item
              });
            });
          }),
          run(hover(), function (menu, simulatedEvent) {
            var item = simulatedEvent.event.item;
            Highlighting.highlight(menu, item);
          })
        ]),
        components: components,
        eventOrder: detail.eventOrder,
        domModification: { attributes: { role: 'menu' } }
      };
    };

    var Menu = composite$1({
      name: 'Menu',
      configFields: schema$d(),
      partFields: parts$1(),
      factory: make$1
    });

    var transpose = function (obj) {
      return tupleMap(obj, function (v, k) {
        return {
          k: v,
          v: k
        };
      });
    };
    var trace = function (items, byItem, byMenu, finish) {
      return get$1(byMenu, finish).bind(function (triggerItem) {
        return get$1(items, triggerItem).bind(function (triggerMenu) {
          var rest = trace(items, byItem, byMenu, triggerMenu);
          return Optional.some([triggerMenu].concat(rest));
        });
      }).getOr([]);
    };
    var generate$5 = function (menus, expansions) {
      var items = {};
      each$1(menus, function (menuItems, menu) {
        each(menuItems, function (item) {
          items[item] = menu;
        });
      });
      var byItem = expansions;
      var byMenu = transpose(expansions);
      var menuPaths = map$2(byMenu, function (_triggerItem, submenu) {
        return [submenu].concat(trace(items, byItem, byMenu, submenu));
      });
      return map$2(items, function (menu) {
        return get$1(menuPaths, menu).getOr([menu]);
      });
    };

    var init$3 = function () {
      var expansions = Cell({});
      var menus = Cell({});
      var paths = Cell({});
      var primary = Cell(Optional.none());
      var directory = Cell({});
      var clear = function () {
        expansions.set({});
        menus.set({});
        paths.set({});
        primary.set(Optional.none());
      };
      var isClear = function () {
        return primary.get().isNone();
      };
      var setMenuBuilt = function (menuName, built) {
        var _a;
        menus.set(__assign(__assign({}, menus.get()), (_a = {}, _a[menuName] = {
          type: 'prepared',
          menu: built
        }, _a)));
      };
      var setContents = function (sPrimary, sMenus, sExpansions, dir) {
        primary.set(Optional.some(sPrimary));
        expansions.set(sExpansions);
        menus.set(sMenus);
        directory.set(dir);
        var sPaths = generate$5(dir, sExpansions);
        paths.set(sPaths);
      };
      var getTriggeringItem = function (menuValue) {
        return find$1(expansions.get(), function (v, _k) {
          return v === menuValue;
        });
      };
      var getTriggerData = function (menuValue, getItemByValue, path) {
        return getPreparedMenu(menuValue).bind(function (menu) {
          return getTriggeringItem(menuValue).bind(function (triggeringItemValue) {
            return getItemByValue(triggeringItemValue).map(function (triggeredItem) {
              return {
                triggeredMenu: menu,
                triggeringItem: triggeredItem,
                triggeringPath: path
              };
            });
          });
        });
      };
      var getTriggeringPath = function (itemValue, getItemByValue) {
        var extraPath = filter(lookupItem(itemValue).toArray(), function (menuValue) {
          return getPreparedMenu(menuValue).isSome();
        });
        return get$1(paths.get(), itemValue).bind(function (path) {
          var revPath = reverse(extraPath.concat(path));
          var triggers = bind(revPath, function (menuValue, menuIndex) {
            return getTriggerData(menuValue, getItemByValue, revPath.slice(0, menuIndex + 1)).fold(function () {
              return primary.get().is(menuValue) ? [] : [Optional.none()];
            }, function (data) {
              return [Optional.some(data)];
            });
          });
          return sequence(triggers);
        });
      };
      var expand = function (itemValue) {
        return get$1(expansions.get(), itemValue).map(function (menu) {
          var current = get$1(paths.get(), itemValue).getOr([]);
          return [menu].concat(current);
        });
      };
      var collapse = function (itemValue) {
        return get$1(paths.get(), itemValue).bind(function (path) {
          return path.length > 1 ? Optional.some(path.slice(1)) : Optional.none();
        });
      };
      var refresh = function (itemValue) {
        return get$1(paths.get(), itemValue);
      };
      var getPreparedMenu = function (menuValue) {
        return lookupMenu(menuValue).bind(extractPreparedMenu);
      };
      var lookupMenu = function (menuValue) {
        return get$1(menus.get(), menuValue);
      };
      var lookupItem = function (itemValue) {
        return get$1(expansions.get(), itemValue);
      };
      var otherMenus = function (path) {
        var menuValues = directory.get();
        return difference(keys(menuValues), path);
      };
      var getPrimary = function () {
        return primary.get().bind(getPreparedMenu);
      };
      var getMenus = function () {
        return menus.get();
      };
      return {
        setMenuBuilt: setMenuBuilt,
        setContents: setContents,
        expand: expand,
        refresh: refresh,
        collapse: collapse,
        lookupMenu: lookupMenu,
        lookupItem: lookupItem,
        otherMenus: otherMenus,
        getPrimary: getPrimary,
        getMenus: getMenus,
        clear: clear,
        isClear: isClear,
        getTriggeringPath: getTriggeringPath
      };
    };
    var extractPreparedMenu = function (prep) {
      return prep.type === 'prepared' ? Optional.some(prep.menu) : Optional.none();
    };
    var LayeredState = {
      init: init$3,
      extractPreparedMenu: extractPreparedMenu
    };

    var make$2 = function (detail, _rawUiSpec) {
      var submenuParentItems = Cell(Optional.none());
      var buildMenus = function (container, primaryName, menus) {
        return map$2(menus, function (spec, name) {
          var makeSketch = function () {
            return Menu.sketch(__assign(__assign({}, spec), {
              value: name,
              markers: detail.markers,
              fakeFocus: detail.fakeFocus,
              onHighlight: detail.onHighlight,
              focusManager: detail.fakeFocus ? highlights() : dom()
            }));
          };
          return name === primaryName ? {
            type: 'prepared',
            menu: container.getSystem().build(makeSketch())
          } : {
            type: 'notbuilt',
            nbMenu: makeSketch
          };
        });
      };
      var layeredState = LayeredState.init();
      var setup = function (container) {
        var componentMap = buildMenus(container, detail.data.primary, detail.data.menus);
        var directory = toDirectory();
        layeredState.setContents(detail.data.primary, componentMap, detail.data.expansions, directory);
        return layeredState.getPrimary();
      };
      var getItemValue = function (item) {
        return Representing.getValue(item).value;
      };
      var getItemByValue = function (_container, menus, itemValue) {
        return findMap(menus, function (menu) {
          if (!menu.getSystem().isConnected()) {
            return Optional.none();
          }
          var candidates = Highlighting.getCandidates(menu);
          return find(candidates, function (c) {
            return getItemValue(c) === itemValue;
          });
        });
      };
      var toDirectory = function (_container) {
        return map$2(detail.data.menus, function (data, _menuName) {
          return bind(data.items, function (item) {
            return item.type === 'separator' ? [] : [item.data.value];
          });
        });
      };
      var setActiveMenu = function (container, menu) {
        Highlighting.highlight(container, menu);
        Highlighting.getHighlighted(menu).orThunk(function () {
          return Highlighting.getFirst(menu);
        }).each(function (item) {
          dispatch(container, item.element, focusItem());
        });
      };
      var getMenus = function (state, menuValues) {
        return cat(map(menuValues, function (mv) {
          return state.lookupMenu(mv).bind(function (prep) {
            return prep.type === 'prepared' ? Optional.some(prep.menu) : Optional.none();
          });
        }));
      };
      var closeOthers = function (container, state, path) {
        var others = getMenus(state, state.otherMenus(path));
        each(others, function (o) {
          remove$5(o.element, [detail.markers.backgroundMenu]);
          if (!detail.stayInDom) {
            Replacing.remove(container, o);
          }
        });
      };
      var getSubmenuParents = function (container) {
        return submenuParentItems.get().getOrThunk(function () {
          var r = {};
          var items = descendants(container.element, '.' + detail.markers.item);
          var parentItems = filter(items, function (i) {
            return get$3(i, 'aria-haspopup') === 'true';
          });
          each(parentItems, function (i) {
            container.getSystem().getByDom(i).each(function (itemComp) {
              var key = getItemValue(itemComp);
              r[key] = itemComp;
            });
          });
          submenuParentItems.set(Optional.some(r));
          return r;
        });
      };
      var updateAriaExpansions = function (container, path) {
        var parentItems = getSubmenuParents(container);
        each$1(parentItems, function (v, k) {
          var expanded = contains(path, k);
          set$1(v.element, 'aria-expanded', expanded);
        });
      };
      var updateMenuPath = function (container, state, path) {
        return Optional.from(path[0]).bind(function (latestMenuName) {
          return state.lookupMenu(latestMenuName).bind(function (menuPrep) {
            if (menuPrep.type === 'notbuilt') {
              return Optional.none();
            } else {
              var activeMenu = menuPrep.menu;
              var rest = getMenus(state, path.slice(1));
              each(rest, function (r) {
                add$2(r.element, detail.markers.backgroundMenu);
              });
              if (!inBody(activeMenu.element)) {
                Replacing.append(container, premade$1(activeMenu));
              }
              remove$5(activeMenu.element, [detail.markers.backgroundMenu]);
              setActiveMenu(container, activeMenu);
              closeOthers(container, state, path);
              return Optional.some(activeMenu);
            }
          });
        });
      };
      var ExpandHighlightDecision;
      (function (ExpandHighlightDecision) {
        ExpandHighlightDecision[ExpandHighlightDecision['HighlightSubmenu'] = 0] = 'HighlightSubmenu';
        ExpandHighlightDecision[ExpandHighlightDecision['HighlightParent'] = 1] = 'HighlightParent';
      }(ExpandHighlightDecision || (ExpandHighlightDecision = {})));
      var buildIfRequired = function (container, menuName, menuPrep) {
        if (menuPrep.type === 'notbuilt') {
          var menu = container.getSystem().build(menuPrep.nbMenu());
          layeredState.setMenuBuilt(menuName, menu);
          return menu;
        } else {
          return menuPrep.menu;
        }
      };
      var expandRight = function (container, item, decision) {
        if (decision === void 0) {
          decision = ExpandHighlightDecision.HighlightSubmenu;
        }
        var value = getItemValue(item);
        return layeredState.expand(value).bind(function (path) {
          updateAriaExpansions(container, path);
          return Optional.from(path[0]).bind(function (menuName) {
            return layeredState.lookupMenu(menuName).bind(function (activeMenuPrep) {
              var activeMenu = buildIfRequired(container, menuName, activeMenuPrep);
              if (!inBody(activeMenu.element)) {
                Replacing.append(container, premade$1(activeMenu));
              }
              detail.onOpenSubmenu(container, item, activeMenu, reverse(path));
              if (decision === ExpandHighlightDecision.HighlightSubmenu) {
                Highlighting.highlightFirst(activeMenu);
                return updateMenuPath(container, layeredState, path);
              } else {
                Highlighting.dehighlightAll(activeMenu);
                return Optional.some(item);
              }
            });
          });
        });
      };
      var collapseLeft = function (container, item) {
        var value = getItemValue(item);
        return layeredState.collapse(value).bind(function (path) {
          updateAriaExpansions(container, path);
          return updateMenuPath(container, layeredState, path).map(function (activeMenu) {
            detail.onCollapseMenu(container, item, activeMenu);
            return activeMenu;
          });
        });
      };
      var updateView = function (container, item) {
        var value = getItemValue(item);
        return layeredState.refresh(value).bind(function (path) {
          updateAriaExpansions(container, path);
          return updateMenuPath(container, layeredState, path);
        });
      };
      var onRight = function (container, item) {
        return inside(item.element) ? Optional.none() : expandRight(container, item, ExpandHighlightDecision.HighlightSubmenu);
      };
      var onLeft = function (container, item) {
        return inside(item.element) ? Optional.none() : collapseLeft(container, item);
      };
      var onEscape = function (container, item) {
        return collapseLeft(container, item).orThunk(function () {
          return detail.onEscape(container, item).map(function () {
            return container;
          });
        });
      };
      var keyOnItem = function (f) {
        return function (container, simulatedEvent) {
          return closest$3(simulatedEvent.getSource(), '.' + detail.markers.item).bind(function (target) {
            return container.getSystem().getByDom(target).toOptional().bind(function (item) {
              return f(container, item).map(always);
            });
          });
        };
      };
      var events = derive([
        run(focus$4(), function (sandbox, simulatedEvent) {
          var item = simulatedEvent.event.item;
          layeredState.lookupItem(getItemValue(item)).each(function () {
            var menu = simulatedEvent.event.menu;
            Highlighting.highlight(sandbox, menu);
            var value = getItemValue(simulatedEvent.event.item);
            layeredState.refresh(value).each(function (path) {
              return closeOthers(sandbox, layeredState, path);
            });
          });
        }),
        runOnExecute(function (component, simulatedEvent) {
          var target = simulatedEvent.event.target;
          component.getSystem().getByDom(target).each(function (item) {
            var itemValue = getItemValue(item);
            if (itemValue.indexOf('collapse-item') === 0) {
              collapseLeft(component, item);
            }
            expandRight(component, item, ExpandHighlightDecision.HighlightSubmenu).fold(function () {
              detail.onExecute(component, item);
            }, noop);
          });
        }),
        runOnAttached(function (container, _simulatedEvent) {
          setup(container).each(function (primary) {
            Replacing.append(container, premade$1(primary));
            detail.onOpenMenu(container, primary);
            if (detail.highlightImmediately) {
              setActiveMenu(container, primary);
            }
          });
        })
      ].concat(detail.navigateOnHover ? [run(hover(), function (sandbox, simulatedEvent) {
          var item = simulatedEvent.event.item;
          updateView(sandbox, item);
          expandRight(sandbox, item, ExpandHighlightDecision.HighlightParent);
          detail.onHover(sandbox, item);
        })] : []));
      var getActiveItem = function (container) {
        return Highlighting.getHighlighted(container).bind(Highlighting.getHighlighted);
      };
      var collapseMenuApi = function (container) {
        getActiveItem(container).each(function (currentItem) {
          collapseLeft(container, currentItem);
        });
      };
      var highlightPrimary = function (container) {
        layeredState.getPrimary().each(function (primary) {
          setActiveMenu(container, primary);
        });
      };
      var extractMenuFromContainer = function (container) {
        return Optional.from(container.components()[0]).filter(function (comp) {
          return get$3(comp.element, 'role') === 'menu';
        });
      };
      var repositionMenus = function (container) {
        var maybeActivePrimary = layeredState.getPrimary().bind(function (primary) {
          return getActiveItem(container).bind(function (currentItem) {
            var itemValue = getItemValue(currentItem);
            var allMenus = values(layeredState.getMenus());
            var preparedMenus = cat(map(allMenus, LayeredState.extractPreparedMenu));
            return layeredState.getTriggeringPath(itemValue, function (v) {
              return getItemByValue(container, preparedMenus, v);
            });
          }).map(function (triggeringPath) {
            return {
              primary: primary,
              triggeringPath: triggeringPath
            };
          });
        });
        maybeActivePrimary.fold(function () {
          extractMenuFromContainer(container).each(function (primaryMenu) {
            detail.onRepositionMenu(container, primaryMenu, []);
          });
        }, function (_a) {
          var primary = _a.primary, triggeringPath = _a.triggeringPath;
          detail.onRepositionMenu(container, primary, triggeringPath);
        });
      };
      var apis = {
        collapseMenu: collapseMenuApi,
        highlightPrimary: highlightPrimary,
        repositionMenus: repositionMenus
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        markers: detail.markers,
        behaviours: augment(detail.tmenuBehaviours, [
          Keying.config({
            mode: 'special',
            onRight: keyOnItem(onRight),
            onLeft: keyOnItem(onLeft),
            onEscape: keyOnItem(onEscape),
            focusIn: function (container, _keyInfo) {
              layeredState.getPrimary().each(function (primary) {
                dispatch(container, primary.element, focusItem());
              });
            }
          }),
          Highlighting.config({
            highlightClass: detail.markers.selectedMenu,
            itemClass: detail.markers.menu
          }),
          Composing.config({
            find: function (container) {
              return Highlighting.getHighlighted(container);
            }
          }),
          Replacing.config({})
        ]),
        eventOrder: detail.eventOrder,
        apis: apis,
        events: events
      };
    };
    var collapseItem = constant('collapse-item');

    var tieredData = function (primary, menus, expansions) {
      return {
        primary: primary,
        menus: menus,
        expansions: expansions
      };
    };
    var singleData = function (name, menu) {
      return {
        primary: name,
        menus: wrap$1(name, menu),
        expansions: {}
      };
    };
    var collapseItem$1 = function (text) {
      return {
        value: generate$1(collapseItem()),
        meta: { text: text }
      };
    };
    var tieredMenu = single$2({
      name: 'TieredMenu',
      configFields: [
        onStrictKeyboardHandler('onExecute'),
        onStrictKeyboardHandler('onEscape'),
        onStrictHandler('onOpenMenu'),
        onStrictHandler('onOpenSubmenu'),
        onHandler('onRepositionMenu'),
        onHandler('onCollapseMenu'),
        defaulted$1('highlightImmediately', true),
        strictObjOf('data', [
          strict$1('primary'),
          strict$1('menus'),
          strict$1('expansions')
        ]),
        defaulted$1('fakeFocus', false),
        onHandler('onHighlight'),
        onHandler('onHover'),
        tieredMenuMarkers(),
        strict$1('dom'),
        defaulted$1('navigateOnHover', true),
        defaulted$1('stayInDom', false),
        field$1('tmenuBehaviours', [
          Keying,
          Highlighting,
          Composing,
          Replacing
        ]),
        defaulted$1('eventOrder', {})
      ],
      apis: {
        collapseMenu: function (apis, tmenu) {
          apis.collapseMenu(tmenu);
        },
        highlightPrimary: function (apis, tmenu) {
          apis.highlightPrimary(tmenu);
        },
        repositionMenus: function (apis, tmenu) {
          apis.repositionMenus(tmenu);
        }
      },
      factory: make$2,
      extraApis: {
        tieredData: tieredData,
        singleData: singleData,
        collapseItem: collapseItem$1
      }
    });

    var makeMenu = function (detail, menuSandbox, anchor, menuSpec, getBounds) {
      var lazySink = function () {
        return detail.lazySink(menuSandbox);
      };
      var layouts = menuSpec.type === 'horizontal' ? {
        layouts: {
          onLtr: function () {
            return belowOrAbove();
          },
          onRtl: function () {
            return belowOrAboveRtl();
          }
        }
      } : {};
      var isFirstTierSubmenu = function (triggeringPaths) {
        return triggeringPaths.length === 2;
      };
      var getSubmenuLayouts = function (triggeringPaths) {
        return isFirstTierSubmenu(triggeringPaths) ? layouts : {};
      };
      return tieredMenu.sketch({
        dom: { tag: 'div' },
        data: menuSpec.data,
        markers: menuSpec.menu.markers,
        highlightImmediately: menuSpec.menu.highlightImmediately,
        onEscape: function () {
          Sandboxing.close(menuSandbox);
          detail.onEscape.map(function (handler) {
            return handler(menuSandbox);
          });
          return Optional.some(true);
        },
        onExecute: function () {
          return Optional.some(true);
        },
        onOpenMenu: function (tmenu, menu) {
          Positioning.positionWithinBounds(lazySink().getOrDie(), anchor, menu, getBounds());
        },
        onOpenSubmenu: function (tmenu, item, submenu, triggeringPaths) {
          var sink = lazySink().getOrDie();
          Positioning.position(sink, __assign({
            anchor: 'submenu',
            item: item
          }, getSubmenuLayouts(triggeringPaths)), submenu);
        },
        onRepositionMenu: function (tmenu, primaryMenu, submenuTriggers) {
          var sink = lazySink().getOrDie();
          Positioning.positionWithinBounds(sink, anchor, primaryMenu, getBounds());
          each(submenuTriggers, function (st) {
            var submenuLayouts = getSubmenuLayouts(st.triggeringPath);
            Positioning.position(sink, __assign({
              anchor: 'submenu',
              item: st.triggeringItem
            }, submenuLayouts), st.triggeredMenu);
          });
        }
      });
    };
    var factory = function (detail, spec) {
      var isPartOfRelated = function (sandbox, queryElem) {
        var related = detail.getRelated(sandbox);
        return related.exists(function (rel) {
          return isPartOf(rel, queryElem);
        });
      };
      var setContent = function (sandbox, thing) {
        Sandboxing.setContent(sandbox, thing);
      };
      var showAt = function (sandbox, anchor, thing) {
        showWithin(sandbox, anchor, thing, Optional.none());
      };
      var showWithin = function (sandbox, anchor, thing, boxElement) {
        showWithinBounds(sandbox, anchor, thing, function () {
          return boxElement.map(function (elem) {
            return box(elem);
          });
        });
      };
      var showWithinBounds = function (sandbox, anchor, thing, getBounds) {
        var sink = detail.lazySink(sandbox).getOrDie();
        Sandboxing.openWhileCloaked(sandbox, thing, function () {
          return Positioning.positionWithinBounds(sink, anchor, sandbox, getBounds());
        });
        Representing.setValue(sandbox, Optional.some({
          mode: 'position',
          anchor: anchor,
          getBounds: getBounds
        }));
      };
      var showMenuAt = function (sandbox, anchor, menuSpec) {
        showMenuWithinBounds(sandbox, anchor, menuSpec, function () {
          return Optional.none();
        });
      };
      var showMenuWithinBounds = function (sandbox, anchor, menuSpec, getBounds) {
        var menu = makeMenu(detail, sandbox, anchor, menuSpec, getBounds);
        Sandboxing.open(sandbox, menu);
        Representing.setValue(sandbox, Optional.some({
          mode: 'menu',
          menu: menu
        }));
      };
      var hide = function (sandbox) {
        if (Sandboxing.isOpen(sandbox)) {
          Representing.setValue(sandbox, Optional.none());
          Sandboxing.close(sandbox);
        }
      };
      var getContent = function (sandbox) {
        return Sandboxing.getState(sandbox);
      };
      var reposition = function (sandbox) {
        if (Sandboxing.isOpen(sandbox)) {
          Representing.getValue(sandbox).each(function (state) {
            switch (state.mode) {
            case 'menu':
              Sandboxing.getState(sandbox).each(function (tmenu) {
                tieredMenu.repositionMenus(tmenu);
              });
              break;
            case 'position':
              var sink = detail.lazySink(sandbox).getOrDie();
              Positioning.positionWithinBounds(sink, state.anchor, sandbox, state.getBounds());
              break;
            }
          });
        }
      };
      var apis = {
        setContent: setContent,
        showAt: showAt,
        showWithin: showWithin,
        showWithinBounds: showWithinBounds,
        showMenuAt: showMenuAt,
        showMenuWithinBounds: showMenuWithinBounds,
        hide: hide,
        getContent: getContent,
        reposition: reposition,
        isOpen: Sandboxing.isOpen
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        behaviours: augment(detail.inlineBehaviours, [
          Sandboxing.config({
            isPartOf: function (sandbox, data, queryElem) {
              return isPartOf(data, queryElem) || isPartOfRelated(sandbox, queryElem);
            },
            getAttachPoint: function (sandbox) {
              return detail.lazySink(sandbox).getOrDie();
            },
            onOpen: function (sandbox) {
              detail.onShow(sandbox);
            },
            onClose: function (sandbox) {
              detail.onHide(sandbox);
            }
          }),
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: Optional.none()
            }
          }),
          Receiving.config({
            channels: __assign(__assign({}, receivingChannel(__assign({ isExtraPart: spec.isExtraPart }, detail.fireDismissalEventInstead.map(function (fe) {
              return { fireEventInstead: { event: fe.event } };
            }).getOr({})))), receivingChannel$1(__assign(__assign({}, detail.fireRepositionEventInstead.map(function (fe) {
              return { fireEventInstead: { event: fe.event } };
            }).getOr({})), { doReposition: reposition })))
          })
        ]),
        eventOrder: detail.eventOrder,
        apis: apis
      };
    };
    var InlineView = single$2({
      name: 'InlineView',
      configFields: [
        strict$1('lazySink'),
        onHandler('onShow'),
        onHandler('onHide'),
        optionFunction('onEscape'),
        field$1('inlineBehaviours', [
          Sandboxing,
          Representing,
          Receiving
        ]),
        optionObjOf('fireDismissalEventInstead', [defaulted$1('event', dismissRequested())]),
        optionObjOf('fireRepositionEventInstead', [defaulted$1('event', repositionRequested())]),
        defaulted$1('getRelated', Optional.none),
        defaulted$1('isExtraPart', never),
        defaulted$1('eventOrder', Optional.none)
      ],
      factory: factory,
      apis: {
        showAt: function (apis, component, anchor, thing) {
          apis.showAt(component, anchor, thing);
        },
        showWithin: function (apis, component, anchor, thing, boxElement) {
          apis.showWithin(component, anchor, thing, boxElement);
        },
        showWithinBounds: function (apis, component, anchor, thing, bounds) {
          apis.showWithinBounds(component, anchor, thing, bounds);
        },
        showMenuAt: function (apis, component, anchor, menuSpec) {
          apis.showMenuAt(component, anchor, menuSpec);
        },
        showMenuWithinBounds: function (apis, component, anchor, menuSpec, bounds) {
          apis.showMenuWithinBounds(component, anchor, menuSpec, bounds);
        },
        hide: function (apis, component) {
          apis.hide(component);
        },
        isOpen: function (apis, component) {
          return apis.isOpen(component);
        },
        getContent: function (apis, component) {
          return apis.getContent(component);
        },
        setContent: function (apis, component, thing) {
          apis.setContent(component, thing);
        },
        reposition: function (apis, component) {
          apis.reposition(component);
        }
      }
    });

    var westEdgeX$1 = function (anchor) {
      return anchor.x;
    };
    var middleX$1 = function (anchor, element) {
      return anchor.x + anchor.width / 2 - element.width / 2;
    };
    var eastEdgeX$1 = function (anchor, element) {
      return anchor.x + anchor.width - element.width;
    };
    var northY$2 = function (anchor) {
      return anchor.y;
    };
    var southY$2 = function (anchor, element) {
      return anchor.y + anchor.height - element.height;
    };
    var southeast$3 = function (anchor, element, bubbles) {
      return nu$7(eastEdgeX$1(anchor, element), southY$2(anchor, element), bubbles.innerSoutheast(), northwest(), boundsRestriction(anchor, {
        right: 0,
        bottom: 3
      }), 'layout-inner-se');
    };
    var southwest$3 = function (anchor, element, bubbles) {
      return nu$7(westEdgeX$1(anchor), southY$2(anchor, element), bubbles.innerSouthwest(), northeast(), boundsRestriction(anchor, {
        left: 1,
        bottom: 3
      }), 'layout-inner-sw');
    };
    var northeast$3 = function (anchor, element, bubbles) {
      return nu$7(eastEdgeX$1(anchor, element), northY$2(anchor), bubbles.innerNortheast(), southwest(), boundsRestriction(anchor, {
        right: 0,
        top: 2
      }), 'layout-inner-ne');
    };
    var northwest$3 = function (anchor, element, bubbles) {
      return nu$7(westEdgeX$1(anchor), northY$2(anchor), bubbles.innerNorthwest(), southeast(), boundsRestriction(anchor, {
        left: 1,
        top: 2
      }), 'layout-inner-nw');
    };
    var north$3 = function (anchor, element, bubbles) {
      return nu$7(middleX$1(anchor, element), northY$2(anchor), bubbles.innerNorth(), south(), boundsRestriction(anchor, { top: 2 }), 'layout-inner-n');
    };
    var south$3 = function (anchor, element, bubbles) {
      return nu$7(middleX$1(anchor, element), southY$2(anchor, element), bubbles.innerSouth(), north(), boundsRestriction(anchor, { bottom: 3 }), 'layout-inner-s');
    };

    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Delay');

    var factory$1 = function (detail) {
      var events = events$7(detail.action);
      var tag = detail.dom.tag;
      var lookupAttr = function (attr) {
        return get$1(detail.dom, 'attributes').bind(function (attrs) {
          return get$1(attrs, attr);
        });
      };
      var getModAttributes = function () {
        if (tag === 'button') {
          var type = lookupAttr('type').getOr('button');
          var roleAttrs = lookupAttr('role').map(function (role) {
            return { role: role };
          }).getOr({});
          return __assign({ type: type }, roleAttrs);
        } else {
          var role = lookupAttr('role').getOr('button');
          return { role: role };
        }
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: detail.components,
        events: events,
        behaviours: SketchBehaviours.augment(detail.buttonBehaviours, [
          Focusing.config({}),
          Keying.config({
            mode: 'execution',
            useSpace: true,
            useEnter: true
          })
        ]),
        domModification: { attributes: getModAttributes() },
        eventOrder: detail.eventOrder
      };
    };
    var Button = single$2({
      name: 'Button',
      factory: factory$1,
      configFields: [
        defaulted$1('uid', undefined),
        strict$1('dom'),
        defaulted$1('components', []),
        SketchBehaviours.field('buttonBehaviours', [
          Focusing,
          Keying
        ]),
        option('action'),
        option('role'),
        defaulted$1('eventOrder', {})
      ]
    });

    var record = function (spec) {
      var uid = isSketchSpec(spec) && hasNonNullableKey(spec, 'uid') ? spec.uid : generate$2('memento');
      var get = function (anyInSystem) {
        return anyInSystem.getSystem().getByUid(uid).getOrDie();
      };
      var getOpt = function (anyInSystem) {
        return anyInSystem.getSystem().getByUid(uid).toOptional();
      };
      var asSpec = function () {
        return __assign(__assign({}, spec), { uid: uid });
      };
      return {
        get: get,
        getOpt: getOpt,
        asSpec: asSpec
      };
    };

    var defaultIcon = function (icons) {
      return Optional.from(icons()['temporary-placeholder']).getOr('!not found!');
    };
    var get$e = function (name, icons) {
      return Optional.from(icons()[name.toLowerCase()]).getOrThunk(function () {
        return defaultIcon(icons);
      });
    };
    var getOr = function (name, icons, fallback) {
      return Optional.from(icons()[name.toLowerCase()]).or(fallback).getOrThunk(function () {
        return defaultIcon(icons);
      });
    };
    var getFirst$1 = function (names, icons) {
      return findMap(names, function (name) {
        return Optional.from(icons()[name.toLowerCase()]);
      }).getOrThunk(function () {
        return defaultIcon(icons);
      });
    };

    var notificationIconMap = {
      success: 'checkmark',
      error: 'warning',
      err: 'error',
      warning: 'warning',
      warn: 'warning',
      info: 'info'
    };
    var factory$2 = function (detail) {
      var memBannerText = record({
        dom: {
          tag: 'p',
          innerHtml: detail.translationProvider(detail.text)
        },
        behaviours: derive$1([Replacing.config({})])
      });
      var renderPercentBar = function (percent) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-bar'],
            attributes: { style: 'width: ' + percent + '%' }
          }
        };
      };
      var renderPercentText = function (percent) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-text'],
            innerHtml: percent + '%'
          }
        };
      };
      var memBannerProgress = record({
        dom: {
          tag: 'div',
          classes: detail.progress ? [
            'tox-progress-bar',
            'tox-progress-indicator'
          ] : ['tox-progress-bar']
        },
        components: [
          {
            dom: {
              tag: 'div',
              classes: ['tox-bar-container']
            },
            components: [renderPercentBar(0)]
          },
          renderPercentText(0)
        ],
        behaviours: derive$1([Replacing.config({})])
      });
      var updateProgress = function (comp, percent) {
        if (comp.getSystem().isConnected()) {
          memBannerProgress.getOpt(comp).each(function (progress) {
            Replacing.set(progress, [
              {
                dom: {
                  tag: 'div',
                  classes: ['tox-bar-container']
                },
                components: [renderPercentBar(percent)]
              },
              renderPercentText(percent)
            ]);
          });
        }
      };
      var updateText = function (comp, text$1) {
        if (comp.getSystem().isConnected()) {
          var banner = memBannerText.get(comp);
          Replacing.set(banner, [text(text$1)]);
        }
      };
      var apis = {
        updateProgress: updateProgress,
        updateText: updateText
      };
      var iconChoices = flatten([
        detail.icon.toArray(),
        detail.level.toArray(),
        detail.level.bind(function (level) {
          return Optional.from(notificationIconMap[level]);
        }).toArray()
      ]);
      var memButton = record(Button.sketch({
        dom: {
          tag: 'button',
          classes: [
            'tox-notification__dismiss',
            'tox-button',
            'tox-button--naked',
            'tox-button--icon'
          ]
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-icon'],
              innerHtml: get$e('close', detail.iconProvider),
              attributes: { 'aria-label': detail.translationProvider('Close') }
            }
          }],
        action: function (comp) {
          detail.onAction(comp);
        }
      }));
      var components = [
        {
          dom: {
            tag: 'div',
            classes: ['tox-notification__icon'],
            innerHtml: getFirst$1(iconChoices, detail.iconProvider)
          }
        },
        {
          dom: {
            tag: 'div',
            classes: ['tox-notification__body']
          },
          components: [memBannerText.asSpec()],
          behaviours: derive$1([Replacing.config({})])
        }
      ];
      return {
        uid: detail.uid,
        dom: {
          tag: 'div',
          attributes: { role: 'alert' },
          classes: detail.level.map(function (level) {
            return [
              'tox-notification',
              'tox-notification--in',
              'tox-notification--' + level
            ];
          }).getOr([
            'tox-notification',
            'tox-notification--in'
          ])
        },
        behaviours: derive$1([
          Focusing.config({}),
          config('notification-events', [run(focusin(), function (comp) {
              memButton.getOpt(comp).each(Focusing.focus);
            })])
        ]),
        components: components.concat(detail.progress ? [memBannerProgress.asSpec()] : []).concat(!detail.closeButton ? [] : [memButton.asSpec()]),
        apis: apis
      };
    };
    var Notification = single$2({
      name: 'Notification',
      factory: factory$2,
      configFields: [
        option('level'),
        strict$1('progress'),
        strict$1('icon'),
        strict$1('onAction'),
        strict$1('text'),
        strict$1('iconProvider'),
        strict$1('translationProvider'),
        defaultedBoolean('closeButton', true)
      ],
      apis: {
        updateProgress: function (apis, comp, percent) {
          apis.updateProgress(comp, percent);
        },
        updateText: function (apis, comp, text) {
          apis.updateText(comp, text);
        }
      }
    });

    function NotificationManagerImpl (editor, extras, uiMothership) {
      var backstage = extras.backstage;
      var getLayoutDirection = function (rel) {
        switch (rel) {
        case 'bc-bc':
          return south$3;
        case 'tc-tc':
          return north$3;
        case 'tc-bc':
          return north$1;
        case 'bc-tc':
        default:
          return south$1;
        }
      };
      var prePositionNotifications = function (notifications) {
        each(notifications, function (notification) {
          return notification.moveTo(0, 0);
        });
      };
      var positionNotifications = function (notifications) {
        if (notifications.length > 0) {
          head(notifications).each(function (firstItem) {
            return firstItem.moveRel(null, 'banner');
          });
          each(notifications, function (notification, index) {
            if (index > 0) {
              notification.moveRel(notifications[index - 1].getEl(), 'bc-tc');
            }
          });
        }
      };
      var reposition = function (notifications) {
        prePositionNotifications(notifications);
        positionNotifications(notifications);
      };
      var open = function (settings, closeCallback) {
        var hideCloseButton = !settings.closeButton && settings.timeout && (settings.timeout > 0 || settings.timeout < 0);
        var close = function () {
          closeCallback();
          InlineView.hide(notificationWrapper);
        };
        var notification = build$1(Notification.sketch({
          text: settings.text,
          level: contains([
            'success',
            'error',
            'warning',
            'warn',
            'info'
          ], settings.type) ? settings.type : undefined,
          progress: settings.progressBar === true,
          icon: Optional.from(settings.icon),
          closeButton: !hideCloseButton,
          onAction: close,
          iconProvider: backstage.shared.providers.icons,
          translationProvider: backstage.shared.providers.translate
        }));
        var notificationWrapper = build$1(InlineView.sketch(__assign({
          dom: {
            tag: 'div',
            classes: ['tox-notifications-container']
          },
          lazySink: extras.backstage.shared.getSink,
          fireDismissalEventInstead: {}
        }, backstage.shared.header.isPositionedAtTop() ? {} : { fireRepositionEventInstead: {} })));
        uiMothership.add(notificationWrapper);
        if (settings.timeout > 0) {
          global$2.setTimeout(function () {
            close();
          }, settings.timeout);
        }
        return {
          close: close,
          moveTo: function (x, y) {
            InlineView.showAt(notificationWrapper, {
              anchor: 'makeshift',
              x: x,
              y: y
            }, premade$1(notification));
          },
          moveRel: function (element, rel) {
            if (rel !== 'banner') {
              var layoutDirection_1 = getLayoutDirection(rel);
              var nodeAnchor = {
                anchor: 'node',
                root: body(),
                node: Optional.some(SugarElement.fromDom(element)),
                layouts: {
                  onRtl: function () {
                    return [layoutDirection_1];
                  },
                  onLtr: function () {
                    return [layoutDirection_1];
                  }
                }
              };
              InlineView.showAt(notificationWrapper, nodeAnchor, premade$1(notification));
            } else {
              InlineView.showAt(notificationWrapper, extras.backstage.shared.anchors.banner(), premade$1(notification));
            }
          },
          text: function (nuText) {
            Notification.updateText(notification, nuText);
          },
          settings: settings,
          getEl: function () {
            return notification.element.dom;
          },
          progressBar: {
            value: function (percent) {
              Notification.updateProgress(notification, percent);
            }
          }
        };
      };
      var close = function (notification) {
        notification.close();
      };
      var getArgs = function (notification) {
        return notification.settings;
      };
      return {
        open: open,
        close: close,
        reposition: reposition,
        getArgs: getArgs
      };
    }

    var first = function (fn, rate) {
      var timer = null;
      var cancel = function () {
        if (timer !== null) {
          clearTimeout(timer);
          timer = null;
        }
      };
      var throttle = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        if (timer === null) {
          timer = setTimeout(function () {
            fn.apply(null, args);
            timer = null;
          }, rate);
        }
      };
      return {
        cancel: cancel,
        throttle: throttle
      };
    };
    var last$2 = function (fn, rate) {
      var timer = null;
      var cancel = function () {
        if (timer !== null) {
          clearTimeout(timer);
          timer = null;
        }
      };
      var throttle = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        if (timer !== null) {
          clearTimeout(timer);
        }
        timer = setTimeout(function () {
          fn.apply(null, args);
          timer = null;
        }, rate);
      };
      return {
        cancel: cancel,
        throttle: throttle
      };
    };

    var global$3 = tinymce.util.Tools.resolve('tinymce.dom.TextSeeker');

    var isBoundary = function (dom, node) {
      return dom.isBlock(node) || contains([
        'BR',
        'IMG',
        'HR',
        'INPUT'
      ], node.nodeName) || dom.getContentEditable(node) === 'false';
    };
    var repeatLeft = function (dom, node, offset, process, rootNode) {
      var search = global$3(dom, function (node) {
        return isBoundary(dom, node);
      });
      return Optional.from(search.backwards(node, offset, process, rootNode));
    };

    var autocompleteSelector = '[data-mce-autocompleter]';
    var create$4 = function (editor, range) {
      return detect$4(SugarElement.fromDom(editor.selection.getNode())).getOrThunk(function () {
        var wrapper = SugarElement.fromHtml('<span data-mce-autocompleter="1" data-mce-bogus="1"></span>', editor.getDoc());
        append(wrapper, SugarElement.fromDom(range.extractContents()));
        range.insertNode(wrapper.dom);
        parent(wrapper).each(function (elm) {
          return elm.dom.normalize();
        });
        last$1(wrapper).map(function (last) {
          editor.selection.setCursorLocation(last.dom, getEnd(last));
        });
        return wrapper;
      });
    };
    var detect$4 = function (elm) {
      return closest$3(elm, autocompleteSelector);
    };

    var isValidTextRange = function (rng) {
      return rng.collapsed && rng.startContainer.nodeType === 3;
    };
    var getText = function (rng) {
      return rng.toString().replace(/\u00A0/g, ' ').replace(/\uFEFF/g, '');
    };
    var isWhitespace = function (chr) {
      return chr !== '' && ' \xA0\f\n\r\t\x0B'.indexOf(chr) !== -1;
    };

    var stripTriggerChar = function (text, triggerCh) {
      return text.substring(triggerCh.length);
    };
    var findChar = function (text, index, ch) {
      var i;
      for (i = index - 1; i >= 0; i--) {
        var char = text.charAt(i);
        if (isWhitespace(char)) {
          return Optional.none();
        }
        if (char === ch) {
          break;
        }
      }
      return Optional.some(i);
    };
    var findStart = function (dom, initRange, ch, minChars) {
      if (minChars === void 0) {
        minChars = 0;
      }
      if (!isValidTextRange(initRange)) {
        return Optional.none();
      }
      var findTriggerChIndex = function (element, offset, text) {
        return findChar(text, offset, ch).getOr(offset);
      };
      var root = dom.getParent(initRange.startContainer, dom.isBlock) || dom.getRoot();
      return repeatLeft(dom, initRange.startContainer, initRange.startOffset, findTriggerChIndex, root).bind(function (spot) {
        var range = initRange.cloneRange();
        range.setStart(spot.container, spot.offset);
        range.setEnd(initRange.endContainer, initRange.endOffset);
        if (range.collapsed) {
          return Optional.none();
        }
        var text = getText(range);
        var triggerCharIndex = text.lastIndexOf(ch);
        if (triggerCharIndex !== 0 || stripTriggerChar(text, ch).length < minChars) {
          return Optional.none();
        } else {
          return Optional.some({
            text: stripTriggerChar(text, ch),
            range: range,
            triggerChar: ch
          });
        }
      });
    };
    var getContext = function (dom, initRange, ch, minChars) {
      if (minChars === void 0) {
        minChars = 0;
      }
      return detect$4(SugarElement.fromDom(initRange.startContainer)).fold(function () {
        return findStart(dom, initRange, ch, minChars);
      }, function (elm) {
        var range = dom.createRng();
        range.selectNode(elm.dom);
        var text = getText(range);
        return Optional.some({
          range: range,
          text: stripTriggerChar(text, ch),
          triggerChar: ch
        });
      });
    };

    var setup = function (api, editor) {
      editor.on('keypress compositionend', api.onKeypress.throttle);
      editor.on('remove', api.onKeypress.cancel);
      var redirectKeyToItem = function (item, e) {
        emitWith(item, keydown(), { raw: e });
      };
      editor.on('keydown', function (e) {
        var getItem = function () {
          return api.getView().bind(Highlighting.getHighlighted);
        };
        if (e.which === 8) {
          api.onKeypress.throttle(e);
        }
        if (api.isActive()) {
          if (e.which === 27) {
            api.cancelIfNecessary();
          }
          if (api.isMenuOpen()) {
            if (e.which === 13) {
              getItem().each(emitExecute);
              e.preventDefault();
            } else if (e.which === 40) {
              getItem().fold(function () {
                api.getView().each(Highlighting.highlightFirst);
              }, function (item) {
                redirectKeyToItem(item, e);
              });
              e.preventDefault();
              e.stopImmediatePropagation();
            } else if (e.which === 37 || e.which === 38 || e.which === 39) {
              getItem().each(function (item) {
                redirectKeyToItem(item, e);
                e.preventDefault();
                e.stopImmediatePropagation();
              });
            }
          } else {
            if (e.which === 13 || e.which === 38 || e.which === 40) {
              api.cancelIfNecessary();
            }
          }
        }
      });
      editor.on('NodeChange', function (e) {
        if (api.isActive() && !api.isProcessingAction() && detect$4(SugarElement.fromDom(e.element)).isNone()) {
          api.cancelIfNecessary();
        }
      });
    };
    var AutocompleterEditorEvents = { setup: setup };

    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Promise');

    var point$1 = function (container, offset) {
      return {
        container: container,
        offset: offset
      };
    };

    var isText$1 = function (node) {
      return node.nodeType === TEXT;
    };
    var isElement$1 = function (node) {
      return node.nodeType === ELEMENT;
    };
    var toLast = function (node) {
      if (isText$1(node)) {
        return point$1(node, node.data.length);
      } else {
        var children = node.childNodes;
        return children.length > 0 ? toLast(children[children.length - 1]) : point$1(node, children.length);
      }
    };
    var toLeaf = function (node, offset) {
      var children = node.childNodes;
      if (children.length > 0 && offset < children.length) {
        return toLeaf(children[offset], 0);
      } else if (children.length > 0 && isElement$1(node) && children.length === offset) {
        return toLast(children[children.length - 1]);
      } else {
        return point$1(node, offset);
      }
    };

    var isPreviousCharContent = function (dom, leaf) {
      return repeatLeft(dom, leaf.container, leaf.offset, function (element, offset) {
        return offset === 0 ? -1 : offset;
      }, dom.getRoot()).filter(function (spot) {
        var char = spot.container.data.charAt(spot.offset - 1);
        return !isWhitespace(char);
      }).isSome();
    };
    var isStartOfWord = function (dom) {
      return function (rng) {
        var leaf = toLeaf(rng.startContainer, rng.startOffset);
        return !isPreviousCharContent(dom, leaf);
      };
    };
    var getTriggerContext = function (dom, initRange, database) {
      return findMap(database.triggerChars, function (ch) {
        return getContext(dom, initRange, ch);
      });
    };
    var lookup = function (editor, getDatabase) {
      var database = getDatabase();
      var rng = editor.selection.getRng();
      return getTriggerContext(editor.dom, rng, database).bind(function (context) {
        return lookupWithContext(editor, getDatabase, context);
      });
    };
    var lookupWithContext = function (editor, getDatabase, context, fetchOptions) {
      if (fetchOptions === void 0) {
        fetchOptions = {};
      }
      var database = getDatabase();
      var rng = editor.selection.getRng();
      var startText = rng.startContainer.nodeValue;
      var autocompleters = filter(database.lookupByChar(context.triggerChar), function (autocompleter) {
        return context.text.length >= autocompleter.minChars && autocompleter.matches.getOrThunk(function () {
          return isStartOfWord(editor.dom);
        })(context.range, startText, context.text);
      });
      if (autocompleters.length === 0) {
        return Optional.none();
      }
      var lookupData = global$4.all(map(autocompleters, function (ac) {
        var fetchResult = ac.fetch(context.text, ac.maxResults, fetchOptions);
        return fetchResult.then(function (results) {
          return {
            matchText: context.text,
            items: results,
            columns: ac.columns,
            onAction: ac.onAction,
            highlightOn: ac.highlightOn
          };
        });
      }));
      return Optional.some({
        lookupData: lookupData,
        context: context
      });
    };

    var separatorMenuItemSchema = objOf([
      strictString('type'),
      optionString('text')
    ]);
    var createSeparatorMenuItem = function (spec) {
      return asRaw('separatormenuitem', separatorMenuItemSchema, spec);
    };

    var autocompleterItemSchema = objOf([
      defaulted$1('type', 'autocompleteitem'),
      defaulted$1('active', false),
      defaulted$1('disabled', false),
      defaulted$1('meta', {}),
      strictString('value'),
      optionString('text'),
      optionString('icon')
    ]);
    var autocompleterSchema = objOf([
      strictString('type'),
      strictString('ch'),
      defaultedNumber('minChars', 1),
      defaulted$1('columns', 1),
      defaultedNumber('maxResults', 10),
      optionFunction('matches'),
      strictFunction('fetch'),
      strictFunction('onAction'),
      defaultedArrayOf('highlightOn', [], string)
    ]);
    var createSeparatorItem = function (spec) {
      return asRaw('Autocompleter.Separator', separatorMenuItemSchema, spec);
    };
    var createAutocompleterItem = function (spec) {
      return asRaw('Autocompleter.Item', autocompleterItemSchema, spec);
    };
    var createAutocompleter = function (spec) {
      return asRaw('Autocompleter', autocompleterSchema, spec);
    };

    var baseToolbarButtonFields = [
      defaultedBoolean('disabled', false),
      optionString('tooltip'),
      optionString('icon'),
      optionString('text'),
      defaultedFunction('onSetup', function () {
        return noop;
      })
    ];
    var toolbarButtonSchema = objOf([
      strictString('type'),
      strictFunction('onAction')
    ].concat(baseToolbarButtonFields));
    var createToolbarButton = function (spec) {
      return asRaw('toolbarbutton', toolbarButtonSchema, spec);
    };

    var baseToolbarToggleButtonFields = [defaultedBoolean('active', false)].concat(baseToolbarButtonFields);
    var toggleButtonSchema = objOf(baseToolbarToggleButtonFields.concat([
      strictString('type'),
      strictFunction('onAction')
    ]));
    var createToggleButton = function (spec) {
      return asRaw('ToggleButton', toggleButtonSchema, spec);
    };

    var contextBarFields = [
      defaultedFunction('predicate', never),
      defaultedStringEnum('scope', 'node', [
        'node',
        'editor'
      ]),
      defaultedStringEnum('position', 'selection', [
        'node',
        'selection',
        'line'
      ])
    ];

    var contextButtonFields = baseToolbarButtonFields.concat([
      defaulted$1('type', 'contextformbutton'),
      defaulted$1('primary', false),
      strictFunction('onAction'),
      state$1('original', identity)
    ]);
    var contextToggleButtonFields = baseToolbarToggleButtonFields.concat([
      defaulted$1('type', 'contextformbutton'),
      defaulted$1('primary', false),
      strictFunction('onAction'),
      state$1('original', identity)
    ]);
    var launchButtonFields = baseToolbarButtonFields.concat([defaulted$1('type', 'contextformbutton')]);
    var launchToggleButtonFields = baseToolbarToggleButtonFields.concat([defaulted$1('type', 'contextformtogglebutton')]);
    var toggleOrNormal = choose$1('type', {
      contextformbutton: contextButtonFields,
      contextformtogglebutton: contextToggleButtonFields
    });
    var contextFormSchema = objOf([
      defaulted$1('type', 'contextform'),
      defaultedFunction('initValue', function () {
        return '';
      }),
      optionString('label'),
      strictArrayOf('commands', toggleOrNormal),
      optionOf('launch', choose$1('type', {
        contextformbutton: launchButtonFields,
        contextformtogglebutton: launchToggleButtonFields
      }))
    ].concat(contextBarFields));
    var createContextForm = function (spec) {
      return asRaw('ContextForm', contextFormSchema, spec);
    };

    var contextToolbarSchema = objOf([
      defaulted$1('type', 'contexttoolbar'),
      strictString('items')
    ].concat(contextBarFields));
    var createContextToolbar = function (spec) {
      return asRaw('ContextToolbar', contextToolbarSchema, spec);
    };

    var stringArray = function (a) {
      var all = {};
      each(a, function (key) {
        all[key] = {};
      });
      return keys(all);
    };

    var register = function (editor) {
      var popups = editor.ui.registry.getAll().popups;
      var dataset = map$2(popups, function (popup) {
        return createAutocompleter(popup).fold(function (err) {
          throw new Error(formatError(err));
        }, function (x) {
          return x;
        });
      });
      var triggerChars = stringArray(mapToArray(dataset, function (v) {
        return v.ch;
      }));
      var datasetValues = values(dataset);
      var lookupByChar = function (ch) {
        return filter(datasetValues, function (dv) {
          return dv.ch === ch;
        });
      };
      return {
        dataset: dataset,
        triggerChars: triggerChars,
        lookupByChar: lookupByChar
      };
    };

    var ItemResponse;
    (function (ItemResponse) {
      ItemResponse[ItemResponse['CLOSE_ON_EXECUTE'] = 0] = 'CLOSE_ON_EXECUTE';
      ItemResponse[ItemResponse['BUBBLE_TO_SANDBOX'] = 1] = 'BUBBLE_TO_SANDBOX';
    }(ItemResponse || (ItemResponse = {})));
    var ItemResponse$1 = ItemResponse;

    var navClass = 'tox-menu-nav__js';
    var selectableClass = 'tox-collection__item';
    var colorClass = 'tox-swatch';
    var presetClasses = {
      normal: navClass,
      color: colorClass
    };
    var tickedClass = 'tox-collection__item--enabled';
    var groupHeadingClass = 'tox-collection__group-heading';
    var iconClass = 'tox-collection__item-icon';
    var textClass = 'tox-collection__item-label';
    var accessoryClass = 'tox-collection__item-accessory';
    var caretClass = 'tox-collection__item-caret';
    var checkmarkClass = 'tox-collection__item-checkmark';
    var activeClass = 'tox-collection__item--active';
    var iconClassRtl = 'tox-collection__item-icon-rtl';
    var containerClass = 'tox-collection__item-container';
    var containerColumnClass = 'tox-collection__item-container--column';
    var containerRowClass = 'tox-collection__item-container--row';
    var containerAlignRightClass = 'tox-collection__item-container--align-right';
    var containerAlignLeftClass = 'tox-collection__item-container--align-left';
    var containerValignTopClass = 'tox-collection__item-container--valign-top';
    var containerValignMiddleClass = 'tox-collection__item-container--valign-middle';
    var containerValignBottomClass = 'tox-collection__item-container--valign-bottom';
    var classForPreset = function (presets) {
      return get$1(presetClasses, presets).getOr(navClass);
    };

    var forMenu = function (presets) {
      if (presets === 'color') {
        return 'tox-swatches';
      } else {
        return 'tox-menu';
      }
    };
    var classes = function (presets) {
      return {
        backgroundMenu: 'tox-background-menu',
        selectedMenu: 'tox-selected-menu',
        selectedItem: 'tox-collection__item--active',
        hasIcons: 'tox-menu--has-icons',
        menu: forMenu(presets),
        tieredMenu: 'tox-tiered-menu'
      };
    };

    var markers$1 = function (presets) {
      var menuClasses = classes(presets);
      return {
        backgroundMenu: menuClasses.backgroundMenu,
        selectedMenu: menuClasses.selectedMenu,
        menu: menuClasses.menu,
        selectedItem: menuClasses.selectedItem,
        item: classForPreset(presets)
      };
    };
    var dom$1 = function (hasIcons, columns, presets) {
      var menuClasses = classes(presets);
      return {
        tag: 'div',
        classes: flatten([
          [
            menuClasses.menu,
            'tox-menu-' + columns + '-column'
          ],
          hasIcons ? [menuClasses.hasIcons] : []
        ])
      };
    };
    var components$1 = [Menu.parts.items({})];
    var part = function (hasIcons, columns, presets) {
      var menuClasses = classes(presets);
      var d = {
        tag: 'div',
        classes: flatten([[menuClasses.tieredMenu]])
      };
      return {
        dom: d,
        markers: markers$1(presets)
      };
    };

    var chunk$1 = function (rowDom, numColumns) {
      return function (items) {
        var chunks = chunk(items, numColumns);
        return map(chunks, function (c) {
          return {
            dom: rowDom,
            components: c
          };
        });
      };
    };
    var forSwatch = function (columns) {
      return {
        dom: {
          tag: 'div',
          classes: [
            'tox-menu',
            'tox-swatches-menu'
          ]
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-swatches']
            },
            components: [Menu.parts.items({
                preprocess: columns !== 'auto' ? chunk$1({
                  tag: 'div',
                  classes: ['tox-swatches__row']
                }, columns) : identity
              })]
          }]
      };
    };
    var forToolbar = function (columns) {
      return {
        dom: {
          tag: 'div',
          classes: [
            'tox-menu',
            'tox-collection',
            'tox-collection--toolbar',
            'tox-collection--toolbar-lg'
          ]
        },
        components: [Menu.parts.items({
            preprocess: chunk$1({
              tag: 'div',
              classes: ['tox-collection__group']
            }, columns)
          })]
      };
    };
    var preprocessCollection = function (items, isSeparator) {
      var allSplits = [];
      var currentSplit = [];
      each(items, function (item, i) {
        if (isSeparator(item, i)) {
          if (currentSplit.length > 0) {
            allSplits.push(currentSplit);
          }
          currentSplit = [];
          if (has(item.dom, 'innerHtml')) {
            currentSplit.push(item);
          }
        } else {
          currentSplit.push(item);
        }
      });
      if (currentSplit.length > 0) {
        allSplits.push(currentSplit);
      }
      return map(allSplits, function (s) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-collection__group']
          },
          components: s
        };
      });
    };
    var forCollection = function (columns, initItems, _hasIcons) {
      return {
        dom: {
          tag: 'div',
          classes: [
            'tox-menu',
            'tox-collection'
          ].concat(columns === 1 ? ['tox-collection--list'] : ['tox-collection--grid'])
        },
        components: [Menu.parts.items({
            preprocess: function (items) {
              if (columns !== 'auto' && columns > 1) {
                return chunk$1({
                  tag: 'div',
                  classes: ['tox-collection__group']
                }, columns)(items);
              } else {
                return preprocessCollection(items, function (_item, i) {
                  return initItems[i].type === 'separator';
                });
              }
            }
          })]
      };
    };
    var forHorizontalCollection = function (initItems, _hasIcons) {
      return {
        dom: {
          tag: 'div',
          classes: [
            'tox-collection',
            'tox-collection--horizontal'
          ]
        },
        components: [Menu.parts.items({
            preprocess: function (items) {
              return preprocessCollection(items, function (_item, i) {
                return initItems[i].type === 'separator';
              });
            }
          })]
      };
    };

    var menuHasIcons = function (xs) {
      return exists(xs, function (item) {
        return 'icon' in item && item.icon !== undefined;
      });
    };
    var handleError = function (error) {
      console.error(formatError(error));
      console.log(error);
      return Optional.none();
    };
    var createHorizontalPartialMenuWithAlloyItems = function (value, _hasIcons, items, _columns, _presets) {
      var structure = forHorizontalCollection(items);
      return {
        value: value,
        dom: structure.dom,
        components: structure.components,
        items: items
      };
    };
    var createPartialMenuWithAlloyItems = function (value, hasIcons, items, columns, presets) {
      if (presets === 'color') {
        var structure = forSwatch(columns);
        return {
          value: value,
          dom: structure.dom,
          components: structure.components,
          items: items
        };
      }
      if (presets === 'normal' && columns === 'auto') {
        var structure = forCollection(columns, items);
        return {
          value: value,
          dom: structure.dom,
          components: structure.components,
          items: items
        };
      }
      if (presets === 'normal' && columns === 1) {
        var structure = forCollection(1, items);
        return {
          value: value,
          dom: structure.dom,
          components: structure.components,
          items: items
        };
      }
      if (presets === 'normal') {
        var structure = forCollection(columns, items);
        return {
          value: value,
          dom: structure.dom,
          components: structure.components,
          items: items
        };
      }
      if (presets === 'listpreview' && columns !== 'auto') {
        var structure = forToolbar(columns);
        return {
          value: value,
          dom: structure.dom,
          components: structure.components,
          items: items
        };
      }
      return {
        value: value,
        dom: dom$1(hasIcons, columns, presets),
        components: components$1,
        items: items
      };
    };

    var cardImageFields = [
      strictString('type'),
      strictString('src'),
      optionString('alt'),
      defaultedArrayOf('classes', [], string)
    ];
    var cardImageSchema = objOf(cardImageFields);

    var cardTextFields = [
      strictString('type'),
      strictString('text'),
      optionString('name'),
      defaultedArrayOf('classes', ['tox-collection__item-label'], string)
    ];
    var cardTextSchema = objOf(cardTextFields);

    var itemSchema$2 = valueThunkOf(function () {
      return chooseProcessor('type', {
        cardimage: cardImageSchema,
        cardtext: cardTextSchema,
        cardcontainer: cardContainerSchema
      });
    });
    var cardContainerSchema = objOf([
      strictString('type'),
      defaultedString('direction', 'horizontal'),
      defaultedString('align', 'left'),
      defaultedString('valign', 'middle'),
      strictArrayOf('items', itemSchema$2)
    ]);

    var commonMenuItemFields = [
      defaultedBoolean('disabled', false),
      optionString('text'),
      optionString('shortcut'),
      field('value', 'value', defaultedThunk(function () {
        return generate$1('menuitem-value');
      }), anyValue$1()),
      defaulted$1('meta', {})
    ];

    var cardMenuItemSchema = objOf([
      strictString('type'),
      optionString('label'),
      strictArrayOf('items', itemSchema$2),
      defaultedFunction('onSetup', function () {
        return noop;
      }),
      defaultedFunction('onAction', noop)
    ].concat(commonMenuItemFields));
    var createCardMenuItem = function (spec) {
      return asRaw('cardmenuitem', cardMenuItemSchema, spec);
    };

    var choiceMenuItemSchema = objOf([
      strictString('type'),
      defaultedBoolean('active', false),
      optionString('icon')
    ].concat(commonMenuItemFields));
    var createChoiceMenuItem = function (spec) {
      return asRaw('choicemenuitem', choiceMenuItemSchema, spec);
    };

    var fancyTypes = [
      'inserttable',
      'colorswatch'
    ];
    var fancyMenuItemSchema = objOf([
      strictString('type'),
      strictStringEnum('fancytype', fancyTypes),
      defaultedFunction('onAction', noop)
    ]);
    var createFancyMenuItem = function (spec) {
      return asRaw('fancymenuitem', fancyMenuItemSchema, spec);
    };

    var menuItemSchema = objOf([
      strictString('type'),
      defaultedFunction('onSetup', function () {
        return noop;
      }),
      defaultedFunction('onAction', noop),
      optionString('icon')
    ].concat(commonMenuItemFields));
    var createMenuItem = function (spec) {
      return asRaw('menuitem', menuItemSchema, spec);
    };

    var nestedMenuItemSchema = objOf([
      strictString('type'),
      strictFunction('getSubmenuItems'),
      defaultedFunction('onSetup', function () {
        return noop;
      }),
      optionString('icon')
    ].concat(commonMenuItemFields));
    var createNestedMenuItem = function (spec) {
      return asRaw('nestedmenuitem', nestedMenuItemSchema, spec);
    };

    var toggleMenuItemSchema = objOf([
      strictString('type'),
      optionString('icon'),
      defaultedBoolean('active', false),
      defaultedFunction('onSetup', function () {
        return noop;
      }),
      strictFunction('onAction')
    ].concat(commonMenuItemFields));
    var createToggleMenuItem = function (spec) {
      return asRaw('togglemenuitem', toggleMenuItemSchema, spec);
    };

    var detectSize = function (comp, margin, selectorClass) {
      var descendants$1 = descendants(comp.element, '.' + selectorClass);
      if (descendants$1.length > 0) {
        var columnLength = findIndex(descendants$1, function (c) {
          var thisTop = c.dom.getBoundingClientRect().top;
          var cTop = descendants$1[0].dom.getBoundingClientRect().top;
          return Math.abs(thisTop - cTop) > margin;
        }).getOr(descendants$1.length);
        return Optional.some({
          numColumns: columnLength,
          numRows: Math.ceil(descendants$1.length / columnLength)
        });
      } else {
        return Optional.none();
      }
    };

    var namedEvents = function (name, handlers) {
      return derive$1([config(name, handlers)]);
    };
    var unnamedEvents = function (handlers) {
      return namedEvents(generate$1('unnamed-events'), handlers);
    };
    var SimpleBehaviours = {
      namedEvents: namedEvents,
      unnamedEvents: unnamedEvents
    };

    var ExclusivityChannel = generate$1('tooltip.exclusive');
    var ShowTooltipEvent = generate$1('tooltip.show');
    var HideTooltipEvent = generate$1('tooltip.hide');

    var hideAllExclusive = function (component, _tConfig, _tState) {
      component.getSystem().broadcastOn([ExclusivityChannel], {});
    };
    var setComponents = function (component, tConfig, tState, specs) {
      tState.getTooltip().each(function (tooltip) {
        if (tooltip.getSystem().isConnected()) {
          Replacing.set(tooltip, specs);
        }
      });
    };

    var TooltippingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        hideAllExclusive: hideAllExclusive,
        setComponents: setComponents
    });

    var events$8 = function (tooltipConfig, state) {
      var hide = function (comp) {
        state.getTooltip().each(function (p) {
          detach(p);
          tooltipConfig.onHide(comp, p);
          state.clearTooltip();
        });
        state.clearTimer();
      };
      var show = function (comp) {
        if (!state.isShowing()) {
          hideAllExclusive(comp);
          var sink = tooltipConfig.lazySink(comp).getOrDie();
          var popup = comp.getSystem().build({
            dom: tooltipConfig.tooltipDom,
            components: tooltipConfig.tooltipComponents,
            events: derive(tooltipConfig.mode === 'normal' ? [
              run(mouseover(), function (_) {
                emit(comp, ShowTooltipEvent);
              }),
              run(mouseout(), function (_) {
                emit(comp, HideTooltipEvent);
              })
            ] : []),
            behaviours: derive$1([Replacing.config({})])
          });
          state.setTooltip(popup);
          attach$1(sink, popup);
          tooltipConfig.onShow(comp, popup);
          Positioning.position(sink, tooltipConfig.anchor(comp), popup);
        }
      };
      return derive(flatten([
        [
          run(ShowTooltipEvent, function (comp) {
            state.resetTimer(function () {
              show(comp);
            }, tooltipConfig.delay);
          }),
          run(HideTooltipEvent, function (comp) {
            state.resetTimer(function () {
              hide(comp);
            }, tooltipConfig.delay);
          }),
          run(receive(), function (comp, message) {
            var receivingData = message;
            if (!receivingData.universal) {
              if (contains(receivingData.channels, ExclusivityChannel)) {
                hide(comp);
              }
            }
          }),
          runOnDetached(function (comp) {
            hide(comp);
          })
        ],
        tooltipConfig.mode === 'normal' ? [
          run(focusin(), function (comp) {
            emit(comp, ShowTooltipEvent);
          }),
          run(postBlur(), function (comp) {
            emit(comp, HideTooltipEvent);
          }),
          run(mouseover(), function (comp) {
            emit(comp, ShowTooltipEvent);
          }),
          run(mouseout(), function (comp) {
            emit(comp, HideTooltipEvent);
          })
        ] : [
          run(highlight(), function (comp, _se) {
            emit(comp, ShowTooltipEvent);
          }),
          run(dehighlight(), function (comp) {
            emit(comp, HideTooltipEvent);
          })
        ]
      ]));
    };

    var ActiveTooltipping = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$8
    });

    var TooltippingSchema = [
      strict$1('lazySink'),
      strict$1('tooltipDom'),
      defaulted$1('exclusive', true),
      defaulted$1('tooltipComponents', []),
      defaulted$1('delay', 300),
      defaultedStringEnum('mode', 'normal', [
        'normal',
        'follow-highlight'
      ]),
      defaulted$1('anchor', function (comp) {
        return {
          anchor: 'hotspot',
          hotspot: comp,
          layouts: {
            onLtr: constant([
              south$1,
              north$1,
              southeast$1,
              northeast$1,
              southwest$1,
              northwest$1
            ]),
            onRtl: constant([
              south$1,
              north$1,
              southeast$1,
              northeast$1,
              southwest$1,
              northwest$1
            ])
          }
        };
      }),
      onHandler('onHide'),
      onHandler('onShow')
    ];

    var init$4 = function () {
      var timer = Cell(Optional.none());
      var popup = Cell(Optional.none());
      var getTooltip = function () {
        return popup.get();
      };
      var setTooltip = function (comp) {
        popup.set(Optional.some(comp));
      };
      var clearTooltip = function () {
        popup.set(Optional.none());
      };
      var clearTimer = function () {
        timer.get().each(function (t) {
          clearTimeout(t);
        });
      };
      var resetTimer = function (f, delay) {
        clearTimer();
        timer.set(Optional.some(setTimeout(function () {
          f();
        }, delay)));
      };
      var isShowing = function () {
        return popup.get().isSome();
      };
      var readState = constant('not-implemented');
      return nu$5({
        getTooltip: getTooltip,
        isShowing: isShowing,
        setTooltip: setTooltip,
        clearTooltip: clearTooltip,
        clearTimer: clearTimer,
        resetTimer: resetTimer,
        readState: readState
      });
    };

    var TooltippingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$4
    });

    var Tooltipping = create$1({
      fields: TooltippingSchema,
      name: 'tooltipping',
      active: ActiveTooltipping,
      state: TooltippingState,
      apis: TooltippingApis
    });

    var escape = function (text) {
      return text.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    };

    var global$5 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');

    var global$6 = tinymce.util.Tools.resolve('tinymce.util.I18n');

    var nativeDisabled = [
      'input',
      'button',
      'textarea',
      'select'
    ];
    var onLoad$5 = function (component, disableConfig, disableState) {
      var f = disableConfig.disabled() ? disable : enable;
      f(component, disableConfig);
    };
    var hasNative = function (component, config) {
      return config.useNative === true && contains(nativeDisabled, name(component.element));
    };
    var nativeIsDisabled = function (component) {
      return has$1(component.element, 'disabled');
    };
    var nativeDisable = function (component) {
      set$1(component.element, 'disabled', 'disabled');
    };
    var nativeEnable = function (component) {
      remove$1(component.element, 'disabled');
    };
    var ariaIsDisabled = function (component) {
      return get$3(component.element, 'aria-disabled') === 'true';
    };
    var ariaDisable = function (component) {
      set$1(component.element, 'aria-disabled', 'true');
    };
    var ariaEnable = function (component) {
      set$1(component.element, 'aria-disabled', 'false');
    };
    var disable = function (component, disableConfig, _disableState) {
      disableConfig.disableClass.each(function (disableClass) {
        add$2(component.element, disableClass);
      });
      var f = hasNative(component, disableConfig) ? nativeDisable : ariaDisable;
      f(component);
      disableConfig.onDisabled(component);
    };
    var enable = function (component, disableConfig, _disableState) {
      disableConfig.disableClass.each(function (disableClass) {
        remove$4(component.element, disableClass);
      });
      var f = hasNative(component, disableConfig) ? nativeEnable : ariaEnable;
      f(component);
      disableConfig.onEnabled(component);
    };
    var isDisabled = function (component, disableConfig) {
      return hasNative(component, disableConfig) ? nativeIsDisabled(component) : ariaIsDisabled(component);
    };
    var set$7 = function (component, disableConfig, disableState, disabled) {
      var f = disabled ? disable : enable;
      f(component, disableConfig);
    };

    var DisableApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        enable: enable,
        disable: disable,
        isDisabled: isDisabled,
        onLoad: onLoad$5,
        set: set$7
    });

    var exhibit$3 = function (base, disableConfig) {
      return nu$6({ classes: disableConfig.disabled() ? disableConfig.disableClass.toArray() : [] });
    };
    var events$9 = function (disableConfig, disableState) {
      return derive([
        abort(execute(), function (component, _simulatedEvent) {
          return isDisabled(component, disableConfig);
        }),
        loadEvent(disableConfig, disableState, onLoad$5)
      ]);
    };

    var ActiveDisable = /*#__PURE__*/Object.freeze({
        __proto__: null,
        exhibit: exhibit$3,
        events: events$9
    });

    var DisableSchema = [
      defaultedFunction('disabled', never),
      defaulted$1('useNative', true),
      option('disableClass'),
      onHandler('onDisabled'),
      onHandler('onEnabled')
    ];

    var Disabling = create$1({
      fields: DisableSchema,
      name: 'disabling',
      active: ActiveDisable,
      apis: DisableApis
    });

    var global$7 = tinymce.util.Tools.resolve('tinymce.EditorManager');

    var getSkinUrl = function (editor) {
      var skin = editor.getParam('skin');
      var skinUrl = editor.getParam('skin_url');
      if (skin !== false) {
        var skinName = skin ? skin : 'oxide';
        if (skinUrl) {
          skinUrl = editor.documentBaseURI.toAbsolute(skinUrl);
        } else {
          skinUrl = global$7.baseURL + '/skins/ui/' + skinName;
        }
      }
      return skinUrl;
    };
    var isReadOnly = function (editor) {
      return editor.getParam('readonly', false, 'boolean');
    };
    var isSkinDisabled = function (editor) {
      return editor.getParam('skin') === false;
    };
    var getHeightSetting = function (editor) {
      return editor.getParam('height', Math.max(editor.getElement().offsetHeight, 200));
    };
    var getWidthSetting = function (editor) {
      return editor.getParam('width', global$5.DOM.getStyle(editor.getElement(), 'width'));
    };
    var getMinWidthSetting = function (editor) {
      return Optional.from(editor.getParam('min_width')).filter(isNumber);
    };
    var getMinHeightSetting = function (editor) {
      return Optional.from(editor.getParam('min_height')).filter(isNumber);
    };
    var getMaxWidthSetting = function (editor) {
      return Optional.from(editor.getParam('max_width')).filter(isNumber);
    };
    var getMaxHeightSetting = function (editor) {
      return Optional.from(editor.getParam('max_height')).filter(isNumber);
    };
    var getUserStyleFormats = function (editor) {
      return Optional.from(editor.getParam('style_formats')).filter(isArray);
    };
    var isMergeStyleFormats = function (editor) {
      return editor.getParam('style_formats_merge', false, 'boolean');
    };
    var getLineHeightFormats = function (editor) {
      return editor.getParam('lineheight_formats', '1 1.1 1.2 1.3 1.4 1.5 2', 'string').split(' ');
    };
    var getRemovedMenuItems = function (editor) {
      return editor.getParam('removed_menuitems', '');
    };
    var isMenubarEnabled = function (editor) {
      return editor.getParam('menubar', true, 'boolean') !== false;
    };
    var isToolbarEnabled = function (editor) {
      var toolbar = editor.getParam('toolbar', true);
      var isToolbarTrue = toolbar === true;
      var isToolbarString = isString(toolbar);
      var isToolbarObjectArray = isArray(toolbar) && toolbar.length > 0;
      return !isMultipleToolbars(editor) && (isToolbarObjectArray || isToolbarString || isToolbarTrue);
    };
    var getMultipleToolbarsSetting = function (editor) {
      var toolbars = range(9, function (num) {
        return editor.getParam('toolbar' + (num + 1), false, 'string');
      });
      var toolbarArray = filter(toolbars, function (toolbar) {
        return typeof toolbar === 'string';
      });
      return toolbarArray.length > 0 ? Optional.some(toolbarArray) : Optional.none();
    };
    var isMultipleToolbars = function (editor) {
      return getMultipleToolbarsSetting(editor).fold(function () {
        var toolbar = editor.getParam('toolbar', [], 'string[]');
        return toolbar.length > 0;
      }, always);
    };
    var ToolbarMode;
    (function (ToolbarMode) {
      ToolbarMode['default'] = 'wrap';
      ToolbarMode['floating'] = 'floating';
      ToolbarMode['sliding'] = 'sliding';
      ToolbarMode['scrolling'] = 'scrolling';
    }(ToolbarMode || (ToolbarMode = {})));
    var getToolbarMode = function (editor) {
      return editor.getParam('toolbar_mode', '', 'string');
    };
    var ToolbarLocation;
    (function (ToolbarLocation) {
      ToolbarLocation['auto'] = 'auto';
      ToolbarLocation['top'] = 'top';
      ToolbarLocation['bottom'] = 'bottom';
    }(ToolbarLocation || (ToolbarLocation = {})));
    var getToolbarGroups = function (editor) {
      return editor.getParam('toolbar_groups', {}, 'object');
    };
    var getToolbarLocation = function (editor) {
      return editor.getParam('toolbar_location', ToolbarLocation.auto, 'string');
    };
    var isToolbarLocationBottom = function (editor) {
      return getToolbarLocation(editor) === ToolbarLocation.bottom;
    };
    var fixedContainerSelector = function (editor) {
      return editor.getParam('fixed_toolbar_container', '', 'string');
    };
    var fixedToolbarContainerTarget = function (editor) {
      return editor.getParam('fixed_toolbar_container_target');
    };
    var isToolbarPersist = function (editor) {
      return editor.getParam('toolbar_persist', false, 'boolean');
    };
    var fixedContainerTarget = function (editor) {
      if (!editor.inline) {
        return Optional.none();
      }
      var selector = fixedContainerSelector(editor);
      if (selector.length > 0) {
        return descendant$1(body(), selector);
      }
      var element = fixedToolbarContainerTarget(editor);
      if (isNonNullable(element)) {
        return Optional.some(SugarElement.fromDom(element));
      }
      return Optional.none();
    };
    var useFixedContainer = function (editor) {
      return editor.inline && fixedContainerTarget(editor).isSome();
    };
    var getUiContainer = function (editor) {
      var fixedContainer = fixedContainerTarget(editor);
      return fixedContainer.getOrThunk(function () {
        return getContentContainer(getRootNode(SugarElement.fromDom(editor.getElement())));
      });
    };
    var isDistractionFree = function (editor) {
      return editor.inline && !isMenubarEnabled(editor) && !isToolbarEnabled(editor) && !isMultipleToolbars(editor);
    };
    var isStickyToolbar = function (editor) {
      var isStickyToolbar = editor.getParam('toolbar_sticky', false, 'boolean');
      return (isStickyToolbar || editor.inline) && !useFixedContainer(editor) && !isDistractionFree(editor);
    };
    var isDraggableModal = function (editor) {
      return editor.getParam('draggable_modal', false, 'boolean');
    };
    var getMenus = function (editor) {
      var menu = editor.getParam('menu');
      if (menu) {
        return map$2(menu, function (menu) {
          return __assign(__assign({}, menu), { items: menu.items });
        });
      } else {
        return {};
      }
    };
    var getMenubar = function (editor) {
      return editor.getParam('menubar');
    };
    var getToolbar = function (editor) {
      return editor.getParam('toolbar', true);
    };
    var getFilePickerCallback = function (editor) {
      return editor.getParam('file_picker_callback');
    };
    var getFilePickerTypes = function (editor) {
      return editor.getParam('file_picker_types');
    };
    var getFileBrowserCallbackTypes = function (editor) {
      return editor.getParam('file_browser_callback_types');
    };
    var noTypeaheadUrls = function (editor) {
      return editor.getParam('typeahead_urls') === false;
    };
    var getAnchorTop = function (editor) {
      return editor.getParam('anchor_top', '#top');
    };
    var getAnchorBottom = function (editor) {
      return editor.getParam('anchor_bottom', '#bottom');
    };
    var getFilePickerValidatorHandler = function (editor) {
      var handler = editor.getParam('file_picker_validator_handler', undefined, 'function');
      if (handler === undefined) {
        return editor.getParam('filepicker_validator_handler', undefined, 'function');
      } else {
        return handler;
      }
    };

    var ReadOnlyChannel = 'silver.readonly';
    var ReadOnlyDataSchema = objOf([strictBoolean('readonly')]);
    var broadcastReadonly = function (uiComponents, readonly) {
      var outerContainer = uiComponents.outerContainer;
      var target = outerContainer.element;
      if (readonly) {
        uiComponents.mothership.broadcastOn([dismissPopups()], { target: target });
        uiComponents.uiMothership.broadcastOn([dismissPopups()], { target: target });
      }
      uiComponents.mothership.broadcastOn([ReadOnlyChannel], { readonly: readonly });
      uiComponents.uiMothership.broadcastOn([ReadOnlyChannel], { readonly: readonly });
    };
    var setupReadonlyModeSwitch = function (editor, uiComponents) {
      editor.on('init', function () {
        if (editor.mode.isReadOnly()) {
          broadcastReadonly(uiComponents, true);
        }
      });
      editor.on('SwitchMode', function () {
        return broadcastReadonly(uiComponents, editor.mode.isReadOnly());
      });
      if (isReadOnly(editor)) {
        editor.setMode('readonly');
      }
    };
    var receivingConfig = function () {
      var _a;
      return Receiving.config({
        channels: (_a = {}, _a[ReadOnlyChannel] = {
          schema: ReadOnlyDataSchema,
          onReceive: function (comp, data) {
            Disabling.set(comp, data.readonly);
          }
        }, _a)
      });
    };

    var item = function (disabled) {
      return Disabling.config({
        disabled: disabled,
        disableClass: 'tox-collection__item--state-disabled'
      });
    };
    var button = function (disabled) {
      return Disabling.config({ disabled: disabled });
    };
    var splitButton = function (disabled) {
      return Disabling.config({
        disabled: disabled,
        disableClass: 'tox-tbtn--disabled'
      });
    };
    var toolbarButton = function (disabled) {
      return Disabling.config({
        disabled: disabled,
        disableClass: 'tox-tbtn--disabled',
        useNative: false
      });
    };
    var DisablingConfigs = {
      item: item,
      button: button,
      splitButton: splitButton,
      toolbarButton: toolbarButton
    };

    var runWithApi = function (info, comp) {
      var api = info.getApi(comp);
      return function (f) {
        f(api);
      };
    };
    var onControlAttached = function (info, editorOffCell) {
      return runOnAttached(function (comp) {
        var run = runWithApi(info, comp);
        run(function (api) {
          var onDestroy = info.onSetup(api);
          if (isFunction(onDestroy)) {
            editorOffCell.set(onDestroy);
          }
        });
      });
    };
    var onControlDetached = function (getApi, editorOffCell) {
      return runOnDetached(function (comp) {
        return runWithApi(getApi, comp)(editorOffCell.get());
      });
    };

    var _a;
    var onMenuItemExecute = function (info, itemResponse) {
      return runOnExecute(function (comp, simulatedEvent) {
        runWithApi(info, comp)(info.onAction);
        if (!info.triggersSubmenu && itemResponse === ItemResponse$1.CLOSE_ON_EXECUTE) {
          if (comp.getSystem().isConnected()) {
            emit(comp, sandboxClose());
          }
          simulatedEvent.stop();
        }
      });
    };
    var menuItemEventOrder = (_a = {}, _a[execute()] = [
      'disabling',
      'alloy.base.behaviour',
      'toggling',
      'item-events'
    ], _a);

    var componentRenderPipeline = function (xs) {
      return bind(xs, function (o) {
        return o.toArray();
      });
    };
    var renderCommonItem = function (spec, structure, itemResponse, providersbackstage) {
      var editorOffCell = Cell(noop);
      return {
        type: 'item',
        dom: structure.dom,
        components: componentRenderPipeline(structure.optComponents),
        data: spec.data,
        eventOrder: menuItemEventOrder,
        hasSubmenu: spec.triggersSubmenu,
        itemBehaviours: derive$1([
          config('item-events', [
            onMenuItemExecute(spec, itemResponse),
            onControlAttached(spec, editorOffCell),
            onControlDetached(spec, editorOffCell)
          ]),
          DisablingConfigs.item(function () {
            return spec.disabled || providersbackstage.isDisabled();
          }),
          receivingConfig(),
          Replacing.config({})
        ].concat(spec.itemBehaviours))
      };
    };
    var buildData = function (source) {
      return {
        value: source.value,
        meta: __assign({ text: source.text.getOr('') }, source.meta)
      };
    };

    var global$8 = tinymce.util.Tools.resolve('tinymce.Env');

    var convertText = function (source) {
      var mac = {
        alt: '&#x2325;',
        ctrl: '&#x2303;',
        shift: '&#x21E7;',
        meta: '&#x2318;',
        access: '&#x2303;&#x2325;'
      };
      var other = {
        meta: 'Ctrl',
        access: 'Shift+Alt'
      };
      var replace = global$8.mac ? mac : other;
      var shortcut = source.split('+');
      var updated = map(shortcut, function (segment) {
        var search = segment.toLowerCase().trim();
        return has(replace, search) ? replace[search] : segment;
      });
      return global$8.mac ? updated.join('') : updated.join('+');
    };

    var renderIcon = function (iconHtml) {
      return {
        dom: {
          tag: 'div',
          classes: [iconClass],
          innerHtml: iconHtml
        }
      };
    };
    var renderText = function (text$1) {
      return {
        dom: {
          tag: 'div',
          classes: [textClass]
        },
        components: [text(global$6.translate(text$1))]
      };
    };
    var renderHtml = function (html, classes) {
      return {
        dom: {
          tag: 'div',
          classes: classes,
          innerHtml: html
        }
      };
    };
    var renderStyledText = function (style, text$1) {
      return {
        dom: {
          tag: 'div',
          classes: [textClass]
        },
        components: [{
            dom: {
              tag: style.tag,
              styles: style.styles
            },
            components: [text(global$6.translate(text$1))]
          }]
      };
    };
    var renderShortcut = function (shortcut) {
      return {
        dom: {
          tag: 'div',
          classes: [accessoryClass],
          innerHtml: convertText(shortcut)
        }
      };
    };
    var renderCheckmark = function (icons) {
      return {
        dom: {
          tag: 'div',
          classes: [checkmarkClass],
          innerHtml: get$e('checkmark', icons)
        }
      };
    };
    var renderSubmenuCaret = function (icons) {
      return {
        dom: {
          tag: 'div',
          classes: [caretClass],
          innerHtml: get$e('chevron-right', icons)
        }
      };
    };
    var renderDownwardsCaret = function (icons) {
      return {
        dom: {
          tag: 'div',
          classes: [caretClass],
          innerHtml: get$e('chevron-down', icons)
        }
      };
    };
    var renderContainer = function (container, components) {
      var directionClass = container.direction === 'vertical' ? containerColumnClass : containerRowClass;
      var alignClass = container.align === 'left' ? containerAlignLeftClass : containerAlignRightClass;
      var getValignClass = function () {
        switch (container.valign) {
        case 'top':
          return containerValignTopClass;
        case 'middle':
          return containerValignMiddleClass;
        case 'bottom':
          return containerValignBottomClass;
        }
      };
      return {
        dom: {
          tag: 'div',
          classes: [
            containerClass,
            directionClass,
            alignClass,
            getValignClass()
          ]
        },
        components: components
      };
    };
    var renderImage = function (src, classes, alt) {
      return {
        dom: {
          tag: 'img',
          classes: classes,
          attributes: {
            src: src,
            alt: alt.getOr('')
          }
        }
      };
    };

    var renderColorStructure = function (itemText, itemValue, iconSvg, providerBackstage) {
      var colorPickerCommand = 'custom';
      var removeColorCommand = 'remove';
      var getDom = function () {
        var common = colorClass;
        var icon = iconSvg.getOr('');
        var attributes = itemText.map(function (text) {
          return { title: providerBackstage.translate(text) };
        }).getOr({});
        var baseDom = {
          tag: 'div',
          attributes: attributes,
          classes: [common]
        };
        if (itemValue === colorPickerCommand) {
          return __assign(__assign({}, baseDom), {
            tag: 'button',
            classes: __spreadArrays(baseDom.classes, ['tox-swatches__picker-btn']),
            innerHtml: icon
          });
        } else if (itemValue === removeColorCommand) {
          return __assign(__assign({}, baseDom), {
            classes: __spreadArrays(baseDom.classes, ['tox-swatch--remove']),
            innerHtml: icon
          });
        } else {
          return __assign(__assign({}, baseDom), {
            attributes: __assign(__assign({}, baseDom.attributes), { 'data-mce-color': itemValue }),
            styles: { 'background-color': itemValue }
          });
        }
      };
      return {
        dom: getDom(),
        optComponents: []
      };
    };
    var renderItemDomStructure = function (rtlClass, ariaLabel) {
      var domTitle = ariaLabel.map(function (label) {
        return { attributes: { title: global$6.translate(label) } };
      }).getOr({});
      return __assign({
        tag: 'div',
        classes: [
          navClass,
          selectableClass
        ].concat(rtlClass ? [iconClassRtl] : [])
      }, domTitle);
    };
    var renderNormalItemStructure = function (info, icon, renderIcons, textRender, rtlClass) {
      var leftIcon = renderIcons ? icon.or(Optional.some('')).map(renderIcon) : Optional.none();
      var checkmark = info.checkMark;
      var content = info.htmlContent.fold(function () {
        return info.textContent.map(textRender);
      }, function (html) {
        return Optional.some(renderHtml(html, [textClass]));
      });
      var menuItem = {
        dom: renderItemDomStructure(rtlClass, info.ariaLabel),
        optComponents: [
          leftIcon,
          content,
          info.shortcutContent.map(renderShortcut),
          checkmark,
          info.caret
        ]
      };
      return menuItem;
    };
    var rtlIcon = [
      'list-num-default',
      'list-num-lower-alpha',
      'list-num-lower-greek',
      'list-num-lower-roman',
      'list-num-upper-alpha',
      'list-num-upper-roman'
    ];
    var rtlTransform = [
      'list-bull-circle',
      'list-bull-default',
      'list-bull-square'
    ];
    var renderItemStructure = function (info, providersBackstage, renderIcons, fallbackIcon) {
      if (fallbackIcon === void 0) {
        fallbackIcon = Optional.none();
      }
      var getIconName = function (iconName) {
        return iconName.map(function (name) {
          return global$6.isRtl() && contains(rtlIcon, name) ? name + '-rtl' : name;
        });
      };
      var needRtlClass = global$6.isRtl() && info.iconContent.exists(function (name) {
        return contains(rtlTransform, name);
      });
      var icon = getIconName(info.iconContent).map(function (iconName) {
        return getOr(iconName, providersBackstage.icons, fallbackIcon);
      });
      var textRender = Optional.from(info.meta).fold(function () {
        return renderText;
      }, function (meta) {
        return has(meta, 'style') ? curry(renderStyledText, meta.style) : renderText;
      });
      if (info.presets === 'color') {
        return renderColorStructure(info.ariaLabel, info.value, icon, providersBackstage);
      } else {
        return renderNormalItemStructure(info, icon, renderIcons, textRender, needRtlClass);
      }
    };

    var tooltipBehaviour = function (meta, sharedBackstage) {
      return get$1(meta, 'tooltipWorker').map(function (tooltipWorker) {
        return [Tooltipping.config({
            lazySink: sharedBackstage.getSink,
            tooltipDom: {
              tag: 'div',
              classes: ['tox-tooltip-worker-container']
            },
            tooltipComponents: [],
            anchor: function (comp) {
              return {
                anchor: 'submenu',
                item: comp,
                overrides: { maxHeightFunction: expandable }
              };
            },
            mode: 'follow-highlight',
            onShow: function (component, _tooltip) {
              tooltipWorker(function (elm) {
                Tooltipping.setComponents(component, [external({ element: SugarElement.fromDom(elm) })]);
              });
            }
          })];
      }).getOr([]);
    };
    var encodeText = function (text) {
      return global$5.DOM.encode(text);
    };
    var replaceText = function (text, matchText) {
      var translated = global$6.translate(text);
      var encoded = encodeText(translated);
      if (matchText.length > 0) {
        var escapedMatchRegex = new RegExp(escape(matchText), 'gi');
        return encoded.replace(escapedMatchRegex, function (match) {
          return '<span class="tox-autocompleter-highlight">' + match + '</span>';
        });
      } else {
        return encoded;
      }
    };
    var renderAutocompleteItem = function (spec, matchText, useText, presets, onItemValueHandler, itemResponse, sharedBackstage, renderIcons) {
      if (renderIcons === void 0) {
        renderIcons = true;
      }
      var structure = renderItemStructure({
        presets: presets,
        textContent: Optional.none(),
        htmlContent: useText ? spec.text.map(function (text) {
          return replaceText(text, matchText);
        }) : Optional.none(),
        ariaLabel: spec.text,
        iconContent: spec.icon,
        shortcutContent: Optional.none(),
        checkMark: Optional.none(),
        caret: Optional.none(),
        value: spec.value
      }, sharedBackstage.providers, renderIcons, spec.icon);
      return renderCommonItem({
        data: buildData(spec),
        disabled: spec.disabled,
        getApi: constant({}),
        onAction: function (_api) {
          return onItemValueHandler(spec.value, spec.meta);
        },
        onSetup: constant(noop),
        triggersSubmenu: false,
        itemBehaviours: tooltipBehaviour(spec.meta, sharedBackstage)
      }, structure, itemResponse, sharedBackstage.providers);
    };

    var render = function (items, extras) {
      return map(items, function (item) {
        switch (item.type) {
        case 'cardcontainer':
          return renderContainer(item, render(item.items, extras));
        case 'cardimage':
          return renderImage(item.src, item.classes, item.alt);
        case 'cardtext':
          var shouldHighlight = item.name.exists(function (name) {
            return contains(extras.cardText.highlightOn, name);
          });
          var matchText = shouldHighlight ? Optional.from(extras.cardText.matchText).getOr('') : '';
          return renderHtml(replaceText(item.text, matchText), item.classes);
        }
      });
    };
    var renderCardMenuItem = function (spec, itemResponse, sharedBackstage, extras) {
      var getApi = function (component) {
        return {
          isDisabled: function () {
            return Disabling.isDisabled(component);
          },
          setDisabled: function (state) {
            Disabling.set(component, state);
            each(descendants(component.element, '*'), function (elm) {
              component.getSystem().getByDom(elm).each(function (comp) {
                if (comp.hasConfigured(Disabling)) {
                  Disabling.set(comp, state);
                }
              });
            });
          }
        };
      };
      var structure = {
        dom: renderItemDomStructure(false, spec.label),
        optComponents: [Optional.some({
            dom: {
              tag: 'div',
              classes: [
                containerClass,
                containerRowClass
              ]
            },
            components: render(spec.items, extras)
          })]
      };
      return renderCommonItem({
        data: buildData(__assign({ text: Optional.none() }, spec)),
        disabled: spec.disabled,
        getApi: getApi,
        onAction: spec.onAction,
        onSetup: spec.onSetup,
        triggersSubmenu: false,
        itemBehaviours: Optional.from(extras.itemBehaviours).getOr([])
      }, structure, itemResponse, sharedBackstage.providers);
    };

    var renderChoiceItem = function (spec, useText, presets, onItemValueHandler, isSelected, itemResponse, providersBackstage, renderIcons) {
      if (renderIcons === void 0) {
        renderIcons = true;
      }
      var getApi = function (component) {
        return {
          setActive: function (state) {
            Toggling.set(component, state);
          },
          isActive: function () {
            return Toggling.isOn(component);
          },
          isDisabled: function () {
            return Disabling.isDisabled(component);
          },
          setDisabled: function (state) {
            return Disabling.set(component, state);
          }
        };
      };
      var structure = renderItemStructure({
        presets: presets,
        textContent: useText ? spec.text : Optional.none(),
        htmlContent: Optional.none(),
        ariaLabel: spec.text,
        iconContent: spec.icon,
        shortcutContent: useText ? spec.shortcut : Optional.none(),
        checkMark: useText ? Optional.some(renderCheckmark(providersBackstage.icons)) : Optional.none(),
        caret: Optional.none(),
        value: spec.value
      }, providersBackstage, renderIcons);
      return deepMerge(renderCommonItem({
        data: buildData(spec),
        disabled: spec.disabled,
        getApi: getApi,
        onAction: function (_api) {
          return onItemValueHandler(spec.value);
        },
        onSetup: function (api) {
          api.setActive(isSelected);
          return noop;
        },
        triggersSubmenu: false,
        itemBehaviours: []
      }, structure, itemResponse, providersBackstage), {
        toggling: {
          toggleClass: tickedClass,
          toggleOnExecute: false,
          selected: spec.active
        }
      });
    };

    var parts$2 = generate$4(owner$2(), parts());

    var hexColour = function (value) {
      return { value: value };
    };
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    var longformRegex = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;
    var isHexString = function (hex) {
      return shorthandRegex.test(hex) || longformRegex.test(hex);
    };
    var getLongForm = function (hex) {
      var hexString = hex.value.replace(shorthandRegex, function (m, r, g, b) {
        return r + r + g + g + b + b;
      });
      return { value: hexString };
    };
    var extractValues = function (hex) {
      var longForm = getLongForm(hex);
      var splitForm = longformRegex.exec(longForm.value);
      return splitForm === null ? [
        'FFFFFF',
        'FF',
        'FF',
        'FF'
      ] : splitForm;
    };
    var toHex = function (component) {
      var hex = component.toString(16);
      return (hex.length === 1 ? '0' + hex : hex).toUpperCase();
    };
    var fromRgba = function (rgbaColour) {
      var value = toHex(rgbaColour.red) + toHex(rgbaColour.green) + toHex(rgbaColour.blue);
      return hexColour(value);
    };

    var min = Math.min;
    var max = Math.max;
    var round = Math.round;
    var rgbRegex = /^rgb\((\d+),\s*(\d+),\s*(\d+)\)/;
    var rgbaRegex = /^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/;
    var rgbaColour = function (red, green, blue, alpha) {
      return {
        red: red,
        green: green,
        blue: blue,
        alpha: alpha
      };
    };
    var isRgbaComponent = function (value) {
      var num = parseInt(value, 10);
      return num.toString() === value && num >= 0 && num <= 255;
    };
    var fromHsv = function (hsv) {
      var r;
      var g;
      var b;
      var hue = (hsv.hue || 0) % 360;
      var saturation = hsv.saturation / 100;
      var brightness = hsv.value / 100;
      saturation = max(0, min(saturation, 1));
      brightness = max(0, min(brightness, 1));
      if (saturation === 0) {
        r = g = b = round(255 * brightness);
        return rgbaColour(r, g, b, 1);
      }
      var side = hue / 60;
      var chroma = brightness * saturation;
      var x = chroma * (1 - Math.abs(side % 2 - 1));
      var match = brightness - chroma;
      switch (Math.floor(side)) {
      case 0:
        r = chroma;
        g = x;
        b = 0;
        break;
      case 1:
        r = x;
        g = chroma;
        b = 0;
        break;
      case 2:
        r = 0;
        g = chroma;
        b = x;
        break;
      case 3:
        r = 0;
        g = x;
        b = chroma;
        break;
      case 4:
        r = x;
        g = 0;
        b = chroma;
        break;
      case 5:
        r = chroma;
        g = 0;
        b = x;
        break;
      default:
        r = g = b = 0;
      }
      r = round(255 * (r + match));
      g = round(255 * (g + match));
      b = round(255 * (b + match));
      return rgbaColour(r, g, b, 1);
    };
    var fromHex = function (hexColour) {
      var result = extractValues(hexColour);
      var red = parseInt(result[1], 16);
      var green = parseInt(result[2], 16);
      var blue = parseInt(result[3], 16);
      return rgbaColour(red, green, blue, 1);
    };
    var fromStringValues = function (red, green, blue, alpha) {
      var r = parseInt(red, 10);
      var g = parseInt(green, 10);
      var b = parseInt(blue, 10);
      var a = parseFloat(alpha);
      return rgbaColour(r, g, b, a);
    };
    var fromString = function (rgbaString) {
      if (rgbaString === 'transparent') {
        return Optional.some(rgbaColour(0, 0, 0, 0));
      }
      var rgbMatch = rgbRegex.exec(rgbaString);
      if (rgbMatch !== null) {
        return Optional.some(fromStringValues(rgbMatch[1], rgbMatch[2], rgbMatch[3], '1'));
      }
      var rgbaMatch = rgbaRegex.exec(rgbaString);
      if (rgbaMatch !== null) {
        return Optional.some(fromStringValues(rgbaMatch[1], rgbaMatch[2], rgbaMatch[3], rgbaMatch[4]));
      }
      return Optional.none();
    };
    var toString = function (rgba) {
      return 'rgba(' + rgba.red + ',' + rgba.green + ',' + rgba.blue + ',' + rgba.alpha + ')';
    };
    var red = rgbaColour(255, 0, 0, 1);

    var fireSkinLoaded = function (editor) {
      return editor.fire('SkinLoaded');
    };
    var fireSkinLoadError = function (editor, error) {
      return editor.fire('SkinLoadError', error);
    };
    var fireResizeEditor = function (editor) {
      return editor.fire('ResizeEditor');
    };
    var fireResizeContent = function (editor, e) {
      return editor.fire('ResizeContent', e);
    };
    var fireScrollContent = function (editor, e) {
      return editor.fire('ScrollContent', e);
    };
    var fireTextColorChange = function (editor, data) {
      return editor.fire('TextColorChange', data);
    };

    var global$9 = tinymce.util.Tools.resolve('tinymce.util.LocalStorage');

    var storageName = 'tinymce-custom-colors';
    function ColorCache (max) {
      if (max === void 0) {
        max = 10;
      }
      var storageString = global$9.getItem(storageName);
      var localstorage = isString(storageString) ? JSON.parse(storageString) : [];
      var prune = function (list) {
        var diff = max - list.length;
        return diff < 0 ? list.slice(0, max) : list;
      };
      var cache = prune(localstorage);
      var add = function (key) {
        indexOf(cache, key).each(remove);
        cache.unshift(key);
        if (cache.length > max) {
          cache.pop();
        }
        global$9.setItem(storageName, JSON.stringify(cache));
      };
      var remove = function (idx) {
        cache.splice(idx, 1);
      };
      var state = function () {
        return cache.slice(0);
      };
      return {
        add: add,
        state: state
      };
    }

    var choiceItem = 'choiceitem';
    var defaultColors = [
      {
        type: choiceItem,
        text: 'Light Green',
        value: '#BFEDD2'
      },
      {
        type: choiceItem,
        text: 'Light Yellow',
        value: '#FBEEB8'
      },
      {
        type: choiceItem,
        text: 'Light Red',
        value: '#F8CAC6'
      },
      {
        type: choiceItem,
        text: 'Light Purple',
        value: '#ECCAFA'
      },
      {
        type: choiceItem,
        text: 'Light Blue',
        value: '#C2E0F4'
      },
      {
        type: choiceItem,
        text: 'Green',
        value: '#2DC26B'
      },
      {
        type: choiceItem,
        text: 'Yellow',
        value: '#F1C40F'
      },
      {
        type: choiceItem,
        text: 'Red',
        value: '#E03E2D'
      },
      {
        type: choiceItem,
        text: 'Purple',
        value: '#B96AD9'
      },
      {
        type: choiceItem,
        text: 'Blue',
        value: '#3598DB'
      },
      {
        type: choiceItem,
        text: 'Dark Turquoise',
        value: '#169179'
      },
      {
        type: choiceItem,
        text: 'Orange',
        value: '#E67E23'
      },
      {
        type: choiceItem,
        text: 'Dark Red',
        value: '#BA372A'
      },
      {
        type: choiceItem,
        text: 'Dark Purple',
        value: '#843FA1'
      },
      {
        type: choiceItem,
        text: 'Dark Blue',
        value: '#236FA1'
      },
      {
        type: choiceItem,
        text: 'Light Gray',
        value: '#ECF0F1'
      },
      {
        type: choiceItem,
        text: 'Medium Gray',
        value: '#CED4D9'
      },
      {
        type: choiceItem,
        text: 'Gray',
        value: '#95A5A6'
      },
      {
        type: choiceItem,
        text: 'Dark Gray',
        value: '#7E8C8D'
      },
      {
        type: choiceItem,
        text: 'Navy Blue',
        value: '#34495E'
      },
      {
        type: choiceItem,
        text: 'Black',
        value: '#000000'
      },
      {
        type: choiceItem,
        text: 'White',
        value: '#ffffff'
      }
    ];
    var colorCache = ColorCache(10);
    var mapColors = function (colorMap) {
      var colors = [];
      var canvas = document.createElement('canvas');
      canvas.height = 1;
      canvas.width = 1;
      var ctx = canvas.getContext('2d');
      var byteAsHex = function (colorByte, alphaByte) {
        var bg = 255;
        var alpha = alphaByte / 255;
        var colorByteWithWhiteBg = Math.round(colorByte * alpha + bg * (1 - alpha));
        return ('0' + colorByteWithWhiteBg.toString(16)).slice(-2).toUpperCase();
      };
      var asHexColor = function (color) {
        if (/^[0-9A-Fa-f]{6}$/.test(color)) {
          return '#' + color.toUpperCase();
        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#FFFFFF';
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, 1, 1);
        var rgba = ctx.getImageData(0, 0, 1, 1).data;
        var r = rgba[0], g = rgba[1], b = rgba[2], a = rgba[3];
        return '#' + byteAsHex(r, a) + byteAsHex(g, a) + byteAsHex(b, a);
      };
      for (var i = 0; i < colorMap.length; i += 2) {
        colors.push({
          text: colorMap[i + 1],
          value: asHexColor(colorMap[i]),
          type: 'choiceitem'
        });
      }
      return colors;
    };
    var getColorCols = function (editor, defaultCols) {
      return editor.getParam('color_cols', defaultCols, 'number');
    };
    var hasCustomColors = function (editor) {
      return editor.getParam('custom_colors') !== false;
    };
    var getColorMap = function (editor) {
      return editor.getParam('color_map');
    };
    var getColors = function (editor) {
      var unmapped = getColorMap(editor);
      return unmapped !== undefined ? mapColors(unmapped) : defaultColors;
    };
    var getCurrentColors = function () {
      return map(colorCache.state(), function (color) {
        return {
          type: choiceItem,
          text: color,
          value: color
        };
      });
    };
    var addColor = function (color) {
      colorCache.add(color);
    };

    var getCurrentColor = function (editor, format) {
      var color;
      editor.dom.getParents(editor.selection.getStart(), function (elm) {
        var value;
        if (value = elm.style[format === 'forecolor' ? 'color' : 'background-color']) {
          color = color ? color : value;
        }
      });
      return color;
    };
    var applyFormat = function (editor, format, value) {
      editor.undoManager.transact(function () {
        editor.focus();
        editor.formatter.apply(format, { value: value });
        editor.nodeChanged();
      });
    };
    var removeFormat = function (editor, format) {
      editor.undoManager.transact(function () {
        editor.focus();
        editor.formatter.remove(format, { value: null }, null, true);
        editor.nodeChanged();
      });
    };
    var registerCommands = function (editor) {
      editor.addCommand('mceApplyTextcolor', function (format, value) {
        applyFormat(editor, format, value);
      });
      editor.addCommand('mceRemoveTextcolor', function (format) {
        removeFormat(editor, format);
      });
    };
    var calcCols = function (colors) {
      return Math.max(5, Math.ceil(Math.sqrt(colors)));
    };
    var getColorCols$1 = function (editor) {
      var colors = getColors(editor);
      var defaultCols = calcCols(colors.length);
      return getColorCols(editor, defaultCols);
    };
    var getAdditionalColors = function (hasCustom) {
      var type = 'choiceitem';
      var remove = {
        type: type,
        text: 'Remove color',
        icon: 'color-swatch-remove-color',
        value: 'remove'
      };
      var custom = {
        type: type,
        text: 'Custom color',
        icon: 'color-picker',
        value: 'custom'
      };
      return hasCustom ? [
        remove,
        custom
      ] : [remove];
    };
    var applyColor = function (editor, format, value, onChoice) {
      if (value === 'custom') {
        var dialog = colorPickerDialog(editor);
        dialog(function (colorOpt) {
          colorOpt.each(function (color) {
            addColor(color);
            editor.execCommand('mceApplyTextcolor', format, color);
            onChoice(color);
          });
        }, '#000000');
      } else if (value === 'remove') {
        onChoice('');
        editor.execCommand('mceRemoveTextcolor', format);
      } else {
        onChoice(value);
        editor.execCommand('mceApplyTextcolor', format, value);
      }
    };
    var getColors$1 = function (colors, hasCustom) {
      return colors.concat(getCurrentColors().concat(getAdditionalColors(hasCustom)));
    };
    var getFetch = function (colors, hasCustom) {
      return function (callback) {
        callback(getColors$1(colors, hasCustom));
      };
    };
    var setIconColor = function (splitButtonApi, name, newColor) {
      var id = name === 'forecolor' ? 'tox-icon-text-color__color' : 'tox-icon-highlight-bg-color__color';
      splitButtonApi.setIconFill(id, newColor);
    };
    var registerTextColorButton = function (editor, name, format, tooltip, lastColor) {
      editor.ui.registry.addSplitButton(name, {
        tooltip: tooltip,
        presets: 'color',
        icon: name === 'forecolor' ? 'text-color' : 'highlight-bg-color',
        select: function (value) {
          var optCurrentRgb = Optional.from(getCurrentColor(editor, format));
          return optCurrentRgb.bind(function (currentRgb) {
            return fromString(currentRgb).map(function (rgba) {
              var currentHex = fromRgba(rgba).value;
              return contains$1(value.toLowerCase(), currentHex);
            });
          }).getOr(false);
        },
        columns: getColorCols$1(editor),
        fetch: getFetch(getColors(editor), hasCustomColors(editor)),
        onAction: function (_splitButtonApi) {
          if (lastColor.get() !== null) {
            applyColor(editor, format, lastColor.get(), noop);
          }
        },
        onItemAction: function (_splitButtonApi, value) {
          applyColor(editor, format, value, function (newColor) {
            lastColor.set(newColor);
            fireTextColorChange(editor, {
              name: name,
              color: newColor
            });
          });
        },
        onSetup: function (splitButtonApi) {
          if (lastColor.get() !== null) {
            setIconColor(splitButtonApi, name, lastColor.get());
          }
          var handler = function (e) {
            if (e.name === name) {
              setIconColor(splitButtonApi, e.name, e.color);
            }
          };
          editor.on('TextColorChange', handler);
          return function () {
            editor.off('TextColorChange', handler);
          };
        }
      });
    };
    var registerTextColorMenuItem = function (editor, name, format, text) {
      editor.ui.registry.addNestedMenuItem(name, {
        text: text,
        icon: name === 'forecolor' ? 'text-color' : 'highlight-bg-color',
        getSubmenuItems: function () {
          return [{
              type: 'fancymenuitem',
              fancytype: 'colorswatch',
              onAction: function (data) {
                applyColor(editor, format, data.value, noop);
              }
            }];
        }
      });
    };
    var colorPickerDialog = function (editor) {
      return function (callback, value) {
        var isValid = false;
        var onSubmit = function (api) {
          var data = api.getData();
          var hex = data.colorpicker;
          if (isValid) {
            callback(Optional.from(hex));
            api.close();
          } else {
            editor.windowManager.alert(editor.translate([
              'Invalid hex color code: {0}',
              hex
            ]));
          }
        };
        var onAction = function (_api, details) {
          if (details.name === 'hex-valid') {
            isValid = details.value;
          }
        };
        var initialData = { colorpicker: value };
        editor.windowManager.open({
          title: 'Color Picker',
          size: 'normal',
          body: {
            type: 'panel',
            items: [{
                type: 'colorpicker',
                name: 'colorpicker',
                label: 'Color'
              }]
          },
          buttons: [
            {
              type: 'cancel',
              name: 'cancel',
              text: 'Cancel'
            },
            {
              type: 'submit',
              name: 'save',
              text: 'Save',
              primary: true
            }
          ],
          initialData: initialData,
          onAction: onAction,
          onSubmit: onSubmit,
          onClose: noop,
          onCancel: function () {
            callback(Optional.none());
          }
        });
      };
    };
    var register$1 = function (editor) {
      registerCommands(editor);
      var lastForeColor = Cell(null);
      var lastBackColor = Cell(null);
      registerTextColorButton(editor, 'forecolor', 'forecolor', 'Text color', lastForeColor);
      registerTextColorButton(editor, 'backcolor', 'hilitecolor', 'Background color', lastBackColor);
      registerTextColorMenuItem(editor, 'forecolor', 'forecolor', 'Text color');
      registerTextColorMenuItem(editor, 'backcolor', 'hilitecolor', 'Background color');
    };

    var createPartialChoiceMenu = function (value, items, onItemValueHandler, columns, presets, itemResponse, select, providersBackstage) {
      var hasIcons = menuHasIcons(items);
      var presetItemTypes = presets !== 'color' ? 'normal' : 'color';
      var alloyItems = createChoiceItems(items, onItemValueHandler, columns, presetItemTypes, itemResponse, select, providersBackstage);
      return createPartialMenuWithAlloyItems(value, hasIcons, alloyItems, columns, presets);
    };
    var createChoiceItems = function (items, onItemValueHandler, columns, itemPresets, itemResponse, select, providersBackstage) {
      return cat(map(items, function (item) {
        if (item.type === 'choiceitem') {
          return createChoiceMenuItem(item).fold(handleError, function (d) {
            return Optional.some(renderChoiceItem(d, columns === 1, itemPresets, onItemValueHandler, select(item.value), itemResponse, providersBackstage, menuHasIcons(items)));
          });
        } else {
          return Optional.none();
        }
      }));
    };

    var deriveMenuMovement = function (columns, presets) {
      var menuMarkers = markers$1(presets);
      if (columns === 1) {
        return {
          mode: 'menu',
          moveOnTab: true
        };
      } else if (columns === 'auto') {
        return {
          mode: 'grid',
          selector: '.' + menuMarkers.item,
          initSize: {
            numColumns: 1,
            numRows: 1
          }
        };
      } else {
        var rowClass = presets === 'color' ? 'tox-swatches__row' : 'tox-collection__group';
        return {
          mode: 'matrix',
          rowSelector: '.' + rowClass
        };
      }
    };
    var deriveCollectionMovement = function (columns, presets) {
      if (columns === 1) {
        return {
          mode: 'menu',
          moveOnTab: false,
          selector: '.tox-collection__item'
        };
      } else if (columns === 'auto') {
        return {
          mode: 'flatgrid',
          selector: '.' + 'tox-collection__item',
          initSize: {
            numColumns: 1,
            numRows: 1
          }
        };
      } else {
        return {
          mode: 'matrix',
          selectors: {
            row: presets === 'color' ? '.tox-swatches__row' : '.tox-collection__group',
            cell: presets === 'color' ? '.' + colorClass : '.' + selectableClass
          }
        };
      }
    };

    var renderColorSwatchItem = function (spec, backstage) {
      var items = getColors$1(backstage.colorinput.getColors(), backstage.colorinput.hasCustomColors());
      var columns = backstage.colorinput.getColorCols();
      var presets = 'color';
      var menuSpec = createPartialChoiceMenu(generate$1('menu-value'), items, function (value) {
        spec.onAction({ value: value });
      }, columns, presets, ItemResponse$1.CLOSE_ON_EXECUTE, never, backstage.shared.providers);
      var widgetSpec = __assign(__assign({}, menuSpec), {
        markers: markers$1(presets),
        movement: deriveMenuMovement(columns, presets)
      });
      return {
        type: 'widget',
        data: { value: generate$1('widget-id') },
        dom: {
          tag: 'div',
          classes: ['tox-fancymenuitem']
        },
        autofocus: true,
        components: [parts$2.widget(Menu.sketch(widgetSpec))]
      };
    };

    var cellOverEvent = generate$1('cell-over');
    var cellExecuteEvent = generate$1('cell-execute');
    var makeCell = function (row, col, labelId) {
      var _a;
      var emitCellOver = function (c) {
        return emitWith(c, cellOverEvent, {
          row: row,
          col: col
        });
      };
      var emitExecute = function (c) {
        return emitWith(c, cellExecuteEvent, {
          row: row,
          col: col
        });
      };
      var onClick = function (c, se) {
        se.stop();
        emitExecute(c);
      };
      return build$1({
        dom: {
          tag: 'div',
          attributes: (_a = { role: 'button' }, _a['aria-labelledby'] = labelId, _a)
        },
        behaviours: derive$1([
          config('insert-table-picker-cell', [
            run(mouseover(), Focusing.focus),
            run(execute(), emitExecute),
            run(click(), onClick),
            run(tap(), onClick)
          ]),
          Toggling.config({
            toggleClass: 'tox-insert-table-picker__selected',
            toggleOnExecute: false
          }),
          Focusing.config({ onFocus: emitCellOver })
        ])
      });
    };
    var makeCells = function (labelId, numRows, numCols) {
      var cells = [];
      for (var i = 0; i < numRows; i++) {
        var row = [];
        for (var j = 0; j < numCols; j++) {
          row.push(makeCell(i, j, labelId));
        }
        cells.push(row);
      }
      return cells;
    };
    var selectCells = function (cells, selectedRow, selectedColumn, numRows, numColumns) {
      for (var i = 0; i < numRows; i++) {
        for (var j = 0; j < numColumns; j++) {
          Toggling.set(cells[i][j], i <= selectedRow && j <= selectedColumn);
        }
      }
    };
    var makeComponents = function (cells) {
      return bind(cells, function (cellRow) {
        return map(cellRow, premade$1);
      });
    };
    var makeLabelText = function (row, col) {
      return text(col + 1 + 'x' + (row + 1));
    };
    var renderInsertTableMenuItem = function (spec) {
      var numRows = 10;
      var numColumns = 10;
      var sizeLabelId = generate$1('size-label');
      var cells = makeCells(sizeLabelId, numRows, numColumns);
      var memLabel = record({
        dom: {
          tag: 'span',
          classes: ['tox-insert-table-picker__label'],
          attributes: { id: sizeLabelId }
        },
        components: [text('0x0')],
        behaviours: derive$1([Replacing.config({})])
      });
      return {
        type: 'widget',
        data: { value: generate$1('widget-id') },
        dom: {
          tag: 'div',
          classes: ['tox-fancymenuitem']
        },
        autofocus: true,
        components: [parts$2.widget({
            dom: {
              tag: 'div',
              classes: ['tox-insert-table-picker']
            },
            components: makeComponents(cells).concat(memLabel.asSpec()),
            behaviours: derive$1([
              config('insert-table-picker', [
                runWithTarget(cellOverEvent, function (c, t, e) {
                  var row = e.event.row;
                  var col = e.event.col;
                  selectCells(cells, row, col, numRows, numColumns);
                  Replacing.set(memLabel.get(c), [makeLabelText(row, col)]);
                }),
                runWithTarget(cellExecuteEvent, function (c, _, e) {
                  spec.onAction({
                    numRows: e.event.row + 1,
                    numColumns: e.event.col + 1
                  });
                  emit(c, sandboxClose());
                })
              ]),
              Keying.config({
                initSize: {
                  numRows: numRows,
                  numColumns: numColumns
                },
                mode: 'flatgrid',
                selector: '[role="button"]'
              })
            ])
          })]
      };
    };

    var fancyMenuItems = {
      inserttable: renderInsertTableMenuItem,
      colorswatch: renderColorSwatchItem
    };
    var valueOpt = function (obj, key) {
      return Object.prototype.hasOwnProperty.call(obj, key) ? Optional.some(obj[key]) : Optional.none();
    };
    var renderFancyMenuItem = function (spec, backstage) {
      return valueOpt(fancyMenuItems, spec.fancytype).map(function (render) {
        return render(spec, backstage);
      });
    };

    var renderNestedItem = function (spec, itemResponse, providersBackstage, renderIcons, downwardsCaret) {
      if (renderIcons === void 0) {
        renderIcons = true;
      }
      if (downwardsCaret === void 0) {
        downwardsCaret = false;
      }
      var caret = downwardsCaret ? renderDownwardsCaret(providersBackstage.icons) : renderSubmenuCaret(providersBackstage.icons);
      var getApi = function (component) {
        return {
          isDisabled: function () {
            return Disabling.isDisabled(component);
          },
          setDisabled: function (state) {
            return Disabling.set(component, state);
          }
        };
      };
      var structure = renderItemStructure({
        presets: 'normal',
        iconContent: spec.icon,
        textContent: spec.text,
        htmlContent: Optional.none(),
        ariaLabel: spec.text,
        caret: Optional.some(caret),
        checkMark: Optional.none(),
        shortcutContent: spec.shortcut
      }, providersBackstage, renderIcons);
      return renderCommonItem({
        data: buildData(spec),
        getApi: getApi,
        disabled: spec.disabled,
        onAction: noop,
        onSetup: spec.onSetup,
        triggersSubmenu: true,
        itemBehaviours: []
      }, structure, itemResponse, providersBackstage);
    };

    var renderNormalItem = function (spec, itemResponse, providersBackstage, renderIcons) {
      if (renderIcons === void 0) {
        renderIcons = true;
      }
      var getApi = function (component) {
        return {
          isDisabled: function () {
            return Disabling.isDisabled(component);
          },
          setDisabled: function (state) {
            return Disabling.set(component, state);
          }
        };
      };
      var structure = renderItemStructure({
        presets: 'normal',
        iconContent: spec.icon,
        textContent: spec.text,
        htmlContent: Optional.none(),
        ariaLabel: spec.text,
        caret: Optional.none(),
        checkMark: Optional.none(),
        shortcutContent: spec.shortcut
      }, providersBackstage, renderIcons);
      return renderCommonItem({
        data: buildData(spec),
        getApi: getApi,
        disabled: spec.disabled,
        onAction: spec.onAction,
        onSetup: spec.onSetup,
        triggersSubmenu: false,
        itemBehaviours: []
      }, structure, itemResponse, providersBackstage);
    };

    var renderSeparatorItem = function (spec) {
      var innerHtml = spec.text.fold(function () {
        return {};
      }, function (text) {
        return { innerHtml: text };
      });
      return {
        type: 'separator',
        dom: __assign({
          tag: 'div',
          classes: [
            selectableClass,
            groupHeadingClass
          ]
        }, innerHtml),
        components: []
      };
    };

    var renderToggleMenuItem = function (spec, itemResponse, providersBackstage, renderIcons) {
      if (renderIcons === void 0) {
        renderIcons = true;
      }
      var getApi = function (component) {
        return {
          setActive: function (state) {
            Toggling.set(component, state);
          },
          isActive: function () {
            return Toggling.isOn(component);
          },
          isDisabled: function () {
            return Disabling.isDisabled(component);
          },
          setDisabled: function (state) {
            return Disabling.set(component, state);
          }
        };
      };
      var structure = renderItemStructure({
        iconContent: spec.icon,
        textContent: spec.text,
        htmlContent: Optional.none(),
        ariaLabel: spec.text,
        checkMark: Optional.some(renderCheckmark(providersBackstage.icons)),
        caret: Optional.none(),
        shortcutContent: spec.shortcut,
        presets: 'normal',
        meta: spec.meta
      }, providersBackstage, renderIcons);
      return deepMerge(renderCommonItem({
        data: buildData(spec),
        disabled: spec.disabled,
        getApi: getApi,
        onAction: spec.onAction,
        onSetup: spec.onSetup,
        triggersSubmenu: false,
        itemBehaviours: []
      }, structure, itemResponse, providersBackstage), {
        toggling: {
          toggleClass: tickedClass,
          toggleOnExecute: false,
          selected: spec.active
        }
      });
    };

    var autocomplete = renderAutocompleteItem;
    var separator = renderSeparatorItem;
    var normal = renderNormalItem;
    var nested = renderNestedItem;
    var toggle$1 = renderToggleMenuItem;
    var fancy = renderFancyMenuItem;
    var card = renderCardMenuItem;

    var FocusMode;
    (function (FocusMode) {
      FocusMode[FocusMode['ContentFocus'] = 0] = 'ContentFocus';
      FocusMode[FocusMode['UiFocus'] = 1] = 'UiFocus';
    }(FocusMode || (FocusMode = {})));
    var createMenuItemFromBridge = function (item, itemResponse, backstage, menuHasIcons, isHorizontalMenu) {
      var providersBackstage = backstage.shared.providers;
      var parseForHorizontalMenu = function (menuitem) {
        return !isHorizontalMenu ? menuitem : __assign(__assign({}, menuitem), {
          shortcut: Optional.none(),
          icon: menuitem.text.isSome() ? Optional.none() : menuitem.icon
        });
      };
      switch (item.type) {
      case 'menuitem':
        return createMenuItem(item).fold(handleError, function (d) {
          return Optional.some(normal(parseForHorizontalMenu(d), itemResponse, providersBackstage, menuHasIcons));
        });
      case 'nestedmenuitem':
        return createNestedMenuItem(item).fold(handleError, function (d) {
          return Optional.some(nested(parseForHorizontalMenu(d), itemResponse, providersBackstage, menuHasIcons, isHorizontalMenu));
        });
      case 'togglemenuitem':
        return createToggleMenuItem(item).fold(handleError, function (d) {
          return Optional.some(toggle$1(parseForHorizontalMenu(d), itemResponse, providersBackstage, menuHasIcons));
        });
      case 'separator':
        return createSeparatorMenuItem(item).fold(handleError, function (d) {
          return Optional.some(separator(d));
        });
      case 'fancymenuitem':
        return createFancyMenuItem(item).fold(handleError, function (d) {
          return fancy(parseForHorizontalMenu(d), backstage);
        });
      default: {
          console.error('Unknown item in general menu', item);
          return Optional.none();
        }
      }
    };
    var createAutocompleteItems = function (items, matchText, onItemValueHandler, columns, itemResponse, sharedBackstage, highlightOn) {
      var renderText = columns === 1;
      var renderIcons = !renderText || menuHasIcons(items);
      return cat(map(items, function (item) {
        switch (item.type) {
        case 'separator':
          return createSeparatorItem(item).fold(handleError, function (d) {
            return Optional.some(separator(d));
          });
        case 'cardmenuitem':
          return createCardMenuItem(item).fold(handleError, function (d) {
            return Optional.some(card(__assign(__assign({}, d), {
              onAction: function (api) {
                d.onAction(api);
                onItemValueHandler(d.value, d.meta);
              }
            }), itemResponse, sharedBackstage, {
              itemBehaviours: tooltipBehaviour(d.meta, sharedBackstage),
              cardText: {
                matchText: matchText,
                highlightOn: highlightOn
              }
            }));
          });
        case 'autocompleteitem':
        default:
          return createAutocompleterItem(item).fold(handleError, function (d) {
            return Optional.some(autocomplete(d, matchText, renderText, 'normal', onItemValueHandler, itemResponse, sharedBackstage, renderIcons));
          });
        }
      }));
    };
    var createPartialMenu = function (value, items, itemResponse, backstage, isHorizontalMenu) {
      var hasIcons = menuHasIcons(items);
      var alloyItems = cat(map(items, function (item) {
        var itemHasIcon = function (i) {
          return isHorizontalMenu ? !i.hasOwnProperty('text') : hasIcons;
        };
        var createItem = function (i) {
          return createMenuItemFromBridge(i, itemResponse, backstage, itemHasIcon(i), isHorizontalMenu);
        };
        if (item.type === 'nestedmenuitem' && item.getSubmenuItems().length <= 0) {
          return createItem(__assign(__assign({}, item), { disabled: true }));
        } else {
          return createItem(item);
        }
      }));
      var createPartial = isHorizontalMenu ? createHorizontalPartialMenuWithAlloyItems : createPartialMenuWithAlloyItems;
      return createPartial(value, hasIcons, alloyItems, 1, 'normal');
    };
    var createTieredDataFrom = function (partialMenu) {
      return tieredMenu.singleData(partialMenu.value, partialMenu);
    };
    var createMenuFrom = function (partialMenu, columns, focusMode, presets) {
      var focusManager = focusMode === FocusMode.ContentFocus ? highlights() : dom();
      var movement = deriveMenuMovement(columns, presets);
      var menuMarkers = markers$1(presets);
      return {
        dom: partialMenu.dom,
        components: partialMenu.components,
        items: partialMenu.items,
        value: partialMenu.value,
        markers: {
          selectedItem: menuMarkers.selectedItem,
          item: menuMarkers.item
        },
        movement: movement,
        fakeFocus: focusMode === FocusMode.ContentFocus,
        focusManager: focusManager,
        menuBehaviours: SimpleBehaviours.unnamedEvents(columns !== 'auto' ? [] : [runOnAttached(function (comp, _se) {
            detectSize(comp, 4, menuMarkers.item).each(function (_a) {
              var numColumns = _a.numColumns, numRows = _a.numRows;
              Keying.setGridSize(comp, numRows, numColumns);
            });
          })])
      };
    };

    var register$2 = function (editor, sharedBackstage) {
      var activeAutocompleter = Cell(Optional.none());
      var processingAction = Cell(false);
      var autocompleter = build$1(InlineView.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-autocompleter']
        },
        components: [],
        fireDismissalEventInstead: {},
        inlineBehaviours: derive$1([config('dismissAutocompleter', [run(dismissRequested(), function () {
              return cancelIfNecessary();
            })])]),
        lazySink: sharedBackstage.getSink
      }));
      var isMenuOpen = function () {
        return InlineView.isOpen(autocompleter);
      };
      var isActive = function () {
        return activeAutocompleter.get().isSome();
      };
      var hideIfNecessary = function () {
        if (isActive()) {
          InlineView.hide(autocompleter);
        }
      };
      var cancelIfNecessary = function () {
        if (isActive()) {
          var lastElement = activeAutocompleter.get().map(function (ac) {
            return ac.element;
          });
          detect$4(lastElement.getOr(SugarElement.fromDom(editor.selection.getNode()))).each(unwrap);
          hideIfNecessary();
          activeAutocompleter.set(Optional.none());
          processingAction.set(false);
        }
      };
      var getAutocompleters = cached(function () {
        return register(editor);
      });
      var getCombinedItems = function (triggerChar, matches) {
        var columns = findMap(matches, function (m) {
          return Optional.from(m.columns);
        }).getOr(1);
        return bind(matches, function (match) {
          var choices = match.items;
          return createAutocompleteItems(choices, match.matchText, function (itemValue, itemMeta) {
            var nr = editor.selection.getRng();
            getContext(editor.dom, nr, triggerChar).fold(function () {
              return console.error('Lost context. Cursor probably moved');
            }, function (_a) {
              var range = _a.range;
              var autocompleterApi = {
                hide: function () {
                  cancelIfNecessary();
                },
                reload: function (fetchOptions) {
                  hideIfNecessary();
                  load(fetchOptions);
                }
              };
              processingAction.set(true);
              match.onAction(autocompleterApi, range, itemValue, itemMeta);
              processingAction.set(false);
            });
          }, columns, ItemResponse$1.BUBBLE_TO_SANDBOX, sharedBackstage, match.highlightOn);
        });
      };
      var commenceIfNecessary = function (context) {
        if (!isActive()) {
          var wrapper = create$4(editor, context.range);
          activeAutocompleter.set(Optional.some({
            triggerChar: context.triggerChar,
            element: wrapper,
            matchLength: context.text.length
          }));
          processingAction.set(false);
        }
      };
      var display = function (ac, context, lookupData, items) {
        ac.matchLength = context.text.length;
        var columns = findMap(lookupData, function (ld) {
          return Optional.from(ld.columns);
        }).getOr(1);
        InlineView.showAt(autocompleter, {
          anchor: 'node',
          root: SugarElement.fromDom(editor.getBody()),
          node: Optional.from(ac.element)
        }, Menu.sketch(createMenuFrom(createPartialMenuWithAlloyItems('autocompleter-value', true, items, columns, 'normal'), columns, FocusMode.ContentFocus, 'normal')));
        InlineView.getContent(autocompleter).each(Highlighting.highlightFirst);
      };
      var doLookup = function (fetchOptions) {
        return activeAutocompleter.get().map(function (ac) {
          return getContext(editor.dom, editor.selection.getRng(), ac.triggerChar).bind(function (newContext) {
            return lookupWithContext(editor, getAutocompleters, newContext, fetchOptions);
          });
        }).getOrThunk(function () {
          return lookup(editor, getAutocompleters);
        });
      };
      var load = function (fetchOptions) {
        doLookup(fetchOptions).fold(cancelIfNecessary, function (lookupInfo) {
          commenceIfNecessary(lookupInfo.context);
          lookupInfo.lookupData.then(function (lookupData) {
            activeAutocompleter.get().map(function (ac) {
              var context = lookupInfo.context;
              if (ac.triggerChar === context.triggerChar) {
                var combinedItems = getCombinedItems(context.triggerChar, lookupData);
                if (combinedItems.length > 0) {
                  display(ac, context, lookupData, combinedItems);
                } else if (context.text.length - ac.matchLength >= 10) {
                  cancelIfNecessary();
                } else {
                  hideIfNecessary();
                }
              }
            });
          });
        });
      };
      var onKeypress = last$2(function (e) {
        if (e.which === 27) {
          return;
        }
        load();
      }, 50);
      var autocompleterUiApi = {
        onKeypress: onKeypress,
        cancelIfNecessary: cancelIfNecessary,
        isMenuOpen: isMenuOpen,
        isActive: isActive,
        isProcessingAction: processingAction.get,
        getView: function () {
          return InlineView.getContent(autocompleter);
        }
      };
      if (editor.hasPlugin('rtc') === false) {
        AutocompleterEditorEvents.setup(autocompleterUiApi, editor);
      }
    };
    var Autocompleter = { register: register$2 };

    var filter$2 = always;
    var bind$3 = function (element, event, handler) {
      return bind$2(element, event, filter$2, handler);
    };
    var capture$1 = function (element, event, handler) {
      return capture(element, event, filter$2, handler);
    };
    var fromRawEvent$1 = fromRawEvent;

    var closest$4 = function (scope, selector, isRoot) {
      return closest$3(scope, selector, isRoot).isSome();
    };

    var DelayedFunction = function (fun, delay) {
      var ref = null;
      var schedule = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        ref = setTimeout(function () {
          fun.apply(null, args);
          ref = null;
        }, delay);
      };
      var cancel = function () {
        if (ref !== null) {
          clearTimeout(ref);
          ref = null;
        }
      };
      return {
        cancel: cancel,
        schedule: schedule
      };
    };

    var SIGNIFICANT_MOVE = 5;
    var LONGPRESS_DELAY = 400;
    var getTouch = function (event) {
      var raw = event.raw;
      if (raw.touches === undefined || raw.touches.length !== 1) {
        return Optional.none();
      }
      return Optional.some(raw.touches[0]);
    };
    var isFarEnough = function (touch, data) {
      var distX = Math.abs(touch.clientX - data.x);
      var distY = Math.abs(touch.clientY - data.y);
      return distX > SIGNIFICANT_MOVE || distY > SIGNIFICANT_MOVE;
    };
    var monitor = function (settings) {
      var startData = Cell(Optional.none());
      var longpressFired = Cell(false);
      var longpress$1 = DelayedFunction(function (event) {
        settings.triggerEvent(longpress(), event);
        longpressFired.set(true);
      }, LONGPRESS_DELAY);
      var handleTouchstart = function (event) {
        getTouch(event).each(function (touch) {
          longpress$1.cancel();
          var data = {
            x: touch.clientX,
            y: touch.clientY,
            target: event.target
          };
          longpress$1.schedule(event);
          longpressFired.set(false);
          startData.set(Optional.some(data));
        });
        return Optional.none();
      };
      var handleTouchmove = function (event) {
        longpress$1.cancel();
        getTouch(event).each(function (touch) {
          startData.get().each(function (data) {
            if (isFarEnough(touch, data)) {
              startData.set(Optional.none());
            }
          });
        });
        return Optional.none();
      };
      var handleTouchend = function (event) {
        longpress$1.cancel();
        var isSame = function (data) {
          return eq$1(data.target, event.target);
        };
        return startData.get().filter(isSame).map(function (_data) {
          if (longpressFired.get()) {
            event.prevent();
            return false;
          } else {
            return settings.triggerEvent(tap(), event);
          }
        });
      };
      var handlers = wrapAll$1([
        {
          key: touchstart(),
          value: handleTouchstart
        },
        {
          key: touchmove(),
          value: handleTouchmove
        },
        {
          key: touchend(),
          value: handleTouchend
        }
      ]);
      var fireIfReady = function (event, type) {
        return get$1(handlers, type).bind(function (handler) {
          return handler(event);
        });
      };
      return { fireIfReady: fireIfReady };
    };

    var isDangerous = function (event) {
      var keyEv = event.raw;
      return keyEv.which === BACKSPACE[0] && !contains([
        'input',
        'textarea'
      ], name(event.target)) && !closest$4(event.target, '[contenteditable="true"]');
    };
    var isFirefox = function () {
      return detect$3().browser.isFirefox();
    };
    var settingsSchema = objOfOnly([
      strictFunction('triggerEvent'),
      defaulted$1('stopBackspace', true)
    ]);
    var bindFocus = function (container, handler) {
      if (isFirefox()) {
        return capture$1(container, 'focus', handler);
      } else {
        return bind$3(container, 'focusin', handler);
      }
    };
    var bindBlur = function (container, handler) {
      if (isFirefox()) {
        return capture$1(container, 'blur', handler);
      } else {
        return bind$3(container, 'focusout', handler);
      }
    };
    var setup$1 = function (container, rawSettings) {
      var settings = asRawOrDie('Getting GUI events settings', settingsSchema, rawSettings);
      var pointerEvents = [
        'touchstart',
        'touchmove',
        'touchend',
        'touchcancel',
        'gesturestart',
        'mousedown',
        'mouseup',
        'mouseover',
        'mousemove',
        'mouseout',
        'click'
      ];
      var tapEvent = monitor(settings);
      var simpleEvents = map(pointerEvents.concat([
        'selectstart',
        'input',
        'contextmenu',
        'change',
        'transitionend',
        'drag',
        'dragstart',
        'dragend',
        'dragenter',
        'dragleave',
        'dragover',
        'drop',
        'keyup'
      ]), function (type) {
        return bind$3(container, type, function (event) {
          tapEvent.fireIfReady(event, type).each(function (tapStopped) {
            if (tapStopped) {
              event.kill();
            }
          });
          var stopped = settings.triggerEvent(type, event);
          if (stopped) {
            event.kill();
          }
        });
      });
      var pasteTimeout = Cell(Optional.none());
      var onPaste = bind$3(container, 'paste', function (event) {
        tapEvent.fireIfReady(event, 'paste').each(function (tapStopped) {
          if (tapStopped) {
            event.kill();
          }
        });
        var stopped = settings.triggerEvent('paste', event);
        if (stopped) {
          event.kill();
        }
        pasteTimeout.set(Optional.some(setTimeout(function () {
          settings.triggerEvent(postPaste(), event);
        }, 0)));
      });
      var onKeydown = bind$3(container, 'keydown', function (event) {
        var stopped = settings.triggerEvent('keydown', event);
        if (stopped) {
          event.kill();
        } else if (settings.stopBackspace === true && isDangerous(event)) {
          event.prevent();
        }
      });
      var onFocusIn = bindFocus(container, function (event) {
        var stopped = settings.triggerEvent('focusin', event);
        if (stopped) {
          event.kill();
        }
      });
      var focusoutTimeout = Cell(Optional.none());
      var onFocusOut = bindBlur(container, function (event) {
        var stopped = settings.triggerEvent('focusout', event);
        if (stopped) {
          event.kill();
        }
        focusoutTimeout.set(Optional.some(setTimeout(function () {
          settings.triggerEvent(postBlur(), event);
        }, 0)));
      });
      var unbind = function () {
        each(simpleEvents, function (e) {
          e.unbind();
        });
        onKeydown.unbind();
        onFocusIn.unbind();
        onFocusOut.unbind();
        onPaste.unbind();
        pasteTimeout.get().each(clearTimeout);
        focusoutTimeout.get().each(clearTimeout);
      };
      return { unbind: unbind };
    };

    var derive$2 = function (rawEvent, rawTarget) {
      var source = get$1(rawEvent, 'target').getOr(rawTarget);
      return Cell(source);
    };

    var fromSource = function (event, source) {
      var stopper = Cell(false);
      var cutter = Cell(false);
      var stop = function () {
        stopper.set(true);
      };
      var cut = function () {
        cutter.set(true);
      };
      return {
        stop: stop,
        cut: cut,
        isStopped: stopper.get,
        isCut: cutter.get,
        event: event,
        setSource: source.set,
        getSource: source.get
      };
    };
    var fromExternal = function (event) {
      var stopper = Cell(false);
      var stop = function () {
        stopper.set(true);
      };
      return {
        stop: stop,
        cut: noop,
        isStopped: stopper.get,
        isCut: never,
        event: event,
        setSource: die('Cannot set source of a broadcasted event'),
        getSource: die('Cannot get source of a broadcasted event')
      };
    };

    var adt$b = Adt.generate([
      { stopped: [] },
      { resume: ['element'] },
      { complete: [] }
    ]);
    var doTriggerHandler = function (lookup, eventType, rawEvent, target, source, logger) {
      var handler = lookup(eventType, target);
      var simulatedEvent = fromSource(rawEvent, source);
      return handler.fold(function () {
        logger.logEventNoHandlers(eventType, target);
        return adt$b.complete();
      }, function (handlerInfo) {
        var descHandler = handlerInfo.descHandler;
        var eventHandler = getCurried(descHandler);
        eventHandler(simulatedEvent);
        if (simulatedEvent.isStopped()) {
          logger.logEventStopped(eventType, handlerInfo.element, descHandler.purpose);
          return adt$b.stopped();
        } else if (simulatedEvent.isCut()) {
          logger.logEventCut(eventType, handlerInfo.element, descHandler.purpose);
          return adt$b.complete();
        } else {
          return parent(handlerInfo.element).fold(function () {
            logger.logNoParent(eventType, handlerInfo.element, descHandler.purpose);
            return adt$b.complete();
          }, function (parent) {
            logger.logEventResponse(eventType, handlerInfo.element, descHandler.purpose);
            return adt$b.resume(parent);
          });
        }
      });
    };
    var doTriggerOnUntilStopped = function (lookup, eventType, rawEvent, rawTarget, source, logger) {
      return doTriggerHandler(lookup, eventType, rawEvent, rawTarget, source, logger).fold(always, function (parent) {
        return doTriggerOnUntilStopped(lookup, eventType, rawEvent, parent, source, logger);
      }, never);
    };
    var triggerHandler = function (lookup, eventType, rawEvent, target, logger) {
      var source = derive$2(rawEvent, target);
      return doTriggerHandler(lookup, eventType, rawEvent, target, source, logger);
    };
    var broadcast = function (listeners, rawEvent, _logger) {
      var simulatedEvent = fromExternal(rawEvent);
      each(listeners, function (listener) {
        var descHandler = listener.descHandler;
        var handler = getCurried(descHandler);
        handler(simulatedEvent);
      });
      return simulatedEvent.isStopped();
    };
    var triggerUntilStopped = function (lookup, eventType, rawEvent, logger) {
      return triggerOnUntilStopped(lookup, eventType, rawEvent, rawEvent.target, logger);
    };
    var triggerOnUntilStopped = function (lookup, eventType, rawEvent, rawTarget, logger) {
      var source = derive$2(rawEvent, rawTarget);
      return doTriggerOnUntilStopped(lookup, eventType, rawEvent, rawTarget, source, logger);
    };

    var eventHandler = function (element, descHandler) {
      return {
        element: element,
        descHandler: descHandler
      };
    };
    var broadcastHandler = function (id, handler) {
      return {
        id: id,
        descHandler: handler
      };
    };
    var EventRegistry = function () {
      var registry = {};
      var registerId = function (extraArgs, id, events) {
        each$1(events, function (v, k) {
          var handlers = registry[k] !== undefined ? registry[k] : {};
          handlers[id] = curryArgs(v, extraArgs);
          registry[k] = handlers;
        });
      };
      var findHandler = function (handlers, elem) {
        return read$1(elem).fold(function () {
          return Optional.none();
        }, function (id) {
          return handlers.bind(function (h) {
            return get$1(h, id);
          }).map(function (descHandler) {
            return eventHandler(elem, descHandler);
          });
        });
      };
      var filterByType = function (type) {
        return get$1(registry, type).map(function (handlers) {
          return mapToArray(handlers, function (f, id) {
            return broadcastHandler(id, f);
          });
        }).getOr([]);
      };
      var find = function (isAboveRoot, type, target) {
        var handlers = get$1(registry, type);
        return closest(target, function (elem) {
          return findHandler(handlers, elem);
        }, isAboveRoot);
      };
      var unregisterId = function (id) {
        each$1(registry, function (handlersById, _eventName) {
          if (handlersById.hasOwnProperty(id)) {
            delete handlersById[id];
          }
        });
      };
      return {
        registerId: registerId,
        unregisterId: unregisterId,
        filterByType: filterByType,
        find: find
      };
    };

    var Registry = function () {
      var events = EventRegistry();
      var components = {};
      var readOrTag = function (component) {
        var elem = component.element;
        return read$1(elem).fold(function () {
          return write('uid-', component.element);
        }, function (uid) {
          return uid;
        });
      };
      var failOnDuplicate = function (component, tagId) {
        var conflict = components[tagId];
        if (conflict === component) {
          unregister(component);
        } else {
          throw new Error('The tagId "' + tagId + '" is already used by: ' + element(conflict.element) + '\nCannot use it for: ' + element(component.element) + '\n' + 'The conflicting element is' + (inBody(conflict.element) ? ' ' : ' not ') + 'already in the DOM');
        }
      };
      var register = function (component) {
        var tagId = readOrTag(component);
        if (hasNonNullableKey(components, tagId)) {
          failOnDuplicate(component, tagId);
        }
        var extraArgs = [component];
        events.registerId(extraArgs, tagId, component.events);
        components[tagId] = component;
      };
      var unregister = function (component) {
        read$1(component.element).each(function (tagId) {
          delete components[tagId];
          events.unregisterId(tagId);
        });
      };
      var filter = function (type) {
        return events.filterByType(type);
      };
      var find = function (isAboveRoot, type, target) {
        return events.find(isAboveRoot, type, target);
      };
      var getById = function (id) {
        return get$1(components, id);
      };
      return {
        find: find,
        filter: filter,
        register: register,
        unregister: unregister,
        getById: getById
      };
    };

    var factory$3 = function (detail) {
      var _a = detail.dom, attributes = _a.attributes, domWithoutAttributes = __rest(_a, ['attributes']);
      return {
        uid: detail.uid,
        dom: __assign({
          tag: 'div',
          attributes: __assign({ role: 'presentation' }, attributes)
        }, domWithoutAttributes),
        components: detail.components,
        behaviours: get$d(detail.containerBehaviours),
        events: detail.events,
        domModification: detail.domModification,
        eventOrder: detail.eventOrder
      };
    };
    var Container = single$2({
      name: 'Container',
      factory: factory$3,
      configFields: [
        defaulted$1('components', []),
        field$1('containerBehaviours', []),
        defaulted$1('events', {}),
        defaulted$1('domModification', {}),
        defaulted$1('eventOrder', {})
      ]
    });

    var takeover = function (root) {
      var isAboveRoot = function (el) {
        return parent(root.element).fold(always, function (parent) {
          return eq$1(el, parent);
        });
      };
      var registry = Registry();
      var lookup = function (eventName, target) {
        return registry.find(isAboveRoot, eventName, target);
      };
      var domEvents = setup$1(root.element, {
        triggerEvent: function (eventName, event) {
          return monitorEvent(eventName, event.target, function (logger) {
            return triggerUntilStopped(lookup, eventName, event, logger);
          });
        }
      });
      var systemApi = {
        debugInfo: constant('real'),
        triggerEvent: function (eventName, target, data) {
          monitorEvent(eventName, target, function (logger) {
            return triggerOnUntilStopped(lookup, eventName, data, target, logger);
          });
        },
        triggerFocus: function (target, originator) {
          read$1(target).fold(function () {
            focus$1(target);
          }, function (_alloyId) {
            monitorEvent(focus(), target, function (logger) {
              triggerHandler(lookup, focus(), {
                originator: originator,
                kill: noop,
                prevent: noop,
                target: target
              }, target, logger);
              return false;
            });
          });
        },
        triggerEscape: function (comp, simulatedEvent) {
          systemApi.triggerEvent('keydown', comp.element, simulatedEvent.event);
        },
        getByUid: function (uid) {
          return getByUid(uid);
        },
        getByDom: function (elem) {
          return getByDom(elem);
        },
        build: build$1,
        addToGui: function (c) {
          add(c);
        },
        removeFromGui: function (c) {
          remove$1(c);
        },
        addToWorld: function (c) {
          addToWorld(c);
        },
        removeFromWorld: function (c) {
          removeFromWorld(c);
        },
        broadcast: function (message) {
          broadcast$1(message);
        },
        broadcastOn: function (channels, message) {
          broadcastOn(channels, message);
        },
        broadcastEvent: function (eventName, event) {
          broadcastEvent(eventName, event);
        },
        isConnected: always
      };
      var addToWorld = function (component) {
        component.connect(systemApi);
        if (!isText(component.element)) {
          registry.register(component);
          each(component.components(), addToWorld);
          systemApi.triggerEvent(systemInit(), component.element, { target: component.element });
        }
      };
      var removeFromWorld = function (component) {
        if (!isText(component.element)) {
          each(component.components(), removeFromWorld);
          registry.unregister(component);
        }
        component.disconnect();
      };
      var add = function (component) {
        attach$1(root, component);
      };
      var remove$1 = function (component) {
        detach(component);
      };
      var destroy = function () {
        domEvents.unbind();
        remove(root.element);
      };
      var broadcastData = function (data) {
        var receivers = registry.filter(receive());
        each(receivers, function (receiver) {
          var descHandler = receiver.descHandler;
          var handler = getCurried(descHandler);
          handler(data);
        });
      };
      var broadcast$1 = function (message) {
        broadcastData({
          universal: true,
          data: message
        });
      };
      var broadcastOn = function (channels, message) {
        broadcastData({
          universal: false,
          channels: channels,
          data: message
        });
      };
      var broadcastEvent = function (eventName, event) {
        var listeners = registry.filter(eventName);
        return broadcast(listeners, event);
      };
      var getByUid = function (uid) {
        return registry.getById(uid).fold(function () {
          return Result.error(new Error('Could not find component with uid: "' + uid + '" in system.'));
        }, Result.value);
      };
      var getByDom = function (elem) {
        var uid = read$1(elem).getOr('not found');
        return getByUid(uid);
      };
      addToWorld(root);
      return {
        root: root,
        element: root.element,
        destroy: destroy,
        add: add,
        remove: remove$1,
        getByUid: getByUid,
        getByDom: getByDom,
        addToWorld: addToWorld,
        removeFromWorld: removeFromWorld,
        broadcast: broadcast$1,
        broadcastOn: broadcastOn,
        broadcastEvent: broadcastEvent
      };
    };

    var renderBar = function (spec, backstage) {
      return {
        dom: {
          tag: 'div',
          classes: [
            'tox-bar',
            'tox-form__controls-h-stack'
          ]
        },
        components: map(spec.items, backstage.interpreter)
      };
    };

    var schema$e = constant([
      defaulted$1('prefix', 'form-field'),
      field$1('fieldBehaviours', [
        Composing,
        Representing
      ])
    ]);
    var parts$3 = constant([
      optional({
        schema: [strict$1('dom')],
        name: 'label'
      }),
      optional({
        factory: {
          sketch: function (spec) {
            return {
              uid: spec.uid,
              dom: {
                tag: 'span',
                styles: { display: 'none' },
                attributes: { 'aria-hidden': 'true' },
                innerHtml: spec.text
              }
            };
          }
        },
        schema: [strict$1('text')],
        name: 'aria-descriptor'
      }),
      required({
        factory: {
          sketch: function (spec) {
            var excludeFactory = exclude$1(spec, ['factory']);
            return spec.factory.sketch(excludeFactory);
          }
        },
        schema: [strict$1('factory')],
        name: 'field'
      })
    ]);

    var factory$4 = function (detail, components, _spec, _externals) {
      var behaviours = augment(detail.fieldBehaviours, [
        Composing.config({
          find: function (container) {
            return getPart(container, detail, 'field');
          }
        }),
        Representing.config({
          store: {
            mode: 'manual',
            getValue: function (field) {
              return Composing.getCurrent(field).bind(Representing.getValue);
            },
            setValue: function (field, value) {
              Composing.getCurrent(field).each(function (current) {
                Representing.setValue(current, value);
              });
            }
          }
        })
      ]);
      var events = derive([runOnAttached(function (component, _simulatedEvent) {
          var ps = getParts(component, detail, [
            'label',
            'field',
            'aria-descriptor'
          ]);
          ps.field().each(function (field) {
            var id = generate$1(detail.prefix);
            ps.label().each(function (label) {
              set$1(label.element, 'for', id);
              set$1(field.element, 'id', id);
            });
            ps['aria-descriptor']().each(function (descriptor) {
              var descriptorId = generate$1(detail.prefix);
              set$1(descriptor.element, 'id', descriptorId);
              set$1(field.element, 'aria-describedby', descriptorId);
            });
          });
        })]);
      var apis = {
        getField: function (container) {
          return getPart(container, detail, 'field');
        },
        getLabel: function (container) {
          return getPart(container, detail, 'label');
        }
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: behaviours,
        events: events,
        apis: apis
      };
    };
    var FormField = composite$1({
      name: 'FormField',
      configFields: schema$e(),
      partFields: parts$3(),
      factory: factory$4,
      apis: {
        getField: function (apis, comp) {
          return apis.getField(comp);
        },
        getLabel: function (apis, comp) {
          return apis.getLabel(comp);
        }
      }
    });

    var exhibit$4 = function (base, tabConfig) {
      return nu$6({
        attributes: wrapAll$1([{
            key: tabConfig.tabAttr,
            value: 'true'
          }])
      });
    };

    var ActiveTabstopping = /*#__PURE__*/Object.freeze({
        __proto__: null,
        exhibit: exhibit$4
    });

    var TabstopSchema = [defaulted$1('tabAttr', 'data-alloy-tabstop')];

    var Tabstopping = create$1({
      fields: TabstopSchema,
      name: 'tabstopping',
      active: ActiveTabstopping
    });

    var global$a = tinymce.util.Tools.resolve('tinymce.html.Entities');

    var renderFormFieldWith = function (pLabel, pField, extraClasses, extraBehaviours) {
      var spec = renderFormFieldSpecWith(pLabel, pField, extraClasses, extraBehaviours);
      return FormField.sketch(spec);
    };
    var renderFormField = function (pLabel, pField) {
      return renderFormFieldWith(pLabel, pField, [], []);
    };
    var renderFormFieldSpecWith = function (pLabel, pField, extraClasses, extraBehaviours) {
      return {
        dom: renderFormFieldDomWith(extraClasses),
        components: pLabel.toArray().concat([pField]),
        fieldBehaviours: derive$1(extraBehaviours)
      };
    };
    var renderFormFieldDom = function () {
      return renderFormFieldDomWith([]);
    };
    var renderFormFieldDomWith = function (extraClasses) {
      return {
        tag: 'div',
        classes: ['tox-form__group'].concat(extraClasses)
      };
    };
    var renderLabel = function (label, providersBackstage) {
      return FormField.parts.label({
        dom: {
          tag: 'label',
          classes: ['tox-label'],
          innerHtml: providersBackstage.translate(label)
        }
      });
    };

    var formChangeEvent = generate$1('form-component-change');
    var formCloseEvent = generate$1('form-close');
    var formCancelEvent = generate$1('form-cancel');
    var formActionEvent = generate$1('form-action');
    var formSubmitEvent = generate$1('form-submit');
    var formBlockEvent = generate$1('form-block');
    var formUnblockEvent = generate$1('form-unblock');
    var formTabChangeEvent = generate$1('form-tabchange');
    var formResizeEvent = generate$1('form-resize');

    var renderCollection = function (spec, providersBackstage) {
      var _a;
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var runOnItem = function (f) {
        return function (comp, se) {
          closest$3(se.event.target, '[data-collection-item-value]').each(function (target) {
            f(comp, se, target, get$3(target, 'data-collection-item-value'));
          });
        };
      };
      var setContents = function (comp, items) {
        var htmlLines = map(items, function (item) {
          var itemText = global$6.translate(item.text);
          var textContent = spec.columns === 1 ? '<div class="tox-collection__item-label">' + itemText + '</div>' : '';
          var iconContent = '<div class="tox-collection__item-icon">' + item.icon + '</div>';
          var mapItemName = {
            '_': ' ',
            ' - ': ' ',
            '-': ' '
          };
          var ariaLabel = itemText.replace(/\_| \- |\-/g, function (match) {
            return mapItemName[match];
          });
          var disabledClass = providersBackstage.isDisabled() ? ' tox-collection__item--state-disabled' : '';
          return '<div class="tox-collection__item' + disabledClass + '" tabindex="-1" data-collection-item-value="' + global$a.encodeAllRaw(item.value) + '" title="' + ariaLabel + '" aria-label="' + ariaLabel + '">' + iconContent + textContent + '</div>';
        });
        var chunks = spec.columns !== 'auto' && spec.columns > 1 ? chunk(htmlLines, spec.columns) : [htmlLines];
        var html = map(chunks, function (ch) {
          return '<div class="tox-collection__group">' + ch.join('') + '</div>';
        });
        set(comp.element, html.join(''));
      };
      var onClick = runOnItem(function (comp, se, tgt, itemValue) {
        se.stop();
        if (!providersBackstage.isDisabled()) {
          emitWith(comp, formActionEvent, {
            name: spec.name,
            value: itemValue
          });
        }
      });
      var collectionEvents = [
        run(mouseover(), runOnItem(function (comp, se, tgt) {
          focus$1(tgt);
        })),
        run(click(), onClick),
        run(tap(), onClick),
        run(focusin(), runOnItem(function (comp, se, tgt) {
          descendant$1(comp.element, '.' + activeClass).each(function (currentActive) {
            remove$4(currentActive, activeClass);
          });
          add$2(tgt, activeClass);
        })),
        run(focusout(), runOnItem(function (comp) {
          descendant$1(comp.element, '.' + activeClass).each(function (currentActive) {
            remove$4(currentActive, activeClass);
          });
        })),
        runOnExecute(runOnItem(function (comp, se, tgt, itemValue) {
          emitWith(comp, formActionEvent, {
            name: spec.name,
            value: itemValue
          });
        }))
      ];
      var iterCollectionItems = function (comp, applyAttributes) {
        return map(descendants(comp.element, '.tox-collection__item'), applyAttributes);
      };
      var pField = FormField.parts.field({
        dom: {
          tag: 'div',
          classes: ['tox-collection'].concat(spec.columns !== 1 ? ['tox-collection--grid'] : ['tox-collection--list'])
        },
        components: [],
        factory: { sketch: identity },
        behaviours: derive$1([
          Disabling.config({
            disabled: providersBackstage.isDisabled,
            onDisabled: function (comp) {
              iterCollectionItems(comp, function (childElm) {
                add$2(childElm, 'tox-collection__item--state-disabled');
                set$1(childElm, 'aria-disabled', true);
              });
            },
            onEnabled: function (comp) {
              iterCollectionItems(comp, function (childElm) {
                remove$4(childElm, 'tox-collection__item--state-disabled');
                remove$1(childElm, 'aria-disabled');
              });
            }
          }),
          receivingConfig(),
          Replacing.config({}),
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: []
            },
            onSetValue: function (comp, items) {
              setContents(comp, items);
              if (spec.columns === 'auto') {
                detectSize(comp, 5, 'tox-collection__item').each(function (_a) {
                  var numRows = _a.numRows, numColumns = _a.numColumns;
                  Keying.setGridSize(comp, numRows, numColumns);
                });
              }
              emit(comp, formResizeEvent);
            }
          }),
          Tabstopping.config({}),
          Keying.config(deriveCollectionMovement(spec.columns, 'normal')),
          config('collection-events', collectionEvents)
        ]),
        eventOrder: (_a = {}, _a[execute()] = [
          'disabling',
          'alloy.base.behaviour',
          'collection-events'
        ], _a)
      });
      var extraClasses = ['tox-form__group--collection'];
      return renderFormFieldWith(pLabel, pField, extraClasses, []);
    };

    var schema$f = constant([
      option('data'),
      defaulted$1('inputAttributes', {}),
      defaulted$1('inputStyles', {}),
      defaulted$1('tag', 'input'),
      defaulted$1('inputClasses', []),
      onHandler('onSetValue'),
      defaulted$1('styles', {}),
      defaulted$1('eventOrder', {}),
      field$1('inputBehaviours', [
        Representing,
        Focusing
      ]),
      defaulted$1('selectOnFocus', true)
    ]);
    var focusBehaviours = function (detail) {
      return derive$1([Focusing.config({
          onFocus: !detail.selectOnFocus ? noop : function (component) {
            var input = component.element;
            var value = get$6(input);
            input.dom.setSelectionRange(0, value.length);
          }
        })]);
    };
    var behaviours = function (detail) {
      return __assign(__assign({}, focusBehaviours(detail)), augment(detail.inputBehaviours, [Representing.config({
          store: __assign(__assign({ mode: 'manual' }, detail.data.map(function (data) {
            return { initialValue: data };
          }).getOr({})), {
            getValue: function (input) {
              return get$6(input.element);
            },
            setValue: function (input, data) {
              var current = get$6(input.element);
              if (current !== data) {
                set$3(input.element, data);
              }
            }
          }),
          onSetValue: detail.onSetValue
        })]));
    };
    var dom$2 = function (detail) {
      return {
        tag: detail.tag,
        attributes: __assign({ type: 'text' }, detail.inputAttributes),
        styles: detail.inputStyles,
        classes: detail.inputClasses
      };
    };

    var factory$5 = function (detail, _spec) {
      return {
        uid: detail.uid,
        dom: dom$2(detail),
        components: [],
        behaviours: behaviours(detail),
        eventOrder: detail.eventOrder
      };
    };
    var Input = single$2({
      name: 'Input',
      configFields: schema$f(),
      factory: factory$5
    });

    var exports$1 = {}, module = { exports: exports$1 };
    (function (define, exports, module, require) {
      (function (f) {
        if (typeof exports === 'object' && typeof module !== 'undefined') {
          module.exports = f();
        } else if (typeof define === 'function' && define.amd) {
          define([], f);
        } else {
          var g;
          if (typeof window !== 'undefined') {
            g = window;
          } else if (typeof __webpack_require__.g !== 'undefined') {
            g = __webpack_require__.g;
          } else if (typeof self !== 'undefined') {
            g = self;
          } else {
            g = this;
          }
          g.EphoxContactWrapper = f();
        }
      }(function () {
        return function () {
          function r(e, n, t) {
            function o(i, f) {
              if (!n[i]) {
                if (!e[i]) {
                  var c = 'function' == typeof require && require;
                  if (!f && c)
                    return c(i, !0);
                  if (u)
                    return u(i, !0);
                  var a = new Error('Cannot find module \'' + i + '\'');
                  throw a.code = 'MODULE_NOT_FOUND', a;
                }
                var p = n[i] = { exports: {} };
                e[i][0].call(p.exports, function (r) {
                  var n = e[i][1][r];
                  return o(n || r);
                }, p, p.exports, r, e, n, t);
              }
              return n[i].exports;
            }
            for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++)
              o(t[i]);
            return o;
          }
          return r;
        }()({
          1: [
            function (require, module, exports) {
              var process = module.exports = {};
              var cachedSetTimeout;
              var cachedClearTimeout;
              function defaultSetTimout() {
                throw new Error('setTimeout has not been defined');
              }
              function defaultClearTimeout() {
                throw new Error('clearTimeout has not been defined');
              }
              (function () {
                try {
                  if (typeof setTimeout === 'function') {
                    cachedSetTimeout = setTimeout;
                  } else {
                    cachedSetTimeout = defaultSetTimout;
                  }
                } catch (e) {
                  cachedSetTimeout = defaultSetTimout;
                }
                try {
                  if (typeof clearTimeout === 'function') {
                    cachedClearTimeout = clearTimeout;
                  } else {
                    cachedClearTimeout = defaultClearTimeout;
                  }
                } catch (e) {
                  cachedClearTimeout = defaultClearTimeout;
                }
              }());
              function runTimeout(fun) {
                if (cachedSetTimeout === setTimeout) {
                  return setTimeout(fun, 0);
                }
                if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
                  cachedSetTimeout = setTimeout;
                  return setTimeout(fun, 0);
                }
                try {
                  return cachedSetTimeout(fun, 0);
                } catch (e) {
                  try {
                    return cachedSetTimeout.call(null, fun, 0);
                  } catch (e) {
                    return cachedSetTimeout.call(this, fun, 0);
                  }
                }
              }
              function runClearTimeout(marker) {
                if (cachedClearTimeout === clearTimeout) {
                  return clearTimeout(marker);
                }
                if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
                  cachedClearTimeout = clearTimeout;
                  return clearTimeout(marker);
                }
                try {
                  return cachedClearTimeout(marker);
                } catch (e) {
                  try {
                    return cachedClearTimeout.call(null, marker);
                  } catch (e) {
                    return cachedClearTimeout.call(this, marker);
                  }
                }
              }
              var queue = [];
              var draining = false;
              var currentQueue;
              var queueIndex = -1;
              function cleanUpNextTick() {
                if (!draining || !currentQueue) {
                  return;
                }
                draining = false;
                if (currentQueue.length) {
                  queue = currentQueue.concat(queue);
                } else {
                  queueIndex = -1;
                }
                if (queue.length) {
                  drainQueue();
                }
              }
              function drainQueue() {
                if (draining) {
                  return;
                }
                var timeout = runTimeout(cleanUpNextTick);
                draining = true;
                var len = queue.length;
                while (len) {
                  currentQueue = queue;
                  queue = [];
                  while (++queueIndex < len) {
                    if (currentQueue) {
                      currentQueue[queueIndex].run();
                    }
                  }
                  queueIndex = -1;
                  len = queue.length;
                }
                currentQueue = null;
                draining = false;
                runClearTimeout(timeout);
              }
              process.nextTick = function (fun) {
                var args = new Array(arguments.length - 1);
                if (arguments.length > 1) {
                  for (var i = 1; i < arguments.length; i++) {
                    args[i - 1] = arguments[i];
                  }
                }
                queue.push(new Item(fun, args));
                if (queue.length === 1 && !draining) {
                  runTimeout(drainQueue);
                }
              };
              function Item(fun, array) {
                this.fun = fun;
                this.array = array;
              }
              Item.prototype.run = function () {
                this.fun.apply(null, this.array);
              };
              process.title = 'browser';
              process.browser = true;
              process.env = {};
              process.argv = [];
              process.version = '';
              process.versions = {};
              function noop() {
              }
              process.on = noop;
              process.addListener = noop;
              process.once = noop;
              process.off = noop;
              process.removeListener = noop;
              process.removeAllListeners = noop;
              process.emit = noop;
              process.prependListener = noop;
              process.prependOnceListener = noop;
              process.listeners = function (name) {
                return [];
              };
              process.binding = function (name) {
                throw new Error('process.binding is not supported');
              };
              process.cwd = function () {
                return '/';
              };
              process.chdir = function (dir) {
                throw new Error('process.chdir is not supported');
              };
              process.umask = function () {
                return 0;
              };
            },
            {}
          ],
          2: [
            function (require, module, exports) {
              (function (setImmediate) {
                (function (root) {
                  var setTimeoutFunc = setTimeout;
                  function noop() {
                  }
                  function bind(fn, thisArg) {
                    return function () {
                      fn.apply(thisArg, arguments);
                    };
                  }
                  function Promise(fn) {
                    if (typeof this !== 'object')
                      throw new TypeError('Promises must be constructed via new');
                    if (typeof fn !== 'function')
                      throw new TypeError('not a function');
                    this._state = 0;
                    this._handled = false;
                    this._value = undefined;
                    this._deferreds = [];
                    doResolve(fn, this);
                  }
                  function handle(self, deferred) {
                    while (self._state === 3) {
                      self = self._value;
                    }
                    if (self._state === 0) {
                      self._deferreds.push(deferred);
                      return;
                    }
                    self._handled = true;
                    Promise._immediateFn(function () {
                      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;
                      if (cb === null) {
                        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);
                        return;
                      }
                      var ret;
                      try {
                        ret = cb(self._value);
                      } catch (e) {
                        reject(deferred.promise, e);
                        return;
                      }
                      resolve(deferred.promise, ret);
                    });
                  }
                  function resolve(self, newValue) {
                    try {
                      if (newValue === self)
                        throw new TypeError('A promise cannot be resolved with itself.');
                      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {
                        var then = newValue.then;
                        if (newValue instanceof Promise) {
                          self._state = 3;
                          self._value = newValue;
                          finale(self);
                          return;
                        } else if (typeof then === 'function') {
                          doResolve(bind(then, newValue), self);
                          return;
                        }
                      }
                      self._state = 1;
                      self._value = newValue;
                      finale(self);
                    } catch (e) {
                      reject(self, e);
                    }
                  }
                  function reject(self, newValue) {
                    self._state = 2;
                    self._value = newValue;
                    finale(self);
                  }
                  function finale(self) {
                    if (self._state === 2 && self._deferreds.length === 0) {
                      Promise._immediateFn(function () {
                        if (!self._handled) {
                          Promise._unhandledRejectionFn(self._value);
                        }
                      });
                    }
                    for (var i = 0, len = self._deferreds.length; i < len; i++) {
                      handle(self, self._deferreds[i]);
                    }
                    self._deferreds = null;
                  }
                  function Handler(onFulfilled, onRejected, promise) {
                    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;
                    this.onRejected = typeof onRejected === 'function' ? onRejected : null;
                    this.promise = promise;
                  }
                  function doResolve(fn, self) {
                    var done = false;
                    try {
                      fn(function (value) {
                        if (done)
                          return;
                        done = true;
                        resolve(self, value);
                      }, function (reason) {
                        if (done)
                          return;
                        done = true;
                        reject(self, reason);
                      });
                    } catch (ex) {
                      if (done)
                        return;
                      done = true;
                      reject(self, ex);
                    }
                  }
                  Promise.prototype['catch'] = function (onRejected) {
                    return this.then(null, onRejected);
                  };
                  Promise.prototype.then = function (onFulfilled, onRejected) {
                    var prom = new this.constructor(noop);
                    handle(this, new Handler(onFulfilled, onRejected, prom));
                    return prom;
                  };
                  Promise.all = function (arr) {
                    var args = Array.prototype.slice.call(arr);
                    return new Promise(function (resolve, reject) {
                      if (args.length === 0)
                        return resolve([]);
                      var remaining = args.length;
                      function res(i, val) {
                        try {
                          if (val && (typeof val === 'object' || typeof val === 'function')) {
                            var then = val.then;
                            if (typeof then === 'function') {
                              then.call(val, function (val) {
                                res(i, val);
                              }, reject);
                              return;
                            }
                          }
                          args[i] = val;
                          if (--remaining === 0) {
                            resolve(args);
                          }
                        } catch (ex) {
                          reject(ex);
                        }
                      }
                      for (var i = 0; i < args.length; i++) {
                        res(i, args[i]);
                      }
                    });
                  };
                  Promise.resolve = function (value) {
                    if (value && typeof value === 'object' && value.constructor === Promise) {
                      return value;
                    }
                    return new Promise(function (resolve) {
                      resolve(value);
                    });
                  };
                  Promise.reject = function (value) {
                    return new Promise(function (resolve, reject) {
                      reject(value);
                    });
                  };
                  Promise.race = function (values) {
                    return new Promise(function (resolve, reject) {
                      for (var i = 0, len = values.length; i < len; i++) {
                        values[i].then(resolve, reject);
                      }
                    });
                  };
                  Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {
                    setImmediate(fn);
                  } : function (fn) {
                    setTimeoutFunc(fn, 0);
                  };
                  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {
                    if (typeof console !== 'undefined' && console) {
                      console.warn('Possible Unhandled Promise Rejection:', err);
                    }
                  };
                  Promise._setImmediateFn = function _setImmediateFn(fn) {
                    Promise._immediateFn = fn;
                  };
                  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {
                    Promise._unhandledRejectionFn = fn;
                  };
                  if (typeof module !== 'undefined' && module.exports) {
                    module.exports = Promise;
                  } else if (!root.Promise) {
                    root.Promise = Promise;
                  }
                }(this));
              }.call(this, require('timers').setImmediate));
            },
            { 'timers': 3 }
          ],
          3: [
            function (require, module, exports) {
              (function (setImmediate, clearImmediate) {
                var nextTick = require('process/browser.js').nextTick;
                var apply = Function.prototype.apply;
                var slice = Array.prototype.slice;
                var immediateIds = {};
                var nextImmediateId = 0;
                exports.setTimeout = function () {
                  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);
                };
                exports.setInterval = function () {
                  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);
                };
                exports.clearTimeout = exports.clearInterval = function (timeout) {
                  timeout.close();
                };
                function Timeout(id, clearFn) {
                  this._id = id;
                  this._clearFn = clearFn;
                }
                Timeout.prototype.unref = Timeout.prototype.ref = function () {
                };
                Timeout.prototype.close = function () {
                  this._clearFn.call(window, this._id);
                };
                exports.enroll = function (item, msecs) {
                  clearTimeout(item._idleTimeoutId);
                  item._idleTimeout = msecs;
                };
                exports.unenroll = function (item) {
                  clearTimeout(item._idleTimeoutId);
                  item._idleTimeout = -1;
                };
                exports._unrefActive = exports.active = function (item) {
                  clearTimeout(item._idleTimeoutId);
                  var msecs = item._idleTimeout;
                  if (msecs >= 0) {
                    item._idleTimeoutId = setTimeout(function onTimeout() {
                      if (item._onTimeout)
                        item._onTimeout();
                    }, msecs);
                  }
                };
                exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {
                  var id = nextImmediateId++;
                  var args = arguments.length < 2 ? false : slice.call(arguments, 1);
                  immediateIds[id] = true;
                  nextTick(function onNextTick() {
                    if (immediateIds[id]) {
                      if (args) {
                        fn.apply(null, args);
                      } else {
                        fn.call(null);
                      }
                      exports.clearImmediate(id);
                    }
                  });
                  return id;
                };
                exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {
                  delete immediateIds[id];
                };
              }.call(this, require('timers').setImmediate, require('timers').clearImmediate));
            },
            {
              'process/browser.js': 1,
              'timers': 3
            }
          ],
          4: [
            function (require, module, exports) {
              var promisePolyfill = require('promise-polyfill');
              var Global = function () {
                if (typeof window !== 'undefined') {
                  return window;
                } else {
                  return Function('return this;')();
                }
              }();
              module.exports = { boltExport: Global.Promise || promisePolyfill };
            },
            { 'promise-polyfill': 2 }
          ]
        }, {}, [4])(4);
      }));
    }(undefined, exports$1, module, undefined));
    var Promise = module.exports.boltExport;

    var nu$a = function (baseFn) {
      var data = Optional.none();
      var callbacks = [];
      var map = function (f) {
        return nu$a(function (nCallback) {
          get(function (data) {
            nCallback(f(data));
          });
        });
      };
      var get = function (nCallback) {
        if (isReady()) {
          call(nCallback);
        } else {
          callbacks.push(nCallback);
        }
      };
      var set = function (x) {
        if (!isReady()) {
          data = Optional.some(x);
          run(callbacks);
          callbacks = [];
        }
      };
      var isReady = function () {
        return data.isSome();
      };
      var run = function (cbs) {
        each(cbs, call);
      };
      var call = function (cb) {
        data.each(function (x) {
          setTimeout(function () {
            cb(x);
          }, 0);
        });
      };
      baseFn(set);
      return {
        get: get,
        map: map,
        isReady: isReady
      };
    };
    var pure = function (a) {
      return nu$a(function (callback) {
        callback(a);
      });
    };
    var LazyValue = {
      nu: nu$a,
      pure: pure
    };

    var errorReporter = function (err) {
      setTimeout(function () {
        throw err;
      }, 0);
    };
    var make$3 = function (run) {
      var get = function (callback) {
        run().then(callback, errorReporter);
      };
      var map = function (fab) {
        return make$3(function () {
          return run().then(fab);
        });
      };
      var bind = function (aFutureB) {
        return make$3(function () {
          return run().then(function (v) {
            return aFutureB(v).toPromise();
          });
        });
      };
      var anonBind = function (futureB) {
        return make$3(function () {
          return run().then(function () {
            return futureB.toPromise();
          });
        });
      };
      var toLazy = function () {
        return LazyValue.nu(get);
      };
      var toCached = function () {
        var cache = null;
        return make$3(function () {
          if (cache === null) {
            cache = run();
          }
          return cache;
        });
      };
      var toPromise = run;
      return {
        map: map,
        bind: bind,
        anonBind: anonBind,
        toLazy: toLazy,
        toCached: toCached,
        toPromise: toPromise,
        get: get
      };
    };
    var nu$b = function (baseFn) {
      return make$3(function () {
        return new Promise(baseFn);
      });
    };
    var pure$1 = function (a) {
      return make$3(function () {
        return Promise.resolve(a);
      });
    };
    var Future = {
      nu: nu$b,
      pure: pure$1
    };

    var ariaElements = [
      'input',
      'textarea'
    ];
    var isAriaElement = function (elem) {
      var name$1 = name(elem);
      return contains(ariaElements, name$1);
    };
    var markValid = function (component, invalidConfig) {
      var elem = invalidConfig.getRoot(component).getOr(component.element);
      remove$4(elem, invalidConfig.invalidClass);
      invalidConfig.notify.each(function (notifyInfo) {
        if (isAriaElement(component.element)) {
          set$1(component.element, 'aria-invalid', false);
        }
        notifyInfo.getContainer(component).each(function (container) {
          set(container, notifyInfo.validHtml);
        });
        notifyInfo.onValid(component);
      });
    };
    var markInvalid = function (component, invalidConfig, invalidState, text) {
      var elem = invalidConfig.getRoot(component).getOr(component.element);
      add$2(elem, invalidConfig.invalidClass);
      invalidConfig.notify.each(function (notifyInfo) {
        if (isAriaElement(component.element)) {
          set$1(component.element, 'aria-invalid', true);
        }
        notifyInfo.getContainer(component).each(function (container) {
          set(container, text);
        });
        notifyInfo.onInvalid(component, text);
      });
    };
    var query = function (component, invalidConfig, _invalidState) {
      return invalidConfig.validator.fold(function () {
        return Future.pure(Result.value(true));
      }, function (validatorInfo) {
        return validatorInfo.validate(component);
      });
    };
    var run$1 = function (component, invalidConfig, invalidState) {
      invalidConfig.notify.each(function (notifyInfo) {
        notifyInfo.onValidate(component);
      });
      return query(component, invalidConfig).map(function (valid) {
        if (component.getSystem().isConnected()) {
          return valid.fold(function (err) {
            markInvalid(component, invalidConfig, invalidState, err);
            return Result.error(err);
          }, function (v) {
            markValid(component, invalidConfig);
            return Result.value(v);
          });
        } else {
          return Result.error('No longer in system');
        }
      });
    };
    var isInvalid = function (component, invalidConfig) {
      var elem = invalidConfig.getRoot(component).getOr(component.element);
      return has$2(elem, invalidConfig.invalidClass);
    };

    var InvalidateApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        markValid: markValid,
        markInvalid: markInvalid,
        query: query,
        run: run$1,
        isInvalid: isInvalid
    });

    var events$a = function (invalidConfig, invalidState) {
      return invalidConfig.validator.map(function (validatorInfo) {
        return derive([run(validatorInfo.onEvent, function (component) {
            run$1(component, invalidConfig, invalidState).get(identity);
          })].concat(validatorInfo.validateOnLoad ? [runOnAttached(function (component) {
            run$1(component, invalidConfig, invalidState).get(noop);
          })] : []));
      }).getOr({});
    };

    var ActiveInvalidate = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$a
    });

    var InvalidateSchema = [
      strict$1('invalidClass'),
      defaulted$1('getRoot', Optional.none),
      optionObjOf('notify', [
        defaulted$1('aria', 'alert'),
        defaulted$1('getContainer', Optional.none),
        defaulted$1('validHtml', ''),
        onHandler('onValid'),
        onHandler('onInvalid'),
        onHandler('onValidate')
      ]),
      optionObjOf('validator', [
        strict$1('validate'),
        defaulted$1('onEvent', 'input'),
        defaulted$1('validateOnLoad', true)
      ])
    ];

    var Invalidating = create$1({
      fields: InvalidateSchema,
      name: 'invalidating',
      active: ActiveInvalidate,
      apis: InvalidateApis,
      extra: {
        validation: function (validator) {
          return function (component) {
            var v = Representing.getValue(component);
            return Future.pure(validator(v));
          };
        }
      }
    });

    var getCoupled = function (component, coupleConfig, coupleState, name) {
      return coupleState.getOrCreate(component, coupleConfig, name);
    };

    var CouplingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        getCoupled: getCoupled
    });

    var CouplingSchema = [strictOf('others', setOf$1(Result.value, anyValue$1()))];

    var init$5 = function () {
      var coupled = {};
      var getOrCreate = function (component, coupleConfig, name) {
        var available = keys(coupleConfig.others);
        if (!available) {
          throw new Error('Cannot find coupled component: ' + name + '. Known coupled components: ' + JSON.stringify(available, null, 2));
        } else {
          return get$1(coupled, name).getOrThunk(function () {
            var builder = get$1(coupleConfig.others, name).getOrDie('No information found for coupled component: ' + name);
            var spec = builder(component);
            var built = component.getSystem().build(spec);
            coupled[name] = built;
            return built;
          });
        }
      };
      var readState = constant({});
      return nu$5({
        readState: readState,
        getOrCreate: getOrCreate
      });
    };

    var CouplingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$5
    });

    var Coupling = create$1({
      fields: CouplingSchema,
      name: 'coupling',
      apis: CouplingApis,
      state: CouplingState
    });

    var suffix = constant('sink');
    var partType = constant(optional({
      name: suffix(),
      overrides: constant({
        dom: { tag: 'div' },
        behaviours: derive$1([Positioning.config({ useFixed: always })]),
        events: derive([
          cutter(keydown()),
          cutter(mousedown()),
          cutter(click())
        ])
      })
    }));

    var HighlightOnOpen;
    (function (HighlightOnOpen) {
      HighlightOnOpen[HighlightOnOpen['HighlightFirst'] = 0] = 'HighlightFirst';
      HighlightOnOpen[HighlightOnOpen['HighlightNone'] = 1] = 'HighlightNone';
    }(HighlightOnOpen || (HighlightOnOpen = {})));
    var getAnchor = function (detail, component) {
      var hotspot = detail.getHotspot(component).getOr(component);
      var anchor = 'hotspot';
      var overrides = detail.getAnchorOverrides();
      return detail.layouts.fold(function () {
        return {
          anchor: anchor,
          hotspot: hotspot,
          overrides: overrides
        };
      }, function (layouts) {
        return {
          anchor: anchor,
          hotspot: hotspot,
          overrides: overrides,
          layouts: layouts
        };
      });
    };
    var fetch = function (detail, mapFetch, component) {
      var fetcher = detail.fetch;
      return fetcher(component).map(mapFetch);
    };
    var openF = function (detail, mapFetch, anchor, component, sandbox, externals, highlightOnOpen) {
      var futureData = fetch(detail, mapFetch, component);
      var getLazySink = getSink(component, detail);
      return futureData.map(function (tdata) {
        return tdata.bind(function (data) {
          return Optional.from(tieredMenu.sketch(__assign(__assign({}, externals.menu()), {
            uid: generate$2(''),
            data: data,
            highlightImmediately: highlightOnOpen === HighlightOnOpen.HighlightFirst,
            onOpenMenu: function (tmenu, menu) {
              var sink = getLazySink().getOrDie();
              Positioning.position(sink, anchor, menu);
              Sandboxing.decloak(sandbox);
            },
            onOpenSubmenu: function (tmenu, item, submenu) {
              var sink = getLazySink().getOrDie();
              Positioning.position(sink, {
                anchor: 'submenu',
                item: item
              }, submenu);
              Sandboxing.decloak(sandbox);
            },
            onRepositionMenu: function (tmenu, primaryMenu, submenuTriggers) {
              var sink = getLazySink().getOrDie();
              Positioning.position(sink, anchor, primaryMenu);
              each(submenuTriggers, function (st) {
                Positioning.position(sink, {
                  anchor: 'submenu',
                  item: st.triggeringItem
                }, st.triggeredMenu);
              });
            },
            onEscape: function () {
              Focusing.focus(component);
              Sandboxing.close(sandbox);
              return Optional.some(true);
            }
          })));
        });
      });
    };
    var open$1 = function (detail, mapFetch, hotspot, sandbox, externals, onOpenSync, highlightOnOpen) {
      var anchor = getAnchor(detail, hotspot);
      var processed = openF(detail, mapFetch, anchor, hotspot, sandbox, externals, highlightOnOpen);
      return processed.map(function (tdata) {
        tdata.fold(function () {
          if (Sandboxing.isOpen(sandbox)) {
            Sandboxing.close(sandbox);
          }
        }, function (data) {
          Sandboxing.cloak(sandbox);
          Sandboxing.open(sandbox, data);
          onOpenSync(sandbox);
        });
        return sandbox;
      });
    };
    var close$1 = function (detail, mapFetch, component, sandbox, _externals, _onOpenSync, _highlightOnOpen) {
      Sandboxing.close(sandbox);
      return Future.pure(sandbox);
    };
    var togglePopup = function (detail, mapFetch, hotspot, externals, onOpenSync, highlightOnOpen) {
      var sandbox = Coupling.getCoupled(hotspot, 'sandbox');
      var showing = Sandboxing.isOpen(sandbox);
      var action = showing ? close$1 : open$1;
      return action(detail, mapFetch, hotspot, sandbox, externals, onOpenSync, highlightOnOpen);
    };
    var matchWidth = function (hotspot, container, useMinWidth) {
      var menu = Composing.getCurrent(container).getOr(container);
      var buttonWidth = get$8(hotspot.element);
      if (useMinWidth) {
        set$2(menu.element, 'min-width', buttonWidth + 'px');
      } else {
        set$4(menu.element, buttonWidth);
      }
    };
    var getSink = function (anyInSystem, sinkDetail) {
      return anyInSystem.getSystem().getByUid(sinkDetail.uid + '-' + suffix()).map(function (internalSink) {
        return function () {
          return Result.value(internalSink);
        };
      }).getOrThunk(function () {
        return sinkDetail.lazySink.fold(function () {
          return function () {
            return Result.error(new Error('No internal sink is specified, nor could an external sink be found'));
          };
        }, function (lazySinkFn) {
          return function () {
            return lazySinkFn(anyInSystem);
          };
        });
      });
    };
    var doRepositionMenus = function (sandbox) {
      Sandboxing.getState(sandbox).each(function (tmenu) {
        tieredMenu.repositionMenus(tmenu);
      });
    };
    var makeSandbox = function (detail, hotspot, extras) {
      var ariaOwner = manager();
      var onOpen = function (component, menu) {
        var anchor = getAnchor(detail, hotspot);
        ariaOwner.link(hotspot.element);
        if (detail.matchWidth) {
          matchWidth(anchor.hotspot, menu, detail.useMinWidth);
        }
        detail.onOpen(anchor, component, menu);
        if (extras !== undefined && extras.onOpen !== undefined) {
          extras.onOpen(component, menu);
        }
      };
      var onClose = function (component, menu) {
        ariaOwner.unlink(hotspot.element);
        if (extras !== undefined && extras.onClose !== undefined) {
          extras.onClose(component, menu);
        }
      };
      var lazySink = getSink(hotspot, detail);
      return {
        dom: {
          tag: 'div',
          classes: detail.sandboxClasses,
          attributes: {
            id: ariaOwner.id,
            role: 'listbox'
          }
        },
        behaviours: SketchBehaviours.augment(detail.sandboxBehaviours, [
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: hotspot
            }
          }),
          Sandboxing.config({
            onOpen: onOpen,
            onClose: onClose,
            isPartOf: function (container, data, queryElem) {
              return isPartOf(data, queryElem) || isPartOf(hotspot, queryElem);
            },
            getAttachPoint: function () {
              return lazySink().getOrDie();
            }
          }),
          Composing.config({
            find: function (sandbox) {
              return Sandboxing.getState(sandbox).bind(function (menu) {
                return Composing.getCurrent(menu);
              });
            }
          }),
          Receiving.config({ channels: __assign(__assign({}, receivingChannel({ isExtraPart: never })), receivingChannel$1({ doReposition: doRepositionMenus })) })
        ])
      };
    };
    var repositionMenus = function (comp) {
      var sandbox = Coupling.getCoupled(comp, 'sandbox');
      doRepositionMenus(sandbox);
    };

    var sandboxFields = function () {
      return [
        defaulted$1('sandboxClasses', []),
        SketchBehaviours.field('sandboxBehaviours', [
          Composing,
          Receiving,
          Sandboxing,
          Representing
        ])
      ];
    };

    var schema$g = constant([
      strict$1('dom'),
      strict$1('fetch'),
      onHandler('onOpen'),
      onKeyboardHandler('onExecute'),
      defaulted$1('getHotspot', Optional.some),
      defaulted$1('getAnchorOverrides', constant({})),
      schema$1(),
      field$1('dropdownBehaviours', [
        Toggling,
        Coupling,
        Keying,
        Focusing
      ]),
      strict$1('toggleClass'),
      defaulted$1('eventOrder', {}),
      option('lazySink'),
      defaulted$1('matchWidth', false),
      defaulted$1('useMinWidth', false),
      option('role')
    ].concat(sandboxFields()));
    var parts$4 = constant([
      external$1({
        schema: [tieredMenuMarkers()],
        name: 'menu',
        defaults: function (detail) {
          return { onExecute: detail.onExecute };
        }
      }),
      partType()
    ]);

    var factory$6 = function (detail, components, _spec, externals) {
      var _a;
      var lookupAttr = function (attr) {
        return get$1(detail.dom, 'attributes').bind(function (attrs) {
          return get$1(attrs, attr);
        });
      };
      var switchToMenu = function (sandbox) {
        Sandboxing.getState(sandbox).each(function (tmenu) {
          tieredMenu.highlightPrimary(tmenu);
        });
      };
      var action = function (component) {
        var onOpenSync = switchToMenu;
        togglePopup(detail, function (x) {
          return x;
        }, component, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);
      };
      var apis = {
        expand: function (comp) {
          if (!Toggling.isOn(comp)) {
            togglePopup(detail, function (x) {
              return x;
            }, comp, externals, noop, HighlightOnOpen.HighlightNone).get(noop);
          }
        },
        open: function (comp) {
          if (!Toggling.isOn(comp)) {
            togglePopup(detail, function (x) {
              return x;
            }, comp, externals, noop, HighlightOnOpen.HighlightFirst).get(noop);
          }
        },
        isOpen: Toggling.isOn,
        close: function (comp) {
          if (Toggling.isOn(comp)) {
            togglePopup(detail, function (x) {
              return x;
            }, comp, externals, noop, HighlightOnOpen.HighlightFirst).get(noop);
          }
        },
        repositionMenus: function (comp) {
          if (Toggling.isOn(comp)) {
            repositionMenus(comp);
          }
        }
      };
      var triggerExecute = function (comp, _se) {
        emitExecute(comp);
        return Optional.some(true);
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: augment(detail.dropdownBehaviours, [
          Toggling.config({
            toggleClass: detail.toggleClass,
            aria: { mode: 'expanded' }
          }),
          Coupling.config({
            others: {
              sandbox: function (hotspot) {
                return makeSandbox(detail, hotspot, {
                  onOpen: function () {
                    return Toggling.on(hotspot);
                  },
                  onClose: function () {
                    return Toggling.off(hotspot);
                  }
                });
              }
            }
          }),
          Keying.config({
            mode: 'special',
            onSpace: triggerExecute,
            onEnter: triggerExecute,
            onDown: function (comp, _se) {
              if (Dropdown.isOpen(comp)) {
                var sandbox = Coupling.getCoupled(comp, 'sandbox');
                switchToMenu(sandbox);
              } else {
                Dropdown.open(comp);
              }
              return Optional.some(true);
            },
            onEscape: function (comp, _se) {
              if (Dropdown.isOpen(comp)) {
                Dropdown.close(comp);
                return Optional.some(true);
              } else {
                return Optional.none();
              }
            }
          }),
          Focusing.config({})
        ]),
        events: events$7(Optional.some(action)),
        eventOrder: __assign(__assign({}, detail.eventOrder), (_a = {}, _a[execute()] = [
          'disabling',
          'toggling',
          'alloy.base.behaviour'
        ], _a)),
        apis: apis,
        domModification: {
          attributes: __assign(__assign({ 'aria-haspopup': 'true' }, detail.role.fold(function () {
            return {};
          }, function (role) {
            return { role: role };
          })), detail.dom.tag === 'button' ? { type: lookupAttr('type').getOr('button') } : {})
        }
      };
    };
    var Dropdown = composite$1({
      name: 'Dropdown',
      configFields: schema$g(),
      partFields: parts$4(),
      factory: factory$6,
      apis: {
        open: function (apis, comp) {
          return apis.open(comp);
        },
        expand: function (apis, comp) {
          return apis.expand(comp);
        },
        close: function (apis, comp) {
          return apis.close(comp);
        },
        isOpen: function (apis, comp) {
          return apis.isOpen(comp);
        },
        repositionMenus: function (apis, comp) {
          return apis.repositionMenus(comp);
        }
      }
    });

    var exhibit$5 = function () {
      return nu$6({
        styles: {
          '-webkit-user-select': 'none',
          'user-select': 'none',
          '-ms-user-select': 'none',
          '-moz-user-select': '-moz-none'
        },
        attributes: { unselectable: 'on' }
      });
    };
    var events$b = function () {
      return derive([abort(selectstart(), always)]);
    };

    var ActiveUnselecting = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$b,
        exhibit: exhibit$5
    });

    var Unselecting = create$1({
      fields: [],
      name: 'unselecting',
      active: ActiveUnselecting
    });

    var renderPanelButton = function (spec, sharedBackstage) {
      return Dropdown.sketch({
        dom: spec.dom,
        components: spec.components,
        toggleClass: 'mce-active',
        dropdownBehaviours: derive$1([
          DisablingConfigs.button(sharedBackstage.providers.isDisabled),
          receivingConfig(),
          Unselecting.config({}),
          Tabstopping.config({})
        ]),
        layouts: spec.layouts,
        sandboxClasses: ['tox-dialog__popups'],
        lazySink: sharedBackstage.getSink,
        fetch: function (comp) {
          return Future.nu(function (callback) {
            return spec.fetch(callback);
          }).map(function (items) {
            return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$1('menu-value'), items, function (value) {
              spec.onItemAction(comp, value);
            }, spec.columns, spec.presets, ItemResponse$1.CLOSE_ON_EXECUTE, never, sharedBackstage.providers), { movement: deriveMenuMovement(spec.columns, spec.presets) })));
          });
        },
        parts: { menu: part(false, 1, spec.presets) }
      });
    };

    var colorInputChangeEvent = generate$1('color-input-change');
    var colorSwatchChangeEvent = generate$1('color-swatch-change');
    var colorPickerCancelEvent = generate$1('color-picker-cancel');
    var renderColorInput = function (spec, sharedBackstage, colorInputBackstage) {
      var pField = FormField.parts.field({
        factory: Input,
        inputClasses: ['tox-textfield'],
        onSetValue: function (c) {
          return Invalidating.run(c).get(noop);
        },
        inputBehaviours: derive$1([
          Disabling.config({ disabled: sharedBackstage.providers.isDisabled }),
          receivingConfig(),
          Tabstopping.config({}),
          Invalidating.config({
            invalidClass: 'tox-textbox-field-invalid',
            getRoot: function (comp) {
              return parent(comp.element);
            },
            notify: {
              onValid: function (comp) {
                var val = Representing.getValue(comp);
                emitWith(comp, colorInputChangeEvent, { color: val });
              }
            },
            validator: {
              validateOnLoad: false,
              validate: function (input) {
                var inputValue = Representing.getValue(input);
                if (inputValue.length === 0) {
                  return Future.pure(Result.value(true));
                } else {
                  var span = SugarElement.fromTag('span');
                  set$2(span, 'background-color', inputValue);
                  var res = getRaw(span, 'background-color').fold(function () {
                    return Result.error('blah');
                  }, function (_) {
                    return Result.value(inputValue);
                  });
                  return Future.pure(res);
                }
              }
            }
          })
        ]),
        selectOnFocus: false
      });
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, sharedBackstage.providers);
      });
      var emitSwatchChange = function (colorBit, value) {
        emitWith(colorBit, colorSwatchChangeEvent, { value: value });
      };
      var onItemAction = function (comp, value) {
        memColorButton.getOpt(comp).each(function (colorBit) {
          if (value === 'custom') {
            colorInputBackstage.colorPicker(function (valueOpt) {
              valueOpt.fold(function () {
                return emit(colorBit, colorPickerCancelEvent);
              }, function (value) {
                emitSwatchChange(colorBit, value);
                addColor(value);
              });
            }, '#ffffff');
          } else if (value === 'remove') {
            emitSwatchChange(colorBit, '');
          } else {
            emitSwatchChange(colorBit, value);
          }
        });
      };
      var memColorButton = record(renderPanelButton({
        dom: {
          tag: 'span',
          attributes: { 'aria-label': sharedBackstage.providers.translate('Color swatch') }
        },
        layouts: {
          onRtl: function () {
            return [
              southwest$1,
              southeast$1,
              south$1
            ];
          },
          onLtr: function () {
            return [
              southeast$1,
              southwest$1,
              south$1
            ];
          }
        },
        components: [],
        fetch: getFetch(colorInputBackstage.getColors(), colorInputBackstage.hasCustomColors()),
        columns: colorInputBackstage.getColorCols(),
        presets: 'color',
        onItemAction: onItemAction
      }, sharedBackstage));
      return FormField.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-form__group']
        },
        components: pLabel.toArray().concat([{
            dom: {
              tag: 'div',
              classes: ['tox-color-input']
            },
            components: [
              pField,
              memColorButton.asSpec()
            ]
          }]),
        fieldBehaviours: derive$1([config('form-field-events', [
            run(colorInputChangeEvent, function (comp, se) {
              memColorButton.getOpt(comp).each(function (colorButton) {
                set$2(colorButton.element, 'background-color', se.event.color);
              });
              emitWith(comp, formChangeEvent, { name: spec.name });
            }),
            run(colorSwatchChangeEvent, function (comp, se) {
              FormField.getField(comp).each(function (field) {
                Representing.setValue(field, se.event.value);
                Composing.getCurrent(comp).each(Focusing.focus);
              });
            }),
            run(colorPickerCancelEvent, function (comp, _se) {
              FormField.getField(comp).each(function (_field) {
                Composing.getCurrent(comp).each(Focusing.focus);
              });
            })
          ])])
      });
    };

    var labelPart = optional({
      schema: [strict$1('dom')],
      name: 'label'
    });
    var edgePart = function (name) {
      return optional({
        name: '' + name + '-edge',
        overrides: function (detail) {
          var action = detail.model.manager.edgeActions[name];
          return action.fold(function () {
            return {};
          }, function (a) {
            return {
              events: derive([
                runActionExtra(touchstart(), function (comp, se, d) {
                  return a(comp, d);
                }, [detail]),
                runActionExtra(mousedown(), function (comp, se, d) {
                  return a(comp, d);
                }, [detail]),
                runActionExtra(mousemove(), function (comp, se, det) {
                  if (det.mouseIsDown.get()) {
                    a(comp, det);
                  }
                }, [detail])
              ])
            };
          });
        }
      });
    };
    var tlEdgePart = edgePart('top-left');
    var tedgePart = edgePart('top');
    var trEdgePart = edgePart('top-right');
    var redgePart = edgePart('right');
    var brEdgePart = edgePart('bottom-right');
    var bedgePart = edgePart('bottom');
    var blEdgePart = edgePart('bottom-left');
    var ledgePart = edgePart('left');
    var thumbPart = required({
      name: 'thumb',
      defaults: constant({ dom: { styles: { position: 'absolute' } } }),
      overrides: function (detail) {
        return {
          events: derive([
            redirectToPart(touchstart(), detail, 'spectrum'),
            redirectToPart(touchmove(), detail, 'spectrum'),
            redirectToPart(touchend(), detail, 'spectrum'),
            redirectToPart(mousedown(), detail, 'spectrum'),
            redirectToPart(mousemove(), detail, 'spectrum'),
            redirectToPart(mouseup(), detail, 'spectrum')
          ])
        };
      }
    });
    var spectrumPart = required({
      schema: [state$1('mouseIsDown', function () {
          return Cell(false);
        })],
      name: 'spectrum',
      overrides: function (detail) {
        var modelDetail = detail.model;
        var model = modelDetail.manager;
        var setValueFrom = function (component, simulatedEvent) {
          return model.getValueFromEvent(simulatedEvent).map(function (value) {
            return model.setValueFrom(component, detail, value);
          });
        };
        return {
          behaviours: derive$1([
            Keying.config({
              mode: 'special',
              onLeft: function (spectrum) {
                return model.onLeft(spectrum, detail);
              },
              onRight: function (spectrum) {
                return model.onRight(spectrum, detail);
              },
              onUp: function (spectrum) {
                return model.onUp(spectrum, detail);
              },
              onDown: function (spectrum) {
                return model.onDown(spectrum, detail);
              }
            }),
            Focusing.config({})
          ]),
          events: derive([
            run(touchstart(), setValueFrom),
            run(touchmove(), setValueFrom),
            run(mousedown(), setValueFrom),
            run(mousemove(), function (spectrum, se) {
              if (detail.mouseIsDown.get()) {
                setValueFrom(spectrum, se);
              }
            })
          ])
        };
      }
    });
    var SliderParts = [
      labelPart,
      ledgePart,
      redgePart,
      tedgePart,
      bedgePart,
      tlEdgePart,
      trEdgePart,
      blEdgePart,
      brEdgePart,
      thumbPart,
      spectrumPart
    ];

    var _sliderChangeEvent = 'slider.change.value';
    var sliderChangeEvent = constant(_sliderChangeEvent);
    var isTouchEvent = function (evt) {
      return evt.type.indexOf('touch') !== -1;
    };
    var getEventSource = function (simulatedEvent) {
      var evt = simulatedEvent.event.raw;
      if (isTouchEvent(evt)) {
        var touchEvent = evt;
        return touchEvent.touches !== undefined && touchEvent.touches.length === 1 ? Optional.some(touchEvent.touches[0]).map(function (t) {
          return SugarPosition(t.clientX, t.clientY);
        }) : Optional.none();
      } else {
        var mouseEvent = evt;
        return mouseEvent.clientX !== undefined ? Optional.some(mouseEvent).map(function (me) {
          return SugarPosition(me.clientX, me.clientY);
        }) : Optional.none();
      }
    };

    var t = 'top', r$1 = 'right', b = 'bottom', l = 'left';
    var minX = function (detail) {
      return detail.model.minX;
    };
    var minY = function (detail) {
      return detail.model.minY;
    };
    var min1X = function (detail) {
      return detail.model.minX - 1;
    };
    var min1Y = function (detail) {
      return detail.model.minY - 1;
    };
    var maxX = function (detail) {
      return detail.model.maxX;
    };
    var maxY = function (detail) {
      return detail.model.maxY;
    };
    var max1X = function (detail) {
      return detail.model.maxX + 1;
    };
    var max1Y = function (detail) {
      return detail.model.maxY + 1;
    };
    var range$2 = function (detail, max, min) {
      return max(detail) - min(detail);
    };
    var xRange = function (detail) {
      return range$2(detail, maxX, minX);
    };
    var yRange = function (detail) {
      return range$2(detail, maxY, minY);
    };
    var halfX = function (detail) {
      return xRange(detail) / 2;
    };
    var halfY = function (detail) {
      return yRange(detail) / 2;
    };
    var step = function (detail) {
      return detail.stepSize;
    };
    var snap = function (detail) {
      return detail.snapToGrid;
    };
    var snapStart = function (detail) {
      return detail.snapStart;
    };
    var rounded = function (detail) {
      return detail.rounded;
    };
    var hasEdge = function (detail, edgeName) {
      return detail[edgeName + '-edge'] !== undefined;
    };
    var hasLEdge = function (detail) {
      return hasEdge(detail, l);
    };
    var hasREdge = function (detail) {
      return hasEdge(detail, r$1);
    };
    var hasTEdge = function (detail) {
      return hasEdge(detail, t);
    };
    var hasBEdge = function (detail) {
      return hasEdge(detail, b);
    };
    var currentValue = function (detail) {
      return detail.model.value.get();
    };

    var xValue = function (x) {
      return { x: x };
    };
    var yValue = function (y) {
      return { y: y };
    };
    var xyValue = function (x, y) {
      return {
        x: x,
        y: y
      };
    };
    var fireSliderChange = function (component, value) {
      emitWith(component, sliderChangeEvent(), { value: value });
    };
    var setToTLEdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(min1X(detail), min1Y(detail)));
    };
    var setToTEdge = function (edge, detail) {
      fireSliderChange(edge, yValue(min1Y(detail)));
    };
    var setToTEdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(halfX(detail), min1Y(detail)));
    };
    var setToTREdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(max1X(detail), min1Y(detail)));
    };
    var setToREdge = function (edge, detail) {
      fireSliderChange(edge, xValue(max1X(detail)));
    };
    var setToREdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(max1X(detail), halfY(detail)));
    };
    var setToBREdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(max1X(detail), max1Y(detail)));
    };
    var setToBEdge = function (edge, detail) {
      fireSliderChange(edge, yValue(max1Y(detail)));
    };
    var setToBEdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(halfX(detail), max1Y(detail)));
    };
    var setToBLEdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(min1X(detail), max1Y(detail)));
    };
    var setToLEdge = function (edge, detail) {
      fireSliderChange(edge, xValue(min1X(detail)));
    };
    var setToLEdgeXY = function (edge, detail) {
      fireSliderChange(edge, xyValue(min1X(detail), halfY(detail)));
    };

    var reduceBy = function (value, min, max, step) {
      if (value < min) {
        return value;
      } else if (value > max) {
        return max;
      } else if (value === min) {
        return min - 1;
      } else {
        return Math.max(min, value - step);
      }
    };
    var increaseBy = function (value, min, max, step) {
      if (value > max) {
        return value;
      } else if (value < min) {
        return min;
      } else if (value === max) {
        return max + 1;
      } else {
        return Math.min(max, value + step);
      }
    };
    var capValue = function (value, min, max) {
      return Math.max(min, Math.min(max, value));
    };
    var snapValueOf = function (value, min, max, step, snapStart) {
      return snapStart.fold(function () {
        var initValue = value - min;
        var extraValue = Math.round(initValue / step) * step;
        return capValue(min + extraValue, min - 1, max + 1);
      }, function (start) {
        var remainder = (value - start) % step;
        var adjustment = Math.round(remainder / step);
        var rawSteps = Math.floor((value - start) / step);
        var maxSteps = Math.floor((max - start) / step);
        var numSteps = Math.min(maxSteps, rawSteps + adjustment);
        var r = start + numSteps * step;
        return Math.max(start, r);
      });
    };
    var findOffsetOf = function (value, min, max) {
      return Math.min(max, Math.max(value, min)) - min;
    };
    var findValueOf = function (args) {
      var min = args.min, max = args.max, range = args.range, value = args.value, step = args.step, snap = args.snap, snapStart = args.snapStart, rounded = args.rounded, hasMinEdge = args.hasMinEdge, hasMaxEdge = args.hasMaxEdge, minBound = args.minBound, maxBound = args.maxBound, screenRange = args.screenRange;
      var capMin = hasMinEdge ? min - 1 : min;
      var capMax = hasMaxEdge ? max + 1 : max;
      if (value < minBound) {
        return capMin;
      } else if (value > maxBound) {
        return capMax;
      } else {
        var offset = findOffsetOf(value, minBound, maxBound);
        var newValue = capValue(offset / screenRange * range + min, capMin, capMax);
        if (snap && newValue >= min && newValue <= max) {
          return snapValueOf(newValue, min, max, step, snapStart);
        } else if (rounded) {
          return Math.round(newValue);
        } else {
          return newValue;
        }
      }
    };
    var findOffsetOfValue = function (args) {
      var min = args.min, max = args.max, range = args.range, value = args.value, hasMinEdge = args.hasMinEdge, hasMaxEdge = args.hasMaxEdge, maxBound = args.maxBound, maxOffset = args.maxOffset, centerMinEdge = args.centerMinEdge, centerMaxEdge = args.centerMaxEdge;
      if (value < min) {
        return hasMinEdge ? 0 : centerMinEdge;
      } else if (value > max) {
        return hasMaxEdge ? maxBound : centerMaxEdge;
      } else {
        return (value - min) / range * maxOffset;
      }
    };

    var top = 'top', right = 'right', bottom = 'bottom', left = 'left', width = 'width', height = 'height';
    var getBounds$1 = function (component) {
      return component.element.dom.getBoundingClientRect();
    };
    var getBoundsProperty = function (bounds, property) {
      return bounds[property];
    };
    var getMinXBounds = function (component) {
      var bounds = getBounds$1(component);
      return getBoundsProperty(bounds, left);
    };
    var getMaxXBounds = function (component) {
      var bounds = getBounds$1(component);
      return getBoundsProperty(bounds, right);
    };
    var getMinYBounds = function (component) {
      var bounds = getBounds$1(component);
      return getBoundsProperty(bounds, top);
    };
    var getMaxYBounds = function (component) {
      var bounds = getBounds$1(component);
      return getBoundsProperty(bounds, bottom);
    };
    var getXScreenRange = function (component) {
      var bounds = getBounds$1(component);
      return getBoundsProperty(bounds, width);
    };
    var getYScreenRange = function (component) {
      var bounds = getBounds$1(component);
      return getBoundsProperty(bounds, height);
    };
    var getCenterOffsetOf = function (componentMinEdge, componentMaxEdge, spectrumMinEdge) {
      return (componentMinEdge + componentMaxEdge) / 2 - spectrumMinEdge;
    };
    var getXCenterOffSetOf = function (component, spectrum) {
      var componentBounds = getBounds$1(component);
      var spectrumBounds = getBounds$1(spectrum);
      var componentMinEdge = getBoundsProperty(componentBounds, left);
      var componentMaxEdge = getBoundsProperty(componentBounds, right);
      var spectrumMinEdge = getBoundsProperty(spectrumBounds, left);
      return getCenterOffsetOf(componentMinEdge, componentMaxEdge, spectrumMinEdge);
    };
    var getYCenterOffSetOf = function (component, spectrum) {
      var componentBounds = getBounds$1(component);
      var spectrumBounds = getBounds$1(spectrum);
      var componentMinEdge = getBoundsProperty(componentBounds, top);
      var componentMaxEdge = getBoundsProperty(componentBounds, bottom);
      var spectrumMinEdge = getBoundsProperty(spectrumBounds, top);
      return getCenterOffsetOf(componentMinEdge, componentMaxEdge, spectrumMinEdge);
    };

    var fireSliderChange$1 = function (spectrum, value) {
      emitWith(spectrum, sliderChangeEvent(), { value: value });
    };
    var sliderValue = function (x) {
      return { x: x };
    };
    var findValueOfOffset = function (spectrum, detail, left) {
      var args = {
        min: minX(detail),
        max: maxX(detail),
        range: xRange(detail),
        value: left,
        step: step(detail),
        snap: snap(detail),
        snapStart: snapStart(detail),
        rounded: rounded(detail),
        hasMinEdge: hasLEdge(detail),
        hasMaxEdge: hasREdge(detail),
        minBound: getMinXBounds(spectrum),
        maxBound: getMaxXBounds(spectrum),
        screenRange: getXScreenRange(spectrum)
      };
      return findValueOf(args);
    };
    var setValueFrom = function (spectrum, detail, value) {
      var xValue = findValueOfOffset(spectrum, detail, value);
      var sliderVal = sliderValue(xValue);
      fireSliderChange$1(spectrum, sliderVal);
      return xValue;
    };
    var setToMin = function (spectrum, detail) {
      var min = minX(detail);
      fireSliderChange$1(spectrum, sliderValue(min));
    };
    var setToMax = function (spectrum, detail) {
      var max = maxX(detail);
      fireSliderChange$1(spectrum, sliderValue(max));
    };
    var moveBy = function (direction, spectrum, detail) {
      var f = direction > 0 ? increaseBy : reduceBy;
      var xValue = f(currentValue(detail).x, minX(detail), maxX(detail), step(detail));
      fireSliderChange$1(spectrum, sliderValue(xValue));
      return Optional.some(xValue);
    };
    var handleMovement = function (direction) {
      return function (spectrum, detail) {
        return moveBy(direction, spectrum, detail).map(always);
      };
    };
    var getValueFromEvent = function (simulatedEvent) {
      var pos = getEventSource(simulatedEvent);
      return pos.map(function (p) {
        return p.left;
      });
    };
    var findOffsetOfValue$1 = function (spectrum, detail, value, minEdge, maxEdge) {
      var minOffset = 0;
      var maxOffset = getXScreenRange(spectrum);
      var centerMinEdge = minEdge.bind(function (edge) {
        return Optional.some(getXCenterOffSetOf(edge, spectrum));
      }).getOr(minOffset);
      var centerMaxEdge = maxEdge.bind(function (edge) {
        return Optional.some(getXCenterOffSetOf(edge, spectrum));
      }).getOr(maxOffset);
      var args = {
        min: minX(detail),
        max: maxX(detail),
        range: xRange(detail),
        value: value,
        hasMinEdge: hasLEdge(detail),
        hasMaxEdge: hasREdge(detail),
        minBound: getMinXBounds(spectrum),
        minOffset: minOffset,
        maxBound: getMaxXBounds(spectrum),
        maxOffset: maxOffset,
        centerMinEdge: centerMinEdge,
        centerMaxEdge: centerMaxEdge
      };
      return findOffsetOfValue(args);
    };
    var findPositionOfValue = function (slider, spectrum, value, minEdge, maxEdge, detail) {
      var offset = findOffsetOfValue$1(spectrum, detail, value, minEdge, maxEdge);
      return getMinXBounds(spectrum) - getMinXBounds(slider) + offset;
    };
    var setPositionFromValue = function (slider, thumb, detail, edges) {
      var value = currentValue(detail);
      var pos = findPositionOfValue(slider, edges.getSpectrum(slider), value.x, edges.getLeftEdge(slider), edges.getRightEdge(slider), detail);
      var thumbRadius = get$8(thumb.element) / 2;
      set$2(thumb.element, 'left', pos - thumbRadius + 'px');
    };
    var onLeft = handleMovement(-1);
    var onRight = handleMovement(1);
    var onUp = Optional.none;
    var onDown = Optional.none;
    var edgeActions = {
      'top-left': Optional.none(),
      'top': Optional.none(),
      'top-right': Optional.none(),
      'right': Optional.some(setToREdge),
      'bottom-right': Optional.none(),
      'bottom': Optional.none(),
      'bottom-left': Optional.none(),
      'left': Optional.some(setToLEdge)
    };

    var HorizontalModel = /*#__PURE__*/Object.freeze({
        __proto__: null,
        setValueFrom: setValueFrom,
        setToMin: setToMin,
        setToMax: setToMax,
        findValueOfOffset: findValueOfOffset,
        getValueFromEvent: getValueFromEvent,
        findPositionOfValue: findPositionOfValue,
        setPositionFromValue: setPositionFromValue,
        onLeft: onLeft,
        onRight: onRight,
        onUp: onUp,
        onDown: onDown,
        edgeActions: edgeActions
    });

    var fireSliderChange$2 = function (spectrum, value) {
      emitWith(spectrum, sliderChangeEvent(), { value: value });
    };
    var sliderValue$1 = function (y) {
      return { y: y };
    };
    var findValueOfOffset$1 = function (spectrum, detail, top) {
      var args = {
        min: minY(detail),
        max: maxY(detail),
        range: yRange(detail),
        value: top,
        step: step(detail),
        snap: snap(detail),
        snapStart: snapStart(detail),
        rounded: rounded(detail),
        hasMinEdge: hasTEdge(detail),
        hasMaxEdge: hasBEdge(detail),
        minBound: getMinYBounds(spectrum),
        maxBound: getMaxYBounds(spectrum),
        screenRange: getYScreenRange(spectrum)
      };
      return findValueOf(args);
    };
    var setValueFrom$1 = function (spectrum, detail, value) {
      var yValue = findValueOfOffset$1(spectrum, detail, value);
      var sliderVal = sliderValue$1(yValue);
      fireSliderChange$2(spectrum, sliderVal);
      return yValue;
    };
    var setToMin$1 = function (spectrum, detail) {
      var min = minY(detail);
      fireSliderChange$2(spectrum, sliderValue$1(min));
    };
    var setToMax$1 = function (spectrum, detail) {
      var max = maxY(detail);
      fireSliderChange$2(spectrum, sliderValue$1(max));
    };
    var moveBy$1 = function (direction, spectrum, detail) {
      var f = direction > 0 ? increaseBy : reduceBy;
      var yValue = f(currentValue(detail).y, minY(detail), maxY(detail), step(detail));
      fireSliderChange$2(spectrum, sliderValue$1(yValue));
      return Optional.some(yValue);
    };
    var handleMovement$1 = function (direction) {
      return function (spectrum, detail) {
        return moveBy$1(direction, spectrum, detail).map(always);
      };
    };
    var getValueFromEvent$1 = function (simulatedEvent) {
      var pos = getEventSource(simulatedEvent);
      return pos.map(function (p) {
        return p.top;
      });
    };
    var findOffsetOfValue$2 = function (spectrum, detail, value, minEdge, maxEdge) {
      var minOffset = 0;
      var maxOffset = getYScreenRange(spectrum);
      var centerMinEdge = minEdge.bind(function (edge) {
        return Optional.some(getYCenterOffSetOf(edge, spectrum));
      }).getOr(minOffset);
      var centerMaxEdge = maxEdge.bind(function (edge) {
        return Optional.some(getYCenterOffSetOf(edge, spectrum));
      }).getOr(maxOffset);
      var args = {
        min: minY(detail),
        max: maxY(detail),
        range: yRange(detail),
        value: value,
        hasMinEdge: hasTEdge(detail),
        hasMaxEdge: hasBEdge(detail),
        minBound: getMinYBounds(spectrum),
        minOffset: minOffset,
        maxBound: getMaxYBounds(spectrum),
        maxOffset: maxOffset,
        centerMinEdge: centerMinEdge,
        centerMaxEdge: centerMaxEdge
      };
      return findOffsetOfValue(args);
    };
    var findPositionOfValue$1 = function (slider, spectrum, value, minEdge, maxEdge, detail) {
      var offset = findOffsetOfValue$2(spectrum, detail, value, minEdge, maxEdge);
      return getMinYBounds(spectrum) - getMinYBounds(slider) + offset;
    };
    var setPositionFromValue$1 = function (slider, thumb, detail, edges) {
      var value = currentValue(detail);
      var pos = findPositionOfValue$1(slider, edges.getSpectrum(slider), value.y, edges.getTopEdge(slider), edges.getBottomEdge(slider), detail);
      var thumbRadius = get$7(thumb.element) / 2;
      set$2(thumb.element, 'top', pos - thumbRadius + 'px');
    };
    var onLeft$1 = Optional.none;
    var onRight$1 = Optional.none;
    var onUp$1 = handleMovement$1(-1);
    var onDown$1 = handleMovement$1(1);
    var edgeActions$1 = {
      'top-left': Optional.none(),
      'top': Optional.some(setToTEdge),
      'top-right': Optional.none(),
      'right': Optional.none(),
      'bottom-right': Optional.none(),
      'bottom': Optional.some(setToBEdge),
      'bottom-left': Optional.none(),
      'left': Optional.none()
    };

    var VerticalModel = /*#__PURE__*/Object.freeze({
        __proto__: null,
        setValueFrom: setValueFrom$1,
        setToMin: setToMin$1,
        setToMax: setToMax$1,
        findValueOfOffset: findValueOfOffset$1,
        getValueFromEvent: getValueFromEvent$1,
        findPositionOfValue: findPositionOfValue$1,
        setPositionFromValue: setPositionFromValue$1,
        onLeft: onLeft$1,
        onRight: onRight$1,
        onUp: onUp$1,
        onDown: onDown$1,
        edgeActions: edgeActions$1
    });

    var fireSliderChange$3 = function (spectrum, value) {
      emitWith(spectrum, sliderChangeEvent(), { value: value });
    };
    var sliderValue$2 = function (x, y) {
      return {
        x: x,
        y: y
      };
    };
    var setValueFrom$2 = function (spectrum, detail, value) {
      var xValue = findValueOfOffset(spectrum, detail, value.left);
      var yValue = findValueOfOffset$1(spectrum, detail, value.top);
      var val = sliderValue$2(xValue, yValue);
      fireSliderChange$3(spectrum, val);
      return val;
    };
    var moveBy$2 = function (direction, isVerticalMovement, spectrum, detail) {
      var f = direction > 0 ? increaseBy : reduceBy;
      var xValue = isVerticalMovement ? currentValue(detail).x : f(currentValue(detail).x, minX(detail), maxX(detail), step(detail));
      var yValue = !isVerticalMovement ? currentValue(detail).y : f(currentValue(detail).y, minY(detail), maxY(detail), step(detail));
      fireSliderChange$3(spectrum, sliderValue$2(xValue, yValue));
      return Optional.some(xValue);
    };
    var handleMovement$2 = function (direction, isVerticalMovement) {
      return function (spectrum, detail) {
        return moveBy$2(direction, isVerticalMovement, spectrum, detail).map(always);
      };
    };
    var setToMin$2 = function (spectrum, detail) {
      var mX = minX(detail);
      var mY = minY(detail);
      fireSliderChange$3(spectrum, sliderValue$2(mX, mY));
    };
    var setToMax$2 = function (spectrum, detail) {
      var mX = maxX(detail);
      var mY = maxY(detail);
      fireSliderChange$3(spectrum, sliderValue$2(mX, mY));
    };
    var getValueFromEvent$2 = function (simulatedEvent) {
      return getEventSource(simulatedEvent);
    };
    var setPositionFromValue$2 = function (slider, thumb, detail, edges) {
      var value = currentValue(detail);
      var xPos = findPositionOfValue(slider, edges.getSpectrum(slider), value.x, edges.getLeftEdge(slider), edges.getRightEdge(slider), detail);
      var yPos = findPositionOfValue$1(slider, edges.getSpectrum(slider), value.y, edges.getTopEdge(slider), edges.getBottomEdge(slider), detail);
      var thumbXRadius = get$8(thumb.element) / 2;
      var thumbYRadius = get$7(thumb.element) / 2;
      set$2(thumb.element, 'left', xPos - thumbXRadius + 'px');
      set$2(thumb.element, 'top', yPos - thumbYRadius + 'px');
    };
    var onLeft$2 = handleMovement$2(-1, false);
    var onRight$2 = handleMovement$2(1, false);
    var onUp$2 = handleMovement$2(-1, true);
    var onDown$2 = handleMovement$2(1, true);
    var edgeActions$2 = {
      'top-left': Optional.some(setToTLEdgeXY),
      'top': Optional.some(setToTEdgeXY),
      'top-right': Optional.some(setToTREdgeXY),
      'right': Optional.some(setToREdgeXY),
      'bottom-right': Optional.some(setToBREdgeXY),
      'bottom': Optional.some(setToBEdgeXY),
      'bottom-left': Optional.some(setToBLEdgeXY),
      'left': Optional.some(setToLEdgeXY)
    };

    var TwoDModel = /*#__PURE__*/Object.freeze({
        __proto__: null,
        setValueFrom: setValueFrom$2,
        setToMin: setToMin$2,
        setToMax: setToMax$2,
        getValueFromEvent: getValueFromEvent$2,
        setPositionFromValue: setPositionFromValue$2,
        onLeft: onLeft$2,
        onRight: onRight$2,
        onUp: onUp$2,
        onDown: onDown$2,
        edgeActions: edgeActions$2
    });

    var SliderSchema = [
      defaulted$1('stepSize', 1),
      defaulted$1('onChange', noop),
      defaulted$1('onChoose', noop),
      defaulted$1('onInit', noop),
      defaulted$1('onDragStart', noop),
      defaulted$1('onDragEnd', noop),
      defaulted$1('snapToGrid', false),
      defaulted$1('rounded', true),
      option('snapStart'),
      strictOf('model', choose$1('mode', {
        x: [
          defaulted$1('minX', 0),
          defaulted$1('maxX', 100),
          state$1('value', function (spec) {
            return Cell(spec.mode.minX);
          }),
          strict$1('getInitialValue'),
          output('manager', HorizontalModel)
        ],
        y: [
          defaulted$1('minY', 0),
          defaulted$1('maxY', 100),
          state$1('value', function (spec) {
            return Cell(spec.mode.minY);
          }),
          strict$1('getInitialValue'),
          output('manager', VerticalModel)
        ],
        xy: [
          defaulted$1('minX', 0),
          defaulted$1('maxX', 100),
          defaulted$1('minY', 0),
          defaulted$1('maxY', 100),
          state$1('value', function (spec) {
            return Cell({
              x: spec.mode.minX,
              y: spec.mode.minY
            });
          }),
          strict$1('getInitialValue'),
          output('manager', TwoDModel)
        ]
      })),
      field$1('sliderBehaviours', [
        Keying,
        Representing
      ]),
      state$1('mouseIsDown', function () {
        return Cell(false);
      })
    ];

    var sketch = function (detail, components, _spec, _externals) {
      var _a;
      var getThumb = function (component) {
        return getPartOrDie(component, detail, 'thumb');
      };
      var getSpectrum = function (component) {
        return getPartOrDie(component, detail, 'spectrum');
      };
      var getLeftEdge = function (component) {
        return getPart(component, detail, 'left-edge');
      };
      var getRightEdge = function (component) {
        return getPart(component, detail, 'right-edge');
      };
      var getTopEdge = function (component) {
        return getPart(component, detail, 'top-edge');
      };
      var getBottomEdge = function (component) {
        return getPart(component, detail, 'bottom-edge');
      };
      var modelDetail = detail.model;
      var model = modelDetail.manager;
      var refresh = function (slider, thumb) {
        model.setPositionFromValue(slider, thumb, detail, {
          getLeftEdge: getLeftEdge,
          getRightEdge: getRightEdge,
          getTopEdge: getTopEdge,
          getBottomEdge: getBottomEdge,
          getSpectrum: getSpectrum
        });
      };
      var setValue = function (slider, newValue) {
        modelDetail.value.set(newValue);
        var thumb = getThumb(slider);
        refresh(slider, thumb);
      };
      var changeValue = function (slider, newValue) {
        setValue(slider, newValue);
        var thumb = getThumb(slider);
        detail.onChange(slider, thumb, newValue);
        return Optional.some(true);
      };
      var resetToMin = function (slider) {
        model.setToMin(slider, detail);
      };
      var resetToMax = function (slider) {
        model.setToMax(slider, detail);
      };
      var choose = function (slider) {
        var fireOnChoose = function () {
          getPart(slider, detail, 'thumb').each(function (thumb) {
            var value = modelDetail.value.get();
            detail.onChoose(slider, thumb, value);
          });
        };
        var wasDown = detail.mouseIsDown.get();
        detail.mouseIsDown.set(false);
        if (wasDown) {
          fireOnChoose();
        }
      };
      var onDragStart = function (slider, simulatedEvent) {
        simulatedEvent.stop();
        detail.mouseIsDown.set(true);
        detail.onDragStart(slider, getThumb(slider));
      };
      var onDragEnd = function (slider, simulatedEvent) {
        simulatedEvent.stop();
        detail.onDragEnd(slider, getThumb(slider));
        choose(slider);
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: augment(detail.sliderBehaviours, [
          Keying.config({
            mode: 'special',
            focusIn: function (slider) {
              return getPart(slider, detail, 'spectrum').map(Keying.focusIn).map(always);
            }
          }),
          Representing.config({
            store: {
              mode: 'manual',
              getValue: function (_) {
                return modelDetail.value.get();
              }
            }
          }),
          Receiving.config({ channels: (_a = {}, _a[mouseReleased()] = { onReceive: choose }, _a) })
        ]),
        events: derive([
          run(sliderChangeEvent(), function (slider, simulatedEvent) {
            changeValue(slider, simulatedEvent.event.value);
          }),
          runOnAttached(function (slider, _simulatedEvent) {
            var getInitial = modelDetail.getInitialValue();
            modelDetail.value.set(getInitial);
            var thumb = getThumb(slider);
            refresh(slider, thumb);
            var spectrum = getSpectrum(slider);
            detail.onInit(slider, thumb, spectrum, modelDetail.value.get());
          }),
          run(touchstart(), onDragStart),
          run(touchend(), onDragEnd),
          run(mousedown(), onDragStart),
          run(mouseup(), onDragEnd)
        ]),
        apis: {
          resetToMin: resetToMin,
          resetToMax: resetToMax,
          setValue: setValue,
          refresh: refresh
        },
        domModification: { styles: { position: 'relative' } }
      };
    };

    var Slider = composite$1({
      name: 'Slider',
      configFields: SliderSchema,
      partFields: SliderParts,
      factory: sketch,
      apis: {
        setValue: function (apis, slider, value) {
          apis.setValue(slider, value);
        },
        resetToMin: function (apis, slider) {
          apis.resetToMin(slider);
        },
        resetToMax: function (apis, slider) {
          apis.resetToMax(slider);
        },
        refresh: function (apis, slider) {
          apis.refresh(slider);
        }
      }
    });

    var hsvColour = function (hue, saturation, value) {
      return {
        hue: hue,
        saturation: saturation,
        value: value
      };
    };
    var fromRgb = function (rgbaColour) {
      var h = 0;
      var s = 0;
      var v = 0;
      var r = rgbaColour.red / 255;
      var g = rgbaColour.green / 255;
      var b = rgbaColour.blue / 255;
      var minRGB = Math.min(r, Math.min(g, b));
      var maxRGB = Math.max(r, Math.max(g, b));
      if (minRGB === maxRGB) {
        v = minRGB;
        return hsvColour(0, 0, v * 100);
      }
      var d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;
      h = r === minRGB ? 3 : b === minRGB ? 1 : 5;
      h = 60 * (h - d / (maxRGB - minRGB));
      s = (maxRGB - minRGB) / maxRGB;
      v = maxRGB;
      return hsvColour(Math.round(h), Math.round(s * 100), Math.round(v * 100));
    };

    var hexToHsv = function (hex) {
      return fromRgb(fromHex(hex));
    };
    var hsvToHex = function (hsv) {
      return fromRgba(fromHsv(hsv));
    };

    var fieldsUpdate = generate$1('rgb-hex-update');
    var sliderUpdate = generate$1('slider-update');
    var paletteUpdate = generate$1('palette-update');

    var sliderFactory = function (translate, getClass) {
      var spectrum = Slider.parts.spectrum({
        dom: {
          tag: 'div',
          classes: [getClass('hue-slider-spectrum')],
          attributes: { role: 'presentation' }
        }
      });
      var thumb = Slider.parts.thumb({
        dom: {
          tag: 'div',
          classes: [getClass('hue-slider-thumb')],
          attributes: { role: 'presentation' }
        }
      });
      return Slider.sketch({
        dom: {
          tag: 'div',
          classes: [getClass('hue-slider')],
          attributes: { role: 'presentation' }
        },
        rounded: false,
        model: {
          mode: 'y',
          getInitialValue: constant({ y: 0 })
        },
        components: [
          spectrum,
          thumb
        ],
        sliderBehaviours: derive$1([Focusing.config({})]),
        onChange: function (slider, _thumb, value) {
          emitWith(slider, sliderUpdate, { value: value });
        }
      });
    };

    var owner$3 = 'form';
    var schema$h = [field$1('formBehaviours', [Representing])];
    var getPartName = function (name) {
      return '<alloy.field.' + name + '>';
    };
    var sketch$1 = function (fSpec) {
      var parts = function () {
        var record = [];
        var field = function (name, config) {
          record.push(name);
          return generateOne(owner$3, getPartName(name), config);
        };
        return {
          field: field,
          record: function () {
            return record;
          }
        };
      }();
      var spec = fSpec(parts);
      var partNames = parts.record();
      var fieldParts = map(partNames, function (n) {
        return required({
          name: n,
          pname: getPartName(n)
        });
      });
      return composite(owner$3, schema$h, fieldParts, make$4, spec);
    };
    var toResult$1 = function (o, e) {
      return o.fold(function () {
        return Result.error(e);
      }, Result.value);
    };
    var make$4 = function (detail, components) {
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: augment(detail.formBehaviours, [Representing.config({
            store: {
              mode: 'manual',
              getValue: function (form) {
                var resPs = getAllParts(form, detail);
                return map$2(resPs, function (resPThunk, pName) {
                  return resPThunk().bind(function (v) {
                    var opt = Composing.getCurrent(v);
                    return toResult$1(opt, new Error('Cannot find a current component to extract the value from for form part \'' + pName + '\': ' + element(v.element)));
                  }).map(Representing.getValue);
                });
              },
              setValue: function (form, values) {
                each$1(values, function (newValue, key) {
                  getPart(form, detail, key).each(function (wrapper) {
                    Composing.getCurrent(wrapper).each(function (field) {
                      Representing.setValue(field, newValue);
                    });
                  });
                });
              }
            }
          })]),
        apis: {
          getField: function (form, key) {
            return getPart(form, detail, key).bind(Composing.getCurrent);
          }
        }
      };
    };
    var Form = {
      getField: makeApi(function (apis, component, key) {
        return apis.getField(component, key);
      }),
      sketch: sketch$1
    };

    var validInput = generate$1('valid-input');
    var invalidInput = generate$1('invalid-input');
    var validatingInput = generate$1('validating-input');
    var translatePrefix = 'colorcustom.rgb.';
    var rgbFormFactory = function (translate, getClass, onValidHexx, onInvalidHexx) {
      var invalidation = function (label, isValid) {
        return Invalidating.config({
          invalidClass: getClass('invalid'),
          notify: {
            onValidate: function (comp) {
              emitWith(comp, validatingInput, { type: label });
            },
            onValid: function (comp) {
              emitWith(comp, validInput, {
                type: label,
                value: Representing.getValue(comp)
              });
            },
            onInvalid: function (comp) {
              emitWith(comp, invalidInput, {
                type: label,
                value: Representing.getValue(comp)
              });
            }
          },
          validator: {
            validate: function (comp) {
              var value = Representing.getValue(comp);
              var res = isValid(value) ? Result.value(true) : Result.error(translate('aria.input.invalid'));
              return Future.pure(res);
            },
            validateOnLoad: false
          }
        });
      };
      var renderTextField = function (isValid, name, label, description, data) {
        var helptext = translate(translatePrefix + 'range');
        var pLabel = FormField.parts.label({
          dom: {
            tag: 'label',
            innerHtml: label,
            attributes: { 'aria-label': description }
          }
        });
        var pField = FormField.parts.field({
          data: data,
          factory: Input,
          inputAttributes: __assign({ type: 'text' }, name === 'hex' ? { 'aria-live': 'polite' } : {}),
          inputClasses: [getClass('textfield')],
          inputBehaviours: derive$1([
            invalidation(name, isValid),
            Tabstopping.config({})
          ]),
          onSetValue: function (input) {
            if (Invalidating.isInvalid(input)) {
              var run = Invalidating.run(input);
              run.get(noop);
            }
          }
        });
        var comps = [
          pLabel,
          pField
        ];
        var concats = name !== 'hex' ? [FormField.parts['aria-descriptor']({ text: helptext })] : [];
        var components = comps.concat(concats);
        return {
          dom: {
            tag: 'div',
            attributes: { role: 'presentation' }
          },
          components: components
        };
      };
      var copyRgbToHex = function (form, rgba) {
        var hex = fromRgba(rgba);
        Form.getField(form, 'hex').each(function (hexField) {
          if (!Focusing.isFocused(hexField)) {
            Representing.setValue(form, { hex: hex.value });
          }
        });
        return hex;
      };
      var copyRgbToForm = function (form, rgb) {
        var red = rgb.red;
        var green = rgb.green;
        var blue = rgb.blue;
        Representing.setValue(form, {
          red: red,
          green: green,
          blue: blue
        });
      };
      var memPreview = record({
        dom: {
          tag: 'div',
          classes: [getClass('rgba-preview')],
          styles: { 'background-color': 'white' },
          attributes: { role: 'presentation' }
        }
      });
      var updatePreview = function (anyInSystem, hex) {
        memPreview.getOpt(anyInSystem).each(function (preview) {
          set$2(preview.element, 'background-color', '#' + hex.value);
        });
      };
      var factory = function () {
        var state = {
          red: Cell(Optional.some(255)),
          green: Cell(Optional.some(255)),
          blue: Cell(Optional.some(255)),
          hex: Cell(Optional.some('ffffff'))
        };
        var copyHexToRgb = function (form, hex) {
          var rgb = fromHex(hex);
          copyRgbToForm(form, rgb);
          setValueRgb(rgb);
        };
        var get = function (prop) {
          return state[prop].get();
        };
        var set = function (prop, value) {
          state[prop].set(value);
        };
        var getValueRgb = function () {
          return get('red').bind(function (red) {
            return get('green').bind(function (green) {
              return get('blue').map(function (blue) {
                return rgbaColour(red, green, blue, 1);
              });
            });
          });
        };
        var setValueRgb = function (rgb) {
          var red = rgb.red;
          var green = rgb.green;
          var blue = rgb.blue;
          set('red', Optional.some(red));
          set('green', Optional.some(green));
          set('blue', Optional.some(blue));
        };
        var onInvalidInput = function (form, simulatedEvent) {
          var data = simulatedEvent.event;
          if (data.type !== 'hex') {
            set(data.type, Optional.none());
          } else {
            onInvalidHexx(form);
          }
        };
        var onValidHex = function (form, value) {
          onValidHexx(form);
          var hex = hexColour(value);
          set('hex', Optional.some(value));
          var rgb = fromHex(hex);
          copyRgbToForm(form, rgb);
          setValueRgb(rgb);
          emitWith(form, fieldsUpdate, { hex: hex });
          updatePreview(form, hex);
        };
        var onValidRgb = function (form, prop, value) {
          var val = parseInt(value, 10);
          set(prop, Optional.some(val));
          getValueRgb().each(function (rgb) {
            var hex = copyRgbToHex(form, rgb);
            emitWith(form, fieldsUpdate, { hex: hex });
            updatePreview(form, hex);
          });
        };
        var isHexInputEvent = function (data) {
          return data.type === 'hex';
        };
        var onValidInput = function (form, simulatedEvent) {
          var data = simulatedEvent.event;
          if (isHexInputEvent(data)) {
            onValidHex(form, data.value);
          } else {
            onValidRgb(form, data.type, data.value);
          }
        };
        var formPartStrings = function (key) {
          return {
            label: translate(translatePrefix + key + '.label'),
            description: translate(translatePrefix + key + '.description')
          };
        };
        var redStrings = formPartStrings('red');
        var greenStrings = formPartStrings('green');
        var blueStrings = formPartStrings('blue');
        var hexStrings = formPartStrings('hex');
        return deepMerge(Form.sketch(function (parts) {
          return {
            dom: {
              tag: 'form',
              classes: [getClass('rgb-form')],
              attributes: { 'aria-label': translate('aria.color.picker') }
            },
            components: [
              parts.field('red', FormField.sketch(renderTextField(isRgbaComponent, 'red', redStrings.label, redStrings.description, 255))),
              parts.field('green', FormField.sketch(renderTextField(isRgbaComponent, 'green', greenStrings.label, greenStrings.description, 255))),
              parts.field('blue', FormField.sketch(renderTextField(isRgbaComponent, 'blue', blueStrings.label, blueStrings.description, 255))),
              parts.field('hex', FormField.sketch(renderTextField(isHexString, 'hex', hexStrings.label, hexStrings.description, 'ffffff'))),
              memPreview.asSpec()
            ],
            formBehaviours: derive$1([
              Invalidating.config({ invalidClass: getClass('form-invalid') }),
              config('rgb-form-events', [
                run(validInput, onValidInput),
                run(invalidInput, onInvalidInput),
                run(validatingInput, onInvalidInput)
              ])
            ])
          };
        }), {
          apis: {
            updateHex: function (form, hex) {
              Representing.setValue(form, { hex: hex.value });
              copyHexToRgb(form, hex);
              updatePreview(form, hex);
            }
          }
        });
      };
      var rgbFormSketcher = single$2({
        factory: factory,
        name: 'RgbForm',
        configFields: [],
        apis: {
          updateHex: function (apis, form, hex) {
            apis.updateHex(form, hex);
          }
        },
        extraApis: {}
      });
      return rgbFormSketcher;
    };

    var paletteFactory = function (_translate, getClass) {
      var spectrumPart = Slider.parts.spectrum({
        dom: {
          tag: 'canvas',
          attributes: { role: 'presentation' },
          classes: [getClass('sv-palette-spectrum')]
        }
      });
      var thumbPart = Slider.parts.thumb({
        dom: {
          tag: 'div',
          attributes: { role: 'presentation' },
          classes: [getClass('sv-palette-thumb')],
          innerHtml: '<div class=' + getClass('sv-palette-inner-thumb') + ' role="presentation"></div>'
        }
      });
      var setColour = function (canvas, rgba) {
        var width = canvas.width, height = canvas.height;
        var ctx = canvas.getContext('2d');
        if (ctx === null) {
          return;
        }
        ctx.fillStyle = rgba;
        ctx.fillRect(0, 0, width, height);
        var grdWhite = ctx.createLinearGradient(0, 0, width, 0);
        grdWhite.addColorStop(0, 'rgba(255,255,255,1)');
        grdWhite.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = grdWhite;
        ctx.fillRect(0, 0, width, height);
        var grdBlack = ctx.createLinearGradient(0, 0, 0, height);
        grdBlack.addColorStop(0, 'rgba(0,0,0,0)');
        grdBlack.addColorStop(1, 'rgba(0,0,0,1)');
        ctx.fillStyle = grdBlack;
        ctx.fillRect(0, 0, width, height);
      };
      var setPaletteHue = function (slider, hue) {
        var canvas = slider.components()[0].element.dom;
        var hsv = hsvColour(hue, 100, 100);
        var rgba = fromHsv(hsv);
        setColour(canvas, toString(rgba));
      };
      var setPaletteThumb = function (slider, hex) {
        var hsv = fromRgb(fromHex(hex));
        Slider.setValue(slider, {
          x: hsv.saturation,
          y: 100 - hsv.value
        });
      };
      var factory = function (_detail) {
        var getInitialValue = constant({
          x: 0,
          y: 0
        });
        var onChange = function (slider, _thumb, value) {
          emitWith(slider, paletteUpdate, { value: value });
        };
        var onInit = function (_slider, _thumb, spectrum, _value) {
          setColour(spectrum.element.dom, toString(red));
        };
        var sliderBehaviours = derive$1([
          Composing.config({ find: Optional.some }),
          Focusing.config({})
        ]);
        return Slider.sketch({
          dom: {
            tag: 'div',
            attributes: { role: 'presentation' },
            classes: [getClass('sv-palette')]
          },
          model: {
            mode: 'xy',
            getInitialValue: getInitialValue
          },
          rounded: false,
          components: [
            spectrumPart,
            thumbPart
          ],
          onChange: onChange,
          onInit: onInit,
          sliderBehaviours: sliderBehaviours
        });
      };
      var saturationBrightnessPaletteSketcher = single$2({
        factory: factory,
        name: 'SaturationBrightnessPalette',
        configFields: [],
        apis: {
          setHue: function (_apis, slider, hue) {
            setPaletteHue(slider, hue);
          },
          setThumb: function (_apis, slider, hex) {
            setPaletteThumb(slider, hex);
          }
        },
        extraApis: {}
      });
      return saturationBrightnessPaletteSketcher;
    };

    var makeFactory = function (translate, getClass) {
      var factory = function (detail) {
        var rgbForm = rgbFormFactory(translate, getClass, detail.onValidHex, detail.onInvalidHex);
        var sbPalette = paletteFactory(translate, getClass);
        var hueSliderToDegrees = function (hue) {
          return (100 - hue) / 100 * 360;
        };
        var hueDegreesToSlider = function (hue) {
          return 100 - hue / 360 * 100;
        };
        var state = {
          paletteRgba: Cell(red),
          paletteHue: Cell(0)
        };
        var memSlider = record(sliderFactory(translate, getClass));
        var memPalette = record(sbPalette.sketch({}));
        var memRgb = record(rgbForm.sketch({}));
        var updatePalette = function (anyInSystem, _hex, hue) {
          memPalette.getOpt(anyInSystem).each(function (palette) {
            sbPalette.setHue(palette, hue);
          });
        };
        var updateFields = function (anyInSystem, hex) {
          memRgb.getOpt(anyInSystem).each(function (form) {
            rgbForm.updateHex(form, hex);
          });
        };
        var updateSlider = function (anyInSystem, _hex, hue) {
          memSlider.getOpt(anyInSystem).each(function (slider) {
            Slider.setValue(slider, { y: hueDegreesToSlider(hue) });
          });
        };
        var updatePaletteThumb = function (anyInSystem, hex) {
          memPalette.getOpt(anyInSystem).each(function (palette) {
            sbPalette.setThumb(palette, hex);
          });
        };
        var updateState = function (hex, hue) {
          var rgba = fromHex(hex);
          state.paletteRgba.set(rgba);
          state.paletteHue.set(hue);
        };
        var runUpdates = function (anyInSystem, hex, hue, updates) {
          updateState(hex, hue);
          each(updates, function (update) {
            update(anyInSystem, hex, hue);
          });
        };
        var onPaletteUpdate = function () {
          var updates = [updateFields];
          return function (form, simulatedEvent) {
            var value = simulatedEvent.event.value;
            var oldHue = state.paletteHue.get();
            var newHsv = hsvColour(oldHue, value.x, 100 - value.y);
            var newHex = hsvToHex(newHsv);
            runUpdates(form, newHex, oldHue, updates);
          };
        };
        var onSliderUpdate = function () {
          var updates = [
            updatePalette,
            updateFields
          ];
          return function (form, simulatedEvent) {
            var hue = hueSliderToDegrees(simulatedEvent.event.value.y);
            var oldRgb = state.paletteRgba.get();
            var oldHsv = fromRgb(oldRgb);
            var newHsv = hsvColour(hue, oldHsv.saturation, oldHsv.value);
            var newHex = hsvToHex(newHsv);
            runUpdates(form, newHex, hue, updates);
          };
        };
        var onFieldsUpdate = function () {
          var updates = [
            updatePalette,
            updateSlider,
            updatePaletteThumb
          ];
          return function (form, simulatedEvent) {
            var hex = simulatedEvent.event.hex;
            var hsv = hexToHsv(hex);
            runUpdates(form, hex, hsv.hue, updates);
          };
        };
        return {
          uid: detail.uid,
          dom: detail.dom,
          components: [
            memPalette.asSpec(),
            memSlider.asSpec(),
            memRgb.asSpec()
          ],
          behaviours: derive$1([
            config('colour-picker-events', [
              run(fieldsUpdate, onFieldsUpdate()),
              run(paletteUpdate, onPaletteUpdate()),
              run(sliderUpdate, onSliderUpdate())
            ]),
            Composing.config({
              find: function (comp) {
                return memRgb.getOpt(comp);
              }
            }),
            Keying.config({ mode: 'acyclic' })
          ])
        };
      };
      var colourPickerSketcher = single$2({
        name: 'ColourPicker',
        configFields: [
          strict$1('dom'),
          defaulted$1('onValidHex', noop),
          defaulted$1('onInvalidHex', noop)
        ],
        factory: factory
      });
      return colourPickerSketcher;
    };

    var self$1 = function () {
      return Composing.config({ find: Optional.some });
    };
    var memento = function (mem) {
      return Composing.config({ find: mem.getOpt });
    };
    var childAt = function (index) {
      return Composing.config({
        find: function (comp) {
          return child(comp.element, index).bind(function (element) {
            return comp.getSystem().getByDom(element).toOptional();
          });
        }
      });
    };
    var ComposingConfigs = {
      self: self$1,
      memento: memento,
      childAt: childAt
    };

    var english = {
      'colorcustom.rgb.red.label': 'R',
      'colorcustom.rgb.red.description': 'Red component',
      'colorcustom.rgb.green.label': 'G',
      'colorcustom.rgb.green.description': 'Green component',
      'colorcustom.rgb.blue.label': 'B',
      'colorcustom.rgb.blue.description': 'Blue component',
      'colorcustom.rgb.hex.label': '#',
      'colorcustom.rgb.hex.description': 'Hex color code',
      'colorcustom.rgb.range': 'Range 0 to 255',
      'colorcustom.sb.saturation': 'Saturation',
      'colorcustom.sb.brightness': 'Brightness',
      'colorcustom.sb.picker': 'Saturation and Brightness Picker',
      'colorcustom.sb.palette': 'Saturation and Brightness Palette',
      'colorcustom.sb.instructions': 'Use arrow keys to select saturation and brightness, on x and y axes',
      'colorcustom.hue.hue': 'Hue',
      'colorcustom.hue.slider': 'Hue Slider',
      'colorcustom.hue.palette': 'Hue Palette',
      'colorcustom.hue.instructions': 'Use arrow keys to select a hue',
      'aria.color.picker': 'Color Picker',
      'aria.input.invalid': 'Invalid input'
    };
    var getEnglishText = function (key) {
      return english[key];
    };
    var translate$1 = function (key) {
      return getEnglishText(key);
    };
    var renderColorPicker = function (_spec) {
      var getClass = function (key) {
        return 'tox-' + key;
      };
      var colourPickerFactory = makeFactory(translate$1, getClass);
      var onValidHex = function (form) {
        emitWith(form, formActionEvent, {
          name: 'hex-valid',
          value: true
        });
      };
      var onInvalidHex = function (form) {
        emitWith(form, formActionEvent, {
          name: 'hex-valid',
          value: false
        });
      };
      var memPicker = record(colourPickerFactory.sketch({
        dom: {
          tag: 'div',
          classes: [getClass('color-picker-container')],
          attributes: { role: 'presentation' }
        },
        onValidHex: onValidHex,
        onInvalidHex: onInvalidHex
      }));
      return {
        dom: { tag: 'div' },
        components: [memPicker.asSpec()],
        behaviours: derive$1([
          Representing.config({
            store: {
              mode: 'manual',
              getValue: function (comp) {
                var picker = memPicker.get(comp);
                var optRgbForm = Composing.getCurrent(picker);
                var optHex = optRgbForm.bind(function (rgbForm) {
                  var formValues = Representing.getValue(rgbForm);
                  return formValues.hex;
                });
                return optHex.map(function (hex) {
                  return '#' + hex;
                }).getOr('');
              },
              setValue: function (comp, newValue) {
                var pattern = /^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/;
                var m = pattern.exec(newValue);
                var picker = memPicker.get(comp);
                var optRgbForm = Composing.getCurrent(picker);
                optRgbForm.fold(function () {
                  console.log('Can not find form');
                }, function (rgbForm) {
                  Representing.setValue(rgbForm, { hex: Optional.from(m[1]).getOr('') });
                  Form.getField(rgbForm, 'hex').each(function (hexField) {
                    emit(hexField, input());
                  });
                });
              }
            }
          }),
          ComposingConfigs.self()
        ])
      };
    };

    var global$b = tinymce.util.Tools.resolve('tinymce.Resource');

    var isOldCustomEditor = function (spec) {
      return Object.prototype.hasOwnProperty.call(spec, 'init');
    };
    var renderCustomEditor = function (spec) {
      var editorApi = Cell(Optional.none());
      var memReplaced = record({ dom: { tag: spec.tag } });
      var initialValue = Cell(Optional.none());
      return {
        dom: {
          tag: 'div',
          classes: ['tox-custom-editor']
        },
        behaviours: derive$1([
          config('custom-editor-events', [runOnAttached(function (component) {
              memReplaced.getOpt(component).each(function (ta) {
                (isOldCustomEditor(spec) ? spec.init(ta.element.dom) : global$b.load(spec.scriptId, spec.scriptUrl).then(function (init) {
                  return init(ta.element.dom, spec.settings);
                })).then(function (ea) {
                  initialValue.get().each(function (cvalue) {
                    ea.setValue(cvalue);
                  });
                  initialValue.set(Optional.none());
                  editorApi.set(Optional.some(ea));
                });
              });
            })]),
          Representing.config({
            store: {
              mode: 'manual',
              getValue: function () {
                return editorApi.get().fold(function () {
                  return initialValue.get().getOr('');
                }, function (ed) {
                  return ed.getValue();
                });
              },
              setValue: function (component, value) {
                editorApi.get().fold(function () {
                  initialValue.set(Optional.some(value));
                }, function (ed) {
                  return ed.setValue(value);
                });
              }
            }
          }),
          ComposingConfigs.self()
        ]),
        components: [memReplaced.asSpec()]
      };
    };

    var global$c = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var processors = objOf([
      defaulted$1('preprocess', identity),
      defaulted$1('postprocess', identity)
    ]);
    var memento$1 = function (mem, rawProcessors) {
      var ps = asRawOrDie('RepresentingConfigs.memento processors', processors, rawProcessors);
      return Representing.config({
        store: {
          mode: 'manual',
          getValue: function (comp) {
            var other = mem.get(comp);
            var rawValue = Representing.getValue(other);
            return ps.postprocess(rawValue);
          },
          setValue: function (comp, rawValue) {
            var newValue = ps.preprocess(rawValue);
            var other = mem.get(comp);
            Representing.setValue(other, newValue);
          }
        }
      });
    };
    var withComp = function (optInitialValue, getter, setter) {
      return Representing.config(deepMerge({
        store: {
          mode: 'manual',
          getValue: getter,
          setValue: setter
        }
      }, optInitialValue.map(function (initialValue) {
        return { store: { initialValue: initialValue } };
      }).getOr({})));
    };
    var withElement = function (initialValue, getter, setter) {
      return withComp(initialValue, function (c) {
        return getter(c.element);
      }, function (c, v) {
        return setter(c.element, v);
      });
    };
    var domValue = function (optInitialValue) {
      return withElement(optInitialValue, get$6, set$3);
    };
    var domHtml = function (optInitialValue) {
      return withElement(optInitialValue, get$2, set);
    };
    var memory$1 = function (initialValue) {
      return Representing.config({
        store: {
          mode: 'memory',
          initialValue: initialValue
        }
      });
    };
    var RepresentingConfigs = {
      memento: memento$1,
      withElement: withElement,
      withComp: withComp,
      domValue: domValue,
      domHtml: domHtml,
      memory: memory$1
    };

    var defaultImageFileTypes = 'jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp';
    var filterByExtension = function (files, providersBackstage) {
      var allowedImageFileTypes = global$c.explode(providersBackstage.getSetting('images_file_types', defaultImageFileTypes, 'string'));
      var isFileInAllowedTypes = function (file) {
        return exists(allowedImageFileTypes, function (type) {
          return endsWith(file.name.toLowerCase(), '.' + type.toLowerCase());
        });
      };
      return filter(from$1(files), isFileInAllowedTypes);
    };
    var renderDropZone = function (spec, providersBackstage) {
      var stopper = function (_, se) {
        se.stop();
      };
      var sequence = function (actions) {
        return function (comp, se) {
          each(actions, function (a) {
            a(comp, se);
          });
        };
      };
      var onDrop = function (comp, se) {
        if (!Disabling.isDisabled(comp)) {
          var transferEvent = se.event.raw;
          handleFiles(comp, transferEvent.dataTransfer.files);
        }
      };
      var onSelect = function (component, simulatedEvent) {
        var input = simulatedEvent.event.raw.target;
        handleFiles(component, input.files);
      };
      var handleFiles = function (component, files) {
        Representing.setValue(component, filterByExtension(files, providersBackstage));
        emitWith(component, formChangeEvent, { name: spec.name });
      };
      var memInput = record({
        dom: {
          tag: 'input',
          attributes: {
            type: 'file',
            accept: 'image/*'
          },
          styles: { display: 'none' }
        },
        behaviours: derive$1([config('input-file-events', [
            cutter(click()),
            cutter(tap())
          ])])
      });
      var renderField = function (s) {
        return {
          uid: s.uid,
          dom: {
            tag: 'div',
            classes: ['tox-dropzone-container']
          },
          behaviours: derive$1([
            RepresentingConfigs.memory([]),
            ComposingConfigs.self(),
            Disabling.config({}),
            Toggling.config({
              toggleClass: 'dragenter',
              toggleOnExecute: false
            }),
            config('dropzone-events', [
              run('dragenter', sequence([
                stopper,
                Toggling.toggle
              ])),
              run('dragleave', sequence([
                stopper,
                Toggling.toggle
              ])),
              run('dragover', stopper),
              run('drop', sequence([
                stopper,
                onDrop
              ])),
              run(change(), onSelect)
            ])
          ]),
          components: [{
              dom: {
                tag: 'div',
                classes: ['tox-dropzone'],
                styles: {}
              },
              components: [
                {
                  dom: {
                    tag: 'p',
                    innerHtml: providersBackstage.translate('Drop an image here')
                  }
                },
                Button.sketch({
                  dom: {
                    tag: 'button',
                    innerHtml: providersBackstage.translate('Browse for an image'),
                    styles: { position: 'relative' },
                    classes: [
                      'tox-button',
                      'tox-button--secondary'
                    ]
                  },
                  components: [memInput.asSpec()],
                  action: function (comp) {
                    var inputComp = memInput.get(comp);
                    inputComp.element.dom.click();
                  },
                  buttonBehaviours: derive$1([
                    Tabstopping.config({}),
                    DisablingConfigs.button(providersBackstage.isDisabled),
                    receivingConfig()
                  ])
                })
              ]
            }]
        };
      };
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var pField = FormField.parts.field({ factory: { sketch: renderField } });
      return renderFormFieldWith(pLabel, pField, ['tox-form__group--stretched'], []);
    };

    var renderGrid = function (spec, backstage) {
      return {
        dom: {
          tag: 'div',
          classes: [
            'tox-form__grid',
            'tox-form__grid--' + spec.columns + 'col'
          ]
        },
        components: map(spec.items, backstage.interpreter)
      };
    };

    var beforeObject = generate$1('alloy-fake-before-tabstop');
    var afterObject = generate$1('alloy-fake-after-tabstop');
    var craftWithClasses = function (classes) {
      return {
        dom: {
          tag: 'div',
          styles: {
            width: '1px',
            height: '1px',
            outline: 'none'
          },
          attributes: { tabindex: '0' },
          classes: classes
        },
        behaviours: derive$1([
          Focusing.config({ ignore: true }),
          Tabstopping.config({})
        ])
      };
    };
    var craft = function (spec) {
      return {
        dom: {
          tag: 'div',
          classes: ['tox-navobj']
        },
        components: [
          craftWithClasses([beforeObject]),
          spec,
          craftWithClasses([afterObject])
        ],
        behaviours: derive$1([ComposingConfigs.childAt(1)])
      };
    };
    var triggerTab = function (placeholder, shiftKey) {
      emitWith(placeholder, keydown(), {
        raw: {
          which: 9,
          shiftKey: shiftKey
        }
      });
    };
    var onFocus$1 = function (container, targetComp) {
      var target = targetComp.element;
      if (has$2(target, beforeObject)) {
        triggerTab(container, true);
      } else if (has$2(target, afterObject)) {
        triggerTab(container, false);
      }
    };
    var isPseudoStop = function (element) {
      return closest$4(element, [
        '.' + beforeObject,
        '.' + afterObject
      ].join(','), never);
    };

    var platformNeedsSandboxing = !(detect$3().browser.isIE() || detect$3().browser.isEdge());
    var getDynamicSource = function (isSandbox) {
      var cachedValue = Cell('');
      return {
        getValue: function (_frameComponent) {
          return cachedValue.get();
        },
        setValue: function (frameComponent, html) {
          if (!isSandbox) {
            set$1(frameComponent.element, 'src', 'javascript:\'\'');
            var doc = frameComponent.element.dom.contentWindow.document;
            doc.open();
            doc.write(html);
            doc.close();
          } else {
            set$1(frameComponent.element, 'srcdoc', html);
          }
          cachedValue.set(html);
        }
      };
    };
    var renderIFrame = function (spec, providersBackstage) {
      var isSandbox = platformNeedsSandboxing && spec.sandboxed;
      var attributes = __assign(__assign({}, spec.label.map(function (title) {
        return { title: title };
      }).getOr({})), isSandbox ? { sandbox: 'allow-scripts allow-same-origin' } : {});
      var sourcing = getDynamicSource(isSandbox);
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var factory = function (newSpec) {
        return craft({
          uid: newSpec.uid,
          dom: {
            tag: 'iframe',
            attributes: attributes
          },
          behaviours: derive$1([
            Tabstopping.config({}),
            Focusing.config({}),
            RepresentingConfigs.withComp(Optional.none(), sourcing.getValue, sourcing.setValue)
          ])
        });
      };
      var pField = FormField.parts.field({ factory: { sketch: factory } });
      return renderFormFieldWith(pLabel, pField, ['tox-form__group--stretched'], []);
    };

    var create$5 = function (width, height) {
      return resize(document.createElement('canvas'), width, height);
    };
    var clone$1 = function (canvas) {
      var tCanvas = create$5(canvas.width, canvas.height);
      var ctx = get2dContext(tCanvas);
      ctx.drawImage(canvas, 0, 0);
      return tCanvas;
    };
    var get2dContext = function (canvas) {
      return canvas.getContext('2d');
    };
    var resize = function (canvas, width, height) {
      canvas.width = width;
      canvas.height = height;
      return canvas;
    };

    var getWidth = function (image) {
      return image.naturalWidth || image.width;
    };
    var getHeight = function (image) {
      return image.naturalHeight || image.height;
    };

    var promise = function () {
      var Promise = function (fn) {
        if (typeof this !== 'object') {
          throw new TypeError('Promises must be constructed via new');
        }
        if (typeof fn !== 'function') {
          throw new TypeError('not a function');
        }
        this._state = null;
        this._value = null;
        this._deferreds = [];
        doResolve(fn, bind(resolve, this), bind(reject, this));
      };
      var anyWindow = window;
      var asap = Promise.immediateFn || typeof anyWindow.setImmediate === 'function' && anyWindow.setImmediate || function (fn) {
        return setTimeout(fn, 1);
      };
      var bind = function (fn, thisArg) {
        return function () {
          var args = [];
          for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
          }
          return fn.apply(thisArg, args);
        };
      };
      var isArray = Array.isArray || function (value) {
        return Object.prototype.toString.call(value) === '[object Array]';
      };
      function handle(deferred) {
        var me = this;
        if (this._state === null) {
          this._deferreds.push(deferred);
          return;
        }
        asap(function () {
          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;
          if (cb === null) {
            (me._state ? deferred.resolve : deferred.reject)(me._value);
            return;
          }
          var ret;
          try {
            ret = cb(me._value);
          } catch (e) {
            deferred.reject(e);
            return;
          }
          deferred.resolve(ret);
        });
      }
      function resolve(newValue) {
        try {
          if (newValue === this) {
            throw new TypeError('A promise cannot be resolved with itself.');
          }
          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {
            var then = newValue.then;
            if (typeof then === 'function') {
              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));
              return;
            }
          }
          this._state = true;
          this._value = newValue;
          finale.call(this);
        } catch (e) {
          reject.call(this, e);
        }
      }
      function reject(newValue) {
        this._state = false;
        this._value = newValue;
        finale.call(this);
      }
      function finale() {
        for (var _i = 0, _a = this._deferreds; _i < _a.length; _i++) {
          var deferred = _a[_i];
          handle.call(this, deferred);
        }
        this._deferreds = [];
      }
      function Handler(onFulfilled, onRejected, resolve, reject) {
        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;
        this.onRejected = typeof onRejected === 'function' ? onRejected : null;
        this.resolve = resolve;
        this.reject = reject;
      }
      var doResolve = function (fn, onFulfilled, onRejected) {
        var done = false;
        try {
          fn(function (value) {
            if (done) {
              return;
            }
            done = true;
            onFulfilled(value);
          }, function (reason) {
            if (done) {
              return;
            }
            done = true;
            onRejected(reason);
          });
        } catch (ex) {
          if (done) {
            return;
          }
          done = true;
          onRejected(ex);
        }
      };
      Promise.prototype.catch = function (onRejected) {
        return this.then(null, onRejected);
      };
      Promise.prototype.then = function (onFulfilled, onRejected) {
        var me = this;
        return new Promise(function (resolve, reject) {
          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));
        });
      };
      Promise.all = function () {
        var values = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          values[_i] = arguments[_i];
        }
        var args = Array.prototype.slice.call(values.length === 1 && isArray(values[0]) ? values[0] : values);
        return new Promise(function (resolve, reject) {
          if (args.length === 0) {
            return resolve([]);
          }
          var remaining = args.length;
          var res = function (i, val) {
            try {
              if (val && (typeof val === 'object' || typeof val === 'function')) {
                var then = val.then;
                if (typeof then === 'function') {
                  then.call(val, function (val) {
                    res(i, val);
                  }, reject);
                  return;
                }
              }
              args[i] = val;
              if (--remaining === 0) {
                resolve(args);
              }
            } catch (ex) {
              reject(ex);
            }
          };
          for (var i = 0; i < args.length; i++) {
            res(i, args[i]);
          }
        });
      };
      Promise.resolve = function (value) {
        if (value && typeof value === 'object' && value.constructor === Promise) {
          return value;
        }
        return new Promise(function (resolve) {
          resolve(value);
        });
      };
      Promise.reject = function (reason) {
        return new Promise(function (resolve, reject) {
          reject(reason);
        });
      };
      Promise.race = function (values) {
        return new Promise(function (resolve, reject) {
          for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {
            var value = values_1[_i];
            value.then(resolve, reject);
          }
        });
      };
      return Promise;
    };
    var Promise$1 = window.Promise ? window.Promise : promise();

    var blobToImage = function (blob) {
      return new Promise$1(function (resolve, reject) {
        var blobUrl = URL.createObjectURL(blob);
        var image = new Image();
        var removeListeners = function () {
          image.removeEventListener('load', loaded);
          image.removeEventListener('error', error);
        };
        var loaded = function () {
          removeListeners();
          resolve(image);
        };
        var error = function () {
          removeListeners();
          reject('Unable to load data of type ' + blob.type + ': ' + blobUrl);
        };
        image.addEventListener('load', loaded);
        image.addEventListener('error', error);
        image.src = blobUrl;
        if (image.complete) {
          setTimeout(loaded, 0);
        }
      });
    };
    var dataUriToBlobSync = function (uri) {
      var data = uri.split(',');
      var matches = /data:([^;]+)/.exec(data[0]);
      if (!matches) {
        return Optional.none();
      }
      var mimetype = matches[1];
      var base64 = data[1];
      var sliceSize = 1024;
      var byteCharacters = atob(base64);
      var bytesLength = byteCharacters.length;
      var slicesCount = Math.ceil(bytesLength / sliceSize);
      var byteArrays = new Array(slicesCount);
      for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
        var begin = sliceIndex * sliceSize;
        var end = Math.min(begin + sliceSize, bytesLength);
        var bytes = new Array(end - begin);
        for (var offset = begin, i = 0; offset < end; ++i, ++offset) {
          bytes[i] = byteCharacters[offset].charCodeAt(0);
        }
        byteArrays[sliceIndex] = new Uint8Array(bytes);
      }
      return Optional.some(new Blob(byteArrays, { type: mimetype }));
    };
    var dataUriToBlob = function (uri) {
      return new Promise$1(function (resolve, reject) {
        dataUriToBlobSync(uri).fold(function () {
          reject('uri is not base64: ' + uri);
        }, resolve);
      });
    };
    var canvasToBlob = function (canvas, type, quality) {
      type = type || 'image/png';
      if (isFunction(HTMLCanvasElement.prototype.toBlob)) {
        return new Promise$1(function (resolve, reject) {
          canvas.toBlob(function (blob) {
            if (blob) {
              resolve(blob);
            } else {
              reject();
            }
          }, type, quality);
        });
      } else {
        return dataUriToBlob(canvas.toDataURL(type, quality));
      }
    };
    var canvasToDataURL = function (canvas, type, quality) {
      type = type || 'image/png';
      return canvas.toDataURL(type, quality);
    };
    var blobToCanvas = function (blob) {
      return blobToImage(blob).then(function (image) {
        revokeImageUrl(image);
        var canvas = create$5(getWidth(image), getHeight(image));
        var context = get2dContext(canvas);
        context.drawImage(image, 0, 0);
        return canvas;
      });
    };
    var blobToDataUri = function (blob) {
      return new Promise$1(function (resolve) {
        var reader = new FileReader();
        reader.onloadend = function () {
          resolve(reader.result);
        };
        reader.readAsDataURL(blob);
      });
    };
    var revokeImageUrl = function (image) {
      URL.revokeObjectURL(image.src);
    };

    var create$6 = function (getCanvas, blob, uri) {
      var initialType = blob.type;
      var getType = constant(initialType);
      var toBlob = function () {
        return Promise$1.resolve(blob);
      };
      var toDataURL = constant(uri);
      var toBase64 = function () {
        return uri.split(',')[1];
      };
      var toAdjustedBlob = function (type, quality) {
        return getCanvas.then(function (canvas) {
          return canvasToBlob(canvas, type, quality);
        });
      };
      var toAdjustedDataURL = function (type, quality) {
        return getCanvas.then(function (canvas) {
          return canvasToDataURL(canvas, type, quality);
        });
      };
      var toAdjustedBase64 = function (type, quality) {
        return toAdjustedDataURL(type, quality).then(function (dataurl) {
          return dataurl.split(',')[1];
        });
      };
      var toCanvas = function () {
        return getCanvas.then(clone$1);
      };
      return {
        getType: getType,
        toBlob: toBlob,
        toDataURL: toDataURL,
        toBase64: toBase64,
        toAdjustedBlob: toAdjustedBlob,
        toAdjustedDataURL: toAdjustedDataURL,
        toAdjustedBase64: toAdjustedBase64,
        toCanvas: toCanvas
      };
    };
    var fromBlob = function (blob) {
      return blobToDataUri(blob).then(function (uri) {
        return create$6(blobToCanvas(blob), blob, uri);
      });
    };
    var fromCanvas = function (canvas, type) {
      return canvasToBlob(canvas, type).then(function (blob) {
        return create$6(Promise$1.resolve(canvas), blob, canvas.toDataURL());
      });
    };

    var blobToImageResult = function (blob) {
      return fromBlob(blob);
    };

    var clamp$1 = function (value, min, max) {
      var parsedValue = typeof value === 'string' ? parseFloat(value) : value;
      if (parsedValue > max) {
        parsedValue = max;
      } else if (parsedValue < min) {
        parsedValue = min;
      }
      return parsedValue;
    };
    var identity$1 = function () {
      return [
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1
      ];
    };
    var DELTA_INDEX = [
      0,
      0.01,
      0.02,
      0.04,
      0.05,
      0.06,
      0.07,
      0.08,
      0.1,
      0.11,
      0.12,
      0.14,
      0.15,
      0.16,
      0.17,
      0.18,
      0.2,
      0.21,
      0.22,
      0.24,
      0.25,
      0.27,
      0.28,
      0.3,
      0.32,
      0.34,
      0.36,
      0.38,
      0.4,
      0.42,
      0.44,
      0.46,
      0.48,
      0.5,
      0.53,
      0.56,
      0.59,
      0.62,
      0.65,
      0.68,
      0.71,
      0.74,
      0.77,
      0.8,
      0.83,
      0.86,
      0.89,
      0.92,
      0.95,
      0.98,
      1,
      1.06,
      1.12,
      1.18,
      1.24,
      1.3,
      1.36,
      1.42,
      1.48,
      1.54,
      1.6,
      1.66,
      1.72,
      1.78,
      1.84,
      1.9,
      1.96,
      2,
      2.12,
      2.25,
      2.37,
      2.5,
      2.62,
      2.75,
      2.87,
      3,
      3.2,
      3.4,
      3.6,
      3.8,
      4,
      4.3,
      4.7,
      4.9,
      5,
      5.5,
      6,
      6.5,
      6.8,
      7,
      7.3,
      7.5,
      7.8,
      8,
      8.4,
      8.7,
      9,
      9.4,
      9.6,
      9.8,
      10
    ];
    var multiply = function (matrix1, matrix2) {
      var col = [];
      var out = new Array(25);
      var val;
      for (var i = 0; i < 5; i++) {
        for (var j = 0; j < 5; j++) {
          col[j] = matrix2[j + i * 5];
        }
        for (var j = 0; j < 5; j++) {
          val = 0;
          for (var k = 0; k < 5; k++) {
            val += matrix1[j + k * 5] * col[k];
          }
          out[j + i * 5] = val;
        }
      }
      return out;
    };
    var adjustContrast = function (matrix, value) {
      var x;
      value = clamp$1(value, -1, 1);
      value *= 100;
      if (value < 0) {
        x = 127 + value / 100 * 127;
      } else {
        x = value % 1;
        if (x === 0) {
          x = DELTA_INDEX[value];
        } else {
          x = DELTA_INDEX[Math.floor(value)] * (1 - x) + DELTA_INDEX[Math.floor(value) + 1] * x;
        }
        x = x * 127 + 127;
      }
      return multiply(matrix, [
        x / 127,
        0,
        0,
        0,
        0.5 * (127 - x),
        0,
        x / 127,
        0,
        0,
        0.5 * (127 - x),
        0,
        0,
        x / 127,
        0,
        0.5 * (127 - x),
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1
      ]);
    };
    var adjustBrightness = function (matrix, value) {
      value = clamp$1(255 * value, -255, 255);
      return multiply(matrix, [
        1,
        0,
        0,
        0,
        value,
        0,
        1,
        0,
        0,
        value,
        0,
        0,
        1,
        0,
        value,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1
      ]);
    };
    var adjustColors = function (matrix, adjustR, adjustG, adjustB) {
      adjustR = clamp$1(adjustR, 0, 2);
      adjustG = clamp$1(adjustG, 0, 2);
      adjustB = clamp$1(adjustB, 0, 2);
      return multiply(matrix, [
        adjustR,
        0,
        0,
        0,
        0,
        0,
        adjustG,
        0,
        0,
        0,
        0,
        0,
        adjustB,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        1
      ]);
    };

    var colorFilter = function (ir, matrix) {
      return ir.toCanvas().then(function (canvas) {
        return applyColorFilter(canvas, ir.getType(), matrix);
      });
    };
    var applyColorFilter = function (canvas, type, matrix) {
      var context = get2dContext(canvas);
      var applyMatrix = function (pixelsData, m) {
        var r, g, b, a;
        var data = pixelsData.data, m0 = m[0], m1 = m[1], m2 = m[2], m3 = m[3], m4 = m[4], m5 = m[5], m6 = m[6], m7 = m[7], m8 = m[8], m9 = m[9], m10 = m[10], m11 = m[11], m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15], m16 = m[16], m17 = m[17], m18 = m[18], m19 = m[19];
        for (var i = 0; i < data.length; i += 4) {
          r = data[i];
          g = data[i + 1];
          b = data[i + 2];
          a = data[i + 3];
          data[i] = r * m0 + g * m1 + b * m2 + a * m3 + m4;
          data[i + 1] = r * m5 + g * m6 + b * m7 + a * m8 + m9;
          data[i + 2] = r * m10 + g * m11 + b * m12 + a * m13 + m14;
          data[i + 3] = r * m15 + g * m16 + b * m17 + a * m18 + m19;
        }
        return pixelsData;
      };
      var pixels = applyMatrix(context.getImageData(0, 0, canvas.width, canvas.height), matrix);
      context.putImageData(pixels, 0, 0);
      return fromCanvas(canvas, type);
    };
    var convoluteFilter = function (ir, matrix) {
      return ir.toCanvas().then(function (canvas) {
        return applyConvoluteFilter(canvas, ir.getType(), matrix);
      });
    };
    var applyConvoluteFilter = function (canvas, type, matrix) {
      var context = get2dContext(canvas);
      var applyMatrix = function (pIn, pOut, aMatrix) {
        var clamp = function (value, min, max) {
          if (value > max) {
            value = max;
          } else if (value < min) {
            value = min;
          }
          return value;
        };
        var side = Math.round(Math.sqrt(aMatrix.length));
        var halfSide = Math.floor(side / 2);
        var rgba = pIn.data;
        var drgba = pOut.data;
        var w = pIn.width;
        var h = pIn.height;
        for (var y = 0; y < h; y++) {
          for (var x = 0; x < w; x++) {
            var r = 0;
            var g = 0;
            var b = 0;
            for (var cy = 0; cy < side; cy++) {
              for (var cx = 0; cx < side; cx++) {
                var scx = clamp(x + cx - halfSide, 0, w - 1);
                var scy = clamp(y + cy - halfSide, 0, h - 1);
                var innerOffset = (scy * w + scx) * 4;
                var wt = aMatrix[cy * side + cx];
                r += rgba[innerOffset] * wt;
                g += rgba[innerOffset + 1] * wt;
                b += rgba[innerOffset + 2] * wt;
              }
            }
            var offset = (y * w + x) * 4;
            drgba[offset] = clamp(r, 0, 255);
            drgba[offset + 1] = clamp(g, 0, 255);
            drgba[offset + 2] = clamp(b, 0, 255);
          }
        }
        return pOut;
      };
      var pixelsIn = context.getImageData(0, 0, canvas.width, canvas.height);
      var pixelsOut = context.getImageData(0, 0, canvas.width, canvas.height);
      pixelsOut = applyMatrix(pixelsIn, pixelsOut, matrix);
      context.putImageData(pixelsOut, 0, 0);
      return fromCanvas(canvas, type);
    };
    var functionColorFilter = function (colorFn) {
      var filterImpl = function (canvas, type, value) {
        var context = get2dContext(canvas);
        var lookup = new Array(256);
        var applyLookup = function (pixelsData, lookupData) {
          var data = pixelsData.data;
          for (var i = 0; i < data.length; i += 4) {
            data[i] = lookupData[data[i]];
            data[i + 1] = lookupData[data[i + 1]];
            data[i + 2] = lookupData[data[i + 2]];
          }
          return pixelsData;
        };
        for (var i = 0; i < lookup.length; i++) {
          lookup[i] = colorFn(i, value);
        }
        var pixels = applyLookup(context.getImageData(0, 0, canvas.width, canvas.height), lookup);
        context.putImageData(pixels, 0, 0);
        return fromCanvas(canvas, type);
      };
      return function (ir, value) {
        return ir.toCanvas().then(function (canvas) {
          return filterImpl(canvas, ir.getType(), value);
        });
      };
    };
    var complexAdjustableColorFilter = function (matrixAdjustFn) {
      return function (ir, adjust) {
        return colorFilter(ir, matrixAdjustFn(identity$1(), adjust));
      };
    };
    var basicColorFilter = function (matrix) {
      return function (ir) {
        return colorFilter(ir, matrix);
      };
    };
    var basicConvolutionFilter = function (kernel) {
      return function (ir) {
        return convoluteFilter(ir, kernel);
      };
    };
    var invert = basicColorFilter([
      -1,
      0,
      0,
      0,
      255,
      0,
      -1,
      0,
      0,
      255,
      0,
      0,
      -1,
      0,
      255,
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      0,
      0,
      1
    ]);
    var brightness = complexAdjustableColorFilter(adjustBrightness);
    var contrast = complexAdjustableColorFilter(adjustContrast);
    var colorize = function (ir, adjustR, adjustG, adjustB) {
      return colorFilter(ir, adjustColors(identity$1(), adjustR, adjustG, adjustB));
    };
    var sharpen = basicConvolutionFilter([
      0,
      -1,
      0,
      -1,
      5,
      -1,
      0,
      -1,
      0
    ]);
    var gamma = functionColorFilter(function (color, value) {
      return Math.pow(color / 255, 1 - value) * 255;
    });

    var scale = function (image, dW, dH) {
      var sW = getWidth(image);
      var sH = getHeight(image);
      var wRatio = dW / sW;
      var hRatio = dH / sH;
      var scaleCapped = false;
      if (wRatio < 0.5 || wRatio > 2) {
        wRatio = wRatio < 0.5 ? 0.5 : 2;
        scaleCapped = true;
      }
      if (hRatio < 0.5 || hRatio > 2) {
        hRatio = hRatio < 0.5 ? 0.5 : 2;
        scaleCapped = true;
      }
      var scaled = _scale(image, wRatio, hRatio);
      return !scaleCapped ? scaled : scaled.then(function (tCanvas) {
        return scale(tCanvas, dW, dH);
      });
    };
    var _scale = function (image, wRatio, hRatio) {
      return new Promise$1(function (resolve) {
        var sW = getWidth(image);
        var sH = getHeight(image);
        var dW = Math.floor(sW * wRatio);
        var dH = Math.floor(sH * hRatio);
        var canvas = create$5(dW, dH);
        var context = get2dContext(canvas);
        context.drawImage(image, 0, 0, sW, sH, 0, 0, dW, dH);
        resolve(canvas);
      });
    };

    var ceilWithPrecision = function (num, precision) {
      if (precision === void 0) {
        precision = 2;
      }
      var mul = Math.pow(10, precision);
      var upper = Math.round(num * mul);
      return Math.ceil(upper / mul);
    };
    var rotate = function (ir, angle) {
      return ir.toCanvas().then(function (canvas) {
        return applyRotate(canvas, ir.getType(), angle);
      });
    };
    var applyRotate = function (image, type, angle) {
      var degrees = angle < 0 ? 360 + angle : angle;
      var rad = degrees * Math.PI / 180;
      var width = image.width;
      var height = image.height;
      var sin = Math.sin(rad);
      var cos = Math.cos(rad);
      var newWidth = ceilWithPrecision(Math.abs(width * cos) + Math.abs(height * sin));
      var newHeight = ceilWithPrecision(Math.abs(width * sin) + Math.abs(height * cos));
      var canvas = create$5(newWidth, newHeight);
      var context = get2dContext(canvas);
      context.translate(newWidth / 2, newHeight / 2);
      context.rotate(rad);
      context.drawImage(image, -width / 2, -height / 2);
      return fromCanvas(canvas, type);
    };
    var flip = function (ir, axis) {
      return ir.toCanvas().then(function (canvas) {
        return applyFlip(canvas, ir.getType(), axis);
      });
    };
    var applyFlip = function (image, type, axis) {
      var canvas = create$5(image.width, image.height);
      var context = get2dContext(canvas);
      if (axis === 'v') {
        context.scale(1, -1);
        context.drawImage(image, 0, -canvas.height);
      } else {
        context.scale(-1, 1);
        context.drawImage(image, -canvas.width, 0);
      }
      return fromCanvas(canvas, type);
    };
    var crop = function (ir, x, y, w, h) {
      return ir.toCanvas().then(function (canvas) {
        return applyCrop(canvas, ir.getType(), x, y, w, h);
      });
    };
    var applyCrop = function (image, type, x, y, w, h) {
      var canvas = create$5(w, h);
      var context = get2dContext(canvas);
      context.drawImage(image, -x, -y);
      return fromCanvas(canvas, type);
    };
    var resize$1 = function (ir, w, h) {
      return ir.toCanvas().then(function (canvas) {
        return scale(canvas, w, h).then(function (newCanvas) {
          return fromCanvas(newCanvas, ir.getType());
        });
      });
    };

    var invert$1 = function (ir) {
      return invert(ir);
    };
    var sharpen$1 = function (ir) {
      return sharpen(ir);
    };
    var gamma$1 = function (ir, value) {
      return gamma(ir, value);
    };
    var colorize$1 = function (ir, adjustR, adjustG, adjustB) {
      return colorize(ir, adjustR, adjustG, adjustB);
    };
    var brightness$1 = function (ir, adjust) {
      return brightness(ir, adjust);
    };
    var contrast$1 = function (ir, adjust) {
      return contrast(ir, adjust);
    };
    var flip$1 = function (ir, axis) {
      return flip(ir, axis);
    };
    var crop$1 = function (ir, x, y, w, h) {
      return crop(ir, x, y, w, h);
    };
    var resize$2 = function (ir, w, h) {
      return resize$1(ir, w, h);
    };
    var rotate$1 = function (ir, angle) {
      return rotate(ir, angle);
    };

    var renderIcon$1 = function (iconHtml, behaviours) {
      return __assign({
        dom: {
          tag: 'span',
          innerHtml: iconHtml,
          classes: [
            'tox-icon',
            'tox-tbtn__icon-wrap'
          ]
        }
      }, behaviours);
    };
    var renderIconFromPack = function (iconName, iconsProvider) {
      return renderIcon$1(get$e(iconName, iconsProvider), {});
    };
    var renderReplacableIconFromPack = function (iconName, iconsProvider) {
      return renderIcon$1(get$e(iconName, iconsProvider), { behaviours: derive$1([Replacing.config({})]) });
    };
    var renderLabel$1 = function (text, prefix, providersBackstage) {
      return {
        dom: {
          tag: 'span',
          innerHtml: providersBackstage.translate(text),
          classes: [prefix + '__select-label']
        },
        behaviours: derive$1([Replacing.config({})])
      };
    };

    var _a$1;
    var internalToolbarButtonExecute = generate$1('toolbar.button.execute');
    var onToolbarButtonExecute = function (info) {
      return runOnExecute(function (comp, _simulatedEvent) {
        runWithApi(info, comp)(function (itemApi) {
          emitWith(comp, internalToolbarButtonExecute, { buttonApi: itemApi });
          info.onAction(itemApi);
        });
      });
    };
    var toolbarButtonEventOrder = (_a$1 = {}, _a$1[execute()] = [
      'disabling',
      'alloy.base.behaviour',
      'toggling',
      'toolbar-button-events'
    ], _a$1);

    var updateMenuText = generate$1('update-menu-text');
    var updateMenuIcon = generate$1('update-menu-icon');
    var renderCommonDropdown = function (spec, prefix, sharedBackstage) {
      var editorOffCell = Cell(noop);
      var optMemDisplayText = spec.text.map(function (text) {
        return record(renderLabel$1(text, prefix, sharedBackstage.providers));
      });
      var optMemDisplayIcon = spec.icon.map(function (iconName) {
        return record(renderReplacableIconFromPack(iconName, sharedBackstage.providers.icons));
      });
      var onLeftOrRightInMenu = function (comp, se) {
        var dropdown = Representing.getValue(comp);
        Focusing.focus(dropdown);
        emitWith(dropdown, 'keydown', { raw: se.event.raw });
        Dropdown.close(dropdown);
        return Optional.some(true);
      };
      var role = spec.role.fold(function () {
        return {};
      }, function (role) {
        return { role: role };
      });
      var tooltipAttributes = spec.tooltip.fold(function () {
        return {};
      }, function (tooltip) {
        var translatedTooltip = sharedBackstage.providers.translate(tooltip);
        return {
          'title': translatedTooltip,
          'aria-label': translatedTooltip
        };
      });
      var memDropdown = record(Dropdown.sketch(__assign(__assign(__assign({}, spec.uid ? { uid: spec.uid } : {}), role), {
        dom: {
          tag: 'button',
          classes: [
            prefix,
            prefix + '--select'
          ].concat(map(spec.classes, function (c) {
            return prefix + '--' + c;
          })),
          attributes: __assign({}, tooltipAttributes)
        },
        components: componentRenderPipeline([
          optMemDisplayIcon.map(function (mem) {
            return mem.asSpec();
          }),
          optMemDisplayText.map(function (mem) {
            return mem.asSpec();
          }),
          Optional.some({
            dom: {
              tag: 'div',
              classes: [prefix + '__select-chevron'],
              innerHtml: get$e('chevron-down', sharedBackstage.providers.icons)
            }
          })
        ]),
        matchWidth: true,
        useMinWidth: true,
        dropdownBehaviours: derive$1(__spreadArrays(spec.dropdownBehaviours, [
          DisablingConfigs.button(function () {
            return spec.disabled || sharedBackstage.providers.isDisabled();
          }),
          receivingConfig(),
          Unselecting.config({}),
          Replacing.config({}),
          config('dropdown-events', [
            onControlAttached(spec, editorOffCell),
            onControlDetached(spec, editorOffCell)
          ]),
          config('menubutton-update-display-text', [
            run(updateMenuText, function (comp, se) {
              optMemDisplayText.bind(function (mem) {
                return mem.getOpt(comp);
              }).each(function (displayText) {
                Replacing.set(displayText, [text(sharedBackstage.providers.translate(se.event.text))]);
              });
            }),
            run(updateMenuIcon, function (comp, se) {
              optMemDisplayIcon.bind(function (mem) {
                return mem.getOpt(comp);
              }).each(function (displayIcon) {
                Replacing.set(displayIcon, [renderReplacableIconFromPack(se.event.icon, sharedBackstage.providers.icons)]);
              });
            })
          ])
        ])),
        eventOrder: deepMerge(toolbarButtonEventOrder, {
          mousedown: [
            'focusing',
            'alloy.base.behaviour',
            'item-type-events',
            'normal-dropdown-events'
          ]
        }),
        sandboxBehaviours: derive$1([Keying.config({
            mode: 'special',
            onLeft: onLeftOrRightInMenu,
            onRight: onLeftOrRightInMenu
          })]),
        lazySink: sharedBackstage.getSink,
        toggleClass: prefix + '--active',
        parts: { menu: part(false, spec.columns, spec.presets) },
        fetch: function (comp) {
          return Future.nu(curry(spec.fetch, comp));
        }
      })));
      return memDropdown.asSpec();
    };

    var isMenuItemReference = function (item) {
      return isString(item);
    };
    var isSeparator = function (item) {
      return item.type === 'separator';
    };
    var isExpandingMenuItem = function (item) {
      return has(item, 'getSubmenuItems');
    };
    var separator$1 = { type: 'separator' };
    var unwrapReferences = function (items, menuItems) {
      var realItems = foldl(items, function (acc, item) {
        if (isMenuItemReference(item)) {
          if (item === '') {
            return acc;
          } else if (item === '|') {
            return acc.length > 0 && !isSeparator(acc[acc.length - 1]) ? acc.concat([separator$1]) : acc;
          } else if (has(menuItems, item.toLowerCase())) {
            return acc.concat([menuItems[item.toLowerCase()]]);
          } else {
            return acc;
          }
        } else {
          return acc.concat([item]);
        }
      }, []);
      if (realItems.length > 0 && isSeparator(realItems[realItems.length - 1])) {
        realItems.pop();
      }
      return realItems;
    };
    var getFromExpandingItem = function (item, menuItems) {
      var submenuItems = item.getSubmenuItems();
      var rest = expand(submenuItems, menuItems);
      var newMenus = deepMerge(rest.menus, wrap$1(item.value, rest.items));
      var newExpansions = deepMerge(rest.expansions, wrap$1(item.value, item.value));
      return {
        item: item,
        menus: newMenus,
        expansions: newExpansions
      };
    };
    var getFromItem = function (item, menuItems) {
      return isExpandingMenuItem(item) ? getFromExpandingItem(item, menuItems) : {
        item: item,
        menus: {},
        expansions: {}
      };
    };
    var generateValueIfRequired = function (item) {
      if (isSeparator(item)) {
        return item;
      } else {
        var itemValue = get$1(item, 'value').getOrThunk(function () {
          return generate$1('generated-menu-item');
        });
        return deepMerge({ value: itemValue }, item);
      }
    };
    var expand = function (items, menuItems) {
      var realItems = unwrapReferences(isString(items) ? items.split(' ') : items, menuItems);
      return foldr(realItems, function (acc, item) {
        var itemWithValue = generateValueIfRequired(item);
        var newData = getFromItem(itemWithValue, menuItems);
        return {
          menus: deepMerge(acc.menus, newData.menus),
          items: [newData.item].concat(acc.items),
          expansions: deepMerge(acc.expansions, newData.expansions)
        };
      }, {
        menus: {},
        expansions: {},
        items: []
      });
    };

    var build$2 = function (items, itemResponse, backstage, isHorizontalMenu) {
      var primary = generate$1('primary-menu');
      var data = expand(items, backstage.shared.providers.menuItems());
      if (data.items.length === 0) {
        return Optional.none();
      }
      var mainMenu = createPartialMenu(primary, data.items, itemResponse, backstage, isHorizontalMenu);
      var submenus = map$2(data.menus, function (menuItems, menuName) {
        return createPartialMenu(menuName, menuItems, itemResponse, backstage, false);
      });
      var menus = deepMerge(submenus, wrap$1(primary, mainMenu));
      return Optional.from(tieredMenu.tieredData(primary, menus, data.expansions));
    };

    var getMenuButtonApi = function (component) {
      return {
        isDisabled: function () {
          return Disabling.isDisabled(component);
        },
        setDisabled: function (state) {
          return Disabling.set(component, state);
        },
        setActive: function (state) {
          var elm = component.element;
          if (state) {
            add$2(elm, 'tox-tbtn--enabled');
            set$1(elm, 'aria-pressed', true);
          } else {
            remove$4(elm, 'tox-tbtn--enabled');
            remove$1(elm, 'aria-pressed');
          }
        },
        isActive: function () {
          return has$2(component.element, 'tox-tbtn--enabled');
        }
      };
    };
    var renderMenuButton = function (spec, prefix, backstage, role) {
      return renderCommonDropdown({
        text: spec.text,
        icon: spec.icon,
        tooltip: spec.tooltip,
        role: role,
        fetch: function (_comp, callback) {
          spec.fetch(function (items) {
            callback(build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage, false));
          });
        },
        onSetup: spec.onSetup,
        getApi: getMenuButtonApi,
        columns: 1,
        presets: 'normal',
        classes: [],
        dropdownBehaviours: [Tabstopping.config({})]
      }, prefix, backstage.shared);
    };
    var getFetch$1 = function (items, getButton, backstage) {
      var getMenuItemAction = function (item) {
        return function (api) {
          var newValue = !api.isActive();
          api.setActive(newValue);
          item.storage.set(newValue);
          backstage.shared.getSink().each(function (sink) {
            getButton().getOpt(sink).each(function (orig) {
              focus$1(orig.element);
              emitWith(orig, formActionEvent, {
                name: item.name,
                value: item.storage.get()
              });
            });
          });
        };
      };
      var getMenuItemSetup = function (item) {
        return function (api) {
          api.setActive(item.storage.get());
        };
      };
      return function (success) {
        success(map(items, function (item) {
          var text = item.text.fold(function () {
            return {};
          }, function (text) {
            return { text: text };
          });
          return __assign(__assign({
            type: item.type,
            active: false
          }, text), {
            onAction: getMenuItemAction(item),
            onSetup: getMenuItemSetup(item)
          });
        }));
      };
    };

    var renderCommonSpec = function (spec, actionOpt, extraBehaviours, dom, components, providersBackstage) {
      if (extraBehaviours === void 0) {
        extraBehaviours = [];
      }
      var action = actionOpt.fold(function () {
        return {};
      }, function (action) {
        return { action: action };
      });
      var common = __assign({
        buttonBehaviours: derive$1([
          DisablingConfigs.button(function () {
            return spec.disabled || providersBackstage.isDisabled();
          }),
          receivingConfig(),
          Tabstopping.config({}),
          config('button press', [
            preventDefault('click'),
            preventDefault('mousedown')
          ])
        ].concat(extraBehaviours)),
        eventOrder: {
          click: [
            'button press',
            'alloy.base.behaviour'
          ],
          mousedown: [
            'button press',
            'alloy.base.behaviour'
          ]
        }
      }, action);
      var domFinal = deepMerge(common, { dom: dom });
      return deepMerge(domFinal, { components: components });
    };
    var renderIconButtonSpec = function (spec, action, providersBackstage, extraBehaviours) {
      if (extraBehaviours === void 0) {
        extraBehaviours = [];
      }
      var tooltipAttributes = spec.tooltip.map(function (tooltip) {
        return {
          'aria-label': providersBackstage.translate(tooltip),
          'title': providersBackstage.translate(tooltip)
        };
      }).getOr({});
      var dom = {
        tag: 'button',
        classes: ['tox-tbtn'],
        attributes: tooltipAttributes
      };
      var icon = spec.icon.map(function (iconName) {
        return renderIconFromPack(iconName, providersBackstage.icons);
      });
      var components = componentRenderPipeline([icon]);
      return renderCommonSpec(spec, action, extraBehaviours, dom, components, providersBackstage);
    };
    var renderIconButton = function (spec, action, providersBackstage, extraBehaviours) {
      if (extraBehaviours === void 0) {
        extraBehaviours = [];
      }
      var iconButtonSpec = renderIconButtonSpec(spec, Optional.some(action), providersBackstage, extraBehaviours);
      return Button.sketch(iconButtonSpec);
    };
    var renderButtonSpec = function (spec, action, providersBackstage, extraBehaviours, extraClasses) {
      if (extraBehaviours === void 0) {
        extraBehaviours = [];
      }
      if (extraClasses === void 0) {
        extraClasses = [];
      }
      var translatedText = providersBackstage.translate(spec.text);
      var icon = spec.icon ? spec.icon.map(function (iconName) {
        return renderIconFromPack(iconName, providersBackstage.icons);
      }) : Optional.none();
      var components = icon.isSome() ? componentRenderPipeline([icon]) : [];
      var innerHtml = icon.isSome() ? {} : { innerHtml: translatedText };
      var classes = __spreadArrays(!spec.primary && !spec.borderless ? [
        'tox-button',
        'tox-button--secondary'
      ] : ['tox-button'], icon.isSome() ? ['tox-button--icon'] : [], spec.borderless ? ['tox-button--naked'] : [], extraClasses);
      var dom = __assign(__assign({
        tag: 'button',
        classes: classes
      }, innerHtml), { attributes: { title: translatedText } });
      return renderCommonSpec(spec, action, extraBehaviours, dom, components, providersBackstage);
    };
    var renderButton = function (spec, action, providersBackstage, extraBehaviours, extraClasses) {
      if (extraBehaviours === void 0) {
        extraBehaviours = [];
      }
      if (extraClasses === void 0) {
        extraClasses = [];
      }
      var buttonSpec = renderButtonSpec(spec, Optional.some(action), providersBackstage, extraBehaviours, extraClasses);
      return Button.sketch(buttonSpec);
    };
    var getAction = function (name, buttonType) {
      return function (comp) {
        if (buttonType === 'custom') {
          emitWith(comp, formActionEvent, {
            name: name,
            value: {}
          });
        } else if (buttonType === 'submit') {
          emit(comp, formSubmitEvent);
        } else if (buttonType === 'cancel') {
          emit(comp, formCancelEvent);
        } else {
          console.error('Unknown button type: ', buttonType);
        }
      };
    };
    var isMenuFooterButtonSpec = function (spec, buttonType) {
      return buttonType === 'menu';
    };
    var isNormalFooterButtonSpec = function (spec, buttonType) {
      return buttonType === 'custom' || buttonType === 'cancel' || buttonType === 'submit';
    };
    var renderFooterButton = function (spec, buttonType, backstage) {
      if (isMenuFooterButtonSpec(spec, buttonType)) {
        var getButton = function () {
          return memButton_1;
        };
        var menuButtonSpec = spec;
        var fixedSpec = __assign(__assign({}, spec), {
          onSetup: function (api) {
            api.setDisabled(spec.disabled);
            return noop;
          },
          fetch: getFetch$1(menuButtonSpec.items, getButton, backstage)
        });
        var memButton_1 = record(renderMenuButton(fixedSpec, 'tox-tbtn', backstage, Optional.none()));
        return memButton_1.asSpec();
      } else if (isNormalFooterButtonSpec(spec, buttonType)) {
        var action = getAction(spec.name, buttonType);
        var buttonSpec = __assign(__assign({}, spec), { borderless: false });
        return renderButton(buttonSpec, action, backstage.shared.providers, []);
      } else {
        console.error('Unknown footer button type: ', buttonType);
      }
    };
    var renderDialogButton = function (spec, providersBackstage) {
      var action = getAction(spec.name, 'custom');
      return renderFormField(Optional.none(), FormField.parts.field(__assign({ factory: Button }, renderButtonSpec(spec, Optional.some(action), providersBackstage, [
        RepresentingConfigs.memory(''),
        ComposingConfigs.self()
      ]))));
    };

    var schema$i = constant([
      defaulted$1('field1Name', 'field1'),
      defaulted$1('field2Name', 'field2'),
      onStrictHandler('onLockedChange'),
      markers(['lockClass']),
      defaulted$1('locked', false),
      SketchBehaviours.field('coupledFieldBehaviours', [
        Composing,
        Representing
      ])
    ]);
    var getField = function (comp, detail, partName) {
      return getPart(comp, detail, partName).bind(Composing.getCurrent);
    };
    var coupledPart = function (selfName, otherName) {
      return required({
        factory: FormField,
        name: selfName,
        overrides: function (detail) {
          return {
            fieldBehaviours: derive$1([config('coupled-input-behaviour', [run(input(), function (me) {
                  getField(me, detail, otherName).each(function (other) {
                    getPart(me, detail, 'lock').each(function (lock) {
                      if (Toggling.isOn(lock)) {
                        detail.onLockedChange(me, other, lock);
                      }
                    });
                  });
                })])])
          };
        }
      });
    };
    var parts$5 = constant([
      coupledPart('field1', 'field2'),
      coupledPart('field2', 'field1'),
      required({
        factory: Button,
        schema: [strict$1('dom')],
        name: 'lock',
        overrides: function (detail) {
          return {
            buttonBehaviours: derive$1([Toggling.config({
                selected: detail.locked,
                toggleClass: detail.markers.lockClass,
                aria: { mode: 'pressed' }
              })])
          };
        }
      })
    ]);

    var factory$7 = function (detail, components, _spec, _externals) {
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: SketchBehaviours.augment(detail.coupledFieldBehaviours, [
          Composing.config({ find: Optional.some }),
          Representing.config({
            store: {
              mode: 'manual',
              getValue: function (comp) {
                var _a;
                var parts = getPartsOrDie(comp, detail, [
                  'field1',
                  'field2'
                ]);
                return _a = {}, _a[detail.field1Name] = Representing.getValue(parts.field1()), _a[detail.field2Name] = Representing.getValue(parts.field2()), _a;
              },
              setValue: function (comp, value) {
                var parts = getPartsOrDie(comp, detail, [
                  'field1',
                  'field2'
                ]);
                if (hasNonNullableKey(value, detail.field1Name)) {
                  Representing.setValue(parts.field1(), value[detail.field1Name]);
                }
                if (hasNonNullableKey(value, detail.field2Name)) {
                  Representing.setValue(parts.field2(), value[detail.field2Name]);
                }
              }
            }
          })
        ]),
        apis: {
          getField1: function (component) {
            return getPart(component, detail, 'field1');
          },
          getField2: function (component) {
            return getPart(component, detail, 'field2');
          },
          getLock: function (component) {
            return getPart(component, detail, 'lock');
          }
        }
      };
    };
    var FormCoupledInputs = composite$1({
      name: 'FormCoupledInputs',
      configFields: schema$i(),
      partFields: parts$5(),
      factory: factory$7,
      apis: {
        getField1: function (apis, component) {
          return apis.getField1(component);
        },
        getField2: function (apis, component) {
          return apis.getField2(component);
        },
        getLock: function (apis, component) {
          return apis.getLock(component);
        }
      }
    });

    var formatSize = function (size) {
      var unitDec = {
        '': 0,
        'px': 0,
        'pt': 1,
        'mm': 1,
        'pc': 2,
        'ex': 2,
        'em': 2,
        'ch': 2,
        'rem': 2,
        'cm': 3,
        'in': 4,
        '%': 4
      };
      var maxDecimal = function (unit) {
        return unit in unitDec ? unitDec[unit] : 1;
      };
      var numText = size.value.toFixed(maxDecimal(size.unit));
      if (numText.indexOf('.') !== -1) {
        numText = numText.replace(/\.?0*$/, '');
      }
      return numText + size.unit;
    };
    var parseSize = function (sizeText) {
      var numPattern = /^\s*(\d+(?:\.\d+)?)\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\s*$/;
      var match = numPattern.exec(sizeText);
      if (match !== null) {
        var value = parseFloat(match[1]);
        var unit = match[2];
        return Result.value({
          value: value,
          unit: unit
        });
      } else {
        return Result.error(sizeText);
      }
    };
    var convertUnit = function (size, unit) {
      var inInch = {
        '': 96,
        'px': 96,
        'pt': 72,
        'cm': 2.54,
        'pc': 12,
        'mm': 25.4,
        'in': 1
      };
      var supported = function (u) {
        return Object.prototype.hasOwnProperty.call(inInch, u);
      };
      if (size.unit === unit) {
        return Optional.some(size.value);
      } else if (supported(size.unit) && supported(unit)) {
        if (inInch[size.unit] === inInch[unit]) {
          return Optional.some(size.value);
        } else {
          return Optional.some(size.value / inInch[size.unit] * inInch[unit]);
        }
      } else {
        return Optional.none();
      }
    };
    var noSizeConversion = function (_input) {
      return Optional.none();
    };
    var ratioSizeConversion = function (scale, unit) {
      return function (size) {
        return convertUnit(size, unit).map(function (value) {
          return {
            value: value * scale,
            unit: unit
          };
        });
      };
    };
    var makeRatioConverter = function (currentFieldText, otherFieldText) {
      var cValue = parseSize(currentFieldText).toOptional();
      var oValue = parseSize(otherFieldText).toOptional();
      return lift2(cValue, oValue, function (cSize, oSize) {
        return convertUnit(cSize, oSize.unit).map(function (val) {
          return oSize.value / val;
        }).map(function (r) {
          return ratioSizeConversion(r, oSize.unit);
        }).getOr(noSizeConversion);
      }).getOr(noSizeConversion);
    };

    var renderSizeInput = function (spec, providersBackstage) {
      var converter = noSizeConversion;
      var ratioEvent = generate$1('ratio-event');
      var pLock = FormCoupledInputs.parts.lock({
        dom: {
          tag: 'button',
          classes: [
            'tox-lock',
            'tox-button',
            'tox-button--naked',
            'tox-button--icon'
          ],
          attributes: { title: providersBackstage.translate(spec.label.getOr('Constrain proportions')) }
        },
        components: [
          {
            dom: {
              tag: 'span',
              classes: [
                'tox-icon',
                'tox-lock-icon__lock'
              ],
              innerHtml: get$e('lock', providersBackstage.icons)
            }
          },
          {
            dom: {
              tag: 'span',
              classes: [
                'tox-icon',
                'tox-lock-icon__unlock'
              ],
              innerHtml: get$e('unlock', providersBackstage.icons)
            }
          }
        ],
        buttonBehaviours: derive$1([
          Disabling.config({
            disabled: function () {
              return spec.disabled || providersBackstage.isDisabled();
            }
          }),
          receivingConfig(),
          Tabstopping.config({})
        ])
      });
      var formGroup = function (components) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-form__group']
          },
          components: components
        };
      };
      var getFieldPart = function (isField1) {
        return FormField.parts.field({
          factory: Input,
          inputClasses: ['tox-textfield'],
          inputBehaviours: derive$1([
            Disabling.config({
              disabled: function () {
                return spec.disabled || providersBackstage.isDisabled();
              }
            }),
            receivingConfig(),
            Tabstopping.config({}),
            config('size-input-events', [
              run(focusin(), function (component, _simulatedEvent) {
                emitWith(component, ratioEvent, { isField1: isField1 });
              }),
              run(change(), function (component, _simulatedEvent) {
                emitWith(component, formChangeEvent, { name: spec.name });
              })
            ])
          ]),
          selectOnFocus: false
        });
      };
      var getLabel = function (label) {
        return {
          dom: {
            tag: 'label',
            classes: ['tox-label'],
            innerHtml: providersBackstage.translate(label)
          }
        };
      };
      var widthField = FormCoupledInputs.parts.field1(formGroup([
        FormField.parts.label(getLabel('Width')),
        getFieldPart(true)
      ]));
      var heightField = FormCoupledInputs.parts.field2(formGroup([
        FormField.parts.label(getLabel('Height')),
        getFieldPart(false)
      ]));
      return FormCoupledInputs.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-form__group']
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-form__controls-h-stack']
            },
            components: [
              widthField,
              heightField,
              formGroup([
                getLabel('&nbsp;'),
                pLock
              ])
            ]
          }],
        field1Name: 'width',
        field2Name: 'height',
        locked: true,
        markers: { lockClass: 'tox-locked' },
        onLockedChange: function (current, other, _lock) {
          parseSize(Representing.getValue(current)).each(function (size) {
            converter(size).each(function (newSize) {
              Representing.setValue(other, formatSize(newSize));
            });
          });
        },
        coupledFieldBehaviours: derive$1([
          Disabling.config({
            disabled: function () {
              return spec.disabled || providersBackstage.isDisabled();
            },
            onDisabled: function (comp) {
              FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.disable);
              FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.disable);
              FormCoupledInputs.getLock(comp).each(Disabling.disable);
            },
            onEnabled: function (comp) {
              FormCoupledInputs.getField1(comp).bind(FormField.getField).each(Disabling.enable);
              FormCoupledInputs.getField2(comp).bind(FormField.getField).each(Disabling.enable);
              FormCoupledInputs.getLock(comp).each(Disabling.enable);
            }
          }),
          receivingConfig(),
          config('size-input-events2', [run(ratioEvent, function (component, simulatedEvent) {
              var isField1 = simulatedEvent.event.isField1;
              var optCurrent = isField1 ? FormCoupledInputs.getField1(component) : FormCoupledInputs.getField2(component);
              var optOther = isField1 ? FormCoupledInputs.getField2(component) : FormCoupledInputs.getField1(component);
              var value1 = optCurrent.map(Representing.getValue).getOr('');
              var value2 = optOther.map(Representing.getValue).getOr('');
              converter = makeRatioConverter(value1, value2);
            })])
        ])
      });
    };

    var undo = constant(generate$1('undo'));
    var redo = constant(generate$1('redo'));
    var zoom = constant(generate$1('zoom'));
    var back = constant(generate$1('back'));
    var apply = constant(generate$1('apply'));
    var swap = constant(generate$1('swap'));
    var transform = constant(generate$1('transform'));
    var tempTransform = constant(generate$1('temp-transform'));
    var transformApply = constant(generate$1('transform-apply'));
    var internal = {
      undo: undo,
      redo: redo,
      zoom: zoom,
      back: back,
      apply: apply,
      swap: swap,
      transform: transform,
      tempTransform: tempTransform,
      transformApply: transformApply
    };
    var saveState = constant('save-state');
    var disable$1 = constant('disable');
    var enable$1 = constant('enable');
    var external$2 = {
      formActionEvent: formActionEvent,
      saveState: saveState,
      disable: disable$1,
      enable: enable$1
    };

    var renderEditPanel = function (imagePanel, providersBackstage) {
      var createButton = function (text, action, disabled, primary) {
        return record(renderButton({
          name: text,
          text: text,
          disabled: disabled,
          primary: primary,
          icon: Optional.none(),
          borderless: false
        }, action, providersBackstage));
      };
      var createIconButton = function (icon, tooltip, action, disabled) {
        return record(renderIconButton({
          name: icon,
          icon: Optional.some(icon),
          tooltip: Optional.some(tooltip),
          disabled: disabled,
          primary: false,
          borderless: false
        }, action, providersBackstage));
      };
      var disableAllComponents = function (comps, eventcomp) {
        comps.map(function (mem) {
          var component = mem.get(eventcomp);
          if (component.hasConfigured(Disabling)) {
            Disabling.disable(component);
          }
        });
      };
      var enableAllComponents = function (comps, eventcomp) {
        comps.map(function (mem) {
          var component = mem.get(eventcomp);
          if (component.hasConfigured(Disabling)) {
            Disabling.enable(component);
          }
        });
      };
      var panelDom = {
        tag: 'div',
        classes: [
          'tox-image-tools__toolbar',
          'tox-image-tools-edit-panel'
        ]
      };
      var noop$1 = noop;
      var emit$1 = function (comp, event, data) {
        emitWith(comp, event, data);
      };
      var emitDisable = function (component) {
        return emit(component, external$2.disable());
      };
      var emitEnable = function (component) {
        return emit(component, external$2.enable());
      };
      var emitTransform = function (comp, transform) {
        emitDisable(comp);
        emit$1(comp, internal.transform(), { transform: transform });
        emitEnable(comp);
      };
      var emitTempTransform = function (comp, transform) {
        emitDisable(comp);
        emit$1(comp, internal.tempTransform(), { transform: transform });
        emitEnable(comp);
      };
      var getBackSwap = function (anyInSystem) {
        return function () {
          memContainer.getOpt(anyInSystem).each(function (container) {
            Replacing.set(container, [ButtonPanel]);
          });
        };
      };
      var emitTransformApply = function (comp, transform) {
        emitDisable(comp);
        emit$1(comp, internal.transformApply(), {
          transform: transform,
          swap: getBackSwap(comp)
        });
        emitEnable(comp);
      };
      var createBackButton = function () {
        return createButton('Back', function (button) {
          return emit$1(button, internal.back(), { swap: getBackSwap(button) });
        }, false, false);
      };
      var createSpacer = function () {
        return record({
          dom: {
            tag: 'div',
            classes: ['tox-spacer']
          },
          behaviours: derive$1([Disabling.config({})])
        });
      };
      var createApplyButton = function () {
        return createButton('Apply', function (button) {
          return emit$1(button, internal.apply(), { swap: getBackSwap(button) });
        }, true, true);
      };
      var makeCropTransform = function () {
        return function (ir) {
          var rect = imagePanel.getRect();
          return crop$1(ir, rect.x, rect.y, rect.w, rect.h);
        };
      };
      var cropPanelComponents = [
        createBackButton(),
        createSpacer(),
        createButton('Apply', function (button) {
          var transform = makeCropTransform();
          emitTransformApply(button, transform);
          imagePanel.hideCrop();
        }, false, true)
      ];
      var CropPanel = Container.sketch({
        dom: panelDom,
        components: cropPanelComponents.map(function (mem) {
          return mem.asSpec();
        }),
        containerBehaviours: derive$1([config('image-tools-crop-buttons-events', [
            run(external$2.disable(), function (comp, _se) {
              disableAllComponents(cropPanelComponents, comp);
            }),
            run(external$2.enable(), function (comp, _se) {
              enableAllComponents(cropPanelComponents, comp);
            })
          ])])
      });
      var memSize = record(renderSizeInput({
        name: 'size',
        label: Optional.none(),
        constrain: true,
        disabled: false
      }, providersBackstage));
      var makeResizeTransform = function (width, height) {
        return function (ir) {
          return resize$2(ir, width, height);
        };
      };
      var resizePanelComponents = [
        createBackButton(),
        createSpacer(),
        memSize,
        createSpacer(),
        createButton('Apply', function (button) {
          memSize.getOpt(button).each(function (sizeInput) {
            var value = Representing.getValue(sizeInput);
            var width = parseInt(value.width, 10);
            var height = parseInt(value.height, 10);
            var transform = makeResizeTransform(width, height);
            emitTransformApply(button, transform);
          });
        }, false, true)
      ];
      var ResizePanel = Container.sketch({
        dom: panelDom,
        components: resizePanelComponents.map(function (mem) {
          return mem.asSpec();
        }),
        containerBehaviours: derive$1([config('image-tools-resize-buttons-events', [
            run(external$2.disable(), function (comp, _se) {
              disableAllComponents(resizePanelComponents, comp);
            }),
            run(external$2.enable(), function (comp, _se) {
              enableAllComponents(resizePanelComponents, comp);
            })
          ])])
      });
      var makeValueTransform = function (transform, value) {
        return function (ir) {
          return transform(ir, value);
        };
      };
      var horizontalFlip = makeValueTransform(flip$1, 'h');
      var verticalFlip = makeValueTransform(flip$1, 'v');
      var counterclockwiseRotate = makeValueTransform(rotate$1, -90);
      var clockwiseRotate = makeValueTransform(rotate$1, 90);
      var flipRotateOnAction = function (comp, operation) {
        emitTempTransform(comp, operation);
      };
      var flipRotateComponents = [
        createBackButton(),
        createSpacer(),
        createIconButton('flip-horizontally', 'Flip horizontally', function (button) {
          flipRotateOnAction(button, horizontalFlip);
        }, false),
        createIconButton('flip-vertically', 'Flip vertically', function (button) {
          flipRotateOnAction(button, verticalFlip);
        }, false),
        createIconButton('rotate-left', 'Rotate counterclockwise', function (button) {
          flipRotateOnAction(button, counterclockwiseRotate);
        }, false),
        createIconButton('rotate-right', 'Rotate clockwise', function (button) {
          flipRotateOnAction(button, clockwiseRotate);
        }, false),
        createSpacer(),
        createApplyButton()
      ];
      var FlipRotatePanel = Container.sketch({
        dom: panelDom,
        components: flipRotateComponents.map(function (mem) {
          return mem.asSpec();
        }),
        containerBehaviours: derive$1([config('image-tools-fliprotate-buttons-events', [
            run(external$2.disable(), function (comp, _se) {
              disableAllComponents(flipRotateComponents, comp);
            }),
            run(external$2.enable(), function (comp, _se) {
              enableAllComponents(flipRotateComponents, comp);
            })
          ])])
      });
      var makeSlider = function (label, onChoose, min, value, max) {
        var labelPart = Slider.parts.label({
          dom: {
            tag: 'label',
            classes: ['tox-label'],
            innerHtml: providersBackstage.translate(label)
          }
        });
        var spectrum = Slider.parts.spectrum({
          dom: {
            tag: 'div',
            classes: ['tox-slider__rail'],
            attributes: { role: 'presentation' }
          }
        });
        var thumb = Slider.parts.thumb({
          dom: {
            tag: 'div',
            classes: ['tox-slider__handle'],
            attributes: { role: 'presentation' }
          }
        });
        return record(Slider.sketch({
          dom: {
            tag: 'div',
            classes: ['tox-slider'],
            attributes: { role: 'presentation' }
          },
          model: {
            mode: 'x',
            minX: min,
            maxX: max,
            getInitialValue: constant({ x: value })
          },
          components: [
            labelPart,
            spectrum,
            thumb
          ],
          sliderBehaviours: derive$1([Focusing.config({})]),
          onChoose: onChoose
        }));
      };
      var makeVariableSlider = function (label, transform, min, value, max) {
        var onChoose = function (slider, _thumb, value) {
          var valTransform = makeValueTransform(transform, value.x / 100);
          emitTransform(slider, valTransform);
        };
        return makeSlider(label, onChoose, min, value, max);
      };
      var variableFilterPanelComponents = function (label, transform, min, value, max) {
        return [
          createBackButton(),
          makeVariableSlider(label, transform, min, value, max),
          createApplyButton()
        ];
      };
      var createVariableFilterPanel = function (label, transform, min, value, max) {
        var filterPanelComponents = variableFilterPanelComponents(label, transform, min, value, max);
        return Container.sketch({
          dom: panelDom,
          components: filterPanelComponents.map(function (mem) {
            return mem.asSpec();
          }),
          containerBehaviours: derive$1([config('image-tools-filter-panel-buttons-events', [
              run(external$2.disable(), function (comp, _se) {
                disableAllComponents(filterPanelComponents, comp);
              }),
              run(external$2.enable(), function (comp, _se) {
                enableAllComponents(filterPanelComponents, comp);
              })
            ])])
        });
      };
      var filterPanelComponents = [
        createBackButton(),
        createSpacer(),
        createApplyButton()
      ];
      var FilterPanel = Container.sketch({
        dom: panelDom,
        components: filterPanelComponents.map(function (mem) {
          return mem.asSpec();
        })
      });
      var BrightnessPanel = createVariableFilterPanel('Brightness', brightness$1, -100, 0, 100);
      var ContrastPanel = createVariableFilterPanel('Contrast', contrast$1, -100, 0, 100);
      var GammaPanel = createVariableFilterPanel('Gamma', gamma$1, -100, 0, 100);
      var makeColorTransform = function (red, green, blue) {
        return function (ir) {
          return colorize$1(ir, red, green, blue);
        };
      };
      var makeColorSlider = function (label) {
        var onChoose = function (slider, _thumb, _value) {
          var redOpt = memRed.getOpt(slider);
          var blueOpt = memBlue.getOpt(slider);
          var greenOpt = memGreen.getOpt(slider);
          redOpt.each(function (red) {
            blueOpt.each(function (blue) {
              greenOpt.each(function (green) {
                var r = Representing.getValue(red).x / 100;
                var g = Representing.getValue(green).x / 100;
                var b = Representing.getValue(blue).x / 100;
                var transform = makeColorTransform(r, g, b);
                emitTransform(slider, transform);
              });
            });
          });
        };
        return makeSlider(label, onChoose, 0, 100, 200);
      };
      var memRed = makeColorSlider('R');
      var memGreen = makeColorSlider('G');
      var memBlue = makeColorSlider('B');
      var colorizePanelComponents = [
        createBackButton(),
        memRed,
        memGreen,
        memBlue,
        createApplyButton()
      ];
      var ColorizePanel = Container.sketch({
        dom: panelDom,
        components: colorizePanelComponents.map(function (mem) {
          return mem.asSpec();
        })
      });
      var getTransformPanelEvent = function (panel, transform, update) {
        return function (button) {
          var swap = function () {
            memContainer.getOpt(button).each(function (container) {
              Replacing.set(container, [panel]);
              update(container);
            });
          };
          emit$1(button, internal.swap(), {
            transform: transform,
            swap: swap
          });
        };
      };
      var cropPanelUpdate = function (_anyInSystem) {
        imagePanel.showCrop();
      };
      var resizePanelUpdate = function (anyInSystem) {
        memSize.getOpt(anyInSystem).each(function (sizeInput) {
          var measurements = imagePanel.getMeasurements();
          var width = measurements.width;
          var height = measurements.height;
          Representing.setValue(sizeInput, {
            width: width,
            height: height
          });
        });
      };
      var sharpenTransform = Optional.some(sharpen$1);
      var invertTransform = Optional.some(invert$1);
      var buttonPanelComponents = [
        createIconButton('crop', 'Crop', getTransformPanelEvent(CropPanel, Optional.none(), cropPanelUpdate), false),
        createIconButton('resize', 'Resize', getTransformPanelEvent(ResizePanel, Optional.none(), resizePanelUpdate), false),
        createIconButton('orientation', 'Orientation', getTransformPanelEvent(FlipRotatePanel, Optional.none(), noop$1), false),
        createIconButton('brightness', 'Brightness', getTransformPanelEvent(BrightnessPanel, Optional.none(), noop$1), false),
        createIconButton('sharpen', 'Sharpen', getTransformPanelEvent(FilterPanel, sharpenTransform, noop$1), false),
        createIconButton('contrast', 'Contrast', getTransformPanelEvent(ContrastPanel, Optional.none(), noop$1), false),
        createIconButton('color-levels', 'Color levels', getTransformPanelEvent(ColorizePanel, Optional.none(), noop$1), false),
        createIconButton('gamma', 'Gamma', getTransformPanelEvent(GammaPanel, Optional.none(), noop$1), false),
        createIconButton('invert', 'Invert', getTransformPanelEvent(FilterPanel, invertTransform, noop$1), false)
      ];
      var ButtonPanel = Container.sketch({
        dom: panelDom,
        components: buttonPanelComponents.map(function (mem) {
          return mem.asSpec();
        })
      });
      var container = Container.sketch({
        dom: { tag: 'div' },
        components: [ButtonPanel],
        containerBehaviours: derive$1([Replacing.config({})])
      });
      var memContainer = record(container);
      var getApplyButton = function (anyInSystem) {
        return memContainer.getOpt(anyInSystem).map(function (container) {
          var panel = container.components()[0];
          return panel.components()[panel.components().length - 1];
        });
      };
      return {
        memContainer: memContainer,
        getApplyButton: getApplyButton
      };
    };

    var global$d = tinymce.util.Tools.resolve('tinymce.geom.Rect');

    var global$e = tinymce.util.Tools.resolve('tinymce.dom.DomQuery');

    var global$f = tinymce.util.Tools.resolve('tinymce.util.Observable');

    var global$g = tinymce.util.Tools.resolve('tinymce.util.VK');

    var getDocumentSize = function (doc) {
      var max = Math.max;
      var documentElement = doc.documentElement;
      var body = doc.body;
      var scrollWidth = max(documentElement.scrollWidth, body.scrollWidth);
      var clientWidth = max(documentElement.clientWidth, body.clientWidth);
      var offsetWidth = max(documentElement.offsetWidth, body.offsetWidth);
      var scrollHeight = max(documentElement.scrollHeight, body.scrollHeight);
      var clientHeight = max(documentElement.clientHeight, body.clientHeight);
      var offsetHeight = max(documentElement.offsetHeight, body.offsetHeight);
      return {
        width: scrollWidth < offsetWidth ? clientWidth : scrollWidth,
        height: scrollHeight < offsetHeight ? clientHeight : scrollHeight
      };
    };
    var updateWithTouchData = function (e) {
      var keys, i;
      if (e.changedTouches) {
        keys = 'screenX screenY pageX pageY clientX clientY'.split(' ');
        for (i = 0; i < keys.length; i++) {
          e[keys[i]] = e.changedTouches[0][keys[i]];
        }
      }
    };
    function DragHelper (id, settings) {
      var $eventOverlay;
      var doc = settings.document || document;
      var downButton;
      var startX, startY;
      var handleElement = doc.getElementById(settings.handle || id);
      var start = function (e) {
        var docSize = getDocumentSize(doc);
        var cursor;
        updateWithTouchData(e);
        e.preventDefault();
        downButton = e.button;
        var handleElm = handleElement;
        startX = e.screenX;
        startY = e.screenY;
        if (window.getComputedStyle) {
          cursor = window.getComputedStyle(handleElm, null).getPropertyValue('cursor');
        } else {
          cursor = handleElm.runtimeStyle.cursor;
        }
        $eventOverlay = global$e('<div></div>').css({
          position: 'absolute',
          top: 0,
          left: 0,
          width: docSize.width,
          height: docSize.height,
          zIndex: 2147483647,
          opacity: 0.0001,
          cursor: cursor
        }).appendTo(doc.body);
        global$e(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);
        settings.start(e);
      };
      var drag = function (e) {
        updateWithTouchData(e);
        if (e.button !== downButton) {
          return stop(e);
        }
        e.deltaX = e.screenX - startX;
        e.deltaY = e.screenY - startY;
        e.preventDefault();
        settings.drag(e);
      };
      var stop = function (e) {
        updateWithTouchData(e);
        global$e(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);
        $eventOverlay.remove();
        if (settings.stop) {
          settings.stop(e);
        }
      };
      var destroy = function () {
        global$e(handleElement).off();
      };
      global$e(handleElement).on('mousedown touchstart', start);
      return { destroy: destroy };
    }

    var count = 0;
    var create$7 = function (currentRect, viewPortRect, clampRect, containerElm, action) {
      var dragHelpers;
      var prefix = 'tox-';
      var id = prefix + 'crid-' + count++;
      var handles = [
        {
          name: 'move',
          xMul: 0,
          yMul: 0,
          deltaX: 1,
          deltaY: 1,
          deltaW: 0,
          deltaH: 0,
          label: 'Crop Mask'
        },
        {
          name: 'nw',
          xMul: 0,
          yMul: 0,
          deltaX: 1,
          deltaY: 1,
          deltaW: -1,
          deltaH: -1,
          label: 'Top Left Crop Handle'
        },
        {
          name: 'ne',
          xMul: 1,
          yMul: 0,
          deltaX: 0,
          deltaY: 1,
          deltaW: 1,
          deltaH: -1,
          label: 'Top Right Crop Handle'
        },
        {
          name: 'sw',
          xMul: 0,
          yMul: 1,
          deltaX: 1,
          deltaY: 0,
          deltaW: -1,
          deltaH: 1,
          label: 'Bottom Left Crop Handle'
        },
        {
          name: 'se',
          xMul: 1,
          yMul: 1,
          deltaX: 0,
          deltaY: 0,
          deltaW: 1,
          deltaH: 1,
          label: 'Bottom Right Crop Handle'
        }
      ];
      var blockers = [
        'top',
        'right',
        'bottom',
        'left'
      ];
      var getAbsoluteRect = function (outerRect, relativeRect) {
        return {
          x: relativeRect.x + outerRect.x,
          y: relativeRect.y + outerRect.y,
          w: relativeRect.w,
          h: relativeRect.h
        };
      };
      var getRelativeRect = function (outerRect, innerRect) {
        return {
          x: innerRect.x - outerRect.x,
          y: innerRect.y - outerRect.y,
          w: innerRect.w,
          h: innerRect.h
        };
      };
      var getInnerRect = function () {
        return getRelativeRect(clampRect, currentRect);
      };
      var moveRect = function (handle, startRect, deltaX, deltaY) {
        var x, y, w, h, rect;
        x = startRect.x;
        y = startRect.y;
        w = startRect.w;
        h = startRect.h;
        x += deltaX * handle.deltaX;
        y += deltaY * handle.deltaY;
        w += deltaX * handle.deltaW;
        h += deltaY * handle.deltaH;
        if (w < 20) {
          w = 20;
        }
        if (h < 20) {
          h = 20;
        }
        rect = currentRect = global$d.clamp({
          x: x,
          y: y,
          w: w,
          h: h
        }, clampRect, handle.name === 'move');
        rect = getRelativeRect(clampRect, rect);
        instance.fire('updateRect', { rect: rect });
        setInnerRect(rect);
      };
      var render = function () {
        var createDragHelper = function (handle) {
          var startRect;
          return DragHelper(id, {
            document: containerElm.ownerDocument,
            handle: id + '-' + handle.name,
            start: function () {
              startRect = currentRect;
            },
            drag: function (e) {
              moveRect(handle, startRect, e.deltaX, e.deltaY);
            }
          });
        };
        global$e('<div id="' + id + '" class="' + prefix + 'croprect-container"' + ' role="grid" aria-dropeffect="execute">').appendTo(containerElm);
        global$c.each(blockers, function (blocker) {
          global$e('#' + id, containerElm).append('<div id="' + id + '-' + blocker + '"class="' + prefix + 'croprect-block" style="display: none" data-mce-bogus="all">');
        });
        global$c.each(handles, function (handle) {
          global$e('#' + id, containerElm).append('<div id="' + id + '-' + handle.name + '" class="' + prefix + 'croprect-handle ' + prefix + 'croprect-handle-' + handle.name + '"' + 'style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1"' + ' aria-label="' + handle.label + '" aria-grabbed="false" title="' + handle.label + '">');
        });
        dragHelpers = global$c.map(handles, createDragHelper);
        repaint(currentRect);
        global$e(containerElm).on('focusin focusout', function (e) {
          global$e(e.target).attr('aria-grabbed', e.type === 'focus' ? 'true' : 'false');
        });
        global$e(containerElm).on('keydown', function (e) {
          var activeHandle;
          global$c.each(handles, function (handle) {
            if (e.target.id === id + '-' + handle.name) {
              activeHandle = handle;
              return false;
            }
          });
          var moveAndBlock = function (evt, handle, startRect, deltaX, deltaY) {
            evt.stopPropagation();
            evt.preventDefault();
            moveRect(activeHandle, startRect, deltaX, deltaY);
          };
          switch (e.keyCode) {
          case global$g.LEFT:
            moveAndBlock(e, activeHandle, currentRect, -10, 0);
            break;
          case global$g.RIGHT:
            moveAndBlock(e, activeHandle, currentRect, 10, 0);
            break;
          case global$g.UP:
            moveAndBlock(e, activeHandle, currentRect, 0, -10);
            break;
          case global$g.DOWN:
            moveAndBlock(e, activeHandle, currentRect, 0, 10);
            break;
          case global$g.ENTER:
          case global$g.SPACEBAR:
            e.preventDefault();
            action();
            break;
          }
        });
      };
      var toggleVisibility = function (state) {
        var selectors = global$c.map(handles, function (handle) {
          return '#' + id + '-' + handle.name;
        }).concat(global$c.map(blockers, function (blocker) {
          return '#' + id + '-' + blocker;
        })).join(',');
        if (state) {
          global$e(selectors, containerElm).show();
        } else {
          global$e(selectors, containerElm).hide();
        }
      };
      var repaint = function (rect) {
        var updateElementRect = function (name, rect) {
          if (rect.h < 0) {
            rect.h = 0;
          }
          if (rect.w < 0) {
            rect.w = 0;
          }
          global$e('#' + id + '-' + name, containerElm).css({
            left: rect.x,
            top: rect.y,
            width: rect.w,
            height: rect.h
          });
        };
        global$c.each(handles, function (handle) {
          global$e('#' + id + '-' + handle.name, containerElm).css({
            left: rect.w * handle.xMul + rect.x,
            top: rect.h * handle.yMul + rect.y
          });
        });
        updateElementRect('top', {
          x: viewPortRect.x,
          y: viewPortRect.y,
          w: viewPortRect.w,
          h: rect.y - viewPortRect.y
        });
        updateElementRect('right', {
          x: rect.x + rect.w,
          y: rect.y,
          w: viewPortRect.w - rect.x - rect.w + viewPortRect.x,
          h: rect.h
        });
        updateElementRect('bottom', {
          x: viewPortRect.x,
          y: rect.y + rect.h,
          w: viewPortRect.w,
          h: viewPortRect.h - rect.y - rect.h + viewPortRect.y
        });
        updateElementRect('left', {
          x: viewPortRect.x,
          y: rect.y,
          w: rect.x - viewPortRect.x,
          h: rect.h
        });
        updateElementRect('move', rect);
      };
      var setRect = function (rect) {
        currentRect = rect;
        repaint(currentRect);
      };
      var setViewPortRect = function (rect) {
        viewPortRect = rect;
        repaint(currentRect);
      };
      var setInnerRect = function (rect) {
        setRect(getAbsoluteRect(clampRect, rect));
      };
      var setClampRect = function (rect) {
        clampRect = rect;
        repaint(currentRect);
      };
      var destroy = function () {
        global$c.each(dragHelpers, function (helper) {
          helper.destroy();
        });
        dragHelpers = [];
      };
      render();
      var instance = global$c.extend({
        toggleVisibility: toggleVisibility,
        setClampRect: setClampRect,
        setRect: setRect,
        getInnerRect: getInnerRect,
        setInnerRect: setInnerRect,
        setViewPortRect: setViewPortRect,
        destroy: destroy
      }, global$f);
      return instance;
    };
    var CropRect = { create: create$7 };

    var loadImage = function (image) {
      return new global$4(function (resolve) {
        var loaded = function () {
          image.removeEventListener('load', loaded);
          resolve(image);
        };
        if (image.complete) {
          resolve(image);
        } else {
          image.addEventListener('load', loaded);
        }
      });
    };
    var renderImagePanel = function (initialUrl) {
      var memBg = record({
        dom: {
          tag: 'div',
          classes: ['tox-image-tools__image-bg'],
          attributes: { role: 'presentation' }
        }
      });
      var zoomState = Cell(1);
      var cropRect = Cell(Optional.none());
      var rectState = Cell({
        x: 0,
        y: 0,
        w: 1,
        h: 1
      });
      var viewRectState = Cell({
        x: 0,
        y: 0,
        w: 1,
        h: 1
      });
      var repaintImg = function (anyInSystem, img) {
        memContainer.getOpt(anyInSystem).each(function (panel) {
          var zoom = zoomState.get();
          var panelW = get$8(panel.element);
          var panelH = get$7(panel.element);
          var width = img.dom.naturalWidth * zoom;
          var height = img.dom.naturalHeight * zoom;
          var left = Math.max(0, panelW / 2 - width / 2);
          var top = Math.max(0, panelH / 2 - height / 2);
          var css = {
            left: left.toString() + 'px',
            top: top.toString() + 'px',
            width: width.toString() + 'px',
            height: height.toString() + 'px',
            position: 'absolute'
          };
          setAll$1(img, css);
          memBg.getOpt(panel).each(function (bg) {
            setAll$1(bg.element, css);
          });
          cropRect.get().each(function (cRect) {
            var rect = rectState.get();
            cRect.setRect({
              x: rect.x * zoom + left,
              y: rect.y * zoom + top,
              w: rect.w * zoom,
              h: rect.h * zoom
            });
            cRect.setClampRect({
              x: left,
              y: top,
              w: width,
              h: height
            });
            cRect.setViewPortRect({
              x: 0,
              y: 0,
              w: panelW,
              h: panelH
            });
          });
        });
      };
      var zoomFit = function (anyInSystem, img) {
        memContainer.getOpt(anyInSystem).each(function (panel) {
          var panelW = get$8(panel.element);
          var panelH = get$7(panel.element);
          var width = img.dom.naturalWidth;
          var height = img.dom.naturalHeight;
          var zoom = Math.min(panelW / width, panelH / height);
          if (zoom >= 1) {
            zoomState.set(1);
          } else {
            zoomState.set(zoom);
          }
        });
      };
      var updateSrc = function (anyInSystem, url) {
        var img = SugarElement.fromTag('img');
        set$1(img, 'src', url);
        return loadImage(img.dom).then(function () {
          return memContainer.getOpt(anyInSystem).map(function (panel) {
            var aImg = external({ element: img });
            Replacing.replaceAt(panel, 1, Optional.some(aImg));
            var lastViewRect = viewRectState.get();
            var viewRect = {
              x: 0,
              y: 0,
              w: img.dom.naturalWidth,
              h: img.dom.naturalHeight
            };
            viewRectState.set(viewRect);
            var rect = global$d.inflate(viewRect, -20, -20);
            rectState.set(rect);
            if (lastViewRect.w !== viewRect.w || lastViewRect.h !== viewRect.h) {
              zoomFit(panel, img);
            }
            repaintImg(panel, img);
            return img;
          });
        });
      };
      var zoom = function (anyInSystem, direction) {
        var currentZoom = zoomState.get();
        var newZoom = direction > 0 ? Math.min(2, currentZoom + 0.1) : Math.max(0.1, currentZoom - 0.1);
        zoomState.set(newZoom);
        memContainer.getOpt(anyInSystem).each(function (panel) {
          var img = panel.components()[1].element;
          repaintImg(panel, img);
        });
      };
      var showCrop = function () {
        cropRect.get().each(function (cRect) {
          cRect.toggleVisibility(true);
        });
      };
      var hideCrop = function () {
        cropRect.get().each(function (cRect) {
          cRect.toggleVisibility(false);
        });
      };
      var getRect = function () {
        return rectState.get();
      };
      var container = Container.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-image-tools__image']
        },
        components: [
          memBg.asSpec(),
          {
            dom: {
              tag: 'img',
              attributes: { src: initialUrl }
            }
          },
          {
            dom: { tag: 'div' },
            behaviours: derive$1([config('image-panel-crop-events', [runOnAttached(function (comp) {
                  memContainer.getOpt(comp).each(function (container) {
                    var el = container.element.dom;
                    var cRect = CropRect.create({
                      x: 10,
                      y: 10,
                      w: 100,
                      h: 100
                    }, {
                      x: 0,
                      y: 0,
                      w: 200,
                      h: 200
                    }, {
                      x: 0,
                      y: 0,
                      w: 200,
                      h: 200
                    }, el, noop);
                    cRect.toggleVisibility(false);
                    cRect.on('updateRect', function (e) {
                      var rect = e.rect;
                      var zoom = zoomState.get();
                      var newRect = {
                        x: Math.round(rect.x / zoom),
                        y: Math.round(rect.y / zoom),
                        w: Math.round(rect.w / zoom),
                        h: Math.round(rect.h / zoom)
                      };
                      rectState.set(newRect);
                    });
                    cropRect.set(Optional.some(cRect));
                  });
                })])])
          }
        ],
        containerBehaviours: derive$1([
          Replacing.config({}),
          config('image-panel-events', [runOnAttached(function (comp) {
              updateSrc(comp, initialUrl);
            })])
        ])
      });
      var memContainer = record(container);
      var getMeasurements = function () {
        var viewRect = viewRectState.get();
        return {
          width: viewRect.w,
          height: viewRect.h
        };
      };
      return {
        memContainer: memContainer,
        updateSrc: updateSrc,
        zoom: zoom,
        showCrop: showCrop,
        hideCrop: hideCrop,
        getRect: getRect,
        getMeasurements: getMeasurements
      };
    };

    var createButton = function (innerHtml, icon, disabled, action, providersBackstage) {
      return renderIconButton({
        name: innerHtml,
        icon: Optional.some(icon),
        disabled: disabled,
        tooltip: Optional.some(innerHtml),
        primary: false,
        borderless: false
      }, action, providersBackstage);
    };
    var setButtonEnabled = function (button, enabled) {
      if (enabled) {
        Disabling.enable(button);
      } else {
        Disabling.disable(button);
      }
    };
    var renderSideBar = function (providersBackstage) {
      var updateButtonUndoStates = function (anyInSystem, undoEnabled, redoEnabled) {
        memUndo.getOpt(anyInSystem).each(function (undo) {
          setButtonEnabled(undo, undoEnabled);
        });
        memRedo.getOpt(anyInSystem).each(function (redo) {
          setButtonEnabled(redo, redoEnabled);
        });
      };
      var memUndo = record(createButton('Undo', 'undo', true, function (button) {
        emitWith(button, internal.undo(), { direction: 1 });
      }, providersBackstage));
      var memRedo = record(createButton('Redo', 'redo', true, function (button) {
        emitWith(button, internal.redo(), { direction: 1 });
      }, providersBackstage));
      var container = Container.sketch({
        dom: {
          tag: 'div',
          classes: [
            'tox-image-tools__toolbar',
            'tox-image-tools__sidebar'
          ]
        },
        components: [
          memUndo.asSpec(),
          memRedo.asSpec(),
          createButton('Zoom in', 'zoom-in', false, function (button) {
            emitWith(button, internal.zoom(), { direction: 1 });
          }, providersBackstage),
          createButton('Zoom out', 'zoom-out', false, function (button) {
            emitWith(button, internal.zoom(), { direction: -1 });
          }, providersBackstage)
        ]
      });
      return {
        container: container,
        updateButtonUndoStates: updateButtonUndoStates
      };
    };

    function UndoStack () {
      var data = [];
      var index = -1;
      var add = function (state) {
        var removed = data.splice(++index);
        data.push(state);
        return {
          state: state,
          removed: removed
        };
      };
      var undo = function () {
        if (canUndo()) {
          return data[--index];
        }
      };
      var redo = function () {
        if (canRedo()) {
          return data[++index];
        }
      };
      var canUndo = function () {
        return index > 0;
      };
      var canRedo = function () {
        return index !== -1 && index < data.length - 1;
      };
      return {
        data: data,
        add: add,
        undo: undo,
        redo: redo,
        canUndo: canUndo,
        canRedo: canRedo
      };
    }

    var makeState = function (initialState) {
      var blobState = Cell(initialState);
      var tempState = Cell(Optional.none());
      var undoStack = UndoStack();
      undoStack.add(initialState);
      var getBlobState = function () {
        return blobState.get();
      };
      var setBlobState = function (state) {
        blobState.set(state);
      };
      var getTempState = function () {
        return tempState.get().fold(function () {
          return blobState.get();
        }, function (temp) {
          return temp;
        });
      };
      var updateTempState = function (blob) {
        var newTempState = createState(blob);
        destroyTempState();
        tempState.set(Optional.some(newTempState));
        return newTempState.url;
      };
      var createState = function (blob) {
        return {
          blob: blob,
          url: URL.createObjectURL(blob)
        };
      };
      var destroyState = function (state) {
        URL.revokeObjectURL(state.url);
      };
      var destroyStates = function (states) {
        global$c.each(states, destroyState);
      };
      var destroyTempState = function () {
        tempState.get().each(destroyState);
        tempState.set(Optional.none());
      };
      var addBlobState = function (blob) {
        var newState = createState(blob);
        setBlobState(newState);
        var removed = undoStack.add(newState).removed;
        destroyStates(removed);
        return newState.url;
      };
      var addTempState = function (blob) {
        var newState = createState(blob);
        tempState.set(Optional.some(newState));
        return newState.url;
      };
      var applyTempState = function (postApply) {
        return tempState.get().fold(noop, function (temp) {
          addBlobState(temp.blob);
          postApply();
        });
      };
      var undo = function () {
        var currentState = undoStack.undo();
        setBlobState(currentState);
        return currentState.url;
      };
      var redo = function () {
        var currentState = undoStack.redo();
        setBlobState(currentState);
        return currentState.url;
      };
      var getHistoryStates = function () {
        var undoEnabled = undoStack.canUndo();
        var redoEnabled = undoStack.canRedo();
        return {
          undoEnabled: undoEnabled,
          redoEnabled: redoEnabled
        };
      };
      return {
        getBlobState: getBlobState,
        setBlobState: setBlobState,
        addBlobState: addBlobState,
        getTempState: getTempState,
        updateTempState: updateTempState,
        addTempState: addTempState,
        applyTempState: applyTempState,
        destroyTempState: destroyTempState,
        undo: undo,
        redo: redo,
        getHistoryStates: getHistoryStates
      };
    };

    var renderImageTools = function (detail, providersBackstage) {
      var state = makeState(detail.currentState);
      var zoom = function (anyInSystem, simulatedEvent) {
        var direction = simulatedEvent.event.direction;
        imagePanel.zoom(anyInSystem, direction);
      };
      var updateButtonUndoStates = function (anyInSystem) {
        var historyStates = state.getHistoryStates();
        sideBar.updateButtonUndoStates(anyInSystem, historyStates.undoEnabled, historyStates.redoEnabled);
        emitWith(anyInSystem, external$2.formActionEvent, {
          name: external$2.saveState(),
          value: historyStates.undoEnabled
        });
      };
      var disableUndoRedo = function (anyInSystem) {
        sideBar.updateButtonUndoStates(anyInSystem, false, false);
      };
      var undo = function (anyInSystem, _simulatedEvent) {
        var url = state.undo();
        updateSrc(anyInSystem, url).then(function (_oImg) {
          unblock(anyInSystem);
          updateButtonUndoStates(anyInSystem);
        });
      };
      var redo = function (anyInSystem, _simulatedEvent) {
        var url = state.redo();
        updateSrc(anyInSystem, url).then(function (_oImg) {
          unblock(anyInSystem);
          updateButtonUndoStates(anyInSystem);
        });
      };
      var imageResultToBlob = function (ir) {
        return ir.toBlob();
      };
      var block = function (anyInSystem) {
        emitWith(anyInSystem, external$2.formActionEvent, {
          name: external$2.disable(),
          value: {}
        });
      };
      var unblock = function (anyInSystem) {
        editPanel.getApplyButton(anyInSystem).each(function (applyButton) {
          Disabling.enable(applyButton);
        });
        emitWith(anyInSystem, external$2.formActionEvent, {
          name: external$2.enable(),
          value: {}
        });
      };
      var updateSrc = function (anyInSystem, src) {
        block(anyInSystem);
        return imagePanel.updateSrc(anyInSystem, src);
      };
      var blobManipulate = function (anyInSystem, blob, filter, action, swap) {
        block(anyInSystem);
        return blobToImageResult(blob).then(filter).then(imageResultToBlob).then(action).then(function (url) {
          return updateSrc(anyInSystem, url).then(function (oImg) {
            updateButtonUndoStates(anyInSystem);
            swap();
            unblock(anyInSystem);
            return oImg;
          });
        }).catch(function (err) {
          console.log(err);
          unblock(anyInSystem);
          return err;
        });
      };
      var manipulate = function (anyInSystem, filter, swap) {
        var blob = state.getBlobState().blob;
        var action = function (blob) {
          return state.updateTempState(blob);
        };
        blobManipulate(anyInSystem, blob, filter, action, swap);
      };
      var tempManipulate = function (anyInSystem, filter) {
        var blob = state.getTempState().blob;
        var action = function (blob) {
          return state.addTempState(blob);
        };
        blobManipulate(anyInSystem, blob, filter, action, noop);
      };
      var manipulateApply = function (anyInSystem, filter, swap) {
        var blob = state.getBlobState().blob;
        var action = function (blob) {
          var url = state.addBlobState(blob);
          destroyTempState(anyInSystem);
          return url;
        };
        blobManipulate(anyInSystem, blob, filter, action, swap);
      };
      var apply = function (anyInSystem, simulatedEvent) {
        var postApply = function () {
          destroyTempState(anyInSystem);
          var swap = simulatedEvent.event.swap;
          swap();
        };
        state.applyTempState(postApply);
      };
      var destroyTempState = function (anyInSystem) {
        var currentUrl = state.getBlobState().url;
        state.destroyTempState();
        updateButtonUndoStates(anyInSystem);
        return currentUrl;
      };
      var cancel = function (anyInSystem) {
        var currentUrl = destroyTempState(anyInSystem);
        updateSrc(anyInSystem, currentUrl).then(function (_oImg) {
          unblock(anyInSystem);
        });
      };
      var back = function (anyInSystem, simulatedEvent) {
        cancel(anyInSystem);
        var swap = simulatedEvent.event.swap;
        swap();
        imagePanel.hideCrop();
      };
      var transform = function (anyInSystem, simulatedEvent) {
        return manipulate(anyInSystem, simulatedEvent.event.transform, noop);
      };
      var tempTransform = function (anyInSystem, simulatedEvent) {
        return tempManipulate(anyInSystem, simulatedEvent.event.transform);
      };
      var transformApply = function (anyInSystem, simulatedEvent) {
        return manipulateApply(anyInSystem, simulatedEvent.event.transform, simulatedEvent.event.swap);
      };
      var imagePanel = renderImagePanel(detail.currentState.url);
      var sideBar = renderSideBar(providersBackstage);
      var editPanel = renderEditPanel(imagePanel, providersBackstage);
      var swap = function (anyInSystem, simulatedEvent) {
        disableUndoRedo(anyInSystem);
        var transform = simulatedEvent.event.transform;
        var swap = simulatedEvent.event.swap;
        transform.fold(function () {
          swap();
        }, function (transform) {
          manipulate(anyInSystem, transform, swap);
        });
      };
      return {
        dom: {
          tag: 'div',
          attributes: { role: 'presentation' }
        },
        components: [
          editPanel.memContainer.asSpec(),
          imagePanel.memContainer.asSpec(),
          sideBar.container
        ],
        behaviours: derive$1([
          Representing.config({
            store: {
              mode: 'manual',
              getValue: function () {
                return state.getBlobState();
              }
            }
          }),
          config('image-tools-events', [
            run(internal.undo(), undo),
            run(internal.redo(), redo),
            run(internal.zoom(), zoom),
            run(internal.back(), back),
            run(internal.apply(), apply),
            run(internal.transform(), transform),
            run(internal.tempTransform(), tempTransform),
            run(internal.transformApply(), transformApply),
            run(internal.swap(), swap)
          ]),
          ComposingConfigs.self()
        ])
      };
    };

    var renderLabel$2 = function (spec, backstageShared) {
      var label = {
        dom: {
          tag: 'label',
          innerHtml: backstageShared.providers.translate(spec.label),
          classes: ['tox-label']
        }
      };
      var comps = map(spec.items, backstageShared.interpreter);
      return {
        dom: {
          tag: 'div',
          classes: ['tox-form__group']
        },
        components: [label].concat(comps),
        behaviours: derive$1([
          ComposingConfigs.self(),
          Replacing.config({}),
          RepresentingConfigs.domHtml(Optional.none()),
          Keying.config({ mode: 'acyclic' })
        ])
      };
    };

    var isSingleListItem = function (item) {
      return !has(item, 'items');
    };
    var dataAttribute = 'data-value';
    var fetchItems = function (dropdownComp, name, items, selectedValue) {
      return map(items, function (item) {
        if (!isSingleListItem(item)) {
          return {
            type: 'nestedmenuitem',
            text: item.text,
            getSubmenuItems: function () {
              return fetchItems(dropdownComp, name, item.items, selectedValue);
            }
          };
        } else {
          return {
            type: 'togglemenuitem',
            text: item.text,
            value: item.value,
            active: item.value === selectedValue,
            onAction: function () {
              Representing.setValue(dropdownComp, item.value);
              emitWith(dropdownComp, formChangeEvent, { name: name });
              Focusing.focus(dropdownComp);
            }
          };
        }
      });
    };
    var findItemByValue = function (items, value) {
      return findMap(items, function (item) {
        if (!isSingleListItem(item)) {
          return findItemByValue(item.items, value);
        } else {
          return someIf(item.value === value, item);
        }
      });
    };
    var renderListBox = function (spec, backstage) {
      var providersBackstage = backstage.shared.providers;
      var initialItem = head(spec.items).filter(isSingleListItem);
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var pField = FormField.parts.field({
        dom: {},
        factory: {
          sketch: function (sketchSpec) {
            return renderCommonDropdown({
              uid: sketchSpec.uid,
              text: initialItem.map(function (item) {
                return item.text;
              }),
              icon: Optional.none(),
              tooltip: spec.label,
              role: Optional.none(),
              fetch: function (comp, callback) {
                var items = fetchItems(comp, spec.name, spec.items, Representing.getValue(comp));
                callback(build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage, false));
              },
              onSetup: constant(noop),
              getApi: constant({}),
              columns: 1,
              presets: 'normal',
              classes: [],
              dropdownBehaviours: [
                Tabstopping.config({}),
                Representing.config({
                  store: {
                    mode: 'manual',
                    initialValue: initialItem.map(function (item) {
                      return item.value;
                    }).getOr(''),
                    getValue: function (comp) {
                      return get$3(comp.element, dataAttribute);
                    },
                    setValue: function (comp, data) {
                      findItemByValue(spec.items, data).each(function (item) {
                        set$1(comp.element, dataAttribute, item.value);
                        emitWith(comp, updateMenuText, { text: item.text });
                      });
                    }
                  }
                })
              ]
            }, 'tox-listbox', backstage.shared);
          }
        }
      });
      var listBoxWrap = {
        dom: {
          tag: 'div',
          classes: ['tox-listboxfield']
        },
        components: [pField]
      };
      return FormField.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-form__group']
        },
        components: flatten([
          pLabel.toArray(),
          [listBoxWrap]
        ]),
        fieldBehaviours: derive$1([Disabling.config({
            disabled: constant(spec.disabled),
            onDisabled: function (comp) {
              FormField.getField(comp).each(Disabling.disable);
            },
            onEnabled: function (comp) {
              FormField.getField(comp).each(Disabling.enable);
            }
          })])
      });
    };

    var renderPanel = function (spec, backstage) {
      return {
        dom: {
          tag: 'div',
          classes: spec.classes
        },
        components: map(spec.items, backstage.shared.interpreter)
      };
    };

    var factory$8 = function (detail, _spec) {
      var options = map(detail.options, function (option) {
        return {
          dom: {
            tag: 'option',
            value: option.value,
            innerHtml: option.text
          }
        };
      });
      var initialValues = detail.data.map(function (v) {
        return wrap$1('initialValue', v);
      }).getOr({});
      return {
        uid: detail.uid,
        dom: {
          tag: 'select',
          classes: detail.selectClasses,
          attributes: detail.selectAttributes
        },
        components: options,
        behaviours: augment(detail.selectBehaviours, [
          Focusing.config({}),
          Representing.config({
            store: __assign({
              mode: 'manual',
              getValue: function (select) {
                return get$6(select.element);
              },
              setValue: function (select, newValue) {
                var found = find(detail.options, function (opt) {
                  return opt.value === newValue;
                });
                if (found.isSome()) {
                  set$3(select.element, newValue);
                }
              }
            }, initialValues)
          })
        ])
      };
    };
    var HtmlSelect = single$2({
      name: 'HtmlSelect',
      configFields: [
        strict$1('options'),
        field$1('selectBehaviours', [
          Focusing,
          Representing
        ]),
        defaulted$1('selectClasses', []),
        defaulted$1('selectAttributes', {}),
        option('data')
      ],
      factory: factory$8
    });

    var renderSelectBox = function (spec, providersBackstage) {
      var translatedOptions = map(spec.items, function (item) {
        return {
          text: providersBackstage.translate(item.text),
          value: item.value
        };
      });
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var pField = FormField.parts.field({
        dom: {},
        selectAttributes: { size: spec.size },
        options: translatedOptions,
        factory: HtmlSelect,
        selectBehaviours: derive$1([
          Disabling.config({
            disabled: function () {
              return spec.disabled || providersBackstage.isDisabled();
            }
          }),
          Tabstopping.config({}),
          config('selectbox-change', [run(change(), function (component, _) {
              emitWith(component, formChangeEvent, { name: spec.name });
            })])
        ])
      });
      var chevron = spec.size > 1 ? Optional.none() : Optional.some({
        dom: {
          tag: 'div',
          classes: ['tox-selectfield__icon-js'],
          innerHtml: get$e('chevron-down', providersBackstage.icons)
        }
      });
      var selectWrap = {
        dom: {
          tag: 'div',
          classes: ['tox-selectfield']
        },
        components: flatten([
          [pField],
          chevron.toArray()
        ])
      };
      return FormField.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-form__group']
        },
        components: flatten([
          pLabel.toArray(),
          [selectWrap]
        ]),
        fieldBehaviours: derive$1([
          Disabling.config({
            disabled: function () {
              return spec.disabled || providersBackstage.isDisabled();
            },
            onDisabled: function (comp) {
              FormField.getField(comp).each(Disabling.disable);
            },
            onEnabled: function (comp) {
              FormField.getField(comp).each(Disabling.enable);
            }
          }),
          receivingConfig()
        ])
      });
    };

    var renderTable = function (spec, providersBackstage) {
      var renderTh = function (text) {
        return {
          dom: {
            tag: 'th',
            innerHtml: providersBackstage.translate(text)
          }
        };
      };
      var renderHeader = function (header) {
        return {
          dom: { tag: 'thead' },
          components: [{
              dom: { tag: 'tr' },
              components: map(header, renderTh)
            }]
        };
      };
      var renderTd = function (text) {
        return {
          dom: {
            tag: 'td',
            innerHtml: providersBackstage.translate(text)
          }
        };
      };
      var renderTr = function (row) {
        return {
          dom: { tag: 'tr' },
          components: map(row, renderTd)
        };
      };
      var renderRows = function (rows) {
        return {
          dom: { tag: 'tbody' },
          components: map(rows, renderTr)
        };
      };
      return {
        dom: {
          tag: 'table',
          classes: ['tox-dialog__table']
        },
        components: [
          renderHeader(spec.header),
          renderRows(spec.cells)
        ],
        behaviours: derive$1([
          Tabstopping.config({}),
          Focusing.config({})
        ])
      };
    };

    var renderTextField = function (spec, providersBackstage) {
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var baseInputBehaviours = [
        Disabling.config({
          disabled: function () {
            return spec.disabled || providersBackstage.isDisabled();
          }
        }),
        receivingConfig(),
        Keying.config({
          mode: 'execution',
          useEnter: spec.multiline !== true,
          useControlEnter: spec.multiline === true,
          execute: function (comp) {
            emit(comp, formSubmitEvent);
            return Optional.some(true);
          }
        }),
        config('textfield-change', [
          run(input(), function (component, _) {
            emitWith(component, formChangeEvent, { name: spec.name });
          }),
          run(postPaste(), function (component, _) {
            emitWith(component, formChangeEvent, { name: spec.name });
          })
        ]),
        Tabstopping.config({})
      ];
      var validatingBehaviours = spec.validation.map(function (vl) {
        return Invalidating.config({
          getRoot: function (input) {
            return parent(input.element);
          },
          invalidClass: 'tox-invalid',
          validator: {
            validate: function (input) {
              var v = Representing.getValue(input);
              var result = vl.validator(v);
              return Future.pure(result === true ? Result.value(v) : Result.error(result));
            },
            validateOnLoad: vl.validateOnLoad
          }
        });
      }).toArray();
      var placeholder = spec.placeholder.fold(constant({}), function (p) {
        return { placeholder: providersBackstage.translate(p) };
      });
      var inputMode = spec.inputMode.fold(constant({}), function (mode) {
        return { inputmode: mode };
      });
      var inputAttributes = __assign(__assign({}, placeholder), inputMode);
      var pField = FormField.parts.field({
        tag: spec.multiline === true ? 'textarea' : 'input',
        inputAttributes: inputAttributes,
        inputClasses: [spec.classname],
        inputBehaviours: derive$1(flatten([
          baseInputBehaviours,
          validatingBehaviours
        ])),
        selectOnFocus: false,
        factory: Input
      });
      var extraClasses = spec.flex ? ['tox-form__group--stretched'] : [];
      var extraClasses2 = extraClasses.concat(spec.maximized ? ['tox-form-group--maximize'] : []);
      var extraBehaviours = [
        Disabling.config({
          disabled: function () {
            return spec.disabled || providersBackstage.isDisabled();
          },
          onDisabled: function (comp) {
            FormField.getField(comp).each(Disabling.disable);
          },
          onEnabled: function (comp) {
            FormField.getField(comp).each(Disabling.enable);
          }
        }),
        receivingConfig()
      ];
      return renderFormFieldWith(pLabel, pField, extraClasses2, extraBehaviours);
    };
    var renderInput = function (spec, providersBackstage) {
      return renderTextField({
        name: spec.name,
        multiline: false,
        label: spec.label,
        inputMode: spec.inputMode,
        placeholder: spec.placeholder,
        flex: false,
        disabled: spec.disabled,
        classname: 'tox-textfield',
        validation: Optional.none(),
        maximized: spec.maximized
      }, providersBackstage);
    };
    var renderTextarea = function (spec, providersBackstage) {
      return renderTextField({
        name: spec.name,
        multiline: true,
        label: spec.label,
        inputMode: Optional.none(),
        placeholder: spec.placeholder,
        flex: true,
        disabled: spec.disabled,
        classname: 'tox-textarea',
        validation: Optional.none(),
        maximized: spec.maximized
      }, providersBackstage);
    };

    var events$c = function (streamConfig, streamState) {
      var streams = streamConfig.stream.streams;
      var processor = streams.setup(streamConfig, streamState);
      return derive([
        run(streamConfig.event, processor),
        runOnDetached(function () {
          return streamState.cancel();
        })
      ].concat(streamConfig.cancelEvent.map(function (e) {
        return [run(e, function () {
            return streamState.cancel();
          })];
      }).getOr([])));
    };

    var ActiveStreaming = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$c
    });

    var throttle = function (_config) {
      var state = Cell(null);
      var readState = function () {
        return { timer: state.get() !== null ? 'set' : 'unset' };
      };
      var setTimer = function (t) {
        state.set(t);
      };
      var cancel = function () {
        var t = state.get();
        if (t !== null) {
          t.cancel();
        }
      };
      return nu$5({
        readState: readState,
        setTimer: setTimer,
        cancel: cancel
      });
    };
    var init$6 = function (spec) {
      return spec.stream.streams.state(spec);
    };

    var StreamingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        throttle: throttle,
        init: init$6
    });

    var setup$2 = function (streamInfo, streamState) {
      var sInfo = streamInfo.stream;
      var throttler = last$2(streamInfo.onStream, sInfo.delay);
      streamState.setTimer(throttler);
      return function (component, simulatedEvent) {
        throttler.throttle(component, simulatedEvent);
        if (sInfo.stopEvent) {
          simulatedEvent.stop();
        }
      };
    };
    var StreamingSchema = [
      strictOf('stream', choose$1('mode', {
        throttle: [
          strict$1('delay'),
          defaulted$1('stopEvent', true),
          output('streams', {
            setup: setup$2,
            state: throttle
          })
        ]
      })),
      defaulted$1('event', 'input'),
      option('cancelEvent'),
      onStrictHandler('onStream')
    ];

    var Streaming = create$1({
      fields: StreamingSchema,
      name: 'streaming',
      active: ActiveStreaming,
      state: StreamingState
    });

    var setValueFromItem = function (model, input, item) {
      var itemData = Representing.getValue(item);
      Representing.setValue(input, itemData);
      setCursorAtEnd(input);
    };
    var setSelectionOn = function (input, f) {
      var el = input.element;
      var value = get$6(el);
      var node = el.dom;
      if (get$3(el, 'type') !== 'number') {
        f(node, value);
      }
    };
    var setCursorAtEnd = function (input) {
      setSelectionOn(input, function (node, value) {
        return node.setSelectionRange(value.length, value.length);
      });
    };
    var setSelectionToEnd = function (input, startOffset) {
      setSelectionOn(input, function (node, value) {
        return node.setSelectionRange(startOffset, value.length);
      });
    };
    var attemptSelectOver = function (model, input, item) {
      if (!model.selectsOver) {
        return Optional.none();
      } else {
        var currentValue = Representing.getValue(input);
        var inputDisplay_1 = model.getDisplayText(currentValue);
        var itemValue = Representing.getValue(item);
        var itemDisplay = model.getDisplayText(itemValue);
        return itemDisplay.indexOf(inputDisplay_1) === 0 ? Optional.some(function () {
          setValueFromItem(model, input, item);
          setSelectionToEnd(input, inputDisplay_1.length);
        }) : Optional.none();
      }
    };

    var itemExecute = constant('alloy.typeahead.itemexecute');

    var make$5 = function (detail, components, spec, externals) {
      var navigateList = function (comp, simulatedEvent, highlighter) {
        detail.previewing.set(false);
        var sandbox = Coupling.getCoupled(comp, 'sandbox');
        if (Sandboxing.isOpen(sandbox)) {
          Composing.getCurrent(sandbox).each(function (menu) {
            Highlighting.getHighlighted(menu).fold(function () {
              highlighter(menu);
            }, function () {
              dispatchEvent(sandbox, menu.element, 'keydown', simulatedEvent);
            });
          });
        } else {
          var onOpenSync = function (sandbox) {
            Composing.getCurrent(sandbox).each(highlighter);
          };
          open$1(detail, mapFetch(comp), comp, sandbox, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);
        }
      };
      var focusBehaviours$1 = focusBehaviours(detail);
      var mapFetch = function (comp) {
        return function (tdata) {
          return tdata.map(function (data) {
            var menus = values(data.menus);
            var items = bind(menus, function (menu) {
              return filter(menu.items, function (item) {
                return item.type === 'item';
              });
            });
            var repState = Representing.getState(comp);
            repState.update(map(items, function (item) {
              return item.data;
            }));
            return data;
          });
        };
      };
      var behaviours = [
        Focusing.config({}),
        Representing.config({
          onSetValue: detail.onSetValue,
          store: __assign({
            mode: 'dataset',
            getDataKey: function (comp) {
              return get$6(comp.element);
            },
            getFallbackEntry: function (itemString) {
              return {
                value: itemString,
                meta: {}
              };
            },
            setValue: function (comp, data) {
              set$3(comp.element, detail.model.getDisplayText(data));
            }
          }, detail.initialData.map(function (d) {
            return wrap$1('initialValue', d);
          }).getOr({}))
        }),
        Streaming.config({
          stream: {
            mode: 'throttle',
            delay: detail.responseTime,
            stopEvent: false
          },
          onStream: function (component, _simulatedEvent) {
            var sandbox = Coupling.getCoupled(component, 'sandbox');
            var focusInInput = Focusing.isFocused(component);
            if (focusInInput) {
              if (get$6(component.element).length >= detail.minChars) {
                var previousValue_1 = Composing.getCurrent(sandbox).bind(function (menu) {
                  return Highlighting.getHighlighted(menu).map(Representing.getValue);
                });
                detail.previewing.set(true);
                var onOpenSync = function (_sandbox) {
                  Composing.getCurrent(sandbox).each(function (menu) {
                    previousValue_1.fold(function () {
                      if (detail.model.selectsOver) {
                        Highlighting.highlightFirst(menu);
                      }
                    }, function (pv) {
                      Highlighting.highlightBy(menu, function (item) {
                        var itemData = Representing.getValue(item);
                        return itemData.value === pv.value;
                      });
                      Highlighting.getHighlighted(menu).orThunk(function () {
                        Highlighting.highlightFirst(menu);
                        return Optional.none();
                      });
                    });
                  });
                };
                open$1(detail, mapFetch(component), component, sandbox, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);
              }
            }
          },
          cancelEvent: typeaheadCancel()
        }),
        Keying.config({
          mode: 'special',
          onDown: function (comp, simulatedEvent) {
            navigateList(comp, simulatedEvent, Highlighting.highlightFirst);
            return Optional.some(true);
          },
          onEscape: function (comp) {
            var sandbox = Coupling.getCoupled(comp, 'sandbox');
            if (Sandboxing.isOpen(sandbox)) {
              Sandboxing.close(sandbox);
              return Optional.some(true);
            }
            return Optional.none();
          },
          onUp: function (comp, simulatedEvent) {
            navigateList(comp, simulatedEvent, Highlighting.highlightLast);
            return Optional.some(true);
          },
          onEnter: function (comp) {
            var sandbox = Coupling.getCoupled(comp, 'sandbox');
            var sandboxIsOpen = Sandboxing.isOpen(sandbox);
            if (sandboxIsOpen && !detail.previewing.get()) {
              return Composing.getCurrent(sandbox).bind(function (menu) {
                return Highlighting.getHighlighted(menu);
              }).map(function (item) {
                emitWith(comp, itemExecute(), { item: item });
                return true;
              });
            } else {
              var currentValue = Representing.getValue(comp);
              emit(comp, typeaheadCancel());
              detail.onExecute(sandbox, comp, currentValue);
              if (sandboxIsOpen) {
                Sandboxing.close(sandbox);
              }
              return Optional.some(true);
            }
          }
        }),
        Toggling.config({
          toggleClass: detail.markers.openClass,
          aria: { mode: 'expanded' }
        }),
        Coupling.config({
          others: {
            sandbox: function (hotspot) {
              return makeSandbox(detail, hotspot, {
                onOpen: function () {
                  return Toggling.on(hotspot);
                },
                onClose: function () {
                  return Toggling.off(hotspot);
                }
              });
            }
          }
        }),
        config('typeaheadevents', [
          runOnExecute(function (comp) {
            var onOpenSync = noop;
            togglePopup(detail, mapFetch(comp), comp, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);
          }),
          run(itemExecute(), function (comp, se) {
            var sandbox = Coupling.getCoupled(comp, 'sandbox');
            setValueFromItem(detail.model, comp, se.event.item);
            emit(comp, typeaheadCancel());
            detail.onItemExecute(comp, sandbox, se.event.item, Representing.getValue(comp));
            Sandboxing.close(sandbox);
            setCursorAtEnd(comp);
          })
        ].concat(detail.dismissOnBlur ? [run(postBlur(), function (typeahead) {
            var sandbox = Coupling.getCoupled(typeahead, 'sandbox');
            if (search(sandbox.element).isNone()) {
              Sandboxing.close(sandbox);
            }
          })] : []))
      ];
      return {
        uid: detail.uid,
        dom: dom$2(deepMerge(detail, {
          inputAttributes: {
            'role': 'combobox',
            'aria-autocomplete': 'list',
            'aria-haspopup': 'true'
          }
        })),
        behaviours: __assign(__assign({}, focusBehaviours$1), augment(detail.typeaheadBehaviours, behaviours)),
        eventOrder: detail.eventOrder
      };
    };

    var schema$j = constant([
      option('lazySink'),
      strict$1('fetch'),
      defaulted$1('minChars', 5),
      defaulted$1('responseTime', 1000),
      onHandler('onOpen'),
      defaulted$1('getHotspot', Optional.some),
      defaulted$1('getAnchorOverrides', constant({})),
      defaulted$1('layouts', Optional.none()),
      defaulted$1('eventOrder', {}),
      defaultedObjOf('model', {}, [
        defaulted$1('getDisplayText', function (itemData) {
          return itemData.meta !== undefined && itemData.meta.text !== undefined ? itemData.meta.text : itemData.value;
        }),
        defaulted$1('selectsOver', true),
        defaulted$1('populateFromBrowse', true)
      ]),
      onHandler('onSetValue'),
      onKeyboardHandler('onExecute'),
      onHandler('onItemExecute'),
      defaulted$1('inputClasses', []),
      defaulted$1('inputAttributes', {}),
      defaulted$1('inputStyles', {}),
      defaulted$1('matchWidth', true),
      defaulted$1('useMinWidth', false),
      defaulted$1('dismissOnBlur', true),
      markers(['openClass']),
      option('initialData'),
      field$1('typeaheadBehaviours', [
        Focusing,
        Representing,
        Streaming,
        Keying,
        Toggling,
        Coupling
      ]),
      state$1('previewing', function () {
        return Cell(true);
      })
    ].concat(schema$f()).concat(sandboxFields()));
    var parts$6 = constant([external$1({
        schema: [tieredMenuMarkers()],
        name: 'menu',
        overrides: function (detail) {
          return {
            fakeFocus: true,
            onHighlight: function (menu, item) {
              if (!detail.previewing.get()) {
                menu.getSystem().getByUid(detail.uid).each(function (input) {
                  if (detail.model.populateFromBrowse) {
                    setValueFromItem(detail.model, input, item);
                  }
                });
              } else {
                menu.getSystem().getByUid(detail.uid).each(function (input) {
                  attemptSelectOver(detail.model, input, item).fold(function () {
                    return Highlighting.dehighlight(menu, item);
                  }, function (fn) {
                    return fn();
                  });
                });
              }
              detail.previewing.set(false);
            },
            onExecute: function (menu, item) {
              return menu.getSystem().getByUid(detail.uid).toOptional().map(function (typeahead) {
                emitWith(typeahead, itemExecute(), { item: item });
                return true;
              });
            },
            onHover: function (menu, item) {
              detail.previewing.set(false);
              menu.getSystem().getByUid(detail.uid).each(function (input) {
                if (detail.model.populateFromBrowse) {
                  setValueFromItem(detail.model, input, item);
                }
              });
            }
          };
        }
      })]);

    var Typeahead = composite$1({
      name: 'Typeahead',
      configFields: schema$j(),
      partFields: parts$6(),
      factory: make$5
    });

    var wrap$2 = function (delegate) {
      var toCached = function () {
        return wrap$2(delegate.toCached());
      };
      var bindFuture = function (f) {
        return wrap$2(delegate.bind(function (resA) {
          return resA.fold(function (err) {
            return Future.pure(Result.error(err));
          }, function (a) {
            return f(a);
          });
        }));
      };
      var bindResult = function (f) {
        return wrap$2(delegate.map(function (resA) {
          return resA.bind(f);
        }));
      };
      var mapResult = function (f) {
        return wrap$2(delegate.map(function (resA) {
          return resA.map(f);
        }));
      };
      var mapError = function (f) {
        return wrap$2(delegate.map(function (resA) {
          return resA.mapError(f);
        }));
      };
      var foldResult = function (whenError, whenValue) {
        return delegate.map(function (res) {
          return res.fold(whenError, whenValue);
        });
      };
      var withTimeout = function (timeout, errorThunk) {
        return wrap$2(Future.nu(function (callback) {
          var timedOut = false;
          var timer = setTimeout(function () {
            timedOut = true;
            callback(Result.error(errorThunk()));
          }, timeout);
          delegate.get(function (result) {
            if (!timedOut) {
              clearTimeout(timer);
              callback(result);
            }
          });
        }));
      };
      return __assign(__assign({}, delegate), {
        toCached: toCached,
        bindFuture: bindFuture,
        bindResult: bindResult,
        mapResult: mapResult,
        mapError: mapError,
        foldResult: foldResult,
        withTimeout: withTimeout
      });
    };
    var nu$c = function (worker) {
      return wrap$2(Future.nu(worker));
    };
    var value$2 = function (value) {
      return wrap$2(Future.pure(Result.value(value)));
    };
    var error$1 = function (error) {
      return wrap$2(Future.pure(Result.error(error)));
    };
    var fromResult$1 = function (result) {
      return wrap$2(Future.pure(result));
    };
    var fromFuture = function (future) {
      return wrap$2(future.map(Result.value));
    };
    var fromPromise = function (promise) {
      return nu$c(function (completer) {
        promise.then(function (value) {
          completer(Result.value(value));
        }, function (error) {
          completer(Result.error(error));
        });
      });
    };
    var FutureResult = {
      nu: nu$c,
      wrap: wrap$2,
      pure: value$2,
      value: value$2,
      error: error$1,
      fromResult: fromResult$1,
      fromFuture: fromFuture,
      fromPromise: fromPromise
    };

    var separator$2 = { type: 'separator' };
    var toMenuItem = function (target) {
      return {
        type: 'menuitem',
        value: target.url,
        text: target.title,
        meta: { attach: target.attach },
        onAction: noop
      };
    };
    var staticMenuItem = function (title, url) {
      return {
        type: 'menuitem',
        value: url,
        text: title,
        meta: { attach: undefined },
        onAction: noop
      };
    };
    var toMenuItems = function (targets) {
      return map(targets, toMenuItem);
    };
    var filterLinkTargets = function (type, targets) {
      return filter(targets, function (target) {
        return target.type === type;
      });
    };
    var filteredTargets = function (type, targets) {
      return toMenuItems(filterLinkTargets(type, targets));
    };
    var headerTargets = function (linkInfo) {
      return filteredTargets('header', linkInfo.targets);
    };
    var anchorTargets = function (linkInfo) {
      return filteredTargets('anchor', linkInfo.targets);
    };
    var anchorTargetTop = function (linkInfo) {
      return Optional.from(linkInfo.anchorTop).map(function (url) {
        return staticMenuItem('<top>', url);
      }).toArray();
    };
    var anchorTargetBottom = function (linkInfo) {
      return Optional.from(linkInfo.anchorBottom).map(function (url) {
        return staticMenuItem('<bottom>', url);
      }).toArray();
    };
    var historyTargets = function (history) {
      return map(history, function (url) {
        return staticMenuItem(url, url);
      });
    };
    var joinMenuLists = function (items) {
      return foldl(items, function (a, b) {
        var bothEmpty = a.length === 0 || b.length === 0;
        return bothEmpty ? a.concat(b) : a.concat(separator$2, b);
      }, []);
    };
    var filterByQuery = function (term, menuItems) {
      var lowerCaseTerm = term.toLowerCase();
      return filter(menuItems, function (item) {
        var text = item.meta !== undefined && item.meta.text !== undefined ? item.meta.text : item.text;
        return contains$1(text.toLowerCase(), lowerCaseTerm) || contains$1(item.value.toLowerCase(), lowerCaseTerm);
      });
    };

    var getItems = function (fileType, input, urlBackstage) {
      var urlInputValue = Representing.getValue(input);
      var term = urlInputValue.meta.text !== undefined ? urlInputValue.meta.text : urlInputValue.value;
      var info = urlBackstage.getLinkInformation();
      return info.fold(function () {
        return [];
      }, function (linkInfo) {
        var history = filterByQuery(term, historyTargets(urlBackstage.getHistory(fileType)));
        return fileType === 'file' ? joinMenuLists([
          history,
          filterByQuery(term, headerTargets(linkInfo)),
          filterByQuery(term, flatten([
            anchorTargetTop(linkInfo),
            anchorTargets(linkInfo),
            anchorTargetBottom(linkInfo)
          ]))
        ]) : history;
      });
    };
    var errorId = generate$1('aria-invalid');
    var renderUrlInput = function (spec, backstage, urlBackstage) {
      var _a;
      var providersBackstage = backstage.shared.providers;
      var updateHistory = function (component) {
        var urlEntry = Representing.getValue(component);
        urlBackstage.addToHistory(urlEntry.value, spec.filetype);
      };
      var pField = FormField.parts.field({
        factory: Typeahead,
        dismissOnBlur: true,
        inputClasses: ['tox-textfield'],
        sandboxClasses: ['tox-dialog__popups'],
        inputAttributes: {
          'aria-errormessage': errorId,
          'type': 'url'
        },
        minChars: 0,
        responseTime: 0,
        fetch: function (input) {
          var items = getItems(spec.filetype, input, urlBackstage);
          var tdata = build$2(items, ItemResponse$1.BUBBLE_TO_SANDBOX, backstage, false);
          return Future.pure(tdata);
        },
        getHotspot: function (comp) {
          return memUrlBox.getOpt(comp);
        },
        onSetValue: function (comp, _newValue) {
          if (comp.hasConfigured(Invalidating)) {
            Invalidating.run(comp).get(noop);
          }
        },
        typeaheadBehaviours: derive$1(flatten([
          urlBackstage.getValidationHandler().map(function (handler) {
            return Invalidating.config({
              getRoot: function (comp) {
                return parent(comp.element);
              },
              invalidClass: 'tox-control-wrap--status-invalid',
              notify: {
                onInvalid: function (comp, err) {
                  memInvalidIcon.getOpt(comp).each(function (invalidComp) {
                    set$1(invalidComp.element, 'title', providersBackstage.translate(err));
                  });
                }
              },
              validator: {
                validate: function (input) {
                  var urlEntry = Representing.getValue(input);
                  return FutureResult.nu(function (completer) {
                    handler({
                      type: spec.filetype,
                      url: urlEntry.value
                    }, function (validation) {
                      if (validation.status === 'invalid') {
                        var err = Result.error(validation.message);
                        completer(err);
                      } else {
                        var val = Result.value(validation.message);
                        completer(val);
                      }
                    });
                  });
                },
                validateOnLoad: false
              }
            });
          }).toArray(),
          [
            Disabling.config({
              disabled: function () {
                return spec.disabled || providersBackstage.isDisabled();
              }
            }),
            Tabstopping.config({}),
            config('urlinput-events', flatten([
              spec.filetype === 'file' ? [run(input(), function (comp) {
                  emitWith(comp, formChangeEvent, { name: spec.name });
                })] : [],
              [
                run(change(), function (comp) {
                  emitWith(comp, formChangeEvent, { name: spec.name });
                  updateHistory(comp);
                }),
                run(postPaste(), function (comp) {
                  emitWith(comp, formChangeEvent, { name: spec.name });
                  updateHistory(comp);
                })
              ]
            ]))
          ]
        ])),
        eventOrder: (_a = {}, _a[input()] = [
          'streaming',
          'urlinput-events',
          'invalidating'
        ], _a),
        model: {
          getDisplayText: function (itemData) {
            return itemData.value;
          },
          selectsOver: false,
          populateFromBrowse: false
        },
        markers: { openClass: 'tox-textfield--popup-open' },
        lazySink: backstage.shared.getSink,
        parts: { menu: part(false, 1, 'normal') },
        onExecute: function (_menu, component, _entry) {
          emitWith(component, formSubmitEvent, {});
        },
        onItemExecute: function (typeahead, _sandbox, _item, _value) {
          updateHistory(typeahead);
          emitWith(typeahead, formChangeEvent, { name: spec.name });
        }
      });
      var pLabel = spec.label.map(function (label) {
        return renderLabel(label, providersBackstage);
      });
      var makeIcon = function (name, errId, icon, label) {
        if (icon === void 0) {
          icon = name;
        }
        if (label === void 0) {
          label = name;
        }
        return {
          dom: {
            tag: 'div',
            classes: [
              'tox-icon',
              'tox-control-wrap__status-icon-' + name
            ],
            innerHtml: get$e(icon, providersBackstage.icons),
            attributes: __assign({
              'title': providersBackstage.translate(label),
              'aria-live': 'polite'
            }, errId.fold(function () {
              return {};
            }, function (id) {
              return { id: id };
            }))
          }
        };
      };
      var memInvalidIcon = record(makeIcon('invalid', Optional.some(errorId), 'warning'));
      var memStatus = record({
        dom: {
          tag: 'div',
          classes: ['tox-control-wrap__status-icon-wrap']
        },
        components: [memInvalidIcon.asSpec()]
      });
      var optUrlPicker = urlBackstage.getUrlPicker(spec.filetype);
      var browseUrlEvent = generate$1('browser.url.event');
      var memUrlBox = record({
        dom: {
          tag: 'div',
          classes: ['tox-control-wrap']
        },
        components: [
          pField,
          memStatus.asSpec()
        ],
        behaviours: derive$1([Disabling.config({
            disabled: function () {
              return spec.disabled || providersBackstage.isDisabled();
            }
          })])
      });
      var memUrlPickerButton = record(renderButton({
        name: spec.name,
        icon: Optional.some('browse'),
        text: spec.label.getOr(''),
        disabled: spec.disabled,
        primary: false,
        borderless: true
      }, function (component) {
        return emit(component, browseUrlEvent);
      }, providersBackstage, [], ['tox-browse-url']));
      var controlHWrapper = function () {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-form__controls-h-stack']
          },
          components: flatten([
            [memUrlBox.asSpec()],
            optUrlPicker.map(function () {
              return memUrlPickerButton.asSpec();
            }).toArray()
          ])
        };
      };
      var openUrlPicker = function (comp) {
        Composing.getCurrent(comp).each(function (field) {
          var componentData = Representing.getValue(field);
          var urlData = __assign({ fieldname: spec.name }, componentData);
          optUrlPicker.each(function (picker) {
            picker(urlData).get(function (chosenData) {
              Representing.setValue(field, chosenData);
              emitWith(comp, formChangeEvent, { name: spec.name });
            });
          });
        });
      };
      return FormField.sketch({
        dom: renderFormFieldDom(),
        components: pLabel.toArray().concat([controlHWrapper()]),
        fieldBehaviours: derive$1([
          Disabling.config({
            disabled: function () {
              return spec.disabled || providersBackstage.isDisabled();
            },
            onDisabled: function (comp) {
              FormField.getField(comp).each(Disabling.disable);
              memUrlPickerButton.getOpt(comp).each(Disabling.disable);
            },
            onEnabled: function (comp) {
              FormField.getField(comp).each(Disabling.enable);
              memUrlPickerButton.getOpt(comp).each(Disabling.enable);
            }
          }),
          receivingConfig(),
          config('url-input-events', [run(browseUrlEvent, openUrlPicker)])
        ])
      });
    };

    var renderAlertBanner = function (spec, providersBackstage) {
      return Container.sketch({
        dom: {
          tag: 'div',
          attributes: { role: 'alert' },
          classes: [
            'tox-notification',
            'tox-notification--in',
            'tox-notification--' + spec.level
          ]
        },
        components: [
          {
            dom: {
              tag: 'div',
              classes: ['tox-notification__icon']
            },
            components: [Button.sketch({
                dom: {
                  tag: 'button',
                  classes: [
                    'tox-button',
                    'tox-button--naked',
                    'tox-button--icon'
                  ],
                  innerHtml: get$e(spec.icon, providersBackstage.icons),
                  attributes: { title: providersBackstage.translate(spec.iconTooltip) }
                },
                action: function (comp) {
                  emitWith(comp, formActionEvent, {
                    name: 'alert-banner',
                    value: spec.url
                  });
                }
              })]
          },
          {
            dom: {
              tag: 'div',
              classes: ['tox-notification__body'],
              innerHtml: providersBackstage.translate(spec.text)
            }
          }
        ]
      });
    };

    var renderCheckbox = function (spec, providerBackstage) {
      var repBehaviour = Representing.config({
        store: {
          mode: 'manual',
          getValue: function (comp) {
            var el = comp.element.dom;
            return el.checked;
          },
          setValue: function (comp, value) {
            var el = comp.element.dom;
            el.checked = value;
          }
        }
      });
      var toggleCheckboxHandler = function (comp) {
        comp.element.dom.click();
        return Optional.some(true);
      };
      var pField = FormField.parts.field({
        factory: { sketch: identity },
        dom: {
          tag: 'input',
          classes: ['tox-checkbox__input'],
          attributes: { type: 'checkbox' }
        },
        behaviours: derive$1([
          ComposingConfigs.self(),
          Disabling.config({
            disabled: function () {
              return spec.disabled || providerBackstage.isDisabled();
            }
          }),
          Tabstopping.config({}),
          Focusing.config({}),
          repBehaviour,
          Keying.config({
            mode: 'special',
            onEnter: toggleCheckboxHandler,
            onSpace: toggleCheckboxHandler,
            stopSpaceKeyup: true
          }),
          config('checkbox-events', [run(change(), function (component, _) {
              emitWith(component, formChangeEvent, { name: spec.name });
            })])
        ])
      });
      var pLabel = FormField.parts.label({
        dom: {
          tag: 'span',
          classes: ['tox-checkbox__label'],
          innerHtml: providerBackstage.translate(spec.label)
        },
        behaviours: derive$1([Unselecting.config({})])
      });
      var makeIcon = function (className) {
        var iconName = className === 'checked' ? 'selected' : 'unselected';
        return {
          dom: {
            tag: 'span',
            classes: [
              'tox-icon',
              'tox-checkbox-icon__' + className
            ],
            innerHtml: get$e(iconName, providerBackstage.icons)
          }
        };
      };
      var memIcons = record({
        dom: {
          tag: 'div',
          classes: ['tox-checkbox__icons']
        },
        components: [
          makeIcon('checked'),
          makeIcon('unchecked')
        ]
      });
      return FormField.sketch({
        dom: {
          tag: 'label',
          classes: ['tox-checkbox']
        },
        components: [
          pField,
          memIcons.asSpec(),
          pLabel
        ],
        fieldBehaviours: derive$1([
          Disabling.config({
            disabled: function () {
              return spec.disabled || providerBackstage.isDisabled();
            },
            disableClass: 'tox-checkbox--disabled',
            onDisabled: function (comp) {
              FormField.getField(comp).each(Disabling.disable);
            },
            onEnabled: function (comp) {
              FormField.getField(comp).each(Disabling.enable);
            }
          }),
          receivingConfig()
        ])
      });
    };

    var renderHtmlPanel = function (spec) {
      if (spec.presets === 'presentation') {
        return Container.sketch({
          dom: {
            tag: 'div',
            classes: ['tox-form__group'],
            innerHtml: spec.html
          }
        });
      } else {
        return Container.sketch({
          dom: {
            tag: 'div',
            classes: ['tox-form__group'],
            innerHtml: spec.html,
            attributes: { role: 'document' }
          },
          containerBehaviours: derive$1([
            Tabstopping.config({}),
            Focusing.config({})
          ])
        });
      }
    };

    var make$6 = function (render) {
      return function (parts, spec, backstage) {
        return get$1(spec, 'name').fold(function () {
          return render(spec, backstage);
        }, function (fieldName) {
          return parts.field(fieldName, render(spec, backstage));
        });
      };
    };
    var makeIframe = function (render) {
      return function (parts, spec, backstage) {
        var iframeSpec = deepMerge(spec, { source: 'dynamic' });
        return make$6(render)(parts, iframeSpec, backstage);
      };
    };
    var factories = {
      bar: make$6(function (spec, backstage) {
        return renderBar(spec, backstage.shared);
      }),
      collection: make$6(function (spec, backstage) {
        return renderCollection(spec, backstage.shared.providers);
      }),
      alertbanner: make$6(function (spec, backstage) {
        return renderAlertBanner(spec, backstage.shared.providers);
      }),
      input: make$6(function (spec, backstage) {
        return renderInput(spec, backstage.shared.providers);
      }),
      textarea: make$6(function (spec, backstage) {
        return renderTextarea(spec, backstage.shared.providers);
      }),
      label: make$6(function (spec, backstage) {
        return renderLabel$2(spec, backstage.shared);
      }),
      iframe: makeIframe(function (spec, backstage) {
        return renderIFrame(spec, backstage.shared.providers);
      }),
      button: make$6(function (spec, backstage) {
        return renderDialogButton(spec, backstage.shared.providers);
      }),
      checkbox: make$6(function (spec, backstage) {
        return renderCheckbox(spec, backstage.shared.providers);
      }),
      colorinput: make$6(function (spec, backstage) {
        return renderColorInput(spec, backstage.shared, backstage.colorinput);
      }),
      colorpicker: make$6(renderColorPicker),
      dropzone: make$6(function (spec, backstage) {
        return renderDropZone(spec, backstage.shared.providers);
      }),
      grid: make$6(function (spec, backstage) {
        return renderGrid(spec, backstage.shared);
      }),
      listbox: make$6(function (spec, backstage) {
        return renderListBox(spec, backstage);
      }),
      selectbox: make$6(function (spec, backstage) {
        return renderSelectBox(spec, backstage.shared.providers);
      }),
      sizeinput: make$6(function (spec, backstage) {
        return renderSizeInput(spec, backstage.shared.providers);
      }),
      urlinput: make$6(function (spec, backstage) {
        return renderUrlInput(spec, backstage, backstage.urlinput);
      }),
      customeditor: make$6(renderCustomEditor),
      htmlpanel: make$6(renderHtmlPanel),
      imagetools: make$6(function (spec, backstage) {
        return renderImageTools(spec, backstage.shared.providers);
      }),
      table: make$6(function (spec, backstage) {
        return renderTable(spec, backstage.shared.providers);
      }),
      panel: make$6(function (spec, backstage) {
        return renderPanel(spec, backstage);
      })
    };
    var noFormParts = {
      field: function (_name, spec) {
        return spec;
      }
    };
    var interpretInForm = function (parts, spec, oldBackstage) {
      var newBackstage = deepMerge(oldBackstage, {
        shared: {
          interpreter: function (childSpec) {
            return interpretParts(parts, childSpec, newBackstage);
          }
        }
      });
      return interpretParts(parts, spec, newBackstage);
    };
    var interpretParts = function (parts, spec, backstage) {
      return get$1(factories, spec.type).fold(function () {
        console.error('Unknown factory type "' + spec.type + '", defaulting to container: ', spec);
        return spec;
      }, function (factory) {
        return factory(parts, spec, backstage);
      });
    };
    var interpretWithoutForm = function (spec, backstage) {
      var parts = noFormParts;
      return interpretParts(parts, spec, backstage);
    };

    var bubbleAlignments = {
      valignCentre: [],
      alignCentre: [],
      alignLeft: [],
      alignRight: [],
      right: [],
      left: [],
      bottom: [],
      top: []
    };
    var getInlineDialogAnchor = function (contentAreaElement, lazyAnchorbar, lazyUseEditableAreaAnchor) {
      var bubble = nu$8(-12, 12, bubbleAlignments);
      var overrides = { maxHeightFunction: expandable() };
      var editableAreaAnchor = function () {
        return {
          anchor: 'node',
          root: getContentContainer(contentAreaElement()),
          node: Optional.from(contentAreaElement()),
          bubble: bubble,
          layouts: {
            onRtl: function () {
              return [northwest$3];
            },
            onLtr: function () {
              return [northeast$3];
            }
          },
          overrides: overrides
        };
      };
      var standardAnchor = function () {
        return {
          anchor: 'hotspot',
          hotspot: lazyAnchorbar(),
          bubble: bubble,
          layouts: {
            onRtl: function () {
              return [southeast$1];
            },
            onLtr: function () {
              return [southwest$1];
            }
          },
          overrides: overrides
        };
      };
      return function () {
        return lazyUseEditableAreaAnchor() ? editableAreaAnchor() : standardAnchor();
      };
    };
    var getBannerAnchor = function (contentAreaElement, lazyAnchorbar, lazyUseEditableAreaAnchor) {
      var editableAreaAnchor = function () {
        return {
          anchor: 'node',
          root: getContentContainer(contentAreaElement()),
          node: Optional.from(contentAreaElement()),
          layouts: {
            onRtl: function () {
              return [north$3];
            },
            onLtr: function () {
              return [north$3];
            }
          }
        };
      };
      var standardAnchor = function () {
        return {
          anchor: 'hotspot',
          hotspot: lazyAnchorbar(),
          layouts: {
            onRtl: function () {
              return [south$1];
            },
            onLtr: function () {
              return [south$1];
            }
          }
        };
      };
      return function () {
        return lazyUseEditableAreaAnchor() ? editableAreaAnchor() : standardAnchor();
      };
    };
    var getCursorAnchor = function (editor, bodyElement) {
      return function () {
        return {
          anchor: 'selection',
          root: bodyElement(),
          getSelection: function () {
            var rng = editor.selection.getRng();
            return Optional.some(SimSelection.range(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset));
          }
        };
      };
    };
    var getNodeAnchor = function (bodyElement) {
      return function (element) {
        return {
          anchor: 'node',
          root: bodyElement(),
          node: element
        };
      };
    };
    var getAnchors = function (editor, lazyAnchorbar, isToolbarTop) {
      var useFixedToolbarContainer = useFixedContainer(editor);
      var bodyElement = function () {
        return SugarElement.fromDom(editor.getBody());
      };
      var contentAreaElement = function () {
        return SugarElement.fromDom(editor.getContentAreaContainer());
      };
      var lazyUseEditableAreaAnchor = function () {
        return useFixedToolbarContainer || !isToolbarTop();
      };
      return {
        inlineDialog: getInlineDialogAnchor(contentAreaElement, lazyAnchorbar, lazyUseEditableAreaAnchor),
        banner: getBannerAnchor(contentAreaElement, lazyAnchorbar, lazyUseEditableAreaAnchor),
        cursor: getCursorAnchor(editor, bodyElement),
        node: getNodeAnchor(bodyElement)
      };
    };

    var colorPicker = function (editor) {
      return function (callback, value) {
        var dialog = colorPickerDialog(editor);
        dialog(callback, value);
      };
    };
    var hasCustomColors$1 = function (editor) {
      return function () {
        return hasCustomColors(editor);
      };
    };
    var getColors$2 = function (editor) {
      return function () {
        return getColors(editor);
      };
    };
    var getColorCols$2 = function (editor) {
      return function () {
        return getColorCols$1(editor);
      };
    };
    var ColorInputBackstage = function (editor) {
      return {
        colorPicker: colorPicker(editor),
        hasCustomColors: hasCustomColors$1(editor),
        getColors: getColors$2(editor),
        getColorCols: getColorCols$2(editor)
      };
    };

    var isDraggableModal$1 = function (editor) {
      return function () {
        return isDraggableModal(editor);
      };
    };
    var DialogBackstage = function (editor) {
      return { isDraggableModal: isDraggableModal$1(editor) };
    };

    var HeaderBackstage = function (editor) {
      var mode = Cell(isToolbarLocationBottom(editor) ? 'bottom' : 'top');
      return {
        isPositionedAtTop: function () {
          return mode.get() === 'top';
        },
        getDockingMode: mode.get,
        setDockingMode: mode.set
      };
    };

    var defaultStyleFormats = [
      {
        title: 'Headings',
        items: [
          {
            title: 'Heading 1',
            format: 'h1'
          },
          {
            title: 'Heading 2',
            format: 'h2'
          },
          {
            title: 'Heading 3',
            format: 'h3'
          },
          {
            title: 'Heading 4',
            format: 'h4'
          },
          {
            title: 'Heading 5',
            format: 'h5'
          },
          {
            title: 'Heading 6',
            format: 'h6'
          }
        ]
      },
      {
        title: 'Inline',
        items: [
          {
            title: 'Bold',
            format: 'bold'
          },
          {
            title: 'Italic',
            format: 'italic'
          },
          {
            title: 'Underline',
            format: 'underline'
          },
          {
            title: 'Strikethrough',
            format: 'strikethrough'
          },
          {
            title: 'Superscript',
            format: 'superscript'
          },
          {
            title: 'Subscript',
            format: 'subscript'
          },
          {
            title: 'Code',
            format: 'code'
          }
        ]
      },
      {
        title: 'Blocks',
        items: [
          {
            title: 'Paragraph',
            format: 'p'
          },
          {
            title: 'Blockquote',
            format: 'blockquote'
          },
          {
            title: 'Div',
            format: 'div'
          },
          {
            title: 'Pre',
            format: 'pre'
          }
        ]
      },
      {
        title: 'Align',
        items: [
          {
            title: 'Left',
            format: 'alignleft'
          },
          {
            title: 'Center',
            format: 'aligncenter'
          },
          {
            title: 'Right',
            format: 'alignright'
          },
          {
            title: 'Justify',
            format: 'alignjustify'
          }
        ]
      }
    ];
    var isNestedFormat = function (format) {
      return has(format, 'items');
    };
    var isBlockFormat = function (format) {
      return has(format, 'block');
    };
    var isInlineFormat = function (format) {
      return has(format, 'inline');
    };
    var isSelectorFormat = function (format) {
      return has(format, 'selector');
    };
    var mapFormats = function (userFormats) {
      return foldl(userFormats, function (acc, fmt) {
        if (isNestedFormat(fmt)) {
          var result = mapFormats(fmt.items);
          return {
            customFormats: acc.customFormats.concat(result.customFormats),
            formats: acc.formats.concat([{
                title: fmt.title,
                items: result.formats
              }])
          };
        } else if (isInlineFormat(fmt) || isBlockFormat(fmt) || isSelectorFormat(fmt)) {
          var formatName = isString(fmt.name) ? fmt.name : fmt.title.toLowerCase();
          var formatNameWithPrefix = 'custom-' + formatName;
          return {
            customFormats: acc.customFormats.concat([{
                name: formatNameWithPrefix,
                format: fmt
              }]),
            formats: acc.formats.concat([{
                title: fmt.title,
                format: formatNameWithPrefix,
                icon: fmt.icon
              }])
          };
        } else {
          return __assign(__assign({}, acc), { formats: acc.formats.concat(fmt) });
        }
      }, {
        customFormats: [],
        formats: []
      });
    };
    var registerCustomFormats = function (editor, userFormats) {
      var result = mapFormats(userFormats);
      var registerFormats = function (customFormats) {
        each(customFormats, function (fmt) {
          if (!editor.formatter.has(fmt.name)) {
            editor.formatter.register(fmt.name, fmt.format);
          }
        });
      };
      if (editor.formatter) {
        registerFormats(result.customFormats);
      } else {
        editor.on('init', function () {
          registerFormats(result.customFormats);
        });
      }
      return result.formats;
    };
    var getStyleFormats = function (editor) {
      return getUserStyleFormats(editor).map(function (userFormats) {
        var registeredUserFormats = registerCustomFormats(editor, userFormats);
        return isMergeStyleFormats(editor) ? defaultStyleFormats.concat(registeredUserFormats) : registeredUserFormats;
      }).getOr(defaultStyleFormats);
    };

    var processBasic = function (item, isSelectedFor, getPreviewFor) {
      var formatterSpec = {
        type: 'formatter',
        isSelected: isSelectedFor(item.format),
        getStylePreview: getPreviewFor(item.format)
      };
      return deepMerge(item, formatterSpec);
    };
    var register$3 = function (editor, formats, isSelectedFor, getPreviewFor) {
      var enrichSupported = function (item) {
        return processBasic(item, isSelectedFor, getPreviewFor);
      };
      var enrichMenu = function (item) {
        var submenuSpec = { type: 'submenu' };
        return deepMerge(item, submenuSpec);
      };
      var enrichCustom = function (item) {
        var formatName = isString(item.name) ? item.name : generate$1(item.title);
        var formatNameWithPrefix = 'custom-' + formatName;
        var customSpec = {
          type: 'formatter',
          format: formatNameWithPrefix,
          isSelected: isSelectedFor(formatNameWithPrefix),
          getStylePreview: getPreviewFor(formatNameWithPrefix)
        };
        var newItem = deepMerge(item, customSpec);
        editor.formatter.register(formatName, newItem);
        return newItem;
      };
      var doEnrich = function (items) {
        return map(items, function (item) {
          var keys$1 = keys(item);
          if (hasNonNullableKey(item, 'items')) {
            var newItems_1 = doEnrich(item.items);
            return deepMerge(enrichMenu(item), {
              getStyleItems: function () {
                return newItems_1;
              }
            });
          } else if (hasNonNullableKey(item, 'format')) {
            return enrichSupported(item);
          } else if (keys$1.length === 1 && contains(keys$1, 'title')) {
            return deepMerge(item, { type: 'separator' });
          } else {
            return enrichCustom(item);
          }
        });
      };
      return doEnrich(formats);
    };

    var init$7 = function (editor) {
      var isSelectedFor = function (format) {
        return function () {
          return editor.formatter.match(format);
        };
      };
      var getPreviewFor = function (format) {
        return function () {
          var fmt = editor.formatter.get(format);
          return fmt !== undefined ? Optional.some({
            tag: fmt.length > 0 ? fmt[0].inline || fmt[0].block || 'div' : 'div',
            styles: editor.dom.parseStyle(editor.formatter.getCssText(format))
          }) : Optional.none();
        };
      };
      var flatten = function (fmt) {
        var subs = fmt.items;
        return subs !== undefined && subs.length > 0 ? bind(subs, flatten) : [fmt.format];
      };
      var settingsFormats = Cell([]);
      var settingsFlattenedFormats = Cell([]);
      var eventsFormats = Cell([]);
      var eventsFlattenedFormats = Cell([]);
      var replaceSettings = Cell(false);
      editor.on('PreInit', function (_e) {
        var formats = getStyleFormats(editor);
        var enriched = register$3(editor, formats, isSelectedFor, getPreviewFor);
        settingsFormats.set(enriched);
        settingsFlattenedFormats.set(bind(enriched, flatten));
      });
      editor.on('addStyleModifications', function (e) {
        var modifications = register$3(editor, e.items, isSelectedFor, getPreviewFor);
        eventsFormats.set(modifications);
        replaceSettings.set(e.replace);
        eventsFlattenedFormats.set(bind(modifications, flatten));
      });
      var getData = function () {
        var fromSettings = replaceSettings.get() ? [] : settingsFormats.get();
        var fromEvents = eventsFormats.get();
        return fromSettings.concat(fromEvents);
      };
      var getFlattenedKeys = function () {
        var fromSettings = replaceSettings.get() ? [] : settingsFlattenedFormats.get();
        var fromEvents = eventsFlattenedFormats.get();
        return fromSettings.concat(fromEvents);
      };
      return {
        getData: getData,
        getFlattenedKeys: getFlattenedKeys
      };
    };

    var isElement$2 = function (node) {
      return isNonNullable(node) && node.nodeType === 1;
    };
    var trim$1 = global$c.trim;
    var hasContentEditableState = function (value) {
      return function (node) {
        if (isElement$2(node)) {
          if (node.contentEditable === value) {
            return true;
          }
          if (node.getAttribute('data-mce-contenteditable') === value) {
            return true;
          }
        }
        return false;
      };
    };
    var isContentEditableTrue = hasContentEditableState('true');
    var isContentEditableFalse = hasContentEditableState('false');
    var create$8 = function (type, title, url, level, attach) {
      return {
        type: type,
        title: title,
        url: url,
        level: level,
        attach: attach
      };
    };
    var isChildOfContentEditableTrue = function (node) {
      while (node = node.parentNode) {
        var value = node.contentEditable;
        if (value && value !== 'inherit') {
          return isContentEditableTrue(node);
        }
      }
      return false;
    };
    var select = function (selector, root) {
      return map(descendants(SugarElement.fromDom(root), selector), function (element) {
        return element.dom;
      });
    };
    var getElementText = function (elm) {
      return elm.innerText || elm.textContent;
    };
    var getOrGenerateId = function (elm) {
      return elm.id ? elm.id : generate$1('h');
    };
    var isAnchor = function (elm) {
      return elm && elm.nodeName === 'A' && (elm.id || elm.name) !== undefined;
    };
    var isValidAnchor = function (elm) {
      return isAnchor(elm) && isEditable(elm);
    };
    var isHeader = function (elm) {
      return elm && /^(H[1-6])$/.test(elm.nodeName);
    };
    var isEditable = function (elm) {
      return isChildOfContentEditableTrue(elm) && !isContentEditableFalse(elm);
    };
    var isValidHeader = function (elm) {
      return isHeader(elm) && isEditable(elm);
    };
    var getLevel = function (elm) {
      return isHeader(elm) ? parseInt(elm.nodeName.substr(1), 10) : 0;
    };
    var headerTarget = function (elm) {
      var headerId = getOrGenerateId(elm);
      var attach = function () {
        elm.id = headerId;
      };
      return create$8('header', getElementText(elm), '#' + headerId, getLevel(elm), attach);
    };
    var anchorTarget = function (elm) {
      var anchorId = elm.id || elm.name;
      var anchorText = getElementText(elm);
      return create$8('anchor', anchorText ? anchorText : '#' + anchorId, '#' + anchorId, 0, noop);
    };
    var getHeaderTargets = function (elms) {
      return map(filter(elms, isValidHeader), headerTarget);
    };
    var getAnchorTargets = function (elms) {
      return map(filter(elms, isValidAnchor), anchorTarget);
    };
    var getTargetElements = function (elm) {
      var elms = select('h1,h2,h3,h4,h5,h6,a:not([href])', elm);
      return elms;
    };
    var hasTitle = function (target) {
      return trim$1(target.title).length > 0;
    };
    var find$5 = function (elm) {
      var elms = getTargetElements(elm);
      return filter(getHeaderTargets(elms).concat(getAnchorTargets(elms)), hasTitle);
    };
    var LinkTargets = { find: find$5 };

    var STORAGE_KEY = 'tinymce-url-history';
    var HISTORY_LENGTH = 5;
    var isHttpUrl = function (url) {
      return isString(url) && /^https?/.test(url);
    };
    var isArrayOfUrl = function (a) {
      return isArray(a) && a.length <= HISTORY_LENGTH && forall(a, isHttpUrl);
    };
    var isRecordOfUrlArray = function (r) {
      return isObject(r) && find$1(r, function (value) {
        return !isArrayOfUrl(value);
      }).isNone();
    };
    var getAllHistory = function () {
      var unparsedHistory = global$9.getItem(STORAGE_KEY);
      if (unparsedHistory === null) {
        return {};
      }
      var history;
      try {
        history = JSON.parse(unparsedHistory);
      } catch (e) {
        if (e instanceof SyntaxError) {
          console.log('Local storage ' + STORAGE_KEY + ' was not valid JSON', e);
          return {};
        }
        throw e;
      }
      if (!isRecordOfUrlArray(history)) {
        console.log('Local storage ' + STORAGE_KEY + ' was not valid format', history);
        return {};
      }
      return history;
    };
    var setAllHistory = function (history) {
      if (!isRecordOfUrlArray(history)) {
        throw new Error('Bad format for history:\n' + JSON.stringify(history));
      }
      global$9.setItem(STORAGE_KEY, JSON.stringify(history));
    };
    var getHistory = function (fileType) {
      var history = getAllHistory();
      return Object.prototype.hasOwnProperty.call(history, fileType) ? history[fileType] : [];
    };
    var addToHistory = function (url, fileType) {
      if (!isHttpUrl(url)) {
        return;
      }
      var history = getAllHistory();
      var items = Object.prototype.hasOwnProperty.call(history, fileType) ? history[fileType] : [];
      var itemsWithoutUrl = filter(items, function (item) {
        return item !== url;
      });
      history[fileType] = [url].concat(itemsWithoutUrl).slice(0, HISTORY_LENGTH);
      setAllHistory(history);
    };

    var isTruthy = function (value) {
      return !!value;
    };
    var makeMap = function (value) {
      return map$2(global$c.makeMap(value, /[, ]/), isTruthy);
    };
    var getPicker = function (editor) {
      return Optional.from(getFilePickerCallback(editor)).filter(isFunction);
    };
    var getPickerTypes = function (editor) {
      var optFileTypes = Optional.some(getFilePickerTypes(editor)).filter(isTruthy);
      var optLegacyTypes = Optional.some(getFileBrowserCallbackTypes(editor)).filter(isTruthy);
      var optTypes = optFileTypes.or(optLegacyTypes).map(makeMap);
      return getPicker(editor).fold(never, function (_picker) {
        return optTypes.fold(always, function (types) {
          return keys(types).length > 0 ? types : false;
        });
      });
    };
    var getPickerSetting = function (editor, filetype) {
      var pickerTypes = getPickerTypes(editor);
      if (isBoolean(pickerTypes)) {
        return pickerTypes ? getPicker(editor) : Optional.none();
      } else {
        return pickerTypes[filetype] ? getPicker(editor) : Optional.none();
      }
    };
    var getUrlPicker = function (editor, filetype) {
      return getPickerSetting(editor, filetype).map(function (picker) {
        return function (entry) {
          return Future.nu(function (completer) {
            var handler = function (value, meta) {
              if (!isString(value)) {
                throw new Error('Expected value to be string');
              }
              if (meta !== undefined && !isObject(meta)) {
                throw new Error('Expected meta to be a object');
              }
              var r = {
                value: value,
                meta: meta
              };
              completer(r);
            };
            var meta = __assign({
              filetype: filetype,
              fieldname: entry.fieldname
            }, Optional.from(entry.meta).getOr({}));
            picker.call(editor, handler, entry.value, meta);
          });
        };
      });
    };
    var getTextSetting = function (value) {
      return Optional.from(value).filter(isString).getOrUndefined();
    };
    var getLinkInformation = function (editor) {
      if (noTypeaheadUrls(editor)) {
        return Optional.none();
      }
      return Optional.some({
        targets: LinkTargets.find(editor.getBody()),
        anchorTop: getTextSetting(getAnchorTop(editor)),
        anchorBottom: getTextSetting(getAnchorBottom(editor))
      });
    };
    var getValidationHandler = function (editor) {
      return Optional.from(getFilePickerValidatorHandler(editor));
    };
    var UrlInputBackstage = function (editor) {
      return {
        getHistory: getHistory,
        addToHistory: addToHistory,
        getLinkInformation: function () {
          return getLinkInformation(editor);
        },
        getValidationHandler: function () {
          return getValidationHandler(editor);
        },
        getUrlPicker: function (filetype) {
          return getUrlPicker(editor, filetype);
        }
      };
    };

    var init$8 = function (sink, editor, lazyAnchorbar) {
      var contextMenuState = Cell(false);
      var toolbar = HeaderBackstage(editor);
      var backstage = {
        shared: {
          providers: {
            icons: function () {
              return editor.ui.registry.getAll().icons;
            },
            menuItems: function () {
              return editor.ui.registry.getAll().menuItems;
            },
            translate: global$6.translate,
            isDisabled: function () {
              return editor.mode.isReadOnly() || editor.ui.isDisabled();
            },
            getSetting: editor.getParam.bind(editor)
          },
          interpreter: function (s) {
            return interpretWithoutForm(s, backstage);
          },
          anchors: getAnchors(editor, lazyAnchorbar, toolbar.isPositionedAtTop),
          header: toolbar,
          getSink: function () {
            return Result.value(sink);
          }
        },
        urlinput: UrlInputBackstage(editor),
        styleselect: init$7(editor),
        colorinput: ColorInputBackstage(editor),
        dialog: DialogBackstage(editor),
        isContextMenuOpen: function () {
          return contextMenuState.get();
        },
        setContextMenuState: function (state) {
          return contextMenuState.set(state);
        }
      };
      return backstage;
    };

    var expandable$1 = constant(function (element, available) {
      setMax$1(element, Math.floor(available));
    });

    var showContextToolbarEvent = 'contexttoolbar-show';
    var hideContextToolbarEvent = 'contexttoolbar-hide';

    var schema$k = constant([
      strict$1('dom'),
      defaulted$1('shell', true),
      field$1('toolbarBehaviours', [Replacing])
    ]);
    var enhanceGroups = function () {
      return { behaviours: derive$1([Replacing.config({})]) };
    };
    var parts$7 = constant([optional({
        name: 'groups',
        overrides: enhanceGroups
      })]);

    var factory$9 = function (detail, components, _spec, _externals) {
      var setGroups = function (toolbar, groups) {
        getGroupContainer(toolbar).fold(function () {
          console.error('Toolbar was defined to not be a shell, but no groups container was specified in components');
          throw new Error('Toolbar was defined to not be a shell, but no groups container was specified in components');
        }, function (container) {
          Replacing.set(container, groups);
        });
      };
      var getGroupContainer = function (component) {
        return detail.shell ? Optional.some(component) : getPart(component, detail, 'groups');
      };
      var extra = detail.shell ? {
        behaviours: [Replacing.config({})],
        components: []
      } : {
        behaviours: [],
        components: components
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: extra.components,
        behaviours: augment(detail.toolbarBehaviours, extra.behaviours),
        apis: { setGroups: setGroups },
        domModification: { attributes: { role: 'group' } }
      };
    };
    var Toolbar = composite$1({
      name: 'Toolbar',
      configFields: schema$k(),
      partFields: parts$7(),
      factory: factory$9,
      apis: {
        setGroups: function (apis, toolbar, groups) {
          apis.setGroups(toolbar, groups);
        }
      }
    });

    var generate$6 = function (xs, f) {
      var init = {
        len: 0,
        list: []
      };
      var r = foldl(xs, function (b, a) {
        var value = f(a, b.len);
        return value.fold(constant(b), function (v) {
          return {
            len: v.finish,
            list: b.list.concat([v])
          };
        });
      }, init);
      return r.list;
    };

    var output$1 = function (within, extra, withinWidth) {
      return {
        within: within,
        extra: extra,
        withinWidth: withinWidth
      };
    };
    var apportion = function (units, total, len) {
      var parray = generate$6(units, function (unit, current) {
        var width = len(unit);
        return Optional.some({
          element: unit,
          start: current,
          finish: current + width,
          width: width
        });
      });
      var within = filter(parray, function (unit) {
        return unit.finish <= total;
      });
      var withinWidth = foldr(within, function (acc, el) {
        return acc + el.width;
      }, 0);
      var extra = parray.slice(within.length);
      return {
        within: within,
        extra: extra,
        withinWidth: withinWidth
      };
    };
    var toUnit = function (parray) {
      return map(parray, function (unit) {
        return unit.element;
      });
    };
    var fitLast = function (within, extra, withinWidth) {
      var fits = toUnit(within.concat(extra));
      return output$1(fits, [], withinWidth);
    };
    var overflow = function (within, extra, overflower, withinWidth) {
      var fits = toUnit(within).concat([overflower]);
      return output$1(fits, toUnit(extra), withinWidth);
    };
    var fitAll = function (within, extra, withinWidth) {
      return output$1(toUnit(within), [], withinWidth);
    };
    var tryFit = function (total, units, len) {
      var divide = apportion(units, total, len);
      return divide.extra.length === 0 ? Optional.some(divide) : Optional.none();
    };
    var partition$3 = function (total, units, len, overflower) {
      var divide = tryFit(total, units, len).getOrThunk(function () {
        return apportion(units, total - len(overflower), len);
      });
      var within = divide.within;
      var extra = divide.extra;
      var withinWidth = divide.withinWidth;
      if (extra.length === 1 && extra[0].width <= len(overflower)) {
        return fitLast(within, extra, withinWidth);
      } else if (extra.length >= 1) {
        return overflow(within, extra, overflower, withinWidth);
      } else {
        return fitAll(within, extra, withinWidth);
      }
    };

    var setGroups = function (toolbar, storedGroups) {
      var bGroups = map(storedGroups, function (g) {
        return premade$1(g);
      });
      Toolbar.setGroups(toolbar, bGroups);
    };
    var findFocusedComp = function (comps) {
      return findMap(comps, function (comp) {
        return search(comp.element).bind(function (focusedElm) {
          return comp.getSystem().getByDom(focusedElm).toOptional();
        });
      });
    };
    var refresh = function (toolbar, detail, setOverflow) {
      var primary = getPartOrDie(toolbar, detail, 'primary');
      var overflowGroup = Coupling.getCoupled(toolbar, 'overflowGroup');
      set$2(primary.element, 'visibility', 'hidden');
      var groups = detail.builtGroups.get().concat([overflowGroup]);
      var focusedComp = findFocusedComp(groups);
      setOverflow([]);
      setGroups(primary, groups);
      var availableWidth = get$8(primary.element);
      var overflows = partition$3(availableWidth, detail.builtGroups.get(), function (comp) {
        return get$8(comp.element);
      }, overflowGroup);
      if (overflows.extra.length === 0) {
        Replacing.remove(primary, overflowGroup);
        setOverflow([]);
      } else {
        setGroups(primary, overflows.within);
        setOverflow(overflows.extra);
      }
      remove$6(primary.element, 'visibility');
      reflow(primary.element);
      focusedComp.each(Focusing.focus);
    };

    var schema$l = constant([
      field$1('splitToolbarBehaviours', [Coupling]),
      state$1('builtGroups', function () {
        return Cell([]);
      })
    ]);

    var schema$m = constant([
      markers(['overflowToggledClass']),
      optionFunction('getOverflowBounds'),
      strict$1('lazySink'),
      state$1('overflowGroups', function () {
        return Cell([]);
      })
    ].concat(schema$l()));
    var parts$8 = constant([
      required({
        factory: Toolbar,
        schema: schema$k(),
        name: 'primary'
      }),
      external$1({
        schema: schema$k(),
        name: 'overflow'
      }),
      external$1({ name: 'overflow-button' }),
      external$1({ name: 'overflow-group' })
    ]);

    var schema$n = constant([
      markers(['toggledClass']),
      strict$1('lazySink'),
      strictFunction('fetch'),
      optionFunction('getBounds'),
      optionObjOf('fireDismissalEventInstead', [defaulted$1('event', dismissRequested())]),
      schema$1()
    ]);
    var parts$9 = constant([
      external$1({
        name: 'button',
        overrides: function (detail) {
          return {
            dom: { attributes: { 'aria-haspopup': 'true' } },
            buttonBehaviours: derive$1([Toggling.config({
                toggleClass: detail.markers.toggledClass,
                aria: { mode: 'expanded' },
                toggleOnExecute: false
              })])
          };
        }
      }),
      external$1({
        factory: Toolbar,
        schema: schema$k(),
        name: 'toolbar',
        overrides: function (detail) {
          return {
            toolbarBehaviours: derive$1([Keying.config({
                mode: 'cyclic',
                onEscape: function (comp) {
                  getPart(comp, detail, 'button').each(Focusing.focus);
                  return Optional.none();
                }
              })])
          };
        }
      })
    ]);

    var toggle$2 = function (button, externals) {
      var toolbarSandbox = Coupling.getCoupled(button, 'toolbarSandbox');
      if (Sandboxing.isOpen(toolbarSandbox)) {
        Sandboxing.close(toolbarSandbox);
      } else {
        Sandboxing.open(toolbarSandbox, externals.toolbar());
      }
    };
    var position$2 = function (button, toolbar, detail, layouts) {
      var bounds = detail.getBounds.map(function (bounder) {
        return bounder();
      });
      var sink = detail.lazySink(button).getOrDie();
      Positioning.positionWithinBounds(sink, {
        anchor: 'hotspot',
        hotspot: button,
        layouts: layouts,
        overrides: { maxWidthFunction: expandable$1() }
      }, toolbar, bounds);
    };
    var setGroups$1 = function (button, toolbar, detail, layouts, groups) {
      Toolbar.setGroups(toolbar, groups);
      position$2(button, toolbar, detail, layouts);
      Toggling.on(button);
    };
    var makeSandbox$1 = function (button, spec, detail) {
      var ariaOwner = manager();
      var onOpen = function (sandbox, toolbar) {
        detail.fetch().get(function (groups) {
          setGroups$1(button, toolbar, detail, spec.layouts, groups);
          ariaOwner.link(button.element);
          Keying.focusIn(toolbar);
        });
      };
      var onClose = function () {
        Toggling.off(button);
        Focusing.focus(button);
        ariaOwner.unlink(button.element);
      };
      return {
        dom: {
          tag: 'div',
          attributes: { id: ariaOwner.id }
        },
        behaviours: derive$1([
          Keying.config({
            mode: 'special',
            onEscape: function (comp) {
              Sandboxing.close(comp);
              return Optional.some(true);
            }
          }),
          Sandboxing.config({
            onOpen: onOpen,
            onClose: onClose,
            isPartOf: function (container, data, queryElem) {
              return isPartOf(data, queryElem) || isPartOf(button, queryElem);
            },
            getAttachPoint: function () {
              return detail.lazySink(button).getOrDie();
            }
          }),
          Receiving.config({
            channels: __assign(__assign({}, receivingChannel(__assign({ isExtraPart: never }, detail.fireDismissalEventInstead.map(function (fe) {
              return { fireEventInstead: { event: fe.event } };
            }).getOr({})))), receivingChannel$1({
              doReposition: function () {
                Sandboxing.getState(Coupling.getCoupled(button, 'toolbarSandbox')).each(function (toolbar) {
                  position$2(button, toolbar, detail, spec.layouts);
                });
              }
            }))
          })
        ])
      };
    };
    var factory$a = function (detail, components, spec, externals) {
      return __assign(__assign({}, Button.sketch(__assign(__assign({}, externals.button()), {
        action: function (button) {
          toggle$2(button, externals);
        },
        buttonBehaviours: SketchBehaviours.augment({ dump: externals.button().buttonBehaviours }, [Coupling.config({
            others: {
              toolbarSandbox: function (button) {
                return makeSandbox$1(button, spec, detail);
              }
            }
          })])
      }))), {
        apis: {
          setGroups: function (button, groups) {
            Sandboxing.getState(Coupling.getCoupled(button, 'toolbarSandbox')).each(function (toolbar) {
              setGroups$1(button, toolbar, detail, spec.layouts, groups);
            });
          },
          reposition: function (button) {
            Sandboxing.getState(Coupling.getCoupled(button, 'toolbarSandbox')).each(function (toolbar) {
              position$2(button, toolbar, detail, spec.layouts);
            });
          },
          toggle: function (button) {
            toggle$2(button, externals);
          },
          getToolbar: function (button) {
            return Sandboxing.getState(Coupling.getCoupled(button, 'toolbarSandbox'));
          },
          isOpen: function (button) {
            return Sandboxing.isOpen(Coupling.getCoupled(button, 'toolbarSandbox'));
          }
        }
      });
    };
    var FloatingToolbarButton = composite$1({
      name: 'FloatingToolbarButton',
      factory: factory$a,
      configFields: schema$n(),
      partFields: parts$9(),
      apis: {
        setGroups: function (apis, button, groups) {
          apis.setGroups(button, groups);
        },
        reposition: function (apis, button) {
          apis.reposition(button);
        },
        toggle: function (apis, button) {
          apis.toggle(button);
        },
        getToolbar: function (apis, button) {
          return apis.getToolbar(button);
        },
        isOpen: function (apis, button) {
          return apis.isOpen(button);
        }
      }
    });

    var schema$o = constant([
      strict$1('items'),
      markers(['itemSelector']),
      field$1('tgroupBehaviours', [Keying])
    ]);
    var parts$a = constant([group({
        name: 'items',
        unit: 'item'
      })]);

    var factory$b = function (detail, components, _spec, _externals) {
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: augment(detail.tgroupBehaviours, [Keying.config({
            mode: 'flow',
            selector: detail.markers.itemSelector
          })]),
        domModification: { attributes: { role: 'toolbar' } }
      };
    };
    var ToolbarGroup = composite$1({
      name: 'ToolbarGroup',
      configFields: schema$o(),
      partFields: parts$a(),
      factory: factory$b
    });

    var buildGroups = function (comps) {
      return map(comps, function (g) {
        return premade$1(g);
      });
    };
    var refresh$1 = function (toolbar, memFloatingToolbarButton, detail) {
      refresh(toolbar, detail, function (overflowGroups) {
        detail.overflowGroups.set(overflowGroups);
        memFloatingToolbarButton.getOpt(toolbar).each(function (floatingToolbarButton) {
          FloatingToolbarButton.setGroups(floatingToolbarButton, buildGroups(overflowGroups));
        });
      });
    };
    var factory$c = function (detail, components, spec, externals) {
      var memFloatingToolbarButton = record(FloatingToolbarButton.sketch({
        fetch: function () {
          return Future.nu(function (resolve) {
            resolve(buildGroups(detail.overflowGroups.get()));
          });
        },
        layouts: {
          onLtr: function () {
            return [
              southwest$1,
              southeast$1
            ];
          },
          onRtl: function () {
            return [
              southeast$1,
              southwest$1
            ];
          },
          onBottomLtr: function () {
            return [
              northwest$1,
              northeast$1
            ];
          },
          onBottomRtl: function () {
            return [
              northeast$1,
              northwest$1
            ];
          }
        },
        getBounds: spec.getOverflowBounds,
        lazySink: detail.lazySink,
        fireDismissalEventInstead: {},
        markers: { toggledClass: detail.markers.overflowToggledClass },
        parts: {
          button: externals['overflow-button'](),
          toolbar: externals.overflow()
        }
      }));
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: augment(detail.splitToolbarBehaviours, [Coupling.config({
            others: {
              overflowGroup: function () {
                return ToolbarGroup.sketch(__assign(__assign({}, externals['overflow-group']()), { items: [memFloatingToolbarButton.asSpec()] }));
              }
            }
          })]),
        apis: {
          setGroups: function (toolbar, groups) {
            detail.builtGroups.set(map(groups, toolbar.getSystem().build));
            refresh$1(toolbar, memFloatingToolbarButton, detail);
          },
          refresh: function (toolbar) {
            return refresh$1(toolbar, memFloatingToolbarButton, detail);
          },
          toggle: function (toolbar) {
            memFloatingToolbarButton.getOpt(toolbar).each(function (floatingToolbarButton) {
              FloatingToolbarButton.toggle(floatingToolbarButton);
            });
          },
          isOpen: function (toolbar) {
            return memFloatingToolbarButton.getOpt(toolbar).map(FloatingToolbarButton.isOpen).getOr(false);
          },
          reposition: function (toolbar) {
            memFloatingToolbarButton.getOpt(toolbar).each(function (floatingToolbarButton) {
              FloatingToolbarButton.reposition(floatingToolbarButton);
            });
          },
          getOverflow: function (toolbar) {
            return memFloatingToolbarButton.getOpt(toolbar).bind(FloatingToolbarButton.getToolbar);
          }
        },
        domModification: { attributes: { role: 'group' } }
      };
    };
    var SplitFloatingToolbar = composite$1({
      name: 'SplitFloatingToolbar',
      configFields: schema$m(),
      partFields: parts$8(),
      factory: factory$c,
      apis: {
        setGroups: function (apis, toolbar, groups) {
          apis.setGroups(toolbar, groups);
        },
        refresh: function (apis, toolbar) {
          apis.refresh(toolbar);
        },
        reposition: function (apis, toolbar) {
          apis.reposition(toolbar);
        },
        toggle: function (apis, toolbar) {
          apis.toggle(toolbar);
        },
        isOpen: function (apis, toolbar) {
          return apis.isOpen(toolbar);
        },
        getOverflow: function (apis, toolbar) {
          return apis.getOverflow(toolbar);
        }
      }
    });

    var getAnimationRoot = function (component, slideConfig) {
      return slideConfig.getAnimationRoot.fold(function () {
        return component.element;
      }, function (get) {
        return get(component);
      });
    };

    var getDimensionProperty = function (slideConfig) {
      return slideConfig.dimension.property;
    };
    var getDimension = function (slideConfig, elem) {
      return slideConfig.dimension.getDimension(elem);
    };
    var disableTransitions = function (component, slideConfig) {
      var root = getAnimationRoot(component, slideConfig);
      remove$5(root, [
        slideConfig.shrinkingClass,
        slideConfig.growingClass
      ]);
    };
    var setShrunk = function (component, slideConfig) {
      remove$4(component.element, slideConfig.openClass);
      add$2(component.element, slideConfig.closedClass);
      set$2(component.element, getDimensionProperty(slideConfig), '0px');
      reflow(component.element);
    };
    var setGrown = function (component, slideConfig) {
      remove$4(component.element, slideConfig.closedClass);
      add$2(component.element, slideConfig.openClass);
      remove$6(component.element, getDimensionProperty(slideConfig));
    };
    var doImmediateShrink = function (component, slideConfig, slideState, _calculatedSize) {
      slideState.setCollapsed();
      set$2(component.element, getDimensionProperty(slideConfig), getDimension(slideConfig, component.element));
      reflow(component.element);
      disableTransitions(component, slideConfig);
      setShrunk(component, slideConfig);
      slideConfig.onStartShrink(component);
      slideConfig.onShrunk(component);
    };
    var doStartShrink = function (component, slideConfig, slideState, calculatedSize) {
      var size = calculatedSize.getOrThunk(function () {
        return getDimension(slideConfig, component.element);
      });
      slideState.setCollapsed();
      set$2(component.element, getDimensionProperty(slideConfig), size);
      reflow(component.element);
      var root = getAnimationRoot(component, slideConfig);
      remove$4(root, slideConfig.growingClass);
      add$2(root, slideConfig.shrinkingClass);
      setShrunk(component, slideConfig);
      slideConfig.onStartShrink(component);
    };
    var doStartSmartShrink = function (component, slideConfig, slideState) {
      var size = getDimension(slideConfig, component.element);
      var shrinker = size === '0px' ? doImmediateShrink : doStartShrink;
      shrinker(component, slideConfig, slideState, Optional.some(size));
    };
    var doStartGrow = function (component, slideConfig, slideState) {
      var root = getAnimationRoot(component, slideConfig);
      var wasShrinking = has$2(root, slideConfig.shrinkingClass);
      var beforeSize = getDimension(slideConfig, component.element);
      setGrown(component, slideConfig);
      var fullSize = getDimension(slideConfig, component.element);
      var startPartialGrow = function () {
        set$2(component.element, getDimensionProperty(slideConfig), beforeSize);
        reflow(component.element);
      };
      var startCompleteGrow = function () {
        setShrunk(component, slideConfig);
      };
      var setStartSize = wasShrinking ? startPartialGrow : startCompleteGrow;
      setStartSize();
      remove$4(root, slideConfig.shrinkingClass);
      add$2(root, slideConfig.growingClass);
      setGrown(component, slideConfig);
      set$2(component.element, getDimensionProperty(slideConfig), fullSize);
      slideState.setExpanded();
      slideConfig.onStartGrow(component);
    };
    var refresh$2 = function (component, slideConfig, slideState) {
      if (slideState.isExpanded()) {
        remove$6(component.element, getDimensionProperty(slideConfig));
        var fullSize = getDimension(slideConfig, component.element);
        set$2(component.element, getDimensionProperty(slideConfig), fullSize);
      }
    };
    var grow = function (component, slideConfig, slideState) {
      if (!slideState.isExpanded()) {
        doStartGrow(component, slideConfig, slideState);
      }
    };
    var shrink = function (component, slideConfig, slideState) {
      if (slideState.isExpanded()) {
        doStartSmartShrink(component, slideConfig, slideState);
      }
    };
    var immediateShrink = function (component, slideConfig, slideState) {
      if (slideState.isExpanded()) {
        doImmediateShrink(component, slideConfig, slideState, Optional.none());
      }
    };
    var hasGrown = function (component, slideConfig, slideState) {
      return slideState.isExpanded();
    };
    var hasShrunk = function (component, slideConfig, slideState) {
      return slideState.isCollapsed();
    };
    var isGrowing = function (component, slideConfig, _slideState) {
      var root = getAnimationRoot(component, slideConfig);
      return has$2(root, slideConfig.growingClass) === true;
    };
    var isShrinking = function (component, slideConfig, _slideState) {
      var root = getAnimationRoot(component, slideConfig);
      return has$2(root, slideConfig.shrinkingClass) === true;
    };
    var isTransitioning = function (component, slideConfig, slideState) {
      return isGrowing(component, slideConfig) || isShrinking(component, slideConfig);
    };
    var toggleGrow = function (component, slideConfig, slideState) {
      var f = slideState.isExpanded() ? doStartSmartShrink : doStartGrow;
      f(component, slideConfig, slideState);
    };

    var SlidingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        refresh: refresh$2,
        grow: grow,
        shrink: shrink,
        immediateShrink: immediateShrink,
        hasGrown: hasGrown,
        hasShrunk: hasShrunk,
        isGrowing: isGrowing,
        isShrinking: isShrinking,
        isTransitioning: isTransitioning,
        toggleGrow: toggleGrow,
        disableTransitions: disableTransitions
    });

    var exhibit$6 = function (base, slideConfig, _slideState) {
      var expanded = slideConfig.expanded;
      return expanded ? nu$6({
        classes: [slideConfig.openClass],
        styles: {}
      }) : nu$6({
        classes: [slideConfig.closedClass],
        styles: wrap$1(slideConfig.dimension.property, '0px')
      });
    };
    var events$d = function (slideConfig, slideState) {
      return derive([runOnSource(transitionend(), function (component, simulatedEvent) {
          var raw = simulatedEvent.event.raw;
          if (raw.propertyName === slideConfig.dimension.property) {
            disableTransitions(component, slideConfig);
            if (slideState.isExpanded()) {
              remove$6(component.element, slideConfig.dimension.property);
            }
            var notify = slideState.isExpanded() ? slideConfig.onGrown : slideConfig.onShrunk;
            notify(component);
          }
        })]);
    };

    var ActiveSliding = /*#__PURE__*/Object.freeze({
        __proto__: null,
        exhibit: exhibit$6,
        events: events$d
    });

    var SlidingSchema = [
      strict$1('closedClass'),
      strict$1('openClass'),
      strict$1('shrinkingClass'),
      strict$1('growingClass'),
      option('getAnimationRoot'),
      onHandler('onShrunk'),
      onHandler('onStartShrink'),
      onHandler('onGrown'),
      onHandler('onStartGrow'),
      defaulted$1('expanded', false),
      strictOf('dimension', choose$1('property', {
        width: [
          output('property', 'width'),
          output('getDimension', function (elem) {
            return get$8(elem) + 'px';
          })
        ],
        height: [
          output('property', 'height'),
          output('getDimension', function (elem) {
            return get$7(elem) + 'px';
          })
        ]
      }))
    ];

    var init$9 = function (spec) {
      var state = Cell(spec.expanded);
      var readState = function () {
        return 'expanded: ' + state.get();
      };
      return nu$5({
        isExpanded: function () {
          return state.get() === true;
        },
        isCollapsed: function () {
          return state.get() === false;
        },
        setCollapsed: curry(state.set, false),
        setExpanded: curry(state.set, true),
        readState: readState
      });
    };

    var SlidingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$9
    });

    var Sliding = create$1({
      fields: SlidingSchema,
      name: 'sliding',
      active: ActiveSliding,
      apis: SlidingApis,
      state: SlidingState
    });

    var schema$p = constant([
      markers([
        'closedClass',
        'openClass',
        'shrinkingClass',
        'growingClass',
        'overflowToggledClass'
      ]),
      onHandler('onOpened'),
      onHandler('onClosed')
    ].concat(schema$l()));
    var parts$b = constant([
      required({
        factory: Toolbar,
        schema: schema$k(),
        name: 'primary'
      }),
      required({
        factory: Toolbar,
        schema: schema$k(),
        name: 'overflow',
        overrides: function (detail) {
          return {
            toolbarBehaviours: derive$1([
              Sliding.config({
                dimension: { property: 'height' },
                closedClass: detail.markers.closedClass,
                openClass: detail.markers.openClass,
                shrinkingClass: detail.markers.shrinkingClass,
                growingClass: detail.markers.growingClass,
                onShrunk: function (comp) {
                  getPart(comp, detail, 'overflow-button').each(function (button) {
                    Toggling.off(button);
                    Focusing.focus(button);
                  });
                  detail.onClosed(comp);
                },
                onGrown: function (comp) {
                  Keying.focusIn(comp);
                  detail.onOpened(comp);
                },
                onStartGrow: function (comp) {
                  getPart(comp, detail, 'overflow-button').each(Toggling.on);
                }
              }),
              Keying.config({
                mode: 'acyclic',
                onEscape: function (comp) {
                  getPart(comp, detail, 'overflow-button').each(Focusing.focus);
                  return Optional.some(true);
                }
              })
            ])
          };
        }
      }),
      external$1({
        name: 'overflow-button',
        overrides: function (detail) {
          return {
            buttonBehaviours: derive$1([Toggling.config({
                toggleClass: detail.markers.overflowToggledClass,
                aria: { mode: 'pressed' },
                toggleOnExecute: false
              })])
          };
        }
      }),
      external$1({ name: 'overflow-group' })
    ]);

    var isOpen$1 = function (toolbar, detail) {
      return getPart(toolbar, detail, 'overflow').map(Sliding.hasGrown).getOr(false);
    };
    var toggleToolbar = function (toolbar, detail) {
      getPart(toolbar, detail, 'overflow-button').bind(function () {
        return getPart(toolbar, detail, 'overflow');
      }).each(function (overf) {
        refresh$3(toolbar, detail);
        Sliding.toggleGrow(overf);
      });
    };
    var refresh$3 = function (toolbar, detail) {
      getPart(toolbar, detail, 'overflow').each(function (overflow) {
        refresh(toolbar, detail, function (groups) {
          var builtGroups = map(groups, function (g) {
            return premade$1(g);
          });
          Toolbar.setGroups(overflow, builtGroups);
        });
        getPart(toolbar, detail, 'overflow-button').each(function (button) {
          if (Sliding.hasGrown(overflow)) {
            Toggling.on(button);
          }
        });
        Sliding.refresh(overflow);
      });
    };
    var factory$d = function (detail, components, spec, externals) {
      var toolbarToggleEvent = 'alloy.toolbar.toggle';
      var doSetGroups = function (toolbar, groups) {
        var built = map(groups, toolbar.getSystem().build);
        detail.builtGroups.set(built);
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: augment(detail.splitToolbarBehaviours, [
          Coupling.config({
            others: {
              overflowGroup: function (toolbar) {
                return ToolbarGroup.sketch(__assign(__assign({}, externals['overflow-group']()), {
                  items: [Button.sketch(__assign(__assign({}, externals['overflow-button']()), {
                      action: function (_button) {
                        emit(toolbar, toolbarToggleEvent);
                      }
                    }))]
                }));
              }
            }
          }),
          config('toolbar-toggle-events', [run(toolbarToggleEvent, function (toolbar) {
              toggleToolbar(toolbar, detail);
            })])
        ]),
        apis: {
          setGroups: function (toolbar, groups) {
            doSetGroups(toolbar, groups);
            refresh$3(toolbar, detail);
          },
          refresh: function (toolbar) {
            return refresh$3(toolbar, detail);
          },
          toggle: function (toolbar) {
            return toggleToolbar(toolbar, detail);
          },
          isOpen: function (toolbar) {
            return isOpen$1(toolbar, detail);
          }
        },
        domModification: { attributes: { role: 'group' } }
      };
    };
    var SplitSlidingToolbar = composite$1({
      name: 'SplitSlidingToolbar',
      configFields: schema$p(),
      partFields: parts$b(),
      factory: factory$d,
      apis: {
        setGroups: function (apis, toolbar, groups) {
          apis.setGroups(toolbar, groups);
        },
        refresh: function (apis, toolbar) {
          apis.refresh(toolbar);
        },
        toggle: function (apis, toolbar) {
          apis.toggle(toolbar);
        },
        isOpen: function (apis, toolbar) {
          return apis.isOpen(toolbar);
        }
      }
    });

    var toolbarHeightChange = constant(generate$1('toolbar-height-change'));

    var renderToolbarGroupCommon = function (toolbarGroup) {
      var attributes = toolbarGroup.title.fold(function () {
        return {};
      }, function (title) {
        return { attributes: { title: title } };
      });
      return {
        dom: __assign({
          tag: 'div',
          classes: ['tox-toolbar__group']
        }, attributes),
        components: [ToolbarGroup.parts.items({})],
        items: toolbarGroup.items,
        markers: { itemSelector: '*:not(.tox-split-button) > .tox-tbtn:not([disabled]), ' + '.tox-split-button:not([disabled]), ' + '.tox-toolbar-nav-js:not([disabled])' },
        tgroupBehaviours: derive$1([
          Tabstopping.config({}),
          Focusing.config({})
        ])
      };
    };
    var renderToolbarGroup = function (toolbarGroup) {
      return ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup));
    };
    var getToolbarbehaviours = function (toolbarSpec, modeName) {
      var onAttached = runOnAttached(function (component) {
        var groups = map(toolbarSpec.initGroups, renderToolbarGroup);
        Toolbar.setGroups(component, groups);
      });
      return derive$1([
        DisablingConfigs.toolbarButton(toolbarSpec.providers.isDisabled),
        receivingConfig(),
        Keying.config({
          mode: modeName,
          onEscape: toolbarSpec.onEscape,
          selector: '.tox-toolbar__group'
        }),
        config('toolbar-events', [onAttached])
      ]);
    };
    var renderMoreToolbarCommon = function (toolbarSpec) {
      var modeName = toolbarSpec.cyclicKeying ? 'cyclic' : 'acyclic';
      return {
        uid: toolbarSpec.uid,
        dom: {
          tag: 'div',
          classes: ['tox-toolbar-overlord']
        },
        parts: {
          'overflow-group': renderToolbarGroupCommon({
            title: Optional.none(),
            items: []
          }),
          'overflow-button': renderIconButtonSpec({
            name: 'more',
            icon: Optional.some('more-drawer'),
            disabled: false,
            tooltip: Optional.some('More...'),
            primary: false,
            borderless: false
          }, Optional.none(), toolbarSpec.providers)
        },
        splitToolbarBehaviours: getToolbarbehaviours(toolbarSpec, modeName)
      };
    };
    var renderFloatingMoreToolbar = function (toolbarSpec) {
      var baseSpec = renderMoreToolbarCommon(toolbarSpec);
      var overflowXOffset = 4;
      var primary = SplitFloatingToolbar.parts.primary({
        dom: {
          tag: 'div',
          classes: ['tox-toolbar__primary']
        }
      });
      return SplitFloatingToolbar.sketch(__assign(__assign({}, baseSpec), {
        lazySink: toolbarSpec.getSink,
        getOverflowBounds: function () {
          var headerElem = toolbarSpec.moreDrawerData.lazyHeader().element;
          var headerBounds = absolute$1(headerElem);
          var docElem = documentElement(headerElem);
          var docBounds = absolute$1(docElem);
          var height = Math.max(docElem.dom.scrollHeight, docBounds.height);
          return bounds$1(headerBounds.x + overflowXOffset, docBounds.y, headerBounds.width - overflowXOffset * 2, height);
        },
        parts: __assign(__assign({}, baseSpec.parts), {
          overflow: {
            dom: {
              tag: 'div',
              classes: ['tox-toolbar__overflow'],
              attributes: toolbarSpec.attributes
            }
          }
        }),
        components: [primary],
        markers: { overflowToggledClass: 'tox-tbtn--enabled' }
      }));
    };
    var renderSlidingMoreToolbar = function (toolbarSpec) {
      var primary = SplitSlidingToolbar.parts.primary({
        dom: {
          tag: 'div',
          classes: ['tox-toolbar__primary']
        }
      });
      var overflow = SplitSlidingToolbar.parts.overflow({
        dom: {
          tag: 'div',
          classes: ['tox-toolbar__overflow']
        }
      });
      var baseSpec = renderMoreToolbarCommon(toolbarSpec);
      return SplitSlidingToolbar.sketch(__assign(__assign({}, baseSpec), {
        components: [
          primary,
          overflow
        ],
        markers: {
          openClass: 'tox-toolbar__overflow--open',
          closedClass: 'tox-toolbar__overflow--closed',
          growingClass: 'tox-toolbar__overflow--growing',
          shrinkingClass: 'tox-toolbar__overflow--shrinking',
          overflowToggledClass: 'tox-tbtn--enabled'
        },
        onOpened: function (comp) {
          comp.getSystem().broadcastOn([toolbarHeightChange()], { type: 'opened' });
        },
        onClosed: function (comp) {
          comp.getSystem().broadcastOn([toolbarHeightChange()], { type: 'closed' });
        }
      }));
    };
    var renderToolbar = function (toolbarSpec) {
      var modeName = toolbarSpec.cyclicKeying ? 'cyclic' : 'acyclic';
      return Toolbar.sketch({
        uid: toolbarSpec.uid,
        dom: {
          tag: 'div',
          classes: ['tox-toolbar'].concat(toolbarSpec.type === ToolbarMode.scrolling ? ['tox-toolbar--scrolling'] : [])
        },
        components: [Toolbar.parts.groups({})],
        toolbarBehaviours: getToolbarbehaviours(toolbarSpec, modeName)
      });
    };

    var groupToolbarButtonSchema = objOf([
      strictString('type'),
      strictOf('items', oneOf([
        arrOfObj$1([
          strictString('name'),
          strictArrayOf('items', string)
        ]),
        string
      ]))
    ].concat(baseToolbarButtonFields));
    var createGroupToolbarButton = function (spec) {
      return asRaw('GroupToolbarButton', groupToolbarButtonSchema, spec);
    };

    var baseMenuButtonFields = [
      optionString('text'),
      optionString('tooltip'),
      optionString('icon'),
      strictFunction('fetch'),
      defaultedFunction('onSetup', function () {
        return noop;
      })
    ];

    var MenuButtonSchema = objOf(__spreadArrays([strictString('type')], baseMenuButtonFields));
    var createMenuButton = function (spec) {
      return asRaw('menubutton', MenuButtonSchema, spec);
    };

    var splitButtonSchema = objOf([
      strictString('type'),
      optionString('tooltip'),
      optionString('icon'),
      optionString('text'),
      optionFunction('select'),
      strictFunction('fetch'),
      defaultedFunction('onSetup', function () {
        return noop;
      }),
      defaultedStringEnum('presets', 'normal', [
        'normal',
        'color',
        'listpreview'
      ]),
      defaulted$1('columns', 1),
      strictFunction('onAction'),
      strictFunction('onItemAction')
    ]);
    var createSplitButton = function (spec) {
      return asRaw('SplitButton', splitButtonSchema, spec);
    };

    var events$e = function (reflectingConfig, reflectingState) {
      var update = function (component, data) {
        reflectingConfig.updateState.each(function (updateState) {
          var newState = updateState(component, data);
          reflectingState.set(newState);
        });
        reflectingConfig.renderComponents.each(function (renderComponents) {
          var newComponents = renderComponents(data, reflectingState.get());
          var newChildren = map(newComponents, component.getSystem().build);
          replaceChildren(component, newChildren);
        });
      };
      return derive([
        run(receive(), function (component, message) {
          var receivingData = message;
          if (!receivingData.universal) {
            var channel = reflectingConfig.channel;
            if (contains(receivingData.channels, channel)) {
              update(component, receivingData.data);
            }
          }
        }),
        runOnAttached(function (comp, _se) {
          reflectingConfig.initialData.each(function (rawData) {
            update(comp, rawData);
          });
        })
      ]);
    };

    var ActiveReflecting = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$e
    });

    var getState$2 = function (component, replaceConfig, reflectState) {
      return reflectState;
    };

    var ReflectingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        getState: getState$2
    });

    var ReflectingSchema = [
      strict$1('channel'),
      option('renderComponents'),
      option('updateState'),
      option('initialData')
    ];

    var init$a = function () {
      var cell = Cell(Optional.none());
      var set = function (optS) {
        return cell.set(optS);
      };
      var clear = function () {
        return cell.set(Optional.none());
      };
      var get = function () {
        return cell.get();
      };
      var readState = function () {
        return cell.get().fold(function () {
          return 'none';
        }, function (x) {
          return x;
        });
      };
      return {
        readState: readState,
        get: get,
        set: set,
        clear: clear
      };
    };

    var ReflectingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$a
    });

    var Reflecting = create$1({
      fields: ReflectingSchema,
      name: 'reflecting',
      active: ActiveReflecting,
      apis: ReflectingApis,
      state: ReflectingState
    });

    var schema$q = constant([
      strict$1('toggleClass'),
      strict$1('fetch'),
      onStrictHandler('onExecute'),
      defaulted$1('getHotspot', Optional.some),
      defaulted$1('getAnchorOverrides', constant({})),
      schema$1(),
      onStrictHandler('onItemExecute'),
      option('lazySink'),
      strict$1('dom'),
      onHandler('onOpen'),
      field$1('splitDropdownBehaviours', [
        Coupling,
        Keying,
        Focusing
      ]),
      defaulted$1('matchWidth', false),
      defaulted$1('useMinWidth', false),
      defaulted$1('eventOrder', {}),
      option('role')
    ].concat(sandboxFields()));
    var arrowPart = required({
      factory: Button,
      schema: [strict$1('dom')],
      name: 'arrow',
      defaults: function () {
        return { buttonBehaviours: derive$1([Focusing.revoke()]) };
      },
      overrides: function (detail) {
        return {
          dom: {
            tag: 'span',
            attributes: { role: 'presentation' }
          },
          action: function (arrow) {
            arrow.getSystem().getByUid(detail.uid).each(emitExecute);
          },
          buttonBehaviours: derive$1([Toggling.config({
              toggleOnExecute: false,
              toggleClass: detail.toggleClass
            })])
        };
      }
    });
    var buttonPart = required({
      factory: Button,
      schema: [strict$1('dom')],
      name: 'button',
      defaults: function () {
        return { buttonBehaviours: derive$1([Focusing.revoke()]) };
      },
      overrides: function (detail) {
        return {
          dom: {
            tag: 'span',
            attributes: { role: 'presentation' }
          },
          action: function (btn) {
            btn.getSystem().getByUid(detail.uid).each(function (splitDropdown) {
              detail.onExecute(splitDropdown, btn);
            });
          }
        };
      }
    });
    var parts$c = constant([
      arrowPart,
      buttonPart,
      optional({
        factory: {
          sketch: function (spec) {
            return {
              uid: spec.uid,
              dom: {
                tag: 'span',
                styles: { display: 'none' },
                attributes: { 'aria-hidden': 'true' },
                innerHtml: spec.text
              }
            };
          }
        },
        schema: [strict$1('text')],
        name: 'aria-descriptor'
      }),
      external$1({
        schema: [tieredMenuMarkers()],
        name: 'menu',
        defaults: function (detail) {
          return {
            onExecute: function (tmenu, item) {
              tmenu.getSystem().getByUid(detail.uid).each(function (splitDropdown) {
                detail.onItemExecute(splitDropdown, tmenu, item);
              });
            }
          };
        }
      }),
      partType()
    ]);

    var factory$e = function (detail, components, spec, externals) {
      var _a;
      var switchToMenu = function (sandbox) {
        Composing.getCurrent(sandbox).each(function (current) {
          Highlighting.highlightFirst(current);
          Keying.focusIn(current);
        });
      };
      var action = function (component) {
        var onOpenSync = switchToMenu;
        togglePopup(detail, function (x) {
          return x;
        }, component, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);
      };
      var openMenu = function (comp) {
        action(comp);
        return Optional.some(true);
      };
      var executeOnButton = function (comp) {
        var button = getPartOrDie(comp, detail, 'button');
        emitExecute(button);
        return Optional.some(true);
      };
      var buttonEvents = __assign(__assign({}, derive([runOnAttached(function (component, _simulatedEvent) {
          var ariaDescriptor = getPart(component, detail, 'aria-descriptor');
          ariaDescriptor.each(function (descriptor) {
            var descriptorId = generate$1('aria');
            set$1(descriptor.element, 'id', descriptorId);
            set$1(component.element, 'aria-describedby', descriptorId);
          });
        })])), events$7(Optional.some(action)));
      var apis = {
        repositionMenus: function (comp) {
          if (Toggling.isOn(comp)) {
            repositionMenus(comp);
          }
        }
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        apis: apis,
        eventOrder: __assign(__assign({}, detail.eventOrder), (_a = {}, _a[execute()] = [
          'disabling',
          'toggling',
          'alloy.base.behaviour'
        ], _a)),
        events: buttonEvents,
        behaviours: augment(detail.splitDropdownBehaviours, [
          Coupling.config({
            others: {
              sandbox: function (hotspot) {
                var arrow = getPartOrDie(hotspot, detail, 'arrow');
                var extras = {
                  onOpen: function () {
                    Toggling.on(arrow);
                    Toggling.on(hotspot);
                  },
                  onClose: function () {
                    Toggling.off(arrow);
                    Toggling.off(hotspot);
                  }
                };
                return makeSandbox(detail, hotspot, extras);
              }
            }
          }),
          Keying.config({
            mode: 'special',
            onSpace: executeOnButton,
            onEnter: executeOnButton,
            onDown: openMenu
          }),
          Focusing.config({}),
          Toggling.config({
            toggleOnExecute: false,
            aria: { mode: 'expanded' }
          })
        ]),
        domModification: {
          attributes: {
            'role': detail.role.getOr('button'),
            'aria-haspopup': true
          }
        }
      };
    };
    var SplitDropdown = composite$1({
      name: 'SplitDropdown',
      configFields: schema$q(),
      partFields: parts$c(),
      factory: factory$e,
      apis: {
        repositionMenus: function (apis, comp) {
          return apis.repositionMenus(comp);
        }
      }
    });

    var getButtonApi = function (component) {
      return {
        isDisabled: function () {
          return Disabling.isDisabled(component);
        },
        setDisabled: function (state) {
          return Disabling.set(component, state);
        }
      };
    };
    var getToggleApi = function (component) {
      return {
        setActive: function (state) {
          Toggling.set(component, state);
        },
        isActive: function () {
          return Toggling.isOn(component);
        },
        isDisabled: function () {
          return Disabling.isDisabled(component);
        },
        setDisabled: function (state) {
          return Disabling.set(component, state);
        }
      };
    };
    var getTooltipAttributes = function (tooltip, providersBackstage) {
      return tooltip.map(function (tooltip) {
        return {
          'aria-label': providersBackstage.translate(tooltip),
          'title': providersBackstage.translate(tooltip)
        };
      }).getOr({});
    };
    var focusButtonEvent = generate$1('focus-button');
    var rtlIcon$1 = [
      'checklist',
      'ordered-list'
    ];
    var rtlTransform$1 = [
      'indent',
      'outdent',
      'table-insert-column-after',
      'table-insert-column-before',
      'unordered-list'
    ];
    var renderCommonStructure = function (icon, text, tooltip, receiver, behaviours, providersBackstage) {
      var _d;
      var getIconName = function (iconName) {
        return global$6.isRtl() && contains(rtlIcon$1, iconName) ? iconName + '-rtl' : iconName;
      };
      var needsRtlClass = global$6.isRtl() && icon.exists(function (name) {
        return contains(rtlTransform$1, name);
      });
      return {
        dom: {
          tag: 'button',
          classes: ['tox-tbtn'].concat(text.isSome() ? ['tox-tbtn--select'] : []).concat(needsRtlClass ? ['tox-tbtn__icon-rtl'] : []),
          attributes: getTooltipAttributes(tooltip, providersBackstage)
        },
        components: componentRenderPipeline([
          icon.map(function (iconName) {
            return renderIconFromPack(getIconName(iconName), providersBackstage.icons);
          }),
          text.map(function (text) {
            return renderLabel$1(text, 'tox-tbtn', providersBackstage);
          })
        ]),
        eventOrder: (_d = {}, _d[mousedown()] = [
          'focusing',
          'alloy.base.behaviour',
          'common-button-display-events'
        ], _d),
        buttonBehaviours: derive$1([
          DisablingConfigs.toolbarButton(providersBackstage.isDisabled),
          receivingConfig(),
          config('common-button-display-events', [run(mousedown(), function (button, se) {
              se.event.prevent();
              emit(button, focusButtonEvent);
            })])
        ].concat(receiver.map(function (r) {
          return Reflecting.config({
            channel: r,
            initialData: {
              icon: icon,
              text: text
            },
            renderComponents: function (data, _state) {
              return componentRenderPipeline([
                data.icon.map(function (iconName) {
                  return renderIconFromPack(getIconName(iconName), providersBackstage.icons);
                }),
                data.text.map(function (text) {
                  return renderLabel$1(text, 'tox-tbtn', providersBackstage);
                })
              ]);
            }
          });
        }).toArray()).concat(behaviours.getOr([])))
      };
    };
    var renderFloatingToolbarButton = function (spec, backstage, identifyButtons, attributes) {
      var sharedBackstage = backstage.shared;
      return FloatingToolbarButton.sketch({
        lazySink: sharedBackstage.getSink,
        fetch: function () {
          return Future.nu(function (resolve) {
            resolve(map(identifyButtons(spec.items), renderToolbarGroup));
          });
        },
        markers: { toggledClass: 'tox-tbtn--enabled' },
        parts: {
          button: renderCommonStructure(spec.icon, spec.text, spec.tooltip, Optional.none(), Optional.none(), sharedBackstage.providers),
          toolbar: {
            dom: {
              tag: 'div',
              classes: ['tox-toolbar__overflow'],
              attributes: attributes
            }
          }
        }
      });
    };
    var renderCommonToolbarButton = function (spec, specialisation, providersBackstage) {
      var editorOffCell = Cell(noop);
      var structure = renderCommonStructure(spec.icon, spec.text, spec.tooltip, Optional.none(), Optional.none(), providersBackstage);
      return Button.sketch({
        dom: structure.dom,
        components: structure.components,
        eventOrder: toolbarButtonEventOrder,
        buttonBehaviours: derive$1([
          config('toolbar-button-events', [
            onToolbarButtonExecute({
              onAction: spec.onAction,
              getApi: specialisation.getApi
            }),
            onControlAttached(specialisation, editorOffCell),
            onControlDetached(specialisation, editorOffCell)
          ]),
          DisablingConfigs.toolbarButton(function () {
            return spec.disabled || providersBackstage.isDisabled();
          }),
          receivingConfig()
        ].concat(specialisation.toolbarButtonBehaviours))
      });
    };
    var renderToolbarButton = function (spec, providersBackstage) {
      return renderToolbarButtonWith(spec, providersBackstage, []);
    };
    var renderToolbarButtonWith = function (spec, providersBackstage, bonusEvents) {
      return renderCommonToolbarButton(spec, {
        toolbarButtonBehaviours: [].concat(bonusEvents.length > 0 ? [config('toolbarButtonWith', bonusEvents)] : []),
        getApi: getButtonApi,
        onSetup: spec.onSetup
      }, providersBackstage);
    };
    var renderToolbarToggleButton = function (spec, providersBackstage) {
      return renderToolbarToggleButtonWith(spec, providersBackstage, []);
    };
    var renderToolbarToggleButtonWith = function (spec, providersBackstage, bonusEvents) {
      return deepMerge(renderCommonToolbarButton(spec, {
        toolbarButtonBehaviours: [
          Replacing.config({}),
          Toggling.config({
            toggleClass: 'tox-tbtn--enabled',
            aria: { mode: 'pressed' },
            toggleOnExecute: false
          })
        ].concat(bonusEvents.length > 0 ? [config('toolbarToggleButtonWith', bonusEvents)] : []),
        getApi: getToggleApi,
        onSetup: spec.onSetup
      }, providersBackstage));
    };
    var fetchChoices = function (getApi, spec, providersBackstage) {
      return function (comp) {
        return Future.nu(function (callback) {
          return spec.fetch(callback);
        }).map(function (items) {
          return Optional.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$1('menu-value'), items, function (value) {
            spec.onItemAction(getApi(comp), value);
          }, spec.columns, spec.presets, ItemResponse$1.CLOSE_ON_EXECUTE, spec.select.getOr(never), providersBackstage), {
            movement: deriveMenuMovement(spec.columns, spec.presets),
            menuBehaviours: SimpleBehaviours.unnamedEvents(spec.columns !== 'auto' ? [] : [runOnAttached(function (comp, _se) {
                detectSize(comp, 4, classForPreset(spec.presets)).each(function (_d) {
                  var numRows = _d.numRows, numColumns = _d.numColumns;
                  Keying.setGridSize(comp, numRows, numColumns);
                });
              })])
          })));
        });
      };
    };
    var renderSplitButton = function (spec, sharedBackstage) {
      var _d;
      var displayChannel = generate$1('channel-update-split-dropdown-display');
      var getApi = function (comp) {
        return {
          isDisabled: function () {
            return Disabling.isDisabled(comp);
          },
          setDisabled: function (state) {
            return Disabling.set(comp, state);
          },
          setIconFill: function (id, value) {
            descendant$1(comp.element, 'svg path[id="' + id + '"], rect[id="' + id + '"]').each(function (underlinePath) {
              set$1(underlinePath, 'fill', value);
            });
          },
          setIconStroke: function (id, value) {
            descendant$1(comp.element, 'svg path[id="' + id + '"], rect[id="' + id + '"]').each(function (underlinePath) {
              set$1(underlinePath, 'stroke', value);
            });
          },
          setActive: function (state) {
            if (comp.getSystem().isConnected()) {
              set$1(comp.element, 'aria-pressed', state);
              descendant$1(comp.element, 'span').each(function (button) {
                comp.getSystem().getByDom(button).each(function (buttonComp) {
                  return Toggling.set(buttonComp, state);
                });
              });
            }
          },
          isActive: function () {
            return descendant$1(comp.element, 'span').exists(function (button) {
              if (comp.getSystem().isConnected()) {
                return comp.getSystem().getByDom(button).exists(Toggling.isOn);
              } else {
                return false;
              }
            });
          }
        };
      };
      var editorOffCell = Cell(noop);
      var specialisation = {
        getApi: getApi,
        onSetup: spec.onSetup
      };
      return SplitDropdown.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-split-button'],
          attributes: __assign({ 'aria-pressed': false }, getTooltipAttributes(spec.tooltip, sharedBackstage.providers))
        },
        onExecute: function (button) {
          spec.onAction(getApi(button));
        },
        onItemExecute: function (_a, _b, _c) {
        },
        splitDropdownBehaviours: derive$1([
          DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),
          receivingConfig(),
          config('split-dropdown-events', [
            run(focusButtonEvent, Focusing.focus),
            onControlAttached(specialisation, editorOffCell),
            onControlDetached(specialisation, editorOffCell)
          ]),
          Unselecting.config({})
        ]),
        eventOrder: (_d = {}, _d[attachedToDom()] = [
          'alloy.base.behaviour',
          'split-dropdown-events'
        ], _d),
        toggleClass: 'tox-tbtn--enabled',
        lazySink: sharedBackstage.getSink,
        fetch: fetchChoices(getApi, spec, sharedBackstage.providers),
        parts: { menu: part(false, spec.columns, spec.presets) },
        components: [
          SplitDropdown.parts.button(renderCommonStructure(spec.icon, spec.text, Optional.none(), Optional.some(displayChannel), Optional.some([Toggling.config({
              toggleClass: 'tox-tbtn--enabled',
              toggleOnExecute: false
            })]), sharedBackstage.providers)),
          SplitDropdown.parts.arrow({
            dom: {
              tag: 'button',
              classes: [
                'tox-tbtn',
                'tox-split-button__chevron'
              ],
              innerHtml: get$e('chevron-down', sharedBackstage.providers.icons)
            },
            buttonBehaviours: derive$1([
              DisablingConfigs.splitButton(sharedBackstage.providers.isDisabled),
              receivingConfig()
            ])
          }),
          SplitDropdown.parts['aria-descriptor']({ text: sharedBackstage.providers.translate('To open the popup, press Shift+Enter') })
        ]
      });
    };

    var getFormApi = function (input) {
      return {
        hide: function () {
          return emit(input, sandboxClose());
        },
        getValue: function () {
          return Representing.getValue(input);
        }
      };
    };
    var runOnExecute$1 = function (memInput, original) {
      return run(internalToolbarButtonExecute, function (comp, se) {
        var input = memInput.get(comp);
        var formApi = getFormApi(input);
        original.onAction(formApi, se.event.buttonApi);
      });
    };
    var renderContextButton = function (memInput, button, extras) {
      var _a = button.original, primary = _a.primary, rest = __rest(_a, ['primary']);
      var bridged = getOrDie(createToolbarButton(__assign(__assign({}, rest), {
        type: 'button',
        onAction: noop
      })));
      return renderToolbarButtonWith(bridged, extras.backstage.shared.providers, [runOnExecute$1(memInput, button)]);
    };
    var renderContextToggleButton = function (memInput, button, extras) {
      var _a = button.original, primary = _a.primary, rest = __rest(_a, ['primary']);
      var bridged = getOrDie(createToggleButton(__assign(__assign({}, rest), {
        type: 'togglebutton',
        onAction: noop
      })));
      return renderToolbarToggleButtonWith(bridged, extras.backstage.shared.providers, [runOnExecute$1(memInput, button)]);
    };
    var generateOne$1 = function (memInput, button, providersBackstage) {
      var extras = { backstage: { shared: { providers: providersBackstage } } };
      if (button.type === 'contextformtogglebutton') {
        return renderContextToggleButton(memInput, button, extras);
      } else {
        return renderContextButton(memInput, button, extras);
      }
    };
    var generate$7 = function (memInput, buttons, providersBackstage) {
      var mementos = map(buttons, function (button) {
        return record(generateOne$1(memInput, button, providersBackstage));
      });
      var asSpecs = function () {
        return map(mementos, function (mem) {
          return mem.asSpec();
        });
      };
      var findPrimary = function (compInSystem) {
        return findMap(buttons, function (button, i) {
          if (button.primary) {
            return Optional.from(mementos[i]).bind(function (mem) {
              return mem.getOpt(compInSystem);
            }).filter(not(Disabling.isDisabled));
          } else {
            return Optional.none();
          }
        });
      };
      return {
        asSpecs: asSpecs,
        findPrimary: findPrimary
      };
    };

    var buildInitGroups = function (ctx, providers) {
      var inputAttributes = ctx.label.fold(function () {
        return {};
      }, function (label) {
        return { 'aria-label': label };
      });
      var memInput = record(Input.sketch({
        inputClasses: [
          'tox-toolbar-textfield',
          'tox-toolbar-nav-js'
        ],
        data: ctx.initValue(),
        inputAttributes: inputAttributes,
        selectOnFocus: true,
        inputBehaviours: derive$1([Keying.config({
            mode: 'special',
            onEnter: function (input) {
              return commands.findPrimary(input).map(function (primary) {
                emitExecute(primary);
                return true;
              });
            },
            onLeft: function (comp, se) {
              se.cut();
              return Optional.none();
            },
            onRight: function (comp, se) {
              se.cut();
              return Optional.none();
            }
          })])
      }));
      var commands = generate$7(memInput, ctx.commands, providers);
      return [
        {
          title: Optional.none(),
          items: [memInput.asSpec()]
        },
        {
          title: Optional.none(),
          items: commands.asSpecs()
        }
      ];
    };
    var renderContextForm = function (toolbarType, ctx, providers) {
      return renderToolbar({
        type: toolbarType,
        uid: generate$1('context-toolbar'),
        initGroups: buildInitGroups(ctx, providers),
        onEscape: Optional.none,
        cyclicKeying: true,
        providers: providers
      });
    };
    var ContextForm = {
      renderContextForm: renderContextForm,
      buildInitGroups: buildInitGroups
    };

    var getHorizontalBounds = function (contentAreaBox, viewportBounds) {
      var x = Math.max(viewportBounds.x, contentAreaBox.x);
      var contentBoxWidth = contentAreaBox.right - x;
      var maxViewportWidth = viewportBounds.width - (x - viewportBounds.x);
      var width = Math.min(contentBoxWidth, maxViewportWidth);
      return {
        x: x,
        width: width
      };
    };
    var getVerticalBounds = function (editor, contentAreaBox, viewportBounds, isToolbarLocationTop) {
      var container = SugarElement.fromDom(editor.getContainer());
      var header = descendant$1(container, '.tox-editor-header').getOr(container);
      var headerBox = box(header);
      var isToolbarBelowContentArea = headerBox.y >= contentAreaBox.bottom;
      var isToolbarAbove = isToolbarLocationTop && !isToolbarBelowContentArea;
      if (editor.inline && isToolbarAbove) {
        return {
          y: Math.max(headerBox.bottom, viewportBounds.y),
          bottom: viewportBounds.bottom
        };
      }
      if (editor.inline && !isToolbarAbove) {
        return {
          y: viewportBounds.y,
          bottom: Math.min(headerBox.y, viewportBounds.bottom)
        };
      }
      var containerBounds = box(container);
      if (isToolbarAbove) {
        return {
          y: Math.max(headerBox.bottom, viewportBounds.y),
          bottom: Math.min(containerBounds.bottom, viewportBounds.bottom)
        };
      }
      return {
        y: Math.max(containerBounds.y, viewportBounds.y),
        bottom: Math.min(headerBox.y, viewportBounds.bottom)
      };
    };
    var getContextToolbarBounds = function (editor, sharedBackstage) {
      var viewportBounds = getBounds(window);
      var contentAreaBox = box(SugarElement.fromDom(editor.getContentAreaContainer()));
      var toolbarOrMenubarEnabled = isMenubarEnabled(editor) || isToolbarEnabled(editor) || isMultipleToolbars(editor);
      var _a = getHorizontalBounds(contentAreaBox, viewportBounds), x = _a.x, width = _a.width;
      if (editor.inline && !toolbarOrMenubarEnabled) {
        return bounds$1(x, viewportBounds.y, width, viewportBounds.height);
      } else {
        var isToolbarTop = sharedBackstage.header.isPositionedAtTop();
        var _b = getVerticalBounds(editor, contentAreaBox, viewportBounds, isToolbarTop), y = _b.y, bottom = _b.bottom;
        return bounds$1(x, y, width, bottom - y);
      }
    };

    var matchTargetWith = function (elem, candidates) {
      var ctxs = filter(candidates, function (toolbarApi) {
        return toolbarApi.predicate(elem.dom);
      });
      var _a = partition(ctxs, function (t) {
          return t.type === 'contexttoolbar';
        }), pass = _a.pass, fail = _a.fail;
      return {
        contextToolbars: pass,
        contextForms: fail
      };
    };
    var filterByPositionForStartNode = function (toolbars) {
      if (toolbars.length <= 1) {
        return toolbars;
      } else {
        var doesPositionExist = function (value) {
          return exists(toolbars, function (t) {
            return t.position === value;
          });
        };
        var filterToolbarsByPosition = function (value) {
          return filter(toolbars, function (t) {
            return t.position === value;
          });
        };
        var hasSelectionToolbars = doesPositionExist('selection');
        var hasNodeToolbars = doesPositionExist('node');
        if (hasSelectionToolbars || hasNodeToolbars) {
          if (hasNodeToolbars && hasSelectionToolbars) {
            var nodeToolbars = filterToolbarsByPosition('node');
            var selectionToolbars = map(filterToolbarsByPosition('selection'), function (t) {
              return __assign(__assign({}, t), { position: 'node' });
            });
            return nodeToolbars.concat(selectionToolbars);
          } else {
            return hasSelectionToolbars ? filterToolbarsByPosition('selection') : filterToolbarsByPosition('node');
          }
        } else {
          return filterToolbarsByPosition('line');
        }
      }
    };
    var filterByPositionForAncestorNode = function (toolbars) {
      if (toolbars.length <= 1) {
        return toolbars;
      } else {
        var findPosition_1 = function (value) {
          return find(toolbars, function (t) {
            return t.position === value;
          });
        };
        var basePosition = findPosition_1('selection').orThunk(function () {
          return findPosition_1('node');
        }).orThunk(function () {
          return findPosition_1('line');
        }).map(function (t) {
          return t.position;
        });
        return basePosition.fold(function () {
          return [];
        }, function (pos) {
          return filter(toolbars, function (t) {
            return t.position === pos;
          });
        });
      }
    };
    var matchStartNode = function (elem, nodeCandidates, editorCandidates) {
      var nodeMatches = matchTargetWith(elem, nodeCandidates);
      if (nodeMatches.contextForms.length > 0) {
        return Optional.some({
          elem: elem,
          toolbars: [nodeMatches.contextForms[0]]
        });
      } else {
        var editorMatches = matchTargetWith(elem, editorCandidates);
        if (editorMatches.contextForms.length > 0) {
          return Optional.some({
            elem: elem,
            toolbars: [editorMatches.contextForms[0]]
          });
        } else if (nodeMatches.contextToolbars.length > 0 || editorMatches.contextToolbars.length > 0) {
          var toolbars = filterByPositionForStartNode(nodeMatches.contextToolbars.concat(editorMatches.contextToolbars));
          return Optional.some({
            elem: elem,
            toolbars: toolbars
          });
        } else {
          return Optional.none();
        }
      }
    };
    var matchAncestor = function (isRoot, startNode, scopes) {
      if (isRoot(startNode)) {
        return Optional.none();
      } else {
        return ancestor(startNode, function (ancestorElem) {
          var _a = matchTargetWith(ancestorElem, scopes.inNodeScope), contextToolbars = _a.contextToolbars, contextForms = _a.contextForms;
          var toolbars = contextForms.length > 0 ? contextForms : filterByPositionForAncestorNode(contextToolbars);
          return toolbars.length > 0 ? Optional.some({
            elem: ancestorElem,
            toolbars: toolbars
          }) : Optional.none();
        }, isRoot);
      }
    };
    var lookup$1 = function (scopes, editor) {
      var rootElem = SugarElement.fromDom(editor.getBody());
      var isRoot = function (elem) {
        return eq$1(elem, rootElem);
      };
      var isOutsideRoot = function (startNode) {
        return !isRoot(startNode) && !contains$2(rootElem, startNode);
      };
      var startNode = SugarElement.fromDom(editor.selection.getNode());
      if (isOutsideRoot(startNode)) {
        return Optional.none();
      }
      return matchStartNode(startNode, scopes.inNodeScope, scopes.inEditorScope).orThunk(function () {
        return matchAncestor(isRoot, startNode, scopes);
      });
    };

    var categorise = function (contextToolbars, navigate) {
      var forms = {};
      var inNodeScope = [];
      var inEditorScope = [];
      var formNavigators = {};
      var lookupTable = {};
      var registerForm = function (key, toolbarSpec) {
        var contextForm = getOrDie(createContextForm(toolbarSpec));
        forms[key] = contextForm;
        contextForm.launch.map(function (launch) {
          formNavigators['form:' + key + ''] = __assign(__assign({}, toolbarSpec.launch), {
            type: launch.type === 'contextformtogglebutton' ? 'togglebutton' : 'button',
            onAction: function () {
              navigate(contextForm);
            }
          });
        });
        if (contextForm.scope === 'editor') {
          inEditorScope.push(contextForm);
        } else {
          inNodeScope.push(contextForm);
        }
        lookupTable[key] = contextForm;
      };
      var registerToolbar = function (key, toolbarSpec) {
        createContextToolbar(toolbarSpec).each(function (contextToolbar) {
          if (toolbarSpec.scope === 'editor') {
            inEditorScope.push(contextToolbar);
          } else {
            inNodeScope.push(contextToolbar);
          }
          lookupTable[key] = contextToolbar;
        });
      };
      var keys$1 = keys(contextToolbars);
      each(keys$1, function (key) {
        var toolbarApi = contextToolbars[key];
        if (toolbarApi.type === 'contextform') {
          registerForm(key, toolbarApi);
        } else if (toolbarApi.type === 'contexttoolbar') {
          registerToolbar(key, toolbarApi);
        }
      });
      return {
        forms: forms,
        inNodeScope: inNodeScope,
        inEditorScope: inEditorScope,
        lookupTable: lookupTable,
        formNavigators: formNavigators
      };
    };

    var forwardSlideEvent = generate$1('forward-slide');
    var backSlideEvent = generate$1('backward-slide');
    var changeSlideEvent = generate$1('change-slide-event');
    var resizingClass = 'tox-pop--resizing';
    var renderContextToolbar = function (spec) {
      var stack = Cell([]);
      return InlineView.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-pop']
        },
        fireDismissalEventInstead: { event: 'doNotDismissYet' },
        onShow: function (comp) {
          stack.set([]);
          InlineView.getContent(comp).each(function (c) {
            remove$6(c.element, 'visibility');
          });
          remove$4(comp.element, resizingClass);
          remove$6(comp.element, 'width');
        },
        inlineBehaviours: derive$1([
          config('context-toolbar-events', [
            runOnSource(transitionend(), function (comp, _se) {
              remove$4(comp.element, resizingClass);
              remove$6(comp.element, 'width');
            }),
            run(changeSlideEvent, function (comp, se) {
              var elem = comp.element;
              remove$6(elem, 'width');
              var currentWidth = get$8(elem);
              InlineView.setContent(comp, se.event.contents);
              add$2(elem, resizingClass);
              var newWidth = get$8(elem);
              set$2(elem, 'width', currentWidth + 'px');
              InlineView.getContent(comp).each(function (newContents) {
                se.event.focus.bind(function (f) {
                  focus$1(f);
                  return search(elem);
                }).orThunk(function () {
                  Keying.focusIn(newContents);
                  return active(getRootNode(elem));
                });
              });
              global$2.setTimeout(function () {
                set$2(comp.element, 'width', newWidth + 'px');
              }, 0);
            }),
            run(forwardSlideEvent, function (comp, se) {
              InlineView.getContent(comp).each(function (oldContents) {
                stack.set(stack.get().concat([{
                    bar: oldContents,
                    focus: active(getRootNode(comp.element))
                  }]));
              });
              emitWith(comp, changeSlideEvent, {
                contents: se.event.forwardContents,
                focus: Optional.none()
              });
            }),
            run(backSlideEvent, function (comp, _se) {
              last(stack.get()).each(function (last) {
                stack.set(stack.get().slice(0, stack.get().length - 1));
                emitWith(comp, changeSlideEvent, {
                  contents: premade$1(last.bar),
                  focus: last.focus
                });
              });
            })
          ]),
          Keying.config({
            mode: 'special',
            onEscape: function (comp) {
              return last(stack.get()).fold(function () {
                return spec.onEscape();
              }, function (_) {
                emit(comp, backSlideEvent);
                return Optional.some(true);
              });
            }
          })
        ]),
        lazySink: function () {
          return Result.value(spec.sink);
        }
      });
    };

    var generateSelectItems = function (_editor, backstage, spec) {
      var generateItem = function (rawItem, response, disabled, value) {
        var translatedText = backstage.shared.providers.translate(rawItem.title);
        if (rawItem.type === 'separator') {
          return Optional.some({
            type: 'separator',
            text: translatedText
          });
        } else if (rawItem.type === 'submenu') {
          var items = bind(rawItem.getStyleItems(), function (si) {
            return validate(si, response, value);
          });
          if (response === 0 && items.length <= 0) {
            return Optional.none();
          } else {
            return Optional.some({
              type: 'nestedmenuitem',
              text: translatedText,
              disabled: items.length <= 0,
              getSubmenuItems: function () {
                return bind(rawItem.getStyleItems(), function (si) {
                  return validate(si, response, value);
                });
              }
            });
          }
        } else {
          return Optional.some(__assign({
            type: 'togglemenuitem',
            text: translatedText,
            icon: rawItem.icon,
            active: rawItem.isSelected(value),
            disabled: disabled,
            onAction: spec.onAction(rawItem)
          }, rawItem.getStylePreview().fold(function () {
            return {};
          }, function (preview) {
            return { meta: { style: preview } };
          })));
        }
      };
      var validate = function (item, response, value) {
        var invalid = item.type === 'formatter' && spec.isInvalid(item);
        if (response === 0) {
          return invalid ? [] : generateItem(item, response, false, value).toArray();
        } else {
          return generateItem(item, response, invalid, value).toArray();
        }
      };
      var validateItems = function (preItems) {
        var value = spec.getCurrentValue();
        var response = spec.shouldHide ? 0 : 1;
        return bind(preItems, function (item) {
          return validate(item, response, value);
        });
      };
      var getFetch = function (backstage, getStyleItems) {
        return function (comp, callback) {
          var preItems = getStyleItems();
          var items = validateItems(preItems);
          var menu = build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage, false);
          callback(menu);
        };
      };
      return {
        validateItems: validateItems,
        getFetch: getFetch
      };
    };
    var createMenuItems = function (editor, backstage, spec) {
      var dataset = spec.dataset;
      var getStyleItems = dataset.type === 'basic' ? function () {
        return map(dataset.data, function (d) {
          return processBasic(d, spec.isSelectedFor, spec.getPreviewFor);
        });
      } : dataset.getData;
      return {
        items: generateSelectItems(editor, backstage, spec),
        getStyleItems: getStyleItems
      };
    };
    var createSelectButton = function (editor, backstage, spec) {
      var _a = createMenuItems(editor, backstage, spec), items = _a.items, getStyleItems = _a.getStyleItems;
      var getApi = function (comp) {
        return { getComponent: constant(comp) };
      };
      var onSetup = function (api) {
        var updateText = function () {
          var comp = api.getComponent();
          if (comp.getSystem().isConnected()) {
            spec.updateText(comp);
          }
        };
        updateText();
        editor.on('NodeChange', updateText);
        return function () {
          editor.off('NodeChange', updateText);
        };
      };
      return renderCommonDropdown({
        text: spec.icon.isSome() ? Optional.none() : Optional.some(''),
        icon: spec.icon,
        tooltip: Optional.from(spec.tooltip),
        role: Optional.none(),
        fetch: items.getFetch(backstage, getStyleItems),
        onSetup: onSetup,
        getApi: getApi,
        columns: 1,
        presets: 'normal',
        classes: spec.icon.isSome() ? [] : ['bespoke'],
        dropdownBehaviours: []
      }, 'tox-tbtn', backstage.shared);
    };

    var process = function (rawFormats) {
      return map(rawFormats, function (item) {
        var title = item, format = item;
        var values = item.split('=');
        if (values.length > 1) {
          title = values[0];
          format = values[1];
        }
        return {
          title: title,
          format: format
        };
      });
    };
    var buildBasicStaticDataset = function (data) {
      return {
        type: 'basic',
        data: data
      };
    };
    var Delimiter;
    (function (Delimiter) {
      Delimiter[Delimiter['SemiColon'] = 0] = 'SemiColon';
      Delimiter[Delimiter['Space'] = 1] = 'Space';
    }(Delimiter || (Delimiter = {})));
    var split = function (rawFormats, delimiter) {
      if (delimiter === Delimiter.SemiColon) {
        return rawFormats.replace(/;$/, '').split(';');
      } else {
        return rawFormats.split(' ');
      }
    };
    var buildBasicSettingsDataset = function (editor, settingName, defaults, delimiter) {
      var rawFormats = editor.getParam(settingName, defaults, 'string');
      var data = process(split(rawFormats, delimiter));
      return {
        type: 'basic',
        data: data
      };
    };

    var alignMenuItems = [
      {
        title: 'Left',
        icon: 'align-left',
        format: 'alignleft',
        command: 'JustifyLeft'
      },
      {
        title: 'Center',
        icon: 'align-center',
        format: 'aligncenter',
        command: 'JustifyCenter'
      },
      {
        title: 'Right',
        icon: 'align-right',
        format: 'alignright',
        command: 'JustifyRight'
      },
      {
        title: 'Justify',
        icon: 'align-justify',
        format: 'alignjustify',
        command: 'JustifyFull'
      }
    ];
    var getSpec = function (editor) {
      var getMatchingValue = function () {
        return find(alignMenuItems, function (item) {
          return editor.formatter.match(item.format);
        });
      };
      var isSelectedFor = function (format) {
        return function () {
          return editor.formatter.match(format);
        };
      };
      var getPreviewFor = function (_format) {
        return function () {
          return Optional.none();
        };
      };
      var updateSelectMenuIcon = function (comp) {
        var match = getMatchingValue();
        var alignment = match.fold(function () {
          return 'left';
        }, function (item) {
          return item.title.toLowerCase();
        });
        emitWith(comp, updateMenuIcon, { icon: 'align-' + alignment });
      };
      var dataset = buildBasicStaticDataset(alignMenuItems);
      var onAction = function (rawItem) {
        return function () {
          return find(alignMenuItems, function (item) {
            return item.format === rawItem.format;
          }).each(function (item) {
            return editor.execCommand(item.command);
          });
        };
      };
      return {
        tooltip: 'Align',
        icon: Optional.some('align-left'),
        isSelectedFor: isSelectedFor,
        getCurrentValue: Optional.none,
        getPreviewFor: getPreviewFor,
        onAction: onAction,
        updateText: updateSelectMenuIcon,
        dataset: dataset,
        shouldHide: false,
        isInvalid: function (item) {
          return !editor.formatter.canApply(item.format);
        }
      };
    };
    var createAlignSelect = function (editor, backstage) {
      return createSelectButton(editor, backstage, getSpec(editor));
    };
    var alignSelectMenu = function (editor, backstage) {
      var menuItems = createMenuItems(editor, backstage, getSpec(editor));
      editor.ui.registry.addNestedMenuItem('align', {
        text: backstage.shared.providers.translate('Align'),
        getSubmenuItems: function () {
          return menuItems.items.validateItems(menuItems.getStyleItems());
        }
      });
    };

    var defaultFontsFormats = 'Andale Mono=andale mono,monospace;' + 'Arial=arial,helvetica,sans-serif;' + 'Arial Black=arial black,sans-serif;' + 'Book Antiqua=book antiqua,palatino,serif;' + 'Comic Sans MS=comic sans ms,sans-serif;' + 'Courier New=courier new,courier,monospace;' + 'Georgia=georgia,palatino,serif;' + 'Helvetica=helvetica,arial,sans-serif;' + 'Impact=impact,sans-serif;' + 'Symbol=symbol;' + 'Tahoma=tahoma,arial,helvetica,sans-serif;' + 'Terminal=terminal,monaco,monospace;' + 'Times New Roman=times new roman,times,serif;' + 'Trebuchet MS=trebuchet ms,geneva,sans-serif;' + 'Verdana=verdana,geneva,sans-serif;' + 'Webdings=webdings;' + 'Wingdings=wingdings,zapf dingbats';
    var systemStackFonts = [
      '-apple-system',
      'Segoe UI',
      'Roboto',
      'Helvetica Neue',
      'sans-serif'
    ];
    var splitFonts = function (fontFamily) {
      var fonts = fontFamily.split(/\s*,\s*/);
      return map(fonts, function (font) {
        return font.replace(/^['"]+|['"]+$/g, '');
      });
    };
    var isSystemFontStack = function (fontFamily) {
      var matchesSystemStack = function () {
        var fonts = splitFonts(fontFamily.toLowerCase());
        return forall(systemStackFonts, function (font) {
          return fonts.indexOf(font.toLowerCase()) > -1;
        });
      };
      return fontFamily.indexOf('-apple-system') === 0 && matchesSystemStack();
    };
    var getSpec$1 = function (editor) {
      var getMatchingValue = function () {
        var getFirstFont = function (fontFamily) {
          return fontFamily ? splitFonts(fontFamily)[0] : '';
        };
        var fontFamily = editor.queryCommandValue('FontName');
        var items = dataset.data;
        var font = fontFamily ? fontFamily.toLowerCase() : '';
        var matchOpt = find(items, function (item) {
          var format = item.format;
          return format.toLowerCase() === font || getFirstFont(format).toLowerCase() === getFirstFont(font).toLowerCase();
        }).orThunk(function () {
          if (isSystemFontStack(font)) {
            return Optional.from({
              title: 'System Font',
              format: font
            });
          } else {
            return Optional.none();
          }
        });
        return {
          matchOpt: matchOpt,
          font: fontFamily
        };
      };
      var isSelectedFor = function (item) {
        return function (valueOpt) {
          return valueOpt.exists(function (value) {
            return value.format === item;
          });
        };
      };
      var getCurrentValue = function () {
        var matchOpt = getMatchingValue().matchOpt;
        return matchOpt;
      };
      var getPreviewFor = function (item) {
        return function () {
          return Optional.some({
            tag: 'div',
            styles: item.indexOf('dings') === -1 ? { 'font-family': item } : {}
          });
        };
      };
      var onAction = function (rawItem) {
        return function () {
          editor.undoManager.transact(function () {
            editor.focus();
            editor.execCommand('FontName', false, rawItem.format);
          });
        };
      };
      var updateSelectMenuText = function (comp) {
        var _a = getMatchingValue(), matchOpt = _a.matchOpt, font = _a.font;
        var text = matchOpt.fold(function () {
          return font;
        }, function (item) {
          return item.title;
        });
        emitWith(comp, updateMenuText, { text: text });
      };
      var dataset = buildBasicSettingsDataset(editor, 'font_formats', defaultFontsFormats, Delimiter.SemiColon);
      return {
        tooltip: 'Fonts',
        icon: Optional.none(),
        isSelectedFor: isSelectedFor,
        getCurrentValue: getCurrentValue,
        getPreviewFor: getPreviewFor,
        onAction: onAction,
        updateText: updateSelectMenuText,
        dataset: dataset,
        shouldHide: false,
        isInvalid: never
      };
    };
    var createFontSelect = function (editor, backstage) {
      return createSelectButton(editor, backstage, getSpec$1(editor));
    };
    var fontSelectMenu = function (editor, backstage) {
      var menuItems = createMenuItems(editor, backstage, getSpec$1(editor));
      editor.ui.registry.addNestedMenuItem('fontformats', {
        text: backstage.shared.providers.translate('Fonts'),
        getSubmenuItems: function () {
          return menuItems.items.validateItems(menuItems.getStyleItems());
        }
      });
    };

    var defaultFontsizeFormats = '8pt 10pt 12pt 14pt 18pt 24pt 36pt';
    var legacyFontSizes = {
      '8pt': '1',
      '10pt': '2',
      '12pt': '3',
      '14pt': '4',
      '18pt': '5',
      '24pt': '6',
      '36pt': '7'
    };
    var keywordFontSizes = {
      'xx-small': '7pt',
      'x-small': '8pt',
      'small': '10pt',
      'medium': '12pt',
      'large': '14pt',
      'x-large': '18pt',
      'xx-large': '24pt'
    };
    var round$1 = function (number, precision) {
      var factor = Math.pow(10, precision);
      return Math.round(number * factor) / factor;
    };
    var toPt = function (fontSize, precision) {
      if (/[0-9.]+px$/.test(fontSize)) {
        return round$1(parseInt(fontSize, 10) * 72 / 96, precision || 0) + 'pt';
      } else {
        return get$1(keywordFontSizes, fontSize).getOr(fontSize);
      }
    };
    var toLegacy = function (fontSize) {
      return get$1(legacyFontSizes, fontSize).getOr('');
    };
    var getSpec$2 = function (editor) {
      var getMatchingValue = function () {
        var matchOpt = Optional.none();
        var items = dataset.data;
        var fontSize = editor.queryCommandValue('FontSize');
        if (fontSize) {
          var _loop_1 = function (precision) {
            var pt = toPt(fontSize, precision);
            var legacy = toLegacy(pt);
            matchOpt = find(items, function (item) {
              return item.format === fontSize || item.format === pt || item.format === legacy;
            });
          };
          for (var precision = 3; matchOpt.isNone() && precision >= 0; precision--) {
            _loop_1(precision);
          }
        }
        return {
          matchOpt: matchOpt,
          size: fontSize
        };
      };
      var isSelectedFor = function (item) {
        return function (valueOpt) {
          return valueOpt.exists(function (value) {
            return value.format === item;
          });
        };
      };
      var getCurrentValue = function () {
        var matchOpt = getMatchingValue().matchOpt;
        return matchOpt;
      };
      var getPreviewFor = constant(Optional.none);
      var onAction = function (rawItem) {
        return function () {
          editor.undoManager.transact(function () {
            editor.focus();
            editor.execCommand('FontSize', false, rawItem.format);
          });
        };
      };
      var updateSelectMenuText = function (comp) {
        var _a = getMatchingValue(), matchOpt = _a.matchOpt, size = _a.size;
        var text = matchOpt.fold(function () {
          return size;
        }, function (match) {
          return match.title;
        });
        emitWith(comp, updateMenuText, { text: text });
      };
      var dataset = buildBasicSettingsDataset(editor, 'fontsize_formats', defaultFontsizeFormats, Delimiter.Space);
      return {
        tooltip: 'Font sizes',
        icon: Optional.none(),
        isSelectedFor: isSelectedFor,
        getPreviewFor: getPreviewFor,
        getCurrentValue: getCurrentValue,
        onAction: onAction,
        updateText: updateSelectMenuText,
        dataset: dataset,
        shouldHide: false,
        isInvalid: never
      };
    };
    var createFontsizeSelect = function (editor, backstage) {
      return createSelectButton(editor, backstage, getSpec$2(editor));
    };
    var fontsizeSelectMenu = function (editor, backstage) {
      var menuItems = createMenuItems(editor, backstage, getSpec$2(editor));
      editor.ui.registry.addNestedMenuItem('fontsizes', {
        text: 'Font sizes',
        getSubmenuItems: function () {
          return menuItems.items.validateItems(menuItems.getStyleItems());
        }
      });
    };

    var findNearest = function (editor, getStyles) {
      var styles = getStyles();
      var formats = map(styles, function (style) {
        return style.format;
      });
      return Optional.from(editor.formatter.closest(formats)).bind(function (fmt) {
        return find(styles, function (data) {
          return data.format === fmt;
        });
      }).orThunk(function () {
        return someIf(editor.formatter.match('p'), {
          title: 'Paragraph',
          format: 'p'
        });
      });
    };

    var revocable = function (doRevoke) {
      var subject = Cell(Optional.none());
      var revoke = function () {
        return subject.get().each(doRevoke);
      };
      var clear = function () {
        revoke();
        subject.set(Optional.none());
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var set = function (s) {
        revoke();
        subject.set(Optional.some(s));
      };
      return {
        clear: clear,
        isSet: isSet,
        set: set
      };
    };
    var destroyable = function () {
      return revocable(function (s) {
        return s.destroy();
      });
    };
    var unbindable = function () {
      return revocable(function (s) {
        return s.unbind();
      });
    };
    var value$3 = function () {
      var subject = Cell(Optional.none());
      var clear = function () {
        return subject.set(Optional.none());
      };
      var set = function (s) {
        return subject.set(Optional.some(s));
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var on = function (f) {
        return subject.get().each(f);
      };
      return {
        clear: clear,
        set: set,
        isSet: isSet,
        on: on
      };
    };

    var onSetupFormatToggle = function (editor, name) {
      return function (api) {
        var boundCallback = unbindable();
        var init = function () {
          api.setActive(editor.formatter.match(name));
          var binding = editor.formatter.formatChanged(name, api.setActive);
          boundCallback.set(binding);
        };
        editor.initialized ? init() : editor.on('init', init);
        return boundCallback.clear;
      };
    };
    var onActionToggleFormat = function (editor) {
      return function (rawItem) {
        return function () {
          editor.undoManager.transact(function () {
            editor.focus();
            editor.execCommand('mceToggleFormat', false, rawItem.format);
          });
        };
      };
    };

    var defaultBlocks = 'Paragraph=p;' + 'Heading 1=h1;' + 'Heading 2=h2;' + 'Heading 3=h3;' + 'Heading 4=h4;' + 'Heading 5=h5;' + 'Heading 6=h6;' + 'Preformatted=pre';
    var getSpec$3 = function (editor) {
      var isSelectedFor = function (format) {
        return function () {
          return editor.formatter.match(format);
        };
      };
      var getPreviewFor = function (format) {
        return function () {
          var fmt = editor.formatter.get(format);
          return Optional.some({
            tag: fmt.length > 0 ? fmt[0].inline || fmt[0].block || 'div' : 'div',
            styles: editor.dom.parseStyle(editor.formatter.getCssText(format))
          });
        };
      };
      var updateSelectMenuText = function (comp) {
        var detectedFormat = findNearest(editor, function () {
          return dataset.data;
        });
        var text = detectedFormat.fold(function () {
          return 'Paragraph';
        }, function (fmt) {
          return fmt.title;
        });
        emitWith(comp, updateMenuText, { text: text });
      };
      var dataset = buildBasicSettingsDataset(editor, 'block_formats', defaultBlocks, Delimiter.SemiColon);
      return {
        tooltip: 'Blocks',
        icon: Optional.none(),
        isSelectedFor: isSelectedFor,
        getCurrentValue: Optional.none,
        getPreviewFor: getPreviewFor,
        onAction: onActionToggleFormat(editor),
        updateText: updateSelectMenuText,
        dataset: dataset,
        shouldHide: false,
        isInvalid: function (item) {
          return !editor.formatter.canApply(item.format);
        }
      };
    };
    var createFormatSelect = function (editor, backstage) {
      return createSelectButton(editor, backstage, getSpec$3(editor));
    };
    var formatSelectMenu = function (editor, backstage) {
      var menuItems = createMenuItems(editor, backstage, getSpec$3(editor));
      editor.ui.registry.addNestedMenuItem('blockformats', {
        text: 'Blocks',
        getSubmenuItems: function () {
          return menuItems.items.validateItems(menuItems.getStyleItems());
        }
      });
    };

    var getSpec$4 = function (editor, dataset) {
      var isSelectedFor = function (format) {
        return function () {
          return editor.formatter.match(format);
        };
      };
      var getPreviewFor = function (format) {
        return function () {
          var fmt = editor.formatter.get(format);
          return fmt !== undefined ? Optional.some({
            tag: fmt.length > 0 ? fmt[0].inline || fmt[0].block || 'div' : 'div',
            styles: editor.dom.parseStyle(editor.formatter.getCssText(format))
          }) : Optional.none();
        };
      };
      var updateSelectMenuText = function (comp) {
        var getFormatItems = function (fmt) {
          var subs = fmt.items;
          return subs !== undefined && subs.length > 0 ? bind(subs, getFormatItems) : [{
              title: fmt.title,
              format: fmt.format
            }];
        };
        var flattenedItems = bind(getStyleFormats(editor), getFormatItems);
        var detectedFormat = findNearest(editor, function () {
          return flattenedItems;
        });
        var text = detectedFormat.fold(function () {
          return 'Paragraph';
        }, function (fmt) {
          return fmt.title;
        });
        emitWith(comp, updateMenuText, { text: text });
      };
      return {
        tooltip: 'Formats',
        icon: Optional.none(),
        isSelectedFor: isSelectedFor,
        getCurrentValue: Optional.none,
        getPreviewFor: getPreviewFor,
        onAction: onActionToggleFormat(editor),
        updateText: updateSelectMenuText,
        shouldHide: editor.getParam('style_formats_autohide', false, 'boolean'),
        isInvalid: function (item) {
          return !editor.formatter.canApply(item.format);
        },
        dataset: dataset
      };
    };
    var createStyleSelect = function (editor, backstage) {
      var dataset = __assign({ type: 'advanced' }, backstage.styleselect);
      return createSelectButton(editor, backstage, getSpec$4(editor, dataset));
    };
    var styleSelectMenu = function (editor, backstage) {
      var dataset = __assign({ type: 'advanced' }, backstage.styleselect);
      var menuItems = createMenuItems(editor, backstage, getSpec$4(editor, dataset));
      editor.ui.registry.addNestedMenuItem('formats', {
        text: 'Formats',
        getSubmenuItems: function () {
          return menuItems.items.validateItems(menuItems.getStyleItems());
        }
      });
    };

    var defaultToolbar = [
      {
        name: 'history',
        items: [
          'undo',
          'redo'
        ]
      },
      {
        name: 'styles',
        items: ['styleselect']
      },
      {
        name: 'formatting',
        items: [
          'bold',
          'italic'
        ]
      },
      {
        name: 'alignment',
        items: [
          'alignleft',
          'aligncenter',
          'alignright',
          'alignjustify'
        ]
      },
      {
        name: 'indentation',
        items: [
          'outdent',
          'indent'
        ]
      },
      {
        name: 'permanent pen',
        items: ['permanentpen']
      },
      {
        name: 'comments',
        items: ['addcomment']
      }
    ];
    var renderFromBridge = function (bridgeBuilder, render) {
      return function (spec, extras, editor) {
        var internal = bridgeBuilder(spec).mapError(function (errInfo) {
          return formatError(errInfo);
        }).getOrDie();
        return render(internal, extras, editor);
      };
    };
    var types = {
      button: renderFromBridge(createToolbarButton, function (s, extras) {
        return renderToolbarButton(s, extras.backstage.shared.providers);
      }),
      togglebutton: renderFromBridge(createToggleButton, function (s, extras) {
        return renderToolbarToggleButton(s, extras.backstage.shared.providers);
      }),
      menubutton: renderFromBridge(createMenuButton, function (s, extras) {
        return renderMenuButton(s, 'tox-tbtn', extras.backstage, Optional.none());
      }),
      splitbutton: renderFromBridge(createSplitButton, function (s, extras) {
        return renderSplitButton(s, extras.backstage.shared);
      }),
      grouptoolbarbutton: renderFromBridge(createGroupToolbarButton, function (s, extras, editor) {
        var _a;
        var buttons = editor.ui.registry.getAll().buttons;
        var identify = function (toolbar) {
          return identifyButtons(editor, {
            buttons: buttons,
            toolbar: toolbar,
            allowToolbarGroups: false
          }, extras, Optional.none());
        };
        var attributes = (_a = {}, _a[Attribute] = extras.backstage.shared.header.isPositionedAtTop() ? AttributeValue.TopToBottom : AttributeValue.BottomToTop, _a);
        switch (getToolbarMode(editor)) {
        case ToolbarMode.floating:
          return renderFloatingToolbarButton(s, extras.backstage, identify, attributes);
        default:
          throw new Error('Toolbar groups are only supported when using floating toolbar mode');
        }
      }),
      styleSelectButton: function (editor, extras) {
        return createStyleSelect(editor, extras.backstage);
      },
      fontsizeSelectButton: function (editor, extras) {
        return createFontsizeSelect(editor, extras.backstage);
      },
      fontSelectButton: function (editor, extras) {
        return createFontSelect(editor, extras.backstage);
      },
      formatButton: function (editor, extras) {
        return createFormatSelect(editor, extras.backstage);
      },
      alignMenuButton: function (editor, extras) {
        return createAlignSelect(editor, extras.backstage);
      }
    };
    var extractFrom = function (spec, extras, editor) {
      return get$1(types, spec.type).fold(function () {
        console.error('skipping button defined by', spec);
        return Optional.none();
      }, function (render) {
        return Optional.some(render(spec, extras, editor));
      });
    };
    var bespokeButtons = {
      styleselect: types.styleSelectButton,
      fontsizeselect: types.fontsizeSelectButton,
      fontselect: types.fontSelectButton,
      formatselect: types.formatButton,
      align: types.alignMenuButton
    };
    var removeUnusedDefaults = function (buttons) {
      var filteredItemGroups = map(defaultToolbar, function (group) {
        var items = filter(group.items, function (subItem) {
          return has(buttons, subItem) || has(bespokeButtons, subItem);
        });
        return {
          name: group.name,
          items: items
        };
      });
      return filter(filteredItemGroups, function (group) {
        return group.items.length > 0;
      });
    };
    var convertStringToolbar = function (strToolbar) {
      var groupsStrings = strToolbar.split('|');
      return map(groupsStrings, function (g) {
        return { items: g.trim().split(' ') };
      });
    };
    var isToolbarGroupSettingArray = function (toolbar) {
      return isArrayOf(toolbar, function (t) {
        return has(t, 'name') && has(t, 'items');
      });
    };
    var createToolbar = function (toolbarConfig) {
      var toolbar = toolbarConfig.toolbar;
      var buttons = toolbarConfig.buttons;
      if (toolbar === false) {
        return [];
      } else if (toolbar === undefined || toolbar === true) {
        return removeUnusedDefaults(buttons);
      } else if (isString(toolbar)) {
        return convertStringToolbar(toolbar);
      } else if (isToolbarGroupSettingArray(toolbar)) {
        return toolbar;
      } else {
        console.error('Toolbar type should be string, string[], boolean or ToolbarGroup[]');
        return [];
      }
    };
    var lookupButton = function (editor, buttons, toolbarItem, allowToolbarGroups, extras, prefixes) {
      return get$1(buttons, toolbarItem.toLowerCase()).orThunk(function () {
        return prefixes.bind(function (ps) {
          return findMap(ps, function (prefix) {
            return get$1(buttons, prefix + toolbarItem.toLowerCase());
          });
        });
      }).fold(function () {
        return get$1(bespokeButtons, toolbarItem.toLowerCase()).map(function (r) {
          return r(editor, extras);
        }).orThunk(function () {
          return Optional.none();
        });
      }, function (spec) {
        if (spec.type === 'grouptoolbarbutton' && !allowToolbarGroups) {
          console.warn('Ignoring the \'' + toolbarItem + '\' toolbar button. Group toolbar buttons are only supported when using floating toolbar mode and cannot be nested.');
          return Optional.none();
        } else {
          return extractFrom(spec, extras, editor);
        }
      });
    };
    var identifyButtons = function (editor, toolbarConfig, extras, prefixes) {
      var toolbarGroups = createToolbar(toolbarConfig);
      var groups = map(toolbarGroups, function (group) {
        var items = bind(group.items, function (toolbarItem) {
          return toolbarItem.trim().length === 0 ? [] : lookupButton(editor, toolbarConfig.buttons, toolbarItem, toolbarConfig.allowToolbarGroups, extras, prefixes).toArray();
        });
        return {
          title: Optional.from(editor.translate(group.name)),
          items: items
        };
      });
      return filter(groups, function (group) {
        return group.items.length > 0;
      });
    };

    var bubbleSize = 12;
    var bubbleAlignments$1 = {
      valignCentre: [],
      alignCentre: [],
      alignLeft: ['tox-pop--align-left'],
      alignRight: ['tox-pop--align-right'],
      right: ['tox-pop--right'],
      left: ['tox-pop--left'],
      bottom: ['tox-pop--bottom'],
      top: ['tox-pop--top']
    };
    var anchorOverrides = {
      maxHeightFunction: expandable(),
      maxWidthFunction: expandable$1()
    };
    var desktopAnchorSpecLayouts = {
      onLtr: function () {
        return [
          north$1,
          south$1,
          northeast$1,
          southeast$1,
          northwest$1,
          southwest$1,
          north$3,
          south$3,
          northeast$3,
          southeast$3,
          northwest$3,
          southwest$3
        ];
      },
      onRtl: function () {
        return [
          north$1,
          south$1,
          northwest$1,
          southwest$1,
          northeast$1,
          southeast$1,
          north$3,
          south$3,
          northwest$3,
          southwest$3,
          northeast$3,
          southeast$3
        ];
      }
    };
    var mobileAnchorSpecLayouts = {
      onLtr: function () {
        return [
          south$1,
          southeast$1,
          southwest$1,
          northeast$1,
          northwest$1,
          north$1,
          north$3,
          south$3,
          northeast$3,
          southeast$3,
          northwest$3,
          southwest$3
        ];
      },
      onRtl: function () {
        return [
          south$1,
          southwest$1,
          southeast$1,
          northwest$1,
          northeast$1,
          north$1,
          north$3,
          south$3,
          northwest$3,
          southwest$3,
          northeast$3,
          southeast$3
        ];
      }
    };
    var getAnchorLayout = function (position, isTouch) {
      if (position === 'line') {
        return {
          bubble: nu$8(bubbleSize, 0, bubbleAlignments$1),
          layouts: {
            onLtr: function () {
              return [east$1];
            },
            onRtl: function () {
              return [west$1];
            }
          },
          overrides: anchorOverrides
        };
      } else {
        return {
          bubble: nu$8(0, bubbleSize, bubbleAlignments$1),
          layouts: isTouch ? mobileAnchorSpecLayouts : desktopAnchorSpecLayouts,
          overrides: anchorOverrides
        };
      }
    };
    var register$4 = function (editor, registryContextToolbars, sink, extras) {
      var isTouch = detect$3().deviceType.isTouch;
      var contextbar = build$1(renderContextToolbar({
        sink: sink,
        onEscape: function () {
          editor.focus();
          return Optional.some(true);
        }
      }));
      var getBounds = function () {
        return getContextToolbarBounds(editor, extras.backstage.shared);
      };
      var isRangeOverlapping = function (aTop, aBottom, bTop, bBottom) {
        return Math.max(aTop, bTop) <= Math.min(aBottom, bBottom);
      };
      var getLastElementVerticalBound = function () {
        var nodeBounds = lastElement.get().filter(function (ele) {
          return inBody(SugarElement.fromDom(ele));
        }).map(function (ele) {
          return ele.getBoundingClientRect();
        }).getOrThunk(function () {
          return editor.selection.getRng().getBoundingClientRect();
        });
        var diffTop = editor.inline ? get$9().top : absolute$1(SugarElement.fromDom(editor.getBody())).y;
        return {
          y: nodeBounds.top + diffTop,
          bottom: nodeBounds.bottom + diffTop
        };
      };
      var shouldContextToolbarHide = function () {
        if (isTouch() && extras.backstage.isContextMenuOpen()) {
          return true;
        }
        var lastElementBounds = getLastElementVerticalBound();
        var contextToolbarBounds = getBounds();
        return !isRangeOverlapping(lastElementBounds.y, lastElementBounds.bottom, contextToolbarBounds.y, contextToolbarBounds.bottom);
      };
      var close = function () {
        lastAnchor.set(Optional.none());
        InlineView.hide(contextbar);
      };
      var forceHide = function () {
        InlineView.hide(contextbar);
      };
      var hideOrRepositionIfNecessary = function () {
        lastAnchor.get().each(function (anchor) {
          var contextBarEle = contextbar.element;
          remove$6(contextBarEle, 'display');
          if (shouldContextToolbarHide()) {
            set$2(contextBarEle, 'display', 'none');
          } else {
            Positioning.positionWithinBounds(sink, anchor, contextbar, Optional.some(getBounds()));
          }
        });
      };
      var lastAnchor = Cell(Optional.none());
      var lastElement = Cell(Optional.none());
      var timer = Cell(null);
      var wrapInPopDialog = function (toolbarSpec) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-pop__dialog']
          },
          components: [toolbarSpec],
          behaviours: derive$1([
            Keying.config({ mode: 'acyclic' }),
            config('pop-dialog-wrap-events', [
              runOnAttached(function (comp) {
                editor.shortcuts.add('ctrl+F9', 'focus statusbar', function () {
                  return Keying.focusIn(comp);
                });
              }),
              runOnDetached(function (_comp) {
                editor.shortcuts.remove('ctrl+F9');
              })
            ])
          ])
        };
      };
      var getScopes = cached(function () {
        return categorise(registryContextToolbars, function (toolbarApi) {
          var alloySpec = buildToolbar([toolbarApi]);
          emitWith(contextbar, forwardSlideEvent, { forwardContents: wrapInPopDialog(alloySpec) });
        });
      });
      var buildContextToolbarGroups = function (allButtons, ctx) {
        return identifyButtons(editor, {
          buttons: allButtons,
          toolbar: ctx.items,
          allowToolbarGroups: false
        }, extras, Optional.some(['form:']));
      };
      var buildContextMenuGroups = function (ctx, providers) {
        return ContextForm.buildInitGroups(ctx, providers);
      };
      var buildToolbar = function (toolbars) {
        var buttons = editor.ui.registry.getAll().buttons;
        var scopes = getScopes();
        var allButtons = __assign(__assign({}, buttons), scopes.formNavigators);
        var toolbarType = getToolbarMode(editor) === ToolbarMode.scrolling ? ToolbarMode.scrolling : ToolbarMode.default;
        var initGroups = flatten(map(toolbars, function (ctx) {
          return ctx.type === 'contexttoolbar' ? buildContextToolbarGroups(allButtons, ctx) : buildContextMenuGroups(ctx, extras.backstage.shared.providers);
        }));
        return renderToolbar({
          type: toolbarType,
          uid: generate$1('context-toolbar'),
          initGroups: initGroups,
          onEscape: Optional.none,
          cyclicKeying: true,
          providers: extras.backstage.shared.providers
        });
      };
      editor.on(showContextToolbarEvent, function (e) {
        var scopes = getScopes();
        get$1(scopes.lookupTable, e.toolbarKey).each(function (ctx) {
          launchContext([ctx], e.target === editor ? Optional.none() : Optional.some(e));
          InlineView.getContent(contextbar).each(Keying.focusIn);
        });
      });
      var getAnchor = function (position, element) {
        var anchorage = position === 'node' ? extras.backstage.shared.anchors.node(element) : extras.backstage.shared.anchors.cursor();
        return deepMerge(anchorage, getAnchorLayout(position, isTouch()));
      };
      var launchContext = function (toolbarApi, elem) {
        clearTimer();
        if (isTouch() && extras.backstage.isContextMenuOpen()) {
          return;
        }
        var toolbarSpec = buildToolbar(toolbarApi);
        var sElem = elem.map(SugarElement.fromDom);
        var anchor = getAnchor(toolbarApi[0].position, sElem);
        lastAnchor.set(Optional.some(anchor));
        lastElement.set(elem);
        var contextBarEle = contextbar.element;
        remove$6(contextBarEle, 'display');
        InlineView.showWithinBounds(contextbar, anchor, wrapInPopDialog(toolbarSpec), function () {
          return Optional.some(getBounds());
        });
        if (shouldContextToolbarHide()) {
          set$2(contextBarEle, 'display', 'none');
        }
      };
      var launchContextToolbar = function () {
        if (!editor.hasFocus()) {
          return;
        }
        var scopes = getScopes();
        lookup$1(scopes, editor).fold(close, function (info) {
          launchContext(info.toolbars, Optional.some(info.elem.dom));
        });
      };
      var clearTimer = function () {
        var current = timer.get();
        if (current !== null) {
          global$2.clearTimeout(current);
          timer.set(null);
        }
      };
      var asyncOpen = function () {
        clearTimer();
        timer.set(global$2.setEditorTimeout(editor, launchContextToolbar, 0));
      };
      editor.on('init', function () {
        editor.on(hideContextToolbarEvent, forceHide);
        editor.on('ScrollContent ScrollWindow longpress', hideOrRepositionIfNecessary);
        editor.on('click keyup focus SetContent ObjectResized ResizeEditor', function () {
          asyncOpen();
        });
        editor.on('focusout', function (_e) {
          global$2.setEditorTimeout(editor, function () {
            if (search(sink.element).isNone() && search(contextbar.element).isNone()) {
              close();
            }
          }, 0);
        });
        editor.on('SwitchMode', function () {
          if (editor.mode.isReadOnly()) {
            close();
          }
        });
        editor.on('AfterProgressState', function (event) {
          if (event.state) {
            close();
          } else if (editor.hasFocus()) {
            asyncOpen();
          }
        });
        editor.on('NodeChange', function (_e) {
          search(contextbar.element).fold(asyncOpen, noop);
        });
      });
    };

    var setup$3 = function (editor, mothership, uiMothership) {
      var broadcastEvent = function (name, evt) {
        each([
          mothership,
          uiMothership
        ], function (ship) {
          ship.broadcastEvent(name, evt);
        });
      };
      var broadcastOn = function (channel, message) {
        each([
          mothership,
          uiMothership
        ], function (ship) {
          ship.broadcastOn([channel], message);
        });
      };
      var fireDismissPopups = function (evt) {
        return broadcastOn(dismissPopups(), { target: evt.target });
      };
      var onTouchstart = bind$3(SugarElement.fromDom(document), 'touchstart', fireDismissPopups);
      var onTouchmove = bind$3(SugarElement.fromDom(document), 'touchmove', function (evt) {
        return broadcastEvent(documentTouchmove(), evt);
      });
      var onTouchend = bind$3(SugarElement.fromDom(document), 'touchend', function (evt) {
        return broadcastEvent(documentTouchend(), evt);
      });
      var onMousedown = bind$3(SugarElement.fromDom(document), 'mousedown', fireDismissPopups);
      var onMouseup = bind$3(SugarElement.fromDom(document), 'mouseup', function (evt) {
        if (evt.raw.button === 0) {
          broadcastOn(mouseReleased(), { target: evt.target });
        }
      });
      var onContentClick = function (raw) {
        return broadcastOn(dismissPopups(), { target: SugarElement.fromDom(raw.target) });
      };
      var onContentMouseup = function (raw) {
        if (raw.button === 0) {
          broadcastOn(mouseReleased(), { target: SugarElement.fromDom(raw.target) });
        }
      };
      var onWindowScroll = function (evt) {
        return broadcastEvent(windowScroll(), fromRawEvent$1(evt));
      };
      var onWindowResize = function (evt) {
        broadcastOn(repositionPopups(), {});
        broadcastEvent(windowResize(), fromRawEvent$1(evt));
      };
      var onEditorResize = function () {
        return broadcastOn(repositionPopups(), {});
      };
      var onEditorProgress = function (evt) {
        if (evt.state) {
          broadcastOn(dismissPopups(), { target: SugarElement.fromDom(editor.getContainer()) });
        }
      };
      editor.on('PostRender', function () {
        editor.on('click', onContentClick);
        editor.on('tap', onContentClick);
        editor.on('mouseup', onContentMouseup);
        editor.on('ScrollWindow', onWindowScroll);
        editor.on('ResizeWindow', onWindowResize);
        editor.on('ResizeEditor', onEditorResize);
        editor.on('AfterProgressState', onEditorProgress);
      });
      editor.on('remove', function () {
        editor.off('click', onContentClick);
        editor.off('tap', onContentClick);
        editor.off('mouseup', onContentMouseup);
        editor.off('ScrollWindow', onWindowScroll);
        editor.off('ResizeWindow', onWindowResize);
        editor.off('ResizeEditor', onEditorResize);
        editor.off('AfterProgressState', onEditorProgress);
        onMousedown.unbind();
        onTouchstart.unbind();
        onTouchmove.unbind();
        onTouchend.unbind();
        onMouseup.unbind();
      });
      editor.on('detach', function () {
        detachSystem(mothership);
        detachSystem(uiMothership);
        mothership.destroy();
        uiMothership.destroy();
      });
    };

    var parts$d = AlloyParts;
    var partType$1 = PartType;

    var schema$r = constant([
      defaulted$1('shell', false),
      strict$1('makeItem'),
      defaulted$1('setupItem', noop),
      SketchBehaviours.field('listBehaviours', [Replacing])
    ]);
    var customListDetail = function () {
      return { behaviours: derive$1([Replacing.config({})]) };
    };
    var itemsPart = optional({
      name: 'items',
      overrides: customListDetail
    });
    var parts$e = constant([itemsPart]);
    var name$2 = constant('CustomList');

    var factory$f = function (detail, components, _spec, _external) {
      var setItems = function (list, items) {
        getListContainer(list).fold(function () {
          console.error('Custom List was defined to not be a shell, but no item container was specified in components');
          throw new Error('Custom List was defined to not be a shell, but no item container was specified in components');
        }, function (container) {
          var itemComps = Replacing.contents(container);
          var numListsRequired = items.length;
          var numListsToAdd = numListsRequired - itemComps.length;
          var itemsToAdd = numListsToAdd > 0 ? range(numListsToAdd, function () {
            return detail.makeItem();
          }) : [];
          var itemsToRemove = itemComps.slice(numListsRequired);
          each(itemsToRemove, function (item) {
            return Replacing.remove(container, item);
          });
          each(itemsToAdd, function (item) {
            return Replacing.append(container, item);
          });
          var builtLists = Replacing.contents(container);
          each(builtLists, function (item, i) {
            detail.setupItem(list, item, items[i], i);
          });
        });
      };
      var extra = detail.shell ? {
        behaviours: [Replacing.config({})],
        components: []
      } : {
        behaviours: [],
        components: components
      };
      var getListContainer = function (component) {
        return detail.shell ? Optional.some(component) : getPart(component, detail, 'items');
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: extra.components,
        behaviours: augment(detail.listBehaviours, extra.behaviours),
        apis: { setItems: setItems }
      };
    };
    var CustomList = composite$1({
      name: name$2(),
      configFields: schema$r(),
      partFields: parts$e(),
      factory: factory$f,
      apis: {
        setItems: function (apis, list, items) {
          apis.setItems(list, items);
        }
      }
    });

    var setup$4 = noop;
    var isDocked = never;
    var getBehaviours$2 = constant([]);

    var StaticHeader = /*#__PURE__*/Object.freeze({
        __proto__: null,
        setup: setup$4,
        isDocked: isDocked,
        getBehaviours: getBehaviours$2
    });

    var getOffsetParent = function (element) {
      var isFixed = getRaw(element, 'position').is('fixed');
      var offsetParent$1 = isFixed ? Optional.none() : offsetParent(element);
      return offsetParent$1.orThunk(function () {
        var marker = SugarElement.fromTag('span');
        return parent(element).bind(function (parent) {
          append(parent, marker);
          var offsetParent$1 = offsetParent(marker);
          remove(marker);
          return offsetParent$1;
        });
      });
    };
    var getOrigin = function (element) {
      return getOffsetParent(element).map(absolute).getOrThunk(function () {
        return SugarPosition(0, 0);
      });
    };

    var morphAdt = Adt.generate([
      { static: [] },
      { absolute: ['positionCss'] },
      { fixed: ['positionCss'] }
    ]);
    var appear = function (component, contextualInfo) {
      var elem = component.element;
      add$2(elem, contextualInfo.transitionClass);
      remove$4(elem, contextualInfo.fadeOutClass);
      add$2(elem, contextualInfo.fadeInClass);
      contextualInfo.onShow(component);
    };
    var disappear = function (component, contextualInfo) {
      var elem = component.element;
      add$2(elem, contextualInfo.transitionClass);
      remove$4(elem, contextualInfo.fadeInClass);
      add$2(elem, contextualInfo.fadeOutClass);
      contextualInfo.onHide(component);
    };
    var isPartiallyVisible = function (box, viewport) {
      return box.y < viewport.bottom && box.bottom > viewport.y;
    };
    var isTopCompletelyVisible = function (box, viewport) {
      return box.y >= viewport.y;
    };
    var isBottomCompletelyVisible = function (box, viewport) {
      return box.bottom <= viewport.bottom;
    };
    var isVisibleForModes = function (modes, box, viewport) {
      return forall(modes, function (mode) {
        switch (mode) {
        case 'bottom':
          return isBottomCompletelyVisible(box, viewport);
        case 'top':
          return isTopCompletelyVisible(box, viewport);
        }
      });
    };
    var getPrior = function (elem, state) {
      return state.getInitialPosition().map(function (pos) {
        return bounds$1(pos.bounds.x, pos.bounds.y, get$8(elem), get$7(elem));
      });
    };
    var storePrior = function (elem, box, state) {
      state.setInitialPosition(Optional.some({
        style: getAllRaw(elem),
        position: get$5(elem, 'position') || 'static',
        bounds: box
      }));
    };
    var revertToOriginal = function (elem, box$1, state) {
      return state.getInitialPosition().bind(function (position) {
        state.setInitialPosition(Optional.none());
        switch (position.position) {
        case 'static':
          return Optional.some(morphAdt.static());
        case 'absolute':
          var offsetBox_1 = getOffsetParent(elem).map(box).getOrThunk(function () {
            return box(body());
          });
          return Optional.some(morphAdt.absolute(NuPositionCss('absolute', get$1(position.style, 'left').map(function (_left) {
            return box$1.x - offsetBox_1.x;
          }), get$1(position.style, 'top').map(function (_top) {
            return box$1.y - offsetBox_1.y;
          }), get$1(position.style, 'right').map(function (_right) {
            return offsetBox_1.right - box$1.right;
          }), get$1(position.style, 'bottom').map(function (_bottom) {
            return offsetBox_1.bottom - box$1.bottom;
          }))));
        default:
          return Optional.none();
        }
      });
    };
    var morphToOriginal = function (elem, viewport, state) {
      return getPrior(elem, state).filter(function (box) {
        return isVisibleForModes(state.getModes(), box, viewport);
      }).bind(function (box) {
        return revertToOriginal(elem, box, state);
      });
    };
    var morphToFixed = function (elem, viewport, state) {
      var box$1 = box(elem);
      if (!isVisibleForModes(state.getModes(), box$1, viewport)) {
        storePrior(elem, box$1, state);
        var winBox = win();
        var left = box$1.x - winBox.x;
        var top_1 = viewport.y - winBox.y;
        var bottom = winBox.bottom - viewport.bottom;
        var isTop = box$1.y <= viewport.y;
        return Optional.some(morphAdt.fixed(NuPositionCss('fixed', Optional.some(left), isTop ? Optional.some(top_1) : Optional.none(), Optional.none(), !isTop ? Optional.some(bottom) : Optional.none())));
      } else {
        return Optional.none();
      }
    };
    var getMorph = function (component, viewport, state) {
      var elem = component.element;
      var isDocked = getRaw(elem, 'position').is('fixed');
      return isDocked ? morphToOriginal(elem, viewport, state) : morphToFixed(elem, viewport, state);
    };
    var getMorphToOriginal = function (component, state) {
      var elem = component.element;
      return getPrior(elem, state).bind(function (box) {
        return revertToOriginal(elem, box, state);
      });
    };

    var morphToStatic = function (component, config) {
      each([
        'left',
        'right',
        'top',
        'bottom',
        'position'
      ], function (prop) {
        return remove$6(component.element, prop);
      });
      config.onUndocked(component);
    };
    var morphToCoord = function (component, config, position) {
      applyPositionCss(component.element, position);
      var method = position.position === 'fixed' ? config.onDocked : config.onUndocked;
      method(component);
    };
    var updateVisibility = function (component, config, state, viewport, morphToDocked) {
      if (morphToDocked === void 0) {
        morphToDocked = false;
      }
      config.contextual.each(function (contextInfo) {
        contextInfo.lazyContext(component).each(function (box) {
          var isVisible = isPartiallyVisible(box, viewport);
          if (isVisible !== state.isVisible()) {
            state.setVisible(isVisible);
            if (morphToDocked && !isVisible) {
              add$3(component.element, [contextInfo.fadeOutClass]);
              contextInfo.onHide(component);
            } else {
              var method = isVisible ? appear : disappear;
              method(component, contextInfo);
            }
          }
        });
      });
    };
    var refreshInternal = function (component, config, state) {
      var viewport = config.lazyViewport(component);
      var isDocked = state.isDocked();
      if (isDocked) {
        updateVisibility(component, config, state, viewport);
      }
      getMorph(component, viewport, state).each(function (morph) {
        state.setDocked(!isDocked);
        morph.fold(function () {
          return morphToStatic(component, config);
        }, function (position) {
          return morphToCoord(component, config, position);
        }, function (position) {
          updateVisibility(component, config, state, viewport, true);
          morphToCoord(component, config, position);
        });
      });
    };
    var resetInternal = function (component, config, state) {
      var elem = component.element;
      state.setDocked(false);
      getMorphToOriginal(component, state).each(function (morph) {
        morph.fold(function () {
          return morphToStatic(component, config);
        }, function (position) {
          return morphToCoord(component, config, position);
        }, noop);
      });
      state.setVisible(true);
      config.contextual.each(function (contextInfo) {
        remove$5(elem, [
          contextInfo.fadeInClass,
          contextInfo.fadeOutClass,
          contextInfo.transitionClass
        ]);
        contextInfo.onShow(component);
      });
      refresh$4(component, config, state);
    };
    var refresh$4 = function (component, config, state) {
      if (component.getSystem().isConnected()) {
        refreshInternal(component, config, state);
      }
    };
    var reset = function (component, config, state) {
      if (state.isDocked()) {
        resetInternal(component, config, state);
      }
    };
    var isDocked$1 = function (component, config, state) {
      return state.isDocked();
    };
    var setModes = function (component, config, state, modes) {
      return state.setModes(modes);
    };
    var getModes = function (component, config, state) {
      return state.getModes();
    };

    var DockingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        refresh: refresh$4,
        reset: reset,
        isDocked: isDocked$1,
        getModes: getModes,
        setModes: setModes
    });

    var events$f = function (dockInfo, dockState) {
      return derive([
        runOnSource(transitionend(), function (component, simulatedEvent) {
          dockInfo.contextual.each(function (contextInfo) {
            if (has$2(component.element, contextInfo.transitionClass)) {
              remove$5(component.element, [
                contextInfo.transitionClass,
                contextInfo.fadeInClass
              ]);
              var notify = dockState.isVisible() ? contextInfo.onShown : contextInfo.onHidden;
              notify(component);
            }
            simulatedEvent.stop();
          });
        }),
        run(windowScroll(), function (component, _) {
          refresh$4(component, dockInfo, dockState);
        }),
        run(windowResize(), function (component, _) {
          reset(component, dockInfo, dockState);
        })
      ]);
    };

    var ActiveDocking = /*#__PURE__*/Object.freeze({
        __proto__: null,
        events: events$f
    });

    var DockingSchema = [
      optionObjOf('contextual', [
        strictString('fadeInClass'),
        strictString('fadeOutClass'),
        strictString('transitionClass'),
        strictFunction('lazyContext'),
        onHandler('onShow'),
        onHandler('onShown'),
        onHandler('onHide'),
        onHandler('onHidden')
      ]),
      defaultedFunction('lazyViewport', win),
      defaultedArrayOf('modes', [
        'top',
        'bottom'
      ], string),
      onHandler('onDocked'),
      onHandler('onUndocked')
    ];

    var init$b = function (spec) {
      var docked = Cell(false);
      var visible = Cell(true);
      var initialBounds = Cell(Optional.none());
      var modes = Cell(spec.modes);
      var readState = function () {
        return 'docked:  ' + docked.get() + ', visible: ' + visible.get() + ', modes: ' + modes.get().join(',');
      };
      return nu$5({
        isDocked: docked.get,
        setDocked: docked.set,
        getInitialPosition: initialBounds.get,
        setInitialPosition: initialBounds.set,
        isVisible: visible.get,
        setVisible: visible.set,
        getModes: modes.get,
        setModes: modes.set,
        readState: readState
      });
    };

    var DockingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$b
    });

    var Docking = create$1({
      fields: DockingSchema,
      name: 'docking',
      active: ActiveDocking,
      apis: DockingApis,
      state: DockingState
    });

    var visibility = {
      fadeInClass: 'tox-editor-dock-fadein',
      fadeOutClass: 'tox-editor-dock-fadeout',
      transitionClass: 'tox-editor-dock-transition'
    };
    var editorStickyOnClass = 'tox-tinymce--toolbar-sticky-on';
    var editorStickyOffClass = 'tox-tinymce--toolbar-sticky-off';
    var scrollFromBehindHeader = function (e, containerHeader) {
      var doc = owner(containerHeader);
      var viewHeight = doc.dom.defaultView.innerHeight;
      var scrollPos = get$9(doc);
      var markerElement = SugarElement.fromDom(e.elm);
      var markerPos = absolute$1(markerElement);
      var markerHeight = get$7(markerElement);
      var markerTop = markerPos.y;
      var markerBottom = markerTop + markerHeight;
      var editorHeaderPos = absolute(containerHeader);
      var editorHeaderHeight = get$7(containerHeader);
      var editorHeaderTop = editorHeaderPos.top;
      var editorHeaderBottom = editorHeaderTop + editorHeaderHeight;
      var editorHeaderDockedAtTop = Math.abs(editorHeaderTop - scrollPos.top) < 2;
      var editorHeaderDockedAtBottom = Math.abs(editorHeaderBottom - (scrollPos.top + viewHeight)) < 2;
      if (editorHeaderDockedAtTop && markerTop < editorHeaderBottom) {
        to(scrollPos.left, markerTop - editorHeaderHeight, doc);
      } else if (editorHeaderDockedAtBottom && markerBottom > editorHeaderTop) {
        var y = markerTop - viewHeight + markerHeight + editorHeaderHeight;
        to(scrollPos.left, y, doc);
      }
    };
    var isDockedMode = function (header, mode) {
      return contains(Docking.getModes(header), mode);
    };
    var updateIframeContentFlow = function (header) {
      var getOccupiedHeight = function (elm) {
        return getOuter$1(elm) + (parseInt(get$5(elm, 'margin-top'), 10) || 0) + (parseInt(get$5(elm, 'margin-bottom'), 10) || 0);
      };
      var elm = header.element;
      parent(elm).each(function (parentElem) {
        var padding = 'padding-' + Docking.getModes(header)[0];
        if (Docking.isDocked(header)) {
          var parentWidth = get$8(parentElem);
          set$2(elm, 'width', parentWidth + 'px');
          set$2(parentElem, padding, getOccupiedHeight(elm) + 'px');
        } else {
          remove$6(elm, 'width');
          remove$6(parentElem, padding);
        }
      });
    };
    var updateSinkVisibility = function (sinkElem, visible) {
      if (visible) {
        remove$4(sinkElem, visibility.fadeOutClass);
        add$3(sinkElem, [
          visibility.transitionClass,
          visibility.fadeInClass
        ]);
      } else {
        remove$4(sinkElem, visibility.fadeInClass);
        add$3(sinkElem, [
          visibility.fadeOutClass,
          visibility.transitionClass
        ]);
      }
    };
    var updateEditorClasses = function (editor, docked) {
      var editorContainer = SugarElement.fromDom(editor.getContainer());
      if (docked) {
        add$2(editorContainer, editorStickyOnClass);
        remove$4(editorContainer, editorStickyOffClass);
      } else {
        add$2(editorContainer, editorStickyOffClass);
        remove$4(editorContainer, editorStickyOnClass);
      }
    };
    var restoreFocus = function (headerElem, focusedElem) {
      var ownerDoc = owner(focusedElem);
      active(ownerDoc).filter(function (activeElm) {
        return !eq$1(focusedElem, activeElm);
      }).filter(function (activeElm) {
        return eq$1(activeElm, SugarElement.fromDom(ownerDoc.dom.body)) || contains$2(headerElem, activeElm);
      }).each(function () {
        return focus$1(focusedElem);
      });
    };
    var findFocusedElem = function (rootElm, lazySink) {
      return search(rootElm).orThunk(function () {
        return lazySink().toOptional().bind(function (sink) {
          return search(sink.element);
        });
      });
    };
    var setup$5 = function (editor, sharedBackstage, lazyHeader) {
      if (!editor.inline) {
        if (!sharedBackstage.header.isPositionedAtTop()) {
          editor.on('ResizeEditor', function () {
            lazyHeader().each(Docking.reset);
          });
        }
        editor.on('ResizeWindow ResizeEditor', function () {
          lazyHeader().each(updateIframeContentFlow);
        });
        editor.on('SkinLoaded', function () {
          lazyHeader().each(function (comp) {
            Docking.isDocked(comp) ? Docking.reset(comp) : Docking.refresh(comp);
          });
        });
        editor.on('FullscreenStateChanged', function () {
          lazyHeader().each(Docking.reset);
        });
      }
      editor.on('AfterScrollIntoView', function (e) {
        lazyHeader().each(function (header) {
          Docking.refresh(header);
          var headerElem = header.element;
          if (isVisible(headerElem)) {
            scrollFromBehindHeader(e, headerElem);
          }
        });
      });
      editor.on('PostRender', function () {
        updateEditorClasses(editor, false);
      });
    };
    var isDocked$2 = function (lazyHeader) {
      return lazyHeader().map(Docking.isDocked).getOr(false);
    };
    var getIframeBehaviours = function () {
      var _a;
      return [Receiving.config({ channels: (_a = {}, _a[toolbarHeightChange()] = { onReceive: updateIframeContentFlow }, _a) })];
    };
    var getBehaviours$3 = function (editor, sharedBackstage) {
      var focusedElm = Cell(Optional.none());
      var lazySink = sharedBackstage.getSink;
      var runOnSinkElement = function (f) {
        lazySink().each(function (sink) {
          return f(sink.element);
        });
      };
      var onDockingSwitch = function (comp) {
        if (!editor.inline) {
          updateIframeContentFlow(comp);
        }
        updateEditorClasses(editor, Docking.isDocked(comp));
        comp.getSystem().broadcastOn([repositionPopups()], {});
        lazySink().each(function (sink) {
          return sink.getSystem().broadcastOn([repositionPopups()], {});
        });
      };
      var additionalBehaviours = editor.inline ? [] : getIframeBehaviours();
      return __spreadArrays([
        Focusing.config({}),
        Docking.config({
          contextual: __assign({
            lazyContext: function (comp) {
              var headerHeight = getOuter$1(comp.element);
              var container = editor.inline ? editor.getContentAreaContainer() : editor.getContainer();
              var box$1 = box(SugarElement.fromDom(container));
              var boxHeight = box$1.height - headerHeight;
              var topBound = box$1.y + (isDockedMode(comp, 'top') ? 0 : headerHeight);
              return Optional.some(bounds$1(box$1.x, topBound, box$1.width, boxHeight));
            },
            onShow: function () {
              runOnSinkElement(function (elem) {
                return updateSinkVisibility(elem, true);
              });
            },
            onShown: function (comp) {
              runOnSinkElement(function (elem) {
                return remove$5(elem, [
                  visibility.transitionClass,
                  visibility.fadeInClass
                ]);
              });
              focusedElm.get().each(function (elem) {
                restoreFocus(comp.element, elem);
                focusedElm.set(Optional.none());
              });
            },
            onHide: function (comp) {
              focusedElm.set(findFocusedElem(comp.element, lazySink));
              runOnSinkElement(function (elem) {
                return updateSinkVisibility(elem, false);
              });
            },
            onHidden: function () {
              runOnSinkElement(function (elem) {
                return remove$5(elem, [visibility.transitionClass]);
              });
            }
          }, visibility),
          modes: [sharedBackstage.header.getDockingMode()],
          onDocked: onDockingSwitch,
          onUndocked: onDockingSwitch
        })
      ], additionalBehaviours);
    };

    var StickyHeader = /*#__PURE__*/Object.freeze({
        __proto__: null,
        setup: setup$5,
        isDocked: isDocked$2,
        getBehaviours: getBehaviours$3
    });

    var renderHeader = function (spec) {
      var editor = spec.editor;
      var getBehaviours = spec.sticky ? getBehaviours$3 : getBehaviours$2;
      return {
        uid: spec.uid,
        dom: spec.dom,
        components: spec.components,
        behaviours: derive$1(getBehaviours(editor, spec.sharedBackstage))
      };
    };

    var factory$g = function (detail, spec) {
      var setMenus = function (comp, menus) {
        var newMenus = map(menus, function (m) {
          var buttonSpec = {
            type: 'menubutton',
            text: m.text,
            fetch: function (callback) {
              callback(m.getItems());
            }
          };
          var internal = createMenuButton(buttonSpec).mapError(function (errInfo) {
            return formatError(errInfo);
          }).getOrDie();
          return renderMenuButton(internal, 'tox-mbtn', spec.backstage, Optional.some('menuitem'));
        });
        Replacing.set(comp, newMenus);
      };
      var apis = {
        focus: Keying.focusIn,
        setMenus: setMenus
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: [],
        behaviours: derive$1([
          Replacing.config({}),
          config('menubar-events', [
            runOnAttached(function (component) {
              detail.onSetup(component);
            }),
            run(mouseover(), function (comp, se) {
              descendant$1(comp.element, '.' + 'tox-mbtn--active').each(function (activeButton) {
                closest$3(se.event.target, '.' + 'tox-mbtn').each(function (hoveredButton) {
                  if (!eq$1(activeButton, hoveredButton)) {
                    comp.getSystem().getByDom(activeButton).each(function (activeComp) {
                      comp.getSystem().getByDom(hoveredButton).each(function (hoveredComp) {
                        Dropdown.expand(hoveredComp);
                        Dropdown.close(activeComp);
                        Focusing.focus(hoveredComp);
                      });
                    });
                  }
                });
              });
            }),
            run(focusShifted(), function (comp, se) {
              se.event.prevFocus.bind(function (prev) {
                return comp.getSystem().getByDom(prev).toOptional();
              }).each(function (prev) {
                se.event.newFocus.bind(function (nu) {
                  return comp.getSystem().getByDom(nu).toOptional();
                }).each(function (nu) {
                  if (Dropdown.isOpen(prev)) {
                    Dropdown.expand(nu);
                    Dropdown.close(prev);
                  }
                });
              });
            })
          ]),
          Keying.config({
            mode: 'flow',
            selector: '.' + 'tox-mbtn',
            onEscape: function (comp) {
              detail.onEscape(comp);
              return Optional.some(true);
            }
          }),
          Tabstopping.config({})
        ]),
        apis: apis,
        domModification: { attributes: { role: 'menubar' } }
      };
    };
    var SilverMenubar = single$2({
      factory: factory$g,
      name: 'silver.Menubar',
      configFields: [
        strict$1('dom'),
        strict$1('uid'),
        strict$1('onEscape'),
        strict$1('backstage'),
        defaulted$1('onSetup', noop)
      ],
      apis: {
        focus: function (apis, comp) {
          apis.focus(comp);
        },
        setMenus: function (apis, comp, menus) {
          apis.setMenus(comp, menus);
        }
      }
    });

    var owner$4 = 'container';
    var schema$s = [field$1('slotBehaviours', [])];
    var getPartName$1 = function (name) {
      return '<alloy.field.' + name + '>';
    };
    var sketch$2 = function (sSpec) {
      var parts = function () {
        var record = [];
        var slot = function (name, config) {
          record.push(name);
          return generateOne(owner$4, getPartName$1(name), config);
        };
        return {
          slot: slot,
          record: function () {
            return record;
          }
        };
      }();
      var spec = sSpec(parts);
      var partNames = parts.record();
      var fieldParts = map(partNames, function (n) {
        return required({
          name: n,
          pname: getPartName$1(n)
        });
      });
      return composite(owner$4, schema$s, fieldParts, make$7, spec);
    };
    var make$7 = function (detail, components) {
      var getSlotNames = function (_) {
        return getAllPartNames(detail);
      };
      var getSlot = function (container, key) {
        return getPart(container, detail, key);
      };
      var onSlot = function (f, def) {
        return function (container, key) {
          return getPart(container, detail, key).map(function (slot) {
            return f(slot, key);
          }).getOr(def);
        };
      };
      var onSlots = function (f) {
        return function (container, keys) {
          each(keys, function (key) {
            return f(container, key);
          });
        };
      };
      var doShowing = function (comp, _key) {
        return get$3(comp.element, 'aria-hidden') !== 'true';
      };
      var doShow = function (comp, key) {
        if (!doShowing(comp)) {
          var element = comp.element;
          remove$6(element, 'display');
          remove$1(element, 'aria-hidden');
          emitWith(comp, slotVisibility(), {
            name: key,
            visible: true
          });
        }
      };
      var doHide = function (comp, key) {
        if (doShowing(comp)) {
          var element = comp.element;
          set$2(element, 'display', 'none');
          set$1(element, 'aria-hidden', 'true');
          emitWith(comp, slotVisibility(), {
            name: key,
            visible: false
          });
        }
      };
      var isShowing = onSlot(doShowing, false);
      var hideSlot = onSlot(doHide);
      var hideSlots = onSlots(hideSlot);
      var hideAllSlots = function (container) {
        return hideSlots(container, getSlotNames());
      };
      var showSlot = onSlot(doShow);
      var apis = {
        getSlotNames: getSlotNames,
        getSlot: getSlot,
        isShowing: isShowing,
        hideSlot: hideSlot,
        hideAllSlots: hideAllSlots,
        showSlot: showSlot
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: get$d(detail.slotBehaviours),
        apis: apis
      };
    };
    var slotApis = map$2({
      getSlotNames: function (apis, c) {
        return apis.getSlotNames(c);
      },
      getSlot: function (apis, c, key) {
        return apis.getSlot(c, key);
      },
      isShowing: function (apis, c, key) {
        return apis.isShowing(c, key);
      },
      hideSlot: function (apis, c, key) {
        return apis.hideSlot(c, key);
      },
      hideAllSlots: function (apis, c) {
        return apis.hideAllSlots(c);
      },
      showSlot: function (apis, c, key) {
        return apis.showSlot(c, key);
      }
    }, function (value) {
      return makeApi(value);
    });
    var SlotContainer = __assign(__assign({}, slotApis), { sketch: sketch$2 });

    var sidebarSchema = objOf([
      optionString('icon'),
      optionString('tooltip'),
      defaultedFunction('onShow', noop),
      defaultedFunction('onHide', noop),
      defaultedFunction('onSetup', function () {
        return noop;
      })
    ]);
    var createSidebar = function (spec) {
      return asRaw('sidebar', sidebarSchema, spec);
    };

    var setup$6 = function (editor) {
      var sidebars = editor.ui.registry.getAll().sidebars;
      each(keys(sidebars), function (name) {
        var spec = sidebars[name];
        var isActive = function () {
          return Optional.from(editor.queryCommandValue('ToggleSidebar')).is(name);
        };
        editor.ui.registry.addToggleButton(name, {
          icon: spec.icon,
          tooltip: spec.tooltip,
          onAction: function (buttonApi) {
            editor.execCommand('ToggleSidebar', false, name);
            buttonApi.setActive(isActive());
          },
          onSetup: function (buttonApi) {
            var handleToggle = function () {
              return buttonApi.setActive(isActive());
            };
            editor.on('ToggleSidebar', handleToggle);
            return function () {
              editor.off('ToggleSidebar', handleToggle);
            };
          }
        });
      });
    };
    var getApi = function (comp) {
      return {
        element: function () {
          return comp.element.dom;
        }
      };
    };
    var makePanels = function (parts, panelConfigs) {
      var specs = map(keys(panelConfigs), function (name) {
        var spec = panelConfigs[name];
        var bridged = getOrDie(createSidebar(spec));
        return {
          name: name,
          getApi: getApi,
          onSetup: bridged.onSetup,
          onShow: bridged.onShow,
          onHide: bridged.onHide
        };
      });
      return map(specs, function (spec) {
        var editorOffCell = Cell(noop);
        return parts.slot(spec.name, {
          dom: {
            tag: 'div',
            classes: ['tox-sidebar__pane']
          },
          behaviours: SimpleBehaviours.unnamedEvents([
            onControlAttached(spec, editorOffCell),
            onControlDetached(spec, editorOffCell),
            run(slotVisibility(), function (sidepanel, se) {
              var data = se.event;
              var optSidePanelSpec = find(specs, function (config) {
                return config.name === data.name;
              });
              optSidePanelSpec.each(function (sidePanelSpec) {
                var handler = data.visible ? sidePanelSpec.onShow : sidePanelSpec.onHide;
                handler(sidePanelSpec.getApi(sidepanel));
              });
            })
          ])
        });
      });
    };
    var makeSidebar = function (panelConfigs) {
      return SlotContainer.sketch(function (parts) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-sidebar__pane-container']
          },
          components: makePanels(parts, panelConfigs),
          slotBehaviours: SimpleBehaviours.unnamedEvents([runOnAttached(function (slotContainer) {
              return SlotContainer.hideAllSlots(slotContainer);
            })])
        };
      });
    };
    var setSidebar = function (sidebar, panelConfigs) {
      var optSlider = Composing.getCurrent(sidebar);
      optSlider.each(function (slider) {
        return Replacing.set(slider, [makeSidebar(panelConfigs)]);
      });
    };
    var toggleSidebar = function (sidebar, name) {
      var optSlider = Composing.getCurrent(sidebar);
      optSlider.each(function (slider) {
        var optSlotContainer = Composing.getCurrent(slider);
        optSlotContainer.each(function (slotContainer) {
          if (Sliding.hasGrown(slider)) {
            if (SlotContainer.isShowing(slotContainer, name)) {
              Sliding.shrink(slider);
            } else {
              SlotContainer.hideAllSlots(slotContainer);
              SlotContainer.showSlot(slotContainer, name);
            }
          } else {
            SlotContainer.hideAllSlots(slotContainer);
            SlotContainer.showSlot(slotContainer, name);
            Sliding.grow(slider);
          }
        });
      });
    };
    var whichSidebar = function (sidebar) {
      var optSlider = Composing.getCurrent(sidebar);
      return optSlider.bind(function (slider) {
        var sidebarOpen = Sliding.isGrowing(slider) || Sliding.hasGrown(slider);
        if (sidebarOpen) {
          var optSlotContainer = Composing.getCurrent(slider);
          return optSlotContainer.bind(function (slotContainer) {
            return find(SlotContainer.getSlotNames(slotContainer), function (name) {
              return SlotContainer.isShowing(slotContainer, name);
            });
          });
        } else {
          return Optional.none();
        }
      });
    };
    var fixSize = generate$1('FixSizeEvent');
    var autoSize = generate$1('AutoSizeEvent');
    var renderSidebar = function (spec) {
      return {
        uid: spec.uid,
        dom: {
          tag: 'div',
          classes: ['tox-sidebar'],
          attributes: { role: 'complementary' }
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-sidebar__slider']
            },
            components: [],
            behaviours: derive$1([
              Tabstopping.config({}),
              Focusing.config({}),
              Sliding.config({
                dimension: { property: 'width' },
                closedClass: 'tox-sidebar--sliding-closed',
                openClass: 'tox-sidebar--sliding-open',
                shrinkingClass: 'tox-sidebar--sliding-shrinking',
                growingClass: 'tox-sidebar--sliding-growing',
                onShrunk: function (slider) {
                  var optSlotContainer = Composing.getCurrent(slider);
                  optSlotContainer.each(SlotContainer.hideAllSlots);
                  emit(slider, autoSize);
                },
                onGrown: function (slider) {
                  emit(slider, autoSize);
                },
                onStartGrow: function (slider) {
                  emitWith(slider, fixSize, { width: getRaw(slider.element, 'width').getOr('') });
                },
                onStartShrink: function (slider) {
                  emitWith(slider, fixSize, { width: get$8(slider.element) + 'px' });
                }
              }),
              Replacing.config({}),
              Composing.config({
                find: function (comp) {
                  var children = Replacing.contents(comp);
                  return head(children);
                }
              })
            ])
          }],
        behaviours: derive$1([
          ComposingConfigs.childAt(0),
          config('sidebar-sliding-events', [
            run(fixSize, function (comp, se) {
              set$2(comp.element, 'width', se.event.width);
            }),
            run(autoSize, function (comp, _se) {
              remove$6(comp.element, 'width');
            })
          ])
        ])
      };
    };

    var getAttrs = function (elem) {
      var attributes = elem.dom.attributes !== undefined ? elem.dom.attributes : [];
      return foldl(attributes, function (b, attr) {
        var _a;
        if (attr.name === 'class') {
          return b;
        } else {
          return __assign(__assign({}, b), (_a = {}, _a[attr.name] = attr.value, _a));
        }
      }, {});
    };
    var getClasses = function (elem) {
      return Array.prototype.slice.call(elem.dom.classList, 0);
    };
    var fromHtml$2 = function (html) {
      var elem = SugarElement.fromHtml(html);
      var children$1 = children(elem);
      var attrs = getAttrs(elem);
      var classes = getClasses(elem);
      var contents = children$1.length === 0 ? {} : { innerHtml: get$2(elem) };
      return __assign({
        tag: name(elem),
        classes: classes,
        attributes: attrs
      }, contents);
    };

    var renderSpinner = function (providerBackstage) {
      return {
        dom: {
          tag: 'div',
          attributes: { 'aria-label': providerBackstage.translate('Loading...') },
          classes: ['tox-throbber__busy-spinner']
        },
        components: [{ dom: fromHtml$2('<div class="tox-spinner"><div></div><div></div><div></div></div>') }],
        behaviours: derive$1([
          Keying.config({
            mode: 'special',
            onTab: function () {
              return Optional.some(true);
            },
            onShiftTab: function () {
              return Optional.some(true);
            }
          }),
          Focusing.config({})
        ])
      };
    };
    var toggleThrobber = function (comp, state, providerBackstage) {
      var element = comp.element;
      if (state === true) {
        Replacing.set(comp, [renderSpinner(providerBackstage)]);
        remove$6(element, 'display');
        remove$1(element, 'aria-hidden');
      } else {
        Replacing.set(comp, []);
        set$2(element, 'display', 'none');
        set$1(element, 'aria-hidden', 'true');
      }
    };
    var renderThrobber = function (spec) {
      return {
        uid: spec.uid,
        dom: {
          tag: 'div',
          attributes: { 'aria-hidden': 'true' },
          classes: ['tox-throbber'],
          styles: { display: 'none' }
        },
        behaviours: derive$1([Replacing.config({})]),
        components: []
      };
    };
    var setup$7 = function (editor, lazyThrobber, sharedBackstage) {
      var throbberState = Cell(false);
      var timer = Cell(Optional.none());
      var toggle = function (state) {
        if (state !== throbberState.get()) {
          toggleThrobber(lazyThrobber(), state, sharedBackstage.providers);
          throbberState.set(state);
          editor.fire('AfterProgressState', { state: state });
        }
      };
      editor.on('ProgressState', function (e) {
        timer.get().each(global$2.clearTimeout);
        if (isNumber(e.time)) {
          var timerId = global$2.setEditorTimeout(editor, function () {
            return toggle(e.state);
          }, e.time);
          timer.set(Optional.some(timerId));
        } else {
          toggle(e.state);
          timer.set(Optional.none());
        }
      });
    };

    var factory$h = function (detail, components, _spec) {
      var apis = {
        getSocket: function (comp) {
          return parts$d.getPart(comp, detail, 'socket');
        },
        setSidebar: function (comp, panelConfigs) {
          parts$d.getPart(comp, detail, 'sidebar').each(function (sidebar) {
            return setSidebar(sidebar, panelConfigs);
          });
        },
        toggleSidebar: function (comp, name) {
          parts$d.getPart(comp, detail, 'sidebar').each(function (sidebar) {
            return toggleSidebar(sidebar, name);
          });
        },
        whichSidebar: function (comp) {
          return parts$d.getPart(comp, detail, 'sidebar').bind(whichSidebar).getOrNull();
        },
        getHeader: function (comp) {
          return parts$d.getPart(comp, detail, 'header');
        },
        getToolbar: function (comp) {
          return parts$d.getPart(comp, detail, 'toolbar');
        },
        setToolbar: function (comp, groups) {
          parts$d.getPart(comp, detail, 'toolbar').each(function (toolbar) {
            toolbar.getApis().setGroups(toolbar, groups);
          });
        },
        setToolbars: function (comp, toolbars) {
          parts$d.getPart(comp, detail, 'multiple-toolbar').each(function (mToolbar) {
            CustomList.setItems(mToolbar, toolbars);
          });
        },
        refreshToolbar: function (comp) {
          var toolbar = parts$d.getPart(comp, detail, 'toolbar');
          toolbar.each(function (toolbar) {
            return toolbar.getApis().refresh(toolbar);
          });
        },
        toggleToolbarDrawer: function (comp) {
          parts$d.getPart(comp, detail, 'toolbar').each(function (toolbar) {
            mapFrom(toolbar.getApis().toggle, function (toggle) {
              return toggle(toolbar);
            });
          });
        },
        isToolbarDrawerToggled: function (comp) {
          return parts$d.getPart(comp, detail, 'toolbar').bind(function (toolbar) {
            return Optional.from(toolbar.getApis().isOpen).map(function (isOpen) {
              return isOpen(toolbar);
            });
          }).getOr(false);
        },
        getThrobber: function (comp) {
          return parts$d.getPart(comp, detail, 'throbber');
        },
        focusToolbar: function (comp) {
          var optToolbar = parts$d.getPart(comp, detail, 'toolbar').orThunk(function () {
            return parts$d.getPart(comp, detail, 'multiple-toolbar');
          });
          optToolbar.each(function (toolbar) {
            Keying.focusIn(toolbar);
          });
        },
        setMenubar: function (comp, menus) {
          parts$d.getPart(comp, detail, 'menubar').each(function (menubar) {
            SilverMenubar.setMenus(menubar, menus);
          });
        },
        focusMenubar: function (comp) {
          parts$d.getPart(comp, detail, 'menubar').each(function (menubar) {
            SilverMenubar.focus(menubar);
          });
        }
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        apis: apis,
        behaviours: detail.behaviours
      };
    };
    var partMenubar = partType$1.optional({
      factory: SilverMenubar,
      name: 'menubar',
      schema: [strict$1('backstage')]
    });
    var toolbarFactory = function (spec) {
      if (spec.type === ToolbarMode.sliding) {
        return renderSlidingMoreToolbar;
      } else if (spec.type === ToolbarMode.floating) {
        return renderFloatingMoreToolbar;
      } else {
        return renderToolbar;
      }
    };
    var partMultipleToolbar = partType$1.optional({
      factory: {
        sketch: function (spec) {
          return CustomList.sketch({
            uid: spec.uid,
            dom: spec.dom,
            listBehaviours: derive$1([Keying.config({
                mode: 'acyclic',
                selector: '.tox-toolbar'
              })]),
            makeItem: function () {
              return renderToolbar({
                type: spec.type,
                uid: generate$1('multiple-toolbar-item'),
                cyclicKeying: false,
                initGroups: [],
                providers: spec.providers,
                onEscape: function () {
                  spec.onEscape();
                  return Optional.some(true);
                }
              });
            },
            setupItem: function (_mToolbar, tc, data, _index) {
              Toolbar.setGroups(tc, data);
            },
            shell: true
          });
        }
      },
      name: 'multiple-toolbar',
      schema: [
        strict$1('dom'),
        strict$1('onEscape')
      ]
    });
    var partToolbar = partType$1.optional({
      factory: {
        sketch: function (spec) {
          var renderer = toolbarFactory(spec);
          var toolbarSpec = {
            type: spec.type,
            uid: spec.uid,
            onEscape: function () {
              spec.onEscape();
              return Optional.some(true);
            },
            cyclicKeying: false,
            initGroups: [],
            getSink: spec.getSink,
            providers: spec.providers,
            moreDrawerData: {
              lazyToolbar: spec.lazyToolbar,
              lazyMoreButton: spec.lazyMoreButton,
              lazyHeader: spec.lazyHeader
            },
            attributes: spec.attributes
          };
          return renderer(toolbarSpec);
        }
      },
      name: 'toolbar',
      schema: [
        strict$1('dom'),
        strict$1('onEscape'),
        strict$1('getSink')
      ]
    });
    var partHeader = partType$1.optional({
      factory: { sketch: renderHeader },
      name: 'header',
      schema: [strict$1('dom')]
    });
    var partSocket = partType$1.optional({
      name: 'socket',
      schema: [strict$1('dom')]
    });
    var partSidebar = partType$1.optional({
      factory: { sketch: renderSidebar },
      name: 'sidebar',
      schema: [strict$1('dom')]
    });
    var partThrobber = partType$1.optional({
      factory: { sketch: renderThrobber },
      name: 'throbber',
      schema: [strict$1('dom')]
    });
    var OuterContainer = composite$1({
      name: 'OuterContainer',
      factory: factory$h,
      configFields: [
        strict$1('dom'),
        strict$1('behaviours')
      ],
      partFields: [
        partHeader,
        partMenubar,
        partToolbar,
        partMultipleToolbar,
        partSocket,
        partSidebar,
        partThrobber
      ],
      apis: {
        getSocket: function (apis, comp) {
          return apis.getSocket(comp);
        },
        setSidebar: function (apis, comp, panelConfigs) {
          apis.setSidebar(comp, panelConfigs);
        },
        toggleSidebar: function (apis, comp, name) {
          apis.toggleSidebar(comp, name);
        },
        whichSidebar: function (apis, comp) {
          return apis.whichSidebar(comp);
        },
        getHeader: function (apis, comp) {
          return apis.getHeader(comp);
        },
        getToolbar: function (apis, comp) {
          return apis.getToolbar(comp);
        },
        setToolbar: function (apis, comp, grps) {
          var groups = map(grps, function (grp) {
            return renderToolbarGroup(grp);
          });
          apis.setToolbar(comp, groups);
        },
        setToolbars: function (apis, comp, ts) {
          var renderedToolbars = map(ts, function (g) {
            return map(g, renderToolbarGroup);
          });
          apis.setToolbars(comp, renderedToolbars);
        },
        refreshToolbar: function (apis, comp) {
          return apis.refreshToolbar(comp);
        },
        toggleToolbarDrawer: function (apis, comp) {
          apis.toggleToolbarDrawer(comp);
        },
        isToolbarDrawerToggled: function (apis, comp) {
          return apis.isToolbarDrawerToggled(comp);
        },
        getThrobber: function (apis, comp) {
          return apis.getThrobber(comp);
        },
        setMenubar: function (apis, comp, menus) {
          apis.setMenubar(comp, menus);
        },
        focusMenubar: function (apis, comp) {
          apis.focusMenubar(comp);
        },
        focusToolbar: function (apis, comp) {
          apis.focusToolbar(comp);
        }
      }
    });

    var defaultMenubar = 'file edit view insert format tools table help';
    var defaultMenus = {
      file: {
        title: 'File',
        items: 'newdocument restoredraft | preview | export print | deleteallconversations'
      },
      edit: {
        title: 'Edit',
        items: 'undo redo | cut copy paste pastetext | selectall | searchreplace'
      },
      view: {
        title: 'View',
        items: 'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments'
      },
      insert: {
        title: 'Insert',
        items: 'image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime'
      },
      format: {
        title: 'Format',
        items: 'bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align lineheight | forecolor backcolor | removeformat'
      },
      tools: {
        title: 'Tools',
        items: 'spellchecker spellcheckerlanguage | a11ycheck code wordcount'
      },
      table: {
        title: 'Table',
        items: 'inserttable | cell row column | advtablesort | tableprops deletetable'
      },
      help: {
        title: 'Help',
        items: 'help'
      }
    };
    var make$8 = function (menu, registry, editor) {
      var removedMenuItems = getRemovedMenuItems(editor).split(/[ ,]/);
      return {
        text: menu.title,
        getItems: function () {
          return bind(menu.items, function (i) {
            var itemName = i.toLowerCase();
            if (itemName.trim().length === 0) {
              return [];
            } else if (exists(removedMenuItems, function (removedMenuItem) {
                return removedMenuItem === itemName;
              })) {
              return [];
            } else if (itemName === 'separator' || itemName === '|') {
              return [{ type: 'separator' }];
            } else if (registry.menuItems[itemName]) {
              return [registry.menuItems[itemName]];
            } else {
              return [];
            }
          });
        }
      };
    };
    var parseItemsString = function (items) {
      if (typeof items === 'string') {
        return items.split(' ');
      }
      return items;
    };
    var identifyMenus = function (editor, registry) {
      var rawMenuData = __assign(__assign({}, defaultMenus), registry.menus);
      var userDefinedMenus = keys(registry.menus).length > 0;
      var menubar = registry.menubar === undefined || registry.menubar === true ? parseItemsString(defaultMenubar) : parseItemsString(registry.menubar === false ? '' : registry.menubar);
      var validMenus = filter(menubar, function (menuName) {
        return userDefinedMenus ? registry.menus.hasOwnProperty(menuName) && registry.menus[menuName].hasOwnProperty('items') || defaultMenus.hasOwnProperty(menuName) : defaultMenus.hasOwnProperty(menuName);
      });
      var menus = map(validMenus, function (menuName) {
        var menuData = rawMenuData[menuName];
        return make$8({
          title: menuData.title,
          items: parseItemsString(menuData.items)
        }, registry, editor);
      });
      return filter(menus, function (menu) {
        var isNotSeparator = function (item) {
          return item.type !== 'separator';
        };
        return menu.getItems().length > 0 && exists(menu.getItems(), isNotSeparator);
      });
    };

    var fireSkinLoaded$1 = function (editor) {
      var done = function () {
        editor._skinLoaded = true;
        fireSkinLoaded(editor);
      };
      return function () {
        if (editor.initialized) {
          done();
        } else {
          editor.on('init', done);
        }
      };
    };
    var fireSkinLoadError$1 = function (editor, err) {
      return function () {
        return fireSkinLoadError(editor, { message: err });
      };
    };

    var loadStylesheet = function (editor, stylesheetUrl, styleSheetLoader) {
      return new global$4(function (resolve, reject) {
        styleSheetLoader.load(stylesheetUrl, resolve, reject);
        editor.on('remove', function () {
          return styleSheetLoader.unload(stylesheetUrl);
        });
      });
    };
    var loadUiSkins = function (editor, skinUrl) {
      var skinUiCss = skinUrl + '/skin.min.css';
      return loadStylesheet(editor, skinUiCss, editor.ui.styleSheetLoader);
    };
    var loadShadowDomUiSkins = function (editor, skinUrl) {
      var isInShadowRoot$1 = isInShadowRoot(SugarElement.fromDom(editor.getElement()));
      if (isInShadowRoot$1) {
        var shadowDomSkinCss = skinUrl + '/skin.shadowdom.min.css';
        return loadStylesheet(editor, shadowDomSkinCss, global$5.DOM.styleSheetLoader);
      } else {
        return global$4.resolve();
      }
    };
    var loadSkin = function (isInline, editor) {
      var skinUrl = getSkinUrl(editor);
      if (skinUrl) {
        editor.contentCSS.push(skinUrl + (isInline ? '/content.inline' : '/content') + '.min.css');
      }
      if (isSkinDisabled(editor) === false && isString(skinUrl)) {
        global$4.all([
          loadUiSkins(editor, skinUrl),
          loadShadowDomUiSkins(editor, skinUrl)
        ]).then(fireSkinLoaded$1(editor), fireSkinLoadError$1(editor, 'Skin could not be loaded'));
      } else {
        fireSkinLoaded$1(editor)();
      }
    };
    var iframe = curry(loadSkin, false);
    var inline = curry(loadSkin, true);

    var setToolbar = function (editor, uiComponents, rawUiConfig, backstage) {
      var comp = uiComponents.outerContainer;
      var toolbarConfig = rawUiConfig.toolbar;
      var toolbarButtonsConfig = rawUiConfig.buttons;
      if (isArrayOf(toolbarConfig, isString)) {
        var toolbars = toolbarConfig.map(function (t) {
          var config = {
            toolbar: t,
            buttons: toolbarButtonsConfig,
            allowToolbarGroups: rawUiConfig.allowToolbarGroups
          };
          return identifyButtons(editor, config, { backstage: backstage }, Optional.none());
        });
        OuterContainer.setToolbars(comp, toolbars);
      } else {
        OuterContainer.setToolbar(comp, identifyButtons(editor, rawUiConfig, { backstage: backstage }, Optional.none()));
      }
    };

    var detection = detect$3();
    var isiOS12 = detection.os.isiOS() && detection.os.version.major <= 12;
    var setupEvents = function (editor, uiComponents) {
      var dom = editor.dom;
      var contentWindow = editor.getWin();
      var initialDocEle = editor.getDoc().documentElement;
      var lastWindowDimensions = Cell(SugarPosition(contentWindow.innerWidth, contentWindow.innerHeight));
      var lastDocumentDimensions = Cell(SugarPosition(initialDocEle.offsetWidth, initialDocEle.offsetHeight));
      var resizeWindow = function () {
        var outer = lastWindowDimensions.get();
        if (outer.left !== contentWindow.innerWidth || outer.top !== contentWindow.innerHeight) {
          lastWindowDimensions.set(SugarPosition(contentWindow.innerWidth, contentWindow.innerHeight));
          fireResizeContent(editor);
        }
      };
      var resizeDocument = function () {
        var docEle = editor.getDoc().documentElement;
        var inner = lastDocumentDimensions.get();
        if (inner.left !== docEle.offsetWidth || inner.top !== docEle.offsetHeight) {
          lastDocumentDimensions.set(SugarPosition(docEle.offsetWidth, docEle.offsetHeight));
          fireResizeContent(editor);
        }
      };
      var scroll = function (e) {
        return fireScrollContent(editor, e);
      };
      dom.bind(contentWindow, 'resize', resizeWindow);
      dom.bind(contentWindow, 'scroll', scroll);
      var elementLoad = capture$1(SugarElement.fromDom(editor.getBody()), 'load', resizeDocument);
      var mothership = uiComponents.uiMothership.element;
      editor.on('hide', function () {
        set$2(mothership, 'display', 'none');
      });
      editor.on('show', function () {
        remove$6(mothership, 'display');
      });
      editor.on('NodeChange', resizeDocument);
      editor.on('remove', function () {
        elementLoad.unbind();
        dom.unbind(contentWindow, 'resize', resizeWindow);
        dom.unbind(contentWindow, 'scroll', scroll);
        contentWindow = null;
      });
    };
    var render$1 = function (editor, uiComponents, rawUiConfig, backstage, args) {
      var lastToolbarWidth = Cell(0);
      var outerContainer = uiComponents.outerContainer;
      iframe(editor);
      var eTargetNode = SugarElement.fromDom(args.targetNode);
      var uiRoot = getContentContainer(getRootNode(eTargetNode));
      attachSystemAfter(eTargetNode, uiComponents.mothership);
      attachSystem(uiRoot, uiComponents.uiMothership);
      editor.on('PostRender', function () {
        setToolbar(editor, uiComponents, rawUiConfig, backstage);
        lastToolbarWidth.set(editor.getWin().innerWidth);
        OuterContainer.setMenubar(outerContainer, identifyMenus(editor, rawUiConfig));
        OuterContainer.setSidebar(outerContainer, rawUiConfig.sidebar);
        setupEvents(editor, uiComponents);
      });
      var socket = OuterContainer.getSocket(outerContainer).getOrDie('Could not find expected socket element');
      if (isiOS12) {
        setAll$1(socket.element, {
          'overflow': 'scroll',
          '-webkit-overflow-scrolling': 'touch'
        });
        var limit = first(function () {
          editor.fire('ScrollContent');
        }, 20);
        var unbinder = bind$3(socket.element, 'scroll', limit.throttle);
        editor.on('remove', unbinder.unbind);
      }
      setupReadonlyModeSwitch(editor, uiComponents);
      editor.addCommand('ToggleSidebar', function (_ui, value) {
        OuterContainer.toggleSidebar(outerContainer, value);
        editor.fire('ToggleSidebar');
      });
      editor.addQueryValueHandler('ToggleSidebar', function () {
        return OuterContainer.whichSidebar(outerContainer);
      });
      var toolbarMode = getToolbarMode(editor);
      var refreshDrawer = function () {
        OuterContainer.refreshToolbar(uiComponents.outerContainer);
      };
      if (toolbarMode === ToolbarMode.sliding || toolbarMode === ToolbarMode.floating) {
        editor.on('ResizeWindow ResizeEditor ResizeContent', function () {
          var width = editor.getWin().innerWidth;
          if (width !== lastToolbarWidth.get()) {
            refreshDrawer();
            lastToolbarWidth.set(width);
          }
        });
      }
      var api = {
        enable: function () {
          broadcastReadonly(uiComponents, false);
        },
        disable: function () {
          broadcastReadonly(uiComponents, true);
        },
        isDisabled: function () {
          return Disabling.isDisabled(outerContainer);
        }
      };
      return {
        iframeContainer: socket.element.dom,
        editorContainer: outerContainer.element.dom,
        api: api
      };
    };

    var Iframe = /*#__PURE__*/Object.freeze({
        __proto__: null,
        render: render$1
    });

    var parseToInt = function (val) {
      var re = /^[0-9\.]+(|px)$/i;
      if (re.test('' + val)) {
        return Optional.some(parseInt('' + val, 10));
      }
      return Optional.none();
    };
    var numToPx = function (val) {
      return isNumber(val) ? val + 'px' : val;
    };
    var calcCappedSize = function (size, minSize, maxSize) {
      var minOverride = minSize.filter(function (min) {
        return size < min;
      });
      var maxOverride = maxSize.filter(function (max) {
        return size > max;
      });
      return minOverride.or(maxOverride).getOr(size);
    };

    var getHeight$1 = function (editor) {
      var baseHeight = getHeightSetting(editor);
      var minHeight = getMinHeightSetting(editor);
      var maxHeight = getMaxHeightSetting(editor);
      return parseToInt(baseHeight).map(function (height) {
        return calcCappedSize(height, minHeight, maxHeight);
      });
    };
    var getHeightWithFallback = function (editor) {
      var height = getHeight$1(editor);
      return height.getOr(getHeightSetting(editor));
    };
    var getWidth$1 = function (editor) {
      var baseWidth = getWidthSetting(editor);
      var minWidth = getMinWidthSetting(editor);
      var maxWidth = getMaxWidthSetting(editor);
      return parseToInt(baseWidth).map(function (width) {
        return calcCappedSize(width, minWidth, maxWidth);
      });
    };
    var getWidthWithFallback = function (editor) {
      var width = getWidth$1(editor);
      return width.getOr(getWidthSetting(editor));
    };

    var InlineHeader = function (editor, targetElm, uiComponents, backstage, floatContainer) {
      var uiMothership = uiComponents.uiMothership, outerContainer = uiComponents.outerContainer;
      var DOM = global$5.DOM;
      var useFixedToolbarContainer = useFixedContainer(editor);
      var isSticky = isStickyToolbar(editor);
      var editorMaxWidthOpt = getMaxWidthSetting(editor).or(getWidth$1(editor));
      var headerBackstage = backstage.shared.header;
      var isPositionedAtTop = headerBackstage.isPositionedAtTop;
      var toolbarMode = getToolbarMode(editor);
      var isSplitToolbar = toolbarMode === ToolbarMode.sliding || toolbarMode === ToolbarMode.floating;
      var visible = Cell(false);
      var isVisible = function () {
        return visible.get() && !editor.removed;
      };
      var calcToolbarOffset = function (toolbar) {
        return isSplitToolbar ? toolbar.fold(function () {
          return 0;
        }, function (tbar) {
          return tbar.components().length > 1 ? get$7(tbar.components()[1].element) : 0;
        }) : 0;
      };
      var calcMode = function (container) {
        switch (getToolbarLocation(editor)) {
        case ToolbarLocation.auto:
          var toolbar_1 = OuterContainer.getToolbar(outerContainer);
          var offset = calcToolbarOffset(toolbar_1);
          var toolbarHeight = get$7(container.element) - offset;
          var targetBounds = box(targetElm);
          var roomAtTop = targetBounds.y > toolbarHeight;
          if (roomAtTop) {
            return 'top';
          } else {
            var doc = documentElement(targetElm);
            var docHeight = Math.max(doc.dom.scrollHeight, get$7(doc));
            var roomAtBottom = targetBounds.bottom < docHeight - toolbarHeight;
            if (roomAtBottom) {
              return 'bottom';
            } else {
              var winBounds = win();
              var isRoomAtBottomViewport = winBounds.bottom < targetBounds.bottom - toolbarHeight;
              return isRoomAtBottomViewport ? 'bottom' : 'top';
            }
          }
        case ToolbarLocation.bottom:
          return 'bottom';
        case ToolbarLocation.top:
        default:
          return 'top';
        }
      };
      var setupMode = function (mode) {
        var container = floatContainer.get();
        Docking.setModes(container, [mode]);
        headerBackstage.setDockingMode(mode);
        var verticalDir = isPositionedAtTop() ? AttributeValue.TopToBottom : AttributeValue.BottomToTop;
        set$1(container.element, Attribute, verticalDir);
      };
      var updateChromeWidth = function () {
        var maxWidth = editorMaxWidthOpt.getOrThunk(function () {
          var bodyMargin = parseToInt(get$5(body(), 'margin-left')).getOr(0);
          return get$8(body()) - absolute(targetElm).left + bodyMargin;
        });
        set$2(floatContainer.get().element, 'max-width', maxWidth + 'px');
      };
      var updateChromePosition = function () {
        var toolbar = OuterContainer.getToolbar(outerContainer);
        var offset = calcToolbarOffset(toolbar);
        var targetBounds = box(targetElm);
        var top = isPositionedAtTop() ? Math.max(targetBounds.y - get$7(floatContainer.get().element) + offset, 0) : targetBounds.bottom;
        setAll$1(outerContainer.element, {
          position: 'absolute',
          top: Math.round(top) + 'px',
          left: Math.round(targetBounds.x) + 'px'
        });
      };
      var repositionPopups$1 = function () {
        uiMothership.broadcastOn([repositionPopups()], {});
      };
      var updateChromeUi = function (resetDocking) {
        if (resetDocking === void 0) {
          resetDocking = false;
        }
        if (!isVisible()) {
          return;
        }
        if (!useFixedToolbarContainer) {
          updateChromeWidth();
        }
        if (isSplitToolbar) {
          OuterContainer.refreshToolbar(outerContainer);
        }
        if (!useFixedToolbarContainer) {
          updateChromePosition();
        }
        if (isSticky) {
          var floatContainerComp = floatContainer.get();
          resetDocking ? Docking.reset(floatContainerComp) : Docking.refresh(floatContainerComp);
        }
        repositionPopups$1();
      };
      var updateMode = function (updateUi) {
        if (updateUi === void 0) {
          updateUi = true;
        }
        if (useFixedToolbarContainer || !isSticky || !isVisible()) {
          return;
        }
        var currentMode = headerBackstage.getDockingMode();
        var newMode = calcMode(floatContainer.get());
        if (newMode !== currentMode) {
          setupMode(newMode);
          if (updateUi) {
            updateChromeUi(true);
          }
        }
      };
      var show = function () {
        visible.set(true);
        set$2(outerContainer.element, 'display', 'flex');
        DOM.addClass(editor.getBody(), 'mce-edit-focus');
        remove$6(uiMothership.element, 'display');
        updateMode(false);
        updateChromeUi();
      };
      var hide = function () {
        visible.set(false);
        if (uiComponents.outerContainer) {
          set$2(outerContainer.element, 'display', 'none');
          DOM.removeClass(editor.getBody(), 'mce-edit-focus');
        }
        set$2(uiMothership.element, 'display', 'none');
      };
      return {
        isVisible: isVisible,
        isPositionedAtTop: isPositionedAtTop,
        show: show,
        hide: hide,
        update: updateChromeUi,
        updateMode: updateMode,
        repositionPopups: repositionPopups$1
      };
    };

    var getTargetPosAndBounds = function (targetElm, isToolbarTop) {
      var bounds = box(targetElm);
      return {
        pos: isToolbarTop ? bounds.y : bounds.bottom,
        bounds: bounds
      };
    };
    var setupEvents$1 = function (editor, targetElm, ui, toolbarPersist) {
      var prevPosAndBounds = Cell(getTargetPosAndBounds(targetElm, ui.isPositionedAtTop()));
      var resizeContent = function (e) {
        var _a = getTargetPosAndBounds(targetElm, ui.isPositionedAtTop()), pos = _a.pos, bounds = _a.bounds;
        var _b = prevPosAndBounds.get(), prevPos = _b.pos, prevBounds = _b.bounds;
        var hasResized = bounds.height !== prevBounds.height || bounds.width !== prevBounds.width;
        prevPosAndBounds.set({
          pos: pos,
          bounds: bounds
        });
        if (hasResized) {
          fireResizeContent(editor, e);
        }
        if (ui.isVisible()) {
          if (prevPos !== pos) {
            ui.update(true);
          } else if (hasResized) {
            ui.updateMode();
            ui.repositionPopups();
          }
        }
      };
      if (!toolbarPersist) {
        editor.on('activate', ui.show);
        editor.on('deactivate', ui.hide);
      }
      editor.on('SkinLoaded ResizeWindow', function () {
        return ui.update(true);
      });
      editor.on('NodeChange keydown', function (e) {
        global$2.requestAnimationFrame(function () {
          return resizeContent(e);
        });
      });
      editor.on('ScrollWindow', function () {
        return ui.updateMode();
      });
      var elementLoad = unbindable();
      elementLoad.set(capture$1(SugarElement.fromDom(editor.getBody()), 'load', resizeContent));
      editor.on('remove', function () {
        elementLoad.clear();
      });
    };
    var render$2 = function (editor, uiComponents, rawUiConfig, backstage, args) {
      var mothership = uiComponents.mothership, uiMothership = uiComponents.uiMothership, outerContainer = uiComponents.outerContainer;
      var floatContainer = Cell(null);
      var targetElm = SugarElement.fromDom(args.targetNode);
      var ui = InlineHeader(editor, targetElm, uiComponents, backstage, floatContainer);
      var toolbarPersist = isToolbarPersist(editor);
      inline(editor);
      var render = function () {
        if (floatContainer.get()) {
          ui.show();
          return;
        }
        floatContainer.set(OuterContainer.getHeader(outerContainer).getOrDie());
        var uiContainer = getUiContainer(editor);
        attachSystem(uiContainer, mothership);
        attachSystem(uiContainer, uiMothership);
        setToolbar(editor, uiComponents, rawUiConfig, backstage);
        OuterContainer.setMenubar(outerContainer, identifyMenus(editor, rawUiConfig));
        ui.show();
        setupEvents$1(editor, targetElm, ui, toolbarPersist);
        editor.nodeChanged();
      };
      editor.on('show', render);
      editor.on('hide', ui.hide);
      if (!toolbarPersist) {
        editor.on('focus', render);
        editor.on('blur', ui.hide);
      }
      editor.on('init', function () {
        if (editor.hasFocus() || toolbarPersist) {
          render();
        }
      });
      setupReadonlyModeSwitch(editor, uiComponents);
      var api = {
        show: function () {
          ui.show();
        },
        hide: function () {
          ui.hide();
        },
        enable: function () {
          broadcastReadonly(uiComponents, false);
        },
        disable: function () {
          broadcastReadonly(uiComponents, true);
        },
        isDisabled: function () {
          return Disabling.isDisabled(outerContainer);
        }
      };
      return {
        editorContainer: outerContainer.element.dom,
        api: api
      };
    };

    var Inline = /*#__PURE__*/Object.freeze({
        __proto__: null,
        render: render$2
    });

    var register$5 = function (editor) {
      var alignToolbarButtons = [
        {
          name: 'alignleft',
          text: 'Align left',
          cmd: 'JustifyLeft',
          icon: 'align-left'
        },
        {
          name: 'aligncenter',
          text: 'Align center',
          cmd: 'JustifyCenter',
          icon: 'align-center'
        },
        {
          name: 'alignright',
          text: 'Align right',
          cmd: 'JustifyRight',
          icon: 'align-right'
        },
        {
          name: 'alignjustify',
          text: 'Justify',
          cmd: 'JustifyFull',
          icon: 'align-justify'
        }
      ];
      global$c.each(alignToolbarButtons, function (item) {
        editor.ui.registry.addToggleButton(item.name, {
          tooltip: item.text,
          onAction: function () {
            return editor.execCommand(item.cmd);
          },
          icon: item.icon,
          onSetup: onSetupFormatToggle(editor, item.name)
        });
      });
      var alignNoneToolbarButton = {
        name: 'alignnone',
        text: 'No alignment',
        cmd: 'JustifyNone',
        icon: 'align-none'
      };
      editor.ui.registry.addButton(alignNoneToolbarButton.name, {
        tooltip: alignNoneToolbarButton.text,
        onAction: function () {
          return editor.execCommand(alignNoneToolbarButton.cmd);
        },
        icon: alignNoneToolbarButton.icon
      });
    };

    var register$6 = function (editor, backstage) {
      alignSelectMenu(editor, backstage);
      fontSelectMenu(editor, backstage);
      styleSelectMenu(editor, backstage);
      formatSelectMenu(editor, backstage);
      fontsizeSelectMenu(editor, backstage);
    };

    var toggleOutdentState = function (api, editor) {
      api.setDisabled(!editor.queryCommandState('outdent'));
      var onNodeChange = function () {
        api.setDisabled(!editor.queryCommandState('outdent'));
      };
      editor.on('NodeChange', onNodeChange);
      return function () {
        return editor.off('NodeChange', onNodeChange);
      };
    };
    var registerButtons = function (editor) {
      editor.ui.registry.addButton('outdent', {
        tooltip: 'Decrease indent',
        icon: 'outdent',
        onSetup: function (api) {
          return toggleOutdentState(api, editor);
        },
        onAction: function () {
          return editor.execCommand('outdent');
        }
      });
      editor.ui.registry.addButton('indent', {
        tooltip: 'Increase indent',
        icon: 'indent',
        onAction: function () {
          return editor.execCommand('indent');
        }
      });
    };
    var register$7 = function (editor) {
      registerButtons(editor);
    };

    var units = {
      unsupportedLength: [
        'em',
        'ex',
        'cap',
        'ch',
        'ic',
        'rem',
        'lh',
        'rlh',
        'vw',
        'vh',
        'vi',
        'vb',
        'vmin',
        'vmax',
        'cm',
        'mm',
        'Q',
        'in',
        'pc',
        'pt',
        'px'
      ],
      fixed: [
        'px',
        'pt'
      ],
      relative: ['%'],
      empty: ['']
    };
    var pattern = function () {
      var decimalDigits = '[0-9]+';
      var signedInteger = '[+-]?' + decimalDigits;
      var exponentPart = '[eE]' + signedInteger;
      var dot = '\\.';
      var opt = function (input) {
        return '(?:' + input + ')?';
      };
      var unsignedDecimalLiteral = [
        'Infinity',
        decimalDigits + dot + opt(decimalDigits) + opt(exponentPart),
        dot + decimalDigits + opt(exponentPart),
        decimalDigits + opt(exponentPart)
      ].join('|');
      var float = '[+-]?(?:' + unsignedDecimalLiteral + ')';
      return new RegExp('^(' + float + ')(.*)$');
    }();
    var isUnit = function (unit, accepted) {
      return exists(accepted, function (acc) {
        return exists(units[acc], function (check) {
          return unit === check;
        });
      });
    };
    var parse = function (input, accepted) {
      var match = Optional.from(pattern.exec(input));
      return match.bind(function (array) {
        var value = Number(array[1]);
        var unitRaw = array[2];
        if (isUnit(unitRaw, accepted)) {
          return Optional.some({
            value: value,
            unit: unitRaw
          });
        } else {
          return Optional.none();
        }
      });
    };
    var normalise = function (input, accepted) {
      return parse(input, accepted).map(function (_a) {
        var value = _a.value, unit = _a.unit;
        return value + unit;
      });
    };

    var normaliseLineHeight = function (input) {
      return normalise(input, [
        'fixed',
        'relative',
        'empty'
      ]).getOr(input);
    };
    var getLineHeights = function (editor) {
      var options = getLineHeightFormats(editor);
      var apis = new Map();
      var lastApi = destroyable();
      var callback = function () {
        var current = normaliseLineHeight(editor.queryCommandValue('LineHeight'));
        Optional.from(apis.get(current)).fold(function () {
          return lastApi.clear();
        }, function (api) {
          lastApi.set({
            destroy: function () {
              api.setActive(false);
            }
          });
          api.setActive(true);
        });
      };
      editor.on('nodeChange', callback);
      return map(options, function (value, i) {
        return {
          type: 'togglemenuitem',
          text: value,
          onSetup: function (api) {
            apis.set(normaliseLineHeight(value), api);
            if (i + 1 === options.length) {
              callback();
            }
            return function () {
              if (i === 0) {
                editor.off('nodeChange', callback);
                lastApi.clear();
              }
            };
          },
          onAction: function () {
            return editor.execCommand('LineHeight', false, value);
          }
        };
      });
    };
    var registerMenuItems = function (editor) {
      editor.ui.registry.addNestedMenuItem('lineheight', {
        type: 'nestedmenuitem',
        text: 'Line height',
        getSubmenuItems: function () {
          return getLineHeights(editor);
        }
      });
    };
    var registerButtons$1 = function (editor) {
      editor.ui.registry.addMenuButton('lineheight', {
        tooltip: 'Line height',
        icon: 'line-height',
        fetch: function (callback) {
          return callback(getLineHeights(editor));
        }
      });
    };
    var register$8 = function (editor) {
      registerMenuItems(editor);
      registerButtons$1(editor);
    };

    var toggleFormat = function (editor, fmt) {
      return function () {
        editor.execCommand('mceToggleFormat', false, fmt);
      };
    };
    var registerFormatButtons = function (editor) {
      global$c.each([
        {
          name: 'bold',
          text: 'Bold',
          icon: 'bold'
        },
        {
          name: 'italic',
          text: 'Italic',
          icon: 'italic'
        },
        {
          name: 'underline',
          text: 'Underline',
          icon: 'underline'
        },
        {
          name: 'strikethrough',
          text: 'Strikethrough',
          icon: 'strike-through'
        },
        {
          name: 'subscript',
          text: 'Subscript',
          icon: 'subscript'
        },
        {
          name: 'superscript',
          text: 'Superscript',
          icon: 'superscript'
        }
      ], function (btn, _idx) {
        editor.ui.registry.addToggleButton(btn.name, {
          tooltip: btn.text,
          icon: btn.icon,
          onSetup: onSetupFormatToggle(editor, btn.name),
          onAction: toggleFormat(editor, btn.name)
        });
      });
      for (var i = 1; i <= 6; i++) {
        var name_1 = 'h' + i;
        editor.ui.registry.addToggleButton(name_1, {
          text: name_1.toUpperCase(),
          tooltip: 'Heading ' + i,
          onSetup: onSetupFormatToggle(editor, name_1),
          onAction: toggleFormat(editor, name_1)
        });
      }
    };
    var registerCommandButtons = function (editor) {
      global$c.each([
        {
          name: 'cut',
          text: 'Cut',
          action: 'Cut',
          icon: 'cut'
        },
        {
          name: 'copy',
          text: 'Copy',
          action: 'Copy',
          icon: 'copy'
        },
        {
          name: 'paste',
          text: 'Paste',
          action: 'Paste',
          icon: 'paste'
        },
        {
          name: 'help',
          text: 'Help',
          action: 'mceHelp',
          icon: 'help'
        },
        {
          name: 'selectall',
          text: 'Select all',
          action: 'SelectAll',
          icon: 'select-all'
        },
        {
          name: 'newdocument',
          text: 'New document',
          action: 'mceNewDocument',
          icon: 'new-document'
        },
        {
          name: 'removeformat',
          text: 'Clear formatting',
          action: 'RemoveFormat',
          icon: 'remove-formatting'
        },
        {
          name: 'remove',
          text: 'Remove',
          action: 'Delete',
          icon: 'remove'
        }
      ], function (btn) {
        editor.ui.registry.addButton(btn.name, {
          tooltip: btn.text,
          icon: btn.icon,
          onAction: function () {
            return editor.execCommand(btn.action);
          }
        });
      });
    };
    var registerCommandToggleButtons = function (editor) {
      global$c.each([{
          name: 'blockquote',
          text: 'Blockquote',
          action: 'mceBlockQuote',
          icon: 'quote'
        }], function (btn) {
        editor.ui.registry.addToggleButton(btn.name, {
          tooltip: btn.text,
          icon: btn.icon,
          onAction: function () {
            return editor.execCommand(btn.action);
          },
          onSetup: onSetupFormatToggle(editor, btn.name)
        });
      });
    };
    var registerButtons$2 = function (editor) {
      registerFormatButtons(editor);
      registerCommandButtons(editor);
      registerCommandToggleButtons(editor);
    };
    var registerMenuItems$1 = function (editor) {
      global$c.each([
        {
          name: 'bold',
          text: 'Bold',
          action: 'Bold',
          icon: 'bold',
          shortcut: 'Meta+B'
        },
        {
          name: 'italic',
          text: 'Italic',
          action: 'Italic',
          icon: 'italic',
          shortcut: 'Meta+I'
        },
        {
          name: 'underline',
          text: 'Underline',
          action: 'Underline',
          icon: 'underline',
          shortcut: 'Meta+U'
        },
        {
          name: 'strikethrough',
          text: 'Strikethrough',
          action: 'Strikethrough',
          icon: 'strike-through',
          shortcut: ''
        },
        {
          name: 'subscript',
          text: 'Subscript',
          action: 'Subscript',
          icon: 'subscript',
          shortcut: ''
        },
        {
          name: 'superscript',
          text: 'Superscript',
          action: 'Superscript',
          icon: 'superscript',
          shortcut: ''
        },
        {
          name: 'removeformat',
          text: 'Clear formatting',
          action: 'RemoveFormat',
          icon: 'remove-formatting',
          shortcut: ''
        },
        {
          name: 'newdocument',
          text: 'New document',
          action: 'mceNewDocument',
          icon: 'new-document',
          shortcut: ''
        },
        {
          name: 'cut',
          text: 'Cut',
          action: 'Cut',
          icon: 'cut',
          shortcut: 'Meta+X'
        },
        {
          name: 'copy',
          text: 'Copy',
          action: 'Copy',
          icon: 'copy',
          shortcut: 'Meta+C'
        },
        {
          name: 'paste',
          text: 'Paste',
          action: 'Paste',
          icon: 'paste',
          shortcut: 'Meta+V'
        },
        {
          name: 'selectall',
          text: 'Select all',
          action: 'SelectAll',
          icon: 'select-all',
          shortcut: 'Meta+A'
        }
      ], function (btn) {
        editor.ui.registry.addMenuItem(btn.name, {
          text: btn.text,
          icon: btn.icon,
          shortcut: btn.shortcut,
          onAction: function () {
            return editor.execCommand(btn.action);
          }
        });
      });
      editor.ui.registry.addMenuItem('codeformat', {
        text: 'Code',
        icon: 'sourcecode',
        onAction: toggleFormat(editor, 'code')
      });
    };
    var register$9 = function (editor) {
      registerButtons$2(editor);
      registerMenuItems$1(editor);
    };

    var toggleUndoRedoState = function (api, editor, type) {
      var checkState = function () {
        return editor.undoManager ? editor.undoManager[type]() : false;
      };
      var onUndoStateChange = function () {
        api.setDisabled(editor.mode.isReadOnly() || !checkState());
      };
      api.setDisabled(!checkState());
      editor.on('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', onUndoStateChange);
      return function () {
        return editor.off('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', onUndoStateChange);
      };
    };
    var registerMenuItems$2 = function (editor) {
      editor.ui.registry.addMenuItem('undo', {
        text: 'Undo',
        icon: 'undo',
        shortcut: 'Meta+Z',
        onSetup: function (api) {
          return toggleUndoRedoState(api, editor, 'hasUndo');
        },
        onAction: function () {
          return editor.execCommand('undo');
        }
      });
      editor.ui.registry.addMenuItem('redo', {
        text: 'Redo',
        icon: 'redo',
        shortcut: 'Meta+Y',
        onSetup: function (api) {
          return toggleUndoRedoState(api, editor, 'hasRedo');
        },
        onAction: function () {
          return editor.execCommand('redo');
        }
      });
    };
    var registerButtons$3 = function (editor) {
      editor.ui.registry.addButton('undo', {
        tooltip: 'Undo',
        icon: 'undo',
        onSetup: function (api) {
          return toggleUndoRedoState(api, editor, 'hasUndo');
        },
        onAction: function () {
          return editor.execCommand('undo');
        }
      });
      editor.ui.registry.addButton('redo', {
        tooltip: 'Redo',
        icon: 'redo',
        onSetup: function (api) {
          return toggleUndoRedoState(api, editor, 'hasRedo');
        },
        onAction: function () {
          return editor.execCommand('redo');
        }
      });
    };
    var register$a = function (editor) {
      registerMenuItems$2(editor);
      registerButtons$3(editor);
    };

    var toggleVisualAidState = function (api, editor) {
      api.setActive(editor.hasVisual);
      var onVisualAid = function (e) {
        api.setActive(e.hasVisual);
      };
      editor.on('VisualAid', onVisualAid);
      return function () {
        return editor.off('VisualAid', onVisualAid);
      };
    };
    var registerMenuItems$3 = function (editor) {
      editor.ui.registry.addToggleMenuItem('visualaid', {
        text: 'Visual aids',
        onSetup: function (api) {
          return toggleVisualAidState(api, editor);
        },
        onAction: function () {
          editor.execCommand('mceToggleVisualAid');
        }
      });
    };
    var registerToolbarButton = function (editor) {
      editor.ui.registry.addButton('visualaid', {
        tooltip: 'Visual aids',
        text: 'Visual aids',
        onAction: function () {
          return editor.execCommand('mceToggleVisualAid');
        }
      });
    };
    var register$b = function (editor) {
      registerToolbarButton(editor);
      registerMenuItems$3(editor);
    };

    var setup$8 = function (editor, backstage) {
      register$5(editor);
      register$9(editor);
      register$6(editor, backstage);
      register$a(editor);
      register$1(editor);
      register$b(editor);
      register$7(editor);
      register$8(editor);
    };

    var nu$d = function (x, y) {
      return {
        anchor: 'makeshift',
        x: x,
        y: y
      };
    };
    var transpose$1 = function (pos, dx, dy) {
      return nu$d(pos.x + dx, pos.y + dy);
    };
    var isTouchEvent$1 = function (e) {
      return e.type === 'longpress' || e.type.indexOf('touch') === 0;
    };
    var fromPageXY = function (e) {
      if (isTouchEvent$1(e)) {
        var touch = e.touches[0];
        return nu$d(touch.pageX, touch.pageY);
      } else {
        return nu$d(e.pageX, e.pageY);
      }
    };
    var fromClientXY = function (e) {
      if (isTouchEvent$1(e)) {
        var touch = e.touches[0];
        return nu$d(touch.clientX, touch.clientY);
      } else {
        return nu$d(e.clientX, e.clientY);
      }
    };
    var transposeContentAreaContainer = function (element, pos) {
      var containerPos = global$5.DOM.getPos(element);
      return transpose$1(pos, containerPos.x, containerPos.y);
    };
    var getPointAnchor = function (editor, e) {
      if (e.type === 'contextmenu' || e.type === 'longpress') {
        if (editor.inline) {
          return fromPageXY(e);
        } else {
          return transposeContentAreaContainer(editor.getContentAreaContainer(), fromClientXY(e));
        }
      } else {
        return getSelectionAnchor(editor);
      }
    };
    var getSelectionAnchor = function (editor) {
      return {
        anchor: 'selection',
        root: SugarElement.fromDom(editor.selection.getNode())
      };
    };
    var getNodeAnchor$1 = function (editor) {
      return {
        anchor: 'node',
        node: Optional.some(SugarElement.fromDom(editor.selection.getNode())),
        root: SugarElement.fromDom(editor.getBody())
      };
    };

    var initAndShow = function (editor, e, buildMenu, backstage, contextmenu, useNodeAnchor) {
      var items = buildMenu();
      var anchorSpec = useNodeAnchor ? getNodeAnchor$1(editor) : getPointAnchor(editor, e);
      build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage, false).map(function (menuData) {
        e.preventDefault();
        InlineView.showMenuAt(contextmenu, anchorSpec, {
          menu: { markers: markers$1('normal') },
          data: menuData
        });
      });
    };

    var layouts = {
      onLtr: function () {
        return [
          south$1,
          southeast$1,
          southwest$1,
          northeast$1,
          northwest$1,
          north$1,
          north$3,
          south$3,
          northeast$3,
          southeast$3,
          northwest$3,
          southwest$3
        ];
      },
      onRtl: function () {
        return [
          south$1,
          southwest$1,
          southeast$1,
          northwest$1,
          northeast$1,
          north$1,
          north$3,
          south$3,
          northwest$3,
          southwest$3,
          northeast$3,
          southeast$3
        ];
      }
    };
    var bubbleSize$1 = 12;
    var bubbleAlignments$2 = {
      valignCentre: [],
      alignCentre: [],
      alignLeft: ['tox-pop--align-left'],
      alignRight: ['tox-pop--align-right'],
      right: ['tox-pop--right'],
      left: ['tox-pop--left'],
      bottom: ['tox-pop--bottom'],
      top: ['tox-pop--top']
    };
    var isTouchWithinSelection = function (editor, e) {
      var selection = editor.selection;
      if (selection.isCollapsed() || e.touches.length < 1) {
        return false;
      } else {
        var touch_1 = e.touches[0];
        var rng = selection.getRng();
        var rngRectOpt = getFirstRect$1(editor.getWin(), SimSelection.domRange(rng));
        return rngRectOpt.exists(function (rngRect) {
          return rngRect.left <= touch_1.clientX && rngRect.right >= touch_1.clientX && rngRect.top <= touch_1.clientY && rngRect.bottom >= touch_1.clientY;
        });
      }
    };
    var getPointAnchorSpec = function (editor, e) {
      return __assign({
        bubble: nu$8(0, bubbleSize$1, bubbleAlignments$2),
        layouts: layouts,
        overrides: {
          maxWidthFunction: expandable$1(),
          maxHeightFunction: expandable()
        }
      }, getPointAnchor(editor, e));
    };
    var setupiOSOverrides = function (editor) {
      var originalSelection = editor.selection.getRng();
      var selectionReset = function () {
        global$2.setEditorTimeout(editor, function () {
          editor.selection.setRng(originalSelection);
        }, 10);
        unbindEventListeners();
      };
      editor.once('touchend', selectionReset);
      var preventMousedown = function (e) {
        e.preventDefault();
        e.stopImmediatePropagation();
      };
      editor.on('mousedown', preventMousedown, true);
      var clearSelectionReset = function () {
        return unbindEventListeners();
      };
      editor.once('longpresscancel', clearSelectionReset);
      var unbindEventListeners = function () {
        editor.off('touchend', selectionReset);
        editor.off('longpresscancel', clearSelectionReset);
        editor.off('mousedown', preventMousedown);
      };
    };
    var show = function (editor, e, items, backstage, contextmenu, useNodeAnchor, highlightImmediately) {
      var anchorSpec = useNodeAnchor ? getNodeAnchor$1(editor) : getPointAnchorSpec(editor, e);
      build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage, true).map(function (menuData) {
        e.preventDefault();
        InlineView.showMenuWithinBounds(contextmenu, anchorSpec, {
          menu: {
            markers: markers$1('normal'),
            highlightImmediately: highlightImmediately
          },
          data: menuData,
          type: 'horizontal'
        }, function () {
          return Optional.some(getContextToolbarBounds(editor, backstage.shared));
        });
        editor.fire(hideContextToolbarEvent);
      });
    };
    var initAndShow$1 = function (editor, e, buildMenu, backstage, contextmenu, useNodeAnchor) {
      var detection = detect$3();
      var isiOS = detection.os.isiOS();
      var isOSX = detection.os.isOSX();
      var isAndroid = detection.os.isAndroid();
      var isTouch = detection.deviceType.isTouch();
      var shouldHighlightImmediately = function () {
        return !(isAndroid || isiOS || isOSX && isTouch);
      };
      var open = function () {
        var items = buildMenu();
        show(editor, e, items, backstage, contextmenu, useNodeAnchor, shouldHighlightImmediately());
      };
      if ((isOSX || isiOS) && !useNodeAnchor) {
        var openiOS_1 = function () {
          setupiOSOverrides(editor);
          open();
        };
        if (isTouchWithinSelection(editor, e)) {
          openiOS_1();
        } else {
          editor.once('selectionchange', openiOS_1);
          editor.once('touchend', function () {
            return editor.off('selectionchange', openiOS_1);
          });
        }
      } else {
        if (isAndroid && !useNodeAnchor) {
          editor.selection.setCursorLocation(e.target, 0);
        }
        open();
      }
    };

    var patchPipeConfig = function (config) {
      return typeof config === 'string' ? config.split(/[ ,]/) : config;
    };
    var shouldNeverUseNative = function (editor) {
      return editor.getParam('contextmenu_never_use_native', false, 'boolean');
    };
    var getMenuItems = function (editor, name, defaultItems) {
      var contextMenus = editor.ui.registry.getAll().contextMenus;
      return Optional.from(editor.getParam(name)).map(patchPipeConfig).getOrThunk(function () {
        return filter(patchPipeConfig(defaultItems), function (item) {
          return has(contextMenus, item);
        });
      });
    };
    var isContextMenuDisabled = function (editor) {
      return editor.getParam('contextmenu') === false;
    };
    var getContextMenu = function (editor) {
      return getMenuItems(editor, 'contextmenu', 'link linkchecker image imagetools table spellchecker configurepermanentpen');
    };
    var getAvoidOverlapSelector = function (editor) {
      return editor.getParam('contextmenu_avoid_overlap', '', 'string');
    };

    var isSeparator$1 = function (item) {
      return isString(item) ? item === '|' : item.type === 'separator';
    };
    var separator$3 = { type: 'separator' };
    var makeContextItem = function (item) {
      var commonMenuItem = function (item) {
        return {
          text: item.text,
          icon: item.icon,
          disabled: item.disabled,
          shortcut: item.shortcut
        };
      };
      if (isString(item)) {
        return item;
      } else {
        switch (item.type) {
        case 'separator':
          return separator$3;
        case 'submenu':
          return __assign(__assign({ type: 'nestedmenuitem' }, commonMenuItem(item)), {
            getSubmenuItems: function () {
              var items = item.getSubmenuItems();
              if (isString(items)) {
                return items;
              } else {
                return map(items, makeContextItem);
              }
            }
          });
        default:
          return __assign(__assign({ type: 'menuitem' }, commonMenuItem(item)), { onAction: noarg(item.onAction) });
        }
      }
    };
    var addContextMenuGroup = function (xs, groupItems) {
      if (groupItems.length === 0) {
        return xs;
      }
      var lastMenuItem = last(xs).filter(function (item) {
        return !isSeparator$1(item);
      });
      var before = lastMenuItem.fold(function () {
        return [];
      }, function (_) {
        return [separator$3];
      });
      return xs.concat(before).concat(groupItems).concat([separator$3]);
    };
    var generateContextMenu = function (contextMenus, menuConfig, selectedElement) {
      var sections = foldl(menuConfig, function (acc, name) {
        return get$1(contextMenus, name.toLowerCase()).map(function (menu) {
          var items = menu.update(selectedElement);
          if (isString(items)) {
            return addContextMenuGroup(acc, items.split(' '));
          } else if (items.length > 0) {
            var allItems = map(items, makeContextItem);
            return addContextMenuGroup(acc, allItems);
          } else {
            return acc;
          }
        }).getOrThunk(function () {
          return acc.concat([name]);
        });
      }, []);
      if (sections.length > 0 && isSeparator$1(sections[sections.length - 1])) {
        sections.pop();
      }
      return sections;
    };
    var isNativeOverrideKeyEvent = function (editor, e) {
      return e.ctrlKey && !shouldNeverUseNative(editor);
    };
    var isTriggeredByKeyboard = function (editor, e) {
      return e.type !== 'longpress' && (e.button !== 2 || e.target === editor.getBody() && e.pointerType === '');
    };
    var getSelectedElement = function (editor, e) {
      return isTriggeredByKeyboard(editor, e) ? editor.selection.getStart(true) : e.target;
    };
    var shouldUseNodeAnchor = function (editor, e) {
      var selector = getAvoidOverlapSelector(editor);
      if (isTriggeredByKeyboard(editor, e)) {
        return true;
      } else if (selector) {
        var target = getSelectedElement(editor, e);
        return closest$4(SugarElement.fromDom(target), selector);
      } else {
        return false;
      }
    };
    var setup$9 = function (editor, lazySink, backstage) {
      var detection = detect$3();
      var isTouch = detection.deviceType.isTouch;
      var contextmenu = build$1(InlineView.sketch({
        dom: { tag: 'div' },
        lazySink: lazySink,
        onEscape: function () {
          return editor.focus();
        },
        onShow: function () {
          return backstage.setContextMenuState(true);
        },
        onHide: function () {
          return backstage.setContextMenuState(false);
        },
        fireDismissalEventInstead: {},
        inlineBehaviours: derive$1([config('dismissContextMenu', [run(dismissRequested(), function (comp, _se) {
              Sandboxing.close(comp);
              editor.focus();
            })])])
      }));
      var hideContextMenu = function (_e) {
        return InlineView.hide(contextmenu);
      };
      var showContextMenu = function (e) {
        if (shouldNeverUseNative(editor)) {
          e.preventDefault();
        }
        if (isNativeOverrideKeyEvent(editor, e) || isContextMenuDisabled(editor)) {
          return;
        }
        var useNodeAnchor = shouldUseNodeAnchor(editor, e);
        var buildMenu = function () {
          var selectedElement = getSelectedElement(editor, e);
          var registry = editor.ui.registry.getAll();
          var menuConfig = getContextMenu(editor);
          return generateContextMenu(registry.contextMenus, menuConfig, selectedElement);
        };
        var initAndShow$2 = isTouch() ? initAndShow$1 : initAndShow;
        initAndShow$2(editor, e, buildMenu, backstage, contextmenu, useNodeAnchor);
      };
      editor.on('init', function () {
        var hideEvents = 'ResizeEditor ScrollContent ScrollWindow longpresscancel' + (isTouch() ? '' : ' ResizeWindow');
        editor.on(hideEvents, hideContextMenu);
        editor.on('longpress contextmenu', showContextMenu);
      });
    };

    var adt$c = Adt.generate([
      {
        offset: [
          'x',
          'y'
        ]
      },
      {
        absolute: [
          'x',
          'y'
        ]
      },
      {
        fixed: [
          'x',
          'y'
        ]
      }
    ]);
    var subtract = function (change) {
      return function (point) {
        return point.translate(-change.left, -change.top);
      };
    };
    var add$4 = function (change) {
      return function (point) {
        return point.translate(change.left, change.top);
      };
    };
    var transform$1 = function (changes) {
      return function (x, y) {
        return foldl(changes, function (rest, f) {
          return f(rest);
        }, SugarPosition(x, y));
      };
    };
    var asFixed = function (coord, scroll, origin) {
      return coord.fold(transform$1([
        add$4(origin),
        subtract(scroll)
      ]), transform$1([subtract(scroll)]), transform$1([]));
    };
    var asAbsolute = function (coord, scroll, origin) {
      return coord.fold(transform$1([add$4(origin)]), transform$1([]), transform$1([add$4(scroll)]));
    };
    var asOffset = function (coord, scroll, origin) {
      return coord.fold(transform$1([]), transform$1([subtract(origin)]), transform$1([
        add$4(scroll),
        subtract(origin)
      ]));
    };
    var withinRange = function (coord1, coord2, xRange, yRange, scroll, origin) {
      var a1 = asAbsolute(coord1, scroll, origin);
      var a2 = asAbsolute(coord2, scroll, origin);
      return Math.abs(a1.left - a2.left) <= xRange && Math.abs(a1.top - a2.top) <= yRange;
    };
    var getDeltas = function (coord1, coord2, xRange, yRange, scroll, origin) {
      var a1 = asAbsolute(coord1, scroll, origin);
      var a2 = asAbsolute(coord2, scroll, origin);
      var left = Math.abs(a1.left - a2.left);
      var top = Math.abs(a1.top - a2.top);
      return SugarPosition(left, top);
    };
    var toStyles = function (coord, scroll, origin) {
      var stylesOpt = coord.fold(function (x, y) {
        return {
          position: Optional.some('absolute'),
          left: Optional.some(x + 'px'),
          top: Optional.some(y + 'px')
        };
      }, function (x, y) {
        return {
          position: Optional.some('absolute'),
          left: Optional.some(x - origin.left + 'px'),
          top: Optional.some(y - origin.top + 'px')
        };
      }, function (x, y) {
        return {
          position: Optional.some('fixed'),
          left: Optional.some(x + 'px'),
          top: Optional.some(y + 'px')
        };
      });
      return __assign({
        right: Optional.none(),
        bottom: Optional.none()
      }, stylesOpt);
    };
    var translate$2 = function (coord, deltaX, deltaY) {
      return coord.fold(function (x, y) {
        return offset(x + deltaX, y + deltaY);
      }, function (x, y) {
        return absolute$3(x + deltaX, y + deltaY);
      }, function (x, y) {
        return fixed$1(x + deltaX, y + deltaY);
      });
    };
    var absorb = function (partialCoord, originalCoord, scroll, origin) {
      var absorbOne = function (stencil, nu) {
        return function (optX, optY) {
          var original = stencil(originalCoord, scroll, origin);
          return nu(optX.getOr(original.left), optY.getOr(original.top));
        };
      };
      return partialCoord.fold(absorbOne(asOffset, offset), absorbOne(asAbsolute, absolute$3), absorbOne(asFixed, fixed$1));
    };
    var offset = adt$c.offset;
    var absolute$3 = adt$c.absolute;
    var fixed$1 = adt$c.fixed;

    var parseAttrToInt = function (element, name) {
      var value = get$3(element, name);
      return isUndefined(value) ? NaN : parseInt(value, 10);
    };
    var get$f = function (component, snapsInfo) {
      var element = component.element;
      var x = parseAttrToInt(element, snapsInfo.leftAttr);
      var y = parseAttrToInt(element, snapsInfo.topAttr);
      return isNaN(x) || isNaN(y) ? Optional.none() : Optional.some(SugarPosition(x, y));
    };
    var set$8 = function (component, snapsInfo, pt) {
      var element = component.element;
      set$1(element, snapsInfo.leftAttr, pt.left + 'px');
      set$1(element, snapsInfo.topAttr, pt.top + 'px');
    };
    var clear = function (component, snapsInfo) {
      var element = component.element;
      remove$1(element, snapsInfo.leftAttr);
      remove$1(element, snapsInfo.topAttr);
    };

    var getCoords = function (component, snapInfo, coord, delta) {
      return get$f(component, snapInfo).fold(function () {
        return coord;
      }, function (fixed) {
        return fixed$1(fixed.left + delta.left, fixed.top + delta.top);
      });
    };
    var moveOrSnap = function (component, snapInfo, coord, delta, scroll, origin) {
      var newCoord = getCoords(component, snapInfo, coord, delta);
      var snap = snapInfo.mustSnap ? findClosestSnap(component, snapInfo, newCoord, scroll, origin) : findSnap(component, snapInfo, newCoord, scroll, origin);
      var fixedCoord = asFixed(newCoord, scroll, origin);
      set$8(component, snapInfo, fixedCoord);
      return snap.fold(function () {
        return {
          coord: fixed$1(fixedCoord.left, fixedCoord.top),
          extra: Optional.none()
        };
      }, function (spanned) {
        return {
          coord: spanned.output,
          extra: spanned.extra
        };
      });
    };
    var stopDrag = function (component, snapInfo) {
      clear(component, snapInfo);
    };
    var findMatchingSnap = function (snaps, newCoord, scroll, origin) {
      return findMap(snaps, function (snap) {
        var sensor = snap.sensor;
        var inRange = withinRange(newCoord, sensor, snap.range.left, snap.range.top, scroll, origin);
        return inRange ? Optional.some({
          output: absorb(snap.output, newCoord, scroll, origin),
          extra: snap.extra
        }) : Optional.none();
      });
    };
    var findClosestSnap = function (component, snapInfo, newCoord, scroll, origin) {
      var snaps = snapInfo.getSnapPoints(component);
      var matchSnap = findMatchingSnap(snaps, newCoord, scroll, origin);
      return matchSnap.orThunk(function () {
        var bestSnap = foldl(snaps, function (acc, snap) {
          var sensor = snap.sensor;
          var deltas = getDeltas(newCoord, sensor, snap.range.left, snap.range.top, scroll, origin);
          return acc.deltas.fold(function () {
            return {
              deltas: Optional.some(deltas),
              snap: Optional.some(snap)
            };
          }, function (bestDeltas) {
            var currAvg = (deltas.left + deltas.top) / 2;
            var bestAvg = (bestDeltas.left + bestDeltas.top) / 2;
            if (currAvg <= bestAvg) {
              return {
                deltas: Optional.some(deltas),
                snap: Optional.some(snap)
              };
            } else {
              return acc;
            }
          });
        }, {
          deltas: Optional.none(),
          snap: Optional.none()
        });
        return bestSnap.snap.map(function (snap) {
          return {
            output: absorb(snap.output, newCoord, scroll, origin),
            extra: snap.extra
          };
        });
      });
    };
    var findSnap = function (component, snapInfo, newCoord, scroll, origin) {
      var snaps = snapInfo.getSnapPoints(component);
      return findMatchingSnap(snaps, newCoord, scroll, origin);
    };
    var snapTo = function (snap, scroll, origin) {
      return {
        coord: absorb(snap.output, snap.output, scroll, origin),
        extra: snap.extra
      };
    };

    var snapTo$1 = function (component, dragConfig, _state, snap) {
      var target = dragConfig.getTarget(component.element);
      if (dragConfig.repositionTarget) {
        var doc = owner(component.element);
        var scroll_1 = get$9(doc);
        var origin_1 = getOrigin(target);
        var snapPin = snapTo(snap, scroll_1, origin_1);
        var styles = toStyles(snapPin.coord, scroll_1, origin_1);
        setOptions(target, styles);
      }
    };

    var DraggingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        snapTo: snapTo$1
    });

    var initialAttribute = 'data-initial-z-index';
    var resetZIndex = function (blocker) {
      parent(blocker.element).filter(isElement).each(function (root) {
        getOpt(root, initialAttribute).fold(function () {
          return remove$6(root, 'z-index');
        }, function (zIndex) {
          return set$2(root, 'z-index', zIndex);
        });
        remove$1(root, initialAttribute);
      });
    };
    var changeZIndex = function (blocker) {
      parent(blocker.element).filter(isElement).each(function (root) {
        getRaw(root, 'z-index').each(function (zindex) {
          set$1(root, initialAttribute, zindex);
        });
        set$2(root, 'z-index', get$5(blocker.element, 'z-index'));
      });
    };
    var instigate = function (anyComponent, blocker) {
      anyComponent.getSystem().addToGui(blocker);
      changeZIndex(blocker);
    };
    var discard = function (blocker) {
      resetZIndex(blocker);
      blocker.getSystem().removeFromGui(blocker);
    };
    var createComponent = function (component, blockerClass, blockerEvents) {
      return component.getSystem().build(Container.sketch({
        dom: {
          styles: {
            'left': '0px',
            'top': '0px',
            'width': '100%',
            'height': '100%',
            'position': 'fixed',
            'z-index': '1000000000000000'
          },
          classes: [blockerClass]
        },
        events: blockerEvents
      }));
    };

    var SnapSchema = optionObjOf('snaps', [
      strict$1('getSnapPoints'),
      onHandler('onSensor'),
      strict$1('leftAttr'),
      strict$1('topAttr'),
      defaulted$1('lazyViewport', win),
      defaulted$1('mustSnap', false)
    ]);

    var schema$t = [
      defaulted$1('useFixed', never),
      strict$1('blockerClass'),
      defaulted$1('getTarget', identity),
      defaulted$1('onDrag', noop),
      defaulted$1('repositionTarget', true),
      defaulted$1('onDrop', noop),
      defaultedFunction('getBounds', win),
      SnapSchema
    ];

    var getCurrentCoord = function (target) {
      return lift3(getRaw(target, 'left'), getRaw(target, 'top'), getRaw(target, 'position'), function (left, top, position) {
        var nu = position === 'fixed' ? fixed$1 : offset;
        return nu(parseInt(left, 10), parseInt(top, 10));
      }).getOrThunk(function () {
        var location = absolute(target);
        return absolute$3(location.left, location.top);
      });
    };
    var clampCoords = function (component, coords, scroll, origin, startData) {
      var bounds = startData.bounds;
      var absoluteCoord = asAbsolute(coords, scroll, origin);
      var newX = clamp(absoluteCoord.left, bounds.x, bounds.x + bounds.width - startData.width);
      var newY = clamp(absoluteCoord.top, bounds.y, bounds.y + bounds.height - startData.height);
      var newCoords = absolute$3(newX, newY);
      return coords.fold(function () {
        var offset$1 = asOffset(newCoords, scroll, origin);
        return offset(offset$1.left, offset$1.top);
      }, function () {
        return newCoords;
      }, function () {
        var fixed = asFixed(newCoords, scroll, origin);
        return fixed$1(fixed.left, fixed.top);
      });
    };
    var calcNewCoord = function (component, optSnaps, currentCoord, scroll, origin, delta, startData) {
      var newCoord = optSnaps.fold(function () {
        var translated = translate$2(currentCoord, delta.left, delta.top);
        var fixedCoord = asFixed(translated, scroll, origin);
        return fixed$1(fixedCoord.left, fixedCoord.top);
      }, function (snapInfo) {
        var snapping = moveOrSnap(component, snapInfo, currentCoord, delta, scroll, origin);
        snapping.extra.each(function (extra) {
          snapInfo.onSensor(component, extra);
        });
        return snapping.coord;
      });
      return clampCoords(component, newCoord, scroll, origin, startData);
    };
    var dragBy = function (component, dragConfig, startData, delta) {
      var target = dragConfig.getTarget(component.element);
      if (dragConfig.repositionTarget) {
        var doc = owner(component.element);
        var scroll_1 = get$9(doc);
        var origin_1 = getOrigin(target);
        var currentCoord = getCurrentCoord(target);
        var newCoord = calcNewCoord(component, dragConfig.snaps, currentCoord, scroll_1, origin_1, delta, startData);
        var styles = toStyles(newCoord, scroll_1, origin_1);
        setOptions(target, styles);
      }
      dragConfig.onDrag(component, target, delta);
    };

    var calcStartData = function (dragConfig, comp) {
      return {
        bounds: dragConfig.getBounds(),
        height: getOuter$1(comp.element),
        width: getOuter$2(comp.element)
      };
    };
    var move$1 = function (component, dragConfig, dragState, dragMode, event) {
      var delta = dragState.update(dragMode, event);
      var dragStartData = dragState.getStartData().getOrThunk(function () {
        return calcStartData(dragConfig, component);
      });
      delta.each(function (dlt) {
        dragBy(component, dragConfig, dragStartData, dlt);
      });
    };
    var stop = function (component, blocker, dragConfig, dragState) {
      blocker.each(discard);
      dragConfig.snaps.each(function (snapInfo) {
        stopDrag(component, snapInfo);
      });
      var target = dragConfig.getTarget(component.element);
      dragState.reset();
      dragConfig.onDrop(component, target);
    };
    var handlers = function (events) {
      return function (dragConfig, dragState) {
        var updateStartState = function (comp) {
          dragState.setStartData(calcStartData(dragConfig, comp));
        };
        return derive(__spreadArrays([run(windowScroll(), function (comp) {
            dragState.getStartData().each(function () {
              return updateStartState(comp);
            });
          })], events(dragConfig, dragState, updateStartState)));
      };
    };

    var init$c = function (dragApi) {
      return derive([
        run(mousedown(), dragApi.forceDrop),
        run(mouseup(), dragApi.drop),
        run(mousemove(), function (comp, simulatedEvent) {
          dragApi.move(simulatedEvent.event);
        }),
        run(mouseout(), dragApi.delayDrop)
      ]);
    };

    var getData$1 = function (event) {
      return Optional.from(SugarPosition(event.x, event.y));
    };
    var getDelta$1 = function (old, nu) {
      return SugarPosition(nu.left - old.left, nu.top - old.top);
    };

    var MouseData = /*#__PURE__*/Object.freeze({
        __proto__: null,
        getData: getData$1,
        getDelta: getDelta$1
    });

    var events$g = function (dragConfig, dragState, updateStartState) {
      return [run(mousedown(), function (component, simulatedEvent) {
          var raw = simulatedEvent.event.raw;
          if (raw.button !== 0) {
            return;
          }
          simulatedEvent.stop();
          var stop$1 = function () {
            return stop(component, Optional.some(blocker), dragConfig, dragState);
          };
          var delayDrop = DelayedFunction(stop$1, 200);
          var dragApi = {
            drop: stop$1,
            delayDrop: delayDrop.schedule,
            forceDrop: stop$1,
            move: function (event) {
              delayDrop.cancel();
              move$1(component, dragConfig, dragState, MouseData, event);
            }
          };
          var blocker = createComponent(component, dragConfig.blockerClass, init$c(dragApi));
          var start = function () {
            updateStartState(component);
            instigate(component, blocker);
          };
          start();
        })];
    };
    var schema$u = __spreadArrays(schema$t, [output('dragger', { handlers: handlers(events$g) })]);

    var init$d = function (dragApi) {
      return derive([
        run(touchstart(), dragApi.forceDrop),
        run(touchend(), dragApi.drop),
        run(touchcancel(), dragApi.drop),
        run(touchmove(), function (comp, simulatedEvent) {
          dragApi.move(simulatedEvent.event);
        })
      ]);
    };

    var getDataFrom = function (touches) {
      var touch = touches[0];
      return Optional.some(SugarPosition(touch.clientX, touch.clientY));
    };
    var getData$2 = function (event) {
      var raw = event.raw;
      var touches = raw.touches;
      return touches.length === 1 ? getDataFrom(touches) : Optional.none();
    };
    var getDelta$2 = function (old, nu) {
      return SugarPosition(nu.left - old.left, nu.top - old.top);
    };

    var TouchData = /*#__PURE__*/Object.freeze({
        __proto__: null,
        getData: getData$2,
        getDelta: getDelta$2
    });

    var events$h = function (dragConfig, dragState, updateStartState) {
      var blockerCell = Cell(Optional.none());
      return [
        run(touchstart(), function (component, simulatedEvent) {
          simulatedEvent.stop();
          var stop$1 = function () {
            stop(component, blockerCell.get(), dragConfig, dragState);
            blockerCell.set(Optional.none());
          };
          var dragApi = {
            drop: stop$1,
            delayDrop: noop,
            forceDrop: stop$1,
            move: function (event) {
              move$1(component, dragConfig, dragState, TouchData, event);
            }
          };
          var blocker = createComponent(component, dragConfig.blockerClass, init$d(dragApi));
          blockerCell.set(Optional.some(blocker));
          var start = function () {
            updateStartState(component);
            instigate(component, blocker);
          };
          start();
        }),
        run(touchmove(), function (component, simulatedEvent) {
          simulatedEvent.stop();
          move$1(component, dragConfig, dragState, TouchData, simulatedEvent.event);
        }),
        run(touchend(), function (component, simulatedEvent) {
          simulatedEvent.stop();
          stop(component, blockerCell.get(), dragConfig, dragState);
          blockerCell.set(Optional.none());
        }),
        run(touchcancel(), function (component) {
          stop(component, blockerCell.get(), dragConfig, dragState);
          blockerCell.set(Optional.none());
        })
      ];
    };
    var schema$v = __spreadArrays(schema$t, [output('dragger', { handlers: handlers(events$h) })]);

    var events$i = function (dragConfig, dragState, updateStartState) {
      return __spreadArrays(events$g(dragConfig, dragState, updateStartState), events$h(dragConfig, dragState, updateStartState));
    };
    var schema$w = __spreadArrays(schema$t, [output('dragger', { handlers: handlers(events$i) })]);

    var mouse = schema$u;
    var touch = schema$v;
    var mouseOrTouch = schema$w;

    var DraggingBranches = /*#__PURE__*/Object.freeze({
        __proto__: null,
        mouse: mouse,
        touch: touch,
        mouseOrTouch: mouseOrTouch
    });

    var init$e = function () {
      var previous = Optional.none();
      var startData = Optional.none();
      var reset = function () {
        previous = Optional.none();
        startData = Optional.none();
      };
      var calculateDelta = function (mode, nu) {
        var result = previous.map(function (old) {
          return mode.getDelta(old, nu);
        });
        previous = Optional.some(nu);
        return result;
      };
      var update = function (mode, dragEvent) {
        return mode.getData(dragEvent).bind(function (nuData) {
          return calculateDelta(mode, nuData);
        });
      };
      var setStartData = function (data) {
        startData = Optional.some(data);
      };
      var getStartData = function () {
        return startData;
      };
      var readState = constant({});
      return nu$5({
        readState: readState,
        reset: reset,
        update: update,
        getStartData: getStartData,
        setStartData: setStartData
      });
    };

    var DragState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$e
    });

    var Dragging = createModes$1({
      branchKey: 'mode',
      branches: DraggingBranches,
      name: 'dragging',
      active: {
        events: function (dragConfig, dragState) {
          var dragger = dragConfig.dragger;
          return dragger.handlers(dragConfig, dragState);
        }
      },
      extra: {
        snap: function (sConfig) {
          return {
            sensor: sConfig.sensor,
            range: sConfig.range,
            output: sConfig.output,
            extra: Optional.from(sConfig.extra)
          };
        }
      },
      state: DragState,
      apis: DraggingApis
    });

    var snapWidth = 40;
    var snapOffset = snapWidth / 2;
    var calcSnap = function (selectorOpt, td, x, y, width, height) {
      return selectorOpt.fold(function () {
        return Dragging.snap({
          sensor: absolute$3(x - snapOffset, y - snapOffset),
          range: SugarPosition(width, height),
          output: absolute$3(Optional.some(x), Optional.some(y)),
          extra: { td: td }
        });
      }, function (selectorHandle) {
        var sensorLeft = x - snapOffset;
        var sensorTop = y - snapOffset;
        var sensorWidth = snapWidth;
        var sensorHeight = snapWidth;
        var rect = selectorHandle.element.dom.getBoundingClientRect();
        return Dragging.snap({
          sensor: absolute$3(sensorLeft, sensorTop),
          range: SugarPosition(sensorWidth, sensorHeight),
          output: absolute$3(Optional.some(x - rect.width / 2), Optional.some(y - rect.height / 2)),
          extra: { td: td }
        });
      });
    };
    var getSnapsConfig = function (getSnapPoints, cell, onChange) {
      var isSameCell = function (cellOpt, td) {
        return cellOpt.exists(function (currentTd) {
          return eq$1(currentTd, td);
        });
      };
      return {
        getSnapPoints: getSnapPoints,
        leftAttr: 'data-drag-left',
        topAttr: 'data-drag-top',
        onSensor: function (component, extra) {
          var td = extra.td;
          if (!isSameCell(cell.get(), td)) {
            cell.set(Optional.some(td));
            onChange(td);
          }
        },
        mustSnap: true
      };
    };
    var createSelector = function (snaps) {
      return record(Button.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-selector']
        },
        buttonBehaviours: derive$1([
          Dragging.config({
            mode: 'mouseOrTouch',
            blockerClass: 'blocker',
            snaps: snaps
          }),
          Unselecting.config({})
        ]),
        eventOrder: {
          mousedown: [
            'dragging',
            'alloy.base.behaviour'
          ],
          touchstart: [
            'dragging',
            'alloy.base.behaviour'
          ]
        }
      }));
    };
    var setup$a = function (editor, sink) {
      var tlTds = Cell([]);
      var brTds = Cell([]);
      var isVisible = Cell(false);
      var startCell = Cell(Optional.none());
      var finishCell = Cell(Optional.none());
      var getTopLeftSnap = function (td) {
        var box = absolute$1(td);
        return calcSnap(memTopLeft.getOpt(sink), td, box.x, box.y, box.width, box.height);
      };
      var getTopLeftSnaps = function () {
        return map(tlTds.get(), function (td) {
          return getTopLeftSnap(td);
        });
      };
      var getBottomRightSnap = function (td) {
        var box = absolute$1(td);
        return calcSnap(memBottomRight.getOpt(sink), td, box.right, box.bottom, box.width, box.height);
      };
      var getBottomRightSnaps = function () {
        return map(brTds.get(), function (td) {
          return getBottomRightSnap(td);
        });
      };
      var topLeftSnaps = getSnapsConfig(getTopLeftSnaps, startCell, function (start) {
        finishCell.get().each(function (finish) {
          editor.fire('TableSelectorChange', {
            start: start,
            finish: finish
          });
        });
      });
      var bottomRightSnaps = getSnapsConfig(getBottomRightSnaps, finishCell, function (finish) {
        startCell.get().each(function (start) {
          editor.fire('TableSelectorChange', {
            start: start,
            finish: finish
          });
        });
      });
      var memTopLeft = createSelector(topLeftSnaps);
      var memBottomRight = createSelector(bottomRightSnaps);
      var topLeft = build$1(memTopLeft.asSpec());
      var bottomRight = build$1(memBottomRight.asSpec());
      var showOrHideHandle = function (selector, cell, isAbove, isBelow) {
        var cellRect = cell.dom.getBoundingClientRect();
        remove$6(selector.element, 'display');
        var viewportHeight = defaultView(SugarElement.fromDom(editor.getBody())).dom.innerHeight;
        var aboveViewport = isAbove(cellRect);
        var belowViewport = isBelow(cellRect, viewportHeight);
        if (aboveViewport || belowViewport) {
          set$2(selector.element, 'display', 'none');
        }
      };
      var snapTo = function (selector, cell, getSnapConfig, pos) {
        var snap = getSnapConfig(cell);
        Dragging.snapTo(selector, snap);
        var isAbove = function (rect) {
          return rect[pos] < 0;
        };
        var isBelow = function (rect, viewportHeight) {
          return rect[pos] > viewportHeight;
        };
        showOrHideHandle(selector, cell, isAbove, isBelow);
      };
      var snapTopLeft = function (cell) {
        return snapTo(topLeft, cell, getTopLeftSnap, 'top');
      };
      var snapLastTopLeft = function () {
        return startCell.get().each(snapTopLeft);
      };
      var snapBottomRight = function (cell) {
        return snapTo(bottomRight, cell, getBottomRightSnap, 'bottom');
      };
      var snapLastBottomRight = function () {
        return finishCell.get().each(snapBottomRight);
      };
      if (detect$3().deviceType.isTouch()) {
        editor.on('TableSelectionChange', function (e) {
          if (!isVisible.get()) {
            attach$1(sink, topLeft);
            attach$1(sink, bottomRight);
            isVisible.set(true);
          }
          startCell.set(Optional.some(e.start));
          finishCell.set(Optional.some(e.finish));
          e.otherCells.each(function (otherCells) {
            tlTds.set(otherCells.upOrLeftCells);
            brTds.set(otherCells.downOrRightCells);
            snapTopLeft(e.start);
            snapBottomRight(e.finish);
          });
        });
        editor.on('ResizeEditor ResizeWindow ScrollContent', function () {
          snapLastTopLeft();
          snapLastBottomRight();
        });
        editor.on('TableSelectionClear', function () {
          if (isVisible.get()) {
            detach(topLeft);
            detach(bottomRight);
            isVisible.set(false);
          }
          startCell.set(Optional.none());
          finishCell.set(Optional.none());
        });
      }
    };

    var isHidden$1 = function (elm) {
      if (elm.nodeType === 1) {
        if (elm.nodeName === 'BR' || !!elm.getAttribute('data-mce-bogus')) {
          return true;
        }
        if (elm.getAttribute('data-mce-type') === 'bookmark') {
          return true;
        }
      }
      return false;
    };
    var renderElementPath = function (editor, settings, providersBackstage) {
      if (!settings.delimiter) {
        settings.delimiter = '\xBB';
      }
      var getDataPath = function (data) {
        var parts = data || [];
        var newPathElements = map(parts, function (part, index) {
          return Button.sketch({
            dom: {
              tag: 'div',
              classes: ['tox-statusbar__path-item'],
              attributes: {
                'role': 'button',
                'data-index': index,
                'tab-index': -1,
                'aria-level': index + 1
              },
              innerHtml: part.name
            },
            action: function (_btn) {
              editor.focus();
              editor.selection.select(part.element);
              editor.nodeChanged();
            },
            buttonBehaviours: derive$1([
              DisablingConfigs.button(providersBackstage.isDisabled),
              receivingConfig()
            ])
          });
        });
        var divider = {
          dom: {
            tag: 'div',
            classes: ['tox-statusbar__path-divider'],
            attributes: { 'aria-hidden': true },
            innerHtml: ' ' + settings.delimiter + ' '
          }
        };
        return foldl(newPathElements.slice(1), function (acc, element) {
          var newAcc = acc;
          newAcc.push(divider);
          newAcc.push(element);
          return newAcc;
        }, [newPathElements[0]]);
      };
      var updatePath = function (parents) {
        var newPath = [];
        var i = parents.length;
        while (i-- > 0) {
          var parent_1 = parents[i];
          if (parent_1.nodeType === 1 && !isHidden$1(parent_1)) {
            var args = editor.fire('ResolveName', {
              name: parent_1.nodeName.toLowerCase(),
              target: parent_1
            });
            if (!args.isDefaultPrevented()) {
              newPath.push({
                name: args.name,
                element: parent_1
              });
            }
            if (args.isPropagationStopped()) {
              break;
            }
          }
        }
        return newPath;
      };
      return {
        dom: {
          tag: 'div',
          classes: ['tox-statusbar__path'],
          attributes: { role: 'navigation' }
        },
        behaviours: derive$1([
          Keying.config({
            mode: 'flow',
            selector: 'div[role=button]'
          }),
          Disabling.config({ disabled: providersBackstage.isDisabled }),
          receivingConfig(),
          Tabstopping.config({}),
          Replacing.config({}),
          config('elementPathEvents', [runOnAttached(function (comp, _e) {
              editor.shortcuts.add('alt+F11', 'focus statusbar elementpath', function () {
                return Keying.focusIn(comp);
              });
              editor.on('NodeChange', function (e) {
                var newPath = updatePath(e.parents);
                if (newPath.length > 0) {
                  Replacing.set(comp, getDataPath(newPath));
                } else {
                  Replacing.set(comp, []);
                }
              });
            })])
        ]),
        components: []
      };
    };

    var ResizeTypes;
    (function (ResizeTypes) {
      ResizeTypes[ResizeTypes['None'] = 0] = 'None';
      ResizeTypes[ResizeTypes['Both'] = 1] = 'Both';
      ResizeTypes[ResizeTypes['Vertical'] = 2] = 'Vertical';
    }(ResizeTypes || (ResizeTypes = {})));
    var getDimensions = function (editor, deltas, resizeType, originalHeight, originalWidth) {
      var dimensions = {};
      dimensions.height = calcCappedSize(originalHeight + deltas.top, getMinHeightSetting(editor), getMaxHeightSetting(editor));
      if (resizeType === ResizeTypes.Both) {
        dimensions.width = calcCappedSize(originalWidth + deltas.left, getMinWidthSetting(editor), getMaxWidthSetting(editor));
      }
      return dimensions;
    };
    var resize$3 = function (editor, deltas, resizeType) {
      var container = SugarElement.fromDom(editor.getContainer());
      var dimensions = getDimensions(editor, deltas, resizeType, get$7(container), get$8(container));
      each$1(dimensions, function (val, dim) {
        return set$2(container, dim, numToPx(val));
      });
      fireResizeEditor(editor);
    };

    var getResizeType = function (editor) {
      var fallback = !editor.hasPlugin('autoresize');
      var resize = editor.getParam('resize', fallback);
      if (resize === false) {
        return ResizeTypes.None;
      } else if (resize === 'both') {
        return ResizeTypes.Both;
      } else {
        return ResizeTypes.Vertical;
      }
    };
    var keyboardHandler = function (editor, resizeType, x, y) {
      var scale = 20;
      var delta = SugarPosition(x * scale, y * scale);
      resize$3(editor, delta, resizeType);
      return Optional.some(true);
    };
    var renderResizeHandler = function (editor, providersBackstage) {
      var resizeType = getResizeType(editor);
      if (resizeType === ResizeTypes.None) {
        return Optional.none();
      }
      return Optional.some({
        dom: {
          tag: 'div',
          classes: ['tox-statusbar__resize-handle'],
          attributes: { title: providersBackstage.translate('Resize') },
          innerHtml: get$e('resize-handle', providersBackstage.icons)
        },
        behaviours: derive$1([
          Dragging.config({
            mode: 'mouse',
            repositionTarget: false,
            onDrag: function (_comp, _target, delta) {
              return resize$3(editor, delta, resizeType);
            },
            blockerClass: 'tox-blocker'
          }),
          Keying.config({
            mode: 'special',
            onLeft: function () {
              return keyboardHandler(editor, resizeType, -1, 0);
            },
            onRight: function () {
              return keyboardHandler(editor, resizeType, 1, 0);
            },
            onUp: function () {
              return keyboardHandler(editor, resizeType, 0, -1);
            },
            onDown: function () {
              return keyboardHandler(editor, resizeType, 0, 1);
            }
          }),
          Tabstopping.config({}),
          Focusing.config({})
        ])
      });
    };

    var renderWordCount = function (editor, providersBackstage) {
      var _a;
      var replaceCountText = function (comp, count, mode) {
        return Replacing.set(comp, [text(providersBackstage.translate([
            '{0} ' + mode,
            count[mode]
          ]))]);
      };
      return Button.sketch({
        dom: {
          tag: 'button',
          classes: ['tox-statusbar__wordcount']
        },
        components: [],
        buttonBehaviours: derive$1([
          DisablingConfigs.button(providersBackstage.isDisabled),
          receivingConfig(),
          Tabstopping.config({}),
          Replacing.config({}),
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: {
                mode: 'words',
                count: {
                  words: 0,
                  characters: 0
                }
              }
            }
          }),
          config('wordcount-events', [
            runOnExecute(function (comp) {
              var currentVal = Representing.getValue(comp);
              var newMode = currentVal.mode === 'words' ? 'characters' : 'words';
              Representing.setValue(comp, {
                mode: newMode,
                count: currentVal.count
              });
              replaceCountText(comp, currentVal.count, newMode);
            }),
            runOnAttached(function (comp) {
              editor.on('wordCountUpdate', function (e) {
                var mode = Representing.getValue(comp).mode;
                Representing.setValue(comp, {
                  mode: mode,
                  count: e.wordCount
                });
                replaceCountText(comp, e.wordCount, mode);
              });
            })
          ])
        ]),
        eventOrder: (_a = {}, _a[execute()] = [
          'disabling',
          'alloy.base.behaviour',
          'wordcount-events'
        ], _a)
      });
    };

    var renderStatusbar = function (editor, providersBackstage) {
      var renderBranding = function () {
        var label = global$6.translate([
          'Powered by {0}',
          'Tiny'
        ]);
        var linkHtml = '<a href="https://www.tiny.cloud/?utm_campaign=editor_referral&amp;utm_medium=poweredby&amp;utm_source=tinymce&amp;utm_content=v5" rel="noopener" target="_blank" tabindex="-1" aria-label="' + label + '">' + label + '</a>';
        return {
          dom: {
            tag: 'span',
            classes: ['tox-statusbar__branding'],
            innerHtml: linkHtml
          }
        };
      };
      var getTextComponents = function () {
        var components = [];
        if (editor.getParam('elementpath', true, 'boolean')) {
          components.push(renderElementPath(editor, {}, providersBackstage));
        }
        if (editor.hasPlugin('wordcount')) {
          components.push(renderWordCount(editor, providersBackstage));
        }
        if (editor.getParam('branding', true, 'boolean')) {
          components.push(renderBranding());
        }
        if (components.length > 0) {
          return [{
              dom: {
                tag: 'div',
                classes: ['tox-statusbar__text-container']
              },
              components: components
            }];
        }
        return [];
      };
      var getComponents = function () {
        var components = getTextComponents();
        var resizeHandler = renderResizeHandler(editor, providersBackstage);
        return components.concat(resizeHandler.toArray());
      };
      return {
        dom: {
          tag: 'div',
          classes: ['tox-statusbar']
        },
        components: getComponents()
      };
    };

    var setup$b = function (editor) {
      var _a;
      var isInline = editor.inline;
      var mode = isInline ? Inline : Iframe;
      var header = isStickyToolbar(editor) ? StickyHeader : StaticHeader;
      var lazyOuterContainer = Optional.none();
      var platform = detect$3();
      var isIE = platform.browser.isIE();
      var platformClasses = isIE ? ['tox-platform-ie'] : [];
      var isTouch = platform.deviceType.isTouch();
      var touchPlatformClass = 'tox-platform-touch';
      var deviceClasses = isTouch ? [touchPlatformClass] : [];
      var isToolbarBottom = isToolbarLocationBottom(editor);
      var uiContainer = getUiContainer(editor);
      var dirAttributes = global$6.isRtl() ? { attributes: { dir: 'rtl' } } : {};
      var verticalDirAttributes = { attributes: (_a = {}, _a[Attribute] = isToolbarBottom ? AttributeValue.BottomToTop : AttributeValue.TopToBottom, _a) };
      var lazyHeader = function () {
        return lazyOuterContainer.bind(OuterContainer.getHeader);
      };
      var isHeaderDocked = function () {
        return header.isDocked(lazyHeader);
      };
      var resizeUiMothership = function () {
        set$2(uiMothership.element, 'width', document.body.clientWidth + 'px');
      };
      var makeSinkDefinition = function () {
        var isGridUiContainer = eq$1(body(), uiContainer) && get$5(uiContainer, 'display') === 'grid';
        var sinkSpec = {
          dom: __assign({
            tag: 'div',
            classes: [
              'tox',
              'tox-silver-sink',
              'tox-tinymce-aux'
            ].concat(platformClasses).concat(deviceClasses)
          }, dirAttributes),
          behaviours: derive$1([Positioning.config({
              useFixed: function () {
                return isHeaderDocked();
              }
            })])
        };
        var reactiveWidthSpec = {
          dom: { styles: { width: document.body.clientWidth + 'px' } },
          events: derive([run(windowResize(), resizeUiMothership)])
        };
        return deepMerge(sinkSpec, isGridUiContainer ? reactiveWidthSpec : {});
      };
      var sink = build$1(makeSinkDefinition());
      var lazySink = function () {
        return Result.value(sink);
      };
      var memAnchorBar = record({
        dom: {
          tag: 'div',
          classes: ['tox-anchorbar']
        }
      });
      var lazyAnchorBar = function () {
        return lazyOuterContainer.bind(function (container) {
          return memAnchorBar.getOpt(container);
        }).getOrDie('Could not find a anchor bar element');
      };
      var lazyToolbar = function () {
        return lazyOuterContainer.bind(function (container) {
          return OuterContainer.getToolbar(container);
        }).getOrDie('Could not find more toolbar element');
      };
      var lazyThrobber = function () {
        return lazyOuterContainer.bind(function (container) {
          return OuterContainer.getThrobber(container);
        }).getOrDie('Could not find throbber element');
      };
      var backstage = init$8(sink, editor, lazyAnchorBar);
      var partMenubar = OuterContainer.parts.menubar({
        dom: {
          tag: 'div',
          classes: ['tox-menubar']
        },
        backstage: backstage,
        onEscape: function () {
          editor.focus();
        }
      });
      var toolbarMode = getToolbarMode(editor);
      var partToolbar = OuterContainer.parts.toolbar(__assign({
        dom: {
          tag: 'div',
          classes: ['tox-toolbar']
        },
        getSink: lazySink,
        providers: backstage.shared.providers,
        onEscape: function () {
          editor.focus();
        },
        type: toolbarMode,
        lazyToolbar: lazyToolbar,
        lazyHeader: function () {
          return lazyHeader().getOrDie('Could not find header element');
        }
      }, verticalDirAttributes));
      var partMultipleToolbar = OuterContainer.parts['multiple-toolbar']({
        dom: {
          tag: 'div',
          classes: ['tox-toolbar-overlord']
        },
        providers: backstage.shared.providers,
        onEscape: function () {
          editor.focus();
        },
        type: toolbarMode
      });
      var partSocket = OuterContainer.parts.socket({
        dom: {
          tag: 'div',
          classes: ['tox-edit-area']
        }
      });
      var partSidebar = OuterContainer.parts.sidebar({
        dom: {
          tag: 'div',
          classes: ['tox-sidebar']
        }
      });
      var partThrobber = OuterContainer.parts.throbber({
        dom: {
          tag: 'div',
          classes: ['tox-throbber']
        },
        backstage: backstage
      });
      var sb = editor.getParam('statusbar', true, 'boolean');
      var statusbar = sb && !isInline ? Optional.some(renderStatusbar(editor, backstage.shared.providers)) : Optional.none();
      var socketSidebarContainer = {
        dom: {
          tag: 'div',
          classes: ['tox-sidebar-wrap']
        },
        components: [
          partSocket,
          partSidebar
        ]
      };
      var hasMultipleToolbar = isMultipleToolbars(editor);
      var hasToolbar = isToolbarEnabled(editor);
      var hasMenubar = isMenubarEnabled(editor);
      var getPartToolbar = function () {
        if (hasMultipleToolbar) {
          return [partMultipleToolbar];
        } else if (hasToolbar) {
          return [partToolbar];
        } else {
          return [];
        }
      };
      var partHeader = OuterContainer.parts.header({
        dom: __assign({
          tag: 'div',
          classes: ['tox-editor-header']
        }, verticalDirAttributes),
        components: flatten([
          hasMenubar ? [partMenubar] : [],
          getPartToolbar(),
          useFixedContainer(editor) ? [] : [memAnchorBar.asSpec()]
        ]),
        sticky: isStickyToolbar(editor),
        editor: editor,
        sharedBackstage: backstage.shared
      });
      var editorComponents = flatten([
        isToolbarBottom ? [] : [partHeader],
        isInline ? [] : [socketSidebarContainer],
        isToolbarBottom ? [partHeader] : []
      ]);
      var editorContainer = {
        dom: {
          tag: 'div',
          classes: ['tox-editor-container']
        },
        components: editorComponents
      };
      var containerComponents = flatten([
        [editorContainer],
        isInline ? [] : statusbar.toArray(),
        [partThrobber]
      ]);
      var isHidden = isDistractionFree(editor);
      var attributes = __assign(__assign({ role: 'application' }, global$6.isRtl() ? { dir: 'rtl' } : {}), isHidden ? { 'aria-hidden': 'true' } : {});
      var outerContainer = build$1(OuterContainer.sketch({
        dom: {
          tag: 'div',
          classes: [
            'tox',
            'tox-tinymce'
          ].concat(isInline ? ['tox-tinymce-inline'] : []).concat(isToolbarBottom ? ['tox-tinymce--toolbar-bottom'] : []).concat(deviceClasses).concat(platformClasses),
          styles: __assign({ visibility: 'hidden' }, isHidden ? {
            opacity: '0',
            border: '0'
          } : {}),
          attributes: attributes
        },
        components: containerComponents,
        behaviours: derive$1([
          receivingConfig(),
          Disabling.config({ disableClass: 'tox-tinymce--disabled' }),
          Keying.config({
            mode: 'cyclic',
            selector: '.tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a, .tox-statusbar__resize-handle'
          })
        ])
      }));
      lazyOuterContainer = Optional.some(outerContainer);
      editor.shortcuts.add('alt+F9', 'focus menubar', function () {
        OuterContainer.focusMenubar(outerContainer);
      });
      editor.shortcuts.add('alt+F10', 'focus toolbar', function () {
        OuterContainer.focusToolbar(outerContainer);
      });
      editor.addCommand('ToggleToolbarDrawer', function () {
        OuterContainer.toggleToolbarDrawer(outerContainer);
      });
      editor.addQueryStateHandler('ToggleToolbarDrawer', function () {
        return OuterContainer.isToolbarDrawerToggled(outerContainer);
      });
      var mothership = takeover(outerContainer);
      var uiMothership = takeover(sink);
      setup$3(editor, mothership, uiMothership);
      var getUi = function () {
        var channels = {
          broadcastAll: uiMothership.broadcast,
          broadcastOn: uiMothership.broadcastOn,
          register: noop
        };
        return { channels: channels };
      };
      var setEditorSize = function () {
        var parsedHeight = numToPx(getHeightWithFallback(editor));
        var parsedWidth = numToPx(getWidthWithFallback(editor));
        if (!editor.inline) {
          if (isValidValue('div', 'width', parsedWidth)) {
            set$2(outerContainer.element, 'width', parsedWidth);
          }
          if (isValidValue('div', 'height', parsedHeight)) {
            set$2(outerContainer.element, 'height', parsedHeight);
          } else {
            set$2(outerContainer.element, 'height', '200px');
          }
        }
        return parsedHeight;
      };
      var renderUI = function () {
        header.setup(editor, backstage.shared, lazyHeader);
        setup$8(editor, backstage);
        setup$9(editor, lazySink, backstage);
        setup$6(editor);
        setup$7(editor, lazyThrobber, backstage.shared);
        map$2(getToolbarGroups(editor), function (toolbarGroupButtonConfig, name) {
          editor.ui.registry.addGroupToolbarButton(name, toolbarGroupButtonConfig);
        });
        var _a = editor.ui.registry.getAll(), buttons = _a.buttons, menuItems = _a.menuItems, contextToolbars = _a.contextToolbars, sidebars = _a.sidebars;
        var toolbarOpt = getMultipleToolbarsSetting(editor);
        var rawUiConfig = {
          menuItems: menuItems,
          menus: getMenus(editor),
          menubar: getMenubar(editor),
          toolbar: toolbarOpt.getOrThunk(function () {
            return getToolbar(editor);
          }),
          allowToolbarGroups: toolbarMode === ToolbarMode.floating,
          buttons: buttons,
          sidebar: sidebars
        };
        register$4(editor, contextToolbars, sink, { backstage: backstage });
        setup$a(editor, sink);
        var elm = editor.getElement();
        var height = setEditorSize();
        var uiComponents = {
          mothership: mothership,
          uiMothership: uiMothership,
          outerContainer: outerContainer
        };
        var args = {
          targetNode: elm,
          height: height
        };
        return mode.render(editor, uiComponents, rawUiConfig, backstage, args);
      };
      return {
        mothership: mothership,
        uiMothership: uiMothership,
        backstage: backstage,
        renderUI: renderUI,
        getUi: getUi
      };
    };

    var describedBy = function (describedElement, describeElement) {
      var describeId = Optional.from(get$3(describedElement, 'id')).fold(function () {
        var id = generate$1('dialog-describe');
        set$1(describeElement, 'id', id);
        return id;
      }, identity);
      set$1(describedElement, 'aria-describedby', describeId);
    };

    var labelledBy = function (labelledElement, labelElement) {
      var labelId = getOpt(labelledElement, 'id').fold(function () {
        var id = generate$1('dialog-label');
        set$1(labelElement, 'id', id);
        return id;
      }, identity);
      set$1(labelledElement, 'aria-labelledby', labelId);
    };

    var schema$x = constant([
      strict$1('lazySink'),
      option('dragBlockClass'),
      defaultedFunction('getBounds', win),
      defaulted$1('useTabstopAt', always),
      defaulted$1('eventOrder', {}),
      field$1('modalBehaviours', [Keying]),
      onKeyboardHandler('onExecute'),
      onStrictKeyboardHandler('onEscape')
    ]);
    var basic = { sketch: identity };
    var parts$f = constant([
      optional({
        name: 'draghandle',
        overrides: function (detail, spec) {
          return {
            behaviours: derive$1([Dragging.config({
                mode: 'mouse',
                getTarget: function (handle) {
                  return ancestor$2(handle, '[role="dialog"]').getOr(handle);
                },
                blockerClass: detail.dragBlockClass.getOrDie(new Error('The drag blocker class was not specified for a dialog with a drag handle: \n' + JSON.stringify(spec, null, 2)).message),
                getBounds: detail.getDragBounds
              })])
          };
        }
      }),
      required({
        schema: [strict$1('dom')],
        name: 'title'
      }),
      required({
        factory: basic,
        schema: [strict$1('dom')],
        name: 'close'
      }),
      required({
        factory: basic,
        schema: [strict$1('dom')],
        name: 'body'
      }),
      optional({
        factory: basic,
        schema: [strict$1('dom')],
        name: 'footer'
      }),
      external$1({
        factory: {
          sketch: function (spec, detail) {
            return __assign(__assign({}, spec), {
              dom: detail.dom,
              components: detail.components
            });
          }
        },
        schema: [
          defaulted$1('dom', {
            tag: 'div',
            styles: {
              position: 'fixed',
              left: '0px',
              top: '0px',
              right: '0px',
              bottom: '0px'
            }
          }),
          defaulted$1('components', [])
        ],
        name: 'blocker'
      })
    ]);

    var block = function (component, config, state, getBusySpec) {
      set$1(component.element, 'aria-busy', true);
      var root = config.getRoot(component).getOr(component);
      var blockerBehaviours = derive$1([
        Keying.config({
          mode: 'special',
          onTab: function () {
            return Optional.some(true);
          },
          onShiftTab: function () {
            return Optional.some(true);
          }
        }),
        Focusing.config({})
      ]);
      var blockSpec = getBusySpec(root, blockerBehaviours);
      var blocker = root.getSystem().build(blockSpec);
      Replacing.append(root, premade$1(blocker));
      if (blocker.hasConfigured(Keying)) {
        Keying.focusIn(blocker);
      }
      if (!state.isBlocked()) {
        config.onBlock(component);
      }
      state.blockWith(function () {
        return Replacing.remove(root, blocker);
      });
    };
    var unblock = function (component, config, state) {
      remove$1(component.element, 'aria-busy');
      if (state.isBlocked()) {
        config.onUnblock(component);
      }
      state.clear();
    };

    var BlockingApis = /*#__PURE__*/Object.freeze({
        __proto__: null,
        block: block,
        unblock: unblock
    });

    var BlockingSchema = [
      defaultedFunction('getRoot', Optional.none),
      onHandler('onBlock'),
      onHandler('onUnblock')
    ];

    var init$f = function () {
      var blocker = destroyable();
      var blockWith = function (destroy) {
        blocker.set({ destroy: destroy });
      };
      return nu$5({
        readState: blocker.isSet,
        blockWith: blockWith,
        clear: blocker.clear,
        isBlocked: blocker.isSet
      });
    };

    var BlockingState = /*#__PURE__*/Object.freeze({
        __proto__: null,
        init: init$f
    });

    var Blocking = create$1({
      fields: BlockingSchema,
      name: 'blocking',
      apis: BlockingApis,
      state: BlockingState
    });

    var factory$i = function (detail, components, spec, externals) {
      var _a;
      var dialogComp = Cell(Optional.none());
      var showDialog = function (dialog) {
        dialogComp.set(Optional.some(dialog));
        var sink = detail.lazySink(dialog).getOrDie();
        var externalBlocker = externals.blocker();
        var blocker = sink.getSystem().build(__assign(__assign({}, externalBlocker), {
          components: externalBlocker.components.concat([premade$1(dialog)]),
          behaviours: derive$1([
            Focusing.config({}),
            config('dialog-blocker-events', [runOnSource(focusin(), function () {
                Keying.focusIn(dialog);
              })])
          ])
        }));
        attach$1(sink, blocker);
        Keying.focusIn(dialog);
      };
      var hideDialog = function (dialog) {
        dialogComp.set(Optional.none());
        parent(dialog.element).each(function (blockerDom) {
          dialog.getSystem().getByDom(blockerDom).each(function (blocker) {
            detach(blocker);
          });
        });
      };
      var getDialogBody = function (dialog) {
        return getPartOrDie(dialog, detail, 'body');
      };
      var getDialogFooter = function (dialog) {
        return getPartOrDie(dialog, detail, 'footer');
      };
      var setBusy = function (dialog, getBusySpec) {
        Blocking.block(dialog, getBusySpec);
      };
      var setIdle = function (dialog) {
        Blocking.unblock(dialog);
      };
      var modalEventsId = generate$1('modal-events');
      var eventOrder = __assign(__assign({}, detail.eventOrder), (_a = {}, _a[attachedToDom()] = [modalEventsId].concat(detail.eventOrder['alloy.system.attached'] || []), _a));
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        apis: {
          show: showDialog,
          hide: hideDialog,
          getBody: getDialogBody,
          getFooter: getDialogFooter,
          setIdle: setIdle,
          setBusy: setBusy
        },
        eventOrder: eventOrder,
        domModification: {
          attributes: {
            'role': 'dialog',
            'aria-modal': 'true'
          }
        },
        behaviours: augment(detail.modalBehaviours, [
          Replacing.config({}),
          Keying.config({
            mode: 'cyclic',
            onEnter: detail.onExecute,
            onEscape: detail.onEscape,
            useTabstopAt: detail.useTabstopAt
          }),
          Blocking.config({ getRoot: dialogComp.get }),
          config(modalEventsId, [runOnAttached(function (c) {
              labelledBy(c.element, getPartOrDie(c, detail, 'title').element);
              describedBy(c.element, getPartOrDie(c, detail, 'body').element);
            })])
        ])
      };
    };
    var ModalDialog = composite$1({
      name: 'ModalDialog',
      configFields: schema$x(),
      partFields: parts$f(),
      factory: factory$i,
      apis: {
        show: function (apis, dialog) {
          apis.show(dialog);
        },
        hide: function (apis, dialog) {
          apis.hide(dialog);
        },
        getBody: function (apis, dialog) {
          return apis.getBody(dialog);
        },
        getFooter: function (apis, dialog) {
          return apis.getFooter(dialog);
        },
        setBusy: function (apis, dialog, getBusySpec) {
          apis.setBusy(dialog, getBusySpec);
        },
        setIdle: function (apis, dialog) {
          apis.setIdle(dialog);
        }
      }
    });

    var dialogToggleMenuItemSchema = objOf([
      strictString('type'),
      strictString('name')
    ].concat(commonMenuItemFields));
    var dialogToggleMenuItemDataProcessor = boolean;

    var baseFooterButtonFields = [
      field('name', 'name', defaultedThunk(function () {
        return generate$1('button-name');
      }), string),
      optionString('icon'),
      defaultedStringEnum('align', 'end', [
        'start',
        'end'
      ]),
      defaultedBoolean('primary', false),
      defaultedBoolean('disabled', false)
    ];
    var dialogFooterButtonFields = __spreadArrays(baseFooterButtonFields, [strictString('text')]);
    var normalFooterButtonFields = __spreadArrays([strictStringEnum('type', [
        'submit',
        'cancel',
        'custom'
      ])], dialogFooterButtonFields);
    var menuFooterButtonFields = __spreadArrays([
      strictStringEnum('type', ['menu']),
      optionString('text'),
      optionString('tooltip'),
      optionString('icon'),
      strictArrayOf('items', dialogToggleMenuItemSchema)
    ], baseFooterButtonFields);
    var dialogFooterButtonSchema = choose$1('type', {
      submit: normalFooterButtonFields,
      cancel: normalFooterButtonFields,
      custom: normalFooterButtonFields,
      menu: menuFooterButtonFields
    });

    var alertBannerFields = [
      strictString('type'),
      strictString('text'),
      strictStringEnum('level', [
        'info',
        'warn',
        'error',
        'success'
      ]),
      strictString('icon'),
      defaulted$1('url', '')
    ];
    var alertBannerSchema = objOf(alertBannerFields);

    var createBarFields = function (itemsField) {
      return [
        strictString('type'),
        itemsField
      ];
    };

    var buttonFields = [
      strictString('type'),
      strictString('text'),
      defaultedBoolean('disabled', false),
      defaultedBoolean('primary', false),
      field('name', 'name', defaultedThunk(function () {
        return generate$1('button-name');
      }), string),
      optionString('icon'),
      defaultedBoolean('borderless', false)
    ];
    var buttonSchema = objOf(buttonFields);

    var checkboxFields = [
      strictString('type'),
      strictString('name'),
      strictString('label'),
      defaultedBoolean('disabled', false)
    ];
    var checkboxSchema = objOf(checkboxFields);
    var checkboxDataProcessor = boolean;

    var formComponentFields = [
      strictString('type'),
      strictString('name')
    ];
    var formComponentWithLabelFields = formComponentFields.concat([optionString('label')]);

    var collectionFields = formComponentWithLabelFields.concat([defaulted$1('columns', 'auto')]);
    var collectionSchema = objOf(collectionFields);
    var collectionDataProcessor = arrOfObj$1([
      strictString('value'),
      strictString('text'),
      strictString('icon')
    ]);

    var colorInputFields = formComponentWithLabelFields;
    var colorInputSchema = objOf(colorInputFields);
    var colorInputDataProcessor = string;

    var colorPickerFields = formComponentWithLabelFields;
    var colorPickerSchema = objOf(colorPickerFields);
    var colorPickerDataProcessor = string;

    var customEditorFields = formComponentFields.concat([
      defaultedString('tag', 'textarea'),
      strictString('scriptId'),
      strictString('scriptUrl'),
      defaultedPostMsg('settings', undefined)
    ]);
    var customEditorFieldsOld = formComponentFields.concat([
      defaultedString('tag', 'textarea'),
      strictFunction('init')
    ]);
    var customEditorSchema = valueOf(function (v) {
      return asRaw('customeditor.old', objOfOnly(customEditorFieldsOld), v).orThunk(function () {
        return asRaw('customeditor.new', objOfOnly(customEditorFields), v);
      });
    });
    var customEditorDataProcessor = string;

    var dropZoneFields = formComponentWithLabelFields;
    var dropZoneSchema = objOf(dropZoneFields);
    var dropZoneDataProcessor = arrOfVal();

    var createGridFields = function (itemsField) {
      return [
        strictString('type'),
        strictNumber('columns'),
        itemsField
      ];
    };

    var htmlPanelFields = [
      strictString('type'),
      strictString('html'),
      defaultedStringEnum('presets', 'presentation', [
        'presentation',
        'document'
      ])
    ];
    var htmlPanelSchema = objOf(htmlPanelFields);

    var iframeFields = formComponentWithLabelFields.concat([defaultedBoolean('sandboxed', true)]);
    var iframeSchema = objOf(iframeFields);
    var iframeDataProcessor = string;

    var imageToolsFields = formComponentWithLabelFields.concat([strictOf('currentState', objOf([
        strict$1('blob'),
        strictString('url')
      ]))]);
    var imageToolsSchema = objOf(imageToolsFields);

    var inputFields = formComponentWithLabelFields.concat([
      optionString('inputMode'),
      optionString('placeholder'),
      defaultedBoolean('maximized', false),
      defaultedBoolean('disabled', false)
    ]);
    var inputSchema = objOf(inputFields);
    var inputDataProcessor = string;

    var createLabelFields = function (itemsField) {
      return [
        strictString('type'),
        strictString('label'),
        itemsField
      ];
    };

    var listBoxSingleItemFields = [
      strictString('text'),
      strictString('value')
    ];
    var listBoxNestedItemFields = [
      strictString('text'),
      strictArrayOf('items', thunkOf('items', function () {
        return listBoxItemSchema;
      }))
    ];
    var listBoxItemSchema = oneOf([
      objOf(listBoxSingleItemFields),
      objOf(listBoxNestedItemFields)
    ]);
    var listBoxFields = formComponentWithLabelFields.concat([
      strictArrayOf('items', listBoxItemSchema),
      defaultedBoolean('disabled', false)
    ]);
    var listBoxSchema = objOf(listBoxFields);
    var listBoxDataProcessor = string;

    var selectBoxFields = formComponentWithLabelFields.concat([
      strictArrayOfObj('items', [
        strictString('text'),
        strictString('value')
      ]),
      defaultedNumber('size', 1),
      defaultedBoolean('disabled', false)
    ]);
    var selectBoxSchema = objOf(selectBoxFields);
    var selectBoxDataProcessor = string;

    var sizeInputFields = formComponentWithLabelFields.concat([
      defaultedBoolean('constrain', true),
      defaultedBoolean('disabled', false)
    ]);
    var sizeInputSchema = objOf(sizeInputFields);
    var sizeInputDataProcessor = objOf([
      strictString('width'),
      strictString('height')
    ]);

    var tableFields = [
      strictString('type'),
      strictArrayOf('header', string),
      strictArrayOf('cells', arrOf(string))
    ];
    var tableSchema = objOf(tableFields);

    var textAreaFields = formComponentWithLabelFields.concat([
      optionString('placeholder'),
      defaultedBoolean('maximized', false),
      defaultedBoolean('disabled', false)
    ]);
    var textAreaSchema = objOf(textAreaFields);
    var textAreaDataProcessor = string;

    var urlInputFields = formComponentWithLabelFields.concat([
      defaultedStringEnum('filetype', 'file', [
        'image',
        'media',
        'file'
      ]),
      defaulted$1('disabled', false)
    ]);
    var urlInputSchema = objOf(urlInputFields);
    var urlInputDataProcessor = objOf([
      strictString('value'),
      defaulted$1('meta', {})
    ]);

    var createItemsField = function (name) {
      return field('items', 'items', strict(), arrOf(valueOf(function (v) {
        return asRaw('Checking item of ' + name, itemSchema$3, v).fold(function (sErr) {
          return Result.error(formatError(sErr));
        }, function (passValue) {
          return Result.value(passValue);
        });
      })));
    };
    var itemSchema$3 = valueThunkOf(function () {
      return chooseProcessor('type', {
        alertbanner: alertBannerSchema,
        bar: objOf(createBarFields(createItemsField('bar'))),
        button: buttonSchema,
        checkbox: checkboxSchema,
        colorinput: colorInputSchema,
        colorpicker: colorPickerSchema,
        dropzone: dropZoneSchema,
        grid: objOf(createGridFields(createItemsField('grid'))),
        iframe: iframeSchema,
        input: inputSchema,
        listbox: listBoxSchema,
        selectbox: selectBoxSchema,
        sizeinput: sizeInputSchema,
        textarea: textAreaSchema,
        urlinput: urlInputSchema,
        customeditor: customEditorSchema,
        htmlpanel: htmlPanelSchema,
        imagetools: imageToolsSchema,
        collection: collectionSchema,
        label: objOf(createLabelFields(createItemsField('label'))),
        table: tableSchema,
        panel: panelSchema
      });
    });
    var panelFields = [
      strictString('type'),
      defaulted$1('classes', []),
      strictArrayOf('items', itemSchema$3)
    ];
    var panelSchema = objOf(panelFields);

    var tabFields = [
      field('name', 'name', defaultedThunk(function () {
        return generate$1('tab-name');
      }), string),
      strictString('title'),
      strictArrayOf('items', itemSchema$3)
    ];
    var tabPanelFields = [
      strictString('type'),
      strictArrayOfObj('tabs', tabFields)
    ];
    var tabPanelSchema = objOf(tabPanelFields);

    var dialogButtonFields = dialogFooterButtonFields;
    var dialogButtonSchema = dialogFooterButtonSchema;
    var dialogSchema = objOf([
      strictString('title'),
      strictOf('body', chooseProcessor('type', {
        panel: panelSchema,
        tabpanel: tabPanelSchema
      })),
      defaultedString('size', 'normal'),
      strictArrayOf('buttons', dialogButtonSchema),
      defaulted$1('initialData', {}),
      defaultedFunction('onAction', noop),
      defaultedFunction('onChange', noop),
      defaultedFunction('onSubmit', noop),
      defaultedFunction('onClose', noop),
      defaultedFunction('onCancel', noop),
      defaulted$1('onTabChange', noop)
    ]);
    var createDialog = function (spec) {
      return asRaw('dialog', dialogSchema, spec);
    };

    var urlDialogButtonSchema = objOf(__spreadArrays([strictStringEnum('type', [
        'cancel',
        'custom'
      ])], dialogButtonFields));
    var urlDialogSchema = objOf([
      strictString('title'),
      strictString('url'),
      optionNumber('height'),
      optionNumber('width'),
      optionArrayOf('buttons', urlDialogButtonSchema),
      defaultedFunction('onAction', noop),
      defaultedFunction('onCancel', noop),
      defaultedFunction('onClose', noop),
      defaultedFunction('onMessage', noop)
    ]);
    var createUrlDialog = function (spec) {
      return asRaw('dialog', urlDialogSchema, spec);
    };

    var getAllObjects = function (obj) {
      if (isObject(obj)) {
        return [obj].concat(bind(values(obj), getAllObjects));
      } else if (isArray(obj)) {
        return bind(obj, getAllObjects);
      } else {
        return [];
      }
    };

    var isNamedItem = function (obj) {
      return isString(obj.type) && isString(obj.name);
    };
    var dataProcessors = {
      checkbox: checkboxDataProcessor,
      colorinput: colorInputDataProcessor,
      colorpicker: colorPickerDataProcessor,
      dropzone: dropZoneDataProcessor,
      input: inputDataProcessor,
      iframe: iframeDataProcessor,
      sizeinput: sizeInputDataProcessor,
      selectbox: selectBoxDataProcessor,
      listbox: listBoxDataProcessor,
      size: sizeInputDataProcessor,
      textarea: textAreaDataProcessor,
      urlinput: urlInputDataProcessor,
      customeditor: customEditorDataProcessor,
      collection: collectionDataProcessor,
      togglemenuitem: dialogToggleMenuItemDataProcessor
    };
    var getDataProcessor = function (item) {
      return Optional.from(dataProcessors[item.type]);
    };
    var getNamedItems = function (structure) {
      return filter(getAllObjects(structure), isNamedItem);
    };

    var createDataValidator = function (structure) {
      var namedItems = getNamedItems(structure);
      var fields = bind(namedItems, function (item) {
        return getDataProcessor(item).fold(function () {
          return [];
        }, function (schema) {
          return [strictOf(item.name, schema)];
        });
      });
      return objOf(fields);
    };

    var extract$1 = function (structure) {
      var internalDialog = getOrDie(createDialog(structure));
      var dataValidator = createDataValidator(structure);
      var initialData = structure.initialData;
      return {
        internalDialog: internalDialog,
        dataValidator: dataValidator,
        initialData: initialData
      };
    };
    var DialogManager = {
      open: function (factory, structure) {
        var extraction = extract$1(structure);
        return factory(extraction.internalDialog, extraction.initialData, extraction.dataValidator);
      },
      openUrl: function (factory, structure) {
        var internalDialog = getOrDie(createUrlDialog(structure));
        return factory(internalDialog);
      },
      redial: function (structure) {
        return extract$1(structure);
      }
    };

    var toValidValues = function (values) {
      var errors = [];
      var result = {};
      each$1(values, function (value, name) {
        value.fold(function () {
          errors.push(name);
        }, function (v) {
          result[name] = v;
        });
      });
      return errors.length > 0 ? Result.error(errors) : Result.value(result);
    };

    var renderBodyPanel = function (spec, backstage) {
      var memForm = record(Form.sketch(function (parts) {
        return {
          dom: {
            tag: 'div',
            classes: ['tox-form'].concat(spec.classes)
          },
          components: map(spec.items, function (item) {
            return interpretInForm(parts, item, backstage);
          })
        };
      }));
      return {
        dom: {
          tag: 'div',
          classes: ['tox-dialog__body']
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-dialog__body-content']
            },
            components: [memForm.asSpec()]
          }],
        behaviours: derive$1([
          Keying.config({
            mode: 'acyclic',
            useTabstopAt: not(isPseudoStop)
          }),
          ComposingConfigs.memento(memForm),
          RepresentingConfigs.memento(memForm, {
            postprocess: function (formValue) {
              return toValidValues(formValue).fold(function (err) {
                console.error(err);
                return {};
              }, function (vals) {
                return vals;
              });
            }
          })
        ])
      };
    };

    var factory$j = function (detail, _spec) {
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: detail.components,
        events: events$7(detail.action),
        behaviours: augment(detail.tabButtonBehaviours, [
          Focusing.config({}),
          Keying.config({
            mode: 'execution',
            useSpace: true,
            useEnter: true
          }),
          Representing.config({
            store: {
              mode: 'memory',
              initialValue: detail.value
            }
          })
        ]),
        domModification: detail.domModification
      };
    };
    var TabButton = single$2({
      name: 'TabButton',
      configFields: [
        defaulted$1('uid', undefined),
        strict$1('value'),
        field('dom', 'dom', mergeWithThunk(function () {
          return {
            attributes: {
              'role': 'tab',
              'id': generate$1('aria'),
              'aria-selected': 'false'
            }
          };
        }), anyValue$1()),
        option('action'),
        defaulted$1('domModification', {}),
        field$1('tabButtonBehaviours', [
          Focusing,
          Keying,
          Representing
        ]),
        strict$1('view')
      ],
      factory: factory$j
    });

    var schema$y = constant([
      strict$1('tabs'),
      strict$1('dom'),
      defaulted$1('clickToDismiss', false),
      field$1('tabbarBehaviours', [
        Highlighting,
        Keying
      ]),
      markers([
        'tabClass',
        'selectedClass'
      ])
    ]);
    var tabsPart = group({
      factory: TabButton,
      name: 'tabs',
      unit: 'tab',
      overrides: function (barDetail) {
        var dismissTab$1 = function (tabbar, button) {
          Highlighting.dehighlight(tabbar, button);
          emitWith(tabbar, dismissTab(), {
            tabbar: tabbar,
            button: button
          });
        };
        var changeTab$1 = function (tabbar, button) {
          Highlighting.highlight(tabbar, button);
          emitWith(tabbar, changeTab(), {
            tabbar: tabbar,
            button: button
          });
        };
        return {
          action: function (button) {
            var tabbar = button.getSystem().getByUid(barDetail.uid).getOrDie();
            var activeButton = Highlighting.isHighlighted(tabbar, button);
            var response = function () {
              if (activeButton && barDetail.clickToDismiss) {
                return dismissTab$1;
              } else if (!activeButton) {
                return changeTab$1;
              } else {
                return noop;
              }
            }();
            response(tabbar, button);
          },
          domModification: { classes: [barDetail.markers.tabClass] }
        };
      }
    });
    var parts$g = constant([tabsPart]);

    var factory$k = function (detail, components, _spec, _externals) {
      return {
        'uid': detail.uid,
        'dom': detail.dom,
        components: components,
        'debug.sketcher': 'Tabbar',
        'domModification': { attributes: { role: 'tablist' } },
        'behaviours': augment(detail.tabbarBehaviours, [
          Highlighting.config({
            highlightClass: detail.markers.selectedClass,
            itemClass: detail.markers.tabClass,
            onHighlight: function (tabbar, tab) {
              set$1(tab.element, 'aria-selected', 'true');
            },
            onDehighlight: function (tabbar, tab) {
              set$1(tab.element, 'aria-selected', 'false');
            }
          }),
          Keying.config({
            mode: 'flow',
            getInitial: function (tabbar) {
              return Highlighting.getHighlighted(tabbar).map(function (tab) {
                return tab.element;
              });
            },
            selector: '.' + detail.markers.tabClass,
            executeOnMove: true
          })
        ])
      };
    };
    var Tabbar = composite$1({
      name: 'Tabbar',
      configFields: schema$y(),
      partFields: parts$g(),
      factory: factory$k
    });

    var factory$l = function (detail, _spec) {
      return {
        uid: detail.uid,
        dom: detail.dom,
        behaviours: augment(detail.tabviewBehaviours, [Replacing.config({})]),
        domModification: { attributes: { role: 'tabpanel' } }
      };
    };
    var Tabview = single$2({
      name: 'Tabview',
      configFields: [field$1('tabviewBehaviours', [Replacing])],
      factory: factory$l
    });

    var schema$z = constant([
      defaulted$1('selectFirst', true),
      onHandler('onChangeTab'),
      onHandler('onDismissTab'),
      defaulted$1('tabs', []),
      field$1('tabSectionBehaviours', [])
    ]);
    var barPart = required({
      factory: Tabbar,
      schema: [
        strict$1('dom'),
        strictObjOf('markers', [
          strict$1('tabClass'),
          strict$1('selectedClass')
        ])
      ],
      name: 'tabbar',
      defaults: function (detail) {
        return { tabs: detail.tabs };
      }
    });
    var viewPart = required({
      factory: Tabview,
      name: 'tabview'
    });
    var parts$h = constant([
      barPart,
      viewPart
    ]);

    var factory$m = function (detail, components, _spec, _externals) {
      var changeTab$1 = function (button) {
        var tabValue = Representing.getValue(button);
        getPart(button, detail, 'tabview').each(function (tabview) {
          var tabWithValue = find(detail.tabs, function (t) {
            return t.value === tabValue;
          });
          tabWithValue.each(function (tabData) {
            var panel = tabData.view();
            getOpt(button.element, 'id').each(function (id) {
              set$1(tabview.element, 'aria-labelledby', id);
            });
            Replacing.set(tabview, panel);
            detail.onChangeTab(tabview, button, panel);
          });
        });
      };
      var changeTabBy = function (section, byPred) {
        getPart(section, detail, 'tabbar').each(function (tabbar) {
          byPred(tabbar).each(emitExecute);
        });
      };
      return {
        uid: detail.uid,
        dom: detail.dom,
        components: components,
        behaviours: get$d(detail.tabSectionBehaviours),
        events: derive(flatten([
          detail.selectFirst ? [runOnAttached(function (section, _simulatedEvent) {
              changeTabBy(section, Highlighting.getFirst);
            })] : [],
          [
            run(changeTab(), function (section, simulatedEvent) {
              var button = simulatedEvent.event.button;
              changeTab$1(button);
            }),
            run(dismissTab(), function (section, simulatedEvent) {
              var button = simulatedEvent.event.button;
              detail.onDismissTab(section, button);
            })
          ]
        ])),
        apis: {
          getViewItems: function (section) {
            return getPart(section, detail, 'tabview').map(function (tabview) {
              return Replacing.contents(tabview);
            }).getOr([]);
          },
          showTab: function (section, tabKey) {
            var getTabIfNotActive = function (tabbar) {
              var candidates = Highlighting.getCandidates(tabbar);
              var optTab = find(candidates, function (c) {
                return Representing.getValue(c) === tabKey;
              });
              return optTab.filter(function (tab) {
                return !Highlighting.isHighlighted(tabbar, tab);
              });
            };
            changeTabBy(section, getTabIfNotActive);
          }
        }
      };
    };
    var TabSection = composite$1({
      name: 'TabSection',
      configFields: schema$z(),
      partFields: parts$h(),
      factory: factory$m,
      apis: {
        getViewItems: function (apis, component) {
          return apis.getViewItems(component);
        },
        showTab: function (apis, component, tabKey) {
          apis.showTab(component, tabKey);
        }
      }
    });

    var measureHeights = function (allTabs, tabview, tabviewComp) {
      return map(allTabs, function (_tab, i) {
        Replacing.set(tabviewComp, allTabs[i].view());
        var rect = tabview.dom.getBoundingClientRect();
        Replacing.set(tabviewComp, []);
        return rect.height;
      });
    };
    var getMaxHeight = function (heights) {
      return head(sort(heights, function (a, b) {
        if (a > b) {
          return -1;
        } else if (a < b) {
          return +1;
        } else {
          return 0;
        }
      }));
    };
    var getMaxTabviewHeight = function (dialog, tabview, tablist) {
      var documentElement$1 = documentElement(dialog).dom;
      var rootElm = ancestor$2(dialog, '.tox-dialog-wrap').getOr(dialog);
      var isFixed = get$5(rootElm, 'position') === 'fixed';
      var maxHeight;
      if (isFixed) {
        maxHeight = Math.max(documentElement$1.clientHeight, window.innerHeight);
      } else {
        maxHeight = Math.max(documentElement$1.offsetHeight, documentElement$1.scrollHeight);
      }
      var tabviewHeight = get$7(tabview);
      var isTabListBeside = tabview.dom.offsetLeft >= tablist.dom.offsetLeft + get$8(tablist);
      var currentTabHeight = isTabListBeside ? Math.max(get$7(tablist), tabviewHeight) : tabviewHeight;
      var dialogTopMargin = parseInt(get$5(dialog, 'margin-top'), 10) || 0;
      var dialogBottomMargin = parseInt(get$5(dialog, 'margin-bottom'), 10) || 0;
      var dialogHeight = get$7(dialog) + dialogTopMargin + dialogBottomMargin;
      var chromeHeight = dialogHeight - currentTabHeight;
      return maxHeight - chromeHeight;
    };
    var showTab = function (allTabs, comp) {
      head(allTabs).each(function (tab) {
        return TabSection.showTab(comp, tab.value);
      });
    };
    var setTabviewHeight = function (tabview, height) {
      set$2(tabview, 'height', height + 'px');
      if (!detect$3().browser.isIE()) {
        set$2(tabview, 'flex-basis', height + 'px');
      } else {
        remove$6(tabview, 'flex-basis');
      }
    };
    var updateTabviewHeight = function (dialogBody, tabview, maxTabHeight) {
      ancestor$2(dialogBody, '[role="dialog"]').each(function (dialog) {
        descendant$1(dialog, '[role="tablist"]').each(function (tablist) {
          maxTabHeight.get().map(function (height) {
            set$2(tabview, 'height', '0');
            set$2(tabview, 'flex-basis', '0');
            return Math.min(height, getMaxTabviewHeight(dialog, tabview, tablist));
          }).each(function (height) {
            setTabviewHeight(tabview, height);
          });
        });
      });
    };
    var getTabview = function (dialog) {
      return descendant$1(dialog, '[role="tabpanel"]');
    };
    var setMode = function (allTabs) {
      var smartTabHeight = function () {
        var maxTabHeight = Cell(Optional.none());
        var extraEvents = [
          runOnAttached(function (comp) {
            var dialog = comp.element;
            getTabview(dialog).each(function (tabview) {
              set$2(tabview, 'visibility', 'hidden');
              comp.getSystem().getByDom(tabview).toOptional().each(function (tabviewComp) {
                var heights = measureHeights(allTabs, tabview, tabviewComp);
                var maxTabHeightOpt = getMaxHeight(heights);
                maxTabHeight.set(maxTabHeightOpt);
              });
              updateTabviewHeight(dialog, tabview, maxTabHeight);
              remove$6(tabview, 'visibility');
              showTab(allTabs, comp);
              global$2.requestAnimationFrame(function () {
                updateTabviewHeight(dialog, tabview, maxTabHeight);
              });
            });
          }),
          run(windowResize(), function (comp) {
            var dialog = comp.element;
            getTabview(dialog).each(function (tabview) {
              updateTabviewHeight(dialog, tabview, maxTabHeight);
            });
          }),
          run(formResizeEvent, function (comp, _se) {
            var dialog = comp.element;
            getTabview(dialog).each(function (tabview) {
              var oldFocus = active(getRootNode(tabview));
              set$2(tabview, 'visibility', 'hidden');
              var oldHeight = getRaw(tabview, 'height').map(function (h) {
                return parseInt(h, 10);
              });
              remove$6(tabview, 'height');
              remove$6(tabview, 'flex-basis');
              var newHeight = tabview.dom.getBoundingClientRect().height;
              var hasGrown = oldHeight.forall(function (h) {
                return newHeight > h;
              });
              if (hasGrown) {
                maxTabHeight.set(Optional.from(newHeight));
                updateTabviewHeight(dialog, tabview, maxTabHeight);
              } else {
                oldHeight.each(function (h) {
                  setTabviewHeight(tabview, h);
                });
              }
              remove$6(tabview, 'visibility');
              oldFocus.each(focus$1);
            });
          })
        ];
        var selectFirst = false;
        return {
          extraEvents: extraEvents,
          selectFirst: selectFirst
        };
      }();
      var naiveTabHeight = function () {
        var extraEvents = [];
        var selectFirst = true;
        return {
          extraEvents: extraEvents,
          selectFirst: selectFirst
        };
      }();
      return {
        smartTabHeight: smartTabHeight,
        naiveTabHeight: naiveTabHeight
      };
    };

    var SendDataToSectionChannel = 'send-data-to-section';
    var SendDataToViewChannel = 'send-data-to-view';
    var renderTabPanel = function (spec, backstage) {
      var storedValue = Cell({});
      var updateDataWithForm = function (form) {
        var formData = Representing.getValue(form);
        var validData = toValidValues(formData).getOr({});
        var currentData = storedValue.get();
        var newData = deepMerge(currentData, validData);
        storedValue.set(newData);
      };
      var setDataOnForm = function (form) {
        var tabData = storedValue.get();
        Representing.setValue(form, tabData);
      };
      var oldTab = Cell(null);
      var allTabs = map(spec.tabs, function (tab) {
        return {
          value: tab.name,
          dom: {
            tag: 'div',
            classes: ['tox-dialog__body-nav-item'],
            innerHtml: backstage.shared.providers.translate(tab.title)
          },
          view: function () {
            return [Form.sketch(function (parts) {
                return {
                  dom: {
                    tag: 'div',
                    classes: ['tox-form']
                  },
                  components: map(tab.items, function (item) {
                    return interpretInForm(parts, item, backstage);
                  }),
                  formBehaviours: derive$1([
                    Keying.config({
                      mode: 'acyclic',
                      useTabstopAt: not(isPseudoStop)
                    }),
                    config('TabView.form.events', [
                      runOnAttached(setDataOnForm),
                      runOnDetached(updateDataWithForm)
                    ]),
                    Receiving.config({
                      channels: wrapAll$1([
                        {
                          key: SendDataToSectionChannel,
                          value: { onReceive: updateDataWithForm }
                        },
                        {
                          key: SendDataToViewChannel,
                          value: { onReceive: setDataOnForm }
                        }
                      ])
                    })
                  ])
                };
              })];
          }
        };
      });
      var tabMode = setMode(allTabs).smartTabHeight;
      return TabSection.sketch({
        dom: {
          tag: 'div',
          classes: ['tox-dialog__body']
        },
        onChangeTab: function (section, button, _viewItems) {
          var name = Representing.getValue(button);
          emitWith(section, formTabChangeEvent, {
            name: name,
            oldName: oldTab.get()
          });
          oldTab.set(name);
        },
        tabs: allTabs,
        components: [
          TabSection.parts.tabbar({
            dom: {
              tag: 'div',
              classes: ['tox-dialog__body-nav']
            },
            components: [Tabbar.parts.tabs({})],
            markers: {
              tabClass: 'tox-tab',
              selectedClass: 'tox-dialog__body-nav-item--active'
            },
            tabbarBehaviours: derive$1([Tabstopping.config({})])
          }),
          TabSection.parts.tabview({
            dom: {
              tag: 'div',
              classes: ['tox-dialog__body-content']
            }
          })
        ],
        selectFirst: tabMode.selectFirst,
        tabSectionBehaviours: derive$1([
          config('tabpanel', tabMode.extraEvents),
          Keying.config({ mode: 'acyclic' }),
          Composing.config({
            find: function (comp) {
              return head(TabSection.getViewItems(comp));
            }
          }),
          Representing.config({
            store: {
              mode: 'manual',
              getValue: function (tsection) {
                tsection.getSystem().broadcastOn([SendDataToSectionChannel], {});
                return storedValue.get();
              },
              setValue: function (tsection, value) {
                storedValue.set(value);
                tsection.getSystem().broadcastOn([SendDataToViewChannel], {});
              }
            }
          })
        ])
      });
    };

    var dialogChannel = generate$1('update-dialog');
    var titleChannel = generate$1('update-title');
    var bodyChannel = generate$1('update-body');
    var footerChannel = generate$1('update-footer');
    var bodySendMessageChannel = generate$1('body-send-message');

    var renderBody = function (spec, id, backstage, ariaAttrs) {
      var renderComponents = function (incoming) {
        switch (incoming.body.type) {
        case 'tabpanel': {
            return [renderTabPanel(incoming.body, backstage)];
          }
        default: {
            return [renderBodyPanel(incoming.body, backstage)];
          }
        }
      };
      var updateState = function (_comp, incoming) {
        return Optional.some({
          isTabPanel: function () {
            return incoming.body.type === 'tabpanel';
          }
        });
      };
      var ariaAttributes = { 'aria-live': 'polite' };
      return {
        dom: {
          tag: 'div',
          classes: ['tox-dialog__content-js'],
          attributes: __assign(__assign({}, id.map(function (x) {
            return { id: x };
          }).getOr({})), ariaAttrs ? ariaAttributes : {})
        },
        components: [],
        behaviours: derive$1([
          ComposingConfigs.childAt(0),
          Reflecting.config({
            channel: bodyChannel,
            updateState: updateState,
            renderComponents: renderComponents,
            initialData: spec
          })
        ])
      };
    };
    var renderInlineBody = function (spec, contentId, backstage, ariaAttrs) {
      return renderBody(spec, Optional.some(contentId), backstage, ariaAttrs);
    };
    var renderModalBody = function (spec, backstage) {
      var bodySpec = renderBody(spec, Optional.none(), backstage, false);
      return ModalDialog.parts.body(bodySpec);
    };
    var renderIframeBody = function (spec) {
      var bodySpec = {
        dom: {
          tag: 'div',
          classes: ['tox-dialog__content-js']
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-dialog__body-iframe']
            },
            components: [craft({
                dom: {
                  tag: 'iframe',
                  attributes: { src: spec.url }
                },
                behaviours: derive$1([
                  Tabstopping.config({}),
                  Focusing.config({})
                ])
              })]
          }],
        behaviours: derive$1([Keying.config({
            mode: 'acyclic',
            useTabstopAt: not(isPseudoStop)
          })])
      };
      return ModalDialog.parts.body(bodySpec);
    };

    var isTouch = global$8.deviceType.isTouch();
    var hiddenHeader = function (title, close) {
      return {
        dom: {
          tag: 'div',
          styles: { display: 'none' },
          classes: ['tox-dialog__header']
        },
        components: [
          title,
          close
        ]
      };
    };
    var pClose = function (onClose, providersBackstage) {
      return ModalDialog.parts.close(Button.sketch({
        dom: {
          tag: 'button',
          classes: [
            'tox-button',
            'tox-button--icon',
            'tox-button--naked'
          ],
          attributes: {
            'type': 'button',
            'aria-label': providersBackstage.translate('Close')
          }
        },
        action: onClose,
        buttonBehaviours: derive$1([Tabstopping.config({})])
      }));
    };
    var pUntitled = function () {
      return ModalDialog.parts.title({
        dom: {
          tag: 'div',
          classes: ['tox-dialog__title'],
          innerHtml: '',
          styles: { display: 'none' }
        }
      });
    };
    var pBodyMessage = function (message, providersBackstage) {
      return ModalDialog.parts.body({
        dom: {
          tag: 'div',
          classes: ['tox-dialog__body']
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-dialog__body-content']
            },
            components: [{ dom: fromHtml$2('<p>' + providersBackstage.translate(message) + '</p>') }]
          }]
      });
    };
    var pFooter = function (buttons) {
      return ModalDialog.parts.footer({
        dom: {
          tag: 'div',
          classes: ['tox-dialog__footer']
        },
        components: buttons
      });
    };
    var pFooterGroup = function (startButtons, endButtons) {
      return [
        Container.sketch({
          dom: {
            tag: 'div',
            classes: ['tox-dialog__footer-start']
          },
          components: startButtons
        }),
        Container.sketch({
          dom: {
            tag: 'div',
            classes: ['tox-dialog__footer-end']
          },
          components: endButtons
        })
      ];
    };
    var renderDialog = function (spec) {
      var _a;
      var dialogClass = 'tox-dialog';
      var blockerClass = dialogClass + '-wrap';
      var blockerBackdropClass = blockerClass + '__backdrop';
      var scrollLockClass = dialogClass + '__disable-scroll';
      return ModalDialog.sketch({
        lazySink: spec.lazySink,
        onEscape: function (comp) {
          spec.onEscape(comp);
          return Optional.some(true);
        },
        useTabstopAt: function (elem) {
          return !isPseudoStop(elem);
        },
        dom: {
          tag: 'div',
          classes: [dialogClass].concat(spec.extraClasses),
          styles: __assign({ position: 'relative' }, spec.extraStyles)
        },
        components: __spreadArrays([
          spec.header,
          spec.body
        ], spec.footer.toArray()),
        parts: {
          blocker: {
            dom: fromHtml$2('<div class="' + blockerClass + '"></div>'),
            components: [{
                dom: {
                  tag: 'div',
                  classes: isTouch ? [
                    blockerBackdropClass,
                    blockerBackdropClass + '--opaque'
                  ] : [blockerBackdropClass]
                }
              }]
          }
        },
        dragBlockClass: blockerClass,
        modalBehaviours: derive$1(__spreadArrays([
          Focusing.config({}),
          config('dialog-events', spec.dialogEvents.concat([runOnSource(focusin(), function (comp, _se) {
              Keying.focusIn(comp);
            })])),
          config('scroll-lock', [
            runOnAttached(function () {
              add$2(body(), scrollLockClass);
            }),
            runOnDetached(function () {
              remove$4(body(), scrollLockClass);
            })
          ])
        ], spec.extraBehaviours)),
        eventOrder: __assign((_a = {}, _a[execute()] = ['dialog-events'], _a[attachedToDom()] = [
          'scroll-lock',
          'dialog-events',
          'alloy.base.behaviour'
        ], _a[detachedFromDom()] = [
          'alloy.base.behaviour',
          'dialog-events',
          'scroll-lock'
        ], _a), spec.eventOrder)
      });
    };

    var renderClose = function (providersBackstage) {
      return Button.sketch({
        dom: {
          tag: 'button',
          classes: [
            'tox-button',
            'tox-button--icon',
            'tox-button--naked'
          ],
          attributes: {
            'type': 'button',
            'aria-label': providersBackstage.translate('Close'),
            'title': providersBackstage.translate('Close')
          }
        },
        components: [{
            dom: {
              tag: 'div',
              classes: ['tox-icon'],
              innerHtml: get$e('close', providersBackstage.icons)
            }
          }],
        action: function (comp) {
          emit(comp, formCancelEvent);
        }
      });
    };
    var renderTitle = function (spec, id, providersBackstage) {
      var renderComponents = function (data) {
        return [text(providersBackstage.translate(data.title))];
      };
      return {
        dom: {
          tag: 'div',
          classes: ['tox-dialog__title'],
          attributes: __assign({}, id.map(function (x) {
            return { id: x };
          }).getOr({}))
        },
        components: renderComponents(spec),
        behaviours: derive$1([Reflecting.config({
            channel: titleChannel,
            renderComponents: renderComponents
          })])
      };
    };
    var renderDragHandle = function () {
      return { dom: fromHtml$2('<div class="tox-dialog__draghandle"></div>') };
    };
    var renderInlineHeader = function (spec, titleId, providersBackstage) {
      return Container.sketch({
        dom: fromHtml$2('<div class="tox-dialog__header"></div>'),
        components: [
          renderTitle(spec, Optional.some(titleId), providersBackstage),
          renderDragHandle(),
          renderClose(providersBackstage)
        ],
        containerBehaviours: derive$1([Dragging.config({
            mode: 'mouse',
            blockerClass: 'blocker',
            getTarget: function (handle) {
              return closest$3(handle, '[role="dialog"]').getOrDie();
            },
            snaps: {
              getSnapPoints: function () {
                return [];
              },
              leftAttr: 'data-drag-left',
              topAttr: 'data-drag-top'
            }
          })])
      });
    };
    var renderModalHeader = function (spec, providersBackstage) {
      var pTitle = ModalDialog.parts.title(renderTitle(spec, Optional.none(), providersBackstage));
      var pHandle = ModalDialog.parts.draghandle(renderDragHandle());
      var pClose = ModalDialog.parts.close(renderClose(providersBackstage));
      var components = [pTitle].concat(spec.draggable ? [pHandle] : []).concat([pClose]);
      return Container.sketch({
        dom: fromHtml$2('<div class="tox-dialog__header"></div>'),
        components: components
      });
    };

    var getHeader = function (title, backstage) {
      return renderModalHeader({
        title: backstage.shared.providers.translate(title),
        draggable: backstage.dialog.isDraggableModal()
      }, backstage.shared.providers);
    };
    var getBusySpec = function (message, bs, providers) {
      return {
        dom: {
          tag: 'div',
          classes: ['tox-dialog__busy-spinner'],
          attributes: { 'aria-label': providers.translate(message) },
          styles: {
            left: '0px',
            right: '0px',
            bottom: '0px',
            top: '0px',
            position: 'absolute'
          }
        },
        behaviours: bs,
        components: [{ dom: fromHtml$2('<div class="tox-spinner"><div></div><div></div><div></div></div>') }]
      };
    };
    var getEventExtras = function (lazyDialog, providers, extra) {
      return {
        onClose: function () {
          return extra.closeWindow();
        },
        onBlock: function (blockEvent) {
          ModalDialog.setBusy(lazyDialog(), function (_comp, bs) {
            return getBusySpec(blockEvent.message, bs, providers);
          });
        },
        onUnblock: function () {
          ModalDialog.setIdle(lazyDialog());
        }
      };
    };
    var renderModalDialog = function (spec, initialData, dialogEvents, backstage) {
      var _a;
      var updateState = function (_comp, incoming) {
        return Optional.some(incoming);
      };
      return build$1(renderDialog(__assign(__assign({}, spec), {
        lazySink: backstage.shared.getSink,
        extraBehaviours: __spreadArrays([
          Reflecting.config({
            channel: dialogChannel,
            updateState: updateState,
            initialData: initialData
          }),
          RepresentingConfigs.memory({})
        ], spec.extraBehaviours),
        onEscape: function (comp) {
          emit(comp, formCancelEvent);
        },
        dialogEvents: dialogEvents,
        eventOrder: (_a = {}, _a[receive()] = [
          Reflecting.name(),
          Receiving.name()
        ], _a[attachedToDom()] = [
          'scroll-lock',
          Reflecting.name(),
          'messages',
          'dialog-events',
          'alloy.base.behaviour'
        ], _a[detachedFromDom()] = [
          'alloy.base.behaviour',
          'dialog-events',
          'messages',
          Reflecting.name(),
          'scroll-lock'
        ], _a)
      })));
    };
    var mapMenuButtons = function (buttons) {
      var mapItems = function (button) {
        var items = map(button.items, function (item) {
          var cell = Cell(false);
          return __assign(__assign({}, item), { storage: cell });
        });
        return __assign(__assign({}, button), { items: items });
      };
      return map(buttons, function (button) {
        if (button.type === 'menu') {
          return mapItems(button);
        }
        return button;
      });
    };
    var extractCellsToObject = function (buttons) {
      return foldl(buttons, function (acc, button) {
        if (button.type === 'menu') {
          var menuButton = button;
          return foldl(menuButton.items, function (innerAcc, item) {
            innerAcc[item.name] = item.storage;
            return innerAcc;
          }, acc);
        }
        return acc;
      }, {});
    };

    var initCommonEvents = function (fireApiEvent, extras) {
      return [
        runWithTarget(focusin(), onFocus$1),
        fireApiEvent(formCloseEvent, function (_api, spec) {
          extras.onClose();
          spec.onClose();
        }),
        fireApiEvent(formCancelEvent, function (api, spec, _event, self) {
          spec.onCancel(api);
          emit(self, formCloseEvent);
        }),
        run(formUnblockEvent, function (_c, _se) {
          return extras.onUnblock();
        }),
        run(formBlockEvent, function (_c, se) {
          return extras.onBlock(se.event);
        })
      ];
    };
    var initUrlDialog = function (getInstanceApi, extras) {
      var fireApiEvent = function (eventName, f) {
        return run(eventName, function (c, se) {
          withSpec(c, function (spec, _c) {
            f(getInstanceApi(), spec, se.event, c);
          });
        });
      };
      var withSpec = function (c, f) {
        Reflecting.getState(c).get().each(function (currentDialog) {
          f(currentDialog, c);
        });
      };
      return __spreadArrays(initCommonEvents(fireApiEvent, extras), [fireApiEvent(formActionEvent, function (api, spec, event) {
          spec.onAction(api, { name: event.name });
        })]);
    };
    var initDialog = function (getInstanceApi, extras, getSink) {
      var fireApiEvent = function (eventName, f) {
        return run(eventName, function (c, se) {
          withSpec(c, function (spec, _c) {
            f(getInstanceApi(), spec, se.event, c);
          });
        });
      };
      var withSpec = function (c, f) {
        Reflecting.getState(c).get().each(function (currentDialogInit) {
          f(currentDialogInit.internalDialog, c);
        });
      };
      return __spreadArrays(initCommonEvents(fireApiEvent, extras), [
        fireApiEvent(formSubmitEvent, function (api, spec) {
          return spec.onSubmit(api);
        }),
        fireApiEvent(formChangeEvent, function (api, spec, event) {
          spec.onChange(api, { name: event.name });
        }),
        fireApiEvent(formActionEvent, function (api, spec, event, component) {
          var focusIn = function () {
            return Keying.focusIn(component);
          };
          var isDisabled = function (focused) {
            return has$1(focused, 'disabled') || getOpt(focused, 'aria-disabled').exists(function (val) {
              return val === 'true';
            });
          };
          var rootNode = getRootNode(component.element);
          var current = active(rootNode);
          spec.onAction(api, {
            name: event.name,
            value: event.value
          });
          active(rootNode).fold(focusIn, function (focused) {
            if (isDisabled(focused)) {
              focusIn();
            } else if (current.exists(function (cur) {
                return contains$2(focused, cur) && isDisabled(cur);
              })) {
              focusIn();
            } else {
              getSink().toOptional().filter(function (sink) {
                return !contains$2(sink.element, focused);
              }).each(focusIn);
            }
          });
        }),
        fireApiEvent(formTabChangeEvent, function (api, spec, event) {
          spec.onTabChange(api, {
            newTabName: event.name,
            oldTabName: event.oldName
          });
        }),
        runOnDetached(function (component) {
          var api = getInstanceApi();
          Representing.setValue(component, api.getData());
        })
      ]);
    };
    var SilverDialogEvents = {
      initUrlDialog: initUrlDialog,
      initDialog: initDialog
    };

    var makeButton = function (button, backstage) {
      return renderFooterButton(button, button.type, backstage);
    };
    var lookup$2 = function (compInSystem, footerButtons, buttonName) {
      return find(footerButtons, function (button) {
        return button.name === buttonName;
      }).bind(function (memButton) {
        return memButton.memento.getOpt(compInSystem);
      });
    };
    var renderComponents = function (_data, state) {
      var footerButtons = state.map(function (s) {
        return s.footerButtons;
      }).getOr([]);
      var buttonGroups = partition(footerButtons, function (button) {
        return button.align === 'start';
      });
      var makeGroup = function (edge, buttons) {
        return Container.sketch({
          dom: {
            tag: 'div',
            classes: ['tox-dialog__footer-' + edge]
          },
          components: map(buttons, function (button) {
            return button.memento.asSpec();
          })
        });
      };
      var startButtons = makeGroup('start', buttonGroups.pass);
      var endButtons = makeGroup('end', buttonGroups.fail);
      return [
        startButtons,
        endButtons
      ];
    };
    var renderFooter = function (initSpec, backstage) {
      var updateState = function (_comp, data) {
        var footerButtons = map(data.buttons, function (button) {
          var memButton = record(makeButton(button, backstage));
          return {
            name: button.name,
            align: button.align,
            memento: memButton
          };
        });
        var lookupByName = function (compInSystem, buttonName) {
          return lookup$2(compInSystem, footerButtons, buttonName);
        };
        return Optional.some({
          lookupByName: lookupByName,
          footerButtons: footerButtons
        });
      };
      return {
        dom: fromHtml$2('<div class="tox-dialog__footer"></div>'),
        components: [],
        behaviours: derive$1([Reflecting.config({
            channel: footerChannel,
            initialData: initSpec,
            updateState: updateState,
            renderComponents: renderComponents
          })])
      };
    };
    var renderInlineFooter = function (initSpec, backstage) {
      return renderFooter(initSpec, backstage);
    };
    var renderModalFooter = function (initSpec, backstage) {
      return ModalDialog.parts.footer(renderFooter(initSpec, backstage));
    };

    var getCompByName = function (access, name) {
      var root = access.getRoot();
      if (root.getSystem().isConnected()) {
        var form_1 = Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper());
        return Form.getField(form_1, name).fold(function () {
          var footer = access.getFooter();
          var footerState = Reflecting.getState(footer);
          return footerState.get().bind(function (f) {
            return f.lookupByName(form_1, name);
          });
        }, function (comp) {
          return Optional.some(comp);
        });
      } else {
        return Optional.none();
      }
    };
    var validateData = function (access, data) {
      var root = access.getRoot();
      return Reflecting.getState(root).get().map(function (dialogState) {
        return getOrDie(asRaw('data', dialogState.dataValidator, data));
      }).getOr(data);
    };
    var getDialogApi = function (access, doRedial, menuItemStates) {
      var withRoot = function (f) {
        var root = access.getRoot();
        if (root.getSystem().isConnected()) {
          f(root);
        }
      };
      var getData = function () {
        var root = access.getRoot();
        var valueComp = root.getSystem().isConnected() ? access.getFormWrapper() : root;
        var representedValues = Representing.getValue(valueComp);
        var menuItemCurrentState = map$2(menuItemStates, function (cell) {
          return cell.get();
        });
        return __assign(__assign({}, representedValues), menuItemCurrentState);
      };
      var setData = function (newData) {
        withRoot(function (_) {
          var prevData = instanceApi.getData();
          var mergedData = __assign(__assign({}, prevData), newData);
          var newInternalData = validateData(access, mergedData);
          var form = access.getFormWrapper();
          Representing.setValue(form, newInternalData);
          each$1(menuItemStates, function (v, k) {
            if (has(mergedData, k)) {
              v.set(mergedData[k]);
            }
          });
        });
      };
      var disable = function (name) {
        getCompByName(access, name).each(Disabling.disable);
      };
      var enable = function (name) {
        getCompByName(access, name).each(Disabling.enable);
      };
      var focus = function (name) {
        getCompByName(access, name).each(Focusing.focus);
      };
      var block = function (message) {
        if (!isString(message)) {
          throw new Error('The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument');
        }
        withRoot(function (root) {
          emitWith(root, formBlockEvent, { message: message });
        });
      };
      var unblock = function () {
        withRoot(function (root) {
          emit(root, formUnblockEvent);
        });
      };
      var showTab = function (name) {
        withRoot(function (_) {
          var body = access.getBody();
          var bodyState = Reflecting.getState(body);
          if (bodyState.get().exists(function (b) {
              return b.isTabPanel();
            })) {
            Composing.getCurrent(body).each(function (tabSection) {
              TabSection.showTab(tabSection, name);
            });
          }
        });
      };
      var redial = function (d) {
        withRoot(function (root) {
          var dialogInit = doRedial(d);
          root.getSystem().broadcastOn([dialogChannel], dialogInit);
          root.getSystem().broadcastOn([titleChannel], dialogInit.internalDialog);
          root.getSystem().broadcastOn([bodyChannel], dialogInit.internalDialog);
          root.getSystem().broadcastOn([footerChannel], dialogInit.internalDialog);
          instanceApi.setData(dialogInit.initialData);
        });
      };
      var close = function () {
        withRoot(function (root) {
          emit(root, formCloseEvent);
        });
      };
      var instanceApi = {
        getData: getData,
        setData: setData,
        disable: disable,
        enable: enable,
        focus: focus,
        block: block,
        unblock: unblock,
        showTab: showTab,
        redial: redial,
        close: close
      };
      return instanceApi;
    };

    var getDialogSizeClasses = function (size) {
      switch (size) {
      case 'large':
        return ['tox-dialog--width-lg'];
      case 'medium':
        return ['tox-dialog--width-md'];
      default:
        return [];
      }
    };
    var renderDialog$1 = function (dialogInit, extra, backstage) {
      var header = getHeader(dialogInit.internalDialog.title, backstage);
      var body = renderModalBody({ body: dialogInit.internalDialog.body }, backstage);
      var storagedMenuButtons = mapMenuButtons(dialogInit.internalDialog.buttons);
      var objOfCells = extractCellsToObject(storagedMenuButtons);
      var footer = renderModalFooter({ buttons: storagedMenuButtons }, backstage);
      var dialogEvents = SilverDialogEvents.initDialog(function () {
        return instanceApi;
      }, getEventExtras(function () {
        return dialog;
      }, backstage.shared.providers, extra), backstage.shared.getSink);
      var dialogSize = getDialogSizeClasses(dialogInit.internalDialog.size);
      var spec = {
        header: header,
        body: body,
        footer: Optional.some(footer),
        extraClasses: dialogSize,
        extraBehaviours: [],
        extraStyles: {}
      };
      var dialog = renderModalDialog(spec, dialogInit, dialogEvents, backstage);
      var modalAccess = function () {
        var getForm = function () {
          var outerForm = ModalDialog.getBody(dialog);
          return Composing.getCurrent(outerForm).getOr(outerForm);
        };
        return {
          getRoot: function () {
            return dialog;
          },
          getBody: function () {
            return ModalDialog.getBody(dialog);
          },
          getFooter: function () {
            return ModalDialog.getFooter(dialog);
          },
          getFormWrapper: getForm
        };
      }();
      var instanceApi = getDialogApi(modalAccess, extra.redial, objOfCells);
      return {
        dialog: dialog,
        instanceApi: instanceApi
      };
    };

    var renderInlineDialog = function (dialogInit, extra, backstage, ariaAttrs) {
      var _a, _b;
      var dialogLabelId = generate$1('dialog-label');
      var dialogContentId = generate$1('dialog-content');
      var updateState = function (_comp, incoming) {
        return Optional.some(incoming);
      };
      var memHeader = record(renderInlineHeader({
        title: dialogInit.internalDialog.title,
        draggable: true
      }, dialogLabelId, backstage.shared.providers));
      var memBody = record(renderInlineBody({ body: dialogInit.internalDialog.body }, dialogContentId, backstage, ariaAttrs));
      var storagedMenuButtons = mapMenuButtons(dialogInit.internalDialog.buttons);
      var objOfCells = extractCellsToObject(storagedMenuButtons);
      var memFooter = record(renderInlineFooter({ buttons: storagedMenuButtons }, backstage));
      var dialogEvents = SilverDialogEvents.initDialog(function () {
        return instanceApi;
      }, {
        onBlock: function (event) {
          Blocking.block(dialog, function (_comp, bs) {
            return getBusySpec(event.message, bs, backstage.shared.providers);
          });
        },
        onUnblock: function () {
          Blocking.unblock(dialog);
        },
        onClose: function () {
          return extra.closeWindow();
        }
      }, backstage.shared.getSink);
      var dialog = build$1({
        dom: {
          tag: 'div',
          classes: [
            'tox-dialog',
            'tox-dialog-inline'
          ],
          attributes: (_a = { role: 'dialog' }, _a['aria-labelledby'] = dialogLabelId, _a['aria-describedby'] = '' + dialogContentId, _a)
        },
        eventOrder: (_b = {}, _b[receive()] = [
          Reflecting.name(),
          Receiving.name()
        ], _b[execute()] = ['execute-on-form'], _b[attachedToDom()] = [
          'reflecting',
          'execute-on-form'
        ], _b),
        behaviours: derive$1([
          Keying.config({
            mode: 'cyclic',
            onEscape: function (c) {
              emit(c, formCloseEvent);
              return Optional.some(true);
            },
            useTabstopAt: function (elem) {
              return !isPseudoStop(elem) && (name(elem) !== 'button' || get$3(elem, 'disabled') !== 'disabled');
            }
          }),
          Reflecting.config({
            channel: dialogChannel,
            updateState: updateState,
            initialData: dialogInit
          }),
          Focusing.config({}),
          config('execute-on-form', dialogEvents.concat([runOnSource(focusin(), function (comp, _se) {
              Keying.focusIn(comp);
            })])),
          Blocking.config({
            getRoot: function () {
              return Optional.some(dialog);
            }
          }),
          Replacing.config({}),
          RepresentingConfigs.memory({})
        ]),
        components: [
          memHeader.asSpec(),
          memBody.asSpec(),
          memFooter.asSpec()
        ]
      });
      var instanceApi = getDialogApi({
        getRoot: function () {
          return dialog;
        },
        getFooter: function () {
          return memFooter.get(dialog);
        },
        getBody: function () {
          return memBody.get(dialog);
        },
        getFormWrapper: function () {
          var body = memBody.get(dialog);
          return Composing.getCurrent(body).getOr(body);
        }
      }, extra.redial, objOfCells);
      return {
        dialog: dialog,
        instanceApi: instanceApi
      };
    };

    var global$h = tinymce.util.Tools.resolve('tinymce.util.URI');

    var getUrlDialogApi = function (root) {
      var withRoot = function (f) {
        if (root.getSystem().isConnected()) {
          f(root);
        }
      };
      var block = function (message) {
        if (!isString(message)) {
          throw new Error('The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument');
        }
        withRoot(function (root) {
          emitWith(root, formBlockEvent, { message: message });
        });
      };
      var unblock = function () {
        withRoot(function (root) {
          emit(root, formUnblockEvent);
        });
      };
      var close = function () {
        withRoot(function (root) {
          emit(root, formCloseEvent);
        });
      };
      var sendMessage = function (data) {
        withRoot(function (root) {
          root.getSystem().broadcastOn([bodySendMessageChannel], data);
        });
      };
      return {
        block: block,
        unblock: unblock,
        close: close,
        sendMessage: sendMessage
      };
    };

    var SUPPORTED_MESSAGE_ACTIONS = [
      'insertContent',
      'setContent',
      'execCommand',
      'close',
      'block',
      'unblock'
    ];
    var isSupportedMessage = function (data) {
      return isObject(data) && SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction) !== -1;
    };
    var isCustomMessage = function (data) {
      return !isSupportedMessage(data) && isObject(data) && has(data, 'mceAction');
    };
    var handleMessage = function (editor, api, data) {
      switch (data.mceAction) {
      case 'insertContent':
        editor.insertContent(data.content);
        break;
      case 'setContent':
        editor.setContent(data.content);
        break;
      case 'execCommand':
        var ui = isBoolean(data.ui) ? data.ui : false;
        editor.execCommand(data.cmd, ui, data.value);
        break;
      case 'close':
        api.close();
        break;
      case 'block':
        api.block(data.message);
        break;
      case 'unblock':
        api.unblock();
        break;
      }
    };
    var renderUrlDialog = function (internalDialog, extra, editor, backstage) {
      var _a;
      var header = getHeader(internalDialog.title, backstage);
      var body = renderIframeBody(internalDialog);
      var footer = internalDialog.buttons.bind(function (buttons) {
        if (buttons.length === 0) {
          return Optional.none();
        } else {
          return Optional.some(renderModalFooter({ buttons: buttons }, backstage));
        }
      });
      var dialogEvents = SilverDialogEvents.initUrlDialog(function () {
        return instanceApi;
      }, getEventExtras(function () {
        return dialog;
      }, backstage.shared.providers, extra));
      var styles = __assign(__assign({}, internalDialog.height.fold(function () {
        return {};
      }, function (height) {
        return {
          'height': height + 'px',
          'max-height': height + 'px'
        };
      })), internalDialog.width.fold(function () {
        return {};
      }, function (width) {
        return {
          'width': width + 'px',
          'max-width': width + 'px'
        };
      }));
      var classes = internalDialog.width.isNone() && internalDialog.height.isNone() ? ['tox-dialog--width-lg'] : [];
      var iframeUri = new global$h(internalDialog.url, { base_uri: new global$h(window.location.href) });
      var iframeDomain = iframeUri.protocol + '://' + iframeUri.host + (iframeUri.port ? ':' + iframeUri.port : '');
      var messageHandlerUnbinder = Cell(Optional.none());
      var extraBehaviours = [
        config('messages', [
          runOnAttached(function () {
            var unbind = bind$3(SugarElement.fromDom(window), 'message', function (e) {
              if (iframeUri.isSameOrigin(new global$h(e.raw.origin))) {
                var data = e.raw.data;
                if (isSupportedMessage(data)) {
                  handleMessage(editor, instanceApi, data);
                } else if (isCustomMessage(data)) {
                  internalDialog.onMessage(instanceApi, data);
                }
              }
            });
            messageHandlerUnbinder.set(Optional.some(unbind));
          }),
          runOnDetached(function () {
            messageHandlerUnbinder.get().each(function (unbinder) {
              return unbinder.unbind();
            });
          })
        ]),
        Receiving.config({
          channels: (_a = {}, _a[bodySendMessageChannel] = {
            onReceive: function (comp, data) {
              descendant$1(comp.element, 'iframe').each(function (iframeEle) {
                var iframeWin = iframeEle.dom.contentWindow;
                iframeWin.postMessage(data, iframeDomain);
              });
            }
          }, _a)
        })
      ];
      var spec = {
        header: header,
        body: body,
        footer: footer,
        extraClasses: classes,
        extraBehaviours: extraBehaviours,
        extraStyles: styles
      };
      var dialog = renderModalDialog(spec, internalDialog, dialogEvents, backstage);
      var instanceApi = getUrlDialogApi(dialog);
      return {
        dialog: dialog,
        instanceApi: instanceApi
      };
    };

    var setup$c = function (extras) {
      var sharedBackstage = extras.backstage.shared;
      var open = function (message, callback) {
        var closeDialog = function () {
          ModalDialog.hide(alertDialog);
          callback();
        };
        var memFooterClose = record(renderFooterButton({
          name: 'close-alert',
          text: 'OK',
          primary: true,
          align: 'end',
          disabled: false,
          icon: Optional.none()
        }, 'cancel', extras.backstage));
        var titleSpec = pUntitled();
        var closeSpec = pClose(closeDialog, sharedBackstage.providers);
        var alertDialog = build$1(renderDialog({
          lazySink: function () {
            return sharedBackstage.getSink();
          },
          header: hiddenHeader(titleSpec, closeSpec),
          body: pBodyMessage(message, sharedBackstage.providers),
          footer: Optional.some(pFooter(pFooterGroup([], [memFooterClose.asSpec()]))),
          onEscape: closeDialog,
          extraClasses: ['tox-alert-dialog'],
          extraBehaviours: [],
          extraStyles: {},
          dialogEvents: [run(formCancelEvent, closeDialog)],
          eventOrder: {}
        }));
        ModalDialog.show(alertDialog);
        var footerCloseButton = memFooterClose.get(alertDialog);
        Focusing.focus(footerCloseButton);
      };
      return { open: open };
    };

    var setup$d = function (extras) {
      var sharedBackstage = extras.backstage.shared;
      var open = function (message, callback) {
        var closeDialog = function (state) {
          ModalDialog.hide(confirmDialog);
          callback(state);
        };
        var memFooterYes = record(renderFooterButton({
          name: 'yes',
          text: 'Yes',
          primary: true,
          align: 'end',
          disabled: false,
          icon: Optional.none()
        }, 'submit', extras.backstage));
        var footerNo = renderFooterButton({
          name: 'no',
          text: 'No',
          primary: false,
          align: 'end',
          disabled: false,
          icon: Optional.none()
        }, 'cancel', extras.backstage);
        var titleSpec = pUntitled();
        var closeSpec = pClose(function () {
          return closeDialog(false);
        }, sharedBackstage.providers);
        var confirmDialog = build$1(renderDialog({
          lazySink: function () {
            return sharedBackstage.getSink();
          },
          header: hiddenHeader(titleSpec, closeSpec),
          body: pBodyMessage(message, sharedBackstage.providers),
          footer: Optional.some(pFooter(pFooterGroup([], [
            footerNo,
            memFooterYes.asSpec()
          ]))),
          onEscape: function () {
            return closeDialog(false);
          },
          extraClasses: ['tox-confirm-dialog'],
          extraBehaviours: [],
          extraStyles: {},
          dialogEvents: [
            run(formCancelEvent, function () {
              return closeDialog(false);
            }),
            run(formSubmitEvent, function () {
              return closeDialog(true);
            })
          ],
          eventOrder: {}
        }));
        ModalDialog.show(confirmDialog);
        var footerYesButton = memFooterYes.get(confirmDialog);
        Focusing.focus(footerYesButton);
      };
      return { open: open };
    };

    var validateData$1 = function (data, validator) {
      return getOrDie(asRaw('data', validator, data));
    };
    var isAlertOrConfirmDialog = function (target) {
      return closest$4(target, '.tox-alert-dialog') || closest$4(target, '.tox-confirm-dialog');
    };
    var inlineAdditionalBehaviours = function (editor, isStickyToolbar, isToolbarLocationTop) {
      if (isStickyToolbar && isToolbarLocationTop) {
        return [];
      } else {
        return [Docking.config({
            contextual: {
              lazyContext: function () {
                return Optional.some(box(SugarElement.fromDom(editor.getContentAreaContainer())));
              },
              fadeInClass: 'tox-dialog-dock-fadein',
              fadeOutClass: 'tox-dialog-dock-fadeout',
              transitionClass: 'tox-dialog-dock-transition'
            },
            modes: ['top']
          })];
      }
    };
    var setup$e = function (extras) {
      var backstage = extras.backstage;
      var editor = extras.editor;
      var isStickyToolbar$1 = isStickyToolbar(editor);
      var alertDialog = setup$c(extras);
      var confirmDialog = setup$d(extras);
      var open = function (config, params, closeWindow) {
        if (params !== undefined && params.inline === 'toolbar') {
          return openInlineDialog(config, backstage.shared.anchors.inlineDialog(), closeWindow, params.ariaAttrs);
        } else if (params !== undefined && params.inline === 'cursor') {
          return openInlineDialog(config, backstage.shared.anchors.cursor(), closeWindow, params.ariaAttrs);
        } else {
          return openModalDialog(config, closeWindow);
        }
      };
      var openUrl = function (config, closeWindow) {
        return openModalUrlDialog(config, closeWindow);
      };
      var openModalUrlDialog = function (config, closeWindow) {
        var factory = function (contents) {
          var dialog = renderUrlDialog(contents, {
            closeWindow: function () {
              ModalDialog.hide(dialog.dialog);
              closeWindow(dialog.instanceApi);
            }
          }, editor, backstage);
          ModalDialog.show(dialog.dialog);
          return dialog.instanceApi;
        };
        return DialogManager.openUrl(factory, config);
      };
      var openModalDialog = function (config, closeWindow) {
        var factory = function (contents, internalInitialData, dataValidator) {
          var initialData = internalInitialData;
          var dialogInit = {
            dataValidator: dataValidator,
            initialData: initialData,
            internalDialog: contents
          };
          var dialog = renderDialog$1(dialogInit, {
            redial: DialogManager.redial,
            closeWindow: function () {
              ModalDialog.hide(dialog.dialog);
              closeWindow(dialog.instanceApi);
            }
          }, backstage);
          ModalDialog.show(dialog.dialog);
          dialog.instanceApi.setData(initialData);
          return dialog.instanceApi;
        };
        return DialogManager.open(factory, config);
      };
      var openInlineDialog = function (config$1, anchor, closeWindow, ariaAttrs) {
        var factory = function (contents, internalInitialData, dataValidator) {
          var initialData = validateData$1(internalInitialData, dataValidator);
          var inlineDialog = value$3();
          var isToolbarLocationTop = backstage.shared.header.isPositionedAtTop();
          var dialogInit = {
            dataValidator: dataValidator,
            initialData: initialData,
            internalDialog: contents
          };
          var refreshDocking = function () {
            return inlineDialog.on(function (dialog) {
              InlineView.reposition(dialog);
              Docking.refresh(dialog);
            });
          };
          var dialogUi = renderInlineDialog(dialogInit, {
            redial: DialogManager.redial,
            closeWindow: function () {
              inlineDialog.on(InlineView.hide);
              editor.off('ResizeEditor', refreshDocking);
              inlineDialog.clear();
              closeWindow(dialogUi.instanceApi);
            }
          }, backstage, ariaAttrs);
          var inlineDialogComp = build$1(InlineView.sketch(__assign(__assign({
            lazySink: backstage.shared.getSink,
            dom: {
              tag: 'div',
              classes: []
            },
            fireDismissalEventInstead: {}
          }, isToolbarLocationTop ? {} : { fireRepositionEventInstead: {} }), {
            inlineBehaviours: derive$1(__spreadArrays([config('window-manager-inline-events', [run(dismissRequested(), function (_comp, _se) {
                  emit(dialogUi.dialog, formCancelEvent);
                })])], inlineAdditionalBehaviours(editor, isStickyToolbar$1, isToolbarLocationTop))),
            isExtraPart: function (_comp, target) {
              return isAlertOrConfirmDialog(target);
            }
          })));
          inlineDialog.set(inlineDialogComp);
          InlineView.showWithin(inlineDialogComp, anchor, premade$1(dialogUi.dialog), Optional.some(body()));
          if (!isStickyToolbar$1 || !isToolbarLocationTop) {
            Docking.refresh(inlineDialogComp);
            editor.on('ResizeEditor', refreshDocking);
          }
          dialogUi.instanceApi.setData(initialData);
          Keying.focusIn(dialogUi.dialog);
          return dialogUi.instanceApi;
        };
        return DialogManager.open(factory, config$1);
      };
      var confirm = function (message, callback) {
        confirmDialog.open(message, function (state) {
          callback(state);
        });
      };
      var alert = function (message, callback) {
        alertDialog.open(message, function () {
          callback();
        });
      };
      var close = function (instanceApi) {
        instanceApi.close();
      };
      return {
        open: open,
        openUrl: openUrl,
        alert: alert,
        close: close,
        confirm: confirm
      };
    };

    function Theme () {
      global$1.add('silver', function (editor) {
        var _a = setup$b(editor), uiMothership = _a.uiMothership, backstage = _a.backstage, renderUI = _a.renderUI, getUi = _a.getUi;
        Autocompleter.register(editor, backstage.shared);
        var windowMgr = setup$e({
          editor: editor,
          backstage: backstage
        });
        return {
          renderUI: renderUI,
          getWindowManagerImpl: constant(windowMgr),
          getNotificationManagerImpl: function () {
            return NotificationManagerImpl(editor, { backstage: backstage }, uiMothership);
          },
          ui: getUi()
        };
      });
    }

    Theme();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV90aGVtZXNfc2lsdmVyX2luZGV4X2pzLmNodW5rLmpzIiwic291cmNlcyI6WyIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvdGhlbWVzL3NpbHZlci9pbmRleC5qcyIsIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS90aGVtZXMvc2lsdmVyL3RoZW1lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEV4cG9ydHMgdGhlIFwic2lsdmVyXCIgdGhlbWUgZm9yIHVzYWdlIHdpdGggbW9kdWxlIGxvYWRlcnNcbi8vIFVzYWdlOlxuLy8gICBDb21tb25KUzpcbi8vICAgICByZXF1aXJlKCd0aW55bWNlL3RoZW1lcy9zaWx2ZXInKVxuLy8gICBFUzIwMTU6XG4vLyAgICAgaW1wb3J0ICd0aW55bWNlL3RoZW1lcy9zaWx2ZXInXG5yZXF1aXJlKCcuL3RoZW1lLmpzJyk7IiwiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIFRpbnkgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTEdQTCBvciBhIGNvbW1lcmNpYWwgbGljZW5zZS5cbiAqIEZvciBMR1BMIHNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICogRm9yIGNvbW1lcmNpYWwgbGljZW5zZXMgc2VlIGh0dHBzOi8vd3d3LnRpbnkuY2xvdWQvXG4gKlxuICogVmVyc2lvbjogNS44LjEgKDIwMjEtMDUtMjApXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHR5cGVPZiA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgdCA9IHR5cGVvZiB4O1xuICAgICAgaWYgKHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICdudWxsJztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKEFycmF5LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHgpIHx8IHguY29uc3RydWN0b3IgJiYgeC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQXJyYXknKSkge1xuICAgICAgICByZXR1cm4gJ2FycmF5JztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKFN0cmluZy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZih4KSB8fCB4LmNvbnN0cnVjdG9yICYmIHguY29uc3RydWN0b3IubmFtZSA9PT0gJ1N0cmluZycpKSB7XG4gICAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlT2YodmFsdWUpID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1NpbXBsZVR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBlcSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuIHQgPT09IGE7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzU3RyaW5nID0gaXNUeXBlKCdzdHJpbmcnKTtcbiAgICB2YXIgaXNPYmplY3QgPSBpc1R5cGUoJ29iamVjdCcpO1xuICAgIHZhciBpc0FycmF5ID0gaXNUeXBlKCdhcnJheScpO1xuICAgIHZhciBpc0Jvb2xlYW4gPSBpc1NpbXBsZVR5cGUoJ2Jvb2xlYW4nKTtcbiAgICB2YXIgaXNVbmRlZmluZWQgPSBlcSh1bmRlZmluZWQpO1xuICAgIHZhciBpc051bGxhYmxlID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIHJldHVybiBhID09PSBudWxsIHx8IGEgPT09IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHZhciBpc05vbk51bGxhYmxlID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIHJldHVybiAhaXNOdWxsYWJsZShhKTtcbiAgICB9O1xuICAgIHZhciBpc0Z1bmN0aW9uID0gaXNTaW1wbGVUeXBlKCdmdW5jdGlvbicpO1xuICAgIHZhciBpc051bWJlciA9IGlzU2ltcGxlVHlwZSgnbnVtYmVyJyk7XG4gICAgdmFyIGlzQXJyYXlPZiA9IGZ1bmN0aW9uICh2YWx1ZSwgcHJlZCkge1xuICAgICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAgIGlmICghcHJlZCh2YWx1ZVtpXSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIHZhciBub29wID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgdmFyIG5vYXJnID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmKCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNvbXBvc2UgPSBmdW5jdGlvbiAoZmEsIGZiKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmEoZmIuYXBwbHkobnVsbCwgYXJncykpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjb21wb3NlMSA9IGZ1bmN0aW9uIChmYmMsIGZhYikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHJldHVybiBmYmMoZmFiKGEpKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29uc3RhbnQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaWRlbnRpdHkgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIHg7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBjdXJyeShmbikge1xuICAgICAgdmFyIGluaXRpYWxBcmdzID0gW107XG4gICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBpbml0aWFsQXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXN0QXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIHJlc3RBcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFsbCA9IGluaXRpYWxBcmdzLmNvbmNhdChyZXN0QXJncyk7XG4gICAgICAgIHJldHVybiBmbi5hcHBseShudWxsLCBhbGwpO1xuICAgICAgfTtcbiAgICB9XG4gICAgdmFyIG5vdCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuICFmKHQpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkaWUgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbmV2ZXIgPSBjb25zdGFudChmYWxzZSk7XG4gICAgdmFyIGFsd2F5cyA9IGNvbnN0YW50KHRydWUpO1xuXG4gICAgdmFyIGdsb2JhbCQxID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuVGhlbWVNYW5hZ2VyJyk7XG5cbiAgICB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xuICAgICAgICAgIGZvciAodmFyIHAgaW4gcylcbiAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXG4gICAgICAgICAgICAgIHRbcF0gPSBzW3BdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfTtcbiAgICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG4gICAgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcbiAgICAgIHZhciB0ID0ge307XG4gICAgICBmb3IgKHZhciBwIGluIHMpXG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcbiAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICdmdW5jdGlvbicpXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXG4gICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcbiAgICAgICAgfVxuICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXlzKCkge1xuICAgICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKVxuICAgICAgICBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfVxuXG4gICAgdmFyIG5vbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gTk9ORTtcbiAgICB9O1xuICAgIHZhciBOT05FID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVxID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIG8uaXNOb25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAodGh1bmspIHtcbiAgICAgICAgcmV0dXJuIHRodW5rKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGlkID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBmb2xkOiBmdW5jdGlvbiAobiwgX3MpIHtcbiAgICAgICAgICByZXR1cm4gbigpO1xuICAgICAgICB9LFxuICAgICAgICBpczogbmV2ZXIsXG4gICAgICAgIGlzU29tZTogbmV2ZXIsXG4gICAgICAgIGlzTm9uZTogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWQsXG4gICAgICAgIGdldE9yVGh1bms6IGNhbGwsXG4gICAgICAgIGdldE9yRGllOiBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyB8fCAnZXJyb3I6IGdldE9yRGllIGNhbGxlZCBvbiBub25lLicpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50KG51bGwpLFxuICAgICAgICBnZXRPclVuZGVmaW5lZDogY29uc3RhbnQodW5kZWZpbmVkKSxcbiAgICAgICAgb3I6IGlkLFxuICAgICAgICBvclRodW5rOiBjYWxsLFxuICAgICAgICBtYXA6IG5vbmUsXG4gICAgICAgIGVhY2g6IG5vb3AsXG4gICAgICAgIGJpbmQ6IG5vbmUsXG4gICAgICAgIGV4aXN0czogbmV2ZXIsXG4gICAgICAgIGZvcmFsbDogYWx3YXlzLFxuICAgICAgICBmaWx0ZXI6IG5vbmUsXG4gICAgICAgIGVxdWFsczogZXEsXG4gICAgICAgIGVxdWFsc186IGVxLFxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogY29uc3RhbnQoJ25vbmUoKScpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH0oKTtcbiAgICB2YXIgc29tZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICB2YXIgY29uc3RhbnRfYSA9IGNvbnN0YW50KGEpO1xuICAgICAgdmFyIHNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtZTtcbiAgICAgIH07XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIHMpIHtcbiAgICAgICAgICByZXR1cm4gcyhhKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IHY7XG4gICAgICAgIH0sXG4gICAgICAgIGlzU29tZTogYWx3YXlzLFxuICAgICAgICBpc05vbmU6IG5ldmVyLFxuICAgICAgICBnZXRPcjogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JEaWU6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yTnVsbDogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50X2EsXG4gICAgICAgIG9yOiBzZWxmLFxuICAgICAgICBvclRodW5rOiBzZWxmLFxuICAgICAgICBtYXA6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIHNvbWUoZihhKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVhY2g6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgZihhKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgZXhpc3RzOiBiaW5kLFxuICAgICAgICBmb3JhbGw6IGJpbmQsXG4gICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gZihhKSA/IG1lIDogTk9ORTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbYV07XG4gICAgICAgIH0sXG4gICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdzb21lKCcgKyBhICsgJyknO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgcmV0dXJuIG8uaXMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVxdWFsc186IGZ1bmN0aW9uIChvLCBlbGVtZW50RXEpIHtcbiAgICAgICAgICByZXR1cm4gby5mb2xkKG5ldmVyLCBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRFcShhLCBiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9O1xuICAgIHZhciBmcm9tID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IE5PTkUgOiBzb21lKHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBPcHRpb25hbCA9IHtcbiAgICAgIHNvbWU6IHNvbWUsXG4gICAgICBub25lOiBub25lLFxuICAgICAgZnJvbTogZnJvbVxuICAgIH07XG5cbiAgICB2YXIgbmF0aXZlU2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG4gICAgdmFyIG5hdGl2ZUluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZjtcbiAgICB2YXIgbmF0aXZlUHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICAgIHZhciByYXdJbmRleE9mID0gZnVuY3Rpb24gKHRzLCB0KSB7XG4gICAgICByZXR1cm4gbmF0aXZlSW5kZXhPZi5jYWxsKHRzLCB0KTtcbiAgICB9O1xuICAgIHZhciBpbmRleE9mID0gZnVuY3Rpb24gKHhzLCB4KSB7XG4gICAgICB2YXIgciA9IHJhd0luZGV4T2YoeHMsIHgpO1xuICAgICAgcmV0dXJuIHIgPT09IC0xID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuc29tZShyKTtcbiAgICB9O1xuICAgIHZhciBjb250YWlucyA9IGZ1bmN0aW9uICh4cywgeCkge1xuICAgICAgcmV0dXJuIHJhd0luZGV4T2YoeHMsIHgpID4gLTE7XG4gICAgfTtcbiAgICB2YXIgZXhpc3RzID0gZnVuY3Rpb24gKHhzLCBwcmVkKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgaWYgKHByZWQoeCwgaSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgdmFyIHJhbmdlID0gZnVuY3Rpb24gKG51bSwgZikge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtOyBpKyspIHtcbiAgICAgICAgci5wdXNoKGYoaSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgY2h1bmsgPSBmdW5jdGlvbiAoYXJyYXksIHNpemUpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSArPSBzaXplKSB7XG4gICAgICAgIHZhciBzID0gbmF0aXZlU2xpY2UuY2FsbChhcnJheSwgaSwgaSArIHNpemUpO1xuICAgICAgICByLnB1c2gocyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBtYXAgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHZhciBsZW4gPSB4cy5sZW5ndGg7XG4gICAgICB2YXIgciA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICByW2ldID0gZih4LCBpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBmKHgsIGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGVhY2hyID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICBmb3IgKHZhciBpID0geHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgZih4LCBpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBwYXJ0aXRpb24gPSBmdW5jdGlvbiAoeHMsIHByZWQpIHtcbiAgICAgIHZhciBwYXNzID0gW107XG4gICAgICB2YXIgZmFpbCA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIHZhciBhcnIgPSBwcmVkKHgsIGkpID8gcGFzcyA6IGZhaWw7XG4gICAgICAgIGFyci5wdXNoKHgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGFzczogcGFzcyxcbiAgICAgICAgZmFpbDogZmFpbFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBmaWx0ZXIgPSBmdW5jdGlvbiAoeHMsIHByZWQpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgaWYgKHByZWQoeCwgaSkpIHtcbiAgICAgICAgICByLnB1c2goeCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGZvbGRyID0gZnVuY3Rpb24gKHhzLCBmLCBhY2MpIHtcbiAgICAgIGVhY2hyKHhzLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBhY2MgPSBmKGFjYywgeCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfTtcbiAgICB2YXIgZm9sZGwgPSBmdW5jdGlvbiAoeHMsIGYsIGFjYykge1xuICAgICAgZWFjaCh4cywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgYWNjID0gZihhY2MsIHgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH07XG4gICAgdmFyIGZpbmRVbnRpbCA9IGZ1bmN0aW9uICh4cywgcHJlZCwgdW50aWwpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBpZiAocHJlZCh4LCBpKSkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHgpO1xuICAgICAgICB9IGVsc2UgaWYgKHVudGlsKHgsIGkpKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgZmluZCA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgcmV0dXJuIGZpbmRVbnRpbCh4cywgcHJlZCwgbmV2ZXIpO1xuICAgIH07XG4gICAgdmFyIGZpbmRJbmRleCA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIGlmIChwcmVkKHgsIGkpKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoaSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICBpZiAoIWlzQXJyYXkoeHNbaV0pKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcnIuZmxhdHRlbiBpdGVtICcgKyBpICsgJyB3YXMgbm90IGFuIGFycmF5LCBpbnB1dDogJyArIHhzKTtcbiAgICAgICAgfVxuICAgICAgICBuYXRpdmVQdXNoLmFwcGx5KHIsIHhzW2ldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHJldHVybiBmbGF0dGVuKG1hcCh4cywgZikpO1xuICAgIH07XG4gICAgdmFyIGZvcmFsbCA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIGlmIChwcmVkKHgsIGkpICE9PSB0cnVlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHZhciByZXZlcnNlID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICB2YXIgciA9IG5hdGl2ZVNsaWNlLmNhbGwoeHMsIDApO1xuICAgICAgci5yZXZlcnNlKCk7XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBkaWZmZXJlbmNlID0gZnVuY3Rpb24gKGExLCBhMikge1xuICAgICAgcmV0dXJuIGZpbHRlcihhMSwgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgcmV0dXJuICFjb250YWlucyhhMiwgeCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBtYXBUb09iamVjdCA9IGZ1bmN0aW9uICh4cywgZikge1xuICAgICAgdmFyIHIgPSB7fTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICByW1N0cmluZyh4KV0gPSBmKHgsIGkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgc29ydCA9IGZ1bmN0aW9uICh4cywgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGNvcHkgPSBuYXRpdmVTbGljZS5jYWxsKHhzLCAwKTtcbiAgICAgIGNvcHkuc29ydChjb21wYXJhdG9yKTtcbiAgICAgIHJldHVybiBjb3B5O1xuICAgIH07XG4gICAgdmFyIGdldCA9IGZ1bmN0aW9uICh4cywgaSkge1xuICAgICAgcmV0dXJuIGkgPj0gMCAmJiBpIDwgeHMubGVuZ3RoID8gT3B0aW9uYWwuc29tZSh4c1tpXSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgaGVhZCA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgcmV0dXJuIGdldCh4cywgMCk7XG4gICAgfTtcbiAgICB2YXIgbGFzdCA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgcmV0dXJuIGdldCh4cywgeHMubGVuZ3RoIC0gMSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbSQxID0gaXNGdW5jdGlvbihBcnJheS5mcm9tKSA/IEFycmF5LmZyb20gOiBmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIG5hdGl2ZVNsaWNlLmNhbGwoeCk7XG4gICAgfTtcbiAgICB2YXIgZmluZE1hcCA9IGZ1bmN0aW9uIChhcnIsIGYpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByID0gZihhcnJbaV0sIGkpO1xuICAgICAgICBpZiAoci5pc1NvbWUoKSkge1xuICAgICAgICAgIHJldHVybiByO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG5cbiAgICB2YXIgdmFsdWUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGlzID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgcmV0dXJuIG8gPT09IHY7XG4gICAgICB9O1xuICAgICAgdmFyIG9yID0gZnVuY3Rpb24gKF9vcHQpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlKG8pO1xuICAgICAgfTtcbiAgICAgIHZhciBvclRodW5rID0gZnVuY3Rpb24gKF9mKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZShvKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlKGYobykpO1xuICAgICAgfTtcbiAgICAgIHZhciBtYXBFcnJvciA9IGZ1bmN0aW9uIChfZikge1xuICAgICAgICByZXR1cm4gdmFsdWUobyk7XG4gICAgICB9O1xuICAgICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAoZikge1xuICAgICAgICBmKG8pO1xuICAgICAgfTtcbiAgICAgIHZhciBiaW5kID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYobyk7XG4gICAgICB9O1xuICAgICAgdmFyIGZvbGQgPSBmdW5jdGlvbiAoXywgb25WYWx1ZSkge1xuICAgICAgICByZXR1cm4gb25WYWx1ZShvKTtcbiAgICAgIH07XG4gICAgICB2YXIgZXhpc3RzID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYobyk7XG4gICAgICB9O1xuICAgICAgdmFyIGZvcmFsbCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKG8pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b09wdGlvbmFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShvKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpczogaXMsXG4gICAgICAgIGlzVmFsdWU6IGFsd2F5cyxcbiAgICAgICAgaXNFcnJvcjogbmV2ZXIsXG4gICAgICAgIGdldE9yOiBjb25zdGFudChvKSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnQobyksXG4gICAgICAgIGdldE9yRGllOiBjb25zdGFudChvKSxcbiAgICAgICAgb3I6IG9yLFxuICAgICAgICBvclRodW5rOiBvclRodW5rLFxuICAgICAgICBmb2xkOiBmb2xkLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgbWFwRXJyb3I6IG1hcEVycm9yLFxuICAgICAgICBlYWNoOiBlYWNoLFxuICAgICAgICBiaW5kOiBiaW5kLFxuICAgICAgICBleGlzdHM6IGV4aXN0cyxcbiAgICAgICAgZm9yYWxsOiBmb3JhbGwsXG4gICAgICAgIHRvT3B0aW9uYWw6IHRvT3B0aW9uYWxcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgdmFyIGdldE9yVGh1bmsgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZigpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRPckRpZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRpZShTdHJpbmcobWVzc2FnZSkpKCk7XG4gICAgICB9O1xuICAgICAgdmFyIG9yID0gZnVuY3Rpb24gKG9wdCkge1xuICAgICAgICByZXR1cm4gb3B0O1xuICAgICAgfTtcbiAgICAgIHZhciBvclRodW5rID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYoKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwID0gZnVuY3Rpb24gKF9mKSB7XG4gICAgICAgIHJldHVybiBlcnJvcihtZXNzYWdlKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwRXJyb3IgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZXJyb3IoZihtZXNzYWdlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoX2YpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yKG1lc3NhZ2UpO1xuICAgICAgfTtcbiAgICAgIHZhciBmb2xkID0gZnVuY3Rpb24gKG9uRXJyb3IsIF8pIHtcbiAgICAgICAgcmV0dXJuIG9uRXJyb3IobWVzc2FnZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXM6IG5ldmVyLFxuICAgICAgICBpc1ZhbHVlOiBuZXZlcixcbiAgICAgICAgaXNFcnJvcjogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWRlbnRpdHksXG4gICAgICAgIGdldE9yVGh1bms6IGdldE9yVGh1bmssXG4gICAgICAgIGdldE9yRGllOiBnZXRPckRpZSxcbiAgICAgICAgb3I6IG9yLFxuICAgICAgICBvclRodW5rOiBvclRodW5rLFxuICAgICAgICBmb2xkOiBmb2xkLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgbWFwRXJyb3I6IG1hcEVycm9yLFxuICAgICAgICBlYWNoOiBub29wLFxuICAgICAgICBiaW5kOiBiaW5kLFxuICAgICAgICBleGlzdHM6IG5ldmVyLFxuICAgICAgICBmb3JhbGw6IGFsd2F5cyxcbiAgICAgICAgdG9PcHRpb25hbDogT3B0aW9uYWwubm9uZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tT3B0aW9uID0gZnVuY3Rpb24gKG9wdCwgZXJyKSB7XG4gICAgICByZXR1cm4gb3B0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZXJyb3IoZXJyKTtcbiAgICAgIH0sIHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBSZXN1bHQgPSB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlcnJvcjogZXJyb3IsXG4gICAgICBmcm9tT3B0aW9uOiBmcm9tT3B0aW9uXG4gICAgfTtcblxuICAgIHZhciBTaW1wbGVSZXN1bHRUeXBlO1xuICAgIChmdW5jdGlvbiAoU2ltcGxlUmVzdWx0VHlwZSkge1xuICAgICAgU2ltcGxlUmVzdWx0VHlwZVtTaW1wbGVSZXN1bHRUeXBlWydFcnJvciddID0gMF0gPSAnRXJyb3InO1xuICAgICAgU2ltcGxlUmVzdWx0VHlwZVtTaW1wbGVSZXN1bHRUeXBlWydWYWx1ZSddID0gMV0gPSAnVmFsdWUnO1xuICAgIH0oU2ltcGxlUmVzdWx0VHlwZSB8fCAoU2ltcGxlUmVzdWx0VHlwZSA9IHt9KSkpO1xuICAgIHZhciBmb2xkID0gZnVuY3Rpb24gKHJlcywgb25FcnJvciwgb25WYWx1ZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdHlwZSA9PT0gU2ltcGxlUmVzdWx0VHlwZS5FcnJvciA/IG9uRXJyb3IocmVzLnNlcnJvcikgOiBvblZhbHVlKHJlcy5zdmFsdWUpO1xuICAgIH07XG4gICAgdmFyIHBhcnRpdGlvbiQxID0gZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgIHZhciB2YWx1ZXMgPSBbXTtcbiAgICAgIHZhciBlcnJvcnMgPSBbXTtcbiAgICAgIGVhY2gocmVzdWx0cywgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICBmb2xkKG9iaiwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIHJldHVybiBlcnJvcnMucHVzaChlcnIpO1xuICAgICAgICB9LCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlcy5wdXNoKHZhbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZXM6IHZhbHVlcyxcbiAgICAgICAgZXJyb3JzOiBlcnJvcnNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbWFwRXJyb3IgPSBmdW5jdGlvbiAocmVzLCBmKSB7XG4gICAgICBpZiAocmVzLnN0eXBlID09PSBTaW1wbGVSZXN1bHRUeXBlLkVycm9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3R5cGU6IFNpbXBsZVJlc3VsdFR5cGUuRXJyb3IsXG4gICAgICAgICAgc2Vycm9yOiBmKHJlcy5zZXJyb3IpXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG1hcCQxID0gZnVuY3Rpb24gKHJlcywgZikge1xuICAgICAgaWYgKHJlcy5zdHlwZSA9PT0gU2ltcGxlUmVzdWx0VHlwZS5WYWx1ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0eXBlOiBTaW1wbGVSZXN1bHRUeXBlLlZhbHVlLFxuICAgICAgICAgIHN2YWx1ZTogZihyZXMuc3ZhbHVlKVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBiaW5kJDEgPSBmdW5jdGlvbiAocmVzLCBmKSB7XG4gICAgICBpZiAocmVzLnN0eXBlID09PSBTaW1wbGVSZXN1bHRUeXBlLlZhbHVlKSB7XG4gICAgICAgIHJldHVybiBmKHJlcy5zdmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBiaW5kRXJyb3IgPSBmdW5jdGlvbiAocmVzLCBmKSB7XG4gICAgICBpZiAocmVzLnN0eXBlID09PSBTaW1wbGVSZXN1bHRUeXBlLkVycm9yKSB7XG4gICAgICAgIHJldHVybiBmKHJlcy5zZXJyb3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzdmFsdWUgPSBmdW5jdGlvbiAodikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3R5cGU6IFNpbXBsZVJlc3VsdFR5cGUuVmFsdWUsXG4gICAgICAgIHN2YWx1ZTogdlxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3R5cGU6IFNpbXBsZVJlc3VsdFR5cGUuRXJyb3IsXG4gICAgICAgIHNlcnJvcjogZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0b1Jlc3VsdCA9IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIHJldHVybiBmb2xkKHJlcywgUmVzdWx0LmVycm9yLCBSZXN1bHQudmFsdWUpO1xuICAgIH07XG4gICAgdmFyIGZyb21SZXN1bHQgPSBmdW5jdGlvbiAocmVzKSB7XG4gICAgICByZXR1cm4gcmVzLmZvbGQoc2Vycm9yLCBzdmFsdWUpO1xuICAgIH07XG4gICAgdmFyIFNpbXBsZVJlc3VsdCA9IHtcbiAgICAgIGZyb21SZXN1bHQ6IGZyb21SZXN1bHQsXG4gICAgICB0b1Jlc3VsdDogdG9SZXN1bHQsXG4gICAgICBzdmFsdWU6IHN2YWx1ZSxcbiAgICAgIHBhcnRpdGlvbjogcGFydGl0aW9uJDEsXG4gICAgICBzZXJyb3I6IHNlcnJvcixcbiAgICAgIGJpbmQ6IGJpbmQkMSxcbiAgICAgIGJpbmRFcnJvcjogYmluZEVycm9yLFxuICAgICAgbWFwOiBtYXAkMSxcbiAgICAgIG1hcEVycm9yOiBtYXBFcnJvcixcbiAgICAgIGZvbGQ6IGZvbGRcbiAgICB9O1xuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cztcbiAgICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QuaGFzT3duUHJvcGVydHk7XG4gICAgdmFyIGVhY2gkMSA9IGZ1bmN0aW9uIChvYmosIGYpIHtcbiAgICAgIHZhciBwcm9wcyA9IGtleXMob2JqKTtcbiAgICAgIGZvciAodmFyIGsgPSAwLCBsZW4gPSBwcm9wcy5sZW5ndGg7IGsgPCBsZW47IGsrKykge1xuICAgICAgICB2YXIgaSA9IHByb3BzW2tdO1xuICAgICAgICB2YXIgeCA9IG9ialtpXTtcbiAgICAgICAgZih4LCBpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBtYXAkMiA9IGZ1bmN0aW9uIChvYmosIGYpIHtcbiAgICAgIHJldHVybiB0dXBsZU1hcChvYmosIGZ1bmN0aW9uICh4LCBpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgazogaSxcbiAgICAgICAgICB2OiBmKHgsIGkpXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB0dXBsZU1hcCA9IGZ1bmN0aW9uIChvYmosIGYpIHtcbiAgICAgIHZhciByID0ge307XG4gICAgICBlYWNoJDEob2JqLCBmdW5jdGlvbiAoeCwgaSkge1xuICAgICAgICB2YXIgdHVwbGUgPSBmKHgsIGkpO1xuICAgICAgICByW3R1cGxlLmtdID0gdHVwbGUudjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgb2JqQWNjID0gZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoeCwgaSkge1xuICAgICAgICByW2ldID0geDtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaW50ZXJuYWxGaWx0ZXIgPSBmdW5jdGlvbiAob2JqLCBwcmVkLCBvblRydWUsIG9uRmFsc2UpIHtcbiAgICAgIHZhciByID0ge307XG4gICAgICBlYWNoJDEob2JqLCBmdW5jdGlvbiAoeCwgaSkge1xuICAgICAgICAocHJlZCh4LCBpKSA/IG9uVHJ1ZSA6IG9uRmFsc2UpKHgsIGkpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBmaWx0ZXIkMSA9IGZ1bmN0aW9uIChvYmosIHByZWQpIHtcbiAgICAgIHZhciB0ID0ge307XG4gICAgICBpbnRlcm5hbEZpbHRlcihvYmosIHByZWQsIG9iakFjYyh0KSwgbm9vcCk7XG4gICAgICByZXR1cm4gdDtcbiAgICB9O1xuICAgIHZhciBtYXBUb0FycmF5ID0gZnVuY3Rpb24gKG9iaiwgZikge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGVhY2gkMShvYmosIGZ1bmN0aW9uICh2YWx1ZSwgbmFtZSkge1xuICAgICAgICByLnB1c2goZih2YWx1ZSwgbmFtZSkpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBmaW5kJDEgPSBmdW5jdGlvbiAob2JqLCBwcmVkKSB7XG4gICAgICB2YXIgcHJvcHMgPSBrZXlzKG9iaik7XG4gICAgICBmb3IgKHZhciBrID0gMCwgbGVuID0gcHJvcHMubGVuZ3RoOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgdmFyIGkgPSBwcm9wc1trXTtcbiAgICAgICAgdmFyIHggPSBvYmpbaV07XG4gICAgICAgIGlmIChwcmVkKHgsIGksIG9iaikpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciB2YWx1ZXMgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gbWFwVG9BcnJheShvYmosIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHJldHVybiB2O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0JDEgPSBmdW5jdGlvbiAob2JqLCBrZXkpIHtcbiAgICAgIHJldHVybiBoYXMob2JqLCBrZXkpID8gT3B0aW9uYWwuZnJvbShvYmpba2V5XSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgaGFzID0gZnVuY3Rpb24gKG9iaiwga2V5KSB7XG4gICAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7XG4gICAgfTtcbiAgICB2YXIgaGFzTm9uTnVsbGFibGVLZXkgPSBmdW5jdGlvbiAob2JqLCBrZXkpIHtcbiAgICAgIHJldHVybiBoYXMob2JqLCBrZXkpICYmIG9ialtrZXldICE9PSB1bmRlZmluZWQgJiYgb2JqW2tleV0gIT09IG51bGw7XG4gICAgfTtcblxuICAgIHZhciBnZW5lcmF0ZSA9IGZ1bmN0aW9uIChjYXNlcykge1xuICAgICAgaWYgKCFpc0FycmF5KGNhc2VzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Nhc2VzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgICAgIH1cbiAgICAgIGlmIChjYXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd0aGVyZSBtdXN0IGJlIGF0IGxlYXN0IG9uZSBjYXNlJyk7XG4gICAgICB9XG4gICAgICB2YXIgY29uc3RydWN0b3JzID0gW107XG4gICAgICB2YXIgYWR0ID0ge307XG4gICAgICBlYWNoKGNhc2VzLCBmdW5jdGlvbiAoYWNhc2UsIGNvdW50KSB7XG4gICAgICAgIHZhciBrZXlzJDEgPSBrZXlzKGFjYXNlKTtcbiAgICAgICAgaWYgKGtleXMkMS5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29uZSBhbmQgb25seSBvbmUgbmFtZSBwZXIgY2FzZScpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBrZXkgPSBrZXlzJDFbMF07XG4gICAgICAgIHZhciB2YWx1ZSA9IGFjYXNlW2tleV07XG4gICAgICAgIGlmIChhZHRba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdkdXBsaWNhdGUga2V5IGRldGVjdGVkOicgKyBrZXkpO1xuICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2NhdGEnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW5ub3QgaGF2ZSBhIGNhc2UgbmFtZWQgY2F0YSAoc29ycnkpJyk7XG4gICAgICAgIH0gZWxzZSBpZiAoIWlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYXNlIGFyZ3VtZW50cyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3RydWN0b3JzLnB1c2goa2V5KTtcbiAgICAgICAgYWR0W2tleV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgYXJnTGVuZ3RoID0gYXJncy5sZW5ndGg7XG4gICAgICAgICAgaWYgKGFyZ0xlbmd0aCAhPT0gdmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dyb25nIG51bWJlciBvZiBhcmd1bWVudHMgdG8gY2FzZSAnICsga2V5ICsgJy4gRXhwZWN0ZWQgJyArIHZhbHVlLmxlbmd0aCArICcgKCcgKyB2YWx1ZSArICcpLCBnb3QgJyArIGFyZ0xlbmd0aCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBtYXRjaCA9IGZ1bmN0aW9uIChicmFuY2hlcykge1xuICAgICAgICAgICAgdmFyIGJyYW5jaEtleXMgPSBrZXlzKGJyYW5jaGVzKTtcbiAgICAgICAgICAgIGlmIChjb25zdHJ1Y3RvcnMubGVuZ3RoICE9PSBicmFuY2hLZXlzLmxlbmd0aCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dyb25nIG51bWJlciBvZiBhcmd1bWVudHMgdG8gbWF0Y2guIEV4cGVjdGVkOiAnICsgY29uc3RydWN0b3JzLmpvaW4oJywnKSArICdcXG5BY3R1YWw6ICcgKyBicmFuY2hLZXlzLmpvaW4oJywnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYWxsUmVxZCA9IGZvcmFsbChjb25zdHJ1Y3RvcnMsIGZ1bmN0aW9uIChyZXFLZXkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zKGJyYW5jaEtleXMsIHJlcUtleSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghYWxsUmVxZCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBhbGwgYnJhbmNoZXMgd2VyZSBzcGVjaWZpZWQgd2hlbiB1c2luZyBtYXRjaC4gU3BlY2lmaWVkOiAnICsgYnJhbmNoS2V5cy5qb2luKCcsICcpICsgJ1xcblJlcXVpcmVkOiAnICsgY29uc3RydWN0b3JzLmpvaW4oJywgJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJyYW5jaGVzW2tleV0uYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZm9sZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB2YXIgZm9sZEFyZ3MgPSBbXTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICBmb2xkQXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChmb2xkQXJncy5sZW5ndGggIT09IGNhc2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignV3JvbmcgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBmb2xkLiBFeHBlY3RlZCAnICsgY2FzZXMubGVuZ3RoICsgJywgZ290ICcgKyBmb2xkQXJncy5sZW5ndGgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBmb2xkQXJnc1tjb3VudF07XG4gICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWF0Y2g6IG1hdGNoLFxuICAgICAgICAgICAgbG9nOiBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2cobGFiZWwsIHtcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcnM6IGNvbnN0cnVjdG9ycyxcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3Rvcjoga2V5LFxuICAgICAgICAgICAgICAgIHBhcmFtczogYXJnc1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWR0O1xuICAgIH07XG4gICAgdmFyIEFkdCA9IHsgZ2VuZXJhdGU6IGdlbmVyYXRlIH07XG5cbiAgICB2YXIgaGFzT3duUHJvcGVydHkkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG4gICAgdmFyIHNoYWxsb3cgPSBmdW5jdGlvbiAob2xkLCBudSkge1xuICAgICAgcmV0dXJuIG51O1xuICAgIH07XG4gICAgdmFyIGRlZXAgPSBmdW5jdGlvbiAob2xkLCBudSkge1xuICAgICAgdmFyIGJvdGhPYmplY3RzID0gaXNPYmplY3Qob2xkKSAmJiBpc09iamVjdChudSk7XG4gICAgICByZXR1cm4gYm90aE9iamVjdHMgPyBkZWVwTWVyZ2Uob2xkLCBudSkgOiBudTtcbiAgICB9O1xuICAgIHZhciBiYXNlTWVyZ2UgPSBmdW5jdGlvbiAobWVyZ2VyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqZWN0cyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIG9iamVjdHNbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3QgbWVyZ2UgemVybyBvYmplY3RzJyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJldCA9IHt9O1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iamVjdHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICB2YXIgY3VyT2JqZWN0ID0gb2JqZWN0c1tqXTtcbiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gY3VyT2JqZWN0KSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkkMS5jYWxsKGN1ck9iamVjdCwga2V5KSkge1xuICAgICAgICAgICAgICByZXRba2V5XSA9IG1lcmdlcihyZXRba2V5XSwgY3VyT2JqZWN0W2tleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkZWVwTWVyZ2UgPSBiYXNlTWVyZ2UoZGVlcCk7XG4gICAgdmFyIG1lcmdlID0gYmFzZU1lcmdlKHNoYWxsb3cpO1xuXG4gICAgdmFyIGNhY2hlZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICB2YXIgY2FsbGVkID0gZmFsc2U7XG4gICAgICB2YXIgcjtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2FsbGVkKSB7XG4gICAgICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgICAgICByID0gZi5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcjtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhZHQgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAgeyBzdHJpY3Q6IFtdIH0sXG4gICAgICB7IGRlZmF1bHRlZFRodW5rOiBbJ2ZhbGxiYWNrVGh1bmsnXSB9LFxuICAgICAgeyBhc09wdGlvbjogW10gfSxcbiAgICAgIHsgYXNEZWZhdWx0ZWRPcHRpb25UaHVuazogWydmYWxsYmFja1RodW5rJ10gfSxcbiAgICAgIHsgbWVyZ2VXaXRoVGh1bms6IFsnYmFzZVRodW5rJ10gfVxuICAgIF0pO1xuICAgIHZhciBkZWZhdWx0ZWQgPSBmdW5jdGlvbiAoZmFsbGJhY2spIHtcbiAgICAgIHJldHVybiBhZHQuZGVmYXVsdGVkVGh1bmsoY29uc3RhbnQoZmFsbGJhY2spKTtcbiAgICB9O1xuICAgIHZhciBtZXJnZVdpdGggPSBmdW5jdGlvbiAoYmFzZSkge1xuICAgICAgcmV0dXJuIGFkdC5tZXJnZVdpdGhUaHVuayhjb25zdGFudChiYXNlKSk7XG4gICAgfTtcbiAgICB2YXIgc3RyaWN0ID0gYWR0LnN0cmljdDtcbiAgICB2YXIgYXNPcHRpb24gPSBhZHQuYXNPcHRpb247XG4gICAgdmFyIGRlZmF1bHRlZFRodW5rID0gYWR0LmRlZmF1bHRlZFRodW5rO1xuICAgIHZhciBhc0RlZmF1bHRlZE9wdGlvblRodW5rID0gYWR0LmFzRGVmYXVsdGVkT3B0aW9uVGh1bms7XG4gICAgdmFyIG1lcmdlV2l0aFRodW5rID0gYWR0Lm1lcmdlV2l0aFRodW5rO1xuXG4gICAgdmFyIGNvbXBhcmlzb24gPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAge1xuICAgICAgICBib3RoRXJyb3JzOiBbXG4gICAgICAgICAgJ2Vycm9yMScsXG4gICAgICAgICAgJ2Vycm9yMidcbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZmlyc3RFcnJvcjogW1xuICAgICAgICAgICdlcnJvcjEnLFxuICAgICAgICAgICd2YWx1ZTInXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHNlY29uZEVycm9yOiBbXG4gICAgICAgICAgJ3ZhbHVlMScsXG4gICAgICAgICAgJ2Vycm9yMidcbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgYm90aFZhbHVlczogW1xuICAgICAgICAgICd2YWx1ZTEnLFxuICAgICAgICAgICd2YWx1ZTInXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdKTtcbiAgICB2YXIgcGFydGl0aW9uJDIgPSBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgdmFyIGVycm9ycyA9IFtdO1xuICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgZWFjaChyZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIHJlc3VsdC5mb2xkKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnIpO1xuICAgICAgICB9LCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnJvcnM6IGVycm9ycyxcbiAgICAgICAgdmFsdWVzOiB2YWx1ZXNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBleGNsdWRlID0gZnVuY3Rpb24gKG9iaiwgZmllbGRzKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgZWFjaCQxKG9iaiwgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgaWYgKCFjb250YWlucyhmaWVsZHMsIGspKSB7XG4gICAgICAgICAgcltrXSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcblxuICAgIHZhciB3cmFwID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHJldHVybiBfYSA9IHt9LCBfYVtrZXldID0gdmFsdWUsIF9hO1xuICAgIH07XG4gICAgdmFyIHdyYXBBbGwgPSBmdW5jdGlvbiAoa2V5dmFsdWVzKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgZWFjaChrZXl2YWx1ZXMsIGZ1bmN0aW9uIChrdikge1xuICAgICAgICByW2t2LmtleV0gPSBrdi52YWx1ZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcblxuICAgIHZhciBleGNsdWRlJDEgPSBmdW5jdGlvbiAob2JqLCBmaWVsZHMpIHtcbiAgICAgIHJldHVybiBleGNsdWRlKG9iaiwgZmllbGRzKTtcbiAgICB9O1xuICAgIHZhciB3cmFwJDEgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIHdyYXAoa2V5LCB2YWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgd3JhcEFsbCQxID0gZnVuY3Rpb24gKGtleXZhbHVlcykge1xuICAgICAgcmV0dXJuIHdyYXBBbGwoa2V5dmFsdWVzKTtcbiAgICB9O1xuICAgIHZhciBtZXJnZVZhbHVlcyA9IGZ1bmN0aW9uICh2YWx1ZXMsIGJhc2UpIHtcbiAgICAgIHJldHVybiB2YWx1ZXMubGVuZ3RoID09PSAwID8gUmVzdWx0LnZhbHVlKGJhc2UpIDogUmVzdWx0LnZhbHVlKGRlZXBNZXJnZShiYXNlLCBtZXJnZS5hcHBseSh1bmRlZmluZWQsIHZhbHVlcykpKTtcbiAgICB9O1xuICAgIHZhciBtZXJnZUVycm9ycyA9IGZ1bmN0aW9uIChlcnJvcnMpIHtcbiAgICAgIHJldHVybiBSZXN1bHQuZXJyb3IoZmxhdHRlbihlcnJvcnMpKTtcbiAgICB9O1xuICAgIHZhciBjb25zb2xpZGF0ZSA9IGZ1bmN0aW9uIChvYmpzLCBiYXNlKSB7XG4gICAgICB2YXIgcGFydGl0aW9ucyA9IHBhcnRpdGlvbiQyKG9ianMpO1xuICAgICAgcmV0dXJuIHBhcnRpdGlvbnMuZXJyb3JzLmxlbmd0aCA+IDAgPyBtZXJnZUVycm9ycyhwYXJ0aXRpb25zLmVycm9ycykgOiBtZXJnZVZhbHVlcyhwYXJ0aXRpb25zLnZhbHVlcywgYmFzZSk7XG4gICAgfTtcblxuICAgIHZhciBtZXJnZVZhbHVlcyQxID0gZnVuY3Rpb24gKHZhbHVlcywgYmFzZSkge1xuICAgICAgcmV0dXJuIHZhbHVlcy5sZW5ndGggPiAwID8gU2ltcGxlUmVzdWx0LnN2YWx1ZShkZWVwTWVyZ2UoYmFzZSwgbWVyZ2UuYXBwbHkodW5kZWZpbmVkLCB2YWx1ZXMpKSkgOiBTaW1wbGVSZXN1bHQuc3ZhbHVlKGJhc2UpO1xuICAgIH07XG4gICAgdmFyIG1lcmdlRXJyb3JzJDEgPSBmdW5jdGlvbiAoZXJyb3JzKSB7XG4gICAgICByZXR1cm4gY29tcG9zZShTaW1wbGVSZXN1bHQuc2Vycm9yLCBmbGF0dGVuKShlcnJvcnMpO1xuICAgIH07XG4gICAgdmFyIGNvbnNvbGlkYXRlT2JqID0gZnVuY3Rpb24gKG9iamVjdHMsIGJhc2UpIHtcbiAgICAgIHZhciBwYXJ0aXRpb24gPSBTaW1wbGVSZXN1bHQucGFydGl0aW9uKG9iamVjdHMpO1xuICAgICAgcmV0dXJuIHBhcnRpdGlvbi5lcnJvcnMubGVuZ3RoID4gMCA/IG1lcmdlRXJyb3JzJDEocGFydGl0aW9uLmVycm9ycykgOiBtZXJnZVZhbHVlcyQxKHBhcnRpdGlvbi52YWx1ZXMsIGJhc2UpO1xuICAgIH07XG4gICAgdmFyIGNvbnNvbGlkYXRlQXJyID0gZnVuY3Rpb24gKG9iamVjdHMpIHtcbiAgICAgIHZhciBwYXJ0aXRpb25zID0gU2ltcGxlUmVzdWx0LnBhcnRpdGlvbihvYmplY3RzKTtcbiAgICAgIHJldHVybiBwYXJ0aXRpb25zLmVycm9ycy5sZW5ndGggPiAwID8gbWVyZ2VFcnJvcnMkMShwYXJ0aXRpb25zLmVycm9ycykgOiBTaW1wbGVSZXN1bHQuc3ZhbHVlKHBhcnRpdGlvbnMudmFsdWVzKTtcbiAgICB9O1xuICAgIHZhciBSZXN1bHRDb21iaW5lID0ge1xuICAgICAgY29uc29saWRhdGVPYmo6IGNvbnNvbGlkYXRlT2JqLFxuICAgICAgY29uc29saWRhdGVBcnI6IGNvbnNvbGlkYXRlQXJyXG4gICAgfTtcblxuICAgIHZhciBmb3JtYXRPYmogPSBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgIHJldHVybiBpc09iamVjdChpbnB1dCkgJiYga2V5cyhpbnB1dCkubGVuZ3RoID4gMTAwID8gJyByZW1vdmVkIGR1ZSB0byBzaXplJyA6IEpTT04uc3RyaW5naWZ5KGlucHV0LCBudWxsLCAyKTtcbiAgICB9O1xuICAgIHZhciBmb3JtYXRFcnJvcnMgPSBmdW5jdGlvbiAoZXJyb3JzKSB7XG4gICAgICB2YXIgZXMgPSBlcnJvcnMubGVuZ3RoID4gMTAgPyBlcnJvcnMuc2xpY2UoMCwgMTApLmNvbmNhdChbe1xuICAgICAgICAgIHBhdGg6IFtdLFxuICAgICAgICAgIGdldEVycm9ySW5mbzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICcuLi4gKG9ubHkgc2hvd2luZyBmaXJzdCB0ZW4gZmFpbHVyZXMpJztcbiAgICAgICAgICB9XG4gICAgICAgIH1dKSA6IGVycm9ycztcbiAgICAgIHJldHVybiBtYXAoZXMsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiAnRmFpbGVkIHBhdGg6ICgnICsgZS5wYXRoLmpvaW4oJyA+ICcpICsgJylcXG4nICsgZS5nZXRFcnJvckluZm8oKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgbnUgPSBmdW5jdGlvbiAocGF0aCwgZ2V0RXJyb3JJbmZvKSB7XG4gICAgICByZXR1cm4gU2ltcGxlUmVzdWx0LnNlcnJvcihbe1xuICAgICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgICAgZ2V0RXJyb3JJbmZvOiBnZXRFcnJvckluZm9cbiAgICAgICAgfV0pO1xuICAgIH07XG4gICAgdmFyIG1pc3NpbmdTdHJpY3QgPSBmdW5jdGlvbiAocGF0aCwga2V5LCBvYmopIHtcbiAgICAgIHJldHVybiBudShwYXRoLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAnQ291bGQgbm90IGZpbmQgdmFsaWQgKnN0cmljdCogdmFsdWUgZm9yIFwiJyArIGtleSArICdcIiBpbiAnICsgZm9ybWF0T2JqKG9iaik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBtaXNzaW5nS2V5ID0gZnVuY3Rpb24gKHBhdGgsIGtleSkge1xuICAgICAgcmV0dXJuIG51KHBhdGgsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICdDaG9pY2Ugc2NoZW1hIGRpZCBub3QgY29udGFpbiBjaG9pY2Uga2V5OiBcIicgKyBrZXkgKyAnXCInO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWlzc2luZ0JyYW5jaCA9IGZ1bmN0aW9uIChwYXRoLCBicmFuY2hlcywgYnJhbmNoKSB7XG4gICAgICByZXR1cm4gbnUocGF0aCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJ1RoZSBjaG9zZW4gc2NoZW1hOiBcIicgKyBicmFuY2ggKyAnXCIgZGlkIG5vdCBleGlzdCBpbiBicmFuY2hlczogJyArIGZvcm1hdE9iaihicmFuY2hlcyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB1bnN1cHBvcnRlZEZpZWxkcyA9IGZ1bmN0aW9uIChwYXRoLCB1bnN1cHBvcnRlZCkge1xuICAgICAgcmV0dXJuIG51KHBhdGgsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICdUaGVyZSBhcmUgdW5zdXBwb3J0ZWQgZmllbGRzOiBbJyArIHVuc3VwcG9ydGVkLmpvaW4oJywgJykgKyAnXSBzcGVjaWZpZWQnO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY3VzdG9tID0gZnVuY3Rpb24gKHBhdGgsIGVycikge1xuICAgICAgcmV0dXJuIG51KHBhdGgsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgYWR0JDEgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAge1xuICAgICAgICBmaWVsZDogW1xuICAgICAgICAgICdrZXknLFxuICAgICAgICAgICdva2V5JyxcbiAgICAgICAgICAncHJlc2VuY2UnLFxuICAgICAgICAgICdwcm9wJ1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBzdGF0ZTogW1xuICAgICAgICAgICdva2V5JyxcbiAgICAgICAgICAnaW5zdGFudGlhdG9yJ1xuICAgICAgICBdXG4gICAgICB9XG4gICAgXSk7XG4gICAgdmFyIHN0cmljdEFjY2VzcyA9IGZ1bmN0aW9uIChwYXRoLCBvYmosIGtleSkge1xuICAgICAgcmV0dXJuIGdldCQxKG9iaiwga2V5KS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG1pc3NpbmdTdHJpY3QocGF0aCwga2V5LCBvYmopO1xuICAgICAgfSwgU2ltcGxlUmVzdWx0LnN2YWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgZmFsbGJhY2tBY2Nlc3MgPSBmdW5jdGlvbiAob2JqLCBrZXksIGZhbGxiYWNrVGh1bmspIHtcbiAgICAgIHZhciB2ID0gZ2V0JDEob2JqLCBrZXkpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsbGJhY2tUaHVuayhvYmopO1xuICAgICAgfSwgaWRlbnRpdHkpO1xuICAgICAgcmV0dXJuIFNpbXBsZVJlc3VsdC5zdmFsdWUodik7XG4gICAgfTtcbiAgICB2YXIgb3B0aW9uQWNjZXNzID0gZnVuY3Rpb24gKG9iaiwga2V5KSB7XG4gICAgICByZXR1cm4gU2ltcGxlUmVzdWx0LnN2YWx1ZShnZXQkMShvYmosIGtleSkpO1xuICAgIH07XG4gICAgdmFyIG9wdGlvbkRlZmF1bHRlZEFjY2VzcyA9IGZ1bmN0aW9uIChvYmosIGtleSwgZmFsbGJhY2spIHtcbiAgICAgIHZhciBvcHQgPSBnZXQkMShvYmosIGtleSkubWFwKGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgcmV0dXJuIHZhbCA9PT0gdHJ1ZSA/IGZhbGxiYWNrKG9iaikgOiB2YWw7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQuc3ZhbHVlKG9wdCk7XG4gICAgfTtcbiAgICB2YXIgY0V4dHJhY3RPbmUgPSBmdW5jdGlvbiAocGF0aCwgb2JqLCBmaWVsZCwgc3RyZW5ndGgpIHtcbiAgICAgIHJldHVybiBmaWVsZC5mb2xkKGZ1bmN0aW9uIChrZXksIG9rZXksIHByZXNlbmNlLCBwcm9wKSB7XG4gICAgICAgIHZhciBidW5kbGUgPSBmdW5jdGlvbiAoYXYpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gcHJvcC5leHRyYWN0KHBhdGguY29uY2F0KFtrZXldKSwgc3RyZW5ndGgsIGF2KTtcbiAgICAgICAgICByZXR1cm4gU2ltcGxlUmVzdWx0Lm1hcChyZXN1bHQsIGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHJldHVybiB3cmFwKG9rZXksIHN0cmVuZ3RoKHJlcykpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgYnVuZGxlQXNPcHRpb24gPSBmdW5jdGlvbiAob3B0VmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gb3B0VmFsdWUuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgb3V0Y29tZSA9IHdyYXAob2tleSwgc3RyZW5ndGgoT3B0aW9uYWwubm9uZSgpKSk7XG4gICAgICAgICAgICByZXR1cm4gU2ltcGxlUmVzdWx0LnN2YWx1ZShvdXRjb21lKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAob3YpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBwcm9wLmV4dHJhY3QocGF0aC5jb25jYXQoW2tleV0pLCBzdHJlbmd0aCwgb3YpO1xuICAgICAgICAgICAgcmV0dXJuIFNpbXBsZVJlc3VsdC5tYXAocmVzdWx0LCBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIHJldHVybiB3cmFwKG9rZXksIHN0cmVuZ3RoKE9wdGlvbmFsLnNvbWUocmVzKSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHByZXNlbmNlLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFNpbXBsZVJlc3VsdC5iaW5kKHN0cmljdEFjY2VzcyhwYXRoLCBvYmosIGtleSksIGJ1bmRsZSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKGZhbGxiYWNrVGh1bmspIHtcbiAgICAgICAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQuYmluZChmYWxsYmFja0FjY2VzcyhvYmosIGtleSwgZmFsbGJhY2tUaHVuayksIGJ1bmRsZSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFNpbXBsZVJlc3VsdC5iaW5kKG9wdGlvbkFjY2VzcyhvYmosIGtleSksIGJ1bmRsZUFzT3B0aW9uKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoZmFsbGJhY2tUaHVuaykge1xuICAgICAgICAgICAgcmV0dXJuIFNpbXBsZVJlc3VsdC5iaW5kKG9wdGlvbkRlZmF1bHRlZEFjY2VzcyhvYmosIGtleSwgZmFsbGJhY2tUaHVuayksIGJ1bmRsZUFzT3B0aW9uKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoYmFzZVRodW5rKSB7XG4gICAgICAgICAgICB2YXIgYmFzZSA9IGJhc2VUaHVuayhvYmopO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFNpbXBsZVJlc3VsdC5tYXAoZmFsbGJhY2tBY2Nlc3Mob2JqLCBrZXksIGNvbnN0YW50KHt9KSksIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgIHJldHVybiBkZWVwTWVyZ2UoYmFzZSwgdik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQuYmluZChyZXN1bHQsIGJ1bmRsZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0oKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChva2V5LCBpbnN0YW50aWF0b3IpIHtcbiAgICAgICAgdmFyIHN0YXRlID0gaW5zdGFudGlhdG9yKG9iaik7XG4gICAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQuc3ZhbHVlKHdyYXAob2tleSwgc3RyZW5ndGgoc3RhdGUpKSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjRXh0cmFjdCA9IGZ1bmN0aW9uIChwYXRoLCBvYmosIGZpZWxkcywgc3RyZW5ndGgpIHtcbiAgICAgIHZhciByZXN1bHRzID0gbWFwKGZpZWxkcywgZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgIHJldHVybiBjRXh0cmFjdE9uZShwYXRoLCBvYmosIGZpZWxkLCBzdHJlbmd0aCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBSZXN1bHRDb21iaW5lLmNvbnNvbGlkYXRlT2JqKHJlc3VsdHMsIHt9KTtcbiAgICB9O1xuICAgIHZhciB2YWx1ZVRodW5rID0gZnVuY3Rpb24gKGdldERlbGVnYXRlKSB7XG4gICAgICB2YXIgZXh0cmFjdCA9IGZ1bmN0aW9uIChwYXRoLCBzdHJlbmd0aCwgdmFsKSB7XG4gICAgICAgIHJldHVybiBnZXREZWxlZ2F0ZSgpLmV4dHJhY3QocGF0aCwgc3RyZW5ndGgsIHZhbCk7XG4gICAgICB9O1xuICAgICAgdmFyIHRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0RGVsZWdhdGUoKS50b1N0cmluZygpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGV4dHJhY3Q6IGV4dHJhY3QsXG4gICAgICAgIHRvU3RyaW5nOiB0b1N0cmluZ1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB2YWx1ZSQxID0gZnVuY3Rpb24gKHZhbGlkYXRvcikge1xuICAgICAgdmFyIGV4dHJhY3QgPSBmdW5jdGlvbiAocGF0aCwgc3RyZW5ndGgsIHZhbCkge1xuICAgICAgICByZXR1cm4gU2ltcGxlUmVzdWx0LmJpbmRFcnJvcih2YWxpZGF0b3IodmFsLCBzdHJlbmd0aCksIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gY3VzdG9tKHBhdGgsIGVycik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICd2YWwnO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGV4dHJhY3Q6IGV4dHJhY3QsXG4gICAgICAgIHRvU3RyaW5nOiB0b1N0cmluZ1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZXRTZXRLZXlzID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgcmV0dXJuIGtleXMoZmlsdGVyJDEob2JqLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGw7XG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgb2JqT2ZPbmx5ID0gZnVuY3Rpb24gKGZpZWxkcykge1xuICAgICAgdmFyIGRlbGVnYXRlID0gb2JqT2YoZmllbGRzKTtcbiAgICAgIHZhciBmaWVsZE5hbWVzID0gZm9sZHIoZmllbGRzLCBmdW5jdGlvbiAoYWNjLCBmKSB7XG4gICAgICAgIHJldHVybiBmLmZvbGQoZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIHJldHVybiBkZWVwTWVyZ2UoYWNjLCB3cmFwJDEoa2V5LCB0cnVlKSk7XG4gICAgICAgIH0sIGNvbnN0YW50KGFjYykpO1xuICAgICAgfSwge30pO1xuICAgICAgdmFyIGV4dHJhY3QgPSBmdW5jdGlvbiAocGF0aCwgc3RyZW5ndGgsIG8pIHtcbiAgICAgICAgdmFyIGtleXMgPSBpc0Jvb2xlYW4obykgPyBbXSA6IGdldFNldEtleXMobyk7XG4gICAgICAgIHZhciBleHRyYSA9IGZpbHRlcihrZXlzLCBmdW5jdGlvbiAoaykge1xuICAgICAgICAgIHJldHVybiAhaGFzTm9uTnVsbGFibGVLZXkoZmllbGROYW1lcywgayk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZXh0cmEubGVuZ3RoID09PSAwID8gZGVsZWdhdGUuZXh0cmFjdChwYXRoLCBzdHJlbmd0aCwgbykgOiB1bnN1cHBvcnRlZEZpZWxkcyhwYXRoLCBleHRyYSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXh0cmFjdDogZXh0cmFjdCxcbiAgICAgICAgdG9TdHJpbmc6IGRlbGVnYXRlLnRvU3RyaW5nXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG9iak9mID0gZnVuY3Rpb24gKGZpZWxkcykge1xuICAgICAgdmFyIGV4dHJhY3QgPSBmdW5jdGlvbiAocGF0aCwgc3RyZW5ndGgsIG8pIHtcbiAgICAgICAgcmV0dXJuIGNFeHRyYWN0KHBhdGgsIG8sIGZpZWxkcywgc3RyZW5ndGgpO1xuICAgICAgfTtcbiAgICAgIHZhciB0b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGZpZWxkU3RyaW5ncyA9IG1hcChmaWVsZHMsIGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICAgIHJldHVybiBmaWVsZC5mb2xkKGZ1bmN0aW9uIChrZXksIG9rZXksIHByZXNlbmNlLCBwcm9wKSB7XG4gICAgICAgICAgICByZXR1cm4ga2V5ICsgJyAtPiAnICsgcHJvcC50b1N0cmluZygpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChva2V5LCBfaW5zdGFudGlhdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gJ3N0YXRlKCcgKyBva2V5ICsgJyknO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICdvYmp7XFxuJyArIGZpZWxkU3RyaW5ncy5qb2luKCdcXG4nKSArICd9JztcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBleHRyYWN0OiBleHRyYWN0LFxuICAgICAgICB0b1N0cmluZzogdG9TdHJpbmdcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYXJyT2YgPSBmdW5jdGlvbiAocHJvcCkge1xuICAgICAgdmFyIGV4dHJhY3QgPSBmdW5jdGlvbiAocGF0aCwgc3RyZW5ndGgsIGFycmF5KSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gbWFwKGFycmF5LCBmdW5jdGlvbiAoYSwgaSkge1xuICAgICAgICAgIHJldHVybiBwcm9wLmV4dHJhY3QocGF0aC5jb25jYXQoWydbJyArIGkgKyAnXSddKSwgc3RyZW5ndGgsIGEpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFJlc3VsdENvbWJpbmUuY29uc29saWRhdGVBcnIocmVzdWx0cyk7XG4gICAgICB9O1xuICAgICAgdmFyIHRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJ2FycmF5KCcgKyBwcm9wLnRvU3RyaW5nKCkgKyAnKSc7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXh0cmFjdDogZXh0cmFjdCxcbiAgICAgICAgdG9TdHJpbmc6IHRvU3RyaW5nXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG9uZU9mID0gZnVuY3Rpb24gKHByb3BzKSB7XG4gICAgICB2YXIgZXh0cmFjdCA9IGZ1bmN0aW9uIChwYXRoLCBzdHJlbmd0aCwgdmFsKSB7XG4gICAgICAgIHZhciBlcnJvcnMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBwcm9wc18xID0gcHJvcHM7IF9pIDwgcHJvcHNfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICB2YXIgcHJvcCA9IHByb3BzXzFbX2ldO1xuICAgICAgICAgIHZhciByZXMgPSBwcm9wLmV4dHJhY3QocGF0aCwgc3RyZW5ndGgsIHZhbCk7XG4gICAgICAgICAgaWYgKHJlcy5zdHlwZSA9PT0gU2ltcGxlUmVzdWx0VHlwZS5WYWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICB9XG4gICAgICAgICAgZXJyb3JzLnB1c2gocmVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVzdWx0Q29tYmluZS5jb25zb2xpZGF0ZUFycihlcnJvcnMpO1xuICAgICAgfTtcbiAgICAgIHZhciB0b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICdvbmVPZignICsgbWFwKHByb3BzLCBmdW5jdGlvbiAocHJvcCkge1xuICAgICAgICAgIHJldHVybiBwcm9wLnRvU3RyaW5nKCk7XG4gICAgICAgIH0pLmpvaW4oJywgJykgKyAnKSc7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXh0cmFjdDogZXh0cmFjdCxcbiAgICAgICAgdG9TdHJpbmc6IHRvU3RyaW5nXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNldE9mID0gZnVuY3Rpb24gKHZhbGlkYXRvciwgcHJvcCkge1xuICAgICAgdmFyIHZhbGlkYXRlS2V5cyA9IGZ1bmN0aW9uIChwYXRoLCBrZXlzKSB7XG4gICAgICAgIHJldHVybiBhcnJPZih2YWx1ZSQxKHZhbGlkYXRvcikpLmV4dHJhY3QocGF0aCwgaWRlbnRpdHksIGtleXMpO1xuICAgICAgfTtcbiAgICAgIHZhciBleHRyYWN0ID0gZnVuY3Rpb24gKHBhdGgsIHN0cmVuZ3RoLCBvKSB7XG4gICAgICAgIHZhciBrZXlzJDEgPSBrZXlzKG8pO1xuICAgICAgICB2YXIgdmFsaWRhdGVkS2V5cyA9IHZhbGlkYXRlS2V5cyhwYXRoLCBrZXlzJDEpO1xuICAgICAgICByZXR1cm4gU2ltcGxlUmVzdWx0LmJpbmQodmFsaWRhdGVkS2V5cywgZnVuY3Rpb24gKHZhbGlkS2V5cykge1xuICAgICAgICAgIHZhciBzY2hlbWEgPSBtYXAodmFsaWRLZXlzLCBmdW5jdGlvbiAodmspIHtcbiAgICAgICAgICAgIHJldHVybiBhZHQkMS5maWVsZCh2aywgdmssIHN0cmljdCgpLCBwcm9wKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gb2JqT2Yoc2NoZW1hKS5leHRyYWN0KHBhdGgsIHN0cmVuZ3RoLCBvKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJ3NldE9mKCcgKyBwcm9wLnRvU3RyaW5nKCkgKyAnKSc7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXh0cmFjdDogZXh0cmFjdCxcbiAgICAgICAgdG9TdHJpbmc6IHRvU3RyaW5nXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHRodW5rID0gZnVuY3Rpb24gKGRlc2MsIHByb2Nlc3Nvcikge1xuICAgICAgdmFyIGdldFAgPSBjYWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcHJvY2Vzc29yKCk7XG4gICAgICB9KTtcbiAgICAgIHZhciBleHRyYWN0ID0gZnVuY3Rpb24gKHBhdGgsIHN0cmVuZ3RoLCB2YWwpIHtcbiAgICAgICAgcmV0dXJuIGdldFAoKS5leHRyYWN0KHBhdGgsIHN0cmVuZ3RoLCB2YWwpO1xuICAgICAgfTtcbiAgICAgIHZhciB0b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldFAoKS50b1N0cmluZygpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGV4dHJhY3Q6IGV4dHJhY3QsXG4gICAgICAgIHRvU3RyaW5nOiB0b1N0cmluZ1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBhbnlWYWx1ZSA9IGNvbnN0YW50KHZhbHVlJDEoU2ltcGxlUmVzdWx0LnN2YWx1ZSkpO1xuICAgIHZhciBhcnJPZk9iaiA9IGNvbXBvc2UoYXJyT2YsIG9iak9mKTtcbiAgICB2YXIgc3RhdGUgPSBhZHQkMS5zdGF0ZTtcbiAgICB2YXIgZmllbGQgPSBhZHQkMS5maWVsZDtcblxuICAgIHZhciBjaG9vc2VGcm9tID0gZnVuY3Rpb24gKHBhdGgsIHN0cmVuZ3RoLCBpbnB1dCwgYnJhbmNoZXMsIGNoKSB7XG4gICAgICB2YXIgZmllbGRzID0gZ2V0JDEoYnJhbmNoZXMsIGNoKTtcbiAgICAgIHJldHVybiBmaWVsZHMuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtaXNzaW5nQnJhbmNoKHBhdGgsIGJyYW5jaGVzLCBjaCk7XG4gICAgICB9LCBmdW5jdGlvbiAodnApIHtcbiAgICAgICAgcmV0dXJuIHZwLmV4dHJhY3QocGF0aC5jb25jYXQoWydicmFuY2g6ICcgKyBjaF0pLCBzdHJlbmd0aCwgaW5wdXQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY2hvb3NlID0gZnVuY3Rpb24gKGtleSwgYnJhbmNoZXMpIHtcbiAgICAgIHZhciBleHRyYWN0ID0gZnVuY3Rpb24gKHBhdGgsIHN0cmVuZ3RoLCBpbnB1dCkge1xuICAgICAgICB2YXIgY2hvaWNlID0gZ2V0JDEoaW5wdXQsIGtleSk7XG4gICAgICAgIHJldHVybiBjaG9pY2UuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1pc3NpbmdLZXkocGF0aCwga2V5KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGNob3Nlbikge1xuICAgICAgICAgIHJldHVybiBjaG9vc2VGcm9tKHBhdGgsIHN0cmVuZ3RoLCBpbnB1dCwgYnJhbmNoZXMsIGNob3Nlbik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICdjaG9vc2VPbignICsga2V5ICsgJykuIFBvc3NpYmxlIHZhbHVlczogJyArIGtleXMoYnJhbmNoZXMpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGV4dHJhY3Q6IGV4dHJhY3QsXG4gICAgICAgIHRvU3RyaW5nOiB0b1N0cmluZ1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIF9hbnlWYWx1ZSA9IHZhbHVlJDEoU2ltcGxlUmVzdWx0LnN2YWx1ZSk7XG4gICAgdmFyIGFyck9mT2JqJDEgPSBmdW5jdGlvbiAob2JqRmllbGRzKSB7XG4gICAgICByZXR1cm4gYXJyT2ZPYmoob2JqRmllbGRzKTtcbiAgICB9O1xuICAgIHZhciBhcnJPZlZhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBhcnJPZihfYW55VmFsdWUpO1xuICAgIH07XG4gICAgdmFyIHZhbHVlVGh1bmtPZiA9IHZhbHVlVGh1bms7XG4gICAgdmFyIHZhbHVlT2YgPSBmdW5jdGlvbiAodmFsaWRhdG9yKSB7XG4gICAgICByZXR1cm4gdmFsdWUkMShmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdmFsaWRhdG9yKHYpLmZvbGQoU2ltcGxlUmVzdWx0LnNlcnJvciwgU2ltcGxlUmVzdWx0LnN2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzZXRPZiQxID0gZnVuY3Rpb24gKHZhbGlkYXRvciwgcHJvcCkge1xuICAgICAgcmV0dXJuIHNldE9mKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQuZnJvbVJlc3VsdCh2YWxpZGF0b3IodikpO1xuICAgICAgfSwgcHJvcCk7XG4gICAgfTtcbiAgICB2YXIgZXh0cmFjdCA9IGZ1bmN0aW9uIChsYWJlbCwgcHJvcCwgc3RyZW5ndGgsIG9iaikge1xuICAgICAgdmFyIHJlcyA9IHByb3AuZXh0cmFjdChbbGFiZWxdLCBzdHJlbmd0aCwgb2JqKTtcbiAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQubWFwRXJyb3IocmVzLCBmdW5jdGlvbiAoZXJycykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlucHV0OiBvYmosXG4gICAgICAgICAgZXJyb3JzOiBlcnJzXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBhc1JhdyA9IGZ1bmN0aW9uIChsYWJlbCwgcHJvcCwgb2JqKSB7XG4gICAgICByZXR1cm4gU2ltcGxlUmVzdWx0LnRvUmVzdWx0KGV4dHJhY3QobGFiZWwsIHByb3AsIGlkZW50aXR5LCBvYmopKTtcbiAgICB9O1xuICAgIHZhciBnZXRPckRpZSA9IGZ1bmN0aW9uIChleHRyYWN0aW9uKSB7XG4gICAgICByZXR1cm4gZXh0cmFjdGlvbi5mb2xkKGZ1bmN0aW9uIChlcnJJbmZvKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXRFcnJvcihlcnJJbmZvKSk7XG4gICAgICB9LCBpZGVudGl0eSk7XG4gICAgfTtcbiAgICB2YXIgYXNSYXdPckRpZSA9IGZ1bmN0aW9uIChsYWJlbCwgcHJvcCwgb2JqKSB7XG4gICAgICByZXR1cm4gZ2V0T3JEaWUoYXNSYXcobGFiZWwsIHByb3AsIG9iaikpO1xuICAgIH07XG4gICAgdmFyIGZvcm1hdEVycm9yID0gZnVuY3Rpb24gKGVyckluZm8pIHtcbiAgICAgIHJldHVybiAnRXJyb3JzOiBcXG4nICsgZm9ybWF0RXJyb3JzKGVyckluZm8uZXJyb3JzKS5qb2luKCdcXG4nKSArICdcXG5cXG5JbnB1dCBvYmplY3Q6ICcgKyBmb3JtYXRPYmooZXJySW5mby5pbnB1dCk7XG4gICAgfTtcbiAgICB2YXIgY2hvb3NlUHJvY2Vzc29yID0gZnVuY3Rpb24gKGtleSwgYnJhbmNoZXMpIHtcbiAgICAgIHJldHVybiBjaG9vc2Uoa2V5LCBicmFuY2hlcyk7XG4gICAgfTtcbiAgICB2YXIgY2hvb3NlJDEgPSBmdW5jdGlvbiAoa2V5LCBicmFuY2hlcykge1xuICAgICAgcmV0dXJuIGNob29zZShrZXksIG1hcCQyKGJyYW5jaGVzLCBvYmpPZikpO1xuICAgIH07XG4gICAgdmFyIHRodW5rT2YgPSBmdW5jdGlvbiAoZGVzYywgc2NoZW1hKSB7XG4gICAgICByZXR1cm4gdGh1bmsoZGVzYywgc2NoZW1hKTtcbiAgICB9O1xuICAgIHZhciBhbnlWYWx1ZSQxID0gY29uc3RhbnQoX2FueVZhbHVlKTtcbiAgICB2YXIgdHlwZWRWYWx1ZSA9IGZ1bmN0aW9uICh2YWxpZGF0b3IsIGV4cGVjdGVkVHlwZSkge1xuICAgICAgcmV0dXJuIHZhbHVlJDEoZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgdmFyIGFjdHVhbFR5cGUgPSB0eXBlb2YgYTtcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRvcihhKSA/IFNpbXBsZVJlc3VsdC5zdmFsdWUoYSkgOiBTaW1wbGVSZXN1bHQuc2Vycm9yKCdFeHBlY3RlZCB0eXBlOiAnICsgZXhwZWN0ZWRUeXBlICsgJyBidXQgZ290OiAnICsgYWN0dWFsVHlwZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBudW1iZXIgPSB0eXBlZFZhbHVlKGlzTnVtYmVyLCAnbnVtYmVyJyk7XG4gICAgdmFyIHN0cmluZyA9IHR5cGVkVmFsdWUoaXNTdHJpbmcsICdzdHJpbmcnKTtcbiAgICB2YXIgYm9vbGVhbiA9IHR5cGVkVmFsdWUoaXNCb29sZWFuLCAnYm9vbGVhbicpO1xuICAgIHZhciBmdW5jdGlvblByb2Nlc3NvciA9IHR5cGVkVmFsdWUoaXNGdW5jdGlvbiwgJ2Z1bmN0aW9uJyk7XG4gICAgdmFyIGlzUG9zdE1lc3NhZ2VhYmxlID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgdmFyIGV2ZXJ5ID0gZnVuY3Rpb24gKGl0ZXIsIGNhbGxiYWNrRm4pIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGl0ZXIubmV4dCgpO1xuICAgICAgICB3aGlsZSAoIXJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgaWYgKCFjYWxsYmFja0ZuKHJlc3VsdC52YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0ID0gaXRlci5uZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9O1xuICAgICAgaWYgKE9iamVjdCh2YWwpICE9PSB2YWwpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKHt9LnRvU3RyaW5nLmNhbGwodmFsKS5zbGljZSg4LCAtMSkpIHtcbiAgICAgIGNhc2UgJ0Jvb2xlYW4nOlxuICAgICAgY2FzZSAnTnVtYmVyJzpcbiAgICAgIGNhc2UgJ1N0cmluZyc6XG4gICAgICBjYXNlICdEYXRlJzpcbiAgICAgIGNhc2UgJ1JlZ0V4cCc6XG4gICAgICBjYXNlICdCbG9iJzpcbiAgICAgIGNhc2UgJ0ZpbGVMaXN0JzpcbiAgICAgIGNhc2UgJ0ltYWdlRGF0YSc6XG4gICAgICBjYXNlICdJbWFnZUJpdG1hcCc6XG4gICAgICBjYXNlICdBcnJheUJ1ZmZlcic6XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgY2FzZSAnQXJyYXknOlxuICAgICAgY2FzZSAnT2JqZWN0JzpcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHZhbCkuZXZlcnkoZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgICAgICByZXR1cm4gaXNQb3N0TWVzc2FnZWFibGUodmFsW3Byb3BdKTtcbiAgICAgICAgfSk7XG4gICAgICBjYXNlICdNYXAnOlxuICAgICAgICByZXR1cm4gZXZlcnkodmFsLmtleXMoKSwgaXNQb3N0TWVzc2FnZWFibGUpICYmIGV2ZXJ5KHZhbC52YWx1ZXMoKSwgaXNQb3N0TWVzc2FnZWFibGUpO1xuICAgICAgY2FzZSAnU2V0JzpcbiAgICAgICAgcmV0dXJuIGV2ZXJ5KHZhbC5rZXlzKCksIGlzUG9zdE1lc3NhZ2VhYmxlKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBwb3N0TWVzc2FnZWFibGUgPSB2YWx1ZSQxKGZ1bmN0aW9uIChhKSB7XG4gICAgICByZXR1cm4gaXNQb3N0TWVzc2FnZWFibGUoYSkgPyBTaW1wbGVSZXN1bHQuc3ZhbHVlKGEpIDogU2ltcGxlUmVzdWx0LnNlcnJvcignRXhwZWN0ZWQgdmFsdWUgdG8gYmUgYWNjZXB0YWJsZSBmb3Igc2VuZGluZyB2aWEgcG9zdE1lc3NhZ2UnKTtcbiAgICB9KTtcblxuICAgIHZhciB2YWxpZGF0ZUVudW0gPSBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgICByZXR1cm4gdmFsdWVPZihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zKHZhbHVlcywgdmFsdWUpID8gUmVzdWx0LnZhbHVlKHZhbHVlKSA6IFJlc3VsdC5lcnJvcignVW5zdXBwb3J0ZWQgdmFsdWU6IFwiJyArIHZhbHVlICsgJ1wiLCBjaG9vc2Ugb25lIG9mIFwiJyArIHZhbHVlcy5qb2luKCcsICcpICsgJ1wiLicpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc3RyaWN0JDEgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIHN0cmljdCgpLCBhbnlWYWx1ZSgpKTtcbiAgICB9O1xuICAgIHZhciBzdHJpY3RPZiA9IGZ1bmN0aW9uIChrZXksIHNjaGVtYSkge1xuICAgICAgcmV0dXJuIGZpZWxkKGtleSwga2V5LCBzdHJpY3QoKSwgc2NoZW1hKTtcbiAgICB9O1xuICAgIHZhciBzdHJpY3ROdW1iZXIgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICByZXR1cm4gc3RyaWN0T2Yoa2V5LCBudW1iZXIpO1xuICAgIH07XG4gICAgdmFyIHN0cmljdFN0cmluZyA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHJldHVybiBzdHJpY3RPZihrZXksIHN0cmluZyk7XG4gICAgfTtcbiAgICB2YXIgc3RyaWN0U3RyaW5nRW51bSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlcykge1xuICAgICAgcmV0dXJuIGZpZWxkKGtleSwga2V5LCBzdHJpY3QoKSwgdmFsaWRhdGVFbnVtKHZhbHVlcykpO1xuICAgIH07XG4gICAgdmFyIHN0cmljdEJvb2xlYW4gPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICByZXR1cm4gc3RyaWN0T2Yoa2V5LCBib29sZWFuKTtcbiAgICB9O1xuICAgIHZhciBzdHJpY3RGdW5jdGlvbiA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHJldHVybiBzdHJpY3RPZihrZXksIGZ1bmN0aW9uUHJvY2Vzc29yKTtcbiAgICB9O1xuICAgIHZhciBmb3JiaWQgPSBmdW5jdGlvbiAoa2V5LCBtZXNzYWdlKSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIGFzT3B0aW9uKCksIHZhbHVlJDEoZnVuY3Rpb24gKF92KSB7XG4gICAgICAgIHJldHVybiBTaW1wbGVSZXN1bHQuc2Vycm9yKCdUaGUgZmllbGQ6ICcgKyBrZXkgKyAnIGlzIGZvcmJpZGRlbi4gJyArIG1lc3NhZ2UpO1xuICAgICAgfSkpO1xuICAgIH07XG4gICAgdmFyIHN0cmljdE9iak9mID0gZnVuY3Rpb24gKGtleSwgb2JqU2NoZW1hKSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIHN0cmljdCgpLCBvYmpPZihvYmpTY2hlbWEpKTtcbiAgICB9O1xuICAgIHZhciBzdHJpY3RBcnJheU9mT2JqID0gZnVuY3Rpb24gKGtleSwgb2JqRmllbGRzKSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIHN0cmljdCgpLCBhcnJPZk9iaihvYmpGaWVsZHMpKTtcbiAgICB9O1xuICAgIHZhciBzdHJpY3RBcnJheU9mID0gZnVuY3Rpb24gKGtleSwgc2NoZW1hKSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIHN0cmljdCgpLCBhcnJPZihzY2hlbWEpKTtcbiAgICB9O1xuICAgIHZhciBvcHRpb24gPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIGFzT3B0aW9uKCksIGFueVZhbHVlKCkpO1xuICAgIH07XG4gICAgdmFyIG9wdGlvbk9mID0gZnVuY3Rpb24gKGtleSwgc2NoZW1hKSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIGFzT3B0aW9uKCksIHNjaGVtYSk7XG4gICAgfTtcbiAgICB2YXIgb3B0aW9uTnVtYmVyID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgcmV0dXJuIG9wdGlvbk9mKGtleSwgbnVtYmVyKTtcbiAgICB9O1xuICAgIHZhciBvcHRpb25TdHJpbmcgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICByZXR1cm4gb3B0aW9uT2Yoa2V5LCBzdHJpbmcpO1xuICAgIH07XG4gICAgdmFyIG9wdGlvbkZ1bmN0aW9uID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgcmV0dXJuIG9wdGlvbk9mKGtleSwgZnVuY3Rpb25Qcm9jZXNzb3IpO1xuICAgIH07XG4gICAgdmFyIG9wdGlvbkFycmF5T2YgPSBmdW5jdGlvbiAoa2V5LCBzY2hlbWEpIHtcbiAgICAgIHJldHVybiBvcHRpb25PZihrZXksIGFyck9mKHNjaGVtYSkpO1xuICAgIH07XG4gICAgdmFyIG9wdGlvbk9iak9mID0gZnVuY3Rpb24gKGtleSwgb2JqU2NoZW1hKSB7XG4gICAgICByZXR1cm4gb3B0aW9uT2Yoa2V5LCBvYmpPZihvYmpTY2hlbWEpKTtcbiAgICB9O1xuICAgIHZhciBvcHRpb25PYmpPZk9ubHkgPSBmdW5jdGlvbiAoa2V5LCBvYmpTY2hlbWEpIHtcbiAgICAgIHJldHVybiBvcHRpb25PZihrZXksIG9iak9mT25seShvYmpTY2hlbWEpKTtcbiAgICB9O1xuICAgIHZhciBkZWZhdWx0ZWQkMSA9IGZ1bmN0aW9uIChrZXksIGZhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gZmllbGQoa2V5LCBrZXksIGRlZmF1bHRlZChmYWxsYmFjayksIGFueVZhbHVlKCkpO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRlZE9mID0gZnVuY3Rpb24gKGtleSwgZmFsbGJhY2ssIHNjaGVtYSkge1xuICAgICAgcmV0dXJuIGZpZWxkKGtleSwga2V5LCBkZWZhdWx0ZWQoZmFsbGJhY2spLCBzY2hlbWEpO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRlZE51bWJlciA9IGZ1bmN0aW9uIChrZXksIGZhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdGVkT2Yoa2V5LCBmYWxsYmFjaywgbnVtYmVyKTtcbiAgICB9O1xuICAgIHZhciBkZWZhdWx0ZWRTdHJpbmcgPSBmdW5jdGlvbiAoa2V5LCBmYWxsYmFjaykge1xuICAgICAgcmV0dXJuIGRlZmF1bHRlZE9mKGtleSwgZmFsbGJhY2ssIHN0cmluZyk7XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdGVkU3RyaW5nRW51bSA9IGZ1bmN0aW9uIChrZXksIGZhbGxiYWNrLCB2YWx1ZXMpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0ZWRPZihrZXksIGZhbGxiYWNrLCB2YWxpZGF0ZUVudW0odmFsdWVzKSk7XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdGVkQm9vbGVhbiA9IGZ1bmN0aW9uIChrZXksIGZhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdGVkT2Yoa2V5LCBmYWxsYmFjaywgYm9vbGVhbik7XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdGVkRnVuY3Rpb24gPSBmdW5jdGlvbiAoa2V5LCBmYWxsYmFjaykge1xuICAgICAgcmV0dXJuIGRlZmF1bHRlZE9mKGtleSwgZmFsbGJhY2ssIGZ1bmN0aW9uUHJvY2Vzc29yKTtcbiAgICB9O1xuICAgIHZhciBkZWZhdWx0ZWRQb3N0TXNnID0gZnVuY3Rpb24gKGtleSwgZmFsbGJhY2spIHtcbiAgICAgIHJldHVybiBkZWZhdWx0ZWRPZihrZXksIGZhbGxiYWNrLCBwb3N0TWVzc2FnZWFibGUpO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRlZEFycmF5T2YgPSBmdW5jdGlvbiAoa2V5LCBmYWxsYmFjaywgc2NoZW1hKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdGVkT2Yoa2V5LCBmYWxsYmFjaywgYXJyT2Yoc2NoZW1hKSk7XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdGVkT2JqT2YgPSBmdW5jdGlvbiAoa2V5LCBmYWxsYmFjaywgb2JqU2NoZW1hKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdGVkT2Yoa2V5LCBmYWxsYmFjaywgb2JqT2Yob2JqU2NoZW1hKSk7XG4gICAgfTtcbiAgICB2YXIgc3RhdGUkMSA9IGZ1bmN0aW9uIChva2V5LCBpbnN0YW50aWF0b3IpIHtcbiAgICAgIHJldHVybiBzdGF0ZShva2V5LCBpbnN0YW50aWF0b3IpO1xuICAgIH07XG5cbiAgICB2YXIgQ2VsbCA9IGZ1bmN0aW9uIChpbml0aWFsKSB7XG4gICAgICB2YXIgdmFsdWUgPSBpbml0aWFsO1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB2YWx1ZSA9IHY7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZnJvbUh0bWwgPSBmdW5jdGlvbiAoaHRtbCwgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBkaXYgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBkaXYuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgIGlmICghZGl2Lmhhc0NoaWxkTm9kZXMoKSB8fCBkaXYuY2hpbGROb2Rlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0hUTUwgZG9lcyBub3QgaGF2ZSBhIHNpbmdsZSByb290IG5vZGUnLCBodG1sKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIVE1MIG11c3QgaGF2ZSBhIHNpbmdsZSByb290IG5vZGUnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmcm9tRG9tKGRpdi5jaGlsZE5vZGVzWzBdKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGFnID0gZnVuY3Rpb24gKHRhZywgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBub2RlID0gZG9jLmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgIHJldHVybiBmcm9tRG9tKG5vZGUpO1xuICAgIH07XG4gICAgdmFyIGZyb21UZXh0ID0gZnVuY3Rpb24gKHRleHQsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgbm9kZSA9IGRvYy5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcbiAgICAgIHJldHVybiBmcm9tRG9tKG5vZGUpO1xuICAgIH07XG4gICAgdmFyIGZyb21Eb20gPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm9kZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IGRvbTogbm9kZSB9O1xuICAgIH07XG4gICAgdmFyIGZyb21Qb2ludCA9IGZ1bmN0aW9uIChkb2NFbG0sIHgsIHkpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGRvY0VsbS5kb20uZWxlbWVudEZyb21Qb2ludCh4LCB5KSkubWFwKGZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIFN1Z2FyRWxlbWVudCA9IHtcbiAgICAgIGZyb21IdG1sOiBmcm9tSHRtbCxcbiAgICAgIGZyb21UYWc6IGZyb21UYWcsXG4gICAgICBmcm9tVGV4dDogZnJvbVRleHQsXG4gICAgICBmcm9tRG9tOiBmcm9tRG9tLFxuICAgICAgZnJvbVBvaW50OiBmcm9tUG9pbnRcbiAgICB9O1xuXG4gICAgdmFyIERldmljZVR5cGUgPSBmdW5jdGlvbiAob3MsIGJyb3dzZXIsIHVzZXJBZ2VudCwgbWVkaWFNYXRjaCkge1xuICAgICAgdmFyIGlzaVBhZCA9IG9zLmlzaU9TKCkgJiYgL2lwYWQvaS50ZXN0KHVzZXJBZ2VudCkgPT09IHRydWU7XG4gICAgICB2YXIgaXNpUGhvbmUgPSBvcy5pc2lPUygpICYmICFpc2lQYWQ7XG4gICAgICB2YXIgaXNNb2JpbGUgPSBvcy5pc2lPUygpIHx8IG9zLmlzQW5kcm9pZCgpO1xuICAgICAgdmFyIGlzVG91Y2ggPSBpc01vYmlsZSB8fCBtZWRpYU1hdGNoKCcocG9pbnRlcjpjb2Fyc2UpJyk7XG4gICAgICB2YXIgaXNUYWJsZXQgPSBpc2lQYWQgfHwgIWlzaVBob25lICYmIGlzTW9iaWxlICYmIG1lZGlhTWF0Y2goJyhtaW4tZGV2aWNlLXdpZHRoOjc2OHB4KScpO1xuICAgICAgdmFyIGlzUGhvbmUgPSBpc2lQaG9uZSB8fCBpc01vYmlsZSAmJiAhaXNUYWJsZXQ7XG4gICAgICB2YXIgaU9Td2VidmlldyA9IGJyb3dzZXIuaXNTYWZhcmkoKSAmJiBvcy5pc2lPUygpICYmIC9zYWZhcmkvaS50ZXN0KHVzZXJBZ2VudCkgPT09IGZhbHNlO1xuICAgICAgdmFyIGlzRGVza3RvcCA9ICFpc1Bob25lICYmICFpc1RhYmxldCAmJiAhaU9Td2VidmlldztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzaVBhZDogY29uc3RhbnQoaXNpUGFkKSxcbiAgICAgICAgaXNpUGhvbmU6IGNvbnN0YW50KGlzaVBob25lKSxcbiAgICAgICAgaXNUYWJsZXQ6IGNvbnN0YW50KGlzVGFibGV0KSxcbiAgICAgICAgaXNQaG9uZTogY29uc3RhbnQoaXNQaG9uZSksXG4gICAgICAgIGlzVG91Y2g6IGNvbnN0YW50KGlzVG91Y2gpLFxuICAgICAgICBpc0FuZHJvaWQ6IG9zLmlzQW5kcm9pZCxcbiAgICAgICAgaXNpT1M6IG9zLmlzaU9TLFxuICAgICAgICBpc1dlYlZpZXc6IGNvbnN0YW50KGlPU3dlYnZpZXcpLFxuICAgICAgICBpc0Rlc2t0b3A6IGNvbnN0YW50KGlzRGVza3RvcClcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBmaXJzdE1hdGNoID0gZnVuY3Rpb24gKHJlZ2V4ZXMsIHMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVnZXhlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgeCA9IHJlZ2V4ZXNbaV07XG4gICAgICAgIGlmICh4LnRlc3QocykpIHtcbiAgICAgICAgICByZXR1cm4geDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHZhciBmaW5kJDIgPSBmdW5jdGlvbiAocmVnZXhlcywgYWdlbnQpIHtcbiAgICAgIHZhciByID0gZmlyc3RNYXRjaChyZWdleGVzLCBhZ2VudCk7XG4gICAgICBpZiAoIXIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtYWpvcjogMCxcbiAgICAgICAgICBtaW5vcjogMFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdmFyIGdyb3VwID0gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgcmV0dXJuIE51bWJlcihhZ2VudC5yZXBsYWNlKHIsICckJyArIGkpKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbnUkMShncm91cCgxKSwgZ3JvdXAoMikpO1xuICAgIH07XG4gICAgdmFyIGRldGVjdCA9IGZ1bmN0aW9uICh2ZXJzaW9uUmVnZXhlcywgYWdlbnQpIHtcbiAgICAgIHZhciBjbGVhbmVkQWdlbnQgPSBTdHJpbmcoYWdlbnQpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAodmVyc2lvblJlZ2V4ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmtub3duKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmluZCQyKHZlcnNpb25SZWdleGVzLCBjbGVhbmVkQWdlbnQpO1xuICAgIH07XG4gICAgdmFyIHVua25vd24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbnUkMSgwLCAwKTtcbiAgICB9O1xuICAgIHZhciBudSQxID0gZnVuY3Rpb24gKG1ham9yLCBtaW5vcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWFqb3I6IG1ham9yLFxuICAgICAgICBtaW5vcjogbWlub3JcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgVmVyc2lvbiA9IHtcbiAgICAgIG51OiBudSQxLFxuICAgICAgZGV0ZWN0OiBkZXRlY3QsXG4gICAgICB1bmtub3duOiB1bmtub3duXG4gICAgfTtcblxuICAgIHZhciBkZXRlY3QkMSA9IGZ1bmN0aW9uIChjYW5kaWRhdGVzLCB1c2VyQWdlbnQpIHtcbiAgICAgIHZhciBhZ2VudCA9IFN0cmluZyh1c2VyQWdlbnQpLnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gZmluZChjYW5kaWRhdGVzLCBmdW5jdGlvbiAoY2FuZGlkYXRlKSB7XG4gICAgICAgIHJldHVybiBjYW5kaWRhdGUuc2VhcmNoKGFnZW50KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRldGVjdEJyb3dzZXIgPSBmdW5jdGlvbiAoYnJvd3NlcnMsIHVzZXJBZ2VudCkge1xuICAgICAgcmV0dXJuIGRldGVjdCQxKGJyb3dzZXJzLCB1c2VyQWdlbnQpLm1hcChmdW5jdGlvbiAoYnJvd3Nlcikge1xuICAgICAgICB2YXIgdmVyc2lvbiA9IFZlcnNpb24uZGV0ZWN0KGJyb3dzZXIudmVyc2lvblJlZ2V4ZXMsIHVzZXJBZ2VudCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY3VycmVudDogYnJvd3Nlci5uYW1lLFxuICAgICAgICAgIHZlcnNpb246IHZlcnNpb25cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRldGVjdE9zID0gZnVuY3Rpb24gKG9zZXMsIHVzZXJBZ2VudCkge1xuICAgICAgcmV0dXJuIGRldGVjdCQxKG9zZXMsIHVzZXJBZ2VudCkubWFwKGZ1bmN0aW9uIChvcykge1xuICAgICAgICB2YXIgdmVyc2lvbiA9IFZlcnNpb24uZGV0ZWN0KG9zLnZlcnNpb25SZWdleGVzLCB1c2VyQWdlbnQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGN1cnJlbnQ6IG9zLm5hbWUsXG4gICAgICAgICAgdmVyc2lvbjogdmVyc2lvblxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgVWFTdHJpbmcgPSB7XG4gICAgICBkZXRlY3RCcm93c2VyOiBkZXRlY3RCcm93c2VyLFxuICAgICAgZGV0ZWN0T3M6IGRldGVjdE9zXG4gICAgfTtcblxuICAgIHZhciBjaGVja1JhbmdlID0gZnVuY3Rpb24gKHN0ciwgc3Vic3RyLCBzdGFydCkge1xuICAgICAgcmV0dXJuIHN1YnN0ciA9PT0gJycgfHwgc3RyLmxlbmd0aCA+PSBzdWJzdHIubGVuZ3RoICYmIHN0ci5zdWJzdHIoc3RhcnQsIHN0YXJ0ICsgc3Vic3RyLmxlbmd0aCkgPT09IHN1YnN0cjtcbiAgICB9O1xuICAgIHZhciBjb250YWlucyQxID0gZnVuY3Rpb24gKHN0ciwgc3Vic3RyKSB7XG4gICAgICByZXR1cm4gc3RyLmluZGV4T2Yoc3Vic3RyKSAhPT0gLTE7XG4gICAgfTtcbiAgICB2YXIgZW5kc1dpdGggPSBmdW5jdGlvbiAoc3RyLCBzdWZmaXgpIHtcbiAgICAgIHJldHVybiBjaGVja1JhbmdlKHN0ciwgc3VmZml4LCBzdHIubGVuZ3RoIC0gc3VmZml4Lmxlbmd0aCk7XG4gICAgfTtcbiAgICB2YXIgYmxhbmsgPSBmdW5jdGlvbiAocikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzLnJlcGxhY2UociwgJycpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0cmltID0gYmxhbmsoL15cXHMrfFxccyskL2cpO1xuXG4gICAgdmFyIG5vcm1hbFZlcnNpb25SZWdleCA9IC8uKj92ZXJzaW9uXFwvXFwgPyhbMC05XSspXFwuKFswLTldKykuKi87XG4gICAgdmFyIGNoZWNrQ29udGFpbnMgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHVhc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBjb250YWlucyQxKHVhc3RyaW5nLCB0YXJnZXQpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBicm93c2VycyA9IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0VkZ2UnLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj9lZGdlXFwvID8oWzAtOV0rKVxcLihbMC05XSspJC9dLFxuICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uICh1YXN0cmluZykge1xuICAgICAgICAgIHJldHVybiBjb250YWlucyQxKHVhc3RyaW5nLCAnZWRnZS8nKSAmJiBjb250YWlucyQxKHVhc3RyaW5nLCAnY2hyb21lJykgJiYgY29udGFpbnMkMSh1YXN0cmluZywgJ3NhZmFyaScpICYmIGNvbnRhaW5zJDEodWFzdHJpbmcsICdhcHBsZXdlYmtpdCcpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnQ2hyb21lJyxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtcbiAgICAgICAgICAvLio/Y2hyb21lXFwvKFswLTldKylcXC4oWzAtOV0rKS4qLyxcbiAgICAgICAgICBub3JtYWxWZXJzaW9uUmVnZXhcbiAgICAgICAgXSxcbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbnMkMSh1YXN0cmluZywgJ2Nocm9tZScpICYmICFjb250YWlucyQxKHVhc3RyaW5nLCAnY2hyb21lZnJhbWUnKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0lFJyxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtcbiAgICAgICAgICAvLio/bXNpZVxcID8oWzAtOV0rKVxcLihbMC05XSspLiovLFxuICAgICAgICAgIC8uKj9ydjooWzAtOV0rKVxcLihbMC05XSspLiovXG4gICAgICAgIF0sXG4gICAgICAgIHNlYXJjaDogZnVuY3Rpb24gKHVhc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5zJDEodWFzdHJpbmcsICdtc2llJykgfHwgY29udGFpbnMkMSh1YXN0cmluZywgJ3RyaWRlbnQnKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ09wZXJhJyxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtcbiAgICAgICAgICBub3JtYWxWZXJzaW9uUmVnZXgsXG4gICAgICAgICAgLy4qP29wZXJhXFwvKFswLTldKylcXC4oWzAtOV0rKS4qL1xuICAgICAgICBdLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ29wZXJhJylcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdGaXJlZm94JyxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/ZmlyZWZveFxcL1xcID8oWzAtOV0rKVxcLihbMC05XSspLiovXSxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdmaXJlZm94JylcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdTYWZhcmknLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIG5vcm1hbFZlcnNpb25SZWdleCxcbiAgICAgICAgICAvLio/Y3B1IG9zIChbMC05XSspXyhbMC05XSspLiovXG4gICAgICAgIF0sXG4gICAgICAgIHNlYXJjaDogZnVuY3Rpb24gKHVhc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIChjb250YWlucyQxKHVhc3RyaW5nLCAnc2FmYXJpJykgfHwgY29udGFpbnMkMSh1YXN0cmluZywgJ21vYmlsZS8nKSkgJiYgY29udGFpbnMkMSh1YXN0cmluZywgJ2FwcGxld2Via2l0Jyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBdO1xuICAgIHZhciBvc2VzID0gW1xuICAgICAge1xuICAgICAgICBuYW1lOiAnV2luZG93cycsXG4gICAgICAgIHNlYXJjaDogY2hlY2tDb250YWlucygnd2luJyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP3dpbmRvd3NcXCBudFxcID8oWzAtOV0rKVxcLihbMC05XSspLiovXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2lPUycsXG4gICAgICAgIHNlYXJjaDogZnVuY3Rpb24gKHVhc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5zJDEodWFzdHJpbmcsICdpcGhvbmUnKSB8fCBjb250YWlucyQxKHVhc3RyaW5nLCAnaXBhZCcpO1xuICAgICAgICB9LFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIC8uKj92ZXJzaW9uXFwvXFwgPyhbMC05XSspXFwuKFswLTldKykuKi8sXG4gICAgICAgICAgLy4qY3B1IG9zIChbMC05XSspXyhbMC05XSspLiovLFxuICAgICAgICAgIC8uKmNwdSBpcGhvbmUgb3MgKFswLTldKylfKFswLTldKykuKi9cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0FuZHJvaWQnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ2FuZHJvaWQnKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/YW5kcm9pZFxcID8oWzAtOV0rKVxcLihbMC05XSspLiovXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ09TWCcsXG4gICAgICAgIHNlYXJjaDogY2hlY2tDb250YWlucygnbWFjIG9zIHgnKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/bWFjXFwgb3NcXCB4XFwgPyhbMC05XSspXyhbMC05XSspLiovXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0xpbnV4JyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdsaW51eCcpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdTb2xhcmlzJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdzdW5vcycpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdGcmVlQlNEJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdmcmVlYnNkJyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0Nocm9tZU9TJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdjcm9zJyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2Nocm9tZVxcLyhbMC05XSspXFwuKFswLTldKykuKi9dXG4gICAgICB9XG4gICAgXTtcbiAgICB2YXIgUGxhdGZvcm1JbmZvID0ge1xuICAgICAgYnJvd3NlcnM6IGNvbnN0YW50KGJyb3dzZXJzKSxcbiAgICAgIG9zZXM6IGNvbnN0YW50KG9zZXMpXG4gICAgfTtcblxuICAgIHZhciBlZGdlID0gJ0VkZ2UnO1xuICAgIHZhciBjaHJvbWUgPSAnQ2hyb21lJztcbiAgICB2YXIgaWUgPSAnSUUnO1xuICAgIHZhciBvcGVyYSA9ICdPcGVyYSc7XG4gICAgdmFyIGZpcmVmb3ggPSAnRmlyZWZveCc7XG4gICAgdmFyIHNhZmFyaSA9ICdTYWZhcmknO1xuICAgIHZhciB1bmtub3duJDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbnUkMih7XG4gICAgICAgIGN1cnJlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdmVyc2lvbjogVmVyc2lvbi51bmtub3duKClcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG51JDIgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgdmFyIGN1cnJlbnQgPSBpbmZvLmN1cnJlbnQ7XG4gICAgICB2YXIgdmVyc2lvbiA9IGluZm8udmVyc2lvbjtcbiAgICAgIHZhciBpc0Jyb3dzZXIgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50ID09PSBuYW1lO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnQ6IGN1cnJlbnQsXG4gICAgICAgIHZlcnNpb246IHZlcnNpb24sXG4gICAgICAgIGlzRWRnZTogaXNCcm93c2VyKGVkZ2UpLFxuICAgICAgICBpc0Nocm9tZTogaXNCcm93c2VyKGNocm9tZSksXG4gICAgICAgIGlzSUU6IGlzQnJvd3NlcihpZSksXG4gICAgICAgIGlzT3BlcmE6IGlzQnJvd3NlcihvcGVyYSksXG4gICAgICAgIGlzRmlyZWZveDogaXNCcm93c2VyKGZpcmVmb3gpLFxuICAgICAgICBpc1NhZmFyaTogaXNCcm93c2VyKHNhZmFyaSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgQnJvd3NlciA9IHtcbiAgICAgIHVua25vd246IHVua25vd24kMSxcbiAgICAgIG51OiBudSQyLFxuICAgICAgZWRnZTogY29uc3RhbnQoZWRnZSksXG4gICAgICBjaHJvbWU6IGNvbnN0YW50KGNocm9tZSksXG4gICAgICBpZTogY29uc3RhbnQoaWUpLFxuICAgICAgb3BlcmE6IGNvbnN0YW50KG9wZXJhKSxcbiAgICAgIGZpcmVmb3g6IGNvbnN0YW50KGZpcmVmb3gpLFxuICAgICAgc2FmYXJpOiBjb25zdGFudChzYWZhcmkpXG4gICAgfTtcblxuICAgIHZhciB3aW5kb3dzID0gJ1dpbmRvd3MnO1xuICAgIHZhciBpb3MgPSAnaU9TJztcbiAgICB2YXIgYW5kcm9pZCA9ICdBbmRyb2lkJztcbiAgICB2YXIgbGludXggPSAnTGludXgnO1xuICAgIHZhciBvc3ggPSAnT1NYJztcbiAgICB2YXIgc29sYXJpcyA9ICdTb2xhcmlzJztcbiAgICB2YXIgZnJlZWJzZCA9ICdGcmVlQlNEJztcbiAgICB2YXIgY2hyb21lb3MgPSAnQ2hyb21lT1MnO1xuICAgIHZhciB1bmtub3duJDIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbnUkMyh7XG4gICAgICAgIGN1cnJlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgdmVyc2lvbjogVmVyc2lvbi51bmtub3duKClcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG51JDMgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgdmFyIGN1cnJlbnQgPSBpbmZvLmN1cnJlbnQ7XG4gICAgICB2YXIgdmVyc2lvbiA9IGluZm8udmVyc2lvbjtcbiAgICAgIHZhciBpc09TID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudCA9PT0gbmFtZTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjdXJyZW50OiBjdXJyZW50LFxuICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICBpc1dpbmRvd3M6IGlzT1Mod2luZG93cyksXG4gICAgICAgIGlzaU9TOiBpc09TKGlvcyksXG4gICAgICAgIGlzQW5kcm9pZDogaXNPUyhhbmRyb2lkKSxcbiAgICAgICAgaXNPU1g6IGlzT1Mob3N4KSxcbiAgICAgICAgaXNMaW51eDogaXNPUyhsaW51eCksXG4gICAgICAgIGlzU29sYXJpczogaXNPUyhzb2xhcmlzKSxcbiAgICAgICAgaXNGcmVlQlNEOiBpc09TKGZyZWVic2QpLFxuICAgICAgICBpc0Nocm9tZU9TOiBpc09TKGNocm9tZW9zKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBPcGVyYXRpbmdTeXN0ZW0gPSB7XG4gICAgICB1bmtub3duOiB1bmtub3duJDIsXG4gICAgICBudTogbnUkMyxcbiAgICAgIHdpbmRvd3M6IGNvbnN0YW50KHdpbmRvd3MpLFxuICAgICAgaW9zOiBjb25zdGFudChpb3MpLFxuICAgICAgYW5kcm9pZDogY29uc3RhbnQoYW5kcm9pZCksXG4gICAgICBsaW51eDogY29uc3RhbnQobGludXgpLFxuICAgICAgb3N4OiBjb25zdGFudChvc3gpLFxuICAgICAgc29sYXJpczogY29uc3RhbnQoc29sYXJpcyksXG4gICAgICBmcmVlYnNkOiBjb25zdGFudChmcmVlYnNkKSxcbiAgICAgIGNocm9tZW9zOiBjb25zdGFudChjaHJvbWVvcylcbiAgICB9O1xuXG4gICAgdmFyIGRldGVjdCQyID0gZnVuY3Rpb24gKHVzZXJBZ2VudCwgbWVkaWFNYXRjaCkge1xuICAgICAgdmFyIGJyb3dzZXJzID0gUGxhdGZvcm1JbmZvLmJyb3dzZXJzKCk7XG4gICAgICB2YXIgb3NlcyA9IFBsYXRmb3JtSW5mby5vc2VzKCk7XG4gICAgICB2YXIgYnJvd3NlciA9IFVhU3RyaW5nLmRldGVjdEJyb3dzZXIoYnJvd3NlcnMsIHVzZXJBZ2VudCkuZm9sZChCcm93c2VyLnVua25vd24sIEJyb3dzZXIubnUpO1xuICAgICAgdmFyIG9zID0gVWFTdHJpbmcuZGV0ZWN0T3Mob3NlcywgdXNlckFnZW50KS5mb2xkKE9wZXJhdGluZ1N5c3RlbS51bmtub3duLCBPcGVyYXRpbmdTeXN0ZW0ubnUpO1xuICAgICAgdmFyIGRldmljZVR5cGUgPSBEZXZpY2VUeXBlKG9zLCBicm93c2VyLCB1c2VyQWdlbnQsIG1lZGlhTWF0Y2gpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYnJvd3NlcjogYnJvd3NlcixcbiAgICAgICAgb3M6IG9zLFxuICAgICAgICBkZXZpY2VUeXBlOiBkZXZpY2VUeXBlXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFBsYXRmb3JtRGV0ZWN0aW9uID0geyBkZXRlY3Q6IGRldGVjdCQyIH07XG5cbiAgICB2YXIgbWVkaWFNYXRjaCA9IGZ1bmN0aW9uIChxdWVyeSkge1xuICAgICAgcmV0dXJuIHdpbmRvdy5tYXRjaE1lZGlhKHF1ZXJ5KS5tYXRjaGVzO1xuICAgIH07XG4gICAgdmFyIHBsYXRmb3JtID0gY2FjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBQbGF0Zm9ybURldGVjdGlvbi5kZXRlY3QobmF2aWdhdG9yLnVzZXJBZ2VudCwgbWVkaWFNYXRjaCk7XG4gICAgfSk7XG4gICAgdmFyIGRldGVjdCQzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHBsYXRmb3JtKCk7XG4gICAgfTtcblxuICAgIHZhciBjb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA9IGZ1bmN0aW9uIChhLCBiLCBtYXRjaCkge1xuICAgICAgcmV0dXJuIChhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgbWF0Y2gpICE9PSAwO1xuICAgIH07XG4gICAgdmFyIGRvY3VtZW50UG9zaXRpb25Db250YWluZWRCeSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gY29tcGFyZURvY3VtZW50UG9zaXRpb24oYSwgYiwgTm9kZS5ET0NVTUVOVF9QT1NJVElPTl9DT05UQUlORURfQlkpO1xuICAgIH07XG5cbiAgICB2YXIgRE9DVU1FTlQgPSA5O1xuICAgIHZhciBET0NVTUVOVF9GUkFHTUVOVCA9IDExO1xuICAgIHZhciBFTEVNRU5UID0gMTtcbiAgICB2YXIgVEVYVCA9IDM7XG5cbiAgICB2YXIgaXMgPSBmdW5jdGlvbiAoZWxlbWVudCwgc2VsZWN0b3IpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIGlmIChkb20ubm9kZVR5cGUgIT09IEVMRU1FTlQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGVsZW0gPSBkb207XG4gICAgICAgIGlmIChlbGVtLm1hdGNoZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLm1hdGNoZXMoc2VsZWN0b3IpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubXNNYXRjaGVzU2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLndlYmtpdE1hdGNoZXNTZWxlY3RvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuIGVsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLm1vek1hdGNoZXNTZWxlY3RvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuIGVsZW0ubW96TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Jyb3dzZXIgbGFja3MgbmF0aXZlIHNlbGVjdG9ycycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgYnlwYXNzU2VsZWN0b3IgPSBmdW5jdGlvbiAoZG9tKSB7XG4gICAgICByZXR1cm4gZG9tLm5vZGVUeXBlICE9PSBFTEVNRU5UICYmIGRvbS5ub2RlVHlwZSAhPT0gRE9DVU1FTlQgJiYgZG9tLm5vZGVUeXBlICE9PSBET0NVTUVOVF9GUkFHTUVOVCB8fCBkb20uY2hpbGRFbGVtZW50Q291bnQgPT09IDA7XG4gICAgfTtcbiAgICB2YXIgYWxsID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBzY29wZSkge1xuICAgICAgdmFyIGJhc2UgPSBzY29wZSA9PT0gdW5kZWZpbmVkID8gZG9jdW1lbnQgOiBzY29wZS5kb207XG4gICAgICByZXR1cm4gYnlwYXNzU2VsZWN0b3IoYmFzZSkgPyBbXSA6IG1hcChiYXNlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLCBTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcbiAgICB2YXIgb25lID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBzY29wZSkge1xuICAgICAgdmFyIGJhc2UgPSBzY29wZSA9PT0gdW5kZWZpbmVkID8gZG9jdW1lbnQgOiBzY29wZS5kb207XG4gICAgICByZXR1cm4gYnlwYXNzU2VsZWN0b3IoYmFzZSkgPyBPcHRpb25hbC5ub25lKCkgOiBPcHRpb25hbC5mcm9tKGJhc2UucXVlcnlTZWxlY3RvcihzZWxlY3RvcikpLm1hcChTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcblxuICAgIHZhciBlcSQxID0gZnVuY3Rpb24gKGUxLCBlMikge1xuICAgICAgcmV0dXJuIGUxLmRvbSA9PT0gZTIuZG9tO1xuICAgIH07XG4gICAgdmFyIHJlZ3VsYXJDb250YWlucyA9IGZ1bmN0aW9uIChlMSwgZTIpIHtcbiAgICAgIHZhciBkMSA9IGUxLmRvbTtcbiAgICAgIHZhciBkMiA9IGUyLmRvbTtcbiAgICAgIHJldHVybiBkMSA9PT0gZDIgPyBmYWxzZSA6IGQxLmNvbnRhaW5zKGQyKTtcbiAgICB9O1xuICAgIHZhciBpZUNvbnRhaW5zID0gZnVuY3Rpb24gKGUxLCBlMikge1xuICAgICAgcmV0dXJuIGRvY3VtZW50UG9zaXRpb25Db250YWluZWRCeShlMS5kb20sIGUyLmRvbSk7XG4gICAgfTtcbiAgICB2YXIgY29udGFpbnMkMiA9IGZ1bmN0aW9uIChlMSwgZTIpIHtcbiAgICAgIHJldHVybiBkZXRlY3QkMygpLmJyb3dzZXIuaXNJRSgpID8gaWVDb250YWlucyhlMSwgZTIpIDogcmVndWxhckNvbnRhaW5zKGUxLCBlMik7XG4gICAgfTtcblxuICAgIHZhciBlbnN1cmVJc1Jvb3QgPSBmdW5jdGlvbiAoaXNSb290KSB7XG4gICAgICByZXR1cm4gaXNGdW5jdGlvbihpc1Jvb3QpID8gaXNSb290IDogbmV2ZXI7XG4gICAgfTtcbiAgICB2YXIgYW5jZXN0b3IgPSBmdW5jdGlvbiAoc2NvcGUsIHRyYW5zZm9ybSwgaXNSb290KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IHNjb3BlLmRvbTtcbiAgICAgIHZhciBzdG9wID0gZW5zdXJlSXNSb290KGlzUm9vdCk7XG4gICAgICB3aGlsZSAoZWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICAgIHZhciBlbCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsZW1lbnQpO1xuICAgICAgICB2YXIgdHJhbnNmb3JtZWQgPSB0cmFuc2Zvcm0oZWwpO1xuICAgICAgICBpZiAodHJhbnNmb3JtZWQuaXNTb21lKCkpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RvcChlbCkpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBjbG9zZXN0ID0gZnVuY3Rpb24gKHNjb3BlLCB0cmFuc2Zvcm0sIGlzUm9vdCkge1xuICAgICAgdmFyIGN1cnJlbnQgPSB0cmFuc2Zvcm0oc2NvcGUpO1xuICAgICAgdmFyIHN0b3AgPSBlbnN1cmVJc1Jvb3QoaXNSb290KTtcbiAgICAgIHJldHVybiBjdXJyZW50Lm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3RvcChzY29wZSkgPyBPcHRpb25hbC5ub25lKCkgOiBhbmNlc3RvcihzY29wZSwgdHJhbnNmb3JtLCBzdG9wKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgaXNTb3VyY2UgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgcmV0dXJuIGVxJDEoY29tcG9uZW50LmVsZW1lbnQsIHNpbXVsYXRlZEV2ZW50LmV2ZW50LnRhcmdldCk7XG4gICAgfTtcblxuICAgIHZhciBudSQ0ID0gZnVuY3Rpb24gKHBhcnRzKSB7XG4gICAgICBpZiAoIWhhc05vbk51bGxhYmxlS2V5KHBhcnRzLCAnY2FuJykgJiYgIWhhc05vbk51bGxhYmxlS2V5KHBhcnRzLCAnYWJvcnQnKSAmJiAhaGFzTm9uTnVsbGFibGVLZXkocGFydHMsICdydW4nKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V2ZW50SGFuZGxlciBkZWZpbmVkIGJ5OiAnICsgSlNPTi5zdHJpbmdpZnkocGFydHMsIG51bGwsIDIpICsgJyBkb2VzIG5vdCBoYXZlIGNhbiwgYWJvcnQsIG9yIHJ1biEnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhc1Jhd09yRGllKCdFeHRyYWN0aW5nIGV2ZW50LmhhbmRsZXInLCBvYmpPZk9ubHkoW1xuICAgICAgICBkZWZhdWx0ZWQkMSgnY2FuJywgYWx3YXlzKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2Fib3J0JywgbmV2ZXIpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgncnVuJywgbm9vcClcbiAgICAgIF0pLCBwYXJ0cyk7XG4gICAgfTtcbiAgICB2YXIgYWxsJDEgPSBmdW5jdGlvbiAoaGFuZGxlcnMsIGYpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmb2xkbChoYW5kbGVycywgZnVuY3Rpb24gKGFjYywgaGFuZGxlcikge1xuICAgICAgICAgIHJldHVybiBhY2MgJiYgZihoYW5kbGVyKS5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xuICAgICAgICB9LCB0cnVlKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYW55ID0gZnVuY3Rpb24gKGhhbmRsZXJzLCBmKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm9sZGwoaGFuZGxlcnMsIGZ1bmN0aW9uIChhY2MsIGhhbmRsZXIpIHtcbiAgICAgICAgICByZXR1cm4gYWNjIHx8IGYoaGFuZGxlcikuYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZWFkID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgIHJldHVybiBpc0Z1bmN0aW9uKGhhbmRsZXIpID8ge1xuICAgICAgICBjYW46IGFsd2F5cyxcbiAgICAgICAgYWJvcnQ6IG5ldmVyLFxuICAgICAgICBydW46IGhhbmRsZXJcbiAgICAgIH0gOiBoYW5kbGVyO1xuICAgIH07XG4gICAgdmFyIGZ1c2UgPSBmdW5jdGlvbiAoaGFuZGxlcnMpIHtcbiAgICAgIHZhciBjYW4gPSBhbGwkMShoYW5kbGVycywgZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgcmV0dXJuIGhhbmRsZXIuY2FuO1xuICAgICAgfSk7XG4gICAgICB2YXIgYWJvcnQgPSBhbnkoaGFuZGxlcnMsIGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHJldHVybiBoYW5kbGVyLmFib3J0O1xuICAgICAgfSk7XG4gICAgICB2YXIgcnVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBlYWNoKGhhbmRsZXJzLCBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICAgIGhhbmRsZXIucnVuLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBudSQ0KHtcbiAgICAgICAgY2FuOiBjYW4sXG4gICAgICAgIGFib3J0OiBhYm9ydCxcbiAgICAgICAgcnVuOiBydW5cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgY29uc3RhbnQkMSA9IGNvbnN0YW50O1xuICAgIHZhciB0b3VjaHN0YXJ0ID0gY29uc3RhbnQkMSgndG91Y2hzdGFydCcpO1xuICAgIHZhciB0b3VjaG1vdmUgPSBjb25zdGFudCQxKCd0b3VjaG1vdmUnKTtcbiAgICB2YXIgdG91Y2hlbmQgPSBjb25zdGFudCQxKCd0b3VjaGVuZCcpO1xuICAgIHZhciB0b3VjaGNhbmNlbCA9IGNvbnN0YW50JDEoJ3RvdWNoY2FuY2VsJyk7XG4gICAgdmFyIG1vdXNlZG93biA9IGNvbnN0YW50JDEoJ21vdXNlZG93bicpO1xuICAgIHZhciBtb3VzZW1vdmUgPSBjb25zdGFudCQxKCdtb3VzZW1vdmUnKTtcbiAgICB2YXIgbW91c2VvdXQgPSBjb25zdGFudCQxKCdtb3VzZW91dCcpO1xuICAgIHZhciBtb3VzZXVwID0gY29uc3RhbnQkMSgnbW91c2V1cCcpO1xuICAgIHZhciBtb3VzZW92ZXIgPSBjb25zdGFudCQxKCdtb3VzZW92ZXInKTtcbiAgICB2YXIgZm9jdXNpbiA9IGNvbnN0YW50JDEoJ2ZvY3VzaW4nKTtcbiAgICB2YXIgZm9jdXNvdXQgPSBjb25zdGFudCQxKCdmb2N1c291dCcpO1xuICAgIHZhciBrZXlkb3duID0gY29uc3RhbnQkMSgna2V5ZG93bicpO1xuICAgIHZhciBrZXl1cCA9IGNvbnN0YW50JDEoJ2tleXVwJyk7XG4gICAgdmFyIGlucHV0ID0gY29uc3RhbnQkMSgnaW5wdXQnKTtcbiAgICB2YXIgY2hhbmdlID0gY29uc3RhbnQkMSgnY2hhbmdlJyk7XG4gICAgdmFyIGNsaWNrID0gY29uc3RhbnQkMSgnY2xpY2snKTtcbiAgICB2YXIgdHJhbnNpdGlvbmVuZCA9IGNvbnN0YW50JDEoJ3RyYW5zaXRpb25lbmQnKTtcbiAgICB2YXIgc2VsZWN0c3RhcnQgPSBjb25zdGFudCQxKCdzZWxlY3RzdGFydCcpO1xuXG4gICAgdmFyIHByZWZpeE5hbWUgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgcmV0dXJuIGNvbnN0YW50KCdhbGxveS4nICsgbmFtZSk7XG4gICAgfTtcbiAgICB2YXIgYWxsb3kgPSB7IHRhcDogcHJlZml4TmFtZSgndGFwJykgfTtcbiAgICB2YXIgZm9jdXMgPSBwcmVmaXhOYW1lKCdmb2N1cycpO1xuICAgIHZhciBwb3N0Qmx1ciA9IHByZWZpeE5hbWUoJ2JsdXIucG9zdCcpO1xuICAgIHZhciBwb3N0UGFzdGUgPSBwcmVmaXhOYW1lKCdwYXN0ZS5wb3N0Jyk7XG4gICAgdmFyIHJlY2VpdmUgPSBwcmVmaXhOYW1lKCdyZWNlaXZlJyk7XG4gICAgdmFyIGV4ZWN1dGUgPSBwcmVmaXhOYW1lKCdleGVjdXRlJyk7XG4gICAgdmFyIGZvY3VzSXRlbSA9IHByZWZpeE5hbWUoJ2ZvY3VzLml0ZW0nKTtcbiAgICB2YXIgdGFwID0gYWxsb3kudGFwO1xuICAgIHZhciBsb25ncHJlc3MgPSBwcmVmaXhOYW1lKCdsb25ncHJlc3MnKTtcbiAgICB2YXIgc2FuZGJveENsb3NlID0gcHJlZml4TmFtZSgnc2FuZGJveC5jbG9zZScpO1xuICAgIHZhciB0eXBlYWhlYWRDYW5jZWwgPSBwcmVmaXhOYW1lKCd0eXBlYWhlYWQuY2FuY2VsJyk7XG4gICAgdmFyIHN5c3RlbUluaXQgPSBwcmVmaXhOYW1lKCdzeXN0ZW0uaW5pdCcpO1xuICAgIHZhciBkb2N1bWVudFRvdWNobW92ZSA9IHByZWZpeE5hbWUoJ3N5c3RlbS50b3VjaG1vdmUnKTtcbiAgICB2YXIgZG9jdW1lbnRUb3VjaGVuZCA9IHByZWZpeE5hbWUoJ3N5c3RlbS50b3VjaGVuZCcpO1xuICAgIHZhciB3aW5kb3dTY3JvbGwgPSBwcmVmaXhOYW1lKCdzeXN0ZW0uc2Nyb2xsJyk7XG4gICAgdmFyIHdpbmRvd1Jlc2l6ZSA9IHByZWZpeE5hbWUoJ3N5c3RlbS5yZXNpemUnKTtcbiAgICB2YXIgYXR0YWNoZWRUb0RvbSA9IHByZWZpeE5hbWUoJ3N5c3RlbS5hdHRhY2hlZCcpO1xuICAgIHZhciBkZXRhY2hlZEZyb21Eb20gPSBwcmVmaXhOYW1lKCdzeXN0ZW0uZGV0YWNoZWQnKTtcbiAgICB2YXIgZGlzbWlzc1JlcXVlc3RlZCA9IHByZWZpeE5hbWUoJ3N5c3RlbS5kaXNtaXNzUmVxdWVzdGVkJyk7XG4gICAgdmFyIHJlcG9zaXRpb25SZXF1ZXN0ZWQgPSBwcmVmaXhOYW1lKCdzeXN0ZW0ucmVwb3NpdGlvblJlcXVlc3RlZCcpO1xuICAgIHZhciBmb2N1c1NoaWZ0ZWQgPSBwcmVmaXhOYW1lKCdmb2N1c21hbmFnZXIuc2hpZnRlZCcpO1xuICAgIHZhciBzbG90VmlzaWJpbGl0eSA9IHByZWZpeE5hbWUoJ3Nsb3Rjb250YWluZXIudmlzaWJpbGl0eScpO1xuICAgIHZhciBjaGFuZ2VUYWIgPSBwcmVmaXhOYW1lKCdjaGFuZ2UudGFiJyk7XG4gICAgdmFyIGRpc21pc3NUYWIgPSBwcmVmaXhOYW1lKCdkaXNtaXNzLnRhYicpO1xuICAgIHZhciBoaWdobGlnaHQgPSBwcmVmaXhOYW1lKCdoaWdobGlnaHQnKTtcbiAgICB2YXIgZGVoaWdobGlnaHQgPSBwcmVmaXhOYW1lKCdkZWhpZ2hsaWdodCcpO1xuXG4gICAgdmFyIGVtaXQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBldmVudCkge1xuICAgICAgZGlzcGF0Y2hXaXRoKGNvbXBvbmVudCwgY29tcG9uZW50LmVsZW1lbnQsIGV2ZW50LCB7fSk7XG4gICAgfTtcbiAgICB2YXIgZW1pdFdpdGggPSBmdW5jdGlvbiAoY29tcG9uZW50LCBldmVudCwgcHJvcGVydGllcykge1xuICAgICAgZGlzcGF0Y2hXaXRoKGNvbXBvbmVudCwgY29tcG9uZW50LmVsZW1lbnQsIGV2ZW50LCBwcm9wZXJ0aWVzKTtcbiAgICB9O1xuICAgIHZhciBlbWl0RXhlY3V0ZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIGVtaXQoY29tcG9uZW50LCBleGVjdXRlKCkpO1xuICAgIH07XG4gICAgdmFyIGRpc3BhdGNoID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgdGFyZ2V0LCBldmVudCkge1xuICAgICAgZGlzcGF0Y2hXaXRoKGNvbXBvbmVudCwgdGFyZ2V0LCBldmVudCwge30pO1xuICAgIH07XG4gICAgdmFyIGRpc3BhdGNoV2l0aCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRhcmdldCwgZXZlbnQsIHByb3BlcnRpZXMpIHtcbiAgICAgIHZhciBkYXRhID0gX19hc3NpZ24oeyB0YXJnZXQ6IHRhcmdldCB9LCBwcm9wZXJ0aWVzKTtcbiAgICAgIGNvbXBvbmVudC5nZXRTeXN0ZW0oKS50cmlnZ2VyRXZlbnQoZXZlbnQsIHRhcmdldCwgZGF0YSk7XG4gICAgfTtcbiAgICB2YXIgZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRhcmdldCwgZXZlbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkudHJpZ2dlckV2ZW50KGV2ZW50LCB0YXJnZXQsIHNpbXVsYXRlZEV2ZW50LmV2ZW50KTtcbiAgICB9O1xuXG4gICAgdmFyIGRlcml2ZSA9IGZ1bmN0aW9uIChjb25maWdzKSB7XG4gICAgICByZXR1cm4gd3JhcEFsbCQxKGNvbmZpZ3MpO1xuICAgIH07XG4gICAgdmFyIGFib3J0ID0gZnVuY3Rpb24gKG5hbWUsIHByZWRpY2F0ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5OiBuYW1lLFxuICAgICAgICB2YWx1ZTogbnUkNCh7IGFib3J0OiBwcmVkaWNhdGUgfSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY2FuID0gZnVuY3Rpb24gKG5hbWUsIHByZWRpY2F0ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5OiBuYW1lLFxuICAgICAgICB2YWx1ZTogbnUkNCh7IGNhbjogcHJlZGljYXRlIH0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGtleTogbmFtZSxcbiAgICAgICAgdmFsdWU6IG51JDQoe1xuICAgICAgICAgIHJ1bjogZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgIHNpbXVsYXRlZEV2ZW50LmV2ZW50LnByZXZlbnQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJ1biA9IGZ1bmN0aW9uIChuYW1lLCBoYW5kbGVyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBrZXk6IG5hbWUsXG4gICAgICAgIHZhbHVlOiBudSQ0KHsgcnVuOiBoYW5kbGVyIH0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJ1bkFjdGlvbkV4dHJhID0gZnVuY3Rpb24gKG5hbWUsIGFjdGlvbiwgZXh0cmEpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGtleTogbmFtZSxcbiAgICAgICAgdmFsdWU6IG51JDQoe1xuICAgICAgICAgIHJ1bjogZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgIGFjdGlvbi5hcHBseSh1bmRlZmluZWQsIFtcbiAgICAgICAgICAgICAgY29tcG9uZW50LFxuICAgICAgICAgICAgICBzaW11bGF0ZWRFdmVudFxuICAgICAgICAgICAgXS5jb25jYXQoZXh0cmEpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJ1bk9uTmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgcmV0dXJuIHJ1bihuYW1lLCBoYW5kbGVyKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcnVuT25Tb3VyY2VOYW1lID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGtleTogbmFtZSxcbiAgICAgICAgICB2YWx1ZTogbnUkNCh7XG4gICAgICAgICAgICBydW46IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICAgIGlmIChpc1NvdXJjZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSkge1xuICAgICAgICAgICAgICAgIGhhbmRsZXIoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZWRpcmVjdFRvVWlkID0gZnVuY3Rpb24gKG5hbWUsIHVpZCkge1xuICAgICAgcmV0dXJuIHJ1bihuYW1lLCBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlVaWQodWlkKS5lYWNoKGZ1bmN0aW9uIChyZWRpcmVjdGVlKSB7XG4gICAgICAgICAgZGlzcGF0Y2hFdmVudChyZWRpcmVjdGVlLCByZWRpcmVjdGVlLmVsZW1lbnQsIG5hbWUsIHNpbXVsYXRlZEV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWRpcmVjdFRvUGFydCA9IGZ1bmN0aW9uIChuYW1lLCBkZXRhaWwsIHBhcnROYW1lKSB7XG4gICAgICB2YXIgdWlkID0gZGV0YWlsLnBhcnRVaWRzW3BhcnROYW1lXTtcbiAgICAgIHJldHVybiByZWRpcmVjdFRvVWlkKG5hbWUsIHVpZCk7XG4gICAgfTtcbiAgICB2YXIgcnVuV2l0aFRhcmdldCA9IGZ1bmN0aW9uIChuYW1lLCBmKSB7XG4gICAgICByZXR1cm4gcnVuKG5hbWUsIGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHZhciBldiA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50O1xuICAgICAgICB2YXIgdGFyZ2V0ID0gY29tcG9uZW50LmdldFN5c3RlbSgpLmdldEJ5RG9tKGV2LnRhcmdldCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGNsb3Nlc3QkMSA9IGNsb3Nlc3QoZXYudGFyZ2V0LCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20oZWwpLnRvT3B0aW9uYWwoKTtcbiAgICAgICAgICB9LCBuZXZlcik7XG4gICAgICAgICAgcmV0dXJuIGNsb3Nlc3QkMS5nZXRPcihjb21wb25lbnQpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoYykge1xuICAgICAgICAgIHJldHVybiBjO1xuICAgICAgICB9KTtcbiAgICAgICAgZihjb21wb25lbnQsIHRhcmdldCwgc2ltdWxhdGVkRXZlbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY3V0dGVyID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBydW4obmFtZSwgZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgc2ltdWxhdGVkRXZlbnQuY3V0KCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzdG9wcGVyID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBydW4obmFtZSwgZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcnVuT25Tb3VyY2UgPSBmdW5jdGlvbiAobmFtZSwgZikge1xuICAgICAgcmV0dXJuIHJ1bk9uU291cmNlTmFtZShuYW1lKShmKTtcbiAgICB9O1xuICAgIHZhciBydW5PbkF0dGFjaGVkID0gcnVuT25Tb3VyY2VOYW1lKGF0dGFjaGVkVG9Eb20oKSk7XG4gICAgdmFyIHJ1bk9uRGV0YWNoZWQgPSBydW5PblNvdXJjZU5hbWUoZGV0YWNoZWRGcm9tRG9tKCkpO1xuICAgIHZhciBydW5PbkluaXQgPSBydW5PblNvdXJjZU5hbWUoc3lzdGVtSW5pdCgpKTtcbiAgICB2YXIgcnVuT25FeGVjdXRlID0gcnVuT25OYW1lKGV4ZWN1dGUoKSk7XG5cbiAgICB2YXIgR2xvYmFsID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBGdW5jdGlvbigncmV0dXJuIHRoaXM7JykoKTtcblxuICAgIHZhciBuYW1lID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciByID0gZWxlbWVudC5kb20ubm9kZU5hbWU7XG4gICAgICByZXR1cm4gci50b0xvd2VyQ2FzZSgpO1xuICAgIH07XG4gICAgdmFyIHR5cGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLm5vZGVUeXBlO1xuICAgIH07XG4gICAgdmFyIGlzVHlwZSQxID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdHlwZShlbGVtZW50KSA9PT0gdDtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNFbGVtZW50ID0gaXNUeXBlJDEoRUxFTUVOVCk7XG4gICAgdmFyIGlzVGV4dCA9IGlzVHlwZSQxKFRFWFQpO1xuICAgIHZhciBpc0RvY3VtZW50ID0gaXNUeXBlJDEoRE9DVU1FTlQpO1xuICAgIHZhciBpc0RvY3VtZW50RnJhZ21lbnQgPSBpc1R5cGUkMShET0NVTUVOVF9GUkFHTUVOVCk7XG5cbiAgICB2YXIgb3duZXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsZW1lbnQuZG9tLm93bmVyRG9jdW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGRvY3VtZW50T3JPd25lciA9IGZ1bmN0aW9uIChkb3MpIHtcbiAgICAgIHJldHVybiBpc0RvY3VtZW50KGRvcykgPyBkb3MgOiBvd25lcihkb3MpO1xuICAgIH07XG4gICAgdmFyIGRvY3VtZW50RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21Eb20oZG9jdW1lbnRPck93bmVyKGVsZW1lbnQpLmRvbS5kb2N1bWVudEVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRWaWV3ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudE9yT3duZXIoZWxlbWVudCkuZG9tLmRlZmF1bHRWaWV3KTtcbiAgICB9O1xuICAgIHZhciBwYXJlbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZWxlbWVudC5kb20ucGFyZW50Tm9kZSkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBwYXJlbnROb2RlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBwYXJlbnQoZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgb2Zmc2V0UGFyZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGVsZW1lbnQuZG9tLm9mZnNldFBhcmVudCkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBuZXh0U2libGluZyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShlbGVtZW50LmRvbS5uZXh0U2libGluZykubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBjaGlsZHJlbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gbWFwKGVsZW1lbnQuZG9tLmNoaWxkTm9kZXMsIFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBjaGlsZCA9IGZ1bmN0aW9uIChlbGVtZW50LCBpbmRleCkge1xuICAgICAgdmFyIGNzID0gZWxlbWVudC5kb20uY2hpbGROb2RlcztcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGNzW2luZGV4XSkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBmaXJzdENoaWxkID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBjaGlsZChlbGVtZW50LCAwKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzU2hhZG93Um9vdCA9IGZ1bmN0aW9uIChkb3MpIHtcbiAgICAgIHJldHVybiBpc0RvY3VtZW50RnJhZ21lbnQoZG9zKSAmJiBpc05vbk51bGxhYmxlKGRvcy5kb20uaG9zdCk7XG4gICAgfTtcbiAgICB2YXIgc3VwcG9ydGVkID0gaXNGdW5jdGlvbihFbGVtZW50LnByb3RvdHlwZS5hdHRhY2hTaGFkb3cpICYmIGlzRnVuY3Rpb24oTm9kZS5wcm90b3R5cGUuZ2V0Um9vdE5vZGUpO1xuICAgIHZhciBpc1N1cHBvcnRlZCA9IGNvbnN0YW50KHN1cHBvcnRlZCk7XG4gICAgdmFyIGdldFJvb3ROb2RlID0gc3VwcG9ydGVkID8gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShlLmRvbS5nZXRSb290Tm9kZSgpKTtcbiAgICB9IDogZG9jdW1lbnRPck93bmVyO1xuICAgIHZhciBnZXRDb250ZW50Q29udGFpbmVyID0gZnVuY3Rpb24gKGRvcykge1xuICAgICAgcmV0dXJuIGlzU2hhZG93Um9vdChkb3MpID8gZG9zIDogU3VnYXJFbGVtZW50LmZyb21Eb20oZG9jdW1lbnRPck93bmVyKGRvcykuZG9tLmJvZHkpO1xuICAgIH07XG4gICAgdmFyIGlzSW5TaGFkb3dSb290ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBnZXRTaGFkb3dSb290KGUpLmlzU29tZSgpO1xuICAgIH07XG4gICAgdmFyIGdldFNoYWRvd1Jvb3QgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHIgPSBnZXRSb290Tm9kZShlKTtcbiAgICAgIHJldHVybiBpc1NoYWRvd1Jvb3QocikgPyBPcHRpb25hbC5zb21lKHIpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGdldFNoYWRvd0hvc3QgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGUuZG9tLmhvc3QpO1xuICAgIH07XG4gICAgdmFyIGdldE9yaWdpbmFsRXZlbnRUYXJnZXQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmIChpc1N1cHBvcnRlZCgpICYmIGlzTm9uTnVsbGFibGUoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICB2YXIgZWwgPSBTdWdhckVsZW1lbnQuZnJvbURvbShldmVudC50YXJnZXQpO1xuICAgICAgICBpZiAoaXNFbGVtZW50KGVsKSAmJiBpc09wZW5TaGFkb3dIb3N0KGVsKSkge1xuICAgICAgICAgIGlmIChldmVudC5jb21wb3NlZCAmJiBldmVudC5jb21wb3NlZFBhdGgpIHtcbiAgICAgICAgICAgIHZhciBjb21wb3NlZFBhdGggPSBldmVudC5jb21wb3NlZFBhdGgoKTtcbiAgICAgICAgICAgIGlmIChjb21wb3NlZFBhdGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhlYWQoY29tcG9zZWRQYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGV2ZW50LnRhcmdldCk7XG4gICAgfTtcbiAgICB2YXIgaXNPcGVuU2hhZG93SG9zdCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gaXNOb25OdWxsYWJsZShlbGVtZW50LmRvbS5zaGFkb3dSb290KTtcbiAgICB9O1xuXG4gICAgdmFyIGJlZm9yZSA9IGZ1bmN0aW9uIChtYXJrZXIsIGVsZW1lbnQpIHtcbiAgICAgIHZhciBwYXJlbnQkMSA9IHBhcmVudChtYXJrZXIpO1xuICAgICAgcGFyZW50JDEuZWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICB2LmRvbS5pbnNlcnRCZWZvcmUoZWxlbWVudC5kb20sIG1hcmtlci5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYWZ0ZXIgPSBmdW5jdGlvbiAobWFya2VyLCBlbGVtZW50KSB7XG4gICAgICB2YXIgc2libGluZyA9IG5leHRTaWJsaW5nKG1hcmtlcik7XG4gICAgICBzaWJsaW5nLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFyZW50JDEgPSBwYXJlbnQobWFya2VyKTtcbiAgICAgICAgcGFyZW50JDEuZWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgIGFwcGVuZCh2LCBlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAodikge1xuICAgICAgICBiZWZvcmUodiwgZWxlbWVudCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwcmVwZW5kID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudCkge1xuICAgICAgdmFyIGZpcnN0Q2hpbGQkMSA9IGZpcnN0Q2hpbGQocGFyZW50KTtcbiAgICAgIGZpcnN0Q2hpbGQkMS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXBwZW5kKHBhcmVudCwgZWxlbWVudCk7XG4gICAgICB9LCBmdW5jdGlvbiAodikge1xuICAgICAgICBwYXJlbnQuZG9tLmluc2VydEJlZm9yZShlbGVtZW50LmRvbSwgdi5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXBwZW5kID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudCkge1xuICAgICAgcGFyZW50LmRvbS5hcHBlbmRDaGlsZChlbGVtZW50LmRvbSk7XG4gICAgfTtcbiAgICB2YXIgYXBwZW5kQXQgPSBmdW5jdGlvbiAocGFyZW50LCBlbGVtZW50LCBpbmRleCkge1xuICAgICAgY2hpbGQocGFyZW50LCBpbmRleCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFwcGVuZChwYXJlbnQsIGVsZW1lbnQpO1xuICAgICAgfSwgZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgYmVmb3JlKHYsIGVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBiZWZvcmUkMSA9IGZ1bmN0aW9uIChtYXJrZXIsIGVsZW1lbnRzKSB7XG4gICAgICBlYWNoKGVsZW1lbnRzLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBiZWZvcmUobWFya2VyLCB4KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFwcGVuZCQxID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudHMpIHtcbiAgICAgIGVhY2goZWxlbWVudHMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGFwcGVuZChwYXJlbnQsIHgpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBlbXB0eSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICBlbGVtZW50LmRvbS50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgZWFjaChjaGlsZHJlbihlbGVtZW50KSwgZnVuY3Rpb24gKHJvZ3VlKSB7XG4gICAgICAgIHJlbW92ZShyb2d1ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW1vdmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgaWYgKGRvbS5wYXJlbnROb2RlICE9PSBudWxsKSB7XG4gICAgICAgIGRvbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRvbSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgdW53cmFwID0gZnVuY3Rpb24gKHdyYXBwZXIpIHtcbiAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4od3JhcHBlcik7XG4gICAgICBpZiAoY2hpbGRyZW4kMS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGJlZm9yZSQxKHdyYXBwZXIsIGNoaWxkcmVuJDEpO1xuICAgICAgfVxuICAgICAgcmVtb3ZlKHdyYXBwZXIpO1xuICAgIH07XG5cbiAgICB2YXIgZnJvbUh0bWwkMSA9IGZ1bmN0aW9uIChodG1sLCBzY29wZSkge1xuICAgICAgdmFyIGRvYyA9IHNjb3BlIHx8IGRvY3VtZW50O1xuICAgICAgdmFyIGRpdiA9IGRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGRpdi5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgcmV0dXJuIGNoaWxkcmVuKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRpdikpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0JDIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLmlubmVySFRNTDtcbiAgICB9O1xuICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29udGVudCkge1xuICAgICAgdmFyIG93bmVyJDEgPSBvd25lcihlbGVtZW50KTtcbiAgICAgIHZhciBkb2NEb20gPSBvd25lciQxLmRvbTtcbiAgICAgIHZhciBmcmFnbWVudCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRvY0RvbS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkpO1xuICAgICAgdmFyIGNvbnRlbnRFbGVtZW50cyA9IGZyb21IdG1sJDEoY29udGVudCwgZG9jRG9tKTtcbiAgICAgIGFwcGVuZCQxKGZyYWdtZW50LCBjb250ZW50RWxlbWVudHMpO1xuICAgICAgZW1wdHkoZWxlbWVudCk7XG4gICAgICBhcHBlbmQoZWxlbWVudCwgZnJhZ21lbnQpO1xuICAgIH07XG4gICAgdmFyIGdldE91dGVyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBjb250YWluZXIgPSBTdWdhckVsZW1lbnQuZnJvbVRhZygnZGl2Jyk7XG4gICAgICB2YXIgY2xvbmUgPSBTdWdhckVsZW1lbnQuZnJvbURvbShlbGVtZW50LmRvbS5jbG9uZU5vZGUodHJ1ZSkpO1xuICAgICAgYXBwZW5kKGNvbnRhaW5lciwgY2xvbmUpO1xuICAgICAgcmV0dXJuIGdldCQyKGNvbnRhaW5lcik7XG4gICAgfTtcblxuICAgIHZhciByYXdTZXQgPSBmdW5jdGlvbiAoZG9tLCBrZXksIHZhbHVlKSB7XG4gICAgICBpZiAoaXNTdHJpbmcodmFsdWUpIHx8IGlzQm9vbGVhbih2YWx1ZSkgfHwgaXNOdW1iZXIodmFsdWUpKSB7XG4gICAgICAgIGRvbS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSArICcnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgY2FsbCB0byBBdHRyaWJ1dGUuc2V0LiBLZXkgJywga2V5LCAnOjogVmFsdWUgJywgdmFsdWUsICc6OiBFbGVtZW50ICcsIGRvbSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXR0cmlidXRlIHZhbHVlIHdhcyBub3Qgc2ltcGxlJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0JDEgPSBmdW5jdGlvbiAoZWxlbWVudCwga2V5LCB2YWx1ZSkge1xuICAgICAgcmF3U2V0KGVsZW1lbnQuZG9tLCBrZXksIHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBzZXRBbGwgPSBmdW5jdGlvbiAoZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIGVhY2gkMShhdHRycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgcmF3U2V0KGRvbSwgaywgdik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXQkMyA9IGZ1bmN0aW9uIChlbGVtZW50LCBrZXkpIHtcbiAgICAgIHZhciB2ID0gZWxlbWVudC5kb20uZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgICByZXR1cm4gdiA9PT0gbnVsbCA/IHVuZGVmaW5lZCA6IHY7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3B0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZ2V0JDMoZWxlbWVudCwga2V5KSk7XG4gICAgfTtcbiAgICB2YXIgaGFzJDEgPSBmdW5jdGlvbiAoZWxlbWVudCwga2V5KSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICByZXR1cm4gZG9tICYmIGRvbS5oYXNBdHRyaWJ1dGUgPyBkb20uaGFzQXR0cmlidXRlKGtleSkgOiBmYWxzZTtcbiAgICB9O1xuICAgIHZhciByZW1vdmUkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBrZXkpIHtcbiAgICAgIGVsZW1lbnQuZG9tLnJlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgIH07XG5cbiAgICB2YXIgY2xvbmUgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGlzRGVlcCkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKG9yaWdpbmFsLmRvbS5jbG9uZU5vZGUoaXNEZWVwKSk7XG4gICAgfTtcbiAgICB2YXIgc2hhbGxvdyQxID0gZnVuY3Rpb24gKG9yaWdpbmFsKSB7XG4gICAgICByZXR1cm4gY2xvbmUob3JpZ2luYWwsIGZhbHNlKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldEh0bWwgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgaWYgKGlzU2hhZG93Um9vdChlbGVtZW50KSkge1xuICAgICAgICByZXR1cm4gJyNzaGFkb3ctcm9vdCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2xvbmUgPSBzaGFsbG93JDEoZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBnZXRPdXRlcihjbG9uZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBlbGVtZW50ID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgIHJldHVybiBnZXRIdG1sKGVsZW0pO1xuICAgIH07XG5cbiAgICB2YXIgaXNSZWN1cnNpdmUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBvcmlnaW5hdG9yLCB0YXJnZXQpIHtcbiAgICAgIHJldHVybiBlcSQxKG9yaWdpbmF0b3IsIGNvbXBvbmVudC5lbGVtZW50KSAmJiAhZXEkMShvcmlnaW5hdG9yLCB0YXJnZXQpO1xuICAgIH07XG4gICAgdmFyIGV2ZW50cyA9IGRlcml2ZShbY2FuKGZvY3VzKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHZhciBldmVudCA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50O1xuICAgICAgICB2YXIgb3JpZ2luYXRvciA9IGV2ZW50Lm9yaWdpbmF0b3I7XG4gICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlmIChpc1JlY3Vyc2l2ZShjb21wb25lbnQsIG9yaWdpbmF0b3IsIHRhcmdldCkpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oZm9jdXMoKSArICcgZGlkIG5vdCBnZXQgaW50ZXJwcmV0ZWQgYnkgdGhlIGRlc2lyZWQgdGFyZ2V0LiAnICsgJ1xcbk9yaWdpbmF0b3I6ICcgKyBlbGVtZW50KG9yaWdpbmF0b3IpICsgJ1xcblRhcmdldDogJyArIGVsZW1lbnQodGFyZ2V0KSArICdcXG5DaGVjayB0aGUgJyArIGZvY3VzKCkgKyAnIGV2ZW50IGhhbmRsZXJzJyk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KV0pO1xuXG4gICAgdmFyIERlZmF1bHRFdmVudHMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHNcbiAgICB9KTtcblxuICAgIHZhciB1bmlxdWUgPSAwO1xuICAgIHZhciBnZW5lcmF0ZSQxID0gZnVuY3Rpb24gKHByZWZpeCkge1xuICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgdmFyIHRpbWUgPSBkYXRlLmdldFRpbWUoKTtcbiAgICAgIHZhciByYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMDAwKTtcbiAgICAgIHVuaXF1ZSsrO1xuICAgICAgcmV0dXJuIHByZWZpeCArICdfJyArIHJhbmRvbSArIHVuaXF1ZSArIFN0cmluZyh0aW1lKTtcbiAgICB9O1xuXG4gICAgdmFyIHByZWZpeCA9IGNvbnN0YW50KCdhbGxveS1pZC0nKTtcbiAgICB2YXIgaWRBdHRyID0gY29uc3RhbnQoJ2RhdGEtYWxsb3ktaWQnKTtcblxuICAgIHZhciBwcmVmaXgkMSA9IHByZWZpeCgpO1xuICAgIHZhciBpZEF0dHIkMSA9IGlkQXR0cigpO1xuICAgIHZhciB3cml0ZSA9IGZ1bmN0aW9uIChsYWJlbCwgZWxlbSkge1xuICAgICAgdmFyIGlkID0gZ2VuZXJhdGUkMShwcmVmaXgkMSArIGxhYmVsKTtcbiAgICAgIHdyaXRlT25seShlbGVtLCBpZCk7XG4gICAgICByZXR1cm4gaWQ7XG4gICAgfTtcbiAgICB2YXIgd3JpdGVPbmx5ID0gZnVuY3Rpb24gKGVsZW0sIHVpZCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsZW0uZG9tLCBpZEF0dHIkMSwge1xuICAgICAgICB2YWx1ZTogdWlkLFxuICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVhZCQxID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgIHZhciBpZCA9IGlzRWxlbWVudChlbGVtKSA/IGVsZW0uZG9tW2lkQXR0ciQxXSA6IG51bGw7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShpZCk7XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGUkMiA9IGZ1bmN0aW9uIChwcmVmaXgpIHtcbiAgICAgIHJldHVybiBnZW5lcmF0ZSQxKHByZWZpeCk7XG4gICAgfTtcblxuICAgIHZhciBtYWtlID0gaWRlbnRpdHk7XG5cbiAgICB2YXIgTm9Db250ZXh0QXBpID0gZnVuY3Rpb24gKGdldENvbXApIHtcbiAgICAgIHZhciBmYWlsID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY29tcG9uZW50IG11c3QgYmUgaW4gYSBjb250ZXh0IHRvIHNlbmQ6ICcgKyBldmVudCArIChnZXRDb21wID8gJ1xcbicgKyBlbGVtZW50KGdldENvbXAoKS5lbGVtZW50KSArICcgaXMgbm90IGluIGNvbnRleHQuJyA6ICcnKSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGVidWdJbmZvOiBjb25zdGFudCgnZmFrZScpLFxuICAgICAgICB0cmlnZ2VyRXZlbnQ6IGZhaWwoJ3RyaWdnZXJFdmVudCcpLFxuICAgICAgICB0cmlnZ2VyRm9jdXM6IGZhaWwoJ3RyaWdnZXJGb2N1cycpLFxuICAgICAgICB0cmlnZ2VyRXNjYXBlOiBmYWlsKCd0cmlnZ2VyRXNjYXBlJyksXG4gICAgICAgIGJ1aWxkOiBmYWlsKCdidWlsZCcpLFxuICAgICAgICBhZGRUb1dvcmxkOiBmYWlsKCdhZGRUb1dvcmxkJyksXG4gICAgICAgIHJlbW92ZUZyb21Xb3JsZDogZmFpbCgncmVtb3ZlRnJvbVdvcmxkJyksXG4gICAgICAgIGFkZFRvR3VpOiBmYWlsKCdhZGRUb0d1aScpLFxuICAgICAgICByZW1vdmVGcm9tR3VpOiBmYWlsKCdyZW1vdmVGcm9tR3VpJyksXG4gICAgICAgIGdldEJ5VWlkOiBmYWlsKCdnZXRCeVVpZCcpLFxuICAgICAgICBnZXRCeURvbTogZmFpbCgnZ2V0QnlEb20nKSxcbiAgICAgICAgYnJvYWRjYXN0OiBmYWlsKCdicm9hZGNhc3QnKSxcbiAgICAgICAgYnJvYWRjYXN0T246IGZhaWwoJ2Jyb2FkY2FzdE9uJyksXG4gICAgICAgIGJyb2FkY2FzdEV2ZW50OiBmYWlsKCdicm9hZGNhc3RFdmVudCcpLFxuICAgICAgICBpc0Nvbm5lY3RlZDogbmV2ZXJcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2luZ2xldG9uID0gTm9Db250ZXh0QXBpKCk7XG5cbiAgICB2YXIgbWFya0FzQmVoYXZpb3VyQXBpID0gZnVuY3Rpb24gKGYsIGFwaU5hbWUsIGFwaUZ1bmN0aW9uKSB7XG4gICAgICB2YXIgZGVsZWdhdGUgPSBhcGlGdW5jdGlvbi50b1N0cmluZygpO1xuICAgICAgdmFyIGVuZEluZGV4ID0gZGVsZWdhdGUuaW5kZXhPZignKScpICsgMTtcbiAgICAgIHZhciBvcGVuQnJhY2tldEluZGV4ID0gZGVsZWdhdGUuaW5kZXhPZignKCcpO1xuICAgICAgdmFyIHBhcmFtZXRlcnMgPSBkZWxlZ2F0ZS5zdWJzdHJpbmcob3BlbkJyYWNrZXRJbmRleCArIDEsIGVuZEluZGV4IC0gMSkuc3BsaXQoLyxcXHMqLyk7XG4gICAgICBmLnRvRnVuY3Rpb25Bbm5vdGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IGFwaU5hbWUsXG4gICAgICAgICAgcGFyYW1ldGVyczogY2xlYW5QYXJhbWV0ZXJzKHBhcmFtZXRlcnMuc2xpY2UoMCwgMSkuY29uY2F0KHBhcmFtZXRlcnMuc2xpY2UoMykpKVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmO1xuICAgIH07XG4gICAgdmFyIGNsZWFuUGFyYW1ldGVycyA9IGZ1bmN0aW9uIChwYXJhbWV0ZXJzKSB7XG4gICAgICByZXR1cm4gbWFwKHBhcmFtZXRlcnMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiBlbmRzV2l0aChwLCAnLyonKSA/IHAuc3Vic3RyaW5nKDAsIHAubGVuZ3RoIC0gJy8qJy5sZW5ndGgpIDogcDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1hcmtBc0V4dHJhQXBpID0gZnVuY3Rpb24gKGYsIGV4dHJhTmFtZSkge1xuICAgICAgdmFyIGRlbGVnYXRlID0gZi50b1N0cmluZygpO1xuICAgICAgdmFyIGVuZEluZGV4ID0gZGVsZWdhdGUuaW5kZXhPZignKScpICsgMTtcbiAgICAgIHZhciBvcGVuQnJhY2tldEluZGV4ID0gZGVsZWdhdGUuaW5kZXhPZignKCcpO1xuICAgICAgdmFyIHBhcmFtZXRlcnMgPSBkZWxlZ2F0ZS5zdWJzdHJpbmcob3BlbkJyYWNrZXRJbmRleCArIDEsIGVuZEluZGV4IC0gMSkuc3BsaXQoLyxcXHMqLyk7XG4gICAgICBmLnRvRnVuY3Rpb25Bbm5vdGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IGV4dHJhTmFtZSxcbiAgICAgICAgICBwYXJhbWV0ZXJzOiBjbGVhblBhcmFtZXRlcnMocGFyYW1ldGVycylcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZjtcbiAgICB9O1xuICAgIHZhciBtYXJrQXNTa2V0Y2hBcGkgPSBmdW5jdGlvbiAoZiwgYXBpRnVuY3Rpb24pIHtcbiAgICAgIHZhciBkZWxlZ2F0ZSA9IGFwaUZ1bmN0aW9uLnRvU3RyaW5nKCk7XG4gICAgICB2YXIgZW5kSW5kZXggPSBkZWxlZ2F0ZS5pbmRleE9mKCcpJykgKyAxO1xuICAgICAgdmFyIG9wZW5CcmFja2V0SW5kZXggPSBkZWxlZ2F0ZS5pbmRleE9mKCcoJyk7XG4gICAgICB2YXIgcGFyYW1ldGVycyA9IGRlbGVnYXRlLnN1YnN0cmluZyhvcGVuQnJhY2tldEluZGV4ICsgMSwgZW5kSW5kZXggLSAxKS5zcGxpdCgvLFxccyovKTtcbiAgICAgIGYudG9GdW5jdGlvbkFubm90YXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogJ09WRVJSSURFJyxcbiAgICAgICAgICBwYXJhbWV0ZXJzOiBjbGVhblBhcmFtZXRlcnMocGFyYW1ldGVycy5zbGljZSgxKSlcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZjtcbiAgICB9O1xuXG4gICAgdmFyIHByZW1hZGVUYWcgPSBnZW5lcmF0ZSQxKCdhbGxveS1wcmVtYWRlJyk7XG4gICAgdmFyIHByZW1hZGUgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgcmV0dXJuIHdyYXAkMShwcmVtYWRlVGFnLCBjb21wKTtcbiAgICB9O1xuICAgIHZhciBnZXRQcmVtYWRlID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBnZXQkMShzcGVjLCBwcmVtYWRlVGFnKTtcbiAgICB9O1xuICAgIHZhciBtYWtlQXBpID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgIHJldHVybiBtYXJrQXNTa2V0Y2hBcGkoZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICB2YXIgcmVzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIHJlc3RbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGYuYXBwbHkodm9pZCAwLCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgY29tcG9uZW50LmdldEFwaXMoKSxcbiAgICAgICAgICBjb21wb25lbnRcbiAgICAgICAgXSwgcmVzdCkpO1xuICAgICAgfSwgZik7XG4gICAgfTtcblxuICAgIHZhciBOb1N0YXRlID0ge1xuICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbnUkNSh7XG4gICAgICAgICAgcmVhZFN0YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJ05vIFN0YXRlIHJlcXVpcmVkJztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG51JDUgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIHNwZWM7XG4gICAgfTtcblxuICAgIHZhciBnZW5lcmF0ZUZyb20gPSBmdW5jdGlvbiAoc3BlYywgYWxsKSB7XG4gICAgICB2YXIgc2NoZW1hID0gbWFwKGFsbCwgZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbk9iak9mKGEubmFtZSgpLCBbXG4gICAgICAgICAgc3RyaWN0JDEoJ2NvbmZpZycpLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdzdGF0ZScsIE5vU3RhdGUpXG4gICAgICAgIF0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgdmFsaWRhdGVkID0gYXNSYXcoJ2NvbXBvbmVudC5iZWhhdmlvdXJzJywgb2JqT2Yoc2NoZW1hKSwgc3BlYy5iZWhhdmlvdXJzKS5mb2xkKGZ1bmN0aW9uIChlcnJJbmZvKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXRFcnJvcihlcnJJbmZvKSArICdcXG5Db21wbGV0ZSBzcGVjOlxcbicgKyBKU09OLnN0cmluZ2lmeShzcGVjLCBudWxsLCAyKSk7XG4gICAgICB9LCBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGlzdDogYWxsLFxuICAgICAgICBkYXRhOiBtYXAkMih2YWxpZGF0ZWQsIGZ1bmN0aW9uIChvcHRCbG9iVGh1bmspIHtcbiAgICAgICAgICB2YXIgb3V0cHV0ID0gb3B0QmxvYlRodW5rLm1hcChmdW5jdGlvbiAoYmxvYikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgY29uZmlnOiBibG9iLmNvbmZpZyxcbiAgICAgICAgICAgICAgc3RhdGU6IGJsb2Iuc3RhdGUuaW5pdChibG9iLmNvbmZpZylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0QmVoYXZpb3VycyA9IGZ1bmN0aW9uIChiRGF0YSkge1xuICAgICAgcmV0dXJuIGJEYXRhLmxpc3Q7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGF0YSA9IGZ1bmN0aW9uIChiRGF0YSkge1xuICAgICAgcmV0dXJuIGJEYXRhLmRhdGE7XG4gICAgfTtcblxuICAgIHZhciBieUlubmVyS2V5ID0gZnVuY3Rpb24gKGRhdGEsIHR1cGxlKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgZWFjaCQxKGRhdGEsIGZ1bmN0aW9uIChkZXRhaWwsIGtleSkge1xuICAgICAgICBlYWNoJDEoZGV0YWlsLCBmdW5jdGlvbiAodmFsdWUsIGluZGV4S2V5KSB7XG4gICAgICAgICAgdmFyIGNoYWluID0gZ2V0JDEociwgaW5kZXhLZXkpLmdldE9yKFtdKTtcbiAgICAgICAgICByW2luZGV4S2V5XSA9IGNoYWluLmNvbmNhdChbdHVwbGUoa2V5LCB2YWx1ZSldKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByO1xuICAgIH07XG5cbiAgICB2YXIgbnUkNiA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbGFzc2VzOiBzLmNsYXNzZXMgIT09IHVuZGVmaW5lZCA/IHMuY2xhc3NlcyA6IFtdLFxuICAgICAgICBhdHRyaWJ1dGVzOiBzLmF0dHJpYnV0ZXMgIT09IHVuZGVmaW5lZCA/IHMuYXR0cmlidXRlcyA6IHt9LFxuICAgICAgICBzdHlsZXM6IHMuc3R5bGVzICE9PSB1bmRlZmluZWQgPyBzLnN0eWxlcyA6IHt9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1lcmdlJDEgPSBmdW5jdGlvbiAoZGVmbkEsIG1vZCkge1xuICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZWZuQSksIHtcbiAgICAgICAgYXR0cmlidXRlczogX19hc3NpZ24oX19hc3NpZ24oe30sIGRlZm5BLmF0dHJpYnV0ZXMpLCBtb2QuYXR0cmlidXRlcyksXG4gICAgICAgIHN0eWxlczogX19hc3NpZ24oX19hc3NpZ24oe30sIGRlZm5BLnN0eWxlcyksIG1vZC5zdHlsZXMpLFxuICAgICAgICBjbGFzc2VzOiBkZWZuQS5jbGFzc2VzLmNvbmNhdChtb2QuY2xhc3NlcylcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgY29tYmluZSA9IGZ1bmN0aW9uIChpbmZvLCBiYXNlTW9kLCBiZWhhdmlvdXJzLCBiYXNlKSB7XG4gICAgICB2YXIgbW9kc0J5QmVoYXZpb3VyID0gX19hc3NpZ24oe30sIGJhc2VNb2QpO1xuICAgICAgZWFjaChiZWhhdmlvdXJzLCBmdW5jdGlvbiAoYmVoYXZpb3VyKSB7XG4gICAgICAgIG1vZHNCeUJlaGF2aW91cltiZWhhdmlvdXIubmFtZSgpXSA9IGJlaGF2aW91ci5leGhpYml0KGluZm8sIGJhc2UpO1xuICAgICAgfSk7XG4gICAgICB2YXIgYnlBc3BlY3QgPSBieUlubmVyS2V5KG1vZHNCeUJlaGF2aW91ciwgZnVuY3Rpb24gKG5hbWUsIG1vZGlmaWNhdGlvbikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgbW9kaWZpY2F0aW9uOiBtb2RpZmljYXRpb25cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGNvbWJpbmVPYmplY3RzID0gZnVuY3Rpb24gKG9iamVjdHMpIHtcbiAgICAgICAgcmV0dXJuIGZvbGRyKG9iamVjdHMsIGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBhLm1vZGlmaWNhdGlvbiksIGIpO1xuICAgICAgICB9LCB7fSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNvbWJpbmVkQ2xhc3NlcyA9IGZvbGRyKGJ5QXNwZWN0LmNsYXNzZXMsIGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICAgIHJldHVybiBhLm1vZGlmaWNhdGlvbi5jb25jYXQoYik7XG4gICAgICB9LCBbXSk7XG4gICAgICB2YXIgY29tYmluZWRBdHRyaWJ1dGVzID0gY29tYmluZU9iamVjdHMoYnlBc3BlY3QuYXR0cmlidXRlcyk7XG4gICAgICB2YXIgY29tYmluZWRTdHlsZXMgPSBjb21iaW5lT2JqZWN0cyhieUFzcGVjdC5zdHlsZXMpO1xuICAgICAgcmV0dXJuIG51JDYoe1xuICAgICAgICBjbGFzc2VzOiBjb21iaW5lZENsYXNzZXMsXG4gICAgICAgIGF0dHJpYnV0ZXM6IGNvbWJpbmVkQXR0cmlidXRlcyxcbiAgICAgICAgc3R5bGVzOiBjb21iaW5lZFN0eWxlc1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzb3J0S2V5cyA9IGZ1bmN0aW9uIChsYWJlbCwga2V5TmFtZSwgYXJyYXksIG9yZGVyKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgc29ydGVkID0gc29ydChhcnJheSwgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICB2YXIgYUtleSA9IGFba2V5TmFtZV07XG4gICAgICAgICAgdmFyIGJLZXkgPSBiW2tleU5hbWVdO1xuICAgICAgICAgIHZhciBhSW5kZXggPSBvcmRlci5pbmRleE9mKGFLZXkpO1xuICAgICAgICAgIHZhciBiSW5kZXggPSBvcmRlci5pbmRleE9mKGJLZXkpO1xuICAgICAgICAgIGlmIChhSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBvcmRlcmluZyBmb3IgJyArIGxhYmVsICsgJyBkb2VzIG5vdCBoYXZlIGFuIGVudHJ5IGZvciAnICsgYUtleSArICcuXFxuT3JkZXIgc3BlY2lmaWVkOiAnICsgSlNPTi5zdHJpbmdpZnkob3JkZXIsIG51bGwsIDIpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGJJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIG9yZGVyaW5nIGZvciAnICsgbGFiZWwgKyAnIGRvZXMgbm90IGhhdmUgYW4gZW50cnkgZm9yICcgKyBiS2V5ICsgJy5cXG5PcmRlciBzcGVjaWZpZWQ6ICcgKyBKU09OLnN0cmluZ2lmeShvcmRlciwgbnVsbCwgMikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYUluZGV4IDwgYkluZGV4KSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgfSBlbHNlIGlmIChiSW5kZXggPCBhSW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gUmVzdWx0LnZhbHVlKHNvcnRlZCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnJvcihbZXJyXSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciB1bmN1cnJpZWQgPSBmdW5jdGlvbiAoaGFuZGxlciwgcHVycG9zZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGFuZGxlcjogaGFuZGxlcixcbiAgICAgICAgcHVycG9zZTogcHVycG9zZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjdXJyaWVkID0gZnVuY3Rpb24gKGhhbmRsZXIsIHB1cnBvc2UpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNIYW5kbGVyOiBoYW5kbGVyLFxuICAgICAgICBwdXJwb3NlOiBwdXJwb3NlXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGN1cnJ5QXJncyA9IGZ1bmN0aW9uIChkZXNjSGFuZGxlciwgZXh0cmFBcmdzKSB7XG4gICAgICByZXR1cm4gY3VycmllZChjdXJyeS5hcHBseSh1bmRlZmluZWQsIFtkZXNjSGFuZGxlci5oYW5kbGVyXS5jb25jYXQoZXh0cmFBcmdzKSksIGRlc2NIYW5kbGVyLnB1cnBvc2UpO1xuICAgIH07XG4gICAgdmFyIGdldEN1cnJpZWQgPSBmdW5jdGlvbiAoZGVzY0hhbmRsZXIpIHtcbiAgICAgIHJldHVybiBkZXNjSGFuZGxlci5jSGFuZGxlcjtcbiAgICB9O1xuXG4gICAgdmFyIGJlaGF2aW91clR1cGxlID0gZnVuY3Rpb24gKG5hbWUsIGhhbmRsZXIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGhhbmRsZXI6IGhhbmRsZXJcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbmFtZVRvSGFuZGxlcnMgPSBmdW5jdGlvbiAoYmVoYXZpb3VycywgaW5mbykge1xuICAgICAgdmFyIHIgPSB7fTtcbiAgICAgIGVhY2goYmVoYXZpb3VycywgZnVuY3Rpb24gKGJlaGF2aW91cikge1xuICAgICAgICByW2JlaGF2aW91ci5uYW1lKCldID0gYmVoYXZpb3VyLmhhbmRsZXJzKGluZm8pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBncm91cEJ5RXZlbnRzID0gZnVuY3Rpb24gKGluZm8sIGJlaGF2aW91cnMsIGJhc2UpIHtcbiAgICAgIHZhciBiZWhhdmlvdXJFdmVudHMgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYmFzZSksIG5hbWVUb0hhbmRsZXJzKGJlaGF2aW91cnMsIGluZm8pKTtcbiAgICAgIHJldHVybiBieUlubmVyS2V5KGJlaGF2aW91ckV2ZW50cywgYmVoYXZpb3VyVHVwbGUpO1xuICAgIH07XG4gICAgdmFyIGNvbWJpbmUkMSA9IGZ1bmN0aW9uIChpbmZvLCBldmVudE9yZGVyLCBiZWhhdmlvdXJzLCBiYXNlKSB7XG4gICAgICB2YXIgYnlFdmVudE5hbWUgPSBncm91cEJ5RXZlbnRzKGluZm8sIGJlaGF2aW91cnMsIGJhc2UpO1xuICAgICAgcmV0dXJuIGNvbWJpbmVHcm91cHMoYnlFdmVudE5hbWUsIGV2ZW50T3JkZXIpO1xuICAgIH07XG4gICAgdmFyIGFzc2VtYmxlID0gZnVuY3Rpb24gKHJhd0hhbmRsZXIpIHtcbiAgICAgIHZhciBoYW5kbGVyID0gcmVhZChyYXdIYW5kbGVyKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICB2YXIgcmVzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDI7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIHJlc3RbX2kgLSAyXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFyZ3MgPSBbXG4gICAgICAgICAgY29tcG9uZW50LFxuICAgICAgICAgIHNpbXVsYXRlZEV2ZW50XG4gICAgICAgIF0uY29uY2F0KHJlc3QpO1xuICAgICAgICBpZiAoaGFuZGxlci5hYm9ydC5hcHBseSh1bmRlZmluZWQsIGFyZ3MpKSB7XG4gICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGhhbmRsZXIuY2FuLmFwcGx5KHVuZGVmaW5lZCwgYXJncykpIHtcbiAgICAgICAgICBoYW5kbGVyLnJ1bi5hcHBseSh1bmRlZmluZWQsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1pc3NpbmdPcmRlckVycm9yID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgdHVwbGVzKSB7XG4gICAgICByZXR1cm4gUmVzdWx0LmVycm9yKFsnVGhlIGV2ZW50ICgnICsgZXZlbnROYW1lICsgJykgaGFzIG1vcmUgdGhhbiBvbmUgYmVoYXZpb3VyIHRoYXQgbGlzdGVucyB0byBpdC5cXG5XaGVuIHRoaXMgb2NjdXJzLCB5b3UgbXVzdCAnICsgJ3NwZWNpZnkgYW4gZXZlbnQgb3JkZXJpbmcgZm9yIHRoZSBiZWhhdmlvdXJzIGluIHlvdXIgc3BlYyAoZS5nLiBbIFwibGlzdGluZ1wiLCBcInRvZ2dsaW5nXCIgXSkuXFxuVGhlIGJlaGF2aW91cnMgdGhhdCAnICsgJ2NhbiB0cmlnZ2VyIGl0IGFyZTogJyArIEpTT04uc3RyaW5naWZ5KG1hcCh0dXBsZXMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgcmV0dXJuIGMubmFtZTtcbiAgICAgICAgfSksIG51bGwsIDIpXSk7XG4gICAgfTtcbiAgICB2YXIgZnVzZSQxID0gZnVuY3Rpb24gKHR1cGxlcywgZXZlbnRPcmRlciwgZXZlbnROYW1lKSB7XG4gICAgICB2YXIgb3JkZXIgPSBldmVudE9yZGVyW2V2ZW50TmFtZV07XG4gICAgICBpZiAoIW9yZGVyKSB7XG4gICAgICAgIHJldHVybiBtaXNzaW5nT3JkZXJFcnJvcihldmVudE5hbWUsIHR1cGxlcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gc29ydEtleXMoJ0V2ZW50OiAnICsgZXZlbnROYW1lLCAnbmFtZScsIHR1cGxlcywgb3JkZXIpLm1hcChmdW5jdGlvbiAoc29ydGVkVHVwbGVzKSB7XG4gICAgICAgICAgdmFyIGhhbmRsZXJzID0gbWFwKHNvcnRlZFR1cGxlcywgZnVuY3Rpb24gKHR1cGxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHVwbGUuaGFuZGxlcjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gZnVzZShoYW5kbGVycyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNvbWJpbmVHcm91cHMgPSBmdW5jdGlvbiAoYnlFdmVudE5hbWUsIGV2ZW50T3JkZXIpIHtcbiAgICAgIHZhciByID0gbWFwVG9BcnJheShieUV2ZW50TmFtZSwgZnVuY3Rpb24gKHR1cGxlcywgZXZlbnROYW1lKSB7XG4gICAgICAgIHZhciBjb21iaW5lZCA9IHR1cGxlcy5sZW5ndGggPT09IDEgPyBSZXN1bHQudmFsdWUodHVwbGVzWzBdLmhhbmRsZXIpIDogZnVzZSQxKHR1cGxlcywgZXZlbnRPcmRlciwgZXZlbnROYW1lKTtcbiAgICAgICAgcmV0dXJuIGNvbWJpbmVkLm1hcChmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICAgIHZhciBhc3NlbWJsZWQgPSBhc3NlbWJsZShoYW5kbGVyKTtcbiAgICAgICAgICB2YXIgcHVycG9zZSA9IHR1cGxlcy5sZW5ndGggPiAxID8gZmlsdGVyKGV2ZW50T3JkZXJbZXZlbnROYW1lXSwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgIHJldHVybiBleGlzdHModHVwbGVzLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICByZXR1cm4gdC5uYW1lID09PSBvO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSkuam9pbignID4gJykgOiB0dXBsZXNbMF0ubmFtZTtcbiAgICAgICAgICByZXR1cm4gd3JhcCQxKGV2ZW50TmFtZSwgdW5jdXJyaWVkKGFzc2VtYmxlZCwgcHVycG9zZSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbnNvbGlkYXRlKHIsIHt9KTtcbiAgICB9O1xuXG4gICAgdmFyIGJhc2VCZWhhdmlvdXIgPSAnYWxsb3kuYmFzZS5iZWhhdmlvdXInO1xuICAgIHZhciB0b0luZm8gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIF9hO1xuICAgICAgcmV0dXJuIGFzUmF3KCdjdXN0b20uZGVmaW5pdGlvbicsIG9iak9mKFtcbiAgICAgICAgZmllbGQoJ2RvbScsICdkb20nLCBzdHJpY3QoKSwgb2JqT2YoW1xuICAgICAgICAgIHN0cmljdCQxKCd0YWcnKSxcbiAgICAgICAgICBkZWZhdWx0ZWQkMSgnc3R5bGVzJywge30pLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdjbGFzc2VzJywgW10pLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdhdHRyaWJ1dGVzJywge30pLFxuICAgICAgICAgIG9wdGlvbigndmFsdWUnKSxcbiAgICAgICAgICBvcHRpb24oJ2lubmVySHRtbCcpXG4gICAgICAgIF0pKSxcbiAgICAgICAgc3RyaWN0JDEoJ2NvbXBvbmVudHMnKSxcbiAgICAgICAgc3RyaWN0JDEoJ3VpZCcpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRzJywge30pLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnYXBpcycsIHt9KSxcbiAgICAgICAgZmllbGQoJ2V2ZW50T3JkZXInLCAnZXZlbnRPcmRlcicsIG1lcmdlV2l0aCgoX2EgPSB7fSwgX2FbZXhlY3V0ZSgpXSA9IFtcbiAgICAgICAgICAnZGlzYWJsaW5nJyxcbiAgICAgICAgICBiYXNlQmVoYXZpb3VyLFxuICAgICAgICAgICd0b2dnbGluZycsXG4gICAgICAgICAgJ3R5cGVhaGVhZGV2ZW50cydcbiAgICAgICAgXSwgX2FbZm9jdXMoKV0gPSBbXG4gICAgICAgICAgYmFzZUJlaGF2aW91cixcbiAgICAgICAgICAnZm9jdXNpbmcnLFxuICAgICAgICAgICdrZXlpbmcnXG4gICAgICAgIF0sIF9hW3N5c3RlbUluaXQoKV0gPSBbXG4gICAgICAgICAgYmFzZUJlaGF2aW91cixcbiAgICAgICAgICAnZGlzYWJsaW5nJyxcbiAgICAgICAgICAndG9nZ2xpbmcnLFxuICAgICAgICAgICdyZXByZXNlbnRpbmcnXG4gICAgICAgIF0sIF9hW2lucHV0KCldID0gW1xuICAgICAgICAgIGJhc2VCZWhhdmlvdXIsXG4gICAgICAgICAgJ3JlcHJlc2VudGluZycsXG4gICAgICAgICAgJ3N0cmVhbWluZycsXG4gICAgICAgICAgJ2ludmFsaWRhdGluZydcbiAgICAgICAgXSwgX2FbZGV0YWNoZWRGcm9tRG9tKCldID0gW1xuICAgICAgICAgIGJhc2VCZWhhdmlvdXIsXG4gICAgICAgICAgJ3JlcHJlc2VudGluZycsXG4gICAgICAgICAgJ2l0ZW0tZXZlbnRzJyxcbiAgICAgICAgICAndG9vbHRpcHBpbmcnXG4gICAgICAgIF0sIF9hW21vdXNlZG93bigpXSA9IFtcbiAgICAgICAgICAnZm9jdXNpbmcnLFxuICAgICAgICAgIGJhc2VCZWhhdmlvdXIsXG4gICAgICAgICAgJ2l0ZW0tdHlwZS1ldmVudHMnXG4gICAgICAgIF0sIF9hW3RvdWNoc3RhcnQoKV0gPSBbXG4gICAgICAgICAgJ2ZvY3VzaW5nJyxcbiAgICAgICAgICBiYXNlQmVoYXZpb3VyLFxuICAgICAgICAgICdpdGVtLXR5cGUtZXZlbnRzJ1xuICAgICAgICBdLCBfYVttb3VzZW92ZXIoKV0gPSBbXG4gICAgICAgICAgJ2l0ZW0tdHlwZS1ldmVudHMnLFxuICAgICAgICAgICd0b29sdGlwcGluZydcbiAgICAgICAgXSwgX2FbcmVjZWl2ZSgpXSA9IFtcbiAgICAgICAgICAncmVjZWl2aW5nJyxcbiAgICAgICAgICAncmVmbGVjdGluZycsXG4gICAgICAgICAgJ3Rvb2x0aXBwaW5nJ1xuICAgICAgICBdLCBfYSkpLCBhbnlWYWx1ZSQxKCkpLFxuICAgICAgICBvcHRpb24oJ2RvbU1vZGlmaWNhdGlvbicpXG4gICAgICBdKSwgc3BlYyk7XG4gICAgfTtcbiAgICB2YXIgdG9EZWZpbml0aW9uID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZXRhaWwuZG9tKSwge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbUNoaWxkcmVuOiBtYXAoZGV0YWlsLmNvbXBvbmVudHMsIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbXAuZWxlbWVudDtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRvTW9kaWZpY2F0aW9uID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIGRldGFpbC5kb21Nb2RpZmljYXRpb24uZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBudSQ2KHt9KTtcbiAgICAgIH0sIG51JDYpO1xuICAgIH07XG4gICAgdmFyIHRvRXZlbnRzID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIHJldHVybiBpbmZvLmV2ZW50cztcbiAgICB9O1xuXG4gICAgdmFyIHJlYWQkMiA9IGZ1bmN0aW9uIChlbGVtZW50LCBhdHRyKSB7XG4gICAgICB2YXIgdmFsdWUgPSBnZXQkMyhlbGVtZW50LCBhdHRyKTtcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAnJyA/IFtdIDogdmFsdWUuc3BsaXQoJyAnKTtcbiAgICB9O1xuICAgIHZhciBhZGQgPSBmdW5jdGlvbiAoZWxlbWVudCwgYXR0ciwgaWQpIHtcbiAgICAgIHZhciBvbGQgPSByZWFkJDIoZWxlbWVudCwgYXR0cik7XG4gICAgICB2YXIgbnUgPSBvbGQuY29uY2F0KFtpZF0pO1xuICAgICAgc2V0JDEoZWxlbWVudCwgYXR0ciwgbnUuam9pbignICcpKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZSQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGF0dHIsIGlkKSB7XG4gICAgICB2YXIgbnUgPSBmaWx0ZXIocmVhZCQyKGVsZW1lbnQsIGF0dHIpLCBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdiAhPT0gaWQ7XG4gICAgICB9KTtcbiAgICAgIGlmIChudS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNldCQxKGVsZW1lbnQsIGF0dHIsIG51LmpvaW4oJyAnKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZW1vdmUkMShlbGVtZW50LCBhdHRyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgdmFyIHN1cHBvcnRzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50LmRvbS5jbGFzc0xpc3QgIT09IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHZhciBnZXQkNCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gcmVhZCQyKGVsZW1lbnQsICdjbGFzcycpO1xuICAgIH07XG4gICAgdmFyIGFkZCQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICByZXR1cm4gYWRkKGVsZW1lbnQsICdjbGFzcycsIGNsYXp6KTtcbiAgICB9O1xuICAgIHZhciByZW1vdmUkMyA9IGZ1bmN0aW9uIChlbGVtZW50LCBjbGF6eikge1xuICAgICAgcmV0dXJuIHJlbW92ZSQyKGVsZW1lbnQsICdjbGFzcycsIGNsYXp6KTtcbiAgICB9O1xuXG4gICAgdmFyIGFkZCQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICBpZiAoc3VwcG9ydHMoZWxlbWVudCkpIHtcbiAgICAgICAgZWxlbWVudC5kb20uY2xhc3NMaXN0LmFkZChjbGF6eik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhZGQkMShlbGVtZW50LCBjbGF6eik7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgY2xlYW5DbGFzcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICB2YXIgY2xhc3NMaXN0ID0gc3VwcG9ydHMoZWxlbWVudCkgPyBlbGVtZW50LmRvbS5jbGFzc0xpc3QgOiBnZXQkNChlbGVtZW50KTtcbiAgICAgIGlmIChjbGFzc0xpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlbW92ZSQxKGVsZW1lbnQsICdjbGFzcycpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlbW92ZSQ0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICBpZiAoc3VwcG9ydHMoZWxlbWVudCkpIHtcbiAgICAgICAgdmFyIGNsYXNzTGlzdCA9IGVsZW1lbnQuZG9tLmNsYXNzTGlzdDtcbiAgICAgICAgY2xhc3NMaXN0LnJlbW92ZShjbGF6eik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZW1vdmUkMyhlbGVtZW50LCBjbGF6eik7XG4gICAgICB9XG4gICAgICBjbGVhbkNsYXNzKGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGhhcyQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICByZXR1cm4gc3VwcG9ydHMoZWxlbWVudCkgJiYgZWxlbWVudC5kb20uY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXp6KTtcbiAgICB9O1xuXG4gICAgdmFyIGFkZCQzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXNzZXMpIHtcbiAgICAgIGVhY2goY2xhc3NlcywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgYWRkJDIoZWxlbWVudCwgeCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW1vdmUkNSA9IGZ1bmN0aW9uIChlbGVtZW50LCBjbGFzc2VzKSB7XG4gICAgICBlYWNoKGNsYXNzZXMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJlbW92ZSQ0KGVsZW1lbnQsIHgpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBpc1N1cHBvcnRlZCQxID0gZnVuY3Rpb24gKGRvbSkge1xuICAgICAgcmV0dXJuIGRvbS5zdHlsZSAhPT0gdW5kZWZpbmVkICYmIGlzRnVuY3Rpb24oZG9tLnN0eWxlLmdldFByb3BlcnR5VmFsdWUpO1xuICAgIH07XG5cbiAgICB2YXIgaW5Cb2R5ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBpc1RleHQoZWxlbWVudCkgPyBlbGVtZW50LmRvbS5wYXJlbnROb2RlIDogZWxlbWVudC5kb207XG4gICAgICBpZiAoZG9tID09PSB1bmRlZmluZWQgfHwgZG9tID09PSBudWxsIHx8IGRvbS5vd25lckRvY3VtZW50ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBkb2MgPSBkb20ub3duZXJEb2N1bWVudDtcbiAgICAgIHJldHVybiBnZXRTaGFkb3dSb290KFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRvbSkpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZG9jLmJvZHkuY29udGFpbnMoZG9tKTtcbiAgICAgIH0sIGNvbXBvc2UxKGluQm9keSwgZ2V0U2hhZG93SG9zdCkpO1xuICAgIH07XG4gICAgdmFyIGJvZHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZ2V0Qm9keShTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudCkpO1xuICAgIH07XG4gICAgdmFyIGdldEJvZHkgPSBmdW5jdGlvbiAoZG9jKSB7XG4gICAgICB2YXIgYiA9IGRvYy5kb20uYm9keTtcbiAgICAgIGlmIChiID09PSBudWxsIHx8IGIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JvZHkgaXMgbm90IGF2YWlsYWJsZSB5ZXQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShiKTtcbiAgICB9O1xuXG4gICAgdmFyIGludGVybmFsU2V0ID0gZnVuY3Rpb24gKGRvbSwgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgICBpZiAoIWlzU3RyaW5nKHZhbHVlKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGNhbGwgdG8gQ1NTLnNldC4gUHJvcGVydHkgJywgcHJvcGVydHksICc6OiBWYWx1ZSAnLCB2YWx1ZSwgJzo6IEVsZW1lbnQgJywgZG9tKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDU1MgdmFsdWUgbXVzdCBiZSBhIHN0cmluZzogJyArIHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1N1cHBvcnRlZCQxKGRvbSkpIHtcbiAgICAgICAgZG9tLnN0eWxlLnNldFByb3BlcnR5KHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaW50ZXJuYWxSZW1vdmUgPSBmdW5jdGlvbiAoZG9tLCBwcm9wZXJ0eSkge1xuICAgICAgaWYgKGlzU3VwcG9ydGVkJDEoZG9tKSkge1xuICAgICAgICBkb20uc3R5bGUucmVtb3ZlUHJvcGVydHkocHJvcGVydHkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHNldCQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgaW50ZXJuYWxTZXQoZG9tLCBwcm9wZXJ0eSwgdmFsdWUpO1xuICAgIH07XG4gICAgdmFyIHNldEFsbCQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNzcykge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgZWFjaCQxKGNzcywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgaW50ZXJuYWxTZXQoZG9tLCBrLCB2KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHNldE9wdGlvbnMgPSBmdW5jdGlvbiAoZWxlbWVudCwgY3NzKSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBlYWNoJDEoY3NzLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICB2LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGludGVybmFsUmVtb3ZlKGRvbSwgayk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIGludGVybmFsU2V0KGRvbSwgaywgdmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldCQ1ID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5KSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICB2YXIgc3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9tKTtcbiAgICAgIHZhciByID0gc3R5bGVzLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHkpO1xuICAgICAgcmV0dXJuIHIgPT09ICcnICYmICFpbkJvZHkoZWxlbWVudCkgPyBnZXRVbnNhZmVQcm9wZXJ0eShkb20sIHByb3BlcnR5KSA6IHI7XG4gICAgfTtcbiAgICB2YXIgZ2V0VW5zYWZlUHJvcGVydHkgPSBmdW5jdGlvbiAoZG9tLCBwcm9wZXJ0eSkge1xuICAgICAgcmV0dXJuIGlzU3VwcG9ydGVkJDEoZG9tKSA/IGRvbS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5KSA6ICcnO1xuICAgIH07XG4gICAgdmFyIGdldFJhdyA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0eSkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgdmFyIHJhdyA9IGdldFVuc2FmZVByb3BlcnR5KGRvbSwgcHJvcGVydHkpO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20ocmF3KS5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuIHIubGVuZ3RoID4gMDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldEFsbFJhdyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICB2YXIgY3NzID0ge307XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBpZiAoaXNTdXBwb3J0ZWQkMShkb20pKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9tLnN0eWxlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHJ1bGVOYW1lID0gZG9tLnN0eWxlLml0ZW0oaSk7XG4gICAgICAgICAgY3NzW3J1bGVOYW1lXSA9IGRvbS5zdHlsZVtydWxlTmFtZV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjc3M7XG4gICAgfTtcbiAgICB2YXIgaXNWYWxpZFZhbHVlID0gZnVuY3Rpb24gKHRhZywgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgICB2YXIgZWxlbWVudCA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKHRhZyk7XG4gICAgICBzZXQkMihlbGVtZW50LCBwcm9wZXJ0eSwgdmFsdWUpO1xuICAgICAgdmFyIHN0eWxlID0gZ2V0UmF3KGVsZW1lbnQsIHByb3BlcnR5KTtcbiAgICAgIHJldHVybiBzdHlsZS5pc1NvbWUoKTtcbiAgICB9O1xuICAgIHZhciByZW1vdmUkNiA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0eSkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgaW50ZXJuYWxSZW1vdmUoZG9tLCBwcm9wZXJ0eSk7XG4gICAgICBpZiAoZ2V0T3B0KGVsZW1lbnQsICdzdHlsZScpLm1hcCh0cmltKS5pcygnJykpIHtcbiAgICAgICAgcmVtb3ZlJDEoZWxlbWVudCwgJ3N0eWxlJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVmbG93ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBlLmRvbS5vZmZzZXRXaWR0aDtcbiAgICB9O1xuXG4gICAgdmFyIGdldCQ2ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50LmRvbS52YWx1ZTtcbiAgICB9O1xuICAgIHZhciBzZXQkMyA9IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWx1ZS5zZXQgd2FzIHVuZGVmaW5lZCcpO1xuICAgICAgfVxuICAgICAgZWxlbWVudC5kb20udmFsdWUgPSB2YWx1ZTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlclRvRG9tID0gZnVuY3Rpb24gKGRlZmluaXRpb24pIHtcbiAgICAgIHZhciBzdWJqZWN0ID0gU3VnYXJFbGVtZW50LmZyb21UYWcoZGVmaW5pdGlvbi50YWcpO1xuICAgICAgc2V0QWxsKHN1YmplY3QsIGRlZmluaXRpb24uYXR0cmlidXRlcyk7XG4gICAgICBhZGQkMyhzdWJqZWN0LCBkZWZpbml0aW9uLmNsYXNzZXMpO1xuICAgICAgc2V0QWxsJDEoc3ViamVjdCwgZGVmaW5pdGlvbi5zdHlsZXMpO1xuICAgICAgZGVmaW5pdGlvbi5pbm5lckh0bWwuZWFjaChmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgICByZXR1cm4gc2V0KHN1YmplY3QsIGh0bWwpO1xuICAgICAgfSk7XG4gICAgICB2YXIgY2hpbGRyZW4gPSBkZWZpbml0aW9uLmRvbUNoaWxkcmVuO1xuICAgICAgYXBwZW5kJDEoc3ViamVjdCwgY2hpbGRyZW4pO1xuICAgICAgZGVmaW5pdGlvbi52YWx1ZS5lYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBzZXQkMyhzdWJqZWN0LCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICAgIGlmICghZGVmaW5pdGlvbi51aWQpIHtcbiAgICAgICAgZGVidWdnZXI7XG4gICAgICB9XG4gICAgICB3cml0ZU9ubHkoc3ViamVjdCwgZGVmaW5pdGlvbi51aWQpO1xuICAgICAgcmV0dXJuIHN1YmplY3Q7XG4gICAgfTtcblxuICAgIHZhciBnZXRCZWhhdmlvdXJzJDEgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIGJlaGF2aW91cnMgPSBnZXQkMShzcGVjLCAnYmVoYXZpb3VycycpLmdldE9yKHt9KTtcbiAgICAgIHZhciBrZXlzJDEgPSBmaWx0ZXIoa2V5cyhiZWhhdmlvdXJzKSwgZnVuY3Rpb24gKGspIHtcbiAgICAgICAgcmV0dXJuIGJlaGF2aW91cnNba10gIT09IHVuZGVmaW5lZDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1hcChrZXlzJDEsIGZ1bmN0aW9uIChrKSB7XG4gICAgICAgIHJldHVybiBiZWhhdmlvdXJzW2tdLm1lO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGVGcm9tJDEgPSBmdW5jdGlvbiAoc3BlYywgYWxsKSB7XG4gICAgICByZXR1cm4gZ2VuZXJhdGVGcm9tKHNwZWMsIGFsbCk7XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGUkMyA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICB2YXIgYWxsID0gZ2V0QmVoYXZpb3VycyQxKHNwZWMpO1xuICAgICAgcmV0dXJuIGdlbmVyYXRlRnJvbSQxKHNwZWMsIGFsbCk7XG4gICAgfTtcblxuICAgIHZhciBnZXREb21EZWZpbml0aW9uID0gZnVuY3Rpb24gKGluZm8sIGJMaXN0LCBiRGF0YSkge1xuICAgICAgdmFyIGRlZmluaXRpb24gPSB0b0RlZmluaXRpb24oaW5mbyk7XG4gICAgICB2YXIgaW5mb01vZGlmaWNhdGlvbiA9IHRvTW9kaWZpY2F0aW9uKGluZm8pO1xuICAgICAgdmFyIGJhc2VNb2RpZmljYXRpb24gPSB7ICdhbGxveS5iYXNlLm1vZGlmaWNhdGlvbic6IGluZm9Nb2RpZmljYXRpb24gfTtcbiAgICAgIHZhciBtb2RpZmljYXRpb24gPSBiTGlzdC5sZW5ndGggPiAwID8gY29tYmluZShiRGF0YSwgYmFzZU1vZGlmaWNhdGlvbiwgYkxpc3QsIGRlZmluaXRpb24pIDogaW5mb01vZGlmaWNhdGlvbjtcbiAgICAgIHJldHVybiBtZXJnZSQxKGRlZmluaXRpb24sIG1vZGlmaWNhdGlvbik7XG4gICAgfTtcbiAgICB2YXIgZ2V0RXZlbnRzID0gZnVuY3Rpb24gKGluZm8sIGJMaXN0LCBiRGF0YSkge1xuICAgICAgdmFyIGJhc2VFdmVudHMgPSB7ICdhbGxveS5iYXNlLmJlaGF2aW91cic6IHRvRXZlbnRzKGluZm8pIH07XG4gICAgICByZXR1cm4gY29tYmluZSQxKGJEYXRhLCBpbmZvLmV2ZW50T3JkZXIsIGJMaXN0LCBiYXNlRXZlbnRzKS5nZXRPckRpZSgpO1xuICAgIH07XG4gICAgdmFyIGJ1aWxkID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHZhciBnZXRNZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG1lO1xuICAgICAgfTtcbiAgICAgIHZhciBzeXN0ZW1BcGkgPSBDZWxsKHNpbmdsZXRvbik7XG4gICAgICB2YXIgaW5mbyA9IGdldE9yRGllKHRvSW5mbyhzcGVjKSk7XG4gICAgICB2YXIgYkJsb2IgPSBnZW5lcmF0ZSQzKHNwZWMpO1xuICAgICAgdmFyIGJMaXN0ID0gZ2V0QmVoYXZpb3VycyhiQmxvYik7XG4gICAgICB2YXIgYkRhdGEgPSBnZXREYXRhKGJCbG9iKTtcbiAgICAgIHZhciBtb2REZWZpbml0aW9uID0gZ2V0RG9tRGVmaW5pdGlvbihpbmZvLCBiTGlzdCwgYkRhdGEpO1xuICAgICAgdmFyIGl0ZW0gPSByZW5kZXJUb0RvbShtb2REZWZpbml0aW9uKTtcbiAgICAgIHZhciBldmVudHMgPSBnZXRFdmVudHMoaW5mbywgYkxpc3QsIGJEYXRhKTtcbiAgICAgIHZhciBzdWJjb21wb25lbnRzID0gQ2VsbChpbmZvLmNvbXBvbmVudHMpO1xuICAgICAgdmFyIGNvbm5lY3QgPSBmdW5jdGlvbiAobmV3QXBpKSB7XG4gICAgICAgIHN5c3RlbUFwaS5zZXQobmV3QXBpKTtcbiAgICAgIH07XG4gICAgICB2YXIgZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3lzdGVtQXBpLnNldChOb0NvbnRleHRBcGkoZ2V0TWUpKTtcbiAgICAgIH07XG4gICAgICB2YXIgc3luY0NvbXBvbmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4oaXRlbSk7XG4gICAgICAgIHZhciBzdWJzID0gYmluZChjaGlsZHJlbiQxLCBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgICByZXR1cm4gc3lzdGVtQXBpLmdldCgpLmdldEJ5RG9tKGNoaWxkKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgcmV0dXJuIFtjXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHN1YmNvbXBvbmVudHMuc2V0KHN1YnMpO1xuICAgICAgfTtcbiAgICAgIHZhciBjb25maWcgPSBmdW5jdGlvbiAoYmVoYXZpb3VyKSB7XG4gICAgICAgIHZhciBiID0gYkRhdGE7XG4gICAgICAgIHZhciBmID0gaXNGdW5jdGlvbihiW2JlaGF2aW91ci5uYW1lKCldKSA/IGJbYmVoYXZpb3VyLm5hbWUoKV0gOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZmluZCAnICsgYmVoYXZpb3VyLm5hbWUoKSArICcgaW4gJyArIEpTT04uc3RyaW5naWZ5KHNwZWMsIG51bGwsIDIpKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGYoKTtcbiAgICAgIH07XG4gICAgICB2YXIgaGFzQ29uZmlndXJlZCA9IGZ1bmN0aW9uIChiZWhhdmlvdXIpIHtcbiAgICAgICAgcmV0dXJuIGlzRnVuY3Rpb24oYkRhdGFbYmVoYXZpb3VyLm5hbWUoKV0pO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRBcGlzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaW5mby5hcGlzO1xuICAgICAgfTtcbiAgICAgIHZhciByZWFkU3RhdGUgPSBmdW5jdGlvbiAoYmVoYXZpb3VyTmFtZSkge1xuICAgICAgICByZXR1cm4gYkRhdGFbYmVoYXZpb3VyTmFtZV0oKS5tYXAoZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgICByZXR1cm4gYi5zdGF0ZS5yZWFkU3RhdGUoKTtcbiAgICAgICAgfSkuZ2V0T3IoJ25vdCBlbmFibGVkJyk7XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBnZXRTeXN0ZW06IHN5c3RlbUFwaS5nZXQsXG4gICAgICAgIGNvbmZpZzogY29uZmlnLFxuICAgICAgICBoYXNDb25maWd1cmVkOiBoYXNDb25maWd1cmVkLFxuICAgICAgICBzcGVjOiBzcGVjLFxuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZSxcbiAgICAgICAgZ2V0QXBpczogZ2V0QXBpcyxcbiAgICAgICAgY29ubmVjdDogY29ubmVjdCxcbiAgICAgICAgZGlzY29ubmVjdDogZGlzY29ubmVjdCxcbiAgICAgICAgZWxlbWVudDogaXRlbSxcbiAgICAgICAgc3luY0NvbXBvbmVudHM6IHN5bmNDb21wb25lbnRzLFxuICAgICAgICBjb21wb25lbnRzOiBzdWJjb21wb25lbnRzLmdldCxcbiAgICAgICAgZXZlbnRzOiBldmVudHNcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWU7XG4gICAgfTtcblxuICAgIHZhciBidWlsZFN1YmNvbXBvbmVudHMgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIGNvbXBvbmVudHMgPSBnZXQkMShzcGVjLCAnY29tcG9uZW50cycpLmdldE9yKFtdKTtcbiAgICAgIHJldHVybiBtYXAoY29tcG9uZW50cywgYnVpbGQkMSk7XG4gICAgfTtcbiAgICB2YXIgYnVpbGRGcm9tU3BlYyA9IGZ1bmN0aW9uICh1c2VyU3BlYykge1xuICAgICAgdmFyIF9hID0gbWFrZSh1c2VyU3BlYyksIHNwZWNFdmVudHMgPSBfYS5ldmVudHMsIHNwZWMgPSBfX3Jlc3QoX2EsIFsnZXZlbnRzJ10pO1xuICAgICAgdmFyIGNvbXBvbmVudHMgPSBidWlsZFN1YmNvbXBvbmVudHMoc3BlYyk7XG4gICAgICB2YXIgY29tcGxldGVTcGVjID0gX19hc3NpZ24oX19hc3NpZ24oe30sIHNwZWMpLCB7XG4gICAgICAgIGV2ZW50czogX19hc3NpZ24oX19hc3NpZ24oe30sIERlZmF1bHRFdmVudHMpLCBzcGVjRXZlbnRzKSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50c1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gUmVzdWx0LnZhbHVlKGJ1aWxkKGNvbXBsZXRlU3BlYykpO1xuICAgIH07XG4gICAgdmFyIHRleHQgPSBmdW5jdGlvbiAodGV4dENvbnRlbnQpIHtcbiAgICAgIHZhciBlbGVtZW50ID0gU3VnYXJFbGVtZW50LmZyb21UZXh0KHRleHRDb250ZW50KTtcbiAgICAgIHJldHVybiBleHRlcm5hbCh7IGVsZW1lbnQ6IGVsZW1lbnQgfSk7XG4gICAgfTtcbiAgICB2YXIgZXh0ZXJuYWwgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIGV4dFNwZWMgPSBhc1Jhd09yRGllKCdleHRlcm5hbC5jb21wb25lbnQnLCBvYmpPZk9ubHkoW1xuICAgICAgICBzdHJpY3QkMSgnZWxlbWVudCcpLFxuICAgICAgICBvcHRpb24oJ3VpZCcpXG4gICAgICBdKSwgc3BlYyk7XG4gICAgICB2YXIgc3lzdGVtQXBpID0gQ2VsbChOb0NvbnRleHRBcGkoKSk7XG4gICAgICB2YXIgY29ubmVjdCA9IGZ1bmN0aW9uIChuZXdBcGkpIHtcbiAgICAgICAgc3lzdGVtQXBpLnNldChuZXdBcGkpO1xuICAgICAgfTtcbiAgICAgIHZhciBkaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzeXN0ZW1BcGkuc2V0KE5vQ29udGV4dEFwaShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1lO1xuICAgICAgICB9KSk7XG4gICAgICB9O1xuICAgICAgZXh0U3BlYy51aWQuZWFjaChmdW5jdGlvbiAodWlkKSB7XG4gICAgICAgIHdyaXRlT25seShleHRTcGVjLmVsZW1lbnQsIHVpZCk7XG4gICAgICB9KTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZ2V0U3lzdGVtOiBzeXN0ZW1BcGkuZ2V0LFxuICAgICAgICBjb25maWc6IE9wdGlvbmFsLm5vbmUsXG4gICAgICAgIGhhc0NvbmZpZ3VyZWQ6IG5ldmVyLFxuICAgICAgICBjb25uZWN0OiBjb25uZWN0LFxuICAgICAgICBkaXNjb25uZWN0OiBkaXNjb25uZWN0LFxuICAgICAgICBnZXRBcGlzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9LFxuICAgICAgICBlbGVtZW50OiBleHRTcGVjLmVsZW1lbnQsXG4gICAgICAgIHNwZWM6IHNwZWMsXG4gICAgICAgIHJlYWRTdGF0ZTogY29uc3RhbnQoJ05vIHN0YXRlJyksXG4gICAgICAgIHN5bmNDb21wb25lbnRzOiBub29wLFxuICAgICAgICBjb21wb25lbnRzOiBjb25zdGFudChbXSksXG4gICAgICAgIGV2ZW50czoge31cbiAgICAgIH07XG4gICAgICByZXR1cm4gcHJlbWFkZShtZSk7XG4gICAgfTtcbiAgICB2YXIgdWlkcyA9IGdlbmVyYXRlJDI7XG4gICAgdmFyIGJ1aWxkJDEgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGdldFByZW1hZGUoc3BlYykuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB1c2VyU3BlY1dpdGhVaWQgPSBzcGVjLmhhc093blByb3BlcnR5KCd1aWQnKSA/IHNwZWMgOiBfX2Fzc2lnbih7IHVpZDogdWlkcygnJykgfSwgc3BlYyk7XG4gICAgICAgIHJldHVybiBidWlsZEZyb21TcGVjKHVzZXJTcGVjV2l0aFVpZCkuZ2V0T3JEaWUoKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChwcmVidWlsdCkge1xuICAgICAgICByZXR1cm4gcHJlYnVpbHQ7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwcmVtYWRlJDEgPSBwcmVtYWRlO1xuXG4gICAgdmFyIERpbWVuc2lvbiA9IGZ1bmN0aW9uIChuYW1lLCBnZXRPZmZzZXQpIHtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCwgaCkge1xuICAgICAgICBpZiAoIWlzTnVtYmVyKGgpICYmICFoLm1hdGNoKC9eWzAtOV0rJC8pKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUgKyAnLnNldCBhY2NlcHRzIG9ubHkgcG9zaXRpdmUgaW50ZWdlciB2YWx1ZXMuIFZhbHVlIHdhcyAnICsgaCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgICBpZiAoaXNTdXBwb3J0ZWQkMShkb20pKSB7XG4gICAgICAgICAgZG9tLnN0eWxlW25hbWVdID0gaCArICdweCc7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHIgPSBnZXRPZmZzZXQoZWxlbWVudCk7XG4gICAgICAgIGlmIChyIDw9IDAgfHwgciA9PT0gbnVsbCkge1xuICAgICAgICAgIHZhciBjc3MgPSBnZXQkNShlbGVtZW50LCBuYW1lKTtcbiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChjc3MpIHx8IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgICB9O1xuICAgICAgdmFyIGdldE91dGVyID0gZ2V0O1xuICAgICAgdmFyIGFnZ3JlZ2F0ZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIHJldHVybiBmb2xkbChwcm9wZXJ0aWVzLCBmdW5jdGlvbiAoYWNjLCBwcm9wZXJ0eSkge1xuICAgICAgICAgIHZhciB2YWwgPSBnZXQkNShlbGVtZW50LCBwcm9wZXJ0eSk7XG4gICAgICAgICAgdmFyIHZhbHVlID0gdmFsID09PSB1bmRlZmluZWQgPyAwIDogcGFyc2VJbnQodmFsLCAxMCk7XG4gICAgICAgICAgcmV0dXJuIGlzTmFOKHZhbHVlKSA/IGFjYyA6IGFjYyArIHZhbHVlO1xuICAgICAgICB9LCAwKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWF4ID0gZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlLCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIHZhciBjdW11bGF0aXZlSW5jbHVzaW9ucyA9IGFnZ3JlZ2F0ZShlbGVtZW50LCBwcm9wZXJ0aWVzKTtcbiAgICAgICAgdmFyIGFic29sdXRlTWF4ID0gdmFsdWUgPiBjdW11bGF0aXZlSW5jbHVzaW9ucyA/IHZhbHVlIC0gY3VtdWxhdGl2ZUluY2x1c2lvbnMgOiAwO1xuICAgICAgICByZXR1cm4gYWJzb2x1dGVNYXg7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGdldDogZ2V0LFxuICAgICAgICBnZXRPdXRlcjogZ2V0T3V0ZXIsXG4gICAgICAgIGFnZ3JlZ2F0ZTogYWdncmVnYXRlLFxuICAgICAgICBtYXg6IG1heFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGFwaSA9IERpbWVuc2lvbignaGVpZ2h0JywgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIHJldHVybiBpbkJvZHkoZWxlbWVudCkgPyBkb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0IDogZG9tLm9mZnNldEhlaWdodDtcbiAgICB9KTtcbiAgICB2YXIgZ2V0JDcgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFwaS5nZXQoZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3V0ZXIkMSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYXBpLmdldE91dGVyKGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIHNldE1heCA9IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZSkge1xuICAgICAgdmFyIGluY2x1c2lvbnMgPSBbXG4gICAgICAgICdtYXJnaW4tdG9wJyxcbiAgICAgICAgJ2JvcmRlci10b3Atd2lkdGgnLFxuICAgICAgICAncGFkZGluZy10b3AnLFxuICAgICAgICAncGFkZGluZy1ib3R0b20nLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbS13aWR0aCcsXG4gICAgICAgICdtYXJnaW4tYm90dG9tJ1xuICAgICAgXTtcbiAgICAgIHZhciBhYnNNYXggPSBhcGkubWF4KGVsZW1lbnQsIHZhbHVlLCBpbmNsdXNpb25zKTtcbiAgICAgIHNldCQyKGVsZW1lbnQsICdtYXgtaGVpZ2h0JywgYWJzTWF4ICsgJ3B4Jyk7XG4gICAgfTtcblxuICAgIHZhciByID0gZnVuY3Rpb24gKGxlZnQsIHRvcCkge1xuICAgICAgdmFyIHRyYW5zbGF0ZSA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiByKGxlZnQgKyB4LCB0b3AgKyB5KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZWZ0OiBsZWZ0LFxuICAgICAgICB0b3A6IHRvcCxcbiAgICAgICAgdHJhbnNsYXRlOiB0cmFuc2xhdGVcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgU3VnYXJQb3NpdGlvbiA9IHI7XG5cbiAgICB2YXIgYm94UG9zaXRpb24gPSBmdW5jdGlvbiAoZG9tKSB7XG4gICAgICB2YXIgYm94ID0gZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24oYm94LmxlZnQsIGJveC50b3ApO1xuICAgIH07XG4gICAgdmFyIGZpcnN0RGVmaW5lZE9yWmVybyA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICBpZiAoYSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBhO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGIgIT09IHVuZGVmaW5lZCA/IGIgOiAwO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGFic29sdXRlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb2MgPSBlbGVtZW50LmRvbS5vd25lckRvY3VtZW50O1xuICAgICAgdmFyIGJvZHkgPSBkb2MuYm9keTtcbiAgICAgIHZhciB3aW4gPSBkb2MuZGVmYXVsdFZpZXc7XG4gICAgICB2YXIgaHRtbCA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICBpZiAoYm9keSA9PT0gZWxlbWVudC5kb20pIHtcbiAgICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24oYm9keS5vZmZzZXRMZWZ0LCBib2R5Lm9mZnNldFRvcCk7XG4gICAgICB9XG4gICAgICB2YXIgc2Nyb2xsVG9wID0gZmlyc3REZWZpbmVkT3JaZXJvKHdpbiA9PT0gbnVsbCB8fCB3aW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHdpbi5wYWdlWU9mZnNldCwgaHRtbC5zY3JvbGxUb3ApO1xuICAgICAgdmFyIHNjcm9sbExlZnQgPSBmaXJzdERlZmluZWRPclplcm8od2luID09PSBudWxsIHx8IHdpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2luLnBhZ2VYT2Zmc2V0LCBodG1sLnNjcm9sbExlZnQpO1xuICAgICAgdmFyIGNsaWVudFRvcCA9IGZpcnN0RGVmaW5lZE9yWmVybyhodG1sLmNsaWVudFRvcCwgYm9keS5jbGllbnRUb3ApO1xuICAgICAgdmFyIGNsaWVudExlZnQgPSBmaXJzdERlZmluZWRPclplcm8oaHRtbC5jbGllbnRMZWZ0LCBib2R5LmNsaWVudExlZnQpO1xuICAgICAgcmV0dXJuIHZpZXdwb3J0KGVsZW1lbnQpLnRyYW5zbGF0ZShzY3JvbGxMZWZ0IC0gY2xpZW50TGVmdCwgc2Nyb2xsVG9wIC0gY2xpZW50VG9wKTtcbiAgICB9O1xuICAgIHZhciB2aWV3cG9ydCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICB2YXIgZG9jID0gZG9tLm93bmVyRG9jdW1lbnQ7XG4gICAgICB2YXIgYm9keSA9IGRvYy5ib2R5O1xuICAgICAgaWYgKGJvZHkgPT09IGRvbSkge1xuICAgICAgICByZXR1cm4gU3VnYXJQb3NpdGlvbihib2R5Lm9mZnNldExlZnQsIGJvZHkub2Zmc2V0VG9wKTtcbiAgICAgIH1cbiAgICAgIGlmICghaW5Cb2R5KGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBTdWdhclBvc2l0aW9uKDAsIDApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJveFBvc2l0aW9uKGRvbSk7XG4gICAgfTtcblxuICAgIHZhciBhcGkkMSA9IERpbWVuc2lvbignd2lkdGgnLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLm9mZnNldFdpZHRoO1xuICAgIH0pO1xuICAgIHZhciBzZXQkNCA9IGZ1bmN0aW9uIChlbGVtZW50LCBoKSB7XG4gICAgICByZXR1cm4gYXBpJDEuc2V0KGVsZW1lbnQsIGgpO1xuICAgIH07XG4gICAgdmFyIGdldCQ4ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBhcGkkMS5nZXQoZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3V0ZXIkMiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYXBpJDEuZ2V0T3V0ZXIoZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgc2V0TWF4JDEgPSBmdW5jdGlvbiAoZWxlbWVudCwgdmFsdWUpIHtcbiAgICAgIHZhciBpbmNsdXNpb25zID0gW1xuICAgICAgICAnbWFyZ2luLWxlZnQnLFxuICAgICAgICAnYm9yZGVyLWxlZnQtd2lkdGgnLFxuICAgICAgICAncGFkZGluZy1sZWZ0JyxcbiAgICAgICAgJ3BhZGRpbmctcmlnaHQnLFxuICAgICAgICAnYm9yZGVyLXJpZ2h0LXdpZHRoJyxcbiAgICAgICAgJ21hcmdpbi1yaWdodCdcbiAgICAgIF07XG4gICAgICB2YXIgYWJzTWF4ID0gYXBpJDEubWF4KGVsZW1lbnQsIHZhbHVlLCBpbmNsdXNpb25zKTtcbiAgICAgIHNldCQyKGVsZW1lbnQsICdtYXgtd2lkdGgnLCBhYnNNYXggKyAncHgnKTtcbiAgICB9O1xuXG4gICAgdmFyIG1rRXZlbnQgPSBmdW5jdGlvbiAodGFyZ2V0LCB4LCB5LCBzdG9wLCBwcmV2ZW50LCBraWxsLCByYXcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5LFxuICAgICAgICBzdG9wOiBzdG9wLFxuICAgICAgICBwcmV2ZW50OiBwcmV2ZW50LFxuICAgICAgICBraWxsOiBraWxsLFxuICAgICAgICByYXc6IHJhd1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tUmF3RXZlbnQgPSBmdW5jdGlvbiAocmF3RXZlbnQpIHtcbiAgICAgIHZhciB0YXJnZXQgPSBTdWdhckVsZW1lbnQuZnJvbURvbShnZXRPcmlnaW5hbEV2ZW50VGFyZ2V0KHJhd0V2ZW50KS5nZXRPcihyYXdFdmVudC50YXJnZXQpKTtcbiAgICAgIHZhciBzdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmF3RXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9O1xuICAgICAgdmFyIHByZXZlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByYXdFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfTtcbiAgICAgIHZhciBraWxsID0gY29tcG9zZShwcmV2ZW50LCBzdG9wKTtcbiAgICAgIHJldHVybiBta0V2ZW50KHRhcmdldCwgcmF3RXZlbnQuY2xpZW50WCwgcmF3RXZlbnQuY2xpZW50WSwgc3RvcCwgcHJldmVudCwga2lsbCwgcmF3RXZlbnQpO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIChmaWx0ZXIsIGhhbmRsZXIpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAocmF3RXZlbnQpIHtcbiAgICAgICAgaWYgKGZpbHRlcihyYXdFdmVudCkpIHtcbiAgICAgICAgICBoYW5kbGVyKGZyb21SYXdFdmVudChyYXdFdmVudCkpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGJpbmRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCBldmVudCwgZmlsdGVyLCBoYW5kbGVyLCB1c2VDYXB0dXJlKSB7XG4gICAgICB2YXIgd3JhcHBlZCA9IGhhbmRsZShmaWx0ZXIsIGhhbmRsZXIpO1xuICAgICAgZWxlbWVudC5kb20uYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgd3JhcHBlZCwgdXNlQ2FwdHVyZSk7XG4gICAgICByZXR1cm4geyB1bmJpbmQ6IGN1cnJ5KHVuYmluZCwgZWxlbWVudCwgZXZlbnQsIHdyYXBwZWQsIHVzZUNhcHR1cmUpIH07XG4gICAgfTtcbiAgICB2YXIgYmluZCQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50LCBmaWx0ZXIsIGhhbmRsZXIpIHtcbiAgICAgIHJldHVybiBiaW5kZXIoZWxlbWVudCwgZXZlbnQsIGZpbHRlciwgaGFuZGxlciwgZmFsc2UpO1xuICAgIH07XG4gICAgdmFyIGNhcHR1cmUgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGZpbHRlciwgaGFuZGxlcikge1xuICAgICAgcmV0dXJuIGJpbmRlcihlbGVtZW50LCBldmVudCwgZmlsdGVyLCBoYW5kbGVyLCB0cnVlKTtcbiAgICB9O1xuICAgIHZhciB1bmJpbmQgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIsIHVzZUNhcHR1cmUpIHtcbiAgICAgIGVsZW1lbnQuZG9tLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIHVzZUNhcHR1cmUpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0JDkgPSBmdW5jdGlvbiAoX0RPQykge1xuICAgICAgdmFyIGRvYyA9IF9ET0MgIT09IHVuZGVmaW5lZCA/IF9ET0MuZG9tIDogZG9jdW1lbnQ7XG4gICAgICB2YXIgeCA9IGRvYy5ib2R5LnNjcm9sbExlZnQgfHwgZG9jLmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0O1xuICAgICAgdmFyIHkgPSBkb2MuYm9keS5zY3JvbGxUb3AgfHwgZG9jLmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICByZXR1cm4gU3VnYXJQb3NpdGlvbih4LCB5KTtcbiAgICB9O1xuICAgIHZhciB0byA9IGZ1bmN0aW9uICh4LCB5LCBfRE9DKSB7XG4gICAgICB2YXIgZG9jID0gX0RPQyAhPT0gdW5kZWZpbmVkID8gX0RPQy5kb20gOiBkb2N1bWVudDtcbiAgICAgIHZhciB3aW4gPSBkb2MuZGVmYXVsdFZpZXc7XG4gICAgICBpZiAod2luKSB7XG4gICAgICAgIHdpbi5zY3JvbGxUbyh4LCB5KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGdldCRhID0gZnVuY3Rpb24gKF93aW4pIHtcbiAgICAgIHZhciB3aW4gPSBfd2luID09PSB1bmRlZmluZWQgPyB3aW5kb3cgOiBfd2luO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20od2luWyd2aXN1YWxWaWV3cG9ydCddKTtcbiAgICB9O1xuICAgIHZhciBib3VuZHMgPSBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgcmlnaHQ6IHggKyB3aWR0aCxcbiAgICAgICAgYm90dG9tOiB5ICsgaGVpZ2h0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldEJvdW5kcyA9IGZ1bmN0aW9uIChfd2luKSB7XG4gICAgICB2YXIgd2luID0gX3dpbiA9PT0gdW5kZWZpbmVkID8gd2luZG93IDogX3dpbjtcbiAgICAgIHZhciBkb2MgPSB3aW4uZG9jdW1lbnQ7XG4gICAgICB2YXIgc2Nyb2xsID0gZ2V0JDkoU3VnYXJFbGVtZW50LmZyb21Eb20oZG9jKSk7XG4gICAgICByZXR1cm4gZ2V0JGEod2luKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGh0bWwgPSB3aW4uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICB2YXIgd2lkdGggPSBodG1sLmNsaWVudFdpZHRoO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gaHRtbC5jbGllbnRIZWlnaHQ7XG4gICAgICAgIHJldHVybiBib3VuZHMoc2Nyb2xsLmxlZnQsIHNjcm9sbC50b3AsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgfSwgZnVuY3Rpb24gKHZpc3VhbFZpZXdwb3J0KSB7XG4gICAgICAgIHJldHVybiBib3VuZHMoTWF0aC5tYXgodmlzdWFsVmlld3BvcnQucGFnZUxlZnQsIHNjcm9sbC5sZWZ0KSwgTWF0aC5tYXgodmlzdWFsVmlld3BvcnQucGFnZVRvcCwgc2Nyb2xsLnRvcCksIHZpc3VhbFZpZXdwb3J0LndpZHRoLCB2aXN1YWxWaWV3cG9ydC5oZWlnaHQpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciB3YWxrVXAgPSBmdW5jdGlvbiAobmF2aWdhdGlvbiwgZG9jKSB7XG4gICAgICB2YXIgZnJhbWUgPSBuYXZpZ2F0aW9uLnZpZXcoZG9jKTtcbiAgICAgIHJldHVybiBmcmFtZS5mb2xkKGNvbnN0YW50KFtdKSwgZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgdmFyIHBhcmVudCA9IG5hdmlnYXRpb24ub3duZXIoZik7XG4gICAgICAgIHZhciByZXN0ID0gd2Fsa1VwKG5hdmlnYXRpb24sIHBhcmVudCk7XG4gICAgICAgIHJldHVybiBbZl0uY29uY2F0KHJlc3QpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcGF0aFRvID0gZnVuY3Rpb24gKGVsZW1lbnQsIG5hdmlnYXRpb24pIHtcbiAgICAgIHZhciBkID0gbmF2aWdhdGlvbi5vd25lcihlbGVtZW50KTtcbiAgICAgIHZhciBwYXRocyA9IHdhbGtVcChuYXZpZ2F0aW9uLCBkKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHBhdGhzKTtcbiAgICB9O1xuXG4gICAgdmFyIHZpZXcgPSBmdW5jdGlvbiAoZG9jKSB7XG4gICAgICB2YXIgX2E7XG4gICAgICB2YXIgZWxlbWVudCA9IGRvYy5kb20gPT09IGRvY3VtZW50ID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuZnJvbSgoX2EgPSBkb2MuZG9tLmRlZmF1bHRWaWV3KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZnJhbWVFbGVtZW50KTtcbiAgICAgIHJldHVybiBlbGVtZW50Lm1hcChTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcbiAgICB2YXIgb3duZXIkMSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gb3duZXIoZWxlbWVudCk7XG4gICAgfTtcblxuICAgIHZhciBOYXZpZ2F0aW9uID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIHZpZXc6IHZpZXcsXG4gICAgICAgIG93bmVyOiBvd25lciQxXG4gICAgfSk7XG5cbiAgICB2YXIgZmluZCQzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb2MgPSBTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudCk7XG4gICAgICB2YXIgc2Nyb2xsID0gZ2V0JDkoZG9jKTtcbiAgICAgIHZhciBwYXRoID0gcGF0aFRvKGVsZW1lbnQsIE5hdmlnYXRpb24pO1xuICAgICAgcmV0dXJuIHBhdGguZm9sZChjdXJyeShhYnNvbHV0ZSwgZWxlbWVudCksIGZ1bmN0aW9uIChmcmFtZXMpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IHZpZXdwb3J0KGVsZW1lbnQpO1xuICAgICAgICB2YXIgciA9IGZvbGRyKGZyYW1lcywgZnVuY3Rpb24gKGIsIGEpIHtcbiAgICAgICAgICB2YXIgbG9jID0gdmlld3BvcnQoYSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGxlZnQ6IGIubGVmdCArIGxvYy5sZWZ0LFxuICAgICAgICAgICAgdG9wOiBiLnRvcCArIGxvYy50b3BcbiAgICAgICAgICB9O1xuICAgICAgICB9LCB7XG4gICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICB0b3A6IDBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBTdWdhclBvc2l0aW9uKHIubGVmdCArIG9mZnNldC5sZWZ0ICsgc2Nyb2xsLmxlZnQsIHIudG9wICsgb2Zmc2V0LnRvcCArIHNjcm9sbC50b3ApO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBwb2ludGVkID0gZnVuY3Rpb24gKHBvaW50LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb2ludDogcG9pbnQsXG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVjdCA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5LFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGJvdW5kcyQxID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IHgsXG4gICAgICAgIHk6IHksXG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHJpZ2h0OiB4ICsgd2lkdGgsXG4gICAgICAgIGJvdHRvbTogeSArIGhlaWdodFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBib3ggPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIHh5ID0gYWJzb2x1dGUoZWxlbWVudCk7XG4gICAgICB2YXIgdyA9IGdldE91dGVyJDIoZWxlbWVudCk7XG4gICAgICB2YXIgaCA9IGdldE91dGVyJDEoZWxlbWVudCk7XG4gICAgICByZXR1cm4gYm91bmRzJDEoeHkubGVmdCwgeHkudG9wLCB3LCBoKTtcbiAgICB9O1xuICAgIHZhciBhYnNvbHV0ZSQxID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBwb3NpdGlvbiA9IGZpbmQkMyhlbGVtZW50KTtcbiAgICAgIHZhciB3aWR0aCA9IGdldE91dGVyJDIoZWxlbWVudCk7XG4gICAgICB2YXIgaGVpZ2h0ID0gZ2V0T3V0ZXIkMShlbGVtZW50KTtcbiAgICAgIHJldHVybiBib3VuZHMkMShwb3NpdGlvbi5sZWZ0LCBwb3NpdGlvbi50b3AsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH07XG4gICAgdmFyIHdpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBnZXRCb3VuZHMod2luZG93KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gQ2xvc2VzdE9yQW5jZXN0b3IgKGlzLCBhbmNlc3Rvciwgc2NvcGUsIGEsIGlzUm9vdCkge1xuICAgICAgaWYgKGlzKHNjb3BlLCBhKSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShzY29wZSk7XG4gICAgICB9IGVsc2UgaWYgKGlzRnVuY3Rpb24oaXNSb290KSAmJiBpc1Jvb3Qoc2NvcGUpKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYW5jZXN0b3Ioc2NvcGUsIGEsIGlzUm9vdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGFuY2VzdG9yJDEgPSBmdW5jdGlvbiAoc2NvcGUsIHByZWRpY2F0ZSwgaXNSb290KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IHNjb3BlLmRvbTtcbiAgICAgIHZhciBzdG9wID0gaXNGdW5jdGlvbihpc1Jvb3QpID8gaXNSb290IDogbmV2ZXI7XG4gICAgICB3aGlsZSAoZWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICAgIHZhciBlbCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsZW1lbnQpO1xuICAgICAgICBpZiAocHJlZGljYXRlKGVsKSkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGVsKTtcbiAgICAgICAgfSBlbHNlIGlmIChzdG9wKGVsKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGNsb3Nlc3QkMSA9IGZ1bmN0aW9uIChzY29wZSwgcHJlZGljYXRlLCBpc1Jvb3QpIHtcbiAgICAgIHZhciBpcyA9IGZ1bmN0aW9uIChzLCB0ZXN0KSB7XG4gICAgICAgIHJldHVybiB0ZXN0KHMpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBDbG9zZXN0T3JBbmNlc3RvcihpcywgYW5jZXN0b3IkMSwgc2NvcGUsIHByZWRpY2F0ZSwgaXNSb290KTtcbiAgICB9O1xuICAgIHZhciBkZXNjZW5kYW50ID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciBkZXNjZW5kID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2YXIgY2hpbGRfMSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKG5vZGUuY2hpbGROb2Rlc1tpXSk7XG4gICAgICAgICAgaWYgKHByZWRpY2F0ZShjaGlsZF8xKSkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoY2hpbGRfMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXMgPSBkZXNjZW5kKG5vZGUuY2hpbGROb2Rlc1tpXSk7XG4gICAgICAgICAgaWYgKHJlcy5pc1NvbWUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVzY2VuZChzY29wZS5kb20pO1xuICAgIH07XG5cbiAgICB2YXIgY2xvc2VzdCQyID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGNsb3Nlc3QkMShzY29wZSwgcHJlZGljYXRlLCBpc1Jvb3QpLmlzU29tZSgpO1xuICAgIH07XG5cbiAgICB2YXIgYW5jZXN0b3IkMiA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGFuY2VzdG9yJDEoc2NvcGUsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBpcyhlLCBzZWxlY3Rvcik7XG4gICAgICB9LCBpc1Jvb3QpO1xuICAgIH07XG4gICAgdmFyIGRlc2NlbmRhbnQkMSA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBvbmUoc2VsZWN0b3IsIHNjb3BlKTtcbiAgICB9O1xuICAgIHZhciBjbG9zZXN0JDMgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdG9yLCBpc1Jvb3QpIHtcbiAgICAgIHZhciBpcyQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7XG4gICAgICAgIHJldHVybiBpcyhlbGVtZW50LCBzZWxlY3Rvcik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIENsb3Nlc3RPckFuY2VzdG9yKGlzJDEsIGFuY2VzdG9yJDIsIHNjb3BlLCBzZWxlY3RvciwgaXNSb290KTtcbiAgICB9O1xuXG4gICAgdmFyIGZpbmQkNCA9IGZ1bmN0aW9uIChxdWVyeUVsZW0pIHtcbiAgICAgIHZhciBkZXBlbmRlbnQgPSBjbG9zZXN0JDEocXVlcnlFbGVtLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICBpZiAoIWlzRWxlbWVudChlbGVtKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaWQgPSBnZXQkMyhlbGVtLCAnaWQnKTtcbiAgICAgICAgcmV0dXJuIGlkICE9PSB1bmRlZmluZWQgJiYgaWQuaW5kZXhPZignYXJpYS1vd25zJykgPiAtMTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlcGVuZGVudC5iaW5kKGZ1bmN0aW9uIChkZXApIHtcbiAgICAgICAgdmFyIGlkID0gZ2V0JDMoZGVwLCAnaWQnKTtcbiAgICAgICAgdmFyIGRvcyA9IGdldFJvb3ROb2RlKGRlcCk7XG4gICAgICAgIHJldHVybiBkZXNjZW5kYW50JDEoZG9zLCAnW2FyaWEtb3ducz1cIicgKyBpZCArICdcIl0nKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1hbmFnZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYXJpYUlkID0gZ2VuZXJhdGUkMSgnYXJpYS1vd25zJyk7XG4gICAgICB2YXIgbGluayA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHNldCQxKGVsZW0sICdhcmlhLW93bnMnLCBhcmlhSWQpO1xuICAgICAgfTtcbiAgICAgIHZhciB1bmxpbmsgPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZW1vdmUkMShlbGVtLCAnYXJpYS1vd25zJyk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGFyaWFJZCxcbiAgICAgICAgbGluazogbGluayxcbiAgICAgICAgdW5saW5rOiB1bmxpbmtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBpc0FyaWFQYXJ0T2YgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBxdWVyeUVsZW0pIHtcbiAgICAgIHJldHVybiBmaW5kJDQocXVlcnlFbGVtKS5leGlzdHMoZnVuY3Rpb24gKG93bmVyKSB7XG4gICAgICAgIHJldHVybiBpc1BhcnRPZihjb21wb25lbnQsIG93bmVyKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzUGFydE9mID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcXVlcnlFbGVtKSB7XG4gICAgICByZXR1cm4gY2xvc2VzdCQyKHF1ZXJ5RWxlbSwgZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBlcSQxKGVsLCBjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICB9LCBuZXZlcikgfHwgaXNBcmlhUGFydE9mKGNvbXBvbmVudCwgcXVlcnlFbGVtKTtcbiAgICB9O1xuXG4gICAgdmFyIHVua25vd24kMyA9ICd1bmtub3duJztcbiAgICB2YXIgRXZlbnRDb25maWd1cmF0aW9uO1xuICAgIChmdW5jdGlvbiAoRXZlbnRDb25maWd1cmF0aW9uKSB7XG4gICAgICBFdmVudENvbmZpZ3VyYXRpb25bRXZlbnRDb25maWd1cmF0aW9uWydTVE9QJ10gPSAwXSA9ICdTVE9QJztcbiAgICAgIEV2ZW50Q29uZmlndXJhdGlvbltFdmVudENvbmZpZ3VyYXRpb25bJ05PUk1BTCddID0gMV0gPSAnTk9STUFMJztcbiAgICAgIEV2ZW50Q29uZmlndXJhdGlvbltFdmVudENvbmZpZ3VyYXRpb25bJ0xPR0dJTkcnXSA9IDJdID0gJ0xPR0dJTkcnO1xuICAgIH0oRXZlbnRDb25maWd1cmF0aW9uIHx8IChFdmVudENvbmZpZ3VyYXRpb24gPSB7fSkpKTtcbiAgICB2YXIgZXZlbnRDb25maWcgPSBDZWxsKHt9KTtcbiAgICB2YXIgbWFrZUV2ZW50TG9nZ2VyID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaW5pdGlhbFRhcmdldCkge1xuICAgICAgdmFyIHNlcXVlbmNlID0gW107XG4gICAgICB2YXIgc3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsb2dFdmVudEN1dDogZnVuY3Rpb24gKF9uYW1lLCB0YXJnZXQsIHB1cnBvc2UpIHtcbiAgICAgICAgICBzZXF1ZW5jZS5wdXNoKHtcbiAgICAgICAgICAgIG91dGNvbWU6ICdjdXQnLFxuICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgICAgICBwdXJwb3NlOiBwdXJwb3NlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZ0V2ZW50U3RvcHBlZDogZnVuY3Rpb24gKF9uYW1lLCB0YXJnZXQsIHB1cnBvc2UpIHtcbiAgICAgICAgICBzZXF1ZW5jZS5wdXNoKHtcbiAgICAgICAgICAgIG91dGNvbWU6ICdzdG9wcGVkJyxcbiAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICAgICAgcHVycG9zZTogcHVycG9zZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBsb2dOb1BhcmVudDogZnVuY3Rpb24gKF9uYW1lLCB0YXJnZXQsIHB1cnBvc2UpIHtcbiAgICAgICAgICBzZXF1ZW5jZS5wdXNoKHtcbiAgICAgICAgICAgIG91dGNvbWU6ICduby1wYXJlbnQnLFxuICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgICAgICBwdXJwb3NlOiBwdXJwb3NlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZ0V2ZW50Tm9IYW5kbGVyczogZnVuY3Rpb24gKF9uYW1lLCB0YXJnZXQpIHtcbiAgICAgICAgICBzZXF1ZW5jZS5wdXNoKHtcbiAgICAgICAgICAgIG91dGNvbWU6ICduby1oYW5kbGVycy1sZWZ0JyxcbiAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvZ0V2ZW50UmVzcG9uc2U6IGZ1bmN0aW9uIChfbmFtZSwgdGFyZ2V0LCBwdXJwb3NlKSB7XG4gICAgICAgICAgc2VxdWVuY2UucHVzaCh7XG4gICAgICAgICAgICBvdXRjb21lOiAncmVzcG9uc2UnLFxuICAgICAgICAgICAgcHVycG9zZTogcHVycG9zZSxcbiAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHdyaXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGZpbmlzaFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICBpZiAoY29udGFpbnMoW1xuICAgICAgICAgICAgICAnbW91c2Vtb3ZlJyxcbiAgICAgICAgICAgICAgJ21vdXNlb3ZlcicsXG4gICAgICAgICAgICAgICdtb3VzZW91dCcsXG4gICAgICAgICAgICAgIHN5c3RlbUluaXQoKVxuICAgICAgICAgICAgXSwgZXZlbnROYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLmxvZyhldmVudE5hbWUsIHtcbiAgICAgICAgICAgIGV2ZW50OiBldmVudE5hbWUsXG4gICAgICAgICAgICB0aW1lOiBmaW5pc2hUaW1lIC0gc3RhcnRUaW1lLFxuICAgICAgICAgICAgdGFyZ2V0OiBpbml0aWFsVGFyZ2V0LmRvbSxcbiAgICAgICAgICAgIHNlcXVlbmNlOiBtYXAoc2VxdWVuY2UsIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgICAgIGlmICghY29udGFpbnMoW1xuICAgICAgICAgICAgICAgICAgJ2N1dCcsXG4gICAgICAgICAgICAgICAgICAnc3RvcHBlZCcsXG4gICAgICAgICAgICAgICAgICAncmVzcG9uc2UnXG4gICAgICAgICAgICAgICAgXSwgcy5vdXRjb21lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzLm91dGNvbWU7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICd7JyArIHMucHVycG9zZSArICd9ICcgKyBzLm91dGNvbWUgKyAnIGF0ICgnICsgZWxlbWVudChzLnRhcmdldCkgKyAnKSc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcHJvY2Vzc0V2ZW50ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaW5pdGlhbFRhcmdldCwgZikge1xuICAgICAgdmFyIHN0YXR1cyA9IGdldCQxKGV2ZW50Q29uZmlnLmdldCgpLCBldmVudE5hbWUpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGF0dGVybnMgPSBrZXlzKGV2ZW50Q29uZmlnLmdldCgpKTtcbiAgICAgICAgcmV0dXJuIGZpbmRNYXAocGF0dGVybnMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50TmFtZS5pbmRleE9mKHApID4gLTEgPyBPcHRpb25hbC5zb21lKGV2ZW50Q29uZmlnLmdldCgpW3BdKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KS5nZXRPcihFdmVudENvbmZpZ3VyYXRpb24uTk9STUFMKTtcbiAgICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICBjYXNlIEV2ZW50Q29uZmlndXJhdGlvbi5OT1JNQUw6XG4gICAgICAgIHJldHVybiBmKG5vTG9nZ2VyKCkpO1xuICAgICAgY2FzZSBFdmVudENvbmZpZ3VyYXRpb24uTE9HR0lORzoge1xuICAgICAgICAgIHZhciBsb2dnZXIgPSBtYWtlRXZlbnRMb2dnZXIoZXZlbnROYW1lLCBpbml0aWFsVGFyZ2V0KTtcbiAgICAgICAgICB2YXIgb3V0cHV0ID0gZihsb2dnZXIpO1xuICAgICAgICAgIGxvZ2dlci53cml0ZSgpO1xuICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgRXZlbnRDb25maWd1cmF0aW9uLlNUT1A6XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHBhdGggPSBbXG4gICAgICAnYWxsb3kvZGF0YS9GaWVsZHMnLFxuICAgICAgJ2FsbG95L2RlYnVnZ2luZy9EZWJ1Z2dpbmcnXG4gICAgXTtcbiAgICB2YXIgZ2V0VHJhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCk7XG4gICAgICBpZiAoZXJyLnN0YWNrICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIGxpbmVzID0gZXJyLnN0YWNrLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgcmV0dXJuIGZpbmQobGluZXMsIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICAgICAgcmV0dXJuIGxpbmUuaW5kZXhPZignYWxsb3knKSA+IDAgJiYgIWV4aXN0cyhwYXRoLCBmdW5jdGlvbiAocCkge1xuICAgICAgICAgICAgcmV0dXJuIGxpbmUuaW5kZXhPZihwKSA+IC0xO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KS5nZXRPcih1bmtub3duJDMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHVua25vd24kMztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpZ25vcmVFdmVudCA9IHtcbiAgICAgIGxvZ0V2ZW50Q3V0OiBub29wLFxuICAgICAgbG9nRXZlbnRTdG9wcGVkOiBub29wLFxuICAgICAgbG9nTm9QYXJlbnQ6IG5vb3AsXG4gICAgICBsb2dFdmVudE5vSGFuZGxlcnM6IG5vb3AsXG4gICAgICBsb2dFdmVudFJlc3BvbnNlOiBub29wLFxuICAgICAgd3JpdGU6IG5vb3BcbiAgICB9O1xuICAgIHZhciBtb25pdG9yRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBpbml0aWFsVGFyZ2V0LCBmKSB7XG4gICAgICByZXR1cm4gcHJvY2Vzc0V2ZW50KGV2ZW50TmFtZSwgaW5pdGlhbFRhcmdldCwgZik7XG4gICAgfTtcbiAgICB2YXIgbm9Mb2dnZXIgPSBjb25zdGFudChpZ25vcmVFdmVudCk7XG5cbiAgICB2YXIgbWVudUZpZWxkcyA9IGNvbnN0YW50KFtcbiAgICAgIHN0cmljdCQxKCdtZW51JyksXG4gICAgICBzdHJpY3QkMSgnc2VsZWN0ZWRNZW51JylcbiAgICBdKTtcbiAgICB2YXIgaXRlbUZpZWxkcyA9IGNvbnN0YW50KFtcbiAgICAgIHN0cmljdCQxKCdpdGVtJyksXG4gICAgICBzdHJpY3QkMSgnc2VsZWN0ZWRJdGVtJylcbiAgICBdKTtcbiAgICB2YXIgc2NoZW1hID0gY29uc3RhbnQob2JqT2YoaXRlbUZpZWxkcygpLmNvbmNhdChtZW51RmllbGRzKCkpKSk7XG4gICAgdmFyIGl0ZW1TY2hlbWEgPSBjb25zdGFudChvYmpPZihpdGVtRmllbGRzKCkpKTtcblxuICAgIHZhciBfaW5pdFNpemUgPSBzdHJpY3RPYmpPZignaW5pdFNpemUnLCBbXG4gICAgICBzdHJpY3QkMSgnbnVtQ29sdW1ucycpLFxuICAgICAgc3RyaWN0JDEoJ251bVJvd3MnKVxuICAgIF0pO1xuICAgIHZhciBpdGVtTWFya2VycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBzdHJpY3RPZignbWFya2VycycsIGl0ZW1TY2hlbWEoKSk7XG4gICAgfTtcbiAgICB2YXIgdGllcmVkTWVudU1hcmtlcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gc3RyaWN0T2JqT2YoJ21hcmtlcnMnLCBbc3RyaWN0JDEoJ2JhY2tncm91bmRNZW51JyldLmNvbmNhdChtZW51RmllbGRzKCkpLmNvbmNhdChpdGVtRmllbGRzKCkpKTtcbiAgICB9O1xuICAgIHZhciBtYXJrZXJzID0gZnVuY3Rpb24gKHJlcXVpcmVkKSB7XG4gICAgICByZXR1cm4gc3RyaWN0T2JqT2YoJ21hcmtlcnMnLCBtYXAocmVxdWlyZWQsIHN0cmljdCQxKSk7XG4gICAgfTtcbiAgICB2YXIgb25QcmVzZW5jZUhhbmRsZXIgPSBmdW5jdGlvbiAobGFiZWwsIGZpZWxkTmFtZSwgcHJlc2VuY2UpIHtcbiAgICAgIHZhciB0cmFjZSA9IGdldFRyYWNlKCk7XG4gICAgICByZXR1cm4gZmllbGQoZmllbGROYW1lLCBmaWVsZE5hbWUsIHByZXNlbmNlLCB2YWx1ZU9mKGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQudmFsdWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGYuYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcbiAgICAgICAgfSk7XG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgb25IYW5kbGVyID0gZnVuY3Rpb24gKGZpZWxkTmFtZSkge1xuICAgICAgcmV0dXJuIG9uUHJlc2VuY2VIYW5kbGVyKCdvbkhhbmRsZXInLCBmaWVsZE5hbWUsIGRlZmF1bHRlZChub29wKSk7XG4gICAgfTtcbiAgICB2YXIgb25LZXlib2FyZEhhbmRsZXIgPSBmdW5jdGlvbiAoZmllbGROYW1lKSB7XG4gICAgICByZXR1cm4gb25QcmVzZW5jZUhhbmRsZXIoJ29uS2V5Ym9hcmRIYW5kbGVyJywgZmllbGROYW1lLCBkZWZhdWx0ZWQoT3B0aW9uYWwubm9uZSkpO1xuICAgIH07XG4gICAgdmFyIG9uU3RyaWN0SGFuZGxlciA9IGZ1bmN0aW9uIChmaWVsZE5hbWUpIHtcbiAgICAgIHJldHVybiBvblByZXNlbmNlSGFuZGxlcignb25IYW5kbGVyJywgZmllbGROYW1lLCBzdHJpY3QoKSk7XG4gICAgfTtcbiAgICB2YXIgb25TdHJpY3RLZXlib2FyZEhhbmRsZXIgPSBmdW5jdGlvbiAoZmllbGROYW1lKSB7XG4gICAgICByZXR1cm4gb25QcmVzZW5jZUhhbmRsZXIoJ29uS2V5Ym9hcmRIYW5kbGVyJywgZmllbGROYW1lLCBzdHJpY3QoKSk7XG4gICAgfTtcbiAgICB2YXIgb3V0cHV0ID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gICAgICByZXR1cm4gc3RhdGUkMShuYW1lLCBjb25zdGFudCh2YWx1ZSkpO1xuICAgIH07XG4gICAgdmFyIHNuYXBzaG90ID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBzdGF0ZSQxKG5hbWUsIGlkZW50aXR5KTtcbiAgICB9O1xuICAgIHZhciBpbml0U2l6ZSA9IGNvbnN0YW50KF9pbml0U2l6ZSk7XG5cbiAgICB2YXIgbnUkNyA9IGZ1bmN0aW9uICh4LCB5LCBidWJibGUsIGRpcmVjdGlvbiwgYm91bmRzUmVzdHJpY3Rpb24sIGxhYmVsKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5LFxuICAgICAgICBidWJibGU6IGJ1YmJsZSxcbiAgICAgICAgZGlyZWN0aW9uOiBkaXJlY3Rpb24sXG4gICAgICAgIGJvdW5kc1Jlc3RyaWN0aW9uOiBib3VuZHNSZXN0cmljdGlvbixcbiAgICAgICAgbGFiZWw6IGxhYmVsXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgYWR0JDIgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAgeyBzb3V0aGVhc3Q6IFtdIH0sXG4gICAgICB7IHNvdXRod2VzdDogW10gfSxcbiAgICAgIHsgbm9ydGhlYXN0OiBbXSB9LFxuICAgICAgeyBub3J0aHdlc3Q6IFtdIH0sXG4gICAgICB7IHNvdXRoOiBbXSB9LFxuICAgICAgeyBub3J0aDogW10gfSxcbiAgICAgIHsgZWFzdDogW10gfSxcbiAgICAgIHsgd2VzdDogW10gfVxuICAgIF0pO1xuICAgIHZhciBjYXRhID0gZnVuY3Rpb24gKHN1YmplY3QsIHNvdXRoZWFzdCwgc291dGh3ZXN0LCBub3J0aGVhc3QsIG5vcnRod2VzdCwgc291dGgsIG5vcnRoLCBlYXN0LCB3ZXN0KSB7XG4gICAgICByZXR1cm4gc3ViamVjdC5mb2xkKHNvdXRoZWFzdCwgc291dGh3ZXN0LCBub3J0aGVhc3QsIG5vcnRod2VzdCwgc291dGgsIG5vcnRoLCBlYXN0LCB3ZXN0KTtcbiAgICB9O1xuICAgIHZhciBjYXRhVmVydGljYWwgPSBmdW5jdGlvbiAoc3ViamVjdCwgc291dGgsIG1pZGRsZSwgbm9ydGgpIHtcbiAgICAgIHJldHVybiBzdWJqZWN0LmZvbGQoc291dGgsIHNvdXRoLCBub3J0aCwgbm9ydGgsIHNvdXRoLCBub3J0aCwgbWlkZGxlLCBtaWRkbGUpO1xuICAgIH07XG4gICAgdmFyIGNhdGFIb3Jpem9udGFsID0gZnVuY3Rpb24gKHN1YmplY3QsIGVhc3QsIG1pZGRsZSwgd2VzdCkge1xuICAgICAgcmV0dXJuIHN1YmplY3QuZm9sZChlYXN0LCB3ZXN0LCBlYXN0LCB3ZXN0LCBtaWRkbGUsIG1pZGRsZSwgZWFzdCwgd2VzdCk7XG4gICAgfTtcbiAgICB2YXIgc291dGhlYXN0ID0gYWR0JDIuc291dGhlYXN0O1xuICAgIHZhciBzb3V0aHdlc3QgPSBhZHQkMi5zb3V0aHdlc3Q7XG4gICAgdmFyIG5vcnRoZWFzdCA9IGFkdCQyLm5vcnRoZWFzdDtcbiAgICB2YXIgbm9ydGh3ZXN0ID0gYWR0JDIubm9ydGh3ZXN0O1xuICAgIHZhciBzb3V0aCA9IGFkdCQyLnNvdXRoO1xuICAgIHZhciBub3J0aCA9IGFkdCQyLm5vcnRoO1xuICAgIHZhciBlYXN0ID0gYWR0JDIuZWFzdDtcbiAgICB2YXIgd2VzdCA9IGFkdCQyLndlc3Q7XG5cbiAgICB2YXIgZ2V0UmVzdHJpY3Rpb24gPSBmdW5jdGlvbiAoYW5jaG9yLCByZXN0cmljdGlvbikge1xuICAgICAgc3dpdGNoIChyZXN0cmljdGlvbikge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByZXR1cm4gYW5jaG9yLng7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIHJldHVybiBhbmNob3IueCArIGFuY2hvci53aWR0aDtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmV0dXJuIGFuY2hvci55O1xuICAgICAgY2FzZSAzOlxuICAgICAgICByZXR1cm4gYW5jaG9yLnkgKyBhbmNob3IuaGVpZ2h0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGJvdW5kc1Jlc3RyaWN0aW9uID0gZnVuY3Rpb24gKGFuY2hvciwgcmVzdHJpY3Rpb25zKSB7XG4gICAgICByZXR1cm4gbWFwVG9PYmplY3QoW1xuICAgICAgICAnbGVmdCcsXG4gICAgICAgICdyaWdodCcsXG4gICAgICAgICd0b3AnLFxuICAgICAgICAnYm90dG9tJ1xuICAgICAgXSwgZnVuY3Rpb24gKGRpcikge1xuICAgICAgICByZXR1cm4gZ2V0JDEocmVzdHJpY3Rpb25zLCBkaXIpLm1hcChmdW5jdGlvbiAocmVzdHJpY3Rpb24pIHtcbiAgICAgICAgICByZXR1cm4gZ2V0UmVzdHJpY3Rpb24oYW5jaG9yLCByZXN0cmljdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYWRqdXN0Qm91bmRzID0gZnVuY3Rpb24gKGJvdW5kcywgYm91bmRzUmVzdHJpY3Rpb25zLCBidWJibGVPZmZzZXRzKSB7XG4gICAgICB2YXIgYXBwbHlSZXN0cmljdGlvbiA9IGZ1bmN0aW9uIChkaXIsIGN1cnJlbnQpIHtcbiAgICAgICAgdmFyIGJ1YmJsZU9mZnNldCA9IGRpciA9PT0gJ3RvcCcgfHwgZGlyID09PSAnYm90dG9tJyA/IGJ1YmJsZU9mZnNldHMudG9wIDogYnViYmxlT2Zmc2V0cy5sZWZ0O1xuICAgICAgICByZXR1cm4gZ2V0JDEoYm91bmRzUmVzdHJpY3Rpb25zLCBkaXIpLmJpbmQoaWRlbnRpdHkpLmJpbmQoZnVuY3Rpb24gKHJlc3RyaWN0aW9uKSB7XG4gICAgICAgICAgaWYgKGRpciA9PT0gJ2xlZnQnIHx8IGRpciA9PT0gJ3RvcCcpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN0cmljdGlvbiA+PSBjdXJyZW50ID8gT3B0aW9uYWwuc29tZShyZXN0cmljdGlvbikgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN0cmljdGlvbiA8PSBjdXJyZW50ID8gT3B0aW9uYWwuc29tZShyZXN0cmljdGlvbikgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHJlc3RyaWN0aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3RyaWN0aW9uICsgYnViYmxlT2Zmc2V0O1xuICAgICAgICB9KS5nZXRPcihjdXJyZW50KTtcbiAgICAgIH07XG4gICAgICB2YXIgYWRqdXN0ZWRMZWZ0ID0gYXBwbHlSZXN0cmljdGlvbignbGVmdCcsIGJvdW5kcy54KTtcbiAgICAgIHZhciBhZGp1c3RlZFRvcCA9IGFwcGx5UmVzdHJpY3Rpb24oJ3RvcCcsIGJvdW5kcy55KTtcbiAgICAgIHZhciBhZGp1c3RlZFJpZ2h0ID0gYXBwbHlSZXN0cmljdGlvbigncmlnaHQnLCBib3VuZHMucmlnaHQpO1xuICAgICAgdmFyIGFkanVzdGVkQm90dG9tID0gYXBwbHlSZXN0cmljdGlvbignYm90dG9tJywgYm91bmRzLmJvdHRvbSk7XG4gICAgICByZXR1cm4gYm91bmRzJDEoYWRqdXN0ZWRMZWZ0LCBhZGp1c3RlZFRvcCwgYWRqdXN0ZWRSaWdodCAtIGFkanVzdGVkTGVmdCwgYWRqdXN0ZWRCb3R0b20gLSBhZGp1c3RlZFRvcCk7XG4gICAgfTtcblxuICAgIHZhciBlYXN0WCA9IGZ1bmN0aW9uIChhbmNob3IpIHtcbiAgICAgIHJldHVybiBhbmNob3IueDtcbiAgICB9O1xuICAgIHZhciBtaWRkbGVYID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFuY2hvci54ICsgYW5jaG9yLndpZHRoIC8gMiAtIGVsZW1lbnQud2lkdGggLyAyO1xuICAgIH07XG4gICAgdmFyIHdlc3RYID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFuY2hvci54ICsgYW5jaG9yLndpZHRoIC0gZWxlbWVudC53aWR0aDtcbiAgICB9O1xuICAgIHZhciBub3J0aFkgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnkgLSBlbGVtZW50LmhlaWdodDtcbiAgICB9O1xuICAgIHZhciBzb3V0aFkgPSBmdW5jdGlvbiAoYW5jaG9yKSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnkgKyBhbmNob3IuaGVpZ2h0O1xuICAgIH07XG4gICAgdmFyIGNlbnRyZVkgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnkgKyBhbmNob3IuaGVpZ2h0IC8gMiAtIGVsZW1lbnQuaGVpZ2h0IC8gMjtcbiAgICB9O1xuICAgIHZhciBlYXN0RWRnZVggPSBmdW5jdGlvbiAoYW5jaG9yKSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnggKyBhbmNob3Iud2lkdGg7XG4gICAgfTtcbiAgICB2YXIgd2VzdEVkZ2VYID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFuY2hvci54IC0gZWxlbWVudC53aWR0aDtcbiAgICB9O1xuICAgIHZhciBzb3V0aGVhc3QkMSA9IGZ1bmN0aW9uIChhbmNob3IsIGVsZW1lbnQsIGJ1YmJsZXMpIHtcbiAgICAgIHJldHVybiBudSQ3KGVhc3RYKGFuY2hvciksIHNvdXRoWShhbmNob3IpLCBidWJibGVzLnNvdXRoZWFzdCgpLCBzb3V0aGVhc3QoKSwgYm91bmRzUmVzdHJpY3Rpb24oYW5jaG9yLCB7XG4gICAgICAgIGxlZnQ6IDEsXG4gICAgICAgIHRvcDogM1xuICAgICAgfSksICdsYXlvdXQtc2UnKTtcbiAgICB9O1xuICAgIHZhciBzb3V0aHdlc3QkMSA9IGZ1bmN0aW9uIChhbmNob3IsIGVsZW1lbnQsIGJ1YmJsZXMpIHtcbiAgICAgIHJldHVybiBudSQ3KHdlc3RYKGFuY2hvciwgZWxlbWVudCksIHNvdXRoWShhbmNob3IpLCBidWJibGVzLnNvdXRod2VzdCgpLCBzb3V0aHdlc3QoKSwgYm91bmRzUmVzdHJpY3Rpb24oYW5jaG9yLCB7XG4gICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICB0b3A6IDNcbiAgICAgIH0pLCAnbGF5b3V0LXN3Jyk7XG4gICAgfTtcbiAgICB2YXIgbm9ydGhlYXN0JDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyhlYXN0WChhbmNob3IpLCBub3J0aFkoYW5jaG9yLCBlbGVtZW50KSwgYnViYmxlcy5ub3J0aGVhc3QoKSwgbm9ydGhlYXN0KCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwge1xuICAgICAgICBsZWZ0OiAxLFxuICAgICAgICBib3R0b206IDJcbiAgICAgIH0pLCAnbGF5b3V0LW5lJyk7XG4gICAgfTtcbiAgICB2YXIgbm9ydGh3ZXN0JDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyh3ZXN0WChhbmNob3IsIGVsZW1lbnQpLCBub3J0aFkoYW5jaG9yLCBlbGVtZW50KSwgYnViYmxlcy5ub3J0aHdlc3QoKSwgbm9ydGh3ZXN0KCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwge1xuICAgICAgICByaWdodDogMCxcbiAgICAgICAgYm90dG9tOiAyXG4gICAgICB9KSwgJ2xheW91dC1udycpO1xuICAgIH07XG4gICAgdmFyIG5vcnRoJDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyhtaWRkbGVYKGFuY2hvciwgZWxlbWVudCksIG5vcnRoWShhbmNob3IsIGVsZW1lbnQpLCBidWJibGVzLm5vcnRoKCksIG5vcnRoKCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwgeyBib3R0b206IDIgfSksICdsYXlvdXQtbicpO1xuICAgIH07XG4gICAgdmFyIHNvdXRoJDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyhtaWRkbGVYKGFuY2hvciwgZWxlbWVudCksIHNvdXRoWShhbmNob3IpLCBidWJibGVzLnNvdXRoKCksIHNvdXRoKCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwgeyB0b3A6IDMgfSksICdsYXlvdXQtcycpO1xuICAgIH07XG4gICAgdmFyIGVhc3QkMSA9IGZ1bmN0aW9uIChhbmNob3IsIGVsZW1lbnQsIGJ1YmJsZXMpIHtcbiAgICAgIHJldHVybiBudSQ3KGVhc3RFZGdlWChhbmNob3IpLCBjZW50cmVZKGFuY2hvciwgZWxlbWVudCksIGJ1YmJsZXMuZWFzdCgpLCBlYXN0KCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwgeyBsZWZ0OiAwIH0pLCAnbGF5b3V0LWUnKTtcbiAgICB9O1xuICAgIHZhciB3ZXN0JDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyh3ZXN0RWRnZVgoYW5jaG9yLCBlbGVtZW50KSwgY2VudHJlWShhbmNob3IsIGVsZW1lbnQpLCBidWJibGVzLndlc3QoKSwgd2VzdCgpLCBib3VuZHNSZXN0cmljdGlvbihhbmNob3IsIHsgcmlnaHQ6IDEgfSksICdsYXlvdXQtdycpO1xuICAgIH07XG4gICAgdmFyIGFsbCQyID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgc291dGhlYXN0JDEsXG4gICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICBub3J0aGVhc3QkMSxcbiAgICAgICAgbm9ydGh3ZXN0JDEsXG4gICAgICAgIHNvdXRoJDEsXG4gICAgICAgIG5vcnRoJDEsXG4gICAgICAgIGVhc3QkMSxcbiAgICAgICAgd2VzdCQxXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIGFsbFJ0bCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICBzb3V0aGVhc3QkMSxcbiAgICAgICAgbm9ydGh3ZXN0JDEsXG4gICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICBzb3V0aCQxLFxuICAgICAgICBub3J0aCQxLFxuICAgICAgICBlYXN0JDEsXG4gICAgICAgIHdlc3QkMVxuICAgICAgXTtcbiAgICB9O1xuICAgIHZhciBhYm92ZU9yQmVsb3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBub3J0aGVhc3QkMSxcbiAgICAgICAgbm9ydGh3ZXN0JDEsXG4gICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICBzb3V0aHdlc3QkMSxcbiAgICAgICAgbm9ydGgkMSxcbiAgICAgICAgc291dGgkMVxuICAgICAgXTtcbiAgICB9O1xuICAgIHZhciBhYm92ZU9yQmVsb3dSdGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBub3J0aHdlc3QkMSxcbiAgICAgICAgbm9ydGhlYXN0JDEsXG4gICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICBzb3V0aGVhc3QkMSxcbiAgICAgICAgbm9ydGgkMSxcbiAgICAgICAgc291dGgkMVxuICAgICAgXTtcbiAgICB9O1xuICAgIHZhciBiZWxvd09yQWJvdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBzb3V0aGVhc3QkMSxcbiAgICAgICAgc291dGh3ZXN0JDEsXG4gICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICBub3J0aHdlc3QkMSxcbiAgICAgICAgc291dGgkMSxcbiAgICAgICAgbm9ydGgkMVxuICAgICAgXTtcbiAgICB9O1xuICAgIHZhciBiZWxvd09yQWJvdmVSdGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBzb3V0aHdlc3QkMSxcbiAgICAgICAgc291dGhlYXN0JDEsXG4gICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICBub3J0aGVhc3QkMSxcbiAgICAgICAgc291dGgkMSxcbiAgICAgICAgbm9ydGgkMVxuICAgICAgXTtcbiAgICB9O1xuXG4gICAgdmFyIGNob29zZUNoYW5uZWxzID0gZnVuY3Rpb24gKGNoYW5uZWxzLCBtZXNzYWdlKSB7XG4gICAgICByZXR1cm4gbWVzc2FnZS51bml2ZXJzYWwgPyBjaGFubmVscyA6IGZpbHRlcihjaGFubmVscywgZnVuY3Rpb24gKGNoKSB7XG4gICAgICAgIHJldHVybiBjb250YWlucyhtZXNzYWdlLmNoYW5uZWxzLCBjaCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBldmVudHMkMSA9IGZ1bmN0aW9uIChyZWNlaXZlQ29uZmlnKSB7XG4gICAgICByZXR1cm4gZGVyaXZlKFtydW4ocmVjZWl2ZSgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBtZXNzYWdlKSB7XG4gICAgICAgICAgdmFyIGNoYW5uZWxNYXAgPSByZWNlaXZlQ29uZmlnLmNoYW5uZWxzO1xuICAgICAgICAgIHZhciBjaGFubmVscyA9IGtleXMoY2hhbm5lbE1hcCk7XG4gICAgICAgICAgdmFyIHJlY2VpdmluZ0RhdGEgPSBtZXNzYWdlO1xuICAgICAgICAgIHZhciB0YXJnZXRDaGFubmVscyA9IGNob29zZUNoYW5uZWxzKGNoYW5uZWxzLCByZWNlaXZpbmdEYXRhKTtcbiAgICAgICAgICBlYWNoKHRhcmdldENoYW5uZWxzLCBmdW5jdGlvbiAoY2gpIHtcbiAgICAgICAgICAgIHZhciBjaGFubmVsSW5mbyA9IGNoYW5uZWxNYXBbY2hdO1xuICAgICAgICAgICAgdmFyIGNoYW5uZWxTY2hlbWEgPSBjaGFubmVsSW5mby5zY2hlbWE7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGFzUmF3T3JEaWUoJ2NoYW5uZWxbJyArIGNoICsgJ10gZGF0YVxcblJlY2VpdmVyOiAnICsgZWxlbWVudChjb21wb25lbnQuZWxlbWVudCksIGNoYW5uZWxTY2hlbWEsIHJlY2VpdmluZ0RhdGEuZGF0YSk7XG4gICAgICAgICAgICBjaGFubmVsSW5mby5vblJlY2VpdmUoY29tcG9uZW50LCBkYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSldKTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZVJlY2VpdmluZyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBldmVudHM6IGV2ZW50cyQxXG4gICAgfSk7XG5cbiAgICB2YXIgUmVjZWl2aW5nU2NoZW1hID0gW3N0cmljdE9mKCdjaGFubmVscycsIHNldE9mJDEoUmVzdWx0LnZhbHVlLCBvYmpPZk9ubHkoW1xuICAgICAgICBvblN0cmljdEhhbmRsZXIoJ29uUmVjZWl2ZScpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnc2NoZW1hJywgYW55VmFsdWUkMSgpKVxuICAgICAgXSkpKV07XG5cbiAgICB2YXIgZXhlY3V0ZUV2ZW50ID0gZnVuY3Rpb24gKGJDb25maWcsIGJTdGF0ZSwgZXhlY3V0b3IpIHtcbiAgICAgIHJldHVybiBydW5PbkV4ZWN1dGUoZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICBleGVjdXRvcihjb21wb25lbnQsIGJDb25maWcsIGJTdGF0ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBsb2FkRXZlbnQgPSBmdW5jdGlvbiAoYkNvbmZpZywgYlN0YXRlLCBmKSB7XG4gICAgICByZXR1cm4gcnVuT25Jbml0KGZ1bmN0aW9uIChjb21wb25lbnQsIF9zaW11bGF0ZWRFdmVudCkge1xuICAgICAgICBmKGNvbXBvbmVudCwgYkNvbmZpZywgYlN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZSA9IGZ1bmN0aW9uIChzY2hlbWEsIG5hbWUsIGFjdGl2ZSwgYXBpcywgZXh0cmEsIHN0YXRlKSB7XG4gICAgICB2YXIgY29uZmlnU2NoZW1hID0gb2JqT2ZPbmx5KHNjaGVtYSk7XG4gICAgICB2YXIgc2NoZW1hU2NoZW1hID0gb3B0aW9uT2JqT2YobmFtZSwgW29wdGlvbk9iak9mT25seSgnY29uZmlnJywgc2NoZW1hKV0pO1xuICAgICAgcmV0dXJuIGRvQ3JlYXRlKGNvbmZpZ1NjaGVtYSwgc2NoZW1hU2NoZW1hLCBuYW1lLCBhY3RpdmUsIGFwaXMsIGV4dHJhLCBzdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlTW9kZXMgPSBmdW5jdGlvbiAobW9kZXMsIG5hbWUsIGFjdGl2ZSwgYXBpcywgZXh0cmEsIHN0YXRlKSB7XG4gICAgICB2YXIgY29uZmlnU2NoZW1hID0gbW9kZXM7XG4gICAgICB2YXIgc2NoZW1hU2NoZW1hID0gb3B0aW9uT2JqT2YobmFtZSwgW29wdGlvbk9mKCdjb25maWcnLCBtb2RlcyldKTtcbiAgICAgIHJldHVybiBkb0NyZWF0ZShjb25maWdTY2hlbWEsIHNjaGVtYVNjaGVtYSwgbmFtZSwgYWN0aXZlLCBhcGlzLCBleHRyYSwgc3RhdGUpO1xuICAgIH07XG4gICAgdmFyIHdyYXBBcGkgPSBmdW5jdGlvbiAoYk5hbWUsIGFwaUZ1bmN0aW9uLCBhcGlOYW1lKSB7XG4gICAgICB2YXIgZiA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgdmFyIHJlc3QgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICByZXN0W19pIC0gMV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhcmdzID0gW2NvbXBvbmVudF0uY29uY2F0KHJlc3QpO1xuICAgICAgICByZXR1cm4gY29tcG9uZW50LmNvbmZpZyh7IG5hbWU6IGNvbnN0YW50KGJOYW1lKSB9KS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dlIGNvdWxkIG5vdCBmaW5kIGFueSBiZWhhdmlvdXIgY29uZmlndXJhdGlvbiBmb3I6ICcgKyBiTmFtZSArICcuIFVzaW5nIEFQSTogJyArIGFwaU5hbWUpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgIHZhciByZXN0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJncywgMSk7XG4gICAgICAgICAgcmV0dXJuIGFwaUZ1bmN0aW9uLmFwcGx5KHVuZGVmaW5lZCwgW1xuICAgICAgICAgICAgY29tcG9uZW50LFxuICAgICAgICAgICAgaW5mby5jb25maWcsXG4gICAgICAgICAgICBpbmZvLnN0YXRlXG4gICAgICAgICAgXS5jb25jYXQocmVzdCkpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWFya0FzQmVoYXZpb3VyQXBpKGYsIGFwaU5hbWUsIGFwaUZ1bmN0aW9uKTtcbiAgICB9O1xuICAgIHZhciByZXZva2VCZWhhdmlvdXIgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5OiBuYW1lLFxuICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGRvQ3JlYXRlID0gZnVuY3Rpb24gKGNvbmZpZ1NjaGVtYSwgc2NoZW1hU2NoZW1hLCBuYW1lLCBhY3RpdmUsIGFwaXMsIGV4dHJhLCBzdGF0ZSkge1xuICAgICAgdmFyIGdldENvbmZpZyA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgIHJldHVybiBoYXNOb25OdWxsYWJsZUtleShpbmZvLCBuYW1lKSA/IGluZm9bbmFtZV0oKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgd3JhcHBlZEFwaXMgPSBtYXAkMihhcGlzLCBmdW5jdGlvbiAoYXBpRiwgYXBpTmFtZSkge1xuICAgICAgICByZXR1cm4gd3JhcEFwaShuYW1lLCBhcGlGLCBhcGlOYW1lKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHdyYXBwZWRFeHRyYSA9IG1hcCQyKGV4dHJhLCBmdW5jdGlvbiAoZXh0cmFGLCBleHRyYU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIG1hcmtBc0V4dHJhQXBpKGV4dHJhRiwgZXh0cmFOYW1lKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIG1lID0gX19hc3NpZ24oX19hc3NpZ24oX19hc3NpZ24oe30sIHdyYXBwZWRFeHRyYSksIHdyYXBwZWRBcGlzKSwge1xuICAgICAgICByZXZva2U6IGN1cnJ5KHJldm9rZUJlaGF2aW91ciwgbmFtZSksXG4gICAgICAgIGNvbmZpZzogZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgICAgICB2YXIgcHJlcGFyZWQgPSBhc1Jhd09yRGllKG5hbWUgKyAnLWNvbmZpZycsIGNvbmZpZ1NjaGVtYSwgc3BlYyk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtleTogbmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgIGNvbmZpZzogcHJlcGFyZWQsXG4gICAgICAgICAgICAgIG1lOiBtZSxcbiAgICAgICAgICAgICAgY29uZmlnQXNSYXc6IGNhY2hlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzUmF3T3JEaWUobmFtZSArICctY29uZmlnJywgY29uZmlnU2NoZW1hLCBzcGVjKTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIGluaXRpYWxDb25maWc6IHNwZWMsXG4gICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIHNjaGVtYTogY29uc3RhbnQoc2NoZW1hU2NoZW1hKSxcbiAgICAgICAgZXhoaWJpdDogZnVuY3Rpb24gKGluZm8sIGJhc2UpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0Q29uZmlnKGluZm8pLmJpbmQoZnVuY3Rpb24gKGJlaGF2aW91ckluZm8pIHtcbiAgICAgICAgICAgIHJldHVybiBnZXQkMShhY3RpdmUsICdleGhpYml0JykubWFwKGZ1bmN0aW9uIChleGhpYml0b3IpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGV4aGliaXRvcihiYXNlLCBiZWhhdmlvdXJJbmZvLmNvbmZpZywgYmVoYXZpb3VySW5mby5zdGF0ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KS5nZXRPcihudSQ2KHt9KSk7XG4gICAgICAgIH0sXG4gICAgICAgIG5hbWU6IGNvbnN0YW50KG5hbWUpLFxuICAgICAgICBoYW5kbGVyczogZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgICByZXR1cm4gZ2V0Q29uZmlnKGluZm8pLm1hcChmdW5jdGlvbiAoYmVoYXZpb3VySW5mbykge1xuICAgICAgICAgICAgdmFyIGdldEV2ZW50cyA9IGdldCQxKGFjdGl2ZSwgJ2V2ZW50cycpLmdldE9yKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZ2V0RXZlbnRzKGJlaGF2aW91ckluZm8uY29uZmlnLCBiZWhhdmlvdXJJbmZvLnN0YXRlKTtcbiAgICAgICAgICB9KS5nZXRPcih7fSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH07XG5cbiAgICB2YXIgZGVyaXZlJDEgPSBmdW5jdGlvbiAoY2FwYWJpbGl0aWVzKSB7XG4gICAgICByZXR1cm4gd3JhcEFsbCQxKGNhcGFiaWxpdGllcyk7XG4gICAgfTtcbiAgICB2YXIgc2ltcGxlU2NoZW1hID0gb2JqT2ZPbmx5KFtcbiAgICAgIHN0cmljdCQxKCdmaWVsZHMnKSxcbiAgICAgIHN0cmljdCQxKCduYW1lJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnYWN0aXZlJywge30pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2FwaXMnLCB7fSksXG4gICAgICBkZWZhdWx0ZWQkMSgnc3RhdGUnLCBOb1N0YXRlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdleHRyYScsIHt9KVxuICAgIF0pO1xuICAgIHZhciBjcmVhdGUkMSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhc1Jhd09yRGllKCdDcmVhdGluZyBiZWhhdmlvdXI6ICcgKyBkYXRhLm5hbWUsIHNpbXBsZVNjaGVtYSwgZGF0YSk7XG4gICAgICByZXR1cm4gY3JlYXRlKHZhbHVlLmZpZWxkcywgdmFsdWUubmFtZSwgdmFsdWUuYWN0aXZlLCB2YWx1ZS5hcGlzLCB2YWx1ZS5leHRyYSwgdmFsdWUuc3RhdGUpO1xuICAgIH07XG4gICAgdmFyIG1vZGVTY2hlbWEgPSBvYmpPZk9ubHkoW1xuICAgICAgc3RyaWN0JDEoJ2JyYW5jaEtleScpLFxuICAgICAgc3RyaWN0JDEoJ2JyYW5jaGVzJyksXG4gICAgICBzdHJpY3QkMSgnbmFtZScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2FjdGl2ZScsIHt9KSxcbiAgICAgIGRlZmF1bHRlZCQxKCdhcGlzJywge30pLFxuICAgICAgZGVmYXVsdGVkJDEoJ3N0YXRlJywgTm9TdGF0ZSksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXh0cmEnLCB7fSlcbiAgICBdKTtcbiAgICB2YXIgY3JlYXRlTW9kZXMkMSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhc1Jhd09yRGllKCdDcmVhdGluZyBiZWhhdmlvdXI6ICcgKyBkYXRhLm5hbWUsIG1vZGVTY2hlbWEsIGRhdGEpO1xuICAgICAgcmV0dXJuIGNyZWF0ZU1vZGVzKGNob29zZSQxKHZhbHVlLmJyYW5jaEtleSwgdmFsdWUuYnJhbmNoZXMpLCB2YWx1ZS5uYW1lLCB2YWx1ZS5hY3RpdmUsIHZhbHVlLmFwaXMsIHZhbHVlLmV4dHJhLCB2YWx1ZS5zdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgcmV2b2tlID0gY29uc3RhbnQodW5kZWZpbmVkKTtcblxuICAgIHZhciBSZWNlaXZpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IFJlY2VpdmluZ1NjaGVtYSxcbiAgICAgIG5hbWU6ICdyZWNlaXZpbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVSZWNlaXZpbmdcbiAgICB9KTtcblxuICAgIHZhciBleGhpYml0ID0gZnVuY3Rpb24gKGJhc2UsIHBvc0NvbmZpZykge1xuICAgICAgcmV0dXJuIG51JDYoe1xuICAgICAgICBjbGFzc2VzOiBbXSxcbiAgICAgICAgc3R5bGVzOiBwb3NDb25maWcudXNlRml4ZWQoKSA/IHt9IDogeyBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZVBvc2l0aW9uID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGV4aGliaXQ6IGV4aGliaXRcbiAgICB9KTtcblxuICAgIHZhciBnZXREb2N1bWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudCk7XG4gICAgfTtcblxuICAgIHZhciBmb2N1cyQxID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50LmRvbS5mb2N1cygpO1xuICAgIH07XG4gICAgdmFyIGJsdXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLmJsdXIoKTtcbiAgICB9O1xuICAgIHZhciBoYXNGb2N1cyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICB2YXIgcm9vdCA9IGdldFJvb3ROb2RlKGVsZW1lbnQpLmRvbTtcbiAgICAgIHJldHVybiBlbGVtZW50LmRvbSA9PT0gcm9vdC5hY3RpdmVFbGVtZW50O1xuICAgIH07XG4gICAgdmFyIGFjdGl2ZSA9IGZ1bmN0aW9uIChyb290KSB7XG4gICAgICBpZiAocm9vdCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJvb3QgPSBnZXREb2N1bWVudCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20ocm9vdC5kb20uYWN0aXZlRWxlbWVudCkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBzZWFyY2ggPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFjdGl2ZShnZXRSb290Tm9kZShlbGVtZW50KSkuZmlsdGVyKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LmRvbS5jb250YWlucyhlLmRvbSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHByZXNlcnZlID0gZnVuY3Rpb24gKGYsIGNvbnRhaW5lcikge1xuICAgICAgdmFyIGRvcyA9IGdldFJvb3ROb2RlKGNvbnRhaW5lcik7XG4gICAgICB2YXIgcmVmb2N1cyA9IGFjdGl2ZShkb3MpLmJpbmQoZnVuY3Rpb24gKGZvY3VzZWQpIHtcbiAgICAgICAgdmFyIGhhc0ZvY3VzID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICByZXR1cm4gZXEkMShmb2N1c2VkLCBlbGVtKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGhhc0ZvY3VzKGNvbnRhaW5lcikgPyBPcHRpb25hbC5zb21lKGNvbnRhaW5lcikgOiBkZXNjZW5kYW50KGNvbnRhaW5lciwgaGFzRm9jdXMpO1xuICAgICAgfSk7XG4gICAgICB2YXIgcmVzdWx0ID0gZihjb250YWluZXIpO1xuICAgICAgcmVmb2N1cy5lYWNoKGZ1bmN0aW9uIChvbGRGb2N1cykge1xuICAgICAgICBhY3RpdmUoZG9zKS5maWx0ZXIoZnVuY3Rpb24gKG5ld0ZvY3VzKSB7XG4gICAgICAgICAgcmV0dXJuIGVxJDEobmV3Rm9jdXMsIG9sZEZvY3VzKTtcbiAgICAgICAgfSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZm9jdXMkMShvbGRGb2N1cyk7XG4gICAgICAgIH0sIG5vb3ApO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICB2YXIgTnVQb3NpdGlvbkNzcyA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgbGVmdCwgdG9wLCByaWdodCwgYm90dG9tKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXG4gICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgIHRvcDogdG9wLFxuICAgICAgICByaWdodDogcmlnaHQsXG4gICAgICAgIGJvdHRvbTogYm90dG9tXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGFwcGx5UG9zaXRpb25Dc3MgPSBmdW5jdGlvbiAoZWxlbWVudCwgcG9zaXRpb24pIHtcbiAgICAgIHZhciBhZGRQeCA9IGZ1bmN0aW9uIChudW0pIHtcbiAgICAgICAgcmV0dXJuIG51bSArICdweCc7XG4gICAgICB9O1xuICAgICAgc2V0T3B0aW9ucyhlbGVtZW50LCB7XG4gICAgICAgIHBvc2l0aW9uOiBPcHRpb25hbC5zb21lKHBvc2l0aW9uLnBvc2l0aW9uKSxcbiAgICAgICAgbGVmdDogcG9zaXRpb24ubGVmdC5tYXAoYWRkUHgpLFxuICAgICAgICB0b3A6IHBvc2l0aW9uLnRvcC5tYXAoYWRkUHgpLFxuICAgICAgICByaWdodDogcG9zaXRpb24ucmlnaHQubWFwKGFkZFB4KSxcbiAgICAgICAgYm90dG9tOiBwb3NpdGlvbi5ib3R0b20ubWFwKGFkZFB4KVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBhZHQkMyA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7IG5vbmU6IFtdIH0sXG4gICAgICB7XG4gICAgICAgIHJlbGF0aXZlOiBbXG4gICAgICAgICAgJ3gnLFxuICAgICAgICAgICd5JyxcbiAgICAgICAgICAnd2lkdGgnLFxuICAgICAgICAgICdoZWlnaHQnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZpeGVkOiBbXG4gICAgICAgICAgJ3gnLFxuICAgICAgICAgICd5JyxcbiAgICAgICAgICAnd2lkdGgnLFxuICAgICAgICAgICdoZWlnaHQnXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdKTtcbiAgICB2YXIgcG9zaXRpb25XaXRoRGlyZWN0aW9uID0gZnVuY3Rpb24gKHBvc05hbWUsIGRlY2lzaW9uLCB4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICB2YXIgZGVjaXNpb25YID0gZGVjaXNpb24ueCAtIHg7XG4gICAgICB2YXIgZGVjaXNpb25ZID0gZGVjaXNpb24ueSAtIHk7XG4gICAgICB2YXIgZGVjaXNpb25XaWR0aCA9IGRlY2lzaW9uLndpZHRoO1xuICAgICAgdmFyIGRlY2lzaW9uSGVpZ2h0ID0gZGVjaXNpb24uaGVpZ2h0O1xuICAgICAgdmFyIGRlY2lzaW9uUmlnaHQgPSB3aWR0aCAtIChkZWNpc2lvblggKyBkZWNpc2lvbldpZHRoKTtcbiAgICAgIHZhciBkZWNpc2lvbkJvdHRvbSA9IGhlaWdodCAtIChkZWNpc2lvblkgKyBkZWNpc2lvbkhlaWdodCk7XG4gICAgICB2YXIgbGVmdCA9IE9wdGlvbmFsLnNvbWUoZGVjaXNpb25YKTtcbiAgICAgIHZhciB0b3AgPSBPcHRpb25hbC5zb21lKGRlY2lzaW9uWSk7XG4gICAgICB2YXIgcmlnaHQgPSBPcHRpb25hbC5zb21lKGRlY2lzaW9uUmlnaHQpO1xuICAgICAgdmFyIGJvdHRvbSA9IE9wdGlvbmFsLnNvbWUoZGVjaXNpb25Cb3R0b20pO1xuICAgICAgdmFyIG5vbmUgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICByZXR1cm4gY2F0YShkZWNpc2lvbi5kaXJlY3Rpb24sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE51UG9zaXRpb25Dc3MocG9zTmFtZSwgbGVmdCwgdG9wLCBub25lLCBub25lKTtcbiAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE51UG9zaXRpb25Dc3MocG9zTmFtZSwgbm9uZSwgdG9wLCByaWdodCwgbm9uZSk7XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBOdVBvc2l0aW9uQ3NzKHBvc05hbWUsIGxlZnQsIG5vbmUsIG5vbmUsIGJvdHRvbSk7XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBOdVBvc2l0aW9uQ3NzKHBvc05hbWUsIG5vbmUsIG5vbmUsIHJpZ2h0LCBib3R0b20pO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTnVQb3NpdGlvbkNzcyhwb3NOYW1lLCBsZWZ0LCB0b3AsIG5vbmUsIG5vbmUpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTnVQb3NpdGlvbkNzcyhwb3NOYW1lLCBsZWZ0LCBub25lLCBub25lLCBib3R0b20pO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTnVQb3NpdGlvbkNzcyhwb3NOYW1lLCBsZWZ0LCB0b3AsIG5vbmUsIG5vbmUpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTnVQb3NpdGlvbkNzcyhwb3NOYW1lLCBub25lLCB0b3AsIHJpZ2h0LCBub25lKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlcG9zaXRpb24gPSBmdW5jdGlvbiAob3JpZ2luLCBkZWNpc2lvbikge1xuICAgICAgcmV0dXJuIG9yaWdpbi5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE51UG9zaXRpb25Dc3MoJ2Fic29sdXRlJywgT3B0aW9uYWwuc29tZShkZWNpc2lvbi54KSwgT3B0aW9uYWwuc29tZShkZWNpc2lvbi55KSwgT3B0aW9uYWwubm9uZSgpLCBPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfSwgZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uV2l0aERpcmVjdGlvbignYWJzb2x1dGUnLCBkZWNpc2lvbiwgeCwgeSwgd2lkdGgsIGhlaWdodCk7XG4gICAgICB9LCBmdW5jdGlvbiAoeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICByZXR1cm4gcG9zaXRpb25XaXRoRGlyZWN0aW9uKCdmaXhlZCcsIGRlY2lzaW9uLCB4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRvQm94ID0gZnVuY3Rpb24gKG9yaWdpbiwgZWxlbWVudCkge1xuICAgICAgdmFyIHJlbCA9IGN1cnJ5KGZpbmQkMywgZWxlbWVudCk7XG4gICAgICB2YXIgcG9zaXRpb24gPSBvcmlnaW4uZm9sZChyZWwsIHJlbCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc2Nyb2xsID0gZ2V0JDkoKTtcbiAgICAgICAgcmV0dXJuIGZpbmQkMyhlbGVtZW50KS50cmFuc2xhdGUoLXNjcm9sbC5sZWZ0LCAtc2Nyb2xsLnRvcCk7XG4gICAgICB9KTtcbiAgICAgIHZhciB3aWR0aCA9IGdldE91dGVyJDIoZWxlbWVudCk7XG4gICAgICB2YXIgaGVpZ2h0ID0gZ2V0T3V0ZXIkMShlbGVtZW50KTtcbiAgICAgIHJldHVybiBib3VuZHMkMShwb3NpdGlvbi5sZWZ0LCBwb3NpdGlvbi50b3AsIHdpZHRoLCBoZWlnaHQpO1xuICAgIH07XG4gICAgdmFyIHZpZXdwb3J0JDEgPSBmdW5jdGlvbiAob3JpZ2luLCBnZXRCb3VuZHMpIHtcbiAgICAgIHJldHVybiBnZXRCb3VuZHMuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBvcmlnaW4uZm9sZCh3aW4sIHdpbiwgYm91bmRzJDEpO1xuICAgICAgfSwgZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgcmV0dXJuIG9yaWdpbi5mb2xkKGIsIGIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgYm91bmRzID0gYigpO1xuICAgICAgICAgIHZhciBwb3MgPSB0cmFuc2xhdGUob3JpZ2luLCBib3VuZHMueCwgYm91bmRzLnkpO1xuICAgICAgICAgIHJldHVybiBib3VuZHMkMShwb3MubGVmdCwgcG9zLnRvcCwgYm91bmRzLndpZHRoLCBib3VuZHMuaGVpZ2h0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB0cmFuc2xhdGUgPSBmdW5jdGlvbiAob3JpZ2luLCB4LCB5KSB7XG4gICAgICB2YXIgcG9zID0gU3VnYXJQb3NpdGlvbih4LCB5KTtcbiAgICAgIHZhciByZW1vdmVTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvdXRlclNjcm9sbCA9IGdldCQ5KCk7XG4gICAgICAgIHJldHVybiBwb3MudHJhbnNsYXRlKC1vdXRlclNjcm9sbC5sZWZ0LCAtb3V0ZXJTY3JvbGwudG9wKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gb3JpZ2luLmZvbGQoY29uc3RhbnQocG9zKSwgY29uc3RhbnQocG9zKSwgcmVtb3ZlU2Nyb2xsKTtcbiAgICB9O1xuICAgIHZhciBjYXRhJDEgPSBmdW5jdGlvbiAoc3ViamVjdCwgb25Ob25lLCBvblJlbGF0aXZlLCBvbkZpeGVkKSB7XG4gICAgICByZXR1cm4gc3ViamVjdC5mb2xkKG9uTm9uZSwgb25SZWxhdGl2ZSwgb25GaXhlZCk7XG4gICAgfTtcbiAgICB2YXIgbm9uZSQxID0gYWR0JDMubm9uZTtcbiAgICB2YXIgcmVsYXRpdmUgPSBhZHQkMy5yZWxhdGl2ZTtcbiAgICB2YXIgZml4ZWQgPSBhZHQkMy5maXhlZDtcblxuICAgIHZhciBhbmNob3IgPSBmdW5jdGlvbiAoYW5jaG9yQm94LCBvcmlnaW4pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFuY2hvckJveDogYW5jaG9yQm94LFxuICAgICAgICBvcmlnaW46IG9yaWdpblxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBib3gkMSA9IGZ1bmN0aW9uIChhbmNob3JCb3gsIG9yaWdpbikge1xuICAgICAgcmV0dXJuIGFuY2hvcihhbmNob3JCb3gsIG9yaWdpbik7XG4gICAgfTtcblxuICAgIHZhciBjeWNsZUJ5ID0gZnVuY3Rpb24gKHZhbHVlLCBkZWx0YSwgbWluLCBtYXgpIHtcbiAgICAgIHZhciByID0gdmFsdWUgKyBkZWx0YTtcbiAgICAgIGlmIChyID4gbWF4KSB7XG4gICAgICAgIHJldHVybiBtaW47XG4gICAgICB9IGVsc2UgaWYgKHIgPCBtaW4pIHtcbiAgICAgICAgcmV0dXJuIG1heDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNsYW1wID0gZnVuY3Rpb24gKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHZhbHVlLCBtaW4pLCBtYXgpO1xuICAgIH07XG5cbiAgICB2YXIgYWR0JDQgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAgeyBmaXQ6IFsncmVwb3NpdGlvbiddIH0sXG4gICAgICB7XG4gICAgICAgIG5vZml0OiBbXG4gICAgICAgICAgJ3JlcG9zaXRpb24nLFxuICAgICAgICAgICdkZWx0YVcnLFxuICAgICAgICAgICdkZWx0YUgnXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdKTtcbiAgICB2YXIgY2FsY1JlcG9zaXRpb24gPSBmdW5jdGlvbiAobmV3WCwgbmV3WSwgd2lkdGgsIGhlaWdodCwgYm91bmRzKSB7XG4gICAgICB2YXIgYm91bmRzWCA9IGJvdW5kcy54O1xuICAgICAgdmFyIGJvdW5kc1kgPSBib3VuZHMueTtcbiAgICAgIHZhciBib3VuZHNXaWR0aCA9IGJvdW5kcy53aWR0aDtcbiAgICAgIHZhciBib3VuZHNIZWlnaHQgPSBib3VuZHMuaGVpZ2h0O1xuICAgICAgdmFyIHhJbkJvdW5kcyA9IG5ld1ggPj0gYm91bmRzWDtcbiAgICAgIHZhciB5SW5Cb3VuZHMgPSBuZXdZID49IGJvdW5kc1k7XG4gICAgICB2YXIgb3JpZ2luSW5Cb3VuZHMgPSB4SW5Cb3VuZHMgJiYgeUluQm91bmRzO1xuICAgICAgdmFyIHhGaXQgPSBuZXdYICsgd2lkdGggPD0gYm91bmRzWCArIGJvdW5kc1dpZHRoO1xuICAgICAgdmFyIHlGaXQgPSBuZXdZICsgaGVpZ2h0IDw9IGJvdW5kc1kgKyBib3VuZHNIZWlnaHQ7XG4gICAgICB2YXIgc2l6ZUluQm91bmRzID0geEZpdCAmJiB5Rml0O1xuICAgICAgdmFyIGRlbHRhVyA9IE1hdGguYWJzKE1hdGgubWluKHdpZHRoLCB4SW5Cb3VuZHMgPyBib3VuZHNYICsgYm91bmRzV2lkdGggLSBuZXdYIDogYm91bmRzWCAtIChuZXdYICsgd2lkdGgpKSk7XG4gICAgICB2YXIgZGVsdGFIID0gTWF0aC5hYnMoTWF0aC5taW4oaGVpZ2h0LCB5SW5Cb3VuZHMgPyBib3VuZHNZICsgYm91bmRzSGVpZ2h0IC0gbmV3WSA6IGJvdW5kc1kgLSAobmV3WSArIGhlaWdodCkpKTtcbiAgICAgIHZhciBtYXhYID0gTWF0aC5tYXgoYm91bmRzLngsIGJvdW5kcy5yaWdodCAtIHdpZHRoKTtcbiAgICAgIHZhciBtYXhZID0gTWF0aC5tYXgoYm91bmRzLnksIGJvdW5kcy5ib3R0b20gLSBoZWlnaHQpO1xuICAgICAgdmFyIGxpbWl0WCA9IGNsYW1wKG5ld1gsIGJvdW5kcy54LCBtYXhYKTtcbiAgICAgIHZhciBsaW1pdFkgPSBjbGFtcChuZXdZLCBib3VuZHMueSwgbWF4WSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvcmlnaW5JbkJvdW5kczogb3JpZ2luSW5Cb3VuZHMsXG4gICAgICAgIHNpemVJbkJvdW5kczogc2l6ZUluQm91bmRzLFxuICAgICAgICBsaW1pdFg6IGxpbWl0WCxcbiAgICAgICAgbGltaXRZOiBsaW1pdFksXG4gICAgICAgIGRlbHRhVzogZGVsdGFXLFxuICAgICAgICBkZWx0YUg6IGRlbHRhSFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBhdHRlbXB0ID0gZnVuY3Rpb24gKGNhbmRpZGF0ZSwgd2lkdGgsIGhlaWdodCwgYm91bmRzKSB7XG4gICAgICB2YXIgY2FuZGlkYXRlWCA9IGNhbmRpZGF0ZS54O1xuICAgICAgdmFyIGNhbmRpZGF0ZVkgPSBjYW5kaWRhdGUueTtcbiAgICAgIHZhciBidWJibGVPZmZzZXRzID0gY2FuZGlkYXRlLmJ1YmJsZS5vZmZzZXQ7XG4gICAgICB2YXIgYnViYmxlTGVmdCA9IGJ1YmJsZU9mZnNldHMubGVmdDtcbiAgICAgIHZhciBidWJibGVUb3AgPSBidWJibGVPZmZzZXRzLnRvcDtcbiAgICAgIHZhciBhZGp1c3RlZEJvdW5kcyA9IGFkanVzdEJvdW5kcyhib3VuZHMsIGNhbmRpZGF0ZS5ib3VuZHNSZXN0cmljdGlvbiwgYnViYmxlT2Zmc2V0cyk7XG4gICAgICB2YXIgYm91bmRzWSA9IGFkanVzdGVkQm91bmRzLnk7XG4gICAgICB2YXIgYm91bmRzQm90dG9tID0gYWRqdXN0ZWRCb3VuZHMuYm90dG9tO1xuICAgICAgdmFyIGJvdW5kc1ggPSBhZGp1c3RlZEJvdW5kcy54O1xuICAgICAgdmFyIGJvdW5kc1JpZ2h0ID0gYWRqdXN0ZWRCb3VuZHMucmlnaHQ7XG4gICAgICB2YXIgbmV3WCA9IGNhbmRpZGF0ZVggKyBidWJibGVMZWZ0O1xuICAgICAgdmFyIG5ld1kgPSBjYW5kaWRhdGVZICsgYnViYmxlVG9wO1xuICAgICAgdmFyIF9hID0gY2FsY1JlcG9zaXRpb24obmV3WCwgbmV3WSwgd2lkdGgsIGhlaWdodCwgYWRqdXN0ZWRCb3VuZHMpLCBvcmlnaW5JbkJvdW5kcyA9IF9hLm9yaWdpbkluQm91bmRzLCBzaXplSW5Cb3VuZHMgPSBfYS5zaXplSW5Cb3VuZHMsIGxpbWl0WCA9IF9hLmxpbWl0WCwgbGltaXRZID0gX2EubGltaXRZLCBkZWx0YVcgPSBfYS5kZWx0YVcsIGRlbHRhSCA9IF9hLmRlbHRhSDtcbiAgICAgIHZhciB1cEF2YWlsYWJsZSA9IGNvbnN0YW50KGxpbWl0WSArIGRlbHRhSCAtIGJvdW5kc1kpO1xuICAgICAgdmFyIGRvd25BdmFpbGFibGUgPSBjb25zdGFudChib3VuZHNCb3R0b20gLSBsaW1pdFkpO1xuICAgICAgdmFyIG1heEhlaWdodCA9IGNhdGFWZXJ0aWNhbChjYW5kaWRhdGUuZGlyZWN0aW9uLCBkb3duQXZhaWxhYmxlLCBkb3duQXZhaWxhYmxlLCB1cEF2YWlsYWJsZSk7XG4gICAgICB2YXIgd2VzdEF2YWlsYWJsZSA9IGNvbnN0YW50KGxpbWl0WCArIGRlbHRhVyAtIGJvdW5kc1gpO1xuICAgICAgdmFyIGVhc3RBdmFpbGFibGUgPSBjb25zdGFudChib3VuZHNSaWdodCAtIGxpbWl0WCk7XG4gICAgICB2YXIgbWF4V2lkdGggPSBjYXRhSG9yaXpvbnRhbChjYW5kaWRhdGUuZGlyZWN0aW9uLCBlYXN0QXZhaWxhYmxlLCBlYXN0QXZhaWxhYmxlLCB3ZXN0QXZhaWxhYmxlKTtcbiAgICAgIHZhciByZXBvc2l0aW9uID0ge1xuICAgICAgICB4OiBsaW1pdFgsXG4gICAgICAgIHk6IGxpbWl0WSxcbiAgICAgICAgd2lkdGg6IGRlbHRhVyxcbiAgICAgICAgaGVpZ2h0OiBkZWx0YUgsXG4gICAgICAgIG1heEhlaWdodDogbWF4SGVpZ2h0LFxuICAgICAgICBtYXhXaWR0aDogbWF4V2lkdGgsXG4gICAgICAgIGRpcmVjdGlvbjogY2FuZGlkYXRlLmRpcmVjdGlvbixcbiAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgIG9uOiBjYW5kaWRhdGUuYnViYmxlLmNsYXNzZXNPbixcbiAgICAgICAgICBvZmY6IGNhbmRpZGF0ZS5idWJibGUuY2xhc3Nlc09mZlxuICAgICAgICB9LFxuICAgICAgICBsYWJlbDogY2FuZGlkYXRlLmxhYmVsLFxuICAgICAgICBjYW5kaWRhdGVZZm9yVGVzdDogbmV3WVxuICAgICAgfTtcbiAgICAgIHJldHVybiBvcmlnaW5JbkJvdW5kcyAmJiBzaXplSW5Cb3VuZHMgPyBhZHQkNC5maXQocmVwb3NpdGlvbikgOiBhZHQkNC5ub2ZpdChyZXBvc2l0aW9uLCBkZWx0YVcsIGRlbHRhSCk7XG4gICAgfTtcbiAgICB2YXIgYXR0ZW1wdHMgPSBmdW5jdGlvbiAoY2FuZGlkYXRlcywgYW5jaG9yQm94LCBlbGVtZW50Qm94LCBidWJibGVzLCBib3VuZHMpIHtcbiAgICAgIHZhciBwYW5lbFdpZHRoID0gZWxlbWVudEJveC53aWR0aDtcbiAgICAgIHZhciBwYW5lbEhlaWdodCA9IGVsZW1lbnRCb3guaGVpZ2h0O1xuICAgICAgdmFyIGF0dGVtcHRCZXN0Rml0ID0gZnVuY3Rpb24gKGxheW91dCwgcmVwb3NpdGlvbiwgZGVsdGFXLCBkZWx0YUgpIHtcbiAgICAgICAgdmFyIG5leHQgPSBsYXlvdXQoYW5jaG9yQm94LCBlbGVtZW50Qm94LCBidWJibGVzKTtcbiAgICAgICAgdmFyIGF0dGVtcHRMYXlvdXQgPSBhdHRlbXB0KG5leHQsIHBhbmVsV2lkdGgsIHBhbmVsSGVpZ2h0LCBib3VuZHMpO1xuICAgICAgICByZXR1cm4gYXR0ZW1wdExheW91dC5mb2xkKGFkdCQ0LmZpdCwgZnVuY3Rpb24gKG5ld1JlcG9zaXRpb24sIG5ld0RlbHRhVywgbmV3RGVsdGFIKSB7XG4gICAgICAgICAgdmFyIGltcHJvdmVkID0gbmV3RGVsdGFIID4gZGVsdGFIIHx8IG5ld0RlbHRhVyA+IGRlbHRhVztcbiAgICAgICAgICByZXR1cm4gaW1wcm92ZWQgPyBhZHQkNC5ub2ZpdChuZXdSZXBvc2l0aW9uLCBuZXdEZWx0YVcsIG5ld0RlbHRhSCkgOiBhZHQkNC5ub2ZpdChyZXBvc2l0aW9uLCBkZWx0YVcsIGRlbHRhSCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBhYmMgPSBmb2xkbChjYW5kaWRhdGVzLCBmdW5jdGlvbiAoYiwgYSkge1xuICAgICAgICB2YXIgYmVzdE5leHQgPSBjdXJyeShhdHRlbXB0QmVzdEZpdCwgYSk7XG4gICAgICAgIHJldHVybiBiLmZvbGQoYWR0JDQuZml0LCBiZXN0TmV4dCk7XG4gICAgICB9LCBhZHQkNC5ub2ZpdCh7XG4gICAgICAgIHg6IGFuY2hvckJveC54LFxuICAgICAgICB5OiBhbmNob3JCb3gueSxcbiAgICAgICAgd2lkdGg6IGVsZW1lbnRCb3gud2lkdGgsXG4gICAgICAgIGhlaWdodDogZWxlbWVudEJveC5oZWlnaHQsXG4gICAgICAgIG1heEhlaWdodDogZWxlbWVudEJveC5oZWlnaHQsXG4gICAgICAgIG1heFdpZHRoOiBlbGVtZW50Qm94LndpZHRoLFxuICAgICAgICBkaXJlY3Rpb246IHNvdXRoZWFzdCgpLFxuICAgICAgICBjbGFzc2VzOiB7XG4gICAgICAgICAgb246IFtdLFxuICAgICAgICAgIG9mZjogW11cbiAgICAgICAgfSxcbiAgICAgICAgbGFiZWw6ICdub25lJyxcbiAgICAgICAgY2FuZGlkYXRlWWZvclRlc3Q6IGFuY2hvckJveC55XG4gICAgICB9LCAtMSwgLTEpKTtcbiAgICAgIHJldHVybiBhYmMuZm9sZChpZGVudGl0eSwgaWRlbnRpdHkpO1xuICAgIH07XG5cbiAgICB2YXIgZWxlbWVudFNpemUgPSBmdW5jdGlvbiAocCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IGdldE91dGVyJDIocCksXG4gICAgICAgIGhlaWdodDogZ2V0T3V0ZXIkMShwKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBsYXlvdXQgPSBmdW5jdGlvbiAoYW5jaG9yQm94LCBlbGVtZW50LCBidWJibGVzLCBvcHRpb25zKSB7XG4gICAgICByZW1vdmUkNihlbGVtZW50LCAnbWF4LWhlaWdodCcpO1xuICAgICAgcmVtb3ZlJDYoZWxlbWVudCwgJ21heC13aWR0aCcpO1xuICAgICAgdmFyIGVsZW1lbnRCb3ggPSBlbGVtZW50U2l6ZShlbGVtZW50KTtcbiAgICAgIHJldHVybiBhdHRlbXB0cyhvcHRpb25zLnByZWZlcmVuY2UsIGFuY2hvckJveCwgZWxlbWVudEJveCwgYnViYmxlcywgb3B0aW9ucy5ib3VuZHMpO1xuICAgIH07XG4gICAgdmFyIHNldENsYXNzZXMgPSBmdW5jdGlvbiAoZWxlbWVudCwgZGVjaXNpb24pIHtcbiAgICAgIHZhciBjbGFzc0luZm8gPSBkZWNpc2lvbi5jbGFzc2VzO1xuICAgICAgcmVtb3ZlJDUoZWxlbWVudCwgY2xhc3NJbmZvLm9mZik7XG4gICAgICBhZGQkMyhlbGVtZW50LCBjbGFzc0luZm8ub24pO1xuICAgIH07XG4gICAgdmFyIHNldEhlaWdodCA9IGZ1bmN0aW9uIChlbGVtZW50LCBkZWNpc2lvbiwgb3B0aW9ucykge1xuICAgICAgdmFyIG1heEhlaWdodEZ1bmN0aW9uID0gb3B0aW9ucy5tYXhIZWlnaHRGdW5jdGlvbjtcbiAgICAgIG1heEhlaWdodEZ1bmN0aW9uKGVsZW1lbnQsIGRlY2lzaW9uLm1heEhlaWdodCk7XG4gICAgfTtcbiAgICB2YXIgc2V0V2lkdGggPSBmdW5jdGlvbiAoZWxlbWVudCwgZGVjaXNpb24sIG9wdGlvbnMpIHtcbiAgICAgIHZhciBtYXhXaWR0aEZ1bmN0aW9uID0gb3B0aW9ucy5tYXhXaWR0aEZ1bmN0aW9uO1xuICAgICAgbWF4V2lkdGhGdW5jdGlvbihlbGVtZW50LCBkZWNpc2lvbi5tYXhXaWR0aCk7XG4gICAgfTtcbiAgICB2YXIgcG9zaXRpb24gPSBmdW5jdGlvbiAoZWxlbWVudCwgZGVjaXNpb24sIG9wdGlvbnMpIHtcbiAgICAgIGFwcGx5UG9zaXRpb25Dc3MoZWxlbWVudCwgcmVwb3NpdGlvbihvcHRpb25zLm9yaWdpbiwgZGVjaXNpb24pKTtcbiAgICB9O1xuXG4gICAgdmFyIHNldE1heEhlaWdodCA9IGZ1bmN0aW9uIChlbGVtZW50LCBtYXhIZWlnaHQpIHtcbiAgICAgIHNldE1heChlbGVtZW50LCBNYXRoLmZsb29yKG1heEhlaWdodCkpO1xuICAgIH07XG4gICAgdmFyIGFuY2hvcmVkID0gY29uc3RhbnQoZnVuY3Rpb24gKGVsZW1lbnQsIGF2YWlsYWJsZSkge1xuICAgICAgc2V0TWF4SGVpZ2h0KGVsZW1lbnQsIGF2YWlsYWJsZSk7XG4gICAgICBzZXRBbGwkMShlbGVtZW50LCB7XG4gICAgICAgICdvdmVyZmxvdy14JzogJ2hpZGRlbicsXG4gICAgICAgICdvdmVyZmxvdy15JzogJ2F1dG8nXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICB2YXIgZXhwYW5kYWJsZSA9IGNvbnN0YW50KGZ1bmN0aW9uIChlbGVtZW50LCBhdmFpbGFibGUpIHtcbiAgICAgIHNldE1heEhlaWdodChlbGVtZW50LCBhdmFpbGFibGUpO1xuICAgIH0pO1xuXG4gICAgdmFyIGRlZmF1bHRPciA9IGZ1bmN0aW9uIChvcHRpb25zLCBrZXksIGRlcGhhdWx0KSB7XG4gICAgICByZXR1cm4gb3B0aW9uc1trZXldID09PSB1bmRlZmluZWQgPyBkZXBoYXVsdCA6IG9wdGlvbnNba2V5XTtcbiAgICB9O1xuICAgIHZhciBzaW1wbGUgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGUsIGxheW91dHMsIGdldEJvdW5kcywgb3ZlcnJpZGVPcHRpb25zKSB7XG4gICAgICB2YXIgbWF4SGVpZ2h0RnVuY3Rpb24gPSBkZWZhdWx0T3Iob3ZlcnJpZGVPcHRpb25zLCAnbWF4SGVpZ2h0RnVuY3Rpb24nLCBhbmNob3JlZCgpKTtcbiAgICAgIHZhciBtYXhXaWR0aEZ1bmN0aW9uID0gZGVmYXVsdE9yKG92ZXJyaWRlT3B0aW9ucywgJ21heFdpZHRoRnVuY3Rpb24nLCBub29wKTtcbiAgICAgIHZhciBhbmNob3JCb3ggPSBhbmNob3IuYW5jaG9yQm94O1xuICAgICAgdmFyIG9yaWdpbiA9IGFuY2hvci5vcmlnaW47XG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgYm91bmRzOiB2aWV3cG9ydCQxKG9yaWdpbiwgZ2V0Qm91bmRzKSxcbiAgICAgICAgb3JpZ2luOiBvcmlnaW4sXG4gICAgICAgIHByZWZlcmVuY2U6IGxheW91dHMsXG4gICAgICAgIG1heEhlaWdodEZ1bmN0aW9uOiBtYXhIZWlnaHRGdW5jdGlvbixcbiAgICAgICAgbWF4V2lkdGhGdW5jdGlvbjogbWF4V2lkdGhGdW5jdGlvblxuICAgICAgfTtcbiAgICAgIGdvKGFuY2hvckJveCwgZWxlbWVudCwgYnViYmxlLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIHZhciBnbyA9IGZ1bmN0aW9uIChhbmNob3JCb3gsIGVsZW1lbnQsIGJ1YmJsZSwgb3B0aW9ucykge1xuICAgICAgdmFyIGRlY2lzaW9uID0gbGF5b3V0KGFuY2hvckJveCwgZWxlbWVudCwgYnViYmxlLCBvcHRpb25zKTtcbiAgICAgIHBvc2l0aW9uKGVsZW1lbnQsIGRlY2lzaW9uLCBvcHRpb25zKTtcbiAgICAgIHNldENsYXNzZXMoZWxlbWVudCwgZGVjaXNpb24pO1xuICAgICAgc2V0SGVpZ2h0KGVsZW1lbnQsIGRlY2lzaW9uLCBvcHRpb25zKTtcbiAgICAgIHNldFdpZHRoKGVsZW1lbnQsIGRlY2lzaW9uLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgdmFyIGFsbEFsaWdubWVudHMgPSBbXG4gICAgICAndmFsaWduQ2VudHJlJyxcbiAgICAgICdhbGlnbkxlZnQnLFxuICAgICAgJ2FsaWduUmlnaHQnLFxuICAgICAgJ2FsaWduQ2VudHJlJyxcbiAgICAgICd0b3AnLFxuICAgICAgJ2JvdHRvbScsXG4gICAgICAnbGVmdCcsXG4gICAgICAncmlnaHQnXG4gICAgXTtcbiAgICB2YXIgbnUkOCA9IGZ1bmN0aW9uICh3aWR0aCwgeW9mZnNldCwgY2xhc3Nlcykge1xuICAgICAgdmFyIGdldENsYXNzZXMgPSBmdW5jdGlvbiAocHJvcCkge1xuICAgICAgICByZXR1cm4gZ2V0JDEoY2xhc3NlcywgcHJvcCkuZ2V0T3IoW10pO1xuICAgICAgfTtcbiAgICAgIHZhciBtYWtlID0gZnVuY3Rpb24gKHhEZWx0YSwgeURlbHRhLCBhbGlnbm1lbnRzT24pIHtcbiAgICAgICAgdmFyIGFsaWdubWVudHNPZmYgPSBkaWZmZXJlbmNlKGFsbEFsaWdubWVudHMsIGFsaWdubWVudHNPbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb2Zmc2V0OiBTdWdhclBvc2l0aW9uKHhEZWx0YSwgeURlbHRhKSxcbiAgICAgICAgICBjbGFzc2VzT246IGJpbmQoYWxpZ25tZW50c09uLCBnZXRDbGFzc2VzKSxcbiAgICAgICAgICBjbGFzc2VzT2ZmOiBiaW5kKGFsaWdubWVudHNPZmYsIGdldENsYXNzZXMpXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc291dGhlYXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1ha2UoLXdpZHRoLCB5b2Zmc2V0LCBbXG4gICAgICAgICAgICAndG9wJyxcbiAgICAgICAgICAgICdhbGlnbkxlZnQnXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNvdXRod2VzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtYWtlKHdpZHRoLCB5b2Zmc2V0LCBbXG4gICAgICAgICAgICAndG9wJyxcbiAgICAgICAgICAgICdhbGlnblJpZ2h0J1xuICAgICAgICAgIF0pO1xuICAgICAgICB9LFxuICAgICAgICBzb3V0aDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtYWtlKC13aWR0aCAvIDIsIHlvZmZzZXQsIFtcbiAgICAgICAgICAgICd0b3AnLFxuICAgICAgICAgICAgJ2FsaWduQ2VudHJlJ1xuICAgICAgICAgIF0pO1xuICAgICAgICB9LFxuICAgICAgICBub3J0aGVhc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWFrZSgtd2lkdGgsIC15b2Zmc2V0LCBbXG4gICAgICAgICAgICAnYm90dG9tJyxcbiAgICAgICAgICAgICdhbGlnbkxlZnQnXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0sXG4gICAgICAgIG5vcnRod2VzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtYWtlKHdpZHRoLCAteW9mZnNldCwgW1xuICAgICAgICAgICAgJ2JvdHRvbScsXG4gICAgICAgICAgICAnYWxpZ25SaWdodCdcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSxcbiAgICAgICAgbm9ydGg6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWFrZSgtd2lkdGggLyAyLCAteW9mZnNldCwgW1xuICAgICAgICAgICAgJ2JvdHRvbScsXG4gICAgICAgICAgICAnYWxpZ25DZW50cmUnXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVhc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWFrZSh3aWR0aCwgLXlvZmZzZXQgLyAyLCBbXG4gICAgICAgICAgICAndmFsaWduQ2VudHJlJyxcbiAgICAgICAgICAgICdsZWZ0J1xuICAgICAgICAgIF0pO1xuICAgICAgICB9LFxuICAgICAgICB3ZXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1ha2UoLXdpZHRoLCAteW9mZnNldCAvIDIsIFtcbiAgICAgICAgICAgICd2YWxpZ25DZW50cmUnLFxuICAgICAgICAgICAgJ3JpZ2h0J1xuICAgICAgICAgIF0pO1xuICAgICAgICB9LFxuICAgICAgICBpbm5lck5vcnRod2VzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtYWtlKC13aWR0aCwgeW9mZnNldCwgW1xuICAgICAgICAgICAgJ3RvcCcsXG4gICAgICAgICAgICAnYWxpZ25SaWdodCdcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5uZXJOb3J0aGVhc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWFrZSh3aWR0aCwgeW9mZnNldCwgW1xuICAgICAgICAgICAgJ3RvcCcsXG4gICAgICAgICAgICAnYWxpZ25MZWZ0J1xuICAgICAgICAgIF0pO1xuICAgICAgICB9LFxuICAgICAgICBpbm5lck5vcnRoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1ha2UoLXdpZHRoIC8gMiwgeW9mZnNldCwgW1xuICAgICAgICAgICAgJ3RvcCcsXG4gICAgICAgICAgICAnYWxpZ25DZW50cmUnXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0sXG4gICAgICAgIGlubmVyU291dGh3ZXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1ha2UoLXdpZHRoLCAteW9mZnNldCwgW1xuICAgICAgICAgICAgJ2JvdHRvbScsXG4gICAgICAgICAgICAnYWxpZ25SaWdodCdcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5uZXJTb3V0aGVhc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWFrZSh3aWR0aCwgLXlvZmZzZXQsIFtcbiAgICAgICAgICAgICdib3R0b20nLFxuICAgICAgICAgICAgJ2FsaWduTGVmdCdcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5uZXJTb3V0aDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtYWtlKC13aWR0aCAvIDIsIC15b2Zmc2V0LCBbXG4gICAgICAgICAgICAnYm90dG9tJyxcbiAgICAgICAgICAgICdhbGlnbkNlbnRyZSdcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5uZXJXZXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1ha2Uod2lkdGgsIC15b2Zmc2V0IC8gMiwgW1xuICAgICAgICAgICAgJ3ZhbGlnbkNlbnRyZScsXG4gICAgICAgICAgICAncmlnaHQnXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0sXG4gICAgICAgIGlubmVyRWFzdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtYWtlKC13aWR0aCwgLXlvZmZzZXQgLyAyLCBbXG4gICAgICAgICAgICAndmFsaWduQ2VudHJlJyxcbiAgICAgICAgICAgICdsZWZ0J1xuICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGZhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG51JDgoMCwgMCwge30pO1xuICAgIH07XG5cbiAgICB2YXIgbnUkOSA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4geDtcbiAgICB9O1xuXG4gICAgdmFyIG9uRGlyZWN0aW9uID0gZnVuY3Rpb24gKGlzTHRyLCBpc1J0bCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBnZXREaXJlY3Rpb24oZWxlbWVudCkgPT09ICdydGwnID8gaXNSdGwgOiBpc0x0cjtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0RGlyZWN0aW9uID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBnZXQkNShlbGVtZW50LCAnZGlyZWN0aW9uJykgPT09ICdydGwnID8gJ3J0bCcgOiAnbHRyJztcbiAgICB9O1xuXG4gICAgdmFyIEF0dHJpYnV0ZVZhbHVlO1xuICAgIChmdW5jdGlvbiAoQXR0cmlidXRlVmFsdWUpIHtcbiAgICAgIEF0dHJpYnV0ZVZhbHVlWydUb3BUb0JvdHRvbSddID0gJ3RvcHRvYm90dG9tJztcbiAgICAgIEF0dHJpYnV0ZVZhbHVlWydCb3R0b21Ub1RvcCddID0gJ2JvdHRvbXRvdG9wJztcbiAgICB9KEF0dHJpYnV0ZVZhbHVlIHx8IChBdHRyaWJ1dGVWYWx1ZSA9IHt9KSkpO1xuICAgIHZhciBBdHRyaWJ1dGUgPSAnZGF0YS1hbGxveS12ZXJ0aWNhbC1kaXInO1xuICAgIHZhciBpc0JvdHRvbVRvVG9wRGlyID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXR1cm4gY2xvc2VzdCQyKGVsLCBmdW5jdGlvbiAoY3VycmVudCkge1xuICAgICAgICByZXR1cm4gaXNFbGVtZW50KGN1cnJlbnQpICYmIGdldCQzKGN1cnJlbnQsICdkYXRhLWFsbG95LXZlcnRpY2FsLWRpcicpID09PSBBdHRyaWJ1dGVWYWx1ZS5Cb3R0b21Ub1RvcDtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgc2NoZW1hJDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gb3B0aW9uT2JqT2YoJ2xheW91dHMnLCBbXG4gICAgICAgIHN0cmljdCQxKCdvbkx0cicpLFxuICAgICAgICBzdHJpY3QkMSgnb25SdGwnKSxcbiAgICAgICAgb3B0aW9uKCdvbkJvdHRvbUx0cicpLFxuICAgICAgICBvcHRpb24oJ29uQm90dG9tUnRsJylcbiAgICAgIF0pO1xuICAgIH07XG4gICAgdmFyIGdldCRiID0gZnVuY3Rpb24gKGVsZW0sIGluZm8sIGRlZmF1bHRMdHIsIGRlZmF1bHRSdGwsIGRlZmF1bHRCb3R0b21MdHIsIGRlZmF1bHRCb3R0b21SdGwsIGRpckVsZW1lbnQpIHtcbiAgICAgIHZhciBpc0JvdHRvbVRvVG9wID0gZGlyRWxlbWVudC5tYXAoaXNCb3R0b21Ub1RvcERpcikuZ2V0T3IoZmFsc2UpO1xuICAgICAgdmFyIGN1c3RvbUx0ciA9IGluZm8ubGF5b3V0cy5tYXAoZnVuY3Rpb24gKGxzKSB7XG4gICAgICAgIHJldHVybiBscy5vbkx0cihlbGVtKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGN1c3RvbVJ0bCA9IGluZm8ubGF5b3V0cy5tYXAoZnVuY3Rpb24gKGxzKSB7XG4gICAgICAgIHJldHVybiBscy5vblJ0bChlbGVtKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGx0ciA9IGlzQm90dG9tVG9Ub3AgPyBpbmZvLmxheW91dHMuYmluZChmdW5jdGlvbiAobHMpIHtcbiAgICAgICAgcmV0dXJuIGxzLm9uQm90dG9tTHRyLm1hcChmdW5jdGlvbiAoZikge1xuICAgICAgICAgIHJldHVybiBmKGVsZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pLm9yKGN1c3RvbUx0cikuZ2V0T3IoZGVmYXVsdEJvdHRvbUx0cikgOiBjdXN0b21MdHIuZ2V0T3IoZGVmYXVsdEx0cik7XG4gICAgICB2YXIgcnRsID0gaXNCb3R0b21Ub1RvcCA/IGluZm8ubGF5b3V0cy5iaW5kKGZ1bmN0aW9uIChscykge1xuICAgICAgICByZXR1cm4gbHMub25Cb3R0b21SdGwubWFwKGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIGYoZWxlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfSkub3IoY3VzdG9tUnRsKS5nZXRPcihkZWZhdWx0Qm90dG9tUnRsKSA6IGN1c3RvbVJ0bC5nZXRPcihkZWZhdWx0UnRsKTtcbiAgICAgIHZhciBmID0gb25EaXJlY3Rpb24obHRyLCBydGwpO1xuICAgICAgcmV0dXJuIGYoZWxlbSk7XG4gICAgfTtcblxuICAgIHZhciBwbGFjZW1lbnQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBhbmNob3JJbmZvLCBvcmlnaW4pIHtcbiAgICAgIHZhciBob3RzcG90ID0gYW5jaG9ySW5mby5ob3RzcG90O1xuICAgICAgdmFyIGFuY2hvckJveCA9IHRvQm94KG9yaWdpbiwgaG90c3BvdC5lbGVtZW50KTtcbiAgICAgIHZhciBsYXlvdXRzID0gZ2V0JGIoY29tcG9uZW50LmVsZW1lbnQsIGFuY2hvckluZm8sIGJlbG93T3JBYm92ZSgpLCBiZWxvd09yQWJvdmVSdGwoKSwgYWJvdmVPckJlbG93KCksIGFib3ZlT3JCZWxvd1J0bCgpLCBPcHRpb25hbC5zb21lKGFuY2hvckluZm8uaG90c3BvdC5lbGVtZW50KSk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShudSQ5KHtcbiAgICAgICAgYW5jaG9yQm94OiBhbmNob3JCb3gsXG4gICAgICAgIGJ1YmJsZTogYW5jaG9ySW5mby5idWJibGUuZ2V0T3IoZmFsbGJhY2soKSksXG4gICAgICAgIG92ZXJyaWRlczogYW5jaG9ySW5mby5vdmVycmlkZXMsXG4gICAgICAgIGxheW91dHM6IGxheW91dHMsXG4gICAgICAgIHBsYWNlcjogT3B0aW9uYWwubm9uZSgpXG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgSG90c3BvdEFuY2hvciA9IFtcbiAgICAgIHN0cmljdCQxKCdob3RzcG90JyksXG4gICAgICBvcHRpb24oJ2J1YmJsZScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ292ZXJyaWRlcycsIHt9KSxcbiAgICAgIHNjaGVtYSQxKCksXG4gICAgICBvdXRwdXQoJ3BsYWNlbWVudCcsIHBsYWNlbWVudClcbiAgICBdO1xuXG4gICAgdmFyIHBsYWNlbWVudCQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgYW5jaG9ySW5mbywgb3JpZ2luKSB7XG4gICAgICB2YXIgcG9zID0gdHJhbnNsYXRlKG9yaWdpbiwgYW5jaG9ySW5mby54LCBhbmNob3JJbmZvLnkpO1xuICAgICAgdmFyIGFuY2hvckJveCA9IGJvdW5kcyQxKHBvcy5sZWZ0LCBwb3MudG9wLCBhbmNob3JJbmZvLndpZHRoLCBhbmNob3JJbmZvLmhlaWdodCk7XG4gICAgICB2YXIgbGF5b3V0cyA9IGdldCRiKGNvbXBvbmVudC5lbGVtZW50LCBhbmNob3JJbmZvLCBhbGwkMigpLCBhbGxSdGwoKSwgYWxsJDIoKSwgYWxsUnRsKCksIE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShudSQ5KHtcbiAgICAgICAgYW5jaG9yQm94OiBhbmNob3JCb3gsXG4gICAgICAgIGJ1YmJsZTogYW5jaG9ySW5mby5idWJibGUsXG4gICAgICAgIG92ZXJyaWRlczogYW5jaG9ySW5mby5vdmVycmlkZXMsXG4gICAgICAgIGxheW91dHM6IGxheW91dHMsXG4gICAgICAgIHBsYWNlcjogT3B0aW9uYWwubm9uZSgpXG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgTWFrZXNoaWZ0QW5jaG9yID0gW1xuICAgICAgc3RyaWN0JDEoJ3gnKSxcbiAgICAgIHN0cmljdCQxKCd5JyksXG4gICAgICBkZWZhdWx0ZWQkMSgnaGVpZ2h0JywgMCksXG4gICAgICBkZWZhdWx0ZWQkMSgnd2lkdGgnLCAwKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdidWJibGUnLCBmYWxsYmFjaygpKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdvdmVycmlkZXMnLCB7fSksXG4gICAgICBzY2hlbWEkMSgpLFxuICAgICAgb3V0cHV0KCdwbGFjZW1lbnQnLCBwbGFjZW1lbnQkMSlcbiAgICBdO1xuXG4gICAgdmFyIGFkdCQ1ID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHsgc2NyZWVuOiBbJ3BvaW50J10gfSxcbiAgICAgIHtcbiAgICAgICAgYWJzb2x1dGU6IFtcbiAgICAgICAgICAncG9pbnQnLFxuICAgICAgICAgICdzY3JvbGxMZWZ0JyxcbiAgICAgICAgICAnc2Nyb2xsVG9wJ1xuICAgICAgICBdXG4gICAgICB9XG4gICAgXSk7XG4gICAgdmFyIHRvRml4ZWQgPSBmdW5jdGlvbiAocG9zKSB7XG4gICAgICByZXR1cm4gcG9zLmZvbGQoaWRlbnRpdHksIGZ1bmN0aW9uIChwb2ludCwgc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wKSB7XG4gICAgICAgIHJldHVybiBwb2ludC50cmFuc2xhdGUoLXNjcm9sbExlZnQsIC1zY3JvbGxUb3ApO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdG9BYnNvbHV0ZSA9IGZ1bmN0aW9uIChwb3MpIHtcbiAgICAgIHJldHVybiBwb3MuZm9sZChpZGVudGl0eSwgaWRlbnRpdHkpO1xuICAgIH07XG4gICAgdmFyIHN1bSA9IGZ1bmN0aW9uIChwb2ludHMpIHtcbiAgICAgIHJldHVybiBmb2xkbChwb2ludHMsIGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICAgIHJldHVybiBiLnRyYW5zbGF0ZShhLmxlZnQsIGEudG9wKTtcbiAgICAgIH0sIFN1Z2FyUG9zaXRpb24oMCwgMCkpO1xuICAgIH07XG4gICAgdmFyIHN1bUFzRml4ZWQgPSBmdW5jdGlvbiAocG9zaXRpb25zKSB7XG4gICAgICB2YXIgcG9pbnRzID0gbWFwKHBvc2l0aW9ucywgdG9GaXhlZCk7XG4gICAgICByZXR1cm4gc3VtKHBvaW50cyk7XG4gICAgfTtcbiAgICB2YXIgc3VtQXNBYnNvbHV0ZSA9IGZ1bmN0aW9uIChwb3NpdGlvbnMpIHtcbiAgICAgIHZhciBwb2ludHMgPSBtYXAocG9zaXRpb25zLCB0b0Fic29sdXRlKTtcbiAgICAgIHJldHVybiBzdW0ocG9pbnRzKTtcbiAgICB9O1xuICAgIHZhciBzY3JlZW4gPSBhZHQkNS5zY3JlZW47XG4gICAgdmFyIGFic29sdXRlJDIgPSBhZHQkNS5hYnNvbHV0ZTtcblxuICAgIHZhciBnZXRPZmZzZXQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBvcmlnaW4sIGFuY2hvckluZm8pIHtcbiAgICAgIHZhciB3aW4gPSBkZWZhdWx0VmlldyhhbmNob3JJbmZvLnJvb3QpLmRvbTtcbiAgICAgIHZhciBoYXNTYW1lT3duZXIgPSBmdW5jdGlvbiAoZnJhbWUpIHtcbiAgICAgICAgdmFyIGZyYW1lT3duZXIgPSBvd25lcihmcmFtZSk7XG4gICAgICAgIHZhciBjb21wT3duZXIgPSBvd25lcihjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBlcSQxKGZyYW1lT3duZXIsIGNvbXBPd25lcik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20od2luLmZyYW1lRWxlbWVudCkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKS5maWx0ZXIoaGFzU2FtZU93bmVyKS5tYXAoYWJzb2x1dGUpO1xuICAgIH07XG4gICAgdmFyIGdldFJvb3RQb2ludCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIG9yaWdpbiwgYW5jaG9ySW5mbykge1xuICAgICAgdmFyIGRvYyA9IG93bmVyKGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIHZhciBvdXRlclNjcm9sbCA9IGdldCQ5KGRvYyk7XG4gICAgICB2YXIgb2Zmc2V0ID0gZ2V0T2Zmc2V0KGNvbXBvbmVudCwgb3JpZ2luLCBhbmNob3JJbmZvKS5nZXRPcihvdXRlclNjcm9sbCk7XG4gICAgICByZXR1cm4gYWJzb2x1dGUkMihvZmZzZXQsIG91dGVyU2Nyb2xsLmxlZnQsIG91dGVyU2Nyb2xsLnRvcCk7XG4gICAgfTtcblxuICAgIHZhciBjYXBSZWN0ID0gZnVuY3Rpb24gKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgdmFyIG5ld0xlZnQgPSBsZWZ0LCBuZXdUb3AgPSB0b3AsIG5ld1dpZHRoID0gd2lkdGgsIG5ld0hlaWdodCA9IGhlaWdodDtcbiAgICAgIGlmIChsZWZ0IDwgMCkge1xuICAgICAgICBuZXdMZWZ0ID0gMDtcbiAgICAgICAgbmV3V2lkdGggPSB3aWR0aCArIGxlZnQ7XG4gICAgICB9XG4gICAgICBpZiAodG9wIDwgMCkge1xuICAgICAgICBuZXdUb3AgPSAwO1xuICAgICAgICBuZXdIZWlnaHQgPSBoZWlnaHQgKyB0b3A7XG4gICAgICB9XG4gICAgICB2YXIgcG9pbnQgPSBzY3JlZW4oU3VnYXJQb3NpdGlvbihuZXdMZWZ0LCBuZXdUb3ApKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHBvaW50ZWQocG9pbnQsIG5ld1dpZHRoLCBuZXdIZWlnaHQpKTtcbiAgICB9O1xuICAgIHZhciBjYWxjTmV3QW5jaG9yID0gZnVuY3Rpb24gKG9wdEJveCwgcm9vdFBvaW50LCBhbmNob3JJbmZvLCBvcmlnaW4sIGVsZW0pIHtcbiAgICAgIHJldHVybiBvcHRCb3gubWFwKGZ1bmN0aW9uIChib3gpIHtcbiAgICAgICAgdmFyIHBvaW50cyA9IFtcbiAgICAgICAgICByb290UG9pbnQsXG4gICAgICAgICAgYm94LnBvaW50XG4gICAgICAgIF07XG4gICAgICAgIHZhciB0b3BMZWZ0ID0gY2F0YSQxKG9yaWdpbiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzdW1Bc0Fic29sdXRlKHBvaW50cyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gc3VtQXNBYnNvbHV0ZShwb2ludHMpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHN1bUFzRml4ZWQocG9pbnRzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBhbmNob3JCb3ggPSByZWN0KHRvcExlZnQubGVmdCwgdG9wTGVmdC50b3AsIGJveC53aWR0aCwgYm94LmhlaWdodCk7XG4gICAgICAgIHZhciBsYXlvdXRzTHRyID0gYW5jaG9ySW5mby5zaG93QWJvdmUgPyBhYm92ZU9yQmVsb3coKSA6IGJlbG93T3JBYm92ZSgpO1xuICAgICAgICB2YXIgbGF5b3V0c1J0bCA9IGFuY2hvckluZm8uc2hvd0Fib3ZlID8gYWJvdmVPckJlbG93UnRsKCkgOiBiZWxvd09yQWJvdmVSdGwoKTtcbiAgICAgICAgdmFyIGxheW91dHMgPSBnZXQkYihlbGVtLCBhbmNob3JJbmZvLCBsYXlvdXRzTHRyLCBsYXlvdXRzUnRsLCBsYXlvdXRzTHRyLCBsYXlvdXRzUnRsLCBPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICByZXR1cm4gbnUkOSh7XG4gICAgICAgICAgYW5jaG9yQm94OiBhbmNob3JCb3gsXG4gICAgICAgICAgYnViYmxlOiBhbmNob3JJbmZvLmJ1YmJsZS5nZXRPcihmYWxsYmFjaygpKSxcbiAgICAgICAgICBvdmVycmlkZXM6IGFuY2hvckluZm8ub3ZlcnJpZGVzLFxuICAgICAgICAgIGxheW91dHM6IGxheW91dHMsXG4gICAgICAgICAgcGxhY2VyOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHBsYWNlbWVudCQyID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgYW5jaG9ySW5mbywgb3JpZ2luKSB7XG4gICAgICB2YXIgcm9vdFBvaW50ID0gZ2V0Um9vdFBvaW50KGNvbXBvbmVudCwgb3JpZ2luLCBhbmNob3JJbmZvKTtcbiAgICAgIHJldHVybiBhbmNob3JJbmZvLm5vZGUuZmlsdGVyKGluQm9keSkuYmluZChmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgIHZhciByZWN0ID0gdGFyZ2V0LmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgdmFyIG5vZGVCb3ggPSBjYXBSZWN0KHJlY3QubGVmdCwgcmVjdC50b3AsIHJlY3Qud2lkdGgsIHJlY3QuaGVpZ2h0KTtcbiAgICAgICAgdmFyIGVsZW0gPSBhbmNob3JJbmZvLm5vZGUuZ2V0T3IoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICByZXR1cm4gY2FsY05ld0FuY2hvcihub2RlQm94LCByb290UG9pbnQsIGFuY2hvckluZm8sIG9yaWdpbiwgZWxlbSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBOb2RlQW5jaG9yID0gW1xuICAgICAgc3RyaWN0JDEoJ25vZGUnKSxcbiAgICAgIHN0cmljdCQxKCdyb290JyksXG4gICAgICBvcHRpb24oJ2J1YmJsZScpLFxuICAgICAgc2NoZW1hJDEoKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdvdmVycmlkZXMnLCB7fSksXG4gICAgICBkZWZhdWx0ZWQkMSgnc2hvd0Fib3ZlJywgZmFsc2UpLFxuICAgICAgb3V0cHV0KCdwbGFjZW1lbnQnLCBwbGFjZW1lbnQkMilcbiAgICBdO1xuXG4gICAgdmFyIHplcm9XaWR0aCA9ICdcXHVGRUZGJztcbiAgICB2YXIgbmJzcCA9ICdcXHhBMCc7XG5cbiAgICB2YXIgY3JlYXRlJDIgPSBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICBzb2Zmc2V0OiBzb2Zmc2V0LFxuICAgICAgICBmaW5pc2g6IGZpbmlzaCxcbiAgICAgICAgZm9mZnNldDogZm9mZnNldFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTaW1SYW5nZSA9IHsgY3JlYXRlOiBjcmVhdGUkMiB9O1xuXG4gICAgdmFyIGFkdCQ2ID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHsgYmVmb3JlOiBbJ2VsZW1lbnQnXSB9LFxuICAgICAge1xuICAgICAgICBvbjogW1xuICAgICAgICAgICdlbGVtZW50JyxcbiAgICAgICAgICAnb2Zmc2V0J1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgeyBhZnRlcjogWydlbGVtZW50J10gfVxuICAgIF0pO1xuICAgIHZhciBjYXRhJDIgPSBmdW5jdGlvbiAoc3ViamVjdCwgb25CZWZvcmUsIG9uT24sIG9uQWZ0ZXIpIHtcbiAgICAgIHJldHVybiBzdWJqZWN0LmZvbGQob25CZWZvcmUsIG9uT24sIG9uQWZ0ZXIpO1xuICAgIH07XG4gICAgdmFyIGdldFN0YXJ0ID0gZnVuY3Rpb24gKHNpdHUpIHtcbiAgICAgIHJldHVybiBzaXR1LmZvbGQoaWRlbnRpdHksIGlkZW50aXR5LCBpZGVudGl0eSk7XG4gICAgfTtcbiAgICB2YXIgYmVmb3JlJDIgPSBhZHQkNi5iZWZvcmU7XG4gICAgdmFyIG9uID0gYWR0JDYub247XG4gICAgdmFyIGFmdGVyJDEgPSBhZHQkNi5hZnRlcjtcbiAgICB2YXIgU2l0dSA9IHtcbiAgICAgIGJlZm9yZTogYmVmb3JlJDIsXG4gICAgICBvbjogb24sXG4gICAgICBhZnRlcjogYWZ0ZXIkMSxcbiAgICAgIGNhdGE6IGNhdGEkMixcbiAgICAgIGdldFN0YXJ0OiBnZXRTdGFydFxuICAgIH07XG5cbiAgICB2YXIgYWR0JDcgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAgeyBkb21SYW5nZTogWydybmcnXSB9LFxuICAgICAge1xuICAgICAgICByZWxhdGl2ZTogW1xuICAgICAgICAgICdzdGFydFNpdHUnLFxuICAgICAgICAgICdmaW5pc2hTaXR1J1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBleGFjdDogW1xuICAgICAgICAgICdzdGFydCcsXG4gICAgICAgICAgJ3NvZmZzZXQnLFxuICAgICAgICAgICdmaW5pc2gnLFxuICAgICAgICAgICdmb2Zmc2V0J1xuICAgICAgICBdXG4gICAgICB9XG4gICAgXSk7XG4gICAgdmFyIGV4YWN0RnJvbVJhbmdlID0gZnVuY3Rpb24gKHNpbVJhbmdlKSB7XG4gICAgICByZXR1cm4gYWR0JDcuZXhhY3Qoc2ltUmFuZ2Uuc3RhcnQsIHNpbVJhbmdlLnNvZmZzZXQsIHNpbVJhbmdlLmZpbmlzaCwgc2ltUmFuZ2UuZm9mZnNldCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U3RhcnQkMSA9IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgIHJldHVybiBzZWxlY3Rpb24ubWF0Y2goe1xuICAgICAgICBkb21SYW5nZTogZnVuY3Rpb24gKHJuZykge1xuICAgICAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShybmcuc3RhcnRDb250YWluZXIpO1xuICAgICAgICB9LFxuICAgICAgICByZWxhdGl2ZTogZnVuY3Rpb24gKHN0YXJ0U2l0dSwgX2ZpbmlzaFNpdHUpIHtcbiAgICAgICAgICByZXR1cm4gU2l0dS5nZXRTdGFydChzdGFydFNpdHUpO1xuICAgICAgICB9LFxuICAgICAgICBleGFjdDogZnVuY3Rpb24gKHN0YXJ0LCBfc29mZnNldCwgX2ZpbmlzaCwgX2ZvZmZzZXQpIHtcbiAgICAgICAgICByZXR1cm4gc3RhcnQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRvbVJhbmdlID0gYWR0JDcuZG9tUmFuZ2U7XG4gICAgdmFyIHJlbGF0aXZlJDEgPSBhZHQkNy5yZWxhdGl2ZTtcbiAgICB2YXIgZXhhY3QgPSBhZHQkNy5leGFjdDtcbiAgICB2YXIgZ2V0V2luID0gZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgdmFyIHN0YXJ0ID0gZ2V0U3RhcnQkMShzZWxlY3Rpb24pO1xuICAgICAgcmV0dXJuIGRlZmF1bHRWaWV3KHN0YXJ0KTtcbiAgICB9O1xuICAgIHZhciByYW5nZSQxID0gU2ltUmFuZ2UuY3JlYXRlO1xuICAgIHZhciBTaW1TZWxlY3Rpb24gPSB7XG4gICAgICBkb21SYW5nZTogZG9tUmFuZ2UsXG4gICAgICByZWxhdGl2ZTogcmVsYXRpdmUkMSxcbiAgICAgIGV4YWN0OiBleGFjdCxcbiAgICAgIGV4YWN0RnJvbVJhbmdlOiBleGFjdEZyb21SYW5nZSxcbiAgICAgIGdldFdpbjogZ2V0V2luLFxuICAgICAgcmFuZ2U6IHJhbmdlJDFcbiAgICB9O1xuXG4gICAgdmFyIHNldFN0YXJ0ID0gZnVuY3Rpb24gKHJuZywgc2l0dSkge1xuICAgICAgc2l0dS5mb2xkKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJuZy5zZXRTdGFydEJlZm9yZShlLmRvbSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZSwgbykge1xuICAgICAgICBybmcuc2V0U3RhcnQoZS5kb20sIG8pO1xuICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcm5nLnNldFN0YXJ0QWZ0ZXIoZS5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0RmluaXNoID0gZnVuY3Rpb24gKHJuZywgc2l0dSkge1xuICAgICAgc2l0dS5mb2xkKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJuZy5zZXRFbmRCZWZvcmUoZS5kb20pO1xuICAgICAgfSwgZnVuY3Rpb24gKGUsIG8pIHtcbiAgICAgICAgcm5nLnNldEVuZChlLmRvbSwgbyk7XG4gICAgICB9LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBybmcuc2V0RW5kQWZ0ZXIoZS5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVsYXRpdmVUb05hdGl2ZSA9IGZ1bmN0aW9uICh3aW4sIHN0YXJ0U2l0dSwgZmluaXNoU2l0dSkge1xuICAgICAgdmFyIHJhbmdlID0gd2luLmRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICBzZXRTdGFydChyYW5nZSwgc3RhcnRTaXR1KTtcbiAgICAgIHNldEZpbmlzaChyYW5nZSwgZmluaXNoU2l0dSk7XG4gICAgICByZXR1cm4gcmFuZ2U7XG4gICAgfTtcbiAgICB2YXIgZXhhY3RUb05hdGl2ZSA9IGZ1bmN0aW9uICh3aW4sIHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgIHZhciBybmcgPSB3aW4uZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIHJuZy5zZXRTdGFydChzdGFydC5kb20sIHNvZmZzZXQpO1xuICAgICAgcm5nLnNldEVuZChmaW5pc2guZG9tLCBmb2Zmc2V0KTtcbiAgICAgIHJldHVybiBybmc7XG4gICAgfTtcbiAgICB2YXIgdG9SZWN0ID0gZnVuY3Rpb24gKHJlY3QpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IHJlY3QubGVmdCxcbiAgICAgICAgdG9wOiByZWN0LnRvcCxcbiAgICAgICAgcmlnaHQ6IHJlY3QucmlnaHQsXG4gICAgICAgIGJvdHRvbTogcmVjdC5ib3R0b20sXG4gICAgICAgIHdpZHRoOiByZWN0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldEZpcnN0UmVjdCA9IGZ1bmN0aW9uIChybmcpIHtcbiAgICAgIHZhciByZWN0cyA9IHJuZy5nZXRDbGllbnRSZWN0cygpO1xuICAgICAgdmFyIHJlY3QgPSByZWN0cy5sZW5ndGggPiAwID8gcmVjdHNbMF0gOiBybmcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICByZXR1cm4gcmVjdC53aWR0aCA+IDAgfHwgcmVjdC5oZWlnaHQgPiAwID8gT3B0aW9uYWwuc29tZShyZWN0KS5tYXAodG9SZWN0KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuXG4gICAgdmFyIGFkdCQ4ID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHtcbiAgICAgICAgbHRyOiBbXG4gICAgICAgICAgJ3N0YXJ0JyxcbiAgICAgICAgICAnc29mZnNldCcsXG4gICAgICAgICAgJ2ZpbmlzaCcsXG4gICAgICAgICAgJ2ZvZmZzZXQnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHJ0bDogW1xuICAgICAgICAgICdzdGFydCcsXG4gICAgICAgICAgJ3NvZmZzZXQnLFxuICAgICAgICAgICdmaW5pc2gnLFxuICAgICAgICAgICdmb2Zmc2V0J1xuICAgICAgICBdXG4gICAgICB9XG4gICAgXSk7XG4gICAgdmFyIGZyb21SYW5nZSA9IGZ1bmN0aW9uICh3aW4sIHR5cGUsIHJhbmdlKSB7XG4gICAgICByZXR1cm4gdHlwZShTdWdhckVsZW1lbnQuZnJvbURvbShyYW5nZS5zdGFydENvbnRhaW5lciksIHJhbmdlLnN0YXJ0T2Zmc2V0LCBTdWdhckVsZW1lbnQuZnJvbURvbShyYW5nZS5lbmRDb250YWluZXIpLCByYW5nZS5lbmRPZmZzZXQpO1xuICAgIH07XG4gICAgdmFyIGdldFJhbmdlcyA9IGZ1bmN0aW9uICh3aW4sIHNlbGVjdGlvbikge1xuICAgICAgcmV0dXJuIHNlbGVjdGlvbi5tYXRjaCh7XG4gICAgICAgIGRvbVJhbmdlOiBmdW5jdGlvbiAocm5nKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGx0cjogY29uc3RhbnQocm5nKSxcbiAgICAgICAgICAgIHJ0bDogT3B0aW9uYWwubm9uZVxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIHJlbGF0aXZlOiBmdW5jdGlvbiAoc3RhcnRTaXR1LCBmaW5pc2hTaXR1KSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGx0cjogY2FjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlbGF0aXZlVG9OYXRpdmUod2luLCBzdGFydFNpdHUsIGZpbmlzaFNpdHUpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydGw6IGNhY2hlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHJlbGF0aXZlVG9OYXRpdmUod2luLCBmaW5pc2hTaXR1LCBzdGFydFNpdHUpKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgZXhhY3Q6IGZ1bmN0aW9uIChzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGx0cjogY2FjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGV4YWN0VG9OYXRpdmUod2luLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcnRsOiBjYWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShleGFjdFRvTmF0aXZlKHdpbiwgZmluaXNoLCBmb2Zmc2V0LCBzdGFydCwgc29mZnNldCkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkb0RpYWdub3NlID0gZnVuY3Rpb24gKHdpbiwgcmFuZ2VzKSB7XG4gICAgICB2YXIgcm5nID0gcmFuZ2VzLmx0cigpO1xuICAgICAgaWYgKHJuZy5jb2xsYXBzZWQpIHtcbiAgICAgICAgdmFyIHJldmVyc2VkID0gcmFuZ2VzLnJ0bCgpLmZpbHRlcihmdW5jdGlvbiAocmV2KSB7XG4gICAgICAgICAgcmV0dXJuIHJldi5jb2xsYXBzZWQgPT09IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJldmVyc2VkLm1hcChmdW5jdGlvbiAocmV2KSB7XG4gICAgICAgICAgcmV0dXJuIGFkdCQ4LnJ0bChTdWdhckVsZW1lbnQuZnJvbURvbShyZXYuZW5kQ29udGFpbmVyKSwgcmV2LmVuZE9mZnNldCwgU3VnYXJFbGVtZW50LmZyb21Eb20ocmV2LnN0YXJ0Q29udGFpbmVyKSwgcmV2LnN0YXJ0T2Zmc2V0KTtcbiAgICAgICAgfSkuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGZyb21SYW5nZSh3aW4sIGFkdCQ4Lmx0ciwgcm5nKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZnJvbVJhbmdlKHdpbiwgYWR0JDgubHRyLCBybmcpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGRpYWdub3NlID0gZnVuY3Rpb24gKHdpbiwgc2VsZWN0aW9uKSB7XG4gICAgICB2YXIgcmFuZ2VzID0gZ2V0UmFuZ2VzKHdpbiwgc2VsZWN0aW9uKTtcbiAgICAgIHJldHVybiBkb0RpYWdub3NlKHdpbiwgcmFuZ2VzKTtcbiAgICB9O1xuICAgIHZhciBhc0x0clJhbmdlID0gZnVuY3Rpb24gKHdpbiwgc2VsZWN0aW9uKSB7XG4gICAgICB2YXIgZGlhZ25vc2lzID0gZGlhZ25vc2Uod2luLCBzZWxlY3Rpb24pO1xuICAgICAgcmV0dXJuIGRpYWdub3Npcy5tYXRjaCh7XG4gICAgICAgIGx0cjogZnVuY3Rpb24gKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgICAgICB2YXIgcm5nID0gd2luLmRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgICAgcm5nLnNldFN0YXJ0KHN0YXJ0LmRvbSwgc29mZnNldCk7XG4gICAgICAgICAgcm5nLnNldEVuZChmaW5pc2guZG9tLCBmb2Zmc2V0KTtcbiAgICAgICAgICByZXR1cm4gcm5nO1xuICAgICAgICB9LFxuICAgICAgICBydGw6IGZ1bmN0aW9uIChzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICAgICAgdmFyIHJuZyA9IHdpbi5kb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgIHJuZy5zZXRTdGFydChmaW5pc2guZG9tLCBmb2Zmc2V0KTtcbiAgICAgICAgICBybmcuc2V0RW5kKHN0YXJ0LmRvbSwgc29mZnNldCk7XG4gICAgICAgICAgcmV0dXJuIHJuZztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbHRyID0gYWR0JDgubHRyO1xuICAgIHZhciBydGwgPSBhZHQkOC5ydGw7XG5cbiAgICB2YXIgTm9kZVZhbHVlID0gZnVuY3Rpb24gKGlzLCBuYW1lKSB7XG4gICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFpcyhlbGVtZW50KSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuIG9ubHkgZ2V0ICcgKyBuYW1lICsgJyB2YWx1ZSBvZiBhICcgKyBuYW1lICsgJyBub2RlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldE9wdGlvbihlbGVtZW50KS5nZXRPcignJyk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldE9wdGlvbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBpcyhlbGVtZW50KSA/IE9wdGlvbmFsLmZyb20oZWxlbWVudC5kb20ubm9kZVZhbHVlKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgICAgIGlmICghaXMoZWxlbWVudCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBvbmx5IHNldCByYXcgJyArIG5hbWUgKyAnIHZhbHVlIG9mIGEgJyArIG5hbWUgKyAnIG5vZGUnKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmRvbS5ub2RlVmFsdWUgPSB2YWx1ZTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgZ2V0T3B0aW9uOiBnZXRPcHRpb24sXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgYXBpJDIgPSBOb2RlVmFsdWUoaXNUZXh0LCAndGV4dCcpO1xuICAgIHZhciBnZXQkYyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYXBpJDIuZ2V0KGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGdldE9wdGlvbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYXBpJDIuZ2V0T3B0aW9uKGVsZW1lbnQpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0RW5kID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBuYW1lKGVsZW1lbnQpID09PSAnaW1nJyA/IDEgOiBnZXRPcHRpb24oZWxlbWVudCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjaGlsZHJlbihlbGVtZW50KS5sZW5ndGg7XG4gICAgICB9LCBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdi5sZW5ndGg7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpc1RleHROb2RlV2l0aEN1cnNvclBvc2l0aW9uID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXR1cm4gZ2V0T3B0aW9uKGVsKS5maWx0ZXIoZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHRleHQudHJpbSgpLmxlbmd0aCAhPT0gMCB8fCB0ZXh0LmluZGV4T2YobmJzcCkgPiAtMTtcbiAgICAgIH0pLmlzU29tZSgpO1xuICAgIH07XG4gICAgdmFyIGVsZW1lbnRzV2l0aEN1cnNvclBvc2l0aW9uID0gW1xuICAgICAgJ2ltZycsXG4gICAgICAnYnInXG4gICAgXTtcbiAgICB2YXIgaXNDdXJzb3JQb3NpdGlvbiA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICB2YXIgaGFzQ3Vyc29yUG9zaXRpb24gPSBpc1RleHROb2RlV2l0aEN1cnNvclBvc2l0aW9uKGVsZW0pO1xuICAgICAgcmV0dXJuIGhhc0N1cnNvclBvc2l0aW9uIHx8IGNvbnRhaW5zKGVsZW1lbnRzV2l0aEN1cnNvclBvc2l0aW9uLCBuYW1lKGVsZW0pKTtcbiAgICB9O1xuXG4gICAgdmFyIGxhc3QkMSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZGVzY2VuZGFudFJ0bChlbGVtZW50LCBpc0N1cnNvclBvc2l0aW9uKTtcbiAgICB9O1xuICAgIHZhciBkZXNjZW5kYW50UnRsID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciBkZXNjZW5kID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGNoaWxkcmVuJDEgPSBjaGlsZHJlbihlbGVtZW50KTtcbiAgICAgICAgZm9yICh2YXIgaSA9IGNoaWxkcmVuJDEubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbiQxW2ldO1xuICAgICAgICAgIGlmIChwcmVkaWNhdGUoY2hpbGQpKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShjaGlsZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXMgPSBkZXNjZW5kKGNoaWxkKTtcbiAgICAgICAgICBpZiAocmVzLmlzU29tZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBkZXNjZW5kKHNjb3BlKTtcbiAgICB9O1xuXG4gICAgdmFyIGRlc2NlbmRhbnRzID0gZnVuY3Rpb24gKHNjb3BlLCBzZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGFsbChzZWxlY3Rvciwgc2NvcGUpO1xuICAgIH07XG5cbiAgICB2YXIgbWFrZVJhbmdlID0gZnVuY3Rpb24gKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgIHZhciBkb2MgPSBvd25lcihzdGFydCk7XG4gICAgICB2YXIgcm5nID0gZG9jLmRvbS5jcmVhdGVSYW5nZSgpO1xuICAgICAgcm5nLnNldFN0YXJ0KHN0YXJ0LmRvbSwgc29mZnNldCk7XG4gICAgICBybmcuc2V0RW5kKGZpbmlzaC5kb20sIGZvZmZzZXQpO1xuICAgICAgcmV0dXJuIHJuZztcbiAgICB9O1xuICAgIHZhciBhZnRlciQyID0gZnVuY3Rpb24gKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgIHZhciByID0gbWFrZVJhbmdlKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpO1xuICAgICAgdmFyIHNhbWUgPSBlcSQxKHN0YXJ0LCBmaW5pc2gpICYmIHNvZmZzZXQgPT09IGZvZmZzZXQ7XG4gICAgICByZXR1cm4gci5jb2xsYXBzZWQgJiYgIXNhbWU7XG4gICAgfTtcblxuICAgIHZhciBnZXROYXRpdmVTZWxlY3Rpb24gPSBmdW5jdGlvbiAod2luKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbSh3aW4uZ2V0U2VsZWN0aW9uKCkpO1xuICAgIH07XG4gICAgdmFyIHJlYWRSYW5nZSA9IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgIGlmIChzZWxlY3Rpb24ucmFuZ2VDb3VudCA+IDApIHtcbiAgICAgICAgdmFyIGZpcnN0Um5nID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XG4gICAgICAgIHZhciBsYXN0Um5nID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoc2VsZWN0aW9uLnJhbmdlQ291bnQgLSAxKTtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoU2ltUmFuZ2UuY3JlYXRlKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGZpcnN0Um5nLnN0YXJ0Q29udGFpbmVyKSwgZmlyc3RSbmcuc3RhcnRPZmZzZXQsIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGxhc3RSbmcuZW5kQ29udGFpbmVyKSwgbGFzdFJuZy5lbmRPZmZzZXQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZG9HZXRFeGFjdCA9IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgIGlmIChzZWxlY3Rpb24uYW5jaG9yTm9kZSA9PT0gbnVsbCB8fCBzZWxlY3Rpb24uZm9jdXNOb2RlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiByZWFkUmFuZ2Uoc2VsZWN0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBhbmNob3IgPSBTdWdhckVsZW1lbnQuZnJvbURvbShzZWxlY3Rpb24uYW5jaG9yTm9kZSk7XG4gICAgICAgIHZhciBmb2N1c18xID0gU3VnYXJFbGVtZW50LmZyb21Eb20oc2VsZWN0aW9uLmZvY3VzTm9kZSk7XG4gICAgICAgIHJldHVybiBhZnRlciQyKGFuY2hvciwgc2VsZWN0aW9uLmFuY2hvck9mZnNldCwgZm9jdXNfMSwgc2VsZWN0aW9uLmZvY3VzT2Zmc2V0KSA/IE9wdGlvbmFsLnNvbWUoU2ltUmFuZ2UuY3JlYXRlKGFuY2hvciwgc2VsZWN0aW9uLmFuY2hvck9mZnNldCwgZm9jdXNfMSwgc2VsZWN0aW9uLmZvY3VzT2Zmc2V0KSkgOiByZWFkUmFuZ2Uoc2VsZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRFeGFjdCA9IGZ1bmN0aW9uICh3aW4pIHtcbiAgICAgIHJldHVybiBnZXROYXRpdmVTZWxlY3Rpb24od2luKS5maWx0ZXIoZnVuY3Rpb24gKHNlbCkge1xuICAgICAgICByZXR1cm4gc2VsLnJhbmdlQ291bnQgPiAwO1xuICAgICAgfSkuYmluZChkb0dldEV4YWN0KTtcbiAgICB9O1xuICAgIHZhciBnZXRGaXJzdFJlY3QkMSA9IGZ1bmN0aW9uICh3aW4sIHNlbGVjdGlvbikge1xuICAgICAgdmFyIHJuZyA9IGFzTHRyUmFuZ2Uod2luLCBzZWxlY3Rpb24pO1xuICAgICAgcmV0dXJuIGdldEZpcnN0UmVjdChybmcpO1xuICAgIH07XG5cbiAgICB2YXIgcG9pbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgb2Zmc2V0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICBvZmZzZXQ6IG9mZnNldFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkZXNjZW5kT25jZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBvZmZzZXQpIHtcbiAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4oZWxlbWVudCk7XG4gICAgICBpZiAoY2hpbGRyZW4kMS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHBvaW50KGVsZW1lbnQsIG9mZnNldCk7XG4gICAgICB9IGVsc2UgaWYgKG9mZnNldCA8IGNoaWxkcmVuJDEubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBwb2ludChjaGlsZHJlbiQxW29mZnNldF0sIDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGxhc3QgPSBjaGlsZHJlbiQxW2NoaWxkcmVuJDEubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBsZW4gPSBpc1RleHQobGFzdCkgPyBnZXQkYyhsYXN0KS5sZW5ndGggOiBjaGlsZHJlbihsYXN0KS5sZW5ndGg7XG4gICAgICAgIHJldHVybiBwb2ludChsYXN0LCBsZW4pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZGVzY2VuZE9uY2UkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBvZmZzZXQpIHtcbiAgICAgIHJldHVybiBpc1RleHQoZWxlbWVudCkgPyBwb2ludChlbGVtZW50LCBvZmZzZXQpIDogZGVzY2VuZE9uY2UoZWxlbWVudCwgb2Zmc2V0KTtcbiAgICB9O1xuICAgIHZhciBnZXRBbmNob3JTZWxlY3Rpb24gPSBmdW5jdGlvbiAod2luLCBhbmNob3JJbmZvKSB7XG4gICAgICB2YXIgZ2V0U2VsZWN0aW9uID0gYW5jaG9ySW5mby5nZXRTZWxlY3Rpb24uZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGdldEV4YWN0KHdpbik7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBnZXRTZWxlY3Rpb24oKS5tYXAoZnVuY3Rpb24gKHNlbCkge1xuICAgICAgICB2YXIgbW9kU3RhcnQgPSBkZXNjZW5kT25jZSQxKHNlbC5zdGFydCwgc2VsLnNvZmZzZXQpO1xuICAgICAgICB2YXIgbW9kRmluaXNoID0gZGVzY2VuZE9uY2UkMShzZWwuZmluaXNoLCBzZWwuZm9mZnNldCk7XG4gICAgICAgIHJldHVybiBTaW1TZWxlY3Rpb24ucmFuZ2UobW9kU3RhcnQuZWxlbWVudCwgbW9kU3RhcnQub2Zmc2V0LCBtb2RGaW5pc2guZWxlbWVudCwgbW9kRmluaXNoLm9mZnNldCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwbGFjZW1lbnQkMyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGFuY2hvckluZm8sIG9yaWdpbikge1xuICAgICAgdmFyIHdpbiA9IGRlZmF1bHRWaWV3KGFuY2hvckluZm8ucm9vdCkuZG9tO1xuICAgICAgdmFyIHJvb3RQb2ludCA9IGdldFJvb3RQb2ludChjb21wb25lbnQsIG9yaWdpbiwgYW5jaG9ySW5mbyk7XG4gICAgICB2YXIgc2VsZWN0aW9uQm94ID0gZ2V0QW5jaG9yU2VsZWN0aW9uKHdpbiwgYW5jaG9ySW5mbykuYmluZChmdW5jdGlvbiAoc2VsKSB7XG4gICAgICAgIHZhciBvcHRSZWN0ID0gZ2V0Rmlyc3RSZWN0JDEod2luLCBTaW1TZWxlY3Rpb24uZXhhY3RGcm9tUmFuZ2Uoc2VsKSkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHggPSBTdWdhckVsZW1lbnQuZnJvbVRleHQoemVyb1dpZHRoKTtcbiAgICAgICAgICBiZWZvcmUoc2VsLnN0YXJ0LCB4KTtcbiAgICAgICAgICByZXR1cm4gZ2V0Rmlyc3RSZWN0JDEod2luLCBTaW1TZWxlY3Rpb24uZXhhY3QoeCwgMCwgeCwgMSkpLm1hcChmdW5jdGlvbiAocmVjdCkge1xuICAgICAgICAgICAgcmVtb3ZlKHgpO1xuICAgICAgICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gb3B0UmVjdC5iaW5kKGZ1bmN0aW9uIChyYXdSZWN0KSB7XG4gICAgICAgICAgcmV0dXJuIGNhcFJlY3QocmF3UmVjdC5sZWZ0LCByYXdSZWN0LnRvcCwgcmF3UmVjdC53aWR0aCwgcmF3UmVjdC5oZWlnaHQpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHRhcmdldEVsZW1lbnQgPSBnZXRBbmNob3JTZWxlY3Rpb24od2luLCBhbmNob3JJbmZvKS5iaW5kKGZ1bmN0aW9uIChzZWwpIHtcbiAgICAgICAgcmV0dXJuIGlzRWxlbWVudChzZWwuc3RhcnQpID8gT3B0aW9uYWwuc29tZShzZWwuc3RhcnQpIDogcGFyZW50Tm9kZShzZWwuc3RhcnQpO1xuICAgICAgfSk7XG4gICAgICB2YXIgZWxlbSA9IHRhcmdldEVsZW1lbnQuZ2V0T3IoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgcmV0dXJuIGNhbGNOZXdBbmNob3Ioc2VsZWN0aW9uQm94LCByb290UG9pbnQsIGFuY2hvckluZm8sIG9yaWdpbiwgZWxlbSk7XG4gICAgfTtcbiAgICB2YXIgU2VsZWN0aW9uQW5jaG9yID0gW1xuICAgICAgb3B0aW9uKCdnZXRTZWxlY3Rpb24nKSxcbiAgICAgIHN0cmljdCQxKCdyb290JyksXG4gICAgICBvcHRpb24oJ2J1YmJsZScpLFxuICAgICAgc2NoZW1hJDEoKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdvdmVycmlkZXMnLCB7fSksXG4gICAgICBkZWZhdWx0ZWQkMSgnc2hvd0Fib3ZlJywgZmFsc2UpLFxuICAgICAgb3V0cHV0KCdwbGFjZW1lbnQnLCBwbGFjZW1lbnQkMylcbiAgICBdO1xuXG4gICAgdmFyIGVhc3RYJDEgPSBmdW5jdGlvbiAoYW5jaG9yKSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnggKyBhbmNob3Iud2lkdGg7XG4gICAgfTtcbiAgICB2YXIgd2VzdFgkMSA9IGZ1bmN0aW9uIChhbmNob3IsIGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBhbmNob3IueCAtIGVsZW1lbnQud2lkdGg7XG4gICAgfTtcbiAgICB2YXIgbm9ydGhZJDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnkgLSBlbGVtZW50LmhlaWdodCArIGFuY2hvci5oZWlnaHQ7XG4gICAgfTtcbiAgICB2YXIgc291dGhZJDEgPSBmdW5jdGlvbiAoYW5jaG9yKSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnk7XG4gICAgfTtcbiAgICB2YXIgc291dGhlYXN0JDIgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyhlYXN0WCQxKGFuY2hvciksIHNvdXRoWSQxKGFuY2hvciksIGJ1YmJsZXMuc291dGhlYXN0KCksIHNvdXRoZWFzdCgpLCBib3VuZHNSZXN0cmljdGlvbihhbmNob3IsIHtcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgdG9wOiAyXG4gICAgICB9KSwgJ2xpbmstbGF5b3V0LXNlJyk7XG4gICAgfTtcbiAgICB2YXIgc291dGh3ZXN0JDIgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyh3ZXN0WCQxKGFuY2hvciwgZWxlbWVudCksIHNvdXRoWSQxKGFuY2hvciksIGJ1YmJsZXMuc291dGh3ZXN0KCksIHNvdXRod2VzdCgpLCBib3VuZHNSZXN0cmljdGlvbihhbmNob3IsIHtcbiAgICAgICAgcmlnaHQ6IDEsXG4gICAgICAgIHRvcDogMlxuICAgICAgfSksICdsaW5rLWxheW91dC1zdycpO1xuICAgIH07XG4gICAgdmFyIG5vcnRoZWFzdCQyID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCwgYnViYmxlcykge1xuICAgICAgcmV0dXJuIG51JDcoZWFzdFgkMShhbmNob3IpLCBub3J0aFkkMShhbmNob3IsIGVsZW1lbnQpLCBidWJibGVzLm5vcnRoZWFzdCgpLCBub3J0aGVhc3QoKSwgYm91bmRzUmVzdHJpY3Rpb24oYW5jaG9yLCB7XG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIGJvdHRvbTogM1xuICAgICAgfSksICdsaW5rLWxheW91dC1uZScpO1xuICAgIH07XG4gICAgdmFyIG5vcnRod2VzdCQyID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCwgYnViYmxlcykge1xuICAgICAgcmV0dXJuIG51JDcod2VzdFgkMShhbmNob3IsIGVsZW1lbnQpLCBub3J0aFkkMShhbmNob3IsIGVsZW1lbnQpLCBidWJibGVzLm5vcnRod2VzdCgpLCBub3J0aHdlc3QoKSwgYm91bmRzUmVzdHJpY3Rpb24oYW5jaG9yLCB7XG4gICAgICAgIHJpZ2h0OiAxLFxuICAgICAgICBib3R0b206IDNcbiAgICAgIH0pLCAnbGluay1sYXlvdXQtbncnKTtcbiAgICB9O1xuICAgIHZhciBhbGwkMyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHNvdXRoZWFzdCQyLFxuICAgICAgICBzb3V0aHdlc3QkMixcbiAgICAgICAgbm9ydGhlYXN0JDIsXG4gICAgICAgIG5vcnRod2VzdCQyXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIGFsbFJ0bCQxID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgc291dGh3ZXN0JDIsXG4gICAgICAgIHNvdXRoZWFzdCQyLFxuICAgICAgICBub3J0aHdlc3QkMixcbiAgICAgICAgbm9ydGhlYXN0JDJcbiAgICAgIF07XG4gICAgfTtcblxuICAgIHZhciBwbGFjZW1lbnQkNCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHN1Ym1lbnVJbmZvLCBvcmlnaW4pIHtcbiAgICAgIHZhciBhbmNob3JCb3ggPSB0b0JveChvcmlnaW4sIHN1Ym1lbnVJbmZvLml0ZW0uZWxlbWVudCk7XG4gICAgICB2YXIgbGF5b3V0cyA9IGdldCRiKGNvbXBvbmVudC5lbGVtZW50LCBzdWJtZW51SW5mbywgYWxsJDMoKSwgYWxsUnRsJDEoKSwgYWxsJDMoKSwgYWxsUnRsJDEoKSwgT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKG51JDkoe1xuICAgICAgICBhbmNob3JCb3g6IGFuY2hvckJveCxcbiAgICAgICAgYnViYmxlOiBmYWxsYmFjaygpLFxuICAgICAgICBvdmVycmlkZXM6IHN1Ym1lbnVJbmZvLm92ZXJyaWRlcyxcbiAgICAgICAgbGF5b3V0czogbGF5b3V0cyxcbiAgICAgICAgcGxhY2VyOiBPcHRpb25hbC5ub25lKClcbiAgICAgIH0pKTtcbiAgICB9O1xuICAgIHZhciBTdWJtZW51QW5jaG9yID0gW1xuICAgICAgc3RyaWN0JDEoJ2l0ZW0nKSxcbiAgICAgIHNjaGVtYSQxKCksXG4gICAgICBkZWZhdWx0ZWQkMSgnb3ZlcnJpZGVzJywge30pLFxuICAgICAgb3V0cHV0KCdwbGFjZW1lbnQnLCBwbGFjZW1lbnQkNClcbiAgICBdO1xuXG4gICAgdmFyIEFuY2hvclNjaGVtYSA9IGNob29zZSQxKCdhbmNob3InLCB7XG4gICAgICBzZWxlY3Rpb246IFNlbGVjdGlvbkFuY2hvcixcbiAgICAgIG5vZGU6IE5vZGVBbmNob3IsXG4gICAgICBob3RzcG90OiBIb3RzcG90QW5jaG9yLFxuICAgICAgc3VibWVudTogU3VibWVudUFuY2hvcixcbiAgICAgIG1ha2VzaGlmdDogTWFrZXNoaWZ0QW5jaG9yXG4gICAgfSk7XG5cbiAgICB2YXIgZ2V0Rml4ZWRPcmlnaW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaHRtbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAgIHJldHVybiBmaXhlZCgwLCAwLCBodG1sLmNsaWVudFdpZHRoLCBodG1sLmNsaWVudEhlaWdodCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UmVsYXRpdmVPcmlnaW4gPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICB2YXIgcG9zaXRpb24gPSBhYnNvbHV0ZShjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICB2YXIgYm91bmRzID0gY29tcG9uZW50LmVsZW1lbnQuZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgcmV0dXJuIHJlbGF0aXZlKHBvc2l0aW9uLmxlZnQsIHBvc2l0aW9uLnRvcCwgYm91bmRzLndpZHRoLCBib3VuZHMuaGVpZ2h0KTtcbiAgICB9O1xuICAgIHZhciBwbGFjZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIG9yaWdpbiwgYW5jaG9yaW5nLCBnZXRCb3VuZHMsIHBsYWNlZSkge1xuICAgICAgdmFyIGFuY2hvciA9IGJveCQxKGFuY2hvcmluZy5hbmNob3JCb3gsIG9yaWdpbik7XG4gICAgICBzaW1wbGUoYW5jaG9yLCBwbGFjZWUuZWxlbWVudCwgYW5jaG9yaW5nLmJ1YmJsZSwgYW5jaG9yaW5nLmxheW91dHMsIGdldEJvdW5kcywgYW5jaG9yaW5nLm92ZXJyaWRlcyk7XG4gICAgfTtcbiAgICB2YXIgcG9zaXRpb24kMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHBvc0NvbmZpZywgcG9zU3RhdGUsIGFuY2hvciwgcGxhY2VlKSB7XG4gICAgICBwb3NpdGlvbldpdGhpbihjb21wb25lbnQsIHBvc0NvbmZpZywgcG9zU3RhdGUsIGFuY2hvciwgcGxhY2VlLCBPcHRpb25hbC5ub25lKCkpO1xuICAgIH07XG4gICAgdmFyIHBvc2l0aW9uV2l0aGluID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcG9zQ29uZmlnLCBwb3NTdGF0ZSwgYW5jaG9yLCBwbGFjZWUsIGJveEVsZW1lbnQpIHtcbiAgICAgIHZhciBib3VuZHNCb3ggPSBib3hFbGVtZW50Lm1hcChib3gpO1xuICAgICAgcmV0dXJuIHBvc2l0aW9uV2l0aGluQm91bmRzKGNvbXBvbmVudCwgcG9zQ29uZmlnLCBwb3NTdGF0ZSwgYW5jaG9yLCBwbGFjZWUsIGJvdW5kc0JveCk7XG4gICAgfTtcbiAgICB2YXIgcG9zaXRpb25XaXRoaW5Cb3VuZHMgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBwb3NDb25maWcsIHBvc1N0YXRlLCBhbmNob3IsIHBsYWNlZSwgYm91bmRzKSB7XG4gICAgICB2YXIgYW5jaG9yYWdlID0gYXNSYXdPckRpZSgncG9zaXRpb25pbmcgYW5jaG9yLmluZm8nLCBBbmNob3JTY2hlbWEsIGFuY2hvcik7XG4gICAgICBwcmVzZXJ2ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNldCQyKHBsYWNlZS5lbGVtZW50LCAncG9zaXRpb24nLCAnZml4ZWQnKTtcbiAgICAgICAgdmFyIG9sZFZpc2liaWxpdHkgPSBnZXRSYXcocGxhY2VlLmVsZW1lbnQsICd2aXNpYmlsaXR5Jyk7XG4gICAgICAgIHNldCQyKHBsYWNlZS5lbGVtZW50LCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgdmFyIG9yaWdpbiA9IHBvc0NvbmZpZy51c2VGaXhlZCgpID8gZ2V0Rml4ZWRPcmlnaW4oKSA6IGdldFJlbGF0aXZlT3JpZ2luKGNvbXBvbmVudCk7XG4gICAgICAgIHZhciBwbGFjZXIgPSBhbmNob3JhZ2UucGxhY2VtZW50O1xuICAgICAgICB2YXIgZ2V0Qm91bmRzID0gYm91bmRzLm1hcChjb25zdGFudCkub3IocG9zQ29uZmlnLmdldEJvdW5kcyk7XG4gICAgICAgIHBsYWNlcihjb21wb25lbnQsIGFuY2hvcmFnZSwgb3JpZ2luKS5lYWNoKGZ1bmN0aW9uIChhbmNob3JpbmcpIHtcbiAgICAgICAgICB2YXIgZG9QbGFjZSA9IGFuY2hvcmluZy5wbGFjZXIuZ2V0T3IocGxhY2UpO1xuICAgICAgICAgIGRvUGxhY2UoY29tcG9uZW50LCBvcmlnaW4sIGFuY2hvcmluZywgZ2V0Qm91bmRzLCBwbGFjZWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgb2xkVmlzaWJpbGl0eS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZW1vdmUkNihwbGFjZWUuZWxlbWVudCwgJ3Zpc2liaWxpdHknKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKHZpcykge1xuICAgICAgICAgIHNldCQyKHBsYWNlZS5lbGVtZW50LCAndmlzaWJpbGl0eScsIHZpcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZ2V0UmF3KHBsYWNlZS5lbGVtZW50LCAnbGVmdCcpLmlzTm9uZSgpICYmIGdldFJhdyhwbGFjZWUuZWxlbWVudCwgJ3RvcCcpLmlzTm9uZSgpICYmIGdldFJhdyhwbGFjZWUuZWxlbWVudCwgJ3JpZ2h0JykuaXNOb25lKCkgJiYgZ2V0UmF3KHBsYWNlZS5lbGVtZW50LCAnYm90dG9tJykuaXNOb25lKCkgJiYgZ2V0UmF3KHBsYWNlZS5lbGVtZW50LCAncG9zaXRpb24nKS5pcygnZml4ZWQnKSkge1xuICAgICAgICAgIHJlbW92ZSQ2KHBsYWNlZS5lbGVtZW50LCAncG9zaXRpb24nKTtcbiAgICAgICAgfVxuICAgICAgfSwgcGxhY2VlLmVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGdldE1vZGUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBwQ29uZmlnLCBfcFN0YXRlKSB7XG4gICAgICByZXR1cm4gcENvbmZpZy51c2VGaXhlZCgpID8gJ2ZpeGVkJyA6ICdhYnNvbHV0ZSc7XG4gICAgfTtcblxuICAgIHZhciBQb3NpdGlvbkFwaXMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uJDEsXG4gICAgICAgIHBvc2l0aW9uV2l0aGluOiBwb3NpdGlvbldpdGhpbixcbiAgICAgICAgcG9zaXRpb25XaXRoaW5Cb3VuZHM6IHBvc2l0aW9uV2l0aGluQm91bmRzLFxuICAgICAgICBnZXRNb2RlOiBnZXRNb2RlXG4gICAgfSk7XG5cbiAgICB2YXIgUG9zaXRpb25TY2hlbWEgPSBbXG4gICAgICBkZWZhdWx0ZWQkMSgndXNlRml4ZWQnLCBuZXZlciksXG4gICAgICBvcHRpb24oJ2dldEJvdW5kcycpXG4gICAgXTtcblxuICAgIHZhciBQb3NpdGlvbmluZyA9IGNyZWF0ZSQxKHtcbiAgICAgIGZpZWxkczogUG9zaXRpb25TY2hlbWEsXG4gICAgICBuYW1lOiAncG9zaXRpb25pbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVQb3NpdGlvbixcbiAgICAgIGFwaXM6IFBvc2l0aW9uQXBpc1xuICAgIH0pO1xuXG4gICAgdmFyIGZpcmVEZXRhY2hpbmcgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICBlbWl0KGNvbXBvbmVudCwgZGV0YWNoZWRGcm9tRG9tKCkpO1xuICAgICAgdmFyIGNoaWxkcmVuID0gY29tcG9uZW50LmNvbXBvbmVudHMoKTtcbiAgICAgIGVhY2goY2hpbGRyZW4sIGZpcmVEZXRhY2hpbmcpO1xuICAgIH07XG4gICAgdmFyIGZpcmVBdHRhY2hpbmcgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICB2YXIgY2hpbGRyZW4gPSBjb21wb25lbnQuY29tcG9uZW50cygpO1xuICAgICAgZWFjaChjaGlsZHJlbiwgZmlyZUF0dGFjaGluZyk7XG4gICAgICBlbWl0KGNvbXBvbmVudCwgYXR0YWNoZWRUb0RvbSgpKTtcbiAgICB9O1xuICAgIHZhciBhdHRhY2ggPSBmdW5jdGlvbiAocGFyZW50LCBjaGlsZCkge1xuICAgICAgYXBwZW5kKHBhcmVudC5lbGVtZW50LCBjaGlsZC5lbGVtZW50KTtcbiAgICB9O1xuICAgIHZhciBkZXRhY2hDaGlsZHJlbiA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIGVhY2goY29tcG9uZW50LmNvbXBvbmVudHMoKSwgZnVuY3Rpb24gKGNoaWxkQ29tcCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlKGNoaWxkQ29tcC5lbGVtZW50KTtcbiAgICAgIH0pO1xuICAgICAgZW1wdHkoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgY29tcG9uZW50LnN5bmNDb21wb25lbnRzKCk7XG4gICAgfTtcbiAgICB2YXIgcmVwbGFjZUNoaWxkcmVuID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgbmV3Q2hpbGRyZW4pIHtcbiAgICAgIHZhciBzdWJzID0gY29tcG9uZW50LmNvbXBvbmVudHMoKTtcbiAgICAgIGRldGFjaENoaWxkcmVuKGNvbXBvbmVudCk7XG4gICAgICB2YXIgZGVsZXRlZCA9IGRpZmZlcmVuY2Uoc3VicywgbmV3Q2hpbGRyZW4pO1xuICAgICAgZWFjaChkZWxldGVkLCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICBmaXJlRGV0YWNoaW5nKGNvbXApO1xuICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkucmVtb3ZlRnJvbVdvcmxkKGNvbXApO1xuICAgICAgfSk7XG4gICAgICBlYWNoKG5ld0NoaWxkcmVuLCBmdW5jdGlvbiAoY2hpbGRDb21wKSB7XG4gICAgICAgIGlmICghY2hpbGRDb21wLmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkuYWRkVG9Xb3JsZChjaGlsZENvbXApO1xuICAgICAgICAgIGF0dGFjaChjb21wb25lbnQsIGNoaWxkQ29tcCk7XG4gICAgICAgICAgaWYgKGluQm9keShjb21wb25lbnQuZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGZpcmVBdHRhY2hpbmcoY2hpbGRDb21wKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXR0YWNoKGNvbXBvbmVudCwgY2hpbGRDb21wKTtcbiAgICAgICAgfVxuICAgICAgICBjb21wb25lbnQuc3luY0NvbXBvbmVudHMoKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgYXR0YWNoJDEgPSBmdW5jdGlvbiAocGFyZW50LCBjaGlsZCkge1xuICAgICAgYXR0YWNoV2l0aChwYXJlbnQsIGNoaWxkLCBhcHBlbmQpO1xuICAgIH07XG4gICAgdmFyIGF0dGFjaFdpdGggPSBmdW5jdGlvbiAocGFyZW50LCBjaGlsZCwgaW5zZXJ0aW9uKSB7XG4gICAgICBwYXJlbnQuZ2V0U3lzdGVtKCkuYWRkVG9Xb3JsZChjaGlsZCk7XG4gICAgICBpbnNlcnRpb24ocGFyZW50LmVsZW1lbnQsIGNoaWxkLmVsZW1lbnQpO1xuICAgICAgaWYgKGluQm9keShwYXJlbnQuZWxlbWVudCkpIHtcbiAgICAgICAgZmlyZUF0dGFjaGluZyhjaGlsZCk7XG4gICAgICB9XG4gICAgICBwYXJlbnQuc3luY0NvbXBvbmVudHMoKTtcbiAgICB9O1xuICAgIHZhciBkb0RldGFjaCA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIGZpcmVEZXRhY2hpbmcoY29tcG9uZW50KTtcbiAgICAgIHJlbW92ZShjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkucmVtb3ZlRnJvbVdvcmxkKGNvbXBvbmVudCk7XG4gICAgfTtcbiAgICB2YXIgZGV0YWNoID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgdmFyIHBhcmVudCQxID0gcGFyZW50KGNvbXBvbmVudC5lbGVtZW50KS5iaW5kKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20ocCkudG9PcHRpb25hbCgpO1xuICAgICAgfSk7XG4gICAgICBkb0RldGFjaChjb21wb25lbnQpO1xuICAgICAgcGFyZW50JDEuZWFjaChmdW5jdGlvbiAocCkge1xuICAgICAgICBwLnN5bmNDb21wb25lbnRzKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkZXRhY2hDaGlsZHJlbiQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgdmFyIHN1YnMgPSBjb21wb25lbnQuY29tcG9uZW50cygpO1xuICAgICAgZWFjaChzdWJzLCBkb0RldGFjaCk7XG4gICAgICBlbXB0eShjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICBjb21wb25lbnQuc3luY0NvbXBvbmVudHMoKTtcbiAgICB9O1xuICAgIHZhciBhdHRhY2hTeXN0ZW0gPSBmdW5jdGlvbiAoZWxlbWVudCwgZ3VpU3lzdGVtKSB7XG4gICAgICBhdHRhY2hTeXN0ZW1XaXRoKGVsZW1lbnQsIGd1aVN5c3RlbSwgYXBwZW5kKTtcbiAgICB9O1xuICAgIHZhciBhdHRhY2hTeXN0ZW1BZnRlciA9IGZ1bmN0aW9uIChlbGVtZW50LCBndWlTeXN0ZW0pIHtcbiAgICAgIGF0dGFjaFN5c3RlbVdpdGgoZWxlbWVudCwgZ3VpU3lzdGVtLCBhZnRlcik7XG4gICAgfTtcbiAgICB2YXIgYXR0YWNoU3lzdGVtV2l0aCA9IGZ1bmN0aW9uIChlbGVtZW50LCBndWlTeXN0ZW0sIGluc2VydGVyKSB7XG4gICAgICBpbnNlcnRlcihlbGVtZW50LCBndWlTeXN0ZW0uZWxlbWVudCk7XG4gICAgICB2YXIgY2hpbGRyZW4kMSA9IGNoaWxkcmVuKGd1aVN5c3RlbS5lbGVtZW50KTtcbiAgICAgIGVhY2goY2hpbGRyZW4kMSwgZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgIGd1aVN5c3RlbS5nZXRCeURvbShjaGlsZCkuZWFjaChmaXJlQXR0YWNoaW5nKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRldGFjaFN5c3RlbSA9IGZ1bmN0aW9uIChndWlTeXN0ZW0pIHtcbiAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4oZ3VpU3lzdGVtLmVsZW1lbnQpO1xuICAgICAgZWFjaChjaGlsZHJlbiQxLCBmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgZ3VpU3lzdGVtLmdldEJ5RG9tKGNoaWxkKS5lYWNoKGZpcmVEZXRhY2hpbmcpO1xuICAgICAgfSk7XG4gICAgICByZW1vdmUoZ3VpU3lzdGVtLmVsZW1lbnQpO1xuICAgIH07XG5cbiAgICB2YXIgcmVidWlsZCA9IGZ1bmN0aW9uIChzYW5kYm94LCBzQ29uZmlnLCBzU3RhdGUsIGRhdGEpIHtcbiAgICAgIHNTdGF0ZS5nZXQoKS5lYWNoKGZ1bmN0aW9uIChfZGF0YSkge1xuICAgICAgICBkZXRhY2hDaGlsZHJlbiQxKHNhbmRib3gpO1xuICAgICAgfSk7XG4gICAgICB2YXIgcG9pbnQgPSBzQ29uZmlnLmdldEF0dGFjaFBvaW50KHNhbmRib3gpO1xuICAgICAgYXR0YWNoJDEocG9pbnQsIHNhbmRib3gpO1xuICAgICAgdmFyIGJ1aWx0ID0gc2FuZGJveC5nZXRTeXN0ZW0oKS5idWlsZChkYXRhKTtcbiAgICAgIGF0dGFjaCQxKHNhbmRib3gsIGJ1aWx0KTtcbiAgICAgIHNTdGF0ZS5zZXQoYnVpbHQpO1xuICAgICAgcmV0dXJuIGJ1aWx0O1xuICAgIH07XG4gICAgdmFyIG9wZW4gPSBmdW5jdGlvbiAoc2FuZGJveCwgc0NvbmZpZywgc1N0YXRlLCBkYXRhKSB7XG4gICAgICB2YXIgbmV3U3RhdGUgPSByZWJ1aWxkKHNhbmRib3gsIHNDb25maWcsIHNTdGF0ZSwgZGF0YSk7XG4gICAgICBzQ29uZmlnLm9uT3BlbihzYW5kYm94LCBuZXdTdGF0ZSk7XG4gICAgICByZXR1cm4gbmV3U3RhdGU7XG4gICAgfTtcbiAgICB2YXIgc2V0Q29udGVudCA9IGZ1bmN0aW9uIChzYW5kYm94LCBzQ29uZmlnLCBzU3RhdGUsIGRhdGEpIHtcbiAgICAgIHJldHVybiBzU3RhdGUuZ2V0KCkubWFwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJlYnVpbGQoc2FuZGJveCwgc0NvbmZpZywgc1N0YXRlLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG9wZW5XaGlsZUNsb2FrZWQgPSBmdW5jdGlvbiAoc2FuZGJveCwgc0NvbmZpZywgc1N0YXRlLCBkYXRhLCB0cmFuc2FjdGlvbikge1xuICAgICAgY2xvYWsoc2FuZGJveCwgc0NvbmZpZyk7XG4gICAgICBvcGVuKHNhbmRib3gsIHNDb25maWcsIHNTdGF0ZSwgZGF0YSk7XG4gICAgICB0cmFuc2FjdGlvbigpO1xuICAgICAgZGVjbG9hayhzYW5kYm94LCBzQ29uZmlnKTtcbiAgICB9O1xuICAgIHZhciBjbG9zZSA9IGZ1bmN0aW9uIChzYW5kYm94LCBzQ29uZmlnLCBzU3RhdGUpIHtcbiAgICAgIHNTdGF0ZS5nZXQoKS5lYWNoKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGRldGFjaENoaWxkcmVuJDEoc2FuZGJveCk7XG4gICAgICAgIGRldGFjaChzYW5kYm94KTtcbiAgICAgICAgc0NvbmZpZy5vbkNsb3NlKHNhbmRib3gsIGRhdGEpO1xuICAgICAgICBzU3RhdGUuY2xlYXIoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzT3BlbiA9IGZ1bmN0aW9uIChfc2FuZGJveCwgX3NDb25maWcsIHNTdGF0ZSkge1xuICAgICAgcmV0dXJuIHNTdGF0ZS5pc09wZW4oKTtcbiAgICB9O1xuICAgIHZhciBpc1BhcnRPZiQxID0gZnVuY3Rpb24gKHNhbmRib3gsIHNDb25maWcsIHNTdGF0ZSwgcXVlcnlFbGVtKSB7XG4gICAgICByZXR1cm4gaXNPcGVuKHNhbmRib3gsIHNDb25maWcsIHNTdGF0ZSkgJiYgc1N0YXRlLmdldCgpLmV4aXN0cyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gc0NvbmZpZy5pc1BhcnRPZihzYW5kYm94LCBkYXRhLCBxdWVyeUVsZW0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U3RhdGUgPSBmdW5jdGlvbiAoX3NhbmRib3gsIF9zQ29uZmlnLCBzU3RhdGUpIHtcbiAgICAgIHJldHVybiBzU3RhdGUuZ2V0KCk7XG4gICAgfTtcbiAgICB2YXIgc3RvcmUgPSBmdW5jdGlvbiAoc2FuZGJveCwgY3NzS2V5LCBhdHRyLCBuZXdWYWx1ZSkge1xuICAgICAgZ2V0UmF3KHNhbmRib3guZWxlbWVudCwgY3NzS2V5KS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVtb3ZlJDEoc2FuZGJveC5lbGVtZW50LCBhdHRyKTtcbiAgICAgIH0sIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHNldCQxKHNhbmRib3guZWxlbWVudCwgYXR0ciwgdik7XG4gICAgICB9KTtcbiAgICAgIHNldCQyKHNhbmRib3guZWxlbWVudCwgY3NzS2V5LCBuZXdWYWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgcmVzdG9yZSA9IGZ1bmN0aW9uIChzYW5kYm94LCBjc3NLZXksIGF0dHIpIHtcbiAgICAgIGdldE9wdChzYW5kYm94LmVsZW1lbnQsIGF0dHIpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlJDYoc2FuZGJveC5lbGVtZW50LCBjc3NLZXkpO1xuICAgICAgfSwgZnVuY3Rpb24gKG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybiBzZXQkMihzYW5kYm94LmVsZW1lbnQsIGNzc0tleSwgb2xkVmFsdWUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY2xvYWsgPSBmdW5jdGlvbiAoc2FuZGJveCwgc0NvbmZpZywgX3NTdGF0ZSkge1xuICAgICAgdmFyIHNpbmsgPSBzQ29uZmlnLmdldEF0dGFjaFBvaW50KHNhbmRib3gpO1xuICAgICAgc2V0JDIoc2FuZGJveC5lbGVtZW50LCAncG9zaXRpb24nLCBQb3NpdGlvbmluZy5nZXRNb2RlKHNpbmspKTtcbiAgICAgIHN0b3JlKHNhbmRib3gsICd2aXNpYmlsaXR5Jywgc0NvbmZpZy5jbG9ha1Zpc2liaWxpdHlBdHRyLCAnaGlkZGVuJyk7XG4gICAgfTtcbiAgICB2YXIgaGFzUG9zaXRpb24gPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGV4aXN0cyhbXG4gICAgICAgICd0b3AnLFxuICAgICAgICAnbGVmdCcsXG4gICAgICAgICdyaWdodCcsXG4gICAgICAgICdib3R0b20nXG4gICAgICBdLCBmdW5jdGlvbiAocG9zKSB7XG4gICAgICAgIHJldHVybiBnZXRSYXcoZWxlbWVudCwgcG9zKS5pc1NvbWUoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRlY2xvYWsgPSBmdW5jdGlvbiAoc2FuZGJveCwgc0NvbmZpZywgX3NTdGF0ZSkge1xuICAgICAgaWYgKCFoYXNQb3NpdGlvbihzYW5kYm94LmVsZW1lbnQpKSB7XG4gICAgICAgIHJlbW92ZSQ2KHNhbmRib3guZWxlbWVudCwgJ3Bvc2l0aW9uJyk7XG4gICAgICB9XG4gICAgICByZXN0b3JlKHNhbmRib3gsICd2aXNpYmlsaXR5Jywgc0NvbmZpZy5jbG9ha1Zpc2liaWxpdHlBdHRyKTtcbiAgICB9O1xuXG4gICAgdmFyIFNhbmRib3hBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGNsb2FrOiBjbG9hayxcbiAgICAgICAgZGVjbG9hazogZGVjbG9hayxcbiAgICAgICAgb3Blbjogb3BlbixcbiAgICAgICAgb3BlbldoaWxlQ2xvYWtlZDogb3BlbldoaWxlQ2xvYWtlZCxcbiAgICAgICAgY2xvc2U6IGNsb3NlLFxuICAgICAgICBpc09wZW46IGlzT3BlbixcbiAgICAgICAgaXNQYXJ0T2Y6IGlzUGFydE9mJDEsXG4gICAgICAgIGdldFN0YXRlOiBnZXRTdGF0ZSxcbiAgICAgICAgc2V0Q29udGVudDogc2V0Q29udGVudFxuICAgIH0pO1xuXG4gICAgdmFyIGV2ZW50cyQyID0gZnVuY3Rpb24gKHNhbmRib3hDb25maWcsIHNhbmRib3hTdGF0ZSkge1xuICAgICAgcmV0dXJuIGRlcml2ZShbcnVuKHNhbmRib3hDbG9zZSgpLCBmdW5jdGlvbiAoc2FuZGJveCwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgY2xvc2Uoc2FuZGJveCwgc2FuZGJveENvbmZpZywgc2FuZGJveFN0YXRlKTtcbiAgICAgICAgfSldKTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZVNhbmRib3ggPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkMlxuICAgIH0pO1xuXG4gICAgdmFyIFNhbmRib3hTY2hlbWEgPSBbXG4gICAgICBvbkhhbmRsZXIoJ29uT3BlbicpLFxuICAgICAgb25IYW5kbGVyKCdvbkNsb3NlJyksXG4gICAgICBzdHJpY3QkMSgnaXNQYXJ0T2YnKSxcbiAgICAgIHN0cmljdCQxKCdnZXRBdHRhY2hQb2ludCcpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2Nsb2FrVmlzaWJpbGl0eUF0dHInLCAnZGF0YS1wcmVjbG9hay12aXNpYmlsaXR5JylcbiAgICBdO1xuXG4gICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY29udGVudHMgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgcmVhZFN0YXRlID0gY29uc3RhbnQoJ25vdC1pbXBsZW1lbnRlZCcpO1xuICAgICAgdmFyIGlzT3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnRzLmdldCgpLmlzU29tZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICBjb250ZW50cy5zZXQoT3B0aW9uYWwuc29tZShjb21wKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnRzLmdldCgpO1xuICAgICAgfTtcbiAgICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29udGVudHMuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG51JDUoe1xuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZSxcbiAgICAgICAgaXNPcGVuOiBpc09wZW4sXG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGdldDogZ2V0XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIFNhbmRib3hTdGF0ZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBpbml0OiBpbml0XG4gICAgfSk7XG5cbiAgICB2YXIgU2FuZGJveGluZyA9IGNyZWF0ZSQxKHtcbiAgICAgIGZpZWxkczogU2FuZGJveFNjaGVtYSxcbiAgICAgIG5hbWU6ICdzYW5kYm94aW5nJyxcbiAgICAgIGFjdGl2ZTogQWN0aXZlU2FuZGJveCxcbiAgICAgIGFwaXM6IFNhbmRib3hBcGlzLFxuICAgICAgc3RhdGU6IFNhbmRib3hTdGF0ZVxuICAgIH0pO1xuXG4gICAgdmFyIGRpc21pc3NQb3B1cHMgPSBjb25zdGFudCgnZGlzbWlzcy5wb3B1cHMnKTtcbiAgICB2YXIgcmVwb3NpdGlvblBvcHVwcyA9IGNvbnN0YW50KCdyZXBvc2l0aW9uLnBvcHVwcycpO1xuICAgIHZhciBtb3VzZVJlbGVhc2VkID0gY29uc3RhbnQoJ21vdXNlLnJlbGVhc2VkJyk7XG5cbiAgICB2YXIgc2NoZW1hJDIgPSBvYmpPZk9ubHkoW1xuICAgICAgZGVmYXVsdGVkJDEoJ2lzRXh0cmFQYXJ0JywgbmV2ZXIpLFxuICAgICAgb3B0aW9uT2JqT2YoJ2ZpcmVFdmVudEluc3RlYWQnLCBbZGVmYXVsdGVkJDEoJ2V2ZW50JywgZGlzbWlzc1JlcXVlc3RlZCgpKV0pXG4gICAgXSk7XG4gICAgdmFyIHJlY2VpdmluZ0NoYW5uZWwgPSBmdW5jdGlvbiAocmF3U3BlYykge1xuICAgICAgdmFyIF9hO1xuICAgICAgdmFyIGRldGFpbCA9IGFzUmF3T3JEaWUoJ0Rpc21pc3NhbCcsIHNjaGVtYSQyLCByYXdTcGVjKTtcbiAgICAgIHJldHVybiBfYSA9IHt9LCBfYVtkaXNtaXNzUG9wdXBzKCldID0ge1xuICAgICAgICBzY2hlbWE6IG9iak9mT25seShbc3RyaWN0JDEoJ3RhcmdldCcpXSksXG4gICAgICAgIG9uUmVjZWl2ZTogZnVuY3Rpb24gKHNhbmRib3gsIGRhdGEpIHtcbiAgICAgICAgICBpZiAoU2FuZGJveGluZy5pc09wZW4oc2FuZGJveCkpIHtcbiAgICAgICAgICAgIHZhciBpc1BhcnQgPSBTYW5kYm94aW5nLmlzUGFydE9mKHNhbmRib3gsIGRhdGEudGFyZ2V0KSB8fCBkZXRhaWwuaXNFeHRyYVBhcnQoc2FuZGJveCwgZGF0YS50YXJnZXQpO1xuICAgICAgICAgICAgaWYgKCFpc1BhcnQpIHtcbiAgICAgICAgICAgICAgZGV0YWlsLmZpcmVFdmVudEluc3RlYWQuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFNhbmRib3hpbmcuY2xvc2Uoc2FuZGJveCk7XG4gICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChmZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbWl0KHNhbmRib3gsIGZlLmV2ZW50KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCBfYTtcbiAgICB9O1xuXG4gICAgdmFyIHNjaGVtYSQzID0gb2JqT2ZPbmx5KFtcbiAgICAgIG9wdGlvbk9iak9mKCdmaXJlRXZlbnRJbnN0ZWFkJywgW2RlZmF1bHRlZCQxKCdldmVudCcsIHJlcG9zaXRpb25SZXF1ZXN0ZWQoKSldKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdkb1JlcG9zaXRpb24nKVxuICAgIF0pO1xuICAgIHZhciByZWNlaXZpbmdDaGFubmVsJDEgPSBmdW5jdGlvbiAocmF3U3BlYykge1xuICAgICAgdmFyIF9hO1xuICAgICAgdmFyIGRldGFpbCA9IGFzUmF3T3JEaWUoJ1JlcG9zaXRpb24nLCBzY2hlbWEkMywgcmF3U3BlYyk7XG4gICAgICByZXR1cm4gX2EgPSB7fSwgX2FbcmVwb3NpdGlvblBvcHVwcygpXSA9IHtcbiAgICAgICAgb25SZWNlaXZlOiBmdW5jdGlvbiAoc2FuZGJveCkge1xuICAgICAgICAgIGlmIChTYW5kYm94aW5nLmlzT3BlbihzYW5kYm94KSkge1xuICAgICAgICAgICAgZGV0YWlsLmZpcmVFdmVudEluc3RlYWQuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkZXRhaWwuZG9SZXBvc2l0aW9uKHNhbmRib3gpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGZlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBlbWl0KHNhbmRib3gsIGZlLmV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgX2E7XG4gICAgfTtcblxuICAgIHZhciBvbkxvYWQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCByZXBDb25maWcsIHJlcFN0YXRlKSB7XG4gICAgICByZXBDb25maWcuc3RvcmUubWFuYWdlci5vbkxvYWQoY29tcG9uZW50LCByZXBDb25maWcsIHJlcFN0YXRlKTtcbiAgICB9O1xuICAgIHZhciBvblVubG9hZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUpIHtcbiAgICAgIHJlcENvbmZpZy5zdG9yZS5tYW5hZ2VyLm9uVW5sb2FkKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgc2V0VmFsdWUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCByZXBDb25maWcsIHJlcFN0YXRlLCBkYXRhKSB7XG4gICAgICByZXBDb25maWcuc3RvcmUubWFuYWdlci5zZXRWYWx1ZShjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUsIGRhdGEpO1xuICAgIH07XG4gICAgdmFyIGdldFZhbHVlID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSkge1xuICAgICAgcmV0dXJuIHJlcENvbmZpZy5zdG9yZS5tYW5hZ2VyLmdldFZhbHVlKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U3RhdGUkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUpIHtcbiAgICAgIHJldHVybiByZXBTdGF0ZTtcbiAgICB9O1xuXG4gICAgdmFyIFJlcHJlc2VudEFwaXMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgb25Mb2FkOiBvbkxvYWQsXG4gICAgICAgIG9uVW5sb2FkOiBvblVubG9hZCxcbiAgICAgICAgc2V0VmFsdWU6IHNldFZhbHVlLFxuICAgICAgICBnZXRWYWx1ZTogZ2V0VmFsdWUsXG4gICAgICAgIGdldFN0YXRlOiBnZXRTdGF0ZSQxXG4gICAgfSk7XG5cbiAgICB2YXIgZXZlbnRzJDMgPSBmdW5jdGlvbiAocmVwQ29uZmlnLCByZXBTdGF0ZSkge1xuICAgICAgdmFyIGVzID0gcmVwQ29uZmlnLnJlc2V0T25Eb20gPyBbXG4gICAgICAgIHJ1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgIG9uTG9hZChjb21wLCByZXBDb25maWcsIHJlcFN0YXRlKTtcbiAgICAgICAgfSksXG4gICAgICAgIHJ1bk9uRGV0YWNoZWQoZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgIG9uVW5sb2FkKGNvbXAsIHJlcENvbmZpZywgcmVwU3RhdGUpO1xuICAgICAgICB9KVxuICAgICAgXSA6IFtsb2FkRXZlbnQocmVwQ29uZmlnLCByZXBTdGF0ZSwgb25Mb2FkKV07XG4gICAgICByZXR1cm4gZGVyaXZlKGVzKTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZVJlcHJlc2VudGluZyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBldmVudHM6IGV2ZW50cyQzXG4gICAgfSk7XG5cbiAgICB2YXIgbWVtb3J5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRhdGEgPSBDZWxsKG51bGwpO1xuICAgICAgdmFyIHJlYWRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RlOiAnbWVtb3J5JyxcbiAgICAgICAgICB2YWx1ZTogZGF0YS5nZXQoKVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBpc05vdFNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEuZ2V0KCkgPT09IG51bGw7XG4gICAgICB9O1xuICAgICAgdmFyIGNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBkYXRhLnNldChudWxsKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbnUkNSh7XG4gICAgICAgIHNldDogZGF0YS5zZXQsXG4gICAgICAgIGdldDogZGF0YS5nZXQsXG4gICAgICAgIGlzTm90U2V0OiBpc05vdFNldCxcbiAgICAgICAgY2xlYXI6IGNsZWFyLFxuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWFudWFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJlYWRTdGF0ZSA9IG5vb3A7XG4gICAgICByZXR1cm4gbnUkNSh7IHJlYWRTdGF0ZTogcmVhZFN0YXRlIH0pO1xuICAgIH07XG4gICAgdmFyIGRhdGFzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZGF0YUJ5VmFsdWUgPSBDZWxsKHt9KTtcbiAgICAgIHZhciBkYXRhQnlUZXh0ID0gQ2VsbCh7fSk7XG4gICAgICB2YXIgcmVhZFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGU6ICdkYXRhc2V0JyxcbiAgICAgICAgICBkYXRhQnlWYWx1ZTogZGF0YUJ5VmFsdWUuZ2V0KCksXG4gICAgICAgICAgZGF0YUJ5VGV4dDogZGF0YUJ5VGV4dC5nZXQoKVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGF0YUJ5VmFsdWUuc2V0KHt9KTtcbiAgICAgICAgZGF0YUJ5VGV4dC5zZXQoe30pO1xuICAgICAgfTtcbiAgICAgIHZhciBsb29rdXAgPSBmdW5jdGlvbiAoaXRlbVN0cmluZykge1xuICAgICAgICByZXR1cm4gZ2V0JDEoZGF0YUJ5VmFsdWUuZ2V0KCksIGl0ZW1TdHJpbmcpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXQkMShkYXRhQnlUZXh0LmdldCgpLCBpdGVtU3RyaW5nKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICB2YXIgY3VycmVudERhdGFCeVZhbHVlID0gZGF0YUJ5VmFsdWUuZ2V0KCk7XG4gICAgICAgIHZhciBjdXJyZW50RGF0YUJ5VGV4dCA9IGRhdGFCeVRleHQuZ2V0KCk7XG4gICAgICAgIHZhciBuZXdEYXRhQnlWYWx1ZSA9IHt9O1xuICAgICAgICB2YXIgbmV3RGF0YUJ5VGV4dCA9IHt9O1xuICAgICAgICBlYWNoKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIG5ld0RhdGFCeVZhbHVlW2l0ZW0udmFsdWVdID0gaXRlbTtcbiAgICAgICAgICBnZXQkMShpdGVtLCAnbWV0YScpLmVhY2goZnVuY3Rpb24gKG1ldGEpIHtcbiAgICAgICAgICAgIGdldCQxKG1ldGEsICd0ZXh0JykuZWFjaChmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICAgICAgICBuZXdEYXRhQnlUZXh0W3RleHRdID0gaXRlbTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YUJ5VmFsdWUuc2V0KF9fYXNzaWduKF9fYXNzaWduKHt9LCBjdXJyZW50RGF0YUJ5VmFsdWUpLCBuZXdEYXRhQnlWYWx1ZSkpO1xuICAgICAgICBkYXRhQnlUZXh0LnNldChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgY3VycmVudERhdGFCeVRleHQpLCBuZXdEYXRhQnlUZXh0KSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG51JDUoe1xuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZSxcbiAgICAgICAgbG9va3VwOiBsb29rdXAsXG4gICAgICAgIHVwZGF0ZTogdXBkYXRlLFxuICAgICAgICBjbGVhcjogY2xlYXJcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGluaXQkMSA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gc3BlYy5zdG9yZS5tYW5hZ2VyLnN0YXRlKHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgUmVwcmVzZW50U3RhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgbWVtb3J5OiBtZW1vcnksXG4gICAgICAgIGRhdGFzZXQ6IGRhdGFzZXQsXG4gICAgICAgIG1hbnVhbDogbWFudWFsLFxuICAgICAgICBpbml0OiBpbml0JDFcbiAgICB9KTtcblxuICAgIHZhciBzZXRWYWx1ZSQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSwgZGF0YSkge1xuICAgICAgdmFyIHN0b3JlID0gcmVwQ29uZmlnLnN0b3JlO1xuICAgICAgcmVwU3RhdGUudXBkYXRlKFtkYXRhXSk7XG4gICAgICBzdG9yZS5zZXRWYWx1ZShjb21wb25lbnQsIGRhdGEpO1xuICAgICAgcmVwQ29uZmlnLm9uU2V0VmFsdWUoY29tcG9uZW50LCBkYXRhKTtcbiAgICB9O1xuICAgIHZhciBnZXRWYWx1ZSQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSkge1xuICAgICAgdmFyIHN0b3JlID0gcmVwQ29uZmlnLnN0b3JlO1xuICAgICAgdmFyIGtleSA9IHN0b3JlLmdldERhdGFLZXkoY29tcG9uZW50KTtcbiAgICAgIHJldHVybiByZXBTdGF0ZS5sb29rdXAoa2V5KS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHN0b3JlLmdldEZhbGxiYWNrRW50cnkoa2V5KTtcbiAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgb25Mb2FkJDEgPSBmdW5jdGlvbiAoY29tcG9uZW50LCByZXBDb25maWcsIHJlcFN0YXRlKSB7XG4gICAgICB2YXIgc3RvcmUgPSByZXBDb25maWcuc3RvcmU7XG4gICAgICBzdG9yZS5pbml0aWFsVmFsdWUuZWFjaChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBzZXRWYWx1ZSQxKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSwgZGF0YSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvblVubG9hZCQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwQ29uZmlnLCByZXBTdGF0ZSkge1xuICAgICAgcmVwU3RhdGUuY2xlYXIoKTtcbiAgICB9O1xuICAgIHZhciBEYXRhc2V0U3RvcmUgPSBbXG4gICAgICBvcHRpb24oJ2luaXRpYWxWYWx1ZScpLFxuICAgICAgc3RyaWN0JDEoJ2dldEZhbGxiYWNrRW50cnknKSxcbiAgICAgIHN0cmljdCQxKCdnZXREYXRhS2V5JyksXG4gICAgICBzdHJpY3QkMSgnc2V0VmFsdWUnKSxcbiAgICAgIG91dHB1dCgnbWFuYWdlcicsIHtcbiAgICAgICAgc2V0VmFsdWU6IHNldFZhbHVlJDEsXG4gICAgICAgIGdldFZhbHVlOiBnZXRWYWx1ZSQxLFxuICAgICAgICBvbkxvYWQ6IG9uTG9hZCQxLFxuICAgICAgICBvblVubG9hZDogb25VbmxvYWQkMSxcbiAgICAgICAgc3RhdGU6IGRhdGFzZXRcbiAgICAgIH0pXG4gICAgXTtcblxuICAgIHZhciBnZXRWYWx1ZSQyID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwQ29uZmlnLCBfcmVwU3RhdGUpIHtcbiAgICAgIHJldHVybiByZXBDb25maWcuc3RvcmUuZ2V0VmFsdWUoY29tcG9uZW50KTtcbiAgICB9O1xuICAgIHZhciBzZXRWYWx1ZSQyID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwQ29uZmlnLCBfcmVwU3RhdGUsIGRhdGEpIHtcbiAgICAgIHJlcENvbmZpZy5zdG9yZS5zZXRWYWx1ZShjb21wb25lbnQsIGRhdGEpO1xuICAgICAgcmVwQ29uZmlnLm9uU2V0VmFsdWUoY29tcG9uZW50LCBkYXRhKTtcbiAgICB9O1xuICAgIHZhciBvbkxvYWQkMiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgX3JlcFN0YXRlKSB7XG4gICAgICByZXBDb25maWcuc3RvcmUuaW5pdGlhbFZhbHVlLmVhY2goZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgcmVwQ29uZmlnLnN0b3JlLnNldFZhbHVlKGNvbXBvbmVudCwgZGF0YSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBNYW51YWxTdG9yZSA9IFtcbiAgICAgIHN0cmljdCQxKCdnZXRWYWx1ZScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3NldFZhbHVlJywgbm9vcCksXG4gICAgICBvcHRpb24oJ2luaXRpYWxWYWx1ZScpLFxuICAgICAgb3V0cHV0KCdtYW5hZ2VyJywge1xuICAgICAgICBzZXRWYWx1ZTogc2V0VmFsdWUkMixcbiAgICAgICAgZ2V0VmFsdWU6IGdldFZhbHVlJDIsXG4gICAgICAgIG9uTG9hZDogb25Mb2FkJDIsXG4gICAgICAgIG9uVW5sb2FkOiBub29wLFxuICAgICAgICBzdGF0ZTogTm9TdGF0ZS5pbml0XG4gICAgICB9KVxuICAgIF07XG5cbiAgICB2YXIgc2V0VmFsdWUkMyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUsIGRhdGEpIHtcbiAgICAgIHJlcFN0YXRlLnNldChkYXRhKTtcbiAgICAgIHJlcENvbmZpZy5vblNldFZhbHVlKGNvbXBvbmVudCwgZGF0YSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VmFsdWUkMyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUpIHtcbiAgICAgIHJldHVybiByZXBTdGF0ZS5nZXQoKTtcbiAgICB9O1xuICAgIHZhciBvbkxvYWQkMyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUpIHtcbiAgICAgIHJlcENvbmZpZy5zdG9yZS5pbml0aWFsVmFsdWUuZWFjaChmdW5jdGlvbiAoaW5pdFZhbCkge1xuICAgICAgICBpZiAocmVwU3RhdGUuaXNOb3RTZXQoKSkge1xuICAgICAgICAgIHJlcFN0YXRlLnNldChpbml0VmFsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgb25VbmxvYWQkMiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcENvbmZpZywgcmVwU3RhdGUpIHtcbiAgICAgIHJlcFN0YXRlLmNsZWFyKCk7XG4gICAgfTtcbiAgICB2YXIgTWVtb3J5U3RvcmUgPSBbXG4gICAgICBvcHRpb24oJ2luaXRpYWxWYWx1ZScpLFxuICAgICAgb3V0cHV0KCdtYW5hZ2VyJywge1xuICAgICAgICBzZXRWYWx1ZTogc2V0VmFsdWUkMyxcbiAgICAgICAgZ2V0VmFsdWU6IGdldFZhbHVlJDMsXG4gICAgICAgIG9uTG9hZDogb25Mb2FkJDMsXG4gICAgICAgIG9uVW5sb2FkOiBvblVubG9hZCQyLFxuICAgICAgICBzdGF0ZTogbWVtb3J5XG4gICAgICB9KVxuICAgIF07XG5cbiAgICB2YXIgUmVwcmVzZW50U2NoZW1hID0gW1xuICAgICAgZGVmYXVsdGVkT2YoJ3N0b3JlJywgeyBtb2RlOiAnbWVtb3J5JyB9LCBjaG9vc2UkMSgnbW9kZScsIHtcbiAgICAgICAgbWVtb3J5OiBNZW1vcnlTdG9yZSxcbiAgICAgICAgbWFudWFsOiBNYW51YWxTdG9yZSxcbiAgICAgICAgZGF0YXNldDogRGF0YXNldFN0b3JlXG4gICAgICB9KSksXG4gICAgICBvbkhhbmRsZXIoJ29uU2V0VmFsdWUnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdyZXNldE9uRG9tJywgZmFsc2UpXG4gICAgXTtcblxuICAgIHZhciBSZXByZXNlbnRpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IFJlcHJlc2VudFNjaGVtYSxcbiAgICAgIG5hbWU6ICdyZXByZXNlbnRpbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVSZXByZXNlbnRpbmcsXG4gICAgICBhcGlzOiBSZXByZXNlbnRBcGlzLFxuICAgICAgZXh0cmE6IHtcbiAgICAgICAgc2V0VmFsdWVGcm9tOiBmdW5jdGlvbiAoY29tcG9uZW50LCBzb3VyY2UpIHtcbiAgICAgICAgICB2YXIgdmFsdWUgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoc291cmNlKTtcbiAgICAgICAgICBSZXByZXNlbnRpbmcuc2V0VmFsdWUoY29tcG9uZW50LCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzdGF0ZTogUmVwcmVzZW50U3RhdGVcbiAgICB9KTtcblxuICAgIHZhciBmaWVsZCQxID0gZnVuY3Rpb24gKG5hbWUsIGZvcmJpZGRlbikge1xuICAgICAgcmV0dXJuIGRlZmF1bHRlZE9iak9mKG5hbWUsIHt9LCBtYXAoZm9yYmlkZGVuLCBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZm9yYmlkKGYubmFtZSgpLCAnQ2Fubm90IGNvbmZpZ3VyZSAnICsgZi5uYW1lKCkgKyAnIGZvciAnICsgbmFtZSk7XG4gICAgICB9KS5jb25jYXQoW3N0YXRlJDEoJ2R1bXAnLCBpZGVudGl0eSldKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0JGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgcmV0dXJuIGRhdGEuZHVtcDtcbiAgICB9O1xuICAgIHZhciBhdWdtZW50ID0gZnVuY3Rpb24gKGRhdGEsIG9yaWdpbmFsKSB7XG4gICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIGRhdGEuZHVtcCksIGRlcml2ZSQxKG9yaWdpbmFsKSk7XG4gICAgfTtcbiAgICB2YXIgU2tldGNoQmVoYXZpb3VycyA9IHtcbiAgICAgIGZpZWxkOiBmaWVsZCQxLFxuICAgICAgYXVnbWVudDogYXVnbWVudCxcbiAgICAgIGdldDogZ2V0JGRcbiAgICB9O1xuXG4gICAgdmFyIF9wbGFjZWhvbGRlciA9ICdwbGFjZWhvbGRlcic7XG4gICAgdmFyIGFkdCQ5ID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHtcbiAgICAgICAgc2luZ2xlOiBbXG4gICAgICAgICAgJ3JlcXVpcmVkJyxcbiAgICAgICAgICAndmFsdWVUaHVuaydcbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbXVsdGlwbGU6IFtcbiAgICAgICAgICAncmVxdWlyZWQnLFxuICAgICAgICAgICd2YWx1ZVRodW5rcydcbiAgICAgICAgXVxuICAgICAgfVxuICAgIF0pO1xuICAgIHZhciBpc1N1YnN0aXR1dGVkID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBoYXMoc3BlYywgJ3VpVHlwZScpO1xuICAgIH07XG4gICAgdmFyIHN1YlBsYWNlaG9sZGVyID0gZnVuY3Rpb24gKG93bmVyLCBkZXRhaWwsIGNvbXBTcGVjLCBwbGFjZWhvbGRlcnMpIHtcbiAgICAgIGlmIChvd25lci5leGlzdHMoZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICByZXR1cm4gbyAhPT0gY29tcFNwZWMub3duZXI7XG4gICAgICAgIH0pKSB7XG4gICAgICAgIHJldHVybiBhZHQkOS5zaW5nbGUodHJ1ZSwgY29uc3RhbnQoY29tcFNwZWMpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBnZXQkMShwbGFjZWhvbGRlcnMsIGNvbXBTcGVjLm5hbWUpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gcGxhY2Vob2xkZXIgY29tcG9uZW50OiAnICsgY29tcFNwZWMubmFtZSArICdcXG5Lbm93bjogWycgKyBrZXlzKHBsYWNlaG9sZGVycykgKyAnXVxcbk5hbWVzcGFjZTogJyArIG93bmVyLmdldE9yKCdub25lJykgKyAnXFxuU3BlYzogJyArIEpTT04uc3RyaW5naWZ5KGNvbXBTcGVjLCBudWxsLCAyKSk7XG4gICAgICB9LCBmdW5jdGlvbiAobmV3U3BlYykge1xuICAgICAgICByZXR1cm4gbmV3U3BlYy5yZXBsYWNlKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzY2FuID0gZnVuY3Rpb24gKG93bmVyLCBkZXRhaWwsIGNvbXBTcGVjLCBwbGFjZWhvbGRlcnMpIHtcbiAgICAgIGlmIChpc1N1YnN0aXR1dGVkKGNvbXBTcGVjKSAmJiBjb21wU3BlYy51aVR5cGUgPT09IF9wbGFjZWhvbGRlcikge1xuICAgICAgICByZXR1cm4gc3ViUGxhY2Vob2xkZXIob3duZXIsIGRldGFpbCwgY29tcFNwZWMsIHBsYWNlaG9sZGVycyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYWR0JDkuc2luZ2xlKGZhbHNlLCBjb25zdGFudChjb21wU3BlYykpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHN1YnN0aXR1dGUgPSBmdW5jdGlvbiAob3duZXIsIGRldGFpbCwgY29tcFNwZWMsIHBsYWNlaG9sZGVycykge1xuICAgICAgdmFyIGJhc2UgPSBzY2FuKG93bmVyLCBkZXRhaWwsIGNvbXBTcGVjLCBwbGFjZWhvbGRlcnMpO1xuICAgICAgcmV0dXJuIGJhc2UuZm9sZChmdW5jdGlvbiAocmVxLCB2YWx1ZVRodW5rKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGlzU3Vic3RpdHV0ZWQoY29tcFNwZWMpID8gdmFsdWVUaHVuayhkZXRhaWwsIGNvbXBTcGVjLmNvbmZpZywgY29tcFNwZWMudmFsaWRhdGVkKSA6IHZhbHVlVGh1bmsoZGV0YWlsKTtcbiAgICAgICAgdmFyIGNoaWxkU3BlY3MgPSBnZXQkMSh2YWx1ZSwgJ2NvbXBvbmVudHMnKS5nZXRPcihbXSk7XG4gICAgICAgIHZhciBzdWJzdGl0dXRlZCA9IGJpbmQoY2hpbGRTcGVjcywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICByZXR1cm4gc3Vic3RpdHV0ZShvd25lciwgZGV0YWlsLCBjLCBwbGFjZWhvbGRlcnMpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFtfX2Fzc2lnbihfX2Fzc2lnbih7fSwgdmFsdWUpLCB7IGNvbXBvbmVudHM6IHN1YnN0aXR1dGVkIH0pXTtcbiAgICAgIH0sIGZ1bmN0aW9uIChyZXEsIHZhbHVlc1RodW5rKSB7XG4gICAgICAgIGlmIChpc1N1YnN0aXR1dGVkKGNvbXBTcGVjKSkge1xuICAgICAgICAgIHZhciB2YWx1ZXMgPSB2YWx1ZXNUaHVuayhkZXRhaWwsIGNvbXBTcGVjLmNvbmZpZywgY29tcFNwZWMudmFsaWRhdGVkKTtcbiAgICAgICAgICB2YXIgcHJlcHJvY2Vzc29yID0gY29tcFNwZWMudmFsaWRhdGVkLnByZXByb2Nlc3MuZ2V0T3IoaWRlbnRpdHkpO1xuICAgICAgICAgIHJldHVybiBwcmVwcm9jZXNzb3IodmFsdWVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWVzVGh1bmsoZGV0YWlsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc3Vic3RpdHV0ZUFsbCA9IGZ1bmN0aW9uIChvd25lciwgZGV0YWlsLCBjb21wb25lbnRzLCBwbGFjZWhvbGRlcnMpIHtcbiAgICAgIHJldHVybiBiaW5kKGNvbXBvbmVudHMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHJldHVybiBzdWJzdGl0dXRlKG93bmVyLCBkZXRhaWwsIGMsIHBsYWNlaG9sZGVycyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvbmVSZXBsYWNlID0gZnVuY3Rpb24gKGxhYmVsLCByZXBsYWNlbWVudHMpIHtcbiAgICAgIHZhciBjYWxsZWQgPSBmYWxzZTtcbiAgICAgIHZhciB1c2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2FsbGVkO1xuICAgICAgfTtcbiAgICAgIHZhciByZXBsYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2FsbGVkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcnlpbmcgdG8gdXNlIHRoZSBzYW1lIHBsYWNlaG9sZGVyIG1vcmUgdGhhbiBvbmNlOiAnICsgbGFiZWwpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiByZXBsYWNlbWVudHM7XG4gICAgICB9O1xuICAgICAgdmFyIHJlcXVpcmVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVwbGFjZW1lbnRzLmZvbGQoZnVuY3Rpb24gKHJlcSwgXykge1xuICAgICAgICAgIHJldHVybiByZXE7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChyZXEsIF8pIHtcbiAgICAgICAgICByZXR1cm4gcmVxO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBjb25zdGFudChsYWJlbCksXG4gICAgICAgIHJlcXVpcmVkOiByZXF1aXJlZCxcbiAgICAgICAgdXNlZDogdXNlZCxcbiAgICAgICAgcmVwbGFjZTogcmVwbGFjZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzdWJzdGl0dXRlUGxhY2VzID0gZnVuY3Rpb24gKG93bmVyLCBkZXRhaWwsIGNvbXBvbmVudHMsIHBsYWNlaG9sZGVycykge1xuICAgICAgdmFyIHBzID0gbWFwJDIocGxhY2Vob2xkZXJzLCBmdW5jdGlvbiAocGgsIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIG9uZVJlcGxhY2UobmFtZSwgcGgpO1xuICAgICAgfSk7XG4gICAgICB2YXIgb3V0Y29tZSA9IHN1YnN0aXR1dGVBbGwob3duZXIsIGRldGFpbCwgY29tcG9uZW50cywgcHMpO1xuICAgICAgZWFjaCQxKHBzLCBmdW5jdGlvbiAocCkge1xuICAgICAgICBpZiAocC51c2VkKCkgPT09IGZhbHNlICYmIHAucmVxdWlyZWQoKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGxhY2Vob2xkZXI6ICcgKyBwLm5hbWUoKSArICcgd2FzIG5vdCBmb3VuZCBpbiBjb21wb25lbnRzIGxpc3RcXG5OYW1lc3BhY2U6ICcgKyBvd25lci5nZXRPcignbm9uZScpICsgJ1xcbkNvbXBvbmVudHM6ICcgKyBKU09OLnN0cmluZ2lmeShkZXRhaWwuY29tcG9uZW50cywgbnVsbCwgMikpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvdXRjb21lO1xuICAgIH07XG4gICAgdmFyIHNpbmdsZSA9IGFkdCQ5LnNpbmdsZTtcbiAgICB2YXIgbXVsdGlwbGUgPSBhZHQkOS5tdWx0aXBsZTtcbiAgICB2YXIgcGxhY2Vob2xkZXIgPSBjb25zdGFudChfcGxhY2Vob2xkZXIpO1xuXG4gICAgdmFyIGFkdCRhID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHsgcmVxdWlyZWQ6IFsnZGF0YSddIH0sXG4gICAgICB7IGV4dGVybmFsOiBbJ2RhdGEnXSB9LFxuICAgICAgeyBvcHRpb25hbDogWydkYXRhJ10gfSxcbiAgICAgIHsgZ3JvdXA6IFsnZGF0YSddIH1cbiAgICBdKTtcbiAgICB2YXIgZkZhY3RvcnkgPSBkZWZhdWx0ZWQkMSgnZmFjdG9yeScsIHsgc2tldGNoOiBpZGVudGl0eSB9KTtcbiAgICB2YXIgZlNjaGVtYSA9IGRlZmF1bHRlZCQxKCdzY2hlbWEnLCBbXSk7XG4gICAgdmFyIGZOYW1lID0gc3RyaWN0JDEoJ25hbWUnKTtcbiAgICB2YXIgZlBuYW1lID0gZmllbGQoJ3BuYW1lJywgJ3BuYW1lJywgZGVmYXVsdGVkVGh1bmsoZnVuY3Rpb24gKHR5cGVTcGVjKSB7XG4gICAgICByZXR1cm4gJzxhbGxveS4nICsgZ2VuZXJhdGUkMSh0eXBlU3BlYy5uYW1lKSArICc+JztcbiAgICB9KSwgYW55VmFsdWUkMSgpKTtcbiAgICB2YXIgZkdyb3VwU2NoZW1hID0gc3RhdGUkMSgnc2NoZW1hJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFtvcHRpb24oJ3ByZXByb2Nlc3MnKV07XG4gICAgfSk7XG4gICAgdmFyIGZEZWZhdWx0cyA9IGRlZmF1bHRlZCQxKCdkZWZhdWx0cycsIGNvbnN0YW50KHt9KSk7XG4gICAgdmFyIGZPdmVycmlkZXMgPSBkZWZhdWx0ZWQkMSgnb3ZlcnJpZGVzJywgY29uc3RhbnQoe30pKTtcbiAgICB2YXIgcmVxdWlyZWRTcGVjID0gb2JqT2YoW1xuICAgICAgZkZhY3RvcnksXG4gICAgICBmU2NoZW1hLFxuICAgICAgZk5hbWUsXG4gICAgICBmUG5hbWUsXG4gICAgICBmRGVmYXVsdHMsXG4gICAgICBmT3ZlcnJpZGVzXG4gICAgXSk7XG4gICAgdmFyIGV4dGVybmFsU3BlYyA9IG9iak9mKFtcbiAgICAgIGZGYWN0b3J5LFxuICAgICAgZlNjaGVtYSxcbiAgICAgIGZOYW1lLFxuICAgICAgZkRlZmF1bHRzLFxuICAgICAgZk92ZXJyaWRlc1xuICAgIF0pO1xuICAgIHZhciBvcHRpb25hbFNwZWMgPSBvYmpPZihbXG4gICAgICBmRmFjdG9yeSxcbiAgICAgIGZTY2hlbWEsXG4gICAgICBmTmFtZSxcbiAgICAgIGZQbmFtZSxcbiAgICAgIGZEZWZhdWx0cyxcbiAgICAgIGZPdmVycmlkZXNcbiAgICBdKTtcbiAgICB2YXIgZ3JvdXBTcGVjID0gb2JqT2YoW1xuICAgICAgZkZhY3RvcnksXG4gICAgICBmR3JvdXBTY2hlbWEsXG4gICAgICBmTmFtZSxcbiAgICAgIHN0cmljdCQxKCd1bml0JyksXG4gICAgICBmUG5hbWUsXG4gICAgICBmRGVmYXVsdHMsXG4gICAgICBmT3ZlcnJpZGVzXG4gICAgXSk7XG4gICAgdmFyIGFzTmFtZWRQYXJ0ID0gZnVuY3Rpb24gKHBhcnQpIHtcbiAgICAgIHJldHVybiBwYXJ0LmZvbGQoT3B0aW9uYWwuc29tZSwgT3B0aW9uYWwubm9uZSwgT3B0aW9uYWwuc29tZSwgT3B0aW9uYWwuc29tZSk7XG4gICAgfTtcbiAgICB2YXIgbmFtZSQxID0gZnVuY3Rpb24gKHBhcnQpIHtcbiAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gZGF0YS5uYW1lO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBwYXJ0LmZvbGQoZ2V0LCBnZXQsIGdldCwgZ2V0KTtcbiAgICB9O1xuICAgIHZhciBhc0NvbW1vbiA9IGZ1bmN0aW9uIChwYXJ0KSB7XG4gICAgICByZXR1cm4gcGFydC5mb2xkKGlkZW50aXR5LCBpZGVudGl0eSwgaWRlbnRpdHksIGlkZW50aXR5KTtcbiAgICB9O1xuICAgIHZhciBjb252ZXJ0ID0gZnVuY3Rpb24gKGFkdENvbnN0cnVjdG9yLCBwYXJ0U2NoZW1hKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBhc1Jhd09yRGllKCdDb252ZXJ0aW5nIHBhcnQgdHlwZScsIHBhcnRTY2hlbWEsIHNwZWMpO1xuICAgICAgICByZXR1cm4gYWR0Q29uc3RydWN0b3IoZGF0YSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlcXVpcmVkID0gY29udmVydChhZHQkYS5yZXF1aXJlZCwgcmVxdWlyZWRTcGVjKTtcbiAgICB2YXIgZXh0ZXJuYWwkMSA9IGNvbnZlcnQoYWR0JGEuZXh0ZXJuYWwsIGV4dGVybmFsU3BlYyk7XG4gICAgdmFyIG9wdGlvbmFsID0gY29udmVydChhZHQkYS5vcHRpb25hbCwgb3B0aW9uYWxTcGVjKTtcbiAgICB2YXIgZ3JvdXAgPSBjb252ZXJ0KGFkdCRhLmdyb3VwLCBncm91cFNwZWMpO1xuICAgIHZhciBvcmlnaW5hbCA9IGNvbnN0YW50KCdlbnRpcmV0eScpO1xuXG4gICAgdmFyIFBhcnRUeXBlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIHJlcXVpcmVkOiByZXF1aXJlZCxcbiAgICAgICAgZXh0ZXJuYWw6IGV4dGVybmFsJDEsXG4gICAgICAgIG9wdGlvbmFsOiBvcHRpb25hbCxcbiAgICAgICAgZ3JvdXA6IGdyb3VwLFxuICAgICAgICBhc05hbWVkUGFydDogYXNOYW1lZFBhcnQsXG4gICAgICAgIG5hbWU6IG5hbWUkMSxcbiAgICAgICAgYXNDb21tb246IGFzQ29tbW9uLFxuICAgICAgICBvcmlnaW5hbDogb3JpZ2luYWxcbiAgICB9KTtcblxuICAgIHZhciBjb21iaW5lJDIgPSBmdW5jdGlvbiAoZGV0YWlsLCBkYXRhLCBwYXJ0U3BlYywgcGFydFZhbGlkYXRlZCkge1xuICAgICAgcmV0dXJuIGRlZXBNZXJnZShkYXRhLmRlZmF1bHRzKGRldGFpbCwgcGFydFNwZWMsIHBhcnRWYWxpZGF0ZWQpLCBwYXJ0U3BlYywgeyB1aWQ6IGRldGFpbC5wYXJ0VWlkc1tkYXRhLm5hbWVdIH0sIGRhdGEub3ZlcnJpZGVzKGRldGFpbCwgcGFydFNwZWMsIHBhcnRWYWxpZGF0ZWQpKTtcbiAgICB9O1xuICAgIHZhciBzdWJzID0gZnVuY3Rpb24gKG93bmVyLCBkZXRhaWwsIHBhcnRzKSB7XG4gICAgICB2YXIgaW50ZXJuYWxzID0ge307XG4gICAgICB2YXIgZXh0ZXJuYWxzID0ge307XG4gICAgICBlYWNoKHBhcnRzLCBmdW5jdGlvbiAocGFydCkge1xuICAgICAgICBwYXJ0LmZvbGQoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpbnRlcm5hbHNbZGF0YS5wbmFtZV0gPSBzaW5nbGUodHJ1ZSwgZnVuY3Rpb24gKGRldGFpbCwgcGFydFNwZWMsIHBhcnRWYWxpZGF0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhLmZhY3Rvcnkuc2tldGNoKGNvbWJpbmUkMihkZXRhaWwsIGRhdGEsIHBhcnRTcGVjLCBwYXJ0VmFsaWRhdGVkKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgdmFyIHBhcnRTcGVjID0gZGV0YWlsLnBhcnRzW2RhdGEubmFtZV07XG4gICAgICAgICAgZXh0ZXJuYWxzW2RhdGEubmFtZV0gPSBjb25zdGFudChkYXRhLmZhY3Rvcnkuc2tldGNoKGNvbWJpbmUkMihkZXRhaWwsIGRhdGEsIHBhcnRTcGVjW29yaWdpbmFsKCldKSwgcGFydFNwZWMpKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpbnRlcm5hbHNbZGF0YS5wbmFtZV0gPSBzaW5nbGUoZmFsc2UsIGZ1bmN0aW9uIChkZXRhaWwsIHBhcnRTcGVjLCBwYXJ0VmFsaWRhdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5mYWN0b3J5LnNrZXRjaChjb21iaW5lJDIoZGV0YWlsLCBkYXRhLCBwYXJ0U3BlYywgcGFydFZhbGlkYXRlZCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIGludGVybmFsc1tkYXRhLnBuYW1lXSA9IG11bHRpcGxlKHRydWUsIGZ1bmN0aW9uIChkZXRhaWwsIF9wYXJ0U3BlYywgX3BhcnRWYWxpZGF0ZWQpIHtcbiAgICAgICAgICAgIHZhciB1bml0cyA9IGRldGFpbFtkYXRhLm5hbWVdO1xuICAgICAgICAgICAgcmV0dXJuIG1hcCh1bml0cywgZnVuY3Rpb24gKHUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuZmFjdG9yeS5za2V0Y2goZGVlcE1lcmdlKGRhdGEuZGVmYXVsdHMoZGV0YWlsLCB1LCBfcGFydFZhbGlkYXRlZCksIHUsIGRhdGEub3ZlcnJpZGVzKGRldGFpbCwgdSkpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaW50ZXJuYWxzOiBjb25zdGFudChpbnRlcm5hbHMpLFxuICAgICAgICBleHRlcm5hbHM6IGNvbnN0YW50KGV4dGVybmFscylcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBnZW5lcmF0ZSQ0ID0gZnVuY3Rpb24gKG93bmVyLCBwYXJ0cykge1xuICAgICAgdmFyIHIgPSB7fTtcbiAgICAgIGVhY2gocGFydHMsIGZ1bmN0aW9uIChwYXJ0KSB7XG4gICAgICAgIGFzTmFtZWRQYXJ0KHBhcnQpLmVhY2goZnVuY3Rpb24gKG5wKSB7XG4gICAgICAgICAgdmFyIGcgPSBkb0dlbmVyYXRlT25lKG93bmVyLCBucC5wbmFtZSk7XG4gICAgICAgICAgcltucC5uYW1lXSA9IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgICAgIHZhciB2YWxpZGF0ZWQgPSBhc1Jhd09yRGllKCdQYXJ0OiAnICsgbnAubmFtZSArICcgaW4gJyArIG93bmVyLCBvYmpPZihucC5zY2hlbWEpLCBjb25maWcpO1xuICAgICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBnKSwge1xuICAgICAgICAgICAgICBjb25maWc6IGNvbmZpZyxcbiAgICAgICAgICAgICAgdmFsaWRhdGVkOiB2YWxpZGF0ZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBkb0dlbmVyYXRlT25lID0gZnVuY3Rpb24gKG93bmVyLCBwbmFtZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlUeXBlOiBwbGFjZWhvbGRlcigpLFxuICAgICAgICBvd25lcjogb3duZXIsXG4gICAgICAgIG5hbWU6IHBuYW1lXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdlbmVyYXRlT25lID0gZnVuY3Rpb24gKG93bmVyLCBwbmFtZSwgY29uZmlnKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aVR5cGU6IHBsYWNlaG9sZGVyKCksXG4gICAgICAgIG93bmVyOiBvd25lcixcbiAgICAgICAgbmFtZTogcG5hbWUsXG4gICAgICAgIGNvbmZpZzogY29uZmlnLFxuICAgICAgICB2YWxpZGF0ZWQ6IHt9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNjaGVtYXMgPSBmdW5jdGlvbiAocGFydHMpIHtcbiAgICAgIHJldHVybiBiaW5kKHBhcnRzLCBmdW5jdGlvbiAocGFydCkge1xuICAgICAgICByZXR1cm4gcGFydC5mb2xkKE9wdGlvbmFsLm5vbmUsIE9wdGlvbmFsLnNvbWUsIE9wdGlvbmFsLm5vbmUsIE9wdGlvbmFsLm5vbmUpLm1hcChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHJldHVybiBzdHJpY3RPYmpPZihkYXRhLm5hbWUsIGRhdGEuc2NoZW1hLmNvbmNhdChbc25hcHNob3Qob3JpZ2luYWwoKSldKSk7XG4gICAgICAgIH0pLnRvQXJyYXkoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG5hbWVzID0gZnVuY3Rpb24gKHBhcnRzKSB7XG4gICAgICByZXR1cm4gbWFwKHBhcnRzLCBuYW1lJDEpO1xuICAgIH07XG4gICAgdmFyIHN1YnN0aXR1dGVzID0gZnVuY3Rpb24gKG93bmVyLCBkZXRhaWwsIHBhcnRzKSB7XG4gICAgICByZXR1cm4gc3Vicyhvd25lciwgZGV0YWlsLCBwYXJ0cyk7XG4gICAgfTtcbiAgICB2YXIgY29tcG9uZW50cyA9IGZ1bmN0aW9uIChvd25lciwgZGV0YWlsLCBpbnRlcm5hbHMpIHtcbiAgICAgIHJldHVybiBzdWJzdGl0dXRlUGxhY2VzKE9wdGlvbmFsLnNvbWUob3duZXIpLCBkZXRhaWwsIGRldGFpbC5jb21wb25lbnRzLCBpbnRlcm5hbHMpO1xuICAgIH07XG4gICAgdmFyIGdldFBhcnQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkZXRhaWwsIHBhcnRLZXkpIHtcbiAgICAgIHZhciB1aWQgPSBkZXRhaWwucGFydFVpZHNbcGFydEtleV07XG4gICAgICByZXR1cm4gY29tcG9uZW50LmdldFN5c3RlbSgpLmdldEJ5VWlkKHVpZCkudG9PcHRpb25hbCgpO1xuICAgIH07XG4gICAgdmFyIGdldFBhcnRPckRpZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGRldGFpbCwgcGFydEtleSkge1xuICAgICAgcmV0dXJuIGdldFBhcnQoY29tcG9uZW50LCBkZXRhaWwsIHBhcnRLZXkpLmdldE9yRGllKCdDb3VsZCBub3QgZmluZCBwYXJ0OiAnICsgcGFydEtleSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UGFydHMgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkZXRhaWwsIHBhcnRLZXlzKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgdmFyIHVpZHMgPSBkZXRhaWwucGFydFVpZHM7XG4gICAgICB2YXIgc3lzdGVtID0gY29tcG9uZW50LmdldFN5c3RlbSgpO1xuICAgICAgZWFjaChwYXJ0S2V5cywgZnVuY3Rpb24gKHBrKSB7XG4gICAgICAgIHJbcGtdID0gY29uc3RhbnQoc3lzdGVtLmdldEJ5VWlkKHVpZHNbcGtdKSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGdldEFsbFBhcnRzID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZGV0YWlsKSB7XG4gICAgICB2YXIgc3lzdGVtID0gY29tcG9uZW50LmdldFN5c3RlbSgpO1xuICAgICAgcmV0dXJuIG1hcCQyKGRldGFpbC5wYXJ0VWlkcywgZnVuY3Rpb24gKHBVaWQsIF9rKSB7XG4gICAgICAgIHJldHVybiBjb25zdGFudChzeXN0ZW0uZ2V0QnlVaWQocFVpZCkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0QWxsUGFydE5hbWVzID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIGtleXMoZGV0YWlsLnBhcnRVaWRzKTtcbiAgICB9O1xuICAgIHZhciBnZXRQYXJ0c09yRGllID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZGV0YWlsLCBwYXJ0S2V5cykge1xuICAgICAgdmFyIHIgPSB7fTtcbiAgICAgIHZhciB1aWRzID0gZGV0YWlsLnBhcnRVaWRzO1xuICAgICAgdmFyIHN5c3RlbSA9IGNvbXBvbmVudC5nZXRTeXN0ZW0oKTtcbiAgICAgIGVhY2gocGFydEtleXMsIGZ1bmN0aW9uIChwaykge1xuICAgICAgICByW3BrXSA9IGNvbnN0YW50KHN5c3RlbS5nZXRCeVVpZCh1aWRzW3BrXSkuZ2V0T3JEaWUoKSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRVaWRzID0gZnVuY3Rpb24gKGJhc2VVaWQsIHBhcnRUeXBlcykge1xuICAgICAgdmFyIHBhcnROYW1lcyA9IG5hbWVzKHBhcnRUeXBlcyk7XG4gICAgICByZXR1cm4gd3JhcEFsbCQxKG1hcChwYXJ0TmFtZXMsIGZ1bmN0aW9uIChwbikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGtleTogcG4sXG4gICAgICAgICAgdmFsdWU6IGJhc2VVaWQgKyAnLScgKyBwblxuICAgICAgICB9O1xuICAgICAgfSkpO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRVaWRzU2NoZW1hID0gZnVuY3Rpb24gKHBhcnRUeXBlcykge1xuICAgICAgcmV0dXJuIGZpZWxkKCdwYXJ0VWlkcycsICdwYXJ0VWlkcycsIG1lcmdlV2l0aFRodW5rKGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0VWlkcyhzcGVjLnVpZCwgcGFydFR5cGVzKTtcbiAgICAgIH0pLCBhbnlWYWx1ZSQxKCkpO1xuICAgIH07XG5cbiAgICB2YXIgQWxsb3lQYXJ0cyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkNCxcbiAgICAgICAgZ2VuZXJhdGVPbmU6IGdlbmVyYXRlT25lLFxuICAgICAgICBzY2hlbWFzOiBzY2hlbWFzLFxuICAgICAgICBuYW1lczogbmFtZXMsXG4gICAgICAgIHN1YnN0aXR1dGVzOiBzdWJzdGl0dXRlcyxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcbiAgICAgICAgZGVmYXVsdFVpZHM6IGRlZmF1bHRVaWRzLFxuICAgICAgICBkZWZhdWx0VWlkc1NjaGVtYTogZGVmYXVsdFVpZHNTY2hlbWEsXG4gICAgICAgIGdldEFsbFBhcnRzOiBnZXRBbGxQYXJ0cyxcbiAgICAgICAgZ2V0QWxsUGFydE5hbWVzOiBnZXRBbGxQYXJ0TmFtZXMsXG4gICAgICAgIGdldFBhcnQ6IGdldFBhcnQsXG4gICAgICAgIGdldFBhcnRPckRpZTogZ2V0UGFydE9yRGllLFxuICAgICAgICBnZXRQYXJ0czogZ2V0UGFydHMsXG4gICAgICAgIGdldFBhcnRzT3JEaWU6IGdldFBhcnRzT3JEaWVcbiAgICB9KTtcblxuICAgIHZhciBiYXNlID0gZnVuY3Rpb24gKHBhcnRTY2hlbWFzLCBwYXJ0VWlkc1NjaGVtYXMpIHtcbiAgICAgIHZhciBwcyA9IHBhcnRTY2hlbWFzLmxlbmd0aCA+IDAgPyBbc3RyaWN0T2JqT2YoJ3BhcnRzJywgcGFydFNjaGVtYXMpXSA6IFtdO1xuICAgICAgcmV0dXJuIHBzLmNvbmNhdChbXG4gICAgICAgIHN0cmljdCQxKCd1aWQnKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2RvbScsIHt9KSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2NvbXBvbmVudHMnLCBbXSksXG4gICAgICAgIHNuYXBzaG90KCdvcmlnaW5hbFNwZWMnKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2RlYnVnLnNrZXRjaGVyJywge30pXG4gICAgICBdKS5jb25jYXQocGFydFVpZHNTY2hlbWFzKTtcbiAgICB9O1xuICAgIHZhciBhc1Jhd09yRGllJDEgPSBmdW5jdGlvbiAobGFiZWwsIHNjaGVtYSwgc3BlYywgcGFydFNjaGVtYXMsIHBhcnRVaWRzU2NoZW1hcykge1xuICAgICAgdmFyIGJhc2VTID0gYmFzZShwYXJ0U2NoZW1hcywgcGFydFVpZHNTY2hlbWFzKTtcbiAgICAgIHJldHVybiBhc1Jhd09yRGllKGxhYmVsICsgJyBbU3BlY1NjaGVtYV0nLCBvYmpPZk9ubHkoYmFzZVMuY29uY2F0KHNjaGVtYSkpLCBzcGVjKTtcbiAgICB9O1xuXG4gICAgdmFyIHNpbmdsZSQxID0gZnVuY3Rpb24gKG93bmVyLCBzY2hlbWEsIGZhY3RvcnksIHNwZWMpIHtcbiAgICAgIHZhciBzcGVjV2l0aFVpZCA9IHN1cHBseVVpZChzcGVjKTtcbiAgICAgIHZhciBkZXRhaWwgPSBhc1Jhd09yRGllJDEob3duZXIsIHNjaGVtYSwgc3BlY1dpdGhVaWQsIFtdLCBbXSk7XG4gICAgICByZXR1cm4gZmFjdG9yeShkZXRhaWwsIHNwZWNXaXRoVWlkKTtcbiAgICB9O1xuICAgIHZhciBjb21wb3NpdGUgPSBmdW5jdGlvbiAob3duZXIsIHNjaGVtYSwgcGFydFR5cGVzLCBmYWN0b3J5LCBzcGVjKSB7XG4gICAgICB2YXIgc3BlY1dpdGhVaWQgPSBzdXBwbHlVaWQoc3BlYyk7XG4gICAgICB2YXIgcGFydFNjaGVtYXMgPSBzY2hlbWFzKHBhcnRUeXBlcyk7XG4gICAgICB2YXIgcGFydFVpZHNTY2hlbWEgPSBkZWZhdWx0VWlkc1NjaGVtYShwYXJ0VHlwZXMpO1xuICAgICAgdmFyIGRldGFpbCA9IGFzUmF3T3JEaWUkMShvd25lciwgc2NoZW1hLCBzcGVjV2l0aFVpZCwgcGFydFNjaGVtYXMsIFtwYXJ0VWlkc1NjaGVtYV0pO1xuICAgICAgdmFyIHN1YnMgPSBzdWJzdGl0dXRlcyhvd25lciwgZGV0YWlsLCBwYXJ0VHlwZXMpO1xuICAgICAgdmFyIGNvbXBvbmVudHMkMSA9IGNvbXBvbmVudHMob3duZXIsIGRldGFpbCwgc3Vicy5pbnRlcm5hbHMoKSk7XG4gICAgICByZXR1cm4gZmFjdG9yeShkZXRhaWwsIGNvbXBvbmVudHMkMSwgc3BlY1dpdGhVaWQsIHN1YnMuZXh0ZXJuYWxzKCkpO1xuICAgIH07XG4gICAgdmFyIGhhc1VpZCA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gaGFzKHNwZWMsICd1aWQnKTtcbiAgICB9O1xuICAgIHZhciBzdXBwbHlVaWQgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGhhc1VpZChzcGVjKSA/IHNwZWMgOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3BlYyksIHsgdWlkOiBnZW5lcmF0ZSQyKCd1aWQnKSB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGlzU2tldGNoU3BlYyA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gc3BlYy51aWQgIT09IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHZhciBzaW5nbGVTY2hlbWEgPSBvYmpPZk9ubHkoW1xuICAgICAgc3RyaWN0JDEoJ25hbWUnKSxcbiAgICAgIHN0cmljdCQxKCdmYWN0b3J5JyksXG4gICAgICBzdHJpY3QkMSgnY29uZmlnRmllbGRzJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnYXBpcycsIHt9KSxcbiAgICAgIGRlZmF1bHRlZCQxKCdleHRyYUFwaXMnLCB7fSlcbiAgICBdKTtcbiAgICB2YXIgY29tcG9zaXRlU2NoZW1hID0gb2JqT2ZPbmx5KFtcbiAgICAgIHN0cmljdCQxKCduYW1lJyksXG4gICAgICBzdHJpY3QkMSgnZmFjdG9yeScpLFxuICAgICAgc3RyaWN0JDEoJ2NvbmZpZ0ZpZWxkcycpLFxuICAgICAgc3RyaWN0JDEoJ3BhcnRGaWVsZHMnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdhcGlzJywge30pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2V4dHJhQXBpcycsIHt9KVxuICAgIF0pO1xuICAgIHZhciBzaW5nbGUkMiA9IGZ1bmN0aW9uIChyYXdDb25maWcpIHtcbiAgICAgIHZhciBjb25maWcgPSBhc1Jhd09yRGllKCdTa2V0Y2hlciBmb3IgJyArIHJhd0NvbmZpZy5uYW1lLCBzaW5nbGVTY2hlbWEsIHJhd0NvbmZpZyk7XG4gICAgICB2YXIgc2tldGNoID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgICAgcmV0dXJuIHNpbmdsZSQxKGNvbmZpZy5uYW1lLCBjb25maWcuY29uZmlnRmllbGRzLCBjb25maWcuZmFjdG9yeSwgc3BlYyk7XG4gICAgICB9O1xuICAgICAgdmFyIGFwaXMgPSBtYXAkMihjb25maWcuYXBpcywgbWFrZUFwaSk7XG4gICAgICB2YXIgZXh0cmFBcGlzID0gbWFwJDIoY29uZmlnLmV4dHJhQXBpcywgZnVuY3Rpb24gKGYsIGspIHtcbiAgICAgICAgcmV0dXJuIG1hcmtBc0V4dHJhQXBpKGYsIGspO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe1xuICAgICAgICBuYW1lOiBjb25maWcubmFtZSxcbiAgICAgICAgY29uZmlnRmllbGRzOiBjb25maWcuY29uZmlnRmllbGRzLFxuICAgICAgICBza2V0Y2g6IHNrZXRjaFxuICAgICAgfSwgYXBpcyksIGV4dHJhQXBpcyk7XG4gICAgfTtcbiAgICB2YXIgY29tcG9zaXRlJDEgPSBmdW5jdGlvbiAocmF3Q29uZmlnKSB7XG4gICAgICB2YXIgY29uZmlnID0gYXNSYXdPckRpZSgnU2tldGNoZXIgZm9yICcgKyByYXdDb25maWcubmFtZSwgY29tcG9zaXRlU2NoZW1hLCByYXdDb25maWcpO1xuICAgICAgdmFyIHNrZXRjaCA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgIHJldHVybiBjb21wb3NpdGUoY29uZmlnLm5hbWUsIGNvbmZpZy5jb25maWdGaWVsZHMsIGNvbmZpZy5wYXJ0RmllbGRzLCBjb25maWcuZmFjdG9yeSwgc3BlYyk7XG4gICAgICB9O1xuICAgICAgdmFyIHBhcnRzID0gZ2VuZXJhdGUkNChjb25maWcubmFtZSwgY29uZmlnLnBhcnRGaWVsZHMpO1xuICAgICAgdmFyIGFwaXMgPSBtYXAkMihjb25maWcuYXBpcywgbWFrZUFwaSk7XG4gICAgICB2YXIgZXh0cmFBcGlzID0gbWFwJDIoY29uZmlnLmV4dHJhQXBpcywgZnVuY3Rpb24gKGYsIGspIHtcbiAgICAgICAgcmV0dXJuIG1hcmtBc0V4dHJhQXBpKGYsIGspO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe1xuICAgICAgICBuYW1lOiBjb25maWcubmFtZSxcbiAgICAgICAgcGFydEZpZWxkczogY29uZmlnLnBhcnRGaWVsZHMsXG4gICAgICAgIGNvbmZpZ0ZpZWxkczogY29uZmlnLmNvbmZpZ0ZpZWxkcyxcbiAgICAgICAgc2tldGNoOiBza2V0Y2gsXG4gICAgICAgIHBhcnRzOiBwYXJ0c1xuICAgICAgfSwgYXBpcyksIGV4dHJhQXBpcyk7XG4gICAgfTtcblxuICAgIHZhciBjYXQgPSBmdW5jdGlvbiAoYXJyKSB7XG4gICAgICB2YXIgciA9IFtdO1xuICAgICAgdmFyIHB1c2ggPSBmdW5jdGlvbiAoeCkge1xuICAgICAgICByLnB1c2goeCk7XG4gICAgICB9O1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXJyW2ldLmVhY2gocHVzaCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBzZXF1ZW5jZSA9IGZ1bmN0aW9uIChhcnIpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgeCA9IGFycltpXTtcbiAgICAgICAgaWYgKHguaXNTb21lKCkpIHtcbiAgICAgICAgICByLnB1c2goeC5nZXRPckRpZSgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShyKTtcbiAgICB9O1xuICAgIHZhciBsaWZ0MiA9IGZ1bmN0aW9uIChvYSwgb2IsIGYpIHtcbiAgICAgIHJldHVybiBvYS5pc1NvbWUoKSAmJiBvYi5pc1NvbWUoKSA/IE9wdGlvbmFsLnNvbWUoZihvYS5nZXRPckRpZSgpLCBvYi5nZXRPckRpZSgpKSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgbGlmdDMgPSBmdW5jdGlvbiAob2EsIG9iLCBvYywgZikge1xuICAgICAgcmV0dXJuIG9hLmlzU29tZSgpICYmIG9iLmlzU29tZSgpICYmIG9jLmlzU29tZSgpID8gT3B0aW9uYWwuc29tZShmKG9hLmdldE9yRGllKCksIG9iLmdldE9yRGllKCksIG9jLmdldE9yRGllKCkpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBtYXBGcm9tID0gZnVuY3Rpb24gKGEsIGYpIHtcbiAgICAgIHJldHVybiBhICE9PSB1bmRlZmluZWQgJiYgYSAhPT0gbnVsbCA/IE9wdGlvbmFsLnNvbWUoZihhKSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgc29tZUlmID0gZnVuY3Rpb24gKGIsIGEpIHtcbiAgICAgIHJldHVybiBiID8gT3B0aW9uYWwuc29tZShhKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuXG4gICAgdmFyIGluc2lkZSA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIHJldHVybiBuYW1lKHRhcmdldCkgPT09ICdpbnB1dCcgJiYgZ2V0JDModGFyZ2V0LCAndHlwZScpICE9PSAncmFkaW8nIHx8IG5hbWUodGFyZ2V0KSA9PT0gJ3RleHRhcmVhJztcbiAgICB9O1xuXG4gICAgdmFyIGdldEN1cnJlbnQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb21wb3NlQ29uZmlnLCBfY29tcG9zZVN0YXRlKSB7XG4gICAgICByZXR1cm4gY29tcG9zZUNvbmZpZy5maW5kKGNvbXBvbmVudCk7XG4gICAgfTtcblxuICAgIHZhciBDb21wb3NlQXBpcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBnZXRDdXJyZW50OiBnZXRDdXJyZW50XG4gICAgfSk7XG5cbiAgICB2YXIgQ29tcG9zZVNjaGVtYSA9IFtzdHJpY3QkMSgnZmluZCcpXTtcblxuICAgIHZhciBDb21wb3NpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IENvbXBvc2VTY2hlbWEsXG4gICAgICBuYW1lOiAnY29tcG9zaW5nJyxcbiAgICAgIGFwaXM6IENvbXBvc2VBcGlzXG4gICAgfSk7XG5cbiAgICB2YXIgZGVoaWdobGlnaHRBbGxFeGNlcHQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBoQ29uZmlnLCBoU3RhdGUsIHNraXApIHtcbiAgICAgIHZhciBoaWdobGlnaHRlZCA9IGRlc2NlbmRhbnRzKGNvbXBvbmVudC5lbGVtZW50LCAnLicgKyBoQ29uZmlnLmhpZ2hsaWdodENsYXNzKTtcbiAgICAgIGVhY2goaGlnaGxpZ2h0ZWQsIGZ1bmN0aW9uIChoKSB7XG4gICAgICAgIGlmICghZXhpc3RzKHNraXAsIGZ1bmN0aW9uIChza2lwQ29tcCkge1xuICAgICAgICAgICAgcmV0dXJuIHNraXBDb21wLmVsZW1lbnQgPT09IGg7XG4gICAgICAgICAgfSkpIHtcbiAgICAgICAgICByZW1vdmUkNChoLCBoQ29uZmlnLmhpZ2hsaWdodENsYXNzKTtcbiAgICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20oaCkuZWFjaChmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgICAgICBoQ29uZmlnLm9uRGVoaWdobGlnaHQoY29tcG9uZW50LCB0YXJnZXQpO1xuICAgICAgICAgICAgZW1pdCh0YXJnZXQsIGRlaGlnaGxpZ2h0KCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkZWhpZ2hsaWdodEFsbCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSkge1xuICAgICAgcmV0dXJuIGRlaGlnaGxpZ2h0QWxsRXhjZXB0KGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCBbXSk7XG4gICAgfTtcbiAgICB2YXIgZGVoaWdobGlnaHQkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgdGFyZ2V0KSB7XG4gICAgICBpZiAoaXNIaWdobGlnaHRlZChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgdGFyZ2V0KSkge1xuICAgICAgICByZW1vdmUkNCh0YXJnZXQuZWxlbWVudCwgaENvbmZpZy5oaWdobGlnaHRDbGFzcyk7XG4gICAgICAgIGhDb25maWcub25EZWhpZ2hsaWdodChjb21wb25lbnQsIHRhcmdldCk7XG4gICAgICAgIGVtaXQodGFyZ2V0LCBkZWhpZ2hsaWdodCgpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBoaWdobGlnaHQkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgdGFyZ2V0KSB7XG4gICAgICBkZWhpZ2hsaWdodEFsbEV4Y2VwdChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgW3RhcmdldF0pO1xuICAgICAgaWYgKCFpc0hpZ2hsaWdodGVkKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCB0YXJnZXQpKSB7XG4gICAgICAgIGFkZCQyKHRhcmdldC5lbGVtZW50LCBoQ29uZmlnLmhpZ2hsaWdodENsYXNzKTtcbiAgICAgICAgaENvbmZpZy5vbkhpZ2hsaWdodChjb21wb25lbnQsIHRhcmdldCk7XG4gICAgICAgIGVtaXQodGFyZ2V0LCBoaWdobGlnaHQoKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaGlnaGxpZ2h0Rmlyc3QgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBoQ29uZmlnLCBoU3RhdGUpIHtcbiAgICAgIGdldEZpcnN0KGNvbXBvbmVudCwgaENvbmZpZykuZWFjaChmdW5jdGlvbiAoZmlyc3RDb21wKSB7XG4gICAgICAgIGhpZ2hsaWdodCQxKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCBmaXJzdENvbXApO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaGlnaGxpZ2h0TGFzdCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSkge1xuICAgICAgZ2V0TGFzdChjb21wb25lbnQsIGhDb25maWcpLmVhY2goZnVuY3Rpb24gKGxhc3RDb21wKSB7XG4gICAgICAgIGhpZ2hsaWdodCQxKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCBsYXN0Q29tcCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBoaWdobGlnaHRBdCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgaW5kZXgpIHtcbiAgICAgIGdldEJ5SW5kZXgoY29tcG9uZW50LCBoQ29uZmlnLCBoU3RhdGUsIGluZGV4KS5mb2xkKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfSwgZnVuY3Rpb24gKGZpcnN0Q29tcCkge1xuICAgICAgICBoaWdobGlnaHQkMShjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgZmlyc3RDb21wKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGhpZ2hsaWdodEJ5ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciBjYW5kaWRhdGVzID0gZ2V0Q2FuZGlkYXRlcyhjb21wb25lbnQsIGhDb25maWcpO1xuICAgICAgdmFyIHRhcmdldENvbXAgPSBmaW5kKGNhbmRpZGF0ZXMsIHByZWRpY2F0ZSk7XG4gICAgICB0YXJnZXRDb21wLmVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgaGlnaGxpZ2h0JDEoY29tcG9uZW50LCBoQ29uZmlnLCBoU3RhdGUsIGMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaXNIaWdobGlnaHRlZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSwgcXVlcnlUYXJnZXQpIHtcbiAgICAgIHJldHVybiBoYXMkMihxdWVyeVRhcmdldC5lbGVtZW50LCBoQ29uZmlnLmhpZ2hsaWdodENsYXNzKTtcbiAgICB9O1xuICAgIHZhciBnZXRIaWdobGlnaHRlZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIF9oU3RhdGUpIHtcbiAgICAgIHJldHVybiBkZXNjZW5kYW50JDEoY29tcG9uZW50LmVsZW1lbnQsICcuJyArIGhDb25maWcuaGlnaGxpZ2h0Q2xhc3MpLmJpbmQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5nZXRTeXN0ZW0oKS5nZXRCeURvbShlKS50b09wdGlvbmFsKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRCeUluZGV4ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCBpbmRleCkge1xuICAgICAgdmFyIGl0ZW1zID0gZGVzY2VuZGFudHMoY29tcG9uZW50LmVsZW1lbnQsICcuJyArIGhDb25maWcuaXRlbUNsYXNzKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGl0ZW1zW2luZGV4XSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZXJyb3IobmV3IEVycm9yKCdObyBlbGVtZW50IGZvdW5kIHdpdGggaW5kZXggJyArIGluZGV4KSk7XG4gICAgICB9LCBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20pO1xuICAgIH07XG4gICAgdmFyIGdldEZpcnN0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgaENvbmZpZywgX2hTdGF0ZSkge1xuICAgICAgcmV0dXJuIGRlc2NlbmRhbnQkMShjb21wb25lbnQuZWxlbWVudCwgJy4nICsgaENvbmZpZy5pdGVtQ2xhc3MpLmJpbmQoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5nZXRTeXN0ZW0oKS5nZXRCeURvbShlKS50b09wdGlvbmFsKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRMYXN0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgaENvbmZpZywgX2hTdGF0ZSkge1xuICAgICAgdmFyIGl0ZW1zID0gZGVzY2VuZGFudHMoY29tcG9uZW50LmVsZW1lbnQsICcuJyArIGhDb25maWcuaXRlbUNsYXNzKTtcbiAgICAgIHZhciBsYXN0ID0gaXRlbXMubGVuZ3RoID4gMCA/IE9wdGlvbmFsLnNvbWUoaXRlbXNbaXRlbXMubGVuZ3RoIC0gMV0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgcmV0dXJuIGxhc3QuYmluZChmdW5jdGlvbiAoYykge1xuICAgICAgICByZXR1cm4gY29tcG9uZW50LmdldFN5c3RlbSgpLmdldEJ5RG9tKGMpLnRvT3B0aW9uYWwoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldERlbHRhID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCBkZWx0YSkge1xuICAgICAgdmFyIGl0ZW1zID0gZGVzY2VuZGFudHMoY29tcG9uZW50LmVsZW1lbnQsICcuJyArIGhDb25maWcuaXRlbUNsYXNzKTtcbiAgICAgIHZhciBjdXJyZW50ID0gZmluZEluZGV4KGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gaGFzJDIoaXRlbSwgaENvbmZpZy5oaWdobGlnaHRDbGFzcyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjdXJyZW50LmJpbmQoZnVuY3Rpb24gKHNlbGVjdGVkKSB7XG4gICAgICAgIHZhciBkZXN0ID0gY3ljbGVCeShzZWxlY3RlZCwgZGVsdGEsIDAsIGl0ZW1zLmxlbmd0aCAtIDEpO1xuICAgICAgICByZXR1cm4gY29tcG9uZW50LmdldFN5c3RlbSgpLmdldEJ5RG9tKGl0ZW1zW2Rlc3RdKS50b09wdGlvbmFsKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRQcmV2aW91cyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSkge1xuICAgICAgcmV0dXJuIGdldERlbHRhKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCAtMSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TmV4dCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIGhTdGF0ZSkge1xuICAgICAgcmV0dXJuIGdldERlbHRhKGNvbXBvbmVudCwgaENvbmZpZywgaFN0YXRlLCArMSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2FuZGlkYXRlcyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGhDb25maWcsIF9oU3RhdGUpIHtcbiAgICAgIHZhciBpdGVtcyA9IGRlc2NlbmRhbnRzKGNvbXBvbmVudC5lbGVtZW50LCAnLicgKyBoQ29uZmlnLml0ZW1DbGFzcyk7XG4gICAgICByZXR1cm4gY2F0KG1hcChpdGVtcywgZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudC5nZXRTeXN0ZW0oKS5nZXRCeURvbShpKS50b09wdGlvbmFsKCk7XG4gICAgICB9KSk7XG4gICAgfTtcblxuICAgIHZhciBIaWdobGlnaHRBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGRlaGlnaGxpZ2h0QWxsOiBkZWhpZ2hsaWdodEFsbCxcbiAgICAgICAgZGVoaWdobGlnaHQ6IGRlaGlnaGxpZ2h0JDEsXG4gICAgICAgIGhpZ2hsaWdodDogaGlnaGxpZ2h0JDEsXG4gICAgICAgIGhpZ2hsaWdodEZpcnN0OiBoaWdobGlnaHRGaXJzdCxcbiAgICAgICAgaGlnaGxpZ2h0TGFzdDogaGlnaGxpZ2h0TGFzdCxcbiAgICAgICAgaGlnaGxpZ2h0QXQ6IGhpZ2hsaWdodEF0LFxuICAgICAgICBoaWdobGlnaHRCeTogaGlnaGxpZ2h0QnksXG4gICAgICAgIGlzSGlnaGxpZ2h0ZWQ6IGlzSGlnaGxpZ2h0ZWQsXG4gICAgICAgIGdldEhpZ2hsaWdodGVkOiBnZXRIaWdobGlnaHRlZCxcbiAgICAgICAgZ2V0Rmlyc3Q6IGdldEZpcnN0LFxuICAgICAgICBnZXRMYXN0OiBnZXRMYXN0LFxuICAgICAgICBnZXRQcmV2aW91czogZ2V0UHJldmlvdXMsXG4gICAgICAgIGdldE5leHQ6IGdldE5leHQsXG4gICAgICAgIGdldENhbmRpZGF0ZXM6IGdldENhbmRpZGF0ZXNcbiAgICB9KTtcblxuICAgIHZhciBIaWdobGlnaHRTY2hlbWEgPSBbXG4gICAgICBzdHJpY3QkMSgnaGlnaGxpZ2h0Q2xhc3MnKSxcbiAgICAgIHN0cmljdCQxKCdpdGVtQ2xhc3MnKSxcbiAgICAgIG9uSGFuZGxlcignb25IaWdobGlnaHQnKSxcbiAgICAgIG9uSGFuZGxlcignb25EZWhpZ2hsaWdodCcpXG4gICAgXTtcblxuICAgIHZhciBIaWdobGlnaHRpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IEhpZ2hsaWdodFNjaGVtYSxcbiAgICAgIG5hbWU6ICdoaWdobGlnaHRpbmcnLFxuICAgICAgYXBpczogSGlnaGxpZ2h0QXBpc1xuICAgIH0pO1xuXG4gICAgdmFyIEJBQ0tTUEFDRSA9IFs4XTtcbiAgICB2YXIgVEFCID0gWzldO1xuICAgIHZhciBFTlRFUiA9IFsxM107XG4gICAgdmFyIEVTQ0FQRSA9IFsyN107XG4gICAgdmFyIFNQQUNFID0gWzMyXTtcbiAgICB2YXIgTEVGVCA9IFszN107XG4gICAgdmFyIFVQID0gWzM4XTtcbiAgICB2YXIgUklHSFQgPSBbMzldO1xuICAgIHZhciBET1dOID0gWzQwXTtcblxuICAgIHZhciBjeWNsZVByZXYgPSBmdW5jdGlvbiAodmFsdWVzLCBpbmRleCwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgYmVmb3JlID0gcmV2ZXJzZSh2YWx1ZXMuc2xpY2UoMCwgaW5kZXgpKTtcbiAgICAgIHZhciBhZnRlciA9IHJldmVyc2UodmFsdWVzLnNsaWNlKGluZGV4ICsgMSkpO1xuICAgICAgcmV0dXJuIGZpbmQoYmVmb3JlLmNvbmNhdChhZnRlciksIHByZWRpY2F0ZSk7XG4gICAgfTtcbiAgICB2YXIgdHJ5UHJldiA9IGZ1bmN0aW9uICh2YWx1ZXMsIGluZGV4LCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciBiZWZvcmUgPSByZXZlcnNlKHZhbHVlcy5zbGljZSgwLCBpbmRleCkpO1xuICAgICAgcmV0dXJuIGZpbmQoYmVmb3JlLCBwcmVkaWNhdGUpO1xuICAgIH07XG4gICAgdmFyIGN5Y2xlTmV4dCA9IGZ1bmN0aW9uICh2YWx1ZXMsIGluZGV4LCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciBiZWZvcmUgPSB2YWx1ZXMuc2xpY2UoMCwgaW5kZXgpO1xuICAgICAgdmFyIGFmdGVyID0gdmFsdWVzLnNsaWNlKGluZGV4ICsgMSk7XG4gICAgICByZXR1cm4gZmluZChhZnRlci5jb25jYXQoYmVmb3JlKSwgcHJlZGljYXRlKTtcbiAgICB9O1xuICAgIHZhciB0cnlOZXh0ID0gZnVuY3Rpb24gKHZhbHVlcywgaW5kZXgsIHByZWRpY2F0ZSkge1xuICAgICAgdmFyIGFmdGVyID0gdmFsdWVzLnNsaWNlKGluZGV4ICsgMSk7XG4gICAgICByZXR1cm4gZmluZChhZnRlciwgcHJlZGljYXRlKTtcbiAgICB9O1xuXG4gICAgdmFyIGluU2V0ID0gZnVuY3Rpb24gKGtleXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHJhdyA9IGV2ZW50LnJhdztcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zKGtleXMsIHJhdy53aGljaCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGFuZCA9IGZ1bmN0aW9uIChwcmVkcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICByZXR1cm4gZm9yYWxsKHByZWRzLCBmdW5jdGlvbiAocHJlZCkge1xuICAgICAgICAgIHJldHVybiBwcmVkKGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzU2hpZnQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHZhciByYXcgPSBldmVudC5yYXc7XG4gICAgICByZXR1cm4gcmF3LnNoaWZ0S2V5ID09PSB0cnVlO1xuICAgIH07XG4gICAgdmFyIGlzQ29udHJvbCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgdmFyIHJhdyA9IGV2ZW50LnJhdztcbiAgICAgIHJldHVybiByYXcuY3RybEtleSA9PT0gdHJ1ZTtcbiAgICB9O1xuICAgIHZhciBpc05vdFNoaWZ0ID0gbm90KGlzU2hpZnQpO1xuXG4gICAgdmFyIHJ1bGUgPSBmdW5jdGlvbiAobWF0Y2hlcywgYWN0aW9uKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLFxuICAgICAgICBjbGFzc2lmaWNhdGlvbjogYWN0aW9uXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNob29zZSQyID0gZnVuY3Rpb24gKHRyYW5zaXRpb25zLCBldmVudCkge1xuICAgICAgdmFyIHRyYW5zaXRpb24gPSBmaW5kKHRyYW5zaXRpb25zLCBmdW5jdGlvbiAodCkge1xuICAgICAgICByZXR1cm4gdC5tYXRjaGVzKGV2ZW50KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRyYW5zaXRpb24ubWFwKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHJldHVybiB0LmNsYXNzaWZpY2F0aW9uO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZXBvcnRGb2N1c1NoaWZ0aW5nID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcHJldkZvY3VzLCBuZXdGb2N1cykge1xuICAgICAgdmFyIG5vQ2hhbmdlID0gcHJldkZvY3VzLmV4aXN0cyhmdW5jdGlvbiAocCkge1xuICAgICAgICByZXR1cm4gbmV3Rm9jdXMuZXhpc3RzKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgcmV0dXJuIGVxJDEobiwgcCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICBpZiAoIW5vQ2hhbmdlKSB7XG4gICAgICAgIGVtaXRXaXRoKGNvbXBvbmVudCwgZm9jdXNTaGlmdGVkKCksIHtcbiAgICAgICAgICBwcmV2Rm9jdXM6IHByZXZGb2N1cyxcbiAgICAgICAgICBuZXdGb2N1czogbmV3Rm9jdXNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZG9tID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIHNlYXJjaChjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGZvY3VzZWUpIHtcbiAgICAgICAgdmFyIHByZXZGb2N1cyA9IGdldChjb21wb25lbnQpO1xuICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkudHJpZ2dlckZvY3VzKGZvY3VzZWUsIGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgICAgdmFyIG5ld0ZvY3VzID0gZ2V0KGNvbXBvbmVudCk7XG4gICAgICAgIHJlcG9ydEZvY3VzU2hpZnRpbmcoY29tcG9uZW50LCBwcmV2Rm9jdXMsIG5ld0ZvY3VzKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgc2V0OiBzZXRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaGlnaGxpZ2h0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiBIaWdobGlnaHRpbmcuZ2V0SGlnaGxpZ2h0ZWQoY29tcG9uZW50KS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gaXRlbS5lbGVtZW50O1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZWxlbWVudCkge1xuICAgICAgICB2YXIgcHJldkZvY3VzID0gZ2V0KGNvbXBvbmVudCk7XG4gICAgICAgIGNvbXBvbmVudC5nZXRTeXN0ZW0oKS5nZXRCeURvbShlbGVtZW50KS5mb2xkKG5vb3AsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLmhpZ2hsaWdodChjb21wb25lbnQsIGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG5ld0ZvY3VzID0gZ2V0KGNvbXBvbmVudCk7XG4gICAgICAgIHJlcG9ydEZvY3VzU2hpZnRpbmcoY29tcG9uZW50LCBwcmV2Rm9jdXMsIG5ld0ZvY3VzKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgc2V0OiBzZXRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBGb2N1c0luc2lkZU1vZGVzO1xuICAgIChmdW5jdGlvbiAoRm9jdXNJbnNpZGVNb2Rlcykge1xuICAgICAgRm9jdXNJbnNpZGVNb2Rlc1snT25Gb2N1c01vZGUnXSA9ICdvbkZvY3VzJztcbiAgICAgIEZvY3VzSW5zaWRlTW9kZXNbJ09uRW50ZXJPclNwYWNlTW9kZSddID0gJ29uRW50ZXJPclNwYWNlJztcbiAgICAgIEZvY3VzSW5zaWRlTW9kZXNbJ09uQXBpTW9kZSddID0gJ29uQXBpJztcbiAgICB9KEZvY3VzSW5zaWRlTW9kZXMgfHwgKEZvY3VzSW5zaWRlTW9kZXMgPSB7fSkpKTtcblxuICAgIHZhciB0eXBpY2FsID0gZnVuY3Rpb24gKGluZm9TY2hlbWEsIHN0YXRlSW5pdCwgZ2V0S2V5ZG93blJ1bGVzLCBnZXRLZXl1cFJ1bGVzLCBvcHRGb2N1c0luKSB7XG4gICAgICB2YXIgc2NoZW1hID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaW5mb1NjaGVtYS5jb25jYXQoW1xuICAgICAgICAgIGRlZmF1bHRlZCQxKCdmb2N1c01hbmFnZXInLCBkb20oKSksXG4gICAgICAgICAgZGVmYXVsdGVkT2YoJ2ZvY3VzSW5zaWRlJywgJ29uRm9jdXMnLCB2YWx1ZU9mKGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250YWlucyhbXG4gICAgICAgICAgICAgICdvbkZvY3VzJyxcbiAgICAgICAgICAgICAgJ29uRW50ZXJPclNwYWNlJyxcbiAgICAgICAgICAgICAgJ29uQXBpJ1xuICAgICAgICAgICAgXSwgdmFsKSA/IFJlc3VsdC52YWx1ZSh2YWwpIDogUmVzdWx0LmVycm9yKCdJbnZhbGlkIHZhbHVlIGZvciBmb2N1c0luc2lkZScpO1xuICAgICAgICAgIH0pKSxcbiAgICAgICAgICBvdXRwdXQoJ2hhbmRsZXInLCBtZSksXG4gICAgICAgICAgb3V0cHV0KCdzdGF0ZScsIHN0YXRlSW5pdCksXG4gICAgICAgICAgb3V0cHV0KCdzZW5kRm9jdXNJbicsIG9wdEZvY3VzSW4pXG4gICAgICAgIF0pO1xuICAgICAgfTtcbiAgICAgIHZhciBwcm9jZXNzS2V5ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGdldFJ1bGVzLCBrZXlpbmdDb25maWcsIGtleWluZ1N0YXRlKSB7XG4gICAgICAgIHZhciBydWxlcyA9IGdldFJ1bGVzKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGtleWluZ0NvbmZpZywga2V5aW5nU3RhdGUpO1xuICAgICAgICByZXR1cm4gY2hvb3NlJDIocnVsZXMsIHNpbXVsYXRlZEV2ZW50LmV2ZW50KS5iaW5kKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgICAgcmV0dXJuIHJ1bGUoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwga2V5aW5nQ29uZmlnLCBrZXlpbmdTdGF0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b0V2ZW50cyA9IGZ1bmN0aW9uIChrZXlpbmdDb25maWcsIGtleWluZ1N0YXRlKSB7XG4gICAgICAgIHZhciBvbkZvY3VzSGFuZGxlciA9IGtleWluZ0NvbmZpZy5mb2N1c0luc2lkZSAhPT0gRm9jdXNJbnNpZGVNb2Rlcy5PbkZvY3VzTW9kZSA/IE9wdGlvbmFsLm5vbmUoKSA6IG9wdEZvY3VzSW4oa2V5aW5nQ29uZmlnKS5tYXAoZnVuY3Rpb24gKGZvY3VzSW4pIHtcbiAgICAgICAgICByZXR1cm4gcnVuKGZvY3VzKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICBmb2N1c0luKGNvbXBvbmVudCwga2V5aW5nQ29uZmlnLCBrZXlpbmdTdGF0ZSk7XG4gICAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zdG9wKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdHJ5R29JbnNpZGVDb21wb25lbnQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHZhciBpc0VudGVyT3JTcGFjZSA9IGluU2V0KFNQQUNFLmNvbmNhdChFTlRFUikpKHNpbXVsYXRlZEV2ZW50LmV2ZW50KTtcbiAgICAgICAgICBpZiAoa2V5aW5nQ29uZmlnLmZvY3VzSW5zaWRlID09PSBGb2N1c0luc2lkZU1vZGVzLk9uRW50ZXJPclNwYWNlTW9kZSAmJiBpc0VudGVyT3JTcGFjZSAmJiBpc1NvdXJjZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSkge1xuICAgICAgICAgICAgb3B0Rm9jdXNJbihrZXlpbmdDb25maWcpLmVhY2goZnVuY3Rpb24gKGZvY3VzSW4pIHtcbiAgICAgICAgICAgICAgZm9jdXNJbihjb21wb25lbnQsIGtleWluZ0NvbmZpZywga2V5aW5nU3RhdGUpO1xuICAgICAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zdG9wKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBrZXlib2FyZEV2ZW50cyA9IFtcbiAgICAgICAgICBydW4oa2V5ZG93bigpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgcHJvY2Vzc0tleShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBnZXRLZXlkb3duUnVsZXMsIGtleWluZ0NvbmZpZywga2V5aW5nU3RhdGUpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB0cnlHb0luc2lkZUNvbXBvbmVudChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChfKSB7XG4gICAgICAgICAgICAgIHNpbXVsYXRlZEV2ZW50LnN0b3AoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bihrZXl1cCgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgcHJvY2Vzc0tleShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBnZXRLZXl1cFJ1bGVzLCBrZXlpbmdDb25maWcsIGtleWluZ1N0YXRlKS5lYWNoKGZ1bmN0aW9uIChfKSB7XG4gICAgICAgICAgICAgIHNpbXVsYXRlZEV2ZW50LnN0b3AoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pXG4gICAgICAgIF07XG4gICAgICAgIHJldHVybiBkZXJpdmUob25Gb2N1c0hhbmRsZXIudG9BcnJheSgpLmNvbmNhdChrZXlib2FyZEV2ZW50cykpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgc2NoZW1hOiBzY2hlbWEsXG4gICAgICAgIHByb2Nlc3NLZXk6IHByb2Nlc3NLZXksXG4gICAgICAgIHRvRXZlbnRzOiB0b0V2ZW50c1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZSQzID0gZnVuY3Rpb24gKGN5Y2xpY0ZpZWxkKSB7XG4gICAgICB2YXIgc2NoZW1hID0gW1xuICAgICAgICBvcHRpb24oJ29uRXNjYXBlJyksXG4gICAgICAgIG9wdGlvbignb25FbnRlcicpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnc2VsZWN0b3InLCAnW2RhdGEtYWxsb3ktdGFic3RvcD1cInRydWVcIl06bm90KDpkaXNhYmxlZCknKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2ZpcnN0VGFic3RvcCcsIDApLFxuICAgICAgICBkZWZhdWx0ZWQkMSgndXNlVGFic3RvcEF0JywgYWx3YXlzKSxcbiAgICAgICAgb3B0aW9uKCd2aXNpYmlsaXR5U2VsZWN0b3InKVxuICAgICAgXS5jb25jYXQoW2N5Y2xpY0ZpZWxkXSk7XG4gICAgICB2YXIgaXNWaXNpYmxlID0gZnVuY3Rpb24gKHRhYmJpbmdDb25maWcsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9IHRhYmJpbmdDb25maWcudmlzaWJpbGl0eVNlbGVjdG9yLmJpbmQoZnVuY3Rpb24gKHNlbCkge1xuICAgICAgICAgIHJldHVybiBjbG9zZXN0JDMoZWxlbWVudCwgc2VsKTtcbiAgICAgICAgfSkuZ2V0T3IoZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBnZXQkNyh0YXJnZXQpID4gMDtcbiAgICAgIH07XG4gICAgICB2YXIgZmluZEluaXRpYWwgPSBmdW5jdGlvbiAoY29tcG9uZW50LCB0YWJiaW5nQ29uZmlnKSB7XG4gICAgICAgIHZhciB0YWJzdG9wcyA9IGRlc2NlbmRhbnRzKGNvbXBvbmVudC5lbGVtZW50LCB0YWJiaW5nQ29uZmlnLnNlbGVjdG9yKTtcbiAgICAgICAgdmFyIHZpc2libGVzID0gZmlsdGVyKHRhYnN0b3BzLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBpc1Zpc2libGUodGFiYmluZ0NvbmZpZywgZWxlbSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbSh2aXNpYmxlc1t0YWJiaW5nQ29uZmlnLmZpcnN0VGFic3RvcF0pO1xuICAgICAgfTtcbiAgICAgIHZhciBmaW5kQ3VycmVudCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRhYmJpbmdDb25maWcpIHtcbiAgICAgICAgcmV0dXJuIHRhYmJpbmdDb25maWcuZm9jdXNNYW5hZ2VyLmdldChjb21wb25lbnQpLmJpbmQoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICByZXR1cm4gY2xvc2VzdCQzKGVsZW0sIHRhYmJpbmdDb25maWcuc2VsZWN0b3IpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNUYWJzdG9wID0gZnVuY3Rpb24gKHRhYmJpbmdDb25maWcsIGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGlzVmlzaWJsZSh0YWJiaW5nQ29uZmlnLCBlbGVtZW50KSAmJiB0YWJiaW5nQ29uZmlnLnVzZVRhYnN0b3BBdChlbGVtZW50KTtcbiAgICAgIH07XG4gICAgICB2YXIgZm9jdXNJbiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRhYmJpbmdDb25maWcsIF90YWJiaW5nU3RhdGUpIHtcbiAgICAgICAgZmluZEluaXRpYWwoY29tcG9uZW50LCB0YWJiaW5nQ29uZmlnKS5lYWNoKGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICB0YWJiaW5nQ29uZmlnLmZvY3VzTWFuYWdlci5zZXQoY29tcG9uZW50LCB0YXJnZXQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ29Gcm9tVGFic3RvcCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRhYnN0b3BzLCBzdG9wSW5kZXgsIHRhYmJpbmdDb25maWcsIGN5Y2xlKSB7XG4gICAgICAgIHJldHVybiBjeWNsZSh0YWJzdG9wcywgc3RvcEluZGV4LCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBpc1RhYnN0b3AodGFiYmluZ0NvbmZpZywgZWxlbSk7XG4gICAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0YWJiaW5nQ29uZmlnLmN5Y2xpYyA/IE9wdGlvbmFsLnNvbWUodHJ1ZSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICB0YWJiaW5nQ29uZmlnLmZvY3VzTWFuYWdlci5zZXQoY29tcG9uZW50LCB0YXJnZXQpO1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ28gPSBmdW5jdGlvbiAoY29tcG9uZW50LCBfc2ltdWxhdGVkRXZlbnQsIHRhYmJpbmdDb25maWcsIGN5Y2xlKSB7XG4gICAgICAgIHZhciB0YWJzdG9wcyA9IGRlc2NlbmRhbnRzKGNvbXBvbmVudC5lbGVtZW50LCB0YWJiaW5nQ29uZmlnLnNlbGVjdG9yKTtcbiAgICAgICAgcmV0dXJuIGZpbmRDdXJyZW50KGNvbXBvbmVudCwgdGFiYmluZ0NvbmZpZykuYmluZChmdW5jdGlvbiAodGFic3RvcCkge1xuICAgICAgICAgIHZhciBvcHRTdG9wSW5kZXggPSBmaW5kSW5kZXgodGFic3RvcHMsIGN1cnJ5KGVxJDEsIHRhYnN0b3ApKTtcbiAgICAgICAgICByZXR1cm4gb3B0U3RvcEluZGV4LmJpbmQoZnVuY3Rpb24gKHN0b3BJbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIGdvRnJvbVRhYnN0b3AoY29tcG9uZW50LCB0YWJzdG9wcywgc3RvcEluZGV4LCB0YWJiaW5nQ29uZmlnLCBjeWNsZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBnb0JhY2t3YXJkcyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCB0YWJiaW5nQ29uZmlnKSB7XG4gICAgICAgIHZhciBuYXZpZ2F0ZSA9IHRhYmJpbmdDb25maWcuY3ljbGljID8gY3ljbGVQcmV2IDogdHJ5UHJldjtcbiAgICAgICAgcmV0dXJuIGdvKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIHRhYmJpbmdDb25maWcsIG5hdmlnYXRlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ29Gb3J3YXJkcyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCB0YWJiaW5nQ29uZmlnKSB7XG4gICAgICAgIHZhciBuYXZpZ2F0ZSA9IHRhYmJpbmdDb25maWcuY3ljbGljID8gY3ljbGVOZXh0IDogdHJ5TmV4dDtcbiAgICAgICAgcmV0dXJuIGdvKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIHRhYmJpbmdDb25maWcsIG5hdmlnYXRlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZXhlY3V0ZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCB0YWJiaW5nQ29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0YWJiaW5nQ29uZmlnLm9uRW50ZXIuYmluZChmdW5jdGlvbiAoZikge1xuICAgICAgICAgIHJldHVybiBmKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZXhpdCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCB0YWJiaW5nQ29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0YWJiaW5nQ29uZmlnLm9uRXNjYXBlLmJpbmQoZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gZihjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldEtleWRvd25SdWxlcyA9IGNvbnN0YW50KFtcbiAgICAgICAgcnVsZShhbmQoW1xuICAgICAgICAgIGlzU2hpZnQsXG4gICAgICAgICAgaW5TZXQoVEFCKVxuICAgICAgICBdKSwgZ29CYWNrd2FyZHMpLFxuICAgICAgICBydWxlKGluU2V0KFRBQiksIGdvRm9yd2FyZHMpLFxuICAgICAgICBydWxlKGluU2V0KEVTQ0FQRSksIGV4aXQpLFxuICAgICAgICBydWxlKGFuZChbXG4gICAgICAgICAgaXNOb3RTaGlmdCxcbiAgICAgICAgICBpblNldChFTlRFUilcbiAgICAgICAgXSksIGV4ZWN1dGUpXG4gICAgICBdKTtcbiAgICAgIHZhciBnZXRLZXl1cFJ1bGVzID0gY29uc3RhbnQoW10pO1xuICAgICAgcmV0dXJuIHR5cGljYWwoc2NoZW1hLCBOb1N0YXRlLmluaXQsIGdldEtleWRvd25SdWxlcywgZ2V0S2V5dXBSdWxlcywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShmb2N1c0luKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgQWN5Y2xpY1R5cGUgPSBjcmVhdGUkMyhzdGF0ZSQxKCdjeWNsaWMnLCBuZXZlcikpO1xuXG4gICAgdmFyIEN5Y2xpY1R5cGUgPSBjcmVhdGUkMyhzdGF0ZSQxKCdjeWNsaWMnLCBhbHdheXMpKTtcblxuICAgIHZhciBkb0RlZmF1bHRFeGVjdXRlID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgX3NpbXVsYXRlZEV2ZW50LCBmb2N1c2VkKSB7XG4gICAgICBkaXNwYXRjaChjb21wb25lbnQsIGZvY3VzZWQsIGV4ZWN1dGUoKSk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICB9O1xuICAgIHZhciBkZWZhdWx0RXhlY3V0ZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBmb2N1c2VkKSB7XG4gICAgICB2YXIgaXNDb21wbGV4ID0gaW5zaWRlKGZvY3VzZWQpICYmIGluU2V0KFNQQUNFKShzaW11bGF0ZWRFdmVudC5ldmVudCk7XG4gICAgICByZXR1cm4gaXNDb21wbGV4ID8gT3B0aW9uYWwubm9uZSgpIDogZG9EZWZhdWx0RXhlY3V0ZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBmb2N1c2VkKTtcbiAgICB9O1xuICAgIHZhciBzdG9wRXZlbnRGb3JGaXJlZm94ID0gZnVuY3Rpb24gKF9jb21wb25lbnQsIF9zaW11bGF0ZWRFdmVudCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgfTtcblxuICAgIHZhciBzY2hlbWEkNCA9IFtcbiAgICAgIGRlZmF1bHRlZCQxKCdleGVjdXRlJywgZGVmYXVsdEV4ZWN1dGUpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VzZVNwYWNlJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VzZUVudGVyJywgdHJ1ZSksXG4gICAgICBkZWZhdWx0ZWQkMSgndXNlQ29udHJvbEVudGVyJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VzZURvd24nLCBmYWxzZSlcbiAgICBdO1xuICAgIHZhciBleGVjdXRlJDEgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgZXhlY3V0ZUNvbmZpZykge1xuICAgICAgcmV0dXJuIGV4ZWN1dGVDb25maWcuZXhlY3V0ZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBjb21wb25lbnQuZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0S2V5ZG93blJ1bGVzID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgX3NpbXVsYXRlZEV2ZW50LCBleGVjdXRlQ29uZmlnLCBfZXhlY3V0ZVN0YXRlKSB7XG4gICAgICB2YXIgc3BhY2VFeGVjID0gZXhlY3V0ZUNvbmZpZy51c2VTcGFjZSAmJiAhaW5zaWRlKGNvbXBvbmVudC5lbGVtZW50KSA/IFNQQUNFIDogW107XG4gICAgICB2YXIgZW50ZXJFeGVjID0gZXhlY3V0ZUNvbmZpZy51c2VFbnRlciA/IEVOVEVSIDogW107XG4gICAgICB2YXIgZG93bkV4ZWMgPSBleGVjdXRlQ29uZmlnLnVzZURvd24gPyBET1dOIDogW107XG4gICAgICB2YXIgZXhlY0tleXMgPSBzcGFjZUV4ZWMuY29uY2F0KGVudGVyRXhlYykuY29uY2F0KGRvd25FeGVjKTtcbiAgICAgIHJldHVybiBbcnVsZShpblNldChleGVjS2V5cyksIGV4ZWN1dGUkMSldLmNvbmNhdChleGVjdXRlQ29uZmlnLnVzZUNvbnRyb2xFbnRlciA/IFtydWxlKGFuZChbXG4gICAgICAgICAgaXNDb250cm9sLFxuICAgICAgICAgIGluU2V0KEVOVEVSKVxuICAgICAgICBdKSwgZXhlY3V0ZSQxKV0gOiBbXSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0S2V5dXBSdWxlcyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIF9zaW11bGF0ZWRFdmVudCwgZXhlY3V0ZUNvbmZpZywgX2V4ZWN1dGVTdGF0ZSkge1xuICAgICAgcmV0dXJuIGV4ZWN1dGVDb25maWcudXNlU3BhY2UgJiYgIWluc2lkZShjb21wb25lbnQuZWxlbWVudCkgPyBbcnVsZShpblNldChTUEFDRSksIHN0b3BFdmVudEZvckZpcmVmb3gpXSA6IFtdO1xuICAgIH07XG4gICAgdmFyIEV4ZWN1dGlvblR5cGUgPSB0eXBpY2FsKHNjaGVtYSQ0LCBOb1N0YXRlLmluaXQsIGdldEtleWRvd25SdWxlcywgZ2V0S2V5dXBSdWxlcywgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9KTtcblxuICAgIHZhciBmbGF0Z3JpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBkaW1lbnNpb25zID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIHNldEdyaWRTaXplID0gZnVuY3Rpb24gKG51bVJvd3MsIG51bUNvbHVtbnMpIHtcbiAgICAgICAgZGltZW5zaW9ucy5zZXQoT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgbnVtUm93czogbnVtUm93cyxcbiAgICAgICAgICBudW1Db2x1bW5zOiBudW1Db2x1bW5zXG4gICAgICAgIH0pKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0TnVtUm93cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRpbWVuc2lvbnMuZ2V0KCkubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGQubnVtUm93cztcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldE51bUNvbHVtbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkaW1lbnNpb25zLmdldCgpLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBkLm51bUNvbHVtbnM7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBudSQ1KHtcbiAgICAgICAgcmVhZFN0YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGRpbWVuc2lvbnMuZ2V0KCkubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBudW1Sb3dzOiBTdHJpbmcoZC5udW1Sb3dzKSxcbiAgICAgICAgICAgICAgbnVtQ29sdW1uczogU3RyaW5nKGQubnVtQ29sdW1ucylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSkuZ2V0T3Ioe1xuICAgICAgICAgICAgbnVtUm93czogJz8nLFxuICAgICAgICAgICAgbnVtQ29sdW1uczogJz8nXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldEdyaWRTaXplOiBzZXRHcmlkU2l6ZSxcbiAgICAgICAgZ2V0TnVtUm93czogZ2V0TnVtUm93cyxcbiAgICAgICAgZ2V0TnVtQ29sdW1uczogZ2V0TnVtQ29sdW1uc1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5pdCQyID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBzcGVjLnN0YXRlKHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgS2V5aW5nU3RhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZmxhdGdyaWQ6IGZsYXRncmlkLFxuICAgICAgICBpbml0OiBpbml0JDJcbiAgICB9KTtcblxuICAgIHZhciB1c2VIID0gZnVuY3Rpb24gKG1vdmVtZW50KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGNvbmZpZywgc3RhdGUpIHtcbiAgICAgICAgdmFyIG1vdmUgPSBtb3ZlbWVudChjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICAgIHJldHVybiB1c2UobW92ZSwgY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgY29uZmlnLCBzdGF0ZSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHdlc3QkMiA9IGZ1bmN0aW9uIChtb3ZlTGVmdCwgbW92ZVJpZ2h0KSB7XG4gICAgICB2YXIgbW92ZW1lbnQgPSBvbkRpcmVjdGlvbihtb3ZlTGVmdCwgbW92ZVJpZ2h0KTtcbiAgICAgIHJldHVybiB1c2VIKG1vdmVtZW50KTtcbiAgICB9O1xuICAgIHZhciBlYXN0JDIgPSBmdW5jdGlvbiAobW92ZUxlZnQsIG1vdmVSaWdodCkge1xuICAgICAgdmFyIG1vdmVtZW50ID0gb25EaXJlY3Rpb24obW92ZVJpZ2h0LCBtb3ZlTGVmdCk7XG4gICAgICByZXR1cm4gdXNlSChtb3ZlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgdXNlViA9IGZ1bmN0aW9uIChtb3ZlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGNvbmZpZywgc3RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHVzZShtb3ZlLCBjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBjb25maWcsIHN0YXRlKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdXNlID0gZnVuY3Rpb24gKG1vdmUsIGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGNvbmZpZywgc3RhdGUpIHtcbiAgICAgIHZhciBvdXRjb21lID0gY29uZmlnLmZvY3VzTWFuYWdlci5nZXQoY29tcG9uZW50KS5iaW5kKGZ1bmN0aW9uIChmb2N1c2VkKSB7XG4gICAgICAgIHJldHVybiBtb3ZlKGNvbXBvbmVudC5lbGVtZW50LCBmb2N1c2VkLCBjb25maWcsIHN0YXRlKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG91dGNvbWUubWFwKGZ1bmN0aW9uIChuZXdGb2N1cykge1xuICAgICAgICBjb25maWcuZm9jdXNNYW5hZ2VyLnNldChjb21wb25lbnQsIG5ld0ZvY3VzKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBub3J0aCQyID0gdXNlVjtcbiAgICB2YXIgc291dGgkMiA9IHVzZVY7XG4gICAgdmFyIG1vdmUgPSB1c2VWO1xuXG4gICAgdmFyIGlzSGlkZGVuID0gZnVuY3Rpb24gKGRvbSkge1xuICAgICAgcmV0dXJuIGRvbS5vZmZzZXRXaWR0aCA8PSAwICYmIGRvbS5vZmZzZXRIZWlnaHQgPD0gMDtcbiAgICB9O1xuICAgIHZhciBpc1Zpc2libGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuICFpc0hpZGRlbihlbGVtZW50LmRvbSk7XG4gICAgfTtcblxuICAgIHZhciBsb2NhdGUgPSBmdW5jdGlvbiAoY2FuZGlkYXRlcywgcHJlZGljYXRlKSB7XG4gICAgICByZXR1cm4gZmluZEluZGV4KGNhbmRpZGF0ZXMsIHByZWRpY2F0ZSkubWFwKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluZGV4OiBpbmRleCxcbiAgICAgICAgICBjYW5kaWRhdGVzOiBjYW5kaWRhdGVzXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGxvY2F0ZVZpc2libGUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBjdXJyZW50LCBzZWxlY3Rvcikge1xuICAgICAgdmFyIHByZWRpY2F0ZSA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiBlcSQxKHgsIGN1cnJlbnQpO1xuICAgICAgfTtcbiAgICAgIHZhciBjYW5kaWRhdGVzID0gZGVzY2VuZGFudHMoY29udGFpbmVyLCBzZWxlY3Rvcik7XG4gICAgICB2YXIgdmlzaWJsZSA9IGZpbHRlcihjYW5kaWRhdGVzLCBpc1Zpc2libGUpO1xuICAgICAgcmV0dXJuIGxvY2F0ZSh2aXNpYmxlLCBwcmVkaWNhdGUpO1xuICAgIH07XG4gICAgdmFyIGZpbmRJbmRleCQxID0gZnVuY3Rpb24gKGVsZW1lbnRzLCB0YXJnZXQpIHtcbiAgICAgIHJldHVybiBmaW5kSW5kZXgoZWxlbWVudHMsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHJldHVybiBlcSQxKHRhcmdldCwgZWxlbSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHdpdGhHcmlkID0gZnVuY3Rpb24gKHZhbHVlcywgaW5kZXgsIG51bUNvbHMsIGYpIHtcbiAgICAgIHZhciBvbGRSb3cgPSBNYXRoLmZsb29yKGluZGV4IC8gbnVtQ29scyk7XG4gICAgICB2YXIgb2xkQ29sdW1uID0gaW5kZXggJSBudW1Db2xzO1xuICAgICAgcmV0dXJuIGYob2xkUm93LCBvbGRDb2x1bW4pLmJpbmQoZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgdmFyIG5ld0luZGV4ID0gYWRkcmVzcy5yb3cgKiBudW1Db2xzICsgYWRkcmVzcy5jb2x1bW47XG4gICAgICAgIHJldHVybiBuZXdJbmRleCA+PSAwICYmIG5ld0luZGV4IDwgdmFsdWVzLmxlbmd0aCA/IE9wdGlvbmFsLnNvbWUodmFsdWVzW25ld0luZGV4XSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjeWNsZUhvcml6b250YWwgPSBmdW5jdGlvbiAodmFsdWVzLCBpbmRleCwgbnVtUm93cywgbnVtQ29scywgZGVsdGEpIHtcbiAgICAgIHJldHVybiB3aXRoR3JpZCh2YWx1ZXMsIGluZGV4LCBudW1Db2xzLCBmdW5jdGlvbiAob2xkUm93LCBvbGRDb2x1bW4pIHtcbiAgICAgICAgdmFyIG9uTGFzdFJvdyA9IG9sZFJvdyA9PT0gbnVtUm93cyAtIDE7XG4gICAgICAgIHZhciBjb2xzSW5Sb3cgPSBvbkxhc3RSb3cgPyB2YWx1ZXMubGVuZ3RoIC0gb2xkUm93ICogbnVtQ29scyA6IG51bUNvbHM7XG4gICAgICAgIHZhciBuZXdDb2x1bW4gPSBjeWNsZUJ5KG9sZENvbHVtbiwgZGVsdGEsIDAsIGNvbHNJblJvdyAtIDEpO1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgcm93OiBvbGRSb3csXG4gICAgICAgICAgY29sdW1uOiBuZXdDb2x1bW5cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjeWNsZVZlcnRpY2FsID0gZnVuY3Rpb24gKHZhbHVlcywgaW5kZXgsIG51bVJvd3MsIG51bUNvbHMsIGRlbHRhKSB7XG4gICAgICByZXR1cm4gd2l0aEdyaWQodmFsdWVzLCBpbmRleCwgbnVtQ29scywgZnVuY3Rpb24gKG9sZFJvdywgb2xkQ29sdW1uKSB7XG4gICAgICAgIHZhciBuZXdSb3cgPSBjeWNsZUJ5KG9sZFJvdywgZGVsdGEsIDAsIG51bVJvd3MgLSAxKTtcbiAgICAgICAgdmFyIG9uTGFzdFJvdyA9IG5ld1JvdyA9PT0gbnVtUm93cyAtIDE7XG4gICAgICAgIHZhciBjb2xzSW5Sb3cgPSBvbkxhc3RSb3cgPyB2YWx1ZXMubGVuZ3RoIC0gbmV3Um93ICogbnVtQ29scyA6IG51bUNvbHM7XG4gICAgICAgIHZhciBuZXdDb2wgPSBjbGFtcChvbGRDb2x1bW4sIDAsIGNvbHNJblJvdyAtIDEpO1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgcm93OiBuZXdSb3csXG4gICAgICAgICAgY29sdW1uOiBuZXdDb2xcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjeWNsZVJpZ2h0ID0gZnVuY3Rpb24gKHZhbHVlcywgaW5kZXgsIG51bVJvd3MsIG51bUNvbHMpIHtcbiAgICAgIHJldHVybiBjeWNsZUhvcml6b250YWwodmFsdWVzLCBpbmRleCwgbnVtUm93cywgbnVtQ29scywgKzEpO1xuICAgIH07XG4gICAgdmFyIGN5Y2xlTGVmdCA9IGZ1bmN0aW9uICh2YWx1ZXMsIGluZGV4LCBudW1Sb3dzLCBudW1Db2xzKSB7XG4gICAgICByZXR1cm4gY3ljbGVIb3Jpem9udGFsKHZhbHVlcywgaW5kZXgsIG51bVJvd3MsIG51bUNvbHMsIC0xKTtcbiAgICB9O1xuICAgIHZhciBjeWNsZVVwID0gZnVuY3Rpb24gKHZhbHVlcywgaW5kZXgsIG51bVJvd3MsIG51bUNvbHMpIHtcbiAgICAgIHJldHVybiBjeWNsZVZlcnRpY2FsKHZhbHVlcywgaW5kZXgsIG51bVJvd3MsIG51bUNvbHMsIC0xKTtcbiAgICB9O1xuICAgIHZhciBjeWNsZURvd24gPSBmdW5jdGlvbiAodmFsdWVzLCBpbmRleCwgbnVtUm93cywgbnVtQ29scykge1xuICAgICAgcmV0dXJuIGN5Y2xlVmVydGljYWwodmFsdWVzLCBpbmRleCwgbnVtUm93cywgbnVtQ29scywgKzEpO1xuICAgIH07XG5cbiAgICB2YXIgc2NoZW1hJDUgPSBbXG4gICAgICBzdHJpY3QkMSgnc2VsZWN0b3InKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdleGVjdXRlJywgZGVmYXVsdEV4ZWN1dGUpLFxuICAgICAgb25LZXlib2FyZEhhbmRsZXIoJ29uRXNjYXBlJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnY2FwdHVyZVRhYicsIGZhbHNlKSxcbiAgICAgIGluaXRTaXplKClcbiAgICBdO1xuICAgIHZhciBmb2N1c0luID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZ3JpZENvbmZpZywgX2dyaWRTdGF0ZSkge1xuICAgICAgZGVzY2VuZGFudCQxKGNvbXBvbmVudC5lbGVtZW50LCBncmlkQ29uZmlnLnNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uIChmaXJzdCkge1xuICAgICAgICBncmlkQ29uZmlnLmZvY3VzTWFuYWdlci5zZXQoY29tcG9uZW50LCBmaXJzdCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmaW5kQ3VycmVudCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGdyaWRDb25maWcpIHtcbiAgICAgIHJldHVybiBncmlkQ29uZmlnLmZvY3VzTWFuYWdlci5nZXQoY29tcG9uZW50KS5iaW5kKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDMoZWxlbSwgZ3JpZENvbmZpZy5zZWxlY3Rvcik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBleGVjdXRlJDIgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgZ3JpZENvbmZpZywgX2dyaWRTdGF0ZSkge1xuICAgICAgcmV0dXJuIGZpbmRDdXJyZW50KGNvbXBvbmVudCwgZ3JpZENvbmZpZykuYmluZChmdW5jdGlvbiAoZm9jdXNlZCkge1xuICAgICAgICByZXR1cm4gZ3JpZENvbmZpZy5leGVjdXRlKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGZvY3VzZWQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZG9Nb3ZlID0gZnVuY3Rpb24gKGN5Y2xlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW1lbnQsIGZvY3VzZWQsIGdyaWRDb25maWcsIGdyaWRTdGF0ZSkge1xuICAgICAgICByZXR1cm4gbG9jYXRlVmlzaWJsZShlbGVtZW50LCBmb2N1c2VkLCBncmlkQ29uZmlnLnNlbGVjdG9yKS5iaW5kKGZ1bmN0aW9uIChpZGVudGlmaWVkKSB7XG4gICAgICAgICAgcmV0dXJuIGN5Y2xlKGlkZW50aWZpZWQuY2FuZGlkYXRlcywgaWRlbnRpZmllZC5pbmRleCwgZ3JpZFN0YXRlLmdldE51bVJvd3MoKS5nZXRPcihncmlkQ29uZmlnLmluaXRTaXplLm51bVJvd3MpLCBncmlkU3RhdGUuZ2V0TnVtQ29sdW1ucygpLmdldE9yKGdyaWRDb25maWcuaW5pdFNpemUubnVtQ29sdW1ucykpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlVGFiID0gZnVuY3Rpb24gKF9jb21wb25lbnQsIF9zaW11bGF0ZWRFdmVudCwgZ3JpZENvbmZpZykge1xuICAgICAgcmV0dXJuIGdyaWRDb25maWcuY2FwdHVyZVRhYiA/IE9wdGlvbmFsLnNvbWUodHJ1ZSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgZG9Fc2NhcGUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgZ3JpZENvbmZpZykge1xuICAgICAgcmV0dXJuIGdyaWRDb25maWcub25Fc2NhcGUoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCk7XG4gICAgfTtcbiAgICB2YXIgbW92ZUxlZnQgPSBkb01vdmUoY3ljbGVMZWZ0KTtcbiAgICB2YXIgbW92ZVJpZ2h0ID0gZG9Nb3ZlKGN5Y2xlUmlnaHQpO1xuICAgIHZhciBtb3ZlTm9ydGggPSBkb01vdmUoY3ljbGVVcCk7XG4gICAgdmFyIG1vdmVTb3V0aCA9IGRvTW92ZShjeWNsZURvd24pO1xuICAgIHZhciBnZXRLZXlkb3duUnVsZXMkMSA9IGNvbnN0YW50KFtcbiAgICAgIHJ1bGUoaW5TZXQoTEVGVCksIHdlc3QkMihtb3ZlTGVmdCwgbW92ZVJpZ2h0KSksXG4gICAgICBydWxlKGluU2V0KFJJR0hUKSwgZWFzdCQyKG1vdmVMZWZ0LCBtb3ZlUmlnaHQpKSxcbiAgICAgIHJ1bGUoaW5TZXQoVVApLCBub3J0aCQyKG1vdmVOb3J0aCkpLFxuICAgICAgcnVsZShpblNldChET1dOKSwgc291dGgkMihtb3ZlU291dGgpKSxcbiAgICAgIHJ1bGUoYW5kKFtcbiAgICAgICAgaXNTaGlmdCxcbiAgICAgICAgaW5TZXQoVEFCKVxuICAgICAgXSksIGhhbmRsZVRhYiksXG4gICAgICBydWxlKGFuZChbXG4gICAgICAgIGlzTm90U2hpZnQsXG4gICAgICAgIGluU2V0KFRBQilcbiAgICAgIF0pLCBoYW5kbGVUYWIpLFxuICAgICAgcnVsZShpblNldChFU0NBUEUpLCBkb0VzY2FwZSksXG4gICAgICBydWxlKGluU2V0KFNQQUNFLmNvbmNhdChFTlRFUikpLCBleGVjdXRlJDIpXG4gICAgXSk7XG4gICAgdmFyIGdldEtleXVwUnVsZXMkMSA9IGNvbnN0YW50KFtydWxlKGluU2V0KFNQQUNFKSwgc3RvcEV2ZW50Rm9yRmlyZWZveCldKTtcbiAgICB2YXIgRmxhdGdyaWRUeXBlID0gdHlwaWNhbChzY2hlbWEkNSwgZmxhdGdyaWQsIGdldEtleWRvd25SdWxlcyQxLCBnZXRLZXl1cFJ1bGVzJDEsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGZvY3VzSW4pO1xuICAgIH0pO1xuXG4gICAgdmFyIGhvcml6b250YWwgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBzZWxlY3RvciwgY3VycmVudCwgZGVsdGEpIHtcbiAgICAgIHZhciBpc0Rpc2FibGVkQnV0dG9uID0gZnVuY3Rpb24gKGNhbmRpZGF0ZSkge1xuICAgICAgICByZXR1cm4gbmFtZShjYW5kaWRhdGUpID09PSAnYnV0dG9uJyAmJiBnZXQkMyhjYW5kaWRhdGUsICdkaXNhYmxlZCcpID09PSAnZGlzYWJsZWQnO1xuICAgICAgfTtcbiAgICAgIHZhciB0cnlDeWNsZSA9IGZ1bmN0aW9uIChpbml0aWFsLCBpbmRleCwgY2FuZGlkYXRlcykge1xuICAgICAgICB2YXIgbmV3SW5kZXggPSBjeWNsZUJ5KGluZGV4LCBkZWx0YSwgMCwgY2FuZGlkYXRlcy5sZW5ndGggLSAxKTtcbiAgICAgICAgaWYgKG5ld0luZGV4ID09PSBpbml0aWFsKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaXNEaXNhYmxlZEJ1dHRvbihjYW5kaWRhdGVzW25ld0luZGV4XSkgPyB0cnlDeWNsZShpbml0aWFsLCBuZXdJbmRleCwgY2FuZGlkYXRlcykgOiBPcHRpb25hbC5mcm9tKGNhbmRpZGF0ZXNbbmV3SW5kZXhdKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBsb2NhdGVWaXNpYmxlKGNvbnRhaW5lciwgY3VycmVudCwgc2VsZWN0b3IpLmJpbmQoZnVuY3Rpb24gKGlkZW50aWZpZWQpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gaWRlbnRpZmllZC5pbmRleDtcbiAgICAgICAgdmFyIGNhbmRpZGF0ZXMgPSBpZGVudGlmaWVkLmNhbmRpZGF0ZXM7XG4gICAgICAgIHJldHVybiB0cnlDeWNsZShpbmRleCwgaW5kZXgsIGNhbmRpZGF0ZXMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzY2hlbWEkNiA9IFtcbiAgICAgIHN0cmljdCQxKCdzZWxlY3RvcicpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2dldEluaXRpYWwnLCBPcHRpb25hbC5ub25lKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdleGVjdXRlJywgZGVmYXVsdEV4ZWN1dGUpLFxuICAgICAgb25LZXlib2FyZEhhbmRsZXIoJ29uRXNjYXBlJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXhlY3V0ZU9uTW92ZScsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdhbGxvd1ZlcnRpY2FsJywgdHJ1ZSlcbiAgICBdO1xuICAgIHZhciBmaW5kQ3VycmVudCQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZmxvd0NvbmZpZykge1xuICAgICAgcmV0dXJuIGZsb3dDb25maWcuZm9jdXNNYW5hZ2VyLmdldChjb21wb25lbnQpLmJpbmQoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgcmV0dXJuIGNsb3Nlc3QkMyhlbGVtLCBmbG93Q29uZmlnLnNlbGVjdG9yKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGV4ZWN1dGUkMyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBmbG93Q29uZmlnKSB7XG4gICAgICByZXR1cm4gZmluZEN1cnJlbnQkMShjb21wb25lbnQsIGZsb3dDb25maWcpLmJpbmQoZnVuY3Rpb24gKGZvY3VzZWQpIHtcbiAgICAgICAgcmV0dXJuIGZsb3dDb25maWcuZXhlY3V0ZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBmb2N1c2VkKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZvY3VzSW4kMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGZsb3dDb25maWcsIF9zdGF0ZSkge1xuICAgICAgZmxvd0NvbmZpZy5nZXRJbml0aWFsKGNvbXBvbmVudCkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkZXNjZW5kYW50JDEoY29tcG9uZW50LmVsZW1lbnQsIGZsb3dDb25maWcuc2VsZWN0b3IpO1xuICAgICAgfSkuZWFjaChmdW5jdGlvbiAoZmlyc3QpIHtcbiAgICAgICAgZmxvd0NvbmZpZy5mb2N1c01hbmFnZXIuc2V0KGNvbXBvbmVudCwgZmlyc3QpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbW92ZUxlZnQkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBmb2N1c2VkLCBpbmZvKSB7XG4gICAgICByZXR1cm4gaG9yaXpvbnRhbChlbGVtZW50LCBpbmZvLnNlbGVjdG9yLCBmb2N1c2VkLCAtMSk7XG4gICAgfTtcbiAgICB2YXIgbW92ZVJpZ2h0JDEgPSBmdW5jdGlvbiAoZWxlbWVudCwgZm9jdXNlZCwgaW5mbykge1xuICAgICAgcmV0dXJuIGhvcml6b250YWwoZWxlbWVudCwgaW5mby5zZWxlY3RvciwgZm9jdXNlZCwgKzEpO1xuICAgIH07XG4gICAgdmFyIGRvTW92ZSQxID0gZnVuY3Rpb24gKG1vdmVtZW50KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGZsb3dDb25maWcsIGZsb3dTdGF0ZSkge1xuICAgICAgICByZXR1cm4gbW92ZW1lbnQoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgZmxvd0NvbmZpZywgZmxvd1N0YXRlKS5iaW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZmxvd0NvbmZpZy5leGVjdXRlT25Nb3ZlID8gZXhlY3V0ZSQzKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIGZsb3dDb25maWcpIDogT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGRvRXNjYXBlJDEgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgZmxvd0NvbmZpZykge1xuICAgICAgcmV0dXJuIGZsb3dDb25maWcub25Fc2NhcGUoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0S2V5ZG93blJ1bGVzJDIgPSBmdW5jdGlvbiAoX2NvbXBvbmVudCwgX3NlLCBmbG93Q29uZmlnLCBfZmxvd1N0YXRlKSB7XG4gICAgICB2YXIgd2VzdE1vdmVycyA9IExFRlQuY29uY2F0KGZsb3dDb25maWcuYWxsb3dWZXJ0aWNhbCA/IFVQIDogW10pO1xuICAgICAgdmFyIGVhc3RNb3ZlcnMgPSBSSUdIVC5jb25jYXQoZmxvd0NvbmZpZy5hbGxvd1ZlcnRpY2FsID8gRE9XTiA6IFtdKTtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHJ1bGUoaW5TZXQod2VzdE1vdmVycyksIGRvTW92ZSQxKHdlc3QkMihtb3ZlTGVmdCQxLCBtb3ZlUmlnaHQkMSkpKSxcbiAgICAgICAgcnVsZShpblNldChlYXN0TW92ZXJzKSwgZG9Nb3ZlJDEoZWFzdCQyKG1vdmVMZWZ0JDEsIG1vdmVSaWdodCQxKSkpLFxuICAgICAgICBydWxlKGluU2V0KEVOVEVSKSwgZXhlY3V0ZSQzKSxcbiAgICAgICAgcnVsZShpblNldChTUEFDRSksIGV4ZWN1dGUkMyksXG4gICAgICAgIHJ1bGUoaW5TZXQoRVNDQVBFKSwgZG9Fc2NhcGUkMSlcbiAgICAgIF07XG4gICAgfTtcbiAgICB2YXIgZ2V0S2V5dXBSdWxlcyQyID0gY29uc3RhbnQoW3J1bGUoaW5TZXQoU1BBQ0UpLCBzdG9wRXZlbnRGb3JGaXJlZm94KV0pO1xuICAgIHZhciBGbG93VHlwZSA9IHR5cGljYWwoc2NoZW1hJDYsIE5vU3RhdGUuaW5pdCwgZ2V0S2V5ZG93blJ1bGVzJDIsIGdldEtleXVwUnVsZXMkMiwgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZm9jdXNJbiQxKTtcbiAgICB9KTtcblxuICAgIHZhciB0b0NlbGwgPSBmdW5jdGlvbiAobWF0cml4LCByb3dJbmRleCwgY29sdW1uSW5kZXgpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKG1hdHJpeFtyb3dJbmRleF0pLmJpbmQoZnVuY3Rpb24gKHJvdykge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShyb3dbY29sdW1uSW5kZXhdKS5tYXAoZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm93SW5kZXg6IHJvd0luZGV4LFxuICAgICAgICAgICAgY29sdW1uSW5kZXg6IGNvbHVtbkluZGV4LFxuICAgICAgICAgICAgY2VsbDogY2VsbFxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY3ljbGVIb3Jpem9udGFsJDEgPSBmdW5jdGlvbiAobWF0cml4LCByb3dJbmRleCwgc3RhcnRDb2wsIGRlbHRhQ29sKSB7XG4gICAgICB2YXIgcm93ID0gbWF0cml4W3Jvd0luZGV4XTtcbiAgICAgIHZhciBjb2xzSW5Sb3cgPSByb3cubGVuZ3RoO1xuICAgICAgdmFyIG5ld0NvbEluZGV4ID0gY3ljbGVCeShzdGFydENvbCwgZGVsdGFDb2wsIDAsIGNvbHNJblJvdyAtIDEpO1xuICAgICAgcmV0dXJuIHRvQ2VsbChtYXRyaXgsIHJvd0luZGV4LCBuZXdDb2xJbmRleCk7XG4gICAgfTtcbiAgICB2YXIgY3ljbGVWZXJ0aWNhbCQxID0gZnVuY3Rpb24gKG1hdHJpeCwgY29sSW5kZXgsIHN0YXJ0Um93LCBkZWx0YVJvdykge1xuICAgICAgdmFyIG5leHRSb3dJbmRleCA9IGN5Y2xlQnkoc3RhcnRSb3csIGRlbHRhUm93LCAwLCBtYXRyaXgubGVuZ3RoIC0gMSk7XG4gICAgICB2YXIgY29sc0luTmV4dFJvdyA9IG1hdHJpeFtuZXh0Um93SW5kZXhdLmxlbmd0aDtcbiAgICAgIHZhciBuZXh0Q29sSW5kZXggPSBjbGFtcChjb2xJbmRleCwgMCwgY29sc0luTmV4dFJvdyAtIDEpO1xuICAgICAgcmV0dXJuIHRvQ2VsbChtYXRyaXgsIG5leHRSb3dJbmRleCwgbmV4dENvbEluZGV4KTtcbiAgICB9O1xuICAgIHZhciBtb3ZlSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChtYXRyaXgsIHJvd0luZGV4LCBzdGFydENvbCwgZGVsdGFDb2wpIHtcbiAgICAgIHZhciByb3cgPSBtYXRyaXhbcm93SW5kZXhdO1xuICAgICAgdmFyIGNvbHNJblJvdyA9IHJvdy5sZW5ndGg7XG4gICAgICB2YXIgbmV3Q29sSW5kZXggPSBjbGFtcChzdGFydENvbCArIGRlbHRhQ29sLCAwLCBjb2xzSW5Sb3cgLSAxKTtcbiAgICAgIHJldHVybiB0b0NlbGwobWF0cml4LCByb3dJbmRleCwgbmV3Q29sSW5kZXgpO1xuICAgIH07XG4gICAgdmFyIG1vdmVWZXJ0aWNhbCA9IGZ1bmN0aW9uIChtYXRyaXgsIGNvbEluZGV4LCBzdGFydFJvdywgZGVsdGFSb3cpIHtcbiAgICAgIHZhciBuZXh0Um93SW5kZXggPSBjbGFtcChzdGFydFJvdyArIGRlbHRhUm93LCAwLCBtYXRyaXgubGVuZ3RoIC0gMSk7XG4gICAgICB2YXIgY29sc0luTmV4dFJvdyA9IG1hdHJpeFtuZXh0Um93SW5kZXhdLmxlbmd0aDtcbiAgICAgIHZhciBuZXh0Q29sSW5kZXggPSBjbGFtcChjb2xJbmRleCwgMCwgY29sc0luTmV4dFJvdyAtIDEpO1xuICAgICAgcmV0dXJuIHRvQ2VsbChtYXRyaXgsIG5leHRSb3dJbmRleCwgbmV4dENvbEluZGV4KTtcbiAgICB9O1xuICAgIHZhciBjeWNsZVJpZ2h0JDEgPSBmdW5jdGlvbiAobWF0cml4LCBzdGFydFJvdywgc3RhcnRDb2wpIHtcbiAgICAgIHJldHVybiBjeWNsZUhvcml6b250YWwkMShtYXRyaXgsIHN0YXJ0Um93LCBzdGFydENvbCwgKzEpO1xuICAgIH07XG4gICAgdmFyIGN5Y2xlTGVmdCQxID0gZnVuY3Rpb24gKG1hdHJpeCwgc3RhcnRSb3csIHN0YXJ0Q29sKSB7XG4gICAgICByZXR1cm4gY3ljbGVIb3Jpem9udGFsJDEobWF0cml4LCBzdGFydFJvdywgc3RhcnRDb2wsIC0xKTtcbiAgICB9O1xuICAgIHZhciBjeWNsZVVwJDEgPSBmdW5jdGlvbiAobWF0cml4LCBzdGFydFJvdywgc3RhcnRDb2wpIHtcbiAgICAgIHJldHVybiBjeWNsZVZlcnRpY2FsJDEobWF0cml4LCBzdGFydENvbCwgc3RhcnRSb3csIC0xKTtcbiAgICB9O1xuICAgIHZhciBjeWNsZURvd24kMSA9IGZ1bmN0aW9uIChtYXRyaXgsIHN0YXJ0Um93LCBzdGFydENvbCkge1xuICAgICAgcmV0dXJuIGN5Y2xlVmVydGljYWwkMShtYXRyaXgsIHN0YXJ0Q29sLCBzdGFydFJvdywgKzEpO1xuICAgIH07XG4gICAgdmFyIG1vdmVMZWZ0JDIgPSBmdW5jdGlvbiAobWF0cml4LCBzdGFydFJvdywgc3RhcnRDb2wpIHtcbiAgICAgIHJldHVybiBtb3ZlSG9yaXpvbnRhbChtYXRyaXgsIHN0YXJ0Um93LCBzdGFydENvbCwgLTEpO1xuICAgIH07XG4gICAgdmFyIG1vdmVSaWdodCQyID0gZnVuY3Rpb24gKG1hdHJpeCwgc3RhcnRSb3csIHN0YXJ0Q29sKSB7XG4gICAgICByZXR1cm4gbW92ZUhvcml6b250YWwobWF0cml4LCBzdGFydFJvdywgc3RhcnRDb2wsICsxKTtcbiAgICB9O1xuICAgIHZhciBtb3ZlVXAgPSBmdW5jdGlvbiAobWF0cml4LCBzdGFydFJvdywgc3RhcnRDb2wpIHtcbiAgICAgIHJldHVybiBtb3ZlVmVydGljYWwobWF0cml4LCBzdGFydENvbCwgc3RhcnRSb3csIC0xKTtcbiAgICB9O1xuICAgIHZhciBtb3ZlRG93biA9IGZ1bmN0aW9uIChtYXRyaXgsIHN0YXJ0Um93LCBzdGFydENvbCkge1xuICAgICAgcmV0dXJuIG1vdmVWZXJ0aWNhbChtYXRyaXgsIHN0YXJ0Q29sLCBzdGFydFJvdywgKzEpO1xuICAgIH07XG5cbiAgICB2YXIgc2NoZW1hJDcgPSBbXG4gICAgICBzdHJpY3RPYmpPZignc2VsZWN0b3JzJywgW1xuICAgICAgICBzdHJpY3QkMSgncm93JyksXG4gICAgICAgIHN0cmljdCQxKCdjZWxsJylcbiAgICAgIF0pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2N5Y2xlcycsIHRydWUpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3ByZXZpb3VzU2VsZWN0b3InLCBPcHRpb25hbC5ub25lKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdleGVjdXRlJywgZGVmYXVsdEV4ZWN1dGUpXG4gICAgXTtcbiAgICB2YXIgZm9jdXNJbiQyID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgbWF0cml4Q29uZmlnLCBfc3RhdGUpIHtcbiAgICAgIHZhciBmb2N1c2VkID0gbWF0cml4Q29uZmlnLnByZXZpb3VzU2VsZWN0b3IoY29tcG9uZW50KS5vclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGVjdG9ycyA9IG1hdHJpeENvbmZpZy5zZWxlY3RvcnM7XG4gICAgICAgIHJldHVybiBkZXNjZW5kYW50JDEoY29tcG9uZW50LmVsZW1lbnQsIHNlbGVjdG9ycy5jZWxsKTtcbiAgICAgIH0pO1xuICAgICAgZm9jdXNlZC5lYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgIG1hdHJpeENvbmZpZy5mb2N1c01hbmFnZXIuc2V0KGNvbXBvbmVudCwgY2VsbCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBleGVjdXRlJDQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgbWF0cml4Q29uZmlnKSB7XG4gICAgICByZXR1cm4gc2VhcmNoKGNvbXBvbmVudC5lbGVtZW50KS5iaW5kKGZ1bmN0aW9uIChmb2N1c2VkKSB7XG4gICAgICAgIHJldHVybiBtYXRyaXhDb25maWcuZXhlY3V0ZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBmb2N1c2VkKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRvTWF0cml4ID0gZnVuY3Rpb24gKHJvd3MsIG1hdHJpeENvbmZpZykge1xuICAgICAgcmV0dXJuIG1hcChyb3dzLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIHJldHVybiBkZXNjZW5kYW50cyhyb3csIG1hdHJpeENvbmZpZy5zZWxlY3RvcnMuY2VsbCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkb01vdmUkMiA9IGZ1bmN0aW9uIChpZkN5Y2xlLCBpZk1vdmUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCwgZm9jdXNlZCwgbWF0cml4Q29uZmlnKSB7XG4gICAgICAgIHZhciBtb3ZlID0gbWF0cml4Q29uZmlnLmN5Y2xlcyA/IGlmQ3ljbGUgOiBpZk1vdmU7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDMoZm9jdXNlZCwgbWF0cml4Q29uZmlnLnNlbGVjdG9ycy5yb3cpLmJpbmQoZnVuY3Rpb24gKGluUm93KSB7XG4gICAgICAgICAgdmFyIGNlbGxzSW5Sb3cgPSBkZXNjZW5kYW50cyhpblJvdywgbWF0cml4Q29uZmlnLnNlbGVjdG9ycy5jZWxsKTtcbiAgICAgICAgICByZXR1cm4gZmluZEluZGV4JDEoY2VsbHNJblJvdywgZm9jdXNlZCkuYmluZChmdW5jdGlvbiAoY29sSW5kZXgpIHtcbiAgICAgICAgICAgIHZhciBhbGxSb3dzID0gZGVzY2VuZGFudHMoZWxlbWVudCwgbWF0cml4Q29uZmlnLnNlbGVjdG9ycy5yb3cpO1xuICAgICAgICAgICAgcmV0dXJuIGZpbmRJbmRleCQxKGFsbFJvd3MsIGluUm93KS5iaW5kKGZ1bmN0aW9uIChyb3dJbmRleCkge1xuICAgICAgICAgICAgICB2YXIgbWF0cml4ID0gdG9NYXRyaXgoYWxsUm93cywgbWF0cml4Q29uZmlnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG1vdmUobWF0cml4LCByb3dJbmRleCwgY29sSW5kZXgpLm1hcChmdW5jdGlvbiAobmV4dCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNlbGw7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBtb3ZlTGVmdCQzID0gZG9Nb3ZlJDIoY3ljbGVMZWZ0JDEsIG1vdmVMZWZ0JDIpO1xuICAgIHZhciBtb3ZlUmlnaHQkMyA9IGRvTW92ZSQyKGN5Y2xlUmlnaHQkMSwgbW92ZVJpZ2h0JDIpO1xuICAgIHZhciBtb3ZlTm9ydGgkMSA9IGRvTW92ZSQyKGN5Y2xlVXAkMSwgbW92ZVVwKTtcbiAgICB2YXIgbW92ZVNvdXRoJDEgPSBkb01vdmUkMihjeWNsZURvd24kMSwgbW92ZURvd24pO1xuICAgIHZhciBnZXRLZXlkb3duUnVsZXMkMyA9IGNvbnN0YW50KFtcbiAgICAgIHJ1bGUoaW5TZXQoTEVGVCksIHdlc3QkMihtb3ZlTGVmdCQzLCBtb3ZlUmlnaHQkMykpLFxuICAgICAgcnVsZShpblNldChSSUdIVCksIGVhc3QkMihtb3ZlTGVmdCQzLCBtb3ZlUmlnaHQkMykpLFxuICAgICAgcnVsZShpblNldChVUCksIG5vcnRoJDIobW92ZU5vcnRoJDEpKSxcbiAgICAgIHJ1bGUoaW5TZXQoRE9XTiksIHNvdXRoJDIobW92ZVNvdXRoJDEpKSxcbiAgICAgIHJ1bGUoaW5TZXQoU1BBQ0UuY29uY2F0KEVOVEVSKSksIGV4ZWN1dGUkNClcbiAgICBdKTtcbiAgICB2YXIgZ2V0S2V5dXBSdWxlcyQzID0gY29uc3RhbnQoW3J1bGUoaW5TZXQoU1BBQ0UpLCBzdG9wRXZlbnRGb3JGaXJlZm94KV0pO1xuICAgIHZhciBNYXRyaXhUeXBlID0gdHlwaWNhbChzY2hlbWEkNywgTm9TdGF0ZS5pbml0LCBnZXRLZXlkb3duUnVsZXMkMywgZ2V0S2V5dXBSdWxlcyQzLCBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShmb2N1c0luJDIpO1xuICAgIH0pO1xuXG4gICAgdmFyIHNjaGVtYSQ4ID0gW1xuICAgICAgc3RyaWN0JDEoJ3NlbGVjdG9yJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXhlY3V0ZScsIGRlZmF1bHRFeGVjdXRlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdtb3ZlT25UYWInLCBmYWxzZSlcbiAgICBdO1xuICAgIHZhciBleGVjdXRlJDUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgbWVudUNvbmZpZykge1xuICAgICAgcmV0dXJuIG1lbnVDb25maWcuZm9jdXNNYW5hZ2VyLmdldChjb21wb25lbnQpLmJpbmQoZnVuY3Rpb24gKGZvY3VzZWQpIHtcbiAgICAgICAgcmV0dXJuIG1lbnVDb25maWcuZXhlY3V0ZShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBmb2N1c2VkKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZvY3VzSW4kMyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIG1lbnVDb25maWcsIF9zdGF0ZSkge1xuICAgICAgZGVzY2VuZGFudCQxKGNvbXBvbmVudC5lbGVtZW50LCBtZW51Q29uZmlnLnNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uIChmaXJzdCkge1xuICAgICAgICBtZW51Q29uZmlnLmZvY3VzTWFuYWdlci5zZXQoY29tcG9uZW50LCBmaXJzdCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBtb3ZlVXAkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBmb2N1c2VkLCBpbmZvKSB7XG4gICAgICByZXR1cm4gaG9yaXpvbnRhbChlbGVtZW50LCBpbmZvLnNlbGVjdG9yLCBmb2N1c2VkLCAtMSk7XG4gICAgfTtcbiAgICB2YXIgbW92ZURvd24kMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBmb2N1c2VkLCBpbmZvKSB7XG4gICAgICByZXR1cm4gaG9yaXpvbnRhbChlbGVtZW50LCBpbmZvLnNlbGVjdG9yLCBmb2N1c2VkLCArMSk7XG4gICAgfTtcbiAgICB2YXIgZmlyZVNoaWZ0VGFiID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIG1lbnVDb25maWcsIG1lbnVTdGF0ZSkge1xuICAgICAgcmV0dXJuIG1lbnVDb25maWcubW92ZU9uVGFiID8gbW92ZShtb3ZlVXAkMSkoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCwgbWVudUNvbmZpZywgbWVudVN0YXRlKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBmaXJlVGFiID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQsIG1lbnVDb25maWcsIG1lbnVTdGF0ZSkge1xuICAgICAgcmV0dXJuIG1lbnVDb25maWcubW92ZU9uVGFiID8gbW92ZShtb3ZlRG93biQxKShjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBtZW51Q29uZmlnLCBtZW51U3RhdGUpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGdldEtleWRvd25SdWxlcyQ0ID0gY29uc3RhbnQoW1xuICAgICAgcnVsZShpblNldChVUCksIG1vdmUobW92ZVVwJDEpKSxcbiAgICAgIHJ1bGUoaW5TZXQoRE9XTiksIG1vdmUobW92ZURvd24kMSkpLFxuICAgICAgcnVsZShhbmQoW1xuICAgICAgICBpc1NoaWZ0LFxuICAgICAgICBpblNldChUQUIpXG4gICAgICBdKSwgZmlyZVNoaWZ0VGFiKSxcbiAgICAgIHJ1bGUoYW5kKFtcbiAgICAgICAgaXNOb3RTaGlmdCxcbiAgICAgICAgaW5TZXQoVEFCKVxuICAgICAgXSksIGZpcmVUYWIpLFxuICAgICAgcnVsZShpblNldChFTlRFUiksIGV4ZWN1dGUkNSksXG4gICAgICBydWxlKGluU2V0KFNQQUNFKSwgZXhlY3V0ZSQ1KVxuICAgIF0pO1xuICAgIHZhciBnZXRLZXl1cFJ1bGVzJDQgPSBjb25zdGFudChbcnVsZShpblNldChTUEFDRSksIHN0b3BFdmVudEZvckZpcmVmb3gpXSk7XG4gICAgdmFyIE1lbnVUeXBlID0gdHlwaWNhbChzY2hlbWEkOCwgTm9TdGF0ZS5pbml0LCBnZXRLZXlkb3duUnVsZXMkNCwgZ2V0S2V5dXBSdWxlcyQ0LCBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShmb2N1c0luJDMpO1xuICAgIH0pO1xuXG4gICAgdmFyIHNjaGVtYSQ5ID0gW1xuICAgICAgb25LZXlib2FyZEhhbmRsZXIoJ29uU3BhY2UnKSxcbiAgICAgIG9uS2V5Ym9hcmRIYW5kbGVyKCdvbkVudGVyJyksXG4gICAgICBvbktleWJvYXJkSGFuZGxlcignb25TaGlmdEVudGVyJyksXG4gICAgICBvbktleWJvYXJkSGFuZGxlcignb25MZWZ0JyksXG4gICAgICBvbktleWJvYXJkSGFuZGxlcignb25SaWdodCcpLFxuICAgICAgb25LZXlib2FyZEhhbmRsZXIoJ29uVGFiJyksXG4gICAgICBvbktleWJvYXJkSGFuZGxlcignb25TaGlmdFRhYicpLFxuICAgICAgb25LZXlib2FyZEhhbmRsZXIoJ29uVXAnKSxcbiAgICAgIG9uS2V5Ym9hcmRIYW5kbGVyKCdvbkRvd24nKSxcbiAgICAgIG9uS2V5Ym9hcmRIYW5kbGVyKCdvbkVzY2FwZScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3N0b3BTcGFjZUtleXVwJywgZmFsc2UpLFxuICAgICAgb3B0aW9uKCdmb2N1c0luJylcbiAgICBdO1xuICAgIHZhciBnZXRLZXlkb3duUnVsZXMkNSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBzcGVjaWFsSW5mbykge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgcnVsZShpblNldChTUEFDRSksIHNwZWNpYWxJbmZvLm9uU3BhY2UpLFxuICAgICAgICBydWxlKGFuZChbXG4gICAgICAgICAgaXNOb3RTaGlmdCxcbiAgICAgICAgICBpblNldChFTlRFUilcbiAgICAgICAgXSksIHNwZWNpYWxJbmZvLm9uRW50ZXIpLFxuICAgICAgICBydWxlKGFuZChbXG4gICAgICAgICAgaXNTaGlmdCxcbiAgICAgICAgICBpblNldChFTlRFUilcbiAgICAgICAgXSksIHNwZWNpYWxJbmZvLm9uU2hpZnRFbnRlciksXG4gICAgICAgIHJ1bGUoYW5kKFtcbiAgICAgICAgICBpc1NoaWZ0LFxuICAgICAgICAgIGluU2V0KFRBQilcbiAgICAgICAgXSksIHNwZWNpYWxJbmZvLm9uU2hpZnRUYWIpLFxuICAgICAgICBydWxlKGFuZChbXG4gICAgICAgICAgaXNOb3RTaGlmdCxcbiAgICAgICAgICBpblNldChUQUIpXG4gICAgICAgIF0pLCBzcGVjaWFsSW5mby5vblRhYiksXG4gICAgICAgIHJ1bGUoaW5TZXQoVVApLCBzcGVjaWFsSW5mby5vblVwKSxcbiAgICAgICAgcnVsZShpblNldChET1dOKSwgc3BlY2lhbEluZm8ub25Eb3duKSxcbiAgICAgICAgcnVsZShpblNldChMRUZUKSwgc3BlY2lhbEluZm8ub25MZWZ0KSxcbiAgICAgICAgcnVsZShpblNldChSSUdIVCksIHNwZWNpYWxJbmZvLm9uUmlnaHQpLFxuICAgICAgICBydWxlKGluU2V0KFNQQUNFKSwgc3BlY2lhbEluZm8ub25TcGFjZSksXG4gICAgICAgIHJ1bGUoaW5TZXQoRVNDQVBFKSwgc3BlY2lhbEluZm8ub25Fc2NhcGUpXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIGdldEtleXVwUnVsZXMkNSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50LCBzcGVjaWFsSW5mbykge1xuICAgICAgcmV0dXJuIHNwZWNpYWxJbmZvLnN0b3BTcGFjZUtleXVwID8gW3J1bGUoaW5TZXQoU1BBQ0UpLCBzdG9wRXZlbnRGb3JGaXJlZm94KV0gOiBbXTtcbiAgICB9O1xuICAgIHZhciBTcGVjaWFsVHlwZSA9IHR5cGljYWwoc2NoZW1hJDksIE5vU3RhdGUuaW5pdCwgZ2V0S2V5ZG93blJ1bGVzJDUsIGdldEtleXVwUnVsZXMkNSwgZnVuY3Rpb24gKHNwZWNpYWxJbmZvKSB7XG4gICAgICByZXR1cm4gc3BlY2lhbEluZm8uZm9jdXNJbjtcbiAgICB9KTtcblxuICAgIHZhciBhY3ljbGljID0gQWN5Y2xpY1R5cGUuc2NoZW1hKCk7XG4gICAgdmFyIGN5Y2xpYyA9IEN5Y2xpY1R5cGUuc2NoZW1hKCk7XG4gICAgdmFyIGZsb3cgPSBGbG93VHlwZS5zY2hlbWEoKTtcbiAgICB2YXIgZmxhdGdyaWQkMSA9IEZsYXRncmlkVHlwZS5zY2hlbWEoKTtcbiAgICB2YXIgbWF0cml4ID0gTWF0cml4VHlwZS5zY2hlbWEoKTtcbiAgICB2YXIgZXhlY3V0aW9uID0gRXhlY3V0aW9uVHlwZS5zY2hlbWEoKTtcbiAgICB2YXIgbWVudSA9IE1lbnVUeXBlLnNjaGVtYSgpO1xuICAgIHZhciBzcGVjaWFsID0gU3BlY2lhbFR5cGUuc2NoZW1hKCk7XG5cbiAgICB2YXIgS2V5Ym9hcmRCcmFuY2hlcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBhY3ljbGljOiBhY3ljbGljLFxuICAgICAgICBjeWNsaWM6IGN5Y2xpYyxcbiAgICAgICAgZmxvdzogZmxvdyxcbiAgICAgICAgZmxhdGdyaWQ6IGZsYXRncmlkJDEsXG4gICAgICAgIG1hdHJpeDogbWF0cml4LFxuICAgICAgICBleGVjdXRpb246IGV4ZWN1dGlvbixcbiAgICAgICAgbWVudTogbWVudSxcbiAgICAgICAgc3BlY2lhbDogc3BlY2lhbFxuICAgIH0pO1xuXG4gICAgdmFyIGlzRmxhdGdyaWRTdGF0ZSA9IGZ1bmN0aW9uIChrZXlTdGF0ZSkge1xuICAgICAgcmV0dXJuIGhhc05vbk51bGxhYmxlS2V5KGtleVN0YXRlLCAnc2V0R3JpZFNpemUnKTtcbiAgICB9O1xuICAgIHZhciBLZXlpbmcgPSBjcmVhdGVNb2RlcyQxKHtcbiAgICAgIGJyYW5jaEtleTogJ21vZGUnLFxuICAgICAgYnJhbmNoZXM6IEtleWJvYXJkQnJhbmNoZXMsXG4gICAgICBuYW1lOiAna2V5aW5nJyxcbiAgICAgIGFjdGl2ZToge1xuICAgICAgICBldmVudHM6IGZ1bmN0aW9uIChrZXlpbmdDb25maWcsIGtleWluZ1N0YXRlKSB7XG4gICAgICAgICAgdmFyIGhhbmRsZXIgPSBrZXlpbmdDb25maWcuaGFuZGxlcjtcbiAgICAgICAgICByZXR1cm4gaGFuZGxlci50b0V2ZW50cyhrZXlpbmdDb25maWcsIGtleWluZ1N0YXRlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFwaXM6IHtcbiAgICAgICAgZm9jdXNJbjogZnVuY3Rpb24gKGNvbXBvbmVudCwga2V5Q29uZmlnLCBrZXlTdGF0ZSkge1xuICAgICAgICAgIGtleUNvbmZpZy5zZW5kRm9jdXNJbihrZXlDb25maWcpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29tcG9uZW50LmdldFN5c3RlbSgpLnRyaWdnZXJGb2N1cyhjb21wb25lbnQuZWxlbWVudCwgY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChzZW5kRm9jdXNJbikge1xuICAgICAgICAgICAgc2VuZEZvY3VzSW4oY29tcG9uZW50LCBrZXlDb25maWcsIGtleVN0YXRlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0R3JpZFNpemU6IGZ1bmN0aW9uIChjb21wb25lbnQsIGtleUNvbmZpZywga2V5U3RhdGUsIG51bVJvd3MsIG51bUNvbHVtbnMpIHtcbiAgICAgICAgICBpZiAoIWlzRmxhdGdyaWRTdGF0ZShrZXlTdGF0ZSkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0xheW91dCBkb2VzIG5vdCBzdXBwb3J0IHNldEdyaWRTaXplJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGtleVN0YXRlLnNldEdyaWRTaXplKG51bVJvd3MsIG51bUNvbHVtbnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHN0YXRlOiBLZXlpbmdTdGF0ZVxuICAgIH0pO1xuXG4gICAgdmFyIHNldCQ1ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwbGFjZUNvbmZpZywgcmVwbGFjZVN0YXRlLCBkYXRhKSB7XG4gICAgICBwcmVzZXJ2ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBuZXdDaGlsZHJlbiA9IG1hcChkYXRhLCBjb21wb25lbnQuZ2V0U3lzdGVtKCkuYnVpbGQpO1xuICAgICAgICByZXBsYWNlQ2hpbGRyZW4oY29tcG9uZW50LCBuZXdDaGlsZHJlbik7XG4gICAgICB9LCBjb21wb25lbnQuZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwbGFjZUNvbmZpZywgaW5zZXJ0aW9uLCBjaGlsZFNwZWMpIHtcbiAgICAgIHZhciBjaGlsZCA9IGNvbXBvbmVudC5nZXRTeXN0ZW0oKS5idWlsZChjaGlsZFNwZWMpO1xuICAgICAgYXR0YWNoV2l0aChjb21wb25lbnQsIGNoaWxkLCBpbnNlcnRpb24pO1xuICAgIH07XG4gICAgdmFyIGFwcGVuZCQyID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwbGFjZUNvbmZpZywgcmVwbGFjZVN0YXRlLCBhcHBlbmRlZSkge1xuICAgICAgaW5zZXJ0KGNvbXBvbmVudCwgcmVwbGFjZUNvbmZpZywgYXBwZW5kLCBhcHBlbmRlZSk7XG4gICAgfTtcbiAgICB2YXIgcHJlcGVuZCQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgcmVwbGFjZUNvbmZpZywgcmVwbGFjZVN0YXRlLCBwcmVwZW5kZWUpIHtcbiAgICAgIGluc2VydChjb21wb25lbnQsIHJlcGxhY2VDb25maWcsIHByZXBlbmQsIHByZXBlbmRlZSk7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlJDcgPSBmdW5jdGlvbiAoY29tcG9uZW50LCByZXBsYWNlQ29uZmlnLCByZXBsYWNlU3RhdGUsIHJlbW92ZWUpIHtcbiAgICAgIHZhciBjaGlsZHJlbiA9IGNvbnRlbnRzKGNvbXBvbmVudCk7XG4gICAgICB2YXIgZm91bmRDaGlsZCA9IGZpbmQoY2hpbGRyZW4sIGZ1bmN0aW9uIChjaGlsZCkge1xuICAgICAgICByZXR1cm4gZXEkMShyZW1vdmVlLmVsZW1lbnQsIGNoaWxkLmVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgICBmb3VuZENoaWxkLmVhY2goZGV0YWNoKTtcbiAgICB9O1xuICAgIHZhciBjb250ZW50cyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIF9yZXBsYWNlQ29uZmlnKSB7XG4gICAgICByZXR1cm4gY29tcG9uZW50LmNvbXBvbmVudHMoKTtcbiAgICB9O1xuICAgIHZhciByZXBsYWNlQXQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCByZXBsYWNlQ29uZmlnLCByZXBsYWNlU3RhdGUsIHJlcGxhY2VlSW5kZXgsIHJlcGxhY2VyKSB7XG4gICAgICB2YXIgY2hpbGRyZW4gPSBjb250ZW50cyhjb21wb25lbnQpO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oY2hpbGRyZW5bcmVwbGFjZWVJbmRleF0pLm1hcChmdW5jdGlvbiAocmVwbGFjZWUpIHtcbiAgICAgICAgcmVtb3ZlJDcoY29tcG9uZW50LCByZXBsYWNlQ29uZmlnLCByZXBsYWNlU3RhdGUsIHJlcGxhY2VlKTtcbiAgICAgICAgcmVwbGFjZXIuZWFjaChmdW5jdGlvbiAocikge1xuICAgICAgICAgIGluc2VydChjb21wb25lbnQsIHJlcGxhY2VDb25maWcsIGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICBhcHBlbmRBdChwLCBjLCByZXBsYWNlZUluZGV4KTtcbiAgICAgICAgICB9LCByKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXBsYWNlZTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlcGxhY2VCeSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlcGxhY2VDb25maWcsIHJlcGxhY2VTdGF0ZSwgcmVwbGFjZWVQcmVkLCByZXBsYWNlcikge1xuICAgICAgdmFyIGNoaWxkcmVuID0gY29udGVudHMoY29tcG9uZW50KTtcbiAgICAgIHJldHVybiBmaW5kSW5kZXgoY2hpbGRyZW4sIHJlcGxhY2VlUHJlZCkuYmluZChmdW5jdGlvbiAocmVwbGFjZWVJbmRleCkge1xuICAgICAgICByZXR1cm4gcmVwbGFjZUF0KGNvbXBvbmVudCwgcmVwbGFjZUNvbmZpZywgcmVwbGFjZVN0YXRlLCByZXBsYWNlZUluZGV4LCByZXBsYWNlcik7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIFJlcGxhY2VBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGFwcGVuZDogYXBwZW5kJDIsXG4gICAgICAgIHByZXBlbmQ6IHByZXBlbmQkMSxcbiAgICAgICAgcmVtb3ZlOiByZW1vdmUkNyxcbiAgICAgICAgcmVwbGFjZUF0OiByZXBsYWNlQXQsXG4gICAgICAgIHJlcGxhY2VCeTogcmVwbGFjZUJ5LFxuICAgICAgICBzZXQ6IHNldCQ1LFxuICAgICAgICBjb250ZW50czogY29udGVudHNcbiAgICB9KTtcblxuICAgIHZhciBSZXBsYWNpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IFtdLFxuICAgICAgbmFtZTogJ3JlcGxhY2luZycsXG4gICAgICBhcGlzOiBSZXBsYWNlQXBpc1xuICAgIH0pO1xuXG4gICAgdmFyIGV2ZW50cyQ0ID0gZnVuY3Rpb24gKG5hbWUsIGV2ZW50SGFuZGxlcnMpIHtcbiAgICAgIHZhciBldmVudHMgPSBkZXJpdmUoZXZlbnRIYW5kbGVycyk7XG4gICAgICByZXR1cm4gY3JlYXRlJDEoe1xuICAgICAgICBmaWVsZHM6IFtzdHJpY3QkMSgnZW5hYmxlZCcpXSxcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgYWN0aXZlOiB7IGV2ZW50czogY29uc3RhbnQoZXZlbnRzKSB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjb25maWcgPSBmdW5jdGlvbiAobmFtZSwgZXZlbnRIYW5kbGVycykge1xuICAgICAgdmFyIG1lID0gZXZlbnRzJDQobmFtZSwgZXZlbnRIYW5kbGVycyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBrZXk6IG5hbWUsXG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgY29uZmlnOiB7fSxcbiAgICAgICAgICBtZTogbWUsXG4gICAgICAgICAgY29uZmlnQXNSYXc6IGNvbnN0YW50KHt9KSxcbiAgICAgICAgICBpbml0aWFsQ29uZmlnOiB7fSxcbiAgICAgICAgICBzdGF0ZTogTm9TdGF0ZVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZm9jdXMkMiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGZvY3VzQ29uZmlnKSB7XG4gICAgICBpZiAoIWZvY3VzQ29uZmlnLmlnbm9yZSkge1xuICAgICAgICBmb2N1cyQxKGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgICAgZm9jdXNDb25maWcub25Gb2N1cyhjb21wb25lbnQpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGJsdXIkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGZvY3VzQ29uZmlnKSB7XG4gICAgICBpZiAoIWZvY3VzQ29uZmlnLmlnbm9yZSkge1xuICAgICAgICBibHVyKGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpc0ZvY3VzZWQgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICByZXR1cm4gaGFzRm9jdXMoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgIH07XG5cbiAgICB2YXIgRm9jdXNBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGZvY3VzOiBmb2N1cyQyLFxuICAgICAgICBibHVyOiBibHVyJDEsXG4gICAgICAgIGlzRm9jdXNlZDogaXNGb2N1c2VkXG4gICAgfSk7XG5cbiAgICB2YXIgZXhoaWJpdCQxID0gZnVuY3Rpb24gKGJhc2UsIGZvY3VzQ29uZmlnKSB7XG4gICAgICB2YXIgbW9kID0gZm9jdXNDb25maWcuaWdub3JlID8ge30gOiB7IGF0dHJpYnV0ZXM6IHsgdGFiaW5kZXg6ICctMScgfSB9O1xuICAgICAgcmV0dXJuIG51JDYobW9kKTtcbiAgICB9O1xuICAgIHZhciBldmVudHMkNSA9IGZ1bmN0aW9uIChmb2N1c0NvbmZpZykge1xuICAgICAgcmV0dXJuIGRlcml2ZShbcnVuKGZvY3VzKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgZm9jdXMkMihjb21wb25lbnQsIGZvY3VzQ29uZmlnKTtcbiAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zdG9wKCk7XG4gICAgICAgIH0pXS5jb25jYXQoZm9jdXNDb25maWcuc3RvcE1vdXNlZG93biA/IFtydW4obW91c2Vkb3duKCksIGZ1bmN0aW9uIChfLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHNpbXVsYXRlZEV2ZW50LmV2ZW50LnByZXZlbnQoKTtcbiAgICAgICAgfSldIDogW10pKTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZUZvY3VzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGV4aGliaXQ6IGV4aGliaXQkMSxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkNVxuICAgIH0pO1xuXG4gICAgdmFyIEZvY3VzU2NoZW1hID0gW1xuICAgICAgb25IYW5kbGVyKCdvbkZvY3VzJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnc3RvcE1vdXNlZG93bicsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdpZ25vcmUnLCBmYWxzZSlcbiAgICBdO1xuXG4gICAgdmFyIEZvY3VzaW5nID0gY3JlYXRlJDEoe1xuICAgICAgZmllbGRzOiBGb2N1c1NjaGVtYSxcbiAgICAgIG5hbWU6ICdmb2N1c2luZycsXG4gICAgICBhY3RpdmU6IEFjdGl2ZUZvY3VzLFxuICAgICAgYXBpczogRm9jdXNBcGlzXG4gICAgfSk7XG5cbiAgICB2YXIgU2V0dXBCZWhhdmlvdXJDZWxsU3RhdGUgPSBmdW5jdGlvbiAoaW5pdGlhbFN0YXRlKSB7XG4gICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNlbGwgPSBDZWxsKGluaXRpYWxTdGF0ZSk7XG4gICAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGNlbGwuZ2V0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAobmV3U3RhdGUpIHtcbiAgICAgICAgICByZXR1cm4gY2VsbC5zZXQobmV3U3RhdGUpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGNlbGwuc2V0KGluaXRpYWxTdGF0ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciByZWFkU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGNlbGwuZ2V0KCk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgICAgY2xlYXI6IGNsZWFyLFxuICAgICAgICAgIHJlYWRTdGF0ZTogcmVhZFN0YXRlXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHsgaW5pdDogaW5pdCB9O1xuICAgIH07XG5cbiAgICB2YXIgdXBkYXRlQXJpYVN0YXRlID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSkge1xuICAgICAgdmFyIGFyaWFJbmZvID0gdG9nZ2xlQ29uZmlnLmFyaWE7XG4gICAgICBhcmlhSW5mby51cGRhdGUoY29tcG9uZW50LCBhcmlhSW5mbywgdG9nZ2xlU3RhdGUuZ2V0KCkpO1xuICAgIH07XG4gICAgdmFyIHVwZGF0ZUNsYXNzID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSkge1xuICAgICAgdG9nZ2xlQ29uZmlnLnRvZ2dsZUNsYXNzLmVhY2goZnVuY3Rpb24gKHRvZ2dsZUNsYXNzKSB7XG4gICAgICAgIGlmICh0b2dnbGVTdGF0ZS5nZXQoKSkge1xuICAgICAgICAgIGFkZCQyKGNvbXBvbmVudC5lbGVtZW50LCB0b2dnbGVDbGFzcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVtb3ZlJDQoY29tcG9uZW50LmVsZW1lbnQsIHRvZ2dsZUNsYXNzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdG9nZ2xlID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSkge1xuICAgICAgc2V0JDYoY29tcG9uZW50LCB0b2dnbGVDb25maWcsIHRvZ2dsZVN0YXRlLCAhdG9nZ2xlU3RhdGUuZ2V0KCkpO1xuICAgIH07XG4gICAgdmFyIG9uJDEgPSBmdW5jdGlvbiAoY29tcG9uZW50LCB0b2dnbGVDb25maWcsIHRvZ2dsZVN0YXRlKSB7XG4gICAgICB0b2dnbGVTdGF0ZS5zZXQodHJ1ZSk7XG4gICAgICB1cGRhdGVDbGFzcyhjb21wb25lbnQsIHRvZ2dsZUNvbmZpZywgdG9nZ2xlU3RhdGUpO1xuICAgICAgdXBkYXRlQXJpYVN0YXRlKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgb2ZmID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSkge1xuICAgICAgdG9nZ2xlU3RhdGUuc2V0KGZhbHNlKTtcbiAgICAgIHVwZGF0ZUNsYXNzKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSk7XG4gICAgICB1cGRhdGVBcmlhU3RhdGUoY29tcG9uZW50LCB0b2dnbGVDb25maWcsIHRvZ2dsZVN0YXRlKTtcbiAgICB9O1xuICAgIHZhciBzZXQkNiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRvZ2dsZUNvbmZpZywgdG9nZ2xlU3RhdGUsIHN0YXRlKSB7XG4gICAgICB2YXIgYWN0aW9uID0gc3RhdGUgPyBvbiQxIDogb2ZmO1xuICAgICAgYWN0aW9uKGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgaXNPbiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRvZ2dsZUNvbmZpZywgdG9nZ2xlU3RhdGUpIHtcbiAgICAgIHJldHVybiB0b2dnbGVTdGF0ZS5nZXQoKTtcbiAgICB9O1xuICAgIHZhciBvbkxvYWQkNCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRvZ2dsZUNvbmZpZywgdG9nZ2xlU3RhdGUpIHtcbiAgICAgIHNldCQ2KGNvbXBvbmVudCwgdG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSwgdG9nZ2xlQ29uZmlnLnNlbGVjdGVkKTtcbiAgICB9O1xuXG4gICAgdmFyIFRvZ2dsZUFwaXMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgb25Mb2FkOiBvbkxvYWQkNCxcbiAgICAgICAgdG9nZ2xlOiB0b2dnbGUsXG4gICAgICAgIGlzT246IGlzT24sXG4gICAgICAgIG9uOiBvbiQxLFxuICAgICAgICBvZmY6IG9mZixcbiAgICAgICAgc2V0OiBzZXQkNlxuICAgIH0pO1xuXG4gICAgdmFyIGV4aGliaXQkMiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBudSQ2KHt9KTtcbiAgICB9O1xuICAgIHZhciBldmVudHMkNiA9IGZ1bmN0aW9uICh0b2dnbGVDb25maWcsIHRvZ2dsZVN0YXRlKSB7XG4gICAgICB2YXIgZXhlY3V0ZSA9IGV4ZWN1dGVFdmVudCh0b2dnbGVDb25maWcsIHRvZ2dsZVN0YXRlLCB0b2dnbGUpO1xuICAgICAgdmFyIGxvYWQgPSBsb2FkRXZlbnQodG9nZ2xlQ29uZmlnLCB0b2dnbGVTdGF0ZSwgb25Mb2FkJDQpO1xuICAgICAgcmV0dXJuIGRlcml2ZShmbGF0dGVuKFtcbiAgICAgICAgdG9nZ2xlQ29uZmlnLnRvZ2dsZU9uRXhlY3V0ZSA/IFtleGVjdXRlXSA6IFtdLFxuICAgICAgICBbbG9hZF1cbiAgICAgIF0pKTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZVRvZ2dsZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBleGhpYml0OiBleGhpYml0JDIsXG4gICAgICAgIGV2ZW50czogZXZlbnRzJDZcbiAgICB9KTtcblxuICAgIHZhciB1cGRhdGVQcmVzc2VkID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgYXJpYUluZm8sIHN0YXR1cykge1xuICAgICAgc2V0JDEoY29tcG9uZW50LmVsZW1lbnQsICdhcmlhLXByZXNzZWQnLCBzdGF0dXMpO1xuICAgICAgaWYgKGFyaWFJbmZvLnN5bmNXaXRoRXhwYW5kZWQpIHtcbiAgICAgICAgdXBkYXRlRXhwYW5kZWQoY29tcG9uZW50LCBhcmlhSW5mbywgc3RhdHVzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB1cGRhdGVTZWxlY3RlZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGFyaWFJbmZvLCBzdGF0dXMpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnYXJpYS1zZWxlY3RlZCcsIHN0YXR1cyk7XG4gICAgfTtcbiAgICB2YXIgdXBkYXRlQ2hlY2tlZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGFyaWFJbmZvLCBzdGF0dXMpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnYXJpYS1jaGVja2VkJywgc3RhdHVzKTtcbiAgICB9O1xuICAgIHZhciB1cGRhdGVFeHBhbmRlZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGFyaWFJbmZvLCBzdGF0dXMpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnYXJpYS1leHBhbmRlZCcsIHN0YXR1cyk7XG4gICAgfTtcblxuICAgIHZhciBUb2dnbGVTY2hlbWEgPSBbXG4gICAgICBkZWZhdWx0ZWQkMSgnc2VsZWN0ZWQnLCBmYWxzZSksXG4gICAgICBvcHRpb24oJ3RvZ2dsZUNsYXNzJyksXG4gICAgICBkZWZhdWx0ZWQkMSgndG9nZ2xlT25FeGVjdXRlJywgdHJ1ZSksXG4gICAgICBkZWZhdWx0ZWRPZignYXJpYScsIHsgbW9kZTogJ25vbmUnIH0sIGNob29zZSQxKCdtb2RlJywge1xuICAgICAgICBwcmVzc2VkOiBbXG4gICAgICAgICAgZGVmYXVsdGVkJDEoJ3N5bmNXaXRoRXhwYW5kZWQnLCBmYWxzZSksXG4gICAgICAgICAgb3V0cHV0KCd1cGRhdGUnLCB1cGRhdGVQcmVzc2VkKVxuICAgICAgICBdLFxuICAgICAgICBjaGVja2VkOiBbb3V0cHV0KCd1cGRhdGUnLCB1cGRhdGVDaGVja2VkKV0sXG4gICAgICAgIGV4cGFuZGVkOiBbb3V0cHV0KCd1cGRhdGUnLCB1cGRhdGVFeHBhbmRlZCldLFxuICAgICAgICBzZWxlY3RlZDogW291dHB1dCgndXBkYXRlJywgdXBkYXRlU2VsZWN0ZWQpXSxcbiAgICAgICAgbm9uZTogW291dHB1dCgndXBkYXRlJywgbm9vcCldXG4gICAgICB9KSlcbiAgICBdO1xuXG4gICAgdmFyIFRvZ2dsaW5nID0gY3JlYXRlJDEoe1xuICAgICAgZmllbGRzOiBUb2dnbGVTY2hlbWEsXG4gICAgICBuYW1lOiAndG9nZ2xpbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVUb2dnbGUsXG4gICAgICBhcGlzOiBUb2dnbGVBcGlzLFxuICAgICAgc3RhdGU6IFNldHVwQmVoYXZpb3VyQ2VsbFN0YXRlKGZhbHNlKVxuICAgIH0pO1xuXG4gICAgdmFyIHBvaW50ZXJFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb25DbGljayA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHNpbXVsYXRlZEV2ZW50LnN0b3AoKTtcbiAgICAgICAgZW1pdEV4ZWN1dGUoY29tcG9uZW50KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gW1xuICAgICAgICBydW4oY2xpY2soKSwgb25DbGljayksXG4gICAgICAgIHJ1bih0YXAoKSwgb25DbGljayksXG4gICAgICAgIGN1dHRlcih0b3VjaHN0YXJ0KCkpLFxuICAgICAgICBjdXR0ZXIobW91c2Vkb3duKCkpXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIGV2ZW50cyQ3ID0gZnVuY3Rpb24gKG9wdEFjdGlvbikge1xuICAgICAgdmFyIGV4ZWN1dGVIYW5kbGVyID0gZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICByZXR1cm4gcnVuT25FeGVjdXRlKGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgYWN0aW9uKGNvbXBvbmVudCk7XG4gICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVyaXZlKGZsYXR0ZW4oW1xuICAgICAgICBvcHRBY3Rpb24ubWFwKGV4ZWN1dGVIYW5kbGVyKS50b0FycmF5KCksXG4gICAgICAgIHBvaW50ZXJFdmVudHMoKVxuICAgICAgXSkpO1xuICAgIH07XG5cbiAgICB2YXIgaG92ZXJFdmVudCA9ICdhbGxveS5pdGVtLWhvdmVyJztcbiAgICB2YXIgZm9jdXNFdmVudCA9ICdhbGxveS5pdGVtLWZvY3VzJztcbiAgICB2YXIgb25Ib3ZlciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpZiAoc2VhcmNoKGl0ZW0uZWxlbWVudCkuaXNOb25lKCkgfHwgRm9jdXNpbmcuaXNGb2N1c2VkKGl0ZW0pKSB7XG4gICAgICAgIGlmICghRm9jdXNpbmcuaXNGb2N1c2VkKGl0ZW0pKSB7XG4gICAgICAgICAgRm9jdXNpbmcuZm9jdXMoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgZW1pdFdpdGgoaXRlbSwgaG92ZXJFdmVudCwgeyBpdGVtOiBpdGVtIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG9uRm9jdXMgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgZW1pdFdpdGgoaXRlbSwgZm9jdXNFdmVudCwgeyBpdGVtOiBpdGVtIH0pO1xuICAgIH07XG4gICAgdmFyIGhvdmVyID0gY29uc3RhbnQoaG92ZXJFdmVudCk7XG4gICAgdmFyIGZvY3VzJDMgPSBjb25zdGFudChmb2N1c0V2ZW50KTtcblxuICAgIHZhciBidWlsZGVyID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZXRhaWwuZG9tTW9kaWZpY2F0aW9uKSwgeyBhdHRyaWJ1dGVzOiBfX2Fzc2lnbihfX2Fzc2lnbihfX2Fzc2lnbih7ICdyb2xlJzogZGV0YWlsLnRvZ2dsaW5nLmlzU29tZSgpID8gJ21lbnVpdGVtY2hlY2tib3gnIDogJ21lbnVpdGVtJyB9LCBkZXRhaWwuZG9tTW9kaWZpY2F0aW9uLmF0dHJpYnV0ZXMpLCB7ICdhcmlhLWhhc3BvcHVwJzogZGV0YWlsLmhhc1N1Ym1lbnUgfSksIGRldGFpbC5oYXNTdWJtZW51ID8geyAnYXJpYS1leHBhbmRlZCc6IGZhbHNlIH0gOiB7fSkgfSksXG4gICAgICAgIGJlaGF2aW91cnM6IFNrZXRjaEJlaGF2aW91cnMuYXVnbWVudChkZXRhaWwuaXRlbUJlaGF2aW91cnMsIFtcbiAgICAgICAgICBkZXRhaWwudG9nZ2xpbmcuZm9sZChUb2dnbGluZy5yZXZva2UsIGZ1bmN0aW9uICh0Q29uZmlnKSB7XG4gICAgICAgICAgICByZXR1cm4gVG9nZ2xpbmcuY29uZmlnKF9fYXNzaWduKHsgYXJpYTogeyBtb2RlOiAnY2hlY2tlZCcgfSB9LCB0Q29uZmlnKSk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGlnbm9yZTogZGV0YWlsLmlnbm9yZUZvY3VzLFxuICAgICAgICAgICAgc3RvcE1vdXNlZG93bjogZGV0YWlsLmlnbm9yZUZvY3VzLFxuICAgICAgICAgICAgb25Gb2N1czogZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgICBvbkZvY3VzKGNvbXBvbmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyh7IG1vZGU6ICdleGVjdXRpb24nIH0pLFxuICAgICAgICAgIFJlcHJlc2VudGluZy5jb25maWcoe1xuICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgbW9kZTogJ21lbW9yeScsXG4gICAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogZGV0YWlsLmRhdGFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjb25maWcoJ2l0ZW0tdHlwZS1ldmVudHMnLCBfX3NwcmVhZEFycmF5cyhwb2ludGVyRXZlbnRzKCksIFtcbiAgICAgICAgICAgIHJ1bihtb3VzZW92ZXIoKSwgb25Ib3ZlciksXG4gICAgICAgICAgICBydW4oZm9jdXNJdGVtKCksIEZvY3VzaW5nLmZvY3VzKVxuICAgICAgICAgIF0pKVxuICAgICAgICBdKSxcbiAgICAgICAgY29tcG9uZW50czogZGV0YWlsLmNvbXBvbmVudHMsXG4gICAgICAgIGV2ZW50T3JkZXI6IGRldGFpbC5ldmVudE9yZGVyXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNjaGVtYSRhID0gW1xuICAgICAgc3RyaWN0JDEoJ2RhdGEnKSxcbiAgICAgIHN0cmljdCQxKCdjb21wb25lbnRzJyksXG4gICAgICBzdHJpY3QkMSgnZG9tJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnaGFzU3VibWVudScsIGZhbHNlKSxcbiAgICAgIG9wdGlvbigndG9nZ2xpbmcnKSxcbiAgICAgIFNrZXRjaEJlaGF2aW91cnMuZmllbGQoJ2l0ZW1CZWhhdmlvdXJzJywgW1xuICAgICAgICBUb2dnbGluZyxcbiAgICAgICAgRm9jdXNpbmcsXG4gICAgICAgIEtleWluZyxcbiAgICAgICAgUmVwcmVzZW50aW5nXG4gICAgICBdKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdpZ25vcmVGb2N1cycsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdkb21Nb2RpZmljYXRpb24nLCB7fSksXG4gICAgICBvdXRwdXQoJ2J1aWxkZXInLCBidWlsZGVyKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdldmVudE9yZGVyJywge30pXG4gICAgXTtcblxuICAgIHZhciBidWlsZGVyJDEgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGRldGFpbC5jb21wb25lbnRzLFxuICAgICAgICBldmVudHM6IGRlcml2ZShbc3RvcHBlcihmb2N1c0l0ZW0oKSldKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzY2hlbWEkYiA9IFtcbiAgICAgIHN0cmljdCQxKCdkb20nKSxcbiAgICAgIHN0cmljdCQxKCdjb21wb25lbnRzJyksXG4gICAgICBvdXRwdXQoJ2J1aWxkZXInLCBidWlsZGVyJDEpXG4gICAgXTtcblxuICAgIHZhciBvd25lciQyID0gY29uc3RhbnQoJ2l0ZW0td2lkZ2V0Jyk7XG4gICAgdmFyIHBhcnRzID0gY29uc3RhbnQoW3JlcXVpcmVkKHtcbiAgICAgICAgbmFtZTogJ3dpZGdldCcsXG4gICAgICAgIG92ZXJyaWRlczogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgICAgIG1vZGU6ICdtYW51YWwnLFxuICAgICAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIChfY29tcG9uZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXRhaWwuZGF0YTtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBzZXRWYWx1ZTogbm9vcFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSldKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pXSk7XG5cbiAgICB2YXIgYnVpbGRlciQyID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgdmFyIHN1YnMgPSBzdWJzdGl0dXRlcyhvd25lciQyKCksIGRldGFpbCwgcGFydHMoKSk7XG4gICAgICB2YXIgY29tcG9uZW50cyQxID0gY29tcG9uZW50cyhvd25lciQyKCksIGRldGFpbCwgc3Vicy5pbnRlcm5hbHMoKSk7XG4gICAgICB2YXIgZm9jdXNXaWRnZXQgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQYXJ0KGNvbXBvbmVudCwgZGV0YWlsLCAnd2lkZ2V0JykubWFwKGZ1bmN0aW9uICh3aWRnZXQpIHtcbiAgICAgICAgICBLZXlpbmcuZm9jdXNJbih3aWRnZXQpO1xuICAgICAgICAgIHJldHVybiB3aWRnZXQ7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkhvcml6b250YWxBcnJvdyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHJldHVybiBpbnNpZGUoc2ltdWxhdGVkRXZlbnQuZXZlbnQudGFyZ2V0KSA/IE9wdGlvbmFsLm5vbmUoKSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoZGV0YWlsLmF1dG9mb2N1cykge1xuICAgICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc2V0U291cmNlKGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzJDEsXG4gICAgICAgIGRvbU1vZGlmaWNhdGlvbjogZGV0YWlsLmRvbU1vZGlmaWNhdGlvbixcbiAgICAgICAgZXZlbnRzOiBkZXJpdmUoW1xuICAgICAgICAgIHJ1bk9uRXhlY3V0ZShmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgZm9jdXNXaWRnZXQoY29tcG9uZW50KS5lYWNoKGZ1bmN0aW9uIChfd2lkZ2V0KSB7XG4gICAgICAgICAgICAgIHNpbXVsYXRlZEV2ZW50LnN0b3AoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bihtb3VzZW92ZXIoKSwgb25Ib3ZlciksXG4gICAgICAgICAgcnVuKGZvY3VzSXRlbSgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBfc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChkZXRhaWwuYXV0b2ZvY3VzKSB7XG4gICAgICAgICAgICAgIGZvY3VzV2lkZ2V0KGNvbXBvbmVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBGb2N1c2luZy5mb2N1cyhjb21wb25lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pLFxuICAgICAgICBiZWhhdmlvdXJzOiBTa2V0Y2hCZWhhdmlvdXJzLmF1Z21lbnQoZGV0YWlsLndpZGdldEJlaGF2aW91cnMsIFtcbiAgICAgICAgICBSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIG1vZGU6ICdtZW1vcnknLFxuICAgICAgICAgICAgICBpbml0aWFsVmFsdWU6IGRldGFpbC5kYXRhXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGlnbm9yZTogZGV0YWlsLmlnbm9yZUZvY3VzLFxuICAgICAgICAgICAgb25Gb2N1czogZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgICBvbkZvY3VzKGNvbXBvbmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnc3BlY2lhbCcsXG4gICAgICAgICAgICBmb2N1c0luOiBkZXRhaWwuYXV0b2ZvY3VzID8gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgICBmb2N1c1dpZGdldChjb21wb25lbnQpO1xuICAgICAgICAgICAgfSA6IHJldm9rZSgpLFxuICAgICAgICAgICAgb25MZWZ0OiBvbkhvcml6b250YWxBcnJvdyxcbiAgICAgICAgICAgIG9uUmlnaHQ6IG9uSG9yaXpvbnRhbEFycm93LFxuICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICAgIGlmICghRm9jdXNpbmcuaXNGb2N1c2VkKGNvbXBvbmVudCkgJiYgIWRldGFpbC5hdXRvZm9jdXMpIHtcbiAgICAgICAgICAgICAgICBGb2N1c2luZy5mb2N1cyhjb21wb25lbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRldGFpbC5hdXRvZm9jdXMpIHtcbiAgICAgICAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zZXRTb3VyY2UoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNjaGVtYSRjID0gW1xuICAgICAgc3RyaWN0JDEoJ3VpZCcpLFxuICAgICAgc3RyaWN0JDEoJ2RhdGEnKSxcbiAgICAgIHN0cmljdCQxKCdjb21wb25lbnRzJyksXG4gICAgICBzdHJpY3QkMSgnZG9tJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnYXV0b2ZvY3VzJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2lnbm9yZUZvY3VzJywgZmFsc2UpLFxuICAgICAgU2tldGNoQmVoYXZpb3Vycy5maWVsZCgnd2lkZ2V0QmVoYXZpb3VycycsIFtcbiAgICAgICAgUmVwcmVzZW50aW5nLFxuICAgICAgICBGb2N1c2luZyxcbiAgICAgICAgS2V5aW5nXG4gICAgICBdKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdkb21Nb2RpZmljYXRpb24nLCB7fSksXG4gICAgICBkZWZhdWx0VWlkc1NjaGVtYShwYXJ0cygpKSxcbiAgICAgIG91dHB1dCgnYnVpbGRlcicsIGJ1aWxkZXIkMilcbiAgICBdO1xuXG4gICAgdmFyIGl0ZW1TY2hlbWEkMSA9IGNob29zZSQxKCd0eXBlJywge1xuICAgICAgd2lkZ2V0OiBzY2hlbWEkYyxcbiAgICAgIGl0ZW06IHNjaGVtYSRhLFxuICAgICAgc2VwYXJhdG9yOiBzY2hlbWEkYlxuICAgIH0pO1xuICAgIHZhciBjb25maWd1cmVHcmlkID0gZnVuY3Rpb24gKGRldGFpbCwgbW92ZW1lbnRJbmZvKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RlOiAnZmxhdGdyaWQnLFxuICAgICAgICBzZWxlY3RvcjogJy4nICsgZGV0YWlsLm1hcmtlcnMuaXRlbSxcbiAgICAgICAgaW5pdFNpemU6IHtcbiAgICAgICAgICBudW1Db2x1bW5zOiBtb3ZlbWVudEluZm8uaW5pdFNpemUubnVtQ29sdW1ucyxcbiAgICAgICAgICBudW1Sb3dzOiBtb3ZlbWVudEluZm8uaW5pdFNpemUubnVtUm93c1xuICAgICAgICB9LFxuICAgICAgICBmb2N1c01hbmFnZXI6IGRldGFpbC5mb2N1c01hbmFnZXJcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29uZmlndXJlTWF0cml4ID0gZnVuY3Rpb24gKGRldGFpbCwgbW92ZW1lbnRJbmZvKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb2RlOiAnbWF0cml4JyxcbiAgICAgICAgc2VsZWN0b3JzOiB7XG4gICAgICAgICAgcm93OiBtb3ZlbWVudEluZm8ucm93U2VsZWN0b3IsXG4gICAgICAgICAgY2VsbDogJy4nICsgZGV0YWlsLm1hcmtlcnMuaXRlbVxuICAgICAgICB9LFxuICAgICAgICBmb2N1c01hbmFnZXI6IGRldGFpbC5mb2N1c01hbmFnZXJcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29uZmlndXJlTWVudSA9IGZ1bmN0aW9uIChkZXRhaWwsIG1vdmVtZW50SW5mbykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kZTogJ21lbnUnLFxuICAgICAgICBzZWxlY3RvcjogJy4nICsgZGV0YWlsLm1hcmtlcnMuaXRlbSxcbiAgICAgICAgbW92ZU9uVGFiOiBtb3ZlbWVudEluZm8ubW92ZU9uVGFiLFxuICAgICAgICBmb2N1c01hbmFnZXI6IGRldGFpbC5mb2N1c01hbmFnZXJcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcGFydHMkMSA9IGNvbnN0YW50KFtncm91cCh7XG4gICAgICAgIGZhY3Rvcnk6IHtcbiAgICAgICAgICBza2V0Y2g6IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgICAgICB2YXIgaXRlbUluZm8gPSBhc1Jhd09yRGllKCdtZW51LnNwZWMgaXRlbScsIGl0ZW1TY2hlbWEkMSwgc3BlYyk7XG4gICAgICAgICAgICByZXR1cm4gaXRlbUluZm8uYnVpbGRlcihpdGVtSW5mbyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBuYW1lOiAnaXRlbXMnLFxuICAgICAgICB1bml0OiAnaXRlbScsXG4gICAgICAgIGRlZmF1bHRzOiBmdW5jdGlvbiAoZGV0YWlsLCB1KSB7XG4gICAgICAgICAgcmV0dXJuIHUuaGFzT3duUHJvcGVydHkoJ3VpZCcpID8gdSA6IF9fYXNzaWduKF9fYXNzaWduKHt9LCB1KSwgeyB1aWQ6IGdlbmVyYXRlJDIoJ2l0ZW0nKSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiAoZGV0YWlsLCB1KSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IHUudHlwZSxcbiAgICAgICAgICAgIGlnbm9yZUZvY3VzOiBkZXRhaWwuZmFrZUZvY3VzLFxuICAgICAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IGNsYXNzZXM6IFtkZXRhaWwubWFya2Vycy5pdGVtXSB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSldKTtcbiAgICB2YXIgc2NoZW1hJGQgPSBjb25zdGFudChbXG4gICAgICBzdHJpY3QkMSgndmFsdWUnKSxcbiAgICAgIHN0cmljdCQxKCdpdGVtcycpLFxuICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgc3RyaWN0JDEoJ2NvbXBvbmVudHMnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdldmVudE9yZGVyJywge30pLFxuICAgICAgZmllbGQkMSgnbWVudUJlaGF2aW91cnMnLCBbXG4gICAgICAgIEhpZ2hsaWdodGluZyxcbiAgICAgICAgUmVwcmVzZW50aW5nLFxuICAgICAgICBDb21wb3NpbmcsXG4gICAgICAgIEtleWluZ1xuICAgICAgXSksXG4gICAgICBkZWZhdWx0ZWRPZignbW92ZW1lbnQnLCB7XG4gICAgICAgIG1vZGU6ICdtZW51JyxcbiAgICAgICAgbW92ZU9uVGFiOiB0cnVlXG4gICAgICB9LCBjaG9vc2UkMSgnbW9kZScsIHtcbiAgICAgICAgZ3JpZDogW1xuICAgICAgICAgIGluaXRTaXplKCksXG4gICAgICAgICAgb3V0cHV0KCdjb25maWcnLCBjb25maWd1cmVHcmlkKVxuICAgICAgICBdLFxuICAgICAgICBtYXRyaXg6IFtcbiAgICAgICAgICBvdXRwdXQoJ2NvbmZpZycsIGNvbmZpZ3VyZU1hdHJpeCksXG4gICAgICAgICAgc3RyaWN0JDEoJ3Jvd1NlbGVjdG9yJylcbiAgICAgICAgXSxcbiAgICAgICAgbWVudTogW1xuICAgICAgICAgIGRlZmF1bHRlZCQxKCdtb3ZlT25UYWInLCB0cnVlKSxcbiAgICAgICAgICBvdXRwdXQoJ2NvbmZpZycsIGNvbmZpZ3VyZU1lbnUpXG4gICAgICAgIF1cbiAgICAgIH0pKSxcbiAgICAgIGl0ZW1NYXJrZXJzKCksXG4gICAgICBkZWZhdWx0ZWQkMSgnZmFrZUZvY3VzJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2ZvY3VzTWFuYWdlcicsIGRvbSgpKSxcbiAgICAgIG9uSGFuZGxlcignb25IaWdobGlnaHQnKVxuICAgIF0pO1xuXG4gICAgdmFyIGZvY3VzJDQgPSBjb25zdGFudCgnYWxsb3kubWVudS1mb2N1cycpO1xuXG4gICAgdmFyIG1ha2UkMSA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMsIF9zcGVjLCBfZXh0ZXJuYWxzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgbWFya2VyczogZGV0YWlsLm1hcmtlcnMsXG4gICAgICAgIGJlaGF2aW91cnM6IGF1Z21lbnQoZGV0YWlsLm1lbnVCZWhhdmlvdXJzLCBbXG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBoaWdobGlnaHRDbGFzczogZGV0YWlsLm1hcmtlcnMuc2VsZWN0ZWRJdGVtLFxuICAgICAgICAgICAgaXRlbUNsYXNzOiBkZXRhaWwubWFya2Vycy5pdGVtLFxuICAgICAgICAgICAgb25IaWdobGlnaHQ6IGRldGFpbC5vbkhpZ2hsaWdodFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFJlcHJlc2VudGluZy5jb25maWcoe1xuICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgbW9kZTogJ21lbW9yeScsXG4gICAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogZGV0YWlsLnZhbHVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7IGZpbmQ6IE9wdGlvbmFsLnNvbWUgfSksXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyhkZXRhaWwubW92ZW1lbnQuY29uZmlnKGRldGFpbCwgZGV0YWlsLm1vdmVtZW50KSlcbiAgICAgICAgXSksXG4gICAgICAgIGV2ZW50czogZGVyaXZlKFtcbiAgICAgICAgICBydW4oZm9jdXMkMygpLCBmdW5jdGlvbiAobWVudSwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBldmVudCA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50O1xuICAgICAgICAgICAgbWVudS5nZXRTeXN0ZW0oKS5nZXRCeURvbShldmVudC50YXJnZXQpLmVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgSGlnaGxpZ2h0aW5nLmhpZ2hsaWdodChtZW51LCBpdGVtKTtcbiAgICAgICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICAgICAgICBlbWl0V2l0aChtZW51LCBmb2N1cyQ0KCksIHtcbiAgICAgICAgICAgICAgICBtZW51OiBtZW51LFxuICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBydW4oaG92ZXIoKSwgZnVuY3Rpb24gKG1lbnUsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50Lml0ZW07XG4gICAgICAgICAgICBIaWdobGlnaHRpbmcuaGlnaGxpZ2h0KG1lbnUsIGl0ZW0pO1xuICAgICAgICAgIH0pXG4gICAgICAgIF0pLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxuICAgICAgICBldmVudE9yZGVyOiBkZXRhaWwuZXZlbnRPcmRlcixcbiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IGF0dHJpYnV0ZXM6IHsgcm9sZTogJ21lbnUnIH0gfVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIE1lbnUgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnTWVudScsXG4gICAgICBjb25maWdGaWVsZHM6IHNjaGVtYSRkKCksXG4gICAgICBwYXJ0RmllbGRzOiBwYXJ0cyQxKCksXG4gICAgICBmYWN0b3J5OiBtYWtlJDFcbiAgICB9KTtcblxuICAgIHZhciB0cmFuc3Bvc2UgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gdHVwbGVNYXAob2JqLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGs6IHYsXG4gICAgICAgICAgdjoga1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdHJhY2UgPSBmdW5jdGlvbiAoaXRlbXMsIGJ5SXRlbSwgYnlNZW51LCBmaW5pc2gpIHtcbiAgICAgIHJldHVybiBnZXQkMShieU1lbnUsIGZpbmlzaCkuYmluZChmdW5jdGlvbiAodHJpZ2dlckl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGdldCQxKGl0ZW1zLCB0cmlnZ2VySXRlbSkuYmluZChmdW5jdGlvbiAodHJpZ2dlck1lbnUpIHtcbiAgICAgICAgICB2YXIgcmVzdCA9IHRyYWNlKGl0ZW1zLCBieUl0ZW0sIGJ5TWVudSwgdHJpZ2dlck1lbnUpO1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKFt0cmlnZ2VyTWVudV0uY29uY2F0KHJlc3QpKTtcbiAgICAgICAgfSk7XG4gICAgICB9KS5nZXRPcihbXSk7XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGUkNSA9IGZ1bmN0aW9uIChtZW51cywgZXhwYW5zaW9ucykge1xuICAgICAgdmFyIGl0ZW1zID0ge307XG4gICAgICBlYWNoJDEobWVudXMsIGZ1bmN0aW9uIChtZW51SXRlbXMsIG1lbnUpIHtcbiAgICAgICAgZWFjaChtZW51SXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgaXRlbXNbaXRlbV0gPSBtZW51O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGJ5SXRlbSA9IGV4cGFuc2lvbnM7XG4gICAgICB2YXIgYnlNZW51ID0gdHJhbnNwb3NlKGV4cGFuc2lvbnMpO1xuICAgICAgdmFyIG1lbnVQYXRocyA9IG1hcCQyKGJ5TWVudSwgZnVuY3Rpb24gKF90cmlnZ2VySXRlbSwgc3VibWVudSkge1xuICAgICAgICByZXR1cm4gW3N1Ym1lbnVdLmNvbmNhdCh0cmFjZShpdGVtcywgYnlJdGVtLCBieU1lbnUsIHN1Ym1lbnUpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1hcCQyKGl0ZW1zLCBmdW5jdGlvbiAobWVudSkge1xuICAgICAgICByZXR1cm4gZ2V0JDEobWVudVBhdGhzLCBtZW51KS5nZXRPcihbbWVudV0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBpbml0JDMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZXhwYW5zaW9ucyA9IENlbGwoe30pO1xuICAgICAgdmFyIG1lbnVzID0gQ2VsbCh7fSk7XG4gICAgICB2YXIgcGF0aHMgPSBDZWxsKHt9KTtcbiAgICAgIHZhciBwcmltYXJ5ID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIGRpcmVjdG9yeSA9IENlbGwoe30pO1xuICAgICAgdmFyIGNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBhbnNpb25zLnNldCh7fSk7XG4gICAgICAgIG1lbnVzLnNldCh7fSk7XG4gICAgICAgIHBhdGhzLnNldCh7fSk7XG4gICAgICAgIHByaW1hcnkuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzQ2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcmltYXJ5LmdldCgpLmlzTm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXRNZW51QnVpbHQgPSBmdW5jdGlvbiAobWVudU5hbWUsIGJ1aWx0KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgbWVudXMuc2V0KF9fYXNzaWduKF9fYXNzaWduKHt9LCBtZW51cy5nZXQoKSksIChfYSA9IHt9LCBfYVttZW51TmFtZV0gPSB7XG4gICAgICAgICAgdHlwZTogJ3ByZXBhcmVkJyxcbiAgICAgICAgICBtZW51OiBidWlsdFxuICAgICAgICB9LCBfYSkpKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0Q29udGVudHMgPSBmdW5jdGlvbiAoc1ByaW1hcnksIHNNZW51cywgc0V4cGFuc2lvbnMsIGRpcikge1xuICAgICAgICBwcmltYXJ5LnNldChPcHRpb25hbC5zb21lKHNQcmltYXJ5KSk7XG4gICAgICAgIGV4cGFuc2lvbnMuc2V0KHNFeHBhbnNpb25zKTtcbiAgICAgICAgbWVudXMuc2V0KHNNZW51cyk7XG4gICAgICAgIGRpcmVjdG9yeS5zZXQoZGlyKTtcbiAgICAgICAgdmFyIHNQYXRocyA9IGdlbmVyYXRlJDUoZGlyLCBzRXhwYW5zaW9ucyk7XG4gICAgICAgIHBhdGhzLnNldChzUGF0aHMpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRUcmlnZ2VyaW5nSXRlbSA9IGZ1bmN0aW9uIChtZW51VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGZpbmQkMShleHBhbnNpb25zLmdldCgpLCBmdW5jdGlvbiAodiwgX2spIHtcbiAgICAgICAgICByZXR1cm4gdiA9PT0gbWVudVZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VHJpZ2dlckRhdGEgPSBmdW5jdGlvbiAobWVudVZhbHVlLCBnZXRJdGVtQnlWYWx1ZSwgcGF0aCkge1xuICAgICAgICByZXR1cm4gZ2V0UHJlcGFyZWRNZW51KG1lbnVWYWx1ZSkuYmluZChmdW5jdGlvbiAobWVudSkge1xuICAgICAgICAgIHJldHVybiBnZXRUcmlnZ2VyaW5nSXRlbShtZW51VmFsdWUpLmJpbmQoZnVuY3Rpb24gKHRyaWdnZXJpbmdJdGVtVmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRJdGVtQnlWYWx1ZSh0cmlnZ2VyaW5nSXRlbVZhbHVlKS5tYXAoZnVuY3Rpb24gKHRyaWdnZXJlZEl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyZWRNZW51OiBtZW51LFxuICAgICAgICAgICAgICAgIHRyaWdnZXJpbmdJdGVtOiB0cmlnZ2VyZWRJdGVtLFxuICAgICAgICAgICAgICAgIHRyaWdnZXJpbmdQYXRoOiBwYXRoXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFRyaWdnZXJpbmdQYXRoID0gZnVuY3Rpb24gKGl0ZW1WYWx1ZSwgZ2V0SXRlbUJ5VmFsdWUpIHtcbiAgICAgICAgdmFyIGV4dHJhUGF0aCA9IGZpbHRlcihsb29rdXBJdGVtKGl0ZW1WYWx1ZSkudG9BcnJheSgpLCBmdW5jdGlvbiAobWVudVZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIGdldFByZXBhcmVkTWVudShtZW51VmFsdWUpLmlzU29tZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGdldCQxKHBhdGhzLmdldCgpLCBpdGVtVmFsdWUpLmJpbmQoZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICB2YXIgcmV2UGF0aCA9IHJldmVyc2UoZXh0cmFQYXRoLmNvbmNhdChwYXRoKSk7XG4gICAgICAgICAgdmFyIHRyaWdnZXJzID0gYmluZChyZXZQYXRoLCBmdW5jdGlvbiAobWVudVZhbHVlLCBtZW51SW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUcmlnZ2VyRGF0YShtZW51VmFsdWUsIGdldEl0ZW1CeVZhbHVlLCByZXZQYXRoLnNsaWNlKDAsIG1lbnVJbmRleCArIDEpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHByaW1hcnkuZ2V0KCkuaXMobWVudVZhbHVlKSA/IFtdIDogW09wdGlvbmFsLm5vbmUoKV07XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICByZXR1cm4gW09wdGlvbmFsLnNvbWUoZGF0YSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHNlcXVlbmNlKHRyaWdnZXJzKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGV4cGFuZCA9IGZ1bmN0aW9uIChpdGVtVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGdldCQxKGV4cGFuc2lvbnMuZ2V0KCksIGl0ZW1WYWx1ZSkubWFwKGZ1bmN0aW9uIChtZW51KSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnQgPSBnZXQkMShwYXRocy5nZXQoKSwgaXRlbVZhbHVlKS5nZXRPcihbXSk7XG4gICAgICAgICAgcmV0dXJuIFttZW51XS5jb25jYXQoY3VycmVudCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjb2xsYXBzZSA9IGZ1bmN0aW9uIChpdGVtVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGdldCQxKHBhdGhzLmdldCgpLCBpdGVtVmFsdWUpLmJpbmQoZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICByZXR1cm4gcGF0aC5sZW5ndGggPiAxID8gT3B0aW9uYWwuc29tZShwYXRoLnNsaWNlKDEpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlZnJlc2ggPSBmdW5jdGlvbiAoaXRlbVZhbHVlKSB7XG4gICAgICAgIHJldHVybiBnZXQkMShwYXRocy5nZXQoKSwgaXRlbVZhbHVlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0UHJlcGFyZWRNZW51ID0gZnVuY3Rpb24gKG1lbnVWYWx1ZSkge1xuICAgICAgICByZXR1cm4gbG9va3VwTWVudShtZW51VmFsdWUpLmJpbmQoZXh0cmFjdFByZXBhcmVkTWVudSk7XG4gICAgICB9O1xuICAgICAgdmFyIGxvb2t1cE1lbnUgPSBmdW5jdGlvbiAobWVudVZhbHVlKSB7XG4gICAgICAgIHJldHVybiBnZXQkMShtZW51cy5nZXQoKSwgbWVudVZhbHVlKTtcbiAgICAgIH07XG4gICAgICB2YXIgbG9va3VwSXRlbSA9IGZ1bmN0aW9uIChpdGVtVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGdldCQxKGV4cGFuc2lvbnMuZ2V0KCksIGl0ZW1WYWx1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIG90aGVyTWVudXMgPSBmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICB2YXIgbWVudVZhbHVlcyA9IGRpcmVjdG9yeS5nZXQoKTtcbiAgICAgICAgcmV0dXJuIGRpZmZlcmVuY2Uoa2V5cyhtZW51VmFsdWVzKSwgcGF0aCk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFByaW1hcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcmltYXJ5LmdldCgpLmJpbmQoZ2V0UHJlcGFyZWRNZW51KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0TWVudXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtZW51cy5nZXQoKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXRNZW51QnVpbHQ6IHNldE1lbnVCdWlsdCxcbiAgICAgICAgc2V0Q29udGVudHM6IHNldENvbnRlbnRzLFxuICAgICAgICBleHBhbmQ6IGV4cGFuZCxcbiAgICAgICAgcmVmcmVzaDogcmVmcmVzaCxcbiAgICAgICAgY29sbGFwc2U6IGNvbGxhcHNlLFxuICAgICAgICBsb29rdXBNZW51OiBsb29rdXBNZW51LFxuICAgICAgICBsb29rdXBJdGVtOiBsb29rdXBJdGVtLFxuICAgICAgICBvdGhlck1lbnVzOiBvdGhlck1lbnVzLFxuICAgICAgICBnZXRQcmltYXJ5OiBnZXRQcmltYXJ5LFxuICAgICAgICBnZXRNZW51czogZ2V0TWVudXMsXG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgaXNDbGVhcjogaXNDbGVhcixcbiAgICAgICAgZ2V0VHJpZ2dlcmluZ1BhdGg6IGdldFRyaWdnZXJpbmdQYXRoXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGV4dHJhY3RQcmVwYXJlZE1lbnUgPSBmdW5jdGlvbiAocHJlcCkge1xuICAgICAgcmV0dXJuIHByZXAudHlwZSA9PT0gJ3ByZXBhcmVkJyA/IE9wdGlvbmFsLnNvbWUocHJlcC5tZW51KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBMYXllcmVkU3RhdGUgPSB7XG4gICAgICBpbml0OiBpbml0JDMsXG4gICAgICBleHRyYWN0UHJlcGFyZWRNZW51OiBleHRyYWN0UHJlcGFyZWRNZW51XG4gICAgfTtcblxuICAgIHZhciBtYWtlJDIgPSBmdW5jdGlvbiAoZGV0YWlsLCBfcmF3VWlTcGVjKSB7XG4gICAgICB2YXIgc3VibWVudVBhcmVudEl0ZW1zID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIGJ1aWxkTWVudXMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBwcmltYXJ5TmFtZSwgbWVudXMpIHtcbiAgICAgICAgcmV0dXJuIG1hcCQyKG1lbnVzLCBmdW5jdGlvbiAoc3BlYywgbmFtZSkge1xuICAgICAgICAgIHZhciBtYWtlU2tldGNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIE1lbnUuc2tldGNoKF9fYXNzaWduKF9fYXNzaWduKHt9LCBzcGVjKSwge1xuICAgICAgICAgICAgICB2YWx1ZTogbmFtZSxcbiAgICAgICAgICAgICAgbWFya2VyczogZGV0YWlsLm1hcmtlcnMsXG4gICAgICAgICAgICAgIGZha2VGb2N1czogZGV0YWlsLmZha2VGb2N1cyxcbiAgICAgICAgICAgICAgb25IaWdobGlnaHQ6IGRldGFpbC5vbkhpZ2hsaWdodCxcbiAgICAgICAgICAgICAgZm9jdXNNYW5hZ2VyOiBkZXRhaWwuZmFrZUZvY3VzID8gaGlnaGxpZ2h0cygpIDogZG9tKClcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiBuYW1lID09PSBwcmltYXJ5TmFtZSA/IHtcbiAgICAgICAgICAgIHR5cGU6ICdwcmVwYXJlZCcsXG4gICAgICAgICAgICBtZW51OiBjb250YWluZXIuZ2V0U3lzdGVtKCkuYnVpbGQobWFrZVNrZXRjaCgpKVxuICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICB0eXBlOiAnbm90YnVpbHQnLFxuICAgICAgICAgICAgbmJNZW51OiBtYWtlU2tldGNoXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGxheWVyZWRTdGF0ZSA9IExheWVyZWRTdGF0ZS5pbml0KCk7XG4gICAgICB2YXIgc2V0dXAgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgIHZhciBjb21wb25lbnRNYXAgPSBidWlsZE1lbnVzKGNvbnRhaW5lciwgZGV0YWlsLmRhdGEucHJpbWFyeSwgZGV0YWlsLmRhdGEubWVudXMpO1xuICAgICAgICB2YXIgZGlyZWN0b3J5ID0gdG9EaXJlY3RvcnkoKTtcbiAgICAgICAgbGF5ZXJlZFN0YXRlLnNldENvbnRlbnRzKGRldGFpbC5kYXRhLnByaW1hcnksIGNvbXBvbmVudE1hcCwgZGV0YWlsLmRhdGEuZXhwYW5zaW9ucywgZGlyZWN0b3J5KTtcbiAgICAgICAgcmV0dXJuIGxheWVyZWRTdGF0ZS5nZXRQcmltYXJ5KCk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldEl0ZW1WYWx1ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoaXRlbSkudmFsdWU7XG4gICAgICB9O1xuICAgICAgdmFyIGdldEl0ZW1CeVZhbHVlID0gZnVuY3Rpb24gKF9jb250YWluZXIsIG1lbnVzLCBpdGVtVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRNYXAobWVudXMsIGZ1bmN0aW9uIChtZW51KSB7XG4gICAgICAgICAgaWYgKCFtZW51LmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBjYW5kaWRhdGVzID0gSGlnaGxpZ2h0aW5nLmdldENhbmRpZGF0ZXMobWVudSk7XG4gICAgICAgICAgcmV0dXJuIGZpbmQoY2FuZGlkYXRlcywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRJdGVtVmFsdWUoYykgPT09IGl0ZW1WYWx1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHRvRGlyZWN0b3J5ID0gZnVuY3Rpb24gKF9jb250YWluZXIpIHtcbiAgICAgICAgcmV0dXJuIG1hcCQyKGRldGFpbC5kYXRhLm1lbnVzLCBmdW5jdGlvbiAoZGF0YSwgX21lbnVOYW1lKSB7XG4gICAgICAgICAgcmV0dXJuIGJpbmQoZGF0YS5pdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT09ICdzZXBhcmF0b3InID8gW10gOiBbaXRlbS5kYXRhLnZhbHVlXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldEFjdGl2ZU1lbnUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBtZW51KSB7XG4gICAgICAgIEhpZ2hsaWdodGluZy5oaWdobGlnaHQoY29udGFpbmVyLCBtZW51KTtcbiAgICAgICAgSGlnaGxpZ2h0aW5nLmdldEhpZ2hsaWdodGVkKG1lbnUpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBIaWdobGlnaHRpbmcuZ2V0Rmlyc3QobWVudSk7XG4gICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICBkaXNwYXRjaChjb250YWluZXIsIGl0ZW0uZWxlbWVudCwgZm9jdXNJdGVtKCkpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0TWVudXMgPSBmdW5jdGlvbiAoc3RhdGUsIG1lbnVWYWx1ZXMpIHtcbiAgICAgICAgcmV0dXJuIGNhdChtYXAobWVudVZhbHVlcywgZnVuY3Rpb24gKG12KSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmxvb2t1cE1lbnUobXYpLmJpbmQoZnVuY3Rpb24gKHByZXApIHtcbiAgICAgICAgICAgIHJldHVybiBwcmVwLnR5cGUgPT09ICdwcmVwYXJlZCcgPyBPcHRpb25hbC5zb21lKHByZXAubWVudSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xvc2VPdGhlcnMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBzdGF0ZSwgcGF0aCkge1xuICAgICAgICB2YXIgb3RoZXJzID0gZ2V0TWVudXMoc3RhdGUsIHN0YXRlLm90aGVyTWVudXMocGF0aCkpO1xuICAgICAgICBlYWNoKG90aGVycywgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICByZW1vdmUkNShvLmVsZW1lbnQsIFtkZXRhaWwubWFya2Vycy5iYWNrZ3JvdW5kTWVudV0pO1xuICAgICAgICAgIGlmICghZGV0YWlsLnN0YXlJbkRvbSkge1xuICAgICAgICAgICAgUmVwbGFjaW5nLnJlbW92ZShjb250YWluZXIsIG8pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFN1Ym1lbnVQYXJlbnRzID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICByZXR1cm4gc3VibWVudVBhcmVudEl0ZW1zLmdldCgpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciByID0ge307XG4gICAgICAgICAgdmFyIGl0ZW1zID0gZGVzY2VuZGFudHMoY29udGFpbmVyLmVsZW1lbnQsICcuJyArIGRldGFpbC5tYXJrZXJzLml0ZW0pO1xuICAgICAgICAgIHZhciBwYXJlbnRJdGVtcyA9IGZpbHRlcihpdGVtcywgZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXQkMyhpLCAnYXJpYS1oYXNwb3B1cCcpID09PSAndHJ1ZSc7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZWFjaChwYXJlbnRJdGVtcywgZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5nZXRTeXN0ZW0oKS5nZXRCeURvbShpKS5lYWNoKGZ1bmN0aW9uIChpdGVtQ29tcCkge1xuICAgICAgICAgICAgICB2YXIga2V5ID0gZ2V0SXRlbVZhbHVlKGl0ZW1Db21wKTtcbiAgICAgICAgICAgICAgcltrZXldID0gaXRlbUNvbXA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzdWJtZW51UGFyZW50SXRlbXMuc2V0KE9wdGlvbmFsLnNvbWUocikpO1xuICAgICAgICAgIHJldHVybiByO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlQXJpYUV4cGFuc2lvbnMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBwYXRoKSB7XG4gICAgICAgIHZhciBwYXJlbnRJdGVtcyA9IGdldFN1Ym1lbnVQYXJlbnRzKGNvbnRhaW5lcik7XG4gICAgICAgIGVhY2gkMShwYXJlbnRJdGVtcywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgICB2YXIgZXhwYW5kZWQgPSBjb250YWlucyhwYXRoLCBrKTtcbiAgICAgICAgICBzZXQkMSh2LmVsZW1lbnQsICdhcmlhLWV4cGFuZGVkJywgZXhwYW5kZWQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlTWVudVBhdGggPSBmdW5jdGlvbiAoY29udGFpbmVyLCBzdGF0ZSwgcGF0aCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShwYXRoWzBdKS5iaW5kKGZ1bmN0aW9uIChsYXRlc3RNZW51TmFtZSkge1xuICAgICAgICAgIHJldHVybiBzdGF0ZS5sb29rdXBNZW51KGxhdGVzdE1lbnVOYW1lKS5iaW5kKGZ1bmN0aW9uIChtZW51UHJlcCkge1xuICAgICAgICAgICAgaWYgKG1lbnVQcmVwLnR5cGUgPT09ICdub3RidWlsdCcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhciBhY3RpdmVNZW51ID0gbWVudVByZXAubWVudTtcbiAgICAgICAgICAgICAgdmFyIHJlc3QgPSBnZXRNZW51cyhzdGF0ZSwgcGF0aC5zbGljZSgxKSk7XG4gICAgICAgICAgICAgIGVhY2gocmVzdCwgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICBhZGQkMihyLmVsZW1lbnQsIGRldGFpbC5tYXJrZXJzLmJhY2tncm91bmRNZW51KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGlmICghaW5Cb2R5KGFjdGl2ZU1lbnUuZWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICBSZXBsYWNpbmcuYXBwZW5kKGNvbnRhaW5lciwgcHJlbWFkZSQxKGFjdGl2ZU1lbnUpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZW1vdmUkNShhY3RpdmVNZW51LmVsZW1lbnQsIFtkZXRhaWwubWFya2Vycy5iYWNrZ3JvdW5kTWVudV0pO1xuICAgICAgICAgICAgICBzZXRBY3RpdmVNZW51KGNvbnRhaW5lciwgYWN0aXZlTWVudSk7XG4gICAgICAgICAgICAgIGNsb3NlT3RoZXJzKGNvbnRhaW5lciwgc3RhdGUsIHBhdGgpO1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShhY3RpdmVNZW51KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIEV4cGFuZEhpZ2hsaWdodERlY2lzaW9uO1xuICAgICAgKGZ1bmN0aW9uIChFeHBhbmRIaWdobGlnaHREZWNpc2lvbikge1xuICAgICAgICBFeHBhbmRIaWdobGlnaHREZWNpc2lvbltFeHBhbmRIaWdobGlnaHREZWNpc2lvblsnSGlnaGxpZ2h0U3VibWVudSddID0gMF0gPSAnSGlnaGxpZ2h0U3VibWVudSc7XG4gICAgICAgIEV4cGFuZEhpZ2hsaWdodERlY2lzaW9uW0V4cGFuZEhpZ2hsaWdodERlY2lzaW9uWydIaWdobGlnaHRQYXJlbnQnXSA9IDFdID0gJ0hpZ2hsaWdodFBhcmVudCc7XG4gICAgICB9KEV4cGFuZEhpZ2hsaWdodERlY2lzaW9uIHx8IChFeHBhbmRIaWdobGlnaHREZWNpc2lvbiA9IHt9KSkpO1xuICAgICAgdmFyIGJ1aWxkSWZSZXF1aXJlZCA9IGZ1bmN0aW9uIChjb250YWluZXIsIG1lbnVOYW1lLCBtZW51UHJlcCkge1xuICAgICAgICBpZiAobWVudVByZXAudHlwZSA9PT0gJ25vdGJ1aWx0Jykge1xuICAgICAgICAgIHZhciBtZW51ID0gY29udGFpbmVyLmdldFN5c3RlbSgpLmJ1aWxkKG1lbnVQcmVwLm5iTWVudSgpKTtcbiAgICAgICAgICBsYXllcmVkU3RhdGUuc2V0TWVudUJ1aWx0KG1lbnVOYW1lLCBtZW51KTtcbiAgICAgICAgICByZXR1cm4gbWVudTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbWVudVByZXAubWVudTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBleHBhbmRSaWdodCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGl0ZW0sIGRlY2lzaW9uKSB7XG4gICAgICAgIGlmIChkZWNpc2lvbiA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgZGVjaXNpb24gPSBFeHBhbmRIaWdobGlnaHREZWNpc2lvbi5IaWdobGlnaHRTdWJtZW51O1xuICAgICAgICB9XG4gICAgICAgIHZhciB2YWx1ZSA9IGdldEl0ZW1WYWx1ZShpdGVtKTtcbiAgICAgICAgcmV0dXJuIGxheWVyZWRTdGF0ZS5leHBhbmQodmFsdWUpLmJpbmQoZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICB1cGRhdGVBcmlhRXhwYW5zaW9ucyhjb250YWluZXIsIHBhdGgpO1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKHBhdGhbMF0pLmJpbmQoZnVuY3Rpb24gKG1lbnVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gbGF5ZXJlZFN0YXRlLmxvb2t1cE1lbnUobWVudU5hbWUpLmJpbmQoZnVuY3Rpb24gKGFjdGl2ZU1lbnVQcmVwKSB7XG4gICAgICAgICAgICAgIHZhciBhY3RpdmVNZW51ID0gYnVpbGRJZlJlcXVpcmVkKGNvbnRhaW5lciwgbWVudU5hbWUsIGFjdGl2ZU1lbnVQcmVwKTtcbiAgICAgICAgICAgICAgaWYgKCFpbkJvZHkoYWN0aXZlTWVudS5lbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIFJlcGxhY2luZy5hcHBlbmQoY29udGFpbmVyLCBwcmVtYWRlJDEoYWN0aXZlTWVudSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRldGFpbC5vbk9wZW5TdWJtZW51KGNvbnRhaW5lciwgaXRlbSwgYWN0aXZlTWVudSwgcmV2ZXJzZShwYXRoKSk7XG4gICAgICAgICAgICAgIGlmIChkZWNpc2lvbiA9PT0gRXhwYW5kSGlnaGxpZ2h0RGVjaXNpb24uSGlnaGxpZ2h0U3VibWVudSkge1xuICAgICAgICAgICAgICAgIEhpZ2hsaWdodGluZy5oaWdobGlnaHRGaXJzdChhY3RpdmVNZW51KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlTWVudVBhdGgoY29udGFpbmVyLCBsYXllcmVkU3RhdGUsIHBhdGgpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIEhpZ2hsaWdodGluZy5kZWhpZ2hsaWdodEFsbChhY3RpdmVNZW51KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShpdGVtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjb2xsYXBzZUxlZnQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBpdGVtKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGdldEl0ZW1WYWx1ZShpdGVtKTtcbiAgICAgICAgcmV0dXJuIGxheWVyZWRTdGF0ZS5jb2xsYXBzZSh2YWx1ZSkuYmluZChmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAgIHVwZGF0ZUFyaWFFeHBhbnNpb25zKGNvbnRhaW5lciwgcGF0aCk7XG4gICAgICAgICAgcmV0dXJuIHVwZGF0ZU1lbnVQYXRoKGNvbnRhaW5lciwgbGF5ZXJlZFN0YXRlLCBwYXRoKS5tYXAoZnVuY3Rpb24gKGFjdGl2ZU1lbnUpIHtcbiAgICAgICAgICAgIGRldGFpbC5vbkNvbGxhcHNlTWVudShjb250YWluZXIsIGl0ZW0sIGFjdGl2ZU1lbnUpO1xuICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZU1lbnU7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGVWaWV3ID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgaXRlbSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBnZXRJdGVtVmFsdWUoaXRlbSk7XG4gICAgICAgIHJldHVybiBsYXllcmVkU3RhdGUucmVmcmVzaCh2YWx1ZSkuYmluZChmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAgIHVwZGF0ZUFyaWFFeHBhbnNpb25zKGNvbnRhaW5lciwgcGF0aCk7XG4gICAgICAgICAgcmV0dXJuIHVwZGF0ZU1lbnVQYXRoKGNvbnRhaW5lciwgbGF5ZXJlZFN0YXRlLCBwYXRoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uUmlnaHQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBpdGVtKSB7XG4gICAgICAgIHJldHVybiBpbnNpZGUoaXRlbS5lbGVtZW50KSA/IE9wdGlvbmFsLm5vbmUoKSA6IGV4cGFuZFJpZ2h0KGNvbnRhaW5lciwgaXRlbSwgRXhwYW5kSGlnaGxpZ2h0RGVjaXNpb24uSGlnaGxpZ2h0U3VibWVudSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uTGVmdCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGluc2lkZShpdGVtLmVsZW1lbnQpID8gT3B0aW9uYWwubm9uZSgpIDogY29sbGFwc2VMZWZ0KGNvbnRhaW5lciwgaXRlbSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uRXNjYXBlID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgaXRlbSkge1xuICAgICAgICByZXR1cm4gY29sbGFwc2VMZWZ0KGNvbnRhaW5lciwgaXRlbSkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGRldGFpbC5vbkVzY2FwZShjb250YWluZXIsIGl0ZW0pLm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIga2V5T25JdGVtID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb250YWluZXIsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGNsb3Nlc3QkMyhzaW11bGF0ZWRFdmVudC5nZXRTb3VyY2UoKSwgJy4nICsgZGV0YWlsLm1hcmtlcnMuaXRlbSkuYmluZChmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGFpbmVyLmdldFN5c3RlbSgpLmdldEJ5RG9tKHRhcmdldCkudG9PcHRpb25hbCgpLmJpbmQoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGYoY29udGFpbmVyLCBpdGVtKS5tYXAoYWx3YXlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBldmVudHMgPSBkZXJpdmUoW1xuICAgICAgICBydW4oZm9jdXMkNCgpLCBmdW5jdGlvbiAoc2FuZGJveCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICB2YXIgaXRlbSA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50Lml0ZW07XG4gICAgICAgICAgbGF5ZXJlZFN0YXRlLmxvb2t1cEl0ZW0oZ2V0SXRlbVZhbHVlKGl0ZW0pKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtZW51ID0gc2ltdWxhdGVkRXZlbnQuZXZlbnQubWVudTtcbiAgICAgICAgICAgIEhpZ2hsaWdodGluZy5oaWdobGlnaHQoc2FuZGJveCwgbWVudSk7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBnZXRJdGVtVmFsdWUoc2ltdWxhdGVkRXZlbnQuZXZlbnQuaXRlbSk7XG4gICAgICAgICAgICBsYXllcmVkU3RhdGUucmVmcmVzaCh2YWx1ZSkuZWFjaChmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAgICAgICByZXR1cm4gY2xvc2VPdGhlcnMoc2FuZGJveCwgbGF5ZXJlZFN0YXRlLCBwYXRoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KSxcbiAgICAgICAgcnVuT25FeGVjdXRlKGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgdmFyIHRhcmdldCA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50LnRhcmdldDtcbiAgICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20odGFyZ2V0KS5lYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICB2YXIgaXRlbVZhbHVlID0gZ2V0SXRlbVZhbHVlKGl0ZW0pO1xuICAgICAgICAgICAgaWYgKGl0ZW1WYWx1ZS5pbmRleE9mKCdjb2xsYXBzZS1pdGVtJykgPT09IDApIHtcbiAgICAgICAgICAgICAgY29sbGFwc2VMZWZ0KGNvbXBvbmVudCwgaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleHBhbmRSaWdodChjb21wb25lbnQsIGl0ZW0sIEV4cGFuZEhpZ2hsaWdodERlY2lzaW9uLkhpZ2hsaWdodFN1Ym1lbnUpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBkZXRhaWwub25FeGVjdXRlKGNvbXBvbmVudCwgaXRlbSk7XG4gICAgICAgICAgICB9LCBub29wKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSksXG4gICAgICAgIHJ1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbnRhaW5lciwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgc2V0dXAoY29udGFpbmVyKS5lYWNoKGZ1bmN0aW9uIChwcmltYXJ5KSB7XG4gICAgICAgICAgICBSZXBsYWNpbmcuYXBwZW5kKGNvbnRhaW5lciwgcHJlbWFkZSQxKHByaW1hcnkpKTtcbiAgICAgICAgICAgIGRldGFpbC5vbk9wZW5NZW51KGNvbnRhaW5lciwgcHJpbWFyeSk7XG4gICAgICAgICAgICBpZiAoZGV0YWlsLmhpZ2hsaWdodEltbWVkaWF0ZWx5KSB7XG4gICAgICAgICAgICAgIHNldEFjdGl2ZU1lbnUoY29udGFpbmVyLCBwcmltYXJ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgIF0uY29uY2F0KGRldGFpbC5uYXZpZ2F0ZU9uSG92ZXIgPyBbcnVuKGhvdmVyKCksIGZ1bmN0aW9uIChzYW5kYm94LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHZhciBpdGVtID0gc2ltdWxhdGVkRXZlbnQuZXZlbnQuaXRlbTtcbiAgICAgICAgICB1cGRhdGVWaWV3KHNhbmRib3gsIGl0ZW0pO1xuICAgICAgICAgIGV4cGFuZFJpZ2h0KHNhbmRib3gsIGl0ZW0sIEV4cGFuZEhpZ2hsaWdodERlY2lzaW9uLkhpZ2hsaWdodFBhcmVudCk7XG4gICAgICAgICAgZGV0YWlsLm9uSG92ZXIoc2FuZGJveCwgaXRlbSk7XG4gICAgICAgIH0pXSA6IFtdKSk7XG4gICAgICB2YXIgZ2V0QWN0aXZlSXRlbSA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgcmV0dXJuIEhpZ2hsaWdodGluZy5nZXRIaWdobGlnaHRlZChjb250YWluZXIpLmJpbmQoSGlnaGxpZ2h0aW5nLmdldEhpZ2hsaWdodGVkKTtcbiAgICAgIH07XG4gICAgICB2YXIgY29sbGFwc2VNZW51QXBpID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICBnZXRBY3RpdmVJdGVtKGNvbnRhaW5lcikuZWFjaChmdW5jdGlvbiAoY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICBjb2xsYXBzZUxlZnQoY29udGFpbmVyLCBjdXJyZW50SXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBoaWdobGlnaHRQcmltYXJ5ID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICBsYXllcmVkU3RhdGUuZ2V0UHJpbWFyeSgpLmVhY2goZnVuY3Rpb24gKHByaW1hcnkpIHtcbiAgICAgICAgICBzZXRBY3RpdmVNZW51KGNvbnRhaW5lciwgcHJpbWFyeSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBleHRyYWN0TWVudUZyb21Db250YWluZXIgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGNvbnRhaW5lci5jb21wb25lbnRzKClbMF0pLmZpbHRlcihmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHJldHVybiBnZXQkMyhjb21wLmVsZW1lbnQsICdyb2xlJykgPT09ICdtZW51JztcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlcG9zaXRpb25NZW51cyA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgdmFyIG1heWJlQWN0aXZlUHJpbWFyeSA9IGxheWVyZWRTdGF0ZS5nZXRQcmltYXJ5KCkuYmluZChmdW5jdGlvbiAocHJpbWFyeSkge1xuICAgICAgICAgIHJldHVybiBnZXRBY3RpdmVJdGVtKGNvbnRhaW5lcikuYmluZChmdW5jdGlvbiAoY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgIHZhciBpdGVtVmFsdWUgPSBnZXRJdGVtVmFsdWUoY3VycmVudEl0ZW0pO1xuICAgICAgICAgICAgdmFyIGFsbE1lbnVzID0gdmFsdWVzKGxheWVyZWRTdGF0ZS5nZXRNZW51cygpKTtcbiAgICAgICAgICAgIHZhciBwcmVwYXJlZE1lbnVzID0gY2F0KG1hcChhbGxNZW51cywgTGF5ZXJlZFN0YXRlLmV4dHJhY3RQcmVwYXJlZE1lbnUpKTtcbiAgICAgICAgICAgIHJldHVybiBsYXllcmVkU3RhdGUuZ2V0VHJpZ2dlcmluZ1BhdGgoaXRlbVZhbHVlLCBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICByZXR1cm4gZ2V0SXRlbUJ5VmFsdWUoY29udGFpbmVyLCBwcmVwYXJlZE1lbnVzLCB2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAodHJpZ2dlcmluZ1BhdGgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHByaW1hcnk6IHByaW1hcnksXG4gICAgICAgICAgICAgIHRyaWdnZXJpbmdQYXRoOiB0cmlnZ2VyaW5nUGF0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1heWJlQWN0aXZlUHJpbWFyeS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBleHRyYWN0TWVudUZyb21Db250YWluZXIoY29udGFpbmVyKS5lYWNoKGZ1bmN0aW9uIChwcmltYXJ5TWVudSkge1xuICAgICAgICAgICAgZGV0YWlsLm9uUmVwb3NpdGlvbk1lbnUoY29udGFpbmVyLCBwcmltYXJ5TWVudSwgW10pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICB2YXIgcHJpbWFyeSA9IF9hLnByaW1hcnksIHRyaWdnZXJpbmdQYXRoID0gX2EudHJpZ2dlcmluZ1BhdGg7XG4gICAgICAgICAgZGV0YWlsLm9uUmVwb3NpdGlvbk1lbnUoY29udGFpbmVyLCBwcmltYXJ5LCB0cmlnZ2VyaW5nUGF0aCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBhcGlzID0ge1xuICAgICAgICBjb2xsYXBzZU1lbnU6IGNvbGxhcHNlTWVudUFwaSxcbiAgICAgICAgaGlnaGxpZ2h0UHJpbWFyeTogaGlnaGxpZ2h0UHJpbWFyeSxcbiAgICAgICAgcmVwb3NpdGlvbk1lbnVzOiByZXBvc2l0aW9uTWVudXNcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgbWFya2VyczogZGV0YWlsLm1hcmtlcnMsXG4gICAgICAgIGJlaGF2aW91cnM6IGF1Z21lbnQoZGV0YWlsLnRtZW51QmVoYXZpb3VycywgW1xuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgb25SaWdodDoga2V5T25JdGVtKG9uUmlnaHQpLFxuICAgICAgICAgICAgb25MZWZ0OiBrZXlPbkl0ZW0ob25MZWZ0KSxcbiAgICAgICAgICAgIG9uRXNjYXBlOiBrZXlPbkl0ZW0ob25Fc2NhcGUpLFxuICAgICAgICAgICAgZm9jdXNJbjogZnVuY3Rpb24gKGNvbnRhaW5lciwgX2tleUluZm8pIHtcbiAgICAgICAgICAgICAgbGF5ZXJlZFN0YXRlLmdldFByaW1hcnkoKS5lYWNoKGZ1bmN0aW9uIChwcmltYXJ5KSB7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2goY29udGFpbmVyLCBwcmltYXJ5LmVsZW1lbnQsIGZvY3VzSXRlbSgpKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBoaWdobGlnaHRDbGFzczogZGV0YWlsLm1hcmtlcnMuc2VsZWN0ZWRNZW51LFxuICAgICAgICAgICAgaXRlbUNsYXNzOiBkZXRhaWwubWFya2Vycy5tZW51XG4gICAgICAgICAgfSksXG4gICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBmaW5kOiBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBIaWdobGlnaHRpbmcuZ2V0SGlnaGxpZ2h0ZWQoY29udGFpbmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBSZXBsYWNpbmcuY29uZmlnKHt9KVxuICAgICAgICBdKSxcbiAgICAgICAgZXZlbnRPcmRlcjogZGV0YWlsLmV2ZW50T3JkZXIsXG4gICAgICAgIGFwaXM6IGFwaXMsXG4gICAgICAgIGV2ZW50czogZXZlbnRzXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNvbGxhcHNlSXRlbSA9IGNvbnN0YW50KCdjb2xsYXBzZS1pdGVtJyk7XG5cbiAgICB2YXIgdGllcmVkRGF0YSA9IGZ1bmN0aW9uIChwcmltYXJ5LCBtZW51cywgZXhwYW5zaW9ucykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJpbWFyeTogcHJpbWFyeSxcbiAgICAgICAgbWVudXM6IG1lbnVzLFxuICAgICAgICBleHBhbnNpb25zOiBleHBhbnNpb25zXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNpbmdsZURhdGEgPSBmdW5jdGlvbiAobmFtZSwgbWVudSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJpbWFyeTogbmFtZSxcbiAgICAgICAgbWVudXM6IHdyYXAkMShuYW1lLCBtZW51KSxcbiAgICAgICAgZXhwYW5zaW9uczoge31cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29sbGFwc2VJdGVtJDEgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IGdlbmVyYXRlJDEoY29sbGFwc2VJdGVtKCkpLFxuICAgICAgICBtZXRhOiB7IHRleHQ6IHRleHQgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0aWVyZWRNZW51ID0gc2luZ2xlJDIoe1xuICAgICAgbmFtZTogJ1RpZXJlZE1lbnUnLFxuICAgICAgY29uZmlnRmllbGRzOiBbXG4gICAgICAgIG9uU3RyaWN0S2V5Ym9hcmRIYW5kbGVyKCdvbkV4ZWN1dGUnKSxcbiAgICAgICAgb25TdHJpY3RLZXlib2FyZEhhbmRsZXIoJ29uRXNjYXBlJyksXG4gICAgICAgIG9uU3RyaWN0SGFuZGxlcignb25PcGVuTWVudScpLFxuICAgICAgICBvblN0cmljdEhhbmRsZXIoJ29uT3BlblN1Ym1lbnUnKSxcbiAgICAgICAgb25IYW5kbGVyKCdvblJlcG9zaXRpb25NZW51JyksXG4gICAgICAgIG9uSGFuZGxlcignb25Db2xsYXBzZU1lbnUnKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2hpZ2hsaWdodEltbWVkaWF0ZWx5JywgdHJ1ZSksXG4gICAgICAgIHN0cmljdE9iak9mKCdkYXRhJywgW1xuICAgICAgICAgIHN0cmljdCQxKCdwcmltYXJ5JyksXG4gICAgICAgICAgc3RyaWN0JDEoJ21lbnVzJyksXG4gICAgICAgICAgc3RyaWN0JDEoJ2V4cGFuc2lvbnMnKVxuICAgICAgICBdKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2Zha2VGb2N1cycsIGZhbHNlKSxcbiAgICAgICAgb25IYW5kbGVyKCdvbkhpZ2hsaWdodCcpLFxuICAgICAgICBvbkhhbmRsZXIoJ29uSG92ZXInKSxcbiAgICAgICAgdGllcmVkTWVudU1hcmtlcnMoKSxcbiAgICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnbmF2aWdhdGVPbkhvdmVyJywgdHJ1ZSksXG4gICAgICAgIGRlZmF1bHRlZCQxKCdzdGF5SW5Eb20nLCBmYWxzZSksXG4gICAgICAgIGZpZWxkJDEoJ3RtZW51QmVoYXZpb3VycycsIFtcbiAgICAgICAgICBLZXlpbmcsXG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLFxuICAgICAgICAgIENvbXBvc2luZyxcbiAgICAgICAgICBSZXBsYWNpbmdcbiAgICAgICAgXSksXG4gICAgICAgIGRlZmF1bHRlZCQxKCdldmVudE9yZGVyJywge30pXG4gICAgICBdLFxuICAgICAgYXBpczoge1xuICAgICAgICBjb2xsYXBzZU1lbnU6IGZ1bmN0aW9uIChhcGlzLCB0bWVudSkge1xuICAgICAgICAgIGFwaXMuY29sbGFwc2VNZW51KHRtZW51KTtcbiAgICAgICAgfSxcbiAgICAgICAgaGlnaGxpZ2h0UHJpbWFyeTogZnVuY3Rpb24gKGFwaXMsIHRtZW51KSB7XG4gICAgICAgICAgYXBpcy5oaWdobGlnaHRQcmltYXJ5KHRtZW51KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVwb3NpdGlvbk1lbnVzOiBmdW5jdGlvbiAoYXBpcywgdG1lbnUpIHtcbiAgICAgICAgICBhcGlzLnJlcG9zaXRpb25NZW51cyh0bWVudSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmYWN0b3J5OiBtYWtlJDIsXG4gICAgICBleHRyYUFwaXM6IHtcbiAgICAgICAgdGllcmVkRGF0YTogdGllcmVkRGF0YSxcbiAgICAgICAgc2luZ2xlRGF0YTogc2luZ2xlRGF0YSxcbiAgICAgICAgY29sbGFwc2VJdGVtOiBjb2xsYXBzZUl0ZW0kMVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIG1ha2VNZW51ID0gZnVuY3Rpb24gKGRldGFpbCwgbWVudVNhbmRib3gsIGFuY2hvciwgbWVudVNwZWMsIGdldEJvdW5kcykge1xuICAgICAgdmFyIGxhenlTaW5rID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZGV0YWlsLmxhenlTaW5rKG1lbnVTYW5kYm94KTtcbiAgICAgIH07XG4gICAgICB2YXIgbGF5b3V0cyA9IG1lbnVTcGVjLnR5cGUgPT09ICdob3Jpem9udGFsJyA/IHtcbiAgICAgICAgbGF5b3V0czoge1xuICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gYmVsb3dPckFib3ZlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblJ0bDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGJlbG93T3JBYm92ZVJ0bCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSA6IHt9O1xuICAgICAgdmFyIGlzRmlyc3RUaWVyU3VibWVudSA9IGZ1bmN0aW9uICh0cmlnZ2VyaW5nUGF0aHMpIHtcbiAgICAgICAgcmV0dXJuIHRyaWdnZXJpbmdQYXRocy5sZW5ndGggPT09IDI7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFN1Ym1lbnVMYXlvdXRzID0gZnVuY3Rpb24gKHRyaWdnZXJpbmdQYXRocykge1xuICAgICAgICByZXR1cm4gaXNGaXJzdFRpZXJTdWJtZW51KHRyaWdnZXJpbmdQYXRocykgPyBsYXlvdXRzIDoge307XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHRpZXJlZE1lbnUuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7IHRhZzogJ2RpdicgfSxcbiAgICAgICAgZGF0YTogbWVudVNwZWMuZGF0YSxcbiAgICAgICAgbWFya2VyczogbWVudVNwZWMubWVudS5tYXJrZXJzLFxuICAgICAgICBoaWdobGlnaHRJbW1lZGlhdGVseTogbWVudVNwZWMubWVudS5oaWdobGlnaHRJbW1lZGlhdGVseSxcbiAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBTYW5kYm94aW5nLmNsb3NlKG1lbnVTYW5kYm94KTtcbiAgICAgICAgICBkZXRhaWwub25Fc2NhcGUubWFwKGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlcihtZW51U2FuZGJveCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uRXhlY3V0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICB9LFxuICAgICAgICBvbk9wZW5NZW51OiBmdW5jdGlvbiAodG1lbnUsIG1lbnUpIHtcbiAgICAgICAgICBQb3NpdGlvbmluZy5wb3NpdGlvbldpdGhpbkJvdW5kcyhsYXp5U2luaygpLmdldE9yRGllKCksIGFuY2hvciwgbWVudSwgZ2V0Qm91bmRzKCkpO1xuICAgICAgICB9LFxuICAgICAgICBvbk9wZW5TdWJtZW51OiBmdW5jdGlvbiAodG1lbnUsIGl0ZW0sIHN1Ym1lbnUsIHRyaWdnZXJpbmdQYXRocykge1xuICAgICAgICAgIHZhciBzaW5rID0gbGF6eVNpbmsoKS5nZXRPckRpZSgpO1xuICAgICAgICAgIFBvc2l0aW9uaW5nLnBvc2l0aW9uKHNpbmssIF9fYXNzaWduKHtcbiAgICAgICAgICAgIGFuY2hvcjogJ3N1Ym1lbnUnLFxuICAgICAgICAgICAgaXRlbTogaXRlbVxuICAgICAgICAgIH0sIGdldFN1Ym1lbnVMYXlvdXRzKHRyaWdnZXJpbmdQYXRocykpLCBzdWJtZW51KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZXBvc2l0aW9uTWVudTogZnVuY3Rpb24gKHRtZW51LCBwcmltYXJ5TWVudSwgc3VibWVudVRyaWdnZXJzKSB7XG4gICAgICAgICAgdmFyIHNpbmsgPSBsYXp5U2luaygpLmdldE9yRGllKCk7XG4gICAgICAgICAgUG9zaXRpb25pbmcucG9zaXRpb25XaXRoaW5Cb3VuZHMoc2luaywgYW5jaG9yLCBwcmltYXJ5TWVudSwgZ2V0Qm91bmRzKCkpO1xuICAgICAgICAgIGVhY2goc3VibWVudVRyaWdnZXJzLCBmdW5jdGlvbiAoc3QpIHtcbiAgICAgICAgICAgIHZhciBzdWJtZW51TGF5b3V0cyA9IGdldFN1Ym1lbnVMYXlvdXRzKHN0LnRyaWdnZXJpbmdQYXRoKTtcbiAgICAgICAgICAgIFBvc2l0aW9uaW5nLnBvc2l0aW9uKHNpbmssIF9fYXNzaWduKHtcbiAgICAgICAgICAgICAgYW5jaG9yOiAnc3VibWVudScsXG4gICAgICAgICAgICAgIGl0ZW06IHN0LnRyaWdnZXJpbmdJdGVtXG4gICAgICAgICAgICB9LCBzdWJtZW51TGF5b3V0cyksIHN0LnRyaWdnZXJlZE1lbnUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmYWN0b3J5ID0gZnVuY3Rpb24gKGRldGFpbCwgc3BlYykge1xuICAgICAgdmFyIGlzUGFydE9mUmVsYXRlZCA9IGZ1bmN0aW9uIChzYW5kYm94LCBxdWVyeUVsZW0pIHtcbiAgICAgICAgdmFyIHJlbGF0ZWQgPSBkZXRhaWwuZ2V0UmVsYXRlZChzYW5kYm94KTtcbiAgICAgICAgcmV0dXJuIHJlbGF0ZWQuZXhpc3RzKGZ1bmN0aW9uIChyZWwpIHtcbiAgICAgICAgICByZXR1cm4gaXNQYXJ0T2YocmVsLCBxdWVyeUVsZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0Q29udGVudCA9IGZ1bmN0aW9uIChzYW5kYm94LCB0aGluZykge1xuICAgICAgICBTYW5kYm94aW5nLnNldENvbnRlbnQoc2FuZGJveCwgdGhpbmcpO1xuICAgICAgfTtcbiAgICAgIHZhciBzaG93QXQgPSBmdW5jdGlvbiAoc2FuZGJveCwgYW5jaG9yLCB0aGluZykge1xuICAgICAgICBzaG93V2l0aGluKHNhbmRib3gsIGFuY2hvciwgdGhpbmcsIE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNob3dXaXRoaW4gPSBmdW5jdGlvbiAoc2FuZGJveCwgYW5jaG9yLCB0aGluZywgYm94RWxlbWVudCkge1xuICAgICAgICBzaG93V2l0aGluQm91bmRzKHNhbmRib3gsIGFuY2hvciwgdGhpbmcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gYm94RWxlbWVudC5tYXAoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBib3goZWxlbSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBzaG93V2l0aGluQm91bmRzID0gZnVuY3Rpb24gKHNhbmRib3gsIGFuY2hvciwgdGhpbmcsIGdldEJvdW5kcykge1xuICAgICAgICB2YXIgc2luayA9IGRldGFpbC5sYXp5U2luayhzYW5kYm94KS5nZXRPckRpZSgpO1xuICAgICAgICBTYW5kYm94aW5nLm9wZW5XaGlsZUNsb2FrZWQoc2FuZGJveCwgdGhpbmcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gUG9zaXRpb25pbmcucG9zaXRpb25XaXRoaW5Cb3VuZHMoc2luaywgYW5jaG9yLCBzYW5kYm94LCBnZXRCb3VuZHMoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBSZXByZXNlbnRpbmcuc2V0VmFsdWUoc2FuZGJveCwgT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgbW9kZTogJ3Bvc2l0aW9uJyxcbiAgICAgICAgICBhbmNob3I6IGFuY2hvcixcbiAgICAgICAgICBnZXRCb3VuZHM6IGdldEJvdW5kc1xuICAgICAgICB9KSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNob3dNZW51QXQgPSBmdW5jdGlvbiAoc2FuZGJveCwgYW5jaG9yLCBtZW51U3BlYykge1xuICAgICAgICBzaG93TWVudVdpdGhpbkJvdW5kcyhzYW5kYm94LCBhbmNob3IsIG1lbnVTcGVjLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNob3dNZW51V2l0aGluQm91bmRzID0gZnVuY3Rpb24gKHNhbmRib3gsIGFuY2hvciwgbWVudVNwZWMsIGdldEJvdW5kcykge1xuICAgICAgICB2YXIgbWVudSA9IG1ha2VNZW51KGRldGFpbCwgc2FuZGJveCwgYW5jaG9yLCBtZW51U3BlYywgZ2V0Qm91bmRzKTtcbiAgICAgICAgU2FuZGJveGluZy5vcGVuKHNhbmRib3gsIG1lbnUpO1xuICAgICAgICBSZXByZXNlbnRpbmcuc2V0VmFsdWUoc2FuZGJveCwgT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgbW9kZTogJ21lbnUnLFxuICAgICAgICAgIG1lbnU6IG1lbnVcbiAgICAgICAgfSkpO1xuICAgICAgfTtcbiAgICAgIHZhciBoaWRlID0gZnVuY3Rpb24gKHNhbmRib3gpIHtcbiAgICAgICAgaWYgKFNhbmRib3hpbmcuaXNPcGVuKHNhbmRib3gpKSB7XG4gICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKHNhbmRib3gsIE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgICAgU2FuZGJveGluZy5jbG9zZShzYW5kYm94KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBnZXRDb250ZW50ID0gZnVuY3Rpb24gKHNhbmRib3gpIHtcbiAgICAgICAgcmV0dXJuIFNhbmRib3hpbmcuZ2V0U3RhdGUoc2FuZGJveCk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlcG9zaXRpb24gPSBmdW5jdGlvbiAoc2FuZGJveCkge1xuICAgICAgICBpZiAoU2FuZGJveGluZy5pc09wZW4oc2FuZGJveCkpIHtcbiAgICAgICAgICBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoc2FuZGJveCkuZWFjaChmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUubW9kZSkge1xuICAgICAgICAgICAgY2FzZSAnbWVudSc6XG4gICAgICAgICAgICAgIFNhbmRib3hpbmcuZ2V0U3RhdGUoc2FuZGJveCkuZWFjaChmdW5jdGlvbiAodG1lbnUpIHtcbiAgICAgICAgICAgICAgICB0aWVyZWRNZW51LnJlcG9zaXRpb25NZW51cyh0bWVudSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3Bvc2l0aW9uJzpcbiAgICAgICAgICAgICAgdmFyIHNpbmsgPSBkZXRhaWwubGF6eVNpbmsoc2FuZGJveCkuZ2V0T3JEaWUoKTtcbiAgICAgICAgICAgICAgUG9zaXRpb25pbmcucG9zaXRpb25XaXRoaW5Cb3VuZHMoc2luaywgc3RhdGUuYW5jaG9yLCBzYW5kYm94LCBzdGF0ZS5nZXRCb3VuZHMoKSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGFwaXMgPSB7XG4gICAgICAgIHNldENvbnRlbnQ6IHNldENvbnRlbnQsXG4gICAgICAgIHNob3dBdDogc2hvd0F0LFxuICAgICAgICBzaG93V2l0aGluOiBzaG93V2l0aGluLFxuICAgICAgICBzaG93V2l0aGluQm91bmRzOiBzaG93V2l0aGluQm91bmRzLFxuICAgICAgICBzaG93TWVudUF0OiBzaG93TWVudUF0LFxuICAgICAgICBzaG93TWVudVdpdGhpbkJvdW5kczogc2hvd01lbnVXaXRoaW5Cb3VuZHMsXG4gICAgICAgIGhpZGU6IGhpZGUsXG4gICAgICAgIGdldENvbnRlbnQ6IGdldENvbnRlbnQsXG4gICAgICAgIHJlcG9zaXRpb246IHJlcG9zaXRpb24sXG4gICAgICAgIGlzT3BlbjogU2FuZGJveGluZy5pc09wZW5cbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgYmVoYXZpb3VyczogYXVnbWVudChkZXRhaWwuaW5saW5lQmVoYXZpb3VycywgW1xuICAgICAgICAgIFNhbmRib3hpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGlzUGFydE9mOiBmdW5jdGlvbiAoc2FuZGJveCwgZGF0YSwgcXVlcnlFbGVtKSB7XG4gICAgICAgICAgICAgIHJldHVybiBpc1BhcnRPZihkYXRhLCBxdWVyeUVsZW0pIHx8IGlzUGFydE9mUmVsYXRlZChzYW5kYm94LCBxdWVyeUVsZW0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEF0dGFjaFBvaW50OiBmdW5jdGlvbiAoc2FuZGJveCkge1xuICAgICAgICAgICAgICByZXR1cm4gZGV0YWlsLmxhenlTaW5rKHNhbmRib3gpLmdldE9yRGllKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbiAoc2FuZGJveCkge1xuICAgICAgICAgICAgICBkZXRhaWwub25TaG93KHNhbmRib3gpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIChzYW5kYm94KSB7XG4gICAgICAgICAgICAgIGRldGFpbC5vbkhpZGUoc2FuZGJveCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWVtb3J5JyxcbiAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBSZWNlaXZpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGNoYW5uZWxzOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgcmVjZWl2aW5nQ2hhbm5lbChfX2Fzc2lnbih7IGlzRXh0cmFQYXJ0OiBzcGVjLmlzRXh0cmFQYXJ0IH0sIGRldGFpbC5maXJlRGlzbWlzc2FsRXZlbnRJbnN0ZWFkLm1hcChmdW5jdGlvbiAoZmUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHsgZmlyZUV2ZW50SW5zdGVhZDogeyBldmVudDogZmUuZXZlbnQgfSB9O1xuICAgICAgICAgICAgfSkuZ2V0T3Ioe30pKSkpLCByZWNlaXZpbmdDaGFubmVsJDEoX19hc3NpZ24oX19hc3NpZ24oe30sIGRldGFpbC5maXJlUmVwb3NpdGlvbkV2ZW50SW5zdGVhZC5tYXAoZnVuY3Rpb24gKGZlKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7IGZpcmVFdmVudEluc3RlYWQ6IHsgZXZlbnQ6IGZlLmV2ZW50IH0gfTtcbiAgICAgICAgICAgIH0pLmdldE9yKHt9KSksIHsgZG9SZXBvc2l0aW9uOiByZXBvc2l0aW9uIH0pKSlcbiAgICAgICAgICB9KVxuICAgICAgICBdKSxcbiAgICAgICAgZXZlbnRPcmRlcjogZGV0YWlsLmV2ZW50T3JkZXIsXG4gICAgICAgIGFwaXM6IGFwaXNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgSW5saW5lVmlldyA9IHNpbmdsZSQyKHtcbiAgICAgIG5hbWU6ICdJbmxpbmVWaWV3JyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogW1xuICAgICAgICBzdHJpY3QkMSgnbGF6eVNpbmsnKSxcbiAgICAgICAgb25IYW5kbGVyKCdvblNob3cnKSxcbiAgICAgICAgb25IYW5kbGVyKCdvbkhpZGUnKSxcbiAgICAgICAgb3B0aW9uRnVuY3Rpb24oJ29uRXNjYXBlJyksXG4gICAgICAgIGZpZWxkJDEoJ2lubGluZUJlaGF2aW91cnMnLCBbXG4gICAgICAgICAgU2FuZGJveGluZyxcbiAgICAgICAgICBSZXByZXNlbnRpbmcsXG4gICAgICAgICAgUmVjZWl2aW5nXG4gICAgICAgIF0pLFxuICAgICAgICBvcHRpb25PYmpPZignZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZCcsIFtkZWZhdWx0ZWQkMSgnZXZlbnQnLCBkaXNtaXNzUmVxdWVzdGVkKCkpXSksXG4gICAgICAgIG9wdGlvbk9iak9mKCdmaXJlUmVwb3NpdGlvbkV2ZW50SW5zdGVhZCcsIFtkZWZhdWx0ZWQkMSgnZXZlbnQnLCByZXBvc2l0aW9uUmVxdWVzdGVkKCkpXSksXG4gICAgICAgIGRlZmF1bHRlZCQxKCdnZXRSZWxhdGVkJywgT3B0aW9uYWwubm9uZSksXG4gICAgICAgIGRlZmF1bHRlZCQxKCdpc0V4dHJhUGFydCcsIG5ldmVyKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2V2ZW50T3JkZXInLCBPcHRpb25hbC5ub25lKVxuICAgICAgXSxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnksXG4gICAgICBhcGlzOiB7XG4gICAgICAgIHNob3dBdDogZnVuY3Rpb24gKGFwaXMsIGNvbXBvbmVudCwgYW5jaG9yLCB0aGluZykge1xuICAgICAgICAgIGFwaXMuc2hvd0F0KGNvbXBvbmVudCwgYW5jaG9yLCB0aGluZyk7XG4gICAgICAgIH0sXG4gICAgICAgIHNob3dXaXRoaW46IGZ1bmN0aW9uIChhcGlzLCBjb21wb25lbnQsIGFuY2hvciwgdGhpbmcsIGJveEVsZW1lbnQpIHtcbiAgICAgICAgICBhcGlzLnNob3dXaXRoaW4oY29tcG9uZW50LCBhbmNob3IsIHRoaW5nLCBib3hFbGVtZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgc2hvd1dpdGhpbkJvdW5kczogZnVuY3Rpb24gKGFwaXMsIGNvbXBvbmVudCwgYW5jaG9yLCB0aGluZywgYm91bmRzKSB7XG4gICAgICAgICAgYXBpcy5zaG93V2l0aGluQm91bmRzKGNvbXBvbmVudCwgYW5jaG9yLCB0aGluZywgYm91bmRzKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2hvd01lbnVBdDogZnVuY3Rpb24gKGFwaXMsIGNvbXBvbmVudCwgYW5jaG9yLCBtZW51U3BlYykge1xuICAgICAgICAgIGFwaXMuc2hvd01lbnVBdChjb21wb25lbnQsIGFuY2hvciwgbWVudVNwZWMpO1xuICAgICAgICB9LFxuICAgICAgICBzaG93TWVudVdpdGhpbkJvdW5kczogZnVuY3Rpb24gKGFwaXMsIGNvbXBvbmVudCwgYW5jaG9yLCBtZW51U3BlYywgYm91bmRzKSB7XG4gICAgICAgICAgYXBpcy5zaG93TWVudVdpdGhpbkJvdW5kcyhjb21wb25lbnQsIGFuY2hvciwgbWVudVNwZWMsIGJvdW5kcyk7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uIChhcGlzLCBjb21wb25lbnQpIHtcbiAgICAgICAgICBhcGlzLmhpZGUoY29tcG9uZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgaXNPcGVuOiBmdW5jdGlvbiAoYXBpcywgY29tcG9uZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuaXNPcGVuKGNvbXBvbmVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldENvbnRlbnQ6IGZ1bmN0aW9uIChhcGlzLCBjb21wb25lbnQpIHtcbiAgICAgICAgICByZXR1cm4gYXBpcy5nZXRDb250ZW50KGNvbXBvbmVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldENvbnRlbnQ6IGZ1bmN0aW9uIChhcGlzLCBjb21wb25lbnQsIHRoaW5nKSB7XG4gICAgICAgICAgYXBpcy5zZXRDb250ZW50KGNvbXBvbmVudCwgdGhpbmcpO1xuICAgICAgICB9LFxuICAgICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiAoYXBpcywgY29tcG9uZW50KSB7XG4gICAgICAgICAgYXBpcy5yZXBvc2l0aW9uKGNvbXBvbmVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciB3ZXN0RWRnZVgkMSA9IGZ1bmN0aW9uIChhbmNob3IpIHtcbiAgICAgIHJldHVybiBhbmNob3IueDtcbiAgICB9O1xuICAgIHZhciBtaWRkbGVYJDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnggKyBhbmNob3Iud2lkdGggLyAyIC0gZWxlbWVudC53aWR0aCAvIDI7XG4gICAgfTtcbiAgICB2YXIgZWFzdEVkZ2VYJDEgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYW5jaG9yLnggKyBhbmNob3Iud2lkdGggLSBlbGVtZW50LndpZHRoO1xuICAgIH07XG4gICAgdmFyIG5vcnRoWSQyID0gZnVuY3Rpb24gKGFuY2hvcikge1xuICAgICAgcmV0dXJuIGFuY2hvci55O1xuICAgIH07XG4gICAgdmFyIHNvdXRoWSQyID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFuY2hvci55ICsgYW5jaG9yLmhlaWdodCAtIGVsZW1lbnQuaGVpZ2h0O1xuICAgIH07XG4gICAgdmFyIHNvdXRoZWFzdCQzID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCwgYnViYmxlcykge1xuICAgICAgcmV0dXJuIG51JDcoZWFzdEVkZ2VYJDEoYW5jaG9yLCBlbGVtZW50KSwgc291dGhZJDIoYW5jaG9yLCBlbGVtZW50KSwgYnViYmxlcy5pbm5lclNvdXRoZWFzdCgpLCBub3J0aHdlc3QoKSwgYm91bmRzUmVzdHJpY3Rpb24oYW5jaG9yLCB7XG4gICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICBib3R0b206IDNcbiAgICAgIH0pLCAnbGF5b3V0LWlubmVyLXNlJyk7XG4gICAgfTtcbiAgICB2YXIgc291dGh3ZXN0JDMgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyh3ZXN0RWRnZVgkMShhbmNob3IpLCBzb3V0aFkkMihhbmNob3IsIGVsZW1lbnQpLCBidWJibGVzLmlubmVyU291dGh3ZXN0KCksIG5vcnRoZWFzdCgpLCBib3VuZHNSZXN0cmljdGlvbihhbmNob3IsIHtcbiAgICAgICAgbGVmdDogMSxcbiAgICAgICAgYm90dG9tOiAzXG4gICAgICB9KSwgJ2xheW91dC1pbm5lci1zdycpO1xuICAgIH07XG4gICAgdmFyIG5vcnRoZWFzdCQzID0gZnVuY3Rpb24gKGFuY2hvciwgZWxlbWVudCwgYnViYmxlcykge1xuICAgICAgcmV0dXJuIG51JDcoZWFzdEVkZ2VYJDEoYW5jaG9yLCBlbGVtZW50KSwgbm9ydGhZJDIoYW5jaG9yKSwgYnViYmxlcy5pbm5lck5vcnRoZWFzdCgpLCBzb3V0aHdlc3QoKSwgYm91bmRzUmVzdHJpY3Rpb24oYW5jaG9yLCB7XG4gICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICB0b3A6IDJcbiAgICAgIH0pLCAnbGF5b3V0LWlubmVyLW5lJyk7XG4gICAgfTtcbiAgICB2YXIgbm9ydGh3ZXN0JDMgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyh3ZXN0RWRnZVgkMShhbmNob3IpLCBub3J0aFkkMihhbmNob3IpLCBidWJibGVzLmlubmVyTm9ydGh3ZXN0KCksIHNvdXRoZWFzdCgpLCBib3VuZHNSZXN0cmljdGlvbihhbmNob3IsIHtcbiAgICAgICAgbGVmdDogMSxcbiAgICAgICAgdG9wOiAyXG4gICAgICB9KSwgJ2xheW91dC1pbm5lci1udycpO1xuICAgIH07XG4gICAgdmFyIG5vcnRoJDMgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyhtaWRkbGVYJDEoYW5jaG9yLCBlbGVtZW50KSwgbm9ydGhZJDIoYW5jaG9yKSwgYnViYmxlcy5pbm5lck5vcnRoKCksIHNvdXRoKCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwgeyB0b3A6IDIgfSksICdsYXlvdXQtaW5uZXItbicpO1xuICAgIH07XG4gICAgdmFyIHNvdXRoJDMgPSBmdW5jdGlvbiAoYW5jaG9yLCBlbGVtZW50LCBidWJibGVzKSB7XG4gICAgICByZXR1cm4gbnUkNyhtaWRkbGVYJDEoYW5jaG9yLCBlbGVtZW50KSwgc291dGhZJDIoYW5jaG9yLCBlbGVtZW50KSwgYnViYmxlcy5pbm5lclNvdXRoKCksIG5vcnRoKCksIGJvdW5kc1Jlc3RyaWN0aW9uKGFuY2hvciwgeyBib3R0b206IDMgfSksICdsYXlvdXQtaW5uZXItcycpO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDIgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLkRlbGF5Jyk7XG5cbiAgICB2YXIgZmFjdG9yeSQxID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgdmFyIGV2ZW50cyA9IGV2ZW50cyQ3KGRldGFpbC5hY3Rpb24pO1xuICAgICAgdmFyIHRhZyA9IGRldGFpbC5kb20udGFnO1xuICAgICAgdmFyIGxvb2t1cEF0dHIgPSBmdW5jdGlvbiAoYXR0cikge1xuICAgICAgICByZXR1cm4gZ2V0JDEoZGV0YWlsLmRvbSwgJ2F0dHJpYnV0ZXMnKS5iaW5kKGZ1bmN0aW9uIChhdHRycykge1xuICAgICAgICAgIHJldHVybiBnZXQkMShhdHRycywgYXR0cik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRNb2RBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGFnID09PSAnYnV0dG9uJykge1xuICAgICAgICAgIHZhciB0eXBlID0gbG9va3VwQXR0cigndHlwZScpLmdldE9yKCdidXR0b24nKTtcbiAgICAgICAgICB2YXIgcm9sZUF0dHJzID0gbG9va3VwQXR0cigncm9sZScpLm1hcChmdW5jdGlvbiAocm9sZSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgcm9sZTogcm9sZSB9O1xuICAgICAgICAgIH0pLmdldE9yKHt9KTtcbiAgICAgICAgICByZXR1cm4gX19hc3NpZ24oeyB0eXBlOiB0eXBlIH0sIHJvbGVBdHRycyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJvbGUgPSBsb29rdXBBdHRyKCdyb2xlJykuZ2V0T3IoJ2J1dHRvbicpO1xuICAgICAgICAgIHJldHVybiB7IHJvbGU6IHJvbGUgfTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBkZXRhaWwuY29tcG9uZW50cyxcbiAgICAgICAgZXZlbnRzOiBldmVudHMsXG4gICAgICAgIGJlaGF2aW91cnM6IFNrZXRjaEJlaGF2aW91cnMuYXVnbWVudChkZXRhaWwuYnV0dG9uQmVoYXZpb3VycywgW1xuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnZXhlY3V0aW9uJyxcbiAgICAgICAgICAgIHVzZVNwYWNlOiB0cnVlLFxuICAgICAgICAgICAgdXNlRW50ZXI6IHRydWVcbiAgICAgICAgICB9KVxuICAgICAgICBdKSxcbiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IGF0dHJpYnV0ZXM6IGdldE1vZEF0dHJpYnV0ZXMoKSB9LFxuICAgICAgICBldmVudE9yZGVyOiBkZXRhaWwuZXZlbnRPcmRlclxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBCdXR0b24gPSBzaW5nbGUkMih7XG4gICAgICBuYW1lOiAnQnV0dG9uJyxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnkkMSxcbiAgICAgIGNvbmZpZ0ZpZWxkczogW1xuICAgICAgICBkZWZhdWx0ZWQkMSgndWlkJywgdW5kZWZpbmVkKSxcbiAgICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnY29tcG9uZW50cycsIFtdKSxcbiAgICAgICAgU2tldGNoQmVoYXZpb3Vycy5maWVsZCgnYnV0dG9uQmVoYXZpb3VycycsIFtcbiAgICAgICAgICBGb2N1c2luZyxcbiAgICAgICAgICBLZXlpbmdcbiAgICAgICAgXSksXG4gICAgICAgIG9wdGlvbignYWN0aW9uJyksXG4gICAgICAgIG9wdGlvbigncm9sZScpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRPcmRlcicsIHt9KVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgdmFyIHJlY29yZCA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICB2YXIgdWlkID0gaXNTa2V0Y2hTcGVjKHNwZWMpICYmIGhhc05vbk51bGxhYmxlS2V5KHNwZWMsICd1aWQnKSA/IHNwZWMudWlkIDogZ2VuZXJhdGUkMignbWVtZW50bycpO1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICByZXR1cm4gYW55SW5TeXN0ZW0uZ2V0U3lzdGVtKCkuZ2V0QnlVaWQodWlkKS5nZXRPckRpZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRPcHQgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGFueUluU3lzdGVtLmdldFN5c3RlbSgpLmdldEJ5VWlkKHVpZCkudG9PcHRpb25hbCgpO1xuICAgICAgfTtcbiAgICAgIHZhciBhc1NwZWMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3BlYyksIHsgdWlkOiB1aWQgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIGdldE9wdDogZ2V0T3B0LFxuICAgICAgICBhc1NwZWM6IGFzU3BlY1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGRlZmF1bHRJY29uID0gZnVuY3Rpb24gKGljb25zKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShpY29ucygpWyd0ZW1wb3JhcnktcGxhY2Vob2xkZXInXSkuZ2V0T3IoJyFub3QgZm91bmQhJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0JGUgPSBmdW5jdGlvbiAobmFtZSwgaWNvbnMpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGljb25zKClbbmFtZS50b0xvd2VyQ2FzZSgpXSkuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0SWNvbihpY29ucyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRPciA9IGZ1bmN0aW9uIChuYW1lLCBpY29ucywgZmFsbGJhY2spIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGljb25zKClbbmFtZS50b0xvd2VyQ2FzZSgpXSkub3IoZmFsbGJhY2spLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZGVmYXVsdEljb24oaWNvbnMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Rmlyc3QkMSA9IGZ1bmN0aW9uIChuYW1lcywgaWNvbnMpIHtcbiAgICAgIHJldHVybiBmaW5kTWFwKG5hbWVzLCBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShpY29ucygpW25hbWUudG9Mb3dlckNhc2UoKV0pO1xuICAgICAgfSkuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0SWNvbihpY29ucyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG5vdGlmaWNhdGlvbkljb25NYXAgPSB7XG4gICAgICBzdWNjZXNzOiAnY2hlY2ttYXJrJyxcbiAgICAgIGVycm9yOiAnd2FybmluZycsXG4gICAgICBlcnI6ICdlcnJvcicsXG4gICAgICB3YXJuaW5nOiAnd2FybmluZycsXG4gICAgICB3YXJuOiAnd2FybmluZycsXG4gICAgICBpbmZvOiAnaW5mbydcbiAgICB9O1xuICAgIHZhciBmYWN0b3J5JDIgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICB2YXIgbWVtQmFubmVyVGV4dCA9IHJlY29yZCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ3AnLFxuICAgICAgICAgIGlubmVySHRtbDogZGV0YWlsLnRyYW5zbGF0aW9uUHJvdmlkZXIoZGV0YWlsLnRleHQpXG4gICAgICAgIH0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtSZXBsYWNpbmcuY29uZmlnKHt9KV0pXG4gICAgICB9KTtcbiAgICAgIHZhciByZW5kZXJQZXJjZW50QmFyID0gZnVuY3Rpb24gKHBlcmNlbnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1iYXInXSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgc3R5bGU6ICd3aWR0aDogJyArIHBlcmNlbnQgKyAnJScgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVuZGVyUGVyY2VudFRleHQgPSBmdW5jdGlvbiAocGVyY2VudCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LXRleHQnXSxcbiAgICAgICAgICAgIGlubmVySHRtbDogcGVyY2VudCArICclJ1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgbWVtQmFubmVyUHJvZ3Jlc3MgPSByZWNvcmQoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IGRldGFpbC5wcm9ncmVzcyA/IFtcbiAgICAgICAgICAgICd0b3gtcHJvZ3Jlc3MtYmFyJyxcbiAgICAgICAgICAgICd0b3gtcHJvZ3Jlc3MtaW5kaWNhdG9yJ1xuICAgICAgICAgIF0gOiBbJ3RveC1wcm9ncmVzcy1iYXInXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWJhci1jb250YWluZXInXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IFtyZW5kZXJQZXJjZW50QmFyKDApXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVuZGVyUGVyY2VudFRleHQoMClcbiAgICAgICAgXSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1JlcGxhY2luZy5jb25maWcoe30pXSlcbiAgICAgIH0pO1xuICAgICAgdmFyIHVwZGF0ZVByb2dyZXNzID0gZnVuY3Rpb24gKGNvbXAsIHBlcmNlbnQpIHtcbiAgICAgICAgaWYgKGNvbXAuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgIG1lbUJhbm5lclByb2dyZXNzLmdldE9wdChjb21wKS5lYWNoKGZ1bmN0aW9uIChwcm9ncmVzcykge1xuICAgICAgICAgICAgUmVwbGFjaW5nLnNldChwcm9ncmVzcywgW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtYmFyLWNvbnRhaW5lciddXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb21wb25lbnRzOiBbcmVuZGVyUGVyY2VudEJhcihwZXJjZW50KV1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgcmVuZGVyUGVyY2VudFRleHQocGVyY2VudClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZVRleHQgPSBmdW5jdGlvbiAoY29tcCwgdGV4dCQxKSB7XG4gICAgICAgIGlmIChjb21wLmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICB2YXIgYmFubmVyID0gbWVtQmFubmVyVGV4dC5nZXQoY29tcCk7XG4gICAgICAgICAgUmVwbGFjaW5nLnNldChiYW5uZXIsIFt0ZXh0KHRleHQkMSldKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBhcGlzID0ge1xuICAgICAgICB1cGRhdGVQcm9ncmVzczogdXBkYXRlUHJvZ3Jlc3MsXG4gICAgICAgIHVwZGF0ZVRleHQ6IHVwZGF0ZVRleHRcbiAgICAgIH07XG4gICAgICB2YXIgaWNvbkNob2ljZXMgPSBmbGF0dGVuKFtcbiAgICAgICAgZGV0YWlsLmljb24udG9BcnJheSgpLFxuICAgICAgICBkZXRhaWwubGV2ZWwudG9BcnJheSgpLFxuICAgICAgICBkZXRhaWwubGV2ZWwuYmluZChmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShub3RpZmljYXRpb25JY29uTWFwW2xldmVsXSk7XG4gICAgICAgIH0pLnRvQXJyYXkoKVxuICAgICAgXSk7XG4gICAgICB2YXIgbWVtQnV0dG9uID0gcmVjb3JkKEJ1dHRvbi5za2V0Y2goe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICd0b3gtbm90aWZpY2F0aW9uX19kaXNtaXNzJyxcbiAgICAgICAgICAgICd0b3gtYnV0dG9uJyxcbiAgICAgICAgICAgICd0b3gtYnV0dG9uLS1uYWtlZCcsXG4gICAgICAgICAgICAndG94LWJ1dHRvbi0taWNvbidcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtaWNvbiddLFxuICAgICAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCdjbG9zZScsIGRldGFpbC5pY29uUHJvdmlkZXIpLFxuICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7ICdhcmlhLWxhYmVsJzogZGV0YWlsLnRyYW5zbGF0aW9uUHJvdmlkZXIoJ0Nsb3NlJykgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1dLFxuICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgZGV0YWlsLm9uQWN0aW9uKGNvbXApO1xuICAgICAgICB9XG4gICAgICB9KSk7XG4gICAgICB2YXIgY29tcG9uZW50cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LW5vdGlmaWNhdGlvbl9faWNvbiddLFxuICAgICAgICAgICAgaW5uZXJIdG1sOiBnZXRGaXJzdCQxKGljb25DaG9pY2VzLCBkZXRhaWwuaWNvblByb3ZpZGVyKVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LW5vdGlmaWNhdGlvbl9fYm9keSddXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wb25lbnRzOiBbbWVtQmFubmVyVGV4dC5hc1NwZWMoKV0sXG4gICAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1JlcGxhY2luZy5jb25maWcoe30pXSlcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHJvbGU6ICdhbGVydCcgfSxcbiAgICAgICAgICBjbGFzc2VzOiBkZXRhaWwubGV2ZWwubWFwKGZ1bmN0aW9uIChsZXZlbCkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgJ3RveC1ub3RpZmljYXRpb24nLFxuICAgICAgICAgICAgICAndG94LW5vdGlmaWNhdGlvbi0taW4nLFxuICAgICAgICAgICAgICAndG94LW5vdGlmaWNhdGlvbi0tJyArIGxldmVsXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIH0pLmdldE9yKFtcbiAgICAgICAgICAgICd0b3gtbm90aWZpY2F0aW9uJyxcbiAgICAgICAgICAgICd0b3gtbm90aWZpY2F0aW9uLS1pbidcbiAgICAgICAgICBdKVxuICAgICAgICB9LFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBjb25maWcoJ25vdGlmaWNhdGlvbi1ldmVudHMnLCBbcnVuKGZvY3VzaW4oKSwgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgbWVtQnV0dG9uLmdldE9wdChjb21wKS5lYWNoKEZvY3VzaW5nLmZvY3VzKTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgXSksXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHMuY29uY2F0KGRldGFpbC5wcm9ncmVzcyA/IFttZW1CYW5uZXJQcm9ncmVzcy5hc1NwZWMoKV0gOiBbXSkuY29uY2F0KCFkZXRhaWwuY2xvc2VCdXR0b24gPyBbXSA6IFttZW1CdXR0b24uYXNTcGVjKCldKSxcbiAgICAgICAgYXBpczogYXBpc1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBOb3RpZmljYXRpb24gPSBzaW5nbGUkMih7XG4gICAgICBuYW1lOiAnTm90aWZpY2F0aW9uJyxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnkkMixcbiAgICAgIGNvbmZpZ0ZpZWxkczogW1xuICAgICAgICBvcHRpb24oJ2xldmVsJyksXG4gICAgICAgIHN0cmljdCQxKCdwcm9ncmVzcycpLFxuICAgICAgICBzdHJpY3QkMSgnaWNvbicpLFxuICAgICAgICBzdHJpY3QkMSgnb25BY3Rpb24nKSxcbiAgICAgICAgc3RyaWN0JDEoJ3RleHQnKSxcbiAgICAgICAgc3RyaWN0JDEoJ2ljb25Qcm92aWRlcicpLFxuICAgICAgICBzdHJpY3QkMSgndHJhbnNsYXRpb25Qcm92aWRlcicpLFxuICAgICAgICBkZWZhdWx0ZWRCb29sZWFuKCdjbG9zZUJ1dHRvbicsIHRydWUpXG4gICAgICBdLFxuICAgICAgYXBpczoge1xuICAgICAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24gKGFwaXMsIGNvbXAsIHBlcmNlbnQpIHtcbiAgICAgICAgICBhcGlzLnVwZGF0ZVByb2dyZXNzKGNvbXAsIHBlcmNlbnQpO1xuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVUZXh0OiBmdW5jdGlvbiAoYXBpcywgY29tcCwgdGV4dCkge1xuICAgICAgICAgIGFwaXMudXBkYXRlVGV4dChjb21wLCB0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gTm90aWZpY2F0aW9uTWFuYWdlckltcGwgKGVkaXRvciwgZXh0cmFzLCB1aU1vdGhlcnNoaXApIHtcbiAgICAgIHZhciBiYWNrc3RhZ2UgPSBleHRyYXMuYmFja3N0YWdlO1xuICAgICAgdmFyIGdldExheW91dERpcmVjdGlvbiA9IGZ1bmN0aW9uIChyZWwpIHtcbiAgICAgICAgc3dpdGNoIChyZWwpIHtcbiAgICAgICAgY2FzZSAnYmMtYmMnOlxuICAgICAgICAgIHJldHVybiBzb3V0aCQzO1xuICAgICAgICBjYXNlICd0Yy10Yyc6XG4gICAgICAgICAgcmV0dXJuIG5vcnRoJDM7XG4gICAgICAgIGNhc2UgJ3RjLWJjJzpcbiAgICAgICAgICByZXR1cm4gbm9ydGgkMTtcbiAgICAgICAgY2FzZSAnYmMtdGMnOlxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBzb3V0aCQxO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHByZVBvc2l0aW9uTm90aWZpY2F0aW9ucyA9IGZ1bmN0aW9uIChub3RpZmljYXRpb25zKSB7XG4gICAgICAgIGVhY2gobm90aWZpY2F0aW9ucywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikge1xuICAgICAgICAgIHJldHVybiBub3RpZmljYXRpb24ubW92ZVRvKDAsIDApO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgcG9zaXRpb25Ob3RpZmljYXRpb25zID0gZnVuY3Rpb24gKG5vdGlmaWNhdGlvbnMpIHtcbiAgICAgICAgaWYgKG5vdGlmaWNhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGhlYWQobm90aWZpY2F0aW9ucykuZWFjaChmdW5jdGlvbiAoZmlyc3RJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gZmlyc3RJdGVtLm1vdmVSZWwobnVsbCwgJ2Jhbm5lcicpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGVhY2gobm90aWZpY2F0aW9ucywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLm1vdmVSZWwobm90aWZpY2F0aW9uc1tpbmRleCAtIDFdLmdldEVsKCksICdiYy10YycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHJlcG9zaXRpb24gPSBmdW5jdGlvbiAobm90aWZpY2F0aW9ucykge1xuICAgICAgICBwcmVQb3NpdGlvbk5vdGlmaWNhdGlvbnMobm90aWZpY2F0aW9ucyk7XG4gICAgICAgIHBvc2l0aW9uTm90aWZpY2F0aW9ucyhub3RpZmljYXRpb25zKTtcbiAgICAgIH07XG4gICAgICB2YXIgb3BlbiA9IGZ1bmN0aW9uIChzZXR0aW5ncywgY2xvc2VDYWxsYmFjaykge1xuICAgICAgICB2YXIgaGlkZUNsb3NlQnV0dG9uID0gIXNldHRpbmdzLmNsb3NlQnV0dG9uICYmIHNldHRpbmdzLnRpbWVvdXQgJiYgKHNldHRpbmdzLnRpbWVvdXQgPiAwIHx8IHNldHRpbmdzLnRpbWVvdXQgPCAwKTtcbiAgICAgICAgdmFyIGNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNsb3NlQ2FsbGJhY2soKTtcbiAgICAgICAgICBJbmxpbmVWaWV3LmhpZGUobm90aWZpY2F0aW9uV3JhcHBlcik7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBub3RpZmljYXRpb24gPSBidWlsZCQxKE5vdGlmaWNhdGlvbi5za2V0Y2goe1xuICAgICAgICAgIHRleHQ6IHNldHRpbmdzLnRleHQsXG4gICAgICAgICAgbGV2ZWw6IGNvbnRhaW5zKFtcbiAgICAgICAgICAgICdzdWNjZXNzJyxcbiAgICAgICAgICAgICdlcnJvcicsXG4gICAgICAgICAgICAnd2FybmluZycsXG4gICAgICAgICAgICAnd2FybicsXG4gICAgICAgICAgICAnaW5mbydcbiAgICAgICAgICBdLCBzZXR0aW5ncy50eXBlKSA/IHNldHRpbmdzLnR5cGUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgcHJvZ3Jlc3M6IHNldHRpbmdzLnByb2dyZXNzQmFyID09PSB0cnVlLFxuICAgICAgICAgIGljb246IE9wdGlvbmFsLmZyb20oc2V0dGluZ3MuaWNvbiksXG4gICAgICAgICAgY2xvc2VCdXR0b246ICFoaWRlQ2xvc2VCdXR0b24sXG4gICAgICAgICAgb25BY3Rpb246IGNsb3NlLFxuICAgICAgICAgIGljb25Qcm92aWRlcjogYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMuaWNvbnMsXG4gICAgICAgICAgdHJhbnNsYXRpb25Qcm92aWRlcjogYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMudHJhbnNsYXRlXG4gICAgICAgIH0pKTtcbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbldyYXBwZXIgPSBidWlsZCQxKElubGluZVZpZXcuc2tldGNoKF9fYXNzaWduKHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1ub3RpZmljYXRpb25zLWNvbnRhaW5lciddXG4gICAgICAgICAgfSxcbiAgICAgICAgICBsYXp5U2luazogZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQuZ2V0U2luayxcbiAgICAgICAgICBmaXJlRGlzbWlzc2FsRXZlbnRJbnN0ZWFkOiB7fVxuICAgICAgICB9LCBiYWNrc3RhZ2Uuc2hhcmVkLmhlYWRlci5pc1Bvc2l0aW9uZWRBdFRvcCgpID8ge30gOiB7IGZpcmVSZXBvc2l0aW9uRXZlbnRJbnN0ZWFkOiB7fSB9KSkpO1xuICAgICAgICB1aU1vdGhlcnNoaXAuYWRkKG5vdGlmaWNhdGlvbldyYXBwZXIpO1xuICAgICAgICBpZiAoc2V0dGluZ3MudGltZW91dCA+IDApIHtcbiAgICAgICAgICBnbG9iYWwkMi5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgfSwgc2V0dGluZ3MudGltZW91dCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjbG9zZTogY2xvc2UsXG4gICAgICAgICAgbW92ZVRvOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgICAgSW5saW5lVmlldy5zaG93QXQobm90aWZpY2F0aW9uV3JhcHBlciwge1xuICAgICAgICAgICAgICBhbmNob3I6ICdtYWtlc2hpZnQnLFxuICAgICAgICAgICAgICB4OiB4LFxuICAgICAgICAgICAgICB5OiB5XG4gICAgICAgICAgICB9LCBwcmVtYWRlJDEobm90aWZpY2F0aW9uKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb3ZlUmVsOiBmdW5jdGlvbiAoZWxlbWVudCwgcmVsKSB7XG4gICAgICAgICAgICBpZiAocmVsICE9PSAnYmFubmVyJykge1xuICAgICAgICAgICAgICB2YXIgbGF5b3V0RGlyZWN0aW9uXzEgPSBnZXRMYXlvdXREaXJlY3Rpb24ocmVsKTtcbiAgICAgICAgICAgICAgdmFyIG5vZGVBbmNob3IgPSB7XG4gICAgICAgICAgICAgICAgYW5jaG9yOiAnbm9kZScsXG4gICAgICAgICAgICAgICAgcm9vdDogYm9keSgpLFxuICAgICAgICAgICAgICAgIG5vZGU6IE9wdGlvbmFsLnNvbWUoU3VnYXJFbGVtZW50LmZyb21Eb20oZWxlbWVudCkpLFxuICAgICAgICAgICAgICAgIGxheW91dHM6IHtcbiAgICAgICAgICAgICAgICAgIG9uUnRsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbbGF5b3V0RGlyZWN0aW9uXzFdO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbbGF5b3V0RGlyZWN0aW9uXzFdO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgSW5saW5lVmlldy5zaG93QXQobm90aWZpY2F0aW9uV3JhcHBlciwgbm9kZUFuY2hvciwgcHJlbWFkZSQxKG5vdGlmaWNhdGlvbikpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgSW5saW5lVmlldy5zaG93QXQobm90aWZpY2F0aW9uV3JhcHBlciwgZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQuYW5jaG9ycy5iYW5uZXIoKSwgcHJlbWFkZSQxKG5vdGlmaWNhdGlvbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGV4dDogZnVuY3Rpb24gKG51VGV4dCkge1xuICAgICAgICAgICAgTm90aWZpY2F0aW9uLnVwZGF0ZVRleHQobm90aWZpY2F0aW9uLCBudVRleHQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0dGluZ3M6IHNldHRpbmdzLFxuICAgICAgICAgIGdldEVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uLmVsZW1lbnQuZG9tO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvZ3Jlc3NCYXI6IHtcbiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAocGVyY2VudCkge1xuICAgICAgICAgICAgICBOb3RpZmljYXRpb24udXBkYXRlUHJvZ3Jlc3Mobm90aWZpY2F0aW9uLCBwZXJjZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGNsb3NlID0gZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikge1xuICAgICAgICBub3RpZmljYXRpb24uY2xvc2UoKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0QXJncyA9IGZ1bmN0aW9uIChub3RpZmljYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvbi5zZXR0aW5ncztcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvcGVuOiBvcGVuLFxuICAgICAgICBjbG9zZTogY2xvc2UsXG4gICAgICAgIHJlcG9zaXRpb246IHJlcG9zaXRpb24sXG4gICAgICAgIGdldEFyZ3M6IGdldEFyZ3NcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdmFyIGZpcnN0ID0gZnVuY3Rpb24gKGZuLCByYXRlKSB7XG4gICAgICB2YXIgdGltZXIgPSBudWxsO1xuICAgICAgdmFyIGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICB0aW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgdGhyb3R0bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aW1lciA9PT0gbnVsbCkge1xuICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmbi5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICAgIHRpbWVyID0gbnVsbDtcbiAgICAgICAgICB9LCByYXRlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbmNlbDogY2FuY2VsLFxuICAgICAgICB0aHJvdHRsZTogdGhyb3R0bGVcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbGFzdCQyID0gZnVuY3Rpb24gKGZuLCByYXRlKSB7XG4gICAgICB2YXIgdGltZXIgPSBudWxsO1xuICAgICAgdmFyIGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgICB0aW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgdGhyb3R0bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgIH1cbiAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmbi5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICB0aW1lciA9IG51bGw7XG4gICAgICAgIH0sIHJhdGUpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbmNlbDogY2FuY2VsLFxuICAgICAgICB0aHJvdHRsZTogdGhyb3R0bGVcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkMyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5UZXh0U2Vla2VyJyk7XG5cbiAgICB2YXIgaXNCb3VuZGFyeSA9IGZ1bmN0aW9uIChkb20sIG5vZGUpIHtcbiAgICAgIHJldHVybiBkb20uaXNCbG9jayhub2RlKSB8fCBjb250YWlucyhbXG4gICAgICAgICdCUicsXG4gICAgICAgICdJTUcnLFxuICAgICAgICAnSFInLFxuICAgICAgICAnSU5QVVQnXG4gICAgICBdLCBub2RlLm5vZGVOYW1lKSB8fCBkb20uZ2V0Q29udGVudEVkaXRhYmxlKG5vZGUpID09PSAnZmFsc2UnO1xuICAgIH07XG4gICAgdmFyIHJlcGVhdExlZnQgPSBmdW5jdGlvbiAoZG9tLCBub2RlLCBvZmZzZXQsIHByb2Nlc3MsIHJvb3ROb2RlKSB7XG4gICAgICB2YXIgc2VhcmNoID0gZ2xvYmFsJDMoZG9tLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICByZXR1cm4gaXNCb3VuZGFyeShkb20sIG5vZGUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShzZWFyY2guYmFja3dhcmRzKG5vZGUsIG9mZnNldCwgcHJvY2Vzcywgcm9vdE5vZGUpKTtcbiAgICB9O1xuXG4gICAgdmFyIGF1dG9jb21wbGV0ZVNlbGVjdG9yID0gJ1tkYXRhLW1jZS1hdXRvY29tcGxldGVyXSc7XG4gICAgdmFyIGNyZWF0ZSQ0ID0gZnVuY3Rpb24gKGVkaXRvciwgcmFuZ2UpIHtcbiAgICAgIHJldHVybiBkZXRlY3QkNChTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKSkpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgd3JhcHBlciA9IFN1Z2FyRWxlbWVudC5mcm9tSHRtbCgnPHNwYW4gZGF0YS1tY2UtYXV0b2NvbXBsZXRlcj1cIjFcIiBkYXRhLW1jZS1ib2d1cz1cIjFcIj48L3NwYW4+JywgZWRpdG9yLmdldERvYygpKTtcbiAgICAgICAgYXBwZW5kKHdyYXBwZXIsIFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJhbmdlLmV4dHJhY3RDb250ZW50cygpKSk7XG4gICAgICAgIHJhbmdlLmluc2VydE5vZGUod3JhcHBlci5kb20pO1xuICAgICAgICBwYXJlbnQod3JhcHBlcikuZWFjaChmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgICAgcmV0dXJuIGVsbS5kb20ubm9ybWFsaXplKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBsYXN0JDEod3JhcHBlcikubWFwKGZ1bmN0aW9uIChsYXN0KSB7XG4gICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRDdXJzb3JMb2NhdGlvbihsYXN0LmRvbSwgZ2V0RW5kKGxhc3QpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB3cmFwcGVyO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZGV0ZWN0JDQgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICByZXR1cm4gY2xvc2VzdCQzKGVsbSwgYXV0b2NvbXBsZXRlU2VsZWN0b3IpO1xuICAgIH07XG5cbiAgICB2YXIgaXNWYWxpZFRleHRSYW5nZSA9IGZ1bmN0aW9uIChybmcpIHtcbiAgICAgIHJldHVybiBybmcuY29sbGFwc2VkICYmIHJuZy5zdGFydENvbnRhaW5lci5ub2RlVHlwZSA9PT0gMztcbiAgICB9O1xuICAgIHZhciBnZXRUZXh0ID0gZnVuY3Rpb24gKHJuZykge1xuICAgICAgcmV0dXJuIHJuZy50b1N0cmluZygpLnJlcGxhY2UoL1xcdTAwQTAvZywgJyAnKS5yZXBsYWNlKC9cXHVGRUZGL2csICcnKTtcbiAgICB9O1xuICAgIHZhciBpc1doaXRlc3BhY2UgPSBmdW5jdGlvbiAoY2hyKSB7XG4gICAgICByZXR1cm4gY2hyICE9PSAnJyAmJiAnIFxceEEwXFxmXFxuXFxyXFx0XFx4MEInLmluZGV4T2YoY2hyKSAhPT0gLTE7XG4gICAgfTtcblxuICAgIHZhciBzdHJpcFRyaWdnZXJDaGFyID0gZnVuY3Rpb24gKHRleHQsIHRyaWdnZXJDaCkge1xuICAgICAgcmV0dXJuIHRleHQuc3Vic3RyaW5nKHRyaWdnZXJDaC5sZW5ndGgpO1xuICAgIH07XG4gICAgdmFyIGZpbmRDaGFyID0gZnVuY3Rpb24gKHRleHQsIGluZGV4LCBjaCkge1xuICAgICAgdmFyIGk7XG4gICAgICBmb3IgKGkgPSBpbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHZhciBjaGFyID0gdGV4dC5jaGFyQXQoaSk7XG4gICAgICAgIGlmIChpc1doaXRlc3BhY2UoY2hhcikpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFyID09PSBjaCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShpKTtcbiAgICB9O1xuICAgIHZhciBmaW5kU3RhcnQgPSBmdW5jdGlvbiAoZG9tLCBpbml0UmFuZ2UsIGNoLCBtaW5DaGFycykge1xuICAgICAgaWYgKG1pbkNoYXJzID09PSB2b2lkIDApIHtcbiAgICAgICAgbWluQ2hhcnMgPSAwO1xuICAgICAgfVxuICAgICAgaWYgKCFpc1ZhbGlkVGV4dFJhbmdlKGluaXRSYW5nZSkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHZhciBmaW5kVHJpZ2dlckNoSW5kZXggPSBmdW5jdGlvbiAoZWxlbWVudCwgb2Zmc2V0LCB0ZXh0KSB7XG4gICAgICAgIHJldHVybiBmaW5kQ2hhcih0ZXh0LCBvZmZzZXQsIGNoKS5nZXRPcihvZmZzZXQpO1xuICAgICAgfTtcbiAgICAgIHZhciByb290ID0gZG9tLmdldFBhcmVudChpbml0UmFuZ2Uuc3RhcnRDb250YWluZXIsIGRvbS5pc0Jsb2NrKSB8fCBkb20uZ2V0Um9vdCgpO1xuICAgICAgcmV0dXJuIHJlcGVhdExlZnQoZG9tLCBpbml0UmFuZ2Uuc3RhcnRDb250YWluZXIsIGluaXRSYW5nZS5zdGFydE9mZnNldCwgZmluZFRyaWdnZXJDaEluZGV4LCByb290KS5iaW5kKGZ1bmN0aW9uIChzcG90KSB7XG4gICAgICAgIHZhciByYW5nZSA9IGluaXRSYW5nZS5jbG9uZVJhbmdlKCk7XG4gICAgICAgIHJhbmdlLnNldFN0YXJ0KHNwb3QuY29udGFpbmVyLCBzcG90Lm9mZnNldCk7XG4gICAgICAgIHJhbmdlLnNldEVuZChpbml0UmFuZ2UuZW5kQ29udGFpbmVyLCBpbml0UmFuZ2UuZW5kT2Zmc2V0KTtcbiAgICAgICAgaWYgKHJhbmdlLmNvbGxhcHNlZCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRleHQgPSBnZXRUZXh0KHJhbmdlKTtcbiAgICAgICAgdmFyIHRyaWdnZXJDaGFySW5kZXggPSB0ZXh0Lmxhc3RJbmRleE9mKGNoKTtcbiAgICAgICAgaWYgKHRyaWdnZXJDaGFySW5kZXggIT09IDAgfHwgc3RyaXBUcmlnZ2VyQ2hhcih0ZXh0LCBjaCkubGVuZ3RoIDwgbWluQ2hhcnMpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIHRleHQ6IHN0cmlwVHJpZ2dlckNoYXIodGV4dCwgY2gpLFxuICAgICAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICAgICAgdHJpZ2dlckNoYXI6IGNoXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldENvbnRleHQgPSBmdW5jdGlvbiAoZG9tLCBpbml0UmFuZ2UsIGNoLCBtaW5DaGFycykge1xuICAgICAgaWYgKG1pbkNoYXJzID09PSB2b2lkIDApIHtcbiAgICAgICAgbWluQ2hhcnMgPSAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRldGVjdCQ0KFN1Z2FyRWxlbWVudC5mcm9tRG9tKGluaXRSYW5nZS5zdGFydENvbnRhaW5lcikpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmluZFN0YXJ0KGRvbSwgaW5pdFJhbmdlLCBjaCwgbWluQ2hhcnMpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICB2YXIgcmFuZ2UgPSBkb20uY3JlYXRlUm5nKCk7XG4gICAgICAgIHJhbmdlLnNlbGVjdE5vZGUoZWxtLmRvbSk7XG4gICAgICAgIHZhciB0ZXh0ID0gZ2V0VGV4dChyYW5nZSk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICByYW5nZTogcmFuZ2UsXG4gICAgICAgICAgdGV4dDogc3RyaXBUcmlnZ2VyQ2hhcih0ZXh0LCBjaCksXG4gICAgICAgICAgdHJpZ2dlckNoYXI6IGNoXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzZXR1cCA9IGZ1bmN0aW9uIChhcGksIGVkaXRvcikge1xuICAgICAgZWRpdG9yLm9uKCdrZXlwcmVzcyBjb21wb3NpdGlvbmVuZCcsIGFwaS5vbktleXByZXNzLnRocm90dGxlKTtcbiAgICAgIGVkaXRvci5vbigncmVtb3ZlJywgYXBpLm9uS2V5cHJlc3MuY2FuY2VsKTtcbiAgICAgIHZhciByZWRpcmVjdEtleVRvSXRlbSA9IGZ1bmN0aW9uIChpdGVtLCBlKSB7XG4gICAgICAgIGVtaXRXaXRoKGl0ZW0sIGtleWRvd24oKSwgeyByYXc6IGUgfSk7XG4gICAgICB9O1xuICAgICAgZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGdldEl0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaS5nZXRWaWV3KCkuYmluZChIaWdobGlnaHRpbmcuZ2V0SGlnaGxpZ2h0ZWQpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoZS53aGljaCA9PT0gOCkge1xuICAgICAgICAgIGFwaS5vbktleXByZXNzLnRocm90dGxlKGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcGkuaXNBY3RpdmUoKSkge1xuICAgICAgICAgIGlmIChlLndoaWNoID09PSAyNykge1xuICAgICAgICAgICAgYXBpLmNhbmNlbElmTmVjZXNzYXJ5KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChhcGkuaXNNZW51T3BlbigpKSB7XG4gICAgICAgICAgICBpZiAoZS53aGljaCA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgZ2V0SXRlbSgpLmVhY2goZW1pdEV4ZWN1dGUpO1xuICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUud2hpY2ggPT09IDQwKSB7XG4gICAgICAgICAgICAgIGdldEl0ZW0oKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcGkuZ2V0VmlldygpLmVhY2goSGlnaGxpZ2h0aW5nLmhpZ2hsaWdodEZpcnN0KTtcbiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZWRpcmVjdEtleVRvSXRlbShpdGVtLCBlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS53aGljaCA9PT0gMzcgfHwgZS53aGljaCA9PT0gMzggfHwgZS53aGljaCA9PT0gMzkpIHtcbiAgICAgICAgICAgICAgZ2V0SXRlbSgpLmVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZWRpcmVjdEtleVRvSXRlbShpdGVtLCBlKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChlLndoaWNoID09PSAxMyB8fCBlLndoaWNoID09PSAzOCB8fCBlLndoaWNoID09PSA0MCkge1xuICAgICAgICAgICAgICBhcGkuY2FuY2VsSWZOZWNlc3NhcnkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdOb2RlQ2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGFwaS5pc0FjdGl2ZSgpICYmICFhcGkuaXNQcm9jZXNzaW5nQWN0aW9uKCkgJiYgZGV0ZWN0JDQoU3VnYXJFbGVtZW50LmZyb21Eb20oZS5lbGVtZW50KSkuaXNOb25lKCkpIHtcbiAgICAgICAgICBhcGkuY2FuY2VsSWZOZWNlc3NhcnkoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgQXV0b2NvbXBsZXRlckVkaXRvckV2ZW50cyA9IHsgc2V0dXA6IHNldHVwIH07XG5cbiAgICB2YXIgZ2xvYmFsJDQgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLlByb21pc2UnKTtcblxuICAgIHZhciBwb2ludCQxID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgb2Zmc2V0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lcixcbiAgICAgICAgb2Zmc2V0OiBvZmZzZXRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBpc1RleHQkMSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gVEVYVDtcbiAgICB9O1xuICAgIHZhciBpc0VsZW1lbnQkMSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gRUxFTUVOVDtcbiAgICB9O1xuICAgIHZhciB0b0xhc3QgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgaWYgKGlzVGV4dCQxKG5vZGUpKSB7XG4gICAgICAgIHJldHVybiBwb2ludCQxKG5vZGUsIG5vZGUuZGF0YS5sZW5ndGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZE5vZGVzO1xuICAgICAgICByZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID4gMCA/IHRvTGFzdChjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXSkgOiBwb2ludCQxKG5vZGUsIGNoaWxkcmVuLmxlbmd0aCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgdG9MZWFmID0gZnVuY3Rpb24gKG5vZGUsIG9mZnNldCkge1xuICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZE5vZGVzO1xuICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgb2Zmc2V0IDwgY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB0b0xlYWYoY2hpbGRyZW5bb2Zmc2V0XSwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGNoaWxkcmVuLmxlbmd0aCA+IDAgJiYgaXNFbGVtZW50JDEobm9kZSkgJiYgY2hpbGRyZW4ubGVuZ3RoID09PSBvZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIHRvTGFzdChjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcG9pbnQkMShub2RlLCBvZmZzZXQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaXNQcmV2aW91c0NoYXJDb250ZW50ID0gZnVuY3Rpb24gKGRvbSwgbGVhZikge1xuICAgICAgcmV0dXJuIHJlcGVhdExlZnQoZG9tLCBsZWFmLmNvbnRhaW5lciwgbGVhZi5vZmZzZXQsIGZ1bmN0aW9uIChlbGVtZW50LCBvZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIG9mZnNldCA9PT0gMCA/IC0xIDogb2Zmc2V0O1xuICAgICAgfSwgZG9tLmdldFJvb3QoKSkuZmlsdGVyKGZ1bmN0aW9uIChzcG90KSB7XG4gICAgICAgIHZhciBjaGFyID0gc3BvdC5jb250YWluZXIuZGF0YS5jaGFyQXQoc3BvdC5vZmZzZXQgLSAxKTtcbiAgICAgICAgcmV0dXJuICFpc1doaXRlc3BhY2UoY2hhcik7XG4gICAgICB9KS5pc1NvbWUoKTtcbiAgICB9O1xuICAgIHZhciBpc1N0YXJ0T2ZXb3JkID0gZnVuY3Rpb24gKGRvbSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChybmcpIHtcbiAgICAgICAgdmFyIGxlYWYgPSB0b0xlYWYocm5nLnN0YXJ0Q29udGFpbmVyLCBybmcuc3RhcnRPZmZzZXQpO1xuICAgICAgICByZXR1cm4gIWlzUHJldmlvdXNDaGFyQ29udGVudChkb20sIGxlYWYpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZXRUcmlnZ2VyQ29udGV4dCA9IGZ1bmN0aW9uIChkb20sIGluaXRSYW5nZSwgZGF0YWJhc2UpIHtcbiAgICAgIHJldHVybiBmaW5kTWFwKGRhdGFiYXNlLnRyaWdnZXJDaGFycywgZnVuY3Rpb24gKGNoKSB7XG4gICAgICAgIHJldHVybiBnZXRDb250ZXh0KGRvbSwgaW5pdFJhbmdlLCBjaCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBsb29rdXAgPSBmdW5jdGlvbiAoZWRpdG9yLCBnZXREYXRhYmFzZSkge1xuICAgICAgdmFyIGRhdGFiYXNlID0gZ2V0RGF0YWJhc2UoKTtcbiAgICAgIHZhciBybmcgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuICAgICAgcmV0dXJuIGdldFRyaWdnZXJDb250ZXh0KGVkaXRvci5kb20sIHJuZywgZGF0YWJhc2UpLmJpbmQoZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIGxvb2t1cFdpdGhDb250ZXh0KGVkaXRvciwgZ2V0RGF0YWJhc2UsIGNvbnRleHQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbG9va3VwV2l0aENvbnRleHQgPSBmdW5jdGlvbiAoZWRpdG9yLCBnZXREYXRhYmFzZSwgY29udGV4dCwgZmV0Y2hPcHRpb25zKSB7XG4gICAgICBpZiAoZmV0Y2hPcHRpb25zID09PSB2b2lkIDApIHtcbiAgICAgICAgZmV0Y2hPcHRpb25zID0ge307XG4gICAgICB9XG4gICAgICB2YXIgZGF0YWJhc2UgPSBnZXREYXRhYmFzZSgpO1xuICAgICAgdmFyIHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG4gICAgICB2YXIgc3RhcnRUZXh0ID0gcm5nLnN0YXJ0Q29udGFpbmVyLm5vZGVWYWx1ZTtcbiAgICAgIHZhciBhdXRvY29tcGxldGVycyA9IGZpbHRlcihkYXRhYmFzZS5sb29rdXBCeUNoYXIoY29udGV4dC50cmlnZ2VyQ2hhciksIGZ1bmN0aW9uIChhdXRvY29tcGxldGVyKSB7XG4gICAgICAgIHJldHVybiBjb250ZXh0LnRleHQubGVuZ3RoID49IGF1dG9jb21wbGV0ZXIubWluQ2hhcnMgJiYgYXV0b2NvbXBsZXRlci5tYXRjaGVzLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBpc1N0YXJ0T2ZXb3JkKGVkaXRvci5kb20pO1xuICAgICAgICB9KShjb250ZXh0LnJhbmdlLCBzdGFydFRleHQsIGNvbnRleHQudGV4dCk7XG4gICAgICB9KTtcbiAgICAgIGlmIChhdXRvY29tcGxldGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHZhciBsb29rdXBEYXRhID0gZ2xvYmFsJDQuYWxsKG1hcChhdXRvY29tcGxldGVycywgZnVuY3Rpb24gKGFjKSB7XG4gICAgICAgIHZhciBmZXRjaFJlc3VsdCA9IGFjLmZldGNoKGNvbnRleHQudGV4dCwgYWMubWF4UmVzdWx0cywgZmV0Y2hPcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIGZldGNoUmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWF0Y2hUZXh0OiBjb250ZXh0LnRleHQsXG4gICAgICAgICAgICBpdGVtczogcmVzdWx0cyxcbiAgICAgICAgICAgIGNvbHVtbnM6IGFjLmNvbHVtbnMsXG4gICAgICAgICAgICBvbkFjdGlvbjogYWMub25BY3Rpb24sXG4gICAgICAgICAgICBoaWdobGlnaHRPbjogYWMuaGlnaGxpZ2h0T25cbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH0pKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgbG9va3VwRGF0YTogbG9va3VwRGF0YSxcbiAgICAgICAgY29udGV4dDogY29udGV4dFxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzZXBhcmF0b3JNZW51SXRlbVNjaGVtYSA9IG9iak9mKFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgb3B0aW9uU3RyaW5nKCd0ZXh0JylcbiAgICBdKTtcbiAgICB2YXIgY3JlYXRlU2VwYXJhdG9yTWVudUl0ZW0gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGFzUmF3KCdzZXBhcmF0b3JtZW51aXRlbScsIHNlcGFyYXRvck1lbnVJdGVtU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuXG4gICAgdmFyIGF1dG9jb21wbGV0ZXJJdGVtU2NoZW1hID0gb2JqT2YoW1xuICAgICAgZGVmYXVsdGVkJDEoJ3R5cGUnLCAnYXV0b2NvbXBsZXRlaXRlbScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2FjdGl2ZScsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdkaXNhYmxlZCcsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdtZXRhJywge30pLFxuICAgICAgc3RyaWN0U3RyaW5nKCd2YWx1ZScpLFxuICAgICAgb3B0aW9uU3RyaW5nKCd0ZXh0JyksXG4gICAgICBvcHRpb25TdHJpbmcoJ2ljb24nKVxuICAgIF0pO1xuICAgIHZhciBhdXRvY29tcGxldGVyU2NoZW1hID0gb2JqT2YoW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0eXBlJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ2NoJyksXG4gICAgICBkZWZhdWx0ZWROdW1iZXIoJ21pbkNoYXJzJywgMSksXG4gICAgICBkZWZhdWx0ZWQkMSgnY29sdW1ucycsIDEpLFxuICAgICAgZGVmYXVsdGVkTnVtYmVyKCdtYXhSZXN1bHRzJywgMTApLFxuICAgICAgb3B0aW9uRnVuY3Rpb24oJ21hdGNoZXMnKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdmZXRjaCcpLFxuICAgICAgc3RyaWN0RnVuY3Rpb24oJ29uQWN0aW9uJyksXG4gICAgICBkZWZhdWx0ZWRBcnJheU9mKCdoaWdobGlnaHRPbicsIFtdLCBzdHJpbmcpXG4gICAgXSk7XG4gICAgdmFyIGNyZWF0ZVNlcGFyYXRvckl0ZW0gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGFzUmF3KCdBdXRvY29tcGxldGVyLlNlcGFyYXRvcicsIHNlcGFyYXRvck1lbnVJdGVtU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVBdXRvY29tcGxldGVySXRlbSA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ0F1dG9jb21wbGV0ZXIuSXRlbScsIGF1dG9jb21wbGV0ZXJJdGVtU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVBdXRvY29tcGxldGVyID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygnQXV0b2NvbXBsZXRlcicsIGF1dG9jb21wbGV0ZXJTY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgYmFzZVRvb2xiYXJCdXR0b25GaWVsZHMgPSBbXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdkaXNhYmxlZCcsIGZhbHNlKSxcbiAgICAgIG9wdGlvblN0cmluZygndG9vbHRpcCcpLFxuICAgICAgb3B0aW9uU3RyaW5nKCdpY29uJyksXG4gICAgICBvcHRpb25TdHJpbmcoJ3RleHQnKSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdvblNldHVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbm9vcDtcbiAgICAgIH0pXG4gICAgXTtcbiAgICB2YXIgdG9vbGJhckJ1dHRvblNjaGVtYSA9IG9iak9mKFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgc3RyaWN0RnVuY3Rpb24oJ29uQWN0aW9uJylcbiAgICBdLmNvbmNhdChiYXNlVG9vbGJhckJ1dHRvbkZpZWxkcykpO1xuICAgIHZhciBjcmVhdGVUb29sYmFyQnV0dG9uID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygndG9vbGJhcmJ1dHRvbicsIHRvb2xiYXJCdXR0b25TY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgYmFzZVRvb2xiYXJUb2dnbGVCdXR0b25GaWVsZHMgPSBbZGVmYXVsdGVkQm9vbGVhbignYWN0aXZlJywgZmFsc2UpXS5jb25jYXQoYmFzZVRvb2xiYXJCdXR0b25GaWVsZHMpO1xuICAgIHZhciB0b2dnbGVCdXR0b25TY2hlbWEgPSBvYmpPZihiYXNlVG9vbGJhclRvZ2dsZUJ1dHRvbkZpZWxkcy5jb25jYXQoW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0eXBlJyksXG4gICAgICBzdHJpY3RGdW5jdGlvbignb25BY3Rpb24nKVxuICAgIF0pKTtcbiAgICB2YXIgY3JlYXRlVG9nZ2xlQnV0dG9uID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygnVG9nZ2xlQnV0dG9uJywgdG9nZ2xlQnV0dG9uU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuXG4gICAgdmFyIGNvbnRleHRCYXJGaWVsZHMgPSBbXG4gICAgICBkZWZhdWx0ZWRGdW5jdGlvbigncHJlZGljYXRlJywgbmV2ZXIpLFxuICAgICAgZGVmYXVsdGVkU3RyaW5nRW51bSgnc2NvcGUnLCAnbm9kZScsIFtcbiAgICAgICAgJ25vZGUnLFxuICAgICAgICAnZWRpdG9yJ1xuICAgICAgXSksXG4gICAgICBkZWZhdWx0ZWRTdHJpbmdFbnVtKCdwb3NpdGlvbicsICdzZWxlY3Rpb24nLCBbXG4gICAgICAgICdub2RlJyxcbiAgICAgICAgJ3NlbGVjdGlvbicsXG4gICAgICAgICdsaW5lJ1xuICAgICAgXSlcbiAgICBdO1xuXG4gICAgdmFyIGNvbnRleHRCdXR0b25GaWVsZHMgPSBiYXNlVG9vbGJhckJ1dHRvbkZpZWxkcy5jb25jYXQoW1xuICAgICAgZGVmYXVsdGVkJDEoJ3R5cGUnLCAnY29udGV4dGZvcm1idXR0b24nKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdwcmltYXJ5JywgZmFsc2UpLFxuICAgICAgc3RyaWN0RnVuY3Rpb24oJ29uQWN0aW9uJyksXG4gICAgICBzdGF0ZSQxKCdvcmlnaW5hbCcsIGlkZW50aXR5KVxuICAgIF0pO1xuICAgIHZhciBjb250ZXh0VG9nZ2xlQnV0dG9uRmllbGRzID0gYmFzZVRvb2xiYXJUb2dnbGVCdXR0b25GaWVsZHMuY29uY2F0KFtcbiAgICAgIGRlZmF1bHRlZCQxKCd0eXBlJywgJ2NvbnRleHRmb3JtYnV0dG9uJyksXG4gICAgICBkZWZhdWx0ZWQkMSgncHJpbWFyeScsIGZhbHNlKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdvbkFjdGlvbicpLFxuICAgICAgc3RhdGUkMSgnb3JpZ2luYWwnLCBpZGVudGl0eSlcbiAgICBdKTtcbiAgICB2YXIgbGF1bmNoQnV0dG9uRmllbGRzID0gYmFzZVRvb2xiYXJCdXR0b25GaWVsZHMuY29uY2F0KFtkZWZhdWx0ZWQkMSgndHlwZScsICdjb250ZXh0Zm9ybWJ1dHRvbicpXSk7XG4gICAgdmFyIGxhdW5jaFRvZ2dsZUJ1dHRvbkZpZWxkcyA9IGJhc2VUb29sYmFyVG9nZ2xlQnV0dG9uRmllbGRzLmNvbmNhdChbZGVmYXVsdGVkJDEoJ3R5cGUnLCAnY29udGV4dGZvcm10b2dnbGVidXR0b24nKV0pO1xuICAgIHZhciB0b2dnbGVPck5vcm1hbCA9IGNob29zZSQxKCd0eXBlJywge1xuICAgICAgY29udGV4dGZvcm1idXR0b246IGNvbnRleHRCdXR0b25GaWVsZHMsXG4gICAgICBjb250ZXh0Zm9ybXRvZ2dsZWJ1dHRvbjogY29udGV4dFRvZ2dsZUJ1dHRvbkZpZWxkc1xuICAgIH0pO1xuICAgIHZhciBjb250ZXh0Rm9ybVNjaGVtYSA9IG9iak9mKFtcbiAgICAgIGRlZmF1bHRlZCQxKCd0eXBlJywgJ2NvbnRleHRmb3JtJyksXG4gICAgICBkZWZhdWx0ZWRGdW5jdGlvbignaW5pdFZhbHVlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9KSxcbiAgICAgIG9wdGlvblN0cmluZygnbGFiZWwnKSxcbiAgICAgIHN0cmljdEFycmF5T2YoJ2NvbW1hbmRzJywgdG9nZ2xlT3JOb3JtYWwpLFxuICAgICAgb3B0aW9uT2YoJ2xhdW5jaCcsIGNob29zZSQxKCd0eXBlJywge1xuICAgICAgICBjb250ZXh0Zm9ybWJ1dHRvbjogbGF1bmNoQnV0dG9uRmllbGRzLFxuICAgICAgICBjb250ZXh0Zm9ybXRvZ2dsZWJ1dHRvbjogbGF1bmNoVG9nZ2xlQnV0dG9uRmllbGRzXG4gICAgICB9KSlcbiAgICBdLmNvbmNhdChjb250ZXh0QmFyRmllbGRzKSk7XG4gICAgdmFyIGNyZWF0ZUNvbnRleHRGb3JtID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygnQ29udGV4dEZvcm0nLCBjb250ZXh0Rm9ybVNjaGVtYSwgc3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBjb250ZXh0VG9vbGJhclNjaGVtYSA9IG9iak9mKFtcbiAgICAgIGRlZmF1bHRlZCQxKCd0eXBlJywgJ2NvbnRleHR0b29sYmFyJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ2l0ZW1zJylcbiAgICBdLmNvbmNhdChjb250ZXh0QmFyRmllbGRzKSk7XG4gICAgdmFyIGNyZWF0ZUNvbnRleHRUb29sYmFyID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygnQ29udGV4dFRvb2xiYXInLCBjb250ZXh0VG9vbGJhclNjaGVtYSwgc3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBzdHJpbmdBcnJheSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICB2YXIgYWxsID0ge307XG4gICAgICBlYWNoKGEsIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgYWxsW2tleV0gPSB7fTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGtleXMoYWxsKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHBvcHVwcyA9IGVkaXRvci51aS5yZWdpc3RyeS5nZXRBbGwoKS5wb3B1cHM7XG4gICAgICB2YXIgZGF0YXNldCA9IG1hcCQyKHBvcHVwcywgZnVuY3Rpb24gKHBvcHVwKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVBdXRvY29tcGxldGVyKHBvcHVwKS5mb2xkKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0RXJyb3IoZXJyKSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgcmV0dXJuIHg7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgdHJpZ2dlckNoYXJzID0gc3RyaW5nQXJyYXkobWFwVG9BcnJheShkYXRhc2V0LCBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdi5jaDtcbiAgICAgIH0pKTtcbiAgICAgIHZhciBkYXRhc2V0VmFsdWVzID0gdmFsdWVzKGRhdGFzZXQpO1xuICAgICAgdmFyIGxvb2t1cEJ5Q2hhciA9IGZ1bmN0aW9uIChjaCkge1xuICAgICAgICByZXR1cm4gZmlsdGVyKGRhdGFzZXRWYWx1ZXMsIGZ1bmN0aW9uIChkdikge1xuICAgICAgICAgIHJldHVybiBkdi5jaCA9PT0gY2g7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGFzZXQ6IGRhdGFzZXQsXG4gICAgICAgIHRyaWdnZXJDaGFyczogdHJpZ2dlckNoYXJzLFxuICAgICAgICBsb29rdXBCeUNoYXI6IGxvb2t1cEJ5Q2hhclxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIEl0ZW1SZXNwb25zZTtcbiAgICAoZnVuY3Rpb24gKEl0ZW1SZXNwb25zZSkge1xuICAgICAgSXRlbVJlc3BvbnNlW0l0ZW1SZXNwb25zZVsnQ0xPU0VfT05fRVhFQ1VURSddID0gMF0gPSAnQ0xPU0VfT05fRVhFQ1VURSc7XG4gICAgICBJdGVtUmVzcG9uc2VbSXRlbVJlc3BvbnNlWydCVUJCTEVfVE9fU0FOREJPWCddID0gMV0gPSAnQlVCQkxFX1RPX1NBTkRCT1gnO1xuICAgIH0oSXRlbVJlc3BvbnNlIHx8IChJdGVtUmVzcG9uc2UgPSB7fSkpKTtcbiAgICB2YXIgSXRlbVJlc3BvbnNlJDEgPSBJdGVtUmVzcG9uc2U7XG5cbiAgICB2YXIgbmF2Q2xhc3MgPSAndG94LW1lbnUtbmF2X19qcyc7XG4gICAgdmFyIHNlbGVjdGFibGVDbGFzcyA9ICd0b3gtY29sbGVjdGlvbl9faXRlbSc7XG4gICAgdmFyIGNvbG9yQ2xhc3MgPSAndG94LXN3YXRjaCc7XG4gICAgdmFyIHByZXNldENsYXNzZXMgPSB7XG4gICAgICBub3JtYWw6IG5hdkNsYXNzLFxuICAgICAgY29sb3I6IGNvbG9yQ2xhc3NcbiAgICB9O1xuICAgIHZhciB0aWNrZWRDbGFzcyA9ICd0b3gtY29sbGVjdGlvbl9faXRlbS0tZW5hYmxlZCc7XG4gICAgdmFyIGdyb3VwSGVhZGluZ0NsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19ncm91cC1oZWFkaW5nJztcbiAgICB2YXIgaWNvbkNsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWljb24nO1xuICAgIHZhciB0ZXh0Q2xhc3MgPSAndG94LWNvbGxlY3Rpb25fX2l0ZW0tbGFiZWwnO1xuICAgIHZhciBhY2Nlc3NvcnlDbGFzcyA9ICd0b3gtY29sbGVjdGlvbl9faXRlbS1hY2Nlc3NvcnknO1xuICAgIHZhciBjYXJldENsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNhcmV0JztcbiAgICB2YXIgY2hlY2ttYXJrQ2xhc3MgPSAndG94LWNvbGxlY3Rpb25fX2l0ZW0tY2hlY2ttYXJrJztcbiAgICB2YXIgYWN0aXZlQ2xhc3MgPSAndG94LWNvbGxlY3Rpb25fX2l0ZW0tLWFjdGl2ZSc7XG4gICAgdmFyIGljb25DbGFzc1J0bCA9ICd0b3gtY29sbGVjdGlvbl9faXRlbS1pY29uLXJ0bCc7XG4gICAgdmFyIGNvbnRhaW5lckNsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lcic7XG4gICAgdmFyIGNvbnRhaW5lckNvbHVtbkNsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lci0tY29sdW1uJztcbiAgICB2YXIgY29udGFpbmVyUm93Q2xhc3MgPSAndG94LWNvbGxlY3Rpb25fX2l0ZW0tY29udGFpbmVyLS1yb3cnO1xuICAgIHZhciBjb250YWluZXJBbGlnblJpZ2h0Q2xhc3MgPSAndG94LWNvbGxlY3Rpb25fX2l0ZW0tY29udGFpbmVyLS1hbGlnbi1yaWdodCc7XG4gICAgdmFyIGNvbnRhaW5lckFsaWduTGVmdENsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lci0tYWxpZ24tbGVmdCc7XG4gICAgdmFyIGNvbnRhaW5lclZhbGlnblRvcENsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lci0tdmFsaWduLXRvcCc7XG4gICAgdmFyIGNvbnRhaW5lclZhbGlnbk1pZGRsZUNsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lci0tdmFsaWduLW1pZGRsZSc7XG4gICAgdmFyIGNvbnRhaW5lclZhbGlnbkJvdHRvbUNsYXNzID0gJ3RveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lci0tdmFsaWduLWJvdHRvbSc7XG4gICAgdmFyIGNsYXNzRm9yUHJlc2V0ID0gZnVuY3Rpb24gKHByZXNldHMpIHtcbiAgICAgIHJldHVybiBnZXQkMShwcmVzZXRDbGFzc2VzLCBwcmVzZXRzKS5nZXRPcihuYXZDbGFzcyk7XG4gICAgfTtcblxuICAgIHZhciBmb3JNZW51ID0gZnVuY3Rpb24gKHByZXNldHMpIHtcbiAgICAgIGlmIChwcmVzZXRzID09PSAnY29sb3InKSB7XG4gICAgICAgIHJldHVybiAndG94LXN3YXRjaGVzJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAndG94LW1lbnUnO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNsYXNzZXMgPSBmdW5jdGlvbiAocHJlc2V0cykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYmFja2dyb3VuZE1lbnU6ICd0b3gtYmFja2dyb3VuZC1tZW51JyxcbiAgICAgICAgc2VsZWN0ZWRNZW51OiAndG94LXNlbGVjdGVkLW1lbnUnLFxuICAgICAgICBzZWxlY3RlZEl0ZW06ICd0b3gtY29sbGVjdGlvbl9faXRlbS0tYWN0aXZlJyxcbiAgICAgICAgaGFzSWNvbnM6ICd0b3gtbWVudS0taGFzLWljb25zJyxcbiAgICAgICAgbWVudTogZm9yTWVudShwcmVzZXRzKSxcbiAgICAgICAgdGllcmVkTWVudTogJ3RveC10aWVyZWQtbWVudSdcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBtYXJrZXJzJDEgPSBmdW5jdGlvbiAocHJlc2V0cykge1xuICAgICAgdmFyIG1lbnVDbGFzc2VzID0gY2xhc3NlcyhwcmVzZXRzKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJhY2tncm91bmRNZW51OiBtZW51Q2xhc3Nlcy5iYWNrZ3JvdW5kTWVudSxcbiAgICAgICAgc2VsZWN0ZWRNZW51OiBtZW51Q2xhc3Nlcy5zZWxlY3RlZE1lbnUsXG4gICAgICAgIG1lbnU6IG1lbnVDbGFzc2VzLm1lbnUsXG4gICAgICAgIHNlbGVjdGVkSXRlbTogbWVudUNsYXNzZXMuc2VsZWN0ZWRJdGVtLFxuICAgICAgICBpdGVtOiBjbGFzc0ZvclByZXNldChwcmVzZXRzKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkb20kMSA9IGZ1bmN0aW9uIChoYXNJY29ucywgY29sdW1ucywgcHJlc2V0cykge1xuICAgICAgdmFyIG1lbnVDbGFzc2VzID0gY2xhc3NlcyhwcmVzZXRzKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgIGNsYXNzZXM6IGZsYXR0ZW4oW1xuICAgICAgICAgIFtcbiAgICAgICAgICAgIG1lbnVDbGFzc2VzLm1lbnUsXG4gICAgICAgICAgICAndG94LW1lbnUtJyArIGNvbHVtbnMgKyAnLWNvbHVtbidcbiAgICAgICAgICBdLFxuICAgICAgICAgIGhhc0ljb25zID8gW21lbnVDbGFzc2VzLmhhc0ljb25zXSA6IFtdXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNvbXBvbmVudHMkMSA9IFtNZW51LnBhcnRzLml0ZW1zKHt9KV07XG4gICAgdmFyIHBhcnQgPSBmdW5jdGlvbiAoaGFzSWNvbnMsIGNvbHVtbnMsIHByZXNldHMpIHtcbiAgICAgIHZhciBtZW51Q2xhc3NlcyA9IGNsYXNzZXMocHJlc2V0cyk7XG4gICAgICB2YXIgZCA9IHtcbiAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgY2xhc3NlczogZmxhdHRlbihbW21lbnVDbGFzc2VzLnRpZXJlZE1lbnVdXSlcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IGQsXG4gICAgICAgIG1hcmtlcnM6IG1hcmtlcnMkMShwcmVzZXRzKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGNodW5rJDEgPSBmdW5jdGlvbiAocm93RG9tLCBudW1Db2x1bW5zKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgIHZhciBjaHVua3MgPSBjaHVuayhpdGVtcywgbnVtQ29sdW1ucyk7XG4gICAgICAgIHJldHVybiBtYXAoY2h1bmtzLCBmdW5jdGlvbiAoYykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkb206IHJvd0RvbSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IGNcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZm9yU3dhdGNoID0gZnVuY3Rpb24gKGNvbHVtbnMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgJ3RveC1tZW51JyxcbiAgICAgICAgICAgICd0b3gtc3dhdGNoZXMtbWVudSdcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtc3dhdGNoZXMnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IFtNZW51LnBhcnRzLml0ZW1zKHtcbiAgICAgICAgICAgICAgICBwcmVwcm9jZXNzOiBjb2x1bW5zICE9PSAnYXV0bycgPyBjaHVuayQxKHtcbiAgICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1zd2F0Y2hlc19fcm93J11cbiAgICAgICAgICAgICAgICB9LCBjb2x1bW5zKSA6IGlkZW50aXR5XG4gICAgICAgICAgICAgIH0pXVxuICAgICAgICAgIH1dXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGZvclRvb2xiYXIgPSBmdW5jdGlvbiAoY29sdW1ucykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAndG94LW1lbnUnLFxuICAgICAgICAgICAgJ3RveC1jb2xsZWN0aW9uJyxcbiAgICAgICAgICAgICd0b3gtY29sbGVjdGlvbi0tdG9vbGJhcicsXG4gICAgICAgICAgICAndG94LWNvbGxlY3Rpb24tLXRvb2xiYXItbGcnXG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbTWVudS5wYXJ0cy5pdGVtcyh7XG4gICAgICAgICAgICBwcmVwcm9jZXNzOiBjaHVuayQxKHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtY29sbGVjdGlvbl9fZ3JvdXAnXVxuICAgICAgICAgICAgfSwgY29sdW1ucylcbiAgICAgICAgICB9KV1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcHJlcHJvY2Vzc0NvbGxlY3Rpb24gPSBmdW5jdGlvbiAoaXRlbXMsIGlzU2VwYXJhdG9yKSB7XG4gICAgICB2YXIgYWxsU3BsaXRzID0gW107XG4gICAgICB2YXIgY3VycmVudFNwbGl0ID0gW107XG4gICAgICBlYWNoKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwgaSkge1xuICAgICAgICBpZiAoaXNTZXBhcmF0b3IoaXRlbSwgaSkpIHtcbiAgICAgICAgICBpZiAoY3VycmVudFNwbGl0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGFsbFNwbGl0cy5wdXNoKGN1cnJlbnRTcGxpdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnJlbnRTcGxpdCA9IFtdO1xuICAgICAgICAgIGlmIChoYXMoaXRlbS5kb20sICdpbm5lckh0bWwnKSkge1xuICAgICAgICAgICAgY3VycmVudFNwbGl0LnB1c2goaXRlbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN1cnJlbnRTcGxpdC5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChjdXJyZW50U3BsaXQubGVuZ3RoID4gMCkge1xuICAgICAgICBhbGxTcGxpdHMucHVzaChjdXJyZW50U3BsaXQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1hcChhbGxTcGxpdHMsIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtY29sbGVjdGlvbl9fZ3JvdXAnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcG9uZW50czogc1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZm9yQ29sbGVjdGlvbiA9IGZ1bmN0aW9uIChjb2x1bW5zLCBpbml0SXRlbXMsIF9oYXNJY29ucykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAndG94LW1lbnUnLFxuICAgICAgICAgICAgJ3RveC1jb2xsZWN0aW9uJ1xuICAgICAgICAgIF0uY29uY2F0KGNvbHVtbnMgPT09IDEgPyBbJ3RveC1jb2xsZWN0aW9uLS1saXN0J10gOiBbJ3RveC1jb2xsZWN0aW9uLS1ncmlkJ10pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtNZW51LnBhcnRzLml0ZW1zKHtcbiAgICAgICAgICAgIHByZXByb2Nlc3M6IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgICBpZiAoY29sdW1ucyAhPT0gJ2F1dG8nICYmIGNvbHVtbnMgPiAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNodW5rJDEoe1xuICAgICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWNvbGxlY3Rpb25fX2dyb3VwJ11cbiAgICAgICAgICAgICAgICB9LCBjb2x1bW5zKShpdGVtcyk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZXByb2Nlc3NDb2xsZWN0aW9uKGl0ZW1zLCBmdW5jdGlvbiAoX2l0ZW0sIGkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0SXRlbXNbaV0udHlwZSA9PT0gJ3NlcGFyYXRvcic7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KV1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZm9ySG9yaXpvbnRhbENvbGxlY3Rpb24gPSBmdW5jdGlvbiAoaW5pdEl0ZW1zLCBfaGFzSWNvbnMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgJ3RveC1jb2xsZWN0aW9uJyxcbiAgICAgICAgICAgICd0b3gtY29sbGVjdGlvbi0taG9yaXpvbnRhbCdcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtNZW51LnBhcnRzLml0ZW1zKHtcbiAgICAgICAgICAgIHByZXByb2Nlc3M6IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgICByZXR1cm4gcHJlcHJvY2Vzc0NvbGxlY3Rpb24oaXRlbXMsIGZ1bmN0aW9uIChfaXRlbSwgaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbml0SXRlbXNbaV0udHlwZSA9PT0gJ3NlcGFyYXRvcic7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIG1lbnVIYXNJY29ucyA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgcmV0dXJuIGV4aXN0cyh4cywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuICdpY29uJyBpbiBpdGVtICYmIGl0ZW0uaWNvbiAhPT0gdW5kZWZpbmVkO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZm9ybWF0RXJyb3IoZXJyb3IpKTtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlSG9yaXpvbnRhbFBhcnRpYWxNZW51V2l0aEFsbG95SXRlbXMgPSBmdW5jdGlvbiAodmFsdWUsIF9oYXNJY29ucywgaXRlbXMsIF9jb2x1bW5zLCBfcHJlc2V0cykge1xuICAgICAgdmFyIHN0cnVjdHVyZSA9IGZvckhvcml6b250YWxDb2xsZWN0aW9uKGl0ZW1zKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgZG9tOiBzdHJ1Y3R1cmUuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBzdHJ1Y3R1cmUuY29tcG9uZW50cyxcbiAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVBhcnRpYWxNZW51V2l0aEFsbG95SXRlbXMgPSBmdW5jdGlvbiAodmFsdWUsIGhhc0ljb25zLCBpdGVtcywgY29sdW1ucywgcHJlc2V0cykge1xuICAgICAgaWYgKHByZXNldHMgPT09ICdjb2xvcicpIHtcbiAgICAgICAgdmFyIHN0cnVjdHVyZSA9IGZvclN3YXRjaChjb2x1bW5zKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgZG9tOiBzdHJ1Y3R1cmUuZG9tLFxuICAgICAgICAgIGNvbXBvbmVudHM6IHN0cnVjdHVyZS5jb21wb25lbnRzLFxuICAgICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHByZXNldHMgPT09ICdub3JtYWwnICYmIGNvbHVtbnMgPT09ICdhdXRvJykge1xuICAgICAgICB2YXIgc3RydWN0dXJlID0gZm9yQ29sbGVjdGlvbihjb2x1bW5zLCBpdGVtcyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIGRvbTogc3RydWN0dXJlLmRvbSxcbiAgICAgICAgICBjb21wb25lbnRzOiBzdHJ1Y3R1cmUuY29tcG9uZW50cyxcbiAgICAgICAgICBpdGVtczogaXRlbXNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmIChwcmVzZXRzID09PSAnbm9ybWFsJyAmJiBjb2x1bW5zID09PSAxKSB7XG4gICAgICAgIHZhciBzdHJ1Y3R1cmUgPSBmb3JDb2xsZWN0aW9uKDEsIGl0ZW1zKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgZG9tOiBzdHJ1Y3R1cmUuZG9tLFxuICAgICAgICAgIGNvbXBvbmVudHM6IHN0cnVjdHVyZS5jb21wb25lbnRzLFxuICAgICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHByZXNldHMgPT09ICdub3JtYWwnKSB7XG4gICAgICAgIHZhciBzdHJ1Y3R1cmUgPSBmb3JDb2xsZWN0aW9uKGNvbHVtbnMsIGl0ZW1zKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgZG9tOiBzdHJ1Y3R1cmUuZG9tLFxuICAgICAgICAgIGNvbXBvbmVudHM6IHN0cnVjdHVyZS5jb21wb25lbnRzLFxuICAgICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHByZXNldHMgPT09ICdsaXN0cHJldmlldycgJiYgY29sdW1ucyAhPT0gJ2F1dG8nKSB7XG4gICAgICAgIHZhciBzdHJ1Y3R1cmUgPSBmb3JUb29sYmFyKGNvbHVtbnMpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICBkb206IHN0cnVjdHVyZS5kb20sXG4gICAgICAgICAgY29tcG9uZW50czogc3RydWN0dXJlLmNvbXBvbmVudHMsXG4gICAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgIGRvbTogZG9tJDEoaGFzSWNvbnMsIGNvbHVtbnMsIHByZXNldHMpLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzJDEsXG4gICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGNhcmRJbWFnZUZpZWxkcyA9IFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgc3RyaWN0U3RyaW5nKCdzcmMnKSxcbiAgICAgIG9wdGlvblN0cmluZygnYWx0JyksXG4gICAgICBkZWZhdWx0ZWRBcnJheU9mKCdjbGFzc2VzJywgW10sIHN0cmluZylcbiAgICBdO1xuICAgIHZhciBjYXJkSW1hZ2VTY2hlbWEgPSBvYmpPZihjYXJkSW1hZ2VGaWVsZHMpO1xuXG4gICAgdmFyIGNhcmRUZXh0RmllbGRzID0gW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0eXBlJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ3RleHQnKSxcbiAgICAgIG9wdGlvblN0cmluZygnbmFtZScpLFxuICAgICAgZGVmYXVsdGVkQXJyYXlPZignY2xhc3NlcycsIFsndG94LWNvbGxlY3Rpb25fX2l0ZW0tbGFiZWwnXSwgc3RyaW5nKVxuICAgIF07XG4gICAgdmFyIGNhcmRUZXh0U2NoZW1hID0gb2JqT2YoY2FyZFRleHRGaWVsZHMpO1xuXG4gICAgdmFyIGl0ZW1TY2hlbWEkMiA9IHZhbHVlVGh1bmtPZihmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gY2hvb3NlUHJvY2Vzc29yKCd0eXBlJywge1xuICAgICAgICBjYXJkaW1hZ2U6IGNhcmRJbWFnZVNjaGVtYSxcbiAgICAgICAgY2FyZHRleHQ6IGNhcmRUZXh0U2NoZW1hLFxuICAgICAgICBjYXJkY29udGFpbmVyOiBjYXJkQ29udGFpbmVyU2NoZW1hXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICB2YXIgY2FyZENvbnRhaW5lclNjaGVtYSA9IG9iak9mKFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgZGVmYXVsdGVkU3RyaW5nKCdkaXJlY3Rpb24nLCAnaG9yaXpvbnRhbCcpLFxuICAgICAgZGVmYXVsdGVkU3RyaW5nKCdhbGlnbicsICdsZWZ0JyksXG4gICAgICBkZWZhdWx0ZWRTdHJpbmcoJ3ZhbGlnbicsICdtaWRkbGUnKSxcbiAgICAgIHN0cmljdEFycmF5T2YoJ2l0ZW1zJywgaXRlbVNjaGVtYSQyKVxuICAgIF0pO1xuXG4gICAgdmFyIGNvbW1vbk1lbnVJdGVtRmllbGRzID0gW1xuICAgICAgZGVmYXVsdGVkQm9vbGVhbignZGlzYWJsZWQnLCBmYWxzZSksXG4gICAgICBvcHRpb25TdHJpbmcoJ3RleHQnKSxcbiAgICAgIG9wdGlvblN0cmluZygnc2hvcnRjdXQnKSxcbiAgICAgIGZpZWxkKCd2YWx1ZScsICd2YWx1ZScsIGRlZmF1bHRlZFRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdlbmVyYXRlJDEoJ21lbnVpdGVtLXZhbHVlJyk7XG4gICAgICB9KSwgYW55VmFsdWUkMSgpKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdtZXRhJywge30pXG4gICAgXTtcblxuICAgIHZhciBjYXJkTWVudUl0ZW1TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIG9wdGlvblN0cmluZygnbGFiZWwnKSxcbiAgICAgIHN0cmljdEFycmF5T2YoJ2l0ZW1zJywgaXRlbVNjaGVtYSQyKSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdvblNldHVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbm9vcDtcbiAgICAgIH0pLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uQWN0aW9uJywgbm9vcClcbiAgICBdLmNvbmNhdChjb21tb25NZW51SXRlbUZpZWxkcykpO1xuICAgIHZhciBjcmVhdGVDYXJkTWVudUl0ZW0gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGFzUmF3KCdjYXJkbWVudWl0ZW0nLCBjYXJkTWVudUl0ZW1TY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgY2hvaWNlTWVudUl0ZW1TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIGRlZmF1bHRlZEJvb2xlYW4oJ2FjdGl2ZScsIGZhbHNlKSxcbiAgICAgIG9wdGlvblN0cmluZygnaWNvbicpXG4gICAgXS5jb25jYXQoY29tbW9uTWVudUl0ZW1GaWVsZHMpKTtcbiAgICB2YXIgY3JlYXRlQ2hvaWNlTWVudUl0ZW0gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGFzUmF3KCdjaG9pY2VtZW51aXRlbScsIGNob2ljZU1lbnVJdGVtU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuXG4gICAgdmFyIGZhbmN5VHlwZXMgPSBbXG4gICAgICAnaW5zZXJ0dGFibGUnLFxuICAgICAgJ2NvbG9yc3dhdGNoJ1xuICAgIF07XG4gICAgdmFyIGZhbmN5TWVudUl0ZW1TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIHN0cmljdFN0cmluZ0VudW0oJ2ZhbmN5dHlwZScsIGZhbmN5VHlwZXMpLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uQWN0aW9uJywgbm9vcClcbiAgICBdKTtcbiAgICB2YXIgY3JlYXRlRmFuY3lNZW51SXRlbSA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ2ZhbmN5bWVudWl0ZW0nLCBmYW5jeU1lbnVJdGVtU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuXG4gICAgdmFyIG1lbnVJdGVtU2NoZW1hID0gb2JqT2YoW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0eXBlJyksXG4gICAgICBkZWZhdWx0ZWRGdW5jdGlvbignb25TZXR1cCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5vb3A7XG4gICAgICB9KSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdvbkFjdGlvbicsIG5vb3ApLFxuICAgICAgb3B0aW9uU3RyaW5nKCdpY29uJylcbiAgICBdLmNvbmNhdChjb21tb25NZW51SXRlbUZpZWxkcykpO1xuICAgIHZhciBjcmVhdGVNZW51SXRlbSA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ21lbnVpdGVtJywgbWVudUl0ZW1TY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgbmVzdGVkTWVudUl0ZW1TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdnZXRTdWJtZW51SXRlbXMnKSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdvblNldHVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbm9vcDtcbiAgICAgIH0pLFxuICAgICAgb3B0aW9uU3RyaW5nKCdpY29uJylcbiAgICBdLmNvbmNhdChjb21tb25NZW51SXRlbUZpZWxkcykpO1xuICAgIHZhciBjcmVhdGVOZXN0ZWRNZW51SXRlbSA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ25lc3RlZG1lbnVpdGVtJywgbmVzdGVkTWVudUl0ZW1TY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgdG9nZ2xlTWVudUl0ZW1TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIG9wdGlvblN0cmluZygnaWNvbicpLFxuICAgICAgZGVmYXVsdGVkQm9vbGVhbignYWN0aXZlJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uU2V0dXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBub29wO1xuICAgICAgfSksXG4gICAgICBzdHJpY3RGdW5jdGlvbignb25BY3Rpb24nKVxuICAgIF0uY29uY2F0KGNvbW1vbk1lbnVJdGVtRmllbGRzKSk7XG4gICAgdmFyIGNyZWF0ZVRvZ2dsZU1lbnVJdGVtID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygndG9nZ2xlbWVudWl0ZW0nLCB0b2dnbGVNZW51SXRlbVNjaGVtYSwgc3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBkZXRlY3RTaXplID0gZnVuY3Rpb24gKGNvbXAsIG1hcmdpbiwgc2VsZWN0b3JDbGFzcykge1xuICAgICAgdmFyIGRlc2NlbmRhbnRzJDEgPSBkZXNjZW5kYW50cyhjb21wLmVsZW1lbnQsICcuJyArIHNlbGVjdG9yQ2xhc3MpO1xuICAgICAgaWYgKGRlc2NlbmRhbnRzJDEubGVuZ3RoID4gMCkge1xuICAgICAgICB2YXIgY29sdW1uTGVuZ3RoID0gZmluZEluZGV4KGRlc2NlbmRhbnRzJDEsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgdmFyIHRoaXNUb3AgPSBjLmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgICAgICAgdmFyIGNUb3AgPSBkZXNjZW5kYW50cyQxWzBdLmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgICAgICAgcmV0dXJuIE1hdGguYWJzKHRoaXNUb3AgLSBjVG9wKSA+IG1hcmdpbjtcbiAgICAgICAgfSkuZ2V0T3IoZGVzY2VuZGFudHMkMS5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgbnVtQ29sdW1uczogY29sdW1uTGVuZ3RoLFxuICAgICAgICAgIG51bVJvd3M6IE1hdGguY2VpbChkZXNjZW5kYW50cyQxLmxlbmd0aCAvIGNvbHVtbkxlbmd0aClcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgbmFtZWRFdmVudHMgPSBmdW5jdGlvbiAobmFtZSwgaGFuZGxlcnMpIHtcbiAgICAgIHJldHVybiBkZXJpdmUkMShbY29uZmlnKG5hbWUsIGhhbmRsZXJzKV0pO1xuICAgIH07XG4gICAgdmFyIHVubmFtZWRFdmVudHMgPSBmdW5jdGlvbiAoaGFuZGxlcnMpIHtcbiAgICAgIHJldHVybiBuYW1lZEV2ZW50cyhnZW5lcmF0ZSQxKCd1bm5hbWVkLWV2ZW50cycpLCBoYW5kbGVycyk7XG4gICAgfTtcbiAgICB2YXIgU2ltcGxlQmVoYXZpb3VycyA9IHtcbiAgICAgIG5hbWVkRXZlbnRzOiBuYW1lZEV2ZW50cyxcbiAgICAgIHVubmFtZWRFdmVudHM6IHVubmFtZWRFdmVudHNcbiAgICB9O1xuXG4gICAgdmFyIEV4Y2x1c2l2aXR5Q2hhbm5lbCA9IGdlbmVyYXRlJDEoJ3Rvb2x0aXAuZXhjbHVzaXZlJyk7XG4gICAgdmFyIFNob3dUb29sdGlwRXZlbnQgPSBnZW5lcmF0ZSQxKCd0b29sdGlwLnNob3cnKTtcbiAgICB2YXIgSGlkZVRvb2x0aXBFdmVudCA9IGdlbmVyYXRlJDEoJ3Rvb2x0aXAuaGlkZScpO1xuXG4gICAgdmFyIGhpZGVBbGxFeGNsdXNpdmUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBfdENvbmZpZywgX3RTdGF0ZSkge1xuICAgICAgY29tcG9uZW50LmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFtFeGNsdXNpdml0eUNoYW5uZWxdLCB7fSk7XG4gICAgfTtcbiAgICB2YXIgc2V0Q29tcG9uZW50cyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHRDb25maWcsIHRTdGF0ZSwgc3BlY3MpIHtcbiAgICAgIHRTdGF0ZS5nZXRUb29sdGlwKCkuZWFjaChmdW5jdGlvbiAodG9vbHRpcCkge1xuICAgICAgICBpZiAodG9vbHRpcC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgUmVwbGFjaW5nLnNldCh0b29sdGlwLCBzcGVjcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgVG9vbHRpcHBpbmdBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGhpZGVBbGxFeGNsdXNpdmU6IGhpZGVBbGxFeGNsdXNpdmUsXG4gICAgICAgIHNldENvbXBvbmVudHM6IHNldENvbXBvbmVudHNcbiAgICB9KTtcblxuICAgIHZhciBldmVudHMkOCA9IGZ1bmN0aW9uICh0b29sdGlwQ29uZmlnLCBzdGF0ZSkge1xuICAgICAgdmFyIGhpZGUgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICBzdGF0ZS5nZXRUb29sdGlwKCkuZWFjaChmdW5jdGlvbiAocCkge1xuICAgICAgICAgIGRldGFjaChwKTtcbiAgICAgICAgICB0b29sdGlwQ29uZmlnLm9uSGlkZShjb21wLCBwKTtcbiAgICAgICAgICBzdGF0ZS5jbGVhclRvb2x0aXAoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHN0YXRlLmNsZWFyVGltZXIoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2hvdyA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIGlmICghc3RhdGUuaXNTaG93aW5nKCkpIHtcbiAgICAgICAgICBoaWRlQWxsRXhjbHVzaXZlKGNvbXApO1xuICAgICAgICAgIHZhciBzaW5rID0gdG9vbHRpcENvbmZpZy5sYXp5U2luayhjb21wKS5nZXRPckRpZSgpO1xuICAgICAgICAgIHZhciBwb3B1cCA9IGNvbXAuZ2V0U3lzdGVtKCkuYnVpbGQoe1xuICAgICAgICAgICAgZG9tOiB0b29sdGlwQ29uZmlnLnRvb2x0aXBEb20sXG4gICAgICAgICAgICBjb21wb25lbnRzOiB0b29sdGlwQ29uZmlnLnRvb2x0aXBDb21wb25lbnRzLFxuICAgICAgICAgICAgZXZlbnRzOiBkZXJpdmUodG9vbHRpcENvbmZpZy5tb2RlID09PSAnbm9ybWFsJyA/IFtcbiAgICAgICAgICAgICAgcnVuKG1vdXNlb3ZlcigpLCBmdW5jdGlvbiAoXykge1xuICAgICAgICAgICAgICAgIGVtaXQoY29tcCwgU2hvd1Rvb2x0aXBFdmVudCk7XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBydW4obW91c2VvdXQoKSwgZnVuY3Rpb24gKF8pIHtcbiAgICAgICAgICAgICAgICBlbWl0KGNvbXAsIEhpZGVUb29sdGlwRXZlbnQpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSA6IFtdKSxcbiAgICAgICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtSZXBsYWNpbmcuY29uZmlnKHt9KV0pXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc3RhdGUuc2V0VG9vbHRpcChwb3B1cCk7XG4gICAgICAgICAgYXR0YWNoJDEoc2luaywgcG9wdXApO1xuICAgICAgICAgIHRvb2x0aXBDb25maWcub25TaG93KGNvbXAsIHBvcHVwKTtcbiAgICAgICAgICBQb3NpdGlvbmluZy5wb3NpdGlvbihzaW5rLCB0b29sdGlwQ29uZmlnLmFuY2hvcihjb21wKSwgcG9wdXApO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGRlcml2ZShmbGF0dGVuKFtcbiAgICAgICAgW1xuICAgICAgICAgIHJ1bihTaG93VG9vbHRpcEV2ZW50LCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgc3RhdGUucmVzZXRUaW1lcihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHNob3coY29tcCk7XG4gICAgICAgICAgICB9LCB0b29sdGlwQ29uZmlnLmRlbGF5KTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBydW4oSGlkZVRvb2x0aXBFdmVudCwgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHN0YXRlLnJlc2V0VGltZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBoaWRlKGNvbXApO1xuICAgICAgICAgICAgfSwgdG9vbHRpcENvbmZpZy5kZWxheSk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcnVuKHJlY2VpdmUoKSwgZnVuY3Rpb24gKGNvbXAsIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhciByZWNlaXZpbmdEYXRhID0gbWVzc2FnZTtcbiAgICAgICAgICAgIGlmICghcmVjZWl2aW5nRGF0YS51bml2ZXJzYWwpIHtcbiAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zKHJlY2VpdmluZ0RhdGEuY2hhbm5lbHMsIEV4Y2x1c2l2aXR5Q2hhbm5lbCkpIHtcbiAgICAgICAgICAgICAgICBoaWRlKGNvbXApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcnVuT25EZXRhY2hlZChmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgaGlkZShjb21wKTtcbiAgICAgICAgICB9KVxuICAgICAgICBdLFxuICAgICAgICB0b29sdGlwQ29uZmlnLm1vZGUgPT09ICdub3JtYWwnID8gW1xuICAgICAgICAgIHJ1bihmb2N1c2luKCksIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICBlbWl0KGNvbXAsIFNob3dUb29sdGlwRXZlbnQpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bihwb3N0Qmx1cigpLCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgZW1pdChjb21wLCBIaWRlVG9vbHRpcEV2ZW50KTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBydW4obW91c2VvdmVyKCksIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICBlbWl0KGNvbXAsIFNob3dUb29sdGlwRXZlbnQpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bihtb3VzZW91dCgpLCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgZW1pdChjb21wLCBIaWRlVG9vbHRpcEV2ZW50KTtcbiAgICAgICAgICB9KVxuICAgICAgICBdIDogW1xuICAgICAgICAgIHJ1bihoaWdobGlnaHQoKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgZW1pdChjb21wLCBTaG93VG9vbHRpcEV2ZW50KTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBydW4oZGVoaWdobGlnaHQoKSwgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIGVtaXQoY29tcCwgSGlkZVRvb2x0aXBFdmVudCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgXVxuICAgICAgXSkpO1xuICAgIH07XG5cbiAgICB2YXIgQWN0aXZlVG9vbHRpcHBpbmcgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkOFxuICAgIH0pO1xuXG4gICAgdmFyIFRvb2x0aXBwaW5nU2NoZW1hID0gW1xuICAgICAgc3RyaWN0JDEoJ2xhenlTaW5rJyksXG4gICAgICBzdHJpY3QkMSgndG9vbHRpcERvbScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2V4Y2x1c2l2ZScsIHRydWUpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3Rvb2x0aXBDb21wb25lbnRzJywgW10pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2RlbGF5JywgMzAwKSxcbiAgICAgIGRlZmF1bHRlZFN0cmluZ0VudW0oJ21vZGUnLCAnbm9ybWFsJywgW1xuICAgICAgICAnbm9ybWFsJyxcbiAgICAgICAgJ2ZvbGxvdy1oaWdobGlnaHQnXG4gICAgICBdKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdhbmNob3InLCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFuY2hvcjogJ2hvdHNwb3QnLFxuICAgICAgICAgIGhvdHNwb3Q6IGNvbXAsXG4gICAgICAgICAgbGF5b3V0czoge1xuICAgICAgICAgICAgb25MdHI6IGNvbnN0YW50KFtcbiAgICAgICAgICAgICAgc291dGgkMSxcbiAgICAgICAgICAgICAgbm9ydGgkMSxcbiAgICAgICAgICAgICAgc291dGhlYXN0JDEsXG4gICAgICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgICAgICBzb3V0aHdlc3QkMSxcbiAgICAgICAgICAgICAgbm9ydGh3ZXN0JDFcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgb25SdGw6IGNvbnN0YW50KFtcbiAgICAgICAgICAgICAgc291dGgkMSxcbiAgICAgICAgICAgICAgbm9ydGgkMSxcbiAgICAgICAgICAgICAgc291dGhlYXN0JDEsXG4gICAgICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgICAgICBzb3V0aHdlc3QkMSxcbiAgICAgICAgICAgICAgbm9ydGh3ZXN0JDFcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSksXG4gICAgICBvbkhhbmRsZXIoJ29uSGlkZScpLFxuICAgICAgb25IYW5kbGVyKCdvblNob3cnKVxuICAgIF07XG5cbiAgICB2YXIgaW5pdCQ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHRpbWVyID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIHBvcHVwID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIGdldFRvb2x0aXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwb3B1cC5nZXQoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0VG9vbHRpcCA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIHBvcHVwLnNldChPcHRpb25hbC5zb21lKGNvbXApKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xlYXJUb29sdGlwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBwb3B1cC5zZXQoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xlYXJUaW1lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGltZXIuZ2V0KCkuZWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlc2V0VGltZXIgPSBmdW5jdGlvbiAoZiwgZGVsYXkpIHtcbiAgICAgICAgY2xlYXJUaW1lcigpO1xuICAgICAgICB0aW1lci5zZXQoT3B0aW9uYWwuc29tZShzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmKCk7XG4gICAgICAgIH0sIGRlbGF5KSkpO1xuICAgICAgfTtcbiAgICAgIHZhciBpc1Nob3dpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwb3B1cC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVhZFN0YXRlID0gY29uc3RhbnQoJ25vdC1pbXBsZW1lbnRlZCcpO1xuICAgICAgcmV0dXJuIG51JDUoe1xuICAgICAgICBnZXRUb29sdGlwOiBnZXRUb29sdGlwLFxuICAgICAgICBpc1Nob3dpbmc6IGlzU2hvd2luZyxcbiAgICAgICAgc2V0VG9vbHRpcDogc2V0VG9vbHRpcCxcbiAgICAgICAgY2xlYXJUb29sdGlwOiBjbGVhclRvb2x0aXAsXG4gICAgICAgIGNsZWFyVGltZXI6IGNsZWFyVGltZXIsXG4gICAgICAgIHJlc2V0VGltZXI6IHJlc2V0VGltZXIsXG4gICAgICAgIHJlYWRTdGF0ZTogcmVhZFN0YXRlXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIFRvb2x0aXBwaW5nU3RhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgaW5pdDogaW5pdCQ0XG4gICAgfSk7XG5cbiAgICB2YXIgVG9vbHRpcHBpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IFRvb2x0aXBwaW5nU2NoZW1hLFxuICAgICAgbmFtZTogJ3Rvb2x0aXBwaW5nJyxcbiAgICAgIGFjdGl2ZTogQWN0aXZlVG9vbHRpcHBpbmcsXG4gICAgICBzdGF0ZTogVG9vbHRpcHBpbmdTdGF0ZSxcbiAgICAgIGFwaXM6IFRvb2x0aXBwaW5nQXBpc1xuICAgIH0pO1xuXG4gICAgdmFyIGVzY2FwZSA9IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDUgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5kb20uRE9NVXRpbHMnKTtcblxuICAgIHZhciBnbG9iYWwkNiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuSTE4bicpO1xuXG4gICAgdmFyIG5hdGl2ZURpc2FibGVkID0gW1xuICAgICAgJ2lucHV0JyxcbiAgICAgICdidXR0b24nLFxuICAgICAgJ3RleHRhcmVhJyxcbiAgICAgICdzZWxlY3QnXG4gICAgXTtcbiAgICB2YXIgb25Mb2FkJDUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkaXNhYmxlQ29uZmlnLCBkaXNhYmxlU3RhdGUpIHtcbiAgICAgIHZhciBmID0gZGlzYWJsZUNvbmZpZy5kaXNhYmxlZCgpID8gZGlzYWJsZSA6IGVuYWJsZTtcbiAgICAgIGYoY29tcG9uZW50LCBkaXNhYmxlQ29uZmlnKTtcbiAgICB9O1xuICAgIHZhciBoYXNOYXRpdmUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb25maWcpIHtcbiAgICAgIHJldHVybiBjb25maWcudXNlTmF0aXZlID09PSB0cnVlICYmIGNvbnRhaW5zKG5hdGl2ZURpc2FibGVkLCBuYW1lKGNvbXBvbmVudC5lbGVtZW50KSk7XG4gICAgfTtcbiAgICB2YXIgbmF0aXZlSXNEaXNhYmxlZCA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHJldHVybiBoYXMkMShjb21wb25lbnQuZWxlbWVudCwgJ2Rpc2FibGVkJyk7XG4gICAgfTtcbiAgICB2YXIgbmF0aXZlRGlzYWJsZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICB9O1xuICAgIHZhciBuYXRpdmVFbmFibGUgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICByZW1vdmUkMShjb21wb25lbnQuZWxlbWVudCwgJ2Rpc2FibGVkJyk7XG4gICAgfTtcbiAgICB2YXIgYXJpYUlzRGlzYWJsZWQgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICByZXR1cm4gZ2V0JDMoY29tcG9uZW50LmVsZW1lbnQsICdhcmlhLWRpc2FibGVkJykgPT09ICd0cnVlJztcbiAgICB9O1xuICAgIHZhciBhcmlhRGlzYWJsZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnYXJpYS1kaXNhYmxlZCcsICd0cnVlJyk7XG4gICAgfTtcbiAgICB2YXIgYXJpYUVuYWJsZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnYXJpYS1kaXNhYmxlZCcsICdmYWxzZScpO1xuICAgIH07XG4gICAgdmFyIGRpc2FibGUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkaXNhYmxlQ29uZmlnLCBfZGlzYWJsZVN0YXRlKSB7XG4gICAgICBkaXNhYmxlQ29uZmlnLmRpc2FibGVDbGFzcy5lYWNoKGZ1bmN0aW9uIChkaXNhYmxlQ2xhc3MpIHtcbiAgICAgICAgYWRkJDIoY29tcG9uZW50LmVsZW1lbnQsIGRpc2FibGVDbGFzcyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBmID0gaGFzTmF0aXZlKGNvbXBvbmVudCwgZGlzYWJsZUNvbmZpZykgPyBuYXRpdmVEaXNhYmxlIDogYXJpYURpc2FibGU7XG4gICAgICBmKGNvbXBvbmVudCk7XG4gICAgICBkaXNhYmxlQ29uZmlnLm9uRGlzYWJsZWQoY29tcG9uZW50KTtcbiAgICB9O1xuICAgIHZhciBlbmFibGUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkaXNhYmxlQ29uZmlnLCBfZGlzYWJsZVN0YXRlKSB7XG4gICAgICBkaXNhYmxlQ29uZmlnLmRpc2FibGVDbGFzcy5lYWNoKGZ1bmN0aW9uIChkaXNhYmxlQ2xhc3MpIHtcbiAgICAgICAgcmVtb3ZlJDQoY29tcG9uZW50LmVsZW1lbnQsIGRpc2FibGVDbGFzcyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBmID0gaGFzTmF0aXZlKGNvbXBvbmVudCwgZGlzYWJsZUNvbmZpZykgPyBuYXRpdmVFbmFibGUgOiBhcmlhRW5hYmxlO1xuICAgICAgZihjb21wb25lbnQpO1xuICAgICAgZGlzYWJsZUNvbmZpZy5vbkVuYWJsZWQoY29tcG9uZW50KTtcbiAgICB9O1xuICAgIHZhciBpc0Rpc2FibGVkID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZGlzYWJsZUNvbmZpZykge1xuICAgICAgcmV0dXJuIGhhc05hdGl2ZShjb21wb25lbnQsIGRpc2FibGVDb25maWcpID8gbmF0aXZlSXNEaXNhYmxlZChjb21wb25lbnQpIDogYXJpYUlzRGlzYWJsZWQoY29tcG9uZW50KTtcbiAgICB9O1xuICAgIHZhciBzZXQkNyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGRpc2FibGVDb25maWcsIGRpc2FibGVTdGF0ZSwgZGlzYWJsZWQpIHtcbiAgICAgIHZhciBmID0gZGlzYWJsZWQgPyBkaXNhYmxlIDogZW5hYmxlO1xuICAgICAgZihjb21wb25lbnQsIGRpc2FibGVDb25maWcpO1xuICAgIH07XG5cbiAgICB2YXIgRGlzYWJsZUFwaXMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZW5hYmxlOiBlbmFibGUsXG4gICAgICAgIGRpc2FibGU6IGRpc2FibGUsXG4gICAgICAgIGlzRGlzYWJsZWQ6IGlzRGlzYWJsZWQsXG4gICAgICAgIG9uTG9hZDogb25Mb2FkJDUsXG4gICAgICAgIHNldDogc2V0JDdcbiAgICB9KTtcblxuICAgIHZhciBleGhpYml0JDMgPSBmdW5jdGlvbiAoYmFzZSwgZGlzYWJsZUNvbmZpZykge1xuICAgICAgcmV0dXJuIG51JDYoeyBjbGFzc2VzOiBkaXNhYmxlQ29uZmlnLmRpc2FibGVkKCkgPyBkaXNhYmxlQ29uZmlnLmRpc2FibGVDbGFzcy50b0FycmF5KCkgOiBbXSB9KTtcbiAgICB9O1xuICAgIHZhciBldmVudHMkOSA9IGZ1bmN0aW9uIChkaXNhYmxlQ29uZmlnLCBkaXNhYmxlU3RhdGUpIHtcbiAgICAgIHJldHVybiBkZXJpdmUoW1xuICAgICAgICBhYm9ydChleGVjdXRlKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIF9zaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHJldHVybiBpc0Rpc2FibGVkKGNvbXBvbmVudCwgZGlzYWJsZUNvbmZpZyk7XG4gICAgICAgIH0pLFxuICAgICAgICBsb2FkRXZlbnQoZGlzYWJsZUNvbmZpZywgZGlzYWJsZVN0YXRlLCBvbkxvYWQkNSlcbiAgICAgIF0pO1xuICAgIH07XG5cbiAgICB2YXIgQWN0aXZlRGlzYWJsZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBleGhpYml0OiBleGhpYml0JDMsXG4gICAgICAgIGV2ZW50czogZXZlbnRzJDlcbiAgICB9KTtcblxuICAgIHZhciBEaXNhYmxlU2NoZW1hID0gW1xuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ2Rpc2FibGVkJywgbmV2ZXIpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VzZU5hdGl2ZScsIHRydWUpLFxuICAgICAgb3B0aW9uKCdkaXNhYmxlQ2xhc3MnKSxcbiAgICAgIG9uSGFuZGxlcignb25EaXNhYmxlZCcpLFxuICAgICAgb25IYW5kbGVyKCdvbkVuYWJsZWQnKVxuICAgIF07XG5cbiAgICB2YXIgRGlzYWJsaW5nID0gY3JlYXRlJDEoe1xuICAgICAgZmllbGRzOiBEaXNhYmxlU2NoZW1hLFxuICAgICAgbmFtZTogJ2Rpc2FibGluZycsXG4gICAgICBhY3RpdmU6IEFjdGl2ZURpc2FibGUsXG4gICAgICBhcGlzOiBEaXNhYmxlQXBpc1xuICAgIH0pO1xuXG4gICAgdmFyIGdsb2JhbCQ3ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuRWRpdG9yTWFuYWdlcicpO1xuXG4gICAgdmFyIGdldFNraW5VcmwgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgc2tpbiA9IGVkaXRvci5nZXRQYXJhbSgnc2tpbicpO1xuICAgICAgdmFyIHNraW5VcmwgPSBlZGl0b3IuZ2V0UGFyYW0oJ3NraW5fdXJsJyk7XG4gICAgICBpZiAoc2tpbiAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIHNraW5OYW1lID0gc2tpbiA/IHNraW4gOiAnb3hpZGUnO1xuICAgICAgICBpZiAoc2tpblVybCkge1xuICAgICAgICAgIHNraW5VcmwgPSBlZGl0b3IuZG9jdW1lbnRCYXNlVVJJLnRvQWJzb2x1dGUoc2tpblVybCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2tpblVybCA9IGdsb2JhbCQ3LmJhc2VVUkwgKyAnL3NraW5zL3VpLycgKyBza2luTmFtZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHNraW5Vcmw7XG4gICAgfTtcbiAgICB2YXIgaXNSZWFkT25seSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3JlYWRvbmx5JywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgaXNTa2luRGlzYWJsZWQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdza2luJykgPT09IGZhbHNlO1xuICAgIH07XG4gICAgdmFyIGdldEhlaWdodFNldHRpbmcgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdoZWlnaHQnLCBNYXRoLm1heChlZGl0b3IuZ2V0RWxlbWVudCgpLm9mZnNldEhlaWdodCwgMjAwKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0V2lkdGhTZXR0aW5nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnd2lkdGgnLCBnbG9iYWwkNS5ET00uZ2V0U3R5bGUoZWRpdG9yLmdldEVsZW1lbnQoKSwgJ3dpZHRoJykpO1xuICAgIH07XG4gICAgdmFyIGdldE1pbldpZHRoU2V0dGluZyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGVkaXRvci5nZXRQYXJhbSgnbWluX3dpZHRoJykpLmZpbHRlcihpc051bWJlcik7XG4gICAgfTtcbiAgICB2YXIgZ2V0TWluSGVpZ2h0U2V0dGluZyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGVkaXRvci5nZXRQYXJhbSgnbWluX2hlaWdodCcpKS5maWx0ZXIoaXNOdW1iZXIpO1xuICAgIH07XG4gICAgdmFyIGdldE1heFdpZHRoU2V0dGluZyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGVkaXRvci5nZXRQYXJhbSgnbWF4X3dpZHRoJykpLmZpbHRlcihpc051bWJlcik7XG4gICAgfTtcbiAgICB2YXIgZ2V0TWF4SGVpZ2h0U2V0dGluZyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGVkaXRvci5nZXRQYXJhbSgnbWF4X2hlaWdodCcpKS5maWx0ZXIoaXNOdW1iZXIpO1xuICAgIH07XG4gICAgdmFyIGdldFVzZXJTdHlsZUZvcm1hdHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShlZGl0b3IuZ2V0UGFyYW0oJ3N0eWxlX2Zvcm1hdHMnKSkuZmlsdGVyKGlzQXJyYXkpO1xuICAgIH07XG4gICAgdmFyIGlzTWVyZ2VTdHlsZUZvcm1hdHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdzdHlsZV9mb3JtYXRzX21lcmdlJywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TGluZUhlaWdodEZvcm1hdHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdsaW5laGVpZ2h0X2Zvcm1hdHMnLCAnMSAxLjEgMS4yIDEuMyAxLjQgMS41IDInLCAnc3RyaW5nJykuc3BsaXQoJyAnKTtcbiAgICB9O1xuICAgIHZhciBnZXRSZW1vdmVkTWVudUl0ZW1zID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncmVtb3ZlZF9tZW51aXRlbXMnLCAnJyk7XG4gICAgfTtcbiAgICB2YXIgaXNNZW51YmFyRW5hYmxlZCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ21lbnViYXInLCB0cnVlLCAnYm9vbGVhbicpICE9PSBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBpc1Rvb2xiYXJFbmFibGVkID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHRvb2xiYXIgPSBlZGl0b3IuZ2V0UGFyYW0oJ3Rvb2xiYXInLCB0cnVlKTtcbiAgICAgIHZhciBpc1Rvb2xiYXJUcnVlID0gdG9vbGJhciA9PT0gdHJ1ZTtcbiAgICAgIHZhciBpc1Rvb2xiYXJTdHJpbmcgPSBpc1N0cmluZyh0b29sYmFyKTtcbiAgICAgIHZhciBpc1Rvb2xiYXJPYmplY3RBcnJheSA9IGlzQXJyYXkodG9vbGJhcikgJiYgdG9vbGJhci5sZW5ndGggPiAwO1xuICAgICAgcmV0dXJuICFpc011bHRpcGxlVG9vbGJhcnMoZWRpdG9yKSAmJiAoaXNUb29sYmFyT2JqZWN0QXJyYXkgfHwgaXNUb29sYmFyU3RyaW5nIHx8IGlzVG9vbGJhclRydWUpO1xuICAgIH07XG4gICAgdmFyIGdldE11bHRpcGxlVG9vbGJhcnNTZXR0aW5nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHRvb2xiYXJzID0gcmFuZ2UoOSwgZnVuY3Rpb24gKG51bSkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0b29sYmFyJyArIChudW0gKyAxKSwgZmFsc2UsICdzdHJpbmcnKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHRvb2xiYXJBcnJheSA9IGZpbHRlcih0b29sYmFycywgZnVuY3Rpb24gKHRvb2xiYXIpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiB0b29sYmFyID09PSAnc3RyaW5nJztcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRvb2xiYXJBcnJheS5sZW5ndGggPiAwID8gT3B0aW9uYWwuc29tZSh0b29sYmFyQXJyYXkpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGlzTXVsdGlwbGVUb29sYmFycyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnZXRNdWx0aXBsZVRvb2xiYXJzU2V0dGluZyhlZGl0b3IpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9vbGJhciA9IGVkaXRvci5nZXRQYXJhbSgndG9vbGJhcicsIFtdLCAnc3RyaW5nW10nKTtcbiAgICAgICAgcmV0dXJuIHRvb2xiYXIubGVuZ3RoID4gMDtcbiAgICAgIH0sIGFsd2F5cyk7XG4gICAgfTtcbiAgICB2YXIgVG9vbGJhck1vZGU7XG4gICAgKGZ1bmN0aW9uIChUb29sYmFyTW9kZSkge1xuICAgICAgVG9vbGJhck1vZGVbJ2RlZmF1bHQnXSA9ICd3cmFwJztcbiAgICAgIFRvb2xiYXJNb2RlWydmbG9hdGluZyddID0gJ2Zsb2F0aW5nJztcbiAgICAgIFRvb2xiYXJNb2RlWydzbGlkaW5nJ10gPSAnc2xpZGluZyc7XG4gICAgICBUb29sYmFyTW9kZVsnc2Nyb2xsaW5nJ10gPSAnc2Nyb2xsaW5nJztcbiAgICB9KFRvb2xiYXJNb2RlIHx8IChUb29sYmFyTW9kZSA9IHt9KSkpO1xuICAgIHZhciBnZXRUb29sYmFyTW9kZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Rvb2xiYXJfbW9kZScsICcnLCAnc3RyaW5nJyk7XG4gICAgfTtcbiAgICB2YXIgVG9vbGJhckxvY2F0aW9uO1xuICAgIChmdW5jdGlvbiAoVG9vbGJhckxvY2F0aW9uKSB7XG4gICAgICBUb29sYmFyTG9jYXRpb25bJ2F1dG8nXSA9ICdhdXRvJztcbiAgICAgIFRvb2xiYXJMb2NhdGlvblsndG9wJ10gPSAndG9wJztcbiAgICAgIFRvb2xiYXJMb2NhdGlvblsnYm90dG9tJ10gPSAnYm90dG9tJztcbiAgICB9KFRvb2xiYXJMb2NhdGlvbiB8fCAoVG9vbGJhckxvY2F0aW9uID0ge30pKSk7XG4gICAgdmFyIGdldFRvb2xiYXJHcm91cHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0b29sYmFyX2dyb3VwcycsIHt9LCAnb2JqZWN0Jyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VG9vbGJhckxvY2F0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndG9vbGJhcl9sb2NhdGlvbicsIFRvb2xiYXJMb2NhdGlvbi5hdXRvLCAnc3RyaW5nJyk7XG4gICAgfTtcbiAgICB2YXIgaXNUb29sYmFyTG9jYXRpb25Cb3R0b20gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2V0VG9vbGJhckxvY2F0aW9uKGVkaXRvcikgPT09IFRvb2xiYXJMb2NhdGlvbi5ib3R0b207XG4gICAgfTtcbiAgICB2YXIgZml4ZWRDb250YWluZXJTZWxlY3RvciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ZpeGVkX3Rvb2xiYXJfY29udGFpbmVyJywgJycsICdzdHJpbmcnKTtcbiAgICB9O1xuICAgIHZhciBmaXhlZFRvb2xiYXJDb250YWluZXJUYXJnZXQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdmaXhlZF90b29sYmFyX2NvbnRhaW5lcl90YXJnZXQnKTtcbiAgICB9O1xuICAgIHZhciBpc1Rvb2xiYXJQZXJzaXN0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndG9vbGJhcl9wZXJzaXN0JywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgZml4ZWRDb250YWluZXJUYXJnZXQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBpZiAoIWVkaXRvci5pbmxpbmUpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHZhciBzZWxlY3RvciA9IGZpeGVkQ29udGFpbmVyU2VsZWN0b3IoZWRpdG9yKTtcbiAgICAgIGlmIChzZWxlY3Rvci5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBkZXNjZW5kYW50JDEoYm9keSgpLCBzZWxlY3Rvcik7XG4gICAgICB9XG4gICAgICB2YXIgZWxlbWVudCA9IGZpeGVkVG9vbGJhckNvbnRhaW5lclRhcmdldChlZGl0b3IpO1xuICAgICAgaWYgKGlzTm9uTnVsbGFibGUoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoU3VnYXJFbGVtZW50LmZyb21Eb20oZWxlbWVudCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciB1c2VGaXhlZENvbnRhaW5lciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuaW5saW5lICYmIGZpeGVkQ29udGFpbmVyVGFyZ2V0KGVkaXRvcikuaXNTb21lKCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VWlDb250YWluZXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgZml4ZWRDb250YWluZXIgPSBmaXhlZENvbnRhaW5lclRhcmdldChlZGl0b3IpO1xuICAgICAgcmV0dXJuIGZpeGVkQ29udGFpbmVyLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0Q29udGVudENvbnRhaW5lcihnZXRSb290Tm9kZShTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0RWxlbWVudCgpKSkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaXNEaXN0cmFjdGlvbkZyZWUgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmlubGluZSAmJiAhaXNNZW51YmFyRW5hYmxlZChlZGl0b3IpICYmICFpc1Rvb2xiYXJFbmFibGVkKGVkaXRvcikgJiYgIWlzTXVsdGlwbGVUb29sYmFycyhlZGl0b3IpO1xuICAgIH07XG4gICAgdmFyIGlzU3RpY2t5VG9vbGJhciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBpc1N0aWNreVRvb2xiYXIgPSBlZGl0b3IuZ2V0UGFyYW0oJ3Rvb2xiYXJfc3RpY2t5JywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgICByZXR1cm4gKGlzU3RpY2t5VG9vbGJhciB8fCBlZGl0b3IuaW5saW5lKSAmJiAhdXNlRml4ZWRDb250YWluZXIoZWRpdG9yKSAmJiAhaXNEaXN0cmFjdGlvbkZyZWUoZWRpdG9yKTtcbiAgICB9O1xuICAgIHZhciBpc0RyYWdnYWJsZU1vZGFsID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnZHJhZ2dhYmxlX21vZGFsJywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TWVudXMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgbWVudSA9IGVkaXRvci5nZXRQYXJhbSgnbWVudScpO1xuICAgICAgaWYgKG1lbnUpIHtcbiAgICAgICAgcmV0dXJuIG1hcCQyKG1lbnUsIGZ1bmN0aW9uIChtZW51KSB7XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBtZW51KSwgeyBpdGVtczogbWVudS5pdGVtcyB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0TWVudWJhciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ21lbnViYXInKTtcbiAgICB9O1xuICAgIHZhciBnZXRUb29sYmFyID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndG9vbGJhcicsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIGdldEZpbGVQaWNrZXJDYWxsYmFjayA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ZpbGVfcGlja2VyX2NhbGxiYWNrJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RmlsZVBpY2tlclR5cGVzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnZmlsZV9waWNrZXJfdHlwZXMnKTtcbiAgICB9O1xuICAgIHZhciBnZXRGaWxlQnJvd3NlckNhbGxiYWNrVHlwZXMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdmaWxlX2Jyb3dzZXJfY2FsbGJhY2tfdHlwZXMnKTtcbiAgICB9O1xuICAgIHZhciBub1R5cGVhaGVhZFVybHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0eXBlYWhlYWRfdXJscycpID09PSBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBnZXRBbmNob3JUb3AgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdhbmNob3JfdG9wJywgJyN0b3AnKTtcbiAgICB9O1xuICAgIHZhciBnZXRBbmNob3JCb3R0b20gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdhbmNob3JfYm90dG9tJywgJyNib3R0b20nKTtcbiAgICB9O1xuICAgIHZhciBnZXRGaWxlUGlja2VyVmFsaWRhdG9ySGFuZGxlciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBoYW5kbGVyID0gZWRpdG9yLmdldFBhcmFtKCdmaWxlX3BpY2tlcl92YWxpZGF0b3JfaGFuZGxlcicsIHVuZGVmaW5lZCwgJ2Z1bmN0aW9uJyk7XG4gICAgICBpZiAoaGFuZGxlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ZpbGVwaWNrZXJfdmFsaWRhdG9yX2hhbmRsZXInLCB1bmRlZmluZWQsICdmdW5jdGlvbicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGhhbmRsZXI7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBSZWFkT25seUNoYW5uZWwgPSAnc2lsdmVyLnJlYWRvbmx5JztcbiAgICB2YXIgUmVhZE9ubHlEYXRhU2NoZW1hID0gb2JqT2YoW3N0cmljdEJvb2xlYW4oJ3JlYWRvbmx5JyldKTtcbiAgICB2YXIgYnJvYWRjYXN0UmVhZG9ubHkgPSBmdW5jdGlvbiAodWlDb21wb25lbnRzLCByZWFkb25seSkge1xuICAgICAgdmFyIG91dGVyQ29udGFpbmVyID0gdWlDb21wb25lbnRzLm91dGVyQ29udGFpbmVyO1xuICAgICAgdmFyIHRhcmdldCA9IG91dGVyQ29udGFpbmVyLmVsZW1lbnQ7XG4gICAgICBpZiAocmVhZG9ubHkpIHtcbiAgICAgICAgdWlDb21wb25lbnRzLm1vdGhlcnNoaXAuYnJvYWRjYXN0T24oW2Rpc21pc3NQb3B1cHMoKV0sIHsgdGFyZ2V0OiB0YXJnZXQgfSk7XG4gICAgICAgIHVpQ29tcG9uZW50cy51aU1vdGhlcnNoaXAuYnJvYWRjYXN0T24oW2Rpc21pc3NQb3B1cHMoKV0sIHsgdGFyZ2V0OiB0YXJnZXQgfSk7XG4gICAgICB9XG4gICAgICB1aUNvbXBvbmVudHMubW90aGVyc2hpcC5icm9hZGNhc3RPbihbUmVhZE9ubHlDaGFubmVsXSwgeyByZWFkb25seTogcmVhZG9ubHkgfSk7XG4gICAgICB1aUNvbXBvbmVudHMudWlNb3RoZXJzaGlwLmJyb2FkY2FzdE9uKFtSZWFkT25seUNoYW5uZWxdLCB7IHJlYWRvbmx5OiByZWFkb25seSB9KTtcbiAgICB9O1xuICAgIHZhciBzZXR1cFJlYWRvbmx5TW9kZVN3aXRjaCA9IGZ1bmN0aW9uIChlZGl0b3IsIHVpQ29tcG9uZW50cykge1xuICAgICAgZWRpdG9yLm9uKCdpbml0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZWRpdG9yLm1vZGUuaXNSZWFkT25seSgpKSB7XG4gICAgICAgICAgYnJvYWRjYXN0UmVhZG9ubHkodWlDb21wb25lbnRzLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBlZGl0b3Iub24oJ1N3aXRjaE1vZGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBicm9hZGNhc3RSZWFkb25seSh1aUNvbXBvbmVudHMsIGVkaXRvci5tb2RlLmlzUmVhZE9ubHkoKSk7XG4gICAgICB9KTtcbiAgICAgIGlmIChpc1JlYWRPbmx5KGVkaXRvcikpIHtcbiAgICAgICAgZWRpdG9yLnNldE1vZGUoJ3JlYWRvbmx5Jyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVjZWl2aW5nQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF9hO1xuICAgICAgcmV0dXJuIFJlY2VpdmluZy5jb25maWcoe1xuICAgICAgICBjaGFubmVsczogKF9hID0ge30sIF9hW1JlYWRPbmx5Q2hhbm5lbF0gPSB7XG4gICAgICAgICAgc2NoZW1hOiBSZWFkT25seURhdGFTY2hlbWEsXG4gICAgICAgICAgb25SZWNlaXZlOiBmdW5jdGlvbiAoY29tcCwgZGF0YSkge1xuICAgICAgICAgICAgRGlzYWJsaW5nLnNldChjb21wLCBkYXRhLnJlYWRvbmx5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIF9hKVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBpdGVtID0gZnVuY3Rpb24gKGRpc2FibGVkKSB7XG4gICAgICByZXR1cm4gRGlzYWJsaW5nLmNvbmZpZyh7XG4gICAgICAgIGRpc2FibGVkOiBkaXNhYmxlZCxcbiAgICAgICAgZGlzYWJsZUNsYXNzOiAndG94LWNvbGxlY3Rpb25fX2l0ZW0tLXN0YXRlLWRpc2FibGVkJ1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYnV0dG9uID0gZnVuY3Rpb24gKGRpc2FibGVkKSB7XG4gICAgICByZXR1cm4gRGlzYWJsaW5nLmNvbmZpZyh7IGRpc2FibGVkOiBkaXNhYmxlZCB9KTtcbiAgICB9O1xuICAgIHZhciBzcGxpdEJ1dHRvbiA9IGZ1bmN0aW9uIChkaXNhYmxlZCkge1xuICAgICAgcmV0dXJuIERpc2FibGluZy5jb25maWcoe1xuICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgIGRpc2FibGVDbGFzczogJ3RveC10YnRuLS1kaXNhYmxlZCdcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRvb2xiYXJCdXR0b24gPSBmdW5jdGlvbiAoZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybiBEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkLFxuICAgICAgICBkaXNhYmxlQ2xhc3M6ICd0b3gtdGJ0bi0tZGlzYWJsZWQnLFxuICAgICAgICB1c2VOYXRpdmU6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBEaXNhYmxpbmdDb25maWdzID0ge1xuICAgICAgaXRlbTogaXRlbSxcbiAgICAgIGJ1dHRvbjogYnV0dG9uLFxuICAgICAgc3BsaXRCdXR0b246IHNwbGl0QnV0dG9uLFxuICAgICAgdG9vbGJhckJ1dHRvbjogdG9vbGJhckJ1dHRvblxuICAgIH07XG5cbiAgICB2YXIgcnVuV2l0aEFwaSA9IGZ1bmN0aW9uIChpbmZvLCBjb21wKSB7XG4gICAgICB2YXIgYXBpID0gaW5mby5nZXRBcGkoY29tcCk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgZihhcGkpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBvbkNvbnRyb2xBdHRhY2hlZCA9IGZ1bmN0aW9uIChpbmZvLCBlZGl0b3JPZmZDZWxsKSB7XG4gICAgICByZXR1cm4gcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICB2YXIgcnVuID0gcnVuV2l0aEFwaShpbmZvLCBjb21wKTtcbiAgICAgICAgcnVuKGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICB2YXIgb25EZXN0cm95ID0gaW5mby5vblNldHVwKGFwaSk7XG4gICAgICAgICAgaWYgKGlzRnVuY3Rpb24ob25EZXN0cm95KSkge1xuICAgICAgICAgICAgZWRpdG9yT2ZmQ2VsbC5zZXQob25EZXN0cm95KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgb25Db250cm9sRGV0YWNoZWQgPSBmdW5jdGlvbiAoZ2V0QXBpLCBlZGl0b3JPZmZDZWxsKSB7XG4gICAgICByZXR1cm4gcnVuT25EZXRhY2hlZChmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICByZXR1cm4gcnVuV2l0aEFwaShnZXRBcGksIGNvbXApKGVkaXRvck9mZkNlbGwuZ2V0KCkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBfYTtcbiAgICB2YXIgb25NZW51SXRlbUV4ZWN1dGUgPSBmdW5jdGlvbiAoaW5mbywgaXRlbVJlc3BvbnNlKSB7XG4gICAgICByZXR1cm4gcnVuT25FeGVjdXRlKGZ1bmN0aW9uIChjb21wLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICBydW5XaXRoQXBpKGluZm8sIGNvbXApKGluZm8ub25BY3Rpb24pO1xuICAgICAgICBpZiAoIWluZm8udHJpZ2dlcnNTdWJtZW51ICYmIGl0ZW1SZXNwb25zZSA9PT0gSXRlbVJlc3BvbnNlJDEuQ0xPU0VfT05fRVhFQ1VURSkge1xuICAgICAgICAgIGlmIChjb21wLmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICAgIGVtaXQoY29tcCwgc2FuZGJveENsb3NlKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1lbnVJdGVtRXZlbnRPcmRlciA9IChfYSA9IHt9LCBfYVtleGVjdXRlKCldID0gW1xuICAgICAgJ2Rpc2FibGluZycsXG4gICAgICAnYWxsb3kuYmFzZS5iZWhhdmlvdXInLFxuICAgICAgJ3RvZ2dsaW5nJyxcbiAgICAgICdpdGVtLWV2ZW50cydcbiAgICBdLCBfYSk7XG5cbiAgICB2YXIgY29tcG9uZW50UmVuZGVyUGlwZWxpbmUgPSBmdW5jdGlvbiAoeHMpIHtcbiAgICAgIHJldHVybiBiaW5kKHhzLCBmdW5jdGlvbiAobykge1xuICAgICAgICByZXR1cm4gby50b0FycmF5KCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJDb21tb25JdGVtID0gZnVuY3Rpb24gKHNwZWMsIHN0cnVjdHVyZSwgaXRlbVJlc3BvbnNlLCBwcm92aWRlcnNiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBlZGl0b3JPZmZDZWxsID0gQ2VsbChub29wKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdpdGVtJyxcbiAgICAgICAgZG9tOiBzdHJ1Y3R1cmUuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRSZW5kZXJQaXBlbGluZShzdHJ1Y3R1cmUub3B0Q29tcG9uZW50cyksXG4gICAgICAgIGRhdGE6IHNwZWMuZGF0YSxcbiAgICAgICAgZXZlbnRPcmRlcjogbWVudUl0ZW1FdmVudE9yZGVyLFxuICAgICAgICBoYXNTdWJtZW51OiBzcGVjLnRyaWdnZXJzU3VibWVudSxcbiAgICAgICAgaXRlbUJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBjb25maWcoJ2l0ZW0tZXZlbnRzJywgW1xuICAgICAgICAgICAgb25NZW51SXRlbUV4ZWN1dGUoc3BlYywgaXRlbVJlc3BvbnNlKSxcbiAgICAgICAgICAgIG9uQ29udHJvbEF0dGFjaGVkKHNwZWMsIGVkaXRvck9mZkNlbGwpLFxuICAgICAgICAgICAgb25Db250cm9sRGV0YWNoZWQoc3BlYywgZWRpdG9yT2ZmQ2VsbClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLml0ZW0oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNwZWMuZGlzYWJsZWQgfHwgcHJvdmlkZXJzYmFja3N0YWdlLmlzRGlzYWJsZWQoKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICByZWNlaXZpbmdDb25maWcoKSxcbiAgICAgICAgICBSZXBsYWNpbmcuY29uZmlnKHt9KVxuICAgICAgICBdLmNvbmNhdChzcGVjLml0ZW1CZWhhdmlvdXJzKSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYnVpbGREYXRhID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IHNvdXJjZS52YWx1ZSxcbiAgICAgICAgbWV0YTogX19hc3NpZ24oeyB0ZXh0OiBzb3VyY2UudGV4dC5nZXRPcignJykgfSwgc291cmNlLm1ldGEpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDggPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5FbnYnKTtcblxuICAgIHZhciBjb252ZXJ0VGV4dCA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgIHZhciBtYWMgPSB7XG4gICAgICAgIGFsdDogJyYjeDIzMjU7JyxcbiAgICAgICAgY3RybDogJyYjeDIzMDM7JyxcbiAgICAgICAgc2hpZnQ6ICcmI3gyMUU3OycsXG4gICAgICAgIG1ldGE6ICcmI3gyMzE4OycsXG4gICAgICAgIGFjY2VzczogJyYjeDIzMDM7JiN4MjMyNTsnXG4gICAgICB9O1xuICAgICAgdmFyIG90aGVyID0ge1xuICAgICAgICBtZXRhOiAnQ3RybCcsXG4gICAgICAgIGFjY2VzczogJ1NoaWZ0K0FsdCdcbiAgICAgIH07XG4gICAgICB2YXIgcmVwbGFjZSA9IGdsb2JhbCQ4Lm1hYyA/IG1hYyA6IG90aGVyO1xuICAgICAgdmFyIHNob3J0Y3V0ID0gc291cmNlLnNwbGl0KCcrJyk7XG4gICAgICB2YXIgdXBkYXRlZCA9IG1hcChzaG9ydGN1dCwgZnVuY3Rpb24gKHNlZ21lbnQpIHtcbiAgICAgICAgdmFyIHNlYXJjaCA9IHNlZ21lbnQudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgICAgIHJldHVybiBoYXMocmVwbGFjZSwgc2VhcmNoKSA/IHJlcGxhY2Vbc2VhcmNoXSA6IHNlZ21lbnQ7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBnbG9iYWwkOC5tYWMgPyB1cGRhdGVkLmpvaW4oJycpIDogdXBkYXRlZC5qb2luKCcrJyk7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJJY29uID0gZnVuY3Rpb24gKGljb25IdG1sKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFtpY29uQ2xhc3NdLFxuICAgICAgICAgIGlubmVySHRtbDogaWNvbkh0bWxcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJUZXh0ID0gZnVuY3Rpb24gKHRleHQkMSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbdGV4dENsYXNzXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbdGV4dChnbG9iYWwkNi50cmFuc2xhdGUodGV4dCQxKSldXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlckh0bWwgPSBmdW5jdGlvbiAoaHRtbCwgY2xhc3Nlcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBjbGFzc2VzLFxuICAgICAgICAgIGlubmVySHRtbDogaHRtbFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlclN0eWxlZFRleHQgPSBmdW5jdGlvbiAoc3R5bGUsIHRleHQkMSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbdGV4dENsYXNzXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbe1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogc3R5bGUudGFnLFxuICAgICAgICAgICAgICBzdHlsZXM6IHN0eWxlLnN0eWxlc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IFt0ZXh0KGdsb2JhbCQ2LnRyYW5zbGF0ZSh0ZXh0JDEpKV1cbiAgICAgICAgICB9XVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJTaG9ydGN1dCA9IGZ1bmN0aW9uIChzaG9ydGN1dCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbYWNjZXNzb3J5Q2xhc3NdLFxuICAgICAgICAgIGlubmVySHRtbDogY29udmVydFRleHQoc2hvcnRjdXQpXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQ2hlY2ttYXJrID0gZnVuY3Rpb24gKGljb25zKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFtjaGVja21hcmtDbGFzc10sXG4gICAgICAgICAgaW5uZXJIdG1sOiBnZXQkZSgnY2hlY2ttYXJrJywgaWNvbnMpXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyU3VibWVudUNhcmV0ID0gZnVuY3Rpb24gKGljb25zKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFtjYXJldENsYXNzXSxcbiAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCdjaGV2cm9uLXJpZ2h0JywgaWNvbnMpXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRG93bndhcmRzQ2FyZXQgPSBmdW5jdGlvbiAoaWNvbnMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW2NhcmV0Q2xhc3NdLFxuICAgICAgICAgIGlubmVySHRtbDogZ2V0JGUoJ2NoZXZyb24tZG93bicsIGljb25zKVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlckNvbnRhaW5lciA9IGZ1bmN0aW9uIChjb250YWluZXIsIGNvbXBvbmVudHMpIHtcbiAgICAgIHZhciBkaXJlY3Rpb25DbGFzcyA9IGNvbnRhaW5lci5kaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcgPyBjb250YWluZXJDb2x1bW5DbGFzcyA6IGNvbnRhaW5lclJvd0NsYXNzO1xuICAgICAgdmFyIGFsaWduQ2xhc3MgPSBjb250YWluZXIuYWxpZ24gPT09ICdsZWZ0JyA/IGNvbnRhaW5lckFsaWduTGVmdENsYXNzIDogY29udGFpbmVyQWxpZ25SaWdodENsYXNzO1xuICAgICAgdmFyIGdldFZhbGlnbkNsYXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzd2l0Y2ggKGNvbnRhaW5lci52YWxpZ24pIHtcbiAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICByZXR1cm4gY29udGFpbmVyVmFsaWduVG9wQ2xhc3M7XG4gICAgICAgIGNhc2UgJ21pZGRsZSc6XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5lclZhbGlnbk1pZGRsZUNsYXNzO1xuICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgIHJldHVybiBjb250YWluZXJWYWxpZ25Cb3R0b21DbGFzcztcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgY29udGFpbmVyQ2xhc3MsXG4gICAgICAgICAgICBkaXJlY3Rpb25DbGFzcyxcbiAgICAgICAgICAgIGFsaWduQ2xhc3MsXG4gICAgICAgICAgICBnZXRWYWxpZ25DbGFzcygpXG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlckltYWdlID0gZnVuY3Rpb24gKHNyYywgY2xhc3NlcywgYWx0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdpbWcnLFxuICAgICAgICAgIGNsYXNzZXM6IGNsYXNzZXMsXG4gICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgc3JjOiBzcmMsXG4gICAgICAgICAgICBhbHQ6IGFsdC5nZXRPcignJylcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJDb2xvclN0cnVjdHVyZSA9IGZ1bmN0aW9uIChpdGVtVGV4dCwgaXRlbVZhbHVlLCBpY29uU3ZnLCBwcm92aWRlckJhY2tzdGFnZSkge1xuICAgICAgdmFyIGNvbG9yUGlja2VyQ29tbWFuZCA9ICdjdXN0b20nO1xuICAgICAgdmFyIHJlbW92ZUNvbG9yQ29tbWFuZCA9ICdyZW1vdmUnO1xuICAgICAgdmFyIGdldERvbSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbW1vbiA9IGNvbG9yQ2xhc3M7XG4gICAgICAgIHZhciBpY29uID0gaWNvblN2Zy5nZXRPcignJyk7XG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0gaXRlbVRleHQubWFwKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgcmV0dXJuIHsgdGl0bGU6IHByb3ZpZGVyQmFja3N0YWdlLnRyYW5zbGF0ZSh0ZXh0KSB9O1xuICAgICAgICB9KS5nZXRPcih7fSk7XG4gICAgICAgIHZhciBiYXNlRG9tID0ge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcyxcbiAgICAgICAgICBjbGFzc2VzOiBbY29tbW9uXVxuICAgICAgICB9O1xuICAgICAgICBpZiAoaXRlbVZhbHVlID09PSBjb2xvclBpY2tlckNvbW1hbmQpIHtcbiAgICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIGJhc2VEb20pLCB7XG4gICAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgICAgY2xhc3NlczogX19zcHJlYWRBcnJheXMoYmFzZURvbS5jbGFzc2VzLCBbJ3RveC1zd2F0Y2hlc19fcGlja2VyLWJ0biddKSxcbiAgICAgICAgICAgIGlubmVySHRtbDogaWNvblxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW1WYWx1ZSA9PT0gcmVtb3ZlQ29sb3JDb21tYW5kKSB7XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBiYXNlRG9tKSwge1xuICAgICAgICAgICAgY2xhc3NlczogX19zcHJlYWRBcnJheXMoYmFzZURvbS5jbGFzc2VzLCBbJ3RveC1zd2F0Y2gtLXJlbW92ZSddKSxcbiAgICAgICAgICAgIGlubmVySHRtbDogaWNvblxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYmFzZURvbSksIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IF9fYXNzaWduKF9fYXNzaWduKHt9LCBiYXNlRG9tLmF0dHJpYnV0ZXMpLCB7ICdkYXRhLW1jZS1jb2xvcic6IGl0ZW1WYWx1ZSB9KSxcbiAgICAgICAgICAgIHN0eWxlczogeyAnYmFja2dyb3VuZC1jb2xvcic6IGl0ZW1WYWx1ZSB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IGdldERvbSgpLFxuICAgICAgICBvcHRDb21wb25lbnRzOiBbXVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJJdGVtRG9tU3RydWN0dXJlID0gZnVuY3Rpb24gKHJ0bENsYXNzLCBhcmlhTGFiZWwpIHtcbiAgICAgIHZhciBkb21UaXRsZSA9IGFyaWFMYWJlbC5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7XG4gICAgICAgIHJldHVybiB7IGF0dHJpYnV0ZXM6IHsgdGl0bGU6IGdsb2JhbCQ2LnRyYW5zbGF0ZShsYWJlbCkgfSB9O1xuICAgICAgfSkuZ2V0T3Ioe30pO1xuICAgICAgcmV0dXJuIF9fYXNzaWduKHtcbiAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgIG5hdkNsYXNzLFxuICAgICAgICAgIHNlbGVjdGFibGVDbGFzc1xuICAgICAgICBdLmNvbmNhdChydGxDbGFzcyA/IFtpY29uQ2xhc3NSdGxdIDogW10pXG4gICAgICB9LCBkb21UaXRsZSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyTm9ybWFsSXRlbVN0cnVjdHVyZSA9IGZ1bmN0aW9uIChpbmZvLCBpY29uLCByZW5kZXJJY29ucywgdGV4dFJlbmRlciwgcnRsQ2xhc3MpIHtcbiAgICAgIHZhciBsZWZ0SWNvbiA9IHJlbmRlckljb25zID8gaWNvbi5vcihPcHRpb25hbC5zb21lKCcnKSkubWFwKHJlbmRlckljb24pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIGNoZWNrbWFyayA9IGluZm8uY2hlY2tNYXJrO1xuICAgICAgdmFyIGNvbnRlbnQgPSBpbmZvLmh0bWxDb250ZW50LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaW5mby50ZXh0Q29udGVudC5tYXAodGV4dFJlbmRlcik7XG4gICAgICB9LCBmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShyZW5kZXJIdG1sKGh0bWwsIFt0ZXh0Q2xhc3NdKSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBtZW51SXRlbSA9IHtcbiAgICAgICAgZG9tOiByZW5kZXJJdGVtRG9tU3RydWN0dXJlKHJ0bENsYXNzLCBpbmZvLmFyaWFMYWJlbCksXG4gICAgICAgIG9wdENvbXBvbmVudHM6IFtcbiAgICAgICAgICBsZWZ0SWNvbixcbiAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgIGluZm8uc2hvcnRjdXRDb250ZW50Lm1hcChyZW5kZXJTaG9ydGN1dCksXG4gICAgICAgICAgY2hlY2ttYXJrLFxuICAgICAgICAgIGluZm8uY2FyZXRcbiAgICAgICAgXVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZW51SXRlbTtcbiAgICB9O1xuICAgIHZhciBydGxJY29uID0gW1xuICAgICAgJ2xpc3QtbnVtLWRlZmF1bHQnLFxuICAgICAgJ2xpc3QtbnVtLWxvd2VyLWFscGhhJyxcbiAgICAgICdsaXN0LW51bS1sb3dlci1ncmVlaycsXG4gICAgICAnbGlzdC1udW0tbG93ZXItcm9tYW4nLFxuICAgICAgJ2xpc3QtbnVtLXVwcGVyLWFscGhhJyxcbiAgICAgICdsaXN0LW51bS11cHBlci1yb21hbidcbiAgICBdO1xuICAgIHZhciBydGxUcmFuc2Zvcm0gPSBbXG4gICAgICAnbGlzdC1idWxsLWNpcmNsZScsXG4gICAgICAnbGlzdC1idWxsLWRlZmF1bHQnLFxuICAgICAgJ2xpc3QtYnVsbC1zcXVhcmUnXG4gICAgXTtcbiAgICB2YXIgcmVuZGVySXRlbVN0cnVjdHVyZSA9IGZ1bmN0aW9uIChpbmZvLCBwcm92aWRlcnNCYWNrc3RhZ2UsIHJlbmRlckljb25zLCBmYWxsYmFja0ljb24pIHtcbiAgICAgIGlmIChmYWxsYmFja0ljb24gPT09IHZvaWQgMCkge1xuICAgICAgICBmYWxsYmFja0ljb24gPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgICB2YXIgZ2V0SWNvbk5hbWUgPSBmdW5jdGlvbiAoaWNvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGljb25OYW1lLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgIHJldHVybiBnbG9iYWwkNi5pc1J0bCgpICYmIGNvbnRhaW5zKHJ0bEljb24sIG5hbWUpID8gbmFtZSArICctcnRsJyA6IG5hbWU7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBuZWVkUnRsQ2xhc3MgPSBnbG9iYWwkNi5pc1J0bCgpICYmIGluZm8uaWNvbkNvbnRlbnQuZXhpc3RzKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiBjb250YWlucyhydGxUcmFuc2Zvcm0sIG5hbWUpO1xuICAgICAgfSk7XG4gICAgICB2YXIgaWNvbiA9IGdldEljb25OYW1lKGluZm8uaWNvbkNvbnRlbnQpLm1hcChmdW5jdGlvbiAoaWNvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGdldE9yKGljb25OYW1lLCBwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMsIGZhbGxiYWNrSWNvbik7XG4gICAgICB9KTtcbiAgICAgIHZhciB0ZXh0UmVuZGVyID0gT3B0aW9uYWwuZnJvbShpbmZvLm1ldGEpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVuZGVyVGV4dDtcbiAgICAgIH0sIGZ1bmN0aW9uIChtZXRhKSB7XG4gICAgICAgIHJldHVybiBoYXMobWV0YSwgJ3N0eWxlJykgPyBjdXJyeShyZW5kZXJTdHlsZWRUZXh0LCBtZXRhLnN0eWxlKSA6IHJlbmRlclRleHQ7XG4gICAgICB9KTtcbiAgICAgIGlmIChpbmZvLnByZXNldHMgPT09ICdjb2xvcicpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckNvbG9yU3RydWN0dXJlKGluZm8uYXJpYUxhYmVsLCBpbmZvLnZhbHVlLCBpY29uLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlck5vcm1hbEl0ZW1TdHJ1Y3R1cmUoaW5mbywgaWNvbiwgcmVuZGVySWNvbnMsIHRleHRSZW5kZXIsIG5lZWRSdGxDbGFzcyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciB0b29sdGlwQmVoYXZpb3VyID0gZnVuY3Rpb24gKG1ldGEsIHNoYXJlZEJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIGdldCQxKG1ldGEsICd0b29sdGlwV29ya2VyJykubWFwKGZ1bmN0aW9uICh0b29sdGlwV29ya2VyKSB7XG4gICAgICAgIHJldHVybiBbVG9vbHRpcHBpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGxhenlTaW5rOiBzaGFyZWRCYWNrc3RhZ2UuZ2V0U2luayxcbiAgICAgICAgICAgIHRvb2x0aXBEb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtdG9vbHRpcC13b3JrZXItY29udGFpbmVyJ11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b29sdGlwQ29tcG9uZW50czogW10sXG4gICAgICAgICAgICBhbmNob3I6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgYW5jaG9yOiAnc3VibWVudScsXG4gICAgICAgICAgICAgICAgaXRlbTogY29tcCxcbiAgICAgICAgICAgICAgICBvdmVycmlkZXM6IHsgbWF4SGVpZ2h0RnVuY3Rpb246IGV4cGFuZGFibGUgfVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1vZGU6ICdmb2xsb3ctaGlnaGxpZ2h0JyxcbiAgICAgICAgICAgIG9uU2hvdzogZnVuY3Rpb24gKGNvbXBvbmVudCwgX3Rvb2x0aXApIHtcbiAgICAgICAgICAgICAgdG9vbHRpcFdvcmtlcihmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgICAgICAgICAgVG9vbHRpcHBpbmcuc2V0Q29tcG9uZW50cyhjb21wb25lbnQsIFtleHRlcm5hbCh7IGVsZW1lbnQ6IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsbSkgfSldKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSldO1xuICAgICAgfSkuZ2V0T3IoW10pO1xuICAgIH07XG4gICAgdmFyIGVuY29kZVRleHQgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIGdsb2JhbCQ1LkRPTS5lbmNvZGUodGV4dCk7XG4gICAgfTtcbiAgICB2YXIgcmVwbGFjZVRleHQgPSBmdW5jdGlvbiAodGV4dCwgbWF0Y2hUZXh0KSB7XG4gICAgICB2YXIgdHJhbnNsYXRlZCA9IGdsb2JhbCQ2LnRyYW5zbGF0ZSh0ZXh0KTtcbiAgICAgIHZhciBlbmNvZGVkID0gZW5jb2RlVGV4dCh0cmFuc2xhdGVkKTtcbiAgICAgIGlmIChtYXRjaFRleHQubGVuZ3RoID4gMCkge1xuICAgICAgICB2YXIgZXNjYXBlZE1hdGNoUmVnZXggPSBuZXcgUmVnRXhwKGVzY2FwZShtYXRjaFRleHQpLCAnZ2knKTtcbiAgICAgICAgcmV0dXJuIGVuY29kZWQucmVwbGFjZShlc2NhcGVkTWF0Y2hSZWdleCwgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cInRveC1hdXRvY29tcGxldGVyLWhpZ2hsaWdodFwiPicgKyBtYXRjaCArICc8L3NwYW4+JztcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZW5jb2RlZDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciByZW5kZXJBdXRvY29tcGxldGVJdGVtID0gZnVuY3Rpb24gKHNwZWMsIG1hdGNoVGV4dCwgdXNlVGV4dCwgcHJlc2V0cywgb25JdGVtVmFsdWVIYW5kbGVyLCBpdGVtUmVzcG9uc2UsIHNoYXJlZEJhY2tzdGFnZSwgcmVuZGVySWNvbnMpIHtcbiAgICAgIGlmIChyZW5kZXJJY29ucyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlbmRlckljb25zID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHZhciBzdHJ1Y3R1cmUgPSByZW5kZXJJdGVtU3RydWN0dXJlKHtcbiAgICAgICAgcHJlc2V0czogcHJlc2V0cyxcbiAgICAgICAgdGV4dENvbnRlbnQ6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgaHRtbENvbnRlbnQ6IHVzZVRleHQgPyBzcGVjLnRleHQubWFwKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlcGxhY2VUZXh0KHRleHQsIG1hdGNoVGV4dCk7XG4gICAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBhcmlhTGFiZWw6IHNwZWMudGV4dCxcbiAgICAgICAgaWNvbkNvbnRlbnQ6IHNwZWMuaWNvbixcbiAgICAgICAgc2hvcnRjdXRDb250ZW50OiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGNoZWNrTWFyazogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBjYXJldDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICB2YWx1ZTogc3BlYy52YWx1ZVxuICAgICAgfSwgc2hhcmVkQmFja3N0YWdlLnByb3ZpZGVycywgcmVuZGVySWNvbnMsIHNwZWMuaWNvbik7XG4gICAgICByZXR1cm4gcmVuZGVyQ29tbW9uSXRlbSh7XG4gICAgICAgIGRhdGE6IGJ1aWxkRGF0YShzcGVjKSxcbiAgICAgICAgZGlzYWJsZWQ6IHNwZWMuZGlzYWJsZWQsXG4gICAgICAgIGdldEFwaTogY29uc3RhbnQoe30pLFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKF9hcGkpIHtcbiAgICAgICAgICByZXR1cm4gb25JdGVtVmFsdWVIYW5kbGVyKHNwZWMudmFsdWUsIHNwZWMubWV0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uU2V0dXA6IGNvbnN0YW50KG5vb3ApLFxuICAgICAgICB0cmlnZ2Vyc1N1Ym1lbnU6IGZhbHNlLFxuICAgICAgICBpdGVtQmVoYXZpb3VyczogdG9vbHRpcEJlaGF2aW91cihzcGVjLm1ldGEsIHNoYXJlZEJhY2tzdGFnZSlcbiAgICAgIH0sIHN0cnVjdHVyZSwgaXRlbVJlc3BvbnNlLCBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uIChpdGVtcywgZXh0cmFzKSB7XG4gICAgICByZXR1cm4gbWFwKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICBzd2l0Y2ggKGl0ZW0udHlwZSkge1xuICAgICAgICBjYXNlICdjYXJkY29udGFpbmVyJzpcbiAgICAgICAgICByZXR1cm4gcmVuZGVyQ29udGFpbmVyKGl0ZW0sIHJlbmRlcihpdGVtLml0ZW1zLCBleHRyYXMpKTtcbiAgICAgICAgY2FzZSAnY2FyZGltYWdlJzpcbiAgICAgICAgICByZXR1cm4gcmVuZGVySW1hZ2UoaXRlbS5zcmMsIGl0ZW0uY2xhc3NlcywgaXRlbS5hbHQpO1xuICAgICAgICBjYXNlICdjYXJkdGV4dCc6XG4gICAgICAgICAgdmFyIHNob3VsZEhpZ2hsaWdodCA9IGl0ZW0ubmFtZS5leGlzdHMoZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250YWlucyhleHRyYXMuY2FyZFRleHQuaGlnaGxpZ2h0T24sIG5hbWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZhciBtYXRjaFRleHQgPSBzaG91bGRIaWdobGlnaHQgPyBPcHRpb25hbC5mcm9tKGV4dHJhcy5jYXJkVGV4dC5tYXRjaFRleHQpLmdldE9yKCcnKSA6ICcnO1xuICAgICAgICAgIHJldHVybiByZW5kZXJIdG1sKHJlcGxhY2VUZXh0KGl0ZW0udGV4dCwgbWF0Y2hUZXh0KSwgaXRlbS5jbGFzc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQ2FyZE1lbnVJdGVtID0gZnVuY3Rpb24gKHNwZWMsIGl0ZW1SZXNwb25zZSwgc2hhcmVkQmFja3N0YWdlLCBleHRyYXMpIHtcbiAgICAgIHZhciBnZXRBcGkgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIERpc2FibGluZy5pc0Rpc2FibGVkKGNvbXBvbmVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICBEaXNhYmxpbmcuc2V0KGNvbXBvbmVudCwgc3RhdGUpO1xuICAgICAgICAgICAgZWFjaChkZXNjZW5kYW50cyhjb21wb25lbnQuZWxlbWVudCwgJyonKSwgZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICAgICAgICBjb21wb25lbnQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20oZWxtKS5lYWNoKGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbXAuaGFzQ29uZmlndXJlZChEaXNhYmxpbmcpKSB7XG4gICAgICAgICAgICAgICAgICBEaXNhYmxpbmcuc2V0KGNvbXAsIHN0YXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBzdHJ1Y3R1cmUgPSB7XG4gICAgICAgIGRvbTogcmVuZGVySXRlbURvbVN0cnVjdHVyZShmYWxzZSwgc3BlYy5sYWJlbCksXG4gICAgICAgIG9wdENvbXBvbmVudHM6IFtPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAgICAgY29udGFpbmVyQ2xhc3MsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyUm93Q2xhc3NcbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IHJlbmRlcihzcGVjLml0ZW1zLCBleHRyYXMpXG4gICAgICAgICAgfSldXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHJlbmRlckNvbW1vbkl0ZW0oe1xuICAgICAgICBkYXRhOiBidWlsZERhdGEoX19hc3NpZ24oeyB0ZXh0OiBPcHRpb25hbC5ub25lKCkgfSwgc3BlYykpLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgZ2V0QXBpOiBnZXRBcGksXG4gICAgICAgIG9uQWN0aW9uOiBzcGVjLm9uQWN0aW9uLFxuICAgICAgICBvblNldHVwOiBzcGVjLm9uU2V0dXAsXG4gICAgICAgIHRyaWdnZXJzU3VibWVudTogZmFsc2UsXG4gICAgICAgIGl0ZW1CZWhhdmlvdXJzOiBPcHRpb25hbC5mcm9tKGV4dHJhcy5pdGVtQmVoYXZpb3VycykuZ2V0T3IoW10pXG4gICAgICB9LCBzdHJ1Y3R1cmUsIGl0ZW1SZXNwb25zZSwgc2hhcmVkQmFja3N0YWdlLnByb3ZpZGVycyk7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJDaG9pY2VJdGVtID0gZnVuY3Rpb24gKHNwZWMsIHVzZVRleHQsIHByZXNldHMsIG9uSXRlbVZhbHVlSGFuZGxlciwgaXNTZWxlY3RlZCwgaXRlbVJlc3BvbnNlLCBwcm92aWRlcnNCYWNrc3RhZ2UsIHJlbmRlckljb25zKSB7XG4gICAgICBpZiAocmVuZGVySWNvbnMgPT09IHZvaWQgMCkge1xuICAgICAgICByZW5kZXJJY29ucyA9IHRydWU7XG4gICAgICB9XG4gICAgICB2YXIgZ2V0QXBpID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNldEFjdGl2ZTogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICBUb2dnbGluZy5zZXQoY29tcG9uZW50LCBzdGF0ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpc0FjdGl2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFRvZ2dsaW5nLmlzT24oY29tcG9uZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuaXNEaXNhYmxlZChjb21wb25lbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0RGlzYWJsZWQ6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIERpc2FibGluZy5zZXQoY29tcG9uZW50LCBzdGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBzdHJ1Y3R1cmUgPSByZW5kZXJJdGVtU3RydWN0dXJlKHtcbiAgICAgICAgcHJlc2V0czogcHJlc2V0cyxcbiAgICAgICAgdGV4dENvbnRlbnQ6IHVzZVRleHQgPyBzcGVjLnRleHQgOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGh0bWxDb250ZW50OiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGFyaWFMYWJlbDogc3BlYy50ZXh0LFxuICAgICAgICBpY29uQ29udGVudDogc3BlYy5pY29uLFxuICAgICAgICBzaG9ydGN1dENvbnRlbnQ6IHVzZVRleHQgPyBzcGVjLnNob3J0Y3V0IDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBjaGVja01hcms6IHVzZVRleHQgPyBPcHRpb25hbC5zb21lKHJlbmRlckNoZWNrbWFyayhwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpKSA6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgY2FyZXQ6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgdmFsdWU6IHNwZWMudmFsdWVcbiAgICAgIH0sIHByb3ZpZGVyc0JhY2tzdGFnZSwgcmVuZGVySWNvbnMpO1xuICAgICAgcmV0dXJuIGRlZXBNZXJnZShyZW5kZXJDb21tb25JdGVtKHtcbiAgICAgICAgZGF0YTogYnVpbGREYXRhKHNwZWMpLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgZ2V0QXBpOiBnZXRBcGksXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoX2FwaSkge1xuICAgICAgICAgIHJldHVybiBvbkl0ZW1WYWx1ZUhhbmRsZXIoc3BlYy52YWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uU2V0dXA6IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICBhcGkuc2V0QWN0aXZlKGlzU2VsZWN0ZWQpO1xuICAgICAgICAgIHJldHVybiBub29wO1xuICAgICAgICB9LFxuICAgICAgICB0cmlnZ2Vyc1N1Ym1lbnU6IGZhbHNlLFxuICAgICAgICBpdGVtQmVoYXZpb3VyczogW11cbiAgICAgIH0sIHN0cnVjdHVyZSwgaXRlbVJlc3BvbnNlLCBwcm92aWRlcnNCYWNrc3RhZ2UpLCB7XG4gICAgICAgIHRvZ2dsaW5nOiB7XG4gICAgICAgICAgdG9nZ2xlQ2xhc3M6IHRpY2tlZENsYXNzLFxuICAgICAgICAgIHRvZ2dsZU9uRXhlY3V0ZTogZmFsc2UsXG4gICAgICAgICAgc2VsZWN0ZWQ6IHNwZWMuYWN0aXZlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcGFydHMkMiA9IGdlbmVyYXRlJDQob3duZXIkMigpLCBwYXJ0cygpKTtcblxuICAgIHZhciBoZXhDb2xvdXIgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiB7IHZhbHVlOiB2YWx1ZSB9O1xuICAgIH07XG4gICAgdmFyIHNob3J0aGFuZFJlZ2V4ID0gL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKSQvaTtcbiAgICB2YXIgbG9uZ2Zvcm1SZWdleCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkkL2k7XG4gICAgdmFyIGlzSGV4U3RyaW5nID0gZnVuY3Rpb24gKGhleCkge1xuICAgICAgcmV0dXJuIHNob3J0aGFuZFJlZ2V4LnRlc3QoaGV4KSB8fCBsb25nZm9ybVJlZ2V4LnRlc3QoaGV4KTtcbiAgICB9O1xuICAgIHZhciBnZXRMb25nRm9ybSA9IGZ1bmN0aW9uIChoZXgpIHtcbiAgICAgIHZhciBoZXhTdHJpbmcgPSBoZXgudmFsdWUucmVwbGFjZShzaG9ydGhhbmRSZWdleCwgZnVuY3Rpb24gKG0sIHIsIGcsIGIpIHtcbiAgICAgICAgcmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHsgdmFsdWU6IGhleFN0cmluZyB9O1xuICAgIH07XG4gICAgdmFyIGV4dHJhY3RWYWx1ZXMgPSBmdW5jdGlvbiAoaGV4KSB7XG4gICAgICB2YXIgbG9uZ0Zvcm0gPSBnZXRMb25nRm9ybShoZXgpO1xuICAgICAgdmFyIHNwbGl0Rm9ybSA9IGxvbmdmb3JtUmVnZXguZXhlYyhsb25nRm9ybS52YWx1ZSk7XG4gICAgICByZXR1cm4gc3BsaXRGb3JtID09PSBudWxsID8gW1xuICAgICAgICAnRkZGRkZGJyxcbiAgICAgICAgJ0ZGJyxcbiAgICAgICAgJ0ZGJyxcbiAgICAgICAgJ0ZGJ1xuICAgICAgXSA6IHNwbGl0Rm9ybTtcbiAgICB9O1xuICAgIHZhciB0b0hleCA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHZhciBoZXggPSBjb21wb25lbnQudG9TdHJpbmcoMTYpO1xuICAgICAgcmV0dXJuIChoZXgubGVuZ3RoID09PSAxID8gJzAnICsgaGV4IDogaGV4KS50b1VwcGVyQ2FzZSgpO1xuICAgIH07XG4gICAgdmFyIGZyb21SZ2JhID0gZnVuY3Rpb24gKHJnYmFDb2xvdXIpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRvSGV4KHJnYmFDb2xvdXIucmVkKSArIHRvSGV4KHJnYmFDb2xvdXIuZ3JlZW4pICsgdG9IZXgocmdiYUNvbG91ci5ibHVlKTtcbiAgICAgIHJldHVybiBoZXhDb2xvdXIodmFsdWUpO1xuICAgIH07XG5cbiAgICB2YXIgbWluID0gTWF0aC5taW47XG4gICAgdmFyIG1heCA9IE1hdGgubWF4O1xuICAgIHZhciByb3VuZCA9IE1hdGgucm91bmQ7XG4gICAgdmFyIHJnYlJlZ2V4ID0gL15yZ2JcXCgoXFxkKyksXFxzKihcXGQrKSxcXHMqKFxcZCspXFwpLztcbiAgICB2YXIgcmdiYVJlZ2V4ID0gL15yZ2JhXFwoKFxcZCspLFxccyooXFxkKyksXFxzKihcXGQrKSxcXHMqKFxcZD8oPzpcXC5cXGQrKT8pXFwpLztcbiAgICB2YXIgcmdiYUNvbG91ciA9IGZ1bmN0aW9uIChyZWQsIGdyZWVuLCBibHVlLCBhbHBoYSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVkOiByZWQsXG4gICAgICAgIGdyZWVuOiBncmVlbixcbiAgICAgICAgYmx1ZTogYmx1ZSxcbiAgICAgICAgYWxwaGE6IGFscGhhXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzUmdiYUNvbXBvbmVudCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdmFyIG51bSA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICByZXR1cm4gbnVtLnRvU3RyaW5nKCkgPT09IHZhbHVlICYmIG51bSA+PSAwICYmIG51bSA8PSAyNTU7XG4gICAgfTtcbiAgICB2YXIgZnJvbUhzdiA9IGZ1bmN0aW9uIChoc3YpIHtcbiAgICAgIHZhciByO1xuICAgICAgdmFyIGc7XG4gICAgICB2YXIgYjtcbiAgICAgIHZhciBodWUgPSAoaHN2Lmh1ZSB8fCAwKSAlIDM2MDtcbiAgICAgIHZhciBzYXR1cmF0aW9uID0gaHN2LnNhdHVyYXRpb24gLyAxMDA7XG4gICAgICB2YXIgYnJpZ2h0bmVzcyA9IGhzdi52YWx1ZSAvIDEwMDtcbiAgICAgIHNhdHVyYXRpb24gPSBtYXgoMCwgbWluKHNhdHVyYXRpb24sIDEpKTtcbiAgICAgIGJyaWdodG5lc3MgPSBtYXgoMCwgbWluKGJyaWdodG5lc3MsIDEpKTtcbiAgICAgIGlmIChzYXR1cmF0aW9uID09PSAwKSB7XG4gICAgICAgIHIgPSBnID0gYiA9IHJvdW5kKDI1NSAqIGJyaWdodG5lc3MpO1xuICAgICAgICByZXR1cm4gcmdiYUNvbG91cihyLCBnLCBiLCAxKTtcbiAgICAgIH1cbiAgICAgIHZhciBzaWRlID0gaHVlIC8gNjA7XG4gICAgICB2YXIgY2hyb21hID0gYnJpZ2h0bmVzcyAqIHNhdHVyYXRpb247XG4gICAgICB2YXIgeCA9IGNocm9tYSAqICgxIC0gTWF0aC5hYnMoc2lkZSAlIDIgLSAxKSk7XG4gICAgICB2YXIgbWF0Y2ggPSBicmlnaHRuZXNzIC0gY2hyb21hO1xuICAgICAgc3dpdGNoIChNYXRoLmZsb29yKHNpZGUpKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIHIgPSBjaHJvbWE7XG4gICAgICAgIGcgPSB4O1xuICAgICAgICBiID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHIgPSB4O1xuICAgICAgICBnID0gY2hyb21hO1xuICAgICAgICBiID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHIgPSAwO1xuICAgICAgICBnID0gY2hyb21hO1xuICAgICAgICBiID0geDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHIgPSAwO1xuICAgICAgICBnID0geDtcbiAgICAgICAgYiA9IGNocm9tYTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHIgPSB4O1xuICAgICAgICBnID0gMDtcbiAgICAgICAgYiA9IGNocm9tYTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHIgPSBjaHJvbWE7XG4gICAgICAgIGcgPSAwO1xuICAgICAgICBiID0geDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByID0gZyA9IGIgPSAwO1xuICAgICAgfVxuICAgICAgciA9IHJvdW5kKDI1NSAqIChyICsgbWF0Y2gpKTtcbiAgICAgIGcgPSByb3VuZCgyNTUgKiAoZyArIG1hdGNoKSk7XG4gICAgICBiID0gcm91bmQoMjU1ICogKGIgKyBtYXRjaCkpO1xuICAgICAgcmV0dXJuIHJnYmFDb2xvdXIociwgZywgYiwgMSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbUhleCA9IGZ1bmN0aW9uIChoZXhDb2xvdXIpIHtcbiAgICAgIHZhciByZXN1bHQgPSBleHRyYWN0VmFsdWVzKGhleENvbG91cik7XG4gICAgICB2YXIgcmVkID0gcGFyc2VJbnQocmVzdWx0WzFdLCAxNik7XG4gICAgICB2YXIgZ3JlZW4gPSBwYXJzZUludChyZXN1bHRbMl0sIDE2KTtcbiAgICAgIHZhciBibHVlID0gcGFyc2VJbnQocmVzdWx0WzNdLCAxNik7XG4gICAgICByZXR1cm4gcmdiYUNvbG91cihyZWQsIGdyZWVuLCBibHVlLCAxKTtcbiAgICB9O1xuICAgIHZhciBmcm9tU3RyaW5nVmFsdWVzID0gZnVuY3Rpb24gKHJlZCwgZ3JlZW4sIGJsdWUsIGFscGhhKSB7XG4gICAgICB2YXIgciA9IHBhcnNlSW50KHJlZCwgMTApO1xuICAgICAgdmFyIGcgPSBwYXJzZUludChncmVlbiwgMTApO1xuICAgICAgdmFyIGIgPSBwYXJzZUludChibHVlLCAxMCk7XG4gICAgICB2YXIgYSA9IHBhcnNlRmxvYXQoYWxwaGEpO1xuICAgICAgcmV0dXJuIHJnYmFDb2xvdXIociwgZywgYiwgYSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChyZ2JhU3RyaW5nKSB7XG4gICAgICBpZiAocmdiYVN0cmluZyA9PT0gJ3RyYW5zcGFyZW50Jykge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShyZ2JhQ29sb3VyKDAsIDAsIDAsIDApKTtcbiAgICAgIH1cbiAgICAgIHZhciByZ2JNYXRjaCA9IHJnYlJlZ2V4LmV4ZWMocmdiYVN0cmluZyk7XG4gICAgICBpZiAocmdiTWF0Y2ggIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZnJvbVN0cmluZ1ZhbHVlcyhyZ2JNYXRjaFsxXSwgcmdiTWF0Y2hbMl0sIHJnYk1hdGNoWzNdLCAnMScpKTtcbiAgICAgIH1cbiAgICAgIHZhciByZ2JhTWF0Y2ggPSByZ2JhUmVnZXguZXhlYyhyZ2JhU3RyaW5nKTtcbiAgICAgIGlmIChyZ2JhTWF0Y2ggIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZnJvbVN0cmluZ1ZhbHVlcyhyZ2JhTWF0Y2hbMV0sIHJnYmFNYXRjaFsyXSwgcmdiYU1hdGNoWzNdLCByZ2JhTWF0Y2hbNF0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgdG9TdHJpbmcgPSBmdW5jdGlvbiAocmdiYSkge1xuICAgICAgcmV0dXJuICdyZ2JhKCcgKyByZ2JhLnJlZCArICcsJyArIHJnYmEuZ3JlZW4gKyAnLCcgKyByZ2JhLmJsdWUgKyAnLCcgKyByZ2JhLmFscGhhICsgJyknO1xuICAgIH07XG4gICAgdmFyIHJlZCA9IHJnYmFDb2xvdXIoMjU1LCAwLCAwLCAxKTtcblxuICAgIHZhciBmaXJlU2tpbkxvYWRlZCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZmlyZSgnU2tpbkxvYWRlZCcpO1xuICAgIH07XG4gICAgdmFyIGZpcmVTa2luTG9hZEVycm9yID0gZnVuY3Rpb24gKGVkaXRvciwgZXJyb3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZmlyZSgnU2tpbkxvYWRFcnJvcicsIGVycm9yKTtcbiAgICB9O1xuICAgIHZhciBmaXJlUmVzaXplRWRpdG9yID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5maXJlKCdSZXNpemVFZGl0b3InKTtcbiAgICB9O1xuICAgIHZhciBmaXJlUmVzaXplQ29udGVudCA9IGZ1bmN0aW9uIChlZGl0b3IsIGUpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZmlyZSgnUmVzaXplQ29udGVudCcsIGUpO1xuICAgIH07XG4gICAgdmFyIGZpcmVTY3JvbGxDb250ZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgZSkge1xuICAgICAgcmV0dXJuIGVkaXRvci5maXJlKCdTY3JvbGxDb250ZW50JywgZSk7XG4gICAgfTtcbiAgICB2YXIgZmlyZVRleHRDb2xvckNoYW5nZSA9IGZ1bmN0aW9uIChlZGl0b3IsIGRhdGEpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZmlyZSgnVGV4dENvbG9yQ2hhbmdlJywgZGF0YSk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkOSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuTG9jYWxTdG9yYWdlJyk7XG5cbiAgICB2YXIgc3RvcmFnZU5hbWUgPSAndGlueW1jZS1jdXN0b20tY29sb3JzJztcbiAgICBmdW5jdGlvbiBDb2xvckNhY2hlIChtYXgpIHtcbiAgICAgIGlmIChtYXggPT09IHZvaWQgMCkge1xuICAgICAgICBtYXggPSAxMDtcbiAgICAgIH1cbiAgICAgIHZhciBzdG9yYWdlU3RyaW5nID0gZ2xvYmFsJDkuZ2V0SXRlbShzdG9yYWdlTmFtZSk7XG4gICAgICB2YXIgbG9jYWxzdG9yYWdlID0gaXNTdHJpbmcoc3RvcmFnZVN0cmluZykgPyBKU09OLnBhcnNlKHN0b3JhZ2VTdHJpbmcpIDogW107XG4gICAgICB2YXIgcHJ1bmUgPSBmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICB2YXIgZGlmZiA9IG1heCAtIGxpc3QubGVuZ3RoO1xuICAgICAgICByZXR1cm4gZGlmZiA8IDAgPyBsaXN0LnNsaWNlKDAsIG1heCkgOiBsaXN0O1xuICAgICAgfTtcbiAgICAgIHZhciBjYWNoZSA9IHBydW5lKGxvY2Fsc3RvcmFnZSk7XG4gICAgICB2YXIgYWRkID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBpbmRleE9mKGNhY2hlLCBrZXkpLmVhY2gocmVtb3ZlKTtcbiAgICAgICAgY2FjaGUudW5zaGlmdChrZXkpO1xuICAgICAgICBpZiAoY2FjaGUubGVuZ3RoID4gbWF4KSB7XG4gICAgICAgICAgY2FjaGUucG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgZ2xvYmFsJDkuc2V0SXRlbShzdG9yYWdlTmFtZSwgSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVtb3ZlID0gZnVuY3Rpb24gKGlkeCkge1xuICAgICAgICBjYWNoZS5zcGxpY2UoaWR4LCAxKTtcbiAgICAgIH07XG4gICAgICB2YXIgc3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjYWNoZS5zbGljZSgwKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhZGQ6IGFkZCxcbiAgICAgICAgc3RhdGU6IHN0YXRlXG4gICAgICB9O1xuICAgIH1cblxuICAgIHZhciBjaG9pY2VJdGVtID0gJ2Nob2ljZWl0ZW0nO1xuICAgIHZhciBkZWZhdWx0Q29sb3JzID0gW1xuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnTGlnaHQgR3JlZW4nLFxuICAgICAgICB2YWx1ZTogJyNCRkVERDInXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnTGlnaHQgWWVsbG93JyxcbiAgICAgICAgdmFsdWU6ICcjRkJFRUI4J1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogY2hvaWNlSXRlbSxcbiAgICAgICAgdGV4dDogJ0xpZ2h0IFJlZCcsXG4gICAgICAgIHZhbHVlOiAnI0Y4Q0FDNidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdMaWdodCBQdXJwbGUnLFxuICAgICAgICB2YWx1ZTogJyNFQ0NBRkEnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnTGlnaHQgQmx1ZScsXG4gICAgICAgIHZhbHVlOiAnI0MyRTBGNCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdHcmVlbicsXG4gICAgICAgIHZhbHVlOiAnIzJEQzI2QidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdZZWxsb3cnLFxuICAgICAgICB2YWx1ZTogJyNGMUM0MEYnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnUmVkJyxcbiAgICAgICAgdmFsdWU6ICcjRTAzRTJEJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogY2hvaWNlSXRlbSxcbiAgICAgICAgdGV4dDogJ1B1cnBsZScsXG4gICAgICAgIHZhbHVlOiAnI0I5NkFEOSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdCbHVlJyxcbiAgICAgICAgdmFsdWU6ICcjMzU5OERCJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogY2hvaWNlSXRlbSxcbiAgICAgICAgdGV4dDogJ0RhcmsgVHVycXVvaXNlJyxcbiAgICAgICAgdmFsdWU6ICcjMTY5MTc5J1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogY2hvaWNlSXRlbSxcbiAgICAgICAgdGV4dDogJ09yYW5nZScsXG4gICAgICAgIHZhbHVlOiAnI0U2N0UyMydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdEYXJrIFJlZCcsXG4gICAgICAgIHZhbHVlOiAnI0JBMzcyQSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdEYXJrIFB1cnBsZScsXG4gICAgICAgIHZhbHVlOiAnIzg0M0ZBMSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdEYXJrIEJsdWUnLFxuICAgICAgICB2YWx1ZTogJyMyMzZGQTEnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnTGlnaHQgR3JheScsXG4gICAgICAgIHZhbHVlOiAnI0VDRjBGMSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdNZWRpdW0gR3JheScsXG4gICAgICAgIHZhbHVlOiAnI0NFRDREOSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdHcmF5JyxcbiAgICAgICAgdmFsdWU6ICcjOTVBNUE2J1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogY2hvaWNlSXRlbSxcbiAgICAgICAgdGV4dDogJ0RhcmsgR3JheScsXG4gICAgICAgIHZhbHVlOiAnIzdFOEM4RCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IGNob2ljZUl0ZW0sXG4gICAgICAgIHRleHQ6ICdOYXZ5IEJsdWUnLFxuICAgICAgICB2YWx1ZTogJyMzNDQ5NUUnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnQmxhY2snLFxuICAgICAgICB2YWx1ZTogJyMwMDAwMDAnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBjaG9pY2VJdGVtLFxuICAgICAgICB0ZXh0OiAnV2hpdGUnLFxuICAgICAgICB2YWx1ZTogJyNmZmZmZmYnXG4gICAgICB9XG4gICAgXTtcbiAgICB2YXIgY29sb3JDYWNoZSA9IENvbG9yQ2FjaGUoMTApO1xuICAgIHZhciBtYXBDb2xvcnMgPSBmdW5jdGlvbiAoY29sb3JNYXApIHtcbiAgICAgIHZhciBjb2xvcnMgPSBbXTtcbiAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSAxO1xuICAgICAgY2FudmFzLndpZHRoID0gMTtcbiAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIHZhciBieXRlQXNIZXggPSBmdW5jdGlvbiAoY29sb3JCeXRlLCBhbHBoYUJ5dGUpIHtcbiAgICAgICAgdmFyIGJnID0gMjU1O1xuICAgICAgICB2YXIgYWxwaGEgPSBhbHBoYUJ5dGUgLyAyNTU7XG4gICAgICAgIHZhciBjb2xvckJ5dGVXaXRoV2hpdGVCZyA9IE1hdGgucm91bmQoY29sb3JCeXRlICogYWxwaGEgKyBiZyAqICgxIC0gYWxwaGEpKTtcbiAgICAgICAgcmV0dXJuICgnMCcgKyBjb2xvckJ5dGVXaXRoV2hpdGVCZy50b1N0cmluZygxNikpLnNsaWNlKC0yKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBhc0hleENvbG9yID0gZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgICAgIGlmICgvXlswLTlBLUZhLWZdezZ9JC8udGVzdChjb2xvcikpIHtcbiAgICAgICAgICByZXR1cm4gJyMnICsgY29sb3IudG9VcHBlckNhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI0ZGRkZGRic7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpO1xuICAgICAgICB2YXIgcmdiYSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YTtcbiAgICAgICAgdmFyIHIgPSByZ2JhWzBdLCBnID0gcmdiYVsxXSwgYiA9IHJnYmFbMl0sIGEgPSByZ2JhWzNdO1xuICAgICAgICByZXR1cm4gJyMnICsgYnl0ZUFzSGV4KHIsIGEpICsgYnl0ZUFzSGV4KGcsIGEpICsgYnl0ZUFzSGV4KGIsIGEpO1xuICAgICAgfTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29sb3JNYXAubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgICAgY29sb3JzLnB1c2goe1xuICAgICAgICAgIHRleHQ6IGNvbG9yTWFwW2kgKyAxXSxcbiAgICAgICAgICB2YWx1ZTogYXNIZXhDb2xvcihjb2xvck1hcFtpXSksXG4gICAgICAgICAgdHlwZTogJ2Nob2ljZWl0ZW0nXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbG9ycztcbiAgICB9O1xuICAgIHZhciBnZXRDb2xvckNvbHMgPSBmdW5jdGlvbiAoZWRpdG9yLCBkZWZhdWx0Q29scykge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnY29sb3JfY29scycsIGRlZmF1bHRDb2xzLCAnbnVtYmVyJyk7XG4gICAgfTtcbiAgICB2YXIgaGFzQ3VzdG9tQ29sb3JzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnY3VzdG9tX2NvbG9ycycpICE9PSBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBnZXRDb2xvck1hcCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2NvbG9yX21hcCcpO1xuICAgIH07XG4gICAgdmFyIGdldENvbG9ycyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciB1bm1hcHBlZCA9IGdldENvbG9yTWFwKGVkaXRvcik7XG4gICAgICByZXR1cm4gdW5tYXBwZWQgIT09IHVuZGVmaW5lZCA/IG1hcENvbG9ycyh1bm1hcHBlZCkgOiBkZWZhdWx0Q29sb3JzO1xuICAgIH07XG4gICAgdmFyIGdldEN1cnJlbnRDb2xvcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbWFwKGNvbG9yQ2FjaGUuc3RhdGUoKSwgZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogY2hvaWNlSXRlbSxcbiAgICAgICAgICB0ZXh0OiBjb2xvcixcbiAgICAgICAgICB2YWx1ZTogY29sb3JcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFkZENvbG9yID0gZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgICBjb2xvckNhY2hlLmFkZChjb2xvcik7XG4gICAgfTtcblxuICAgIHZhciBnZXRDdXJyZW50Q29sb3IgPSBmdW5jdGlvbiAoZWRpdG9yLCBmb3JtYXQpIHtcbiAgICAgIHZhciBjb2xvcjtcbiAgICAgIGVkaXRvci5kb20uZ2V0UGFyZW50cyhlZGl0b3Iuc2VsZWN0aW9uLmdldFN0YXJ0KCksIGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgPSBlbG0uc3R5bGVbZm9ybWF0ID09PSAnZm9yZWNvbG9yJyA/ICdjb2xvcicgOiAnYmFja2dyb3VuZC1jb2xvciddKSB7XG4gICAgICAgICAgY29sb3IgPSBjb2xvciA/IGNvbG9yIDogdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbG9yO1xuICAgIH07XG4gICAgdmFyIGFwcGx5Rm9ybWF0ID0gZnVuY3Rpb24gKGVkaXRvciwgZm9ybWF0LCB2YWx1ZSkge1xuICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgIGVkaXRvci5mb3JtYXR0ZXIuYXBwbHkoZm9ybWF0LCB7IHZhbHVlOiB2YWx1ZSB9KTtcbiAgICAgICAgZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW1vdmVGb3JtYXQgPSBmdW5jdGlvbiAoZWRpdG9yLCBmb3JtYXQpIHtcbiAgICAgIGVkaXRvci51bmRvTWFuYWdlci50cmFuc2FjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICBlZGl0b3IuZm9ybWF0dGVyLnJlbW92ZShmb3JtYXQsIHsgdmFsdWU6IG51bGwgfSwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgIGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJDb21tYW5kcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VBcHBseVRleHRjb2xvcicsIGZ1bmN0aW9uIChmb3JtYXQsIHZhbHVlKSB7XG4gICAgICAgIGFwcGx5Rm9ybWF0KGVkaXRvciwgZm9ybWF0LCB2YWx1ZSk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VSZW1vdmVUZXh0Y29sb3InLCBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICAgIHJlbW92ZUZvcm1hdChlZGl0b3IsIGZvcm1hdCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjYWxjQ29scyA9IGZ1bmN0aW9uIChjb2xvcnMpIHtcbiAgICAgIHJldHVybiBNYXRoLm1heCg1LCBNYXRoLmNlaWwoTWF0aC5zcXJ0KGNvbG9ycykpKTtcbiAgICB9O1xuICAgIHZhciBnZXRDb2xvckNvbHMkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBjb2xvcnMgPSBnZXRDb2xvcnMoZWRpdG9yKTtcbiAgICAgIHZhciBkZWZhdWx0Q29scyA9IGNhbGNDb2xzKGNvbG9ycy5sZW5ndGgpO1xuICAgICAgcmV0dXJuIGdldENvbG9yQ29scyhlZGl0b3IsIGRlZmF1bHRDb2xzKTtcbiAgICB9O1xuICAgIHZhciBnZXRBZGRpdGlvbmFsQ29sb3JzID0gZnVuY3Rpb24gKGhhc0N1c3RvbSkge1xuICAgICAgdmFyIHR5cGUgPSAnY2hvaWNlaXRlbSc7XG4gICAgICB2YXIgcmVtb3ZlID0ge1xuICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICB0ZXh0OiAnUmVtb3ZlIGNvbG9yJyxcbiAgICAgICAgaWNvbjogJ2NvbG9yLXN3YXRjaC1yZW1vdmUtY29sb3InLFxuICAgICAgICB2YWx1ZTogJ3JlbW92ZSdcbiAgICAgIH07XG4gICAgICB2YXIgY3VzdG9tID0ge1xuICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICB0ZXh0OiAnQ3VzdG9tIGNvbG9yJyxcbiAgICAgICAgaWNvbjogJ2NvbG9yLXBpY2tlcicsXG4gICAgICAgIHZhbHVlOiAnY3VzdG9tJ1xuICAgICAgfTtcbiAgICAgIHJldHVybiBoYXNDdXN0b20gPyBbXG4gICAgICAgIHJlbW92ZSxcbiAgICAgICAgY3VzdG9tXG4gICAgICBdIDogW3JlbW92ZV07XG4gICAgfTtcbiAgICB2YXIgYXBwbHlDb2xvciA9IGZ1bmN0aW9uIChlZGl0b3IsIGZvcm1hdCwgdmFsdWUsIG9uQ2hvaWNlKSB7XG4gICAgICBpZiAodmFsdWUgPT09ICdjdXN0b20nKSB7XG4gICAgICAgIHZhciBkaWFsb2cgPSBjb2xvclBpY2tlckRpYWxvZyhlZGl0b3IpO1xuICAgICAgICBkaWFsb2coZnVuY3Rpb24gKGNvbG9yT3B0KSB7XG4gICAgICAgICAgY29sb3JPcHQuZWFjaChmdW5jdGlvbiAoY29sb3IpIHtcbiAgICAgICAgICAgIGFkZENvbG9yKGNvbG9yKTtcbiAgICAgICAgICAgIGVkaXRvci5leGVjQ29tbWFuZCgnbWNlQXBwbHlUZXh0Y29sb3InLCBmb3JtYXQsIGNvbG9yKTtcbiAgICAgICAgICAgIG9uQ2hvaWNlKGNvbG9yKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgJyMwMDAwMDAnKTtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICdyZW1vdmUnKSB7XG4gICAgICAgIG9uQ2hvaWNlKCcnKTtcbiAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VSZW1vdmVUZXh0Y29sb3InLCBmb3JtYXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb25DaG9pY2UodmFsdWUpO1xuICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZUFwcGx5VGV4dGNvbG9yJywgZm9ybWF0LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0Q29sb3JzJDEgPSBmdW5jdGlvbiAoY29sb3JzLCBoYXNDdXN0b20pIHtcbiAgICAgIHJldHVybiBjb2xvcnMuY29uY2F0KGdldEN1cnJlbnRDb2xvcnMoKS5jb25jYXQoZ2V0QWRkaXRpb25hbENvbG9ycyhoYXNDdXN0b20pKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RmV0Y2ggPSBmdW5jdGlvbiAoY29sb3JzLCBoYXNDdXN0b20pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2soZ2V0Q29sb3JzJDEoY29sb3JzLCBoYXNDdXN0b20pKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2V0SWNvbkNvbG9yID0gZnVuY3Rpb24gKHNwbGl0QnV0dG9uQXBpLCBuYW1lLCBuZXdDb2xvcikge1xuICAgICAgdmFyIGlkID0gbmFtZSA9PT0gJ2ZvcmVjb2xvcicgPyAndG94LWljb24tdGV4dC1jb2xvcl9fY29sb3InIDogJ3RveC1pY29uLWhpZ2hsaWdodC1iZy1jb2xvcl9fY29sb3InO1xuICAgICAgc3BsaXRCdXR0b25BcGkuc2V0SWNvbkZpbGwoaWQsIG5ld0NvbG9yKTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlclRleHRDb2xvckJ1dHRvbiA9IGZ1bmN0aW9uIChlZGl0b3IsIG5hbWUsIGZvcm1hdCwgdG9vbHRpcCwgbGFzdENvbG9yKSB7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkU3BsaXRCdXR0b24obmFtZSwge1xuICAgICAgICB0b29sdGlwOiB0b29sdGlwLFxuICAgICAgICBwcmVzZXRzOiAnY29sb3InLFxuICAgICAgICBpY29uOiBuYW1lID09PSAnZm9yZWNvbG9yJyA/ICd0ZXh0LWNvbG9yJyA6ICdoaWdobGlnaHQtYmctY29sb3InLFxuICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgIHZhciBvcHRDdXJyZW50UmdiID0gT3B0aW9uYWwuZnJvbShnZXRDdXJyZW50Q29sb3IoZWRpdG9yLCBmb3JtYXQpKTtcbiAgICAgICAgICByZXR1cm4gb3B0Q3VycmVudFJnYi5iaW5kKGZ1bmN0aW9uIChjdXJyZW50UmdiKSB7XG4gICAgICAgICAgICByZXR1cm4gZnJvbVN0cmluZyhjdXJyZW50UmdiKS5tYXAoZnVuY3Rpb24gKHJnYmEpIHtcbiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRIZXggPSBmcm9tUmdiYShyZ2JhKS52YWx1ZTtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zJDEodmFsdWUudG9Mb3dlckNhc2UoKSwgY3VycmVudEhleCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KS5nZXRPcihmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbHVtbnM6IGdldENvbG9yQ29scyQxKGVkaXRvciksXG4gICAgICAgIGZldGNoOiBnZXRGZXRjaChnZXRDb2xvcnMoZWRpdG9yKSwgaGFzQ3VzdG9tQ29sb3JzKGVkaXRvcikpLFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKF9zcGxpdEJ1dHRvbkFwaSkge1xuICAgICAgICAgIGlmIChsYXN0Q29sb3IuZ2V0KCkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGFwcGx5Q29sb3IoZWRpdG9yLCBmb3JtYXQsIGxhc3RDb2xvci5nZXQoKSwgbm9vcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvbkl0ZW1BY3Rpb246IGZ1bmN0aW9uIChfc3BsaXRCdXR0b25BcGksIHZhbHVlKSB7XG4gICAgICAgICAgYXBwbHlDb2xvcihlZGl0b3IsIGZvcm1hdCwgdmFsdWUsIGZ1bmN0aW9uIChuZXdDb2xvcikge1xuICAgICAgICAgICAgbGFzdENvbG9yLnNldChuZXdDb2xvcik7XG4gICAgICAgICAgICBmaXJlVGV4dENvbG9yQ2hhbmdlKGVkaXRvciwge1xuICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICBjb2xvcjogbmV3Q29sb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBvblNldHVwOiBmdW5jdGlvbiAoc3BsaXRCdXR0b25BcGkpIHtcbiAgICAgICAgICBpZiAobGFzdENvbG9yLmdldCgpICE9PSBudWxsKSB7XG4gICAgICAgICAgICBzZXRJY29uQ29sb3Ioc3BsaXRCdXR0b25BcGksIG5hbWUsIGxhc3RDb2xvci5nZXQoKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLm5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgc2V0SWNvbkNvbG9yKHNwbGl0QnV0dG9uQXBpLCBlLm5hbWUsIGUuY29sb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgZWRpdG9yLm9uKCdUZXh0Q29sb3JDaGFuZ2UnLCBoYW5kbGVyKTtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZWRpdG9yLm9mZignVGV4dENvbG9yQ2hhbmdlJywgaGFuZGxlcik7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJUZXh0Q29sb3JNZW51SXRlbSA9IGZ1bmN0aW9uIChlZGl0b3IsIG5hbWUsIGZvcm1hdCwgdGV4dCkge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE5lc3RlZE1lbnVJdGVtKG5hbWUsIHtcbiAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgaWNvbjogbmFtZSA9PT0gJ2ZvcmVjb2xvcicgPyAndGV4dC1jb2xvcicgOiAnaGlnaGxpZ2h0LWJnLWNvbG9yJyxcbiAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFt7XG4gICAgICAgICAgICAgIHR5cGU6ICdmYW5jeW1lbnVpdGVtJyxcbiAgICAgICAgICAgICAgZmFuY3l0eXBlOiAnY29sb3Jzd2F0Y2gnLFxuICAgICAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBhcHBseUNvbG9yKGVkaXRvciwgZm9ybWF0LCBkYXRhLnZhbHVlLCBub29wKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNvbG9yUGlja2VyRGlhbG9nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjYWxsYmFjaywgdmFsdWUpIHtcbiAgICAgICAgdmFyIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIG9uU3VibWl0ID0gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgIHZhciBkYXRhID0gYXBpLmdldERhdGEoKTtcbiAgICAgICAgICB2YXIgaGV4ID0gZGF0YS5jb2xvcnBpY2tlcjtcbiAgICAgICAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgICAgICAgY2FsbGJhY2soT3B0aW9uYWwuZnJvbShoZXgpKTtcbiAgICAgICAgICAgIGFwaS5jbG9zZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5hbGVydChlZGl0b3IudHJhbnNsYXRlKFtcbiAgICAgICAgICAgICAgJ0ludmFsaWQgaGV4IGNvbG9yIGNvZGU6IHswfScsXG4gICAgICAgICAgICAgIGhleFxuICAgICAgICAgICAgXSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG9uQWN0aW9uID0gZnVuY3Rpb24gKF9hcGksIGRldGFpbHMpIHtcbiAgICAgICAgICBpZiAoZGV0YWlscy5uYW1lID09PSAnaGV4LXZhbGlkJykge1xuICAgICAgICAgICAgaXNWYWxpZCA9IGRldGFpbHMudmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgaW5pdGlhbERhdGEgPSB7IGNvbG9ycGlja2VyOiB2YWx1ZSB9O1xuICAgICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHtcbiAgICAgICAgICB0aXRsZTogJ0NvbG9yIFBpY2tlcicsXG4gICAgICAgICAgc2l6ZTogJ25vcm1hbCcsXG4gICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgdHlwZTogJ3BhbmVsJyxcbiAgICAgICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdjb2xvcnBpY2tlcicsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2NvbG9ycGlja2VyJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0NvbG9yJ1xuICAgICAgICAgICAgICB9XVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAnY2FuY2VsJyxcbiAgICAgICAgICAgICAgbmFtZTogJ2NhbmNlbCcsXG4gICAgICAgICAgICAgIHRleHQ6ICdDYW5jZWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAnc3VibWl0JyxcbiAgICAgICAgICAgICAgbmFtZTogJ3NhdmUnLFxuICAgICAgICAgICAgICB0ZXh0OiAnU2F2ZScsXG4gICAgICAgICAgICAgIHByaW1hcnk6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIGluaXRpYWxEYXRhOiBpbml0aWFsRGF0YSxcbiAgICAgICAgICBvbkFjdGlvbjogb25BY3Rpb24sXG4gICAgICAgICAgb25TdWJtaXQ6IG9uU3VibWl0LFxuICAgICAgICAgIG9uQ2xvc2U6IG5vb3AsXG4gICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXIkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJlZ2lzdGVyQ29tbWFuZHMoZWRpdG9yKTtcbiAgICAgIHZhciBsYXN0Rm9yZUNvbG9yID0gQ2VsbChudWxsKTtcbiAgICAgIHZhciBsYXN0QmFja0NvbG9yID0gQ2VsbChudWxsKTtcbiAgICAgIHJlZ2lzdGVyVGV4dENvbG9yQnV0dG9uKGVkaXRvciwgJ2ZvcmVjb2xvcicsICdmb3JlY29sb3InLCAnVGV4dCBjb2xvcicsIGxhc3RGb3JlQ29sb3IpO1xuICAgICAgcmVnaXN0ZXJUZXh0Q29sb3JCdXR0b24oZWRpdG9yLCAnYmFja2NvbG9yJywgJ2hpbGl0ZWNvbG9yJywgJ0JhY2tncm91bmQgY29sb3InLCBsYXN0QmFja0NvbG9yKTtcbiAgICAgIHJlZ2lzdGVyVGV4dENvbG9yTWVudUl0ZW0oZWRpdG9yLCAnZm9yZWNvbG9yJywgJ2ZvcmVjb2xvcicsICdUZXh0IGNvbG9yJyk7XG4gICAgICByZWdpc3RlclRleHRDb2xvck1lbnVJdGVtKGVkaXRvciwgJ2JhY2tjb2xvcicsICdoaWxpdGVjb2xvcicsICdCYWNrZ3JvdW5kIGNvbG9yJyk7XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGVQYXJ0aWFsQ2hvaWNlTWVudSA9IGZ1bmN0aW9uICh2YWx1ZSwgaXRlbXMsIG9uSXRlbVZhbHVlSGFuZGxlciwgY29sdW1ucywgcHJlc2V0cywgaXRlbVJlc3BvbnNlLCBzZWxlY3QsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgdmFyIGhhc0ljb25zID0gbWVudUhhc0ljb25zKGl0ZW1zKTtcbiAgICAgIHZhciBwcmVzZXRJdGVtVHlwZXMgPSBwcmVzZXRzICE9PSAnY29sb3InID8gJ25vcm1hbCcgOiAnY29sb3InO1xuICAgICAgdmFyIGFsbG95SXRlbXMgPSBjcmVhdGVDaG9pY2VJdGVtcyhpdGVtcywgb25JdGVtVmFsdWVIYW5kbGVyLCBjb2x1bW5zLCBwcmVzZXRJdGVtVHlwZXMsIGl0ZW1SZXNwb25zZSwgc2VsZWN0LCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgcmV0dXJuIGNyZWF0ZVBhcnRpYWxNZW51V2l0aEFsbG95SXRlbXModmFsdWUsIGhhc0ljb25zLCBhbGxveUl0ZW1zLCBjb2x1bW5zLCBwcmVzZXRzKTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVDaG9pY2VJdGVtcyA9IGZ1bmN0aW9uIChpdGVtcywgb25JdGVtVmFsdWVIYW5kbGVyLCBjb2x1bW5zLCBpdGVtUHJlc2V0cywgaXRlbVJlc3BvbnNlLCBzZWxlY3QsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIGNhdChtYXAoaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICdjaG9pY2VpdGVtJykge1xuICAgICAgICAgIHJldHVybiBjcmVhdGVDaG9pY2VNZW51SXRlbShpdGVtKS5mb2xkKGhhbmRsZUVycm9yLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUocmVuZGVyQ2hvaWNlSXRlbShkLCBjb2x1bW5zID09PSAxLCBpdGVtUHJlc2V0cywgb25JdGVtVmFsdWVIYW5kbGVyLCBzZWxlY3QoaXRlbS52YWx1ZSksIGl0ZW1SZXNwb25zZSwgcHJvdmlkZXJzQmFja3N0YWdlLCBtZW51SGFzSWNvbnMoaXRlbXMpKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgIH07XG5cbiAgICB2YXIgZGVyaXZlTWVudU1vdmVtZW50ID0gZnVuY3Rpb24gKGNvbHVtbnMsIHByZXNldHMpIHtcbiAgICAgIHZhciBtZW51TWFya2VycyA9IG1hcmtlcnMkMShwcmVzZXRzKTtcbiAgICAgIGlmIChjb2x1bW5zID09PSAxKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kZTogJ21lbnUnLFxuICAgICAgICAgIG1vdmVPblRhYjogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmIChjb2x1bW5zID09PSAnYXV0bycpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RlOiAnZ3JpZCcsXG4gICAgICAgICAgc2VsZWN0b3I6ICcuJyArIG1lbnVNYXJrZXJzLml0ZW0sXG4gICAgICAgICAgaW5pdFNpemU6IHtcbiAgICAgICAgICAgIG51bUNvbHVtbnM6IDEsXG4gICAgICAgICAgICBudW1Sb3dzOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHJvd0NsYXNzID0gcHJlc2V0cyA9PT0gJ2NvbG9yJyA/ICd0b3gtc3dhdGNoZXNfX3JvdycgOiAndG94LWNvbGxlY3Rpb25fX2dyb3VwJztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RlOiAnbWF0cml4JyxcbiAgICAgICAgICByb3dTZWxlY3RvcjogJy4nICsgcm93Q2xhc3NcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBkZXJpdmVDb2xsZWN0aW9uTW92ZW1lbnQgPSBmdW5jdGlvbiAoY29sdW1ucywgcHJlc2V0cykge1xuICAgICAgaWYgKGNvbHVtbnMgPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtb2RlOiAnbWVudScsXG4gICAgICAgICAgbW92ZU9uVGFiOiBmYWxzZSxcbiAgICAgICAgICBzZWxlY3RvcjogJy50b3gtY29sbGVjdGlvbl9faXRlbSdcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAoY29sdW1ucyA9PT0gJ2F1dG8nKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kZTogJ2ZsYXRncmlkJyxcbiAgICAgICAgICBzZWxlY3RvcjogJy4nICsgJ3RveC1jb2xsZWN0aW9uX19pdGVtJyxcbiAgICAgICAgICBpbml0U2l6ZToge1xuICAgICAgICAgICAgbnVtQ29sdW1uczogMSxcbiAgICAgICAgICAgIG51bVJvd3M6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1vZGU6ICdtYXRyaXgnLFxuICAgICAgICAgIHNlbGVjdG9yczoge1xuICAgICAgICAgICAgcm93OiBwcmVzZXRzID09PSAnY29sb3InID8gJy50b3gtc3dhdGNoZXNfX3JvdycgOiAnLnRveC1jb2xsZWN0aW9uX19ncm91cCcsXG4gICAgICAgICAgICBjZWxsOiBwcmVzZXRzID09PSAnY29sb3InID8gJy4nICsgY29sb3JDbGFzcyA6ICcuJyArIHNlbGVjdGFibGVDbGFzc1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlckNvbG9yU3dhdGNoSXRlbSA9IGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBpdGVtcyA9IGdldENvbG9ycyQxKGJhY2tzdGFnZS5jb2xvcmlucHV0LmdldENvbG9ycygpLCBiYWNrc3RhZ2UuY29sb3JpbnB1dC5oYXNDdXN0b21Db2xvcnMoKSk7XG4gICAgICB2YXIgY29sdW1ucyA9IGJhY2tzdGFnZS5jb2xvcmlucHV0LmdldENvbG9yQ29scygpO1xuICAgICAgdmFyIHByZXNldHMgPSAnY29sb3InO1xuICAgICAgdmFyIG1lbnVTcGVjID0gY3JlYXRlUGFydGlhbENob2ljZU1lbnUoZ2VuZXJhdGUkMSgnbWVudS12YWx1ZScpLCBpdGVtcywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHNwZWMub25BY3Rpb24oeyB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICB9LCBjb2x1bW5zLCBwcmVzZXRzLCBJdGVtUmVzcG9uc2UkMS5DTE9TRV9PTl9FWEVDVVRFLCBuZXZlciwgYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMpO1xuICAgICAgdmFyIHdpZGdldFNwZWMgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgbWVudVNwZWMpLCB7XG4gICAgICAgIG1hcmtlcnM6IG1hcmtlcnMkMShwcmVzZXRzKSxcbiAgICAgICAgbW92ZW1lbnQ6IGRlcml2ZU1lbnVNb3ZlbWVudChjb2x1bW5zLCBwcmVzZXRzKVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAnd2lkZ2V0JyxcbiAgICAgICAgZGF0YTogeyB2YWx1ZTogZ2VuZXJhdGUkMSgnd2lkZ2V0LWlkJykgfSxcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mYW5jeW1lbnVpdGVtJ11cbiAgICAgICAgfSxcbiAgICAgICAgYXV0b2ZvY3VzOiB0cnVlLFxuICAgICAgICBjb21wb25lbnRzOiBbcGFydHMkMi53aWRnZXQoTWVudS5za2V0Y2god2lkZ2V0U3BlYykpXVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGNlbGxPdmVyRXZlbnQgPSBnZW5lcmF0ZSQxKCdjZWxsLW92ZXInKTtcbiAgICB2YXIgY2VsbEV4ZWN1dGVFdmVudCA9IGdlbmVyYXRlJDEoJ2NlbGwtZXhlY3V0ZScpO1xuICAgIHZhciBtYWtlQ2VsbCA9IGZ1bmN0aW9uIChyb3csIGNvbCwgbGFiZWxJZCkge1xuICAgICAgdmFyIF9hO1xuICAgICAgdmFyIGVtaXRDZWxsT3ZlciA9IGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHJldHVybiBlbWl0V2l0aChjLCBjZWxsT3ZlckV2ZW50LCB7XG4gICAgICAgICAgcm93OiByb3csXG4gICAgICAgICAgY29sOiBjb2xcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGVtaXRFeGVjdXRlID0gZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgcmV0dXJuIGVtaXRXaXRoKGMsIGNlbGxFeGVjdXRlRXZlbnQsIHtcbiAgICAgICAgICByb3c6IHJvdyxcbiAgICAgICAgICBjb2w6IGNvbFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgb25DbGljayA9IGZ1bmN0aW9uIChjLCBzZSkge1xuICAgICAgICBzZS5zdG9wKCk7XG4gICAgICAgIGVtaXRFeGVjdXRlKGMpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBidWlsZCQxKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiAoX2EgPSB7IHJvbGU6ICdidXR0b24nIH0sIF9hWydhcmlhLWxhYmVsbGVkYnknXSA9IGxhYmVsSWQsIF9hKVxuICAgICAgICB9LFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgY29uZmlnKCdpbnNlcnQtdGFibGUtcGlja2VyLWNlbGwnLCBbXG4gICAgICAgICAgICBydW4obW91c2VvdmVyKCksIEZvY3VzaW5nLmZvY3VzKSxcbiAgICAgICAgICAgIHJ1bihleGVjdXRlKCksIGVtaXRFeGVjdXRlKSxcbiAgICAgICAgICAgIHJ1bihjbGljaygpLCBvbkNsaWNrKSxcbiAgICAgICAgICAgIHJ1bih0YXAoKSwgb25DbGljaylcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBUb2dnbGluZy5jb25maWcoe1xuICAgICAgICAgICAgdG9nZ2xlQ2xhc3M6ICd0b3gtaW5zZXJ0LXRhYmxlLXBpY2tlcl9fc2VsZWN0ZWQnLFxuICAgICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiBmYWxzZVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7IG9uRm9jdXM6IGVtaXRDZWxsT3ZlciB9KVxuICAgICAgICBdKVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWFrZUNlbGxzID0gZnVuY3Rpb24gKGxhYmVsSWQsIG51bVJvd3MsIG51bUNvbHMpIHtcbiAgICAgIHZhciBjZWxscyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Sb3dzOyBpKyspIHtcbiAgICAgICAgdmFyIHJvdyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG51bUNvbHM7IGorKykge1xuICAgICAgICAgIHJvdy5wdXNoKG1ha2VDZWxsKGksIGosIGxhYmVsSWQpKTtcbiAgICAgICAgfVxuICAgICAgICBjZWxscy5wdXNoKHJvdyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2VsbHM7XG4gICAgfTtcbiAgICB2YXIgc2VsZWN0Q2VsbHMgPSBmdW5jdGlvbiAoY2VsbHMsIHNlbGVjdGVkUm93LCBzZWxlY3RlZENvbHVtbiwgbnVtUm93cywgbnVtQ29sdW1ucykge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Sb3dzOyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1Db2x1bW5zOyBqKyspIHtcbiAgICAgICAgICBUb2dnbGluZy5zZXQoY2VsbHNbaV1bal0sIGkgPD0gc2VsZWN0ZWRSb3cgJiYgaiA8PSBzZWxlY3RlZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBtYWtlQ29tcG9uZW50cyA9IGZ1bmN0aW9uIChjZWxscykge1xuICAgICAgcmV0dXJuIGJpbmQoY2VsbHMsIGZ1bmN0aW9uIChjZWxsUm93KSB7XG4gICAgICAgIHJldHVybiBtYXAoY2VsbFJvdywgcHJlbWFkZSQxKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1ha2VMYWJlbFRleHQgPSBmdW5jdGlvbiAocm93LCBjb2wpIHtcbiAgICAgIHJldHVybiB0ZXh0KGNvbCArIDEgKyAneCcgKyAocm93ICsgMSkpO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckluc2VydFRhYmxlTWVudUl0ZW0gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIG51bVJvd3MgPSAxMDtcbiAgICAgIHZhciBudW1Db2x1bW5zID0gMTA7XG4gICAgICB2YXIgc2l6ZUxhYmVsSWQgPSBnZW5lcmF0ZSQxKCdzaXplLWxhYmVsJyk7XG4gICAgICB2YXIgY2VsbHMgPSBtYWtlQ2VsbHMoc2l6ZUxhYmVsSWQsIG51bVJvd3MsIG51bUNvbHVtbnMpO1xuICAgICAgdmFyIG1lbUxhYmVsID0gcmVjb3JkKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtaW5zZXJ0LXRhYmxlLXBpY2tlcl9fbGFiZWwnXSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7IGlkOiBzaXplTGFiZWxJZCB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFt0ZXh0KCcweDAnKV0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtSZXBsYWNpbmcuY29uZmlnKHt9KV0pXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICd3aWRnZXQnLFxuICAgICAgICBkYXRhOiB7IHZhbHVlOiBnZW5lcmF0ZSQxKCd3aWRnZXQtaWQnKSB9LFxuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWZhbmN5bWVudWl0ZW0nXVxuICAgICAgICB9LFxuICAgICAgICBhdXRvZm9jdXM6IHRydWUsXG4gICAgICAgIGNvbXBvbmVudHM6IFtwYXJ0cyQyLndpZGdldCh7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtaW5zZXJ0LXRhYmxlLXBpY2tlciddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcG9uZW50czogbWFrZUNvbXBvbmVudHMoY2VsbHMpLmNvbmNhdChtZW1MYWJlbC5hc1NwZWMoKSksXG4gICAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICAgIGNvbmZpZygnaW5zZXJ0LXRhYmxlLXBpY2tlcicsIFtcbiAgICAgICAgICAgICAgICBydW5XaXRoVGFyZ2V0KGNlbGxPdmVyRXZlbnQsIGZ1bmN0aW9uIChjLCB0LCBlKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgcm93ID0gZS5ldmVudC5yb3c7XG4gICAgICAgICAgICAgICAgICB2YXIgY29sID0gZS5ldmVudC5jb2w7XG4gICAgICAgICAgICAgICAgICBzZWxlY3RDZWxscyhjZWxscywgcm93LCBjb2wsIG51bVJvd3MsIG51bUNvbHVtbnMpO1xuICAgICAgICAgICAgICAgICAgUmVwbGFjaW5nLnNldChtZW1MYWJlbC5nZXQoYyksIFttYWtlTGFiZWxUZXh0KHJvdywgY29sKV0pO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHJ1bldpdGhUYXJnZXQoY2VsbEV4ZWN1dGVFdmVudCwgZnVuY3Rpb24gKGMsIF8sIGUpIHtcbiAgICAgICAgICAgICAgICAgIHNwZWMub25BY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICBudW1Sb3dzOiBlLmV2ZW50LnJvdyArIDEsXG4gICAgICAgICAgICAgICAgICAgIG51bUNvbHVtbnM6IGUuZXZlbnQuY29sICsgMVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBlbWl0KGMsIHNhbmRib3hDbG9zZSgpKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICAgICAgaW5pdFNpemU6IHtcbiAgICAgICAgICAgICAgICAgIG51bVJvd3M6IG51bVJvd3MsXG4gICAgICAgICAgICAgICAgICBudW1Db2x1bW5zOiBudW1Db2x1bW5zXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBtb2RlOiAnZmxhdGdyaWQnLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnW3JvbGU9XCJidXR0b25cIl0nXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIH0pXVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGZhbmN5TWVudUl0ZW1zID0ge1xuICAgICAgaW5zZXJ0dGFibGU6IHJlbmRlckluc2VydFRhYmxlTWVudUl0ZW0sXG4gICAgICBjb2xvcnN3YXRjaDogcmVuZGVyQ29sb3JTd2F0Y2hJdGVtXG4gICAgfTtcbiAgICB2YXIgdmFsdWVPcHQgPSBmdW5jdGlvbiAob2JqLCBrZXkpIHtcbiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpID8gT3B0aW9uYWwuc29tZShvYmpba2V5XSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRmFuY3lNZW51SXRlbSA9IGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiB2YWx1ZU9wdChmYW5jeU1lbnVJdGVtcywgc3BlYy5mYW5jeXR5cGUpLm1hcChmdW5jdGlvbiAocmVuZGVyKSB7XG4gICAgICAgIHJldHVybiByZW5kZXIoc3BlYywgYmFja3N0YWdlKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyTmVzdGVkSXRlbSA9IGZ1bmN0aW9uIChzcGVjLCBpdGVtUmVzcG9uc2UsIHByb3ZpZGVyc0JhY2tzdGFnZSwgcmVuZGVySWNvbnMsIGRvd253YXJkc0NhcmV0KSB7XG4gICAgICBpZiAocmVuZGVySWNvbnMgPT09IHZvaWQgMCkge1xuICAgICAgICByZW5kZXJJY29ucyA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoZG93bndhcmRzQ2FyZXQgPT09IHZvaWQgMCkge1xuICAgICAgICBkb3dud2FyZHNDYXJldCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIGNhcmV0ID0gZG93bndhcmRzQ2FyZXQgPyByZW5kZXJEb3dud2FyZHNDYXJldChwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpIDogcmVuZGVyU3VibWVudUNhcmV0KHByb3ZpZGVyc0JhY2tzdGFnZS5pY29ucyk7XG4gICAgICB2YXIgZ2V0QXBpID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuaXNEaXNhYmxlZChjb21wb25lbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0RGlzYWJsZWQ6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIERpc2FibGluZy5zZXQoY29tcG9uZW50LCBzdGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBzdHJ1Y3R1cmUgPSByZW5kZXJJdGVtU3RydWN0dXJlKHtcbiAgICAgICAgcHJlc2V0czogJ25vcm1hbCcsXG4gICAgICAgIGljb25Db250ZW50OiBzcGVjLmljb24sXG4gICAgICAgIHRleHRDb250ZW50OiBzcGVjLnRleHQsXG4gICAgICAgIGh0bWxDb250ZW50OiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGFyaWFMYWJlbDogc3BlYy50ZXh0LFxuICAgICAgICBjYXJldDogT3B0aW9uYWwuc29tZShjYXJldCksXG4gICAgICAgIGNoZWNrTWFyazogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBzaG9ydGN1dENvbnRlbnQ6IHNwZWMuc2hvcnRjdXRcbiAgICAgIH0sIHByb3ZpZGVyc0JhY2tzdGFnZSwgcmVuZGVySWNvbnMpO1xuICAgICAgcmV0dXJuIHJlbmRlckNvbW1vbkl0ZW0oe1xuICAgICAgICBkYXRhOiBidWlsZERhdGEoc3BlYyksXG4gICAgICAgIGdldEFwaTogZ2V0QXBpLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgb25BY3Rpb246IG5vb3AsXG4gICAgICAgIG9uU2V0dXA6IHNwZWMub25TZXR1cCxcbiAgICAgICAgdHJpZ2dlcnNTdWJtZW51OiB0cnVlLFxuICAgICAgICBpdGVtQmVoYXZpb3VyczogW11cbiAgICAgIH0sIHN0cnVjdHVyZSwgaXRlbVJlc3BvbnNlLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyTm9ybWFsSXRlbSA9IGZ1bmN0aW9uIChzcGVjLCBpdGVtUmVzcG9uc2UsIHByb3ZpZGVyc0JhY2tzdGFnZSwgcmVuZGVySWNvbnMpIHtcbiAgICAgIGlmIChyZW5kZXJJY29ucyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlbmRlckljb25zID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHZhciBnZXRBcGkgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIERpc2FibGluZy5pc0Rpc2FibGVkKGNvbXBvbmVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gRGlzYWJsaW5nLnNldChjb21wb25lbnQsIHN0YXRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIHN0cnVjdHVyZSA9IHJlbmRlckl0ZW1TdHJ1Y3R1cmUoe1xuICAgICAgICBwcmVzZXRzOiAnbm9ybWFsJyxcbiAgICAgICAgaWNvbkNvbnRlbnQ6IHNwZWMuaWNvbixcbiAgICAgICAgdGV4dENvbnRlbnQ6IHNwZWMudGV4dCxcbiAgICAgICAgaHRtbENvbnRlbnQ6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgYXJpYUxhYmVsOiBzcGVjLnRleHQsXG4gICAgICAgIGNhcmV0OiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGNoZWNrTWFyazogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBzaG9ydGN1dENvbnRlbnQ6IHNwZWMuc2hvcnRjdXRcbiAgICAgIH0sIHByb3ZpZGVyc0JhY2tzdGFnZSwgcmVuZGVySWNvbnMpO1xuICAgICAgcmV0dXJuIHJlbmRlckNvbW1vbkl0ZW0oe1xuICAgICAgICBkYXRhOiBidWlsZERhdGEoc3BlYyksXG4gICAgICAgIGdldEFwaTogZ2V0QXBpLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgb25BY3Rpb246IHNwZWMub25BY3Rpb24sXG4gICAgICAgIG9uU2V0dXA6IHNwZWMub25TZXR1cCxcbiAgICAgICAgdHJpZ2dlcnNTdWJtZW51OiBmYWxzZSxcbiAgICAgICAgaXRlbUJlaGF2aW91cnM6IFtdXG4gICAgICB9LCBzdHJ1Y3R1cmUsIGl0ZW1SZXNwb25zZSwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlclNlcGFyYXRvckl0ZW0gPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIGlubmVySHRtbCA9IHNwZWMudGV4dC5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgfSwgZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHsgaW5uZXJIdG1sOiB0ZXh0IH07XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdzZXBhcmF0b3InLFxuICAgICAgICBkb206IF9fYXNzaWduKHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgIHNlbGVjdGFibGVDbGFzcyxcbiAgICAgICAgICAgIGdyb3VwSGVhZGluZ0NsYXNzXG4gICAgICAgICAgXVxuICAgICAgICB9LCBpbm5lckh0bWwpLFxuICAgICAgICBjb21wb25lbnRzOiBbXVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlclRvZ2dsZU1lbnVJdGVtID0gZnVuY3Rpb24gKHNwZWMsIGl0ZW1SZXNwb25zZSwgcHJvdmlkZXJzQmFja3N0YWdlLCByZW5kZXJJY29ucykge1xuICAgICAgaWYgKHJlbmRlckljb25zID09PSB2b2lkIDApIHtcbiAgICAgICAgcmVuZGVySWNvbnMgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdmFyIGdldEFwaSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgVG9nZ2xpbmcuc2V0KGNvbXBvbmVudCwgc3RhdGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaXNBY3RpdmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBUb2dnbGluZy5pc09uKGNvbXBvbmVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gRGlzYWJsaW5nLmlzRGlzYWJsZWQoY29tcG9uZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldERpc2FibGVkOiBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuc2V0KGNvbXBvbmVudCwgc3RhdGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgc3RydWN0dXJlID0gcmVuZGVySXRlbVN0cnVjdHVyZSh7XG4gICAgICAgIGljb25Db250ZW50OiBzcGVjLmljb24sXG4gICAgICAgIHRleHRDb250ZW50OiBzcGVjLnRleHQsXG4gICAgICAgIGh0bWxDb250ZW50OiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGFyaWFMYWJlbDogc3BlYy50ZXh0LFxuICAgICAgICBjaGVja01hcms6IE9wdGlvbmFsLnNvbWUocmVuZGVyQ2hlY2ttYXJrKHByb3ZpZGVyc0JhY2tzdGFnZS5pY29ucykpLFxuICAgICAgICBjYXJldDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBzaG9ydGN1dENvbnRlbnQ6IHNwZWMuc2hvcnRjdXQsXG4gICAgICAgIHByZXNldHM6ICdub3JtYWwnLFxuICAgICAgICBtZXRhOiBzcGVjLm1ldGFcbiAgICAgIH0sIHByb3ZpZGVyc0JhY2tzdGFnZSwgcmVuZGVySWNvbnMpO1xuICAgICAgcmV0dXJuIGRlZXBNZXJnZShyZW5kZXJDb21tb25JdGVtKHtcbiAgICAgICAgZGF0YTogYnVpbGREYXRhKHNwZWMpLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgZ2V0QXBpOiBnZXRBcGksXG4gICAgICAgIG9uQWN0aW9uOiBzcGVjLm9uQWN0aW9uLFxuICAgICAgICBvblNldHVwOiBzcGVjLm9uU2V0dXAsXG4gICAgICAgIHRyaWdnZXJzU3VibWVudTogZmFsc2UsXG4gICAgICAgIGl0ZW1CZWhhdmlvdXJzOiBbXVxuICAgICAgfSwgc3RydWN0dXJlLCBpdGVtUmVzcG9uc2UsIHByb3ZpZGVyc0JhY2tzdGFnZSksIHtcbiAgICAgICAgdG9nZ2xpbmc6IHtcbiAgICAgICAgICB0b2dnbGVDbGFzczogdGlja2VkQ2xhc3MsXG4gICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiBmYWxzZSxcbiAgICAgICAgICBzZWxlY3RlZDogc3BlYy5hY3RpdmVcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBhdXRvY29tcGxldGUgPSByZW5kZXJBdXRvY29tcGxldGVJdGVtO1xuICAgIHZhciBzZXBhcmF0b3IgPSByZW5kZXJTZXBhcmF0b3JJdGVtO1xuICAgIHZhciBub3JtYWwgPSByZW5kZXJOb3JtYWxJdGVtO1xuICAgIHZhciBuZXN0ZWQgPSByZW5kZXJOZXN0ZWRJdGVtO1xuICAgIHZhciB0b2dnbGUkMSA9IHJlbmRlclRvZ2dsZU1lbnVJdGVtO1xuICAgIHZhciBmYW5jeSA9IHJlbmRlckZhbmN5TWVudUl0ZW07XG4gICAgdmFyIGNhcmQgPSByZW5kZXJDYXJkTWVudUl0ZW07XG5cbiAgICB2YXIgRm9jdXNNb2RlO1xuICAgIChmdW5jdGlvbiAoRm9jdXNNb2RlKSB7XG4gICAgICBGb2N1c01vZGVbRm9jdXNNb2RlWydDb250ZW50Rm9jdXMnXSA9IDBdID0gJ0NvbnRlbnRGb2N1cyc7XG4gICAgICBGb2N1c01vZGVbRm9jdXNNb2RlWydVaUZvY3VzJ10gPSAxXSA9ICdVaUZvY3VzJztcbiAgICB9KEZvY3VzTW9kZSB8fCAoRm9jdXNNb2RlID0ge30pKSk7XG4gICAgdmFyIGNyZWF0ZU1lbnVJdGVtRnJvbUJyaWRnZSA9IGZ1bmN0aW9uIChpdGVtLCBpdGVtUmVzcG9uc2UsIGJhY2tzdGFnZSwgbWVudUhhc0ljb25zLCBpc0hvcml6b250YWxNZW51KSB7XG4gICAgICB2YXIgcHJvdmlkZXJzQmFja3N0YWdlID0gYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnM7XG4gICAgICB2YXIgcGFyc2VGb3JIb3Jpem9udGFsTWVudSA9IGZ1bmN0aW9uIChtZW51aXRlbSkge1xuICAgICAgICByZXR1cm4gIWlzSG9yaXpvbnRhbE1lbnUgPyBtZW51aXRlbSA6IF9fYXNzaWduKF9fYXNzaWduKHt9LCBtZW51aXRlbSksIHtcbiAgICAgICAgICBzaG9ydGN1dDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgIGljb246IG1lbnVpdGVtLnRleHQuaXNTb21lKCkgPyBPcHRpb25hbC5ub25lKCkgOiBtZW51aXRlbS5pY29uXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHN3aXRjaCAoaXRlbS50eXBlKSB7XG4gICAgICBjYXNlICdtZW51aXRlbSc6XG4gICAgICAgIHJldHVybiBjcmVhdGVNZW51SXRlbShpdGVtKS5mb2xkKGhhbmRsZUVycm9yLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKG5vcm1hbChwYXJzZUZvckhvcml6b250YWxNZW51KGQpLCBpdGVtUmVzcG9uc2UsIHByb3ZpZGVyc0JhY2tzdGFnZSwgbWVudUhhc0ljb25zKSk7XG4gICAgICAgIH0pO1xuICAgICAgY2FzZSAnbmVzdGVkbWVudWl0ZW0nOlxuICAgICAgICByZXR1cm4gY3JlYXRlTmVzdGVkTWVudUl0ZW0oaXRlbSkuZm9sZChoYW5kbGVFcnJvciwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShuZXN0ZWQocGFyc2VGb3JIb3Jpem9udGFsTWVudShkKSwgaXRlbVJlc3BvbnNlLCBwcm92aWRlcnNCYWNrc3RhZ2UsIG1lbnVIYXNJY29ucywgaXNIb3Jpem9udGFsTWVudSkpO1xuICAgICAgICB9KTtcbiAgICAgIGNhc2UgJ3RvZ2dsZW1lbnVpdGVtJzpcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVRvZ2dsZU1lbnVJdGVtKGl0ZW0pLmZvbGQoaGFuZGxlRXJyb3IsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodG9nZ2xlJDEocGFyc2VGb3JIb3Jpem9udGFsTWVudShkKSwgaXRlbVJlc3BvbnNlLCBwcm92aWRlcnNCYWNrc3RhZ2UsIG1lbnVIYXNJY29ucykpO1xuICAgICAgICB9KTtcbiAgICAgIGNhc2UgJ3NlcGFyYXRvcic6XG4gICAgICAgIHJldHVybiBjcmVhdGVTZXBhcmF0b3JNZW51SXRlbShpdGVtKS5mb2xkKGhhbmRsZUVycm9yLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHNlcGFyYXRvcihkKSk7XG4gICAgICAgIH0pO1xuICAgICAgY2FzZSAnZmFuY3ltZW51aXRlbSc6XG4gICAgICAgIHJldHVybiBjcmVhdGVGYW5jeU1lbnVJdGVtKGl0ZW0pLmZvbGQoaGFuZGxlRXJyb3IsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbmN5KHBhcnNlRm9ySG9yaXpvbnRhbE1lbnUoZCksIGJhY2tzdGFnZSk7XG4gICAgICAgIH0pO1xuICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vua25vd24gaXRlbSBpbiBnZW5lcmFsIG1lbnUnLCBpdGVtKTtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlQXV0b2NvbXBsZXRlSXRlbXMgPSBmdW5jdGlvbiAoaXRlbXMsIG1hdGNoVGV4dCwgb25JdGVtVmFsdWVIYW5kbGVyLCBjb2x1bW5zLCBpdGVtUmVzcG9uc2UsIHNoYXJlZEJhY2tzdGFnZSwgaGlnaGxpZ2h0T24pIHtcbiAgICAgIHZhciByZW5kZXJUZXh0ID0gY29sdW1ucyA9PT0gMTtcbiAgICAgIHZhciByZW5kZXJJY29ucyA9ICFyZW5kZXJUZXh0IHx8IG1lbnVIYXNJY29ucyhpdGVtcyk7XG4gICAgICByZXR1cm4gY2F0KG1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgc3dpdGNoIChpdGVtLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnc2VwYXJhdG9yJzpcbiAgICAgICAgICByZXR1cm4gY3JlYXRlU2VwYXJhdG9ySXRlbShpdGVtKS5mb2xkKGhhbmRsZUVycm9yLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoc2VwYXJhdG9yKGQpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgY2FzZSAnY2FyZG1lbnVpdGVtJzpcbiAgICAgICAgICByZXR1cm4gY3JlYXRlQ2FyZE1lbnVJdGVtKGl0ZW0pLmZvbGQoaGFuZGxlRXJyb3IsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShjYXJkKF9fYXNzaWduKF9fYXNzaWduKHt9LCBkKSwge1xuICAgICAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgICAgICAgIGQub25BY3Rpb24oYXBpKTtcbiAgICAgICAgICAgICAgICBvbkl0ZW1WYWx1ZUhhbmRsZXIoZC52YWx1ZSwgZC5tZXRhKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSksIGl0ZW1SZXNwb25zZSwgc2hhcmVkQmFja3N0YWdlLCB7XG4gICAgICAgICAgICAgIGl0ZW1CZWhhdmlvdXJzOiB0b29sdGlwQmVoYXZpb3VyKGQubWV0YSwgc2hhcmVkQmFja3N0YWdlKSxcbiAgICAgICAgICAgICAgY2FyZFRleHQ6IHtcbiAgICAgICAgICAgICAgICBtYXRjaFRleHQ6IG1hdGNoVGV4dCxcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRPbjogaGlnaGxpZ2h0T25cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICBjYXNlICdhdXRvY29tcGxldGVpdGVtJzpcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gY3JlYXRlQXV0b2NvbXBsZXRlckl0ZW0oaXRlbSkuZm9sZChoYW5kbGVFcnJvciwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGF1dG9jb21wbGV0ZShkLCBtYXRjaFRleHQsIHJlbmRlclRleHQsICdub3JtYWwnLCBvbkl0ZW1WYWx1ZUhhbmRsZXIsIGl0ZW1SZXNwb25zZSwgc2hhcmVkQmFja3N0YWdlLCByZW5kZXJJY29ucykpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlUGFydGlhbE1lbnUgPSBmdW5jdGlvbiAodmFsdWUsIGl0ZW1zLCBpdGVtUmVzcG9uc2UsIGJhY2tzdGFnZSwgaXNIb3Jpem9udGFsTWVudSkge1xuICAgICAgdmFyIGhhc0ljb25zID0gbWVudUhhc0ljb25zKGl0ZW1zKTtcbiAgICAgIHZhciBhbGxveUl0ZW1zID0gY2F0KG1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdmFyIGl0ZW1IYXNJY29uID0gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICByZXR1cm4gaXNIb3Jpem9udGFsTWVudSA/ICFpLmhhc093blByb3BlcnR5KCd0ZXh0JykgOiBoYXNJY29ucztcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGNyZWF0ZUl0ZW0gPSBmdW5jdGlvbiAoaSkge1xuICAgICAgICAgIHJldHVybiBjcmVhdGVNZW51SXRlbUZyb21CcmlkZ2UoaSwgaXRlbVJlc3BvbnNlLCBiYWNrc3RhZ2UsIGl0ZW1IYXNJY29uKGkpLCBpc0hvcml6b250YWxNZW51KTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ25lc3RlZG1lbnVpdGVtJyAmJiBpdGVtLmdldFN1Ym1lbnVJdGVtcygpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGNyZWF0ZUl0ZW0oX19hc3NpZ24oX19hc3NpZ24oe30sIGl0ZW0pLCB7IGRpc2FibGVkOiB0cnVlIH0pKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gY3JlYXRlSXRlbShpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgICAgdmFyIGNyZWF0ZVBhcnRpYWwgPSBpc0hvcml6b250YWxNZW51ID8gY3JlYXRlSG9yaXpvbnRhbFBhcnRpYWxNZW51V2l0aEFsbG95SXRlbXMgOiBjcmVhdGVQYXJ0aWFsTWVudVdpdGhBbGxveUl0ZW1zO1xuICAgICAgcmV0dXJuIGNyZWF0ZVBhcnRpYWwodmFsdWUsIGhhc0ljb25zLCBhbGxveUl0ZW1zLCAxLCAnbm9ybWFsJyk7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlVGllcmVkRGF0YUZyb20gPSBmdW5jdGlvbiAocGFydGlhbE1lbnUpIHtcbiAgICAgIHJldHVybiB0aWVyZWRNZW51LnNpbmdsZURhdGEocGFydGlhbE1lbnUudmFsdWUsIHBhcnRpYWxNZW51KTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVNZW51RnJvbSA9IGZ1bmN0aW9uIChwYXJ0aWFsTWVudSwgY29sdW1ucywgZm9jdXNNb2RlLCBwcmVzZXRzKSB7XG4gICAgICB2YXIgZm9jdXNNYW5hZ2VyID0gZm9jdXNNb2RlID09PSBGb2N1c01vZGUuQ29udGVudEZvY3VzID8gaGlnaGxpZ2h0cygpIDogZG9tKCk7XG4gICAgICB2YXIgbW92ZW1lbnQgPSBkZXJpdmVNZW51TW92ZW1lbnQoY29sdW1ucywgcHJlc2V0cyk7XG4gICAgICB2YXIgbWVudU1hcmtlcnMgPSBtYXJrZXJzJDEocHJlc2V0cyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHBhcnRpYWxNZW51LmRvbSxcbiAgICAgICAgY29tcG9uZW50czogcGFydGlhbE1lbnUuY29tcG9uZW50cyxcbiAgICAgICAgaXRlbXM6IHBhcnRpYWxNZW51Lml0ZW1zLFxuICAgICAgICB2YWx1ZTogcGFydGlhbE1lbnUudmFsdWUsXG4gICAgICAgIG1hcmtlcnM6IHtcbiAgICAgICAgICBzZWxlY3RlZEl0ZW06IG1lbnVNYXJrZXJzLnNlbGVjdGVkSXRlbSxcbiAgICAgICAgICBpdGVtOiBtZW51TWFya2Vycy5pdGVtXG4gICAgICAgIH0sXG4gICAgICAgIG1vdmVtZW50OiBtb3ZlbWVudCxcbiAgICAgICAgZmFrZUZvY3VzOiBmb2N1c01vZGUgPT09IEZvY3VzTW9kZS5Db250ZW50Rm9jdXMsXG4gICAgICAgIGZvY3VzTWFuYWdlcjogZm9jdXNNYW5hZ2VyLFxuICAgICAgICBtZW51QmVoYXZpb3VyczogU2ltcGxlQmVoYXZpb3Vycy51bm5hbWVkRXZlbnRzKGNvbHVtbnMgIT09ICdhdXRvJyA/IFtdIDogW3J1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgZGV0ZWN0U2l6ZShjb21wLCA0LCBtZW51TWFya2Vycy5pdGVtKS5lYWNoKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICB2YXIgbnVtQ29sdW1ucyA9IF9hLm51bUNvbHVtbnMsIG51bVJvd3MgPSBfYS5udW1Sb3dzO1xuICAgICAgICAgICAgICBLZXlpbmcuc2V0R3JpZFNpemUoY29tcCwgbnVtUm93cywgbnVtQ29sdW1ucyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KV0pXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgcmVnaXN0ZXIkMiA9IGZ1bmN0aW9uIChlZGl0b3IsIHNoYXJlZEJhY2tzdGFnZSkge1xuICAgICAgdmFyIGFjdGl2ZUF1dG9jb21wbGV0ZXIgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgcHJvY2Vzc2luZ0FjdGlvbiA9IENlbGwoZmFsc2UpO1xuICAgICAgdmFyIGF1dG9jb21wbGV0ZXIgPSBidWlsZCQxKElubGluZVZpZXcuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1hdXRvY29tcGxldGVyJ11cbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogW10sXG4gICAgICAgIGZpcmVEaXNtaXNzYWxFdmVudEluc3RlYWQ6IHt9LFxuICAgICAgICBpbmxpbmVCZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdkaXNtaXNzQXV0b2NvbXBsZXRlcicsIFtydW4oZGlzbWlzc1JlcXVlc3RlZCgpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYW5jZWxJZk5lY2Vzc2FyeSgpO1xuICAgICAgICAgICAgfSldKV0pLFxuICAgICAgICBsYXp5U2luazogc2hhcmVkQmFja3N0YWdlLmdldFNpbmtcbiAgICAgIH0pKTtcbiAgICAgIHZhciBpc01lbnVPcGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gSW5saW5lVmlldy5pc09wZW4oYXV0b2NvbXBsZXRlcik7XG4gICAgICB9O1xuICAgICAgdmFyIGlzQWN0aXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gYWN0aXZlQXV0b2NvbXBsZXRlci5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgaGlkZUlmTmVjZXNzYXJ5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNBY3RpdmUoKSkge1xuICAgICAgICAgIElubGluZVZpZXcuaGlkZShhdXRvY29tcGxldGVyKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBjYW5jZWxJZk5lY2Vzc2FyeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGlzQWN0aXZlKCkpIHtcbiAgICAgICAgICB2YXIgbGFzdEVsZW1lbnQgPSBhY3RpdmVBdXRvY29tcGxldGVyLmdldCgpLm1hcChmdW5jdGlvbiAoYWMpIHtcbiAgICAgICAgICAgIHJldHVybiBhYy5lbGVtZW50O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRldGVjdCQ0KGxhc3RFbGVtZW50LmdldE9yKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpKSkpLmVhY2godW53cmFwKTtcbiAgICAgICAgICBoaWRlSWZOZWNlc3NhcnkoKTtcbiAgICAgICAgICBhY3RpdmVBdXRvY29tcGxldGVyLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICAgIHByb2Nlc3NpbmdBY3Rpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBnZXRBdXRvY29tcGxldGVycyA9IGNhY2hlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZWdpc3RlcihlZGl0b3IpO1xuICAgICAgfSk7XG4gICAgICB2YXIgZ2V0Q29tYmluZWRJdGVtcyA9IGZ1bmN0aW9uICh0cmlnZ2VyQ2hhciwgbWF0Y2hlcykge1xuICAgICAgICB2YXIgY29sdW1ucyA9IGZpbmRNYXAobWF0Y2hlcywgZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShtLmNvbHVtbnMpO1xuICAgICAgICB9KS5nZXRPcigxKTtcbiAgICAgICAgcmV0dXJuIGJpbmQobWF0Y2hlcywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgICAgdmFyIGNob2ljZXMgPSBtYXRjaC5pdGVtcztcbiAgICAgICAgICByZXR1cm4gY3JlYXRlQXV0b2NvbXBsZXRlSXRlbXMoY2hvaWNlcywgbWF0Y2gubWF0Y2hUZXh0LCBmdW5jdGlvbiAoaXRlbVZhbHVlLCBpdGVtTWV0YSkge1xuICAgICAgICAgICAgdmFyIG5yID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKTtcbiAgICAgICAgICAgIGdldENvbnRleHQoZWRpdG9yLmRvbSwgbnIsIHRyaWdnZXJDaGFyKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ0xvc3QgY29udGV4dC4gQ3Vyc29yIHByb2JhYmx5IG1vdmVkJyk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgdmFyIHJhbmdlID0gX2EucmFuZ2U7XG4gICAgICAgICAgICAgIHZhciBhdXRvY29tcGxldGVyQXBpID0ge1xuICAgICAgICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgIGNhbmNlbElmTmVjZXNzYXJ5KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZWxvYWQ6IGZ1bmN0aW9uIChmZXRjaE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgIGhpZGVJZk5lY2Vzc2FyeSgpO1xuICAgICAgICAgICAgICAgICAgbG9hZChmZXRjaE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcHJvY2Vzc2luZ0FjdGlvbi5zZXQodHJ1ZSk7XG4gICAgICAgICAgICAgIG1hdGNoLm9uQWN0aW9uKGF1dG9jb21wbGV0ZXJBcGksIHJhbmdlLCBpdGVtVmFsdWUsIGl0ZW1NZXRhKTtcbiAgICAgICAgICAgICAgcHJvY2Vzc2luZ0FjdGlvbi5zZXQoZmFsc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSwgY29sdW1ucywgSXRlbVJlc3BvbnNlJDEuQlVCQkxFX1RPX1NBTkRCT1gsIHNoYXJlZEJhY2tzdGFnZSwgbWF0Y2guaGlnaGxpZ2h0T24pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgY29tbWVuY2VJZk5lY2Vzc2FyeSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAgIGlmICghaXNBY3RpdmUoKSkge1xuICAgICAgICAgIHZhciB3cmFwcGVyID0gY3JlYXRlJDQoZWRpdG9yLCBjb250ZXh0LnJhbmdlKTtcbiAgICAgICAgICBhY3RpdmVBdXRvY29tcGxldGVyLnNldChPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIHRyaWdnZXJDaGFyOiBjb250ZXh0LnRyaWdnZXJDaGFyLFxuICAgICAgICAgICAgZWxlbWVudDogd3JhcHBlcixcbiAgICAgICAgICAgIG1hdGNoTGVuZ3RoOiBjb250ZXh0LnRleHQubGVuZ3RoXG4gICAgICAgICAgfSkpO1xuICAgICAgICAgIHByb2Nlc3NpbmdBY3Rpb24uc2V0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBkaXNwbGF5ID0gZnVuY3Rpb24gKGFjLCBjb250ZXh0LCBsb29rdXBEYXRhLCBpdGVtcykge1xuICAgICAgICBhYy5tYXRjaExlbmd0aCA9IGNvbnRleHQudGV4dC5sZW5ndGg7XG4gICAgICAgIHZhciBjb2x1bW5zID0gZmluZE1hcChsb29rdXBEYXRhLCBmdW5jdGlvbiAobGQpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShsZC5jb2x1bW5zKTtcbiAgICAgICAgfSkuZ2V0T3IoMSk7XG4gICAgICAgIElubGluZVZpZXcuc2hvd0F0KGF1dG9jb21wbGV0ZXIsIHtcbiAgICAgICAgICBhbmNob3I6ICdub2RlJyxcbiAgICAgICAgICByb290OiBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0Qm9keSgpKSxcbiAgICAgICAgICBub2RlOiBPcHRpb25hbC5mcm9tKGFjLmVsZW1lbnQpXG4gICAgICAgIH0sIE1lbnUuc2tldGNoKGNyZWF0ZU1lbnVGcm9tKGNyZWF0ZVBhcnRpYWxNZW51V2l0aEFsbG95SXRlbXMoJ2F1dG9jb21wbGV0ZXItdmFsdWUnLCB0cnVlLCBpdGVtcywgY29sdW1ucywgJ25vcm1hbCcpLCBjb2x1bW5zLCBGb2N1c01vZGUuQ29udGVudEZvY3VzLCAnbm9ybWFsJykpKTtcbiAgICAgICAgSW5saW5lVmlldy5nZXRDb250ZW50KGF1dG9jb21wbGV0ZXIpLmVhY2goSGlnaGxpZ2h0aW5nLmhpZ2hsaWdodEZpcnN0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZG9Mb29rdXAgPSBmdW5jdGlvbiAoZmV0Y2hPcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBhY3RpdmVBdXRvY29tcGxldGVyLmdldCgpLm1hcChmdW5jdGlvbiAoYWMpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0Q29udGV4dChlZGl0b3IuZG9tLCBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpLCBhYy50cmlnZ2VyQ2hhcikuYmluZChmdW5jdGlvbiAobmV3Q29udGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGxvb2t1cFdpdGhDb250ZXh0KGVkaXRvciwgZ2V0QXV0b2NvbXBsZXRlcnMsIG5ld0NvbnRleHQsIGZldGNoT3B0aW9ucyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBsb29rdXAoZWRpdG9yLCBnZXRBdXRvY29tcGxldGVycyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBsb2FkID0gZnVuY3Rpb24gKGZldGNoT3B0aW9ucykge1xuICAgICAgICBkb0xvb2t1cChmZXRjaE9wdGlvbnMpLmZvbGQoY2FuY2VsSWZOZWNlc3NhcnksIGZ1bmN0aW9uIChsb29rdXBJbmZvKSB7XG4gICAgICAgICAgY29tbWVuY2VJZk5lY2Vzc2FyeShsb29rdXBJbmZvLmNvbnRleHQpO1xuICAgICAgICAgIGxvb2t1cEluZm8ubG9va3VwRGF0YS50aGVuKGZ1bmN0aW9uIChsb29rdXBEYXRhKSB7XG4gICAgICAgICAgICBhY3RpdmVBdXRvY29tcGxldGVyLmdldCgpLm1hcChmdW5jdGlvbiAoYWMpIHtcbiAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSBsb29rdXBJbmZvLmNvbnRleHQ7XG4gICAgICAgICAgICAgIGlmIChhYy50cmlnZ2VyQ2hhciA9PT0gY29udGV4dC50cmlnZ2VyQ2hhcikge1xuICAgICAgICAgICAgICAgIHZhciBjb21iaW5lZEl0ZW1zID0gZ2V0Q29tYmluZWRJdGVtcyhjb250ZXh0LnRyaWdnZXJDaGFyLCBsb29rdXBEYXRhKTtcbiAgICAgICAgICAgICAgICBpZiAoY29tYmluZWRJdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICBkaXNwbGF5KGFjLCBjb250ZXh0LCBsb29rdXBEYXRhLCBjb21iaW5lZEl0ZW1zKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQudGV4dC5sZW5ndGggLSBhYy5tYXRjaExlbmd0aCA+PSAxMCkge1xuICAgICAgICAgICAgICAgICAgY2FuY2VsSWZOZWNlc3NhcnkoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgaGlkZUlmTmVjZXNzYXJ5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uS2V5cHJlc3MgPSBsYXN0JDIoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGUud2hpY2ggPT09IDI3KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxvYWQoKTtcbiAgICAgIH0sIDUwKTtcbiAgICAgIHZhciBhdXRvY29tcGxldGVyVWlBcGkgPSB7XG4gICAgICAgIG9uS2V5cHJlc3M6IG9uS2V5cHJlc3MsXG4gICAgICAgIGNhbmNlbElmTmVjZXNzYXJ5OiBjYW5jZWxJZk5lY2Vzc2FyeSxcbiAgICAgICAgaXNNZW51T3BlbjogaXNNZW51T3BlbixcbiAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLFxuICAgICAgICBpc1Byb2Nlc3NpbmdBY3Rpb246IHByb2Nlc3NpbmdBY3Rpb24uZ2V0LFxuICAgICAgICBnZXRWaWV3OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIElubGluZVZpZXcuZ2V0Q29udGVudChhdXRvY29tcGxldGVyKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmIChlZGl0b3IuaGFzUGx1Z2luKCdydGMnKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgQXV0b2NvbXBsZXRlckVkaXRvckV2ZW50cy5zZXR1cChhdXRvY29tcGxldGVyVWlBcGksIGVkaXRvcik7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgQXV0b2NvbXBsZXRlciA9IHsgcmVnaXN0ZXI6IHJlZ2lzdGVyJDIgfTtcblxuICAgIHZhciBmaWx0ZXIkMiA9IGFsd2F5cztcbiAgICB2YXIgYmluZCQzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyKSB7XG4gICAgICByZXR1cm4gYmluZCQyKGVsZW1lbnQsIGV2ZW50LCBmaWx0ZXIkMiwgaGFuZGxlcik7XG4gICAgfTtcbiAgICB2YXIgY2FwdHVyZSQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyKSB7XG4gICAgICByZXR1cm4gY2FwdHVyZShlbGVtZW50LCBldmVudCwgZmlsdGVyJDIsIGhhbmRsZXIpO1xuICAgIH07XG4gICAgdmFyIGZyb21SYXdFdmVudCQxID0gZnJvbVJhd0V2ZW50O1xuXG4gICAgdmFyIGNsb3Nlc3QkNCA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGNsb3Nlc3QkMyhzY29wZSwgc2VsZWN0b3IsIGlzUm9vdCkuaXNTb21lKCk7XG4gICAgfTtcblxuICAgIHZhciBEZWxheWVkRnVuY3Rpb24gPSBmdW5jdGlvbiAoZnVuLCBkZWxheSkge1xuICAgICAgdmFyIHJlZiA9IG51bGw7XG4gICAgICB2YXIgc2NoZWR1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIHJlZiA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGZ1bi5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICByZWYgPSBudWxsO1xuICAgICAgICB9LCBkZWxheSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHJlZiAhPT0gbnVsbCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dChyZWYpO1xuICAgICAgICAgIHJlZiA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW5jZWw6IGNhbmNlbCxcbiAgICAgICAgc2NoZWR1bGU6IHNjaGVkdWxlXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgU0lHTklGSUNBTlRfTU9WRSA9IDU7XG4gICAgdmFyIExPTkdQUkVTU19ERUxBWSA9IDQwMDtcbiAgICB2YXIgZ2V0VG91Y2ggPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHZhciByYXcgPSBldmVudC5yYXc7XG4gICAgICBpZiAocmF3LnRvdWNoZXMgPT09IHVuZGVmaW5lZCB8fCByYXcudG91Y2hlcy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHJhdy50b3VjaGVzWzBdKTtcbiAgICB9O1xuICAgIHZhciBpc0ZhckVub3VnaCA9IGZ1bmN0aW9uICh0b3VjaCwgZGF0YSkge1xuICAgICAgdmFyIGRpc3RYID0gTWF0aC5hYnModG91Y2guY2xpZW50WCAtIGRhdGEueCk7XG4gICAgICB2YXIgZGlzdFkgPSBNYXRoLmFicyh0b3VjaC5jbGllbnRZIC0gZGF0YS55KTtcbiAgICAgIHJldHVybiBkaXN0WCA+IFNJR05JRklDQU5UX01PVkUgfHwgZGlzdFkgPiBTSUdOSUZJQ0FOVF9NT1ZFO1xuICAgIH07XG4gICAgdmFyIG1vbml0b3IgPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHtcbiAgICAgIHZhciBzdGFydERhdGEgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgbG9uZ3ByZXNzRmlyZWQgPSBDZWxsKGZhbHNlKTtcbiAgICAgIHZhciBsb25ncHJlc3MkMSA9IERlbGF5ZWRGdW5jdGlvbihmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgc2V0dGluZ3MudHJpZ2dlckV2ZW50KGxvbmdwcmVzcygpLCBldmVudCk7XG4gICAgICAgIGxvbmdwcmVzc0ZpcmVkLnNldCh0cnVlKTtcbiAgICAgIH0sIExPTkdQUkVTU19ERUxBWSk7XG4gICAgICB2YXIgaGFuZGxlVG91Y2hzdGFydCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBnZXRUb3VjaChldmVudCkuZWFjaChmdW5jdGlvbiAodG91Y2gpIHtcbiAgICAgICAgICBsb25ncHJlc3MkMS5jYW5jZWwoKTtcbiAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgIHg6IHRvdWNoLmNsaWVudFgsXG4gICAgICAgICAgICB5OiB0b3VjaC5jbGllbnRZLFxuICAgICAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXRcbiAgICAgICAgICB9O1xuICAgICAgICAgIGxvbmdwcmVzcyQxLnNjaGVkdWxlKGV2ZW50KTtcbiAgICAgICAgICBsb25ncHJlc3NGaXJlZC5zZXQoZmFsc2UpO1xuICAgICAgICAgIHN0YXJ0RGF0YS5zZXQoT3B0aW9uYWwuc29tZShkYXRhKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBoYW5kbGVUb3VjaG1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgbG9uZ3ByZXNzJDEuY2FuY2VsKCk7XG4gICAgICAgIGdldFRvdWNoKGV2ZW50KS5lYWNoKGZ1bmN0aW9uICh0b3VjaCkge1xuICAgICAgICAgIHN0YXJ0RGF0YS5nZXQoKS5lYWNoKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoaXNGYXJFbm91Z2godG91Y2gsIGRhdGEpKSB7XG4gICAgICAgICAgICAgIHN0YXJ0RGF0YS5zZXQoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGhhbmRsZVRvdWNoZW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGxvbmdwcmVzcyQxLmNhbmNlbCgpO1xuICAgICAgICB2YXIgaXNTYW1lID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICByZXR1cm4gZXEkMShkYXRhLnRhcmdldCwgZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHN0YXJ0RGF0YS5nZXQoKS5maWx0ZXIoaXNTYW1lKS5tYXAoZnVuY3Rpb24gKF9kYXRhKSB7XG4gICAgICAgICAgaWYgKGxvbmdwcmVzc0ZpcmVkLmdldCgpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy50cmlnZ2VyRXZlbnQodGFwKCksIGV2ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBoYW5kbGVycyA9IHdyYXBBbGwkMShbXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6IHRvdWNoc3RhcnQoKSxcbiAgICAgICAgICB2YWx1ZTogaGFuZGxlVG91Y2hzdGFydFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiB0b3VjaG1vdmUoKSxcbiAgICAgICAgICB2YWx1ZTogaGFuZGxlVG91Y2htb3ZlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6IHRvdWNoZW5kKCksXG4gICAgICAgICAgdmFsdWU6IGhhbmRsZVRvdWNoZW5kXG4gICAgICAgIH1cbiAgICAgIF0pO1xuICAgICAgdmFyIGZpcmVJZlJlYWR5ID0gZnVuY3Rpb24gKGV2ZW50LCB0eXBlKSB7XG4gICAgICAgIHJldHVybiBnZXQkMShoYW5kbGVycywgdHlwZSkuYmluZChmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICAgIHJldHVybiBoYW5kbGVyKGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHsgZmlyZUlmUmVhZHk6IGZpcmVJZlJlYWR5IH07XG4gICAgfTtcblxuICAgIHZhciBpc0Rhbmdlcm91cyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgdmFyIGtleUV2ID0gZXZlbnQucmF3O1xuICAgICAgcmV0dXJuIGtleUV2LndoaWNoID09PSBCQUNLU1BBQ0VbMF0gJiYgIWNvbnRhaW5zKFtcbiAgICAgICAgJ2lucHV0JyxcbiAgICAgICAgJ3RleHRhcmVhJ1xuICAgICAgXSwgbmFtZShldmVudC50YXJnZXQpKSAmJiAhY2xvc2VzdCQ0KGV2ZW50LnRhcmdldCwgJ1tjb250ZW50ZWRpdGFibGU9XCJ0cnVlXCJdJyk7XG4gICAgfTtcbiAgICB2YXIgaXNGaXJlZm94ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGRldGVjdCQzKCkuYnJvd3Nlci5pc0ZpcmVmb3goKTtcbiAgICB9O1xuICAgIHZhciBzZXR0aW5nc1NjaGVtYSA9IG9iak9mT25seShbXG4gICAgICBzdHJpY3RGdW5jdGlvbigndHJpZ2dlckV2ZW50JyksXG4gICAgICBkZWZhdWx0ZWQkMSgnc3RvcEJhY2tzcGFjZScsIHRydWUpXG4gICAgXSk7XG4gICAgdmFyIGJpbmRGb2N1cyA9IGZ1bmN0aW9uIChjb250YWluZXIsIGhhbmRsZXIpIHtcbiAgICAgIGlmIChpc0ZpcmVmb3goKSkge1xuICAgICAgICByZXR1cm4gY2FwdHVyZSQxKGNvbnRhaW5lciwgJ2ZvY3VzJywgaGFuZGxlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYmluZCQzKGNvbnRhaW5lciwgJ2ZvY3VzaW4nLCBoYW5kbGVyKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBiaW5kQmx1ciA9IGZ1bmN0aW9uIChjb250YWluZXIsIGhhbmRsZXIpIHtcbiAgICAgIGlmIChpc0ZpcmVmb3goKSkge1xuICAgICAgICByZXR1cm4gY2FwdHVyZSQxKGNvbnRhaW5lciwgJ2JsdXInLCBoYW5kbGVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBiaW5kJDMoY29udGFpbmVyLCAnZm9jdXNvdXQnLCBoYW5kbGVyKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXR1cCQxID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgcmF3U2V0dGluZ3MpIHtcbiAgICAgIHZhciBzZXR0aW5ncyA9IGFzUmF3T3JEaWUoJ0dldHRpbmcgR1VJIGV2ZW50cyBzZXR0aW5ncycsIHNldHRpbmdzU2NoZW1hLCByYXdTZXR0aW5ncyk7XG4gICAgICB2YXIgcG9pbnRlckV2ZW50cyA9IFtcbiAgICAgICAgJ3RvdWNoc3RhcnQnLFxuICAgICAgICAndG91Y2htb3ZlJyxcbiAgICAgICAgJ3RvdWNoZW5kJyxcbiAgICAgICAgJ3RvdWNoY2FuY2VsJyxcbiAgICAgICAgJ2dlc3R1cmVzdGFydCcsXG4gICAgICAgICdtb3VzZWRvd24nLFxuICAgICAgICAnbW91c2V1cCcsXG4gICAgICAgICdtb3VzZW92ZXInLFxuICAgICAgICAnbW91c2Vtb3ZlJyxcbiAgICAgICAgJ21vdXNlb3V0JyxcbiAgICAgICAgJ2NsaWNrJ1xuICAgICAgXTtcbiAgICAgIHZhciB0YXBFdmVudCA9IG1vbml0b3Ioc2V0dGluZ3MpO1xuICAgICAgdmFyIHNpbXBsZUV2ZW50cyA9IG1hcChwb2ludGVyRXZlbnRzLmNvbmNhdChbXG4gICAgICAgICdzZWxlY3RzdGFydCcsXG4gICAgICAgICdpbnB1dCcsXG4gICAgICAgICdjb250ZXh0bWVudScsXG4gICAgICAgICdjaGFuZ2UnLFxuICAgICAgICAndHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICdkcmFnJyxcbiAgICAgICAgJ2RyYWdzdGFydCcsXG4gICAgICAgICdkcmFnZW5kJyxcbiAgICAgICAgJ2RyYWdlbnRlcicsXG4gICAgICAgICdkcmFnbGVhdmUnLFxuICAgICAgICAnZHJhZ292ZXInLFxuICAgICAgICAnZHJvcCcsXG4gICAgICAgICdrZXl1cCdcbiAgICAgIF0pLCBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICByZXR1cm4gYmluZCQzKGNvbnRhaW5lciwgdHlwZSwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgdGFwRXZlbnQuZmlyZUlmUmVhZHkoZXZlbnQsIHR5cGUpLmVhY2goZnVuY3Rpb24gKHRhcFN0b3BwZWQpIHtcbiAgICAgICAgICAgIGlmICh0YXBTdG9wcGVkKSB7XG4gICAgICAgICAgICAgIGV2ZW50LmtpbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2YXIgc3RvcHBlZCA9IHNldHRpbmdzLnRyaWdnZXJFdmVudCh0eXBlLCBldmVudCk7XG4gICAgICAgICAgaWYgKHN0b3BwZWQpIHtcbiAgICAgICAgICAgIGV2ZW50LmtpbGwoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgcGFzdGVUaW1lb3V0ID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIG9uUGFzdGUgPSBiaW5kJDMoY29udGFpbmVyLCAncGFzdGUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdGFwRXZlbnQuZmlyZUlmUmVhZHkoZXZlbnQsICdwYXN0ZScpLmVhY2goZnVuY3Rpb24gKHRhcFN0b3BwZWQpIHtcbiAgICAgICAgICBpZiAodGFwU3RvcHBlZCkge1xuICAgICAgICAgICAgZXZlbnQua2lsbCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBzdG9wcGVkID0gc2V0dGluZ3MudHJpZ2dlckV2ZW50KCdwYXN0ZScsIGV2ZW50KTtcbiAgICAgICAgaWYgKHN0b3BwZWQpIHtcbiAgICAgICAgICBldmVudC5raWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgcGFzdGVUaW1lb3V0LnNldChPcHRpb25hbC5zb21lKHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNldHRpbmdzLnRyaWdnZXJFdmVudChwb3N0UGFzdGUoKSwgZXZlbnQpO1xuICAgICAgICB9LCAwKSkpO1xuICAgICAgfSk7XG4gICAgICB2YXIgb25LZXlkb3duID0gYmluZCQzKGNvbnRhaW5lciwgJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHN0b3BwZWQgPSBzZXR0aW5ncy50cmlnZ2VyRXZlbnQoJ2tleWRvd24nLCBldmVudCk7XG4gICAgICAgIGlmIChzdG9wcGVkKSB7XG4gICAgICAgICAgZXZlbnQua2lsbCgpO1xuICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLnN0b3BCYWNrc3BhY2UgPT09IHRydWUgJiYgaXNEYW5nZXJvdXMoZXZlbnQpKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBvbkZvY3VzSW4gPSBiaW5kRm9jdXMoY29udGFpbmVyLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHN0b3BwZWQgPSBzZXR0aW5ncy50cmlnZ2VyRXZlbnQoJ2ZvY3VzaW4nLCBldmVudCk7XG4gICAgICAgIGlmIChzdG9wcGVkKSB7XG4gICAgICAgICAgZXZlbnQua2lsbCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBmb2N1c291dFRpbWVvdXQgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgb25Gb2N1c091dCA9IGJpbmRCbHVyKGNvbnRhaW5lciwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBzdG9wcGVkID0gc2V0dGluZ3MudHJpZ2dlckV2ZW50KCdmb2N1c291dCcsIGV2ZW50KTtcbiAgICAgICAgaWYgKHN0b3BwZWQpIHtcbiAgICAgICAgICBldmVudC5raWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9jdXNvdXRUaW1lb3V0LnNldChPcHRpb25hbC5zb21lKHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNldHRpbmdzLnRyaWdnZXJFdmVudChwb3N0Qmx1cigpLCBldmVudCk7XG4gICAgICAgIH0sIDApKSk7XG4gICAgICB9KTtcbiAgICAgIHZhciB1bmJpbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVhY2goc2ltcGxlRXZlbnRzLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGUudW5iaW5kKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBvbktleWRvd24udW5iaW5kKCk7XG4gICAgICAgIG9uRm9jdXNJbi51bmJpbmQoKTtcbiAgICAgICAgb25Gb2N1c091dC51bmJpbmQoKTtcbiAgICAgICAgb25QYXN0ZS51bmJpbmQoKTtcbiAgICAgICAgcGFzdGVUaW1lb3V0LmdldCgpLmVhY2goY2xlYXJUaW1lb3V0KTtcbiAgICAgICAgZm9jdXNvdXRUaW1lb3V0LmdldCgpLmVhY2goY2xlYXJUaW1lb3V0KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4geyB1bmJpbmQ6IHVuYmluZCB9O1xuICAgIH07XG5cbiAgICB2YXIgZGVyaXZlJDIgPSBmdW5jdGlvbiAocmF3RXZlbnQsIHJhd1RhcmdldCkge1xuICAgICAgdmFyIHNvdXJjZSA9IGdldCQxKHJhd0V2ZW50LCAndGFyZ2V0JykuZ2V0T3IocmF3VGFyZ2V0KTtcbiAgICAgIHJldHVybiBDZWxsKHNvdXJjZSk7XG4gICAgfTtcblxuICAgIHZhciBmcm9tU291cmNlID0gZnVuY3Rpb24gKGV2ZW50LCBzb3VyY2UpIHtcbiAgICAgIHZhciBzdG9wcGVyID0gQ2VsbChmYWxzZSk7XG4gICAgICB2YXIgY3V0dGVyID0gQ2VsbChmYWxzZSk7XG4gICAgICB2YXIgc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RvcHBlci5zZXQodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIGN1dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY3V0dGVyLnNldCh0cnVlKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdG9wOiBzdG9wLFxuICAgICAgICBjdXQ6IGN1dCxcbiAgICAgICAgaXNTdG9wcGVkOiBzdG9wcGVyLmdldCxcbiAgICAgICAgaXNDdXQ6IGN1dHRlci5nZXQsXG4gICAgICAgIGV2ZW50OiBldmVudCxcbiAgICAgICAgc2V0U291cmNlOiBzb3VyY2Uuc2V0LFxuICAgICAgICBnZXRTb3VyY2U6IHNvdXJjZS5nZXRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZnJvbUV4dGVybmFsID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICB2YXIgc3RvcHBlciA9IENlbGwoZmFsc2UpO1xuICAgICAgdmFyIHN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN0b3BwZXIuc2V0KHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0b3A6IHN0b3AsXG4gICAgICAgIGN1dDogbm9vcCxcbiAgICAgICAgaXNTdG9wcGVkOiBzdG9wcGVyLmdldCxcbiAgICAgICAgaXNDdXQ6IG5ldmVyLFxuICAgICAgICBldmVudDogZXZlbnQsXG4gICAgICAgIHNldFNvdXJjZTogZGllKCdDYW5ub3Qgc2V0IHNvdXJjZSBvZiBhIGJyb2FkY2FzdGVkIGV2ZW50JyksXG4gICAgICAgIGdldFNvdXJjZTogZGllKCdDYW5ub3QgZ2V0IHNvdXJjZSBvZiBhIGJyb2FkY2FzdGVkIGV2ZW50JylcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhZHQkYiA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7IHN0b3BwZWQ6IFtdIH0sXG4gICAgICB7IHJlc3VtZTogWydlbGVtZW50J10gfSxcbiAgICAgIHsgY29tcGxldGU6IFtdIH1cbiAgICBdKTtcbiAgICB2YXIgZG9UcmlnZ2VySGFuZGxlciA9IGZ1bmN0aW9uIChsb29rdXAsIGV2ZW50VHlwZSwgcmF3RXZlbnQsIHRhcmdldCwgc291cmNlLCBsb2dnZXIpIHtcbiAgICAgIHZhciBoYW5kbGVyID0gbG9va3VwKGV2ZW50VHlwZSwgdGFyZ2V0KTtcbiAgICAgIHZhciBzaW11bGF0ZWRFdmVudCA9IGZyb21Tb3VyY2UocmF3RXZlbnQsIHNvdXJjZSk7XG4gICAgICByZXR1cm4gaGFuZGxlci5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbG9nZ2VyLmxvZ0V2ZW50Tm9IYW5kbGVycyhldmVudFR5cGUsIHRhcmdldCk7XG4gICAgICAgIHJldHVybiBhZHQkYi5jb21wbGV0ZSgpO1xuICAgICAgfSwgZnVuY3Rpb24gKGhhbmRsZXJJbmZvKSB7XG4gICAgICAgIHZhciBkZXNjSGFuZGxlciA9IGhhbmRsZXJJbmZvLmRlc2NIYW5kbGVyO1xuICAgICAgICB2YXIgZXZlbnRIYW5kbGVyID0gZ2V0Q3VycmllZChkZXNjSGFuZGxlcik7XG4gICAgICAgIGV2ZW50SGFuZGxlcihzaW11bGF0ZWRFdmVudCk7XG4gICAgICAgIGlmIChzaW11bGF0ZWRFdmVudC5pc1N0b3BwZWQoKSkge1xuICAgICAgICAgIGxvZ2dlci5sb2dFdmVudFN0b3BwZWQoZXZlbnRUeXBlLCBoYW5kbGVySW5mby5lbGVtZW50LCBkZXNjSGFuZGxlci5wdXJwb3NlKTtcbiAgICAgICAgICByZXR1cm4gYWR0JGIuc3RvcHBlZCgpO1xuICAgICAgICB9IGVsc2UgaWYgKHNpbXVsYXRlZEV2ZW50LmlzQ3V0KCkpIHtcbiAgICAgICAgICBsb2dnZXIubG9nRXZlbnRDdXQoZXZlbnRUeXBlLCBoYW5kbGVySW5mby5lbGVtZW50LCBkZXNjSGFuZGxlci5wdXJwb3NlKTtcbiAgICAgICAgICByZXR1cm4gYWR0JGIuY29tcGxldGUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcGFyZW50KGhhbmRsZXJJbmZvLmVsZW1lbnQpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbG9nZ2VyLmxvZ05vUGFyZW50KGV2ZW50VHlwZSwgaGFuZGxlckluZm8uZWxlbWVudCwgZGVzY0hhbmRsZXIucHVycG9zZSk7XG4gICAgICAgICAgICByZXR1cm4gYWR0JGIuY29tcGxldGUoKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAocGFyZW50KSB7XG4gICAgICAgICAgICBsb2dnZXIubG9nRXZlbnRSZXNwb25zZShldmVudFR5cGUsIGhhbmRsZXJJbmZvLmVsZW1lbnQsIGRlc2NIYW5kbGVyLnB1cnBvc2UpO1xuICAgICAgICAgICAgcmV0dXJuIGFkdCRiLnJlc3VtZShwYXJlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkb1RyaWdnZXJPblVudGlsU3RvcHBlZCA9IGZ1bmN0aW9uIChsb29rdXAsIGV2ZW50VHlwZSwgcmF3RXZlbnQsIHJhd1RhcmdldCwgc291cmNlLCBsb2dnZXIpIHtcbiAgICAgIHJldHVybiBkb1RyaWdnZXJIYW5kbGVyKGxvb2t1cCwgZXZlbnRUeXBlLCByYXdFdmVudCwgcmF3VGFyZ2V0LCBzb3VyY2UsIGxvZ2dlcikuZm9sZChhbHdheXMsIGZ1bmN0aW9uIChwYXJlbnQpIHtcbiAgICAgICAgcmV0dXJuIGRvVHJpZ2dlck9uVW50aWxTdG9wcGVkKGxvb2t1cCwgZXZlbnRUeXBlLCByYXdFdmVudCwgcGFyZW50LCBzb3VyY2UsIGxvZ2dlcik7XG4gICAgICB9LCBuZXZlcik7XG4gICAgfTtcbiAgICB2YXIgdHJpZ2dlckhhbmRsZXIgPSBmdW5jdGlvbiAobG9va3VwLCBldmVudFR5cGUsIHJhd0V2ZW50LCB0YXJnZXQsIGxvZ2dlcikge1xuICAgICAgdmFyIHNvdXJjZSA9IGRlcml2ZSQyKHJhd0V2ZW50LCB0YXJnZXQpO1xuICAgICAgcmV0dXJuIGRvVHJpZ2dlckhhbmRsZXIobG9va3VwLCBldmVudFR5cGUsIHJhd0V2ZW50LCB0YXJnZXQsIHNvdXJjZSwgbG9nZ2VyKTtcbiAgICB9O1xuICAgIHZhciBicm9hZGNhc3QgPSBmdW5jdGlvbiAobGlzdGVuZXJzLCByYXdFdmVudCwgX2xvZ2dlcikge1xuICAgICAgdmFyIHNpbXVsYXRlZEV2ZW50ID0gZnJvbUV4dGVybmFsKHJhd0V2ZW50KTtcbiAgICAgIGVhY2gobGlzdGVuZXJzLCBmdW5jdGlvbiAobGlzdGVuZXIpIHtcbiAgICAgICAgdmFyIGRlc2NIYW5kbGVyID0gbGlzdGVuZXIuZGVzY0hhbmRsZXI7XG4gICAgICAgIHZhciBoYW5kbGVyID0gZ2V0Q3VycmllZChkZXNjSGFuZGxlcik7XG4gICAgICAgIGhhbmRsZXIoc2ltdWxhdGVkRXZlbnQpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gc2ltdWxhdGVkRXZlbnQuaXNTdG9wcGVkKCk7XG4gICAgfTtcbiAgICB2YXIgdHJpZ2dlclVudGlsU3RvcHBlZCA9IGZ1bmN0aW9uIChsb29rdXAsIGV2ZW50VHlwZSwgcmF3RXZlbnQsIGxvZ2dlcikge1xuICAgICAgcmV0dXJuIHRyaWdnZXJPblVudGlsU3RvcHBlZChsb29rdXAsIGV2ZW50VHlwZSwgcmF3RXZlbnQsIHJhd0V2ZW50LnRhcmdldCwgbG9nZ2VyKTtcbiAgICB9O1xuICAgIHZhciB0cmlnZ2VyT25VbnRpbFN0b3BwZWQgPSBmdW5jdGlvbiAobG9va3VwLCBldmVudFR5cGUsIHJhd0V2ZW50LCByYXdUYXJnZXQsIGxvZ2dlcikge1xuICAgICAgdmFyIHNvdXJjZSA9IGRlcml2ZSQyKHJhd0V2ZW50LCByYXdUYXJnZXQpO1xuICAgICAgcmV0dXJuIGRvVHJpZ2dlck9uVW50aWxTdG9wcGVkKGxvb2t1cCwgZXZlbnRUeXBlLCByYXdFdmVudCwgcmF3VGFyZ2V0LCBzb3VyY2UsIGxvZ2dlcik7XG4gICAgfTtcblxuICAgIHZhciBldmVudEhhbmRsZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZGVzY0hhbmRsZXIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgIGRlc2NIYW5kbGVyOiBkZXNjSGFuZGxlclxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBicm9hZGNhc3RIYW5kbGVyID0gZnVuY3Rpb24gKGlkLCBoYW5kbGVyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogaWQsXG4gICAgICAgIGRlc2NIYW5kbGVyOiBoYW5kbGVyXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIEV2ZW50UmVnaXN0cnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcmVnaXN0cnkgPSB7fTtcbiAgICAgIHZhciByZWdpc3RlcklkID0gZnVuY3Rpb24gKGV4dHJhQXJncywgaWQsIGV2ZW50cykge1xuICAgICAgICBlYWNoJDEoZXZlbnRzLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICAgIHZhciBoYW5kbGVycyA9IHJlZ2lzdHJ5W2tdICE9PSB1bmRlZmluZWQgPyByZWdpc3RyeVtrXSA6IHt9O1xuICAgICAgICAgIGhhbmRsZXJzW2lkXSA9IGN1cnJ5QXJncyh2LCBleHRyYUFyZ3MpO1xuICAgICAgICAgIHJlZ2lzdHJ5W2tdID0gaGFuZGxlcnM7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBmaW5kSGFuZGxlciA9IGZ1bmN0aW9uIChoYW5kbGVycywgZWxlbSkge1xuICAgICAgICByZXR1cm4gcmVhZCQxKGVsZW0pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgIHJldHVybiBoYW5kbGVycy5iaW5kKGZ1bmN0aW9uIChoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0JDEoaCwgaWQpO1xuICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZGVzY0hhbmRsZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBldmVudEhhbmRsZXIoZWxlbSwgZGVzY0hhbmRsZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZmlsdGVyQnlUeXBlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGdldCQxKHJlZ2lzdHJ5LCB0eXBlKS5tYXAoZnVuY3Rpb24gKGhhbmRsZXJzKSB7XG4gICAgICAgICAgcmV0dXJuIG1hcFRvQXJyYXkoaGFuZGxlcnMsIGZ1bmN0aW9uIChmLCBpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGJyb2FkY2FzdEhhbmRsZXIoaWQsIGYpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KS5nZXRPcihbXSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZpbmQgPSBmdW5jdGlvbiAoaXNBYm92ZVJvb3QsIHR5cGUsIHRhcmdldCkge1xuICAgICAgICB2YXIgaGFuZGxlcnMgPSBnZXQkMShyZWdpc3RyeSwgdHlwZSk7XG4gICAgICAgIHJldHVybiBjbG9zZXN0KHRhcmdldCwgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICByZXR1cm4gZmluZEhhbmRsZXIoaGFuZGxlcnMsIGVsZW0pO1xuICAgICAgICB9LCBpc0Fib3ZlUm9vdCk7XG4gICAgICB9O1xuICAgICAgdmFyIHVucmVnaXN0ZXJJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICBlYWNoJDEocmVnaXN0cnksIGZ1bmN0aW9uIChoYW5kbGVyc0J5SWQsIF9ldmVudE5hbWUpIHtcbiAgICAgICAgICBpZiAoaGFuZGxlcnNCeUlkLmhhc093blByb3BlcnR5KGlkKSkge1xuICAgICAgICAgICAgZGVsZXRlIGhhbmRsZXJzQnlJZFtpZF07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZWdpc3RlcklkOiByZWdpc3RlcklkLFxuICAgICAgICB1bnJlZ2lzdGVySWQ6IHVucmVnaXN0ZXJJZCxcbiAgICAgICAgZmlsdGVyQnlUeXBlOiBmaWx0ZXJCeVR5cGUsXG4gICAgICAgIGZpbmQ6IGZpbmRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBSZWdpc3RyeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBldmVudHMgPSBFdmVudFJlZ2lzdHJ5KCk7XG4gICAgICB2YXIgY29tcG9uZW50cyA9IHt9O1xuICAgICAgdmFyIHJlYWRPclRhZyA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgdmFyIGVsZW0gPSBjb21wb25lbnQuZWxlbWVudDtcbiAgICAgICAgcmV0dXJuIHJlYWQkMShlbGVtKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gd3JpdGUoJ3VpZC0nLCBjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh1aWQpIHtcbiAgICAgICAgICByZXR1cm4gdWlkO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZmFpbE9uRHVwbGljYXRlID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgdGFnSWQpIHtcbiAgICAgICAgdmFyIGNvbmZsaWN0ID0gY29tcG9uZW50c1t0YWdJZF07XG4gICAgICAgIGlmIChjb25mbGljdCA9PT0gY29tcG9uZW50KSB7XG4gICAgICAgICAgdW5yZWdpc3Rlcihjb21wb25lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHRhZ0lkIFwiJyArIHRhZ0lkICsgJ1wiIGlzIGFscmVhZHkgdXNlZCBieTogJyArIGVsZW1lbnQoY29uZmxpY3QuZWxlbWVudCkgKyAnXFxuQ2Fubm90IHVzZSBpdCBmb3I6ICcgKyBlbGVtZW50KGNvbXBvbmVudC5lbGVtZW50KSArICdcXG4nICsgJ1RoZSBjb25mbGljdGluZyBlbGVtZW50IGlzJyArIChpbkJvZHkoY29uZmxpY3QuZWxlbWVudCkgPyAnICcgOiAnIG5vdCAnKSArICdhbHJlYWR5IGluIHRoZSBET00nKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgdmFyIHRhZ0lkID0gcmVhZE9yVGFnKGNvbXBvbmVudCk7XG4gICAgICAgIGlmIChoYXNOb25OdWxsYWJsZUtleShjb21wb25lbnRzLCB0YWdJZCkpIHtcbiAgICAgICAgICBmYWlsT25EdXBsaWNhdGUoY29tcG9uZW50LCB0YWdJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV4dHJhQXJncyA9IFtjb21wb25lbnRdO1xuICAgICAgICBldmVudHMucmVnaXN0ZXJJZChleHRyYUFyZ3MsIHRhZ0lkLCBjb21wb25lbnQuZXZlbnRzKTtcbiAgICAgICAgY29tcG9uZW50c1t0YWdJZF0gPSBjb21wb25lbnQ7XG4gICAgICB9O1xuICAgICAgdmFyIHVucmVnaXN0ZXIgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJlYWQkMShjb21wb25lbnQuZWxlbWVudCkuZWFjaChmdW5jdGlvbiAodGFnSWQpIHtcbiAgICAgICAgICBkZWxldGUgY29tcG9uZW50c1t0YWdJZF07XG4gICAgICAgICAgZXZlbnRzLnVucmVnaXN0ZXJJZCh0YWdJZCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBmaWx0ZXIgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICByZXR1cm4gZXZlbnRzLmZpbHRlckJ5VHlwZSh0eXBlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZmluZCA9IGZ1bmN0aW9uIChpc0Fib3ZlUm9vdCwgdHlwZSwgdGFyZ2V0KSB7XG4gICAgICAgIHJldHVybiBldmVudHMuZmluZChpc0Fib3ZlUm9vdCwgdHlwZSwgdGFyZ2V0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4gZ2V0JDEoY29tcG9uZW50cywgaWQpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgIGZpbHRlcjogZmlsdGVyLFxuICAgICAgICByZWdpc3RlcjogcmVnaXN0ZXIsXG4gICAgICAgIHVucmVnaXN0ZXI6IHVucmVnaXN0ZXIsXG4gICAgICAgIGdldEJ5SWQ6IGdldEJ5SWRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBmYWN0b3J5JDMgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICB2YXIgX2EgPSBkZXRhaWwuZG9tLCBhdHRyaWJ1dGVzID0gX2EuYXR0cmlidXRlcywgZG9tV2l0aG91dEF0dHJpYnV0ZXMgPSBfX3Jlc3QoX2EsIFsnYXR0cmlidXRlcyddKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBfX2Fzc2lnbih7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBfX2Fzc2lnbih7IHJvbGU6ICdwcmVzZW50YXRpb24nIH0sIGF0dHJpYnV0ZXMpXG4gICAgICAgIH0sIGRvbVdpdGhvdXRBdHRyaWJ1dGVzKSxcbiAgICAgICAgY29tcG9uZW50czogZGV0YWlsLmNvbXBvbmVudHMsXG4gICAgICAgIGJlaGF2aW91cnM6IGdldCRkKGRldGFpbC5jb250YWluZXJCZWhhdmlvdXJzKSxcbiAgICAgICAgZXZlbnRzOiBkZXRhaWwuZXZlbnRzLFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IGRldGFpbC5kb21Nb2RpZmljYXRpb24sXG4gICAgICAgIGV2ZW50T3JkZXI6IGRldGFpbC5ldmVudE9yZGVyXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIENvbnRhaW5lciA9IHNpbmdsZSQyKHtcbiAgICAgIG5hbWU6ICdDb250YWluZXInLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSQzLFxuICAgICAgY29uZmlnRmllbGRzOiBbXG4gICAgICAgIGRlZmF1bHRlZCQxKCdjb21wb25lbnRzJywgW10pLFxuICAgICAgICBmaWVsZCQxKCdjb250YWluZXJCZWhhdmlvdXJzJywgW10pLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRzJywge30pLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnZG9tTW9kaWZpY2F0aW9uJywge30pLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRPcmRlcicsIHt9KVxuICAgICAgXVxuICAgIH0pO1xuXG4gICAgdmFyIHRha2VvdmVyID0gZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgIHZhciBpc0Fib3ZlUm9vdCA9IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICByZXR1cm4gcGFyZW50KHJvb3QuZWxlbWVudCkuZm9sZChhbHdheXMsIGZ1bmN0aW9uIChwYXJlbnQpIHtcbiAgICAgICAgICByZXR1cm4gZXEkMShlbCwgcGFyZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlZ2lzdHJ5ID0gUmVnaXN0cnkoKTtcbiAgICAgIHZhciBsb29rdXAgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCB0YXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5LmZpbmQoaXNBYm92ZVJvb3QsIGV2ZW50TmFtZSwgdGFyZ2V0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZG9tRXZlbnRzID0gc2V0dXAkMShyb290LmVsZW1lbnQsIHtcbiAgICAgICAgdHJpZ2dlckV2ZW50OiBmdW5jdGlvbiAoZXZlbnROYW1lLCBldmVudCkge1xuICAgICAgICAgIHJldHVybiBtb25pdG9yRXZlbnQoZXZlbnROYW1lLCBldmVudC50YXJnZXQsIGZ1bmN0aW9uIChsb2dnZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmlnZ2VyVW50aWxTdG9wcGVkKGxvb2t1cCwgZXZlbnROYW1lLCBldmVudCwgbG9nZ2VyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgc3lzdGVtQXBpID0ge1xuICAgICAgICBkZWJ1Z0luZm86IGNvbnN0YW50KCdyZWFsJyksXG4gICAgICAgIHRyaWdnZXJFdmVudDogZnVuY3Rpb24gKGV2ZW50TmFtZSwgdGFyZ2V0LCBkYXRhKSB7XG4gICAgICAgICAgbW9uaXRvckV2ZW50KGV2ZW50TmFtZSwgdGFyZ2V0LCBmdW5jdGlvbiAobG9nZ2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJpZ2dlck9uVW50aWxTdG9wcGVkKGxvb2t1cCwgZXZlbnROYW1lLCBkYXRhLCB0YXJnZXQsIGxvZ2dlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRyaWdnZXJGb2N1czogZnVuY3Rpb24gKHRhcmdldCwgb3JpZ2luYXRvcikge1xuICAgICAgICAgIHJlYWQkMSh0YXJnZXQpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9jdXMkMSh0YXJnZXQpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChfYWxsb3lJZCkge1xuICAgICAgICAgICAgbW9uaXRvckV2ZW50KGZvY3VzKCksIHRhcmdldCwgZnVuY3Rpb24gKGxvZ2dlcikge1xuICAgICAgICAgICAgICB0cmlnZ2VySGFuZGxlcihsb29rdXAsIGZvY3VzKCksIHtcbiAgICAgICAgICAgICAgICBvcmlnaW5hdG9yOiBvcmlnaW5hdG9yLFxuICAgICAgICAgICAgICAgIGtpbGw6IG5vb3AsXG4gICAgICAgICAgICAgICAgcHJldmVudDogbm9vcCxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldFxuICAgICAgICAgICAgICB9LCB0YXJnZXQsIGxvZ2dlcik7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0cmlnZ2VyRXNjYXBlOiBmdW5jdGlvbiAoY29tcCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICBzeXN0ZW1BcGkudHJpZ2dlckV2ZW50KCdrZXlkb3duJywgY29tcC5lbGVtZW50LCBzaW11bGF0ZWRFdmVudC5ldmVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEJ5VWlkOiBmdW5jdGlvbiAodWlkKSB7XG4gICAgICAgICAgcmV0dXJuIGdldEJ5VWlkKHVpZCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEJ5RG9tOiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBnZXRCeURvbShlbGVtKTtcbiAgICAgICAgfSxcbiAgICAgICAgYnVpbGQ6IGJ1aWxkJDEsXG4gICAgICAgIGFkZFRvR3VpOiBmdW5jdGlvbiAoYykge1xuICAgICAgICAgIGFkZChjKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlRnJvbUd1aTogZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICByZW1vdmUkMShjKTtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkVG9Xb3JsZDogZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICBhZGRUb1dvcmxkKGMpO1xuICAgICAgICB9LFxuICAgICAgICByZW1vdmVGcm9tV29ybGQ6IGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgcmVtb3ZlRnJvbVdvcmxkKGMpO1xuICAgICAgICB9LFxuICAgICAgICBicm9hZGNhc3Q6IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgYnJvYWRjYXN0JDEobWVzc2FnZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJyb2FkY2FzdE9uOiBmdW5jdGlvbiAoY2hhbm5lbHMsIG1lc3NhZ2UpIHtcbiAgICAgICAgICBicm9hZGNhc3RPbihjaGFubmVscywgbWVzc2FnZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJyb2FkY2FzdEV2ZW50OiBmdW5jdGlvbiAoZXZlbnROYW1lLCBldmVudCkge1xuICAgICAgICAgIGJyb2FkY2FzdEV2ZW50KGV2ZW50TmFtZSwgZXZlbnQpO1xuICAgICAgICB9LFxuICAgICAgICBpc0Nvbm5lY3RlZDogYWx3YXlzXG4gICAgICB9O1xuICAgICAgdmFyIGFkZFRvV29ybGQgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIGNvbXBvbmVudC5jb25uZWN0KHN5c3RlbUFwaSk7XG4gICAgICAgIGlmICghaXNUZXh0KGNvbXBvbmVudC5lbGVtZW50KSkge1xuICAgICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKGNvbXBvbmVudCk7XG4gICAgICAgICAgZWFjaChjb21wb25lbnQuY29tcG9uZW50cygpLCBhZGRUb1dvcmxkKTtcbiAgICAgICAgICBzeXN0ZW1BcGkudHJpZ2dlckV2ZW50KHN5c3RlbUluaXQoKSwgY29tcG9uZW50LmVsZW1lbnQsIHsgdGFyZ2V0OiBjb21wb25lbnQuZWxlbWVudCB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciByZW1vdmVGcm9tV29ybGQgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIGlmICghaXNUZXh0KGNvbXBvbmVudC5lbGVtZW50KSkge1xuICAgICAgICAgIGVhY2goY29tcG9uZW50LmNvbXBvbmVudHMoKSwgcmVtb3ZlRnJvbVdvcmxkKTtcbiAgICAgICAgICByZWdpc3RyeS51bnJlZ2lzdGVyKGNvbXBvbmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgY29tcG9uZW50LmRpc2Nvbm5lY3QoKTtcbiAgICAgIH07XG4gICAgICB2YXIgYWRkID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICBhdHRhY2gkMShyb290LCBjb21wb25lbnQpO1xuICAgICAgfTtcbiAgICAgIHZhciByZW1vdmUkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgZGV0YWNoKGNvbXBvbmVudCk7XG4gICAgICB9O1xuICAgICAgdmFyIGRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvbUV2ZW50cy51bmJpbmQoKTtcbiAgICAgICAgcmVtb3ZlKHJvb3QuZWxlbWVudCk7XG4gICAgICB9O1xuICAgICAgdmFyIGJyb2FkY2FzdERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgcmVjZWl2ZXJzID0gcmVnaXN0cnkuZmlsdGVyKHJlY2VpdmUoKSk7XG4gICAgICAgIGVhY2gocmVjZWl2ZXJzLCBmdW5jdGlvbiAocmVjZWl2ZXIpIHtcbiAgICAgICAgICB2YXIgZGVzY0hhbmRsZXIgPSByZWNlaXZlci5kZXNjSGFuZGxlcjtcbiAgICAgICAgICB2YXIgaGFuZGxlciA9IGdldEN1cnJpZWQoZGVzY0hhbmRsZXIpO1xuICAgICAgICAgIGhhbmRsZXIoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBicm9hZGNhc3QkMSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIGJyb2FkY2FzdERhdGEoe1xuICAgICAgICAgIHVuaXZlcnNhbDogdHJ1ZSxcbiAgICAgICAgICBkYXRhOiBtZXNzYWdlXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBicm9hZGNhc3RPbiA9IGZ1bmN0aW9uIChjaGFubmVscywgbWVzc2FnZSkge1xuICAgICAgICBicm9hZGNhc3REYXRhKHtcbiAgICAgICAgICB1bml2ZXJzYWw6IGZhbHNlLFxuICAgICAgICAgIGNoYW5uZWxzOiBjaGFubmVscyxcbiAgICAgICAgICBkYXRhOiBtZXNzYWdlXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBicm9hZGNhc3RFdmVudCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGV2ZW50KSB7XG4gICAgICAgIHZhciBsaXN0ZW5lcnMgPSByZWdpc3RyeS5maWx0ZXIoZXZlbnROYW1lKTtcbiAgICAgICAgcmV0dXJuIGJyb2FkY2FzdChsaXN0ZW5lcnMsIGV2ZW50KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0QnlVaWQgPSBmdW5jdGlvbiAodWlkKSB7XG4gICAgICAgIHJldHVybiByZWdpc3RyeS5nZXRCeUlkKHVpZCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnJvcihuZXcgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIGNvbXBvbmVudCB3aXRoIHVpZDogXCInICsgdWlkICsgJ1wiIGluIHN5c3RlbS4nKSk7XG4gICAgICAgIH0sIFJlc3VsdC52YWx1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldEJ5RG9tID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgdmFyIHVpZCA9IHJlYWQkMShlbGVtKS5nZXRPcignbm90IGZvdW5kJyk7XG4gICAgICAgIHJldHVybiBnZXRCeVVpZCh1aWQpO1xuICAgICAgfTtcbiAgICAgIGFkZFRvV29ybGQocm9vdCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByb290OiByb290LFxuICAgICAgICBlbGVtZW50OiByb290LmVsZW1lbnQsXG4gICAgICAgIGRlc3Ryb3k6IGRlc3Ryb3ksXG4gICAgICAgIGFkZDogYWRkLFxuICAgICAgICByZW1vdmU6IHJlbW92ZSQxLFxuICAgICAgICBnZXRCeVVpZDogZ2V0QnlVaWQsXG4gICAgICAgIGdldEJ5RG9tOiBnZXRCeURvbSxcbiAgICAgICAgYWRkVG9Xb3JsZDogYWRkVG9Xb3JsZCxcbiAgICAgICAgcmVtb3ZlRnJvbVdvcmxkOiByZW1vdmVGcm9tV29ybGQsXG4gICAgICAgIGJyb2FkY2FzdDogYnJvYWRjYXN0JDEsXG4gICAgICAgIGJyb2FkY2FzdE9uOiBicm9hZGNhc3RPbixcbiAgICAgICAgYnJvYWRjYXN0RXZlbnQ6IGJyb2FkY2FzdEV2ZW50XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyQmFyID0gZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAndG94LWJhcicsXG4gICAgICAgICAgICAndG94LWZvcm1fX2NvbnRyb2xzLWgtc3RhY2snXG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBtYXAoc3BlYy5pdGVtcywgYmFja3N0YWdlLmludGVycHJldGVyKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNjaGVtYSRlID0gY29uc3RhbnQoW1xuICAgICAgZGVmYXVsdGVkJDEoJ3ByZWZpeCcsICdmb3JtLWZpZWxkJyksXG4gICAgICBmaWVsZCQxKCdmaWVsZEJlaGF2aW91cnMnLCBbXG4gICAgICAgIENvbXBvc2luZyxcbiAgICAgICAgUmVwcmVzZW50aW5nXG4gICAgICBdKVxuICAgIF0pO1xuICAgIHZhciBwYXJ0cyQzID0gY29uc3RhbnQoW1xuICAgICAgb3B0aW9uYWwoe1xuICAgICAgICBzY2hlbWE6IFtzdHJpY3QkMSgnZG9tJyldLFxuICAgICAgICBuYW1lOiAnbGFiZWwnXG4gICAgICB9KSxcbiAgICAgIG9wdGlvbmFsKHtcbiAgICAgICAgZmFjdG9yeToge1xuICAgICAgICAgIHNrZXRjaDogZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHVpZDogc3BlYy51aWQsXG4gICAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgICAgICAgIHN0eWxlczogeyBkaXNwbGF5OiAnbm9uZScgfSxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7ICdhcmlhLWhpZGRlbic6ICd0cnVlJyB9LFxuICAgICAgICAgICAgICAgIGlubmVySHRtbDogc3BlYy50ZXh0XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzY2hlbWE6IFtzdHJpY3QkMSgndGV4dCcpXSxcbiAgICAgICAgbmFtZTogJ2FyaWEtZGVzY3JpcHRvcidcbiAgICAgIH0pLFxuICAgICAgcmVxdWlyZWQoe1xuICAgICAgICBmYWN0b3J5OiB7XG4gICAgICAgICAgc2tldGNoOiBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgICAgICAgdmFyIGV4Y2x1ZGVGYWN0b3J5ID0gZXhjbHVkZSQxKHNwZWMsIFsnZmFjdG9yeSddKTtcbiAgICAgICAgICAgIHJldHVybiBzcGVjLmZhY3Rvcnkuc2tldGNoKGV4Y2x1ZGVGYWN0b3J5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdmYWN0b3J5JyldLFxuICAgICAgICBuYW1lOiAnZmllbGQnXG4gICAgICB9KVxuICAgIF0pO1xuXG4gICAgdmFyIGZhY3RvcnkkNCA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMsIF9zcGVjLCBfZXh0ZXJuYWxzKSB7XG4gICAgICB2YXIgYmVoYXZpb3VycyA9IGF1Z21lbnQoZGV0YWlsLmZpZWxkQmVoYXZpb3VycywgW1xuICAgICAgICBDb21wb3NpbmcuY29uZmlnKHtcbiAgICAgICAgICBmaW5kOiBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0UGFydChjb250YWluZXIsIGRldGFpbCwgJ2ZpZWxkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgIG1vZGU6ICdtYW51YWwnLFxuICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICAgICAgICByZXR1cm4gQ29tcG9zaW5nLmdldEN1cnJlbnQoZmllbGQpLmJpbmQoUmVwcmVzZW50aW5nLmdldFZhbHVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gKGZpZWxkLCB2YWx1ZSkge1xuICAgICAgICAgICAgICBDb21wb3NpbmcuZ2V0Q3VycmVudChmaWVsZCkuZWFjaChmdW5jdGlvbiAoY3VycmVudCkge1xuICAgICAgICAgICAgICAgIFJlcHJlc2VudGluZy5zZXRWYWx1ZShjdXJyZW50LCB2YWx1ZSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIF0pO1xuICAgICAgdmFyIGV2ZW50cyA9IGRlcml2ZShbcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoY29tcG9uZW50LCBfc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICB2YXIgcHMgPSBnZXRQYXJ0cyhjb21wb25lbnQsIGRldGFpbCwgW1xuICAgICAgICAgICAgJ2xhYmVsJyxcbiAgICAgICAgICAgICdmaWVsZCcsXG4gICAgICAgICAgICAnYXJpYS1kZXNjcmlwdG9yJ1xuICAgICAgICAgIF0pO1xuICAgICAgICAgIHBzLmZpZWxkKCkuZWFjaChmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgIHZhciBpZCA9IGdlbmVyYXRlJDEoZGV0YWlsLnByZWZpeCk7XG4gICAgICAgICAgICBwcy5sYWJlbCgpLmVhY2goZnVuY3Rpb24gKGxhYmVsKSB7XG4gICAgICAgICAgICAgIHNldCQxKGxhYmVsLmVsZW1lbnQsICdmb3InLCBpZCk7XG4gICAgICAgICAgICAgIHNldCQxKGZpZWxkLmVsZW1lbnQsICdpZCcsIGlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcHNbJ2FyaWEtZGVzY3JpcHRvciddKCkuZWFjaChmdW5jdGlvbiAoZGVzY3JpcHRvcikge1xuICAgICAgICAgICAgICB2YXIgZGVzY3JpcHRvcklkID0gZ2VuZXJhdGUkMShkZXRhaWwucHJlZml4KTtcbiAgICAgICAgICAgICAgc2V0JDEoZGVzY3JpcHRvci5lbGVtZW50LCAnaWQnLCBkZXNjcmlwdG9ySWQpO1xuICAgICAgICAgICAgICBzZXQkMShmaWVsZC5lbGVtZW50LCAnYXJpYS1kZXNjcmliZWRieScsIGRlc2NyaXB0b3JJZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSldKTtcbiAgICAgIHZhciBhcGlzID0ge1xuICAgICAgICBnZXRGaWVsZDogZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgIHJldHVybiBnZXRQYXJ0KGNvbnRhaW5lciwgZGV0YWlsLCAnZmllbGQnKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0TGFiZWw6IGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0UGFydChjb250YWluZXIsIGRldGFpbCwgJ2xhYmVsJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcbiAgICAgICAgYmVoYXZpb3VyczogYmVoYXZpb3VycyxcbiAgICAgICAgZXZlbnRzOiBldmVudHMsXG4gICAgICAgIGFwaXM6IGFwaXNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgRm9ybUZpZWxkID0gY29tcG9zaXRlJDEoe1xuICAgICAgbmFtZTogJ0Zvcm1GaWVsZCcsXG4gICAgICBjb25maWdGaWVsZHM6IHNjaGVtYSRlKCksXG4gICAgICBwYXJ0RmllbGRzOiBwYXJ0cyQzKCksXG4gICAgICBmYWN0b3J5OiBmYWN0b3J5JDQsXG4gICAgICBhcGlzOiB7XG4gICAgICAgIGdldEZpZWxkOiBmdW5jdGlvbiAoYXBpcywgY29tcCkge1xuICAgICAgICAgIHJldHVybiBhcGlzLmdldEZpZWxkKGNvbXApO1xuICAgICAgICB9LFxuICAgICAgICBnZXRMYWJlbDogZnVuY3Rpb24gKGFwaXMsIGNvbXApIHtcbiAgICAgICAgICByZXR1cm4gYXBpcy5nZXRMYWJlbChjb21wKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGV4aGliaXQkNCA9IGZ1bmN0aW9uIChiYXNlLCB0YWJDb25maWcpIHtcbiAgICAgIHJldHVybiBudSQ2KHtcbiAgICAgICAgYXR0cmlidXRlczogd3JhcEFsbCQxKFt7XG4gICAgICAgICAgICBrZXk6IHRhYkNvbmZpZy50YWJBdHRyLFxuICAgICAgICAgICAgdmFsdWU6ICd0cnVlJ1xuICAgICAgICAgIH1dKVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBBY3RpdmVUYWJzdG9wcGluZyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBleGhpYml0OiBleGhpYml0JDRcbiAgICB9KTtcblxuICAgIHZhciBUYWJzdG9wU2NoZW1hID0gW2RlZmF1bHRlZCQxKCd0YWJBdHRyJywgJ2RhdGEtYWxsb3ktdGFic3RvcCcpXTtcblxuICAgIHZhciBUYWJzdG9wcGluZyA9IGNyZWF0ZSQxKHtcbiAgICAgIGZpZWxkczogVGFic3RvcFNjaGVtYSxcbiAgICAgIG5hbWU6ICd0YWJzdG9wcGluZycsXG4gICAgICBhY3RpdmU6IEFjdGl2ZVRhYnN0b3BwaW5nXG4gICAgfSk7XG5cbiAgICB2YXIgZ2xvYmFsJGEgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5odG1sLkVudGl0aWVzJyk7XG5cbiAgICB2YXIgcmVuZGVyRm9ybUZpZWxkV2l0aCA9IGZ1bmN0aW9uIChwTGFiZWwsIHBGaWVsZCwgZXh0cmFDbGFzc2VzLCBleHRyYUJlaGF2aW91cnMpIHtcbiAgICAgIHZhciBzcGVjID0gcmVuZGVyRm9ybUZpZWxkU3BlY1dpdGgocExhYmVsLCBwRmllbGQsIGV4dHJhQ2xhc3NlcywgZXh0cmFCZWhhdmlvdXJzKTtcbiAgICAgIHJldHVybiBGb3JtRmllbGQuc2tldGNoKHNwZWMpO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckZvcm1GaWVsZCA9IGZ1bmN0aW9uIChwTGFiZWwsIHBGaWVsZCkge1xuICAgICAgcmV0dXJuIHJlbmRlckZvcm1GaWVsZFdpdGgocExhYmVsLCBwRmllbGQsIFtdLCBbXSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRm9ybUZpZWxkU3BlY1dpdGggPSBmdW5jdGlvbiAocExhYmVsLCBwRmllbGQsIGV4dHJhQ2xhc3NlcywgZXh0cmFCZWhhdmlvdXJzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHJlbmRlckZvcm1GaWVsZERvbVdpdGgoZXh0cmFDbGFzc2VzKSxcbiAgICAgICAgY29tcG9uZW50czogcExhYmVsLnRvQXJyYXkoKS5jb25jYXQoW3BGaWVsZF0pLFxuICAgICAgICBmaWVsZEJlaGF2aW91cnM6IGRlcml2ZSQxKGV4dHJhQmVoYXZpb3VycylcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRm9ybUZpZWxkRG9tID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHJlbmRlckZvcm1GaWVsZERvbVdpdGgoW10pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckZvcm1GaWVsZERvbVdpdGggPSBmdW5jdGlvbiAoZXh0cmFDbGFzc2VzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtX19ncm91cCddLmNvbmNhdChleHRyYUNsYXNzZXMpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlckxhYmVsID0gZnVuY3Rpb24gKGxhYmVsLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiBGb3JtRmllbGQucGFydHMubGFiZWwoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdsYWJlbCcsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtbGFiZWwnXSxcbiAgICAgICAgICBpbm5lckh0bWw6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUobGFiZWwpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZm9ybUNoYW5nZUV2ZW50ID0gZ2VuZXJhdGUkMSgnZm9ybS1jb21wb25lbnQtY2hhbmdlJyk7XG4gICAgdmFyIGZvcm1DbG9zZUV2ZW50ID0gZ2VuZXJhdGUkMSgnZm9ybS1jbG9zZScpO1xuICAgIHZhciBmb3JtQ2FuY2VsRXZlbnQgPSBnZW5lcmF0ZSQxKCdmb3JtLWNhbmNlbCcpO1xuICAgIHZhciBmb3JtQWN0aW9uRXZlbnQgPSBnZW5lcmF0ZSQxKCdmb3JtLWFjdGlvbicpO1xuICAgIHZhciBmb3JtU3VibWl0RXZlbnQgPSBnZW5lcmF0ZSQxKCdmb3JtLXN1Ym1pdCcpO1xuICAgIHZhciBmb3JtQmxvY2tFdmVudCA9IGdlbmVyYXRlJDEoJ2Zvcm0tYmxvY2snKTtcbiAgICB2YXIgZm9ybVVuYmxvY2tFdmVudCA9IGdlbmVyYXRlJDEoJ2Zvcm0tdW5ibG9jaycpO1xuICAgIHZhciBmb3JtVGFiQ2hhbmdlRXZlbnQgPSBnZW5lcmF0ZSQxKCdmb3JtLXRhYmNoYW5nZScpO1xuICAgIHZhciBmb3JtUmVzaXplRXZlbnQgPSBnZW5lcmF0ZSQxKCdmb3JtLXJlc2l6ZScpO1xuXG4gICAgdmFyIHJlbmRlckNvbGxlY3Rpb24gPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgX2E7XG4gICAgICB2YXIgcExhYmVsID0gc3BlYy5sYWJlbC5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJMYWJlbChsYWJlbCwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHJ1bk9uSXRlbSA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoY29tcCwgc2UpIHtcbiAgICAgICAgICBjbG9zZXN0JDMoc2UuZXZlbnQudGFyZ2V0LCAnW2RhdGEtY29sbGVjdGlvbi1pdGVtLXZhbHVlXScpLmVhY2goZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICAgICAgZihjb21wLCBzZSwgdGFyZ2V0LCBnZXQkMyh0YXJnZXQsICdkYXRhLWNvbGxlY3Rpb24taXRlbS12YWx1ZScpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0Q29udGVudHMgPSBmdW5jdGlvbiAoY29tcCwgaXRlbXMpIHtcbiAgICAgICAgdmFyIGh0bWxMaW5lcyA9IG1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICB2YXIgaXRlbVRleHQgPSBnbG9iYWwkNi50cmFuc2xhdGUoaXRlbS50ZXh0KTtcbiAgICAgICAgICB2YXIgdGV4dENvbnRlbnQgPSBzcGVjLmNvbHVtbnMgPT09IDEgPyAnPGRpdiBjbGFzcz1cInRveC1jb2xsZWN0aW9uX19pdGVtLWxhYmVsXCI+JyArIGl0ZW1UZXh0ICsgJzwvZGl2PicgOiAnJztcbiAgICAgICAgICB2YXIgaWNvbkNvbnRlbnQgPSAnPGRpdiBjbGFzcz1cInRveC1jb2xsZWN0aW9uX19pdGVtLWljb25cIj4nICsgaXRlbS5pY29uICsgJzwvZGl2Pic7XG4gICAgICAgICAgdmFyIG1hcEl0ZW1OYW1lID0ge1xuICAgICAgICAgICAgJ18nOiAnICcsXG4gICAgICAgICAgICAnIC0gJzogJyAnLFxuICAgICAgICAgICAgJy0nOiAnICdcbiAgICAgICAgICB9O1xuICAgICAgICAgIHZhciBhcmlhTGFiZWwgPSBpdGVtVGV4dC5yZXBsYWNlKC9cXF98IFxcLSB8XFwtL2csIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICAgICAgcmV0dXJuIG1hcEl0ZW1OYW1lW21hdGNoXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2YXIgZGlzYWJsZWRDbGFzcyA9IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCkgPyAnIHRveC1jb2xsZWN0aW9uX19pdGVtLS1zdGF0ZS1kaXNhYmxlZCcgOiAnJztcbiAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJ0b3gtY29sbGVjdGlvbl9faXRlbScgKyBkaXNhYmxlZENsYXNzICsgJ1wiIHRhYmluZGV4PVwiLTFcIiBkYXRhLWNvbGxlY3Rpb24taXRlbS12YWx1ZT1cIicgKyBnbG9iYWwkYS5lbmNvZGVBbGxSYXcoaXRlbS52YWx1ZSkgKyAnXCIgdGl0bGU9XCInICsgYXJpYUxhYmVsICsgJ1wiIGFyaWEtbGFiZWw9XCInICsgYXJpYUxhYmVsICsgJ1wiPicgKyBpY29uQ29udGVudCArIHRleHRDb250ZW50ICsgJzwvZGl2Pic7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgY2h1bmtzID0gc3BlYy5jb2x1bW5zICE9PSAnYXV0bycgJiYgc3BlYy5jb2x1bW5zID4gMSA/IGNodW5rKGh0bWxMaW5lcywgc3BlYy5jb2x1bW5zKSA6IFtodG1sTGluZXNdO1xuICAgICAgICB2YXIgaHRtbCA9IG1hcChjaHVua3MsIGZ1bmN0aW9uIChjaCkge1xuICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cInRveC1jb2xsZWN0aW9uX19ncm91cFwiPicgKyBjaC5qb2luKCcnKSArICc8L2Rpdj4nO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0KGNvbXAuZWxlbWVudCwgaHRtbC5qb2luKCcnKSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uQ2xpY2sgPSBydW5Pbkl0ZW0oZnVuY3Rpb24gKGNvbXAsIHNlLCB0Z3QsIGl0ZW1WYWx1ZSkge1xuICAgICAgICBzZS5zdG9wKCk7XG4gICAgICAgIGlmICghcHJvdmlkZXJzQmFja3N0YWdlLmlzRGlzYWJsZWQoKSkge1xuICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIGZvcm1BY3Rpb25FdmVudCwge1xuICAgICAgICAgICAgbmFtZTogc3BlYy5uYW1lLFxuICAgICAgICAgICAgdmFsdWU6IGl0ZW1WYWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBjb2xsZWN0aW9uRXZlbnRzID0gW1xuICAgICAgICBydW4obW91c2VvdmVyKCksIHJ1bk9uSXRlbShmdW5jdGlvbiAoY29tcCwgc2UsIHRndCkge1xuICAgICAgICAgIGZvY3VzJDEodGd0KTtcbiAgICAgICAgfSkpLFxuICAgICAgICBydW4oY2xpY2soKSwgb25DbGljayksXG4gICAgICAgIHJ1bih0YXAoKSwgb25DbGljayksXG4gICAgICAgIHJ1bihmb2N1c2luKCksIHJ1bk9uSXRlbShmdW5jdGlvbiAoY29tcCwgc2UsIHRndCkge1xuICAgICAgICAgIGRlc2NlbmRhbnQkMShjb21wLmVsZW1lbnQsICcuJyArIGFjdGl2ZUNsYXNzKS5lYWNoKGZ1bmN0aW9uIChjdXJyZW50QWN0aXZlKSB7XG4gICAgICAgICAgICByZW1vdmUkNChjdXJyZW50QWN0aXZlLCBhY3RpdmVDbGFzcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYWRkJDIodGd0LCBhY3RpdmVDbGFzcyk7XG4gICAgICAgIH0pKSxcbiAgICAgICAgcnVuKGZvY3Vzb3V0KCksIHJ1bk9uSXRlbShmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIGRlc2NlbmRhbnQkMShjb21wLmVsZW1lbnQsICcuJyArIGFjdGl2ZUNsYXNzKS5lYWNoKGZ1bmN0aW9uIChjdXJyZW50QWN0aXZlKSB7XG4gICAgICAgICAgICByZW1vdmUkNChjdXJyZW50QWN0aXZlLCBhY3RpdmVDbGFzcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pKSxcbiAgICAgICAgcnVuT25FeGVjdXRlKHJ1bk9uSXRlbShmdW5jdGlvbiAoY29tcCwgc2UsIHRndCwgaXRlbVZhbHVlKSB7XG4gICAgICAgICAgZW1pdFdpdGgoY29tcCwgZm9ybUFjdGlvbkV2ZW50LCB7XG4gICAgICAgICAgICBuYW1lOiBzcGVjLm5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogaXRlbVZhbHVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pKVxuICAgICAgXTtcbiAgICAgIHZhciBpdGVyQ29sbGVjdGlvbkl0ZW1zID0gZnVuY3Rpb24gKGNvbXAsIGFwcGx5QXR0cmlidXRlcykge1xuICAgICAgICByZXR1cm4gbWFwKGRlc2NlbmRhbnRzKGNvbXAuZWxlbWVudCwgJy50b3gtY29sbGVjdGlvbl9faXRlbScpLCBhcHBseUF0dHJpYnV0ZXMpO1xuICAgICAgfTtcbiAgICAgIHZhciBwRmllbGQgPSBGb3JtRmllbGQucGFydHMuZmllbGQoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWNvbGxlY3Rpb24nXS5jb25jYXQoc3BlYy5jb2x1bW5zICE9PSAxID8gWyd0b3gtY29sbGVjdGlvbi0tZ3JpZCddIDogWyd0b3gtY29sbGVjdGlvbi0tbGlzdCddKVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXSxcbiAgICAgICAgZmFjdG9yeTogeyBza2V0Y2g6IGlkZW50aXR5IH0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGRpc2FibGVkOiBwcm92aWRlcnNCYWNrc3RhZ2UuaXNEaXNhYmxlZCxcbiAgICAgICAgICAgIG9uRGlzYWJsZWQ6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIGl0ZXJDb2xsZWN0aW9uSXRlbXMoY29tcCwgZnVuY3Rpb24gKGNoaWxkRWxtKSB7XG4gICAgICAgICAgICAgICAgYWRkJDIoY2hpbGRFbG0sICd0b3gtY29sbGVjdGlvbl9faXRlbS0tc3RhdGUtZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICBzZXQkMShjaGlsZEVsbSwgJ2FyaWEtZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FbmFibGVkOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICBpdGVyQ29sbGVjdGlvbkl0ZW1zKGNvbXAsIGZ1bmN0aW9uIChjaGlsZEVsbSkge1xuICAgICAgICAgICAgICAgIHJlbW92ZSQ0KGNoaWxkRWxtLCAndG94LWNvbGxlY3Rpb25fX2l0ZW0tLXN0YXRlLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgcmVtb3ZlJDEoY2hpbGRFbG0sICdhcmlhLWRpc2FibGVkJyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICAgIFJlcGxhY2luZy5jb25maWcoe30pLFxuICAgICAgICAgIFJlcHJlc2VudGluZy5jb25maWcoe1xuICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgbW9kZTogJ21lbW9yeScsXG4gICAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblNldFZhbHVlOiBmdW5jdGlvbiAoY29tcCwgaXRlbXMpIHtcbiAgICAgICAgICAgICAgc2V0Q29udGVudHMoY29tcCwgaXRlbXMpO1xuICAgICAgICAgICAgICBpZiAoc3BlYy5jb2x1bW5zID09PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgICBkZXRlY3RTaXplKGNvbXAsIDUsICd0b3gtY29sbGVjdGlvbl9faXRlbScpLmVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgbnVtUm93cyA9IF9hLm51bVJvd3MsIG51bUNvbHVtbnMgPSBfYS5udW1Db2x1bW5zO1xuICAgICAgICAgICAgICAgICAgS2V5aW5nLnNldEdyaWRTaXplKGNvbXAsIG51bVJvd3MsIG51bUNvbHVtbnMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVtaXQoY29tcCwgZm9ybVJlc2l6ZUV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgIEtleWluZy5jb25maWcoZGVyaXZlQ29sbGVjdGlvbk1vdmVtZW50KHNwZWMuY29sdW1ucywgJ25vcm1hbCcpKSxcbiAgICAgICAgICBjb25maWcoJ2NvbGxlY3Rpb24tZXZlbnRzJywgY29sbGVjdGlvbkV2ZW50cylcbiAgICAgICAgXSksXG4gICAgICAgIGV2ZW50T3JkZXI6IChfYSA9IHt9LCBfYVtleGVjdXRlKCldID0gW1xuICAgICAgICAgICdkaXNhYmxpbmcnLFxuICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cicsXG4gICAgICAgICAgJ2NvbGxlY3Rpb24tZXZlbnRzJ1xuICAgICAgICBdLCBfYSlcbiAgICAgIH0pO1xuICAgICAgdmFyIGV4dHJhQ2xhc3NlcyA9IFsndG94LWZvcm1fX2dyb3VwLS1jb2xsZWN0aW9uJ107XG4gICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkV2l0aChwTGFiZWwsIHBGaWVsZCwgZXh0cmFDbGFzc2VzLCBbXSk7XG4gICAgfTtcblxuICAgIHZhciBzY2hlbWEkZiA9IGNvbnN0YW50KFtcbiAgICAgIG9wdGlvbignZGF0YScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2lucHV0QXR0cmlidXRlcycsIHt9KSxcbiAgICAgIGRlZmF1bHRlZCQxKCdpbnB1dFN0eWxlcycsIHt9KSxcbiAgICAgIGRlZmF1bHRlZCQxKCd0YWcnLCAnaW5wdXQnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdpbnB1dENsYXNzZXMnLCBbXSksXG4gICAgICBvbkhhbmRsZXIoJ29uU2V0VmFsdWUnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdzdHlsZXMnLCB7fSksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRPcmRlcicsIHt9KSxcbiAgICAgIGZpZWxkJDEoJ2lucHV0QmVoYXZpb3VycycsIFtcbiAgICAgICAgUmVwcmVzZW50aW5nLFxuICAgICAgICBGb2N1c2luZ1xuICAgICAgXSksXG4gICAgICBkZWZhdWx0ZWQkMSgnc2VsZWN0T25Gb2N1cycsIHRydWUpXG4gICAgXSk7XG4gICAgdmFyIGZvY3VzQmVoYXZpb3VycyA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXJpdmUkMShbRm9jdXNpbmcuY29uZmlnKHtcbiAgICAgICAgICBvbkZvY3VzOiAhZGV0YWlsLnNlbGVjdE9uRm9jdXMgPyBub29wIDogZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gY29tcG9uZW50LmVsZW1lbnQ7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBnZXQkNihpbnB1dCk7XG4gICAgICAgICAgICBpbnB1dC5kb20uc2V0U2VsZWN0aW9uUmFuZ2UoMCwgdmFsdWUubGVuZ3RoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXSk7XG4gICAgfTtcbiAgICB2YXIgYmVoYXZpb3VycyA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZm9jdXNCZWhhdmlvdXJzKGRldGFpbCkpLCBhdWdtZW50KGRldGFpbC5pbnB1dEJlaGF2aW91cnMsIFtSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgICBzdG9yZTogX19hc3NpZ24oX19hc3NpZ24oeyBtb2RlOiAnbWFudWFsJyB9LCBkZXRhaWwuZGF0YS5tYXAoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGluaXRpYWxWYWx1ZTogZGF0YSB9O1xuICAgICAgICAgIH0pLmdldE9yKHt9KSksIHtcbiAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGdldCQ2KGlucHV0LmVsZW1lbnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoaW5wdXQsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBnZXQkNihpbnB1dC5lbGVtZW50KTtcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnQgIT09IGRhdGEpIHtcbiAgICAgICAgICAgICAgICBzZXQkMyhpbnB1dC5lbGVtZW50LCBkYXRhKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG9uU2V0VmFsdWU6IGRldGFpbC5vblNldFZhbHVlXG4gICAgICAgIH0pXSkpO1xuICAgIH07XG4gICAgdmFyIGRvbSQyID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFnOiBkZXRhaWwudGFnLFxuICAgICAgICBhdHRyaWJ1dGVzOiBfX2Fzc2lnbih7IHR5cGU6ICd0ZXh0JyB9LCBkZXRhaWwuaW5wdXRBdHRyaWJ1dGVzKSxcbiAgICAgICAgc3R5bGVzOiBkZXRhaWwuaW5wdXRTdHlsZXMsXG4gICAgICAgIGNsYXNzZXM6IGRldGFpbC5pbnB1dENsYXNzZXNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBmYWN0b3J5JDUgPSBmdW5jdGlvbiAoZGV0YWlsLCBfc3BlYykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRvbSQyKGRldGFpbCksXG4gICAgICAgIGNvbXBvbmVudHM6IFtdLFxuICAgICAgICBiZWhhdmlvdXJzOiBiZWhhdmlvdXJzKGRldGFpbCksXG4gICAgICAgIGV2ZW50T3JkZXI6IGRldGFpbC5ldmVudE9yZGVyXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIElucHV0ID0gc2luZ2xlJDIoe1xuICAgICAgbmFtZTogJ0lucHV0JyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogc2NoZW1hJGYoKSxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnkkNVxuICAgIH0pO1xuXG4gICAgdmFyIGV4cG9ydHMkMSA9IHt9LCBtb2R1bGUgPSB7IGV4cG9ydHM6IGV4cG9ydHMkMSB9O1xuICAgIChmdW5jdGlvbiAoZGVmaW5lLCBleHBvcnRzLCBtb2R1bGUsIHJlcXVpcmUpIHtcbiAgICAgIChmdW5jdGlvbiAoZikge1xuICAgICAgICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgICAgICAgZGVmaW5lKFtdLCBmKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgZztcbiAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGcgPSB3aW5kb3c7XG4gICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgZyA9IGdsb2JhbDtcbiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgZyA9IHNlbGY7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGcgPSB0aGlzO1xuICAgICAgICAgIH1cbiAgICAgICAgICBnLkVwaG94Q29udGFjdFdyYXBwZXIgPSBmKCk7XG4gICAgICAgIH1cbiAgICAgIH0oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGZ1bmN0aW9uIHIoZSwgbiwgdCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gbyhpLCBmKSB7XG4gICAgICAgICAgICAgIGlmICghbltpXSkge1xuICAgICAgICAgICAgICAgIGlmICghZVtpXSkge1xuICAgICAgICAgICAgICAgICAgdmFyIGMgPSAnZnVuY3Rpb24nID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmU7XG4gICAgICAgICAgICAgICAgICBpZiAoIWYgJiYgYylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMoaSwgITApO1xuICAgICAgICAgICAgICAgICAgaWYgKHUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1KGksICEwKTtcbiAgICAgICAgICAgICAgICAgIHZhciBhID0gbmV3IEVycm9yKCdDYW5ub3QgZmluZCBtb2R1bGUgXFwnJyArIGkgKyAnXFwnJyk7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBhLmNvZGUgPSAnTU9EVUxFX05PVF9GT1VORCcsIGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwID0gbltpXSA9IHsgZXhwb3J0czoge30gfTtcbiAgICAgICAgICAgICAgICBlW2ldWzBdLmNhbGwocC5leHBvcnRzLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgdmFyIG4gPSBlW2ldWzFdW3JdO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG8obiB8fCByKTtcbiAgICAgICAgICAgICAgICB9LCBwLCBwLmV4cG9ydHMsIHIsIGUsIG4sIHQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBuW2ldLmV4cG9ydHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKHZhciB1ID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlLCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICAgIG8odFtpXSk7XG4gICAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH0oKSh7XG4gICAgICAgICAgMTogW1xuICAgICAgICAgICAgZnVuY3Rpb24gKHJlcXVpcmUsIG1vZHVsZSwgZXhwb3J0cykge1xuICAgICAgICAgICAgICB2YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG4gICAgICAgICAgICAgIHZhciBjYWNoZWRTZXRUaW1lb3V0O1xuICAgICAgICAgICAgICB2YXIgY2FjaGVkQ2xlYXJUaW1lb3V0O1xuICAgICAgICAgICAgICBmdW5jdGlvbiBkZWZhdWx0U2V0VGltb3V0KCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGRlZmF1bHRDbGVhclRpbWVvdXQoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY2xlYXJUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHJ1blRpbWVvdXQoZnVuKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhY2hlZFNldFRpbWVvdXQgPT09IHNldFRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICgoY2FjaGVkU2V0VGltZW91dCA9PT0gZGVmYXVsdFNldFRpbW91dCB8fCAhY2FjaGVkU2V0VGltZW91dCkgJiYgc2V0VGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKG51bGwsIGZ1biwgMCk7XG4gICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZnVuY3Rpb24gcnVuQ2xlYXJUaW1lb3V0KG1hcmtlcikge1xuICAgICAgICAgICAgICAgIGlmIChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGNsZWFyVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKHRoaXMsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHZhciBxdWV1ZSA9IFtdO1xuICAgICAgICAgICAgICB2YXIgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRRdWV1ZTtcbiAgICAgICAgICAgICAgdmFyIHF1ZXVlSW5kZXggPSAtMTtcbiAgICAgICAgICAgICAgZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgICAgICAgICAgICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgIGRyYWluUXVldWUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSBydW5UaW1lb3V0KGNsZWFuVXBOZXh0VGljayk7XG4gICAgICAgICAgICAgICAgZHJhaW5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGxlbikge1xuICAgICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7XG4gICAgICAgICAgICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICAgICAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgICAgICAgICAgICBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBydW5DbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcXVldWUucHVzaChuZXcgSXRlbShmdW4sIGFyZ3MpKTtcbiAgICAgICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoID09PSAxICYmICFkcmFpbmluZykge1xuICAgICAgICAgICAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGZ1bmN0aW9uIEl0ZW0oZnVuLCBhcnJheSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZnVuID0gZnVuO1xuICAgICAgICAgICAgICAgIHRoaXMuYXJyYXkgPSBhcnJheTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBJdGVtLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG4gICAgICAgICAgICAgIHByb2Nlc3MuYnJvd3NlciA9IHRydWU7XG4gICAgICAgICAgICAgIHByb2Nlc3MuZW52ID0ge307XG4gICAgICAgICAgICAgIHByb2Nlc3MuYXJndiA9IFtdO1xuICAgICAgICAgICAgICBwcm9jZXNzLnZlcnNpb24gPSAnJztcbiAgICAgICAgICAgICAgcHJvY2Vzcy52ZXJzaW9ucyA9IHt9O1xuICAgICAgICAgICAgICBmdW5jdGlvbiBub29wKCkge1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHByb2Nlc3Mub24gPSBub29wO1xuICAgICAgICAgICAgICBwcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDtcbiAgICAgICAgICAgICAgcHJvY2Vzcy5vbmNlID0gbm9vcDtcbiAgICAgICAgICAgICAgcHJvY2Vzcy5vZmYgPSBub29wO1xuICAgICAgICAgICAgICBwcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDtcbiAgICAgICAgICAgICAgcHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xuICAgICAgICAgICAgICBwcm9jZXNzLmVtaXQgPSBub29wO1xuICAgICAgICAgICAgICBwcm9jZXNzLnByZXBlbmRMaXN0ZW5lciA9IG5vb3A7XG4gICAgICAgICAgICAgIHByb2Nlc3MucHJlcGVuZE9uY2VMaXN0ZW5lciA9IG5vb3A7XG4gICAgICAgICAgICAgIHByb2Nlc3MubGlzdGVuZXJzID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBwcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJy8nO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBwcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge31cbiAgICAgICAgICBdLFxuICAgICAgICAgIDI6IFtcbiAgICAgICAgICAgIGZ1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHtcbiAgICAgICAgICAgICAgKGZ1bmN0aW9uIChzZXRJbW1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBzZXRUaW1lb3V0RnVuYyA9IHNldFRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICBmdW5jdGlvbiBub29wKCkge1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYmluZChmbiwgdGhpc0FyZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgIGZuLmFwcGx5KHRoaXNBcmcsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBmdW5jdGlvbiBQcm9taXNlKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcyAhPT0gJ29iamVjdCcpXG4gICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignUHJvbWlzZXMgbXVzdCBiZSBjb25zdHJ1Y3RlZCB2aWEgbmV3Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignbm90IGEgZnVuY3Rpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZlcnJlZHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZG9SZXNvbHZlKGZuLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZShzZWxmLCBkZWZlcnJlZCkge1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc2VsZi5fc3RhdGUgPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzZWxmID0gc2VsZi5fdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuX3N0YXRlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGVmZXJyZWRzLnB1c2goZGVmZXJyZWQpO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZWxmLl9oYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5faW1tZWRpYXRlRm4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgIHZhciBjYiA9IHNlbGYuX3N0YXRlID09PSAxID8gZGVmZXJyZWQub25GdWxmaWxsZWQgOiBkZWZlcnJlZC5vblJlamVjdGVkO1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChjYiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgKHNlbGYuX3N0YXRlID09PSAxID8gcmVzb2x2ZSA6IHJlamVjdCkoZGVmZXJyZWQucHJvbWlzZSwgc2VsZi5fdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0O1xuICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBjYihzZWxmLl92YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGRlZmVycmVkLnByb21pc2UsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRlZmVycmVkLnByb21pc2UsIHJldCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZShzZWxmLCBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gc2VsZilcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0EgcHJvbWlzZSBjYW5ub3QgYmUgcmVzb2x2ZWQgd2l0aCBpdHNlbGYuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICYmICh0eXBlb2YgbmV3VmFsdWUgPT09ICdvYmplY3QnIHx8IHR5cGVvZiBuZXdWYWx1ZSA9PT0gJ2Z1bmN0aW9uJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aGVuID0gbmV3VmFsdWUudGhlbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3RhdGUgPSAzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl92YWx1ZSA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGUoc2VsZik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZG9SZXNvbHZlKGJpbmQodGhlbiwgbmV3VmFsdWUpLCBzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zdGF0ZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgc2VsZi5fdmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICBmaW5hbGUoc2VsZik7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZWplY3Qoc2VsZiwgZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlamVjdChzZWxmLCBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9zdGF0ZSA9IDI7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3ZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGZpbmFsZShzZWxmKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmFsZShzZWxmKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLl9zdGF0ZSA9PT0gMiAmJiBzZWxmLl9kZWZlcnJlZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5faW1tZWRpYXRlRm4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWxmLl9oYW5kbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuX3VuaGFuZGxlZFJlamVjdGlvbkZuKHNlbGYuX3ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VsZi5fZGVmZXJyZWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaGFuZGxlKHNlbGYsIHNlbGYuX2RlZmVycmVkc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fZGVmZXJyZWRzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIEhhbmRsZXIob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIHByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkZ1bGZpbGxlZCA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PT0gJ2Z1bmN0aW9uJyA/IG9uRnVsZmlsbGVkIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblJlamVjdGVkID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT09ICdmdW5jdGlvbicgPyBvblJlamVjdGVkIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRvUmVzb2x2ZShmbiwgc2VsZikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZG9uZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgIGZuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzZWxmLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHNlbGYsIHJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGRvbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHNlbGYsIGV4KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgUHJvbWlzZS5wcm90b3R5cGVbJ2NhdGNoJ10gPSBmdW5jdGlvbiAob25SZWplY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKG51bGwsIG9uUmVqZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIFByb21pc2UucHJvdG90eXBlLnRoZW4gPSBmdW5jdGlvbiAob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb20gPSBuZXcgdGhpcy5jb25zdHJ1Y3Rvcihub29wKTtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlKHRoaXMsIG5ldyBIYW5kbGVyKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkLCBwcm9tKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9tO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsID0gZnVuY3Rpb24gKGFycikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoW10pO1xuICAgICAgICAgICAgICAgICAgICAgIHZhciByZW1haW5pbmcgPSBhcmdzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiByZXMoaSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsICYmICh0eXBlb2YgdmFsID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aGVuID0gdmFsLnRoZW47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVuLmNhbGwodmFsLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyhpLCB2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tcmVtYWluaW5nID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMoaSwgYXJnc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIFByb21pc2UucmVqZWN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgUHJvbWlzZS5yYWNlID0gZnVuY3Rpb24gKHZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tpXS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICBQcm9taXNlLl9pbW1lZGlhdGVGbiA9IHR5cGVvZiBzZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicgPyBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGZuKTtcbiAgICAgICAgICAgICAgICAgIH0gOiBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dEZ1bmMoZm4sIDApO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIFByb21pc2UuX3VuaGFuZGxlZFJlamVjdGlvbkZuID0gZnVuY3Rpb24gX3VuaGFuZGxlZFJlamVjdGlvbkZuKGVycikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1Bvc3NpYmxlIFVuaGFuZGxlZCBQcm9taXNlIFJlamVjdGlvbjonLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgUHJvbWlzZS5fc2V0SW1tZWRpYXRlRm4gPSBmdW5jdGlvbiBfc2V0SW1tZWRpYXRlRm4oZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5faW1tZWRpYXRlRm4gPSBmbjtcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICBQcm9taXNlLl9zZXRVbmhhbmRsZWRSZWplY3Rpb25GbiA9IGZ1bmN0aW9uIF9zZXRVbmhhbmRsZWRSZWplY3Rpb25Gbihmbikge1xuICAgICAgICAgICAgICAgICAgICBQcm9taXNlLl91bmhhbmRsZWRSZWplY3Rpb25GbiA9IGZuO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IFByb21pc2U7XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFyb290LlByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcm9vdC5Qcm9taXNlID0gUHJvbWlzZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KHRoaXMpKTtcbiAgICAgICAgICAgICAgfS5jYWxsKHRoaXMsIHJlcXVpcmUoJ3RpbWVycycpLnNldEltbWVkaWF0ZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgJ3RpbWVycyc6IDMgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgMzogW1xuICAgICAgICAgICAgZnVuY3Rpb24gKHJlcXVpcmUsIG1vZHVsZSwgZXhwb3J0cykge1xuICAgICAgICAgICAgICAoZnVuY3Rpb24gKHNldEltbWVkaWF0ZSwgY2xlYXJJbW1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dFRpY2sgPSByZXF1aXJlKCdwcm9jZXNzL2Jyb3dzZXIuanMnKS5uZXh0VGljaztcbiAgICAgICAgICAgICAgICB2YXIgYXBwbHkgPSBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHk7XG4gICAgICAgICAgICAgICAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xuICAgICAgICAgICAgICAgIHZhciBpbW1lZGlhdGVJZHMgPSB7fTtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEltbWVkaWF0ZUlkID0gMDtcbiAgICAgICAgICAgICAgICBleHBvcnRzLnNldFRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVvdXQoYXBwbHkuY2FsbChzZXRUaW1lb3V0LCB3aW5kb3csIGFyZ3VtZW50cyksIGNsZWFyVGltZW91dCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBleHBvcnRzLnNldEludGVydmFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lb3V0KGFwcGx5LmNhbGwoc2V0SW50ZXJ2YWwsIHdpbmRvdywgYXJndW1lbnRzKSwgY2xlYXJJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmNsZWFyVGltZW91dCA9IGV4cG9ydHMuY2xlYXJJbnRlcnZhbCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgICB0aW1lb3V0LmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBUaW1lb3V0KGlkLCBjbGVhckZuKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLl9pZCA9IGlkO1xuICAgICAgICAgICAgICAgICAgdGhpcy5fY2xlYXJGbiA9IGNsZWFyRm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFRpbWVvdXQucHJvdG90eXBlLnVucmVmID0gVGltZW91dC5wcm90b3R5cGUucmVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgVGltZW91dC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLl9jbGVhckZuLmNhbGwod2luZG93LCB0aGlzLl9pZCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBleHBvcnRzLmVucm9sbCA9IGZ1bmN0aW9uIChpdGVtLCBtc2Vjcykge1xuICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGl0ZW0uX2lkbGVUaW1lb3V0SWQpO1xuICAgICAgICAgICAgICAgICAgaXRlbS5faWRsZVRpbWVvdXQgPSBtc2VjcztcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGV4cG9ydHMudW5lbnJvbGwgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGl0ZW0uX2lkbGVUaW1lb3V0SWQpO1xuICAgICAgICAgICAgICAgICAgaXRlbS5faWRsZVRpbWVvdXQgPSAtMTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGV4cG9ydHMuX3VucmVmQWN0aXZlID0gZXhwb3J0cy5hY3RpdmUgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGl0ZW0uX2lkbGVUaW1lb3V0SWQpO1xuICAgICAgICAgICAgICAgICAgdmFyIG1zZWNzID0gaXRlbS5faWRsZVRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgICBpZiAobXNlY3MgPj0gMCkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLl9pZGxlVGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiBvblRpbWVvdXQoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uX29uVGltZW91dClcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uX29uVGltZW91dCgpO1xuICAgICAgICAgICAgICAgICAgICB9LCBtc2Vjcyk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBleHBvcnRzLnNldEltbWVkaWF0ZSA9IHR5cGVvZiBzZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicgPyBzZXRJbW1lZGlhdGUgOiBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgICAgICAgICAgIHZhciBpZCA9IG5leHRJbW1lZGlhdGVJZCsrO1xuICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoIDwgMiA/IGZhbHNlIDogc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlSWRzW2lkXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICBuZXh0VGljayhmdW5jdGlvbiBvbk5leHRUaWNrKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW1tZWRpYXRlSWRzW2lkXSkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmbi5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm4uY2FsbChudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgZXhwb3J0cy5jbGVhckltbWVkaWF0ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5jbGVhckltbWVkaWF0ZSA9IHR5cGVvZiBjbGVhckltbWVkaWF0ZSA9PT0gJ2Z1bmN0aW9uJyA/IGNsZWFySW1tZWRpYXRlIDogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICBkZWxldGUgaW1tZWRpYXRlSWRzW2lkXTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICB9LmNhbGwodGhpcywgcmVxdWlyZSgndGltZXJzJykuc2V0SW1tZWRpYXRlLCByZXF1aXJlKCd0aW1lcnMnKS5jbGVhckltbWVkaWF0ZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgJ3Byb2Nlc3MvYnJvd3Nlci5qcyc6IDEsXG4gICAgICAgICAgICAgICd0aW1lcnMnOiAzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICA0OiBbXG4gICAgICAgICAgICBmdW5jdGlvbiAocmVxdWlyZSwgbW9kdWxlLCBleHBvcnRzKSB7XG4gICAgICAgICAgICAgIHZhciBwcm9taXNlUG9seWZpbGwgPSByZXF1aXJlKCdwcm9taXNlLXBvbHlmaWxsJyk7XG4gICAgICAgICAgICAgIHZhciBHbG9iYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gRnVuY3Rpb24oJ3JldHVybiB0aGlzOycpKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0geyBib2x0RXhwb3J0OiBHbG9iYWwuUHJvbWlzZSB8fCBwcm9taXNlUG9seWZpbGwgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICdwcm9taXNlLXBvbHlmaWxsJzogMiB9XG4gICAgICAgICAgXVxuICAgICAgICB9LCB7fSwgWzRdKSg0KTtcbiAgICAgIH0pKTtcbiAgICB9KHVuZGVmaW5lZCwgZXhwb3J0cyQxLCBtb2R1bGUsIHVuZGVmaW5lZCkpO1xuICAgIHZhciBQcm9taXNlID0gbW9kdWxlLmV4cG9ydHMuYm9sdEV4cG9ydDtcblxuICAgIHZhciBudSRhID0gZnVuY3Rpb24gKGJhc2VGbikge1xuICAgICAgdmFyIGRhdGEgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICB2YXIgY2FsbGJhY2tzID0gW107XG4gICAgICB2YXIgbWFwID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIG51JGEoZnVuY3Rpb24gKG5DYWxsYmFjaykge1xuICAgICAgICAgIGdldChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgbkNhbGxiYWNrKGYoZGF0YSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKG5DYWxsYmFjaykge1xuICAgICAgICBpZiAoaXNSZWFkeSgpKSB7XG4gICAgICAgICAgY2FsbChuQ2FsbGJhY2spO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhbGxiYWNrcy5wdXNoKG5DYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgaWYgKCFpc1JlYWR5KCkpIHtcbiAgICAgICAgICBkYXRhID0gT3B0aW9uYWwuc29tZSh4KTtcbiAgICAgICAgICBydW4oY2FsbGJhY2tzKTtcbiAgICAgICAgICBjYWxsYmFja3MgPSBbXTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBpc1JlYWR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZGF0YS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgcnVuID0gZnVuY3Rpb24gKGNicykge1xuICAgICAgICBlYWNoKGNicywgY2FsbCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAoY2IpIHtcbiAgICAgICAgZGF0YS5lYWNoKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjYih4KTtcbiAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgYmFzZUZuKHNldCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgIGlzUmVhZHk6IGlzUmVhZHlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcHVyZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICByZXR1cm4gbnUkYShmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2soYSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBMYXp5VmFsdWUgPSB7XG4gICAgICBudTogbnUkYSxcbiAgICAgIHB1cmU6IHB1cmVcbiAgICB9O1xuXG4gICAgdmFyIGVycm9yUmVwb3J0ZXIgPSBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICB2YXIgbWFrZSQzID0gZnVuY3Rpb24gKHJ1bikge1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICBydW4oKS50aGVuKGNhbGxiYWNrLCBlcnJvclJlcG9ydGVyKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwID0gZnVuY3Rpb24gKGZhYikge1xuICAgICAgICByZXR1cm4gbWFrZSQzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcnVuKCkudGhlbihmYWIpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChhRnV0dXJlQikge1xuICAgICAgICByZXR1cm4gbWFrZSQzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcnVuKCkudGhlbihmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgcmV0dXJuIGFGdXR1cmVCKHYpLnRvUHJvbWlzZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgYW5vbkJpbmQgPSBmdW5jdGlvbiAoZnV0dXJlQikge1xuICAgICAgICByZXR1cm4gbWFrZSQzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcnVuKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZnV0dXJlQi50b1Byb21pc2UoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHRvTGF6eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIExhenlWYWx1ZS5udShnZXQpO1xuICAgICAgfTtcbiAgICAgIHZhciB0b0NhY2hlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNhY2hlID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIG1ha2UkMyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKGNhY2hlID09PSBudWxsKSB7XG4gICAgICAgICAgICBjYWNoZSA9IHJ1bigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY2FjaGU7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b1Byb21pc2UgPSBydW47XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgYW5vbkJpbmQ6IGFub25CaW5kLFxuICAgICAgICB0b0xhenk6IHRvTGF6eSxcbiAgICAgICAgdG9DYWNoZWQ6IHRvQ2FjaGVkLFxuICAgICAgICB0b1Byb21pc2U6IHRvUHJvbWlzZSxcbiAgICAgICAgZ2V0OiBnZXRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbnUkYiA9IGZ1bmN0aW9uIChiYXNlRm4pIHtcbiAgICAgIHJldHVybiBtYWtlJDMoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoYmFzZUZuKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHB1cmUkMSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICByZXR1cm4gbWFrZSQzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShhKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIEZ1dHVyZSA9IHtcbiAgICAgIG51OiBudSRiLFxuICAgICAgcHVyZTogcHVyZSQxXG4gICAgfTtcblxuICAgIHZhciBhcmlhRWxlbWVudHMgPSBbXG4gICAgICAnaW5wdXQnLFxuICAgICAgJ3RleHRhcmVhJ1xuICAgIF07XG4gICAgdmFyIGlzQXJpYUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgdmFyIG5hbWUkMSA9IG5hbWUoZWxlbSk7XG4gICAgICByZXR1cm4gY29udGFpbnMoYXJpYUVsZW1lbnRzLCBuYW1lJDEpO1xuICAgIH07XG4gICAgdmFyIG1hcmtWYWxpZCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGludmFsaWRDb25maWcpIHtcbiAgICAgIHZhciBlbGVtID0gaW52YWxpZENvbmZpZy5nZXRSb290KGNvbXBvbmVudCkuZ2V0T3IoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgcmVtb3ZlJDQoZWxlbSwgaW52YWxpZENvbmZpZy5pbnZhbGlkQ2xhc3MpO1xuICAgICAgaW52YWxpZENvbmZpZy5ub3RpZnkuZWFjaChmdW5jdGlvbiAobm90aWZ5SW5mbykge1xuICAgICAgICBpZiAoaXNBcmlhRWxlbWVudChjb21wb25lbnQuZWxlbWVudCkpIHtcbiAgICAgICAgICBzZXQkMShjb21wb25lbnQuZWxlbWVudCwgJ2FyaWEtaW52YWxpZCcsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBub3RpZnlJbmZvLmdldENvbnRhaW5lcihjb21wb25lbnQpLmVhY2goZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgIHNldChjb250YWluZXIsIG5vdGlmeUluZm8udmFsaWRIdG1sKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG5vdGlmeUluZm8ub25WYWxpZChjb21wb25lbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWFya0ludmFsaWQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBpbnZhbGlkQ29uZmlnLCBpbnZhbGlkU3RhdGUsIHRleHQpIHtcbiAgICAgIHZhciBlbGVtID0gaW52YWxpZENvbmZpZy5nZXRSb290KGNvbXBvbmVudCkuZ2V0T3IoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgYWRkJDIoZWxlbSwgaW52YWxpZENvbmZpZy5pbnZhbGlkQ2xhc3MpO1xuICAgICAgaW52YWxpZENvbmZpZy5ub3RpZnkuZWFjaChmdW5jdGlvbiAobm90aWZ5SW5mbykge1xuICAgICAgICBpZiAoaXNBcmlhRWxlbWVudChjb21wb25lbnQuZWxlbWVudCkpIHtcbiAgICAgICAgICBzZXQkMShjb21wb25lbnQuZWxlbWVudCwgJ2FyaWEtaW52YWxpZCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIG5vdGlmeUluZm8uZ2V0Q29udGFpbmVyKGNvbXBvbmVudCkuZWFjaChmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgc2V0KGNvbnRhaW5lciwgdGV4dCk7XG4gICAgICAgIH0pO1xuICAgICAgICBub3RpZnlJbmZvLm9uSW52YWxpZChjb21wb25lbnQsIHRleHQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcXVlcnkgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBpbnZhbGlkQ29uZmlnLCBfaW52YWxpZFN0YXRlKSB7XG4gICAgICByZXR1cm4gaW52YWxpZENvbmZpZy52YWxpZGF0b3IuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBGdXR1cmUucHVyZShSZXN1bHQudmFsdWUodHJ1ZSkpO1xuICAgICAgfSwgZnVuY3Rpb24gKHZhbGlkYXRvckluZm8pIHtcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRvckluZm8udmFsaWRhdGUoY29tcG9uZW50KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJ1biQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgaW52YWxpZENvbmZpZywgaW52YWxpZFN0YXRlKSB7XG4gICAgICBpbnZhbGlkQ29uZmlnLm5vdGlmeS5lYWNoKGZ1bmN0aW9uIChub3RpZnlJbmZvKSB7XG4gICAgICAgIG5vdGlmeUluZm8ub25WYWxpZGF0ZShjb21wb25lbnQpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcXVlcnkoY29tcG9uZW50LCBpbnZhbGlkQ29uZmlnKS5tYXAoZnVuY3Rpb24gKHZhbGlkKSB7XG4gICAgICAgIGlmIChjb21wb25lbnQuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgIHJldHVybiB2YWxpZC5mb2xkKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIG1hcmtJbnZhbGlkKGNvbXBvbmVudCwgaW52YWxpZENvbmZpZywgaW52YWxpZFN0YXRlLCBlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnJvcihlcnIpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICBtYXJrVmFsaWQoY29tcG9uZW50LCBpbnZhbGlkQ29uZmlnKTtcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQudmFsdWUodik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnJvcignTm8gbG9uZ2VyIGluIHN5c3RlbScpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpc0ludmFsaWQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBpbnZhbGlkQ29uZmlnKSB7XG4gICAgICB2YXIgZWxlbSA9IGludmFsaWRDb25maWcuZ2V0Um9vdChjb21wb25lbnQpLmdldE9yKGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIHJldHVybiBoYXMkMihlbGVtLCBpbnZhbGlkQ29uZmlnLmludmFsaWRDbGFzcyk7XG4gICAgfTtcblxuICAgIHZhciBJbnZhbGlkYXRlQXBpcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBtYXJrVmFsaWQ6IG1hcmtWYWxpZCxcbiAgICAgICAgbWFya0ludmFsaWQ6IG1hcmtJbnZhbGlkLFxuICAgICAgICBxdWVyeTogcXVlcnksXG4gICAgICAgIHJ1bjogcnVuJDEsXG4gICAgICAgIGlzSW52YWxpZDogaXNJbnZhbGlkXG4gICAgfSk7XG5cbiAgICB2YXIgZXZlbnRzJGEgPSBmdW5jdGlvbiAoaW52YWxpZENvbmZpZywgaW52YWxpZFN0YXRlKSB7XG4gICAgICByZXR1cm4gaW52YWxpZENvbmZpZy52YWxpZGF0b3IubWFwKGZ1bmN0aW9uICh2YWxpZGF0b3JJbmZvKSB7XG4gICAgICAgIHJldHVybiBkZXJpdmUoW3J1bih2YWxpZGF0b3JJbmZvLm9uRXZlbnQsIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIHJ1biQxKGNvbXBvbmVudCwgaW52YWxpZENvbmZpZywgaW52YWxpZFN0YXRlKS5nZXQoaWRlbnRpdHkpO1xuICAgICAgICAgIH0pXS5jb25jYXQodmFsaWRhdG9ySW5mby52YWxpZGF0ZU9uTG9hZCA/IFtydW5PbkF0dGFjaGVkKGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIHJ1biQxKGNvbXBvbmVudCwgaW52YWxpZENvbmZpZywgaW52YWxpZFN0YXRlKS5nZXQobm9vcCk7XG4gICAgICAgICAgfSldIDogW10pKTtcbiAgICAgIH0pLmdldE9yKHt9KTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZUludmFsaWRhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkYVxuICAgIH0pO1xuXG4gICAgdmFyIEludmFsaWRhdGVTY2hlbWEgPSBbXG4gICAgICBzdHJpY3QkMSgnaW52YWxpZENsYXNzJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnZ2V0Um9vdCcsIE9wdGlvbmFsLm5vbmUpLFxuICAgICAgb3B0aW9uT2JqT2YoJ25vdGlmeScsIFtcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2FyaWEnLCAnYWxlcnQnKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2dldENvbnRhaW5lcicsIE9wdGlvbmFsLm5vbmUpLFxuICAgICAgICBkZWZhdWx0ZWQkMSgndmFsaWRIdG1sJywgJycpLFxuICAgICAgICBvbkhhbmRsZXIoJ29uVmFsaWQnKSxcbiAgICAgICAgb25IYW5kbGVyKCdvbkludmFsaWQnKSxcbiAgICAgICAgb25IYW5kbGVyKCdvblZhbGlkYXRlJylcbiAgICAgIF0pLFxuICAgICAgb3B0aW9uT2JqT2YoJ3ZhbGlkYXRvcicsIFtcbiAgICAgICAgc3RyaWN0JDEoJ3ZhbGlkYXRlJyksXG4gICAgICAgIGRlZmF1bHRlZCQxKCdvbkV2ZW50JywgJ2lucHV0JyksXG4gICAgICAgIGRlZmF1bHRlZCQxKCd2YWxpZGF0ZU9uTG9hZCcsIHRydWUpXG4gICAgICBdKVxuICAgIF07XG5cbiAgICB2YXIgSW52YWxpZGF0aW5nID0gY3JlYXRlJDEoe1xuICAgICAgZmllbGRzOiBJbnZhbGlkYXRlU2NoZW1hLFxuICAgICAgbmFtZTogJ2ludmFsaWRhdGluZycsXG4gICAgICBhY3RpdmU6IEFjdGl2ZUludmFsaWRhdGUsXG4gICAgICBhcGlzOiBJbnZhbGlkYXRlQXBpcyxcbiAgICAgIGV4dHJhOiB7XG4gICAgICAgIHZhbGlkYXRpb246IGZ1bmN0aW9uICh2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgdmFyIHYgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoY29tcG9uZW50KTtcbiAgICAgICAgICAgIHJldHVybiBGdXR1cmUucHVyZSh2YWxpZGF0b3IodikpO1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBnZXRDb3VwbGVkID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY291cGxlQ29uZmlnLCBjb3VwbGVTdGF0ZSwgbmFtZSkge1xuICAgICAgcmV0dXJuIGNvdXBsZVN0YXRlLmdldE9yQ3JlYXRlKGNvbXBvbmVudCwgY291cGxlQ29uZmlnLCBuYW1lKTtcbiAgICB9O1xuXG4gICAgdmFyIENvdXBsaW5nQXBpcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBnZXRDb3VwbGVkOiBnZXRDb3VwbGVkXG4gICAgfSk7XG5cbiAgICB2YXIgQ291cGxpbmdTY2hlbWEgPSBbc3RyaWN0T2YoJ290aGVycycsIHNldE9mJDEoUmVzdWx0LnZhbHVlLCBhbnlWYWx1ZSQxKCkpKV07XG5cbiAgICB2YXIgaW5pdCQ1ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGNvdXBsZWQgPSB7fTtcbiAgICAgIHZhciBnZXRPckNyZWF0ZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGNvdXBsZUNvbmZpZywgbmFtZSkge1xuICAgICAgICB2YXIgYXZhaWxhYmxlID0ga2V5cyhjb3VwbGVDb25maWcub3RoZXJzKTtcbiAgICAgICAgaWYgKCFhdmFpbGFibGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBmaW5kIGNvdXBsZWQgY29tcG9uZW50OiAnICsgbmFtZSArICcuIEtub3duIGNvdXBsZWQgY29tcG9uZW50czogJyArIEpTT04uc3RyaW5naWZ5KGF2YWlsYWJsZSwgbnVsbCwgMikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBnZXQkMShjb3VwbGVkLCBuYW1lKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBidWlsZGVyID0gZ2V0JDEoY291cGxlQ29uZmlnLm90aGVycywgbmFtZSkuZ2V0T3JEaWUoJ05vIGluZm9ybWF0aW9uIGZvdW5kIGZvciBjb3VwbGVkIGNvbXBvbmVudDogJyArIG5hbWUpO1xuICAgICAgICAgICAgdmFyIHNwZWMgPSBidWlsZGVyKGNvbXBvbmVudCk7XG4gICAgICAgICAgICB2YXIgYnVpbHQgPSBjb21wb25lbnQuZ2V0U3lzdGVtKCkuYnVpbGQoc3BlYyk7XG4gICAgICAgICAgICBjb3VwbGVkW25hbWVdID0gYnVpbHQ7XG4gICAgICAgICAgICByZXR1cm4gYnVpbHQ7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgcmVhZFN0YXRlID0gY29uc3RhbnQoe30pO1xuICAgICAgcmV0dXJuIG51JDUoe1xuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZSxcbiAgICAgICAgZ2V0T3JDcmVhdGU6IGdldE9yQ3JlYXRlXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIENvdXBsaW5nU3RhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgaW5pdDogaW5pdCQ1XG4gICAgfSk7XG5cbiAgICB2YXIgQ291cGxpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IENvdXBsaW5nU2NoZW1hLFxuICAgICAgbmFtZTogJ2NvdXBsaW5nJyxcbiAgICAgIGFwaXM6IENvdXBsaW5nQXBpcyxcbiAgICAgIHN0YXRlOiBDb3VwbGluZ1N0YXRlXG4gICAgfSk7XG5cbiAgICB2YXIgc3VmZml4ID0gY29uc3RhbnQoJ3NpbmsnKTtcbiAgICB2YXIgcGFydFR5cGUgPSBjb25zdGFudChvcHRpb25hbCh7XG4gICAgICBuYW1lOiBzdWZmaXgoKSxcbiAgICAgIG92ZXJyaWRlczogY29uc3RhbnQoe1xuICAgICAgICBkb206IHsgdGFnOiAnZGl2JyB9LFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbUG9zaXRpb25pbmcuY29uZmlnKHsgdXNlRml4ZWQ6IGFsd2F5cyB9KV0pLFxuICAgICAgICBldmVudHM6IGRlcml2ZShbXG4gICAgICAgICAgY3V0dGVyKGtleWRvd24oKSksXG4gICAgICAgICAgY3V0dGVyKG1vdXNlZG93bigpKSxcbiAgICAgICAgICBjdXR0ZXIoY2xpY2soKSlcbiAgICAgICAgXSlcbiAgICAgIH0pXG4gICAgfSkpO1xuXG4gICAgdmFyIEhpZ2hsaWdodE9uT3BlbjtcbiAgICAoZnVuY3Rpb24gKEhpZ2hsaWdodE9uT3Blbikge1xuICAgICAgSGlnaGxpZ2h0T25PcGVuW0hpZ2hsaWdodE9uT3BlblsnSGlnaGxpZ2h0Rmlyc3QnXSA9IDBdID0gJ0hpZ2hsaWdodEZpcnN0JztcbiAgICAgIEhpZ2hsaWdodE9uT3BlbltIaWdobGlnaHRPbk9wZW5bJ0hpZ2hsaWdodE5vbmUnXSA9IDFdID0gJ0hpZ2hsaWdodE5vbmUnO1xuICAgIH0oSGlnaGxpZ2h0T25PcGVuIHx8IChIaWdobGlnaHRPbk9wZW4gPSB7fSkpKTtcbiAgICB2YXIgZ2V0QW5jaG9yID0gZnVuY3Rpb24gKGRldGFpbCwgY29tcG9uZW50KSB7XG4gICAgICB2YXIgaG90c3BvdCA9IGRldGFpbC5nZXRIb3RzcG90KGNvbXBvbmVudCkuZ2V0T3IoY29tcG9uZW50KTtcbiAgICAgIHZhciBhbmNob3IgPSAnaG90c3BvdCc7XG4gICAgICB2YXIgb3ZlcnJpZGVzID0gZGV0YWlsLmdldEFuY2hvck92ZXJyaWRlcygpO1xuICAgICAgcmV0dXJuIGRldGFpbC5sYXlvdXRzLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFuY2hvcjogYW5jaG9yLFxuICAgICAgICAgIGhvdHNwb3Q6IGhvdHNwb3QsXG4gICAgICAgICAgb3ZlcnJpZGVzOiBvdmVycmlkZXNcbiAgICAgICAgfTtcbiAgICAgIH0sIGZ1bmN0aW9uIChsYXlvdXRzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiBhbmNob3IsXG4gICAgICAgICAgaG90c3BvdDogaG90c3BvdCxcbiAgICAgICAgICBvdmVycmlkZXM6IG92ZXJyaWRlcyxcbiAgICAgICAgICBsYXlvdXRzOiBsYXlvdXRzXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmZXRjaCA9IGZ1bmN0aW9uIChkZXRhaWwsIG1hcEZldGNoLCBjb21wb25lbnQpIHtcbiAgICAgIHZhciBmZXRjaGVyID0gZGV0YWlsLmZldGNoO1xuICAgICAgcmV0dXJuIGZldGNoZXIoY29tcG9uZW50KS5tYXAobWFwRmV0Y2gpO1xuICAgIH07XG4gICAgdmFyIG9wZW5GID0gZnVuY3Rpb24gKGRldGFpbCwgbWFwRmV0Y2gsIGFuY2hvciwgY29tcG9uZW50LCBzYW5kYm94LCBleHRlcm5hbHMsIGhpZ2hsaWdodE9uT3Blbikge1xuICAgICAgdmFyIGZ1dHVyZURhdGEgPSBmZXRjaChkZXRhaWwsIG1hcEZldGNoLCBjb21wb25lbnQpO1xuICAgICAgdmFyIGdldExhenlTaW5rID0gZ2V0U2luayhjb21wb25lbnQsIGRldGFpbCk7XG4gICAgICByZXR1cm4gZnV0dXJlRGF0YS5tYXAoZnVuY3Rpb24gKHRkYXRhKSB7XG4gICAgICAgIHJldHVybiB0ZGF0YS5iaW5kKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20odGllcmVkTWVudS5za2V0Y2goX19hc3NpZ24oX19hc3NpZ24oe30sIGV4dGVybmFscy5tZW51KCkpLCB7XG4gICAgICAgICAgICB1aWQ6IGdlbmVyYXRlJDIoJycpLFxuICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgIGhpZ2hsaWdodEltbWVkaWF0ZWx5OiBoaWdobGlnaHRPbk9wZW4gPT09IEhpZ2hsaWdodE9uT3Blbi5IaWdobGlnaHRGaXJzdCxcbiAgICAgICAgICAgIG9uT3Blbk1lbnU6IGZ1bmN0aW9uICh0bWVudSwgbWVudSkge1xuICAgICAgICAgICAgICB2YXIgc2luayA9IGdldExhenlTaW5rKCkuZ2V0T3JEaWUoKTtcbiAgICAgICAgICAgICAgUG9zaXRpb25pbmcucG9zaXRpb24oc2luaywgYW5jaG9yLCBtZW51KTtcbiAgICAgICAgICAgICAgU2FuZGJveGluZy5kZWNsb2FrKHNhbmRib3gpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uT3BlblN1Ym1lbnU6IGZ1bmN0aW9uICh0bWVudSwgaXRlbSwgc3VibWVudSkge1xuICAgICAgICAgICAgICB2YXIgc2luayA9IGdldExhenlTaW5rKCkuZ2V0T3JEaWUoKTtcbiAgICAgICAgICAgICAgUG9zaXRpb25pbmcucG9zaXRpb24oc2luaywge1xuICAgICAgICAgICAgICAgIGFuY2hvcjogJ3N1Ym1lbnUnLFxuICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW1cbiAgICAgICAgICAgICAgfSwgc3VibWVudSk7XG4gICAgICAgICAgICAgIFNhbmRib3hpbmcuZGVjbG9hayhzYW5kYm94KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblJlcG9zaXRpb25NZW51OiBmdW5jdGlvbiAodG1lbnUsIHByaW1hcnlNZW51LCBzdWJtZW51VHJpZ2dlcnMpIHtcbiAgICAgICAgICAgICAgdmFyIHNpbmsgPSBnZXRMYXp5U2luaygpLmdldE9yRGllKCk7XG4gICAgICAgICAgICAgIFBvc2l0aW9uaW5nLnBvc2l0aW9uKHNpbmssIGFuY2hvciwgcHJpbWFyeU1lbnUpO1xuICAgICAgICAgICAgICBlYWNoKHN1Ym1lbnVUcmlnZ2VycywgZnVuY3Rpb24gKHN0KSB7XG4gICAgICAgICAgICAgICAgUG9zaXRpb25pbmcucG9zaXRpb24oc2luaywge1xuICAgICAgICAgICAgICAgICAgYW5jaG9yOiAnc3VibWVudScsXG4gICAgICAgICAgICAgICAgICBpdGVtOiBzdC50cmlnZ2VyaW5nSXRlbVxuICAgICAgICAgICAgICAgIH0sIHN0LnRyaWdnZXJlZE1lbnUpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBGb2N1c2luZy5mb2N1cyhjb21wb25lbnQpO1xuICAgICAgICAgICAgICBTYW5kYm94aW5nLmNsb3NlKHNhbmRib3gpO1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG9wZW4kMSA9IGZ1bmN0aW9uIChkZXRhaWwsIG1hcEZldGNoLCBob3RzcG90LCBzYW5kYm94LCBleHRlcm5hbHMsIG9uT3BlblN5bmMsIGhpZ2hsaWdodE9uT3Blbikge1xuICAgICAgdmFyIGFuY2hvciA9IGdldEFuY2hvcihkZXRhaWwsIGhvdHNwb3QpO1xuICAgICAgdmFyIHByb2Nlc3NlZCA9IG9wZW5GKGRldGFpbCwgbWFwRmV0Y2gsIGFuY2hvciwgaG90c3BvdCwgc2FuZGJveCwgZXh0ZXJuYWxzLCBoaWdobGlnaHRPbk9wZW4pO1xuICAgICAgcmV0dXJuIHByb2Nlc3NlZC5tYXAoZnVuY3Rpb24gKHRkYXRhKSB7XG4gICAgICAgIHRkYXRhLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChTYW5kYm94aW5nLmlzT3BlbihzYW5kYm94KSkge1xuICAgICAgICAgICAgU2FuZGJveGluZy5jbG9zZShzYW5kYm94KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgU2FuZGJveGluZy5jbG9hayhzYW5kYm94KTtcbiAgICAgICAgICBTYW5kYm94aW5nLm9wZW4oc2FuZGJveCwgZGF0YSk7XG4gICAgICAgICAgb25PcGVuU3luYyhzYW5kYm94KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzYW5kYm94O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY2xvc2UkMSA9IGZ1bmN0aW9uIChkZXRhaWwsIG1hcEZldGNoLCBjb21wb25lbnQsIHNhbmRib3gsIF9leHRlcm5hbHMsIF9vbk9wZW5TeW5jLCBfaGlnaGxpZ2h0T25PcGVuKSB7XG4gICAgICBTYW5kYm94aW5nLmNsb3NlKHNhbmRib3gpO1xuICAgICAgcmV0dXJuIEZ1dHVyZS5wdXJlKHNhbmRib3gpO1xuICAgIH07XG4gICAgdmFyIHRvZ2dsZVBvcHVwID0gZnVuY3Rpb24gKGRldGFpbCwgbWFwRmV0Y2gsIGhvdHNwb3QsIGV4dGVybmFscywgb25PcGVuU3luYywgaGlnaGxpZ2h0T25PcGVuKSB7XG4gICAgICB2YXIgc2FuZGJveCA9IENvdXBsaW5nLmdldENvdXBsZWQoaG90c3BvdCwgJ3NhbmRib3gnKTtcbiAgICAgIHZhciBzaG93aW5nID0gU2FuZGJveGluZy5pc09wZW4oc2FuZGJveCk7XG4gICAgICB2YXIgYWN0aW9uID0gc2hvd2luZyA/IGNsb3NlJDEgOiBvcGVuJDE7XG4gICAgICByZXR1cm4gYWN0aW9uKGRldGFpbCwgbWFwRmV0Y2gsIGhvdHNwb3QsIHNhbmRib3gsIGV4dGVybmFscywgb25PcGVuU3luYywgaGlnaGxpZ2h0T25PcGVuKTtcbiAgICB9O1xuICAgIHZhciBtYXRjaFdpZHRoID0gZnVuY3Rpb24gKGhvdHNwb3QsIGNvbnRhaW5lciwgdXNlTWluV2lkdGgpIHtcbiAgICAgIHZhciBtZW51ID0gQ29tcG9zaW5nLmdldEN1cnJlbnQoY29udGFpbmVyKS5nZXRPcihjb250YWluZXIpO1xuICAgICAgdmFyIGJ1dHRvbldpZHRoID0gZ2V0JDgoaG90c3BvdC5lbGVtZW50KTtcbiAgICAgIGlmICh1c2VNaW5XaWR0aCkge1xuICAgICAgICBzZXQkMihtZW51LmVsZW1lbnQsICdtaW4td2lkdGgnLCBidXR0b25XaWR0aCArICdweCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0JDQobWVudS5lbGVtZW50LCBidXR0b25XaWR0aCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0U2luayA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgc2lua0RldGFpbCkge1xuICAgICAgcmV0dXJuIGFueUluU3lzdGVtLmdldFN5c3RlbSgpLmdldEJ5VWlkKHNpbmtEZXRhaWwudWlkICsgJy0nICsgc3VmZml4KCkpLm1hcChmdW5jdGlvbiAoaW50ZXJuYWxTaW5rKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFJlc3VsdC52YWx1ZShpbnRlcm5hbFNpbmspO1xuICAgICAgICB9O1xuICAgICAgfSkuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzaW5rRGV0YWlsLmxhenlTaW5rLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycm9yKG5ldyBFcnJvcignTm8gaW50ZXJuYWwgc2luayBpcyBzcGVjaWZpZWQsIG5vciBjb3VsZCBhbiBleHRlcm5hbCBzaW5rIGJlIGZvdW5kJykpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0sIGZ1bmN0aW9uIChsYXp5U2lua0ZuKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBsYXp5U2lua0ZuKGFueUluU3lzdGVtKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRvUmVwb3NpdGlvbk1lbnVzID0gZnVuY3Rpb24gKHNhbmRib3gpIHtcbiAgICAgIFNhbmRib3hpbmcuZ2V0U3RhdGUoc2FuZGJveCkuZWFjaChmdW5jdGlvbiAodG1lbnUpIHtcbiAgICAgICAgdGllcmVkTWVudS5yZXBvc2l0aW9uTWVudXModG1lbnUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWFrZVNhbmRib3ggPSBmdW5jdGlvbiAoZGV0YWlsLCBob3RzcG90LCBleHRyYXMpIHtcbiAgICAgIHZhciBhcmlhT3duZXIgPSBtYW5hZ2VyKCk7XG4gICAgICB2YXIgb25PcGVuID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgbWVudSkge1xuICAgICAgICB2YXIgYW5jaG9yID0gZ2V0QW5jaG9yKGRldGFpbCwgaG90c3BvdCk7XG4gICAgICAgIGFyaWFPd25lci5saW5rKGhvdHNwb3QuZWxlbWVudCk7XG4gICAgICAgIGlmIChkZXRhaWwubWF0Y2hXaWR0aCkge1xuICAgICAgICAgIG1hdGNoV2lkdGgoYW5jaG9yLmhvdHNwb3QsIG1lbnUsIGRldGFpbC51c2VNaW5XaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgZGV0YWlsLm9uT3BlbihhbmNob3IsIGNvbXBvbmVudCwgbWVudSk7XG4gICAgICAgIGlmIChleHRyYXMgIT09IHVuZGVmaW5lZCAmJiBleHRyYXMub25PcGVuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBleHRyYXMub25PcGVuKGNvbXBvbmVudCwgbWVudSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgb25DbG9zZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIG1lbnUpIHtcbiAgICAgICAgYXJpYU93bmVyLnVubGluayhob3RzcG90LmVsZW1lbnQpO1xuICAgICAgICBpZiAoZXh0cmFzICE9PSB1bmRlZmluZWQgJiYgZXh0cmFzLm9uQ2xvc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGV4dHJhcy5vbkNsb3NlKGNvbXBvbmVudCwgbWVudSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgbGF6eVNpbmsgPSBnZXRTaW5rKGhvdHNwb3QsIGRldGFpbCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IGRldGFpbC5zYW5kYm94Q2xhc3NlcyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBpZDogYXJpYU93bmVyLmlkLFxuICAgICAgICAgICAgcm9sZTogJ2xpc3Rib3gnXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBiZWhhdmlvdXJzOiBTa2V0Y2hCZWhhdmlvdXJzLmF1Z21lbnQoZGV0YWlsLnNhbmRib3hCZWhhdmlvdXJzLCBbXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWVtb3J5JyxcbiAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiBob3RzcG90XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgU2FuZGJveGluZy5jb25maWcoe1xuICAgICAgICAgICAgb25PcGVuOiBvbk9wZW4sXG4gICAgICAgICAgICBvbkNsb3NlOiBvbkNsb3NlLFxuICAgICAgICAgICAgaXNQYXJ0T2Y6IGZ1bmN0aW9uIChjb250YWluZXIsIGRhdGEsIHF1ZXJ5RWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gaXNQYXJ0T2YoZGF0YSwgcXVlcnlFbGVtKSB8fCBpc1BhcnRPZihob3RzcG90LCBxdWVyeUVsZW0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEF0dGFjaFBvaW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBsYXp5U2luaygpLmdldE9yRGllKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBmaW5kOiBmdW5jdGlvbiAoc2FuZGJveCkge1xuICAgICAgICAgICAgICByZXR1cm4gU2FuZGJveGluZy5nZXRTdGF0ZShzYW5kYm94KS5iaW5kKGZ1bmN0aW9uIChtZW51KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbXBvc2luZy5nZXRDdXJyZW50KG1lbnUpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBSZWNlaXZpbmcuY29uZmlnKHsgY2hhbm5lbHM6IF9fYXNzaWduKF9fYXNzaWduKHt9LCByZWNlaXZpbmdDaGFubmVsKHsgaXNFeHRyYVBhcnQ6IG5ldmVyIH0pKSwgcmVjZWl2aW5nQ2hhbm5lbCQxKHsgZG9SZXBvc2l0aW9uOiBkb1JlcG9zaXRpb25NZW51cyB9KSkgfSlcbiAgICAgICAgXSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVwb3NpdGlvbk1lbnVzID0gZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgIHZhciBzYW5kYm94ID0gQ291cGxpbmcuZ2V0Q291cGxlZChjb21wLCAnc2FuZGJveCcpO1xuICAgICAgZG9SZXBvc2l0aW9uTWVudXMoc2FuZGJveCk7XG4gICAgfTtcblxuICAgIHZhciBzYW5kYm94RmllbGRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgZGVmYXVsdGVkJDEoJ3NhbmRib3hDbGFzc2VzJywgW10pLFxuICAgICAgICBTa2V0Y2hCZWhhdmlvdXJzLmZpZWxkKCdzYW5kYm94QmVoYXZpb3VycycsIFtcbiAgICAgICAgICBDb21wb3NpbmcsXG4gICAgICAgICAgUmVjZWl2aW5nLFxuICAgICAgICAgIFNhbmRib3hpbmcsXG4gICAgICAgICAgUmVwcmVzZW50aW5nXG4gICAgICAgIF0pXG4gICAgICBdO1xuICAgIH07XG5cbiAgICB2YXIgc2NoZW1hJGcgPSBjb25zdGFudChbXG4gICAgICBzdHJpY3QkMSgnZG9tJyksXG4gICAgICBzdHJpY3QkMSgnZmV0Y2gnKSxcbiAgICAgIG9uSGFuZGxlcignb25PcGVuJyksXG4gICAgICBvbktleWJvYXJkSGFuZGxlcignb25FeGVjdXRlJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnZ2V0SG90c3BvdCcsIE9wdGlvbmFsLnNvbWUpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2dldEFuY2hvck92ZXJyaWRlcycsIGNvbnN0YW50KHt9KSksXG4gICAgICBzY2hlbWEkMSgpLFxuICAgICAgZmllbGQkMSgnZHJvcGRvd25CZWhhdmlvdXJzJywgW1xuICAgICAgICBUb2dnbGluZyxcbiAgICAgICAgQ291cGxpbmcsXG4gICAgICAgIEtleWluZyxcbiAgICAgICAgRm9jdXNpbmdcbiAgICAgIF0pLFxuICAgICAgc3RyaWN0JDEoJ3RvZ2dsZUNsYXNzJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRPcmRlcicsIHt9KSxcbiAgICAgIG9wdGlvbignbGF6eVNpbmsnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdtYXRjaFdpZHRoJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VzZU1pbldpZHRoJywgZmFsc2UpLFxuICAgICAgb3B0aW9uKCdyb2xlJylcbiAgICBdLmNvbmNhdChzYW5kYm94RmllbGRzKCkpKTtcbiAgICB2YXIgcGFydHMkNCA9IGNvbnN0YW50KFtcbiAgICAgIGV4dGVybmFsJDEoe1xuICAgICAgICBzY2hlbWE6IFt0aWVyZWRNZW51TWFya2VycygpXSxcbiAgICAgICAgbmFtZTogJ21lbnUnLFxuICAgICAgICBkZWZhdWx0czogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgIHJldHVybiB7IG9uRXhlY3V0ZTogZGV0YWlsLm9uRXhlY3V0ZSB9O1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHBhcnRUeXBlKClcbiAgICBdKTtcblxuICAgIHZhciBmYWN0b3J5JDYgPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzLCBfc3BlYywgZXh0ZXJuYWxzKSB7XG4gICAgICB2YXIgX2E7XG4gICAgICB2YXIgbG9va3VwQXR0ciA9IGZ1bmN0aW9uIChhdHRyKSB7XG4gICAgICAgIHJldHVybiBnZXQkMShkZXRhaWwuZG9tLCAnYXR0cmlidXRlcycpLmJpbmQoZnVuY3Rpb24gKGF0dHJzKSB7XG4gICAgICAgICAgcmV0dXJuIGdldCQxKGF0dHJzLCBhdHRyKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHN3aXRjaFRvTWVudSA9IGZ1bmN0aW9uIChzYW5kYm94KSB7XG4gICAgICAgIFNhbmRib3hpbmcuZ2V0U3RhdGUoc2FuZGJveCkuZWFjaChmdW5jdGlvbiAodG1lbnUpIHtcbiAgICAgICAgICB0aWVyZWRNZW51LmhpZ2hsaWdodFByaW1hcnkodG1lbnUpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgYWN0aW9uID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICB2YXIgb25PcGVuU3luYyA9IHN3aXRjaFRvTWVudTtcbiAgICAgICAgdG9nZ2xlUG9wdXAoZGV0YWlsLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICB9LCBjb21wb25lbnQsIGV4dGVybmFscywgb25PcGVuU3luYywgSGlnaGxpZ2h0T25PcGVuLkhpZ2hsaWdodEZpcnN0KS5nZXQobm9vcCk7XG4gICAgICB9O1xuICAgICAgdmFyIGFwaXMgPSB7XG4gICAgICAgIGV4cGFuZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICBpZiAoIVRvZ2dsaW5nLmlzT24oY29tcCkpIHtcbiAgICAgICAgICAgIHRvZ2dsZVBvcHVwKGRldGFpbCwgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHg7XG4gICAgICAgICAgICB9LCBjb21wLCBleHRlcm5hbHMsIG5vb3AsIEhpZ2hsaWdodE9uT3Blbi5IaWdobGlnaHROb25lKS5nZXQobm9vcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvcGVuOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIGlmICghVG9nZ2xpbmcuaXNPbihjb21wKSkge1xuICAgICAgICAgICAgdG9nZ2xlUG9wdXAoZGV0YWlsLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICByZXR1cm4geDtcbiAgICAgICAgICAgIH0sIGNvbXAsIGV4dGVybmFscywgbm9vcCwgSGlnaGxpZ2h0T25PcGVuLkhpZ2hsaWdodEZpcnN0KS5nZXQobm9vcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpc09wZW46IFRvZ2dsaW5nLmlzT24sXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIGlmIChUb2dnbGluZy5pc09uKGNvbXApKSB7XG4gICAgICAgICAgICB0b2dnbGVQb3B1cChkZXRhaWwsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICAgICAgfSwgY29tcCwgZXh0ZXJuYWxzLCBub29wLCBIaWdobGlnaHRPbk9wZW4uSGlnaGxpZ2h0Rmlyc3QpLmdldChub29wKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlcG9zaXRpb25NZW51czogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICBpZiAoVG9nZ2xpbmcuaXNPbihjb21wKSkge1xuICAgICAgICAgICAgcmVwb3NpdGlvbk1lbnVzKGNvbXApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciB0cmlnZ2VyRXhlY3V0ZSA9IGZ1bmN0aW9uIChjb21wLCBfc2UpIHtcbiAgICAgICAgZW1pdEV4ZWN1dGUoY29tcCk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxuICAgICAgICBiZWhhdmlvdXJzOiBhdWdtZW50KGRldGFpbC5kcm9wZG93bkJlaGF2aW91cnMsIFtcbiAgICAgICAgICBUb2dnbGluZy5jb25maWcoe1xuICAgICAgICAgICAgdG9nZ2xlQ2xhc3M6IGRldGFpbC50b2dnbGVDbGFzcyxcbiAgICAgICAgICAgIGFyaWE6IHsgbW9kZTogJ2V4cGFuZGVkJyB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgQ291cGxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG90aGVyczoge1xuICAgICAgICAgICAgICBzYW5kYm94OiBmdW5jdGlvbiAoaG90c3BvdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYWtlU2FuZGJveChkZXRhaWwsIGhvdHNwb3QsIHtcbiAgICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9nZ2xpbmcub24oaG90c3BvdCk7XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gVG9nZ2xpbmcub2ZmKGhvdHNwb3QpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnc3BlY2lhbCcsXG4gICAgICAgICAgICBvblNwYWNlOiB0cmlnZ2VyRXhlY3V0ZSxcbiAgICAgICAgICAgIG9uRW50ZXI6IHRyaWdnZXJFeGVjdXRlLFxuICAgICAgICAgICAgb25Eb3duOiBmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgIGlmIChEcm9wZG93bi5pc09wZW4oY29tcCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2FuZGJveCA9IENvdXBsaW5nLmdldENvdXBsZWQoY29tcCwgJ3NhbmRib3gnKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2hUb01lbnUoc2FuZGJveCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgRHJvcGRvd24ub3Blbihjb21wKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBpZiAoRHJvcGRvd24uaXNPcGVuKGNvbXApKSB7XG4gICAgICAgICAgICAgICAgRHJvcGRvd24uY2xvc2UoY29tcCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSlcbiAgICAgICAgXSksXG4gICAgICAgIGV2ZW50czogZXZlbnRzJDcoT3B0aW9uYWwuc29tZShhY3Rpb24pKSxcbiAgICAgICAgZXZlbnRPcmRlcjogX19hc3NpZ24oX19hc3NpZ24oe30sIGRldGFpbC5ldmVudE9yZGVyKSwgKF9hID0ge30sIF9hW2V4ZWN1dGUoKV0gPSBbXG4gICAgICAgICAgJ2Rpc2FibGluZycsXG4gICAgICAgICAgJ3RvZ2dsaW5nJyxcbiAgICAgICAgICAnYWxsb3kuYmFzZS5iZWhhdmlvdXInXG4gICAgICAgIF0sIF9hKSksXG4gICAgICAgIGFwaXM6IGFwaXMsXG4gICAgICAgIGRvbU1vZGlmaWNhdGlvbjoge1xuICAgICAgICAgIGF0dHJpYnV0ZXM6IF9fYXNzaWduKF9fYXNzaWduKHsgJ2FyaWEtaGFzcG9wdXAnOiAndHJ1ZScgfSwgZGV0YWlsLnJvbGUuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKHJvbGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHJvbGU6IHJvbGUgfTtcbiAgICAgICAgICB9KSksIGRldGFpbC5kb20udGFnID09PSAnYnV0dG9uJyA/IHsgdHlwZTogbG9va3VwQXR0cigndHlwZScpLmdldE9yKCdidXR0b24nKSB9IDoge30pXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgRHJvcGRvd24gPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnRHJvcGRvd24nLFxuICAgICAgY29uZmlnRmllbGRzOiBzY2hlbWEkZygpLFxuICAgICAgcGFydEZpZWxkczogcGFydHMkNCgpLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSQ2LFxuICAgICAgYXBpczoge1xuICAgICAgICBvcGVuOiBmdW5jdGlvbiAoYXBpcywgY29tcCkge1xuICAgICAgICAgIHJldHVybiBhcGlzLm9wZW4oY29tcCk7XG4gICAgICAgIH0sXG4gICAgICAgIGV4cGFuZDogZnVuY3Rpb24gKGFwaXMsIGNvbXApIHtcbiAgICAgICAgICByZXR1cm4gYXBpcy5leHBhbmQoY29tcCk7XG4gICAgICAgIH0sXG4gICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoYXBpcywgY29tcCkge1xuICAgICAgICAgIHJldHVybiBhcGlzLmNsb3NlKGNvbXApO1xuICAgICAgICB9LFxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuaXNPcGVuKGNvbXApO1xuICAgICAgICB9LFxuICAgICAgICByZXBvc2l0aW9uTWVudXM6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMucmVwb3NpdGlvbk1lbnVzKGNvbXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgZXhoaWJpdCQ1ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG51JDYoe1xuICAgICAgICBzdHlsZXM6IHtcbiAgICAgICAgICAnLXdlYmtpdC11c2VyLXNlbGVjdCc6ICdub25lJyxcbiAgICAgICAgICAndXNlci1zZWxlY3QnOiAnbm9uZScsXG4gICAgICAgICAgJy1tcy11c2VyLXNlbGVjdCc6ICdub25lJyxcbiAgICAgICAgICAnLW1vei11c2VyLXNlbGVjdCc6ICctbW96LW5vbmUnXG4gICAgICAgIH0sXG4gICAgICAgIGF0dHJpYnV0ZXM6IHsgdW5zZWxlY3RhYmxlOiAnb24nIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGV2ZW50cyRiID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGRlcml2ZShbYWJvcnQoc2VsZWN0c3RhcnQoKSwgYWx3YXlzKV0pO1xuICAgIH07XG5cbiAgICB2YXIgQWN0aXZlVW5zZWxlY3RpbmcgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkYixcbiAgICAgICAgZXhoaWJpdDogZXhoaWJpdCQ1XG4gICAgfSk7XG5cbiAgICB2YXIgVW5zZWxlY3RpbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IFtdLFxuICAgICAgbmFtZTogJ3Vuc2VsZWN0aW5nJyxcbiAgICAgIGFjdGl2ZTogQWN0aXZlVW5zZWxlY3RpbmdcbiAgICB9KTtcblxuICAgIHZhciByZW5kZXJQYW5lbEJ1dHRvbiA9IGZ1bmN0aW9uIChzcGVjLCBzaGFyZWRCYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiBEcm9wZG93bi5za2V0Y2goe1xuICAgICAgICBkb206IHNwZWMuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBzcGVjLmNvbXBvbmVudHMsXG4gICAgICAgIHRvZ2dsZUNsYXNzOiAnbWNlLWFjdGl2ZScsXG4gICAgICAgIGRyb3Bkb3duQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIERpc2FibGluZ0NvbmZpZ3MuYnV0dG9uKHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaXNEaXNhYmxlZCksXG4gICAgICAgICAgcmVjZWl2aW5nQ29uZmlnKCksXG4gICAgICAgICAgVW5zZWxlY3RpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pXG4gICAgICAgIF0pLFxuICAgICAgICBsYXlvdXRzOiBzcGVjLmxheW91dHMsXG4gICAgICAgIHNhbmRib3hDbGFzc2VzOiBbJ3RveC1kaWFsb2dfX3BvcHVwcyddLFxuICAgICAgICBsYXp5U2luazogc2hhcmVkQmFja3N0YWdlLmdldFNpbmssXG4gICAgICAgIGZldGNoOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHJldHVybiBGdXR1cmUubnUoZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gc3BlYy5mZXRjaChjYWxsYmFjayk7XG4gICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oY3JlYXRlVGllcmVkRGF0YUZyb20oZGVlcE1lcmdlKGNyZWF0ZVBhcnRpYWxDaG9pY2VNZW51KGdlbmVyYXRlJDEoJ21lbnUtdmFsdWUnKSwgaXRlbXMsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICBzcGVjLm9uSXRlbUFjdGlvbihjb21wLCB2YWx1ZSk7XG4gICAgICAgICAgICB9LCBzcGVjLmNvbHVtbnMsIHNwZWMucHJlc2V0cywgSXRlbVJlc3BvbnNlJDEuQ0xPU0VfT05fRVhFQ1VURSwgbmV2ZXIsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMpLCB7IG1vdmVtZW50OiBkZXJpdmVNZW51TW92ZW1lbnQoc3BlYy5jb2x1bW5zLCBzcGVjLnByZXNldHMpIH0pKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhcnRzOiB7IG1lbnU6IHBhcnQoZmFsc2UsIDEsIHNwZWMucHJlc2V0cykgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBjb2xvcklucHV0Q2hhbmdlRXZlbnQgPSBnZW5lcmF0ZSQxKCdjb2xvci1pbnB1dC1jaGFuZ2UnKTtcbiAgICB2YXIgY29sb3JTd2F0Y2hDaGFuZ2VFdmVudCA9IGdlbmVyYXRlJDEoJ2NvbG9yLXN3YXRjaC1jaGFuZ2UnKTtcbiAgICB2YXIgY29sb3JQaWNrZXJDYW5jZWxFdmVudCA9IGdlbmVyYXRlJDEoJ2NvbG9yLXBpY2tlci1jYW5jZWwnKTtcbiAgICB2YXIgcmVuZGVyQ29sb3JJbnB1dCA9IGZ1bmN0aW9uIChzcGVjLCBzaGFyZWRCYWNrc3RhZ2UsIGNvbG9ySW5wdXRCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBwRmllbGQgPSBGb3JtRmllbGQucGFydHMuZmllbGQoe1xuICAgICAgICBmYWN0b3J5OiBJbnB1dCxcbiAgICAgICAgaW5wdXRDbGFzc2VzOiBbJ3RveC10ZXh0ZmllbGQnXSxcbiAgICAgICAgb25TZXRWYWx1ZTogZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICByZXR1cm4gSW52YWxpZGF0aW5nLnJ1bihjKS5nZXQobm9vcCk7XG4gICAgICAgIH0sXG4gICAgICAgIGlucHV0QmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIERpc2FibGluZy5jb25maWcoeyBkaXNhYmxlZDogc2hhcmVkQmFja3N0YWdlLnByb3ZpZGVycy5pc0Rpc2FibGVkIH0pLFxuICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICAgIFRhYnN0b3BwaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgSW52YWxpZGF0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBpbnZhbGlkQ2xhc3M6ICd0b3gtdGV4dGJveC1maWVsZC1pbnZhbGlkJyxcbiAgICAgICAgICAgIGdldFJvb3Q6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIHJldHVybiBwYXJlbnQoY29tcC5lbGVtZW50KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBub3RpZnk6IHtcbiAgICAgICAgICAgICAgb25WYWxpZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGNvbXApO1xuICAgICAgICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIGNvbG9ySW5wdXRDaGFuZ2VFdmVudCwgeyBjb2xvcjogdmFsIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsaWRhdG9yOiB7XG4gICAgICAgICAgICAgIHZhbGlkYXRlT25Mb2FkOiBmYWxzZSxcbiAgICAgICAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dFZhbHVlID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGlucHV0KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBGdXR1cmUucHVyZShSZXN1bHQudmFsdWUodHJ1ZSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICB2YXIgc3BhbiA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdzcGFuJyk7XG4gICAgICAgICAgICAgICAgICBzZXQkMihzcGFuLCAnYmFja2dyb3VuZC1jb2xvcicsIGlucHV0VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IGdldFJhdyhzcGFuLCAnYmFja2dyb3VuZC1jb2xvcicpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycm9yKCdibGFoJyk7XG4gICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoXykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVzdWx0LnZhbHVlKGlucHV0VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gRnV0dXJlLnB1cmUocmVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICBdKSxcbiAgICAgICAgc2VsZWN0T25Gb2N1czogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgdmFyIHBMYWJlbCA9IHNwZWMubGFiZWwubWFwKGZ1bmN0aW9uIChsYWJlbCkge1xuICAgICAgICByZXR1cm4gcmVuZGVyTGFiZWwobGFiZWwsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMpO1xuICAgICAgfSk7XG4gICAgICB2YXIgZW1pdFN3YXRjaENoYW5nZSA9IGZ1bmN0aW9uIChjb2xvckJpdCwgdmFsdWUpIHtcbiAgICAgICAgZW1pdFdpdGgoY29sb3JCaXQsIGNvbG9yU3dhdGNoQ2hhbmdlRXZlbnQsIHsgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkl0ZW1BY3Rpb24gPSBmdW5jdGlvbiAoY29tcCwgdmFsdWUpIHtcbiAgICAgICAgbWVtQ29sb3JCdXR0b24uZ2V0T3B0KGNvbXApLmVhY2goZnVuY3Rpb24gKGNvbG9yQml0KSB7XG4gICAgICAgICAgaWYgKHZhbHVlID09PSAnY3VzdG9tJykge1xuICAgICAgICAgICAgY29sb3JJbnB1dEJhY2tzdGFnZS5jb2xvclBpY2tlcihmdW5jdGlvbiAodmFsdWVPcHQpIHtcbiAgICAgICAgICAgICAgdmFsdWVPcHQuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVtaXQoY29sb3JCaXQsIGNvbG9yUGlja2VyQ2FuY2VsRXZlbnQpO1xuICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBlbWl0U3dhdGNoQ2hhbmdlKGNvbG9yQml0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgYWRkQ29sb3IodmFsdWUpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sICcjZmZmZmZmJyk7XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ3JlbW92ZScpIHtcbiAgICAgICAgICAgIGVtaXRTd2F0Y2hDaGFuZ2UoY29sb3JCaXQsICcnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZW1pdFN3YXRjaENoYW5nZShjb2xvckJpdCwgdmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1lbUNvbG9yQnV0dG9uID0gcmVjb3JkKHJlbmRlclBhbmVsQnV0dG9uKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgICAgYXR0cmlidXRlczogeyAnYXJpYS1sYWJlbCc6IHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMudHJhbnNsYXRlKCdDb2xvciBzd2F0Y2gnKSB9XG4gICAgICAgIH0sXG4gICAgICAgIGxheW91dHM6IHtcbiAgICAgICAgICBvblJ0bDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgc291dGh3ZXN0JDEsXG4gICAgICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgICAgICBzb3V0aCQxXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgICAgICBzb3V0aHdlc3QkMSxcbiAgICAgICAgICAgICAgc291dGgkMVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtdLFxuICAgICAgICBmZXRjaDogZ2V0RmV0Y2goY29sb3JJbnB1dEJhY2tzdGFnZS5nZXRDb2xvcnMoKSwgY29sb3JJbnB1dEJhY2tzdGFnZS5oYXNDdXN0b21Db2xvcnMoKSksXG4gICAgICAgIGNvbHVtbnM6IGNvbG9ySW5wdXRCYWNrc3RhZ2UuZ2V0Q29sb3JDb2xzKCksXG4gICAgICAgIHByZXNldHM6ICdjb2xvcicsXG4gICAgICAgIG9uSXRlbUFjdGlvbjogb25JdGVtQWN0aW9uXG4gICAgICB9LCBzaGFyZWRCYWNrc3RhZ2UpKTtcbiAgICAgIHJldHVybiBGb3JtRmllbGQuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtX19ncm91cCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IHBMYWJlbC50b0FycmF5KCkuY29uY2F0KFt7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtY29sb3ItaW5wdXQnXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICAgICAgcEZpZWxkLFxuICAgICAgICAgICAgICBtZW1Db2xvckJ1dHRvbi5hc1NwZWMoKVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1dKSxcbiAgICAgICAgZmllbGRCZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdmb3JtLWZpZWxkLWV2ZW50cycsIFtcbiAgICAgICAgICAgIHJ1bihjb2xvcklucHV0Q2hhbmdlRXZlbnQsIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICAgICAgICBtZW1Db2xvckJ1dHRvbi5nZXRPcHQoY29tcCkuZWFjaChmdW5jdGlvbiAoY29sb3JCdXR0b24pIHtcbiAgICAgICAgICAgICAgICBzZXQkMihjb2xvckJ1dHRvbi5lbGVtZW50LCAnYmFja2dyb3VuZC1jb2xvcicsIHNlLmV2ZW50LmNvbG9yKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIGZvcm1DaGFuZ2VFdmVudCwgeyBuYW1lOiBzcGVjLm5hbWUgfSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ1bihjb2xvclN3YXRjaENoYW5nZUV2ZW50LCBmdW5jdGlvbiAoY29tcCwgc2UpIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZpZWxkLCBzZS5ldmVudC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgQ29tcG9zaW5nLmdldEN1cnJlbnQoY29tcCkuZWFjaChGb2N1c2luZy5mb2N1cyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydW4oY29sb3JQaWNrZXJDYW5jZWxFdmVudCwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBGb3JtRmllbGQuZ2V0RmllbGQoY29tcCkuZWFjaChmdW5jdGlvbiAoX2ZpZWxkKSB7XG4gICAgICAgICAgICAgICAgQ29tcG9zaW5nLmdldEN1cnJlbnQoY29tcCkuZWFjaChGb2N1c2luZy5mb2N1cyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKV0pXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGxhYmVsUGFydCA9IG9wdGlvbmFsKHtcbiAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdkb20nKV0sXG4gICAgICBuYW1lOiAnbGFiZWwnXG4gICAgfSk7XG4gICAgdmFyIGVkZ2VQYXJ0ID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBvcHRpb25hbCh7XG4gICAgICAgIG5hbWU6ICcnICsgbmFtZSArICctZWRnZScsXG4gICAgICAgIG92ZXJyaWRlczogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgIHZhciBhY3Rpb24gPSBkZXRhaWwubW9kZWwubWFuYWdlci5lZGdlQWN0aW9uc1tuYW1lXTtcbiAgICAgICAgICByZXR1cm4gYWN0aW9uLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBldmVudHM6IGRlcml2ZShbXG4gICAgICAgICAgICAgICAgcnVuQWN0aW9uRXh0cmEodG91Y2hzdGFydCgpLCBmdW5jdGlvbiAoY29tcCwgc2UsIGQpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBhKGNvbXAsIGQpO1xuICAgICAgICAgICAgICAgIH0sIFtkZXRhaWxdKSxcbiAgICAgICAgICAgICAgICBydW5BY3Rpb25FeHRyYShtb3VzZWRvd24oKSwgZnVuY3Rpb24gKGNvbXAsIHNlLCBkKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gYShjb21wLCBkKTtcbiAgICAgICAgICAgICAgICB9LCBbZGV0YWlsXSksXG4gICAgICAgICAgICAgICAgcnVuQWN0aW9uRXh0cmEobW91c2Vtb3ZlKCksIGZ1bmN0aW9uIChjb21wLCBzZSwgZGV0KSB7XG4gICAgICAgICAgICAgICAgICBpZiAoZGV0Lm1vdXNlSXNEb3duLmdldCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGEoY29tcCwgZGV0KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBbZGV0YWlsXSlcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRsRWRnZVBhcnQgPSBlZGdlUGFydCgndG9wLWxlZnQnKTtcbiAgICB2YXIgdGVkZ2VQYXJ0ID0gZWRnZVBhcnQoJ3RvcCcpO1xuICAgIHZhciB0ckVkZ2VQYXJ0ID0gZWRnZVBhcnQoJ3RvcC1yaWdodCcpO1xuICAgIHZhciByZWRnZVBhcnQgPSBlZGdlUGFydCgncmlnaHQnKTtcbiAgICB2YXIgYnJFZGdlUGFydCA9IGVkZ2VQYXJ0KCdib3R0b20tcmlnaHQnKTtcbiAgICB2YXIgYmVkZ2VQYXJ0ID0gZWRnZVBhcnQoJ2JvdHRvbScpO1xuICAgIHZhciBibEVkZ2VQYXJ0ID0gZWRnZVBhcnQoJ2JvdHRvbS1sZWZ0Jyk7XG4gICAgdmFyIGxlZGdlUGFydCA9IGVkZ2VQYXJ0KCdsZWZ0Jyk7XG4gICAgdmFyIHRodW1iUGFydCA9IHJlcXVpcmVkKHtcbiAgICAgIG5hbWU6ICd0aHVtYicsXG4gICAgICBkZWZhdWx0czogY29uc3RhbnQoeyBkb206IHsgc3R5bGVzOiB7IHBvc2l0aW9uOiAnYWJzb2x1dGUnIH0gfSB9KSxcbiAgICAgIG92ZXJyaWRlczogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGV2ZW50czogZGVyaXZlKFtcbiAgICAgICAgICAgIHJlZGlyZWN0VG9QYXJ0KHRvdWNoc3RhcnQoKSwgZGV0YWlsLCAnc3BlY3RydW0nKSxcbiAgICAgICAgICAgIHJlZGlyZWN0VG9QYXJ0KHRvdWNobW92ZSgpLCBkZXRhaWwsICdzcGVjdHJ1bScpLFxuICAgICAgICAgICAgcmVkaXJlY3RUb1BhcnQodG91Y2hlbmQoKSwgZGV0YWlsLCAnc3BlY3RydW0nKSxcbiAgICAgICAgICAgIHJlZGlyZWN0VG9QYXJ0KG1vdXNlZG93bigpLCBkZXRhaWwsICdzcGVjdHJ1bScpLFxuICAgICAgICAgICAgcmVkaXJlY3RUb1BhcnQobW91c2Vtb3ZlKCksIGRldGFpbCwgJ3NwZWN0cnVtJyksXG4gICAgICAgICAgICByZWRpcmVjdFRvUGFydChtb3VzZXVwKCksIGRldGFpbCwgJ3NwZWN0cnVtJylcbiAgICAgICAgICBdKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBzcGVjdHJ1bVBhcnQgPSByZXF1aXJlZCh7XG4gICAgICBzY2hlbWE6IFtzdGF0ZSQxKCdtb3VzZUlzRG93bicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gQ2VsbChmYWxzZSk7XG4gICAgICAgIH0pXSxcbiAgICAgIG5hbWU6ICdzcGVjdHJ1bScsXG4gICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgdmFyIG1vZGVsRGV0YWlsID0gZGV0YWlsLm1vZGVsO1xuICAgICAgICB2YXIgbW9kZWwgPSBtb2RlbERldGFpbC5tYW5hZ2VyO1xuICAgICAgICB2YXIgc2V0VmFsdWVGcm9tID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICByZXR1cm4gbW9kZWwuZ2V0VmFsdWVGcm9tRXZlbnQoc2ltdWxhdGVkRXZlbnQpLm1hcChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2RlbC5zZXRWYWx1ZUZyb20oY29tcG9uZW50LCBkZXRhaWwsIHZhbHVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgICBvbkxlZnQ6IGZ1bmN0aW9uIChzcGVjdHJ1bSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbC5vbkxlZnQoc3BlY3RydW0sIGRldGFpbCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9uUmlnaHQ6IGZ1bmN0aW9uIChzcGVjdHJ1bSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbC5vblJpZ2h0KHNwZWN0cnVtLCBkZXRhaWwpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvblVwOiBmdW5jdGlvbiAoc3BlY3RydW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWwub25VcChzcGVjdHJ1bSwgZGV0YWlsKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb25Eb3duOiBmdW5jdGlvbiAoc3BlY3RydW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWwub25Eb3duKHNwZWN0cnVtLCBkZXRhaWwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSlcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBldmVudHM6IGRlcml2ZShbXG4gICAgICAgICAgICBydW4odG91Y2hzdGFydCgpLCBzZXRWYWx1ZUZyb20pLFxuICAgICAgICAgICAgcnVuKHRvdWNobW92ZSgpLCBzZXRWYWx1ZUZyb20pLFxuICAgICAgICAgICAgcnVuKG1vdXNlZG93bigpLCBzZXRWYWx1ZUZyb20pLFxuICAgICAgICAgICAgcnVuKG1vdXNlbW92ZSgpLCBmdW5jdGlvbiAoc3BlY3RydW0sIHNlKSB7XG4gICAgICAgICAgICAgIGlmIChkZXRhaWwubW91c2VJc0Rvd24uZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICBzZXRWYWx1ZUZyb20oc3BlY3RydW0sIHNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBTbGlkZXJQYXJ0cyA9IFtcbiAgICAgIGxhYmVsUGFydCxcbiAgICAgIGxlZGdlUGFydCxcbiAgICAgIHJlZGdlUGFydCxcbiAgICAgIHRlZGdlUGFydCxcbiAgICAgIGJlZGdlUGFydCxcbiAgICAgIHRsRWRnZVBhcnQsXG4gICAgICB0ckVkZ2VQYXJ0LFxuICAgICAgYmxFZGdlUGFydCxcbiAgICAgIGJyRWRnZVBhcnQsXG4gICAgICB0aHVtYlBhcnQsXG4gICAgICBzcGVjdHJ1bVBhcnRcbiAgICBdO1xuXG4gICAgdmFyIF9zbGlkZXJDaGFuZ2VFdmVudCA9ICdzbGlkZXIuY2hhbmdlLnZhbHVlJztcbiAgICB2YXIgc2xpZGVyQ2hhbmdlRXZlbnQgPSBjb25zdGFudChfc2xpZGVyQ2hhbmdlRXZlbnQpO1xuICAgIHZhciBpc1RvdWNoRXZlbnQgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICByZXR1cm4gZXZ0LnR5cGUuaW5kZXhPZigndG91Y2gnKSAhPT0gLTE7XG4gICAgfTtcbiAgICB2YXIgZ2V0RXZlbnRTb3VyY2UgPSBmdW5jdGlvbiAoc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgIHZhciBldnQgPSBzaW11bGF0ZWRFdmVudC5ldmVudC5yYXc7XG4gICAgICBpZiAoaXNUb3VjaEV2ZW50KGV2dCkpIHtcbiAgICAgICAgdmFyIHRvdWNoRXZlbnQgPSBldnQ7XG4gICAgICAgIHJldHVybiB0b3VjaEV2ZW50LnRvdWNoZXMgIT09IHVuZGVmaW5lZCAmJiB0b3VjaEV2ZW50LnRvdWNoZXMubGVuZ3RoID09PSAxID8gT3B0aW9uYWwuc29tZSh0b3VjaEV2ZW50LnRvdWNoZXNbMF0pLm1hcChmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHJldHVybiBTdWdhclBvc2l0aW9uKHQuY2xpZW50WCwgdC5jbGllbnRZKTtcbiAgICAgICAgfSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbW91c2VFdmVudCA9IGV2dDtcbiAgICAgICAgcmV0dXJuIG1vdXNlRXZlbnQuY2xpZW50WCAhPT0gdW5kZWZpbmVkID8gT3B0aW9uYWwuc29tZShtb3VzZUV2ZW50KS5tYXAoZnVuY3Rpb24gKG1lKSB7XG4gICAgICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24obWUuY2xpZW50WCwgbWUuY2xpZW50WSk7XG4gICAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgdCA9ICd0b3AnLCByJDEgPSAncmlnaHQnLCBiID0gJ2JvdHRvbScsIGwgPSAnbGVmdCc7XG4gICAgdmFyIG1pblggPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gZGV0YWlsLm1vZGVsLm1pblg7XG4gICAgfTtcbiAgICB2YXIgbWluWSA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXRhaWwubW9kZWwubWluWTtcbiAgICB9O1xuICAgIHZhciBtaW4xWCA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXRhaWwubW9kZWwubWluWCAtIDE7XG4gICAgfTtcbiAgICB2YXIgbWluMVkgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gZGV0YWlsLm1vZGVsLm1pblkgLSAxO1xuICAgIH07XG4gICAgdmFyIG1heFggPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gZGV0YWlsLm1vZGVsLm1heFg7XG4gICAgfTtcbiAgICB2YXIgbWF4WSA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXRhaWwubW9kZWwubWF4WTtcbiAgICB9O1xuICAgIHZhciBtYXgxWCA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXRhaWwubW9kZWwubWF4WCArIDE7XG4gICAgfTtcbiAgICB2YXIgbWF4MVkgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gZGV0YWlsLm1vZGVsLm1heFkgKyAxO1xuICAgIH07XG4gICAgdmFyIHJhbmdlJDIgPSBmdW5jdGlvbiAoZGV0YWlsLCBtYXgsIG1pbikge1xuICAgICAgcmV0dXJuIG1heChkZXRhaWwpIC0gbWluKGRldGFpbCk7XG4gICAgfTtcbiAgICB2YXIgeFJhbmdlID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIHJhbmdlJDIoZGV0YWlsLCBtYXhYLCBtaW5YKTtcbiAgICB9O1xuICAgIHZhciB5UmFuZ2UgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gcmFuZ2UkMihkZXRhaWwsIG1heFksIG1pblkpO1xuICAgIH07XG4gICAgdmFyIGhhbGZYID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIHhSYW5nZShkZXRhaWwpIC8gMjtcbiAgICB9O1xuICAgIHZhciBoYWxmWSA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiB5UmFuZ2UoZGV0YWlsKSAvIDI7XG4gICAgfTtcbiAgICB2YXIgc3RlcCA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXRhaWwuc3RlcFNpemU7XG4gICAgfTtcbiAgICB2YXIgc25hcCA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBkZXRhaWwuc25hcFRvR3JpZDtcbiAgICB9O1xuICAgIHZhciBzbmFwU3RhcnQgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gZGV0YWlsLnNuYXBTdGFydDtcbiAgICB9O1xuICAgIHZhciByb3VuZGVkID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIGRldGFpbC5yb3VuZGVkO1xuICAgIH07XG4gICAgdmFyIGhhc0VkZ2UgPSBmdW5jdGlvbiAoZGV0YWlsLCBlZGdlTmFtZSkge1xuICAgICAgcmV0dXJuIGRldGFpbFtlZGdlTmFtZSArICctZWRnZSddICE9PSB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICB2YXIgaGFzTEVkZ2UgPSBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICByZXR1cm4gaGFzRWRnZShkZXRhaWwsIGwpO1xuICAgIH07XG4gICAgdmFyIGhhc1JFZGdlID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIGhhc0VkZ2UoZGV0YWlsLCByJDEpO1xuICAgIH07XG4gICAgdmFyIGhhc1RFZGdlID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIGhhc0VkZ2UoZGV0YWlsLCB0KTtcbiAgICB9O1xuICAgIHZhciBoYXNCRWRnZSA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgIHJldHVybiBoYXNFZGdlKGRldGFpbCwgYik7XG4gICAgfTtcbiAgICB2YXIgY3VycmVudFZhbHVlID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgcmV0dXJuIGRldGFpbC5tb2RlbC52YWx1ZS5nZXQoKTtcbiAgICB9O1xuXG4gICAgdmFyIHhWYWx1ZSA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4geyB4OiB4IH07XG4gICAgfTtcbiAgICB2YXIgeVZhbHVlID0gZnVuY3Rpb24gKHkpIHtcbiAgICAgIHJldHVybiB7IHk6IHkgfTtcbiAgICB9O1xuICAgIHZhciB4eVZhbHVlID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IHgsXG4gICAgICAgIHk6IHlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZmlyZVNsaWRlckNoYW5nZSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHZhbHVlKSB7XG4gICAgICBlbWl0V2l0aChjb21wb25lbnQsIHNsaWRlckNoYW5nZUV2ZW50KCksIHsgdmFsdWU6IHZhbHVlIH0pO1xuICAgIH07XG4gICAgdmFyIHNldFRvVExFZGdlWFkgPSBmdW5jdGlvbiAoZWRnZSwgZGV0YWlsKSB7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlKGVkZ2UsIHh5VmFsdWUobWluMVgoZGV0YWlsKSwgbWluMVkoZGV0YWlsKSkpO1xuICAgIH07XG4gICAgdmFyIHNldFRvVEVkZ2UgPSBmdW5jdGlvbiAoZWRnZSwgZGV0YWlsKSB7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlKGVkZ2UsIHlWYWx1ZShtaW4xWShkZXRhaWwpKSk7XG4gICAgfTtcbiAgICB2YXIgc2V0VG9URWRnZVhZID0gZnVuY3Rpb24gKGVkZ2UsIGRldGFpbCkge1xuICAgICAgZmlyZVNsaWRlckNoYW5nZShlZGdlLCB4eVZhbHVlKGhhbGZYKGRldGFpbCksIG1pbjFZKGRldGFpbCkpKTtcbiAgICB9O1xuICAgIHZhciBzZXRUb1RSRWRnZVhZID0gZnVuY3Rpb24gKGVkZ2UsIGRldGFpbCkge1xuICAgICAgZmlyZVNsaWRlckNoYW5nZShlZGdlLCB4eVZhbHVlKG1heDFYKGRldGFpbCksIG1pbjFZKGRldGFpbCkpKTtcbiAgICB9O1xuICAgIHZhciBzZXRUb1JFZGdlID0gZnVuY3Rpb24gKGVkZ2UsIGRldGFpbCkge1xuICAgICAgZmlyZVNsaWRlckNoYW5nZShlZGdlLCB4VmFsdWUobWF4MVgoZGV0YWlsKSkpO1xuICAgIH07XG4gICAgdmFyIHNldFRvUkVkZ2VYWSA9IGZ1bmN0aW9uIChlZGdlLCBkZXRhaWwpIHtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UoZWRnZSwgeHlWYWx1ZShtYXgxWChkZXRhaWwpLCBoYWxmWShkZXRhaWwpKSk7XG4gICAgfTtcbiAgICB2YXIgc2V0VG9CUkVkZ2VYWSA9IGZ1bmN0aW9uIChlZGdlLCBkZXRhaWwpIHtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UoZWRnZSwgeHlWYWx1ZShtYXgxWChkZXRhaWwpLCBtYXgxWShkZXRhaWwpKSk7XG4gICAgfTtcbiAgICB2YXIgc2V0VG9CRWRnZSA9IGZ1bmN0aW9uIChlZGdlLCBkZXRhaWwpIHtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UoZWRnZSwgeVZhbHVlKG1heDFZKGRldGFpbCkpKTtcbiAgICB9O1xuICAgIHZhciBzZXRUb0JFZGdlWFkgPSBmdW5jdGlvbiAoZWRnZSwgZGV0YWlsKSB7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlKGVkZ2UsIHh5VmFsdWUoaGFsZlgoZGV0YWlsKSwgbWF4MVkoZGV0YWlsKSkpO1xuICAgIH07XG4gICAgdmFyIHNldFRvQkxFZGdlWFkgPSBmdW5jdGlvbiAoZWRnZSwgZGV0YWlsKSB7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlKGVkZ2UsIHh5VmFsdWUobWluMVgoZGV0YWlsKSwgbWF4MVkoZGV0YWlsKSkpO1xuICAgIH07XG4gICAgdmFyIHNldFRvTEVkZ2UgPSBmdW5jdGlvbiAoZWRnZSwgZGV0YWlsKSB7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlKGVkZ2UsIHhWYWx1ZShtaW4xWChkZXRhaWwpKSk7XG4gICAgfTtcbiAgICB2YXIgc2V0VG9MRWRnZVhZID0gZnVuY3Rpb24gKGVkZ2UsIGRldGFpbCkge1xuICAgICAgZmlyZVNsaWRlckNoYW5nZShlZGdlLCB4eVZhbHVlKG1pbjFYKGRldGFpbCksIGhhbGZZKGRldGFpbCkpKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlZHVjZUJ5ID0gZnVuY3Rpb24gKHZhbHVlLCBtaW4sIG1heCwgc3RlcCkge1xuICAgICAgaWYgKHZhbHVlIDwgbWluKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1heDtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IG1pbikge1xuICAgICAgICByZXR1cm4gbWluIC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heChtaW4sIHZhbHVlIC0gc3RlcCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaW5jcmVhc2VCeSA9IGZ1bmN0aW9uICh2YWx1ZSwgbWluLCBtYXgsIHN0ZXApIHtcbiAgICAgIGlmICh2YWx1ZSA+IG1heCkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgbWluKSB7XG4gICAgICAgIHJldHVybiBtaW47XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSBtYXgpIHtcbiAgICAgICAgcmV0dXJuIG1heCArIDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTWF0aC5taW4obWF4LCB2YWx1ZSArIHN0ZXApO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNhcFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgcmV0dXJuIE1hdGgubWF4KG1pbiwgTWF0aC5taW4obWF4LCB2YWx1ZSkpO1xuICAgIH07XG4gICAgdmFyIHNuYXBWYWx1ZU9mID0gZnVuY3Rpb24gKHZhbHVlLCBtaW4sIG1heCwgc3RlcCwgc25hcFN0YXJ0KSB7XG4gICAgICByZXR1cm4gc25hcFN0YXJ0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaW5pdFZhbHVlID0gdmFsdWUgLSBtaW47XG4gICAgICAgIHZhciBleHRyYVZhbHVlID0gTWF0aC5yb3VuZChpbml0VmFsdWUgLyBzdGVwKSAqIHN0ZXA7XG4gICAgICAgIHJldHVybiBjYXBWYWx1ZShtaW4gKyBleHRyYVZhbHVlLCBtaW4gLSAxLCBtYXggKyAxKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgICB2YXIgcmVtYWluZGVyID0gKHZhbHVlIC0gc3RhcnQpICUgc3RlcDtcbiAgICAgICAgdmFyIGFkanVzdG1lbnQgPSBNYXRoLnJvdW5kKHJlbWFpbmRlciAvIHN0ZXApO1xuICAgICAgICB2YXIgcmF3U3RlcHMgPSBNYXRoLmZsb29yKCh2YWx1ZSAtIHN0YXJ0KSAvIHN0ZXApO1xuICAgICAgICB2YXIgbWF4U3RlcHMgPSBNYXRoLmZsb29yKChtYXggLSBzdGFydCkgLyBzdGVwKTtcbiAgICAgICAgdmFyIG51bVN0ZXBzID0gTWF0aC5taW4obWF4U3RlcHMsIHJhd1N0ZXBzICsgYWRqdXN0bWVudCk7XG4gICAgICAgIHZhciByID0gc3RhcnQgKyBudW1TdGVwcyAqIHN0ZXA7XG4gICAgICAgIHJldHVybiBNYXRoLm1heChzdGFydCwgcik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmaW5kT2Zmc2V0T2YgPSBmdW5jdGlvbiAodmFsdWUsIG1pbiwgbWF4KSB7XG4gICAgICByZXR1cm4gTWF0aC5taW4obWF4LCBNYXRoLm1heCh2YWx1ZSwgbWluKSkgLSBtaW47XG4gICAgfTtcbiAgICB2YXIgZmluZFZhbHVlT2YgPSBmdW5jdGlvbiAoYXJncykge1xuICAgICAgdmFyIG1pbiA9IGFyZ3MubWluLCBtYXggPSBhcmdzLm1heCwgcmFuZ2UgPSBhcmdzLnJhbmdlLCB2YWx1ZSA9IGFyZ3MudmFsdWUsIHN0ZXAgPSBhcmdzLnN0ZXAsIHNuYXAgPSBhcmdzLnNuYXAsIHNuYXBTdGFydCA9IGFyZ3Muc25hcFN0YXJ0LCByb3VuZGVkID0gYXJncy5yb3VuZGVkLCBoYXNNaW5FZGdlID0gYXJncy5oYXNNaW5FZGdlLCBoYXNNYXhFZGdlID0gYXJncy5oYXNNYXhFZGdlLCBtaW5Cb3VuZCA9IGFyZ3MubWluQm91bmQsIG1heEJvdW5kID0gYXJncy5tYXhCb3VuZCwgc2NyZWVuUmFuZ2UgPSBhcmdzLnNjcmVlblJhbmdlO1xuICAgICAgdmFyIGNhcE1pbiA9IGhhc01pbkVkZ2UgPyBtaW4gLSAxIDogbWluO1xuICAgICAgdmFyIGNhcE1heCA9IGhhc01heEVkZ2UgPyBtYXggKyAxIDogbWF4O1xuICAgICAgaWYgKHZhbHVlIDwgbWluQm91bmQpIHtcbiAgICAgICAgcmV0dXJuIGNhcE1pbjtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBtYXhCb3VuZCkge1xuICAgICAgICByZXR1cm4gY2FwTWF4O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IGZpbmRPZmZzZXRPZih2YWx1ZSwgbWluQm91bmQsIG1heEJvdW5kKTtcbiAgICAgICAgdmFyIG5ld1ZhbHVlID0gY2FwVmFsdWUob2Zmc2V0IC8gc2NyZWVuUmFuZ2UgKiByYW5nZSArIG1pbiwgY2FwTWluLCBjYXBNYXgpO1xuICAgICAgICBpZiAoc25hcCAmJiBuZXdWYWx1ZSA+PSBtaW4gJiYgbmV3VmFsdWUgPD0gbWF4KSB7XG4gICAgICAgICAgcmV0dXJuIHNuYXBWYWx1ZU9mKG5ld1ZhbHVlLCBtaW4sIG1heCwgc3RlcCwgc25hcFN0YXJ0KTtcbiAgICAgICAgfSBlbHNlIGlmIChyb3VuZGVkKSB7XG4gICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobmV3VmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGZpbmRPZmZzZXRPZlZhbHVlID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgIHZhciBtaW4gPSBhcmdzLm1pbiwgbWF4ID0gYXJncy5tYXgsIHJhbmdlID0gYXJncy5yYW5nZSwgdmFsdWUgPSBhcmdzLnZhbHVlLCBoYXNNaW5FZGdlID0gYXJncy5oYXNNaW5FZGdlLCBoYXNNYXhFZGdlID0gYXJncy5oYXNNYXhFZGdlLCBtYXhCb3VuZCA9IGFyZ3MubWF4Qm91bmQsIG1heE9mZnNldCA9IGFyZ3MubWF4T2Zmc2V0LCBjZW50ZXJNaW5FZGdlID0gYXJncy5jZW50ZXJNaW5FZGdlLCBjZW50ZXJNYXhFZGdlID0gYXJncy5jZW50ZXJNYXhFZGdlO1xuICAgICAgaWYgKHZhbHVlIDwgbWluKSB7XG4gICAgICAgIHJldHVybiBoYXNNaW5FZGdlID8gMCA6IGNlbnRlck1pbkVkZ2U7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlID4gbWF4KSB7XG4gICAgICAgIHJldHVybiBoYXNNYXhFZGdlID8gbWF4Qm91bmQgOiBjZW50ZXJNYXhFZGdlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICh2YWx1ZSAtIG1pbikgLyByYW5nZSAqIG1heE9mZnNldDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHRvcCA9ICd0b3AnLCByaWdodCA9ICdyaWdodCcsIGJvdHRvbSA9ICdib3R0b20nLCBsZWZ0ID0gJ2xlZnQnLCB3aWR0aCA9ICd3aWR0aCcsIGhlaWdodCA9ICdoZWlnaHQnO1xuICAgIHZhciBnZXRCb3VuZHMkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHJldHVybiBjb21wb25lbnQuZWxlbWVudC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Qm91bmRzUHJvcGVydHkgPSBmdW5jdGlvbiAoYm91bmRzLCBwcm9wZXJ0eSkge1xuICAgICAgcmV0dXJuIGJvdW5kc1twcm9wZXJ0eV07XG4gICAgfTtcbiAgICB2YXIgZ2V0TWluWEJvdW5kcyA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHZhciBib3VuZHMgPSBnZXRCb3VuZHMkMShjb21wb25lbnQpO1xuICAgICAgcmV0dXJuIGdldEJvdW5kc1Byb3BlcnR5KGJvdW5kcywgbGVmdCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TWF4WEJvdW5kcyA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHZhciBib3VuZHMgPSBnZXRCb3VuZHMkMShjb21wb25lbnQpO1xuICAgICAgcmV0dXJuIGdldEJvdW5kc1Byb3BlcnR5KGJvdW5kcywgcmlnaHQpO1xuICAgIH07XG4gICAgdmFyIGdldE1pbllCb3VuZHMgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICB2YXIgYm91bmRzID0gZ2V0Qm91bmRzJDEoY29tcG9uZW50KTtcbiAgICAgIHJldHVybiBnZXRCb3VuZHNQcm9wZXJ0eShib3VuZHMsIHRvcCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TWF4WUJvdW5kcyA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHZhciBib3VuZHMgPSBnZXRCb3VuZHMkMShjb21wb25lbnQpO1xuICAgICAgcmV0dXJuIGdldEJvdW5kc1Byb3BlcnR5KGJvdW5kcywgYm90dG9tKTtcbiAgICB9O1xuICAgIHZhciBnZXRYU2NyZWVuUmFuZ2UgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICB2YXIgYm91bmRzID0gZ2V0Qm91bmRzJDEoY29tcG9uZW50KTtcbiAgICAgIHJldHVybiBnZXRCb3VuZHNQcm9wZXJ0eShib3VuZHMsIHdpZHRoKTtcbiAgICB9O1xuICAgIHZhciBnZXRZU2NyZWVuUmFuZ2UgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICB2YXIgYm91bmRzID0gZ2V0Qm91bmRzJDEoY29tcG9uZW50KTtcbiAgICAgIHJldHVybiBnZXRCb3VuZHNQcm9wZXJ0eShib3VuZHMsIGhlaWdodCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2VudGVyT2Zmc2V0T2YgPSBmdW5jdGlvbiAoY29tcG9uZW50TWluRWRnZSwgY29tcG9uZW50TWF4RWRnZSwgc3BlY3RydW1NaW5FZGdlKSB7XG4gICAgICByZXR1cm4gKGNvbXBvbmVudE1pbkVkZ2UgKyBjb21wb25lbnRNYXhFZGdlKSAvIDIgLSBzcGVjdHJ1bU1pbkVkZ2U7XG4gICAgfTtcbiAgICB2YXIgZ2V0WENlbnRlck9mZlNldE9mID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc3BlY3RydW0pIHtcbiAgICAgIHZhciBjb21wb25lbnRCb3VuZHMgPSBnZXRCb3VuZHMkMShjb21wb25lbnQpO1xuICAgICAgdmFyIHNwZWN0cnVtQm91bmRzID0gZ2V0Qm91bmRzJDEoc3BlY3RydW0pO1xuICAgICAgdmFyIGNvbXBvbmVudE1pbkVkZ2UgPSBnZXRCb3VuZHNQcm9wZXJ0eShjb21wb25lbnRCb3VuZHMsIGxlZnQpO1xuICAgICAgdmFyIGNvbXBvbmVudE1heEVkZ2UgPSBnZXRCb3VuZHNQcm9wZXJ0eShjb21wb25lbnRCb3VuZHMsIHJpZ2h0KTtcbiAgICAgIHZhciBzcGVjdHJ1bU1pbkVkZ2UgPSBnZXRCb3VuZHNQcm9wZXJ0eShzcGVjdHJ1bUJvdW5kcywgbGVmdCk7XG4gICAgICByZXR1cm4gZ2V0Q2VudGVyT2Zmc2V0T2YoY29tcG9uZW50TWluRWRnZSwgY29tcG9uZW50TWF4RWRnZSwgc3BlY3RydW1NaW5FZGdlKTtcbiAgICB9O1xuICAgIHZhciBnZXRZQ2VudGVyT2ZmU2V0T2YgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzcGVjdHJ1bSkge1xuICAgICAgdmFyIGNvbXBvbmVudEJvdW5kcyA9IGdldEJvdW5kcyQxKGNvbXBvbmVudCk7XG4gICAgICB2YXIgc3BlY3RydW1Cb3VuZHMgPSBnZXRCb3VuZHMkMShzcGVjdHJ1bSk7XG4gICAgICB2YXIgY29tcG9uZW50TWluRWRnZSA9IGdldEJvdW5kc1Byb3BlcnR5KGNvbXBvbmVudEJvdW5kcywgdG9wKTtcbiAgICAgIHZhciBjb21wb25lbnRNYXhFZGdlID0gZ2V0Qm91bmRzUHJvcGVydHkoY29tcG9uZW50Qm91bmRzLCBib3R0b20pO1xuICAgICAgdmFyIHNwZWN0cnVtTWluRWRnZSA9IGdldEJvdW5kc1Byb3BlcnR5KHNwZWN0cnVtQm91bmRzLCB0b3ApO1xuICAgICAgcmV0dXJuIGdldENlbnRlck9mZnNldE9mKGNvbXBvbmVudE1pbkVkZ2UsIGNvbXBvbmVudE1heEVkZ2UsIHNwZWN0cnVtTWluRWRnZSk7XG4gICAgfTtcblxuICAgIHZhciBmaXJlU2xpZGVyQ2hhbmdlJDEgPSBmdW5jdGlvbiAoc3BlY3RydW0sIHZhbHVlKSB7XG4gICAgICBlbWl0V2l0aChzcGVjdHJ1bSwgc2xpZGVyQ2hhbmdlRXZlbnQoKSwgeyB2YWx1ZTogdmFsdWUgfSk7XG4gICAgfTtcbiAgICB2YXIgc2xpZGVyVmFsdWUgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIHsgeDogeCB9O1xuICAgIH07XG4gICAgdmFyIGZpbmRWYWx1ZU9mT2Zmc2V0ID0gZnVuY3Rpb24gKHNwZWN0cnVtLCBkZXRhaWwsIGxlZnQpIHtcbiAgICAgIHZhciBhcmdzID0ge1xuICAgICAgICBtaW46IG1pblgoZGV0YWlsKSxcbiAgICAgICAgbWF4OiBtYXhYKGRldGFpbCksXG4gICAgICAgIHJhbmdlOiB4UmFuZ2UoZGV0YWlsKSxcbiAgICAgICAgdmFsdWU6IGxlZnQsXG4gICAgICAgIHN0ZXA6IHN0ZXAoZGV0YWlsKSxcbiAgICAgICAgc25hcDogc25hcChkZXRhaWwpLFxuICAgICAgICBzbmFwU3RhcnQ6IHNuYXBTdGFydChkZXRhaWwpLFxuICAgICAgICByb3VuZGVkOiByb3VuZGVkKGRldGFpbCksXG4gICAgICAgIGhhc01pbkVkZ2U6IGhhc0xFZGdlKGRldGFpbCksXG4gICAgICAgIGhhc01heEVkZ2U6IGhhc1JFZGdlKGRldGFpbCksXG4gICAgICAgIG1pbkJvdW5kOiBnZXRNaW5YQm91bmRzKHNwZWN0cnVtKSxcbiAgICAgICAgbWF4Qm91bmQ6IGdldE1heFhCb3VuZHMoc3BlY3RydW0pLFxuICAgICAgICBzY3JlZW5SYW5nZTogZ2V0WFNjcmVlblJhbmdlKHNwZWN0cnVtKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBmaW5kVmFsdWVPZihhcmdzKTtcbiAgICB9O1xuICAgIHZhciBzZXRWYWx1ZUZyb20gPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCwgdmFsdWUpIHtcbiAgICAgIHZhciB4VmFsdWUgPSBmaW5kVmFsdWVPZk9mZnNldChzcGVjdHJ1bSwgZGV0YWlsLCB2YWx1ZSk7XG4gICAgICB2YXIgc2xpZGVyVmFsID0gc2xpZGVyVmFsdWUoeFZhbHVlKTtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UkMShzcGVjdHJ1bSwgc2xpZGVyVmFsKTtcbiAgICAgIHJldHVybiB4VmFsdWU7XG4gICAgfTtcbiAgICB2YXIgc2V0VG9NaW4gPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgdmFyIG1pbiA9IG1pblgoZGV0YWlsKTtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UkMShzcGVjdHJ1bSwgc2xpZGVyVmFsdWUobWluKSk7XG4gICAgfTtcbiAgICB2YXIgc2V0VG9NYXggPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgdmFyIG1heCA9IG1heFgoZGV0YWlsKTtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UkMShzcGVjdHJ1bSwgc2xpZGVyVmFsdWUobWF4KSk7XG4gICAgfTtcbiAgICB2YXIgbW92ZUJ5ID0gZnVuY3Rpb24gKGRpcmVjdGlvbiwgc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgdmFyIGYgPSBkaXJlY3Rpb24gPiAwID8gaW5jcmVhc2VCeSA6IHJlZHVjZUJ5O1xuICAgICAgdmFyIHhWYWx1ZSA9IGYoY3VycmVudFZhbHVlKGRldGFpbCkueCwgbWluWChkZXRhaWwpLCBtYXhYKGRldGFpbCksIHN0ZXAoZGV0YWlsKSk7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlJDEoc3BlY3RydW0sIHNsaWRlclZhbHVlKHhWYWx1ZSkpO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoeFZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVNb3ZlbWVudCA9IGZ1bmN0aW9uIChkaXJlY3Rpb24pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgICByZXR1cm4gbW92ZUJ5KGRpcmVjdGlvbiwgc3BlY3RydW0sIGRldGFpbCkubWFwKGFsd2F5cyk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldFZhbHVlRnJvbUV2ZW50ID0gZnVuY3Rpb24gKHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICB2YXIgcG9zID0gZ2V0RXZlbnRTb3VyY2Uoc2ltdWxhdGVkRXZlbnQpO1xuICAgICAgcmV0dXJuIHBvcy5tYXAoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgcmV0dXJuIHAubGVmdDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZpbmRPZmZzZXRPZlZhbHVlJDEgPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCwgdmFsdWUsIG1pbkVkZ2UsIG1heEVkZ2UpIHtcbiAgICAgIHZhciBtaW5PZmZzZXQgPSAwO1xuICAgICAgdmFyIG1heE9mZnNldCA9IGdldFhTY3JlZW5SYW5nZShzcGVjdHJ1bSk7XG4gICAgICB2YXIgY2VudGVyTWluRWRnZSA9IG1pbkVkZ2UuYmluZChmdW5jdGlvbiAoZWRnZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShnZXRYQ2VudGVyT2ZmU2V0T2YoZWRnZSwgc3BlY3RydW0pKTtcbiAgICAgIH0pLmdldE9yKG1pbk9mZnNldCk7XG4gICAgICB2YXIgY2VudGVyTWF4RWRnZSA9IG1heEVkZ2UuYmluZChmdW5jdGlvbiAoZWRnZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShnZXRYQ2VudGVyT2ZmU2V0T2YoZWRnZSwgc3BlY3RydW0pKTtcbiAgICAgIH0pLmdldE9yKG1heE9mZnNldCk7XG4gICAgICB2YXIgYXJncyA9IHtcbiAgICAgICAgbWluOiBtaW5YKGRldGFpbCksXG4gICAgICAgIG1heDogbWF4WChkZXRhaWwpLFxuICAgICAgICByYW5nZTogeFJhbmdlKGRldGFpbCksXG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgaGFzTWluRWRnZTogaGFzTEVkZ2UoZGV0YWlsKSxcbiAgICAgICAgaGFzTWF4RWRnZTogaGFzUkVkZ2UoZGV0YWlsKSxcbiAgICAgICAgbWluQm91bmQ6IGdldE1pblhCb3VuZHMoc3BlY3RydW0pLFxuICAgICAgICBtaW5PZmZzZXQ6IG1pbk9mZnNldCxcbiAgICAgICAgbWF4Qm91bmQ6IGdldE1heFhCb3VuZHMoc3BlY3RydW0pLFxuICAgICAgICBtYXhPZmZzZXQ6IG1heE9mZnNldCxcbiAgICAgICAgY2VudGVyTWluRWRnZTogY2VudGVyTWluRWRnZSxcbiAgICAgICAgY2VudGVyTWF4RWRnZTogY2VudGVyTWF4RWRnZVxuICAgICAgfTtcbiAgICAgIHJldHVybiBmaW5kT2Zmc2V0T2ZWYWx1ZShhcmdzKTtcbiAgICB9O1xuICAgIHZhciBmaW5kUG9zaXRpb25PZlZhbHVlID0gZnVuY3Rpb24gKHNsaWRlciwgc3BlY3RydW0sIHZhbHVlLCBtaW5FZGdlLCBtYXhFZGdlLCBkZXRhaWwpIHtcbiAgICAgIHZhciBvZmZzZXQgPSBmaW5kT2Zmc2V0T2ZWYWx1ZSQxKHNwZWN0cnVtLCBkZXRhaWwsIHZhbHVlLCBtaW5FZGdlLCBtYXhFZGdlKTtcbiAgICAgIHJldHVybiBnZXRNaW5YQm91bmRzKHNwZWN0cnVtKSAtIGdldE1pblhCb3VuZHMoc2xpZGVyKSArIG9mZnNldDtcbiAgICB9O1xuICAgIHZhciBzZXRQb3NpdGlvbkZyb21WYWx1ZSA9IGZ1bmN0aW9uIChzbGlkZXIsIHRodW1iLCBkZXRhaWwsIGVkZ2VzKSB7XG4gICAgICB2YXIgdmFsdWUgPSBjdXJyZW50VmFsdWUoZGV0YWlsKTtcbiAgICAgIHZhciBwb3MgPSBmaW5kUG9zaXRpb25PZlZhbHVlKHNsaWRlciwgZWRnZXMuZ2V0U3BlY3RydW0oc2xpZGVyKSwgdmFsdWUueCwgZWRnZXMuZ2V0TGVmdEVkZ2Uoc2xpZGVyKSwgZWRnZXMuZ2V0UmlnaHRFZGdlKHNsaWRlciksIGRldGFpbCk7XG4gICAgICB2YXIgdGh1bWJSYWRpdXMgPSBnZXQkOCh0aHVtYi5lbGVtZW50KSAvIDI7XG4gICAgICBzZXQkMih0aHVtYi5lbGVtZW50LCAnbGVmdCcsIHBvcyAtIHRodW1iUmFkaXVzICsgJ3B4Jyk7XG4gICAgfTtcbiAgICB2YXIgb25MZWZ0ID0gaGFuZGxlTW92ZW1lbnQoLTEpO1xuICAgIHZhciBvblJpZ2h0ID0gaGFuZGxlTW92ZW1lbnQoMSk7XG4gICAgdmFyIG9uVXAgPSBPcHRpb25hbC5ub25lO1xuICAgIHZhciBvbkRvd24gPSBPcHRpb25hbC5ub25lO1xuICAgIHZhciBlZGdlQWN0aW9ucyA9IHtcbiAgICAgICd0b3AtbGVmdCc6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICd0b3AnOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAndG9wLXJpZ2h0JzogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgJ3JpZ2h0JzogT3B0aW9uYWwuc29tZShzZXRUb1JFZGdlKSxcbiAgICAgICdib3R0b20tcmlnaHQnOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAnYm90dG9tJzogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgJ2JvdHRvbS1sZWZ0JzogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgJ2xlZnQnOiBPcHRpb25hbC5zb21lKHNldFRvTEVkZ2UpXG4gICAgfTtcblxuICAgIHZhciBIb3Jpem9udGFsTW9kZWwgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgc2V0VmFsdWVGcm9tOiBzZXRWYWx1ZUZyb20sXG4gICAgICAgIHNldFRvTWluOiBzZXRUb01pbixcbiAgICAgICAgc2V0VG9NYXg6IHNldFRvTWF4LFxuICAgICAgICBmaW5kVmFsdWVPZk9mZnNldDogZmluZFZhbHVlT2ZPZmZzZXQsXG4gICAgICAgIGdldFZhbHVlRnJvbUV2ZW50OiBnZXRWYWx1ZUZyb21FdmVudCxcbiAgICAgICAgZmluZFBvc2l0aW9uT2ZWYWx1ZTogZmluZFBvc2l0aW9uT2ZWYWx1ZSxcbiAgICAgICAgc2V0UG9zaXRpb25Gcm9tVmFsdWU6IHNldFBvc2l0aW9uRnJvbVZhbHVlLFxuICAgICAgICBvbkxlZnQ6IG9uTGVmdCxcbiAgICAgICAgb25SaWdodDogb25SaWdodCxcbiAgICAgICAgb25VcDogb25VcCxcbiAgICAgICAgb25Eb3duOiBvbkRvd24sXG4gICAgICAgIGVkZ2VBY3Rpb25zOiBlZGdlQWN0aW9uc1xuICAgIH0pO1xuXG4gICAgdmFyIGZpcmVTbGlkZXJDaGFuZ2UkMiA9IGZ1bmN0aW9uIChzcGVjdHJ1bSwgdmFsdWUpIHtcbiAgICAgIGVtaXRXaXRoKHNwZWN0cnVtLCBzbGlkZXJDaGFuZ2VFdmVudCgpLCB7IHZhbHVlOiB2YWx1ZSB9KTtcbiAgICB9O1xuICAgIHZhciBzbGlkZXJWYWx1ZSQxID0gZnVuY3Rpb24gKHkpIHtcbiAgICAgIHJldHVybiB7IHk6IHkgfTtcbiAgICB9O1xuICAgIHZhciBmaW5kVmFsdWVPZk9mZnNldCQxID0gZnVuY3Rpb24gKHNwZWN0cnVtLCBkZXRhaWwsIHRvcCkge1xuICAgICAgdmFyIGFyZ3MgPSB7XG4gICAgICAgIG1pbjogbWluWShkZXRhaWwpLFxuICAgICAgICBtYXg6IG1heFkoZGV0YWlsKSxcbiAgICAgICAgcmFuZ2U6IHlSYW5nZShkZXRhaWwpLFxuICAgICAgICB2YWx1ZTogdG9wLFxuICAgICAgICBzdGVwOiBzdGVwKGRldGFpbCksXG4gICAgICAgIHNuYXA6IHNuYXAoZGV0YWlsKSxcbiAgICAgICAgc25hcFN0YXJ0OiBzbmFwU3RhcnQoZGV0YWlsKSxcbiAgICAgICAgcm91bmRlZDogcm91bmRlZChkZXRhaWwpLFxuICAgICAgICBoYXNNaW5FZGdlOiBoYXNURWRnZShkZXRhaWwpLFxuICAgICAgICBoYXNNYXhFZGdlOiBoYXNCRWRnZShkZXRhaWwpLFxuICAgICAgICBtaW5Cb3VuZDogZ2V0TWluWUJvdW5kcyhzcGVjdHJ1bSksXG4gICAgICAgIG1heEJvdW5kOiBnZXRNYXhZQm91bmRzKHNwZWN0cnVtKSxcbiAgICAgICAgc2NyZWVuUmFuZ2U6IGdldFlTY3JlZW5SYW5nZShzcGVjdHJ1bSlcbiAgICAgIH07XG4gICAgICByZXR1cm4gZmluZFZhbHVlT2YoYXJncyk7XG4gICAgfTtcbiAgICB2YXIgc2V0VmFsdWVGcm9tJDEgPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCwgdmFsdWUpIHtcbiAgICAgIHZhciB5VmFsdWUgPSBmaW5kVmFsdWVPZk9mZnNldCQxKHNwZWN0cnVtLCBkZXRhaWwsIHZhbHVlKTtcbiAgICAgIHZhciBzbGlkZXJWYWwgPSBzbGlkZXJWYWx1ZSQxKHlWYWx1ZSk7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlJDIoc3BlY3RydW0sIHNsaWRlclZhbCk7XG4gICAgICByZXR1cm4geVZhbHVlO1xuICAgIH07XG4gICAgdmFyIHNldFRvTWluJDEgPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgdmFyIG1pbiA9IG1pblkoZGV0YWlsKTtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UkMihzcGVjdHJ1bSwgc2xpZGVyVmFsdWUkMShtaW4pKTtcbiAgICB9O1xuICAgIHZhciBzZXRUb01heCQxID0gZnVuY3Rpb24gKHNwZWN0cnVtLCBkZXRhaWwpIHtcbiAgICAgIHZhciBtYXggPSBtYXhZKGRldGFpbCk7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlJDIoc3BlY3RydW0sIHNsaWRlclZhbHVlJDEobWF4KSk7XG4gICAgfTtcbiAgICB2YXIgbW92ZUJ5JDEgPSBmdW5jdGlvbiAoZGlyZWN0aW9uLCBzcGVjdHJ1bSwgZGV0YWlsKSB7XG4gICAgICB2YXIgZiA9IGRpcmVjdGlvbiA+IDAgPyBpbmNyZWFzZUJ5IDogcmVkdWNlQnk7XG4gICAgICB2YXIgeVZhbHVlID0gZihjdXJyZW50VmFsdWUoZGV0YWlsKS55LCBtaW5ZKGRldGFpbCksIG1heFkoZGV0YWlsKSwgc3RlcChkZXRhaWwpKTtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UkMihzcGVjdHJ1bSwgc2xpZGVyVmFsdWUkMSh5VmFsdWUpKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHlWYWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlTW92ZW1lbnQkMSA9IGZ1bmN0aW9uIChkaXJlY3Rpb24pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgICByZXR1cm4gbW92ZUJ5JDEoZGlyZWN0aW9uLCBzcGVjdHJ1bSwgZGV0YWlsKS5tYXAoYWx3YXlzKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0VmFsdWVGcm9tRXZlbnQkMSA9IGZ1bmN0aW9uIChzaW11bGF0ZWRFdmVudCkge1xuICAgICAgdmFyIHBvcyA9IGdldEV2ZW50U291cmNlKHNpbXVsYXRlZEV2ZW50KTtcbiAgICAgIHJldHVybiBwb3MubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiBwLnRvcDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZpbmRPZmZzZXRPZlZhbHVlJDIgPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCwgdmFsdWUsIG1pbkVkZ2UsIG1heEVkZ2UpIHtcbiAgICAgIHZhciBtaW5PZmZzZXQgPSAwO1xuICAgICAgdmFyIG1heE9mZnNldCA9IGdldFlTY3JlZW5SYW5nZShzcGVjdHJ1bSk7XG4gICAgICB2YXIgY2VudGVyTWluRWRnZSA9IG1pbkVkZ2UuYmluZChmdW5jdGlvbiAoZWRnZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShnZXRZQ2VudGVyT2ZmU2V0T2YoZWRnZSwgc3BlY3RydW0pKTtcbiAgICAgIH0pLmdldE9yKG1pbk9mZnNldCk7XG4gICAgICB2YXIgY2VudGVyTWF4RWRnZSA9IG1heEVkZ2UuYmluZChmdW5jdGlvbiAoZWRnZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShnZXRZQ2VudGVyT2ZmU2V0T2YoZWRnZSwgc3BlY3RydW0pKTtcbiAgICAgIH0pLmdldE9yKG1heE9mZnNldCk7XG4gICAgICB2YXIgYXJncyA9IHtcbiAgICAgICAgbWluOiBtaW5ZKGRldGFpbCksXG4gICAgICAgIG1heDogbWF4WShkZXRhaWwpLFxuICAgICAgICByYW5nZTogeVJhbmdlKGRldGFpbCksXG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgaGFzTWluRWRnZTogaGFzVEVkZ2UoZGV0YWlsKSxcbiAgICAgICAgaGFzTWF4RWRnZTogaGFzQkVkZ2UoZGV0YWlsKSxcbiAgICAgICAgbWluQm91bmQ6IGdldE1pbllCb3VuZHMoc3BlY3RydW0pLFxuICAgICAgICBtaW5PZmZzZXQ6IG1pbk9mZnNldCxcbiAgICAgICAgbWF4Qm91bmQ6IGdldE1heFlCb3VuZHMoc3BlY3RydW0pLFxuICAgICAgICBtYXhPZmZzZXQ6IG1heE9mZnNldCxcbiAgICAgICAgY2VudGVyTWluRWRnZTogY2VudGVyTWluRWRnZSxcbiAgICAgICAgY2VudGVyTWF4RWRnZTogY2VudGVyTWF4RWRnZVxuICAgICAgfTtcbiAgICAgIHJldHVybiBmaW5kT2Zmc2V0T2ZWYWx1ZShhcmdzKTtcbiAgICB9O1xuICAgIHZhciBmaW5kUG9zaXRpb25PZlZhbHVlJDEgPSBmdW5jdGlvbiAoc2xpZGVyLCBzcGVjdHJ1bSwgdmFsdWUsIG1pbkVkZ2UsIG1heEVkZ2UsIGRldGFpbCkge1xuICAgICAgdmFyIG9mZnNldCA9IGZpbmRPZmZzZXRPZlZhbHVlJDIoc3BlY3RydW0sIGRldGFpbCwgdmFsdWUsIG1pbkVkZ2UsIG1heEVkZ2UpO1xuICAgICAgcmV0dXJuIGdldE1pbllCb3VuZHMoc3BlY3RydW0pIC0gZ2V0TWluWUJvdW5kcyhzbGlkZXIpICsgb2Zmc2V0O1xuICAgIH07XG4gICAgdmFyIHNldFBvc2l0aW9uRnJvbVZhbHVlJDEgPSBmdW5jdGlvbiAoc2xpZGVyLCB0aHVtYiwgZGV0YWlsLCBlZGdlcykge1xuICAgICAgdmFyIHZhbHVlID0gY3VycmVudFZhbHVlKGRldGFpbCk7XG4gICAgICB2YXIgcG9zID0gZmluZFBvc2l0aW9uT2ZWYWx1ZSQxKHNsaWRlciwgZWRnZXMuZ2V0U3BlY3RydW0oc2xpZGVyKSwgdmFsdWUueSwgZWRnZXMuZ2V0VG9wRWRnZShzbGlkZXIpLCBlZGdlcy5nZXRCb3R0b21FZGdlKHNsaWRlciksIGRldGFpbCk7XG4gICAgICB2YXIgdGh1bWJSYWRpdXMgPSBnZXQkNyh0aHVtYi5lbGVtZW50KSAvIDI7XG4gICAgICBzZXQkMih0aHVtYi5lbGVtZW50LCAndG9wJywgcG9zIC0gdGh1bWJSYWRpdXMgKyAncHgnKTtcbiAgICB9O1xuICAgIHZhciBvbkxlZnQkMSA9IE9wdGlvbmFsLm5vbmU7XG4gICAgdmFyIG9uUmlnaHQkMSA9IE9wdGlvbmFsLm5vbmU7XG4gICAgdmFyIG9uVXAkMSA9IGhhbmRsZU1vdmVtZW50JDEoLTEpO1xuICAgIHZhciBvbkRvd24kMSA9IGhhbmRsZU1vdmVtZW50JDEoMSk7XG4gICAgdmFyIGVkZ2VBY3Rpb25zJDEgPSB7XG4gICAgICAndG9wLWxlZnQnOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAndG9wJzogT3B0aW9uYWwuc29tZShzZXRUb1RFZGdlKSxcbiAgICAgICd0b3AtcmlnaHQnOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAncmlnaHQnOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAnYm90dG9tLXJpZ2h0JzogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgJ2JvdHRvbSc6IE9wdGlvbmFsLnNvbWUoc2V0VG9CRWRnZSksXG4gICAgICAnYm90dG9tLWxlZnQnOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAnbGVmdCc6IE9wdGlvbmFsLm5vbmUoKVxuICAgIH07XG5cbiAgICB2YXIgVmVydGljYWxNb2RlbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBzZXRWYWx1ZUZyb206IHNldFZhbHVlRnJvbSQxLFxuICAgICAgICBzZXRUb01pbjogc2V0VG9NaW4kMSxcbiAgICAgICAgc2V0VG9NYXg6IHNldFRvTWF4JDEsXG4gICAgICAgIGZpbmRWYWx1ZU9mT2Zmc2V0OiBmaW5kVmFsdWVPZk9mZnNldCQxLFxuICAgICAgICBnZXRWYWx1ZUZyb21FdmVudDogZ2V0VmFsdWVGcm9tRXZlbnQkMSxcbiAgICAgICAgZmluZFBvc2l0aW9uT2ZWYWx1ZTogZmluZFBvc2l0aW9uT2ZWYWx1ZSQxLFxuICAgICAgICBzZXRQb3NpdGlvbkZyb21WYWx1ZTogc2V0UG9zaXRpb25Gcm9tVmFsdWUkMSxcbiAgICAgICAgb25MZWZ0OiBvbkxlZnQkMSxcbiAgICAgICAgb25SaWdodDogb25SaWdodCQxLFxuICAgICAgICBvblVwOiBvblVwJDEsXG4gICAgICAgIG9uRG93bjogb25Eb3duJDEsXG4gICAgICAgIGVkZ2VBY3Rpb25zOiBlZGdlQWN0aW9ucyQxXG4gICAgfSk7XG5cbiAgICB2YXIgZmlyZVNsaWRlckNoYW5nZSQzID0gZnVuY3Rpb24gKHNwZWN0cnVtLCB2YWx1ZSkge1xuICAgICAgZW1pdFdpdGgoc3BlY3RydW0sIHNsaWRlckNoYW5nZUV2ZW50KCksIHsgdmFsdWU6IHZhbHVlIH0pO1xuICAgIH07XG4gICAgdmFyIHNsaWRlclZhbHVlJDIgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzZXRWYWx1ZUZyb20kMiA9IGZ1bmN0aW9uIChzcGVjdHJ1bSwgZGV0YWlsLCB2YWx1ZSkge1xuICAgICAgdmFyIHhWYWx1ZSA9IGZpbmRWYWx1ZU9mT2Zmc2V0KHNwZWN0cnVtLCBkZXRhaWwsIHZhbHVlLmxlZnQpO1xuICAgICAgdmFyIHlWYWx1ZSA9IGZpbmRWYWx1ZU9mT2Zmc2V0JDEoc3BlY3RydW0sIGRldGFpbCwgdmFsdWUudG9wKTtcbiAgICAgIHZhciB2YWwgPSBzbGlkZXJWYWx1ZSQyKHhWYWx1ZSwgeVZhbHVlKTtcbiAgICAgIGZpcmVTbGlkZXJDaGFuZ2UkMyhzcGVjdHJ1bSwgdmFsKTtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfTtcbiAgICB2YXIgbW92ZUJ5JDIgPSBmdW5jdGlvbiAoZGlyZWN0aW9uLCBpc1ZlcnRpY2FsTW92ZW1lbnQsIHNwZWN0cnVtLCBkZXRhaWwpIHtcbiAgICAgIHZhciBmID0gZGlyZWN0aW9uID4gMCA/IGluY3JlYXNlQnkgOiByZWR1Y2VCeTtcbiAgICAgIHZhciB4VmFsdWUgPSBpc1ZlcnRpY2FsTW92ZW1lbnQgPyBjdXJyZW50VmFsdWUoZGV0YWlsKS54IDogZihjdXJyZW50VmFsdWUoZGV0YWlsKS54LCBtaW5YKGRldGFpbCksIG1heFgoZGV0YWlsKSwgc3RlcChkZXRhaWwpKTtcbiAgICAgIHZhciB5VmFsdWUgPSAhaXNWZXJ0aWNhbE1vdmVtZW50ID8gY3VycmVudFZhbHVlKGRldGFpbCkueSA6IGYoY3VycmVudFZhbHVlKGRldGFpbCkueSwgbWluWShkZXRhaWwpLCBtYXhZKGRldGFpbCksIHN0ZXAoZGV0YWlsKSk7XG4gICAgICBmaXJlU2xpZGVyQ2hhbmdlJDMoc3BlY3RydW0sIHNsaWRlclZhbHVlJDIoeFZhbHVlLCB5VmFsdWUpKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHhWYWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlTW92ZW1lbnQkMiA9IGZ1bmN0aW9uIChkaXJlY3Rpb24sIGlzVmVydGljYWxNb3ZlbWVudCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzcGVjdHJ1bSwgZGV0YWlsKSB7XG4gICAgICAgIHJldHVybiBtb3ZlQnkkMihkaXJlY3Rpb24sIGlzVmVydGljYWxNb3ZlbWVudCwgc3BlY3RydW0sIGRldGFpbCkubWFwKGFsd2F5cyk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNldFRvTWluJDIgPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgdmFyIG1YID0gbWluWChkZXRhaWwpO1xuICAgICAgdmFyIG1ZID0gbWluWShkZXRhaWwpO1xuICAgICAgZmlyZVNsaWRlckNoYW5nZSQzKHNwZWN0cnVtLCBzbGlkZXJWYWx1ZSQyKG1YLCBtWSkpO1xuICAgIH07XG4gICAgdmFyIHNldFRvTWF4JDIgPSBmdW5jdGlvbiAoc3BlY3RydW0sIGRldGFpbCkge1xuICAgICAgdmFyIG1YID0gbWF4WChkZXRhaWwpO1xuICAgICAgdmFyIG1ZID0gbWF4WShkZXRhaWwpO1xuICAgICAgZmlyZVNsaWRlckNoYW5nZSQzKHNwZWN0cnVtLCBzbGlkZXJWYWx1ZSQyKG1YLCBtWSkpO1xuICAgIH07XG4gICAgdmFyIGdldFZhbHVlRnJvbUV2ZW50JDIgPSBmdW5jdGlvbiAoc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgIHJldHVybiBnZXRFdmVudFNvdXJjZShzaW11bGF0ZWRFdmVudCk7XG4gICAgfTtcbiAgICB2YXIgc2V0UG9zaXRpb25Gcm9tVmFsdWUkMiA9IGZ1bmN0aW9uIChzbGlkZXIsIHRodW1iLCBkZXRhaWwsIGVkZ2VzKSB7XG4gICAgICB2YXIgdmFsdWUgPSBjdXJyZW50VmFsdWUoZGV0YWlsKTtcbiAgICAgIHZhciB4UG9zID0gZmluZFBvc2l0aW9uT2ZWYWx1ZShzbGlkZXIsIGVkZ2VzLmdldFNwZWN0cnVtKHNsaWRlciksIHZhbHVlLngsIGVkZ2VzLmdldExlZnRFZGdlKHNsaWRlciksIGVkZ2VzLmdldFJpZ2h0RWRnZShzbGlkZXIpLCBkZXRhaWwpO1xuICAgICAgdmFyIHlQb3MgPSBmaW5kUG9zaXRpb25PZlZhbHVlJDEoc2xpZGVyLCBlZGdlcy5nZXRTcGVjdHJ1bShzbGlkZXIpLCB2YWx1ZS55LCBlZGdlcy5nZXRUb3BFZGdlKHNsaWRlciksIGVkZ2VzLmdldEJvdHRvbUVkZ2Uoc2xpZGVyKSwgZGV0YWlsKTtcbiAgICAgIHZhciB0aHVtYlhSYWRpdXMgPSBnZXQkOCh0aHVtYi5lbGVtZW50KSAvIDI7XG4gICAgICB2YXIgdGh1bWJZUmFkaXVzID0gZ2V0JDcodGh1bWIuZWxlbWVudCkgLyAyO1xuICAgICAgc2V0JDIodGh1bWIuZWxlbWVudCwgJ2xlZnQnLCB4UG9zIC0gdGh1bWJYUmFkaXVzICsgJ3B4Jyk7XG4gICAgICBzZXQkMih0aHVtYi5lbGVtZW50LCAndG9wJywgeVBvcyAtIHRodW1iWVJhZGl1cyArICdweCcpO1xuICAgIH07XG4gICAgdmFyIG9uTGVmdCQyID0gaGFuZGxlTW92ZW1lbnQkMigtMSwgZmFsc2UpO1xuICAgIHZhciBvblJpZ2h0JDIgPSBoYW5kbGVNb3ZlbWVudCQyKDEsIGZhbHNlKTtcbiAgICB2YXIgb25VcCQyID0gaGFuZGxlTW92ZW1lbnQkMigtMSwgdHJ1ZSk7XG4gICAgdmFyIG9uRG93biQyID0gaGFuZGxlTW92ZW1lbnQkMigxLCB0cnVlKTtcbiAgICB2YXIgZWRnZUFjdGlvbnMkMiA9IHtcbiAgICAgICd0b3AtbGVmdCc6IE9wdGlvbmFsLnNvbWUoc2V0VG9UTEVkZ2VYWSksXG4gICAgICAndG9wJzogT3B0aW9uYWwuc29tZShzZXRUb1RFZGdlWFkpLFxuICAgICAgJ3RvcC1yaWdodCc6IE9wdGlvbmFsLnNvbWUoc2V0VG9UUkVkZ2VYWSksXG4gICAgICAncmlnaHQnOiBPcHRpb25hbC5zb21lKHNldFRvUkVkZ2VYWSksXG4gICAgICAnYm90dG9tLXJpZ2h0JzogT3B0aW9uYWwuc29tZShzZXRUb0JSRWRnZVhZKSxcbiAgICAgICdib3R0b20nOiBPcHRpb25hbC5zb21lKHNldFRvQkVkZ2VYWSksXG4gICAgICAnYm90dG9tLWxlZnQnOiBPcHRpb25hbC5zb21lKHNldFRvQkxFZGdlWFkpLFxuICAgICAgJ2xlZnQnOiBPcHRpb25hbC5zb21lKHNldFRvTEVkZ2VYWSlcbiAgICB9O1xuXG4gICAgdmFyIFR3b0RNb2RlbCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBzZXRWYWx1ZUZyb206IHNldFZhbHVlRnJvbSQyLFxuICAgICAgICBzZXRUb01pbjogc2V0VG9NaW4kMixcbiAgICAgICAgc2V0VG9NYXg6IHNldFRvTWF4JDIsXG4gICAgICAgIGdldFZhbHVlRnJvbUV2ZW50OiBnZXRWYWx1ZUZyb21FdmVudCQyLFxuICAgICAgICBzZXRQb3NpdGlvbkZyb21WYWx1ZTogc2V0UG9zaXRpb25Gcm9tVmFsdWUkMixcbiAgICAgICAgb25MZWZ0OiBvbkxlZnQkMixcbiAgICAgICAgb25SaWdodDogb25SaWdodCQyLFxuICAgICAgICBvblVwOiBvblVwJDIsXG4gICAgICAgIG9uRG93bjogb25Eb3duJDIsXG4gICAgICAgIGVkZ2VBY3Rpb25zOiBlZGdlQWN0aW9ucyQyXG4gICAgfSk7XG5cbiAgICB2YXIgU2xpZGVyU2NoZW1hID0gW1xuICAgICAgZGVmYXVsdGVkJDEoJ3N0ZXBTaXplJywgMSksXG4gICAgICBkZWZhdWx0ZWQkMSgnb25DaGFuZ2UnLCBub29wKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdvbkNob29zZScsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkJDEoJ29uSW5pdCcsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkJDEoJ29uRHJhZ1N0YXJ0Jywgbm9vcCksXG4gICAgICBkZWZhdWx0ZWQkMSgnb25EcmFnRW5kJywgbm9vcCksXG4gICAgICBkZWZhdWx0ZWQkMSgnc25hcFRvR3JpZCcsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdyb3VuZGVkJywgdHJ1ZSksXG4gICAgICBvcHRpb24oJ3NuYXBTdGFydCcpLFxuICAgICAgc3RyaWN0T2YoJ21vZGVsJywgY2hvb3NlJDEoJ21vZGUnLCB7XG4gICAgICAgIHg6IFtcbiAgICAgICAgICBkZWZhdWx0ZWQkMSgnbWluWCcsIDApLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdtYXhYJywgMTAwKSxcbiAgICAgICAgICBzdGF0ZSQxKCd2YWx1ZScsIGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgICAgICByZXR1cm4gQ2VsbChzcGVjLm1vZGUubWluWCk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgc3RyaWN0JDEoJ2dldEluaXRpYWxWYWx1ZScpLFxuICAgICAgICAgIG91dHB1dCgnbWFuYWdlcicsIEhvcml6b250YWxNb2RlbClcbiAgICAgICAgXSxcbiAgICAgICAgeTogW1xuICAgICAgICAgIGRlZmF1bHRlZCQxKCdtaW5ZJywgMCksXG4gICAgICAgICAgZGVmYXVsdGVkJDEoJ21heFknLCAxMDApLFxuICAgICAgICAgIHN0YXRlJDEoJ3ZhbHVlJywgZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgICAgICAgIHJldHVybiBDZWxsKHNwZWMubW9kZS5taW5ZKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBzdHJpY3QkMSgnZ2V0SW5pdGlhbFZhbHVlJyksXG4gICAgICAgICAgb3V0cHV0KCdtYW5hZ2VyJywgVmVydGljYWxNb2RlbClcbiAgICAgICAgXSxcbiAgICAgICAgeHk6IFtcbiAgICAgICAgICBkZWZhdWx0ZWQkMSgnbWluWCcsIDApLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdtYXhYJywgMTAwKSxcbiAgICAgICAgICBkZWZhdWx0ZWQkMSgnbWluWScsIDApLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdtYXhZJywgMTAwKSxcbiAgICAgICAgICBzdGF0ZSQxKCd2YWx1ZScsIGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgICAgICByZXR1cm4gQ2VsbCh7XG4gICAgICAgICAgICAgIHg6IHNwZWMubW9kZS5taW5YLFxuICAgICAgICAgICAgICB5OiBzcGVjLm1vZGUubWluWVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgc3RyaWN0JDEoJ2dldEluaXRpYWxWYWx1ZScpLFxuICAgICAgICAgIG91dHB1dCgnbWFuYWdlcicsIFR3b0RNb2RlbClcbiAgICAgICAgXVxuICAgICAgfSkpLFxuICAgICAgZmllbGQkMSgnc2xpZGVyQmVoYXZpb3VycycsIFtcbiAgICAgICAgS2V5aW5nLFxuICAgICAgICBSZXByZXNlbnRpbmdcbiAgICAgIF0pLFxuICAgICAgc3RhdGUkMSgnbW91c2VJc0Rvd24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBDZWxsKGZhbHNlKTtcbiAgICAgIH0pXG4gICAgXTtcblxuICAgIHZhciBza2V0Y2ggPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzLCBfc3BlYywgX2V4dGVybmFscykge1xuICAgICAgdmFyIF9hO1xuICAgICAgdmFyIGdldFRodW1iID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGFydE9yRGllKGNvbXBvbmVudCwgZGV0YWlsLCAndGh1bWInKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0U3BlY3RydW0gPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiBnZXRQYXJ0T3JEaWUoY29tcG9uZW50LCBkZXRhaWwsICdzcGVjdHJ1bScpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRMZWZ0RWRnZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBhcnQoY29tcG9uZW50LCBkZXRhaWwsICdsZWZ0LWVkZ2UnKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0UmlnaHRFZGdlID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGFydChjb21wb25lbnQsIGRldGFpbCwgJ3JpZ2h0LWVkZ2UnKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VG9wRWRnZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIGdldFBhcnQoY29tcG9uZW50LCBkZXRhaWwsICd0b3AtZWRnZScpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRCb3R0b21FZGdlID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICByZXR1cm4gZ2V0UGFydChjb21wb25lbnQsIGRldGFpbCwgJ2JvdHRvbS1lZGdlJyk7XG4gICAgICB9O1xuICAgICAgdmFyIG1vZGVsRGV0YWlsID0gZGV0YWlsLm1vZGVsO1xuICAgICAgdmFyIG1vZGVsID0gbW9kZWxEZXRhaWwubWFuYWdlcjtcbiAgICAgIHZhciByZWZyZXNoID0gZnVuY3Rpb24gKHNsaWRlciwgdGh1bWIpIHtcbiAgICAgICAgbW9kZWwuc2V0UG9zaXRpb25Gcm9tVmFsdWUoc2xpZGVyLCB0aHVtYiwgZGV0YWlsLCB7XG4gICAgICAgICAgZ2V0TGVmdEVkZ2U6IGdldExlZnRFZGdlLFxuICAgICAgICAgIGdldFJpZ2h0RWRnZTogZ2V0UmlnaHRFZGdlLFxuICAgICAgICAgIGdldFRvcEVkZ2U6IGdldFRvcEVkZ2UsXG4gICAgICAgICAgZ2V0Qm90dG9tRWRnZTogZ2V0Qm90dG9tRWRnZSxcbiAgICAgICAgICBnZXRTcGVjdHJ1bTogZ2V0U3BlY3RydW1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldFZhbHVlID0gZnVuY3Rpb24gKHNsaWRlciwgbmV3VmFsdWUpIHtcbiAgICAgICAgbW9kZWxEZXRhaWwudmFsdWUuc2V0KG5ld1ZhbHVlKTtcbiAgICAgICAgdmFyIHRodW1iID0gZ2V0VGh1bWIoc2xpZGVyKTtcbiAgICAgICAgcmVmcmVzaChzbGlkZXIsIHRodW1iKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2hhbmdlVmFsdWUgPSBmdW5jdGlvbiAoc2xpZGVyLCBuZXdWYWx1ZSkge1xuICAgICAgICBzZXRWYWx1ZShzbGlkZXIsIG5ld1ZhbHVlKTtcbiAgICAgICAgdmFyIHRodW1iID0gZ2V0VGh1bWIoc2xpZGVyKTtcbiAgICAgICAgZGV0YWlsLm9uQ2hhbmdlKHNsaWRlciwgdGh1bWIsIG5ld1ZhbHVlKTtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlc2V0VG9NaW4gPSBmdW5jdGlvbiAoc2xpZGVyKSB7XG4gICAgICAgIG1vZGVsLnNldFRvTWluKHNsaWRlciwgZGV0YWlsKTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVzZXRUb01heCA9IGZ1bmN0aW9uIChzbGlkZXIpIHtcbiAgICAgICAgbW9kZWwuc2V0VG9NYXgoc2xpZGVyLCBkZXRhaWwpO1xuICAgICAgfTtcbiAgICAgIHZhciBjaG9vc2UgPSBmdW5jdGlvbiAoc2xpZGVyKSB7XG4gICAgICAgIHZhciBmaXJlT25DaG9vc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZ2V0UGFydChzbGlkZXIsIGRldGFpbCwgJ3RodW1iJykuZWFjaChmdW5jdGlvbiAodGh1bWIpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG1vZGVsRGV0YWlsLnZhbHVlLmdldCgpO1xuICAgICAgICAgICAgZGV0YWlsLm9uQ2hvb3NlKHNsaWRlciwgdGh1bWIsIHZhbHVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHdhc0Rvd24gPSBkZXRhaWwubW91c2VJc0Rvd24uZ2V0KCk7XG4gICAgICAgIGRldGFpbC5tb3VzZUlzRG93bi5zZXQoZmFsc2UpO1xuICAgICAgICBpZiAod2FzRG93bikge1xuICAgICAgICAgIGZpcmVPbkNob29zZSgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIG9uRHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKHNsaWRlciwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICBkZXRhaWwubW91c2VJc0Rvd24uc2V0KHRydWUpO1xuICAgICAgICBkZXRhaWwub25EcmFnU3RhcnQoc2xpZGVyLCBnZXRUaHVtYihzbGlkZXIpKTtcbiAgICAgIH07XG4gICAgICB2YXIgb25EcmFnRW5kID0gZnVuY3Rpb24gKHNsaWRlciwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICBkZXRhaWwub25EcmFnRW5kKHNsaWRlciwgZ2V0VGh1bWIoc2xpZGVyKSk7XG4gICAgICAgIGNob29zZShzbGlkZXIpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxuICAgICAgICBiZWhhdmlvdXJzOiBhdWdtZW50KGRldGFpbC5zbGlkZXJCZWhhdmlvdXJzLCBbXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnc3BlY2lhbCcsXG4gICAgICAgICAgICBmb2N1c0luOiBmdW5jdGlvbiAoc2xpZGVyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBnZXRQYXJ0KHNsaWRlciwgZGV0YWlsLCAnc3BlY3RydW0nKS5tYXAoS2V5aW5nLmZvY3VzSW4pLm1hcChhbHdheXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFJlcHJlc2VudGluZy5jb25maWcoe1xuICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgbW9kZTogJ21hbnVhbCcsXG4gICAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoXykge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbERldGFpbC52YWx1ZS5nZXQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFJlY2VpdmluZy5jb25maWcoeyBjaGFubmVsczogKF9hID0ge30sIF9hW21vdXNlUmVsZWFzZWQoKV0gPSB7IG9uUmVjZWl2ZTogY2hvb3NlIH0sIF9hKSB9KVxuICAgICAgICBdKSxcbiAgICAgICAgZXZlbnRzOiBkZXJpdmUoW1xuICAgICAgICAgIHJ1bihzbGlkZXJDaGFuZ2VFdmVudCgpLCBmdW5jdGlvbiAoc2xpZGVyLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgY2hhbmdlVmFsdWUoc2xpZGVyLCBzaW11bGF0ZWRFdmVudC5ldmVudC52YWx1ZSk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoc2xpZGVyLCBfc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBnZXRJbml0aWFsID0gbW9kZWxEZXRhaWwuZ2V0SW5pdGlhbFZhbHVlKCk7XG4gICAgICAgICAgICBtb2RlbERldGFpbC52YWx1ZS5zZXQoZ2V0SW5pdGlhbCk7XG4gICAgICAgICAgICB2YXIgdGh1bWIgPSBnZXRUaHVtYihzbGlkZXIpO1xuICAgICAgICAgICAgcmVmcmVzaChzbGlkZXIsIHRodW1iKTtcbiAgICAgICAgICAgIHZhciBzcGVjdHJ1bSA9IGdldFNwZWN0cnVtKHNsaWRlcik7XG4gICAgICAgICAgICBkZXRhaWwub25Jbml0KHNsaWRlciwgdGh1bWIsIHNwZWN0cnVtLCBtb2RlbERldGFpbC52YWx1ZS5nZXQoKSk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcnVuKHRvdWNoc3RhcnQoKSwgb25EcmFnU3RhcnQpLFxuICAgICAgICAgIHJ1bih0b3VjaGVuZCgpLCBvbkRyYWdFbmQpLFxuICAgICAgICAgIHJ1bihtb3VzZWRvd24oKSwgb25EcmFnU3RhcnQpLFxuICAgICAgICAgIHJ1bihtb3VzZXVwKCksIG9uRHJhZ0VuZClcbiAgICAgICAgXSksXG4gICAgICAgIGFwaXM6IHtcbiAgICAgICAgICByZXNldFRvTWluOiByZXNldFRvTWluLFxuICAgICAgICAgIHJlc2V0VG9NYXg6IHJlc2V0VG9NYXgsXG4gICAgICAgICAgc2V0VmFsdWU6IHNldFZhbHVlLFxuICAgICAgICAgIHJlZnJlc2g6IHJlZnJlc2hcbiAgICAgICAgfSxcbiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IHN0eWxlczogeyBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9IH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBTbGlkZXIgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnU2xpZGVyJyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogU2xpZGVyU2NoZW1hLFxuICAgICAgcGFydEZpZWxkczogU2xpZGVyUGFydHMsXG4gICAgICBmYWN0b3J5OiBza2V0Y2gsXG4gICAgICBhcGlzOiB7XG4gICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoYXBpcywgc2xpZGVyLCB2YWx1ZSkge1xuICAgICAgICAgIGFwaXMuc2V0VmFsdWUoc2xpZGVyLCB2YWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0VG9NaW46IGZ1bmN0aW9uIChhcGlzLCBzbGlkZXIpIHtcbiAgICAgICAgICBhcGlzLnJlc2V0VG9NaW4oc2xpZGVyKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzZXRUb01heDogZnVuY3Rpb24gKGFwaXMsIHNsaWRlcikge1xuICAgICAgICAgIGFwaXMucmVzZXRUb01heChzbGlkZXIpO1xuICAgICAgICB9LFxuICAgICAgICByZWZyZXNoOiBmdW5jdGlvbiAoYXBpcywgc2xpZGVyKSB7XG4gICAgICAgICAgYXBpcy5yZWZyZXNoKHNsaWRlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBoc3ZDb2xvdXIgPSBmdW5jdGlvbiAoaHVlLCBzYXR1cmF0aW9uLCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaHVlOiBodWUsXG4gICAgICAgIHNhdHVyYXRpb246IHNhdHVyYXRpb24sXG4gICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tUmdiID0gZnVuY3Rpb24gKHJnYmFDb2xvdXIpIHtcbiAgICAgIHZhciBoID0gMDtcbiAgICAgIHZhciBzID0gMDtcbiAgICAgIHZhciB2ID0gMDtcbiAgICAgIHZhciByID0gcmdiYUNvbG91ci5yZWQgLyAyNTU7XG4gICAgICB2YXIgZyA9IHJnYmFDb2xvdXIuZ3JlZW4gLyAyNTU7XG4gICAgICB2YXIgYiA9IHJnYmFDb2xvdXIuYmx1ZSAvIDI1NTtcbiAgICAgIHZhciBtaW5SR0IgPSBNYXRoLm1pbihyLCBNYXRoLm1pbihnLCBiKSk7XG4gICAgICB2YXIgbWF4UkdCID0gTWF0aC5tYXgociwgTWF0aC5tYXgoZywgYikpO1xuICAgICAgaWYgKG1pblJHQiA9PT0gbWF4UkdCKSB7XG4gICAgICAgIHYgPSBtaW5SR0I7XG4gICAgICAgIHJldHVybiBoc3ZDb2xvdXIoMCwgMCwgdiAqIDEwMCk7XG4gICAgICB9XG4gICAgICB2YXIgZCA9IHIgPT09IG1pblJHQiA/IGcgLSBiIDogYiA9PT0gbWluUkdCID8gciAtIGcgOiBiIC0gcjtcbiAgICAgIGggPSByID09PSBtaW5SR0IgPyAzIDogYiA9PT0gbWluUkdCID8gMSA6IDU7XG4gICAgICBoID0gNjAgKiAoaCAtIGQgLyAobWF4UkdCIC0gbWluUkdCKSk7XG4gICAgICBzID0gKG1heFJHQiAtIG1pblJHQikgLyBtYXhSR0I7XG4gICAgICB2ID0gbWF4UkdCO1xuICAgICAgcmV0dXJuIGhzdkNvbG91cihNYXRoLnJvdW5kKGgpLCBNYXRoLnJvdW5kKHMgKiAxMDApLCBNYXRoLnJvdW5kKHYgKiAxMDApKTtcbiAgICB9O1xuXG4gICAgdmFyIGhleFRvSHN2ID0gZnVuY3Rpb24gKGhleCkge1xuICAgICAgcmV0dXJuIGZyb21SZ2IoZnJvbUhleChoZXgpKTtcbiAgICB9O1xuICAgIHZhciBoc3ZUb0hleCA9IGZ1bmN0aW9uIChoc3YpIHtcbiAgICAgIHJldHVybiBmcm9tUmdiYShmcm9tSHN2KGhzdikpO1xuICAgIH07XG5cbiAgICB2YXIgZmllbGRzVXBkYXRlID0gZ2VuZXJhdGUkMSgncmdiLWhleC11cGRhdGUnKTtcbiAgICB2YXIgc2xpZGVyVXBkYXRlID0gZ2VuZXJhdGUkMSgnc2xpZGVyLXVwZGF0ZScpO1xuICAgIHZhciBwYWxldHRlVXBkYXRlID0gZ2VuZXJhdGUkMSgncGFsZXR0ZS11cGRhdGUnKTtcblxuICAgIHZhciBzbGlkZXJGYWN0b3J5ID0gZnVuY3Rpb24gKHRyYW5zbGF0ZSwgZ2V0Q2xhc3MpIHtcbiAgICAgIHZhciBzcGVjdHJ1bSA9IFNsaWRlci5wYXJ0cy5zcGVjdHJ1bSh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW2dldENsYXNzKCdodWUtc2xpZGVyLXNwZWN0cnVtJyldLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciB0aHVtYiA9IFNsaWRlci5wYXJ0cy50aHVtYih7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW2dldENsYXNzKCdodWUtc2xpZGVyLXRodW1iJyldLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBTbGlkZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbZ2V0Q2xhc3MoJ2h1ZS1zbGlkZXInKV0sXG4gICAgICAgICAgYXR0cmlidXRlczogeyByb2xlOiAncHJlc2VudGF0aW9uJyB9XG4gICAgICAgIH0sXG4gICAgICAgIHJvdW5kZWQ6IGZhbHNlLFxuICAgICAgICBtb2RlbDoge1xuICAgICAgICAgIG1vZGU6ICd5JyxcbiAgICAgICAgICBnZXRJbml0aWFsVmFsdWU6IGNvbnN0YW50KHsgeTogMCB9KVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgc3BlY3RydW0sXG4gICAgICAgICAgdGh1bWJcbiAgICAgICAgXSxcbiAgICAgICAgc2xpZGVyQmVoYXZpb3VyczogZGVyaXZlJDEoW0ZvY3VzaW5nLmNvbmZpZyh7fSldKSxcbiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIChzbGlkZXIsIF90aHVtYiwgdmFsdWUpIHtcbiAgICAgICAgICBlbWl0V2l0aChzbGlkZXIsIHNsaWRlclVwZGF0ZSwgeyB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgb3duZXIkMyA9ICdmb3JtJztcbiAgICB2YXIgc2NoZW1hJGggPSBbZmllbGQkMSgnZm9ybUJlaGF2aW91cnMnLCBbUmVwcmVzZW50aW5nXSldO1xuICAgIHZhciBnZXRQYXJ0TmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICByZXR1cm4gJzxhbGxveS5maWVsZC4nICsgbmFtZSArICc+JztcbiAgICB9O1xuICAgIHZhciBza2V0Y2gkMSA9IGZ1bmN0aW9uIChmU3BlYykge1xuICAgICAgdmFyIHBhcnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmVjb3JkID0gW107XG4gICAgICAgIHZhciBmaWVsZCA9IGZ1bmN0aW9uIChuYW1lLCBjb25maWcpIHtcbiAgICAgICAgICByZWNvcmQucHVzaChuYW1lKTtcbiAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVPbmUob3duZXIkMywgZ2V0UGFydE5hbWUobmFtZSksIGNvbmZpZyk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZmllbGQ6IGZpZWxkLFxuICAgICAgICAgIHJlY29yZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KCk7XG4gICAgICB2YXIgc3BlYyA9IGZTcGVjKHBhcnRzKTtcbiAgICAgIHZhciBwYXJ0TmFtZXMgPSBwYXJ0cy5yZWNvcmQoKTtcbiAgICAgIHZhciBmaWVsZFBhcnRzID0gbWFwKHBhcnROYW1lcywgZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIHJlcXVpcmVkKHtcbiAgICAgICAgICBuYW1lOiBuLFxuICAgICAgICAgIHBuYW1lOiBnZXRQYXJ0TmFtZShuKVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbXBvc2l0ZShvd25lciQzLCBzY2hlbWEkaCwgZmllbGRQYXJ0cywgbWFrZSQ0LCBzcGVjKTtcbiAgICB9O1xuICAgIHZhciB0b1Jlc3VsdCQxID0gZnVuY3Rpb24gKG8sIGUpIHtcbiAgICAgIHJldHVybiBvLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gUmVzdWx0LmVycm9yKGUpO1xuICAgICAgfSwgUmVzdWx0LnZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBtYWtlJDQgPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcbiAgICAgICAgYmVoYXZpb3VyczogYXVnbWVudChkZXRhaWwuZm9ybUJlaGF2aW91cnMsIFtSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIG1vZGU6ICdtYW51YWwnLFxuICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzUHMgPSBnZXRBbGxQYXJ0cyhmb3JtLCBkZXRhaWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXAkMihyZXNQcywgZnVuY3Rpb24gKHJlc1BUaHVuaywgcE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiByZXNQVGh1bmsoKS5iaW5kKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHQgPSBDb21wb3NpbmcuZ2V0Q3VycmVudCh2KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvUmVzdWx0JDEob3B0LCBuZXcgRXJyb3IoJ0Nhbm5vdCBmaW5kIGEgY3VycmVudCBjb21wb25lbnQgdG8gZXh0cmFjdCB0aGUgdmFsdWUgZnJvbSBmb3IgZm9ybSBwYXJ0IFxcJycgKyBwTmFtZSArICdcXCc6ICcgKyBlbGVtZW50KHYuZWxlbWVudCkpKTtcbiAgICAgICAgICAgICAgICAgIH0pLm1hcChSZXByZXNlbnRpbmcuZ2V0VmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gKGZvcm0sIHZhbHVlcykge1xuICAgICAgICAgICAgICAgIGVhY2gkMSh2YWx1ZXMsIGZ1bmN0aW9uIChuZXdWYWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICBnZXRQYXJ0KGZvcm0sIGRldGFpbCwga2V5KS5lYWNoKGZ1bmN0aW9uICh3cmFwcGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIENvbXBvc2luZy5nZXRDdXJyZW50KHdyYXBwZXIpLmVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZpZWxkLCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KV0pLFxuICAgICAgICBhcGlzOiB7XG4gICAgICAgICAgZ2V0RmllbGQ6IGZ1bmN0aW9uIChmb3JtLCBrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRQYXJ0KGZvcm0sIGRldGFpbCwga2V5KS5iaW5kKENvbXBvc2luZy5nZXRDdXJyZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgRm9ybSA9IHtcbiAgICAgIGdldEZpZWxkOiBtYWtlQXBpKGZ1bmN0aW9uIChhcGlzLCBjb21wb25lbnQsIGtleSkge1xuICAgICAgICByZXR1cm4gYXBpcy5nZXRGaWVsZChjb21wb25lbnQsIGtleSk7XG4gICAgICB9KSxcbiAgICAgIHNrZXRjaDogc2tldGNoJDFcbiAgICB9O1xuXG4gICAgdmFyIHZhbGlkSW5wdXQgPSBnZW5lcmF0ZSQxKCd2YWxpZC1pbnB1dCcpO1xuICAgIHZhciBpbnZhbGlkSW5wdXQgPSBnZW5lcmF0ZSQxKCdpbnZhbGlkLWlucHV0Jyk7XG4gICAgdmFyIHZhbGlkYXRpbmdJbnB1dCA9IGdlbmVyYXRlJDEoJ3ZhbGlkYXRpbmctaW5wdXQnKTtcbiAgICB2YXIgdHJhbnNsYXRlUHJlZml4ID0gJ2NvbG9yY3VzdG9tLnJnYi4nO1xuICAgIHZhciByZ2JGb3JtRmFjdG9yeSA9IGZ1bmN0aW9uICh0cmFuc2xhdGUsIGdldENsYXNzLCBvblZhbGlkSGV4eCwgb25JbnZhbGlkSGV4eCkge1xuICAgICAgdmFyIGludmFsaWRhdGlvbiA9IGZ1bmN0aW9uIChsYWJlbCwgaXNWYWxpZCkge1xuICAgICAgICByZXR1cm4gSW52YWxpZGF0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgaW52YWxpZENsYXNzOiBnZXRDbGFzcygnaW52YWxpZCcpLFxuICAgICAgICAgIG5vdGlmeToge1xuICAgICAgICAgICAgb25WYWxpZGF0ZTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcCwgdmFsaWRhdGluZ0lucHV0LCB7IHR5cGU6IGxhYmVsIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uVmFsaWQ6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIHZhbGlkSW5wdXQsIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBsYWJlbCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogUmVwcmVzZW50aW5nLmdldFZhbHVlKGNvbXApXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uSW52YWxpZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcCwgaW52YWxpZElucHV0LCB7XG4gICAgICAgICAgICAgICAgdHlwZTogbGFiZWwsXG4gICAgICAgICAgICAgICAgdmFsdWU6IFJlcHJlc2VudGluZy5nZXRWYWx1ZShjb21wKVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbGlkYXRvcjoge1xuICAgICAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIHZhciB2YWx1ZSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShjb21wKTtcbiAgICAgICAgICAgICAgdmFyIHJlcyA9IGlzVmFsaWQodmFsdWUpID8gUmVzdWx0LnZhbHVlKHRydWUpIDogUmVzdWx0LmVycm9yKHRyYW5zbGF0ZSgnYXJpYS5pbnB1dC5pbnZhbGlkJykpO1xuICAgICAgICAgICAgICByZXR1cm4gRnV0dXJlLnB1cmUocmVzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2YWxpZGF0ZU9uTG9hZDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciByZW5kZXJUZXh0RmllbGQgPSBmdW5jdGlvbiAoaXNWYWxpZCwgbmFtZSwgbGFiZWwsIGRlc2NyaXB0aW9uLCBkYXRhKSB7XG4gICAgICAgIHZhciBoZWxwdGV4dCA9IHRyYW5zbGF0ZSh0cmFuc2xhdGVQcmVmaXggKyAncmFuZ2UnKTtcbiAgICAgICAgdmFyIHBMYWJlbCA9IEZvcm1GaWVsZC5wYXJ0cy5sYWJlbCh7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdsYWJlbCcsXG4gICAgICAgICAgICBpbm5lckh0bWw6IGxhYmVsLFxuICAgICAgICAgICAgYXR0cmlidXRlczogeyAnYXJpYS1sYWJlbCc6IGRlc2NyaXB0aW9uIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgcEZpZWxkID0gRm9ybUZpZWxkLnBhcnRzLmZpZWxkKHtcbiAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgIGZhY3Rvcnk6IElucHV0LFxuICAgICAgICAgIGlucHV0QXR0cmlidXRlczogX19hc3NpZ24oeyB0eXBlOiAndGV4dCcgfSwgbmFtZSA9PT0gJ2hleCcgPyB7ICdhcmlhLWxpdmUnOiAncG9saXRlJyB9IDoge30pLFxuICAgICAgICAgIGlucHV0Q2xhc3NlczogW2dldENsYXNzKCd0ZXh0ZmllbGQnKV0sXG4gICAgICAgICAgaW5wdXRCZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBpbnZhbGlkYXRpb24obmFtZSwgaXNWYWxpZCksXG4gICAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pXG4gICAgICAgICAgXSksXG4gICAgICAgICAgb25TZXRWYWx1ZTogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICBpZiAoSW52YWxpZGF0aW5nLmlzSW52YWxpZChpbnB1dCkpIHtcbiAgICAgICAgICAgICAgdmFyIHJ1biA9IEludmFsaWRhdGluZy5ydW4oaW5wdXQpO1xuICAgICAgICAgICAgICBydW4uZ2V0KG5vb3ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBjb21wcyA9IFtcbiAgICAgICAgICBwTGFiZWwsXG4gICAgICAgICAgcEZpZWxkXG4gICAgICAgIF07XG4gICAgICAgIHZhciBjb25jYXRzID0gbmFtZSAhPT0gJ2hleCcgPyBbRm9ybUZpZWxkLnBhcnRzWydhcmlhLWRlc2NyaXB0b3InXSh7IHRleHQ6IGhlbHB0ZXh0IH0pXSA6IFtdO1xuICAgICAgICB2YXIgY29tcG9uZW50cyA9IGNvbXBzLmNvbmNhdChjb25jYXRzKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHJvbGU6ICdwcmVzZW50YXRpb24nIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHNcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgY29weVJnYlRvSGV4ID0gZnVuY3Rpb24gKGZvcm0sIHJnYmEpIHtcbiAgICAgICAgdmFyIGhleCA9IGZyb21SZ2JhKHJnYmEpO1xuICAgICAgICBGb3JtLmdldEZpZWxkKGZvcm0sICdoZXgnKS5lYWNoKGZ1bmN0aW9uIChoZXhGaWVsZCkge1xuICAgICAgICAgIGlmICghRm9jdXNpbmcuaXNGb2N1c2VkKGhleEZpZWxkKSkge1xuICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZvcm0sIHsgaGV4OiBoZXgudmFsdWUgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGhleDtcbiAgICAgIH07XG4gICAgICB2YXIgY29weVJnYlRvRm9ybSA9IGZ1bmN0aW9uIChmb3JtLCByZ2IpIHtcbiAgICAgICAgdmFyIHJlZCA9IHJnYi5yZWQ7XG4gICAgICAgIHZhciBncmVlbiA9IHJnYi5ncmVlbjtcbiAgICAgICAgdmFyIGJsdWUgPSByZ2IuYmx1ZTtcbiAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZvcm0sIHtcbiAgICAgICAgICByZWQ6IHJlZCxcbiAgICAgICAgICBncmVlbjogZ3JlZW4sXG4gICAgICAgICAgYmx1ZTogYmx1ZVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgbWVtUHJldmlldyA9IHJlY29yZCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW2dldENsYXNzKCdyZ2JhLXByZXZpZXcnKV0sXG4gICAgICAgICAgc3R5bGVzOiB7ICdiYWNrZ3JvdW5kLWNvbG9yJzogJ3doaXRlJyB9LFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciB1cGRhdGVQcmV2aWV3ID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCBoZXgpIHtcbiAgICAgICAgbWVtUHJldmlldy5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKHByZXZpZXcpIHtcbiAgICAgICAgICBzZXQkMihwcmV2aWV3LmVsZW1lbnQsICdiYWNrZ3JvdW5kLWNvbG9yJywgJyMnICsgaGV4LnZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZhY3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzdGF0ZSA9IHtcbiAgICAgICAgICByZWQ6IENlbGwoT3B0aW9uYWwuc29tZSgyNTUpKSxcbiAgICAgICAgICBncmVlbjogQ2VsbChPcHRpb25hbC5zb21lKDI1NSkpLFxuICAgICAgICAgIGJsdWU6IENlbGwoT3B0aW9uYWwuc29tZSgyNTUpKSxcbiAgICAgICAgICBoZXg6IENlbGwoT3B0aW9uYWwuc29tZSgnZmZmZmZmJykpXG4gICAgICAgIH07XG4gICAgICAgIHZhciBjb3B5SGV4VG9SZ2IgPSBmdW5jdGlvbiAoZm9ybSwgaGV4KSB7XG4gICAgICAgICAgdmFyIHJnYiA9IGZyb21IZXgoaGV4KTtcbiAgICAgICAgICBjb3B5UmdiVG9Gb3JtKGZvcm0sIHJnYik7XG4gICAgICAgICAgc2V0VmFsdWVSZ2IocmdiKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlW3Byb3BdLmdldCgpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7XG4gICAgICAgICAgc3RhdGVbcHJvcF0uc2V0KHZhbHVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGdldFZhbHVlUmdiID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXQoJ3JlZCcpLmJpbmQoZnVuY3Rpb24gKHJlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldCgnZ3JlZW4nKS5iaW5kKGZ1bmN0aW9uIChncmVlbikge1xuICAgICAgICAgICAgICByZXR1cm4gZ2V0KCdibHVlJykubWFwKGZ1bmN0aW9uIChibHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJnYmFDb2xvdXIocmVkLCBncmVlbiwgYmx1ZSwgMSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZXRWYWx1ZVJnYiA9IGZ1bmN0aW9uIChyZ2IpIHtcbiAgICAgICAgICB2YXIgcmVkID0gcmdiLnJlZDtcbiAgICAgICAgICB2YXIgZ3JlZW4gPSByZ2IuZ3JlZW47XG4gICAgICAgICAgdmFyIGJsdWUgPSByZ2IuYmx1ZTtcbiAgICAgICAgICBzZXQoJ3JlZCcsIE9wdGlvbmFsLnNvbWUocmVkKSk7XG4gICAgICAgICAgc2V0KCdncmVlbicsIE9wdGlvbmFsLnNvbWUoZ3JlZW4pKTtcbiAgICAgICAgICBzZXQoJ2JsdWUnLCBPcHRpb25hbC5zb21lKGJsdWUpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG9uSW52YWxpZElucHV0ID0gZnVuY3Rpb24gKGZvcm0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBzaW11bGF0ZWRFdmVudC5ldmVudDtcbiAgICAgICAgICBpZiAoZGF0YS50eXBlICE9PSAnaGV4Jykge1xuICAgICAgICAgICAgc2V0KGRhdGEudHlwZSwgT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb25JbnZhbGlkSGV4eChmb3JtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBvblZhbGlkSGV4ID0gZnVuY3Rpb24gKGZvcm0sIHZhbHVlKSB7XG4gICAgICAgICAgb25WYWxpZEhleHgoZm9ybSk7XG4gICAgICAgICAgdmFyIGhleCA9IGhleENvbG91cih2YWx1ZSk7XG4gICAgICAgICAgc2V0KCdoZXgnLCBPcHRpb25hbC5zb21lKHZhbHVlKSk7XG4gICAgICAgICAgdmFyIHJnYiA9IGZyb21IZXgoaGV4KTtcbiAgICAgICAgICBjb3B5UmdiVG9Gb3JtKGZvcm0sIHJnYik7XG4gICAgICAgICAgc2V0VmFsdWVSZ2IocmdiKTtcbiAgICAgICAgICBlbWl0V2l0aChmb3JtLCBmaWVsZHNVcGRhdGUsIHsgaGV4OiBoZXggfSk7XG4gICAgICAgICAgdXBkYXRlUHJldmlldyhmb3JtLCBoZXgpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25WYWxpZFJnYiA9IGZ1bmN0aW9uIChmb3JtLCBwcm9wLCB2YWx1ZSkge1xuICAgICAgICAgIHZhciB2YWwgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICAgICAgICAgIHNldChwcm9wLCBPcHRpb25hbC5zb21lKHZhbCkpO1xuICAgICAgICAgIGdldFZhbHVlUmdiKCkuZWFjaChmdW5jdGlvbiAocmdiKSB7XG4gICAgICAgICAgICB2YXIgaGV4ID0gY29weVJnYlRvSGV4KGZvcm0sIHJnYik7XG4gICAgICAgICAgICBlbWl0V2l0aChmb3JtLCBmaWVsZHNVcGRhdGUsIHsgaGV4OiBoZXggfSk7XG4gICAgICAgICAgICB1cGRhdGVQcmV2aWV3KGZvcm0sIGhleCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBpc0hleElucHV0RXZlbnQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHJldHVybiBkYXRhLnR5cGUgPT09ICdoZXgnO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25WYWxpZElucHV0ID0gZnVuY3Rpb24gKGZvcm0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBzaW11bGF0ZWRFdmVudC5ldmVudDtcbiAgICAgICAgICBpZiAoaXNIZXhJbnB1dEV2ZW50KGRhdGEpKSB7XG4gICAgICAgICAgICBvblZhbGlkSGV4KGZvcm0sIGRhdGEudmFsdWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvblZhbGlkUmdiKGZvcm0sIGRhdGEudHlwZSwgZGF0YS52YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgZm9ybVBhcnRTdHJpbmdzID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsYWJlbDogdHJhbnNsYXRlKHRyYW5zbGF0ZVByZWZpeCArIGtleSArICcubGFiZWwnKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0cmFuc2xhdGUodHJhbnNsYXRlUHJlZml4ICsga2V5ICsgJy5kZXNjcmlwdGlvbicpXG4gICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHJlZFN0cmluZ3MgPSBmb3JtUGFydFN0cmluZ3MoJ3JlZCcpO1xuICAgICAgICB2YXIgZ3JlZW5TdHJpbmdzID0gZm9ybVBhcnRTdHJpbmdzKCdncmVlbicpO1xuICAgICAgICB2YXIgYmx1ZVN0cmluZ3MgPSBmb3JtUGFydFN0cmluZ3MoJ2JsdWUnKTtcbiAgICAgICAgdmFyIGhleFN0cmluZ3MgPSBmb3JtUGFydFN0cmluZ3MoJ2hleCcpO1xuICAgICAgICByZXR1cm4gZGVlcE1lcmdlKEZvcm0uc2tldGNoKGZ1bmN0aW9uIChwYXJ0cykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZm9ybScsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFtnZXRDbGFzcygncmdiLWZvcm0nKV0sXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgJ2FyaWEtbGFiZWwnOiB0cmFuc2xhdGUoJ2FyaWEuY29sb3IucGlja2VyJykgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICAgICAgcGFydHMuZmllbGQoJ3JlZCcsIEZvcm1GaWVsZC5za2V0Y2gocmVuZGVyVGV4dEZpZWxkKGlzUmdiYUNvbXBvbmVudCwgJ3JlZCcsIHJlZFN0cmluZ3MubGFiZWwsIHJlZFN0cmluZ3MuZGVzY3JpcHRpb24sIDI1NSkpKSxcbiAgICAgICAgICAgICAgcGFydHMuZmllbGQoJ2dyZWVuJywgRm9ybUZpZWxkLnNrZXRjaChyZW5kZXJUZXh0RmllbGQoaXNSZ2JhQ29tcG9uZW50LCAnZ3JlZW4nLCBncmVlblN0cmluZ3MubGFiZWwsIGdyZWVuU3RyaW5ncy5kZXNjcmlwdGlvbiwgMjU1KSkpLFxuICAgICAgICAgICAgICBwYXJ0cy5maWVsZCgnYmx1ZScsIEZvcm1GaWVsZC5za2V0Y2gocmVuZGVyVGV4dEZpZWxkKGlzUmdiYUNvbXBvbmVudCwgJ2JsdWUnLCBibHVlU3RyaW5ncy5sYWJlbCwgYmx1ZVN0cmluZ3MuZGVzY3JpcHRpb24sIDI1NSkpKSxcbiAgICAgICAgICAgICAgcGFydHMuZmllbGQoJ2hleCcsIEZvcm1GaWVsZC5za2V0Y2gocmVuZGVyVGV4dEZpZWxkKGlzSGV4U3RyaW5nLCAnaGV4JywgaGV4U3RyaW5ncy5sYWJlbCwgaGV4U3RyaW5ncy5kZXNjcmlwdGlvbiwgJ2ZmZmZmZicpKSksXG4gICAgICAgICAgICAgIG1lbVByZXZpZXcuYXNTcGVjKClcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBmb3JtQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgICAgICBJbnZhbGlkYXRpbmcuY29uZmlnKHsgaW52YWxpZENsYXNzOiBnZXRDbGFzcygnZm9ybS1pbnZhbGlkJykgfSksXG4gICAgICAgICAgICAgIGNvbmZpZygncmdiLWZvcm0tZXZlbnRzJywgW1xuICAgICAgICAgICAgICAgIHJ1bih2YWxpZElucHV0LCBvblZhbGlkSW5wdXQpLFxuICAgICAgICAgICAgICAgIHJ1bihpbnZhbGlkSW5wdXQsIG9uSW52YWxpZElucHV0KSxcbiAgICAgICAgICAgICAgICBydW4odmFsaWRhdGluZ0lucHV0LCBvbkludmFsaWRJbnB1dClcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgfTtcbiAgICAgICAgfSksIHtcbiAgICAgICAgICBhcGlzOiB7XG4gICAgICAgICAgICB1cGRhdGVIZXg6IGZ1bmN0aW9uIChmb3JtLCBoZXgpIHtcbiAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZvcm0sIHsgaGV4OiBoZXgudmFsdWUgfSk7XG4gICAgICAgICAgICAgIGNvcHlIZXhUb1JnYihmb3JtLCBoZXgpO1xuICAgICAgICAgICAgICB1cGRhdGVQcmV2aWV3KGZvcm0sIGhleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgcmdiRm9ybVNrZXRjaGVyID0gc2luZ2xlJDIoe1xuICAgICAgICBmYWN0b3J5OiBmYWN0b3J5LFxuICAgICAgICBuYW1lOiAnUmdiRm9ybScsXG4gICAgICAgIGNvbmZpZ0ZpZWxkczogW10sXG4gICAgICAgIGFwaXM6IHtcbiAgICAgICAgICB1cGRhdGVIZXg6IGZ1bmN0aW9uIChhcGlzLCBmb3JtLCBoZXgpIHtcbiAgICAgICAgICAgIGFwaXMudXBkYXRlSGV4KGZvcm0sIGhleCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBleHRyYUFwaXM6IHt9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZ2JGb3JtU2tldGNoZXI7XG4gICAgfTtcblxuICAgIHZhciBwYWxldHRlRmFjdG9yeSA9IGZ1bmN0aW9uIChfdHJhbnNsYXRlLCBnZXRDbGFzcykge1xuICAgICAgdmFyIHNwZWN0cnVtUGFydCA9IFNsaWRlci5wYXJ0cy5zcGVjdHJ1bSh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2NhbnZhcycsXG4gICAgICAgICAgYXR0cmlidXRlczogeyByb2xlOiAncHJlc2VudGF0aW9uJyB9LFxuICAgICAgICAgIGNsYXNzZXM6IFtnZXRDbGFzcygnc3YtcGFsZXR0ZS1zcGVjdHJ1bScpXVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciB0aHVtYlBhcnQgPSBTbGlkZXIucGFydHMudGh1bWIoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfSxcbiAgICAgICAgICBjbGFzc2VzOiBbZ2V0Q2xhc3MoJ3N2LXBhbGV0dGUtdGh1bWInKV0sXG4gICAgICAgICAgaW5uZXJIdG1sOiAnPGRpdiBjbGFzcz0nICsgZ2V0Q2xhc3MoJ3N2LXBhbGV0dGUtaW5uZXItdGh1bWInKSArICcgcm9sZT1cInByZXNlbnRhdGlvblwiPjwvZGl2PidcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgc2V0Q29sb3VyID0gZnVuY3Rpb24gKGNhbnZhcywgcmdiYSkge1xuICAgICAgICB2YXIgd2lkdGggPSBjYW52YXMud2lkdGgsIGhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG4gICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgaWYgKGN0eCA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjdHguZmlsbFN0eWxlID0gcmdiYTtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB2YXIgZ3JkV2hpdGUgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgd2lkdGgsIDApO1xuICAgICAgICBncmRXaGl0ZS5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LDI1NSwyNTUsMSknKTtcbiAgICAgICAgZ3JkV2hpdGUuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwyNTUsMjU1LDApJyk7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmRXaGl0ZTtcbiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB2YXIgZ3JkQmxhY2sgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgaGVpZ2h0KTtcbiAgICAgICAgZ3JkQmxhY2suYWRkQ29sb3JTdG9wKDAsICdyZ2JhKDAsMCwwLDApJyk7XG4gICAgICAgIGdyZEJsYWNrLmFkZENvbG9yU3RvcCgxLCAncmdiYSgwLDAsMCwxKScpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JkQmxhY2s7XG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0UGFsZXR0ZUh1ZSA9IGZ1bmN0aW9uIChzbGlkZXIsIGh1ZSkge1xuICAgICAgICB2YXIgY2FudmFzID0gc2xpZGVyLmNvbXBvbmVudHMoKVswXS5lbGVtZW50LmRvbTtcbiAgICAgICAgdmFyIGhzdiA9IGhzdkNvbG91cihodWUsIDEwMCwgMTAwKTtcbiAgICAgICAgdmFyIHJnYmEgPSBmcm9tSHN2KGhzdik7XG4gICAgICAgIHNldENvbG91cihjYW52YXMsIHRvU3RyaW5nKHJnYmEpKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0UGFsZXR0ZVRodW1iID0gZnVuY3Rpb24gKHNsaWRlciwgaGV4KSB7XG4gICAgICAgIHZhciBoc3YgPSBmcm9tUmdiKGZyb21IZXgoaGV4KSk7XG4gICAgICAgIFNsaWRlci5zZXRWYWx1ZShzbGlkZXIsIHtcbiAgICAgICAgICB4OiBoc3Yuc2F0dXJhdGlvbixcbiAgICAgICAgICB5OiAxMDAgLSBoc3YudmFsdWVcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZhY3RvcnkgPSBmdW5jdGlvbiAoX2RldGFpbCkge1xuICAgICAgICB2YXIgZ2V0SW5pdGlhbFZhbHVlID0gY29uc3RhbnQoe1xuICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgeTogMFxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG9uQ2hhbmdlID0gZnVuY3Rpb24gKHNsaWRlciwgX3RodW1iLCB2YWx1ZSkge1xuICAgICAgICAgIGVtaXRXaXRoKHNsaWRlciwgcGFsZXR0ZVVwZGF0ZSwgeyB2YWx1ZTogdmFsdWUgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBvbkluaXQgPSBmdW5jdGlvbiAoX3NsaWRlciwgX3RodW1iLCBzcGVjdHJ1bSwgX3ZhbHVlKSB7XG4gICAgICAgICAgc2V0Q29sb3VyKHNwZWN0cnVtLmVsZW1lbnQuZG9tLCB0b1N0cmluZyhyZWQpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHNsaWRlckJlaGF2aW91cnMgPSBkZXJpdmUkMShbXG4gICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7IGZpbmQ6IE9wdGlvbmFsLnNvbWUgfSksXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KVxuICAgICAgICBdKTtcbiAgICAgICAgcmV0dXJuIFNsaWRlci5za2V0Y2goe1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfSxcbiAgICAgICAgICAgIGNsYXNzZXM6IFtnZXRDbGFzcygnc3YtcGFsZXR0ZScpXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbW9kZWw6IHtcbiAgICAgICAgICAgIG1vZGU6ICd4eScsXG4gICAgICAgICAgICBnZXRJbml0aWFsVmFsdWU6IGdldEluaXRpYWxWYWx1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcm91bmRlZDogZmFsc2UsXG4gICAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgICAgc3BlY3RydW1QYXJ0LFxuICAgICAgICAgICAgdGh1bWJQYXJ0XG4gICAgICAgICAgXSxcbiAgICAgICAgICBvbkNoYW5nZTogb25DaGFuZ2UsXG4gICAgICAgICAgb25Jbml0OiBvbkluaXQsXG4gICAgICAgICAgc2xpZGVyQmVoYXZpb3Vyczogc2xpZGVyQmVoYXZpb3Vyc1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2F0dXJhdGlvbkJyaWdodG5lc3NQYWxldHRlU2tldGNoZXIgPSBzaW5nbGUkMih7XG4gICAgICAgIGZhY3Rvcnk6IGZhY3RvcnksXG4gICAgICAgIG5hbWU6ICdTYXR1cmF0aW9uQnJpZ2h0bmVzc1BhbGV0dGUnLFxuICAgICAgICBjb25maWdGaWVsZHM6IFtdLFxuICAgICAgICBhcGlzOiB7XG4gICAgICAgICAgc2V0SHVlOiBmdW5jdGlvbiAoX2FwaXMsIHNsaWRlciwgaHVlKSB7XG4gICAgICAgICAgICBzZXRQYWxldHRlSHVlKHNsaWRlciwgaHVlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldFRodW1iOiBmdW5jdGlvbiAoX2FwaXMsIHNsaWRlciwgaGV4KSB7XG4gICAgICAgICAgICBzZXRQYWxldHRlVGh1bWIoc2xpZGVyLCBoZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXh0cmFBcGlzOiB7fVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc2F0dXJhdGlvbkJyaWdodG5lc3NQYWxldHRlU2tldGNoZXI7XG4gICAgfTtcblxuICAgIHZhciBtYWtlRmFjdG9yeSA9IGZ1bmN0aW9uICh0cmFuc2xhdGUsIGdldENsYXNzKSB7XG4gICAgICB2YXIgZmFjdG9yeSA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgdmFyIHJnYkZvcm0gPSByZ2JGb3JtRmFjdG9yeSh0cmFuc2xhdGUsIGdldENsYXNzLCBkZXRhaWwub25WYWxpZEhleCwgZGV0YWlsLm9uSW52YWxpZEhleCk7XG4gICAgICAgIHZhciBzYlBhbGV0dGUgPSBwYWxldHRlRmFjdG9yeSh0cmFuc2xhdGUsIGdldENsYXNzKTtcbiAgICAgICAgdmFyIGh1ZVNsaWRlclRvRGVncmVlcyA9IGZ1bmN0aW9uIChodWUpIHtcbiAgICAgICAgICByZXR1cm4gKDEwMCAtIGh1ZSkgLyAxMDAgKiAzNjA7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBodWVEZWdyZWVzVG9TbGlkZXIgPSBmdW5jdGlvbiAoaHVlKSB7XG4gICAgICAgICAgcmV0dXJuIDEwMCAtIGh1ZSAvIDM2MCAqIDEwMDtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHN0YXRlID0ge1xuICAgICAgICAgIHBhbGV0dGVSZ2JhOiBDZWxsKHJlZCksXG4gICAgICAgICAgcGFsZXR0ZUh1ZTogQ2VsbCgwKVxuICAgICAgICB9O1xuICAgICAgICB2YXIgbWVtU2xpZGVyID0gcmVjb3JkKHNsaWRlckZhY3RvcnkodHJhbnNsYXRlLCBnZXRDbGFzcykpO1xuICAgICAgICB2YXIgbWVtUGFsZXR0ZSA9IHJlY29yZChzYlBhbGV0dGUuc2tldGNoKHt9KSk7XG4gICAgICAgIHZhciBtZW1SZ2IgPSByZWNvcmQocmdiRm9ybS5za2V0Y2goe30pKTtcbiAgICAgICAgdmFyIHVwZGF0ZVBhbGV0dGUgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIF9oZXgsIGh1ZSkge1xuICAgICAgICAgIG1lbVBhbGV0dGUuZ2V0T3B0KGFueUluU3lzdGVtKS5lYWNoKGZ1bmN0aW9uIChwYWxldHRlKSB7XG4gICAgICAgICAgICBzYlBhbGV0dGUuc2V0SHVlKHBhbGV0dGUsIGh1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciB1cGRhdGVGaWVsZHMgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIGhleCkge1xuICAgICAgICAgIG1lbVJnYi5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgICAgIHJnYkZvcm0udXBkYXRlSGV4KGZvcm0sIGhleCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciB1cGRhdGVTbGlkZXIgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIF9oZXgsIGh1ZSkge1xuICAgICAgICAgIG1lbVNsaWRlci5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKHNsaWRlcikge1xuICAgICAgICAgICAgU2xpZGVyLnNldFZhbHVlKHNsaWRlciwgeyB5OiBodWVEZWdyZWVzVG9TbGlkZXIoaHVlKSB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHVwZGF0ZVBhbGV0dGVUaHVtYiA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgaGV4KSB7XG4gICAgICAgICAgbWVtUGFsZXR0ZS5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKHBhbGV0dGUpIHtcbiAgICAgICAgICAgIHNiUGFsZXR0ZS5zZXRUaHVtYihwYWxldHRlLCBoZXgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgdXBkYXRlU3RhdGUgPSBmdW5jdGlvbiAoaGV4LCBodWUpIHtcbiAgICAgICAgICB2YXIgcmdiYSA9IGZyb21IZXgoaGV4KTtcbiAgICAgICAgICBzdGF0ZS5wYWxldHRlUmdiYS5zZXQocmdiYSk7XG4gICAgICAgICAgc3RhdGUucGFsZXR0ZUh1ZS5zZXQoaHVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHJ1blVwZGF0ZXMgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIGhleCwgaHVlLCB1cGRhdGVzKSB7XG4gICAgICAgICAgdXBkYXRlU3RhdGUoaGV4LCBodWUpO1xuICAgICAgICAgIGVhY2godXBkYXRlcywgZnVuY3Rpb24gKHVwZGF0ZSkge1xuICAgICAgICAgICAgdXBkYXRlKGFueUluU3lzdGVtLCBoZXgsIGh1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBvblBhbGV0dGVVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHVwZGF0ZXMgPSBbdXBkYXRlRmllbGRzXTtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGZvcm0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzaW11bGF0ZWRFdmVudC5ldmVudC52YWx1ZTtcbiAgICAgICAgICAgIHZhciBvbGRIdWUgPSBzdGF0ZS5wYWxldHRlSHVlLmdldCgpO1xuICAgICAgICAgICAgdmFyIG5ld0hzdiA9IGhzdkNvbG91cihvbGRIdWUsIHZhbHVlLngsIDEwMCAtIHZhbHVlLnkpO1xuICAgICAgICAgICAgdmFyIG5ld0hleCA9IGhzdlRvSGV4KG5ld0hzdik7XG4gICAgICAgICAgICBydW5VcGRhdGVzKGZvcm0sIG5ld0hleCwgb2xkSHVlLCB1cGRhdGVzKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgb25TbGlkZXJVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHVwZGF0ZXMgPSBbXG4gICAgICAgICAgICB1cGRhdGVQYWxldHRlLFxuICAgICAgICAgICAgdXBkYXRlRmllbGRzXG4gICAgICAgICAgXTtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGZvcm0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgaHVlID0gaHVlU2xpZGVyVG9EZWdyZWVzKHNpbXVsYXRlZEV2ZW50LmV2ZW50LnZhbHVlLnkpO1xuICAgICAgICAgICAgdmFyIG9sZFJnYiA9IHN0YXRlLnBhbGV0dGVSZ2JhLmdldCgpO1xuICAgICAgICAgICAgdmFyIG9sZEhzdiA9IGZyb21SZ2Iob2xkUmdiKTtcbiAgICAgICAgICAgIHZhciBuZXdIc3YgPSBoc3ZDb2xvdXIoaHVlLCBvbGRIc3Yuc2F0dXJhdGlvbiwgb2xkSHN2LnZhbHVlKTtcbiAgICAgICAgICAgIHZhciBuZXdIZXggPSBoc3ZUb0hleChuZXdIc3YpO1xuICAgICAgICAgICAgcnVuVXBkYXRlcyhmb3JtLCBuZXdIZXgsIGh1ZSwgdXBkYXRlcyk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG9uRmllbGRzVXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciB1cGRhdGVzID0gW1xuICAgICAgICAgICAgdXBkYXRlUGFsZXR0ZSxcbiAgICAgICAgICAgIHVwZGF0ZVNsaWRlcixcbiAgICAgICAgICAgIHVwZGF0ZVBhbGV0dGVUaHVtYlxuICAgICAgICAgIF07XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChmb3JtLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgdmFyIGhleCA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50LmhleDtcbiAgICAgICAgICAgIHZhciBoc3YgPSBoZXhUb0hzdihoZXgpO1xuICAgICAgICAgICAgcnVuVXBkYXRlcyhmb3JtLCBoZXgsIGhzdi5odWUsIHVwZGF0ZXMpO1xuICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgICBtZW1QYWxldHRlLmFzU3BlYygpLFxuICAgICAgICAgICAgbWVtU2xpZGVyLmFzU3BlYygpLFxuICAgICAgICAgICAgbWVtUmdiLmFzU3BlYygpXG4gICAgICAgICAgXSxcbiAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBjb25maWcoJ2NvbG91ci1waWNrZXItZXZlbnRzJywgW1xuICAgICAgICAgICAgICBydW4oZmllbGRzVXBkYXRlLCBvbkZpZWxkc1VwZGF0ZSgpKSxcbiAgICAgICAgICAgICAgcnVuKHBhbGV0dGVVcGRhdGUsIG9uUGFsZXR0ZVVwZGF0ZSgpKSxcbiAgICAgICAgICAgICAgcnVuKHNsaWRlclVwZGF0ZSwgb25TbGlkZXJVcGRhdGUoKSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICAgIGZpbmQ6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lbVJnYi5nZXRPcHQoY29tcCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgS2V5aW5nLmNvbmZpZyh7IG1vZGU6ICdhY3ljbGljJyB9KVxuICAgICAgICAgIF0pXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGNvbG91clBpY2tlclNrZXRjaGVyID0gc2luZ2xlJDIoe1xuICAgICAgICBuYW1lOiAnQ29sb3VyUGlja2VyJyxcbiAgICAgICAgY29uZmlnRmllbGRzOiBbXG4gICAgICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdvblZhbGlkSGV4Jywgbm9vcCksXG4gICAgICAgICAgZGVmYXVsdGVkJDEoJ29uSW52YWxpZEhleCcsIG5vb3ApXG4gICAgICAgIF0sXG4gICAgICAgIGZhY3Rvcnk6IGZhY3RvcnlcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbG91clBpY2tlclNrZXRjaGVyO1xuICAgIH07XG5cbiAgICB2YXIgc2VsZiQxID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIENvbXBvc2luZy5jb25maWcoeyBmaW5kOiBPcHRpb25hbC5zb21lIH0pO1xuICAgIH07XG4gICAgdmFyIG1lbWVudG8gPSBmdW5jdGlvbiAobWVtKSB7XG4gICAgICByZXR1cm4gQ29tcG9zaW5nLmNvbmZpZyh7IGZpbmQ6IG1lbS5nZXRPcHQgfSk7XG4gICAgfTtcbiAgICB2YXIgY2hpbGRBdCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgcmV0dXJuIENvbXBvc2luZy5jb25maWcoe1xuICAgICAgICBmaW5kOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHJldHVybiBjaGlsZChjb21wLmVsZW1lbnQsIGluZGV4KS5iaW5kKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcC5nZXRTeXN0ZW0oKS5nZXRCeURvbShlbGVtZW50KS50b09wdGlvbmFsKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIENvbXBvc2luZ0NvbmZpZ3MgPSB7XG4gICAgICBzZWxmOiBzZWxmJDEsXG4gICAgICBtZW1lbnRvOiBtZW1lbnRvLFxuICAgICAgY2hpbGRBdDogY2hpbGRBdFxuICAgIH07XG5cbiAgICB2YXIgZW5nbGlzaCA9IHtcbiAgICAgICdjb2xvcmN1c3RvbS5yZ2IucmVkLmxhYmVsJzogJ1InLFxuICAgICAgJ2NvbG9yY3VzdG9tLnJnYi5yZWQuZGVzY3JpcHRpb24nOiAnUmVkIGNvbXBvbmVudCcsXG4gICAgICAnY29sb3JjdXN0b20ucmdiLmdyZWVuLmxhYmVsJzogJ0cnLFxuICAgICAgJ2NvbG9yY3VzdG9tLnJnYi5ncmVlbi5kZXNjcmlwdGlvbic6ICdHcmVlbiBjb21wb25lbnQnLFxuICAgICAgJ2NvbG9yY3VzdG9tLnJnYi5ibHVlLmxhYmVsJzogJ0InLFxuICAgICAgJ2NvbG9yY3VzdG9tLnJnYi5ibHVlLmRlc2NyaXB0aW9uJzogJ0JsdWUgY29tcG9uZW50JyxcbiAgICAgICdjb2xvcmN1c3RvbS5yZ2IuaGV4LmxhYmVsJzogJyMnLFxuICAgICAgJ2NvbG9yY3VzdG9tLnJnYi5oZXguZGVzY3JpcHRpb24nOiAnSGV4IGNvbG9yIGNvZGUnLFxuICAgICAgJ2NvbG9yY3VzdG9tLnJnYi5yYW5nZSc6ICdSYW5nZSAwIHRvIDI1NScsXG4gICAgICAnY29sb3JjdXN0b20uc2Iuc2F0dXJhdGlvbic6ICdTYXR1cmF0aW9uJyxcbiAgICAgICdjb2xvcmN1c3RvbS5zYi5icmlnaHRuZXNzJzogJ0JyaWdodG5lc3MnLFxuICAgICAgJ2NvbG9yY3VzdG9tLnNiLnBpY2tlcic6ICdTYXR1cmF0aW9uIGFuZCBCcmlnaHRuZXNzIFBpY2tlcicsXG4gICAgICAnY29sb3JjdXN0b20uc2IucGFsZXR0ZSc6ICdTYXR1cmF0aW9uIGFuZCBCcmlnaHRuZXNzIFBhbGV0dGUnLFxuICAgICAgJ2NvbG9yY3VzdG9tLnNiLmluc3RydWN0aW9ucyc6ICdVc2UgYXJyb3cga2V5cyB0byBzZWxlY3Qgc2F0dXJhdGlvbiBhbmQgYnJpZ2h0bmVzcywgb24geCBhbmQgeSBheGVzJyxcbiAgICAgICdjb2xvcmN1c3RvbS5odWUuaHVlJzogJ0h1ZScsXG4gICAgICAnY29sb3JjdXN0b20uaHVlLnNsaWRlcic6ICdIdWUgU2xpZGVyJyxcbiAgICAgICdjb2xvcmN1c3RvbS5odWUucGFsZXR0ZSc6ICdIdWUgUGFsZXR0ZScsXG4gICAgICAnY29sb3JjdXN0b20uaHVlLmluc3RydWN0aW9ucyc6ICdVc2UgYXJyb3cga2V5cyB0byBzZWxlY3QgYSBodWUnLFxuICAgICAgJ2FyaWEuY29sb3IucGlja2VyJzogJ0NvbG9yIFBpY2tlcicsXG4gICAgICAnYXJpYS5pbnB1dC5pbnZhbGlkJzogJ0ludmFsaWQgaW5wdXQnXG4gICAgfTtcbiAgICB2YXIgZ2V0RW5nbGlzaFRleHQgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICByZXR1cm4gZW5nbGlzaFtrZXldO1xuICAgIH07XG4gICAgdmFyIHRyYW5zbGF0ZSQxID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgcmV0dXJuIGdldEVuZ2xpc2hUZXh0KGtleSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQ29sb3JQaWNrZXIgPSBmdW5jdGlvbiAoX3NwZWMpIHtcbiAgICAgIHZhciBnZXRDbGFzcyA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuICd0b3gtJyArIGtleTtcbiAgICAgIH07XG4gICAgICB2YXIgY29sb3VyUGlja2VyRmFjdG9yeSA9IG1ha2VGYWN0b3J5KHRyYW5zbGF0ZSQxLCBnZXRDbGFzcyk7XG4gICAgICB2YXIgb25WYWxpZEhleCA9IGZ1bmN0aW9uIChmb3JtKSB7XG4gICAgICAgIGVtaXRXaXRoKGZvcm0sIGZvcm1BY3Rpb25FdmVudCwge1xuICAgICAgICAgIG5hbWU6ICdoZXgtdmFsaWQnLFxuICAgICAgICAgIHZhbHVlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkludmFsaWRIZXggPSBmdW5jdGlvbiAoZm9ybSkge1xuICAgICAgICBlbWl0V2l0aChmb3JtLCBmb3JtQWN0aW9uRXZlbnQsIHtcbiAgICAgICAgICBuYW1lOiAnaGV4LXZhbGlkJyxcbiAgICAgICAgICB2YWx1ZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1lbVBpY2tlciA9IHJlY29yZChjb2xvdXJQaWNrZXJGYWN0b3J5LnNrZXRjaCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW2dldENsYXNzKCdjb2xvci1waWNrZXItY29udGFpbmVyJyldLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfVxuICAgICAgICB9LFxuICAgICAgICBvblZhbGlkSGV4OiBvblZhbGlkSGV4LFxuICAgICAgICBvbkludmFsaWRIZXg6IG9uSW52YWxpZEhleFxuICAgICAgfSkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7IHRhZzogJ2RpdicgfSxcbiAgICAgICAgY29tcG9uZW50czogW21lbVBpY2tlci5hc1NwZWMoKV0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgICAgIG1vZGU6ICdtYW51YWwnLFxuICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgICB2YXIgcGlja2VyID0gbWVtUGlja2VyLmdldChjb21wKTtcbiAgICAgICAgICAgICAgICB2YXIgb3B0UmdiRm9ybSA9IENvbXBvc2luZy5nZXRDdXJyZW50KHBpY2tlcik7XG4gICAgICAgICAgICAgICAgdmFyIG9wdEhleCA9IG9wdFJnYkZvcm0uYmluZChmdW5jdGlvbiAocmdiRm9ybSkge1xuICAgICAgICAgICAgICAgICAgdmFyIGZvcm1WYWx1ZXMgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUocmdiRm9ybSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybVZhbHVlcy5oZXg7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wdEhleC5tYXAoZnVuY3Rpb24gKGhleCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuICcjJyArIGhleDtcbiAgICAgICAgICAgICAgICB9KS5nZXRPcignJyk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoY29tcCwgbmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGF0dGVybiA9IC9eIyhbYS1mQS1GMC05XXszfSg/OlthLWZBLUYwLTldezN9KT8pLztcbiAgICAgICAgICAgICAgICB2YXIgbSA9IHBhdHRlcm4uZXhlYyhuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIHBpY2tlciA9IG1lbVBpY2tlci5nZXQoY29tcCk7XG4gICAgICAgICAgICAgICAgdmFyIG9wdFJnYkZvcm0gPSBDb21wb3NpbmcuZ2V0Q3VycmVudChwaWNrZXIpO1xuICAgICAgICAgICAgICAgIG9wdFJnYkZvcm0uZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FuIG5vdCBmaW5kIGZvcm0nKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmdiRm9ybSkge1xuICAgICAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKHJnYkZvcm0sIHsgaGV4OiBPcHRpb25hbC5mcm9tKG1bMV0pLmdldE9yKCcnKSB9KTtcbiAgICAgICAgICAgICAgICAgIEZvcm0uZ2V0RmllbGQocmdiRm9ybSwgJ2hleCcpLmVhY2goZnVuY3Rpb24gKGhleEZpZWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIGVtaXQoaGV4RmllbGQsIGlucHV0KCkpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBDb21wb3NpbmdDb25maWdzLnNlbGYoKVxuICAgICAgICBdKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCRiID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUmVzb3VyY2UnKTtcblxuICAgIHZhciBpc09sZEN1c3RvbUVkaXRvciA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNwZWMsICdpbml0Jyk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQ3VzdG9tRWRpdG9yID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHZhciBlZGl0b3JBcGkgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgbWVtUmVwbGFjZWQgPSByZWNvcmQoeyBkb206IHsgdGFnOiBzcGVjLnRhZyB9IH0pO1xuICAgICAgdmFyIGluaXRpYWxWYWx1ZSA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtY3VzdG9tLWVkaXRvciddXG4gICAgICAgIH0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBjb25maWcoJ2N1c3RvbS1lZGl0b3ItZXZlbnRzJywgW3J1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgICBtZW1SZXBsYWNlZC5nZXRPcHQoY29tcG9uZW50KS5lYWNoKGZ1bmN0aW9uICh0YSkge1xuICAgICAgICAgICAgICAgIChpc09sZEN1c3RvbUVkaXRvcihzcGVjKSA/IHNwZWMuaW5pdCh0YS5lbGVtZW50LmRvbSkgOiBnbG9iYWwkYi5sb2FkKHNwZWMuc2NyaXB0SWQsIHNwZWMuc2NyaXB0VXJsKS50aGVuKGZ1bmN0aW9uIChpbml0KSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdCh0YS5lbGVtZW50LmRvbSwgc3BlYy5zZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgfSkpLnRoZW4oZnVuY3Rpb24gKGVhKSB7XG4gICAgICAgICAgICAgICAgICBpbml0aWFsVmFsdWUuZ2V0KCkuZWFjaChmdW5jdGlvbiAoY3ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVhLnNldFZhbHVlKGN2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGluaXRpYWxWYWx1ZS5zZXQoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgICAgICAgICAgIGVkaXRvckFwaS5zZXQoT3B0aW9uYWwuc29tZShlYSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWRpdG9yQXBpLmdldCgpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxWYWx1ZS5nZXQoKS5nZXRPcignJyk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVkKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWQuZ2V0VmFsdWUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIChjb21wb25lbnQsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yQXBpLmdldCgpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlLnNldChPcHRpb25hbC5zb21lKHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVkKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWQuc2V0VmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgQ29tcG9zaW5nQ29uZmlncy5zZWxmKClcbiAgICAgICAgXSksXG4gICAgICAgIGNvbXBvbmVudHM6IFttZW1SZXBsYWNlZC5hc1NwZWMoKV1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkYyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVG9vbHMnKTtcblxuICAgIHZhciBwcm9jZXNzb3JzID0gb2JqT2YoW1xuICAgICAgZGVmYXVsdGVkJDEoJ3ByZXByb2Nlc3MnLCBpZGVudGl0eSksXG4gICAgICBkZWZhdWx0ZWQkMSgncG9zdHByb2Nlc3MnLCBpZGVudGl0eSlcbiAgICBdKTtcbiAgICB2YXIgbWVtZW50byQxID0gZnVuY3Rpb24gKG1lbSwgcmF3UHJvY2Vzc29ycykge1xuICAgICAgdmFyIHBzID0gYXNSYXdPckRpZSgnUmVwcmVzZW50aW5nQ29uZmlncy5tZW1lbnRvIHByb2Nlc3NvcnMnLCBwcm9jZXNzb3JzLCByYXdQcm9jZXNzb3JzKTtcbiAgICAgIHJldHVybiBSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHZhciBvdGhlciA9IG1lbS5nZXQoY29tcCk7XG4gICAgICAgICAgICB2YXIgcmF3VmFsdWUgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUob3RoZXIpO1xuICAgICAgICAgICAgcmV0dXJuIHBzLnBvc3Rwcm9jZXNzKHJhd1ZhbHVlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoY29tcCwgcmF3VmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IHBzLnByZXByb2Nlc3MocmF3VmFsdWUpO1xuICAgICAgICAgICAgdmFyIG90aGVyID0gbWVtLmdldChjb21wKTtcbiAgICAgICAgICAgIFJlcHJlc2VudGluZy5zZXRWYWx1ZShvdGhlciwgbmV3VmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgd2l0aENvbXAgPSBmdW5jdGlvbiAob3B0SW5pdGlhbFZhbHVlLCBnZXR0ZXIsIHNldHRlcikge1xuICAgICAgcmV0dXJuIFJlcHJlc2VudGluZy5jb25maWcoZGVlcE1lcmdlKHtcbiAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICBnZXRWYWx1ZTogZ2V0dGVyLFxuICAgICAgICAgIHNldFZhbHVlOiBzZXR0ZXJcbiAgICAgICAgfVxuICAgICAgfSwgb3B0SW5pdGlhbFZhbHVlLm1hcChmdW5jdGlvbiAoaW5pdGlhbFZhbHVlKSB7XG4gICAgICAgIHJldHVybiB7IHN0b3JlOiB7IGluaXRpYWxWYWx1ZTogaW5pdGlhbFZhbHVlIH0gfTtcbiAgICAgIH0pLmdldE9yKHt9KSkpO1xuICAgIH07XG4gICAgdmFyIHdpdGhFbGVtZW50ID0gZnVuY3Rpb24gKGluaXRpYWxWYWx1ZSwgZ2V0dGVyLCBzZXR0ZXIpIHtcbiAgICAgIHJldHVybiB3aXRoQ29tcChpbml0aWFsVmFsdWUsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHJldHVybiBnZXR0ZXIoYy5lbGVtZW50KTtcbiAgICAgIH0sIGZ1bmN0aW9uIChjLCB2KSB7XG4gICAgICAgIHJldHVybiBzZXR0ZXIoYy5lbGVtZW50LCB2KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRvbVZhbHVlID0gZnVuY3Rpb24gKG9wdEluaXRpYWxWYWx1ZSkge1xuICAgICAgcmV0dXJuIHdpdGhFbGVtZW50KG9wdEluaXRpYWxWYWx1ZSwgZ2V0JDYsIHNldCQzKTtcbiAgICB9O1xuICAgIHZhciBkb21IdG1sID0gZnVuY3Rpb24gKG9wdEluaXRpYWxWYWx1ZSkge1xuICAgICAgcmV0dXJuIHdpdGhFbGVtZW50KG9wdEluaXRpYWxWYWx1ZSwgZ2V0JDIsIHNldCk7XG4gICAgfTtcbiAgICB2YXIgbWVtb3J5JDEgPSBmdW5jdGlvbiAoaW5pdGlhbFZhbHVlKSB7XG4gICAgICByZXR1cm4gUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgIHN0b3JlOiB7XG4gICAgICAgICAgbW9kZTogJ21lbW9yeScsXG4gICAgICAgICAgaW5pdGlhbFZhbHVlOiBpbml0aWFsVmFsdWVcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgUmVwcmVzZW50aW5nQ29uZmlncyA9IHtcbiAgICAgIG1lbWVudG86IG1lbWVudG8kMSxcbiAgICAgIHdpdGhFbGVtZW50OiB3aXRoRWxlbWVudCxcbiAgICAgIHdpdGhDb21wOiB3aXRoQ29tcCxcbiAgICAgIGRvbVZhbHVlOiBkb21WYWx1ZSxcbiAgICAgIGRvbUh0bWw6IGRvbUh0bWwsXG4gICAgICBtZW1vcnk6IG1lbW9yeSQxXG4gICAgfTtcblxuICAgIHZhciBkZWZhdWx0SW1hZ2VGaWxlVHlwZXMgPSAnanBlZyxqcGcsanBlLGpmaSxqaWYsamZpZixwbmcsZ2lmLGJtcCx3ZWJwJztcbiAgICB2YXIgZmlsdGVyQnlFeHRlbnNpb24gPSBmdW5jdGlvbiAoZmlsZXMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgdmFyIGFsbG93ZWRJbWFnZUZpbGVUeXBlcyA9IGdsb2JhbCRjLmV4cGxvZGUocHJvdmlkZXJzQmFja3N0YWdlLmdldFNldHRpbmcoJ2ltYWdlc19maWxlX3R5cGVzJywgZGVmYXVsdEltYWdlRmlsZVR5cGVzLCAnc3RyaW5nJykpO1xuICAgICAgdmFyIGlzRmlsZUluQWxsb3dlZFR5cGVzID0gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0cyhhbGxvd2VkSW1hZ2VGaWxlVHlwZXMsIGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgcmV0dXJuIGVuZHNXaXRoKGZpbGUubmFtZS50b0xvd2VyQ2FzZSgpLCAnLicgKyB0eXBlLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZmlsdGVyKGZyb20kMShmaWxlcyksIGlzRmlsZUluQWxsb3dlZFR5cGVzKTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJEcm9wWm9uZSA9IGZ1bmN0aW9uIChzcGVjLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBzdG9wcGVyID0gZnVuY3Rpb24gKF8sIHNlKSB7XG4gICAgICAgIHNlLnN0b3AoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2VxdWVuY2UgPSBmdW5jdGlvbiAoYWN0aW9ucykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbXAsIHNlKSB7XG4gICAgICAgICAgZWFjaChhY3Rpb25zLCBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgYShjb21wLCBzZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIG9uRHJvcCA9IGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICBpZiAoIURpc2FibGluZy5pc0Rpc2FibGVkKGNvbXApKSB7XG4gICAgICAgICAgdmFyIHRyYW5zZmVyRXZlbnQgPSBzZS5ldmVudC5yYXc7XG4gICAgICAgICAgaGFuZGxlRmlsZXMoY29tcCwgdHJhbnNmZXJFdmVudC5kYXRhVHJhbnNmZXIuZmlsZXMpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIG9uU2VsZWN0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gc2ltdWxhdGVkRXZlbnQuZXZlbnQucmF3LnRhcmdldDtcbiAgICAgICAgaGFuZGxlRmlsZXMoY29tcG9uZW50LCBpbnB1dC5maWxlcyk7XG4gICAgICB9O1xuICAgICAgdmFyIGhhbmRsZUZpbGVzID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZmlsZXMpIHtcbiAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGNvbXBvbmVudCwgZmlsdGVyQnlFeHRlbnNpb24oZmlsZXMsIHByb3ZpZGVyc0JhY2tzdGFnZSkpO1xuICAgICAgICBlbWl0V2l0aChjb21wb25lbnQsIGZvcm1DaGFuZ2VFdmVudCwgeyBuYW1lOiBzcGVjLm5hbWUgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1lbUlucHV0ID0gcmVjb3JkKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnaW5wdXQnLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcbiAgICAgICAgICAgIGFjY2VwdDogJ2ltYWdlLyonXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdHlsZXM6IHsgZGlzcGxheTogJ25vbmUnIH1cbiAgICAgICAgfSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW2NvbmZpZygnaW5wdXQtZmlsZS1ldmVudHMnLCBbXG4gICAgICAgICAgICBjdXR0ZXIoY2xpY2soKSksXG4gICAgICAgICAgICBjdXR0ZXIodGFwKCkpXG4gICAgICAgICAgXSldKVxuICAgICAgfSk7XG4gICAgICB2YXIgcmVuZGVyRmllbGQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHVpZDogcy51aWQsXG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZHJvcHpvbmUtY29udGFpbmVyJ11cbiAgICAgICAgICB9LFxuICAgICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICAgIFJlcHJlc2VudGluZ0NvbmZpZ3MubWVtb3J5KFtdKSxcbiAgICAgICAgICAgIENvbXBvc2luZ0NvbmZpZ3Muc2VsZigpLFxuICAgICAgICAgICAgRGlzYWJsaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgICBUb2dnbGluZy5jb25maWcoe1xuICAgICAgICAgICAgICB0b2dnbGVDbGFzczogJ2RyYWdlbnRlcicsXG4gICAgICAgICAgICAgIHRvZ2dsZU9uRXhlY3V0ZTogZmFsc2VcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY29uZmlnKCdkcm9wem9uZS1ldmVudHMnLCBbXG4gICAgICAgICAgICAgIHJ1bignZHJhZ2VudGVyJywgc2VxdWVuY2UoW1xuICAgICAgICAgICAgICAgIHN0b3BwZXIsXG4gICAgICAgICAgICAgICAgVG9nZ2xpbmcudG9nZ2xlXG4gICAgICAgICAgICAgIF0pKSxcbiAgICAgICAgICAgICAgcnVuKCdkcmFnbGVhdmUnLCBzZXF1ZW5jZShbXG4gICAgICAgICAgICAgICAgc3RvcHBlcixcbiAgICAgICAgICAgICAgICBUb2dnbGluZy50b2dnbGVcbiAgICAgICAgICAgICAgXSkpLFxuICAgICAgICAgICAgICBydW4oJ2RyYWdvdmVyJywgc3RvcHBlciksXG4gICAgICAgICAgICAgIHJ1bignZHJvcCcsIHNlcXVlbmNlKFtcbiAgICAgICAgICAgICAgICBzdG9wcGVyLFxuICAgICAgICAgICAgICAgIG9uRHJvcFxuICAgICAgICAgICAgICBdKSksXG4gICAgICAgICAgICAgIHJ1bihjaGFuZ2UoKSwgb25TZWxlY3QpXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZHJvcHpvbmUnXSxcbiAgICAgICAgICAgICAgICBzdHlsZXM6IHt9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgICAgICAgdGFnOiAncCcsXG4gICAgICAgICAgICAgICAgICAgIGlubmVySHRtbDogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZSgnRHJvcCBhbiBpbWFnZSBoZXJlJylcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIEJ1dHRvbi5za2V0Y2goe1xuICAgICAgICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgICAgICAgIHRhZzogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIGlubmVySHRtbDogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZSgnQnJvd3NlIGZvciBhbiBpbWFnZScpLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZXM6IHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgICAgICAgICAgICd0b3gtYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAndG94LWJ1dHRvbi0tc2Vjb25kYXJ5J1xuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgY29tcG9uZW50czogW21lbUlucHV0LmFzU3BlYygpXSxcbiAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlucHV0Q29tcCA9IG1lbUlucHV0LmdldChjb21wKTtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRDb21wLmVsZW1lbnQuZG9tLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgICAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgICAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLmJ1dHRvbihwcm92aWRlcnNCYWNrc3RhZ2UuaXNEaXNhYmxlZCksXG4gICAgICAgICAgICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpXG4gICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIHBMYWJlbCA9IHNwZWMubGFiZWwubWFwKGZ1bmN0aW9uIChsYWJlbCkge1xuICAgICAgICByZXR1cm4gcmVuZGVyTGFiZWwobGFiZWwsIHByb3ZpZGVyc0JhY2tzdGFnZSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBwRmllbGQgPSBGb3JtRmllbGQucGFydHMuZmllbGQoeyBmYWN0b3J5OiB7IHNrZXRjaDogcmVuZGVyRmllbGQgfSB9KTtcbiAgICAgIHJldHVybiByZW5kZXJGb3JtRmllbGRXaXRoKHBMYWJlbCwgcEZpZWxkLCBbJ3RveC1mb3JtX19ncm91cC0tc3RyZXRjaGVkJ10sIFtdKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlckdyaWQgPSBmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICd0b3gtZm9ybV9fZ3JpZCcsXG4gICAgICAgICAgICAndG94LWZvcm1fX2dyaWQtLScgKyBzcGVjLmNvbHVtbnMgKyAnY29sJ1xuICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogbWFwKHNwZWMuaXRlbXMsIGJhY2tzdGFnZS5pbnRlcnByZXRlcilcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBiZWZvcmVPYmplY3QgPSBnZW5lcmF0ZSQxKCdhbGxveS1mYWtlLWJlZm9yZS10YWJzdG9wJyk7XG4gICAgdmFyIGFmdGVyT2JqZWN0ID0gZ2VuZXJhdGUkMSgnYWxsb3ktZmFrZS1hZnRlci10YWJzdG9wJyk7XG4gICAgdmFyIGNyYWZ0V2l0aENsYXNzZXMgPSBmdW5jdGlvbiAoY2xhc3Nlcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBzdHlsZXM6IHtcbiAgICAgICAgICAgIHdpZHRoOiAnMXB4JyxcbiAgICAgICAgICAgIGhlaWdodDogJzFweCcsXG4gICAgICAgICAgICBvdXRsaW5lOiAnbm9uZSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgdGFiaW5kZXg6ICcwJyB9LFxuICAgICAgICAgIGNsYXNzZXM6IGNsYXNzZXNcbiAgICAgICAgfSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7IGlnbm9yZTogdHJ1ZSB9KSxcbiAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNyYWZ0ID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtbmF2b2JqJ11cbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgIGNyYWZ0V2l0aENsYXNzZXMoW2JlZm9yZU9iamVjdF0pLFxuICAgICAgICAgIHNwZWMsXG4gICAgICAgICAgY3JhZnRXaXRoQ2xhc3NlcyhbYWZ0ZXJPYmplY3RdKVxuICAgICAgICBdLFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbQ29tcG9zaW5nQ29uZmlncy5jaGlsZEF0KDEpXSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdHJpZ2dlclRhYiA9IGZ1bmN0aW9uIChwbGFjZWhvbGRlciwgc2hpZnRLZXkpIHtcbiAgICAgIGVtaXRXaXRoKHBsYWNlaG9sZGVyLCBrZXlkb3duKCksIHtcbiAgICAgICAgcmF3OiB7XG4gICAgICAgICAgd2hpY2g6IDksXG4gICAgICAgICAgc2hpZnRLZXk6IHNoaWZ0S2V5XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG9uRm9jdXMkMSA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldENvbXApIHtcbiAgICAgIHZhciB0YXJnZXQgPSB0YXJnZXRDb21wLmVsZW1lbnQ7XG4gICAgICBpZiAoaGFzJDIodGFyZ2V0LCBiZWZvcmVPYmplY3QpKSB7XG4gICAgICAgIHRyaWdnZXJUYWIoY29udGFpbmVyLCB0cnVlKTtcbiAgICAgIH0gZWxzZSBpZiAoaGFzJDIodGFyZ2V0LCBhZnRlck9iamVjdCkpIHtcbiAgICAgICAgdHJpZ2dlclRhYihjb250YWluZXIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpc1BzZXVkb1N0b3AgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGNsb3Nlc3QkNChlbGVtZW50LCBbXG4gICAgICAgICcuJyArIGJlZm9yZU9iamVjdCxcbiAgICAgICAgJy4nICsgYWZ0ZXJPYmplY3RcbiAgICAgIF0uam9pbignLCcpLCBuZXZlcik7XG4gICAgfTtcblxuICAgIHZhciBwbGF0Zm9ybU5lZWRzU2FuZGJveGluZyA9ICEoZGV0ZWN0JDMoKS5icm93c2VyLmlzSUUoKSB8fCBkZXRlY3QkMygpLmJyb3dzZXIuaXNFZGdlKCkpO1xuICAgIHZhciBnZXREeW5hbWljU291cmNlID0gZnVuY3Rpb24gKGlzU2FuZGJveCkge1xuICAgICAgdmFyIGNhY2hlZFZhbHVlID0gQ2VsbCgnJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKF9mcmFtZUNvbXBvbmVudCkge1xuICAgICAgICAgIHJldHVybiBjYWNoZWRWYWx1ZS5nZXQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIChmcmFtZUNvbXBvbmVudCwgaHRtbCkge1xuICAgICAgICAgIGlmICghaXNTYW5kYm94KSB7XG4gICAgICAgICAgICBzZXQkMShmcmFtZUNvbXBvbmVudC5lbGVtZW50LCAnc3JjJywgJ2phdmFzY3JpcHQ6XFwnXFwnJyk7XG4gICAgICAgICAgICB2YXIgZG9jID0gZnJhbWVDb21wb25lbnQuZWxlbWVudC5kb20uY29udGVudFdpbmRvdy5kb2N1bWVudDtcbiAgICAgICAgICAgIGRvYy5vcGVuKCk7XG4gICAgICAgICAgICBkb2Mud3JpdGUoaHRtbCk7XG4gICAgICAgICAgICBkb2MuY2xvc2UoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0JDEoZnJhbWVDb21wb25lbnQuZWxlbWVudCwgJ3NyY2RvYycsIGh0bWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYWNoZWRWYWx1ZS5zZXQoaHRtbCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVySUZyYW1lID0gZnVuY3Rpb24gKHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgdmFyIGlzU2FuZGJveCA9IHBsYXRmb3JtTmVlZHNTYW5kYm94aW5nICYmIHNwZWMuc2FuZGJveGVkO1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3BlYy5sYWJlbC5tYXAoZnVuY3Rpb24gKHRpdGxlKSB7XG4gICAgICAgIHJldHVybiB7IHRpdGxlOiB0aXRsZSB9O1xuICAgICAgfSkuZ2V0T3Ioe30pKSwgaXNTYW5kYm94ID8geyBzYW5kYm94OiAnYWxsb3ctc2NyaXB0cyBhbGxvdy1zYW1lLW9yaWdpbicgfSA6IHt9KTtcbiAgICAgIHZhciBzb3VyY2luZyA9IGdldER5bmFtaWNTb3VyY2UoaXNTYW5kYm94KTtcbiAgICAgIHZhciBwTGFiZWwgPSBzcGVjLmxhYmVsLm1hcChmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckxhYmVsKGxhYmVsLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgfSk7XG4gICAgICB2YXIgZmFjdG9yeSA9IGZ1bmN0aW9uIChuZXdTcGVjKSB7XG4gICAgICAgIHJldHVybiBjcmFmdCh7XG4gICAgICAgICAgdWlkOiBuZXdTcGVjLnVpZCxcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2lmcmFtZScsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGVzXG4gICAgICAgICAgfSxcbiAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICAgIFJlcHJlc2VudGluZ0NvbmZpZ3Mud2l0aENvbXAoT3B0aW9uYWwubm9uZSgpLCBzb3VyY2luZy5nZXRWYWx1ZSwgc291cmNpbmcuc2V0VmFsdWUpXG4gICAgICAgICAgXSlcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHBGaWVsZCA9IEZvcm1GaWVsZC5wYXJ0cy5maWVsZCh7IGZhY3Rvcnk6IHsgc2tldGNoOiBmYWN0b3J5IH0gfSk7XG4gICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkV2l0aChwTGFiZWwsIHBGaWVsZCwgWyd0b3gtZm9ybV9fZ3JvdXAtLXN0cmV0Y2hlZCddLCBbXSk7XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGUkNSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICByZXR1cm4gcmVzaXplKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9O1xuICAgIHZhciBjbG9uZSQxID0gZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgdmFyIHRDYW52YXMgPSBjcmVhdGUkNShjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgdmFyIGN0eCA9IGdldDJkQ29udGV4dCh0Q2FudmFzKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UoY2FudmFzLCAwLCAwKTtcbiAgICAgIHJldHVybiB0Q2FudmFzO1xuICAgIH07XG4gICAgdmFyIGdldDJkQ29udGV4dCA9IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgIHJldHVybiBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICB9O1xuICAgIHZhciByZXNpemUgPSBmdW5jdGlvbiAoY2FudmFzLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICByZXR1cm4gY2FudmFzO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0V2lkdGggPSBmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgIHJldHVybiBpbWFnZS5uYXR1cmFsV2lkdGggfHwgaW1hZ2Uud2lkdGg7XG4gICAgfTtcbiAgICB2YXIgZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICByZXR1cm4gaW1hZ2UubmF0dXJhbEhlaWdodCB8fCBpbWFnZS5oZWlnaHQ7XG4gICAgfTtcblxuICAgIHZhciBwcm9taXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIFByb21pc2UgPSBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Byb21pc2VzIG11c3QgYmUgY29uc3RydWN0ZWQgdmlhIG5ldycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdub3QgYSBmdW5jdGlvbicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXRlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSBudWxsO1xuICAgICAgICB0aGlzLl9kZWZlcnJlZHMgPSBbXTtcbiAgICAgICAgZG9SZXNvbHZlKGZuLCBiaW5kKHJlc29sdmUsIHRoaXMpLCBiaW5kKHJlamVjdCwgdGhpcykpO1xuICAgICAgfTtcbiAgICAgIHZhciBhbnlXaW5kb3cgPSB3aW5kb3c7XG4gICAgICB2YXIgYXNhcCA9IFByb21pc2UuaW1tZWRpYXRlRm4gfHwgdHlwZW9mIGFueVdpbmRvdy5zZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicgJiYgYW55V2luZG93LnNldEltbWVkaWF0ZSB8fCBmdW5jdGlvbiAoZm4pIHtcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZm4sIDEpO1xuICAgICAgfTtcbiAgICAgIHZhciBiaW5kID0gZnVuY3Rpb24gKGZuLCB0aGlzQXJnKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpc0FyZywgYXJncyk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICAgIH07XG4gICAgICBmdW5jdGlvbiBoYW5kbGUoZGVmZXJyZWQpIHtcbiAgICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlID09PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5fZGVmZXJyZWRzLnB1c2goZGVmZXJyZWQpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhc2FwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgY2IgPSBtZS5fc3RhdGUgPyBkZWZlcnJlZC5vbkZ1bGZpbGxlZCA6IGRlZmVycmVkLm9uUmVqZWN0ZWQ7XG4gICAgICAgICAgaWYgKGNiID09PSBudWxsKSB7XG4gICAgICAgICAgICAobWUuX3N0YXRlID8gZGVmZXJyZWQucmVzb2x2ZSA6IGRlZmVycmVkLnJlamVjdCkobWUuX3ZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJldDtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0ID0gY2IobWUuX3ZhbHVlKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmV0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiByZXNvbHZlKG5ld1ZhbHVlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSB0aGlzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBIHByb21pc2UgY2Fubm90IGJlIHJlc29sdmVkIHdpdGggaXRzZWxmLicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobmV3VmFsdWUgJiYgKHR5cGVvZiBuZXdWYWx1ZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG5ld1ZhbHVlID09PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgdmFyIHRoZW4gPSBuZXdWYWx1ZS50aGVuO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgIGRvUmVzb2x2ZShiaW5kKHRoZW4sIG5ld1ZhbHVlKSwgYmluZChyZXNvbHZlLCB0aGlzKSwgYmluZChyZWplY3QsIHRoaXMpKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9zdGF0ZSA9IHRydWU7XG4gICAgICAgICAgdGhpcy5fdmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICBmaW5hbGUuY2FsbCh0aGlzKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJlamVjdC5jYWxsKHRoaXMsIGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiByZWplY3QobmV3VmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgZmluYWxlLmNhbGwodGhpcyk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBmaW5hbGUoKSB7XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl9kZWZlcnJlZHM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgdmFyIGRlZmVycmVkID0gX2FbX2ldO1xuICAgICAgICAgIGhhbmRsZS5jYWxsKHRoaXMsIGRlZmVycmVkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kZWZlcnJlZHMgPSBbXTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIEhhbmRsZXIob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0aGlzLm9uRnVsZmlsbGVkID0gdHlwZW9mIG9uRnVsZmlsbGVkID09PSAnZnVuY3Rpb24nID8gb25GdWxmaWxsZWQgOiBudWxsO1xuICAgICAgICB0aGlzLm9uUmVqZWN0ZWQgPSB0eXBlb2Ygb25SZWplY3RlZCA9PT0gJ2Z1bmN0aW9uJyA/IG9uUmVqZWN0ZWQgOiBudWxsO1xuICAgICAgICB0aGlzLnJlc29sdmUgPSByZXNvbHZlO1xuICAgICAgICB0aGlzLnJlamVjdCA9IHJlamVjdDtcbiAgICAgIH1cbiAgICAgIHZhciBkb1Jlc29sdmUgPSBmdW5jdGlvbiAoZm4sIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7XG4gICAgICAgIHZhciBkb25lID0gZmFsc2U7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZm4oZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XG4gICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIG9uUmVqZWN0ZWQocmVhc29uKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICBvblJlamVjdGVkKGV4KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIFByb21pc2UucHJvdG90eXBlLmNhdGNoID0gZnVuY3Rpb24gKG9uUmVqZWN0ZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGhlbihudWxsLCBvblJlamVjdGVkKTtcbiAgICAgIH07XG4gICAgICBQcm9taXNlLnByb3RvdHlwZS50aGVuID0gZnVuY3Rpb24gKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7XG4gICAgICAgIHZhciBtZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgaGFuZGxlLmNhbGwobWUsIG5ldyBIYW5kbGVyKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkLCByZXNvbHZlLCByZWplY3QpKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgUHJvbWlzZS5hbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2YWx1ZXMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICB2YWx1ZXNbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHZhbHVlcy5sZW5ndGggPT09IDEgJiYgaXNBcnJheSh2YWx1ZXNbMF0pID8gdmFsdWVzWzBdIDogdmFsdWVzKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKFtdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJlbWFpbmluZyA9IGFyZ3MubGVuZ3RoO1xuICAgICAgICAgIHZhciByZXMgPSBmdW5jdGlvbiAoaSwgdmFsKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBpZiAodmFsICYmICh0eXBlb2YgdmFsID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgIHZhciB0aGVuID0gdmFsLnRoZW47XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICB0aGVuLmNhbGwodmFsLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyhpLCB2YWwpO1xuICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYXJnc1tpXSA9IHZhbDtcbiAgICAgICAgICAgICAgaWYgKC0tcmVtYWluaW5nID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhcmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcmVzKGksIGFyZ3NbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgUHJvbWlzZS5yZXNvbHZlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBQcm9taXNlKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBQcm9taXNlLnJlamVjdCA9IGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICByZWplY3QocmVhc29uKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgUHJvbWlzZS5yYWNlID0gZnVuY3Rpb24gKHZhbHVlcykge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgdmFsdWVzXzEgPSB2YWx1ZXM7IF9pIDwgdmFsdWVzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB2YWx1ZXNfMVtfaV07XG4gICAgICAgICAgICB2YWx1ZS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gUHJvbWlzZTtcbiAgICB9O1xuICAgIHZhciBQcm9taXNlJDEgPSB3aW5kb3cuUHJvbWlzZSA/IHdpbmRvdy5Qcm9taXNlIDogcHJvbWlzZSgpO1xuXG4gICAgdmFyIGJsb2JUb0ltYWdlID0gZnVuY3Rpb24gKGJsb2IpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSQxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgdmFyIHJlbW92ZUxpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgbG9hZGVkKTtcbiAgICAgICAgICBpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGxvYWRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZW1vdmVMaXN0ZW5lcnMoKTtcbiAgICAgICAgICByZXNvbHZlKGltYWdlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJlbW92ZUxpc3RlbmVycygpO1xuICAgICAgICAgIHJlamVjdCgnVW5hYmxlIHRvIGxvYWQgZGF0YSBvZiB0eXBlICcgKyBibG9iLnR5cGUgKyAnOiAnICsgYmxvYlVybCk7XG4gICAgICAgIH07XG4gICAgICAgIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBsb2FkZWQpO1xuICAgICAgICBpbWFnZS5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gYmxvYlVybDtcbiAgICAgICAgaWYgKGltYWdlLmNvbXBsZXRlKSB7XG4gICAgICAgICAgc2V0VGltZW91dChsb2FkZWQsIDApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkYXRhVXJpVG9CbG9iU3luYyA9IGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgIHZhciBkYXRhID0gdXJpLnNwbGl0KCcsJyk7XG4gICAgICB2YXIgbWF0Y2hlcyA9IC9kYXRhOihbXjtdKykvLmV4ZWMoZGF0YVswXSk7XG4gICAgICBpZiAoIW1hdGNoZXMpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHZhciBtaW1ldHlwZSA9IG1hdGNoZXNbMV07XG4gICAgICB2YXIgYmFzZTY0ID0gZGF0YVsxXTtcbiAgICAgIHZhciBzbGljZVNpemUgPSAxMDI0O1xuICAgICAgdmFyIGJ5dGVDaGFyYWN0ZXJzID0gYXRvYihiYXNlNjQpO1xuICAgICAgdmFyIGJ5dGVzTGVuZ3RoID0gYnl0ZUNoYXJhY3RlcnMubGVuZ3RoO1xuICAgICAgdmFyIHNsaWNlc0NvdW50ID0gTWF0aC5jZWlsKGJ5dGVzTGVuZ3RoIC8gc2xpY2VTaXplKTtcbiAgICAgIHZhciBieXRlQXJyYXlzID0gbmV3IEFycmF5KHNsaWNlc0NvdW50KTtcbiAgICAgIGZvciAodmFyIHNsaWNlSW5kZXggPSAwOyBzbGljZUluZGV4IDwgc2xpY2VzQ291bnQ7ICsrc2xpY2VJbmRleCkge1xuICAgICAgICB2YXIgYmVnaW4gPSBzbGljZUluZGV4ICogc2xpY2VTaXplO1xuICAgICAgICB2YXIgZW5kID0gTWF0aC5taW4oYmVnaW4gKyBzbGljZVNpemUsIGJ5dGVzTGVuZ3RoKTtcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IEFycmF5KGVuZCAtIGJlZ2luKTtcbiAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gYmVnaW4sIGkgPSAwOyBvZmZzZXQgPCBlbmQ7ICsraSwgKytvZmZzZXQpIHtcbiAgICAgICAgICBieXRlc1tpXSA9IGJ5dGVDaGFyYWN0ZXJzW29mZnNldF0uY2hhckNvZGVBdCgwKTtcbiAgICAgICAgfVxuICAgICAgICBieXRlQXJyYXlzW3NsaWNlSW5kZXhdID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUobmV3IEJsb2IoYnl0ZUFycmF5cywgeyB0eXBlOiBtaW1ldHlwZSB9KSk7XG4gICAgfTtcbiAgICB2YXIgZGF0YVVyaVRvQmxvYiA9IGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSQxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZGF0YVVyaVRvQmxvYlN5bmModXJpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZWplY3QoJ3VyaSBpcyBub3QgYmFzZTY0OiAnICsgdXJpKTtcbiAgICAgICAgfSwgcmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjYW52YXNUb0Jsb2IgPSBmdW5jdGlvbiAoY2FudmFzLCB0eXBlLCBxdWFsaXR5KSB7XG4gICAgICB0eXBlID0gdHlwZSB8fCAnaW1hZ2UvcG5nJztcbiAgICAgIGlmIChpc0Z1bmN0aW9uKEhUTUxDYW52YXNFbGVtZW50LnByb3RvdHlwZS50b0Jsb2IpKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSQxKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBjYW52YXMudG9CbG9iKGZ1bmN0aW9uIChibG9iKSB7XG4gICAgICAgICAgICBpZiAoYmxvYikge1xuICAgICAgICAgICAgICByZXNvbHZlKGJsb2IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgdHlwZSwgcXVhbGl0eSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGFVcmlUb0Jsb2IoY2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgY2FudmFzVG9EYXRhVVJMID0gZnVuY3Rpb24gKGNhbnZhcywgdHlwZSwgcXVhbGl0eSkge1xuICAgICAgdHlwZSA9IHR5cGUgfHwgJ2ltYWdlL3BuZyc7XG4gICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5KTtcbiAgICB9O1xuICAgIHZhciBibG9iVG9DYW52YXMgPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgcmV0dXJuIGJsb2JUb0ltYWdlKGJsb2IpLnRoZW4oZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICAgIHJldm9rZUltYWdlVXJsKGltYWdlKTtcbiAgICAgICAgdmFyIGNhbnZhcyA9IGNyZWF0ZSQ1KGdldFdpZHRoKGltYWdlKSwgZ2V0SGVpZ2h0KGltYWdlKSk7XG4gICAgICAgIHZhciBjb250ZXh0ID0gZ2V0MmRDb250ZXh0KGNhbnZhcyk7XG4gICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTtcbiAgICAgICAgcmV0dXJuIGNhbnZhcztcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGJsb2JUb0RhdGFVcmkgPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlJDEoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmVzb2x2ZShyZWFkZXIucmVzdWx0KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZXZva2VJbWFnZVVybCA9IGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChpbWFnZS5zcmMpO1xuICAgIH07XG5cbiAgICB2YXIgY3JlYXRlJDYgPSBmdW5jdGlvbiAoZ2V0Q2FudmFzLCBibG9iLCB1cmkpIHtcbiAgICAgIHZhciBpbml0aWFsVHlwZSA9IGJsb2IudHlwZTtcbiAgICAgIHZhciBnZXRUeXBlID0gY29uc3RhbnQoaW5pdGlhbFR5cGUpO1xuICAgICAgdmFyIHRvQmxvYiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UkMS5yZXNvbHZlKGJsb2IpO1xuICAgICAgfTtcbiAgICAgIHZhciB0b0RhdGFVUkwgPSBjb25zdGFudCh1cmkpO1xuICAgICAgdmFyIHRvQmFzZTY0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdXJpLnNwbGl0KCcsJylbMV07XG4gICAgICB9O1xuICAgICAgdmFyIHRvQWRqdXN0ZWRCbG9iID0gZnVuY3Rpb24gKHR5cGUsIHF1YWxpdHkpIHtcbiAgICAgICAgcmV0dXJuIGdldENhbnZhcy50aGVuKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgICByZXR1cm4gY2FudmFzVG9CbG9iKGNhbnZhcywgdHlwZSwgcXVhbGl0eSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b0FkanVzdGVkRGF0YVVSTCA9IGZ1bmN0aW9uICh0eXBlLCBxdWFsaXR5KSB7XG4gICAgICAgIHJldHVybiBnZXRDYW52YXMudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbnZhc1RvRGF0YVVSTChjYW52YXMsIHR5cGUsIHF1YWxpdHkpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdG9BZGp1c3RlZEJhc2U2NCA9IGZ1bmN0aW9uICh0eXBlLCBxdWFsaXR5KSB7XG4gICAgICAgIHJldHVybiB0b0FkanVzdGVkRGF0YVVSTCh0eXBlLCBxdWFsaXR5KS50aGVuKGZ1bmN0aW9uIChkYXRhdXJsKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGF1cmwuc3BsaXQoJywnKVsxXTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHRvQ2FudmFzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0Q2FudmFzLnRoZW4oY2xvbmUkMSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0VHlwZTogZ2V0VHlwZSxcbiAgICAgICAgdG9CbG9iOiB0b0Jsb2IsXG4gICAgICAgIHRvRGF0YVVSTDogdG9EYXRhVVJMLFxuICAgICAgICB0b0Jhc2U2NDogdG9CYXNlNjQsXG4gICAgICAgIHRvQWRqdXN0ZWRCbG9iOiB0b0FkanVzdGVkQmxvYixcbiAgICAgICAgdG9BZGp1c3RlZERhdGFVUkw6IHRvQWRqdXN0ZWREYXRhVVJMLFxuICAgICAgICB0b0FkanVzdGVkQmFzZTY0OiB0b0FkanVzdGVkQmFzZTY0LFxuICAgICAgICB0b0NhbnZhczogdG9DYW52YXNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZnJvbUJsb2IgPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgcmV0dXJuIGJsb2JUb0RhdGFVcmkoYmxvYikudGhlbihmdW5jdGlvbiAodXJpKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGUkNihibG9iVG9DYW52YXMoYmxvYiksIGJsb2IsIHVyaSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmcm9tQ2FudmFzID0gZnVuY3Rpb24gKGNhbnZhcywgdHlwZSkge1xuICAgICAgcmV0dXJuIGNhbnZhc1RvQmxvYihjYW52YXMsIHR5cGUpLnRoZW4oZnVuY3Rpb24gKGJsb2IpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZSQ2KFByb21pc2UkMS5yZXNvbHZlKGNhbnZhcyksIGJsb2IsIGNhbnZhcy50b0RhdGFVUkwoKSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGJsb2JUb0ltYWdlUmVzdWx0ID0gZnVuY3Rpb24gKGJsb2IpIHtcbiAgICAgIHJldHVybiBmcm9tQmxvYihibG9iKTtcbiAgICB9O1xuXG4gICAgdmFyIGNsYW1wJDEgPSBmdW5jdGlvbiAodmFsdWUsIG1pbiwgbWF4KSB7XG4gICAgICB2YXIgcGFyc2VkVmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gcGFyc2VGbG9hdCh2YWx1ZSkgOiB2YWx1ZTtcbiAgICAgIGlmIChwYXJzZWRWYWx1ZSA+IG1heCkge1xuICAgICAgICBwYXJzZWRWYWx1ZSA9IG1heDtcbiAgICAgIH0gZWxzZSBpZiAocGFyc2VkVmFsdWUgPCBtaW4pIHtcbiAgICAgICAgcGFyc2VkVmFsdWUgPSBtaW47XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFyc2VkVmFsdWU7XG4gICAgfTtcbiAgICB2YXIgaWRlbnRpdHkkMSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDFcbiAgICAgIF07XG4gICAgfTtcbiAgICB2YXIgREVMVEFfSU5ERVggPSBbXG4gICAgICAwLFxuICAgICAgMC4wMSxcbiAgICAgIDAuMDIsXG4gICAgICAwLjA0LFxuICAgICAgMC4wNSxcbiAgICAgIDAuMDYsXG4gICAgICAwLjA3LFxuICAgICAgMC4wOCxcbiAgICAgIDAuMSxcbiAgICAgIDAuMTEsXG4gICAgICAwLjEyLFxuICAgICAgMC4xNCxcbiAgICAgIDAuMTUsXG4gICAgICAwLjE2LFxuICAgICAgMC4xNyxcbiAgICAgIDAuMTgsXG4gICAgICAwLjIsXG4gICAgICAwLjIxLFxuICAgICAgMC4yMixcbiAgICAgIDAuMjQsXG4gICAgICAwLjI1LFxuICAgICAgMC4yNyxcbiAgICAgIDAuMjgsXG4gICAgICAwLjMsXG4gICAgICAwLjMyLFxuICAgICAgMC4zNCxcbiAgICAgIDAuMzYsXG4gICAgICAwLjM4LFxuICAgICAgMC40LFxuICAgICAgMC40MixcbiAgICAgIDAuNDQsXG4gICAgICAwLjQ2LFxuICAgICAgMC40OCxcbiAgICAgIDAuNSxcbiAgICAgIDAuNTMsXG4gICAgICAwLjU2LFxuICAgICAgMC41OSxcbiAgICAgIDAuNjIsXG4gICAgICAwLjY1LFxuICAgICAgMC42OCxcbiAgICAgIDAuNzEsXG4gICAgICAwLjc0LFxuICAgICAgMC43NyxcbiAgICAgIDAuOCxcbiAgICAgIDAuODMsXG4gICAgICAwLjg2LFxuICAgICAgMC44OSxcbiAgICAgIDAuOTIsXG4gICAgICAwLjk1LFxuICAgICAgMC45OCxcbiAgICAgIDEsXG4gICAgICAxLjA2LFxuICAgICAgMS4xMixcbiAgICAgIDEuMTgsXG4gICAgICAxLjI0LFxuICAgICAgMS4zLFxuICAgICAgMS4zNixcbiAgICAgIDEuNDIsXG4gICAgICAxLjQ4LFxuICAgICAgMS41NCxcbiAgICAgIDEuNixcbiAgICAgIDEuNjYsXG4gICAgICAxLjcyLFxuICAgICAgMS43OCxcbiAgICAgIDEuODQsXG4gICAgICAxLjksXG4gICAgICAxLjk2LFxuICAgICAgMixcbiAgICAgIDIuMTIsXG4gICAgICAyLjI1LFxuICAgICAgMi4zNyxcbiAgICAgIDIuNSxcbiAgICAgIDIuNjIsXG4gICAgICAyLjc1LFxuICAgICAgMi44NyxcbiAgICAgIDMsXG4gICAgICAzLjIsXG4gICAgICAzLjQsXG4gICAgICAzLjYsXG4gICAgICAzLjgsXG4gICAgICA0LFxuICAgICAgNC4zLFxuICAgICAgNC43LFxuICAgICAgNC45LFxuICAgICAgNSxcbiAgICAgIDUuNSxcbiAgICAgIDYsXG4gICAgICA2LjUsXG4gICAgICA2LjgsXG4gICAgICA3LFxuICAgICAgNy4zLFxuICAgICAgNy41LFxuICAgICAgNy44LFxuICAgICAgOCxcbiAgICAgIDguNCxcbiAgICAgIDguNyxcbiAgICAgIDksXG4gICAgICA5LjQsXG4gICAgICA5LjYsXG4gICAgICA5LjgsXG4gICAgICAxMFxuICAgIF07XG4gICAgdmFyIG11bHRpcGx5ID0gZnVuY3Rpb24gKG1hdHJpeDEsIG1hdHJpeDIpIHtcbiAgICAgIHZhciBjb2wgPSBbXTtcbiAgICAgIHZhciBvdXQgPSBuZXcgQXJyYXkoMjUpO1xuICAgICAgdmFyIHZhbDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNTsgaisrKSB7XG4gICAgICAgICAgY29sW2pdID0gbWF0cml4MltqICsgaSAqIDVdO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNTsgaisrKSB7XG4gICAgICAgICAgdmFsID0gMDtcbiAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IDU7IGsrKykge1xuICAgICAgICAgICAgdmFsICs9IG1hdHJpeDFbaiArIGsgKiA1XSAqIGNvbFtrXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3V0W2ogKyBpICogNV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfTtcbiAgICB2YXIgYWRqdXN0Q29udHJhc3QgPSBmdW5jdGlvbiAobWF0cml4LCB2YWx1ZSkge1xuICAgICAgdmFyIHg7XG4gICAgICB2YWx1ZSA9IGNsYW1wJDEodmFsdWUsIC0xLCAxKTtcbiAgICAgIHZhbHVlICo9IDEwMDtcbiAgICAgIGlmICh2YWx1ZSA8IDApIHtcbiAgICAgICAgeCA9IDEyNyArIHZhbHVlIC8gMTAwICogMTI3O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgeCA9IHZhbHVlICUgMTtcbiAgICAgICAgaWYgKHggPT09IDApIHtcbiAgICAgICAgICB4ID0gREVMVEFfSU5ERVhbdmFsdWVdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHggPSBERUxUQV9JTkRFWFtNYXRoLmZsb29yKHZhbHVlKV0gKiAoMSAtIHgpICsgREVMVEFfSU5ERVhbTWF0aC5mbG9vcih2YWx1ZSkgKyAxXSAqIHg7XG4gICAgICAgIH1cbiAgICAgICAgeCA9IHggKiAxMjcgKyAxMjc7XG4gICAgICB9XG4gICAgICByZXR1cm4gbXVsdGlwbHkobWF0cml4LCBbXG4gICAgICAgIHggLyAxMjcsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAuNSAqICgxMjcgLSB4KSxcbiAgICAgICAgMCxcbiAgICAgICAgeCAvIDEyNyxcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICAgICAgMC41ICogKDEyNyAtIHgpLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICB4IC8gMTI3LFxuICAgICAgICAwLFxuICAgICAgICAwLjUgKiAoMTI3IC0geCksXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDFcbiAgICAgIF0pO1xuICAgIH07XG4gICAgdmFyIGFkanVzdEJyaWdodG5lc3MgPSBmdW5jdGlvbiAobWF0cml4LCB2YWx1ZSkge1xuICAgICAgdmFsdWUgPSBjbGFtcCQxKDI1NSAqIHZhbHVlLCAtMjU1LCAyNTUpO1xuICAgICAgcmV0dXJuIG11bHRpcGx5KG1hdHJpeCwgW1xuICAgICAgICAxLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgMCxcbiAgICAgICAgMSxcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAxLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICAxXG4gICAgICBdKTtcbiAgICB9O1xuICAgIHZhciBhZGp1c3RDb2xvcnMgPSBmdW5jdGlvbiAobWF0cml4LCBhZGp1c3RSLCBhZGp1c3RHLCBhZGp1c3RCKSB7XG4gICAgICBhZGp1c3RSID0gY2xhbXAkMShhZGp1c3RSLCAwLCAyKTtcbiAgICAgIGFkanVzdEcgPSBjbGFtcCQxKGFkanVzdEcsIDAsIDIpO1xuICAgICAgYWRqdXN0QiA9IGNsYW1wJDEoYWRqdXN0QiwgMCwgMik7XG4gICAgICByZXR1cm4gbXVsdGlwbHkobWF0cml4LCBbXG4gICAgICAgIGFkanVzdFIsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIGFkanVzdEcsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIGFkanVzdEIsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDEsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDFcbiAgICAgIF0pO1xuICAgIH07XG5cbiAgICB2YXIgY29sb3JGaWx0ZXIgPSBmdW5jdGlvbiAoaXIsIG1hdHJpeCkge1xuICAgICAgcmV0dXJuIGlyLnRvQ2FudmFzKCkudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIHJldHVybiBhcHBseUNvbG9yRmlsdGVyKGNhbnZhcywgaXIuZ2V0VHlwZSgpLCBtYXRyaXgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXBwbHlDb2xvckZpbHRlciA9IGZ1bmN0aW9uIChjYW52YXMsIHR5cGUsIG1hdHJpeCkge1xuICAgICAgdmFyIGNvbnRleHQgPSBnZXQyZENvbnRleHQoY2FudmFzKTtcbiAgICAgIHZhciBhcHBseU1hdHJpeCA9IGZ1bmN0aW9uIChwaXhlbHNEYXRhLCBtKSB7XG4gICAgICAgIHZhciByLCBnLCBiLCBhO1xuICAgICAgICB2YXIgZGF0YSA9IHBpeGVsc0RhdGEuZGF0YSwgbTAgPSBtWzBdLCBtMSA9IG1bMV0sIG0yID0gbVsyXSwgbTMgPSBtWzNdLCBtNCA9IG1bNF0sIG01ID0gbVs1XSwgbTYgPSBtWzZdLCBtNyA9IG1bN10sIG04ID0gbVs4XSwgbTkgPSBtWzldLCBtMTAgPSBtWzEwXSwgbTExID0gbVsxMV0sIG0xMiA9IG1bMTJdLCBtMTMgPSBtWzEzXSwgbTE0ID0gbVsxNF0sIG0xNSA9IG1bMTVdLCBtMTYgPSBtWzE2XSwgbTE3ID0gbVsxN10sIG0xOCA9IG1bMThdLCBtMTkgPSBtWzE5XTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICAgICAgciA9IGRhdGFbaV07XG4gICAgICAgICAgZyA9IGRhdGFbaSArIDFdO1xuICAgICAgICAgIGIgPSBkYXRhW2kgKyAyXTtcbiAgICAgICAgICBhID0gZGF0YVtpICsgM107XG4gICAgICAgICAgZGF0YVtpXSA9IHIgKiBtMCArIGcgKiBtMSArIGIgKiBtMiArIGEgKiBtMyArIG00O1xuICAgICAgICAgIGRhdGFbaSArIDFdID0gciAqIG01ICsgZyAqIG02ICsgYiAqIG03ICsgYSAqIG04ICsgbTk7XG4gICAgICAgICAgZGF0YVtpICsgMl0gPSByICogbTEwICsgZyAqIG0xMSArIGIgKiBtMTIgKyBhICogbTEzICsgbTE0O1xuICAgICAgICAgIGRhdGFbaSArIDNdID0gciAqIG0xNSArIGcgKiBtMTYgKyBiICogbTE3ICsgYSAqIG0xOCArIG0xOTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGl4ZWxzRGF0YTtcbiAgICAgIH07XG4gICAgICB2YXIgcGl4ZWxzID0gYXBwbHlNYXRyaXgoY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KSwgbWF0cml4KTtcbiAgICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKHBpeGVscywgMCwgMCk7XG4gICAgICByZXR1cm4gZnJvbUNhbnZhcyhjYW52YXMsIHR5cGUpO1xuICAgIH07XG4gICAgdmFyIGNvbnZvbHV0ZUZpbHRlciA9IGZ1bmN0aW9uIChpciwgbWF0cml4KSB7XG4gICAgICByZXR1cm4gaXIudG9DYW52YXMoKS50aGVuKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgcmV0dXJuIGFwcGx5Q29udm9sdXRlRmlsdGVyKGNhbnZhcywgaXIuZ2V0VHlwZSgpLCBtYXRyaXgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXBwbHlDb252b2x1dGVGaWx0ZXIgPSBmdW5jdGlvbiAoY2FudmFzLCB0eXBlLCBtYXRyaXgpIHtcbiAgICAgIHZhciBjb250ZXh0ID0gZ2V0MmRDb250ZXh0KGNhbnZhcyk7XG4gICAgICB2YXIgYXBwbHlNYXRyaXggPSBmdW5jdGlvbiAocEluLCBwT3V0LCBhTWF0cml4KSB7XG4gICAgICAgIHZhciBjbGFtcCA9IGZ1bmN0aW9uICh2YWx1ZSwgbWluLCBtYXgpIHtcbiAgICAgICAgICBpZiAodmFsdWUgPiBtYXgpIHtcbiAgICAgICAgICAgIHZhbHVlID0gbWF4O1xuICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCBtaW4pIHtcbiAgICAgICAgICAgIHZhbHVlID0gbWluO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzaWRlID0gTWF0aC5yb3VuZChNYXRoLnNxcnQoYU1hdHJpeC5sZW5ndGgpKTtcbiAgICAgICAgdmFyIGhhbGZTaWRlID0gTWF0aC5mbG9vcihzaWRlIC8gMik7XG4gICAgICAgIHZhciByZ2JhID0gcEluLmRhdGE7XG4gICAgICAgIHZhciBkcmdiYSA9IHBPdXQuZGF0YTtcbiAgICAgICAgdmFyIHcgPSBwSW4ud2lkdGg7XG4gICAgICAgIHZhciBoID0gcEluLmhlaWdodDtcbiAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBoOyB5KyspIHtcbiAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHc7IHgrKykge1xuICAgICAgICAgICAgdmFyIHIgPSAwO1xuICAgICAgICAgICAgdmFyIGcgPSAwO1xuICAgICAgICAgICAgdmFyIGIgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgY3kgPSAwOyBjeSA8IHNpZGU7IGN5KyspIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgY3ggPSAwOyBjeCA8IHNpZGU7IGN4KyspIHtcbiAgICAgICAgICAgICAgICB2YXIgc2N4ID0gY2xhbXAoeCArIGN4IC0gaGFsZlNpZGUsIDAsIHcgLSAxKTtcbiAgICAgICAgICAgICAgICB2YXIgc2N5ID0gY2xhbXAoeSArIGN5IC0gaGFsZlNpZGUsIDAsIGggLSAxKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5uZXJPZmZzZXQgPSAoc2N5ICogdyArIHNjeCkgKiA0O1xuICAgICAgICAgICAgICAgIHZhciB3dCA9IGFNYXRyaXhbY3kgKiBzaWRlICsgY3hdO1xuICAgICAgICAgICAgICAgIHIgKz0gcmdiYVtpbm5lck9mZnNldF0gKiB3dDtcbiAgICAgICAgICAgICAgICBnICs9IHJnYmFbaW5uZXJPZmZzZXQgKyAxXSAqIHd0O1xuICAgICAgICAgICAgICAgIGIgKz0gcmdiYVtpbm5lck9mZnNldCArIDJdICogd3Q7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBvZmZzZXQgPSAoeSAqIHcgKyB4KSAqIDQ7XG4gICAgICAgICAgICBkcmdiYVtvZmZzZXRdID0gY2xhbXAociwgMCwgMjU1KTtcbiAgICAgICAgICAgIGRyZ2JhW29mZnNldCArIDFdID0gY2xhbXAoZywgMCwgMjU1KTtcbiAgICAgICAgICAgIGRyZ2JhW29mZnNldCArIDJdID0gY2xhbXAoYiwgMCwgMjU1KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBPdXQ7XG4gICAgICB9O1xuICAgICAgdmFyIHBpeGVsc0luID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgIHZhciBwaXhlbHNPdXQgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgcGl4ZWxzT3V0ID0gYXBwbHlNYXRyaXgocGl4ZWxzSW4sIHBpeGVsc091dCwgbWF0cml4KTtcbiAgICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKHBpeGVsc091dCwgMCwgMCk7XG4gICAgICByZXR1cm4gZnJvbUNhbnZhcyhjYW52YXMsIHR5cGUpO1xuICAgIH07XG4gICAgdmFyIGZ1bmN0aW9uQ29sb3JGaWx0ZXIgPSBmdW5jdGlvbiAoY29sb3JGbikge1xuICAgICAgdmFyIGZpbHRlckltcGwgPSBmdW5jdGlvbiAoY2FudmFzLCB0eXBlLCB2YWx1ZSkge1xuICAgICAgICB2YXIgY29udGV4dCA9IGdldDJkQ29udGV4dChjYW52YXMpO1xuICAgICAgICB2YXIgbG9va3VwID0gbmV3IEFycmF5KDI1Nik7XG4gICAgICAgIHZhciBhcHBseUxvb2t1cCA9IGZ1bmN0aW9uIChwaXhlbHNEYXRhLCBsb29rdXBEYXRhKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBwaXhlbHNEYXRhLmRhdGE7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICAgICAgICBkYXRhW2ldID0gbG9va3VwRGF0YVtkYXRhW2ldXTtcbiAgICAgICAgICAgIGRhdGFbaSArIDFdID0gbG9va3VwRGF0YVtkYXRhW2kgKyAxXV07XG4gICAgICAgICAgICBkYXRhW2kgKyAyXSA9IGxvb2t1cERhdGFbZGF0YVtpICsgMl1dO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcGl4ZWxzRGF0YTtcbiAgICAgICAgfTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb29rdXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBsb29rdXBbaV0gPSBjb2xvckZuKGksIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcGl4ZWxzID0gYXBwbHlMb29rdXAoY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KSwgbG9va3VwKTtcbiAgICAgICAgY29udGV4dC5wdXRJbWFnZURhdGEocGl4ZWxzLCAwLCAwKTtcbiAgICAgICAgcmV0dXJuIGZyb21DYW52YXMoY2FudmFzLCB0eXBlKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGlyLCB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gaXIudG9DYW52YXMoKS50aGVuKGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgICAgICByZXR1cm4gZmlsdGVySW1wbChjYW52YXMsIGlyLmdldFR5cGUoKSwgdmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29tcGxleEFkanVzdGFibGVDb2xvckZpbHRlciA9IGZ1bmN0aW9uIChtYXRyaXhBZGp1c3RGbikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpciwgYWRqdXN0KSB7XG4gICAgICAgIHJldHVybiBjb2xvckZpbHRlcihpciwgbWF0cml4QWRqdXN0Rm4oaWRlbnRpdHkkMSgpLCBhZGp1c3QpKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYmFzaWNDb2xvckZpbHRlciA9IGZ1bmN0aW9uIChtYXRyaXgpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaXIpIHtcbiAgICAgICAgcmV0dXJuIGNvbG9yRmlsdGVyKGlyLCBtYXRyaXgpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBiYXNpY0NvbnZvbHV0aW9uRmlsdGVyID0gZnVuY3Rpb24gKGtlcm5lbCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpcikge1xuICAgICAgICByZXR1cm4gY29udm9sdXRlRmlsdGVyKGlyLCBrZXJuZWwpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpbnZlcnQgPSBiYXNpY0NvbG9yRmlsdGVyKFtcbiAgICAgIC0xLFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICAwLFxuICAgICAgMjU1LFxuICAgICAgMCxcbiAgICAgIC0xLFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICAyNTUsXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIC0xLFxuICAgICAgMCxcbiAgICAgIDI1NSxcbiAgICAgIDAsXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIDEsXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIDFcbiAgICBdKTtcbiAgICB2YXIgYnJpZ2h0bmVzcyA9IGNvbXBsZXhBZGp1c3RhYmxlQ29sb3JGaWx0ZXIoYWRqdXN0QnJpZ2h0bmVzcyk7XG4gICAgdmFyIGNvbnRyYXN0ID0gY29tcGxleEFkanVzdGFibGVDb2xvckZpbHRlcihhZGp1c3RDb250cmFzdCk7XG4gICAgdmFyIGNvbG9yaXplID0gZnVuY3Rpb24gKGlyLCBhZGp1c3RSLCBhZGp1c3RHLCBhZGp1c3RCKSB7XG4gICAgICByZXR1cm4gY29sb3JGaWx0ZXIoaXIsIGFkanVzdENvbG9ycyhpZGVudGl0eSQxKCksIGFkanVzdFIsIGFkanVzdEcsIGFkanVzdEIpKTtcbiAgICB9O1xuICAgIHZhciBzaGFycGVuID0gYmFzaWNDb252b2x1dGlvbkZpbHRlcihbXG4gICAgICAwLFxuICAgICAgLTEsXG4gICAgICAwLFxuICAgICAgLTEsXG4gICAgICA1LFxuICAgICAgLTEsXG4gICAgICAwLFxuICAgICAgLTEsXG4gICAgICAwXG4gICAgXSk7XG4gICAgdmFyIGdhbW1hID0gZnVuY3Rpb25Db2xvckZpbHRlcihmdW5jdGlvbiAoY29sb3IsIHZhbHVlKSB7XG4gICAgICByZXR1cm4gTWF0aC5wb3coY29sb3IgLyAyNTUsIDEgLSB2YWx1ZSkgKiAyNTU7XG4gICAgfSk7XG5cbiAgICB2YXIgc2NhbGUgPSBmdW5jdGlvbiAoaW1hZ2UsIGRXLCBkSCkge1xuICAgICAgdmFyIHNXID0gZ2V0V2lkdGgoaW1hZ2UpO1xuICAgICAgdmFyIHNIID0gZ2V0SGVpZ2h0KGltYWdlKTtcbiAgICAgIHZhciB3UmF0aW8gPSBkVyAvIHNXO1xuICAgICAgdmFyIGhSYXRpbyA9IGRIIC8gc0g7XG4gICAgICB2YXIgc2NhbGVDYXBwZWQgPSBmYWxzZTtcbiAgICAgIGlmICh3UmF0aW8gPCAwLjUgfHwgd1JhdGlvID4gMikge1xuICAgICAgICB3UmF0aW8gPSB3UmF0aW8gPCAwLjUgPyAwLjUgOiAyO1xuICAgICAgICBzY2FsZUNhcHBlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoaFJhdGlvIDwgMC41IHx8IGhSYXRpbyA+IDIpIHtcbiAgICAgICAgaFJhdGlvID0gaFJhdGlvIDwgMC41ID8gMC41IDogMjtcbiAgICAgICAgc2NhbGVDYXBwZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdmFyIHNjYWxlZCA9IF9zY2FsZShpbWFnZSwgd1JhdGlvLCBoUmF0aW8pO1xuICAgICAgcmV0dXJuICFzY2FsZUNhcHBlZCA/IHNjYWxlZCA6IHNjYWxlZC50aGVuKGZ1bmN0aW9uICh0Q2FudmFzKSB7XG4gICAgICAgIHJldHVybiBzY2FsZSh0Q2FudmFzLCBkVywgZEgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgX3NjYWxlID0gZnVuY3Rpb24gKGltYWdlLCB3UmF0aW8sIGhSYXRpbykge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlJDEoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgICAgdmFyIHNXID0gZ2V0V2lkdGgoaW1hZ2UpO1xuICAgICAgICB2YXIgc0ggPSBnZXRIZWlnaHQoaW1hZ2UpO1xuICAgICAgICB2YXIgZFcgPSBNYXRoLmZsb29yKHNXICogd1JhdGlvKTtcbiAgICAgICAgdmFyIGRIID0gTWF0aC5mbG9vcihzSCAqIGhSYXRpbyk7XG4gICAgICAgIHZhciBjYW52YXMgPSBjcmVhdGUkNShkVywgZEgpO1xuICAgICAgICB2YXIgY29udGV4dCA9IGdldDJkQ29udGV4dChjYW52YXMpO1xuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgc1csIHNILCAwLCAwLCBkVywgZEgpO1xuICAgICAgICByZXNvbHZlKGNhbnZhcyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGNlaWxXaXRoUHJlY2lzaW9uID0gZnVuY3Rpb24gKG51bSwgcHJlY2lzaW9uKSB7XG4gICAgICBpZiAocHJlY2lzaW9uID09PSB2b2lkIDApIHtcbiAgICAgICAgcHJlY2lzaW9uID0gMjtcbiAgICAgIH1cbiAgICAgIHZhciBtdWwgPSBNYXRoLnBvdygxMCwgcHJlY2lzaW9uKTtcbiAgICAgIHZhciB1cHBlciA9IE1hdGgucm91bmQobnVtICogbXVsKTtcbiAgICAgIHJldHVybiBNYXRoLmNlaWwodXBwZXIgLyBtdWwpO1xuICAgIH07XG4gICAgdmFyIHJvdGF0ZSA9IGZ1bmN0aW9uIChpciwgYW5nbGUpIHtcbiAgICAgIHJldHVybiBpci50b0NhbnZhcygpLnRoZW4oZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgICByZXR1cm4gYXBwbHlSb3RhdGUoY2FudmFzLCBpci5nZXRUeXBlKCksIGFuZ2xlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFwcGx5Um90YXRlID0gZnVuY3Rpb24gKGltYWdlLCB0eXBlLCBhbmdsZSkge1xuICAgICAgdmFyIGRlZ3JlZXMgPSBhbmdsZSA8IDAgPyAzNjAgKyBhbmdsZSA6IGFuZ2xlO1xuICAgICAgdmFyIHJhZCA9IGRlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgdmFyIHdpZHRoID0gaW1hZ2Uud2lkdGg7XG4gICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xuICAgICAgdmFyIHNpbiA9IE1hdGguc2luKHJhZCk7XG4gICAgICB2YXIgY29zID0gTWF0aC5jb3MocmFkKTtcbiAgICAgIHZhciBuZXdXaWR0aCA9IGNlaWxXaXRoUHJlY2lzaW9uKE1hdGguYWJzKHdpZHRoICogY29zKSArIE1hdGguYWJzKGhlaWdodCAqIHNpbikpO1xuICAgICAgdmFyIG5ld0hlaWdodCA9IGNlaWxXaXRoUHJlY2lzaW9uKE1hdGguYWJzKHdpZHRoICogc2luKSArIE1hdGguYWJzKGhlaWdodCAqIGNvcykpO1xuICAgICAgdmFyIGNhbnZhcyA9IGNyZWF0ZSQ1KG5ld1dpZHRoLCBuZXdIZWlnaHQpO1xuICAgICAgdmFyIGNvbnRleHQgPSBnZXQyZENvbnRleHQoY2FudmFzKTtcbiAgICAgIGNvbnRleHQudHJhbnNsYXRlKG5ld1dpZHRoIC8gMiwgbmV3SGVpZ2h0IC8gMik7XG4gICAgICBjb250ZXh0LnJvdGF0ZShyYWQpO1xuICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIC13aWR0aCAvIDIsIC1oZWlnaHQgLyAyKTtcbiAgICAgIHJldHVybiBmcm9tQ2FudmFzKGNhbnZhcywgdHlwZSk7XG4gICAgfTtcbiAgICB2YXIgZmxpcCA9IGZ1bmN0aW9uIChpciwgYXhpcykge1xuICAgICAgcmV0dXJuIGlyLnRvQ2FudmFzKCkudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIHJldHVybiBhcHBseUZsaXAoY2FudmFzLCBpci5nZXRUeXBlKCksIGF4aXMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXBwbHlGbGlwID0gZnVuY3Rpb24gKGltYWdlLCB0eXBlLCBheGlzKSB7XG4gICAgICB2YXIgY2FudmFzID0gY3JlYXRlJDUoaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG4gICAgICB2YXIgY29udGV4dCA9IGdldDJkQ29udGV4dChjYW52YXMpO1xuICAgICAgaWYgKGF4aXMgPT09ICd2Jykge1xuICAgICAgICBjb250ZXh0LnNjYWxlKDEsIC0xKTtcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIC1jYW52YXMuaGVpZ2h0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRleHQuc2NhbGUoLTEsIDEpO1xuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgLWNhbnZhcy53aWR0aCwgMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJvbUNhbnZhcyhjYW52YXMsIHR5cGUpO1xuICAgIH07XG4gICAgdmFyIGNyb3AgPSBmdW5jdGlvbiAoaXIsIHgsIHksIHcsIGgpIHtcbiAgICAgIHJldHVybiBpci50b0NhbnZhcygpLnRoZW4oZnVuY3Rpb24gKGNhbnZhcykge1xuICAgICAgICByZXR1cm4gYXBwbHlDcm9wKGNhbnZhcywgaXIuZ2V0VHlwZSgpLCB4LCB5LCB3LCBoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFwcGx5Q3JvcCA9IGZ1bmN0aW9uIChpbWFnZSwgdHlwZSwgeCwgeSwgdywgaCkge1xuICAgICAgdmFyIGNhbnZhcyA9IGNyZWF0ZSQ1KHcsIGgpO1xuICAgICAgdmFyIGNvbnRleHQgPSBnZXQyZENvbnRleHQoY2FudmFzKTtcbiAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAteCwgLXkpO1xuICAgICAgcmV0dXJuIGZyb21DYW52YXMoY2FudmFzLCB0eXBlKTtcbiAgICB9O1xuICAgIHZhciByZXNpemUkMSA9IGZ1bmN0aW9uIChpciwgdywgaCkge1xuICAgICAgcmV0dXJuIGlyLnRvQ2FudmFzKCkudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICAgIHJldHVybiBzY2FsZShjYW52YXMsIHcsIGgpLnRoZW4oZnVuY3Rpb24gKG5ld0NhbnZhcykge1xuICAgICAgICAgIHJldHVybiBmcm9tQ2FudmFzKG5ld0NhbnZhcywgaXIuZ2V0VHlwZSgpKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGludmVydCQxID0gZnVuY3Rpb24gKGlyKSB7XG4gICAgICByZXR1cm4gaW52ZXJ0KGlyKTtcbiAgICB9O1xuICAgIHZhciBzaGFycGVuJDEgPSBmdW5jdGlvbiAoaXIpIHtcbiAgICAgIHJldHVybiBzaGFycGVuKGlyKTtcbiAgICB9O1xuICAgIHZhciBnYW1tYSQxID0gZnVuY3Rpb24gKGlyLCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIGdhbW1hKGlyLCB2YWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgY29sb3JpemUkMSA9IGZ1bmN0aW9uIChpciwgYWRqdXN0UiwgYWRqdXN0RywgYWRqdXN0Qikge1xuICAgICAgcmV0dXJuIGNvbG9yaXplKGlyLCBhZGp1c3RSLCBhZGp1c3RHLCBhZGp1c3RCKTtcbiAgICB9O1xuICAgIHZhciBicmlnaHRuZXNzJDEgPSBmdW5jdGlvbiAoaXIsIGFkanVzdCkge1xuICAgICAgcmV0dXJuIGJyaWdodG5lc3MoaXIsIGFkanVzdCk7XG4gICAgfTtcbiAgICB2YXIgY29udHJhc3QkMSA9IGZ1bmN0aW9uIChpciwgYWRqdXN0KSB7XG4gICAgICByZXR1cm4gY29udHJhc3QoaXIsIGFkanVzdCk7XG4gICAgfTtcbiAgICB2YXIgZmxpcCQxID0gZnVuY3Rpb24gKGlyLCBheGlzKSB7XG4gICAgICByZXR1cm4gZmxpcChpciwgYXhpcyk7XG4gICAgfTtcbiAgICB2YXIgY3JvcCQxID0gZnVuY3Rpb24gKGlyLCB4LCB5LCB3LCBoKSB7XG4gICAgICByZXR1cm4gY3JvcChpciwgeCwgeSwgdywgaCk7XG4gICAgfTtcbiAgICB2YXIgcmVzaXplJDIgPSBmdW5jdGlvbiAoaXIsIHcsIGgpIHtcbiAgICAgIHJldHVybiByZXNpemUkMShpciwgdywgaCk7XG4gICAgfTtcbiAgICB2YXIgcm90YXRlJDEgPSBmdW5jdGlvbiAoaXIsIGFuZ2xlKSB7XG4gICAgICByZXR1cm4gcm90YXRlKGlyLCBhbmdsZSk7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJJY29uJDEgPSBmdW5jdGlvbiAoaWNvbkh0bWwsIGJlaGF2aW91cnMpIHtcbiAgICAgIHJldHVybiBfX2Fzc2lnbih7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgIGlubmVySHRtbDogaWNvbkh0bWwsXG4gICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgJ3RveC1pY29uJyxcbiAgICAgICAgICAgICd0b3gtdGJ0bl9faWNvbi13cmFwJ1xuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgfSwgYmVoYXZpb3Vycyk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVySWNvbkZyb21QYWNrID0gZnVuY3Rpb24gKGljb25OYW1lLCBpY29uc1Byb3ZpZGVyKSB7XG4gICAgICByZXR1cm4gcmVuZGVySWNvbiQxKGdldCRlKGljb25OYW1lLCBpY29uc1Byb3ZpZGVyKSwge30pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlclJlcGxhY2FibGVJY29uRnJvbVBhY2sgPSBmdW5jdGlvbiAoaWNvbk5hbWUsIGljb25zUHJvdmlkZXIpIHtcbiAgICAgIHJldHVybiByZW5kZXJJY29uJDEoZ2V0JGUoaWNvbk5hbWUsIGljb25zUHJvdmlkZXIpLCB7IGJlaGF2aW91cnM6IGRlcml2ZSQxKFtSZXBsYWNpbmcuY29uZmlnKHt9KV0pIH0pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckxhYmVsJDEgPSBmdW5jdGlvbiAodGV4dCwgcHJlZml4LCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgIGlubmVySHRtbDogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZSh0ZXh0KSxcbiAgICAgICAgICBjbGFzc2VzOiBbcHJlZml4ICsgJ19fc2VsZWN0LWxhYmVsJ11cbiAgICAgICAgfSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1JlcGxhY2luZy5jb25maWcoe30pXSlcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBfYSQxO1xuICAgIHZhciBpbnRlcm5hbFRvb2xiYXJCdXR0b25FeGVjdXRlID0gZ2VuZXJhdGUkMSgndG9vbGJhci5idXR0b24uZXhlY3V0ZScpO1xuICAgIHZhciBvblRvb2xiYXJCdXR0b25FeGVjdXRlID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIHJldHVybiBydW5PbkV4ZWN1dGUoZnVuY3Rpb24gKGNvbXAsIF9zaW11bGF0ZWRFdmVudCkge1xuICAgICAgICBydW5XaXRoQXBpKGluZm8sIGNvbXApKGZ1bmN0aW9uIChpdGVtQXBpKSB7XG4gICAgICAgICAgZW1pdFdpdGgoY29tcCwgaW50ZXJuYWxUb29sYmFyQnV0dG9uRXhlY3V0ZSwgeyBidXR0b25BcGk6IGl0ZW1BcGkgfSk7XG4gICAgICAgICAgaW5mby5vbkFjdGlvbihpdGVtQXBpKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB0b29sYmFyQnV0dG9uRXZlbnRPcmRlciA9IChfYSQxID0ge30sIF9hJDFbZXhlY3V0ZSgpXSA9IFtcbiAgICAgICdkaXNhYmxpbmcnLFxuICAgICAgJ2FsbG95LmJhc2UuYmVoYXZpb3VyJyxcbiAgICAgICd0b2dnbGluZycsXG4gICAgICAndG9vbGJhci1idXR0b24tZXZlbnRzJ1xuICAgIF0sIF9hJDEpO1xuXG4gICAgdmFyIHVwZGF0ZU1lbnVUZXh0ID0gZ2VuZXJhdGUkMSgndXBkYXRlLW1lbnUtdGV4dCcpO1xuICAgIHZhciB1cGRhdGVNZW51SWNvbiA9IGdlbmVyYXRlJDEoJ3VwZGF0ZS1tZW51LWljb24nKTtcbiAgICB2YXIgcmVuZGVyQ29tbW9uRHJvcGRvd24gPSBmdW5jdGlvbiAoc3BlYywgcHJlZml4LCBzaGFyZWRCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBlZGl0b3JPZmZDZWxsID0gQ2VsbChub29wKTtcbiAgICAgIHZhciBvcHRNZW1EaXNwbGF5VGV4dCA9IHNwZWMudGV4dC5tYXAoZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHJlY29yZChyZW5kZXJMYWJlbCQxKHRleHQsIHByZWZpeCwgc2hhcmVkQmFja3N0YWdlLnByb3ZpZGVycykpO1xuICAgICAgfSk7XG4gICAgICB2YXIgb3B0TWVtRGlzcGxheUljb24gPSBzcGVjLmljb24ubWFwKGZ1bmN0aW9uIChpY29uTmFtZSkge1xuICAgICAgICByZXR1cm4gcmVjb3JkKHJlbmRlclJlcGxhY2FibGVJY29uRnJvbVBhY2soaWNvbk5hbWUsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaWNvbnMpKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIG9uTGVmdE9yUmlnaHRJbk1lbnUgPSBmdW5jdGlvbiAoY29tcCwgc2UpIHtcbiAgICAgICAgdmFyIGRyb3Bkb3duID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGNvbXApO1xuICAgICAgICBGb2N1c2luZy5mb2N1cyhkcm9wZG93bik7XG4gICAgICAgIGVtaXRXaXRoKGRyb3Bkb3duLCAna2V5ZG93bicsIHsgcmF3OiBzZS5ldmVudC5yYXcgfSk7XG4gICAgICAgIERyb3Bkb3duLmNsb3NlKGRyb3Bkb3duKTtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJvbGUgPSBzcGVjLnJvbGUuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICAgIH0sIGZ1bmN0aW9uIChyb2xlKSB7XG4gICAgICAgIHJldHVybiB7IHJvbGU6IHJvbGUgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHRvb2x0aXBBdHRyaWJ1dGVzID0gc3BlYy50b29sdGlwLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9LCBmdW5jdGlvbiAodG9vbHRpcCkge1xuICAgICAgICB2YXIgdHJhbnNsYXRlZFRvb2x0aXAgPSBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzLnRyYW5zbGF0ZSh0b29sdGlwKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAndGl0bGUnOiB0cmFuc2xhdGVkVG9vbHRpcCxcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IHRyYW5zbGF0ZWRUb29sdGlwXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHZhciBtZW1Ecm9wZG93biA9IHJlY29yZChEcm9wZG93bi5za2V0Y2goX19hc3NpZ24oX19hc3NpZ24oX19hc3NpZ24oe30sIHNwZWMudWlkID8geyB1aWQ6IHNwZWMudWlkIH0gOiB7fSksIHJvbGUpLCB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2J1dHRvbicsXG4gICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgcHJlZml4LFxuICAgICAgICAgICAgcHJlZml4ICsgJy0tc2VsZWN0J1xuICAgICAgICAgIF0uY29uY2F0KG1hcChzcGVjLmNsYXNzZXMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJlZml4ICsgJy0tJyArIGM7XG4gICAgICAgICAgfSkpLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IF9fYXNzaWduKHt9LCB0b29sdGlwQXR0cmlidXRlcylcbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50UmVuZGVyUGlwZWxpbmUoW1xuICAgICAgICAgIG9wdE1lbURpc3BsYXlJY29uLm1hcChmdW5jdGlvbiAobWVtKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtLmFzU3BlYygpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIG9wdE1lbURpc3BsYXlUZXh0Lm1hcChmdW5jdGlvbiAobWVtKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtLmFzU3BlYygpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFtwcmVmaXggKyAnX19zZWxlY3QtY2hldnJvbiddLFxuICAgICAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCdjaGV2cm9uLWRvd24nLCBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzLmljb25zKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pLFxuICAgICAgICBtYXRjaFdpZHRoOiB0cnVlLFxuICAgICAgICB1c2VNaW5XaWR0aDogdHJ1ZSxcbiAgICAgICAgZHJvcGRvd25CZWhhdmlvdXJzOiBkZXJpdmUkMShfX3NwcmVhZEFycmF5cyhzcGVjLmRyb3Bkb3duQmVoYXZpb3VycywgW1xuICAgICAgICAgIERpc2FibGluZ0NvbmZpZ3MuYnV0dG9uKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaXNEaXNhYmxlZCgpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICAgIFVuc2VsZWN0aW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgUmVwbGFjaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgY29uZmlnKCdkcm9wZG93bi1ldmVudHMnLCBbXG4gICAgICAgICAgICBvbkNvbnRyb2xBdHRhY2hlZChzcGVjLCBlZGl0b3JPZmZDZWxsKSxcbiAgICAgICAgICAgIG9uQ29udHJvbERldGFjaGVkKHNwZWMsIGVkaXRvck9mZkNlbGwpXG4gICAgICAgICAgXSksXG4gICAgICAgICAgY29uZmlnKCdtZW51YnV0dG9uLXVwZGF0ZS1kaXNwbGF5LXRleHQnLCBbXG4gICAgICAgICAgICBydW4odXBkYXRlTWVudVRleHQsIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICAgICAgICBvcHRNZW1EaXNwbGF5VGV4dC5iaW5kKGZ1bmN0aW9uIChtZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWVtLmdldE9wdChjb21wKTtcbiAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAoZGlzcGxheVRleHQpIHtcbiAgICAgICAgICAgICAgICBSZXBsYWNpbmcuc2V0KGRpc3BsYXlUZXh0LCBbdGV4dChzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzLnRyYW5zbGF0ZShzZS5ldmVudC50ZXh0KSldKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ1bih1cGRhdGVNZW51SWNvbiwgZnVuY3Rpb24gKGNvbXAsIHNlKSB7XG4gICAgICAgICAgICAgIG9wdE1lbURpc3BsYXlJY29uLmJpbmQoZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZW0uZ2V0T3B0KGNvbXApO1xuICAgICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChkaXNwbGF5SWNvbikge1xuICAgICAgICAgICAgICAgIFJlcGxhY2luZy5zZXQoZGlzcGxheUljb24sIFtyZW5kZXJSZXBsYWNhYmxlSWNvbkZyb21QYWNrKHNlLmV2ZW50Lmljb24sIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaWNvbnMpXSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKVxuICAgICAgICBdKSksXG4gICAgICAgIGV2ZW50T3JkZXI6IGRlZXBNZXJnZSh0b29sYmFyQnV0dG9uRXZlbnRPcmRlciwge1xuICAgICAgICAgIG1vdXNlZG93bjogW1xuICAgICAgICAgICAgJ2ZvY3VzaW5nJyxcbiAgICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cicsXG4gICAgICAgICAgICAnaXRlbS10eXBlLWV2ZW50cycsXG4gICAgICAgICAgICAnbm9ybWFsLWRyb3Bkb3duLWV2ZW50cydcbiAgICAgICAgICBdXG4gICAgICAgIH0pLFxuICAgICAgICBzYW5kYm94QmVoYXZpb3VyczogZGVyaXZlJDEoW0tleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgb25MZWZ0OiBvbkxlZnRPclJpZ2h0SW5NZW51LFxuICAgICAgICAgICAgb25SaWdodDogb25MZWZ0T3JSaWdodEluTWVudVxuICAgICAgICAgIH0pXSksXG4gICAgICAgIGxhenlTaW5rOiBzaGFyZWRCYWNrc3RhZ2UuZ2V0U2luayxcbiAgICAgICAgdG9nZ2xlQ2xhc3M6IHByZWZpeCArICctLWFjdGl2ZScsXG4gICAgICAgIHBhcnRzOiB7IG1lbnU6IHBhcnQoZmFsc2UsIHNwZWMuY29sdW1ucywgc3BlYy5wcmVzZXRzKSB9LFxuICAgICAgICBmZXRjaDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICByZXR1cm4gRnV0dXJlLm51KGN1cnJ5KHNwZWMuZmV0Y2gsIGNvbXApKTtcbiAgICAgICAgfVxuICAgICAgfSkpKTtcbiAgICAgIHJldHVybiBtZW1Ecm9wZG93bi5hc1NwZWMoKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzTWVudUl0ZW1SZWZlcmVuY2UgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgcmV0dXJuIGlzU3RyaW5nKGl0ZW0pO1xuICAgIH07XG4gICAgdmFyIGlzU2VwYXJhdG9yID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHJldHVybiBpdGVtLnR5cGUgPT09ICdzZXBhcmF0b3InO1xuICAgIH07XG4gICAgdmFyIGlzRXhwYW5kaW5nTWVudUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgcmV0dXJuIGhhcyhpdGVtLCAnZ2V0U3VibWVudUl0ZW1zJyk7XG4gICAgfTtcbiAgICB2YXIgc2VwYXJhdG9yJDEgPSB7IHR5cGU6ICdzZXBhcmF0b3InIH07XG4gICAgdmFyIHVud3JhcFJlZmVyZW5jZXMgPSBmdW5jdGlvbiAoaXRlbXMsIG1lbnVJdGVtcykge1xuICAgICAgdmFyIHJlYWxJdGVtcyA9IGZvbGRsKGl0ZW1zLCBmdW5jdGlvbiAoYWNjLCBpdGVtKSB7XG4gICAgICAgIGlmIChpc01lbnVJdGVtUmVmZXJlbmNlKGl0ZW0pKSB7XG4gICAgICAgICAgaWYgKGl0ZW0gPT09ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbSA9PT0gJ3wnKSB7XG4gICAgICAgICAgICByZXR1cm4gYWNjLmxlbmd0aCA+IDAgJiYgIWlzU2VwYXJhdG9yKGFjY1thY2MubGVuZ3RoIC0gMV0pID8gYWNjLmNvbmNhdChbc2VwYXJhdG9yJDFdKSA6IGFjYztcbiAgICAgICAgICB9IGVsc2UgaWYgKGhhcyhtZW51SXRlbXMsIGl0ZW0udG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBhY2MuY29uY2F0KFttZW51SXRlbXNbaXRlbS50b0xvd2VyQ2FzZSgpXV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gYWNjLmNvbmNhdChbaXRlbV0pO1xuICAgICAgICB9XG4gICAgICB9LCBbXSk7XG4gICAgICBpZiAocmVhbEl0ZW1zLmxlbmd0aCA+IDAgJiYgaXNTZXBhcmF0b3IocmVhbEl0ZW1zW3JlYWxJdGVtcy5sZW5ndGggLSAxXSkpIHtcbiAgICAgICAgcmVhbEl0ZW1zLnBvcCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlYWxJdGVtcztcbiAgICB9O1xuICAgIHZhciBnZXRGcm9tRXhwYW5kaW5nSXRlbSA9IGZ1bmN0aW9uIChpdGVtLCBtZW51SXRlbXMpIHtcbiAgICAgIHZhciBzdWJtZW51SXRlbXMgPSBpdGVtLmdldFN1Ym1lbnVJdGVtcygpO1xuICAgICAgdmFyIHJlc3QgPSBleHBhbmQoc3VibWVudUl0ZW1zLCBtZW51SXRlbXMpO1xuICAgICAgdmFyIG5ld01lbnVzID0gZGVlcE1lcmdlKHJlc3QubWVudXMsIHdyYXAkMShpdGVtLnZhbHVlLCByZXN0Lml0ZW1zKSk7XG4gICAgICB2YXIgbmV3RXhwYW5zaW9ucyA9IGRlZXBNZXJnZShyZXN0LmV4cGFuc2lvbnMsIHdyYXAkMShpdGVtLnZhbHVlLCBpdGVtLnZhbHVlKSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICBtZW51czogbmV3TWVudXMsXG4gICAgICAgIGV4cGFuc2lvbnM6IG5ld0V4cGFuc2lvbnNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0RnJvbUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSwgbWVudUl0ZW1zKSB7XG4gICAgICByZXR1cm4gaXNFeHBhbmRpbmdNZW51SXRlbShpdGVtKSA/IGdldEZyb21FeHBhbmRpbmdJdGVtKGl0ZW0sIG1lbnVJdGVtcykgOiB7XG4gICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgIG1lbnVzOiB7fSxcbiAgICAgICAgZXhwYW5zaW9uczoge31cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGVWYWx1ZUlmUmVxdWlyZWQgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgaWYgKGlzU2VwYXJhdG9yKGl0ZW0pKSB7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGl0ZW1WYWx1ZSA9IGdldCQxKGl0ZW0sICd2YWx1ZScpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZW5lcmF0ZSQxKCdnZW5lcmF0ZWQtbWVudS1pdGVtJyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGVlcE1lcmdlKHsgdmFsdWU6IGl0ZW1WYWx1ZSB9LCBpdGVtKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBleHBhbmQgPSBmdW5jdGlvbiAoaXRlbXMsIG1lbnVJdGVtcykge1xuICAgICAgdmFyIHJlYWxJdGVtcyA9IHVud3JhcFJlZmVyZW5jZXMoaXNTdHJpbmcoaXRlbXMpID8gaXRlbXMuc3BsaXQoJyAnKSA6IGl0ZW1zLCBtZW51SXRlbXMpO1xuICAgICAgcmV0dXJuIGZvbGRyKHJlYWxJdGVtcywgZnVuY3Rpb24gKGFjYywgaXRlbSkge1xuICAgICAgICB2YXIgaXRlbVdpdGhWYWx1ZSA9IGdlbmVyYXRlVmFsdWVJZlJlcXVpcmVkKGl0ZW0pO1xuICAgICAgICB2YXIgbmV3RGF0YSA9IGdldEZyb21JdGVtKGl0ZW1XaXRoVmFsdWUsIG1lbnVJdGVtcyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbWVudXM6IGRlZXBNZXJnZShhY2MubWVudXMsIG5ld0RhdGEubWVudXMpLFxuICAgICAgICAgIGl0ZW1zOiBbbmV3RGF0YS5pdGVtXS5jb25jYXQoYWNjLml0ZW1zKSxcbiAgICAgICAgICBleHBhbnNpb25zOiBkZWVwTWVyZ2UoYWNjLmV4cGFuc2lvbnMsIG5ld0RhdGEuZXhwYW5zaW9ucylcbiAgICAgICAgfTtcbiAgICAgIH0sIHtcbiAgICAgICAgbWVudXM6IHt9LFxuICAgICAgICBleHBhbnNpb25zOiB7fSxcbiAgICAgICAgaXRlbXM6IFtdXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGJ1aWxkJDIgPSBmdW5jdGlvbiAoaXRlbXMsIGl0ZW1SZXNwb25zZSwgYmFja3N0YWdlLCBpc0hvcml6b250YWxNZW51KSB7XG4gICAgICB2YXIgcHJpbWFyeSA9IGdlbmVyYXRlJDEoJ3ByaW1hcnktbWVudScpO1xuICAgICAgdmFyIGRhdGEgPSBleHBhbmQoaXRlbXMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLm1lbnVJdGVtcygpKTtcbiAgICAgIGlmIChkYXRhLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgICAgdmFyIG1haW5NZW51ID0gY3JlYXRlUGFydGlhbE1lbnUocHJpbWFyeSwgZGF0YS5pdGVtcywgaXRlbVJlc3BvbnNlLCBiYWNrc3RhZ2UsIGlzSG9yaXpvbnRhbE1lbnUpO1xuICAgICAgdmFyIHN1Ym1lbnVzID0gbWFwJDIoZGF0YS5tZW51cywgZnVuY3Rpb24gKG1lbnVJdGVtcywgbWVudU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVBhcnRpYWxNZW51KG1lbnVOYW1lLCBtZW51SXRlbXMsIGl0ZW1SZXNwb25zZSwgYmFja3N0YWdlLCBmYWxzZSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBtZW51cyA9IGRlZXBNZXJnZShzdWJtZW51cywgd3JhcCQxKHByaW1hcnksIG1haW5NZW51KSk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbSh0aWVyZWRNZW51LnRpZXJlZERhdGEocHJpbWFyeSwgbWVudXMsIGRhdGEuZXhwYW5zaW9ucykpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0TWVudUJ1dHRvbkFwaSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gRGlzYWJsaW5nLmlzRGlzYWJsZWQoY29tcG9uZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0RGlzYWJsZWQ6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuc2V0KGNvbXBvbmVudCwgc3RhdGUpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgIHZhciBlbG0gPSBjb21wb25lbnQuZWxlbWVudDtcbiAgICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICAgIGFkZCQyKGVsbSwgJ3RveC10YnRuLS1lbmFibGVkJyk7XG4gICAgICAgICAgICBzZXQkMShlbG0sICdhcmlhLXByZXNzZWQnLCB0cnVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVtb3ZlJDQoZWxtLCAndG94LXRidG4tLWVuYWJsZWQnKTtcbiAgICAgICAgICAgIHJlbW92ZSQxKGVsbSwgJ2FyaWEtcHJlc3NlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaXNBY3RpdmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gaGFzJDIoY29tcG9uZW50LmVsZW1lbnQsICd0b3gtdGJ0bi0tZW5hYmxlZCcpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlck1lbnVCdXR0b24gPSBmdW5jdGlvbiAoc3BlYywgcHJlZml4LCBiYWNrc3RhZ2UsIHJvbGUpIHtcbiAgICAgIHJldHVybiByZW5kZXJDb21tb25Ecm9wZG93bih7XG4gICAgICAgIHRleHQ6IHNwZWMudGV4dCxcbiAgICAgICAgaWNvbjogc3BlYy5pY29uLFxuICAgICAgICB0b29sdGlwOiBzcGVjLnRvb2x0aXAsXG4gICAgICAgIHJvbGU6IHJvbGUsXG4gICAgICAgIGZldGNoOiBmdW5jdGlvbiAoX2NvbXAsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgc3BlYy5mZXRjaChmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGJ1aWxkJDIoaXRlbXMsIEl0ZW1SZXNwb25zZSQxLkNMT1NFX09OX0VYRUNVVEUsIGJhY2tzdGFnZSwgZmFsc2UpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TZXR1cDogc3BlYy5vblNldHVwLFxuICAgICAgICBnZXRBcGk6IGdldE1lbnVCdXR0b25BcGksXG4gICAgICAgIGNvbHVtbnM6IDEsXG4gICAgICAgIHByZXNldHM6ICdub3JtYWwnLFxuICAgICAgICBjbGFzc2VzOiBbXSxcbiAgICAgICAgZHJvcGRvd25CZWhhdmlvdXJzOiBbVGFic3RvcHBpbmcuY29uZmlnKHt9KV1cbiAgICAgIH0sIHByZWZpeCwgYmFja3N0YWdlLnNoYXJlZCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RmV0Y2gkMSA9IGZ1bmN0aW9uIChpdGVtcywgZ2V0QnV0dG9uLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBnZXRNZW51SXRlbUFjdGlvbiA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgdmFyIG5ld1ZhbHVlID0gIWFwaS5pc0FjdGl2ZSgpO1xuICAgICAgICAgIGFwaS5zZXRBY3RpdmUobmV3VmFsdWUpO1xuICAgICAgICAgIGl0ZW0uc3RvcmFnZS5zZXQobmV3VmFsdWUpO1xuICAgICAgICAgIGJhY2tzdGFnZS5zaGFyZWQuZ2V0U2luaygpLmVhY2goZnVuY3Rpb24gKHNpbmspIHtcbiAgICAgICAgICAgIGdldEJ1dHRvbigpLmdldE9wdChzaW5rKS5lYWNoKGZ1bmN0aW9uIChvcmlnKSB7XG4gICAgICAgICAgICAgIGZvY3VzJDEob3JpZy5lbGVtZW50KTtcbiAgICAgICAgICAgICAgZW1pdFdpdGgob3JpZywgZm9ybUFjdGlvbkV2ZW50LCB7XG4gICAgICAgICAgICAgICAgbmFtZTogaXRlbS5uYW1lLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnN0b3JhZ2UuZ2V0KClcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0TWVudUl0ZW1TZXR1cCA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgYXBpLnNldEFjdGl2ZShpdGVtLnN0b3JhZ2UuZ2V0KCkpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoc3VjY2Vzcykge1xuICAgICAgICBzdWNjZXNzKG1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICB2YXIgdGV4dCA9IGl0ZW0udGV4dC5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGV4dDogdGV4dCB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7XG4gICAgICAgICAgICB0eXBlOiBpdGVtLnR5cGUsXG4gICAgICAgICAgICBhY3RpdmU6IGZhbHNlXG4gICAgICAgICAgfSwgdGV4dCksIHtcbiAgICAgICAgICAgIG9uQWN0aW9uOiBnZXRNZW51SXRlbUFjdGlvbihpdGVtKSxcbiAgICAgICAgICAgIG9uU2V0dXA6IGdldE1lbnVJdGVtU2V0dXAoaXRlbSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlckNvbW1vblNwZWMgPSBmdW5jdGlvbiAoc3BlYywgYWN0aW9uT3B0LCBleHRyYUJlaGF2aW91cnMsIGRvbSwgY29tcG9uZW50cywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICBpZiAoZXh0cmFCZWhhdmlvdXJzID09PSB2b2lkIDApIHtcbiAgICAgICAgZXh0cmFCZWhhdmlvdXJzID0gW107XG4gICAgICB9XG4gICAgICB2YXIgYWN0aW9uID0gYWN0aW9uT3B0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9LCBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgIHJldHVybiB7IGFjdGlvbjogYWN0aW9uIH07XG4gICAgICB9KTtcbiAgICAgIHZhciBjb21tb24gPSBfX2Fzc2lnbih7XG4gICAgICAgIGJ1dHRvbkJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLmJ1dHRvbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc3BlYy5kaXNhYmxlZCB8fCBwcm92aWRlcnNCYWNrc3RhZ2UuaXNEaXNhYmxlZCgpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICAgIFRhYnN0b3BwaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgY29uZmlnKCdidXR0b24gcHJlc3MnLCBbXG4gICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCgnY2xpY2snKSxcbiAgICAgICAgICAgIHByZXZlbnREZWZhdWx0KCdtb3VzZWRvd24nKVxuICAgICAgICAgIF0pXG4gICAgICAgIF0uY29uY2F0KGV4dHJhQmVoYXZpb3VycykpLFxuICAgICAgICBldmVudE9yZGVyOiB7XG4gICAgICAgICAgY2xpY2s6IFtcbiAgICAgICAgICAgICdidXR0b24gcHJlc3MnLFxuICAgICAgICAgICAgJ2FsbG95LmJhc2UuYmVoYXZpb3VyJ1xuICAgICAgICAgIF0sXG4gICAgICAgICAgbW91c2Vkb3duOiBbXG4gICAgICAgICAgICAnYnV0dG9uIHByZXNzJyxcbiAgICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cidcbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH0sIGFjdGlvbik7XG4gICAgICB2YXIgZG9tRmluYWwgPSBkZWVwTWVyZ2UoY29tbW9uLCB7IGRvbTogZG9tIH0pO1xuICAgICAgcmV0dXJuIGRlZXBNZXJnZShkb21GaW5hbCwgeyBjb21wb25lbnRzOiBjb21wb25lbnRzIH0pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckljb25CdXR0b25TcGVjID0gZnVuY3Rpb24gKHNwZWMsIGFjdGlvbiwgcHJvdmlkZXJzQmFja3N0YWdlLCBleHRyYUJlaGF2aW91cnMpIHtcbiAgICAgIGlmIChleHRyYUJlaGF2aW91cnMgPT09IHZvaWQgMCkge1xuICAgICAgICBleHRyYUJlaGF2aW91cnMgPSBbXTtcbiAgICAgIH1cbiAgICAgIHZhciB0b29sdGlwQXR0cmlidXRlcyA9IHNwZWMudG9vbHRpcC5tYXAoZnVuY3Rpb24gKHRvb2x0aXApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUodG9vbHRpcCksXG4gICAgICAgICAgJ3RpdGxlJzogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZSh0b29sdGlwKVxuICAgICAgICB9O1xuICAgICAgfSkuZ2V0T3Ioe30pO1xuICAgICAgdmFyIGRvbSA9IHtcbiAgICAgICAgdGFnOiAnYnV0dG9uJyxcbiAgICAgICAgY2xhc3NlczogWyd0b3gtdGJ0biddLFxuICAgICAgICBhdHRyaWJ1dGVzOiB0b29sdGlwQXR0cmlidXRlc1xuICAgICAgfTtcbiAgICAgIHZhciBpY29uID0gc3BlYy5pY29uLm1hcChmdW5jdGlvbiAoaWNvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckljb25Gcm9tUGFjayhpY29uTmFtZSwgcHJvdmlkZXJzQmFja3N0YWdlLmljb25zKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGNvbXBvbmVudHMgPSBjb21wb25lbnRSZW5kZXJQaXBlbGluZShbaWNvbl0pO1xuICAgICAgcmV0dXJuIHJlbmRlckNvbW1vblNwZWMoc3BlYywgYWN0aW9uLCBleHRyYUJlaGF2aW91cnMsIGRvbSwgY29tcG9uZW50cywgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJJY29uQnV0dG9uID0gZnVuY3Rpb24gKHNwZWMsIGFjdGlvbiwgcHJvdmlkZXJzQmFja3N0YWdlLCBleHRyYUJlaGF2aW91cnMpIHtcbiAgICAgIGlmIChleHRyYUJlaGF2aW91cnMgPT09IHZvaWQgMCkge1xuICAgICAgICBleHRyYUJlaGF2aW91cnMgPSBbXTtcbiAgICAgIH1cbiAgICAgIHZhciBpY29uQnV0dG9uU3BlYyA9IHJlbmRlckljb25CdXR0b25TcGVjKHNwZWMsIE9wdGlvbmFsLnNvbWUoYWN0aW9uKSwgcHJvdmlkZXJzQmFja3N0YWdlLCBleHRyYUJlaGF2aW91cnMpO1xuICAgICAgcmV0dXJuIEJ1dHRvbi5za2V0Y2goaWNvbkJ1dHRvblNwZWMpO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckJ1dHRvblNwZWMgPSBmdW5jdGlvbiAoc3BlYywgYWN0aW9uLCBwcm92aWRlcnNCYWNrc3RhZ2UsIGV4dHJhQmVoYXZpb3VycywgZXh0cmFDbGFzc2VzKSB7XG4gICAgICBpZiAoZXh0cmFCZWhhdmlvdXJzID09PSB2b2lkIDApIHtcbiAgICAgICAgZXh0cmFCZWhhdmlvdXJzID0gW107XG4gICAgICB9XG4gICAgICBpZiAoZXh0cmFDbGFzc2VzID09PSB2b2lkIDApIHtcbiAgICAgICAgZXh0cmFDbGFzc2VzID0gW107XG4gICAgICB9XG4gICAgICB2YXIgdHJhbnNsYXRlZFRleHQgPSBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKHNwZWMudGV4dCk7XG4gICAgICB2YXIgaWNvbiA9IHNwZWMuaWNvbiA/IHNwZWMuaWNvbi5tYXAoZnVuY3Rpb24gKGljb25OYW1lKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJJY29uRnJvbVBhY2soaWNvbk5hbWUsIHByb3ZpZGVyc0JhY2tzdGFnZS5pY29ucyk7XG4gICAgICB9KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIHZhciBjb21wb25lbnRzID0gaWNvbi5pc1NvbWUoKSA/IGNvbXBvbmVudFJlbmRlclBpcGVsaW5lKFtpY29uXSkgOiBbXTtcbiAgICAgIHZhciBpbm5lckh0bWwgPSBpY29uLmlzU29tZSgpID8ge30gOiB7IGlubmVySHRtbDogdHJhbnNsYXRlZFRleHQgfTtcbiAgICAgIHZhciBjbGFzc2VzID0gX19zcHJlYWRBcnJheXMoIXNwZWMucHJpbWFyeSAmJiAhc3BlYy5ib3JkZXJsZXNzID8gW1xuICAgICAgICAndG94LWJ1dHRvbicsXG4gICAgICAgICd0b3gtYnV0dG9uLS1zZWNvbmRhcnknXG4gICAgICBdIDogWyd0b3gtYnV0dG9uJ10sIGljb24uaXNTb21lKCkgPyBbJ3RveC1idXR0b24tLWljb24nXSA6IFtdLCBzcGVjLmJvcmRlcmxlc3MgPyBbJ3RveC1idXR0b24tLW5ha2VkJ10gOiBbXSwgZXh0cmFDbGFzc2VzKTtcbiAgICAgIHZhciBkb20gPSBfX2Fzc2lnbihfX2Fzc2lnbih7XG4gICAgICAgIHRhZzogJ2J1dHRvbicsXG4gICAgICAgIGNsYXNzZXM6IGNsYXNzZXNcbiAgICAgIH0sIGlubmVySHRtbCksIHsgYXR0cmlidXRlczogeyB0aXRsZTogdHJhbnNsYXRlZFRleHQgfSB9KTtcbiAgICAgIHJldHVybiByZW5kZXJDb21tb25TcGVjKHNwZWMsIGFjdGlvbiwgZXh0cmFCZWhhdmlvdXJzLCBkb20sIGNvbXBvbmVudHMsIHByb3ZpZGVyc0JhY2tzdGFnZSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQnV0dG9uID0gZnVuY3Rpb24gKHNwZWMsIGFjdGlvbiwgcHJvdmlkZXJzQmFja3N0YWdlLCBleHRyYUJlaGF2aW91cnMsIGV4dHJhQ2xhc3Nlcykge1xuICAgICAgaWYgKGV4dHJhQmVoYXZpb3VycyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGV4dHJhQmVoYXZpb3VycyA9IFtdO1xuICAgICAgfVxuICAgICAgaWYgKGV4dHJhQ2xhc3NlcyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGV4dHJhQ2xhc3NlcyA9IFtdO1xuICAgICAgfVxuICAgICAgdmFyIGJ1dHRvblNwZWMgPSByZW5kZXJCdXR0b25TcGVjKHNwZWMsIE9wdGlvbmFsLnNvbWUoYWN0aW9uKSwgcHJvdmlkZXJzQmFja3N0YWdlLCBleHRyYUJlaGF2aW91cnMsIGV4dHJhQ2xhc3Nlcyk7XG4gICAgICByZXR1cm4gQnV0dG9uLnNrZXRjaChidXR0b25TcGVjKTtcbiAgICB9O1xuICAgIHZhciBnZXRBY3Rpb24gPSBmdW5jdGlvbiAobmFtZSwgYnV0dG9uVHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIGlmIChidXR0b25UeXBlID09PSAnY3VzdG9tJykge1xuICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIGZvcm1BY3Rpb25FdmVudCwge1xuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiB7fVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGJ1dHRvblR5cGUgPT09ICdzdWJtaXQnKSB7XG4gICAgICAgICAgZW1pdChjb21wLCBmb3JtU3VibWl0RXZlbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKGJ1dHRvblR5cGUgPT09ICdjYW5jZWwnKSB7XG4gICAgICAgICAgZW1pdChjb21wLCBmb3JtQ2FuY2VsRXZlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Vua25vd24gYnV0dG9uIHR5cGU6ICcsIGJ1dHRvblR5cGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzTWVudUZvb3RlckJ1dHRvblNwZWMgPSBmdW5jdGlvbiAoc3BlYywgYnV0dG9uVHlwZSkge1xuICAgICAgcmV0dXJuIGJ1dHRvblR5cGUgPT09ICdtZW51JztcbiAgICB9O1xuICAgIHZhciBpc05vcm1hbEZvb3RlckJ1dHRvblNwZWMgPSBmdW5jdGlvbiAoc3BlYywgYnV0dG9uVHlwZSkge1xuICAgICAgcmV0dXJuIGJ1dHRvblR5cGUgPT09ICdjdXN0b20nIHx8IGJ1dHRvblR5cGUgPT09ICdjYW5jZWwnIHx8IGJ1dHRvblR5cGUgPT09ICdzdWJtaXQnO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckZvb3RlckJ1dHRvbiA9IGZ1bmN0aW9uIChzcGVjLCBidXR0b25UeXBlLCBiYWNrc3RhZ2UpIHtcbiAgICAgIGlmIChpc01lbnVGb290ZXJCdXR0b25TcGVjKHNwZWMsIGJ1dHRvblR5cGUpKSB7XG4gICAgICAgIHZhciBnZXRCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1lbUJ1dHRvbl8xO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgbWVudUJ1dHRvblNwZWMgPSBzcGVjO1xuICAgICAgICB2YXIgZml4ZWRTcGVjID0gX19hc3NpZ24oX19hc3NpZ24oe30sIHNwZWMpLCB7XG4gICAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgICAgYXBpLnNldERpc2FibGVkKHNwZWMuZGlzYWJsZWQpO1xuICAgICAgICAgICAgcmV0dXJuIG5vb3A7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmZXRjaDogZ2V0RmV0Y2gkMShtZW51QnV0dG9uU3BlYy5pdGVtcywgZ2V0QnV0dG9uLCBiYWNrc3RhZ2UpXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbWVtQnV0dG9uXzEgPSByZWNvcmQocmVuZGVyTWVudUJ1dHRvbihmaXhlZFNwZWMsICd0b3gtdGJ0bicsIGJhY2tzdGFnZSwgT3B0aW9uYWwubm9uZSgpKSk7XG4gICAgICAgIHJldHVybiBtZW1CdXR0b25fMS5hc1NwZWMoKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNOb3JtYWxGb290ZXJCdXR0b25TcGVjKHNwZWMsIGJ1dHRvblR5cGUpKSB7XG4gICAgICAgIHZhciBhY3Rpb24gPSBnZXRBY3Rpb24oc3BlYy5uYW1lLCBidXR0b25UeXBlKTtcbiAgICAgICAgdmFyIGJ1dHRvblNwZWMgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3BlYyksIHsgYm9yZGVybGVzczogZmFsc2UgfSk7XG4gICAgICAgIHJldHVybiByZW5kZXJCdXR0b24oYnV0dG9uU3BlYywgYWN0aW9uLCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycywgW10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignVW5rbm93biBmb290ZXIgYnV0dG9uIHR5cGU6ICcsIGJ1dHRvblR5cGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlbmRlckRpYWxvZ0J1dHRvbiA9IGZ1bmN0aW9uIChzcGVjLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBhY3Rpb24gPSBnZXRBY3Rpb24oc3BlYy5uYW1lLCAnY3VzdG9tJyk7XG4gICAgICByZXR1cm4gcmVuZGVyRm9ybUZpZWxkKE9wdGlvbmFsLm5vbmUoKSwgRm9ybUZpZWxkLnBhcnRzLmZpZWxkKF9fYXNzaWduKHsgZmFjdG9yeTogQnV0dG9uIH0sIHJlbmRlckJ1dHRvblNwZWMoc3BlYywgT3B0aW9uYWwuc29tZShhY3Rpb24pLCBwcm92aWRlcnNCYWNrc3RhZ2UsIFtcbiAgICAgICAgUmVwcmVzZW50aW5nQ29uZmlncy5tZW1vcnkoJycpLFxuICAgICAgICBDb21wb3NpbmdDb25maWdzLnNlbGYoKVxuICAgICAgXSkpKSk7XG4gICAgfTtcblxuICAgIHZhciBzY2hlbWEkaSA9IGNvbnN0YW50KFtcbiAgICAgIGRlZmF1bHRlZCQxKCdmaWVsZDFOYW1lJywgJ2ZpZWxkMScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2ZpZWxkMk5hbWUnLCAnZmllbGQyJyksXG4gICAgICBvblN0cmljdEhhbmRsZXIoJ29uTG9ja2VkQ2hhbmdlJyksXG4gICAgICBtYXJrZXJzKFsnbG9ja0NsYXNzJ10pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2xvY2tlZCcsIGZhbHNlKSxcbiAgICAgIFNrZXRjaEJlaGF2aW91cnMuZmllbGQoJ2NvdXBsZWRGaWVsZEJlaGF2aW91cnMnLCBbXG4gICAgICAgIENvbXBvc2luZyxcbiAgICAgICAgUmVwcmVzZW50aW5nXG4gICAgICBdKVxuICAgIF0pO1xuICAgIHZhciBnZXRGaWVsZCA9IGZ1bmN0aW9uIChjb21wLCBkZXRhaWwsIHBhcnROYW1lKSB7XG4gICAgICByZXR1cm4gZ2V0UGFydChjb21wLCBkZXRhaWwsIHBhcnROYW1lKS5iaW5kKENvbXBvc2luZy5nZXRDdXJyZW50KTtcbiAgICB9O1xuICAgIHZhciBjb3VwbGVkUGFydCA9IGZ1bmN0aW9uIChzZWxmTmFtZSwgb3RoZXJOYW1lKSB7XG4gICAgICByZXR1cm4gcmVxdWlyZWQoe1xuICAgICAgICBmYWN0b3J5OiBGb3JtRmllbGQsXG4gICAgICAgIG5hbWU6IHNlbGZOYW1lLFxuICAgICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRCZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdjb3VwbGVkLWlucHV0LWJlaGF2aW91cicsIFtydW4oaW5wdXQoKSwgZnVuY3Rpb24gKG1lKSB7XG4gICAgICAgICAgICAgICAgICBnZXRGaWVsZChtZSwgZGV0YWlsLCBvdGhlck5hbWUpLmVhY2goZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGdldFBhcnQobWUsIGRldGFpbCwgJ2xvY2snKS5lYWNoKGZ1bmN0aW9uIChsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKFRvZ2dsaW5nLmlzT24obG9jaykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbC5vbkxvY2tlZENoYW5nZShtZSwgb3RoZXIsIGxvY2spO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KV0pXSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwYXJ0cyQ1ID0gY29uc3RhbnQoW1xuICAgICAgY291cGxlZFBhcnQoJ2ZpZWxkMScsICdmaWVsZDInKSxcbiAgICAgIGNvdXBsZWRQYXJ0KCdmaWVsZDInLCAnZmllbGQxJyksXG4gICAgICByZXF1aXJlZCh7XG4gICAgICAgIGZhY3Rvcnk6IEJ1dHRvbixcbiAgICAgICAgc2NoZW1hOiBbc3RyaWN0JDEoJ2RvbScpXSxcbiAgICAgICAgbmFtZTogJ2xvY2snLFxuICAgICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW1RvZ2dsaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRldGFpbC5sb2NrZWQsXG4gICAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3M6IGRldGFpbC5tYXJrZXJzLmxvY2tDbGFzcyxcbiAgICAgICAgICAgICAgICBhcmlhOiB7IG1vZGU6ICdwcmVzc2VkJyB9XG4gICAgICAgICAgICAgIH0pXSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIF0pO1xuXG4gICAgdmFyIGZhY3RvcnkkNyA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMsIF9zcGVjLCBfZXh0ZXJuYWxzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcbiAgICAgICAgYmVoYXZpb3VyczogU2tldGNoQmVoYXZpb3Vycy5hdWdtZW50KGRldGFpbC5jb3VwbGVkRmllbGRCZWhhdmlvdXJzLCBbXG4gICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7IGZpbmQ6IE9wdGlvbmFsLnNvbWUgfSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIHZhciBwYXJ0cyA9IGdldFBhcnRzT3JEaWUoY29tcCwgZGV0YWlsLCBbXG4gICAgICAgICAgICAgICAgICAnZmllbGQxJyxcbiAgICAgICAgICAgICAgICAgICdmaWVsZDInXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hID0ge30sIF9hW2RldGFpbC5maWVsZDFOYW1lXSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShwYXJ0cy5maWVsZDEoKSksIF9hW2RldGFpbC5maWVsZDJOYW1lXSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShwYXJ0cy5maWVsZDIoKSksIF9hO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gKGNvbXAsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcnRzID0gZ2V0UGFydHNPckRpZShjb21wLCBkZXRhaWwsIFtcbiAgICAgICAgICAgICAgICAgICdmaWVsZDEnLFxuICAgICAgICAgICAgICAgICAgJ2ZpZWxkMidcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFzTm9uTnVsbGFibGVLZXkodmFsdWUsIGRldGFpbC5maWVsZDFOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKHBhcnRzLmZpZWxkMSgpLCB2YWx1ZVtkZXRhaWwuZmllbGQxTmFtZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaGFzTm9uTnVsbGFibGVLZXkodmFsdWUsIGRldGFpbC5maWVsZDJOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKHBhcnRzLmZpZWxkMigpLCB2YWx1ZVtkZXRhaWwuZmllbGQyTmFtZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pLFxuICAgICAgICBhcGlzOiB7XG4gICAgICAgICAgZ2V0RmllbGQxOiBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0UGFydChjb21wb25lbnQsIGRldGFpbCwgJ2ZpZWxkMScpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0RmllbGQyOiBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0UGFydChjb21wb25lbnQsIGRldGFpbCwgJ2ZpZWxkMicpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0TG9jazogZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFBhcnQoY29tcG9uZW50LCBkZXRhaWwsICdsb2NrJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIEZvcm1Db3VwbGVkSW5wdXRzID0gY29tcG9zaXRlJDEoe1xuICAgICAgbmFtZTogJ0Zvcm1Db3VwbGVkSW5wdXRzJyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogc2NoZW1hJGkoKSxcbiAgICAgIHBhcnRGaWVsZHM6IHBhcnRzJDUoKSxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnkkNyxcbiAgICAgIGFwaXM6IHtcbiAgICAgICAgZ2V0RmllbGQxOiBmdW5jdGlvbiAoYXBpcywgY29tcG9uZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuZ2V0RmllbGQxKGNvbXBvbmVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEZpZWxkMjogZnVuY3Rpb24gKGFwaXMsIGNvbXBvbmVudCkge1xuICAgICAgICAgIHJldHVybiBhcGlzLmdldEZpZWxkMihjb21wb25lbnQpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRMb2NrOiBmdW5jdGlvbiAoYXBpcywgY29tcG9uZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuZ2V0TG9jayhjb21wb25lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgZm9ybWF0U2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICB2YXIgdW5pdERlYyA9IHtcbiAgICAgICAgJyc6IDAsXG4gICAgICAgICdweCc6IDAsXG4gICAgICAgICdwdCc6IDEsXG4gICAgICAgICdtbSc6IDEsXG4gICAgICAgICdwYyc6IDIsXG4gICAgICAgICdleCc6IDIsXG4gICAgICAgICdlbSc6IDIsXG4gICAgICAgICdjaCc6IDIsXG4gICAgICAgICdyZW0nOiAyLFxuICAgICAgICAnY20nOiAzLFxuICAgICAgICAnaW4nOiA0LFxuICAgICAgICAnJSc6IDRcbiAgICAgIH07XG4gICAgICB2YXIgbWF4RGVjaW1hbCA9IGZ1bmN0aW9uICh1bml0KSB7XG4gICAgICAgIHJldHVybiB1bml0IGluIHVuaXREZWMgPyB1bml0RGVjW3VuaXRdIDogMTtcbiAgICAgIH07XG4gICAgICB2YXIgbnVtVGV4dCA9IHNpemUudmFsdWUudG9GaXhlZChtYXhEZWNpbWFsKHNpemUudW5pdCkpO1xuICAgICAgaWYgKG51bVRleHQuaW5kZXhPZignLicpICE9PSAtMSkge1xuICAgICAgICBudW1UZXh0ID0gbnVtVGV4dC5yZXBsYWNlKC9cXC4/MCokLywgJycpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bVRleHQgKyBzaXplLnVuaXQ7XG4gICAgfTtcbiAgICB2YXIgcGFyc2VTaXplID0gZnVuY3Rpb24gKHNpemVUZXh0KSB7XG4gICAgICB2YXIgbnVtUGF0dGVybiA9IC9eXFxzKihcXGQrKD86XFwuXFxkKyk/KVxccyoofGNtfG1tfGlufHB4fHB0fHBjfGVtfGV4fGNofHJlbXx2d3x2aHx2bWlufHZtYXh8JSlcXHMqJC87XG4gICAgICB2YXIgbWF0Y2ggPSBudW1QYXR0ZXJuLmV4ZWMoc2l6ZVRleHQpO1xuICAgICAgaWYgKG1hdGNoICE9PSBudWxsKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlRmxvYXQobWF0Y2hbMV0pO1xuICAgICAgICB2YXIgdW5pdCA9IG1hdGNoWzJdO1xuICAgICAgICByZXR1cm4gUmVzdWx0LnZhbHVlKHtcbiAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgdW5pdDogdW5pdFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZXJyb3Ioc2l6ZVRleHQpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNvbnZlcnRVbml0ID0gZnVuY3Rpb24gKHNpemUsIHVuaXQpIHtcbiAgICAgIHZhciBpbkluY2ggPSB7XG4gICAgICAgICcnOiA5NixcbiAgICAgICAgJ3B4JzogOTYsXG4gICAgICAgICdwdCc6IDcyLFxuICAgICAgICAnY20nOiAyLjU0LFxuICAgICAgICAncGMnOiAxMixcbiAgICAgICAgJ21tJzogMjUuNCxcbiAgICAgICAgJ2luJzogMVxuICAgICAgfTtcbiAgICAgIHZhciBzdXBwb3J0ZWQgPSBmdW5jdGlvbiAodSkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGluSW5jaCwgdSk7XG4gICAgICB9O1xuICAgICAgaWYgKHNpemUudW5pdCA9PT0gdW5pdCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShzaXplLnZhbHVlKTtcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydGVkKHNpemUudW5pdCkgJiYgc3VwcG9ydGVkKHVuaXQpKSB7XG4gICAgICAgIGlmIChpbkluY2hbc2l6ZS51bml0XSA9PT0gaW5JbmNoW3VuaXRdKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoc2l6ZS52YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoc2l6ZS52YWx1ZSAvIGluSW5jaFtzaXplLnVuaXRdICogaW5JbmNoW3VuaXRdKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBub1NpemVDb252ZXJzaW9uID0gZnVuY3Rpb24gKF9pbnB1dCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciByYXRpb1NpemVDb252ZXJzaW9uID0gZnVuY3Rpb24gKHNjYWxlLCB1bml0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNpemUpIHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRVbml0KHNpemUsIHVuaXQpLm1hcChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlICogc2NhbGUsXG4gICAgICAgICAgICB1bml0OiB1bml0XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1ha2VSYXRpb0NvbnZlcnRlciA9IGZ1bmN0aW9uIChjdXJyZW50RmllbGRUZXh0LCBvdGhlckZpZWxkVGV4dCkge1xuICAgICAgdmFyIGNWYWx1ZSA9IHBhcnNlU2l6ZShjdXJyZW50RmllbGRUZXh0KS50b09wdGlvbmFsKCk7XG4gICAgICB2YXIgb1ZhbHVlID0gcGFyc2VTaXplKG90aGVyRmllbGRUZXh0KS50b09wdGlvbmFsKCk7XG4gICAgICByZXR1cm4gbGlmdDIoY1ZhbHVlLCBvVmFsdWUsIGZ1bmN0aW9uIChjU2l6ZSwgb1NpemUpIHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRVbml0KGNTaXplLCBvU2l6ZS51bml0KS5tYXAoZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgIHJldHVybiBvU2l6ZS52YWx1ZSAvIHZhbDtcbiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgcmV0dXJuIHJhdGlvU2l6ZUNvbnZlcnNpb24ociwgb1NpemUudW5pdCk7XG4gICAgICAgIH0pLmdldE9yKG5vU2l6ZUNvbnZlcnNpb24pO1xuICAgICAgfSkuZ2V0T3Iobm9TaXplQ29udmVyc2lvbik7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJTaXplSW5wdXQgPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgY29udmVydGVyID0gbm9TaXplQ29udmVyc2lvbjtcbiAgICAgIHZhciByYXRpb0V2ZW50ID0gZ2VuZXJhdGUkMSgncmF0aW8tZXZlbnQnKTtcbiAgICAgIHZhciBwTG9jayA9IEZvcm1Db3VwbGVkSW5wdXRzLnBhcnRzLmxvY2soe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICd0b3gtbG9jaycsXG4gICAgICAgICAgICAndG94LWJ1dHRvbicsXG4gICAgICAgICAgICAndG94LWJ1dHRvbi0tbmFrZWQnLFxuICAgICAgICAgICAgJ3RveC1idXR0b24tLWljb24nXG4gICAgICAgICAgXSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHRpdGxlOiBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKHNwZWMubGFiZWwuZ2V0T3IoJ0NvbnN0cmFpbiBwcm9wb3J0aW9ucycpKSB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICAgICAndG94LWljb24nLFxuICAgICAgICAgICAgICAgICd0b3gtbG9jay1pY29uX19sb2NrJ1xuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCdsb2NrJywgcHJvdmlkZXJzQmFja3N0YWdlLmljb25zKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAgICAgJ3RveC1pY29uJyxcbiAgICAgICAgICAgICAgICAndG94LWxvY2staWNvbl9fdW5sb2NrJ1xuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCd1bmxvY2snLCBwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgRGlzYWJsaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gc3BlYy5kaXNhYmxlZCB8fCBwcm92aWRlcnNCYWNrc3RhZ2UuaXNEaXNhYmxlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICAgIFRhYnN0b3BwaW5nLmNvbmZpZyh7fSlcbiAgICAgICAgXSlcbiAgICAgIH0pO1xuICAgICAgdmFyIGZvcm1Hcm91cCA9IGZ1bmN0aW9uIChjb21wb25lbnRzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZm9ybV9fZ3JvdXAnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50c1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRGaWVsZFBhcnQgPSBmdW5jdGlvbiAoaXNGaWVsZDEpIHtcbiAgICAgICAgcmV0dXJuIEZvcm1GaWVsZC5wYXJ0cy5maWVsZCh7XG4gICAgICAgICAgZmFjdG9yeTogSW5wdXQsXG4gICAgICAgICAgaW5wdXRDbGFzc2VzOiBbJ3RveC10ZXh0ZmllbGQnXSxcbiAgICAgICAgICBpbnB1dEJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICAgIERpc2FibGluZy5jb25maWcoe1xuICAgICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcmVjZWl2aW5nQ29uZmlnKCksXG4gICAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgICAgY29uZmlnKCdzaXplLWlucHV0LWV2ZW50cycsIFtcbiAgICAgICAgICAgICAgcnVuKGZvY3VzaW4oKSwgZnVuY3Rpb24gKGNvbXBvbmVudCwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcG9uZW50LCByYXRpb0V2ZW50LCB7IGlzRmllbGQxOiBpc0ZpZWxkMSB9KTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHJ1bihjaGFuZ2UoKSwgZnVuY3Rpb24gKGNvbXBvbmVudCwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcG9uZW50LCBmb3JtQ2hhbmdlRXZlbnQsIHsgbmFtZTogc3BlYy5uYW1lIH0pO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSlcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBzZWxlY3RPbkZvY3VzOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0TGFiZWwgPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2xhYmVsJyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWxhYmVsJ10sXG4gICAgICAgICAgICBpbm5lckh0bWw6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUobGFiZWwpXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciB3aWR0aEZpZWxkID0gRm9ybUNvdXBsZWRJbnB1dHMucGFydHMuZmllbGQxKGZvcm1Hcm91cChbXG4gICAgICAgIEZvcm1GaWVsZC5wYXJ0cy5sYWJlbChnZXRMYWJlbCgnV2lkdGgnKSksXG4gICAgICAgIGdldEZpZWxkUGFydCh0cnVlKVxuICAgICAgXSkpO1xuICAgICAgdmFyIGhlaWdodEZpZWxkID0gRm9ybUNvdXBsZWRJbnB1dHMucGFydHMuZmllbGQyKGZvcm1Hcm91cChbXG4gICAgICAgIEZvcm1GaWVsZC5wYXJ0cy5sYWJlbChnZXRMYWJlbCgnSGVpZ2h0JykpLFxuICAgICAgICBnZXRGaWVsZFBhcnQoZmFsc2UpXG4gICAgICBdKSk7XG4gICAgICByZXR1cm4gRm9ybUNvdXBsZWRJbnB1dHMuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtX19ncm91cCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZm9ybV9fY29udHJvbHMtaC1zdGFjayddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgICAgICB3aWR0aEZpZWxkLFxuICAgICAgICAgICAgICBoZWlnaHRGaWVsZCxcbiAgICAgICAgICAgICAgZm9ybUdyb3VwKFtcbiAgICAgICAgICAgICAgICBnZXRMYWJlbCgnJm5ic3A7JyksXG4gICAgICAgICAgICAgICAgcExvY2tcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XSxcbiAgICAgICAgZmllbGQxTmFtZTogJ3dpZHRoJyxcbiAgICAgICAgZmllbGQyTmFtZTogJ2hlaWdodCcsXG4gICAgICAgIGxvY2tlZDogdHJ1ZSxcbiAgICAgICAgbWFya2VyczogeyBsb2NrQ2xhc3M6ICd0b3gtbG9ja2VkJyB9LFxuICAgICAgICBvbkxvY2tlZENoYW5nZTogZnVuY3Rpb24gKGN1cnJlbnQsIG90aGVyLCBfbG9jaykge1xuICAgICAgICAgIHBhcnNlU2l6ZShSZXByZXNlbnRpbmcuZ2V0VmFsdWUoY3VycmVudCkpLmVhY2goZnVuY3Rpb24gKHNpemUpIHtcbiAgICAgICAgICAgIGNvbnZlcnRlcihzaXplKS5lYWNoKGZ1bmN0aW9uIChuZXdTaXplKSB7XG4gICAgICAgICAgICAgIFJlcHJlc2VudGluZy5zZXRWYWx1ZShvdGhlciwgZm9ybWF0U2l6ZShuZXdTaXplKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgY291cGxlZEZpZWxkQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIERpc2FibGluZy5jb25maWcoe1xuICAgICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNwZWMuZGlzYWJsZWQgfHwgcHJvdmlkZXJzQmFja3N0YWdlLmlzRGlzYWJsZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkRpc2FibGVkOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICBGb3JtQ291cGxlZElucHV0cy5nZXRGaWVsZDEoY29tcCkuYmluZChGb3JtRmllbGQuZ2V0RmllbGQpLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgICBGb3JtQ291cGxlZElucHV0cy5nZXRGaWVsZDIoY29tcCkuYmluZChGb3JtRmllbGQuZ2V0RmllbGQpLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgICBGb3JtQ291cGxlZElucHV0cy5nZXRMb2NrKGNvbXApLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUNvdXBsZWRJbnB1dHMuZ2V0RmllbGQxKGNvbXApLmJpbmQoRm9ybUZpZWxkLmdldEZpZWxkKS5lYWNoKERpc2FibGluZy5lbmFibGUpO1xuICAgICAgICAgICAgICBGb3JtQ291cGxlZElucHV0cy5nZXRGaWVsZDIoY29tcCkuYmluZChGb3JtRmllbGQuZ2V0RmllbGQpLmVhY2goRGlzYWJsaW5nLmVuYWJsZSk7XG4gICAgICAgICAgICAgIEZvcm1Db3VwbGVkSW5wdXRzLmdldExvY2soY29tcCkuZWFjaChEaXNhYmxpbmcuZW5hYmxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICByZWNlaXZpbmdDb25maWcoKSxcbiAgICAgICAgICBjb25maWcoJ3NpemUtaW5wdXQtZXZlbnRzMicsIFtydW4ocmF0aW9FdmVudCwgZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgICAgdmFyIGlzRmllbGQxID0gc2ltdWxhdGVkRXZlbnQuZXZlbnQuaXNGaWVsZDE7XG4gICAgICAgICAgICAgIHZhciBvcHRDdXJyZW50ID0gaXNGaWVsZDEgPyBGb3JtQ291cGxlZElucHV0cy5nZXRGaWVsZDEoY29tcG9uZW50KSA6IEZvcm1Db3VwbGVkSW5wdXRzLmdldEZpZWxkMihjb21wb25lbnQpO1xuICAgICAgICAgICAgICB2YXIgb3B0T3RoZXIgPSBpc0ZpZWxkMSA/IEZvcm1Db3VwbGVkSW5wdXRzLmdldEZpZWxkMihjb21wb25lbnQpIDogRm9ybUNvdXBsZWRJbnB1dHMuZ2V0RmllbGQxKGNvbXBvbmVudCk7XG4gICAgICAgICAgICAgIHZhciB2YWx1ZTEgPSBvcHRDdXJyZW50Lm1hcChSZXByZXNlbnRpbmcuZ2V0VmFsdWUpLmdldE9yKCcnKTtcbiAgICAgICAgICAgICAgdmFyIHZhbHVlMiA9IG9wdE90aGVyLm1hcChSZXByZXNlbnRpbmcuZ2V0VmFsdWUpLmdldE9yKCcnKTtcbiAgICAgICAgICAgICAgY29udmVydGVyID0gbWFrZVJhdGlvQ29udmVydGVyKHZhbHVlMSwgdmFsdWUyKTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgXSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgdW5kbyA9IGNvbnN0YW50KGdlbmVyYXRlJDEoJ3VuZG8nKSk7XG4gICAgdmFyIHJlZG8gPSBjb25zdGFudChnZW5lcmF0ZSQxKCdyZWRvJykpO1xuICAgIHZhciB6b29tID0gY29uc3RhbnQoZ2VuZXJhdGUkMSgnem9vbScpKTtcbiAgICB2YXIgYmFjayA9IGNvbnN0YW50KGdlbmVyYXRlJDEoJ2JhY2snKSk7XG4gICAgdmFyIGFwcGx5ID0gY29uc3RhbnQoZ2VuZXJhdGUkMSgnYXBwbHknKSk7XG4gICAgdmFyIHN3YXAgPSBjb25zdGFudChnZW5lcmF0ZSQxKCdzd2FwJykpO1xuICAgIHZhciB0cmFuc2Zvcm0gPSBjb25zdGFudChnZW5lcmF0ZSQxKCd0cmFuc2Zvcm0nKSk7XG4gICAgdmFyIHRlbXBUcmFuc2Zvcm0gPSBjb25zdGFudChnZW5lcmF0ZSQxKCd0ZW1wLXRyYW5zZm9ybScpKTtcbiAgICB2YXIgdHJhbnNmb3JtQXBwbHkgPSBjb25zdGFudChnZW5lcmF0ZSQxKCd0cmFuc2Zvcm0tYXBwbHknKSk7XG4gICAgdmFyIGludGVybmFsID0ge1xuICAgICAgdW5kbzogdW5kbyxcbiAgICAgIHJlZG86IHJlZG8sXG4gICAgICB6b29tOiB6b29tLFxuICAgICAgYmFjazogYmFjayxcbiAgICAgIGFwcGx5OiBhcHBseSxcbiAgICAgIHN3YXA6IHN3YXAsXG4gICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybSxcbiAgICAgIHRlbXBUcmFuc2Zvcm06IHRlbXBUcmFuc2Zvcm0sXG4gICAgICB0cmFuc2Zvcm1BcHBseTogdHJhbnNmb3JtQXBwbHlcbiAgICB9O1xuICAgIHZhciBzYXZlU3RhdGUgPSBjb25zdGFudCgnc2F2ZS1zdGF0ZScpO1xuICAgIHZhciBkaXNhYmxlJDEgPSBjb25zdGFudCgnZGlzYWJsZScpO1xuICAgIHZhciBlbmFibGUkMSA9IGNvbnN0YW50KCdlbmFibGUnKTtcbiAgICB2YXIgZXh0ZXJuYWwkMiA9IHtcbiAgICAgIGZvcm1BY3Rpb25FdmVudDogZm9ybUFjdGlvbkV2ZW50LFxuICAgICAgc2F2ZVN0YXRlOiBzYXZlU3RhdGUsXG4gICAgICBkaXNhYmxlOiBkaXNhYmxlJDEsXG4gICAgICBlbmFibGU6IGVuYWJsZSQxXG4gICAgfTtcblxuICAgIHZhciByZW5kZXJFZGl0UGFuZWwgPSBmdW5jdGlvbiAoaW1hZ2VQYW5lbCwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgY3JlYXRlQnV0dG9uID0gZnVuY3Rpb24gKHRleHQsIGFjdGlvbiwgZGlzYWJsZWQsIHByaW1hcnkpIHtcbiAgICAgICAgcmV0dXJuIHJlY29yZChyZW5kZXJCdXR0b24oe1xuICAgICAgICAgIG5hbWU6IHRleHQsXG4gICAgICAgICAgdGV4dDogdGV4dCxcbiAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgICAgcHJpbWFyeTogcHJpbWFyeSxcbiAgICAgICAgICBpY29uOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgICAgYm9yZGVybGVzczogZmFsc2VcbiAgICAgICAgfSwgYWN0aW9uLCBwcm92aWRlcnNCYWNrc3RhZ2UpKTtcbiAgICAgIH07XG4gICAgICB2YXIgY3JlYXRlSWNvbkJ1dHRvbiA9IGZ1bmN0aW9uIChpY29uLCB0b29sdGlwLCBhY3Rpb24sIGRpc2FibGVkKSB7XG4gICAgICAgIHJldHVybiByZWNvcmQocmVuZGVySWNvbkJ1dHRvbih7XG4gICAgICAgICAgbmFtZTogaWNvbixcbiAgICAgICAgICBpY29uOiBPcHRpb25hbC5zb21lKGljb24pLFxuICAgICAgICAgIHRvb2x0aXA6IE9wdGlvbmFsLnNvbWUodG9vbHRpcCksXG4gICAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkLFxuICAgICAgICAgIHByaW1hcnk6IGZhbHNlLFxuICAgICAgICAgIGJvcmRlcmxlc3M6IGZhbHNlXG4gICAgICAgIH0sIGFjdGlvbiwgcHJvdmlkZXJzQmFja3N0YWdlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGRpc2FibGVBbGxDb21wb25lbnRzID0gZnVuY3Rpb24gKGNvbXBzLCBldmVudGNvbXApIHtcbiAgICAgICAgY29tcHMubWFwKGZ1bmN0aW9uIChtZW0pIHtcbiAgICAgICAgICB2YXIgY29tcG9uZW50ID0gbWVtLmdldChldmVudGNvbXApO1xuICAgICAgICAgIGlmIChjb21wb25lbnQuaGFzQ29uZmlndXJlZChEaXNhYmxpbmcpKSB7XG4gICAgICAgICAgICBEaXNhYmxpbmcuZGlzYWJsZShjb21wb25lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGVuYWJsZUFsbENvbXBvbmVudHMgPSBmdW5jdGlvbiAoY29tcHMsIGV2ZW50Y29tcCkge1xuICAgICAgICBjb21wcy5tYXAoZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgIHZhciBjb21wb25lbnQgPSBtZW0uZ2V0KGV2ZW50Y29tcCk7XG4gICAgICAgICAgaWYgKGNvbXBvbmVudC5oYXNDb25maWd1cmVkKERpc2FibGluZykpIHtcbiAgICAgICAgICAgIERpc2FibGluZy5lbmFibGUoY29tcG9uZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBwYW5lbERvbSA9IHtcbiAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICd0b3gtaW1hZ2UtdG9vbHNfX3Rvb2xiYXInLFxuICAgICAgICAgICd0b3gtaW1hZ2UtdG9vbHMtZWRpdC1wYW5lbCdcbiAgICAgICAgXVxuICAgICAgfTtcbiAgICAgIHZhciBub29wJDEgPSBub29wO1xuICAgICAgdmFyIGVtaXQkMSA9IGZ1bmN0aW9uIChjb21wLCBldmVudCwgZGF0YSkge1xuICAgICAgICBlbWl0V2l0aChjb21wLCBldmVudCwgZGF0YSk7XG4gICAgICB9O1xuICAgICAgdmFyIGVtaXREaXNhYmxlID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICByZXR1cm4gZW1pdChjb21wb25lbnQsIGV4dGVybmFsJDIuZGlzYWJsZSgpKTtcbiAgICAgIH07XG4gICAgICB2YXIgZW1pdEVuYWJsZSA9IGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVtaXQoY29tcG9uZW50LCBleHRlcm5hbCQyLmVuYWJsZSgpKTtcbiAgICAgIH07XG4gICAgICB2YXIgZW1pdFRyYW5zZm9ybSA9IGZ1bmN0aW9uIChjb21wLCB0cmFuc2Zvcm0pIHtcbiAgICAgICAgZW1pdERpc2FibGUoY29tcCk7XG4gICAgICAgIGVtaXQkMShjb21wLCBpbnRlcm5hbC50cmFuc2Zvcm0oKSwgeyB0cmFuc2Zvcm06IHRyYW5zZm9ybSB9KTtcbiAgICAgICAgZW1pdEVuYWJsZShjb21wKTtcbiAgICAgIH07XG4gICAgICB2YXIgZW1pdFRlbXBUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoY29tcCwgdHJhbnNmb3JtKSB7XG4gICAgICAgIGVtaXREaXNhYmxlKGNvbXApO1xuICAgICAgICBlbWl0JDEoY29tcCwgaW50ZXJuYWwudGVtcFRyYW5zZm9ybSgpLCB7IHRyYW5zZm9ybTogdHJhbnNmb3JtIH0pO1xuICAgICAgICBlbWl0RW5hYmxlKGNvbXApO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRCYWNrU3dhcCA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG1lbUNvbnRhaW5lci5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgUmVwbGFjaW5nLnNldChjb250YWluZXIsIFtCdXR0b25QYW5lbF0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBlbWl0VHJhbnNmb3JtQXBwbHkgPSBmdW5jdGlvbiAoY29tcCwgdHJhbnNmb3JtKSB7XG4gICAgICAgIGVtaXREaXNhYmxlKGNvbXApO1xuICAgICAgICBlbWl0JDEoY29tcCwgaW50ZXJuYWwudHJhbnNmb3JtQXBwbHkoKSwge1xuICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgICAgICAgIHN3YXA6IGdldEJhY2tTd2FwKGNvbXApXG4gICAgICAgIH0pO1xuICAgICAgICBlbWl0RW5hYmxlKGNvbXApO1xuICAgICAgfTtcbiAgICAgIHZhciBjcmVhdGVCYWNrQnV0dG9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlQnV0dG9uKCdCYWNrJywgZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICAgIHJldHVybiBlbWl0JDEoYnV0dG9uLCBpbnRlcm5hbC5iYWNrKCksIHsgc3dhcDogZ2V0QmFja1N3YXAoYnV0dG9uKSB9KTtcbiAgICAgICAgfSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH07XG4gICAgICB2YXIgY3JlYXRlU3BhY2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVjb3JkKHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1zcGFjZXInXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW0Rpc2FibGluZy5jb25maWcoe30pXSlcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNyZWF0ZUFwcGx5QnV0dG9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlQnV0dG9uKCdBcHBseScsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICByZXR1cm4gZW1pdCQxKGJ1dHRvbiwgaW50ZXJuYWwuYXBwbHkoKSwgeyBzd2FwOiBnZXRCYWNrU3dhcChidXR0b24pIH0pO1xuICAgICAgICB9LCB0cnVlLCB0cnVlKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFrZUNyb3BUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoaXIpIHtcbiAgICAgICAgICB2YXIgcmVjdCA9IGltYWdlUGFuZWwuZ2V0UmVjdCgpO1xuICAgICAgICAgIHJldHVybiBjcm9wJDEoaXIsIHJlY3QueCwgcmVjdC55LCByZWN0LncsIHJlY3QuaCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGNyb3BQYW5lbENvbXBvbmVudHMgPSBbXG4gICAgICAgIGNyZWF0ZUJhY2tCdXR0b24oKSxcbiAgICAgICAgY3JlYXRlU3BhY2VyKCksXG4gICAgICAgIGNyZWF0ZUJ1dHRvbignQXBwbHknLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgdmFyIHRyYW5zZm9ybSA9IG1ha2VDcm9wVHJhbnNmb3JtKCk7XG4gICAgICAgICAgZW1pdFRyYW5zZm9ybUFwcGx5KGJ1dHRvbiwgdHJhbnNmb3JtKTtcbiAgICAgICAgICBpbWFnZVBhbmVsLmhpZGVDcm9wKCk7XG4gICAgICAgIH0sIGZhbHNlLCB0cnVlKVxuICAgICAgXTtcbiAgICAgIHZhciBDcm9wUGFuZWwgPSBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiBwYW5lbERvbSxcbiAgICAgICAgY29tcG9uZW50czogY3JvcFBhbmVsQ29tcG9uZW50cy5tYXAoZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgIHJldHVybiBtZW0uYXNTcGVjKCk7XG4gICAgICAgIH0pLFxuICAgICAgICBjb250YWluZXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdpbWFnZS10b29scy1jcm9wLWJ1dHRvbnMtZXZlbnRzJywgW1xuICAgICAgICAgICAgcnVuKGV4dGVybmFsJDIuZGlzYWJsZSgpLCBmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgIGRpc2FibGVBbGxDb21wb25lbnRzKGNyb3BQYW5lbENvbXBvbmVudHMsIGNvbXApO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydW4oZXh0ZXJuYWwkMi5lbmFibGUoKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBlbmFibGVBbGxDb21wb25lbnRzKGNyb3BQYW5lbENvbXBvbmVudHMsIGNvbXApO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKV0pXG4gICAgICB9KTtcbiAgICAgIHZhciBtZW1TaXplID0gcmVjb3JkKHJlbmRlclNpemVJbnB1dCh7XG4gICAgICAgIG5hbWU6ICdzaXplJyxcbiAgICAgICAgbGFiZWw6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgY29uc3RyYWluOiB0cnVlLFxuICAgICAgICBkaXNhYmxlZDogZmFsc2VcbiAgICAgIH0sIHByb3ZpZGVyc0JhY2tzdGFnZSkpO1xuICAgICAgdmFyIG1ha2VSZXNpemVUcmFuc2Zvcm0gPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGlyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc2l6ZSQyKGlyLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVzaXplUGFuZWxDb21wb25lbnRzID0gW1xuICAgICAgICBjcmVhdGVCYWNrQnV0dG9uKCksXG4gICAgICAgIGNyZWF0ZVNwYWNlcigpLFxuICAgICAgICBtZW1TaXplLFxuICAgICAgICBjcmVhdGVTcGFjZXIoKSxcbiAgICAgICAgY3JlYXRlQnV0dG9uKCdBcHBseScsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICBtZW1TaXplLmdldE9wdChidXR0b24pLmVhY2goZnVuY3Rpb24gKHNpemVJbnB1dCkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKHNpemVJbnB1dCk7XG4gICAgICAgICAgICB2YXIgd2lkdGggPSBwYXJzZUludCh2YWx1ZS53aWR0aCwgMTApO1xuICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KHZhbHVlLmhlaWdodCwgMTApO1xuICAgICAgICAgICAgdmFyIHRyYW5zZm9ybSA9IG1ha2VSZXNpemVUcmFuc2Zvcm0od2lkdGgsIGhlaWdodCk7XG4gICAgICAgICAgICBlbWl0VHJhbnNmb3JtQXBwbHkoYnV0dG9uLCB0cmFuc2Zvcm0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmYWxzZSwgdHJ1ZSlcbiAgICAgIF07XG4gICAgICB2YXIgUmVzaXplUGFuZWwgPSBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiBwYW5lbERvbSxcbiAgICAgICAgY29tcG9uZW50czogcmVzaXplUGFuZWxDb21wb25lbnRzLm1hcChmdW5jdGlvbiAobWVtKSB7XG4gICAgICAgICAgcmV0dXJuIG1lbS5hc1NwZWMoKTtcbiAgICAgICAgfSksXG4gICAgICAgIGNvbnRhaW5lckJlaGF2aW91cnM6IGRlcml2ZSQxKFtjb25maWcoJ2ltYWdlLXRvb2xzLXJlc2l6ZS1idXR0b25zLWV2ZW50cycsIFtcbiAgICAgICAgICAgIHJ1bihleHRlcm5hbCQyLmRpc2FibGUoKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBkaXNhYmxlQWxsQ29tcG9uZW50cyhyZXNpemVQYW5lbENvbXBvbmVudHMsIGNvbXApO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydW4oZXh0ZXJuYWwkMi5lbmFibGUoKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBlbmFibGVBbGxDb21wb25lbnRzKHJlc2l6ZVBhbmVsQ29tcG9uZW50cywgY29tcCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF0pXSlcbiAgICAgIH0pO1xuICAgICAgdmFyIG1ha2VWYWx1ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0cmFuc2Zvcm0sIHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoaXIpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtKGlyLCB2YWx1ZSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGhvcml6b250YWxGbGlwID0gbWFrZVZhbHVlVHJhbnNmb3JtKGZsaXAkMSwgJ2gnKTtcbiAgICAgIHZhciB2ZXJ0aWNhbEZsaXAgPSBtYWtlVmFsdWVUcmFuc2Zvcm0oZmxpcCQxLCAndicpO1xuICAgICAgdmFyIGNvdW50ZXJjbG9ja3dpc2VSb3RhdGUgPSBtYWtlVmFsdWVUcmFuc2Zvcm0ocm90YXRlJDEsIC05MCk7XG4gICAgICB2YXIgY2xvY2t3aXNlUm90YXRlID0gbWFrZVZhbHVlVHJhbnNmb3JtKHJvdGF0ZSQxLCA5MCk7XG4gICAgICB2YXIgZmxpcFJvdGF0ZU9uQWN0aW9uID0gZnVuY3Rpb24gKGNvbXAsIG9wZXJhdGlvbikge1xuICAgICAgICBlbWl0VGVtcFRyYW5zZm9ybShjb21wLCBvcGVyYXRpb24pO1xuICAgICAgfTtcbiAgICAgIHZhciBmbGlwUm90YXRlQ29tcG9uZW50cyA9IFtcbiAgICAgICAgY3JlYXRlQmFja0J1dHRvbigpLFxuICAgICAgICBjcmVhdGVTcGFjZXIoKSxcbiAgICAgICAgY3JlYXRlSWNvbkJ1dHRvbignZmxpcC1ob3Jpem9udGFsbHknLCAnRmxpcCBob3Jpem9udGFsbHknLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgZmxpcFJvdGF0ZU9uQWN0aW9uKGJ1dHRvbiwgaG9yaXpvbnRhbEZsaXApO1xuICAgICAgICB9LCBmYWxzZSksXG4gICAgICAgIGNyZWF0ZUljb25CdXR0b24oJ2ZsaXAtdmVydGljYWxseScsICdGbGlwIHZlcnRpY2FsbHknLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgZmxpcFJvdGF0ZU9uQWN0aW9uKGJ1dHRvbiwgdmVydGljYWxGbGlwKTtcbiAgICAgICAgfSwgZmFsc2UpLFxuICAgICAgICBjcmVhdGVJY29uQnV0dG9uKCdyb3RhdGUtbGVmdCcsICdSb3RhdGUgY291bnRlcmNsb2Nrd2lzZScsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICBmbGlwUm90YXRlT25BY3Rpb24oYnV0dG9uLCBjb3VudGVyY2xvY2t3aXNlUm90YXRlKTtcbiAgICAgICAgfSwgZmFsc2UpLFxuICAgICAgICBjcmVhdGVJY29uQnV0dG9uKCdyb3RhdGUtcmlnaHQnLCAnUm90YXRlIGNsb2Nrd2lzZScsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICBmbGlwUm90YXRlT25BY3Rpb24oYnV0dG9uLCBjbG9ja3dpc2VSb3RhdGUpO1xuICAgICAgICB9LCBmYWxzZSksXG4gICAgICAgIGNyZWF0ZVNwYWNlcigpLFxuICAgICAgICBjcmVhdGVBcHBseUJ1dHRvbigpXG4gICAgICBdO1xuICAgICAgdmFyIEZsaXBSb3RhdGVQYW5lbCA9IENvbnRhaW5lci5za2V0Y2goe1xuICAgICAgICBkb206IHBhbmVsRG9tLFxuICAgICAgICBjb21wb25lbnRzOiBmbGlwUm90YXRlQ29tcG9uZW50cy5tYXAoZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgIHJldHVybiBtZW0uYXNTcGVjKCk7XG4gICAgICAgIH0pLFxuICAgICAgICBjb250YWluZXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdpbWFnZS10b29scy1mbGlwcm90YXRlLWJ1dHRvbnMtZXZlbnRzJywgW1xuICAgICAgICAgICAgcnVuKGV4dGVybmFsJDIuZGlzYWJsZSgpLCBmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgIGRpc2FibGVBbGxDb21wb25lbnRzKGZsaXBSb3RhdGVDb21wb25lbnRzLCBjb21wKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcnVuKGV4dGVybmFsJDIuZW5hYmxlKCksIGZ1bmN0aW9uIChjb21wLCBfc2UpIHtcbiAgICAgICAgICAgICAgZW5hYmxlQWxsQ29tcG9uZW50cyhmbGlwUm90YXRlQ29tcG9uZW50cywgY29tcCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF0pXSlcbiAgICAgIH0pO1xuICAgICAgdmFyIG1ha2VTbGlkZXIgPSBmdW5jdGlvbiAobGFiZWwsIG9uQ2hvb3NlLCBtaW4sIHZhbHVlLCBtYXgpIHtcbiAgICAgICAgdmFyIGxhYmVsUGFydCA9IFNsaWRlci5wYXJ0cy5sYWJlbCh7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdsYWJlbCcsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1sYWJlbCddLFxuICAgICAgICAgICAgaW5uZXJIdG1sOiBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKGxhYmVsKVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBzcGVjdHJ1bSA9IFNsaWRlci5wYXJ0cy5zcGVjdHJ1bSh7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtc2xpZGVyX19yYWlsJ10sXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHJvbGU6ICdwcmVzZW50YXRpb24nIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdGh1bWIgPSBTbGlkZXIucGFydHMudGh1bWIoe1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LXNsaWRlcl9faGFuZGxlJ10sXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHJvbGU6ICdwcmVzZW50YXRpb24nIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVjb3JkKFNsaWRlci5za2V0Y2goe1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LXNsaWRlciddLFxuICAgICAgICAgICAgYXR0cmlidXRlczogeyByb2xlOiAncHJlc2VudGF0aW9uJyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb2RlbDoge1xuICAgICAgICAgICAgbW9kZTogJ3gnLFxuICAgICAgICAgICAgbWluWDogbWluLFxuICAgICAgICAgICAgbWF4WDogbWF4LFxuICAgICAgICAgICAgZ2V0SW5pdGlhbFZhbHVlOiBjb25zdGFudCh7IHg6IHZhbHVlIH0pXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgICBsYWJlbFBhcnQsXG4gICAgICAgICAgICBzcGVjdHJ1bSxcbiAgICAgICAgICAgIHRodW1iXG4gICAgICAgICAgXSxcbiAgICAgICAgICBzbGlkZXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbRm9jdXNpbmcuY29uZmlnKHt9KV0pLFxuICAgICAgICAgIG9uQ2hvb3NlOiBvbkNob29zZVxuICAgICAgICB9KSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1ha2VWYXJpYWJsZVNsaWRlciA9IGZ1bmN0aW9uIChsYWJlbCwgdHJhbnNmb3JtLCBtaW4sIHZhbHVlLCBtYXgpIHtcbiAgICAgICAgdmFyIG9uQ2hvb3NlID0gZnVuY3Rpb24gKHNsaWRlciwgX3RodW1iLCB2YWx1ZSkge1xuICAgICAgICAgIHZhciB2YWxUcmFuc2Zvcm0gPSBtYWtlVmFsdWVUcmFuc2Zvcm0odHJhbnNmb3JtLCB2YWx1ZS54IC8gMTAwKTtcbiAgICAgICAgICBlbWl0VHJhbnNmb3JtKHNsaWRlciwgdmFsVHJhbnNmb3JtKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG1ha2VTbGlkZXIobGFiZWwsIG9uQ2hvb3NlLCBtaW4sIHZhbHVlLCBtYXgpO1xuICAgICAgfTtcbiAgICAgIHZhciB2YXJpYWJsZUZpbHRlclBhbmVsQ29tcG9uZW50cyA9IGZ1bmN0aW9uIChsYWJlbCwgdHJhbnNmb3JtLCBtaW4sIHZhbHVlLCBtYXgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBjcmVhdGVCYWNrQnV0dG9uKCksXG4gICAgICAgICAgbWFrZVZhcmlhYmxlU2xpZGVyKGxhYmVsLCB0cmFuc2Zvcm0sIG1pbiwgdmFsdWUsIG1heCksXG4gICAgICAgICAgY3JlYXRlQXBwbHlCdXR0b24oKVxuICAgICAgICBdO1xuICAgICAgfTtcbiAgICAgIHZhciBjcmVhdGVWYXJpYWJsZUZpbHRlclBhbmVsID0gZnVuY3Rpb24gKGxhYmVsLCB0cmFuc2Zvcm0sIG1pbiwgdmFsdWUsIG1heCkge1xuICAgICAgICB2YXIgZmlsdGVyUGFuZWxDb21wb25lbnRzID0gdmFyaWFibGVGaWx0ZXJQYW5lbENvbXBvbmVudHMobGFiZWwsIHRyYW5zZm9ybSwgbWluLCB2YWx1ZSwgbWF4KTtcbiAgICAgICAgcmV0dXJuIENvbnRhaW5lci5za2V0Y2goe1xuICAgICAgICAgIGRvbTogcGFuZWxEb20sXG4gICAgICAgICAgY29tcG9uZW50czogZmlsdGVyUGFuZWxDb21wb25lbnRzLm1hcChmdW5jdGlvbiAobWVtKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtLmFzU3BlYygpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNvbnRhaW5lckJlaGF2aW91cnM6IGRlcml2ZSQxKFtjb25maWcoJ2ltYWdlLXRvb2xzLWZpbHRlci1wYW5lbC1idXR0b25zLWV2ZW50cycsIFtcbiAgICAgICAgICAgICAgcnVuKGV4dGVybmFsJDIuZGlzYWJsZSgpLCBmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgICAgZGlzYWJsZUFsbENvbXBvbmVudHMoZmlsdGVyUGFuZWxDb21wb25lbnRzLCBjb21wKTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHJ1bihleHRlcm5hbCQyLmVuYWJsZSgpLCBmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgICAgZW5hYmxlQWxsQ29tcG9uZW50cyhmaWx0ZXJQYW5lbENvbXBvbmVudHMsIGNvbXApO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSldKVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZmlsdGVyUGFuZWxDb21wb25lbnRzID0gW1xuICAgICAgICBjcmVhdGVCYWNrQnV0dG9uKCksXG4gICAgICAgIGNyZWF0ZVNwYWNlcigpLFxuICAgICAgICBjcmVhdGVBcHBseUJ1dHRvbigpXG4gICAgICBdO1xuICAgICAgdmFyIEZpbHRlclBhbmVsID0gQ29udGFpbmVyLnNrZXRjaCh7XG4gICAgICAgIGRvbTogcGFuZWxEb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGZpbHRlclBhbmVsQ29tcG9uZW50cy5tYXAoZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgIHJldHVybiBtZW0uYXNTcGVjKCk7XG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICAgIHZhciBCcmlnaHRuZXNzUGFuZWwgPSBjcmVhdGVWYXJpYWJsZUZpbHRlclBhbmVsKCdCcmlnaHRuZXNzJywgYnJpZ2h0bmVzcyQxLCAtMTAwLCAwLCAxMDApO1xuICAgICAgdmFyIENvbnRyYXN0UGFuZWwgPSBjcmVhdGVWYXJpYWJsZUZpbHRlclBhbmVsKCdDb250cmFzdCcsIGNvbnRyYXN0JDEsIC0xMDAsIDAsIDEwMCk7XG4gICAgICB2YXIgR2FtbWFQYW5lbCA9IGNyZWF0ZVZhcmlhYmxlRmlsdGVyUGFuZWwoJ0dhbW1hJywgZ2FtbWEkMSwgLTEwMCwgMCwgMTAwKTtcbiAgICAgIHZhciBtYWtlQ29sb3JUcmFuc2Zvcm0gPSBmdW5jdGlvbiAocmVkLCBncmVlbiwgYmx1ZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGlyKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbG9yaXplJDEoaXIsIHJlZCwgZ3JlZW4sIGJsdWUpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBtYWtlQ29sb3JTbGlkZXIgPSBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgdmFyIG9uQ2hvb3NlID0gZnVuY3Rpb24gKHNsaWRlciwgX3RodW1iLCBfdmFsdWUpIHtcbiAgICAgICAgICB2YXIgcmVkT3B0ID0gbWVtUmVkLmdldE9wdChzbGlkZXIpO1xuICAgICAgICAgIHZhciBibHVlT3B0ID0gbWVtQmx1ZS5nZXRPcHQoc2xpZGVyKTtcbiAgICAgICAgICB2YXIgZ3JlZW5PcHQgPSBtZW1HcmVlbi5nZXRPcHQoc2xpZGVyKTtcbiAgICAgICAgICByZWRPcHQuZWFjaChmdW5jdGlvbiAocmVkKSB7XG4gICAgICAgICAgICBibHVlT3B0LmVhY2goZnVuY3Rpb24gKGJsdWUpIHtcbiAgICAgICAgICAgICAgZ3JlZW5PcHQuZWFjaChmdW5jdGlvbiAoZ3JlZW4pIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShyZWQpLnggLyAxMDA7XG4gICAgICAgICAgICAgICAgdmFyIGcgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoZ3JlZW4pLnggLyAxMDA7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoYmx1ZSkueCAvIDEwMDtcbiAgICAgICAgICAgICAgICB2YXIgdHJhbnNmb3JtID0gbWFrZUNvbG9yVHJhbnNmb3JtKHIsIGcsIGIpO1xuICAgICAgICAgICAgICAgIGVtaXRUcmFuc2Zvcm0oc2xpZGVyLCB0cmFuc2Zvcm0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbWFrZVNsaWRlcihsYWJlbCwgb25DaG9vc2UsIDAsIDEwMCwgMjAwKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWVtUmVkID0gbWFrZUNvbG9yU2xpZGVyKCdSJyk7XG4gICAgICB2YXIgbWVtR3JlZW4gPSBtYWtlQ29sb3JTbGlkZXIoJ0cnKTtcbiAgICAgIHZhciBtZW1CbHVlID0gbWFrZUNvbG9yU2xpZGVyKCdCJyk7XG4gICAgICB2YXIgY29sb3JpemVQYW5lbENvbXBvbmVudHMgPSBbXG4gICAgICAgIGNyZWF0ZUJhY2tCdXR0b24oKSxcbiAgICAgICAgbWVtUmVkLFxuICAgICAgICBtZW1HcmVlbixcbiAgICAgICAgbWVtQmx1ZSxcbiAgICAgICAgY3JlYXRlQXBwbHlCdXR0b24oKVxuICAgICAgXTtcbiAgICAgIHZhciBDb2xvcml6ZVBhbmVsID0gQ29udGFpbmVyLnNrZXRjaCh7XG4gICAgICAgIGRvbTogcGFuZWxEb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbG9yaXplUGFuZWxDb21wb25lbnRzLm1hcChmdW5jdGlvbiAobWVtKSB7XG4gICAgICAgICAgcmV0dXJuIG1lbS5hc1NwZWMoKTtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgICAgdmFyIGdldFRyYW5zZm9ybVBhbmVsRXZlbnQgPSBmdW5jdGlvbiAocGFuZWwsIHRyYW5zZm9ybSwgdXBkYXRlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgdmFyIHN3YXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBtZW1Db250YWluZXIuZ2V0T3B0KGJ1dHRvbikuZWFjaChmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgIFJlcGxhY2luZy5zZXQoY29udGFpbmVyLCBbcGFuZWxdKTtcbiAgICAgICAgICAgICAgdXBkYXRlKGNvbnRhaW5lcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGVtaXQkMShidXR0b24sIGludGVybmFsLnN3YXAoKSwge1xuICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm0sXG4gICAgICAgICAgICBzd2FwOiBzd2FwXG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGNyb3BQYW5lbFVwZGF0ZSA9IGZ1bmN0aW9uIChfYW55SW5TeXN0ZW0pIHtcbiAgICAgICAgaW1hZ2VQYW5lbC5zaG93Q3JvcCgpO1xuICAgICAgfTtcbiAgICAgIHZhciByZXNpemVQYW5lbFVwZGF0ZSA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICBtZW1TaXplLmdldE9wdChhbnlJblN5c3RlbSkuZWFjaChmdW5jdGlvbiAoc2l6ZUlucHV0KSB7XG4gICAgICAgICAgdmFyIG1lYXN1cmVtZW50cyA9IGltYWdlUGFuZWwuZ2V0TWVhc3VyZW1lbnRzKCk7XG4gICAgICAgICAgdmFyIHdpZHRoID0gbWVhc3VyZW1lbnRzLndpZHRoO1xuICAgICAgICAgIHZhciBoZWlnaHQgPSBtZWFzdXJlbWVudHMuaGVpZ2h0O1xuICAgICAgICAgIFJlcHJlc2VudGluZy5zZXRWYWx1ZShzaXplSW5wdXQsIHtcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBzaGFycGVuVHJhbnNmb3JtID0gT3B0aW9uYWwuc29tZShzaGFycGVuJDEpO1xuICAgICAgdmFyIGludmVydFRyYW5zZm9ybSA9IE9wdGlvbmFsLnNvbWUoaW52ZXJ0JDEpO1xuICAgICAgdmFyIGJ1dHRvblBhbmVsQ29tcG9uZW50cyA9IFtcbiAgICAgICAgY3JlYXRlSWNvbkJ1dHRvbignY3JvcCcsICdDcm9wJywgZ2V0VHJhbnNmb3JtUGFuZWxFdmVudChDcm9wUGFuZWwsIE9wdGlvbmFsLm5vbmUoKSwgY3JvcFBhbmVsVXBkYXRlKSwgZmFsc2UpLFxuICAgICAgICBjcmVhdGVJY29uQnV0dG9uKCdyZXNpemUnLCAnUmVzaXplJywgZ2V0VHJhbnNmb3JtUGFuZWxFdmVudChSZXNpemVQYW5lbCwgT3B0aW9uYWwubm9uZSgpLCByZXNpemVQYW5lbFVwZGF0ZSksIGZhbHNlKSxcbiAgICAgICAgY3JlYXRlSWNvbkJ1dHRvbignb3JpZW50YXRpb24nLCAnT3JpZW50YXRpb24nLCBnZXRUcmFuc2Zvcm1QYW5lbEV2ZW50KEZsaXBSb3RhdGVQYW5lbCwgT3B0aW9uYWwubm9uZSgpLCBub29wJDEpLCBmYWxzZSksXG4gICAgICAgIGNyZWF0ZUljb25CdXR0b24oJ2JyaWdodG5lc3MnLCAnQnJpZ2h0bmVzcycsIGdldFRyYW5zZm9ybVBhbmVsRXZlbnQoQnJpZ2h0bmVzc1BhbmVsLCBPcHRpb25hbC5ub25lKCksIG5vb3AkMSksIGZhbHNlKSxcbiAgICAgICAgY3JlYXRlSWNvbkJ1dHRvbignc2hhcnBlbicsICdTaGFycGVuJywgZ2V0VHJhbnNmb3JtUGFuZWxFdmVudChGaWx0ZXJQYW5lbCwgc2hhcnBlblRyYW5zZm9ybSwgbm9vcCQxKSwgZmFsc2UpLFxuICAgICAgICBjcmVhdGVJY29uQnV0dG9uKCdjb250cmFzdCcsICdDb250cmFzdCcsIGdldFRyYW5zZm9ybVBhbmVsRXZlbnQoQ29udHJhc3RQYW5lbCwgT3B0aW9uYWwubm9uZSgpLCBub29wJDEpLCBmYWxzZSksXG4gICAgICAgIGNyZWF0ZUljb25CdXR0b24oJ2NvbG9yLWxldmVscycsICdDb2xvciBsZXZlbHMnLCBnZXRUcmFuc2Zvcm1QYW5lbEV2ZW50KENvbG9yaXplUGFuZWwsIE9wdGlvbmFsLm5vbmUoKSwgbm9vcCQxKSwgZmFsc2UpLFxuICAgICAgICBjcmVhdGVJY29uQnV0dG9uKCdnYW1tYScsICdHYW1tYScsIGdldFRyYW5zZm9ybVBhbmVsRXZlbnQoR2FtbWFQYW5lbCwgT3B0aW9uYWwubm9uZSgpLCBub29wJDEpLCBmYWxzZSksXG4gICAgICAgIGNyZWF0ZUljb25CdXR0b24oJ2ludmVydCcsICdJbnZlcnQnLCBnZXRUcmFuc2Zvcm1QYW5lbEV2ZW50KEZpbHRlclBhbmVsLCBpbnZlcnRUcmFuc2Zvcm0sIG5vb3AkMSksIGZhbHNlKVxuICAgICAgXTtcbiAgICAgIHZhciBCdXR0b25QYW5lbCA9IENvbnRhaW5lci5za2V0Y2goe1xuICAgICAgICBkb206IHBhbmVsRG9tLFxuICAgICAgICBjb21wb25lbnRzOiBidXR0b25QYW5lbENvbXBvbmVudHMubWFwKGZ1bmN0aW9uIChtZW0pIHtcbiAgICAgICAgICByZXR1cm4gbWVtLmFzU3BlYygpO1xuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgICB2YXIgY29udGFpbmVyID0gQ29udGFpbmVyLnNrZXRjaCh7XG4gICAgICAgIGRvbTogeyB0YWc6ICdkaXYnIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtCdXR0b25QYW5lbF0sXG4gICAgICAgIGNvbnRhaW5lckJlaGF2aW91cnM6IGRlcml2ZSQxKFtSZXBsYWNpbmcuY29uZmlnKHt9KV0pXG4gICAgICB9KTtcbiAgICAgIHZhciBtZW1Db250YWluZXIgPSByZWNvcmQoY29udGFpbmVyKTtcbiAgICAgIHZhciBnZXRBcHBseUJ1dHRvbiA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICByZXR1cm4gbWVtQ29udGFpbmVyLmdldE9wdChhbnlJblN5c3RlbSkubWFwKGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgICB2YXIgcGFuZWwgPSBjb250YWluZXIuY29tcG9uZW50cygpWzBdO1xuICAgICAgICAgIHJldHVybiBwYW5lbC5jb21wb25lbnRzKClbcGFuZWwuY29tcG9uZW50cygpLmxlbmd0aCAtIDFdO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtZW1Db250YWluZXI6IG1lbUNvbnRhaW5lcixcbiAgICAgICAgZ2V0QXBwbHlCdXR0b246IGdldEFwcGx5QnV0dG9uXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJGQgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5nZW9tLlJlY3QnKTtcblxuICAgIHZhciBnbG9iYWwkZSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5Eb21RdWVyeScpO1xuXG4gICAgdmFyIGdsb2JhbCRmID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5PYnNlcnZhYmxlJyk7XG5cbiAgICB2YXIgZ2xvYmFsJGcgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLlZLJyk7XG5cbiAgICB2YXIgZ2V0RG9jdW1lbnRTaXplID0gZnVuY3Rpb24gKGRvYykge1xuICAgICAgdmFyIG1heCA9IE1hdGgubWF4O1xuICAgICAgdmFyIGRvY3VtZW50RWxlbWVudCA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICB2YXIgYm9keSA9IGRvYy5ib2R5O1xuICAgICAgdmFyIHNjcm9sbFdpZHRoID0gbWF4KGRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aCwgYm9keS5zY3JvbGxXaWR0aCk7XG4gICAgICB2YXIgY2xpZW50V2lkdGggPSBtYXgoZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCBib2R5LmNsaWVudFdpZHRoKTtcbiAgICAgIHZhciBvZmZzZXRXaWR0aCA9IG1heChkb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgsIGJvZHkub2Zmc2V0V2lkdGgpO1xuICAgICAgdmFyIHNjcm9sbEhlaWdodCA9IG1heChkb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0LCBib2R5LnNjcm9sbEhlaWdodCk7XG4gICAgICB2YXIgY2xpZW50SGVpZ2h0ID0gbWF4KGRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIGJvZHkuY2xpZW50SGVpZ2h0KTtcbiAgICAgIHZhciBvZmZzZXRIZWlnaHQgPSBtYXgoZG9jdW1lbnRFbGVtZW50Lm9mZnNldEhlaWdodCwgYm9keS5vZmZzZXRIZWlnaHQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IHNjcm9sbFdpZHRoIDwgb2Zmc2V0V2lkdGggPyBjbGllbnRXaWR0aCA6IHNjcm9sbFdpZHRoLFxuICAgICAgICBoZWlnaHQ6IHNjcm9sbEhlaWdodCA8IG9mZnNldEhlaWdodCA/IGNsaWVudEhlaWdodCA6IHNjcm9sbEhlaWdodFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB1cGRhdGVXaXRoVG91Y2hEYXRhID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBrZXlzLCBpO1xuICAgICAgaWYgKGUuY2hhbmdlZFRvdWNoZXMpIHtcbiAgICAgICAga2V5cyA9ICdzY3JlZW5YIHNjcmVlblkgcGFnZVggcGFnZVkgY2xpZW50WCBjbGllbnRZJy5zcGxpdCgnICcpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGVba2V5c1tpXV0gPSBlLmNoYW5nZWRUb3VjaGVzWzBdW2tleXNbaV1dO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBmdW5jdGlvbiBEcmFnSGVscGVyIChpZCwgc2V0dGluZ3MpIHtcbiAgICAgIHZhciAkZXZlbnRPdmVybGF5O1xuICAgICAgdmFyIGRvYyA9IHNldHRpbmdzLmRvY3VtZW50IHx8IGRvY3VtZW50O1xuICAgICAgdmFyIGRvd25CdXR0b247XG4gICAgICB2YXIgc3RhcnRYLCBzdGFydFk7XG4gICAgICB2YXIgaGFuZGxlRWxlbWVudCA9IGRvYy5nZXRFbGVtZW50QnlJZChzZXR0aW5ncy5oYW5kbGUgfHwgaWQpO1xuICAgICAgdmFyIHN0YXJ0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGRvY1NpemUgPSBnZXREb2N1bWVudFNpemUoZG9jKTtcbiAgICAgICAgdmFyIGN1cnNvcjtcbiAgICAgICAgdXBkYXRlV2l0aFRvdWNoRGF0YShlKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBkb3duQnV0dG9uID0gZS5idXR0b247XG4gICAgICAgIHZhciBoYW5kbGVFbG0gPSBoYW5kbGVFbGVtZW50O1xuICAgICAgICBzdGFydFggPSBlLnNjcmVlblg7XG4gICAgICAgIHN0YXJ0WSA9IGUuc2NyZWVuWTtcbiAgICAgICAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7XG4gICAgICAgICAgY3Vyc29yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoaGFuZGxlRWxtLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKCdjdXJzb3InKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdXJzb3IgPSBoYW5kbGVFbG0ucnVudGltZVN0eWxlLmN1cnNvcjtcbiAgICAgICAgfVxuICAgICAgICAkZXZlbnRPdmVybGF5ID0gZ2xvYmFsJGUoJzxkaXY+PC9kaXY+JykuY3NzKHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICB3aWR0aDogZG9jU2l6ZS53aWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IGRvY1NpemUuaGVpZ2h0LFxuICAgICAgICAgIHpJbmRleDogMjE0NzQ4MzY0NyxcbiAgICAgICAgICBvcGFjaXR5OiAwLjAwMDEsXG4gICAgICAgICAgY3Vyc29yOiBjdXJzb3JcbiAgICAgICAgfSkuYXBwZW5kVG8oZG9jLmJvZHkpO1xuICAgICAgICBnbG9iYWwkZShkb2MpLm9uKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgZHJhZykub24oJ21vdXNldXAgdG91Y2hlbmQnLCBzdG9wKTtcbiAgICAgICAgc2V0dGluZ3Muc3RhcnQoZSk7XG4gICAgICB9O1xuICAgICAgdmFyIGRyYWcgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB1cGRhdGVXaXRoVG91Y2hEYXRhKGUpO1xuICAgICAgICBpZiAoZS5idXR0b24gIT09IGRvd25CdXR0b24pIHtcbiAgICAgICAgICByZXR1cm4gc3RvcChlKTtcbiAgICAgICAgfVxuICAgICAgICBlLmRlbHRhWCA9IGUuc2NyZWVuWCAtIHN0YXJ0WDtcbiAgICAgICAgZS5kZWx0YVkgPSBlLnNjcmVlblkgLSBzdGFydFk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgc2V0dGluZ3MuZHJhZyhlKTtcbiAgICAgIH07XG4gICAgICB2YXIgc3RvcCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHVwZGF0ZVdpdGhUb3VjaERhdGEoZSk7XG4gICAgICAgIGdsb2JhbCRlKGRvYykub2ZmKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgZHJhZykub2ZmKCdtb3VzZXVwIHRvdWNoZW5kJywgc3RvcCk7XG4gICAgICAgICRldmVudE92ZXJsYXkucmVtb3ZlKCk7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zdG9wKSB7XG4gICAgICAgICAgc2V0dGluZ3Muc3RvcChlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBkZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBnbG9iYWwkZShoYW5kbGVFbGVtZW50KS5vZmYoKTtcbiAgICAgIH07XG4gICAgICBnbG9iYWwkZShoYW5kbGVFbGVtZW50KS5vbignbW91c2Vkb3duIHRvdWNoc3RhcnQnLCBzdGFydCk7XG4gICAgICByZXR1cm4geyBkZXN0cm95OiBkZXN0cm95IH07XG4gICAgfVxuXG4gICAgdmFyIGNvdW50ID0gMDtcbiAgICB2YXIgY3JlYXRlJDcgPSBmdW5jdGlvbiAoY3VycmVudFJlY3QsIHZpZXdQb3J0UmVjdCwgY2xhbXBSZWN0LCBjb250YWluZXJFbG0sIGFjdGlvbikge1xuICAgICAgdmFyIGRyYWdIZWxwZXJzO1xuICAgICAgdmFyIHByZWZpeCA9ICd0b3gtJztcbiAgICAgIHZhciBpZCA9IHByZWZpeCArICdjcmlkLScgKyBjb3VudCsrO1xuICAgICAgdmFyIGhhbmRsZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnbW92ZScsXG4gICAgICAgICAgeE11bDogMCxcbiAgICAgICAgICB5TXVsOiAwLFxuICAgICAgICAgIGRlbHRhWDogMSxcbiAgICAgICAgICBkZWx0YVk6IDEsXG4gICAgICAgICAgZGVsdGFXOiAwLFxuICAgICAgICAgIGRlbHRhSDogMCxcbiAgICAgICAgICBsYWJlbDogJ0Nyb3AgTWFzaydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdudycsXG4gICAgICAgICAgeE11bDogMCxcbiAgICAgICAgICB5TXVsOiAwLFxuICAgICAgICAgIGRlbHRhWDogMSxcbiAgICAgICAgICBkZWx0YVk6IDEsXG4gICAgICAgICAgZGVsdGFXOiAtMSxcbiAgICAgICAgICBkZWx0YUg6IC0xLFxuICAgICAgICAgIGxhYmVsOiAnVG9wIExlZnQgQ3JvcCBIYW5kbGUnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnbmUnLFxuICAgICAgICAgIHhNdWw6IDEsXG4gICAgICAgICAgeU11bDogMCxcbiAgICAgICAgICBkZWx0YVg6IDAsXG4gICAgICAgICAgZGVsdGFZOiAxLFxuICAgICAgICAgIGRlbHRhVzogMSxcbiAgICAgICAgICBkZWx0YUg6IC0xLFxuICAgICAgICAgIGxhYmVsOiAnVG9wIFJpZ2h0IENyb3AgSGFuZGxlJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3N3JyxcbiAgICAgICAgICB4TXVsOiAwLFxuICAgICAgICAgIHlNdWw6IDEsXG4gICAgICAgICAgZGVsdGFYOiAxLFxuICAgICAgICAgIGRlbHRhWTogMCxcbiAgICAgICAgICBkZWx0YVc6IC0xLFxuICAgICAgICAgIGRlbHRhSDogMSxcbiAgICAgICAgICBsYWJlbDogJ0JvdHRvbSBMZWZ0IENyb3AgSGFuZGxlJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3NlJyxcbiAgICAgICAgICB4TXVsOiAxLFxuICAgICAgICAgIHlNdWw6IDEsXG4gICAgICAgICAgZGVsdGFYOiAwLFxuICAgICAgICAgIGRlbHRhWTogMCxcbiAgICAgICAgICBkZWx0YVc6IDEsXG4gICAgICAgICAgZGVsdGFIOiAxLFxuICAgICAgICAgIGxhYmVsOiAnQm90dG9tIFJpZ2h0IENyb3AgSGFuZGxlJ1xuICAgICAgICB9XG4gICAgICBdO1xuICAgICAgdmFyIGJsb2NrZXJzID0gW1xuICAgICAgICAndG9wJyxcbiAgICAgICAgJ3JpZ2h0JyxcbiAgICAgICAgJ2JvdHRvbScsXG4gICAgICAgICdsZWZ0J1xuICAgICAgXTtcbiAgICAgIHZhciBnZXRBYnNvbHV0ZVJlY3QgPSBmdW5jdGlvbiAob3V0ZXJSZWN0LCByZWxhdGl2ZVJlY3QpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB4OiByZWxhdGl2ZVJlY3QueCArIG91dGVyUmVjdC54LFxuICAgICAgICAgIHk6IHJlbGF0aXZlUmVjdC55ICsgb3V0ZXJSZWN0LnksXG4gICAgICAgICAgdzogcmVsYXRpdmVSZWN0LncsXG4gICAgICAgICAgaDogcmVsYXRpdmVSZWN0LmhcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0UmVsYXRpdmVSZWN0ID0gZnVuY3Rpb24gKG91dGVyUmVjdCwgaW5uZXJSZWN0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgeDogaW5uZXJSZWN0LnggLSBvdXRlclJlY3QueCxcbiAgICAgICAgICB5OiBpbm5lclJlY3QueSAtIG91dGVyUmVjdC55LFxuICAgICAgICAgIHc6IGlubmVyUmVjdC53LFxuICAgICAgICAgIGg6IGlubmVyUmVjdC5oXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGdldElubmVyUmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldFJlbGF0aXZlUmVjdChjbGFtcFJlY3QsIGN1cnJlbnRSZWN0KTtcbiAgICAgIH07XG4gICAgICB2YXIgbW92ZVJlY3QgPSBmdW5jdGlvbiAoaGFuZGxlLCBzdGFydFJlY3QsIGRlbHRhWCwgZGVsdGFZKSB7XG4gICAgICAgIHZhciB4LCB5LCB3LCBoLCByZWN0O1xuICAgICAgICB4ID0gc3RhcnRSZWN0Lng7XG4gICAgICAgIHkgPSBzdGFydFJlY3QueTtcbiAgICAgICAgdyA9IHN0YXJ0UmVjdC53O1xuICAgICAgICBoID0gc3RhcnRSZWN0Lmg7XG4gICAgICAgIHggKz0gZGVsdGFYICogaGFuZGxlLmRlbHRhWDtcbiAgICAgICAgeSArPSBkZWx0YVkgKiBoYW5kbGUuZGVsdGFZO1xuICAgICAgICB3ICs9IGRlbHRhWCAqIGhhbmRsZS5kZWx0YVc7XG4gICAgICAgIGggKz0gZGVsdGFZICogaGFuZGxlLmRlbHRhSDtcbiAgICAgICAgaWYgKHcgPCAyMCkge1xuICAgICAgICAgIHcgPSAyMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaCA8IDIwKSB7XG4gICAgICAgICAgaCA9IDIwO1xuICAgICAgICB9XG4gICAgICAgIHJlY3QgPSBjdXJyZW50UmVjdCA9IGdsb2JhbCRkLmNsYW1wKHtcbiAgICAgICAgICB4OiB4LFxuICAgICAgICAgIHk6IHksXG4gICAgICAgICAgdzogdyxcbiAgICAgICAgICBoOiBoXG4gICAgICAgIH0sIGNsYW1wUmVjdCwgaGFuZGxlLm5hbWUgPT09ICdtb3ZlJyk7XG4gICAgICAgIHJlY3QgPSBnZXRSZWxhdGl2ZVJlY3QoY2xhbXBSZWN0LCByZWN0KTtcbiAgICAgICAgaW5zdGFuY2UuZmlyZSgndXBkYXRlUmVjdCcsIHsgcmVjdDogcmVjdCB9KTtcbiAgICAgICAgc2V0SW5uZXJSZWN0KHJlY3QpO1xuICAgICAgfTtcbiAgICAgIHZhciByZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjcmVhdGVEcmFnSGVscGVyID0gZnVuY3Rpb24gKGhhbmRsZSkge1xuICAgICAgICAgIHZhciBzdGFydFJlY3Q7XG4gICAgICAgICAgcmV0dXJuIERyYWdIZWxwZXIoaWQsIHtcbiAgICAgICAgICAgIGRvY3VtZW50OiBjb250YWluZXJFbG0ub3duZXJEb2N1bWVudCxcbiAgICAgICAgICAgIGhhbmRsZTogaWQgKyAnLScgKyBoYW5kbGUubmFtZSxcbiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHN0YXJ0UmVjdCA9IGN1cnJlbnRSZWN0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIG1vdmVSZWN0KGhhbmRsZSwgc3RhcnRSZWN0LCBlLmRlbHRhWCwgZS5kZWx0YVkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBnbG9iYWwkZSgnPGRpdiBpZD1cIicgKyBpZCArICdcIiBjbGFzcz1cIicgKyBwcmVmaXggKyAnY3JvcHJlY3QtY29udGFpbmVyXCInICsgJyByb2xlPVwiZ3JpZFwiIGFyaWEtZHJvcGVmZmVjdD1cImV4ZWN1dGVcIj4nKS5hcHBlbmRUbyhjb250YWluZXJFbG0pO1xuICAgICAgICBnbG9iYWwkYy5lYWNoKGJsb2NrZXJzLCBmdW5jdGlvbiAoYmxvY2tlcikge1xuICAgICAgICAgIGdsb2JhbCRlKCcjJyArIGlkLCBjb250YWluZXJFbG0pLmFwcGVuZCgnPGRpdiBpZD1cIicgKyBpZCArICctJyArIGJsb2NrZXIgKyAnXCJjbGFzcz1cIicgKyBwcmVmaXggKyAnY3JvcHJlY3QtYmxvY2tcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIiBkYXRhLW1jZS1ib2d1cz1cImFsbFwiPicpO1xuICAgICAgICB9KTtcbiAgICAgICAgZ2xvYmFsJGMuZWFjaChoYW5kbGVzLCBmdW5jdGlvbiAoaGFuZGxlKSB7XG4gICAgICAgICAgZ2xvYmFsJGUoJyMnICsgaWQsIGNvbnRhaW5lckVsbSkuYXBwZW5kKCc8ZGl2IGlkPVwiJyArIGlkICsgJy0nICsgaGFuZGxlLm5hbWUgKyAnXCIgY2xhc3M9XCInICsgcHJlZml4ICsgJ2Nyb3ByZWN0LWhhbmRsZSAnICsgcHJlZml4ICsgJ2Nyb3ByZWN0LWhhbmRsZS0nICsgaGFuZGxlLm5hbWUgKyAnXCInICsgJ3N0eWxlPVwiZGlzcGxheTogbm9uZVwiIGRhdGEtbWNlLWJvZ3VzPVwiYWxsXCIgcm9sZT1cImdyaWRjZWxsXCIgdGFiaW5kZXg9XCItMVwiJyArICcgYXJpYS1sYWJlbD1cIicgKyBoYW5kbGUubGFiZWwgKyAnXCIgYXJpYS1ncmFiYmVkPVwiZmFsc2VcIiB0aXRsZT1cIicgKyBoYW5kbGUubGFiZWwgKyAnXCI+Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICBkcmFnSGVscGVycyA9IGdsb2JhbCRjLm1hcChoYW5kbGVzLCBjcmVhdGVEcmFnSGVscGVyKTtcbiAgICAgICAgcmVwYWludChjdXJyZW50UmVjdCk7XG4gICAgICAgIGdsb2JhbCRlKGNvbnRhaW5lckVsbSkub24oJ2ZvY3VzaW4gZm9jdXNvdXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGdsb2JhbCRlKGUudGFyZ2V0KS5hdHRyKCdhcmlhLWdyYWJiZWQnLCBlLnR5cGUgPT09ICdmb2N1cycgPyAndHJ1ZScgOiAnZmFsc2UnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGdsb2JhbCRlKGNvbnRhaW5lckVsbSkub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHZhciBhY3RpdmVIYW5kbGU7XG4gICAgICAgICAgZ2xvYmFsJGMuZWFjaChoYW5kbGVzLCBmdW5jdGlvbiAoaGFuZGxlKSB7XG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuaWQgPT09IGlkICsgJy0nICsgaGFuZGxlLm5hbWUpIHtcbiAgICAgICAgICAgICAgYWN0aXZlSGFuZGxlID0gaGFuZGxlO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIG1vdmVBbmRCbG9jayA9IGZ1bmN0aW9uIChldnQsIGhhbmRsZSwgc3RhcnRSZWN0LCBkZWx0YVgsIGRlbHRhWSkge1xuICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBtb3ZlUmVjdChhY3RpdmVIYW5kbGUsIHN0YXJ0UmVjdCwgZGVsdGFYLCBkZWx0YVkpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICBjYXNlIGdsb2JhbCRnLkxFRlQ6XG4gICAgICAgICAgICBtb3ZlQW5kQmxvY2soZSwgYWN0aXZlSGFuZGxlLCBjdXJyZW50UmVjdCwgLTEwLCAwKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgZ2xvYmFsJGcuUklHSFQ6XG4gICAgICAgICAgICBtb3ZlQW5kQmxvY2soZSwgYWN0aXZlSGFuZGxlLCBjdXJyZW50UmVjdCwgMTAsIDApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBnbG9iYWwkZy5VUDpcbiAgICAgICAgICAgIG1vdmVBbmRCbG9jayhlLCBhY3RpdmVIYW5kbGUsIGN1cnJlbnRSZWN0LCAwLCAtMTApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBnbG9iYWwkZy5ET1dOOlxuICAgICAgICAgICAgbW92ZUFuZEJsb2NrKGUsIGFjdGl2ZUhhbmRsZSwgY3VycmVudFJlY3QsIDAsIDEwKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgZ2xvYmFsJGcuRU5URVI6XG4gICAgICAgICAgY2FzZSBnbG9iYWwkZy5TUEFDRUJBUjpcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGFjdGlvbigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdG9nZ2xlVmlzaWJpbGl0eSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICB2YXIgc2VsZWN0b3JzID0gZ2xvYmFsJGMubWFwKGhhbmRsZXMsIGZ1bmN0aW9uIChoYW5kbGUpIHtcbiAgICAgICAgICByZXR1cm4gJyMnICsgaWQgKyAnLScgKyBoYW5kbGUubmFtZTtcbiAgICAgICAgfSkuY29uY2F0KGdsb2JhbCRjLm1hcChibG9ja2VycywgZnVuY3Rpb24gKGJsb2NrZXIpIHtcbiAgICAgICAgICByZXR1cm4gJyMnICsgaWQgKyAnLScgKyBibG9ja2VyO1xuICAgICAgICB9KSkuam9pbignLCcpO1xuICAgICAgICBpZiAoc3RhdGUpIHtcbiAgICAgICAgICBnbG9iYWwkZShzZWxlY3RvcnMsIGNvbnRhaW5lckVsbSkuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdsb2JhbCRlKHNlbGVjdG9ycywgY29udGFpbmVyRWxtKS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgcmVwYWludCA9IGZ1bmN0aW9uIChyZWN0KSB7XG4gICAgICAgIHZhciB1cGRhdGVFbGVtZW50UmVjdCA9IGZ1bmN0aW9uIChuYW1lLCByZWN0KSB7XG4gICAgICAgICAgaWYgKHJlY3QuaCA8IDApIHtcbiAgICAgICAgICAgIHJlY3QuaCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZWN0LncgPCAwKSB7XG4gICAgICAgICAgICByZWN0LncgPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBnbG9iYWwkZSgnIycgKyBpZCArICctJyArIG5hbWUsIGNvbnRhaW5lckVsbSkuY3NzKHtcbiAgICAgICAgICAgIGxlZnQ6IHJlY3QueCxcbiAgICAgICAgICAgIHRvcDogcmVjdC55LFxuICAgICAgICAgICAgd2lkdGg6IHJlY3QudyxcbiAgICAgICAgICAgIGhlaWdodDogcmVjdC5oXG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGdsb2JhbCRjLmVhY2goaGFuZGxlcywgZnVuY3Rpb24gKGhhbmRsZSkge1xuICAgICAgICAgIGdsb2JhbCRlKCcjJyArIGlkICsgJy0nICsgaGFuZGxlLm5hbWUsIGNvbnRhaW5lckVsbSkuY3NzKHtcbiAgICAgICAgICAgIGxlZnQ6IHJlY3QudyAqIGhhbmRsZS54TXVsICsgcmVjdC54LFxuICAgICAgICAgICAgdG9wOiByZWN0LmggKiBoYW5kbGUueU11bCArIHJlY3QueVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdXBkYXRlRWxlbWVudFJlY3QoJ3RvcCcsIHtcbiAgICAgICAgICB4OiB2aWV3UG9ydFJlY3QueCxcbiAgICAgICAgICB5OiB2aWV3UG9ydFJlY3QueSxcbiAgICAgICAgICB3OiB2aWV3UG9ydFJlY3QudyxcbiAgICAgICAgICBoOiByZWN0LnkgLSB2aWV3UG9ydFJlY3QueVxuICAgICAgICB9KTtcbiAgICAgICAgdXBkYXRlRWxlbWVudFJlY3QoJ3JpZ2h0Jywge1xuICAgICAgICAgIHg6IHJlY3QueCArIHJlY3QudyxcbiAgICAgICAgICB5OiByZWN0LnksXG4gICAgICAgICAgdzogdmlld1BvcnRSZWN0LncgLSByZWN0LnggLSByZWN0LncgKyB2aWV3UG9ydFJlY3QueCxcbiAgICAgICAgICBoOiByZWN0LmhcbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZUVsZW1lbnRSZWN0KCdib3R0b20nLCB7XG4gICAgICAgICAgeDogdmlld1BvcnRSZWN0LngsXG4gICAgICAgICAgeTogcmVjdC55ICsgcmVjdC5oLFxuICAgICAgICAgIHc6IHZpZXdQb3J0UmVjdC53LFxuICAgICAgICAgIGg6IHZpZXdQb3J0UmVjdC5oIC0gcmVjdC55IC0gcmVjdC5oICsgdmlld1BvcnRSZWN0LnlcbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZUVsZW1lbnRSZWN0KCdsZWZ0Jywge1xuICAgICAgICAgIHg6IHZpZXdQb3J0UmVjdC54LFxuICAgICAgICAgIHk6IHJlY3QueSxcbiAgICAgICAgICB3OiByZWN0LnggLSB2aWV3UG9ydFJlY3QueCxcbiAgICAgICAgICBoOiByZWN0LmhcbiAgICAgICAgfSk7XG4gICAgICAgIHVwZGF0ZUVsZW1lbnRSZWN0KCdtb3ZlJywgcmVjdCk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldFJlY3QgPSBmdW5jdGlvbiAocmVjdCkge1xuICAgICAgICBjdXJyZW50UmVjdCA9IHJlY3Q7XG4gICAgICAgIHJlcGFpbnQoY3VycmVudFJlY3QpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXRWaWV3UG9ydFJlY3QgPSBmdW5jdGlvbiAocmVjdCkge1xuICAgICAgICB2aWV3UG9ydFJlY3QgPSByZWN0O1xuICAgICAgICByZXBhaW50KGN1cnJlbnRSZWN0KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0SW5uZXJSZWN0ID0gZnVuY3Rpb24gKHJlY3QpIHtcbiAgICAgICAgc2V0UmVjdChnZXRBYnNvbHV0ZVJlY3QoY2xhbXBSZWN0LCByZWN0KSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldENsYW1wUmVjdCA9IGZ1bmN0aW9uIChyZWN0KSB7XG4gICAgICAgIGNsYW1wUmVjdCA9IHJlY3Q7XG4gICAgICAgIHJlcGFpbnQoY3VycmVudFJlY3QpO1xuICAgICAgfTtcbiAgICAgIHZhciBkZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBnbG9iYWwkYy5lYWNoKGRyYWdIZWxwZXJzLCBmdW5jdGlvbiAoaGVscGVyKSB7XG4gICAgICAgICAgaGVscGVyLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGRyYWdIZWxwZXJzID0gW107XG4gICAgICB9O1xuICAgICAgcmVuZGVyKCk7XG4gICAgICB2YXIgaW5zdGFuY2UgPSBnbG9iYWwkYy5leHRlbmQoe1xuICAgICAgICB0b2dnbGVWaXNpYmlsaXR5OiB0b2dnbGVWaXNpYmlsaXR5LFxuICAgICAgICBzZXRDbGFtcFJlY3Q6IHNldENsYW1wUmVjdCxcbiAgICAgICAgc2V0UmVjdDogc2V0UmVjdCxcbiAgICAgICAgZ2V0SW5uZXJSZWN0OiBnZXRJbm5lclJlY3QsXG4gICAgICAgIHNldElubmVyUmVjdDogc2V0SW5uZXJSZWN0LFxuICAgICAgICBzZXRWaWV3UG9ydFJlY3Q6IHNldFZpZXdQb3J0UmVjdCxcbiAgICAgICAgZGVzdHJveTogZGVzdHJveVxuICAgICAgfSwgZ2xvYmFsJGYpO1xuICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgIH07XG4gICAgdmFyIENyb3BSZWN0ID0geyBjcmVhdGU6IGNyZWF0ZSQ3IH07XG5cbiAgICB2YXIgbG9hZEltYWdlID0gZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICByZXR1cm4gbmV3IGdsb2JhbCQ0KGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgIHZhciBsb2FkZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZCcsIGxvYWRlZCk7XG4gICAgICAgICAgcmVzb2x2ZShpbWFnZSk7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChpbWFnZS5jb21wbGV0ZSkge1xuICAgICAgICAgIHJlc29sdmUoaW1hZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBsb2FkZWQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJJbWFnZVBhbmVsID0gZnVuY3Rpb24gKGluaXRpYWxVcmwpIHtcbiAgICAgIHZhciBtZW1CZyA9IHJlY29yZCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtaW1hZ2UtdG9vbHNfX2ltYWdlLWJnJ10sXG4gICAgICAgICAgYXR0cmlidXRlczogeyByb2xlOiAncHJlc2VudGF0aW9uJyB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIHpvb21TdGF0ZSA9IENlbGwoMSk7XG4gICAgICB2YXIgY3JvcFJlY3QgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgcmVjdFN0YXRlID0gQ2VsbCh7XG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDAsXG4gICAgICAgIHc6IDEsXG4gICAgICAgIGg6IDFcbiAgICAgIH0pO1xuICAgICAgdmFyIHZpZXdSZWN0U3RhdGUgPSBDZWxsKHtcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMCxcbiAgICAgICAgdzogMSxcbiAgICAgICAgaDogMVxuICAgICAgfSk7XG4gICAgICB2YXIgcmVwYWludEltZyA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgaW1nKSB7XG4gICAgICAgIG1lbUNvbnRhaW5lci5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKHBhbmVsKSB7XG4gICAgICAgICAgdmFyIHpvb20gPSB6b29tU3RhdGUuZ2V0KCk7XG4gICAgICAgICAgdmFyIHBhbmVsVyA9IGdldCQ4KHBhbmVsLmVsZW1lbnQpO1xuICAgICAgICAgIHZhciBwYW5lbEggPSBnZXQkNyhwYW5lbC5lbGVtZW50KTtcbiAgICAgICAgICB2YXIgd2lkdGggPSBpbWcuZG9tLm5hdHVyYWxXaWR0aCAqIHpvb207XG4gICAgICAgICAgdmFyIGhlaWdodCA9IGltZy5kb20ubmF0dXJhbEhlaWdodCAqIHpvb207XG4gICAgICAgICAgdmFyIGxlZnQgPSBNYXRoLm1heCgwLCBwYW5lbFcgLyAyIC0gd2lkdGggLyAyKTtcbiAgICAgICAgICB2YXIgdG9wID0gTWF0aC5tYXgoMCwgcGFuZWxIIC8gMiAtIGhlaWdodCAvIDIpO1xuICAgICAgICAgIHZhciBjc3MgPSB7XG4gICAgICAgICAgICBsZWZ0OiBsZWZ0LnRvU3RyaW5nKCkgKyAncHgnLFxuICAgICAgICAgICAgdG9wOiB0b3AudG9TdHJpbmcoKSArICdweCcsXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgudG9TdHJpbmcoKSArICdweCcsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodC50b1N0cmluZygpICsgJ3B4JyxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnXG4gICAgICAgICAgfTtcbiAgICAgICAgICBzZXRBbGwkMShpbWcsIGNzcyk7XG4gICAgICAgICAgbWVtQmcuZ2V0T3B0KHBhbmVsKS5lYWNoKGZ1bmN0aW9uIChiZykge1xuICAgICAgICAgICAgc2V0QWxsJDEoYmcuZWxlbWVudCwgY3NzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjcm9wUmVjdC5nZXQoKS5lYWNoKGZ1bmN0aW9uIChjUmVjdCkge1xuICAgICAgICAgICAgdmFyIHJlY3QgPSByZWN0U3RhdGUuZ2V0KCk7XG4gICAgICAgICAgICBjUmVjdC5zZXRSZWN0KHtcbiAgICAgICAgICAgICAgeDogcmVjdC54ICogem9vbSArIGxlZnQsXG4gICAgICAgICAgICAgIHk6IHJlY3QueSAqIHpvb20gKyB0b3AsXG4gICAgICAgICAgICAgIHc6IHJlY3QudyAqIHpvb20sXG4gICAgICAgICAgICAgIGg6IHJlY3QuaCAqIHpvb21cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY1JlY3Quc2V0Q2xhbXBSZWN0KHtcbiAgICAgICAgICAgICAgeDogbGVmdCxcbiAgICAgICAgICAgICAgeTogdG9wLFxuICAgICAgICAgICAgICB3OiB3aWR0aCxcbiAgICAgICAgICAgICAgaDogaGVpZ2h0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNSZWN0LnNldFZpZXdQb3J0UmVjdCh7XG4gICAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICAgIHc6IHBhbmVsVyxcbiAgICAgICAgICAgICAgaDogcGFuZWxIXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHpvb21GaXQgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIGltZykge1xuICAgICAgICBtZW1Db250YWluZXIuZ2V0T3B0KGFueUluU3lzdGVtKS5lYWNoKGZ1bmN0aW9uIChwYW5lbCkge1xuICAgICAgICAgIHZhciBwYW5lbFcgPSBnZXQkOChwYW5lbC5lbGVtZW50KTtcbiAgICAgICAgICB2YXIgcGFuZWxIID0gZ2V0JDcocGFuZWwuZWxlbWVudCk7XG4gICAgICAgICAgdmFyIHdpZHRoID0gaW1nLmRvbS5uYXR1cmFsV2lkdGg7XG4gICAgICAgICAgdmFyIGhlaWdodCA9IGltZy5kb20ubmF0dXJhbEhlaWdodDtcbiAgICAgICAgICB2YXIgem9vbSA9IE1hdGgubWluKHBhbmVsVyAvIHdpZHRoLCBwYW5lbEggLyBoZWlnaHQpO1xuICAgICAgICAgIGlmICh6b29tID49IDEpIHtcbiAgICAgICAgICAgIHpvb21TdGF0ZS5zZXQoMSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHpvb21TdGF0ZS5zZXQoem9vbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlU3JjID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCB1cmwpIHtcbiAgICAgICAgdmFyIGltZyA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdpbWcnKTtcbiAgICAgICAgc2V0JDEoaW1nLCAnc3JjJywgdXJsKTtcbiAgICAgICAgcmV0dXJuIGxvYWRJbWFnZShpbWcuZG9tKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWVtQ29udGFpbmVyLmdldE9wdChhbnlJblN5c3RlbSkubWFwKGZ1bmN0aW9uIChwYW5lbCkge1xuICAgICAgICAgICAgdmFyIGFJbWcgPSBleHRlcm5hbCh7IGVsZW1lbnQ6IGltZyB9KTtcbiAgICAgICAgICAgIFJlcGxhY2luZy5yZXBsYWNlQXQocGFuZWwsIDEsIE9wdGlvbmFsLnNvbWUoYUltZykpO1xuICAgICAgICAgICAgdmFyIGxhc3RWaWV3UmVjdCA9IHZpZXdSZWN0U3RhdGUuZ2V0KCk7XG4gICAgICAgICAgICB2YXIgdmlld1JlY3QgPSB7XG4gICAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICAgIHc6IGltZy5kb20ubmF0dXJhbFdpZHRoLFxuICAgICAgICAgICAgICBoOiBpbWcuZG9tLm5hdHVyYWxIZWlnaHRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2aWV3UmVjdFN0YXRlLnNldCh2aWV3UmVjdCk7XG4gICAgICAgICAgICB2YXIgcmVjdCA9IGdsb2JhbCRkLmluZmxhdGUodmlld1JlY3QsIC0yMCwgLTIwKTtcbiAgICAgICAgICAgIHJlY3RTdGF0ZS5zZXQocmVjdCk7XG4gICAgICAgICAgICBpZiAobGFzdFZpZXdSZWN0LncgIT09IHZpZXdSZWN0LncgfHwgbGFzdFZpZXdSZWN0LmggIT09IHZpZXdSZWN0LmgpIHtcbiAgICAgICAgICAgICAgem9vbUZpdChwYW5lbCwgaW1nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcGFpbnRJbWcocGFuZWwsIGltZyk7XG4gICAgICAgICAgICByZXR1cm4gaW1nO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgem9vbSA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgZGlyZWN0aW9uKSB7XG4gICAgICAgIHZhciBjdXJyZW50Wm9vbSA9IHpvb21TdGF0ZS5nZXQoKTtcbiAgICAgICAgdmFyIG5ld1pvb20gPSBkaXJlY3Rpb24gPiAwID8gTWF0aC5taW4oMiwgY3VycmVudFpvb20gKyAwLjEpIDogTWF0aC5tYXgoMC4xLCBjdXJyZW50Wm9vbSAtIDAuMSk7XG4gICAgICAgIHpvb21TdGF0ZS5zZXQobmV3Wm9vbSk7XG4gICAgICAgIG1lbUNvbnRhaW5lci5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKHBhbmVsKSB7XG4gICAgICAgICAgdmFyIGltZyA9IHBhbmVsLmNvbXBvbmVudHMoKVsxXS5lbGVtZW50O1xuICAgICAgICAgIHJlcGFpbnRJbWcocGFuZWwsIGltZyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBzaG93Q3JvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY3JvcFJlY3QuZ2V0KCkuZWFjaChmdW5jdGlvbiAoY1JlY3QpIHtcbiAgICAgICAgICBjUmVjdC50b2dnbGVWaXNpYmlsaXR5KHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgaGlkZUNyb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNyb3BSZWN0LmdldCgpLmVhY2goZnVuY3Rpb24gKGNSZWN0KSB7XG4gICAgICAgICAgY1JlY3QudG9nZ2xlVmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRSZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmVjdFN0YXRlLmdldCgpO1xuICAgICAgfTtcbiAgICAgIHZhciBjb250YWluZXIgPSBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1pbWFnZS10b29sc19faW1hZ2UnXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgbWVtQmcuYXNTcGVjKCksXG4gICAgICAgICAge1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2ltZycsXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgc3JjOiBpbml0aWFsVXJsIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGRvbTogeyB0YWc6ICdkaXYnIH0sXG4gICAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdpbWFnZS1wYW5lbC1jcm9wLWV2ZW50cycsIFtydW5PbkF0dGFjaGVkKGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICBtZW1Db250YWluZXIuZ2V0T3B0KGNvbXApLmVhY2goZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBjb250YWluZXIuZWxlbWVudC5kb207XG4gICAgICAgICAgICAgICAgICAgIHZhciBjUmVjdCA9IENyb3BSZWN0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgeDogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgeTogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgdzogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgIGg6IDEwMFxuICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgIHc6IDIwMCxcbiAgICAgICAgICAgICAgICAgICAgICBoOiAyMDBcbiAgICAgICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgICAgICAgICAgICB3OiAyMDAsXG4gICAgICAgICAgICAgICAgICAgICAgaDogMjAwXG4gICAgICAgICAgICAgICAgICAgIH0sIGVsLCBub29wKTtcbiAgICAgICAgICAgICAgICAgICAgY1JlY3QudG9nZ2xlVmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGNSZWN0Lm9uKCd1cGRhdGVSZWN0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjdCA9IGUucmVjdDtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgem9vbSA9IHpvb21TdGF0ZS5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UmVjdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQocmVjdC54IC8gem9vbSksXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLnJvdW5kKHJlY3QueSAvIHpvb20pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdzogTWF0aC5yb3VuZChyZWN0LncgLyB6b29tKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGg6IE1hdGgucm91bmQocmVjdC5oIC8gem9vbSlcbiAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgIHJlY3RTdGF0ZS5zZXQobmV3UmVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjcm9wUmVjdC5zZXQoT3B0aW9uYWwuc29tZShjUmVjdCkpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSldKV0pXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBjb250YWluZXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgUmVwbGFjaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgY29uZmlnKCdpbWFnZS1wYW5lbC1ldmVudHMnLCBbcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICB1cGRhdGVTcmMoY29tcCwgaW5pdGlhbFVybCk7XG4gICAgICAgICAgICB9KV0pXG4gICAgICAgIF0pXG4gICAgICB9KTtcbiAgICAgIHZhciBtZW1Db250YWluZXIgPSByZWNvcmQoY29udGFpbmVyKTtcbiAgICAgIHZhciBnZXRNZWFzdXJlbWVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2aWV3UmVjdCA9IHZpZXdSZWN0U3RhdGUuZ2V0KCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgd2lkdGg6IHZpZXdSZWN0LncsXG4gICAgICAgICAgaGVpZ2h0OiB2aWV3UmVjdC5oXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVtQ29udGFpbmVyOiBtZW1Db250YWluZXIsXG4gICAgICAgIHVwZGF0ZVNyYzogdXBkYXRlU3JjLFxuICAgICAgICB6b29tOiB6b29tLFxuICAgICAgICBzaG93Q3JvcDogc2hvd0Nyb3AsXG4gICAgICAgIGhpZGVDcm9wOiBoaWRlQ3JvcCxcbiAgICAgICAgZ2V0UmVjdDogZ2V0UmVjdCxcbiAgICAgICAgZ2V0TWVhc3VyZW1lbnRzOiBnZXRNZWFzdXJlbWVudHNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGVCdXR0b24gPSBmdW5jdGlvbiAoaW5uZXJIdG1sLCBpY29uLCBkaXNhYmxlZCwgYWN0aW9uLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiByZW5kZXJJY29uQnV0dG9uKHtcbiAgICAgICAgbmFtZTogaW5uZXJIdG1sLFxuICAgICAgICBpY29uOiBPcHRpb25hbC5zb21lKGljb24pLFxuICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgIHRvb2x0aXA6IE9wdGlvbmFsLnNvbWUoaW5uZXJIdG1sKSxcbiAgICAgICAgcHJpbWFyeTogZmFsc2UsXG4gICAgICAgIGJvcmRlcmxlc3M6IGZhbHNlXG4gICAgICB9LCBhY3Rpb24sIHByb3ZpZGVyc0JhY2tzdGFnZSk7XG4gICAgfTtcbiAgICB2YXIgc2V0QnV0dG9uRW5hYmxlZCA9IGZ1bmN0aW9uIChidXR0b24sIGVuYWJsZWQpIHtcbiAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgIERpc2FibGluZy5lbmFibGUoYnV0dG9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIERpc2FibGluZy5kaXNhYmxlKGJ1dHRvbik7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyU2lkZUJhciA9IGZ1bmN0aW9uIChwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciB1cGRhdGVCdXR0b25VbmRvU3RhdGVzID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCB1bmRvRW5hYmxlZCwgcmVkb0VuYWJsZWQpIHtcbiAgICAgICAgbWVtVW5kby5nZXRPcHQoYW55SW5TeXN0ZW0pLmVhY2goZnVuY3Rpb24gKHVuZG8pIHtcbiAgICAgICAgICBzZXRCdXR0b25FbmFibGVkKHVuZG8sIHVuZG9FbmFibGVkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIG1lbVJlZG8uZ2V0T3B0KGFueUluU3lzdGVtKS5lYWNoKGZ1bmN0aW9uIChyZWRvKSB7XG4gICAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChyZWRvLCByZWRvRW5hYmxlZCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBtZW1VbmRvID0gcmVjb3JkKGNyZWF0ZUJ1dHRvbignVW5kbycsICd1bmRvJywgdHJ1ZSwgZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICBlbWl0V2l0aChidXR0b24sIGludGVybmFsLnVuZG8oKSwgeyBkaXJlY3Rpb246IDEgfSk7XG4gICAgICB9LCBwcm92aWRlcnNCYWNrc3RhZ2UpKTtcbiAgICAgIHZhciBtZW1SZWRvID0gcmVjb3JkKGNyZWF0ZUJ1dHRvbignUmVkbycsICdyZWRvJywgdHJ1ZSwgZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICBlbWl0V2l0aChidXR0b24sIGludGVybmFsLnJlZG8oKSwgeyBkaXJlY3Rpb246IDEgfSk7XG4gICAgICB9LCBwcm92aWRlcnNCYWNrc3RhZ2UpKTtcbiAgICAgIHZhciBjb250YWluZXIgPSBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAndG94LWltYWdlLXRvb2xzX190b29sYmFyJyxcbiAgICAgICAgICAgICd0b3gtaW1hZ2UtdG9vbHNfX3NpZGViYXInXG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgbWVtVW5kby5hc1NwZWMoKSxcbiAgICAgICAgICBtZW1SZWRvLmFzU3BlYygpLFxuICAgICAgICAgIGNyZWF0ZUJ1dHRvbignWm9vbSBpbicsICd6b29tLWluJywgZmFsc2UsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICAgIGVtaXRXaXRoKGJ1dHRvbiwgaW50ZXJuYWwuem9vbSgpLCB7IGRpcmVjdGlvbjogMSB9KTtcbiAgICAgICAgICB9LCBwcm92aWRlcnNCYWNrc3RhZ2UpLFxuICAgICAgICAgIGNyZWF0ZUJ1dHRvbignWm9vbSBvdXQnLCAnem9vbS1vdXQnLCBmYWxzZSwgZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICAgICAgZW1pdFdpdGgoYnV0dG9uLCBpbnRlcm5hbC56b29tKCksIHsgZGlyZWN0aW9uOiAtMSB9KTtcbiAgICAgICAgICB9LCBwcm92aWRlcnNCYWNrc3RhZ2UpXG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udGFpbmVyOiBjb250YWluZXIsXG4gICAgICAgIHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXM6IHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFVuZG9TdGFjayAoKSB7XG4gICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgdmFyIGluZGV4ID0gLTE7XG4gICAgICB2YXIgYWRkID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgIHZhciByZW1vdmVkID0gZGF0YS5zcGxpY2UoKytpbmRleCk7XG4gICAgICAgIGRhdGEucHVzaChzdGF0ZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhdGU6IHN0YXRlLFxuICAgICAgICAgIHJlbW92ZWQ6IHJlbW92ZWRcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgdW5kbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNhblVuZG8oKSkge1xuICAgICAgICAgIHJldHVybiBkYXRhWy0taW5kZXhdO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHJlZG8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjYW5SZWRvKCkpIHtcbiAgICAgICAgICByZXR1cm4gZGF0YVsrK2luZGV4XTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBjYW5VbmRvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaW5kZXggPiAwO1xuICAgICAgfTtcbiAgICAgIHZhciBjYW5SZWRvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaW5kZXggIT09IC0xICYmIGluZGV4IDwgZGF0YS5sZW5ndGggLSAxO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgIGFkZDogYWRkLFxuICAgICAgICB1bmRvOiB1bmRvLFxuICAgICAgICByZWRvOiByZWRvLFxuICAgICAgICBjYW5VbmRvOiBjYW5VbmRvLFxuICAgICAgICBjYW5SZWRvOiBjYW5SZWRvXG4gICAgICB9O1xuICAgIH1cblxuICAgIHZhciBtYWtlU3RhdGUgPSBmdW5jdGlvbiAoaW5pdGlhbFN0YXRlKSB7XG4gICAgICB2YXIgYmxvYlN0YXRlID0gQ2VsbChpbml0aWFsU3RhdGUpO1xuICAgICAgdmFyIHRlbXBTdGF0ZSA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciB1bmRvU3RhY2sgPSBVbmRvU3RhY2soKTtcbiAgICAgIHVuZG9TdGFjay5hZGQoaW5pdGlhbFN0YXRlKTtcbiAgICAgIHZhciBnZXRCbG9iU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBibG9iU3RhdGUuZ2V0KCk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldEJsb2JTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICBibG9iU3RhdGUuc2V0KHN0YXRlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VGVtcFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGVtcFN0YXRlLmdldCgpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBibG9iU3RhdGUuZ2V0KCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh0ZW1wKSB7XG4gICAgICAgICAgcmV0dXJuIHRlbXA7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGVUZW1wU3RhdGUgPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgICB2YXIgbmV3VGVtcFN0YXRlID0gY3JlYXRlU3RhdGUoYmxvYik7XG4gICAgICAgIGRlc3Ryb3lUZW1wU3RhdGUoKTtcbiAgICAgICAgdGVtcFN0YXRlLnNldChPcHRpb25hbC5zb21lKG5ld1RlbXBTdGF0ZSkpO1xuICAgICAgICByZXR1cm4gbmV3VGVtcFN0YXRlLnVybDtcbiAgICAgIH07XG4gICAgICB2YXIgY3JlYXRlU3RhdGUgPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJsb2I6IGJsb2IsXG4gICAgICAgICAgdXJsOiBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGRlc3Ryb3lTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHN0YXRlLnVybCk7XG4gICAgICB9O1xuICAgICAgdmFyIGRlc3Ryb3lTdGF0ZXMgPSBmdW5jdGlvbiAoc3RhdGVzKSB7XG4gICAgICAgIGdsb2JhbCRjLmVhY2goc3RhdGVzLCBkZXN0cm95U3RhdGUpO1xuICAgICAgfTtcbiAgICAgIHZhciBkZXN0cm95VGVtcFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0ZW1wU3RhdGUuZ2V0KCkuZWFjaChkZXN0cm95U3RhdGUpO1xuICAgICAgICB0ZW1wU3RhdGUuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGFkZEJsb2JTdGF0ZSA9IGZ1bmN0aW9uIChibG9iKSB7XG4gICAgICAgIHZhciBuZXdTdGF0ZSA9IGNyZWF0ZVN0YXRlKGJsb2IpO1xuICAgICAgICBzZXRCbG9iU3RhdGUobmV3U3RhdGUpO1xuICAgICAgICB2YXIgcmVtb3ZlZCA9IHVuZG9TdGFjay5hZGQobmV3U3RhdGUpLnJlbW92ZWQ7XG4gICAgICAgIGRlc3Ryb3lTdGF0ZXMocmVtb3ZlZCk7XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZS51cmw7XG4gICAgICB9O1xuICAgICAgdmFyIGFkZFRlbXBTdGF0ZSA9IGZ1bmN0aW9uIChibG9iKSB7XG4gICAgICAgIHZhciBuZXdTdGF0ZSA9IGNyZWF0ZVN0YXRlKGJsb2IpO1xuICAgICAgICB0ZW1wU3RhdGUuc2V0KE9wdGlvbmFsLnNvbWUobmV3U3RhdGUpKTtcbiAgICAgICAgcmV0dXJuIG5ld1N0YXRlLnVybDtcbiAgICAgIH07XG4gICAgICB2YXIgYXBwbHlUZW1wU3RhdGUgPSBmdW5jdGlvbiAocG9zdEFwcGx5KSB7XG4gICAgICAgIHJldHVybiB0ZW1wU3RhdGUuZ2V0KCkuZm9sZChub29wLCBmdW5jdGlvbiAodGVtcCkge1xuICAgICAgICAgIGFkZEJsb2JTdGF0ZSh0ZW1wLmJsb2IpO1xuICAgICAgICAgIHBvc3RBcHBseSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdW5kbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IHVuZG9TdGFjay51bmRvKCk7XG4gICAgICAgIHNldEJsb2JTdGF0ZShjdXJyZW50U3RhdGUpO1xuICAgICAgICByZXR1cm4gY3VycmVudFN0YXRlLnVybDtcbiAgICAgIH07XG4gICAgICB2YXIgcmVkbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IHVuZG9TdGFjay5yZWRvKCk7XG4gICAgICAgIHNldEJsb2JTdGF0ZShjdXJyZW50U3RhdGUpO1xuICAgICAgICByZXR1cm4gY3VycmVudFN0YXRlLnVybDtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0SGlzdG9yeVN0YXRlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHVuZG9FbmFibGVkID0gdW5kb1N0YWNrLmNhblVuZG8oKTtcbiAgICAgICAgdmFyIHJlZG9FbmFibGVkID0gdW5kb1N0YWNrLmNhblJlZG8oKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1bmRvRW5hYmxlZDogdW5kb0VuYWJsZWQsXG4gICAgICAgICAgcmVkb0VuYWJsZWQ6IHJlZG9FbmFibGVkXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0QmxvYlN0YXRlOiBnZXRCbG9iU3RhdGUsXG4gICAgICAgIHNldEJsb2JTdGF0ZTogc2V0QmxvYlN0YXRlLFxuICAgICAgICBhZGRCbG9iU3RhdGU6IGFkZEJsb2JTdGF0ZSxcbiAgICAgICAgZ2V0VGVtcFN0YXRlOiBnZXRUZW1wU3RhdGUsXG4gICAgICAgIHVwZGF0ZVRlbXBTdGF0ZTogdXBkYXRlVGVtcFN0YXRlLFxuICAgICAgICBhZGRUZW1wU3RhdGU6IGFkZFRlbXBTdGF0ZSxcbiAgICAgICAgYXBwbHlUZW1wU3RhdGU6IGFwcGx5VGVtcFN0YXRlLFxuICAgICAgICBkZXN0cm95VGVtcFN0YXRlOiBkZXN0cm95VGVtcFN0YXRlLFxuICAgICAgICB1bmRvOiB1bmRvLFxuICAgICAgICByZWRvOiByZWRvLFxuICAgICAgICBnZXRIaXN0b3J5U3RhdGVzOiBnZXRIaXN0b3J5U3RhdGVzXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVySW1hZ2VUb29scyA9IGZ1bmN0aW9uIChkZXRhaWwsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgdmFyIHN0YXRlID0gbWFrZVN0YXRlKGRldGFpbC5jdXJyZW50U3RhdGUpO1xuICAgICAgdmFyIHpvb20gPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHZhciBkaXJlY3Rpb24gPSBzaW11bGF0ZWRFdmVudC5ldmVudC5kaXJlY3Rpb247XG4gICAgICAgIGltYWdlUGFuZWwuem9vbShhbnlJblN5c3RlbSwgZGlyZWN0aW9uKTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlQnV0dG9uVW5kb1N0YXRlcyA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICB2YXIgaGlzdG9yeVN0YXRlcyA9IHN0YXRlLmdldEhpc3RvcnlTdGF0ZXMoKTtcbiAgICAgICAgc2lkZUJhci51cGRhdGVCdXR0b25VbmRvU3RhdGVzKGFueUluU3lzdGVtLCBoaXN0b3J5U3RhdGVzLnVuZG9FbmFibGVkLCBoaXN0b3J5U3RhdGVzLnJlZG9FbmFibGVkKTtcbiAgICAgICAgZW1pdFdpdGgoYW55SW5TeXN0ZW0sIGV4dGVybmFsJDIuZm9ybUFjdGlvbkV2ZW50LCB7XG4gICAgICAgICAgbmFtZTogZXh0ZXJuYWwkMi5zYXZlU3RhdGUoKSxcbiAgICAgICAgICB2YWx1ZTogaGlzdG9yeVN0YXRlcy51bmRvRW5hYmxlZFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZGlzYWJsZVVuZG9SZWRvID0gZnVuY3Rpb24gKGFueUluU3lzdGVtKSB7XG4gICAgICAgIHNpZGVCYXIudXBkYXRlQnV0dG9uVW5kb1N0YXRlcyhhbnlJblN5c3RlbSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgIH07XG4gICAgICB2YXIgdW5kbyA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHZhciB1cmwgPSBzdGF0ZS51bmRvKCk7XG4gICAgICAgIHVwZGF0ZVNyYyhhbnlJblN5c3RlbSwgdXJsKS50aGVuKGZ1bmN0aW9uIChfb0ltZykge1xuICAgICAgICAgIHVuYmxvY2soYW55SW5TeXN0ZW0pO1xuICAgICAgICAgIHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXMoYW55SW5TeXN0ZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVkbyA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHZhciB1cmwgPSBzdGF0ZS5yZWRvKCk7XG4gICAgICAgIHVwZGF0ZVNyYyhhbnlJblN5c3RlbSwgdXJsKS50aGVuKGZ1bmN0aW9uIChfb0ltZykge1xuICAgICAgICAgIHVuYmxvY2soYW55SW5TeXN0ZW0pO1xuICAgICAgICAgIHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXMoYW55SW5TeXN0ZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgaW1hZ2VSZXN1bHRUb0Jsb2IgPSBmdW5jdGlvbiAoaXIpIHtcbiAgICAgICAgcmV0dXJuIGlyLnRvQmxvYigpO1xuICAgICAgfTtcbiAgICAgIHZhciBibG9jayA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICBlbWl0V2l0aChhbnlJblN5c3RlbSwgZXh0ZXJuYWwkMi5mb3JtQWN0aW9uRXZlbnQsIHtcbiAgICAgICAgICBuYW1lOiBleHRlcm5hbCQyLmRpc2FibGUoKSxcbiAgICAgICAgICB2YWx1ZToge31cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHVuYmxvY2sgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0pIHtcbiAgICAgICAgZWRpdFBhbmVsLmdldEFwcGx5QnV0dG9uKGFueUluU3lzdGVtKS5lYWNoKGZ1bmN0aW9uIChhcHBseUJ1dHRvbikge1xuICAgICAgICAgIERpc2FibGluZy5lbmFibGUoYXBwbHlCdXR0b24pO1xuICAgICAgICB9KTtcbiAgICAgICAgZW1pdFdpdGgoYW55SW5TeXN0ZW0sIGV4dGVybmFsJDIuZm9ybUFjdGlvbkV2ZW50LCB7XG4gICAgICAgICAgbmFtZTogZXh0ZXJuYWwkMi5lbmFibGUoKSxcbiAgICAgICAgICB2YWx1ZToge31cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZVNyYyA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgc3JjKSB7XG4gICAgICAgIGJsb2NrKGFueUluU3lzdGVtKTtcbiAgICAgICAgcmV0dXJuIGltYWdlUGFuZWwudXBkYXRlU3JjKGFueUluU3lzdGVtLCBzcmMpO1xuICAgICAgfTtcbiAgICAgIHZhciBibG9iTWFuaXB1bGF0ZSA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSwgYmxvYiwgZmlsdGVyLCBhY3Rpb24sIHN3YXApIHtcbiAgICAgICAgYmxvY2soYW55SW5TeXN0ZW0pO1xuICAgICAgICByZXR1cm4gYmxvYlRvSW1hZ2VSZXN1bHQoYmxvYikudGhlbihmaWx0ZXIpLnRoZW4oaW1hZ2VSZXN1bHRUb0Jsb2IpLnRoZW4oYWN0aW9uKS50aGVuKGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICByZXR1cm4gdXBkYXRlU3JjKGFueUluU3lzdGVtLCB1cmwpLnRoZW4oZnVuY3Rpb24gKG9JbWcpIHtcbiAgICAgICAgICAgIHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXMoYW55SW5TeXN0ZW0pO1xuICAgICAgICAgICAgc3dhcCgpO1xuICAgICAgICAgICAgdW5ibG9jayhhbnlJblN5c3RlbSk7XG4gICAgICAgICAgICByZXR1cm4gb0ltZztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgdW5ibG9jayhhbnlJblN5c3RlbSk7XG4gICAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1hbmlwdWxhdGUgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIGZpbHRlciwgc3dhcCkge1xuICAgICAgICB2YXIgYmxvYiA9IHN0YXRlLmdldEJsb2JTdGF0ZSgpLmJsb2I7XG4gICAgICAgIHZhciBhY3Rpb24gPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgICAgIHJldHVybiBzdGF0ZS51cGRhdGVUZW1wU3RhdGUoYmxvYik7XG4gICAgICAgIH07XG4gICAgICAgIGJsb2JNYW5pcHVsYXRlKGFueUluU3lzdGVtLCBibG9iLCBmaWx0ZXIsIGFjdGlvbiwgc3dhcCk7XG4gICAgICB9O1xuICAgICAgdmFyIHRlbXBNYW5pcHVsYXRlID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCBmaWx0ZXIpIHtcbiAgICAgICAgdmFyIGJsb2IgPSBzdGF0ZS5nZXRUZW1wU3RhdGUoKS5ibG9iO1xuICAgICAgICB2YXIgYWN0aW9uID0gZnVuY3Rpb24gKGJsb2IpIHtcbiAgICAgICAgICByZXR1cm4gc3RhdGUuYWRkVGVtcFN0YXRlKGJsb2IpO1xuICAgICAgICB9O1xuICAgICAgICBibG9iTWFuaXB1bGF0ZShhbnlJblN5c3RlbSwgYmxvYiwgZmlsdGVyLCBhY3Rpb24sIG5vb3ApO1xuICAgICAgfTtcbiAgICAgIHZhciBtYW5pcHVsYXRlQXBwbHkgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIGZpbHRlciwgc3dhcCkge1xuICAgICAgICB2YXIgYmxvYiA9IHN0YXRlLmdldEJsb2JTdGF0ZSgpLmJsb2I7XG4gICAgICAgIHZhciBhY3Rpb24gPSBmdW5jdGlvbiAoYmxvYikge1xuICAgICAgICAgIHZhciB1cmwgPSBzdGF0ZS5hZGRCbG9iU3RhdGUoYmxvYik7XG4gICAgICAgICAgZGVzdHJveVRlbXBTdGF0ZShhbnlJblN5c3RlbSk7XG4gICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfTtcbiAgICAgICAgYmxvYk1hbmlwdWxhdGUoYW55SW5TeXN0ZW0sIGJsb2IsIGZpbHRlciwgYWN0aW9uLCBzd2FwKTtcbiAgICAgIH07XG4gICAgICB2YXIgYXBwbHkgPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHZhciBwb3N0QXBwbHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZGVzdHJveVRlbXBTdGF0ZShhbnlJblN5c3RlbSk7XG4gICAgICAgICAgdmFyIHN3YXAgPSBzaW11bGF0ZWRFdmVudC5ldmVudC5zd2FwO1xuICAgICAgICAgIHN3YXAoKTtcbiAgICAgICAgfTtcbiAgICAgICAgc3RhdGUuYXBwbHlUZW1wU3RhdGUocG9zdEFwcGx5KTtcbiAgICAgIH07XG4gICAgICB2YXIgZGVzdHJveVRlbXBTdGF0ZSA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICB2YXIgY3VycmVudFVybCA9IHN0YXRlLmdldEJsb2JTdGF0ZSgpLnVybDtcbiAgICAgICAgc3RhdGUuZGVzdHJveVRlbXBTdGF0ZSgpO1xuICAgICAgICB1cGRhdGVCdXR0b25VbmRvU3RhdGVzKGFueUluU3lzdGVtKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRVcmw7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbmNlbCA9IGZ1bmN0aW9uIChhbnlJblN5c3RlbSkge1xuICAgICAgICB2YXIgY3VycmVudFVybCA9IGRlc3Ryb3lUZW1wU3RhdGUoYW55SW5TeXN0ZW0pO1xuICAgICAgICB1cGRhdGVTcmMoYW55SW5TeXN0ZW0sIGN1cnJlbnRVcmwpLnRoZW4oZnVuY3Rpb24gKF9vSW1nKSB7XG4gICAgICAgICAgdW5ibG9jayhhbnlJblN5c3RlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBiYWNrID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICBjYW5jZWwoYW55SW5TeXN0ZW0pO1xuICAgICAgICB2YXIgc3dhcCA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50LnN3YXA7XG4gICAgICAgIHN3YXAoKTtcbiAgICAgICAgaW1hZ2VQYW5lbC5oaWRlQ3JvcCgpO1xuICAgICAgfTtcbiAgICAgIHZhciB0cmFuc2Zvcm0gPSBmdW5jdGlvbiAoYW55SW5TeXN0ZW0sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgIHJldHVybiBtYW5pcHVsYXRlKGFueUluU3lzdGVtLCBzaW11bGF0ZWRFdmVudC5ldmVudC50cmFuc2Zvcm0sIG5vb3ApO1xuICAgICAgfTtcbiAgICAgIHZhciB0ZW1wVHJhbnNmb3JtID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICByZXR1cm4gdGVtcE1hbmlwdWxhdGUoYW55SW5TeXN0ZW0sIHNpbXVsYXRlZEV2ZW50LmV2ZW50LnRyYW5zZm9ybSk7XG4gICAgICB9O1xuICAgICAgdmFyIHRyYW5zZm9ybUFwcGx5ID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICByZXR1cm4gbWFuaXB1bGF0ZUFwcGx5KGFueUluU3lzdGVtLCBzaW11bGF0ZWRFdmVudC5ldmVudC50cmFuc2Zvcm0sIHNpbXVsYXRlZEV2ZW50LmV2ZW50LnN3YXApO1xuICAgICAgfTtcbiAgICAgIHZhciBpbWFnZVBhbmVsID0gcmVuZGVySW1hZ2VQYW5lbChkZXRhaWwuY3VycmVudFN0YXRlLnVybCk7XG4gICAgICB2YXIgc2lkZUJhciA9IHJlbmRlclNpZGVCYXIocHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICAgIHZhciBlZGl0UGFuZWwgPSByZW5kZXJFZGl0UGFuZWwoaW1hZ2VQYW5lbCwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICAgIHZhciBzd2FwID0gZnVuY3Rpb24gKGFueUluU3lzdGVtLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICBkaXNhYmxlVW5kb1JlZG8oYW55SW5TeXN0ZW0pO1xuICAgICAgICB2YXIgdHJhbnNmb3JtID0gc2ltdWxhdGVkRXZlbnQuZXZlbnQudHJhbnNmb3JtO1xuICAgICAgICB2YXIgc3dhcCA9IHNpbXVsYXRlZEV2ZW50LmV2ZW50LnN3YXA7XG4gICAgICAgIHRyYW5zZm9ybS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzd2FwKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh0cmFuc2Zvcm0pIHtcbiAgICAgICAgICBtYW5pcHVsYXRlKGFueUluU3lzdGVtLCB0cmFuc2Zvcm0sIHN3YXApO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3ByZXNlbnRhdGlvbicgfVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgZWRpdFBhbmVsLm1lbUNvbnRhaW5lci5hc1NwZWMoKSxcbiAgICAgICAgICBpbWFnZVBhbmVsLm1lbUNvbnRhaW5lci5hc1NwZWMoKSxcbiAgICAgICAgICBzaWRlQmFyLmNvbnRhaW5lclxuICAgICAgICBdLFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuZ2V0QmxvYlN0YXRlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjb25maWcoJ2ltYWdlLXRvb2xzLWV2ZW50cycsIFtcbiAgICAgICAgICAgIHJ1bihpbnRlcm5hbC51bmRvKCksIHVuZG8pLFxuICAgICAgICAgICAgcnVuKGludGVybmFsLnJlZG8oKSwgcmVkbyksXG4gICAgICAgICAgICBydW4oaW50ZXJuYWwuem9vbSgpLCB6b29tKSxcbiAgICAgICAgICAgIHJ1bihpbnRlcm5hbC5iYWNrKCksIGJhY2spLFxuICAgICAgICAgICAgcnVuKGludGVybmFsLmFwcGx5KCksIGFwcGx5KSxcbiAgICAgICAgICAgIHJ1bihpbnRlcm5hbC50cmFuc2Zvcm0oKSwgdHJhbnNmb3JtKSxcbiAgICAgICAgICAgIHJ1bihpbnRlcm5hbC50ZW1wVHJhbnNmb3JtKCksIHRlbXBUcmFuc2Zvcm0pLFxuICAgICAgICAgICAgcnVuKGludGVybmFsLnRyYW5zZm9ybUFwcGx5KCksIHRyYW5zZm9ybUFwcGx5KSxcbiAgICAgICAgICAgIHJ1bihpbnRlcm5hbC5zd2FwKCksIHN3YXApXG4gICAgICAgICAgXSksXG4gICAgICAgICAgQ29tcG9zaW5nQ29uZmlncy5zZWxmKClcbiAgICAgICAgXSlcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJMYWJlbCQyID0gZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZVNoYXJlZCkge1xuICAgICAgdmFyIGxhYmVsID0ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdsYWJlbCcsXG4gICAgICAgICAgaW5uZXJIdG1sOiBiYWNrc3RhZ2VTaGFyZWQucHJvdmlkZXJzLnRyYW5zbGF0ZShzcGVjLmxhYmVsKSxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1sYWJlbCddXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgY29tcHMgPSBtYXAoc3BlYy5pdGVtcywgYmFja3N0YWdlU2hhcmVkLmludGVycHJldGVyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtZm9ybV9fZ3JvdXAnXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbbGFiZWxdLmNvbmNhdChjb21wcyksXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBDb21wb3NpbmdDb25maWdzLnNlbGYoKSxcbiAgICAgICAgICBSZXBsYWNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBSZXByZXNlbnRpbmdDb25maWdzLmRvbUh0bWwoT3B0aW9uYWwubm9uZSgpKSxcbiAgICAgICAgICBLZXlpbmcuY29uZmlnKHsgbW9kZTogJ2FjeWNsaWMnIH0pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgaXNTaW5nbGVMaXN0SXRlbSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gIWhhcyhpdGVtLCAnaXRlbXMnKTtcbiAgICB9O1xuICAgIHZhciBkYXRhQXR0cmlidXRlID0gJ2RhdGEtdmFsdWUnO1xuICAgIHZhciBmZXRjaEl0ZW1zID0gZnVuY3Rpb24gKGRyb3Bkb3duQ29tcCwgbmFtZSwgaXRlbXMsIHNlbGVjdGVkVmFsdWUpIHtcbiAgICAgIHJldHVybiBtYXAoaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIGlmICghaXNTaW5nbGVMaXN0SXRlbShpdGVtKSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiAnbmVzdGVkbWVudWl0ZW0nLFxuICAgICAgICAgICAgdGV4dDogaXRlbS50ZXh0LFxuICAgICAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmZXRjaEl0ZW1zKGRyb3Bkb3duQ29tcCwgbmFtZSwgaXRlbS5pdGVtcywgc2VsZWN0ZWRWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ3RvZ2dsZW1lbnVpdGVtJyxcbiAgICAgICAgICAgIHRleHQ6IGl0ZW0udGV4dCxcbiAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgYWN0aXZlOiBpdGVtLnZhbHVlID09PSBzZWxlY3RlZFZhbHVlLFxuICAgICAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGRyb3Bkb3duQ29tcCwgaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICAgIGVtaXRXaXRoKGRyb3Bkb3duQ29tcCwgZm9ybUNoYW5nZUV2ZW50LCB7IG5hbWU6IG5hbWUgfSk7XG4gICAgICAgICAgICAgIEZvY3VzaW5nLmZvY3VzKGRyb3Bkb3duQ29tcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmluZEl0ZW1CeVZhbHVlID0gZnVuY3Rpb24gKGl0ZW1zLCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIGZpbmRNYXAoaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIGlmICghaXNTaW5nbGVMaXN0SXRlbShpdGVtKSkge1xuICAgICAgICAgIHJldHVybiBmaW5kSXRlbUJ5VmFsdWUoaXRlbS5pdGVtcywgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBzb21lSWYoaXRlbS52YWx1ZSA9PT0gdmFsdWUsIGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJMaXN0Qm94ID0gZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgdmFyIHByb3ZpZGVyc0JhY2tzdGFnZSA9IGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzO1xuICAgICAgdmFyIGluaXRpYWxJdGVtID0gaGVhZChzcGVjLml0ZW1zKS5maWx0ZXIoaXNTaW5nbGVMaXN0SXRlbSk7XG4gICAgICB2YXIgcExhYmVsID0gc3BlYy5sYWJlbC5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJMYWJlbChsYWJlbCwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHBGaWVsZCA9IEZvcm1GaWVsZC5wYXJ0cy5maWVsZCh7XG4gICAgICAgIGRvbToge30sXG4gICAgICAgIGZhY3Rvcnk6IHtcbiAgICAgICAgICBza2V0Y2g6IGZ1bmN0aW9uIChza2V0Y2hTcGVjKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyQ29tbW9uRHJvcGRvd24oe1xuICAgICAgICAgICAgICB1aWQ6IHNrZXRjaFNwZWMudWlkLFxuICAgICAgICAgICAgICB0ZXh0OiBpbml0aWFsSXRlbS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS50ZXh0O1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgaWNvbjogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgICAgICB0b29sdGlwOiBzcGVjLmxhYmVsLFxuICAgICAgICAgICAgICByb2xlOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgICAgICAgIGZldGNoOiBmdW5jdGlvbiAoY29tcCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBmZXRjaEl0ZW1zKGNvbXAsIHNwZWMubmFtZSwgc3BlYy5pdGVtcywgUmVwcmVzZW50aW5nLmdldFZhbHVlKGNvbXApKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhidWlsZCQyKGl0ZW1zLCBJdGVtUmVzcG9uc2UkMS5DTE9TRV9PTl9FWEVDVVRFLCBiYWNrc3RhZ2UsIGZhbHNlKSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIG9uU2V0dXA6IGNvbnN0YW50KG5vb3ApLFxuICAgICAgICAgICAgICBnZXRBcGk6IGNvbnN0YW50KHt9KSxcbiAgICAgICAgICAgICAgY29sdW1uczogMSxcbiAgICAgICAgICAgICAgcHJlc2V0czogJ25vcm1hbCcsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFtdLFxuICAgICAgICAgICAgICBkcm9wZG93bkJlaGF2aW91cnM6IFtcbiAgICAgICAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgICAgICAgIFJlcHJlc2VudGluZy5jb25maWcoe1xuICAgICAgICAgICAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ21hbnVhbCcsXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogaW5pdGlhbEl0ZW0ubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIH0pLmdldE9yKCcnKSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldCQzKGNvbXAuZWxlbWVudCwgZGF0YUF0dHJpYnV0ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoY29tcCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgIGZpbmRJdGVtQnlWYWx1ZShzcGVjLml0ZW1zLCBkYXRhKS5lYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXQkMShjb21wLmVsZW1lbnQsIGRhdGFBdHRyaWJ1dGUsIGl0ZW0udmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcCwgdXBkYXRlTWVudVRleHQsIHsgdGV4dDogaXRlbS50ZXh0IH0pO1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSwgJ3RveC1saXN0Ym94JywgYmFja3N0YWdlLnNoYXJlZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBsaXN0Qm94V3JhcCA9IHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1saXN0Ym94ZmllbGQnXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbcEZpZWxkXVxuICAgICAgfTtcbiAgICAgIHJldHVybiBGb3JtRmllbGQuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtX19ncm91cCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IGZsYXR0ZW4oW1xuICAgICAgICAgIHBMYWJlbC50b0FycmF5KCksXG4gICAgICAgICAgW2xpc3RCb3hXcmFwXVxuICAgICAgICBdKSxcbiAgICAgICAgZmllbGRCZWhhdmlvdXJzOiBkZXJpdmUkMShbRGlzYWJsaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBkaXNhYmxlZDogY29uc3RhbnQoc3BlYy5kaXNhYmxlZCksXG4gICAgICAgICAgICBvbkRpc2FibGVkOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICBGb3JtRmllbGQuZ2V0RmllbGQoY29tcCkuZWFjaChEaXNhYmxpbmcuZGlzYWJsZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FbmFibGVkOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICBGb3JtRmllbGQuZ2V0RmllbGQoY29tcCkuZWFjaChEaXNhYmxpbmcuZW5hYmxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KV0pXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlclBhbmVsID0gZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBzcGVjLmNsYXNzZXNcbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogbWFwKHNwZWMuaXRlbXMsIGJhY2tzdGFnZS5zaGFyZWQuaW50ZXJwcmV0ZXIpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZmFjdG9yeSQ4ID0gZnVuY3Rpb24gKGRldGFpbCwgX3NwZWMpIHtcbiAgICAgIHZhciBvcHRpb25zID0gbWFwKGRldGFpbC5vcHRpb25zLCBmdW5jdGlvbiAob3B0aW9uKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdvcHRpb24nLFxuICAgICAgICAgICAgdmFsdWU6IG9wdGlvbi52YWx1ZSxcbiAgICAgICAgICAgIGlubmVySHRtbDogb3B0aW9uLnRleHRcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHZhciBpbml0aWFsVmFsdWVzID0gZGV0YWlsLmRhdGEubWFwKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHJldHVybiB3cmFwJDEoJ2luaXRpYWxWYWx1ZScsIHYpO1xuICAgICAgfSkuZ2V0T3Ioe30pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdzZWxlY3QnLFxuICAgICAgICAgIGNsYXNzZXM6IGRldGFpbC5zZWxlY3RDbGFzc2VzLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IGRldGFpbC5zZWxlY3RBdHRyaWJ1dGVzXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IG9wdGlvbnMsXG4gICAgICAgIGJlaGF2aW91cnM6IGF1Z21lbnQoZGV0YWlsLnNlbGVjdEJlaGF2aW91cnMsIFtcbiAgICAgICAgICBGb2N1c2luZy5jb25maWcoe30pLFxuICAgICAgICAgIFJlcHJlc2VudGluZy5jb25maWcoe1xuICAgICAgICAgICAgc3RvcmU6IF9fYXNzaWduKHtcbiAgICAgICAgICAgICAgbW9kZTogJ21hbnVhbCcsXG4gICAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoc2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldCQ2KHNlbGVjdC5lbGVtZW50KTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIChzZWxlY3QsIG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmluZChkZXRhaWwub3B0aW9ucywgZnVuY3Rpb24gKG9wdCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdC52YWx1ZSA9PT0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kLmlzU29tZSgpKSB7XG4gICAgICAgICAgICAgICAgICBzZXQkMyhzZWxlY3QuZWxlbWVudCwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgaW5pdGlhbFZhbHVlcylcbiAgICAgICAgICB9KVxuICAgICAgICBdKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBIdG1sU2VsZWN0ID0gc2luZ2xlJDIoe1xuICAgICAgbmFtZTogJ0h0bWxTZWxlY3QnLFxuICAgICAgY29uZmlnRmllbGRzOiBbXG4gICAgICAgIHN0cmljdCQxKCdvcHRpb25zJyksXG4gICAgICAgIGZpZWxkJDEoJ3NlbGVjdEJlaGF2aW91cnMnLCBbXG4gICAgICAgICAgRm9jdXNpbmcsXG4gICAgICAgICAgUmVwcmVzZW50aW5nXG4gICAgICAgIF0pLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnc2VsZWN0Q2xhc3NlcycsIFtdKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ3NlbGVjdEF0dHJpYnV0ZXMnLCB7fSksXG4gICAgICAgIG9wdGlvbignZGF0YScpXG4gICAgICBdLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSQ4XG4gICAgfSk7XG5cbiAgICB2YXIgcmVuZGVyU2VsZWN0Qm94ID0gZnVuY3Rpb24gKHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgdmFyIHRyYW5zbGF0ZWRPcHRpb25zID0gbWFwKHNwZWMuaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGV4dDogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZShpdGVtLnRleHQpLFxuICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHZhciBwTGFiZWwgPSBzcGVjLmxhYmVsLm1hcChmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckxhYmVsKGxhYmVsLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgfSk7XG4gICAgICB2YXIgcEZpZWxkID0gRm9ybUZpZWxkLnBhcnRzLmZpZWxkKHtcbiAgICAgICAgZG9tOiB7fSxcbiAgICAgICAgc2VsZWN0QXR0cmlidXRlczogeyBzaXplOiBzcGVjLnNpemUgfSxcbiAgICAgICAgb3B0aW9uczogdHJhbnNsYXRlZE9wdGlvbnMsXG4gICAgICAgIGZhY3Rvcnk6IEh0bWxTZWxlY3QsXG4gICAgICAgIHNlbGVjdEJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBjb25maWcoJ3NlbGVjdGJveC1jaGFuZ2UnLCBbcnVuKGNoYW5nZSgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBfKSB7XG4gICAgICAgICAgICAgIGVtaXRXaXRoKGNvbXBvbmVudCwgZm9ybUNoYW5nZUV2ZW50LCB7IG5hbWU6IHNwZWMubmFtZSB9KTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgXSlcbiAgICAgIH0pO1xuICAgICAgdmFyIGNoZXZyb24gPSBzcGVjLnNpemUgPiAxID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuc29tZSh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtc2VsZWN0ZmllbGRfX2ljb24tanMnXSxcbiAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCdjaGV2cm9uLWRvd24nLCBwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIHNlbGVjdFdyYXAgPSB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtc2VsZWN0ZmllbGQnXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBmbGF0dGVuKFtcbiAgICAgICAgICBbcEZpZWxkXSxcbiAgICAgICAgICBjaGV2cm9uLnRvQXJyYXkoKVxuICAgICAgICBdKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBGb3JtRmllbGQuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtX19ncm91cCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IGZsYXR0ZW4oW1xuICAgICAgICAgIHBMYWJlbC50b0FycmF5KCksXG4gICAgICAgICAgW3NlbGVjdFdyYXBdXG4gICAgICAgIF0pLFxuICAgICAgICBmaWVsZEJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goRGlzYWJsaW5nLmVuYWJsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcmVjZWl2aW5nQ29uZmlnKClcbiAgICAgICAgXSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyVGFibGUgPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgcmVuZGVyVGggPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAndGgnLFxuICAgICAgICAgICAgaW5uZXJIdG1sOiBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKHRleHQpXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciByZW5kZXJIZWFkZXIgPSBmdW5jdGlvbiAoaGVhZGVyKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7IHRhZzogJ3RoZWFkJyB9LFxuICAgICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICAgIGRvbTogeyB0YWc6ICd0cicgfSxcbiAgICAgICAgICAgICAgY29tcG9uZW50czogbWFwKGhlYWRlciwgcmVuZGVyVGgpXG4gICAgICAgICAgICB9XVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciByZW5kZXJUZCA9IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICd0ZCcsXG4gICAgICAgICAgICBpbm5lckh0bWw6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUodGV4dClcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIHJlbmRlclRyID0gZnVuY3Rpb24gKHJvdykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRvbTogeyB0YWc6ICd0cicgfSxcbiAgICAgICAgICBjb21wb25lbnRzOiBtYXAocm93LCByZW5kZXJUZClcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVuZGVyUm93cyA9IGZ1bmN0aW9uIChyb3dzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7IHRhZzogJ3Rib2R5JyB9LFxuICAgICAgICAgIGNvbXBvbmVudHM6IG1hcChyb3dzLCByZW5kZXJUcilcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICd0YWJsZScsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtZGlhbG9nX190YWJsZSddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICByZW5kZXJIZWFkZXIoc3BlYy5oZWFkZXIpLFxuICAgICAgICAgIHJlbmRlclJvd3Moc3BlYy5jZWxscylcbiAgICAgICAgXSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIFRhYnN0b3BwaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KVxuICAgICAgICBdKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlclRleHRGaWVsZCA9IGZ1bmN0aW9uIChzcGVjLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBwTGFiZWwgPSBzcGVjLmxhYmVsLm1hcChmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckxhYmVsKGxhYmVsLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgfSk7XG4gICAgICB2YXIgYmFzZUlucHV0QmVoYXZpb3VycyA9IFtcbiAgICAgICAgRGlzYWJsaW5nLmNvbmZpZyh7XG4gICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgcmVjZWl2aW5nQ29uZmlnKCksXG4gICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgIG1vZGU6ICdleGVjdXRpb24nLFxuICAgICAgICAgIHVzZUVudGVyOiBzcGVjLm11bHRpbGluZSAhPT0gdHJ1ZSxcbiAgICAgICAgICB1c2VDb250cm9sRW50ZXI6IHNwZWMubXVsdGlsaW5lID09PSB0cnVlLFxuICAgICAgICAgIGV4ZWN1dGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICBlbWl0KGNvbXAsIGZvcm1TdWJtaXRFdmVudCk7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBjb25maWcoJ3RleHRmaWVsZC1jaGFuZ2UnLCBbXG4gICAgICAgICAgcnVuKGlucHV0KCksIGZ1bmN0aW9uIChjb21wb25lbnQsIF8pIHtcbiAgICAgICAgICAgIGVtaXRXaXRoKGNvbXBvbmVudCwgZm9ybUNoYW5nZUV2ZW50LCB7IG5hbWU6IHNwZWMubmFtZSB9KTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBydW4ocG9zdFBhc3RlKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIF8pIHtcbiAgICAgICAgICAgIGVtaXRXaXRoKGNvbXBvbmVudCwgZm9ybUNoYW5nZUV2ZW50LCB7IG5hbWU6IHNwZWMubmFtZSB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICBdKSxcbiAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KVxuICAgICAgXTtcbiAgICAgIHZhciB2YWxpZGF0aW5nQmVoYXZpb3VycyA9IHNwZWMudmFsaWRhdGlvbi5tYXAoZnVuY3Rpb24gKHZsKSB7XG4gICAgICAgIHJldHVybiBJbnZhbGlkYXRpbmcuY29uZmlnKHtcbiAgICAgICAgICBnZXRSb290OiBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQoaW5wdXQuZWxlbWVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbnZhbGlkQ2xhc3M6ICd0b3gtaW52YWxpZCcsXG4gICAgICAgICAgdmFsaWRhdG9yOiB7XG4gICAgICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICAgIHZhciB2ID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGlucHV0KTtcbiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHZsLnZhbGlkYXRvcih2KTtcbiAgICAgICAgICAgICAgcmV0dXJuIEZ1dHVyZS5wdXJlKHJlc3VsdCA9PT0gdHJ1ZSA/IFJlc3VsdC52YWx1ZSh2KSA6IFJlc3VsdC5lcnJvcihyZXN1bHQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2YWxpZGF0ZU9uTG9hZDogdmwudmFsaWRhdGVPbkxvYWRcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSkudG9BcnJheSgpO1xuICAgICAgdmFyIHBsYWNlaG9sZGVyID0gc3BlYy5wbGFjZWhvbGRlci5mb2xkKGNvbnN0YW50KHt9KSwgZnVuY3Rpb24gKHApIHtcbiAgICAgICAgcmV0dXJuIHsgcGxhY2Vob2xkZXI6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUocCkgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGlucHV0TW9kZSA9IHNwZWMuaW5wdXRNb2RlLmZvbGQoY29uc3RhbnQoe30pLCBmdW5jdGlvbiAobW9kZSkge1xuICAgICAgICByZXR1cm4geyBpbnB1dG1vZGU6IG1vZGUgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGlucHV0QXR0cmlidXRlcyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBwbGFjZWhvbGRlciksIGlucHV0TW9kZSk7XG4gICAgICB2YXIgcEZpZWxkID0gRm9ybUZpZWxkLnBhcnRzLmZpZWxkKHtcbiAgICAgICAgdGFnOiBzcGVjLm11bHRpbGluZSA9PT0gdHJ1ZSA/ICd0ZXh0YXJlYScgOiAnaW5wdXQnLFxuICAgICAgICBpbnB1dEF0dHJpYnV0ZXM6IGlucHV0QXR0cmlidXRlcyxcbiAgICAgICAgaW5wdXRDbGFzc2VzOiBbc3BlYy5jbGFzc25hbWVdLFxuICAgICAgICBpbnB1dEJlaGF2aW91cnM6IGRlcml2ZSQxKGZsYXR0ZW4oW1xuICAgICAgICAgIGJhc2VJbnB1dEJlaGF2aW91cnMsXG4gICAgICAgICAgdmFsaWRhdGluZ0JlaGF2aW91cnNcbiAgICAgICAgXSkpLFxuICAgICAgICBzZWxlY3RPbkZvY3VzOiBmYWxzZSxcbiAgICAgICAgZmFjdG9yeTogSW5wdXRcbiAgICAgIH0pO1xuICAgICAgdmFyIGV4dHJhQ2xhc3NlcyA9IHNwZWMuZmxleCA/IFsndG94LWZvcm1fX2dyb3VwLS1zdHJldGNoZWQnXSA6IFtdO1xuICAgICAgdmFyIGV4dHJhQ2xhc3NlczIgPSBleHRyYUNsYXNzZXMuY29uY2F0KHNwZWMubWF4aW1pemVkID8gWyd0b3gtZm9ybS1ncm91cC0tbWF4aW1pemUnXSA6IFtdKTtcbiAgICAgIHZhciBleHRyYUJlaGF2aW91cnMgPSBbXG4gICAgICAgIERpc2FibGluZy5jb25maWcoe1xuICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc3BlYy5kaXNhYmxlZCB8fCBwcm92aWRlcnNCYWNrc3RhZ2UuaXNEaXNhYmxlZCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIEZvcm1GaWVsZC5nZXRGaWVsZChjb21wKS5lYWNoKERpc2FibGluZy5kaXNhYmxlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIEZvcm1GaWVsZC5nZXRGaWVsZChjb21wKS5lYWNoKERpc2FibGluZy5lbmFibGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIHJlY2VpdmluZ0NvbmZpZygpXG4gICAgICBdO1xuICAgICAgcmV0dXJuIHJlbmRlckZvcm1GaWVsZFdpdGgocExhYmVsLCBwRmllbGQsIGV4dHJhQ2xhc3NlczIsIGV4dHJhQmVoYXZpb3Vycyk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVySW5wdXQgPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4gcmVuZGVyVGV4dEZpZWxkKHtcbiAgICAgICAgbmFtZTogc3BlYy5uYW1lLFxuICAgICAgICBtdWx0aWxpbmU6IGZhbHNlLFxuICAgICAgICBsYWJlbDogc3BlYy5sYWJlbCxcbiAgICAgICAgaW5wdXRNb2RlOiBzcGVjLmlucHV0TW9kZSxcbiAgICAgICAgcGxhY2Vob2xkZXI6IHNwZWMucGxhY2Vob2xkZXIsXG4gICAgICAgIGZsZXg6IGZhbHNlLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgY2xhc3NuYW1lOiAndG94LXRleHRmaWVsZCcsXG4gICAgICAgIHZhbGlkYXRpb246IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgbWF4aW1pemVkOiBzcGVjLm1heGltaXplZFxuICAgICAgfSwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJUZXh0YXJlYSA9IGZ1bmN0aW9uIChzcGVjLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiByZW5kZXJUZXh0RmllbGQoe1xuICAgICAgICBuYW1lOiBzcGVjLm5hbWUsXG4gICAgICAgIG11bHRpbGluZTogdHJ1ZSxcbiAgICAgICAgbGFiZWw6IHNwZWMubGFiZWwsXG4gICAgICAgIGlucHV0TW9kZTogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBwbGFjZWhvbGRlcjogc3BlYy5wbGFjZWhvbGRlcixcbiAgICAgICAgZmxleDogdHJ1ZSxcbiAgICAgICAgZGlzYWJsZWQ6IHNwZWMuZGlzYWJsZWQsXG4gICAgICAgIGNsYXNzbmFtZTogJ3RveC10ZXh0YXJlYScsXG4gICAgICAgIHZhbGlkYXRpb246IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgbWF4aW1pemVkOiBzcGVjLm1heGltaXplZFxuICAgICAgfSwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICB9O1xuXG4gICAgdmFyIGV2ZW50cyRjID0gZnVuY3Rpb24gKHN0cmVhbUNvbmZpZywgc3RyZWFtU3RhdGUpIHtcbiAgICAgIHZhciBzdHJlYW1zID0gc3RyZWFtQ29uZmlnLnN0cmVhbS5zdHJlYW1zO1xuICAgICAgdmFyIHByb2Nlc3NvciA9IHN0cmVhbXMuc2V0dXAoc3RyZWFtQ29uZmlnLCBzdHJlYW1TdGF0ZSk7XG4gICAgICByZXR1cm4gZGVyaXZlKFtcbiAgICAgICAgcnVuKHN0cmVhbUNvbmZpZy5ldmVudCwgcHJvY2Vzc29yKSxcbiAgICAgICAgcnVuT25EZXRhY2hlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0cmVhbVN0YXRlLmNhbmNlbCgpO1xuICAgICAgICB9KVxuICAgICAgXS5jb25jYXQoc3RyZWFtQ29uZmlnLmNhbmNlbEV2ZW50Lm1hcChmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXR1cm4gW3J1bihlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RyZWFtU3RhdGUuY2FuY2VsKCk7XG4gICAgICAgICAgfSldO1xuICAgICAgfSkuZ2V0T3IoW10pKSk7XG4gICAgfTtcblxuICAgIHZhciBBY3RpdmVTdHJlYW1pbmcgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkY1xuICAgIH0pO1xuXG4gICAgdmFyIHRocm90dGxlID0gZnVuY3Rpb24gKF9jb25maWcpIHtcbiAgICAgIHZhciBzdGF0ZSA9IENlbGwobnVsbCk7XG4gICAgICB2YXIgcmVhZFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4geyB0aW1lcjogc3RhdGUuZ2V0KCkgIT09IG51bGwgPyAnc2V0JyA6ICd1bnNldCcgfTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0VGltZXIgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICBzdGF0ZS5zZXQodCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSBzdGF0ZS5nZXQoKTtcbiAgICAgICAgaWYgKHQgIT09IG51bGwpIHtcbiAgICAgICAgICB0LmNhbmNlbCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG51JDUoe1xuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZSxcbiAgICAgICAgc2V0VGltZXI6IHNldFRpbWVyLFxuICAgICAgICBjYW5jZWw6IGNhbmNlbFxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5pdCQ2ID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBzcGVjLnN0cmVhbS5zdHJlYW1zLnN0YXRlKHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgU3RyZWFtaW5nU3RhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgdGhyb3R0bGU6IHRocm90dGxlLFxuICAgICAgICBpbml0OiBpbml0JDZcbiAgICB9KTtcblxuICAgIHZhciBzZXR1cCQyID0gZnVuY3Rpb24gKHN0cmVhbUluZm8sIHN0cmVhbVN0YXRlKSB7XG4gICAgICB2YXIgc0luZm8gPSBzdHJlYW1JbmZvLnN0cmVhbTtcbiAgICAgIHZhciB0aHJvdHRsZXIgPSBsYXN0JDIoc3RyZWFtSW5mby5vblN0cmVhbSwgc0luZm8uZGVsYXkpO1xuICAgICAgc3RyZWFtU3RhdGUuc2V0VGltZXIodGhyb3R0bGVyKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICB0aHJvdHRsZXIudGhyb3R0bGUoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCk7XG4gICAgICAgIGlmIChzSW5mby5zdG9wRXZlbnQpIHtcbiAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgU3RyZWFtaW5nU2NoZW1hID0gW1xuICAgICAgc3RyaWN0T2YoJ3N0cmVhbScsIGNob29zZSQxKCdtb2RlJywge1xuICAgICAgICB0aHJvdHRsZTogW1xuICAgICAgICAgIHN0cmljdCQxKCdkZWxheScpLFxuICAgICAgICAgIGRlZmF1bHRlZCQxKCdzdG9wRXZlbnQnLCB0cnVlKSxcbiAgICAgICAgICBvdXRwdXQoJ3N0cmVhbXMnLCB7XG4gICAgICAgICAgICBzZXR1cDogc2V0dXAkMixcbiAgICAgICAgICAgIHN0YXRlOiB0aHJvdHRsZVxuICAgICAgICAgIH0pXG4gICAgICAgIF1cbiAgICAgIH0pKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdldmVudCcsICdpbnB1dCcpLFxuICAgICAgb3B0aW9uKCdjYW5jZWxFdmVudCcpLFxuICAgICAgb25TdHJpY3RIYW5kbGVyKCdvblN0cmVhbScpXG4gICAgXTtcblxuICAgIHZhciBTdHJlYW1pbmcgPSBjcmVhdGUkMSh7XG4gICAgICBmaWVsZHM6IFN0cmVhbWluZ1NjaGVtYSxcbiAgICAgIG5hbWU6ICdzdHJlYW1pbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVTdHJlYW1pbmcsXG4gICAgICBzdGF0ZTogU3RyZWFtaW5nU3RhdGVcbiAgICB9KTtcblxuICAgIHZhciBzZXRWYWx1ZUZyb21JdGVtID0gZnVuY3Rpb24gKG1vZGVsLCBpbnB1dCwgaXRlbSkge1xuICAgICAgdmFyIGl0ZW1EYXRhID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGl0ZW0pO1xuICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGlucHV0LCBpdGVtRGF0YSk7XG4gICAgICBzZXRDdXJzb3JBdEVuZChpbnB1dCk7XG4gICAgfTtcbiAgICB2YXIgc2V0U2VsZWN0aW9uT24gPSBmdW5jdGlvbiAoaW5wdXQsIGYpIHtcbiAgICAgIHZhciBlbCA9IGlucHV0LmVsZW1lbnQ7XG4gICAgICB2YXIgdmFsdWUgPSBnZXQkNihlbCk7XG4gICAgICB2YXIgbm9kZSA9IGVsLmRvbTtcbiAgICAgIGlmIChnZXQkMyhlbCwgJ3R5cGUnKSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgZihub2RlLCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0Q3Vyc29yQXRFbmQgPSBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgIHNldFNlbGVjdGlvbk9uKGlucHV0LCBmdW5jdGlvbiAobm9kZSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5vZGUuc2V0U2VsZWN0aW9uUmFuZ2UodmFsdWUubGVuZ3RoLCB2YWx1ZS5sZW5ndGgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0U2VsZWN0aW9uVG9FbmQgPSBmdW5jdGlvbiAoaW5wdXQsIHN0YXJ0T2Zmc2V0KSB7XG4gICAgICBzZXRTZWxlY3Rpb25PbihpbnB1dCwgZnVuY3Rpb24gKG5vZGUsIHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBub2RlLnNldFNlbGVjdGlvblJhbmdlKHN0YXJ0T2Zmc2V0LCB2YWx1ZS5sZW5ndGgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXR0ZW1wdFNlbGVjdE92ZXIgPSBmdW5jdGlvbiAobW9kZWwsIGlucHV0LCBpdGVtKSB7XG4gICAgICBpZiAoIW1vZGVsLnNlbGVjdHNPdmVyKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGlucHV0KTtcbiAgICAgICAgdmFyIGlucHV0RGlzcGxheV8xID0gbW9kZWwuZ2V0RGlzcGxheVRleHQoY3VycmVudFZhbHVlKTtcbiAgICAgICAgdmFyIGl0ZW1WYWx1ZSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShpdGVtKTtcbiAgICAgICAgdmFyIGl0ZW1EaXNwbGF5ID0gbW9kZWwuZ2V0RGlzcGxheVRleHQoaXRlbVZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGl0ZW1EaXNwbGF5LmluZGV4T2YoaW5wdXREaXNwbGF5XzEpID09PSAwID8gT3B0aW9uYWwuc29tZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2V0VmFsdWVGcm9tSXRlbShtb2RlbCwgaW5wdXQsIGl0ZW0pO1xuICAgICAgICAgIHNldFNlbGVjdGlvblRvRW5kKGlucHV0LCBpbnB1dERpc3BsYXlfMS5sZW5ndGgpO1xuICAgICAgICB9KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGl0ZW1FeGVjdXRlID0gY29uc3RhbnQoJ2FsbG95LnR5cGVhaGVhZC5pdGVtZXhlY3V0ZScpO1xuXG4gICAgdmFyIG1ha2UkNSA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMsIHNwZWMsIGV4dGVybmFscykge1xuICAgICAgdmFyIG5hdmlnYXRlTGlzdCA9IGZ1bmN0aW9uIChjb21wLCBzaW11bGF0ZWRFdmVudCwgaGlnaGxpZ2h0ZXIpIHtcbiAgICAgICAgZGV0YWlsLnByZXZpZXdpbmcuc2V0KGZhbHNlKTtcbiAgICAgICAgdmFyIHNhbmRib3ggPSBDb3VwbGluZy5nZXRDb3VwbGVkKGNvbXAsICdzYW5kYm94Jyk7XG4gICAgICAgIGlmIChTYW5kYm94aW5nLmlzT3BlbihzYW5kYm94KSkge1xuICAgICAgICAgIENvbXBvc2luZy5nZXRDdXJyZW50KHNhbmRib3gpLmVhY2goZnVuY3Rpb24gKG1lbnUpIHtcbiAgICAgICAgICAgIEhpZ2hsaWdodGluZy5nZXRIaWdobGlnaHRlZChtZW51KS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgaGlnaGxpZ2h0ZXIobWVudSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGRpc3BhdGNoRXZlbnQoc2FuZGJveCwgbWVudS5lbGVtZW50LCAna2V5ZG93bicsIHNpbXVsYXRlZEV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBvbk9wZW5TeW5jID0gZnVuY3Rpb24gKHNhbmRib3gpIHtcbiAgICAgICAgICAgIENvbXBvc2luZy5nZXRDdXJyZW50KHNhbmRib3gpLmVhY2goaGlnaGxpZ2h0ZXIpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgb3BlbiQxKGRldGFpbCwgbWFwRmV0Y2goY29tcCksIGNvbXAsIHNhbmRib3gsIGV4dGVybmFscywgb25PcGVuU3luYywgSGlnaGxpZ2h0T25PcGVuLkhpZ2hsaWdodEZpcnN0KS5nZXQobm9vcCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgZm9jdXNCZWhhdmlvdXJzJDEgPSBmb2N1c0JlaGF2aW91cnMoZGV0YWlsKTtcbiAgICAgIHZhciBtYXBGZXRjaCA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodGRhdGEpIHtcbiAgICAgICAgICByZXR1cm4gdGRhdGEubWFwKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2YXIgbWVudXMgPSB2YWx1ZXMoZGF0YS5tZW51cyk7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBiaW5kKG1lbnVzLCBmdW5jdGlvbiAobWVudSkge1xuICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyKG1lbnUuaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSA9PT0gJ2l0ZW0nO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHJlcFN0YXRlID0gUmVwcmVzZW50aW5nLmdldFN0YXRlKGNvbXApO1xuICAgICAgICAgICAgcmVwU3RhdGUudXBkYXRlKG1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGF0YTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBiZWhhdmlvdXJzID0gW1xuICAgICAgICBGb2N1c2luZy5jb25maWcoe30pLFxuICAgICAgICBSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgICBvblNldFZhbHVlOiBkZXRhaWwub25TZXRWYWx1ZSxcbiAgICAgICAgICBzdG9yZTogX19hc3NpZ24oe1xuICAgICAgICAgICAgbW9kZTogJ2RhdGFzZXQnLFxuICAgICAgICAgICAgZ2V0RGF0YUtleTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGdldCQ2KGNvbXAuZWxlbWVudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmFsbGJhY2tFbnRyeTogZnVuY3Rpb24gKGl0ZW1TdHJpbmcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogaXRlbVN0cmluZyxcbiAgICAgICAgICAgICAgICBtZXRhOiB7fVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoY29tcCwgZGF0YSkge1xuICAgICAgICAgICAgICBzZXQkMyhjb21wLmVsZW1lbnQsIGRldGFpbC5tb2RlbC5nZXREaXNwbGF5VGV4dChkYXRhKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgZGV0YWlsLmluaXRpYWxEYXRhLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAkMSgnaW5pdGlhbFZhbHVlJywgZCk7XG4gICAgICAgICAgfSkuZ2V0T3Ioe30pKVxuICAgICAgICB9KSxcbiAgICAgICAgU3RyZWFtaW5nLmNvbmZpZyh7XG4gICAgICAgICAgc3RyZWFtOiB7XG4gICAgICAgICAgICBtb2RlOiAndGhyb3R0bGUnLFxuICAgICAgICAgICAgZGVsYXk6IGRldGFpbC5yZXNwb25zZVRpbWUsXG4gICAgICAgICAgICBzdG9wRXZlbnQ6IGZhbHNlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblN0cmVhbTogZnVuY3Rpb24gKGNvbXBvbmVudCwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgc2FuZGJveCA9IENvdXBsaW5nLmdldENvdXBsZWQoY29tcG9uZW50LCAnc2FuZGJveCcpO1xuICAgICAgICAgICAgdmFyIGZvY3VzSW5JbnB1dCA9IEZvY3VzaW5nLmlzRm9jdXNlZChjb21wb25lbnQpO1xuICAgICAgICAgICAgaWYgKGZvY3VzSW5JbnB1dCkge1xuICAgICAgICAgICAgICBpZiAoZ2V0JDYoY29tcG9uZW50LmVsZW1lbnQpLmxlbmd0aCA+PSBkZXRhaWwubWluQ2hhcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJldmlvdXNWYWx1ZV8xID0gQ29tcG9zaW5nLmdldEN1cnJlbnQoc2FuZGJveCkuYmluZChmdW5jdGlvbiAobWVudSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIEhpZ2hsaWdodGluZy5nZXRIaWdobGlnaHRlZChtZW51KS5tYXAoUmVwcmVzZW50aW5nLmdldFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBkZXRhaWwucHJldmlld2luZy5zZXQodHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIG9uT3BlblN5bmMgPSBmdW5jdGlvbiAoX3NhbmRib3gpIHtcbiAgICAgICAgICAgICAgICAgIENvbXBvc2luZy5nZXRDdXJyZW50KHNhbmRib3gpLmVhY2goZnVuY3Rpb24gKG1lbnUpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNWYWx1ZV8xLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWwubW9kZWwuc2VsZWN0c092ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEhpZ2hsaWdodGluZy5oaWdobGlnaHRGaXJzdChtZW51KTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChwdikge1xuICAgICAgICAgICAgICAgICAgICAgIEhpZ2hsaWdodGluZy5oaWdobGlnaHRCeShtZW51LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1EYXRhID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1EYXRhLnZhbHVlID09PSBwdi52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICBIaWdobGlnaHRpbmcuZ2V0SGlnaGxpZ2h0ZWQobWVudSkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBIaWdobGlnaHRpbmcuaGlnaGxpZ2h0Rmlyc3QobWVudSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgb3BlbiQxKGRldGFpbCwgbWFwRmV0Y2goY29tcG9uZW50KSwgY29tcG9uZW50LCBzYW5kYm94LCBleHRlcm5hbHMsIG9uT3BlblN5bmMsIEhpZ2hsaWdodE9uT3Blbi5IaWdobGlnaHRGaXJzdCkuZ2V0KG5vb3ApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjYW5jZWxFdmVudDogdHlwZWFoZWFkQ2FuY2VsKClcbiAgICAgICAgfSksXG4gICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgIG1vZGU6ICdzcGVjaWFsJyxcbiAgICAgICAgICBvbkRvd246IGZ1bmN0aW9uIChjb21wLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgbmF2aWdhdGVMaXN0KGNvbXAsIHNpbXVsYXRlZEV2ZW50LCBIaWdobGlnaHRpbmcuaGlnaGxpZ2h0Rmlyc3QpO1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHZhciBzYW5kYm94ID0gQ291cGxpbmcuZ2V0Q291cGxlZChjb21wLCAnc2FuZGJveCcpO1xuICAgICAgICAgICAgaWYgKFNhbmRib3hpbmcuaXNPcGVuKHNhbmRib3gpKSB7XG4gICAgICAgICAgICAgIFNhbmRib3hpbmcuY2xvc2Uoc2FuZGJveCk7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uVXA6IGZ1bmN0aW9uIChjb21wLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgbmF2aWdhdGVMaXN0KGNvbXAsIHNpbXVsYXRlZEV2ZW50LCBIaWdobGlnaHRpbmcuaGlnaGxpZ2h0TGFzdCk7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uRW50ZXI6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICB2YXIgc2FuZGJveCA9IENvdXBsaW5nLmdldENvdXBsZWQoY29tcCwgJ3NhbmRib3gnKTtcbiAgICAgICAgICAgIHZhciBzYW5kYm94SXNPcGVuID0gU2FuZGJveGluZy5pc09wZW4oc2FuZGJveCk7XG4gICAgICAgICAgICBpZiAoc2FuZGJveElzT3BlbiAmJiAhZGV0YWlsLnByZXZpZXdpbmcuZ2V0KCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIENvbXBvc2luZy5nZXRDdXJyZW50KHNhbmRib3gpLmJpbmQoZnVuY3Rpb24gKG1lbnUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSGlnaGxpZ2h0aW5nLmdldEhpZ2hsaWdodGVkKG1lbnUpO1xuICAgICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBlbWl0V2l0aChjb21wLCBpdGVtRXhlY3V0ZSgpLCB7IGl0ZW06IGl0ZW0gfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShjb21wKTtcbiAgICAgICAgICAgICAgZW1pdChjb21wLCB0eXBlYWhlYWRDYW5jZWwoKSk7XG4gICAgICAgICAgICAgIGRldGFpbC5vbkV4ZWN1dGUoc2FuZGJveCwgY29tcCwgY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgICAgaWYgKHNhbmRib3hJc09wZW4pIHtcbiAgICAgICAgICAgICAgICBTYW5kYm94aW5nLmNsb3NlKHNhbmRib3gpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIFRvZ2dsaW5nLmNvbmZpZyh7XG4gICAgICAgICAgdG9nZ2xlQ2xhc3M6IGRldGFpbC5tYXJrZXJzLm9wZW5DbGFzcyxcbiAgICAgICAgICBhcmlhOiB7IG1vZGU6ICdleHBhbmRlZCcgfVxuICAgICAgICB9KSxcbiAgICAgICAgQ291cGxpbmcuY29uZmlnKHtcbiAgICAgICAgICBvdGhlcnM6IHtcbiAgICAgICAgICAgIHNhbmRib3g6IGZ1bmN0aW9uIChob3RzcG90KSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYWtlU2FuZGJveChkZXRhaWwsIGhvdHNwb3QsIHtcbiAgICAgICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBUb2dnbGluZy5vbihob3RzcG90KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBUb2dnbGluZy5vZmYoaG90c3BvdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBjb25maWcoJ3R5cGVhaGVhZGV2ZW50cycsIFtcbiAgICAgICAgICBydW5PbkV4ZWN1dGUoZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHZhciBvbk9wZW5TeW5jID0gbm9vcDtcbiAgICAgICAgICAgIHRvZ2dsZVBvcHVwKGRldGFpbCwgbWFwRmV0Y2goY29tcCksIGNvbXAsIGV4dGVybmFscywgb25PcGVuU3luYywgSGlnaGxpZ2h0T25PcGVuLkhpZ2hsaWdodEZpcnN0KS5nZXQobm9vcCk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcnVuKGl0ZW1FeGVjdXRlKCksIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICAgICAgdmFyIHNhbmRib3ggPSBDb3VwbGluZy5nZXRDb3VwbGVkKGNvbXAsICdzYW5kYm94Jyk7XG4gICAgICAgICAgICBzZXRWYWx1ZUZyb21JdGVtKGRldGFpbC5tb2RlbCwgY29tcCwgc2UuZXZlbnQuaXRlbSk7XG4gICAgICAgICAgICBlbWl0KGNvbXAsIHR5cGVhaGVhZENhbmNlbCgpKTtcbiAgICAgICAgICAgIGRldGFpbC5vbkl0ZW1FeGVjdXRlKGNvbXAsIHNhbmRib3gsIHNlLmV2ZW50Lml0ZW0sIFJlcHJlc2VudGluZy5nZXRWYWx1ZShjb21wKSk7XG4gICAgICAgICAgICBTYW5kYm94aW5nLmNsb3NlKHNhbmRib3gpO1xuICAgICAgICAgICAgc2V0Q3Vyc29yQXRFbmQoY29tcCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgXS5jb25jYXQoZGV0YWlsLmRpc21pc3NPbkJsdXIgPyBbcnVuKHBvc3RCbHVyKCksIGZ1bmN0aW9uICh0eXBlYWhlYWQpIHtcbiAgICAgICAgICAgIHZhciBzYW5kYm94ID0gQ291cGxpbmcuZ2V0Q291cGxlZCh0eXBlYWhlYWQsICdzYW5kYm94Jyk7XG4gICAgICAgICAgICBpZiAoc2VhcmNoKHNhbmRib3guZWxlbWVudCkuaXNOb25lKCkpIHtcbiAgICAgICAgICAgICAgU2FuZGJveGluZy5jbG9zZShzYW5kYm94KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KV0gOiBbXSkpXG4gICAgICBdO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRvbSQyKGRlZXBNZXJnZShkZXRhaWwsIHtcbiAgICAgICAgICBpbnB1dEF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICdyb2xlJzogJ2NvbWJvYm94JyxcbiAgICAgICAgICAgICdhcmlhLWF1dG9jb21wbGV0ZSc6ICdsaXN0JyxcbiAgICAgICAgICAgICdhcmlhLWhhc3BvcHVwJzogJ3RydWUnXG4gICAgICAgICAgfVxuICAgICAgICB9KSksXG4gICAgICAgIGJlaGF2aW91cnM6IF9fYXNzaWduKF9fYXNzaWduKHt9LCBmb2N1c0JlaGF2aW91cnMkMSksIGF1Z21lbnQoZGV0YWlsLnR5cGVhaGVhZEJlaGF2aW91cnMsIGJlaGF2aW91cnMpKSxcbiAgICAgICAgZXZlbnRPcmRlcjogZGV0YWlsLmV2ZW50T3JkZXJcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBzY2hlbWEkaiA9IGNvbnN0YW50KFtcbiAgICAgIG9wdGlvbignbGF6eVNpbmsnKSxcbiAgICAgIHN0cmljdCQxKCdmZXRjaCcpLFxuICAgICAgZGVmYXVsdGVkJDEoJ21pbkNoYXJzJywgNSksXG4gICAgICBkZWZhdWx0ZWQkMSgncmVzcG9uc2VUaW1lJywgMTAwMCksXG4gICAgICBvbkhhbmRsZXIoJ29uT3BlbicpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2dldEhvdHNwb3QnLCBPcHRpb25hbC5zb21lKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdnZXRBbmNob3JPdmVycmlkZXMnLCBjb25zdGFudCh7fSkpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2xheW91dHMnLCBPcHRpb25hbC5ub25lKCkpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2V2ZW50T3JkZXInLCB7fSksXG4gICAgICBkZWZhdWx0ZWRPYmpPZignbW9kZWwnLCB7fSwgW1xuICAgICAgICBkZWZhdWx0ZWQkMSgnZ2V0RGlzcGxheVRleHQnLCBmdW5jdGlvbiAoaXRlbURhdGEpIHtcbiAgICAgICAgICByZXR1cm4gaXRlbURhdGEubWV0YSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1EYXRhLm1ldGEudGV4dCAhPT0gdW5kZWZpbmVkID8gaXRlbURhdGEubWV0YS50ZXh0IDogaXRlbURhdGEudmFsdWU7XG4gICAgICAgIH0pLFxuICAgICAgICBkZWZhdWx0ZWQkMSgnc2VsZWN0c092ZXInLCB0cnVlKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ3BvcHVsYXRlRnJvbUJyb3dzZScsIHRydWUpXG4gICAgICBdKSxcbiAgICAgIG9uSGFuZGxlcignb25TZXRWYWx1ZScpLFxuICAgICAgb25LZXlib2FyZEhhbmRsZXIoJ29uRXhlY3V0ZScpLFxuICAgICAgb25IYW5kbGVyKCdvbkl0ZW1FeGVjdXRlJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnaW5wdXRDbGFzc2VzJywgW10pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2lucHV0QXR0cmlidXRlcycsIHt9KSxcbiAgICAgIGRlZmF1bHRlZCQxKCdpbnB1dFN0eWxlcycsIHt9KSxcbiAgICAgIGRlZmF1bHRlZCQxKCdtYXRjaFdpZHRoJywgdHJ1ZSksXG4gICAgICBkZWZhdWx0ZWQkMSgndXNlTWluV2lkdGgnLCBmYWxzZSksXG4gICAgICBkZWZhdWx0ZWQkMSgnZGlzbWlzc09uQmx1cicsIHRydWUpLFxuICAgICAgbWFya2VycyhbJ29wZW5DbGFzcyddKSxcbiAgICAgIG9wdGlvbignaW5pdGlhbERhdGEnKSxcbiAgICAgIGZpZWxkJDEoJ3R5cGVhaGVhZEJlaGF2aW91cnMnLCBbXG4gICAgICAgIEZvY3VzaW5nLFxuICAgICAgICBSZXByZXNlbnRpbmcsXG4gICAgICAgIFN0cmVhbWluZyxcbiAgICAgICAgS2V5aW5nLFxuICAgICAgICBUb2dnbGluZyxcbiAgICAgICAgQ291cGxpbmdcbiAgICAgIF0pLFxuICAgICAgc3RhdGUkMSgncHJldmlld2luZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIENlbGwodHJ1ZSk7XG4gICAgICB9KVxuICAgIF0uY29uY2F0KHNjaGVtYSRmKCkpLmNvbmNhdChzYW5kYm94RmllbGRzKCkpKTtcbiAgICB2YXIgcGFydHMkNiA9IGNvbnN0YW50KFtleHRlcm5hbCQxKHtcbiAgICAgICAgc2NoZW1hOiBbdGllcmVkTWVudU1hcmtlcnMoKV0sXG4gICAgICAgIG5hbWU6ICdtZW51JyxcbiAgICAgICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZha2VGb2N1czogdHJ1ZSxcbiAgICAgICAgICAgIG9uSGlnaGxpZ2h0OiBmdW5jdGlvbiAobWVudSwgaXRlbSkge1xuICAgICAgICAgICAgICBpZiAoIWRldGFpbC5wcmV2aWV3aW5nLmdldCgpKSB7XG4gICAgICAgICAgICAgICAgbWVudS5nZXRTeXN0ZW0oKS5nZXRCeVVpZChkZXRhaWwudWlkKS5lYWNoKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgaWYgKGRldGFpbC5tb2RlbC5wb3B1bGF0ZUZyb21Ccm93c2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VmFsdWVGcm9tSXRlbShkZXRhaWwubW9kZWwsIGlucHV0LCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtZW51LmdldFN5c3RlbSgpLmdldEJ5VWlkKGRldGFpbC51aWQpLmVhY2goZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICBhdHRlbXB0U2VsZWN0T3ZlcihkZXRhaWwubW9kZWwsIGlucHV0LCBpdGVtKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEhpZ2hsaWdodGluZy5kZWhpZ2hsaWdodChtZW51LCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm4oKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRldGFpbC5wcmV2aWV3aW5nLnNldChmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbiAobWVudSwgaXRlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gbWVudS5nZXRTeXN0ZW0oKS5nZXRCeVVpZChkZXRhaWwudWlkKS50b09wdGlvbmFsKCkubWFwKGZ1bmN0aW9uICh0eXBlYWhlYWQpIHtcbiAgICAgICAgICAgICAgICBlbWl0V2l0aCh0eXBlYWhlYWQsIGl0ZW1FeGVjdXRlKCksIHsgaXRlbTogaXRlbSB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Ib3ZlcjogZnVuY3Rpb24gKG1lbnUsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgZGV0YWlsLnByZXZpZXdpbmcuc2V0KGZhbHNlKTtcbiAgICAgICAgICAgICAgbWVudS5nZXRTeXN0ZW0oKS5nZXRCeVVpZChkZXRhaWwudWlkKS5lYWNoKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICAgICAgICAgIGlmIChkZXRhaWwubW9kZWwucG9wdWxhdGVGcm9tQnJvd3NlKSB7XG4gICAgICAgICAgICAgICAgICBzZXRWYWx1ZUZyb21JdGVtKGRldGFpbC5tb2RlbCwgaW5wdXQsIGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSldKTtcblxuICAgIHZhciBUeXBlYWhlYWQgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnVHlwZWFoZWFkJyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogc2NoZW1hJGooKSxcbiAgICAgIHBhcnRGaWVsZHM6IHBhcnRzJDYoKSxcbiAgICAgIGZhY3Rvcnk6IG1ha2UkNVxuICAgIH0pO1xuXG4gICAgdmFyIHdyYXAkMiA9IGZ1bmN0aW9uIChkZWxlZ2F0ZSkge1xuICAgICAgdmFyIHRvQ2FjaGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gd3JhcCQyKGRlbGVnYXRlLnRvQ2FjaGVkKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBiaW5kRnV0dXJlID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIHdyYXAkMihkZWxlZ2F0ZS5iaW5kKGZ1bmN0aW9uIChyZXNBKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc0EuZm9sZChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gRnV0dXJlLnB1cmUoUmVzdWx0LmVycm9yKGVycikpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICByZXR1cm4gZihhKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgICAgfTtcbiAgICAgIHZhciBiaW5kUmVzdWx0ID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIHdyYXAkMihkZWxlZ2F0ZS5tYXAoZnVuY3Rpb24gKHJlc0EpIHtcbiAgICAgICAgICByZXR1cm4gcmVzQS5iaW5kKGYpO1xuICAgICAgICB9KSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1hcFJlc3VsdCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiB3cmFwJDIoZGVsZWdhdGUubWFwKGZ1bmN0aW9uIChyZXNBKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc0EubWFwKGYpO1xuICAgICAgICB9KSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1hcEVycm9yID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIHdyYXAkMihkZWxlZ2F0ZS5tYXAoZnVuY3Rpb24gKHJlc0EpIHtcbiAgICAgICAgICByZXR1cm4gcmVzQS5tYXBFcnJvcihmKTtcbiAgICAgICAgfSkpO1xuICAgICAgfTtcbiAgICAgIHZhciBmb2xkUmVzdWx0ID0gZnVuY3Rpb24gKHdoZW5FcnJvciwgd2hlblZhbHVlKSB7XG4gICAgICAgIHJldHVybiBkZWxlZ2F0ZS5tYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgIHJldHVybiByZXMuZm9sZCh3aGVuRXJyb3IsIHdoZW5WYWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB3aXRoVGltZW91dCA9IGZ1bmN0aW9uICh0aW1lb3V0LCBlcnJvclRodW5rKSB7XG4gICAgICAgIHJldHVybiB3cmFwJDIoRnV0dXJlLm51KGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgIHZhciB0aW1lZE91dCA9IGZhbHNlO1xuICAgICAgICAgIHZhciB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGltZWRPdXQgPSB0cnVlO1xuICAgICAgICAgICAgY2FsbGJhY2soUmVzdWx0LmVycm9yKGVycm9yVGh1bmsoKSkpO1xuICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgIGRlbGVnYXRlLmdldChmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAoIXRpbWVkT3V0KSB7XG4gICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIGRlbGVnYXRlKSwge1xuICAgICAgICB0b0NhY2hlZDogdG9DYWNoZWQsXG4gICAgICAgIGJpbmRGdXR1cmU6IGJpbmRGdXR1cmUsXG4gICAgICAgIGJpbmRSZXN1bHQ6IGJpbmRSZXN1bHQsXG4gICAgICAgIG1hcFJlc3VsdDogbWFwUmVzdWx0LFxuICAgICAgICBtYXBFcnJvcjogbWFwRXJyb3IsXG4gICAgICAgIGZvbGRSZXN1bHQ6IGZvbGRSZXN1bHQsXG4gICAgICAgIHdpdGhUaW1lb3V0OiB3aXRoVGltZW91dFxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbnUkYyA9IGZ1bmN0aW9uICh3b3JrZXIpIHtcbiAgICAgIHJldHVybiB3cmFwJDIoRnV0dXJlLm51KHdvcmtlcikpO1xuICAgIH07XG4gICAgdmFyIHZhbHVlJDIgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiB3cmFwJDIoRnV0dXJlLnB1cmUoUmVzdWx0LnZhbHVlKHZhbHVlKSkpO1xuICAgIH07XG4gICAgdmFyIGVycm9yJDEgPSBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB3cmFwJDIoRnV0dXJlLnB1cmUoUmVzdWx0LmVycm9yKGVycm9yKSkpO1xuICAgIH07XG4gICAgdmFyIGZyb21SZXN1bHQkMSA9IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgIHJldHVybiB3cmFwJDIoRnV0dXJlLnB1cmUocmVzdWx0KSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbUZ1dHVyZSA9IGZ1bmN0aW9uIChmdXR1cmUpIHtcbiAgICAgIHJldHVybiB3cmFwJDIoZnV0dXJlLm1hcChSZXN1bHQudmFsdWUpKTtcbiAgICB9O1xuICAgIHZhciBmcm9tUHJvbWlzZSA9IGZ1bmN0aW9uIChwcm9taXNlKSB7XG4gICAgICByZXR1cm4gbnUkYyhmdW5jdGlvbiAoY29tcGxldGVyKSB7XG4gICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICBjb21wbGV0ZXIoUmVzdWx0LnZhbHVlKHZhbHVlKSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgIGNvbXBsZXRlcihSZXN1bHQuZXJyb3IoZXJyb3IpKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBGdXR1cmVSZXN1bHQgPSB7XG4gICAgICBudTogbnUkYyxcbiAgICAgIHdyYXA6IHdyYXAkMixcbiAgICAgIHB1cmU6IHZhbHVlJDIsXG4gICAgICB2YWx1ZTogdmFsdWUkMixcbiAgICAgIGVycm9yOiBlcnJvciQxLFxuICAgICAgZnJvbVJlc3VsdDogZnJvbVJlc3VsdCQxLFxuICAgICAgZnJvbUZ1dHVyZTogZnJvbUZ1dHVyZSxcbiAgICAgIGZyb21Qcm9taXNlOiBmcm9tUHJvbWlzZVxuICAgIH07XG5cbiAgICB2YXIgc2VwYXJhdG9yJDIgPSB7IHR5cGU6ICdzZXBhcmF0b3InIH07XG4gICAgdmFyIHRvTWVudUl0ZW0gPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAnbWVudWl0ZW0nLFxuICAgICAgICB2YWx1ZTogdGFyZ2V0LnVybCxcbiAgICAgICAgdGV4dDogdGFyZ2V0LnRpdGxlLFxuICAgICAgICBtZXRhOiB7IGF0dGFjaDogdGFyZ2V0LmF0dGFjaCB9LFxuICAgICAgICBvbkFjdGlvbjogbm9vcFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzdGF0aWNNZW51SXRlbSA9IGZ1bmN0aW9uICh0aXRsZSwgdXJsKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAnbWVudWl0ZW0nLFxuICAgICAgICB2YWx1ZTogdXJsLFxuICAgICAgICB0ZXh0OiB0aXRsZSxcbiAgICAgICAgbWV0YTogeyBhdHRhY2g6IHVuZGVmaW5lZCB9LFxuICAgICAgICBvbkFjdGlvbjogbm9vcFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0b01lbnVJdGVtcyA9IGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICByZXR1cm4gbWFwKHRhcmdldHMsIHRvTWVudUl0ZW0pO1xuICAgIH07XG4gICAgdmFyIGZpbHRlckxpbmtUYXJnZXRzID0gZnVuY3Rpb24gKHR5cGUsIHRhcmdldHMpIHtcbiAgICAgIHJldHVybiBmaWx0ZXIodGFyZ2V0cywgZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICByZXR1cm4gdGFyZ2V0LnR5cGUgPT09IHR5cGU7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmaWx0ZXJlZFRhcmdldHMgPSBmdW5jdGlvbiAodHlwZSwgdGFyZ2V0cykge1xuICAgICAgcmV0dXJuIHRvTWVudUl0ZW1zKGZpbHRlckxpbmtUYXJnZXRzKHR5cGUsIHRhcmdldHMpKTtcbiAgICB9O1xuICAgIHZhciBoZWFkZXJUYXJnZXRzID0gZnVuY3Rpb24gKGxpbmtJbmZvKSB7XG4gICAgICByZXR1cm4gZmlsdGVyZWRUYXJnZXRzKCdoZWFkZXInLCBsaW5rSW5mby50YXJnZXRzKTtcbiAgICB9O1xuICAgIHZhciBhbmNob3JUYXJnZXRzID0gZnVuY3Rpb24gKGxpbmtJbmZvKSB7XG4gICAgICByZXR1cm4gZmlsdGVyZWRUYXJnZXRzKCdhbmNob3InLCBsaW5rSW5mby50YXJnZXRzKTtcbiAgICB9O1xuICAgIHZhciBhbmNob3JUYXJnZXRUb3AgPSBmdW5jdGlvbiAobGlua0luZm8pIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGxpbmtJbmZvLmFuY2hvclRvcCkubWFwKGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIHN0YXRpY01lbnVJdGVtKCc8dG9wPicsIHVybCk7XG4gICAgICB9KS50b0FycmF5KCk7XG4gICAgfTtcbiAgICB2YXIgYW5jaG9yVGFyZ2V0Qm90dG9tID0gZnVuY3Rpb24gKGxpbmtJbmZvKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShsaW5rSW5mby5hbmNob3JCb3R0b20pLm1hcChmdW5jdGlvbiAodXJsKSB7XG4gICAgICAgIHJldHVybiBzdGF0aWNNZW51SXRlbSgnPGJvdHRvbT4nLCB1cmwpO1xuICAgICAgfSkudG9BcnJheSgpO1xuICAgIH07XG4gICAgdmFyIGhpc3RvcnlUYXJnZXRzID0gZnVuY3Rpb24gKGhpc3RvcnkpIHtcbiAgICAgIHJldHVybiBtYXAoaGlzdG9yeSwgZnVuY3Rpb24gKHVybCkge1xuICAgICAgICByZXR1cm4gc3RhdGljTWVudUl0ZW0odXJsLCB1cmwpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgam9pbk1lbnVMaXN0cyA9IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgcmV0dXJuIGZvbGRsKGl0ZW1zLCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICB2YXIgYm90aEVtcHR5ID0gYS5sZW5ndGggPT09IDAgfHwgYi5sZW5ndGggPT09IDA7XG4gICAgICAgIHJldHVybiBib3RoRW1wdHkgPyBhLmNvbmNhdChiKSA6IGEuY29uY2F0KHNlcGFyYXRvciQyLCBiKTtcbiAgICAgIH0sIFtdKTtcbiAgICB9O1xuICAgIHZhciBmaWx0ZXJCeVF1ZXJ5ID0gZnVuY3Rpb24gKHRlcm0sIG1lbnVJdGVtcykge1xuICAgICAgdmFyIGxvd2VyQ2FzZVRlcm0gPSB0ZXJtLnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gZmlsdGVyKG1lbnVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdmFyIHRleHQgPSBpdGVtLm1ldGEgIT09IHVuZGVmaW5lZCAmJiBpdGVtLm1ldGEudGV4dCAhPT0gdW5kZWZpbmVkID8gaXRlbS5tZXRhLnRleHQgOiBpdGVtLnRleHQ7XG4gICAgICAgIHJldHVybiBjb250YWlucyQxKHRleHQudG9Mb3dlckNhc2UoKSwgbG93ZXJDYXNlVGVybSkgfHwgY29udGFpbnMkMShpdGVtLnZhbHVlLnRvTG93ZXJDYXNlKCksIGxvd2VyQ2FzZVRlcm0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnZXRJdGVtcyA9IGZ1bmN0aW9uIChmaWxlVHlwZSwgaW5wdXQsIHVybEJhY2tzdGFnZSkge1xuICAgICAgdmFyIHVybElucHV0VmFsdWUgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoaW5wdXQpO1xuICAgICAgdmFyIHRlcm0gPSB1cmxJbnB1dFZhbHVlLm1ldGEudGV4dCAhPT0gdW5kZWZpbmVkID8gdXJsSW5wdXRWYWx1ZS5tZXRhLnRleHQgOiB1cmxJbnB1dFZhbHVlLnZhbHVlO1xuICAgICAgdmFyIGluZm8gPSB1cmxCYWNrc3RhZ2UuZ2V0TGlua0luZm9ybWF0aW9uKCk7XG4gICAgICByZXR1cm4gaW5mby5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfSwgZnVuY3Rpb24gKGxpbmtJbmZvKSB7XG4gICAgICAgIHZhciBoaXN0b3J5ID0gZmlsdGVyQnlRdWVyeSh0ZXJtLCBoaXN0b3J5VGFyZ2V0cyh1cmxCYWNrc3RhZ2UuZ2V0SGlzdG9yeShmaWxlVHlwZSkpKTtcbiAgICAgICAgcmV0dXJuIGZpbGVUeXBlID09PSAnZmlsZScgPyBqb2luTWVudUxpc3RzKFtcbiAgICAgICAgICBoaXN0b3J5LFxuICAgICAgICAgIGZpbHRlckJ5UXVlcnkodGVybSwgaGVhZGVyVGFyZ2V0cyhsaW5rSW5mbykpLFxuICAgICAgICAgIGZpbHRlckJ5UXVlcnkodGVybSwgZmxhdHRlbihbXG4gICAgICAgICAgICBhbmNob3JUYXJnZXRUb3AobGlua0luZm8pLFxuICAgICAgICAgICAgYW5jaG9yVGFyZ2V0cyhsaW5rSW5mbyksXG4gICAgICAgICAgICBhbmNob3JUYXJnZXRCb3R0b20obGlua0luZm8pXG4gICAgICAgICAgXSkpXG4gICAgICAgIF0pIDogaGlzdG9yeTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGVycm9ySWQgPSBnZW5lcmF0ZSQxKCdhcmlhLWludmFsaWQnKTtcbiAgICB2YXIgcmVuZGVyVXJsSW5wdXQgPSBmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlLCB1cmxCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHZhciBwcm92aWRlcnNCYWNrc3RhZ2UgPSBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycztcbiAgICAgIHZhciB1cGRhdGVIaXN0b3J5ID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICB2YXIgdXJsRW50cnkgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoY29tcG9uZW50KTtcbiAgICAgICAgdXJsQmFja3N0YWdlLmFkZFRvSGlzdG9yeSh1cmxFbnRyeS52YWx1ZSwgc3BlYy5maWxldHlwZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHBGaWVsZCA9IEZvcm1GaWVsZC5wYXJ0cy5maWVsZCh7XG4gICAgICAgIGZhY3Rvcnk6IFR5cGVhaGVhZCxcbiAgICAgICAgZGlzbWlzc09uQmx1cjogdHJ1ZSxcbiAgICAgICAgaW5wdXRDbGFzc2VzOiBbJ3RveC10ZXh0ZmllbGQnXSxcbiAgICAgICAgc2FuZGJveENsYXNzZXM6IFsndG94LWRpYWxvZ19fcG9wdXBzJ10sXG4gICAgICAgIGlucHV0QXR0cmlidXRlczoge1xuICAgICAgICAgICdhcmlhLWVycm9ybWVzc2FnZSc6IGVycm9ySWQsXG4gICAgICAgICAgJ3R5cGUnOiAndXJsJ1xuICAgICAgICB9LFxuICAgICAgICBtaW5DaGFyczogMCxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICBmZXRjaDogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgdmFyIGl0ZW1zID0gZ2V0SXRlbXMoc3BlYy5maWxldHlwZSwgaW5wdXQsIHVybEJhY2tzdGFnZSk7XG4gICAgICAgICAgdmFyIHRkYXRhID0gYnVpbGQkMihpdGVtcywgSXRlbVJlc3BvbnNlJDEuQlVCQkxFX1RPX1NBTkRCT1gsIGJhY2tzdGFnZSwgZmFsc2UpO1xuICAgICAgICAgIHJldHVybiBGdXR1cmUucHVyZSh0ZGF0YSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEhvdHNwb3Q6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIG1lbVVybEJveC5nZXRPcHQoY29tcCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uU2V0VmFsdWU6IGZ1bmN0aW9uIChjb21wLCBfbmV3VmFsdWUpIHtcbiAgICAgICAgICBpZiAoY29tcC5oYXNDb25maWd1cmVkKEludmFsaWRhdGluZykpIHtcbiAgICAgICAgICAgIEludmFsaWRhdGluZy5ydW4oY29tcCkuZ2V0KG5vb3ApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdHlwZWFoZWFkQmVoYXZpb3VyczogZGVyaXZlJDEoZmxhdHRlbihbXG4gICAgICAgICAgdXJsQmFja3N0YWdlLmdldFZhbGlkYXRpb25IYW5kbGVyKCkubWFwKGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gSW52YWxpZGF0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICAgIGdldFJvb3Q6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudChjb21wLmVsZW1lbnQpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBpbnZhbGlkQ2xhc3M6ICd0b3gtY29udHJvbC13cmFwLS1zdGF0dXMtaW52YWxpZCcsXG4gICAgICAgICAgICAgIG5vdGlmeToge1xuICAgICAgICAgICAgICAgIG9uSW52YWxpZDogZnVuY3Rpb24gKGNvbXAsIGVycikge1xuICAgICAgICAgICAgICAgICAgbWVtSW52YWxpZEljb24uZ2V0T3B0KGNvbXApLmVhY2goZnVuY3Rpb24gKGludmFsaWRDb21wKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldCQxKGludmFsaWRDb21wLmVsZW1lbnQsICd0aXRsZScsIHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUoZXJyKSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHZhbGlkYXRvcjoge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgIHZhciB1cmxFbnRyeSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShpbnB1dCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gRnV0dXJlUmVzdWx0Lm51KGZ1bmN0aW9uIChjb21wbGV0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcih7XG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogc3BlYy5maWxldHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybEVudHJ5LnZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb24uc3RhdHVzID09PSAnaW52YWxpZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnIgPSBSZXN1bHQuZXJyb3IodmFsaWRhdGlvbi5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlcihlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gUmVzdWx0LnZhbHVlKHZhbGlkYXRpb24ubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZXIodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZU9uTG9hZDogZmFsc2VcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSkudG9BcnJheSgpLFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIERpc2FibGluZy5jb25maWcoe1xuICAgICAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICAgIGNvbmZpZygndXJsaW5wdXQtZXZlbnRzJywgZmxhdHRlbihbXG4gICAgICAgICAgICAgIHNwZWMuZmlsZXR5cGUgPT09ICdmaWxlJyA/IFtydW4oaW5wdXQoKSwgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIGZvcm1DaGFuZ2VFdmVudCwgeyBuYW1lOiBzcGVjLm5hbWUgfSk7XG4gICAgICAgICAgICAgICAgfSldIDogW10sXG4gICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICBydW4oY2hhbmdlKCksIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICBlbWl0V2l0aChjb21wLCBmb3JtQ2hhbmdlRXZlbnQsIHsgbmFtZTogc3BlYy5uYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgdXBkYXRlSGlzdG9yeShjb21wKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBydW4ocG9zdFBhc3RlKCksIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICBlbWl0V2l0aChjb21wLCBmb3JtQ2hhbmdlRXZlbnQsIHsgbmFtZTogc3BlYy5uYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgdXBkYXRlSGlzdG9yeShjb21wKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICBdKSlcbiAgICAgICAgICBdXG4gICAgICAgIF0pKSxcbiAgICAgICAgZXZlbnRPcmRlcjogKF9hID0ge30sIF9hW2lucHV0KCldID0gW1xuICAgICAgICAgICdzdHJlYW1pbmcnLFxuICAgICAgICAgICd1cmxpbnB1dC1ldmVudHMnLFxuICAgICAgICAgICdpbnZhbGlkYXRpbmcnXG4gICAgICAgIF0sIF9hKSxcbiAgICAgICAgbW9kZWw6IHtcbiAgICAgICAgICBnZXREaXNwbGF5VGV4dDogZnVuY3Rpb24gKGl0ZW1EYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbURhdGEudmFsdWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3RzT3ZlcjogZmFsc2UsXG4gICAgICAgICAgcG9wdWxhdGVGcm9tQnJvd3NlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBtYXJrZXJzOiB7IG9wZW5DbGFzczogJ3RveC10ZXh0ZmllbGQtLXBvcHVwLW9wZW4nIH0sXG4gICAgICAgIGxhenlTaW5rOiBiYWNrc3RhZ2Uuc2hhcmVkLmdldFNpbmssXG4gICAgICAgIHBhcnRzOiB7IG1lbnU6IHBhcnQoZmFsc2UsIDEsICdub3JtYWwnKSB9LFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uIChfbWVudSwgY29tcG9uZW50LCBfZW50cnkpIHtcbiAgICAgICAgICBlbWl0V2l0aChjb21wb25lbnQsIGZvcm1TdWJtaXRFdmVudCwge30pO1xuICAgICAgICB9LFxuICAgICAgICBvbkl0ZW1FeGVjdXRlOiBmdW5jdGlvbiAodHlwZWFoZWFkLCBfc2FuZGJveCwgX2l0ZW0sIF92YWx1ZSkge1xuICAgICAgICAgIHVwZGF0ZUhpc3RvcnkodHlwZWFoZWFkKTtcbiAgICAgICAgICBlbWl0V2l0aCh0eXBlYWhlYWQsIGZvcm1DaGFuZ2VFdmVudCwgeyBuYW1lOiBzcGVjLm5hbWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIHBMYWJlbCA9IHNwZWMubGFiZWwubWFwKGZ1bmN0aW9uIChsYWJlbCkge1xuICAgICAgICByZXR1cm4gcmVuZGVyTGFiZWwobGFiZWwsIHByb3ZpZGVyc0JhY2tzdGFnZSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBtYWtlSWNvbiA9IGZ1bmN0aW9uIChuYW1lLCBlcnJJZCwgaWNvbiwgbGFiZWwpIHtcbiAgICAgICAgaWYgKGljb24gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGljb24gPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYWJlbCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgbGFiZWwgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgICAndG94LWljb24nLFxuICAgICAgICAgICAgICAndG94LWNvbnRyb2wtd3JhcF9fc3RhdHVzLWljb24tJyArIG5hbWVcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKGljb24sIHByb3ZpZGVyc0JhY2tzdGFnZS5pY29ucyksXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBfX2Fzc2lnbih7XG4gICAgICAgICAgICAgICd0aXRsZSc6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUobGFiZWwpLFxuICAgICAgICAgICAgICAnYXJpYS1saXZlJzogJ3BvbGl0ZSdcbiAgICAgICAgICAgIH0sIGVycklkLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHsgaWQ6IGlkIH07XG4gICAgICAgICAgICB9KSlcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIG1lbUludmFsaWRJY29uID0gcmVjb3JkKG1ha2VJY29uKCdpbnZhbGlkJywgT3B0aW9uYWwuc29tZShlcnJvcklkKSwgJ3dhcm5pbmcnKSk7XG4gICAgICB2YXIgbWVtU3RhdHVzID0gcmVjb3JkKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1jb250cm9sLXdyYXBfX3N0YXR1cy1pY29uLXdyYXAnXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbbWVtSW52YWxpZEljb24uYXNTcGVjKCldXG4gICAgICB9KTtcbiAgICAgIHZhciBvcHRVcmxQaWNrZXIgPSB1cmxCYWNrc3RhZ2UuZ2V0VXJsUGlja2VyKHNwZWMuZmlsZXR5cGUpO1xuICAgICAgdmFyIGJyb3dzZVVybEV2ZW50ID0gZ2VuZXJhdGUkMSgnYnJvd3Nlci51cmwuZXZlbnQnKTtcbiAgICAgIHZhciBtZW1VcmxCb3ggPSByZWNvcmQoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWNvbnRyb2wtd3JhcCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICBwRmllbGQsXG4gICAgICAgICAgbWVtU3RhdHVzLmFzU3BlYygpXG4gICAgICAgIF0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSldKVxuICAgICAgfSk7XG4gICAgICB2YXIgbWVtVXJsUGlja2VyQnV0dG9uID0gcmVjb3JkKHJlbmRlckJ1dHRvbih7XG4gICAgICAgIG5hbWU6IHNwZWMubmFtZSxcbiAgICAgICAgaWNvbjogT3B0aW9uYWwuc29tZSgnYnJvd3NlJyksXG4gICAgICAgIHRleHQ6IHNwZWMubGFiZWwuZ2V0T3IoJycpLFxuICAgICAgICBkaXNhYmxlZDogc3BlYy5kaXNhYmxlZCxcbiAgICAgICAgcHJpbWFyeTogZmFsc2UsXG4gICAgICAgIGJvcmRlcmxlc3M6IHRydWVcbiAgICAgIH0sIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVtaXQoY29tcG9uZW50LCBicm93c2VVcmxFdmVudCk7XG4gICAgICB9LCBwcm92aWRlcnNCYWNrc3RhZ2UsIFtdLCBbJ3RveC1icm93c2UtdXJsJ10pKTtcbiAgICAgIHZhciBjb250cm9sSFdyYXBwZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZm9ybV9fY29udHJvbHMtaC1zdGFjayddXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wb25lbnRzOiBmbGF0dGVuKFtcbiAgICAgICAgICAgIFttZW1VcmxCb3guYXNTcGVjKCldLFxuICAgICAgICAgICAgb3B0VXJsUGlja2VyLm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtZW1VcmxQaWNrZXJCdXR0b24uYXNTcGVjKCk7XG4gICAgICAgICAgICB9KS50b0FycmF5KClcbiAgICAgICAgICBdKVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBvcGVuVXJsUGlja2VyID0gZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgQ29tcG9zaW5nLmdldEN1cnJlbnQoY29tcCkuZWFjaChmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICB2YXIgY29tcG9uZW50RGF0YSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShmaWVsZCk7XG4gICAgICAgICAgdmFyIHVybERhdGEgPSBfX2Fzc2lnbih7IGZpZWxkbmFtZTogc3BlYy5uYW1lIH0sIGNvbXBvbmVudERhdGEpO1xuICAgICAgICAgIG9wdFVybFBpY2tlci5lYWNoKGZ1bmN0aW9uIChwaWNrZXIpIHtcbiAgICAgICAgICAgIHBpY2tlcih1cmxEYXRhKS5nZXQoZnVuY3Rpb24gKGNob3NlbkRhdGEpIHtcbiAgICAgICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZpZWxkLCBjaG9zZW5EYXRhKTtcbiAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcCwgZm9ybUNoYW5nZUV2ZW50LCB7IG5hbWU6IHNwZWMubmFtZSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gRm9ybUZpZWxkLnNrZXRjaCh7XG4gICAgICAgIGRvbTogcmVuZGVyRm9ybUZpZWxkRG9tKCksXG4gICAgICAgIGNvbXBvbmVudHM6IHBMYWJlbC50b0FycmF5KCkuY29uY2F0KFtjb250cm9sSFdyYXBwZXIoKV0pLFxuICAgICAgICBmaWVsZEJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgICBtZW1VcmxQaWNrZXJCdXR0b24uZ2V0T3B0KGNvbXApLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goRGlzYWJsaW5nLmVuYWJsZSk7XG4gICAgICAgICAgICAgIG1lbVVybFBpY2tlckJ1dHRvbi5nZXRPcHQoY29tcCkuZWFjaChEaXNhYmxpbmcuZW5hYmxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICByZWNlaXZpbmdDb25maWcoKSxcbiAgICAgICAgICBjb25maWcoJ3VybC1pbnB1dC1ldmVudHMnLCBbcnVuKGJyb3dzZVVybEV2ZW50LCBvcGVuVXJsUGlja2VyKV0pXG4gICAgICAgIF0pXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlckFsZXJ0QmFubmVyID0gZnVuY3Rpb24gKHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIENvbnRhaW5lci5za2V0Y2goe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ2FsZXJ0JyB9LFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICd0b3gtbm90aWZpY2F0aW9uJyxcbiAgICAgICAgICAgICd0b3gtbm90aWZpY2F0aW9uLS1pbicsXG4gICAgICAgICAgICAndG94LW5vdGlmaWNhdGlvbi0tJyArIHNwZWMubGV2ZWxcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtbm90aWZpY2F0aW9uX19pY29uJ11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbQnV0dG9uLnNrZXRjaCh7XG4gICAgICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgICAgICAgICAndG94LWJ1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgICd0b3gtYnV0dG9uLS1uYWtlZCcsXG4gICAgICAgICAgICAgICAgICAgICd0b3gtYnV0dG9uLS1pY29uJ1xuICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgIGlubmVySHRtbDogZ2V0JGUoc3BlYy5pY29uLCBwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpLFxuICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogeyB0aXRsZTogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZShzcGVjLmljb25Ub29sdGlwKSB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICBlbWl0V2l0aChjb21wLCBmb3JtQWN0aW9uRXZlbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2FsZXJ0LWJhbm5lcicsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzcGVjLnVybFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1ub3RpZmljYXRpb25fX2JvZHknXSxcbiAgICAgICAgICAgICAgaW5uZXJIdG1sOiBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKHNwZWMudGV4dClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyQ2hlY2tib3ggPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciByZXBCZWhhdmlvdXIgPSBSZXByZXNlbnRpbmcuY29uZmlnKHtcbiAgICAgICAgc3RvcmU6IHtcbiAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHZhciBlbCA9IGNvbXAuZWxlbWVudC5kb207XG4gICAgICAgICAgICByZXR1cm4gZWwuY2hlY2tlZDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiAoY29tcCwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhciBlbCA9IGNvbXAuZWxlbWVudC5kb207XG4gICAgICAgICAgICBlbC5jaGVja2VkID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciB0b2dnbGVDaGVja2JveEhhbmRsZXIgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICBjb21wLmVsZW1lbnQuZG9tLmNsaWNrKCk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHZhciBwRmllbGQgPSBGb3JtRmllbGQucGFydHMuZmllbGQoe1xuICAgICAgICBmYWN0b3J5OiB7IHNrZXRjaDogaWRlbnRpdHkgfSxcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnaW5wdXQnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWNoZWNrYm94X19pbnB1dCddLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgdHlwZTogJ2NoZWNrYm94JyB9XG4gICAgICAgIH0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBDb21wb3NpbmdDb25maWdzLnNlbGYoKSxcbiAgICAgICAgICBEaXNhYmxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzcGVjLmRpc2FibGVkIHx8IHByb3ZpZGVyQmFja3N0YWdlLmlzRGlzYWJsZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgcmVwQmVoYXZpb3VyLFxuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgb25FbnRlcjogdG9nZ2xlQ2hlY2tib3hIYW5kbGVyLFxuICAgICAgICAgICAgb25TcGFjZTogdG9nZ2xlQ2hlY2tib3hIYW5kbGVyLFxuICAgICAgICAgICAgc3RvcFNwYWNlS2V5dXA6IHRydWVcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjb25maWcoJ2NoZWNrYm94LWV2ZW50cycsIFtydW4oY2hhbmdlKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIF8pIHtcbiAgICAgICAgICAgICAgZW1pdFdpdGgoY29tcG9uZW50LCBmb3JtQ2hhbmdlRXZlbnQsIHsgbmFtZTogc3BlYy5uYW1lIH0pO1xuICAgICAgICAgICAgfSldKVxuICAgICAgICBdKVxuICAgICAgfSk7XG4gICAgICB2YXIgcExhYmVsID0gRm9ybUZpZWxkLnBhcnRzLmxhYmVsKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtY2hlY2tib3hfX2xhYmVsJ10sXG4gICAgICAgICAgaW5uZXJIdG1sOiBwcm92aWRlckJhY2tzdGFnZS50cmFuc2xhdGUoc3BlYy5sYWJlbClcbiAgICAgICAgfSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1Vuc2VsZWN0aW5nLmNvbmZpZyh7fSldKVxuICAgICAgfSk7XG4gICAgICB2YXIgbWFrZUljb24gPSBmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XG4gICAgICAgIHZhciBpY29uTmFtZSA9IGNsYXNzTmFtZSA9PT0gJ2NoZWNrZWQnID8gJ3NlbGVjdGVkJyA6ICd1bnNlbGVjdGVkJztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgICAndG94LWljb24nLFxuICAgICAgICAgICAgICAndG94LWNoZWNrYm94LWljb25fXycgKyBjbGFzc05hbWVcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKGljb25OYW1lLCBwcm92aWRlckJhY2tzdGFnZS5pY29ucylcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIG1lbUljb25zID0gcmVjb3JkKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1jaGVja2JveF9faWNvbnMnXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgbWFrZUljb24oJ2NoZWNrZWQnKSxcbiAgICAgICAgICBtYWtlSWNvbigndW5jaGVja2VkJylcbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gRm9ybUZpZWxkLnNrZXRjaCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2xhYmVsJyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1jaGVja2JveCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICBwRmllbGQsXG4gICAgICAgICAgbWVtSWNvbnMuYXNTcGVjKCksXG4gICAgICAgICAgcExhYmVsXG4gICAgICAgIF0sXG4gICAgICAgIGZpZWxkQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIERpc2FibGluZy5jb25maWcoe1xuICAgICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNwZWMuZGlzYWJsZWQgfHwgcHJvdmlkZXJCYWNrc3RhZ2UuaXNEaXNhYmxlZCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc2FibGVDbGFzczogJ3RveC1jaGVja2JveC0tZGlzYWJsZWQnLFxuICAgICAgICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goRGlzYWJsaW5nLmRpc2FibGUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgRm9ybUZpZWxkLmdldEZpZWxkKGNvbXApLmVhY2goRGlzYWJsaW5nLmVuYWJsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgcmVjZWl2aW5nQ29uZmlnKClcbiAgICAgICAgXSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVySHRtbFBhbmVsID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIGlmIChzcGVjLnByZXNldHMgPT09ICdwcmVzZW50YXRpb24nKSB7XG4gICAgICAgIHJldHVybiBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtX19ncm91cCddLFxuICAgICAgICAgICAgaW5uZXJIdG1sOiBzcGVjLmh0bWxcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIENvbnRhaW5lci5za2V0Y2goe1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWZvcm1fX2dyb3VwJ10sXG4gICAgICAgICAgICBpbm5lckh0bWw6IHNwZWMuaHRtbCxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ2RvY3VtZW50JyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb250YWluZXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KVxuICAgICAgICAgIF0pXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgbWFrZSQ2ID0gZnVuY3Rpb24gKHJlbmRlcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChwYXJ0cywgc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiBnZXQkMShzcGVjLCAnbmFtZScpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiByZW5kZXIoc3BlYywgYmFja3N0YWdlKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGZpZWxkTmFtZSkge1xuICAgICAgICAgIHJldHVybiBwYXJ0cy5maWVsZChmaWVsZE5hbWUsIHJlbmRlcihzcGVjLCBiYWNrc3RhZ2UpKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1ha2VJZnJhbWUgPSBmdW5jdGlvbiAocmVuZGVyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHBhcnRzLCBzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgICAgdmFyIGlmcmFtZVNwZWMgPSBkZWVwTWVyZ2Uoc3BlYywgeyBzb3VyY2U6ICdkeW5hbWljJyB9KTtcbiAgICAgICAgcmV0dXJuIG1ha2UkNihyZW5kZXIpKHBhcnRzLCBpZnJhbWVTcGVjLCBiYWNrc3RhZ2UpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBmYWN0b3JpZXMgPSB7XG4gICAgICBiYXI6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJCYXIoc3BlYywgYmFja3N0YWdlLnNoYXJlZCk7XG4gICAgICB9KSxcbiAgICAgIGNvbGxlY3Rpb246IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJDb2xsZWN0aW9uKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgIH0pLFxuICAgICAgYWxlcnRiYW5uZXI6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJBbGVydEJhbm5lcihzcGVjLCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgICB9KSxcbiAgICAgIGlucHV0OiBtYWtlJDYoZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgICByZXR1cm4gcmVuZGVySW5wdXQoc3BlYywgYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMpO1xuICAgICAgfSksXG4gICAgICB0ZXh0YXJlYTogbWFrZSQ2KGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlclRleHRhcmVhKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgIH0pLFxuICAgICAgbGFiZWw6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJMYWJlbCQyKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQpO1xuICAgICAgfSksXG4gICAgICBpZnJhbWU6IG1ha2VJZnJhbWUoZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgICByZXR1cm4gcmVuZGVySUZyYW1lKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgIH0pLFxuICAgICAgYnV0dG9uOiBtYWtlJDYoZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgICByZXR1cm4gcmVuZGVyRGlhbG9nQnV0dG9uKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgIH0pLFxuICAgICAgY2hlY2tib3g6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJDaGVja2JveChzcGVjLCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgICB9KSxcbiAgICAgIGNvbG9yaW5wdXQ6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJDb2xvcklucHV0KHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQsIGJhY2tzdGFnZS5jb2xvcmlucHV0KTtcbiAgICAgIH0pLFxuICAgICAgY29sb3JwaWNrZXI6IG1ha2UkNihyZW5kZXJDb2xvclBpY2tlciksXG4gICAgICBkcm9wem9uZTogbWFrZSQ2KGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckRyb3Bab25lKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgIH0pLFxuICAgICAgZ3JpZDogbWFrZSQ2KGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckdyaWQoc3BlYywgYmFja3N0YWdlLnNoYXJlZCk7XG4gICAgICB9KSxcbiAgICAgIGxpc3Rib3g6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJMaXN0Qm94KHNwZWMsIGJhY2tzdGFnZSk7XG4gICAgICB9KSxcbiAgICAgIHNlbGVjdGJveDogbWFrZSQ2KGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlclNlbGVjdEJveChzcGVjLCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgICB9KSxcbiAgICAgIHNpemVpbnB1dDogbWFrZSQ2KGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlclNpemVJbnB1dChzcGVjLCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgICB9KSxcbiAgICAgIHVybGlucHV0OiBtYWtlJDYoZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgICByZXR1cm4gcmVuZGVyVXJsSW5wdXQoc3BlYywgYmFja3N0YWdlLCBiYWNrc3RhZ2UudXJsaW5wdXQpO1xuICAgICAgfSksXG4gICAgICBjdXN0b21lZGl0b3I6IG1ha2UkNihyZW5kZXJDdXN0b21FZGl0b3IpLFxuICAgICAgaHRtbHBhbmVsOiBtYWtlJDYocmVuZGVySHRtbFBhbmVsKSxcbiAgICAgIGltYWdldG9vbHM6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJJbWFnZVRvb2xzKHNwZWMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgIH0pLFxuICAgICAgdGFibGU6IG1ha2UkNihmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJUYWJsZShzcGVjLCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgICB9KSxcbiAgICAgIHBhbmVsOiBtYWtlJDYoZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgICByZXR1cm4gcmVuZGVyUGFuZWwoc3BlYywgYmFja3N0YWdlKTtcbiAgICAgIH0pXG4gICAgfTtcbiAgICB2YXIgbm9Gb3JtUGFydHMgPSB7XG4gICAgICBmaWVsZDogZnVuY3Rpb24gKF9uYW1lLCBzcGVjKSB7XG4gICAgICAgIHJldHVybiBzcGVjO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGludGVycHJldEluRm9ybSA9IGZ1bmN0aW9uIChwYXJ0cywgc3BlYywgb2xkQmFja3N0YWdlKSB7XG4gICAgICB2YXIgbmV3QmFja3N0YWdlID0gZGVlcE1lcmdlKG9sZEJhY2tzdGFnZSwge1xuICAgICAgICBzaGFyZWQ6IHtcbiAgICAgICAgICBpbnRlcnByZXRlcjogZnVuY3Rpb24gKGNoaWxkU3BlYykge1xuICAgICAgICAgICAgcmV0dXJuIGludGVycHJldFBhcnRzKHBhcnRzLCBjaGlsZFNwZWMsIG5ld0JhY2tzdGFnZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBpbnRlcnByZXRQYXJ0cyhwYXJ0cywgc3BlYywgbmV3QmFja3N0YWdlKTtcbiAgICB9O1xuICAgIHZhciBpbnRlcnByZXRQYXJ0cyA9IGZ1bmN0aW9uIChwYXJ0cywgc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4gZ2V0JDEoZmFjdG9yaWVzLCBzcGVjLnR5cGUpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdVbmtub3duIGZhY3RvcnkgdHlwZSBcIicgKyBzcGVjLnR5cGUgKyAnXCIsIGRlZmF1bHRpbmcgdG8gY29udGFpbmVyOiAnLCBzcGVjKTtcbiAgICAgICAgcmV0dXJuIHNwZWM7XG4gICAgICB9LCBmdW5jdGlvbiAoZmFjdG9yeSkge1xuICAgICAgICByZXR1cm4gZmFjdG9yeShwYXJ0cywgc3BlYywgYmFja3N0YWdlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGludGVycHJldFdpdGhvdXRGb3JtID0gZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgdmFyIHBhcnRzID0gbm9Gb3JtUGFydHM7XG4gICAgICByZXR1cm4gaW50ZXJwcmV0UGFydHMocGFydHMsIHNwZWMsIGJhY2tzdGFnZSk7XG4gICAgfTtcblxuICAgIHZhciBidWJibGVBbGlnbm1lbnRzID0ge1xuICAgICAgdmFsaWduQ2VudHJlOiBbXSxcbiAgICAgIGFsaWduQ2VudHJlOiBbXSxcbiAgICAgIGFsaWduTGVmdDogW10sXG4gICAgICBhbGlnblJpZ2h0OiBbXSxcbiAgICAgIHJpZ2h0OiBbXSxcbiAgICAgIGxlZnQ6IFtdLFxuICAgICAgYm90dG9tOiBbXSxcbiAgICAgIHRvcDogW11cbiAgICB9O1xuICAgIHZhciBnZXRJbmxpbmVEaWFsb2dBbmNob3IgPSBmdW5jdGlvbiAoY29udGVudEFyZWFFbGVtZW50LCBsYXp5QW5jaG9yYmFyLCBsYXp5VXNlRWRpdGFibGVBcmVhQW5jaG9yKSB7XG4gICAgICB2YXIgYnViYmxlID0gbnUkOCgtMTIsIDEyLCBidWJibGVBbGlnbm1lbnRzKTtcbiAgICAgIHZhciBvdmVycmlkZXMgPSB7IG1heEhlaWdodEZ1bmN0aW9uOiBleHBhbmRhYmxlKCkgfTtcbiAgICAgIHZhciBlZGl0YWJsZUFyZWFBbmNob3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiAnbm9kZScsXG4gICAgICAgICAgcm9vdDogZ2V0Q29udGVudENvbnRhaW5lcihjb250ZW50QXJlYUVsZW1lbnQoKSksXG4gICAgICAgICAgbm9kZTogT3B0aW9uYWwuZnJvbShjb250ZW50QXJlYUVsZW1lbnQoKSksXG4gICAgICAgICAgYnViYmxlOiBidWJibGUsXG4gICAgICAgICAgbGF5b3V0czoge1xuICAgICAgICAgICAgb25SdGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtub3J0aHdlc3QkM107XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtub3J0aGVhc3QkM107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdmVycmlkZXM6IG92ZXJyaWRlc1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBzdGFuZGFyZEFuY2hvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhbmNob3I6ICdob3RzcG90JyxcbiAgICAgICAgICBob3RzcG90OiBsYXp5QW5jaG9yYmFyKCksXG4gICAgICAgICAgYnViYmxlOiBidWJibGUsXG4gICAgICAgICAgbGF5b3V0czoge1xuICAgICAgICAgICAgb25SdGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtzb3V0aGVhc3QkMV07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtzb3V0aHdlc3QkMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdmVycmlkZXM6IG92ZXJyaWRlc1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBsYXp5VXNlRWRpdGFibGVBcmVhQW5jaG9yKCkgPyBlZGl0YWJsZUFyZWFBbmNob3IoKSA6IHN0YW5kYXJkQW5jaG9yKCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldEJhbm5lckFuY2hvciA9IGZ1bmN0aW9uIChjb250ZW50QXJlYUVsZW1lbnQsIGxhenlBbmNob3JiYXIsIGxhenlVc2VFZGl0YWJsZUFyZWFBbmNob3IpIHtcbiAgICAgIHZhciBlZGl0YWJsZUFyZWFBbmNob3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiAnbm9kZScsXG4gICAgICAgICAgcm9vdDogZ2V0Q29udGVudENvbnRhaW5lcihjb250ZW50QXJlYUVsZW1lbnQoKSksXG4gICAgICAgICAgbm9kZTogT3B0aW9uYWwuZnJvbShjb250ZW50QXJlYUVsZW1lbnQoKSksXG4gICAgICAgICAgbGF5b3V0czoge1xuICAgICAgICAgICAgb25SdGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtub3J0aCQzXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkx0cjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gW25vcnRoJDNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgc3RhbmRhcmRBbmNob3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiAnaG90c3BvdCcsXG4gICAgICAgICAgaG90c3BvdDogbGF6eUFuY2hvcmJhcigpLFxuICAgICAgICAgIGxheW91dHM6IHtcbiAgICAgICAgICAgIG9uUnRsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbc291dGgkMV07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtzb3V0aCQxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGxhenlVc2VFZGl0YWJsZUFyZWFBbmNob3IoKSA/IGVkaXRhYmxlQXJlYUFuY2hvcigpIDogc3RhbmRhcmRBbmNob3IoKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0Q3Vyc29yQW5jaG9yID0gZnVuY3Rpb24gKGVkaXRvciwgYm9keUVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiAnc2VsZWN0aW9uJyxcbiAgICAgICAgICByb290OiBib2R5RWxlbWVudCgpLFxuICAgICAgICAgIGdldFNlbGVjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShTaW1TZWxlY3Rpb24ucmFuZ2UoU3VnYXJFbGVtZW50LmZyb21Eb20ocm5nLnN0YXJ0Q29udGFpbmVyKSwgcm5nLnN0YXJ0T2Zmc2V0LCBTdWdhckVsZW1lbnQuZnJvbURvbShybmcuZW5kQ29udGFpbmVyKSwgcm5nLmVuZE9mZnNldCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0Tm9kZUFuY2hvciA9IGZ1bmN0aW9uIChib2R5RWxlbWVudCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYW5jaG9yOiAnbm9kZScsXG4gICAgICAgICAgcm9vdDogYm9keUVsZW1lbnQoKSxcbiAgICAgICAgICBub2RlOiBlbGVtZW50XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldEFuY2hvcnMgPSBmdW5jdGlvbiAoZWRpdG9yLCBsYXp5QW5jaG9yYmFyLCBpc1Rvb2xiYXJUb3ApIHtcbiAgICAgIHZhciB1c2VGaXhlZFRvb2xiYXJDb250YWluZXIgPSB1c2VGaXhlZENvbnRhaW5lcihlZGl0b3IpO1xuICAgICAgdmFyIGJvZHlFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldEJvZHkoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNvbnRlbnRBcmVhRWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXRDb250ZW50QXJlYUNvbnRhaW5lcigpKTtcbiAgICAgIH07XG4gICAgICB2YXIgbGF6eVVzZUVkaXRhYmxlQXJlYUFuY2hvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVzZUZpeGVkVG9vbGJhckNvbnRhaW5lciB8fCAhaXNUb29sYmFyVG9wKCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaW5saW5lRGlhbG9nOiBnZXRJbmxpbmVEaWFsb2dBbmNob3IoY29udGVudEFyZWFFbGVtZW50LCBsYXp5QW5jaG9yYmFyLCBsYXp5VXNlRWRpdGFibGVBcmVhQW5jaG9yKSxcbiAgICAgICAgYmFubmVyOiBnZXRCYW5uZXJBbmNob3IoY29udGVudEFyZWFFbGVtZW50LCBsYXp5QW5jaG9yYmFyLCBsYXp5VXNlRWRpdGFibGVBcmVhQW5jaG9yKSxcbiAgICAgICAgY3Vyc29yOiBnZXRDdXJzb3JBbmNob3IoZWRpdG9yLCBib2R5RWxlbWVudCksXG4gICAgICAgIG5vZGU6IGdldE5vZGVBbmNob3IoYm9keUVsZW1lbnQpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgY29sb3JQaWNrZXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGNhbGxiYWNrLCB2YWx1ZSkge1xuICAgICAgICB2YXIgZGlhbG9nID0gY29sb3JQaWNrZXJEaWFsb2coZWRpdG9yKTtcbiAgICAgICAgZGlhbG9nKGNhbGxiYWNrLCB2YWx1ZSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGhhc0N1c3RvbUNvbG9ycyQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGhhc0N1c3RvbUNvbG9ycyhlZGl0b3IpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZXRDb2xvcnMkMiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnZXRDb2xvcnMoZWRpdG9yKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0Q29sb3JDb2xzJDIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0Q29sb3JDb2xzJDEoZWRpdG9yKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgQ29sb3JJbnB1dEJhY2tzdGFnZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbG9yUGlja2VyOiBjb2xvclBpY2tlcihlZGl0b3IpLFxuICAgICAgICBoYXNDdXN0b21Db2xvcnM6IGhhc0N1c3RvbUNvbG9ycyQxKGVkaXRvciksXG4gICAgICAgIGdldENvbG9yczogZ2V0Q29sb3JzJDIoZWRpdG9yKSxcbiAgICAgICAgZ2V0Q29sb3JDb2xzOiBnZXRDb2xvckNvbHMkMihlZGl0b3IpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgaXNEcmFnZ2FibGVNb2RhbCQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGlzRHJhZ2dhYmxlTW9kYWwoZWRpdG9yKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgRGlhbG9nQmFja3N0YWdlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIHsgaXNEcmFnZ2FibGVNb2RhbDogaXNEcmFnZ2FibGVNb2RhbCQxKGVkaXRvcikgfTtcbiAgICB9O1xuXG4gICAgdmFyIEhlYWRlckJhY2tzdGFnZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBtb2RlID0gQ2VsbChpc1Rvb2xiYXJMb2NhdGlvbkJvdHRvbShlZGl0b3IpID8gJ2JvdHRvbScgOiAndG9wJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc1Bvc2l0aW9uZWRBdFRvcDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtb2RlLmdldCgpID09PSAndG9wJztcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0RG9ja2luZ01vZGU6IG1vZGUuZ2V0LFxuICAgICAgICBzZXREb2NraW5nTW9kZTogbW9kZS5zZXRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBkZWZhdWx0U3R5bGVGb3JtYXRzID0gW1xuICAgICAge1xuICAgICAgICB0aXRsZTogJ0hlYWRpbmdzJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0hlYWRpbmcgMScsXG4gICAgICAgICAgICBmb3JtYXQ6ICdoMSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiAnSGVhZGluZyAyJyxcbiAgICAgICAgICAgIGZvcm1hdDogJ2gyJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdIZWFkaW5nIDMnLFxuICAgICAgICAgICAgZm9ybWF0OiAnaDMnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0hlYWRpbmcgNCcsXG4gICAgICAgICAgICBmb3JtYXQ6ICdoNCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiAnSGVhZGluZyA1JyxcbiAgICAgICAgICAgIGZvcm1hdDogJ2g1J1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdIZWFkaW5nIDYnLFxuICAgICAgICAgICAgZm9ybWF0OiAnaDYnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ0lubGluZScsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdCb2xkJyxcbiAgICAgICAgICAgIGZvcm1hdDogJ2JvbGQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0l0YWxpYycsXG4gICAgICAgICAgICBmb3JtYXQ6ICdpdGFsaWMnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ1VuZGVybGluZScsXG4gICAgICAgICAgICBmb3JtYXQ6ICd1bmRlcmxpbmUnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ1N0cmlrZXRocm91Z2gnLFxuICAgICAgICAgICAgZm9ybWF0OiAnc3RyaWtldGhyb3VnaCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiAnU3VwZXJzY3JpcHQnLFxuICAgICAgICAgICAgZm9ybWF0OiAnc3VwZXJzY3JpcHQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ1N1YnNjcmlwdCcsXG4gICAgICAgICAgICBmb3JtYXQ6ICdzdWJzY3JpcHQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0NvZGUnLFxuICAgICAgICAgICAgZm9ybWF0OiAnY29kZSdcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiAnQmxvY2tzJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ1BhcmFncmFwaCcsXG4gICAgICAgICAgICBmb3JtYXQ6ICdwJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdCbG9ja3F1b3RlJyxcbiAgICAgICAgICAgIGZvcm1hdDogJ2Jsb2NrcXVvdGUnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0RpdicsXG4gICAgICAgICAgICBmb3JtYXQ6ICdkaXYnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ1ByZScsXG4gICAgICAgICAgICBmb3JtYXQ6ICdwcmUnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ0FsaWduJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0xlZnQnLFxuICAgICAgICAgICAgZm9ybWF0OiAnYWxpZ25sZWZ0J1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdDZW50ZXInLFxuICAgICAgICAgICAgZm9ybWF0OiAnYWxpZ25jZW50ZXInXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ1JpZ2h0JyxcbiAgICAgICAgICAgIGZvcm1hdDogJ2FsaWducmlnaHQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZTogJ0p1c3RpZnknLFxuICAgICAgICAgICAgZm9ybWF0OiAnYWxpZ25qdXN0aWZ5J1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIF07XG4gICAgdmFyIGlzTmVzdGVkRm9ybWF0ID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgICAgcmV0dXJuIGhhcyhmb3JtYXQsICdpdGVtcycpO1xuICAgIH07XG4gICAgdmFyIGlzQmxvY2tGb3JtYXQgPSBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICByZXR1cm4gaGFzKGZvcm1hdCwgJ2Jsb2NrJyk7XG4gICAgfTtcbiAgICB2YXIgaXNJbmxpbmVGb3JtYXQgPSBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICByZXR1cm4gaGFzKGZvcm1hdCwgJ2lubGluZScpO1xuICAgIH07XG4gICAgdmFyIGlzU2VsZWN0b3JGb3JtYXQgPSBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICByZXR1cm4gaGFzKGZvcm1hdCwgJ3NlbGVjdG9yJyk7XG4gICAgfTtcbiAgICB2YXIgbWFwRm9ybWF0cyA9IGZ1bmN0aW9uICh1c2VyRm9ybWF0cykge1xuICAgICAgcmV0dXJuIGZvbGRsKHVzZXJGb3JtYXRzLCBmdW5jdGlvbiAoYWNjLCBmbXQpIHtcbiAgICAgICAgaWYgKGlzTmVzdGVkRm9ybWF0KGZtdCkpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gbWFwRm9ybWF0cyhmbXQuaXRlbXMpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjdXN0b21Gb3JtYXRzOiBhY2MuY3VzdG9tRm9ybWF0cy5jb25jYXQocmVzdWx0LmN1c3RvbUZvcm1hdHMpLFxuICAgICAgICAgICAgZm9ybWF0czogYWNjLmZvcm1hdHMuY29uY2F0KFt7XG4gICAgICAgICAgICAgICAgdGl0bGU6IGZtdC50aXRsZSxcbiAgICAgICAgICAgICAgICBpdGVtczogcmVzdWx0LmZvcm1hdHNcbiAgICAgICAgICAgICAgfV0pXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmIChpc0lubGluZUZvcm1hdChmbXQpIHx8IGlzQmxvY2tGb3JtYXQoZm10KSB8fCBpc1NlbGVjdG9yRm9ybWF0KGZtdCkpIHtcbiAgICAgICAgICB2YXIgZm9ybWF0TmFtZSA9IGlzU3RyaW5nKGZtdC5uYW1lKSA/IGZtdC5uYW1lIDogZm10LnRpdGxlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgdmFyIGZvcm1hdE5hbWVXaXRoUHJlZml4ID0gJ2N1c3RvbS0nICsgZm9ybWF0TmFtZTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3VzdG9tRm9ybWF0czogYWNjLmN1c3RvbUZvcm1hdHMuY29uY2F0KFt7XG4gICAgICAgICAgICAgICAgbmFtZTogZm9ybWF0TmFtZVdpdGhQcmVmaXgsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBmbXRcbiAgICAgICAgICAgICAgfV0pLFxuICAgICAgICAgICAgZm9ybWF0czogYWNjLmZvcm1hdHMuY29uY2F0KFt7XG4gICAgICAgICAgICAgICAgdGl0bGU6IGZtdC50aXRsZSxcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdE5hbWVXaXRoUHJlZml4LFxuICAgICAgICAgICAgICAgIGljb246IGZtdC5pY29uXG4gICAgICAgICAgICAgIH1dKVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBhY2MpLCB7IGZvcm1hdHM6IGFjYy5mb3JtYXRzLmNvbmNhdChmbXQpIH0pO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGN1c3RvbUZvcm1hdHM6IFtdLFxuICAgICAgICBmb3JtYXRzOiBbXVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJDdXN0b21Gb3JtYXRzID0gZnVuY3Rpb24gKGVkaXRvciwgdXNlckZvcm1hdHMpIHtcbiAgICAgIHZhciByZXN1bHQgPSBtYXBGb3JtYXRzKHVzZXJGb3JtYXRzKTtcbiAgICAgIHZhciByZWdpc3RlckZvcm1hdHMgPSBmdW5jdGlvbiAoY3VzdG9tRm9ybWF0cykge1xuICAgICAgICBlYWNoKGN1c3RvbUZvcm1hdHMsIGZ1bmN0aW9uIChmbXQpIHtcbiAgICAgICAgICBpZiAoIWVkaXRvci5mb3JtYXR0ZXIuaGFzKGZtdC5uYW1lKSkge1xuICAgICAgICAgICAgZWRpdG9yLmZvcm1hdHRlci5yZWdpc3RlcihmbXQubmFtZSwgZm10LmZvcm1hdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBpZiAoZWRpdG9yLmZvcm1hdHRlcikge1xuICAgICAgICByZWdpc3RlckZvcm1hdHMocmVzdWx0LmN1c3RvbUZvcm1hdHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWRpdG9yLm9uKCdpbml0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJlZ2lzdGVyRm9ybWF0cyhyZXN1bHQuY3VzdG9tRm9ybWF0cyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdC5mb3JtYXRzO1xuICAgIH07XG4gICAgdmFyIGdldFN0eWxlRm9ybWF0cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnZXRVc2VyU3R5bGVGb3JtYXRzKGVkaXRvcikubWFwKGZ1bmN0aW9uICh1c2VyRm9ybWF0cykge1xuICAgICAgICB2YXIgcmVnaXN0ZXJlZFVzZXJGb3JtYXRzID0gcmVnaXN0ZXJDdXN0b21Gb3JtYXRzKGVkaXRvciwgdXNlckZvcm1hdHMpO1xuICAgICAgICByZXR1cm4gaXNNZXJnZVN0eWxlRm9ybWF0cyhlZGl0b3IpID8gZGVmYXVsdFN0eWxlRm9ybWF0cy5jb25jYXQocmVnaXN0ZXJlZFVzZXJGb3JtYXRzKSA6IHJlZ2lzdGVyZWRVc2VyRm9ybWF0cztcbiAgICAgIH0pLmdldE9yKGRlZmF1bHRTdHlsZUZvcm1hdHMpO1xuICAgIH07XG5cbiAgICB2YXIgcHJvY2Vzc0Jhc2ljID0gZnVuY3Rpb24gKGl0ZW0sIGlzU2VsZWN0ZWRGb3IsIGdldFByZXZpZXdGb3IpIHtcbiAgICAgIHZhciBmb3JtYXR0ZXJTcGVjID0ge1xuICAgICAgICB0eXBlOiAnZm9ybWF0dGVyJyxcbiAgICAgICAgaXNTZWxlY3RlZDogaXNTZWxlY3RlZEZvcihpdGVtLmZvcm1hdCksXG4gICAgICAgIGdldFN0eWxlUHJldmlldzogZ2V0UHJldmlld0ZvcihpdGVtLmZvcm1hdClcbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVlcE1lcmdlKGl0ZW0sIGZvcm1hdHRlclNwZWMpO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyJDMgPSBmdW5jdGlvbiAoZWRpdG9yLCBmb3JtYXRzLCBpc1NlbGVjdGVkRm9yLCBnZXRQcmV2aWV3Rm9yKSB7XG4gICAgICB2YXIgZW5yaWNoU3VwcG9ydGVkID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NCYXNpYyhpdGVtLCBpc1NlbGVjdGVkRm9yLCBnZXRQcmV2aWV3Rm9yKTtcbiAgICAgIH07XG4gICAgICB2YXIgZW5yaWNoTWVudSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciBzdWJtZW51U3BlYyA9IHsgdHlwZTogJ3N1Ym1lbnUnIH07XG4gICAgICAgIHJldHVybiBkZWVwTWVyZ2UoaXRlbSwgc3VibWVudVNwZWMpO1xuICAgICAgfTtcbiAgICAgIHZhciBlbnJpY2hDdXN0b20gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICB2YXIgZm9ybWF0TmFtZSA9IGlzU3RyaW5nKGl0ZW0ubmFtZSkgPyBpdGVtLm5hbWUgOiBnZW5lcmF0ZSQxKGl0ZW0udGl0bGUpO1xuICAgICAgICB2YXIgZm9ybWF0TmFtZVdpdGhQcmVmaXggPSAnY3VzdG9tLScgKyBmb3JtYXROYW1lO1xuICAgICAgICB2YXIgY3VzdG9tU3BlYyA9IHtcbiAgICAgICAgICB0eXBlOiAnZm9ybWF0dGVyJyxcbiAgICAgICAgICBmb3JtYXQ6IGZvcm1hdE5hbWVXaXRoUHJlZml4LFxuICAgICAgICAgIGlzU2VsZWN0ZWQ6IGlzU2VsZWN0ZWRGb3IoZm9ybWF0TmFtZVdpdGhQcmVmaXgpLFxuICAgICAgICAgIGdldFN0eWxlUHJldmlldzogZ2V0UHJldmlld0Zvcihmb3JtYXROYW1lV2l0aFByZWZpeClcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG5ld0l0ZW0gPSBkZWVwTWVyZ2UoaXRlbSwgY3VzdG9tU3BlYyk7XG4gICAgICAgIGVkaXRvci5mb3JtYXR0ZXIucmVnaXN0ZXIoZm9ybWF0TmFtZSwgbmV3SXRlbSk7XG4gICAgICAgIHJldHVybiBuZXdJdGVtO1xuICAgICAgfTtcbiAgICAgIHZhciBkb0VucmljaCA9IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICByZXR1cm4gbWFwKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHZhciBrZXlzJDEgPSBrZXlzKGl0ZW0pO1xuICAgICAgICAgIGlmIChoYXNOb25OdWxsYWJsZUtleShpdGVtLCAnaXRlbXMnKSkge1xuICAgICAgICAgICAgdmFyIG5ld0l0ZW1zXzEgPSBkb0VucmljaChpdGVtLml0ZW1zKTtcbiAgICAgICAgICAgIHJldHVybiBkZWVwTWVyZ2UoZW5yaWNoTWVudShpdGVtKSwge1xuICAgICAgICAgICAgICBnZXRTdHlsZUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld0l0ZW1zXzE7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaGFzTm9uTnVsbGFibGVLZXkoaXRlbSwgJ2Zvcm1hdCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gZW5yaWNoU3VwcG9ydGVkKGl0ZW0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoa2V5cyQxLmxlbmd0aCA9PT0gMSAmJiBjb250YWlucyhrZXlzJDEsICd0aXRsZScpKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVlcE1lcmdlKGl0ZW0sIHsgdHlwZTogJ3NlcGFyYXRvcicgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlbnJpY2hDdXN0b20oaXRlbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZG9FbnJpY2goZm9ybWF0cyk7XG4gICAgfTtcblxuICAgIHZhciBpbml0JDcgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgaXNTZWxlY3RlZEZvciA9IGZ1bmN0aW9uIChmb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmZvcm1hdHRlci5tYXRjaChmb3JtYXQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRQcmV2aWV3Rm9yID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBmbXQgPSBlZGl0b3IuZm9ybWF0dGVyLmdldChmb3JtYXQpO1xuICAgICAgICAgIHJldHVybiBmbXQgIT09IHVuZGVmaW5lZCA/IE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgdGFnOiBmbXQubGVuZ3RoID4gMCA/IGZtdFswXS5pbmxpbmUgfHwgZm10WzBdLmJsb2NrIHx8ICdkaXYnIDogJ2RpdicsXG4gICAgICAgICAgICBzdHlsZXM6IGVkaXRvci5kb20ucGFyc2VTdHlsZShlZGl0b3IuZm9ybWF0dGVyLmdldENzc1RleHQoZm9ybWF0KSlcbiAgICAgICAgICB9KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uIChmbXQpIHtcbiAgICAgICAgdmFyIHN1YnMgPSBmbXQuaXRlbXM7XG4gICAgICAgIHJldHVybiBzdWJzICE9PSB1bmRlZmluZWQgJiYgc3Vicy5sZW5ndGggPiAwID8gYmluZChzdWJzLCBmbGF0dGVuKSA6IFtmbXQuZm9ybWF0XTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0dGluZ3NGb3JtYXRzID0gQ2VsbChbXSk7XG4gICAgICB2YXIgc2V0dGluZ3NGbGF0dGVuZWRGb3JtYXRzID0gQ2VsbChbXSk7XG4gICAgICB2YXIgZXZlbnRzRm9ybWF0cyA9IENlbGwoW10pO1xuICAgICAgdmFyIGV2ZW50c0ZsYXR0ZW5lZEZvcm1hdHMgPSBDZWxsKFtdKTtcbiAgICAgIHZhciByZXBsYWNlU2V0dGluZ3MgPSBDZWxsKGZhbHNlKTtcbiAgICAgIGVkaXRvci5vbignUHJlSW5pdCcsIGZ1bmN0aW9uIChfZSkge1xuICAgICAgICB2YXIgZm9ybWF0cyA9IGdldFN0eWxlRm9ybWF0cyhlZGl0b3IpO1xuICAgICAgICB2YXIgZW5yaWNoZWQgPSByZWdpc3RlciQzKGVkaXRvciwgZm9ybWF0cywgaXNTZWxlY3RlZEZvciwgZ2V0UHJldmlld0Zvcik7XG4gICAgICAgIHNldHRpbmdzRm9ybWF0cy5zZXQoZW5yaWNoZWQpO1xuICAgICAgICBzZXR0aW5nc0ZsYXR0ZW5lZEZvcm1hdHMuc2V0KGJpbmQoZW5yaWNoZWQsIGZsYXR0ZW4pKTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdhZGRTdHlsZU1vZGlmaWNhdGlvbnMnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgbW9kaWZpY2F0aW9ucyA9IHJlZ2lzdGVyJDMoZWRpdG9yLCBlLml0ZW1zLCBpc1NlbGVjdGVkRm9yLCBnZXRQcmV2aWV3Rm9yKTtcbiAgICAgICAgZXZlbnRzRm9ybWF0cy5zZXQobW9kaWZpY2F0aW9ucyk7XG4gICAgICAgIHJlcGxhY2VTZXR0aW5ncy5zZXQoZS5yZXBsYWNlKTtcbiAgICAgICAgZXZlbnRzRmxhdHRlbmVkRm9ybWF0cy5zZXQoYmluZChtb2RpZmljYXRpb25zLCBmbGF0dGVuKSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBnZXREYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZnJvbVNldHRpbmdzID0gcmVwbGFjZVNldHRpbmdzLmdldCgpID8gW10gOiBzZXR0aW5nc0Zvcm1hdHMuZ2V0KCk7XG4gICAgICAgIHZhciBmcm9tRXZlbnRzID0gZXZlbnRzRm9ybWF0cy5nZXQoKTtcbiAgICAgICAgcmV0dXJuIGZyb21TZXR0aW5ncy5jb25jYXQoZnJvbUV2ZW50cyk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldEZsYXR0ZW5lZEtleXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBmcm9tU2V0dGluZ3MgPSByZXBsYWNlU2V0dGluZ3MuZ2V0KCkgPyBbXSA6IHNldHRpbmdzRmxhdHRlbmVkRm9ybWF0cy5nZXQoKTtcbiAgICAgICAgdmFyIGZyb21FdmVudHMgPSBldmVudHNGbGF0dGVuZWRGb3JtYXRzLmdldCgpO1xuICAgICAgICByZXR1cm4gZnJvbVNldHRpbmdzLmNvbmNhdChmcm9tRXZlbnRzKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXREYXRhOiBnZXREYXRhLFxuICAgICAgICBnZXRGbGF0dGVuZWRLZXlzOiBnZXRGbGF0dGVuZWRLZXlzXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgaXNFbGVtZW50JDIgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIGlzTm9uTnVsbGFibGUobm9kZSkgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMTtcbiAgICB9O1xuICAgIHZhciB0cmltJDEgPSBnbG9iYWwkYy50cmltO1xuICAgIHZhciBoYXNDb250ZW50RWRpdGFibGVTdGF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIGlmIChpc0VsZW1lbnQkMihub2RlKSkge1xuICAgICAgICAgIGlmIChub2RlLmNvbnRlbnRFZGl0YWJsZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLWNvbnRlbnRlZGl0YWJsZScpID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNDb250ZW50RWRpdGFibGVUcnVlID0gaGFzQ29udGVudEVkaXRhYmxlU3RhdGUoJ3RydWUnKTtcbiAgICB2YXIgaXNDb250ZW50RWRpdGFibGVGYWxzZSA9IGhhc0NvbnRlbnRFZGl0YWJsZVN0YXRlKCdmYWxzZScpO1xuICAgIHZhciBjcmVhdGUkOCA9IGZ1bmN0aW9uICh0eXBlLCB0aXRsZSwgdXJsLCBsZXZlbCwgYXR0YWNoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICB0aXRsZTogdGl0bGUsXG4gICAgICAgIHVybDogdXJsLFxuICAgICAgICBsZXZlbDogbGV2ZWwsXG4gICAgICAgIGF0dGFjaDogYXR0YWNoXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzQ2hpbGRPZkNvbnRlbnRFZGl0YWJsZVRydWUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgd2hpbGUgKG5vZGUgPSBub2RlLnBhcmVudE5vZGUpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gbm9kZS5jb250ZW50RWRpdGFibGU7XG4gICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPT0gJ2luaGVyaXQnKSB7XG4gICAgICAgICAgcmV0dXJuIGlzQ29udGVudEVkaXRhYmxlVHJ1ZShub2RlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgdmFyIHNlbGVjdCA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgcm9vdCkge1xuICAgICAgcmV0dXJuIG1hcChkZXNjZW5kYW50cyhTdWdhckVsZW1lbnQuZnJvbURvbShyb290KSwgc2VsZWN0b3IpLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5kb207XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRFbGVtZW50VGV4dCA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBlbG0uaW5uZXJUZXh0IHx8IGVsbS50ZXh0Q29udGVudDtcbiAgICB9O1xuICAgIHZhciBnZXRPckdlbmVyYXRlSWQgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICByZXR1cm4gZWxtLmlkID8gZWxtLmlkIDogZ2VuZXJhdGUkMSgnaCcpO1xuICAgIH07XG4gICAgdmFyIGlzQW5jaG9yID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGVsbSAmJiBlbG0ubm9kZU5hbWUgPT09ICdBJyAmJiAoZWxtLmlkIHx8IGVsbS5uYW1lKSAhPT0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdmFyIGlzVmFsaWRBbmNob3IgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICByZXR1cm4gaXNBbmNob3IoZWxtKSAmJiBpc0VkaXRhYmxlKGVsbSk7XG4gICAgfTtcbiAgICB2YXIgaXNIZWFkZXIgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICByZXR1cm4gZWxtICYmIC9eKEhbMS02XSkkLy50ZXN0KGVsbS5ub2RlTmFtZSk7XG4gICAgfTtcbiAgICB2YXIgaXNFZGl0YWJsZSA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBpc0NoaWxkT2ZDb250ZW50RWRpdGFibGVUcnVlKGVsbSkgJiYgIWlzQ29udGVudEVkaXRhYmxlRmFsc2UoZWxtKTtcbiAgICB9O1xuICAgIHZhciBpc1ZhbGlkSGVhZGVyID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGlzSGVhZGVyKGVsbSkgJiYgaXNFZGl0YWJsZShlbG0pO1xuICAgIH07XG4gICAgdmFyIGdldExldmVsID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGlzSGVhZGVyKGVsbSkgPyBwYXJzZUludChlbG0ubm9kZU5hbWUuc3Vic3RyKDEpLCAxMCkgOiAwO1xuICAgIH07XG4gICAgdmFyIGhlYWRlclRhcmdldCA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHZhciBoZWFkZXJJZCA9IGdldE9yR2VuZXJhdGVJZChlbG0pO1xuICAgICAgdmFyIGF0dGFjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZWxtLmlkID0gaGVhZGVySWQ7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGNyZWF0ZSQ4KCdoZWFkZXInLCBnZXRFbGVtZW50VGV4dChlbG0pLCAnIycgKyBoZWFkZXJJZCwgZ2V0TGV2ZWwoZWxtKSwgYXR0YWNoKTtcbiAgICB9O1xuICAgIHZhciBhbmNob3JUYXJnZXQgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICB2YXIgYW5jaG9ySWQgPSBlbG0uaWQgfHwgZWxtLm5hbWU7XG4gICAgICB2YXIgYW5jaG9yVGV4dCA9IGdldEVsZW1lbnRUZXh0KGVsbSk7XG4gICAgICByZXR1cm4gY3JlYXRlJDgoJ2FuY2hvcicsIGFuY2hvclRleHQgPyBhbmNob3JUZXh0IDogJyMnICsgYW5jaG9ySWQsICcjJyArIGFuY2hvcklkLCAwLCBub29wKTtcbiAgICB9O1xuICAgIHZhciBnZXRIZWFkZXJUYXJnZXRzID0gZnVuY3Rpb24gKGVsbXMpIHtcbiAgICAgIHJldHVybiBtYXAoZmlsdGVyKGVsbXMsIGlzVmFsaWRIZWFkZXIpLCBoZWFkZXJUYXJnZXQpO1xuICAgIH07XG4gICAgdmFyIGdldEFuY2hvclRhcmdldHMgPSBmdW5jdGlvbiAoZWxtcykge1xuICAgICAgcmV0dXJuIG1hcChmaWx0ZXIoZWxtcywgaXNWYWxpZEFuY2hvciksIGFuY2hvclRhcmdldCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VGFyZ2V0RWxlbWVudHMgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICB2YXIgZWxtcyA9IHNlbGVjdCgnaDEsaDIsaDMsaDQsaDUsaDYsYTpub3QoW2hyZWZdKScsIGVsbSk7XG4gICAgICByZXR1cm4gZWxtcztcbiAgICB9O1xuICAgIHZhciBoYXNUaXRsZSA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIHJldHVybiB0cmltJDEodGFyZ2V0LnRpdGxlKS5sZW5ndGggPiAwO1xuICAgIH07XG4gICAgdmFyIGZpbmQkNSA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHZhciBlbG1zID0gZ2V0VGFyZ2V0RWxlbWVudHMoZWxtKTtcbiAgICAgIHJldHVybiBmaWx0ZXIoZ2V0SGVhZGVyVGFyZ2V0cyhlbG1zKS5jb25jYXQoZ2V0QW5jaG9yVGFyZ2V0cyhlbG1zKSksIGhhc1RpdGxlKTtcbiAgICB9O1xuICAgIHZhciBMaW5rVGFyZ2V0cyA9IHsgZmluZDogZmluZCQ1IH07XG5cbiAgICB2YXIgU1RPUkFHRV9LRVkgPSAndGlueW1jZS11cmwtaGlzdG9yeSc7XG4gICAgdmFyIEhJU1RPUllfTEVOR1RIID0gNTtcbiAgICB2YXIgaXNIdHRwVXJsID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgcmV0dXJuIGlzU3RyaW5nKHVybCkgJiYgL15odHRwcz8vLnRlc3QodXJsKTtcbiAgICB9O1xuICAgIHZhciBpc0FycmF5T2ZVcmwgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGlzQXJyYXkoYSkgJiYgYS5sZW5ndGggPD0gSElTVE9SWV9MRU5HVEggJiYgZm9yYWxsKGEsIGlzSHR0cFVybCk7XG4gICAgfTtcbiAgICB2YXIgaXNSZWNvcmRPZlVybEFycmF5ID0gZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiBpc09iamVjdChyKSAmJiBmaW5kJDEociwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAhaXNBcnJheU9mVXJsKHZhbHVlKTtcbiAgICAgIH0pLmlzTm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGdldEFsbEhpc3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdW5wYXJzZWRIaXN0b3J5ID0gZ2xvYmFsJDkuZ2V0SXRlbShTVE9SQUdFX0tFWSk7XG4gICAgICBpZiAodW5wYXJzZWRIaXN0b3J5ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICAgIH1cbiAgICAgIHZhciBoaXN0b3J5O1xuICAgICAgdHJ5IHtcbiAgICAgICAgaGlzdG9yeSA9IEpTT04ucGFyc2UodW5wYXJzZWRIaXN0b3J5KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBTeW50YXhFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2NhbCBzdG9yYWdlICcgKyBTVE9SQUdFX0tFWSArICcgd2FzIG5vdCB2YWxpZCBKU09OJywgZSk7XG4gICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgICBpZiAoIWlzUmVjb3JkT2ZVcmxBcnJheShoaXN0b3J5KSkge1xuICAgICAgICBjb25zb2xlLmxvZygnTG9jYWwgc3RvcmFnZSAnICsgU1RPUkFHRV9LRVkgKyAnIHdhcyBub3QgdmFsaWQgZm9ybWF0JywgaGlzdG9yeSk7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBoaXN0b3J5O1xuICAgIH07XG4gICAgdmFyIHNldEFsbEhpc3RvcnkgPSBmdW5jdGlvbiAoaGlzdG9yeSkge1xuICAgICAgaWYgKCFpc1JlY29yZE9mVXJsQXJyYXkoaGlzdG9yeSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgZm9ybWF0IGZvciBoaXN0b3J5OlxcbicgKyBKU09OLnN0cmluZ2lmeShoaXN0b3J5KSk7XG4gICAgICB9XG4gICAgICBnbG9iYWwkOS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShoaXN0b3J5KSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SGlzdG9yeSA9IGZ1bmN0aW9uIChmaWxlVHlwZSkge1xuICAgICAgdmFyIGhpc3RvcnkgPSBnZXRBbGxIaXN0b3J5KCk7XG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGhpc3RvcnksIGZpbGVUeXBlKSA/IGhpc3RvcnlbZmlsZVR5cGVdIDogW107XG4gICAgfTtcbiAgICB2YXIgYWRkVG9IaXN0b3J5ID0gZnVuY3Rpb24gKHVybCwgZmlsZVR5cGUpIHtcbiAgICAgIGlmICghaXNIdHRwVXJsKHVybCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGhpc3RvcnkgPSBnZXRBbGxIaXN0b3J5KCk7XG4gICAgICB2YXIgaXRlbXMgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaGlzdG9yeSwgZmlsZVR5cGUpID8gaGlzdG9yeVtmaWxlVHlwZV0gOiBbXTtcbiAgICAgIHZhciBpdGVtc1dpdGhvdXRVcmwgPSBmaWx0ZXIoaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtICE9PSB1cmw7XG4gICAgICB9KTtcbiAgICAgIGhpc3RvcnlbZmlsZVR5cGVdID0gW3VybF0uY29uY2F0KGl0ZW1zV2l0aG91dFVybCkuc2xpY2UoMCwgSElTVE9SWV9MRU5HVEgpO1xuICAgICAgc2V0QWxsSGlzdG9yeShoaXN0b3J5KTtcbiAgICB9O1xuXG4gICAgdmFyIGlzVHJ1dGh5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gISF2YWx1ZTtcbiAgICB9O1xuICAgIHZhciBtYWtlTWFwID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gbWFwJDIoZ2xvYmFsJGMubWFrZU1hcCh2YWx1ZSwgL1ssIF0vKSwgaXNUcnV0aHkpO1xuICAgIH07XG4gICAgdmFyIGdldFBpY2tlciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGdldEZpbGVQaWNrZXJDYWxsYmFjayhlZGl0b3IpKS5maWx0ZXIoaXNGdW5jdGlvbik7XG4gICAgfTtcbiAgICB2YXIgZ2V0UGlja2VyVHlwZXMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgb3B0RmlsZVR5cGVzID0gT3B0aW9uYWwuc29tZShnZXRGaWxlUGlja2VyVHlwZXMoZWRpdG9yKSkuZmlsdGVyKGlzVHJ1dGh5KTtcbiAgICAgIHZhciBvcHRMZWdhY3lUeXBlcyA9IE9wdGlvbmFsLnNvbWUoZ2V0RmlsZUJyb3dzZXJDYWxsYmFja1R5cGVzKGVkaXRvcikpLmZpbHRlcihpc1RydXRoeSk7XG4gICAgICB2YXIgb3B0VHlwZXMgPSBvcHRGaWxlVHlwZXMub3Iob3B0TGVnYWN5VHlwZXMpLm1hcChtYWtlTWFwKTtcbiAgICAgIHJldHVybiBnZXRQaWNrZXIoZWRpdG9yKS5mb2xkKG5ldmVyLCBmdW5jdGlvbiAoX3BpY2tlcikge1xuICAgICAgICByZXR1cm4gb3B0VHlwZXMuZm9sZChhbHdheXMsIGZ1bmN0aW9uICh0eXBlcykge1xuICAgICAgICAgIHJldHVybiBrZXlzKHR5cGVzKS5sZW5ndGggPiAwID8gdHlwZXMgOiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRQaWNrZXJTZXR0aW5nID0gZnVuY3Rpb24gKGVkaXRvciwgZmlsZXR5cGUpIHtcbiAgICAgIHZhciBwaWNrZXJUeXBlcyA9IGdldFBpY2tlclR5cGVzKGVkaXRvcik7XG4gICAgICBpZiAoaXNCb29sZWFuKHBpY2tlclR5cGVzKSkge1xuICAgICAgICByZXR1cm4gcGlja2VyVHlwZXMgPyBnZXRQaWNrZXIoZWRpdG9yKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwaWNrZXJUeXBlc1tmaWxldHlwZV0gPyBnZXRQaWNrZXIoZWRpdG9yKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRVcmxQaWNrZXIgPSBmdW5jdGlvbiAoZWRpdG9yLCBmaWxldHlwZSkge1xuICAgICAgcmV0dXJuIGdldFBpY2tlclNldHRpbmcoZWRpdG9yLCBmaWxldHlwZSkubWFwKGZ1bmN0aW9uIChwaWNrZXIpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgIHJldHVybiBGdXR1cmUubnUoZnVuY3Rpb24gKGNvbXBsZXRlcikge1xuICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAodmFsdWUsIG1ldGEpIHtcbiAgICAgICAgICAgICAgaWYgKCFpc1N0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHZhbHVlIHRvIGJlIHN0cmluZycpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChtZXRhICE9PSB1bmRlZmluZWQgJiYgIWlzT2JqZWN0KG1ldGEpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCBtZXRhIHRvIGJlIGEgb2JqZWN0Jyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIHIgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgIG1ldGE6IG1ldGFcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgY29tcGxldGVyKHIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBtZXRhID0gX19hc3NpZ24oe1xuICAgICAgICAgICAgICBmaWxldHlwZTogZmlsZXR5cGUsXG4gICAgICAgICAgICAgIGZpZWxkbmFtZTogZW50cnkuZmllbGRuYW1lXG4gICAgICAgICAgICB9LCBPcHRpb25hbC5mcm9tKGVudHJ5Lm1ldGEpLmdldE9yKHt9KSk7XG4gICAgICAgICAgICBwaWNrZXIuY2FsbChlZGl0b3IsIGhhbmRsZXIsIGVudHJ5LnZhbHVlLCBtZXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFRleHRTZXR0aW5nID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbSh2YWx1ZSkuZmlsdGVyKGlzU3RyaW5nKS5nZXRPclVuZGVmaW5lZCgpO1xuICAgIH07XG4gICAgdmFyIGdldExpbmtJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGlmIChub1R5cGVhaGVhZFVybHMoZWRpdG9yKSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICB0YXJnZXRzOiBMaW5rVGFyZ2V0cy5maW5kKGVkaXRvci5nZXRCb2R5KCkpLFxuICAgICAgICBhbmNob3JUb3A6IGdldFRleHRTZXR0aW5nKGdldEFuY2hvclRvcChlZGl0b3IpKSxcbiAgICAgICAgYW5jaG9yQm90dG9tOiBnZXRUZXh0U2V0dGluZyhnZXRBbmNob3JCb3R0b20oZWRpdG9yKSlcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFZhbGlkYXRpb25IYW5kbGVyID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZ2V0RmlsZVBpY2tlclZhbGlkYXRvckhhbmRsZXIoZWRpdG9yKSk7XG4gICAgfTtcbiAgICB2YXIgVXJsSW5wdXRCYWNrc3RhZ2UgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRIaXN0b3J5OiBnZXRIaXN0b3J5LFxuICAgICAgICBhZGRUb0hpc3Rvcnk6IGFkZFRvSGlzdG9yeSxcbiAgICAgICAgZ2V0TGlua0luZm9ybWF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGdldExpbmtJbmZvcm1hdGlvbihlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRWYWxpZGF0aW9uSGFuZGxlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXRWYWxpZGF0aW9uSGFuZGxlcihlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRVcmxQaWNrZXI6IGZ1bmN0aW9uIChmaWxldHlwZSkge1xuICAgICAgICAgIHJldHVybiBnZXRVcmxQaWNrZXIoZWRpdG9yLCBmaWxldHlwZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBpbml0JDggPSBmdW5jdGlvbiAoc2luaywgZWRpdG9yLCBsYXp5QW5jaG9yYmFyKSB7XG4gICAgICB2YXIgY29udGV4dE1lbnVTdGF0ZSA9IENlbGwoZmFsc2UpO1xuICAgICAgdmFyIHRvb2xiYXIgPSBIZWFkZXJCYWNrc3RhZ2UoZWRpdG9yKTtcbiAgICAgIHZhciBiYWNrc3RhZ2UgPSB7XG4gICAgICAgIHNoYXJlZDoge1xuICAgICAgICAgIHByb3ZpZGVyczoge1xuICAgICAgICAgICAgaWNvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGVkaXRvci51aS5yZWdpc3RyeS5nZXRBbGwoKS5pY29ucztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZW51SXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGVkaXRvci51aS5yZWdpc3RyeS5nZXRBbGwoKS5tZW51SXRlbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHJhbnNsYXRlOiBnbG9iYWwkNi50cmFuc2xhdGUsXG4gICAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBlZGl0b3IubW9kZS5pc1JlYWRPbmx5KCkgfHwgZWRpdG9yLnVpLmlzRGlzYWJsZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRTZXR0aW5nOiBlZGl0b3IuZ2V0UGFyYW0uYmluZChlZGl0b3IpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbnRlcnByZXRlcjogZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcnByZXRXaXRob3V0Rm9ybShzLCBiYWNrc3RhZ2UpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYW5jaG9yczogZ2V0QW5jaG9ycyhlZGl0b3IsIGxhenlBbmNob3JiYXIsIHRvb2xiYXIuaXNQb3NpdGlvbmVkQXRUb3ApLFxuICAgICAgICAgIGhlYWRlcjogdG9vbGJhcixcbiAgICAgICAgICBnZXRTaW5rOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LnZhbHVlKHNpbmspO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdXJsaW5wdXQ6IFVybElucHV0QmFja3N0YWdlKGVkaXRvciksXG4gICAgICAgIHN0eWxlc2VsZWN0OiBpbml0JDcoZWRpdG9yKSxcbiAgICAgICAgY29sb3JpbnB1dDogQ29sb3JJbnB1dEJhY2tzdGFnZShlZGl0b3IpLFxuICAgICAgICBkaWFsb2c6IERpYWxvZ0JhY2tzdGFnZShlZGl0b3IpLFxuICAgICAgICBpc0NvbnRleHRNZW51T3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjb250ZXh0TWVudVN0YXRlLmdldCgpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRDb250ZXh0TWVudVN0YXRlOiBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICByZXR1cm4gY29udGV4dE1lbnVTdGF0ZS5zZXQoc3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGJhY2tzdGFnZTtcbiAgICB9O1xuXG4gICAgdmFyIGV4cGFuZGFibGUkMSA9IGNvbnN0YW50KGZ1bmN0aW9uIChlbGVtZW50LCBhdmFpbGFibGUpIHtcbiAgICAgIHNldE1heCQxKGVsZW1lbnQsIE1hdGguZmxvb3IoYXZhaWxhYmxlKSk7XG4gICAgfSk7XG5cbiAgICB2YXIgc2hvd0NvbnRleHRUb29sYmFyRXZlbnQgPSAnY29udGV4dHRvb2xiYXItc2hvdyc7XG4gICAgdmFyIGhpZGVDb250ZXh0VG9vbGJhckV2ZW50ID0gJ2NvbnRleHR0b29sYmFyLWhpZGUnO1xuXG4gICAgdmFyIHNjaGVtYSRrID0gY29uc3RhbnQoW1xuICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3NoZWxsJywgdHJ1ZSksXG4gICAgICBmaWVsZCQxKCd0b29sYmFyQmVoYXZpb3VycycsIFtSZXBsYWNpbmddKVxuICAgIF0pO1xuICAgIHZhciBlbmhhbmNlR3JvdXBzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHsgYmVoYXZpb3VyczogZGVyaXZlJDEoW1JlcGxhY2luZy5jb25maWcoe30pXSkgfTtcbiAgICB9O1xuICAgIHZhciBwYXJ0cyQ3ID0gY29uc3RhbnQoW29wdGlvbmFsKHtcbiAgICAgICAgbmFtZTogJ2dyb3VwcycsXG4gICAgICAgIG92ZXJyaWRlczogZW5oYW5jZUdyb3Vwc1xuICAgICAgfSldKTtcblxuICAgIHZhciBmYWN0b3J5JDkgPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzLCBfc3BlYywgX2V4dGVybmFscykge1xuICAgICAgdmFyIHNldEdyb3VwcyA9IGZ1bmN0aW9uICh0b29sYmFyLCBncm91cHMpIHtcbiAgICAgICAgZ2V0R3JvdXBDb250YWluZXIodG9vbGJhcikuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignVG9vbGJhciB3YXMgZGVmaW5lZCB0byBub3QgYmUgYSBzaGVsbCwgYnV0IG5vIGdyb3VwcyBjb250YWluZXIgd2FzIHNwZWNpZmllZCBpbiBjb21wb25lbnRzJyk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUb29sYmFyIHdhcyBkZWZpbmVkIHRvIG5vdCBiZSBhIHNoZWxsLCBidXQgbm8gZ3JvdXBzIGNvbnRhaW5lciB3YXMgc3BlY2lmaWVkIGluIGNvbXBvbmVudHMnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgIFJlcGxhY2luZy5zZXQoY29udGFpbmVyLCBncm91cHMpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0R3JvdXBDb250YWluZXIgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiBkZXRhaWwuc2hlbGwgPyBPcHRpb25hbC5zb21lKGNvbXBvbmVudCkgOiBnZXRQYXJ0KGNvbXBvbmVudCwgZGV0YWlsLCAnZ3JvdXBzJyk7XG4gICAgICB9O1xuICAgICAgdmFyIGV4dHJhID0gZGV0YWlsLnNoZWxsID8ge1xuICAgICAgICBiZWhhdmlvdXJzOiBbUmVwbGFjaW5nLmNvbmZpZyh7fSldLFxuICAgICAgICBjb21wb25lbnRzOiBbXVxuICAgICAgfSA6IHtcbiAgICAgICAgYmVoYXZpb3VyczogW10sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHNcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogZXh0cmEuY29tcG9uZW50cyxcbiAgICAgICAgYmVoYXZpb3VyczogYXVnbWVudChkZXRhaWwudG9vbGJhckJlaGF2aW91cnMsIGV4dHJhLmJlaGF2aW91cnMpLFxuICAgICAgICBhcGlzOiB7IHNldEdyb3Vwczogc2V0R3JvdXBzIH0sXG4gICAgICAgIGRvbU1vZGlmaWNhdGlvbjogeyBhdHRyaWJ1dGVzOiB7IHJvbGU6ICdncm91cCcgfSB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFRvb2xiYXIgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnVG9vbGJhcicsXG4gICAgICBjb25maWdGaWVsZHM6IHNjaGVtYSRrKCksXG4gICAgICBwYXJ0RmllbGRzOiBwYXJ0cyQ3KCksXG4gICAgICBmYWN0b3J5OiBmYWN0b3J5JDksXG4gICAgICBhcGlzOiB7XG4gICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gKGFwaXMsIHRvb2xiYXIsIGdyb3Vwcykge1xuICAgICAgICAgIGFwaXMuc2V0R3JvdXBzKHRvb2xiYXIsIGdyb3Vwcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBnZW5lcmF0ZSQ2ID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICB2YXIgaW5pdCA9IHtcbiAgICAgICAgbGVuOiAwLFxuICAgICAgICBsaXN0OiBbXVxuICAgICAgfTtcbiAgICAgIHZhciByID0gZm9sZGwoeHMsIGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGYoYSwgYi5sZW4pO1xuICAgICAgICByZXR1cm4gdmFsdWUuZm9sZChjb25zdGFudChiKSwgZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGVuOiB2LmZpbmlzaCxcbiAgICAgICAgICAgIGxpc3Q6IGIubGlzdC5jb25jYXQoW3ZdKVxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfSwgaW5pdCk7XG4gICAgICByZXR1cm4gci5saXN0O1xuICAgIH07XG5cbiAgICB2YXIgb3V0cHV0JDEgPSBmdW5jdGlvbiAod2l0aGluLCBleHRyYSwgd2l0aGluV2lkdGgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdpdGhpbjogd2l0aGluLFxuICAgICAgICBleHRyYTogZXh0cmEsXG4gICAgICAgIHdpdGhpbldpZHRoOiB3aXRoaW5XaWR0aFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBhcHBvcnRpb24gPSBmdW5jdGlvbiAodW5pdHMsIHRvdGFsLCBsZW4pIHtcbiAgICAgIHZhciBwYXJyYXkgPSBnZW5lcmF0ZSQ2KHVuaXRzLCBmdW5jdGlvbiAodW5pdCwgY3VycmVudCkge1xuICAgICAgICB2YXIgd2lkdGggPSBsZW4odW5pdCk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBlbGVtZW50OiB1bml0LFxuICAgICAgICAgIHN0YXJ0OiBjdXJyZW50LFxuICAgICAgICAgIGZpbmlzaDogY3VycmVudCArIHdpZHRoLFxuICAgICAgICAgIHdpZHRoOiB3aWR0aFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHdpdGhpbiA9IGZpbHRlcihwYXJyYXksIGZ1bmN0aW9uICh1bml0KSB7XG4gICAgICAgIHJldHVybiB1bml0LmZpbmlzaCA8PSB0b3RhbDtcbiAgICAgIH0pO1xuICAgICAgdmFyIHdpdGhpbldpZHRoID0gZm9sZHIod2l0aGluLCBmdW5jdGlvbiAoYWNjLCBlbCkge1xuICAgICAgICByZXR1cm4gYWNjICsgZWwud2lkdGg7XG4gICAgICB9LCAwKTtcbiAgICAgIHZhciBleHRyYSA9IHBhcnJheS5zbGljZSh3aXRoaW4ubGVuZ3RoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdpdGhpbjogd2l0aGluLFxuICAgICAgICBleHRyYTogZXh0cmEsXG4gICAgICAgIHdpdGhpbldpZHRoOiB3aXRoaW5XaWR0aFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0b1VuaXQgPSBmdW5jdGlvbiAocGFycmF5KSB7XG4gICAgICByZXR1cm4gbWFwKHBhcnJheSwgZnVuY3Rpb24gKHVuaXQpIHtcbiAgICAgICAgcmV0dXJuIHVuaXQuZWxlbWVudDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZpdExhc3QgPSBmdW5jdGlvbiAod2l0aGluLCBleHRyYSwgd2l0aGluV2lkdGgpIHtcbiAgICAgIHZhciBmaXRzID0gdG9Vbml0KHdpdGhpbi5jb25jYXQoZXh0cmEpKTtcbiAgICAgIHJldHVybiBvdXRwdXQkMShmaXRzLCBbXSwgd2l0aGluV2lkdGgpO1xuICAgIH07XG4gICAgdmFyIG92ZXJmbG93ID0gZnVuY3Rpb24gKHdpdGhpbiwgZXh0cmEsIG92ZXJmbG93ZXIsIHdpdGhpbldpZHRoKSB7XG4gICAgICB2YXIgZml0cyA9IHRvVW5pdCh3aXRoaW4pLmNvbmNhdChbb3ZlcmZsb3dlcl0pO1xuICAgICAgcmV0dXJuIG91dHB1dCQxKGZpdHMsIHRvVW5pdChleHRyYSksIHdpdGhpbldpZHRoKTtcbiAgICB9O1xuICAgIHZhciBmaXRBbGwgPSBmdW5jdGlvbiAod2l0aGluLCBleHRyYSwgd2l0aGluV2lkdGgpIHtcbiAgICAgIHJldHVybiBvdXRwdXQkMSh0b1VuaXQod2l0aGluKSwgW10sIHdpdGhpbldpZHRoKTtcbiAgICB9O1xuICAgIHZhciB0cnlGaXQgPSBmdW5jdGlvbiAodG90YWwsIHVuaXRzLCBsZW4pIHtcbiAgICAgIHZhciBkaXZpZGUgPSBhcHBvcnRpb24odW5pdHMsIHRvdGFsLCBsZW4pO1xuICAgICAgcmV0dXJuIGRpdmlkZS5leHRyYS5sZW5ndGggPT09IDAgPyBPcHRpb25hbC5zb21lKGRpdmlkZSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgcGFydGl0aW9uJDMgPSBmdW5jdGlvbiAodG90YWwsIHVuaXRzLCBsZW4sIG92ZXJmbG93ZXIpIHtcbiAgICAgIHZhciBkaXZpZGUgPSB0cnlGaXQodG90YWwsIHVuaXRzLCBsZW4pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gYXBwb3J0aW9uKHVuaXRzLCB0b3RhbCAtIGxlbihvdmVyZmxvd2VyKSwgbGVuKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHdpdGhpbiA9IGRpdmlkZS53aXRoaW47XG4gICAgICB2YXIgZXh0cmEgPSBkaXZpZGUuZXh0cmE7XG4gICAgICB2YXIgd2l0aGluV2lkdGggPSBkaXZpZGUud2l0aGluV2lkdGg7XG4gICAgICBpZiAoZXh0cmEubGVuZ3RoID09PSAxICYmIGV4dHJhWzBdLndpZHRoIDw9IGxlbihvdmVyZmxvd2VyKSkge1xuICAgICAgICByZXR1cm4gZml0TGFzdCh3aXRoaW4sIGV4dHJhLCB3aXRoaW5XaWR0aCk7XG4gICAgICB9IGVsc2UgaWYgKGV4dHJhLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgIHJldHVybiBvdmVyZmxvdyh3aXRoaW4sIGV4dHJhLCBvdmVyZmxvd2VyLCB3aXRoaW5XaWR0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZml0QWxsKHdpdGhpbiwgZXh0cmEsIHdpdGhpbldpZHRoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHNldEdyb3VwcyA9IGZ1bmN0aW9uICh0b29sYmFyLCBzdG9yZWRHcm91cHMpIHtcbiAgICAgIHZhciBiR3JvdXBzID0gbWFwKHN0b3JlZEdyb3VwcywgZnVuY3Rpb24gKGcpIHtcbiAgICAgICAgcmV0dXJuIHByZW1hZGUkMShnKTtcbiAgICAgIH0pO1xuICAgICAgVG9vbGJhci5zZXRHcm91cHModG9vbGJhciwgYkdyb3Vwcyk7XG4gICAgfTtcbiAgICB2YXIgZmluZEZvY3VzZWRDb21wID0gZnVuY3Rpb24gKGNvbXBzKSB7XG4gICAgICByZXR1cm4gZmluZE1hcChjb21wcywgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgcmV0dXJuIHNlYXJjaChjb21wLmVsZW1lbnQpLmJpbmQoZnVuY3Rpb24gKGZvY3VzZWRFbG0pIHtcbiAgICAgICAgICByZXR1cm4gY29tcC5nZXRTeXN0ZW0oKS5nZXRCeURvbShmb2N1c2VkRWxtKS50b09wdGlvbmFsKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVmcmVzaCA9IGZ1bmN0aW9uICh0b29sYmFyLCBkZXRhaWwsIHNldE92ZXJmbG93KSB7XG4gICAgICB2YXIgcHJpbWFyeSA9IGdldFBhcnRPckRpZSh0b29sYmFyLCBkZXRhaWwsICdwcmltYXJ5Jyk7XG4gICAgICB2YXIgb3ZlcmZsb3dHcm91cCA9IENvdXBsaW5nLmdldENvdXBsZWQodG9vbGJhciwgJ292ZXJmbG93R3JvdXAnKTtcbiAgICAgIHNldCQyKHByaW1hcnkuZWxlbWVudCwgJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICB2YXIgZ3JvdXBzID0gZGV0YWlsLmJ1aWx0R3JvdXBzLmdldCgpLmNvbmNhdChbb3ZlcmZsb3dHcm91cF0pO1xuICAgICAgdmFyIGZvY3VzZWRDb21wID0gZmluZEZvY3VzZWRDb21wKGdyb3Vwcyk7XG4gICAgICBzZXRPdmVyZmxvdyhbXSk7XG4gICAgICBzZXRHcm91cHMocHJpbWFyeSwgZ3JvdXBzKTtcbiAgICAgIHZhciBhdmFpbGFibGVXaWR0aCA9IGdldCQ4KHByaW1hcnkuZWxlbWVudCk7XG4gICAgICB2YXIgb3ZlcmZsb3dzID0gcGFydGl0aW9uJDMoYXZhaWxhYmxlV2lkdGgsIGRldGFpbC5idWlsdEdyb3Vwcy5nZXQoKSwgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgcmV0dXJuIGdldCQ4KGNvbXAuZWxlbWVudCk7XG4gICAgICB9LCBvdmVyZmxvd0dyb3VwKTtcbiAgICAgIGlmIChvdmVyZmxvd3MuZXh0cmEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIFJlcGxhY2luZy5yZW1vdmUocHJpbWFyeSwgb3ZlcmZsb3dHcm91cCk7XG4gICAgICAgIHNldE92ZXJmbG93KFtdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldEdyb3VwcyhwcmltYXJ5LCBvdmVyZmxvd3Mud2l0aGluKTtcbiAgICAgICAgc2V0T3ZlcmZsb3cob3ZlcmZsb3dzLmV4dHJhKTtcbiAgICAgIH1cbiAgICAgIHJlbW92ZSQ2KHByaW1hcnkuZWxlbWVudCwgJ3Zpc2liaWxpdHknKTtcbiAgICAgIHJlZmxvdyhwcmltYXJ5LmVsZW1lbnQpO1xuICAgICAgZm9jdXNlZENvbXAuZWFjaChGb2N1c2luZy5mb2N1cyk7XG4gICAgfTtcblxuICAgIHZhciBzY2hlbWEkbCA9IGNvbnN0YW50KFtcbiAgICAgIGZpZWxkJDEoJ3NwbGl0VG9vbGJhckJlaGF2aW91cnMnLCBbQ291cGxpbmddKSxcbiAgICAgIHN0YXRlJDEoJ2J1aWx0R3JvdXBzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gQ2VsbChbXSk7XG4gICAgICB9KVxuICAgIF0pO1xuXG4gICAgdmFyIHNjaGVtYSRtID0gY29uc3RhbnQoW1xuICAgICAgbWFya2VycyhbJ292ZXJmbG93VG9nZ2xlZENsYXNzJ10pLFxuICAgICAgb3B0aW9uRnVuY3Rpb24oJ2dldE92ZXJmbG93Qm91bmRzJyksXG4gICAgICBzdHJpY3QkMSgnbGF6eVNpbmsnKSxcbiAgICAgIHN0YXRlJDEoJ292ZXJmbG93R3JvdXBzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gQ2VsbChbXSk7XG4gICAgICB9KVxuICAgIF0uY29uY2F0KHNjaGVtYSRsKCkpKTtcbiAgICB2YXIgcGFydHMkOCA9IGNvbnN0YW50KFtcbiAgICAgIHJlcXVpcmVkKHtcbiAgICAgICAgZmFjdG9yeTogVG9vbGJhcixcbiAgICAgICAgc2NoZW1hOiBzY2hlbWEkaygpLFxuICAgICAgICBuYW1lOiAncHJpbWFyeSdcbiAgICAgIH0pLFxuICAgICAgZXh0ZXJuYWwkMSh7XG4gICAgICAgIHNjaGVtYTogc2NoZW1hJGsoKSxcbiAgICAgICAgbmFtZTogJ292ZXJmbG93J1xuICAgICAgfSksXG4gICAgICBleHRlcm5hbCQxKHsgbmFtZTogJ292ZXJmbG93LWJ1dHRvbicgfSksXG4gICAgICBleHRlcm5hbCQxKHsgbmFtZTogJ292ZXJmbG93LWdyb3VwJyB9KVxuICAgIF0pO1xuXG4gICAgdmFyIHNjaGVtYSRuID0gY29uc3RhbnQoW1xuICAgICAgbWFya2VycyhbJ3RvZ2dsZWRDbGFzcyddKSxcbiAgICAgIHN0cmljdCQxKCdsYXp5U2luaycpLFxuICAgICAgc3RyaWN0RnVuY3Rpb24oJ2ZldGNoJyksXG4gICAgICBvcHRpb25GdW5jdGlvbignZ2V0Qm91bmRzJyksXG4gICAgICBvcHRpb25PYmpPZignZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZCcsIFtkZWZhdWx0ZWQkMSgnZXZlbnQnLCBkaXNtaXNzUmVxdWVzdGVkKCkpXSksXG4gICAgICBzY2hlbWEkMSgpXG4gICAgXSk7XG4gICAgdmFyIHBhcnRzJDkgPSBjb25zdGFudChbXG4gICAgICBleHRlcm5hbCQxKHtcbiAgICAgICAgbmFtZTogJ2J1dHRvbicsXG4gICAgICAgIG92ZXJyaWRlczogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkb206IHsgYXR0cmlidXRlczogeyAnYXJpYS1oYXNwb3B1cCc6ICd0cnVlJyB9IH0sXG4gICAgICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBkZXJpdmUkMShbVG9nZ2xpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgICB0b2dnbGVDbGFzczogZGV0YWlsLm1hcmtlcnMudG9nZ2xlZENsYXNzLFxuICAgICAgICAgICAgICAgIGFyaWE6IHsgbW9kZTogJ2V4cGFuZGVkJyB9LFxuICAgICAgICAgICAgICAgIHRvZ2dsZU9uRXhlY3V0ZTogZmFsc2VcbiAgICAgICAgICAgICAgfSldKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgZXh0ZXJuYWwkMSh7XG4gICAgICAgIGZhY3Rvcnk6IFRvb2xiYXIsXG4gICAgICAgIHNjaGVtYTogc2NoZW1hJGsoKSxcbiAgICAgICAgbmFtZTogJ3Rvb2xiYXInLFxuICAgICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG9vbGJhckJlaGF2aW91cnM6IGRlcml2ZSQxKFtLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnY3ljbGljJyxcbiAgICAgICAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgICAgICAgIGdldFBhcnQoY29tcCwgZGV0YWlsLCAnYnV0dG9uJykuZWFjaChGb2N1c2luZy5mb2N1cyk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSldKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgXSk7XG5cbiAgICB2YXIgdG9nZ2xlJDIgPSBmdW5jdGlvbiAoYnV0dG9uLCBleHRlcm5hbHMpIHtcbiAgICAgIHZhciB0b29sYmFyU2FuZGJveCA9IENvdXBsaW5nLmdldENvdXBsZWQoYnV0dG9uLCAndG9vbGJhclNhbmRib3gnKTtcbiAgICAgIGlmIChTYW5kYm94aW5nLmlzT3Blbih0b29sYmFyU2FuZGJveCkpIHtcbiAgICAgICAgU2FuZGJveGluZy5jbG9zZSh0b29sYmFyU2FuZGJveCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBTYW5kYm94aW5nLm9wZW4odG9vbGJhclNhbmRib3gsIGV4dGVybmFscy50b29sYmFyKCkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHBvc2l0aW9uJDIgPSBmdW5jdGlvbiAoYnV0dG9uLCB0b29sYmFyLCBkZXRhaWwsIGxheW91dHMpIHtcbiAgICAgIHZhciBib3VuZHMgPSBkZXRhaWwuZ2V0Qm91bmRzLm1hcChmdW5jdGlvbiAoYm91bmRlcikge1xuICAgICAgICByZXR1cm4gYm91bmRlcigpO1xuICAgICAgfSk7XG4gICAgICB2YXIgc2luayA9IGRldGFpbC5sYXp5U2luayhidXR0b24pLmdldE9yRGllKCk7XG4gICAgICBQb3NpdGlvbmluZy5wb3NpdGlvbldpdGhpbkJvdW5kcyhzaW5rLCB7XG4gICAgICAgIGFuY2hvcjogJ2hvdHNwb3QnLFxuICAgICAgICBob3RzcG90OiBidXR0b24sXG4gICAgICAgIGxheW91dHM6IGxheW91dHMsXG4gICAgICAgIG92ZXJyaWRlczogeyBtYXhXaWR0aEZ1bmN0aW9uOiBleHBhbmRhYmxlJDEoKSB9XG4gICAgICB9LCB0b29sYmFyLCBib3VuZHMpO1xuICAgIH07XG4gICAgdmFyIHNldEdyb3VwcyQxID0gZnVuY3Rpb24gKGJ1dHRvbiwgdG9vbGJhciwgZGV0YWlsLCBsYXlvdXRzLCBncm91cHMpIHtcbiAgICAgIFRvb2xiYXIuc2V0R3JvdXBzKHRvb2xiYXIsIGdyb3Vwcyk7XG4gICAgICBwb3NpdGlvbiQyKGJ1dHRvbiwgdG9vbGJhciwgZGV0YWlsLCBsYXlvdXRzKTtcbiAgICAgIFRvZ2dsaW5nLm9uKGJ1dHRvbik7XG4gICAgfTtcbiAgICB2YXIgbWFrZVNhbmRib3gkMSA9IGZ1bmN0aW9uIChidXR0b24sIHNwZWMsIGRldGFpbCkge1xuICAgICAgdmFyIGFyaWFPd25lciA9IG1hbmFnZXIoKTtcbiAgICAgIHZhciBvbk9wZW4gPSBmdW5jdGlvbiAoc2FuZGJveCwgdG9vbGJhcikge1xuICAgICAgICBkZXRhaWwuZmV0Y2goKS5nZXQoZnVuY3Rpb24gKGdyb3Vwcykge1xuICAgICAgICAgIHNldEdyb3VwcyQxKGJ1dHRvbiwgdG9vbGJhciwgZGV0YWlsLCBzcGVjLmxheW91dHMsIGdyb3Vwcyk7XG4gICAgICAgICAgYXJpYU93bmVyLmxpbmsoYnV0dG9uLmVsZW1lbnQpO1xuICAgICAgICAgIEtleWluZy5mb2N1c0luKHRvb2xiYXIpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgb25DbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgVG9nZ2xpbmcub2ZmKGJ1dHRvbik7XG4gICAgICAgIEZvY3VzaW5nLmZvY3VzKGJ1dHRvbik7XG4gICAgICAgIGFyaWFPd25lci51bmxpbmsoYnV0dG9uLmVsZW1lbnQpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgYXR0cmlidXRlczogeyBpZDogYXJpYU93bmVyLmlkIH1cbiAgICAgICAgfSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIFNhbmRib3hpbmcuY2xvc2UoY29tcCk7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFNhbmRib3hpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG9uT3Blbjogb25PcGVuLFxuICAgICAgICAgICAgb25DbG9zZTogb25DbG9zZSxcbiAgICAgICAgICAgIGlzUGFydE9mOiBmdW5jdGlvbiAoY29udGFpbmVyLCBkYXRhLCBxdWVyeUVsZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGlzUGFydE9mKGRhdGEsIHF1ZXJ5RWxlbSkgfHwgaXNQYXJ0T2YoYnV0dG9uLCBxdWVyeUVsZW0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEF0dGFjaFBvaW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkZXRhaWwubGF6eVNpbmsoYnV0dG9uKS5nZXRPckRpZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFJlY2VpdmluZy5jb25maWcoe1xuICAgICAgICAgICAgY2hhbm5lbHM6IF9fYXNzaWduKF9fYXNzaWduKHt9LCByZWNlaXZpbmdDaGFubmVsKF9fYXNzaWduKHsgaXNFeHRyYVBhcnQ6IG5ldmVyIH0sIGRldGFpbC5maXJlRGlzbWlzc2FsRXZlbnRJbnN0ZWFkLm1hcChmdW5jdGlvbiAoZmUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHsgZmlyZUV2ZW50SW5zdGVhZDogeyBldmVudDogZmUuZXZlbnQgfSB9O1xuICAgICAgICAgICAgfSkuZ2V0T3Ioe30pKSkpLCByZWNlaXZpbmdDaGFubmVsJDEoe1xuICAgICAgICAgICAgICBkb1JlcG9zaXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBTYW5kYm94aW5nLmdldFN0YXRlKENvdXBsaW5nLmdldENvdXBsZWQoYnV0dG9uLCAndG9vbGJhclNhbmRib3gnKSkuZWFjaChmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgICAgICAgcG9zaXRpb24kMihidXR0b24sIHRvb2xiYXIsIGRldGFpbCwgc3BlYy5sYXlvdXRzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgfSlcbiAgICAgICAgXSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZmFjdG9yeSRhID0gZnVuY3Rpb24gKGRldGFpbCwgY29tcG9uZW50cywgc3BlYywgZXh0ZXJuYWxzKSB7XG4gICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIEJ1dHRvbi5za2V0Y2goX19hc3NpZ24oX19hc3NpZ24oe30sIGV4dGVybmFscy5idXR0b24oKSksIHtcbiAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgdG9nZ2xlJDIoYnV0dG9uLCBleHRlcm5hbHMpO1xuICAgICAgICB9LFxuICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBTa2V0Y2hCZWhhdmlvdXJzLmF1Z21lbnQoeyBkdW1wOiBleHRlcm5hbHMuYnV0dG9uKCkuYnV0dG9uQmVoYXZpb3VycyB9LCBbQ291cGxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG90aGVyczoge1xuICAgICAgICAgICAgICB0b29sYmFyU2FuZGJveDogZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYWtlU2FuZGJveCQxKGJ1dHRvbiwgc3BlYywgZGV0YWlsKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXSlcbiAgICAgIH0pKSksIHtcbiAgICAgICAgYXBpczoge1xuICAgICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gKGJ1dHRvbiwgZ3JvdXBzKSB7XG4gICAgICAgICAgICBTYW5kYm94aW5nLmdldFN0YXRlKENvdXBsaW5nLmdldENvdXBsZWQoYnV0dG9uLCAndG9vbGJhclNhbmRib3gnKSkuZWFjaChmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgICBzZXRHcm91cHMkMShidXR0b24sIHRvb2xiYXIsIGRldGFpbCwgc3BlYy5sYXlvdXRzLCBncm91cHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgICBTYW5kYm94aW5nLmdldFN0YXRlKENvdXBsaW5nLmdldENvdXBsZWQoYnV0dG9uLCAndG9vbGJhclNhbmRib3gnKSkuZWFjaChmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgICBwb3NpdGlvbiQyKGJ1dHRvbiwgdG9vbGJhciwgZGV0YWlsLCBzcGVjLmxheW91dHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICAgIHRvZ2dsZSQyKGJ1dHRvbiwgZXh0ZXJuYWxzKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldFRvb2xiYXI6IGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICAgIHJldHVybiBTYW5kYm94aW5nLmdldFN0YXRlKENvdXBsaW5nLmdldENvdXBsZWQoYnV0dG9uLCAndG9vbGJhclNhbmRib3gnKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpc09wZW46IGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICAgIHJldHVybiBTYW5kYm94aW5nLmlzT3BlbihDb3VwbGluZy5nZXRDb3VwbGVkKGJ1dHRvbiwgJ3Rvb2xiYXJTYW5kYm94JykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgRmxvYXRpbmdUb29sYmFyQnV0dG9uID0gY29tcG9zaXRlJDEoe1xuICAgICAgbmFtZTogJ0Zsb2F0aW5nVG9vbGJhckJ1dHRvbicsXG4gICAgICBmYWN0b3J5OiBmYWN0b3J5JGEsXG4gICAgICBjb25maWdGaWVsZHM6IHNjaGVtYSRuKCksXG4gICAgICBwYXJ0RmllbGRzOiBwYXJ0cyQ5KCksXG4gICAgICBhcGlzOiB7XG4gICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gKGFwaXMsIGJ1dHRvbiwgZ3JvdXBzKSB7XG4gICAgICAgICAgYXBpcy5zZXRHcm91cHMoYnV0dG9uLCBncm91cHMpO1xuICAgICAgICB9LFxuICAgICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiAoYXBpcywgYnV0dG9uKSB7XG4gICAgICAgICAgYXBpcy5yZXBvc2l0aW9uKGJ1dHRvbik7XG4gICAgICAgIH0sXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gKGFwaXMsIGJ1dHRvbikge1xuICAgICAgICAgIGFwaXMudG9nZ2xlKGJ1dHRvbik7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFRvb2xiYXI6IGZ1bmN0aW9uIChhcGlzLCBidXR0b24pIHtcbiAgICAgICAgICByZXR1cm4gYXBpcy5nZXRUb29sYmFyKGJ1dHRvbik7XG4gICAgICAgIH0sXG4gICAgICAgIGlzT3BlbjogZnVuY3Rpb24gKGFwaXMsIGJ1dHRvbikge1xuICAgICAgICAgIHJldHVybiBhcGlzLmlzT3BlbihidXR0b24pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgc2NoZW1hJG8gPSBjb25zdGFudChbXG4gICAgICBzdHJpY3QkMSgnaXRlbXMnKSxcbiAgICAgIG1hcmtlcnMoWydpdGVtU2VsZWN0b3InXSksXG4gICAgICBmaWVsZCQxKCd0Z3JvdXBCZWhhdmlvdXJzJywgW0tleWluZ10pXG4gICAgXSk7XG4gICAgdmFyIHBhcnRzJGEgPSBjb25zdGFudChbZ3JvdXAoe1xuICAgICAgICBuYW1lOiAnaXRlbXMnLFxuICAgICAgICB1bml0OiAnaXRlbSdcbiAgICAgIH0pXSk7XG5cbiAgICB2YXIgZmFjdG9yeSRiID0gZnVuY3Rpb24gKGRldGFpbCwgY29tcG9uZW50cywgX3NwZWMsIF9leHRlcm5hbHMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxuICAgICAgICBiZWhhdmlvdXJzOiBhdWdtZW50KGRldGFpbC50Z3JvdXBCZWhhdmlvdXJzLCBbS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnZmxvdycsXG4gICAgICAgICAgICBzZWxlY3RvcjogZGV0YWlsLm1hcmtlcnMuaXRlbVNlbGVjdG9yXG4gICAgICAgICAgfSldKSxcbiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3Rvb2xiYXInIH0gfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBUb29sYmFyR3JvdXAgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnVG9vbGJhckdyb3VwJyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogc2NoZW1hJG8oKSxcbiAgICAgIHBhcnRGaWVsZHM6IHBhcnRzJGEoKSxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnkkYlxuICAgIH0pO1xuXG4gICAgdmFyIGJ1aWxkR3JvdXBzID0gZnVuY3Rpb24gKGNvbXBzKSB7XG4gICAgICByZXR1cm4gbWFwKGNvbXBzLCBmdW5jdGlvbiAoZykge1xuICAgICAgICByZXR1cm4gcHJlbWFkZSQxKGcpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVmcmVzaCQxID0gZnVuY3Rpb24gKHRvb2xiYXIsIG1lbUZsb2F0aW5nVG9vbGJhckJ1dHRvbiwgZGV0YWlsKSB7XG4gICAgICByZWZyZXNoKHRvb2xiYXIsIGRldGFpbCwgZnVuY3Rpb24gKG92ZXJmbG93R3JvdXBzKSB7XG4gICAgICAgIGRldGFpbC5vdmVyZmxvd0dyb3Vwcy5zZXQob3ZlcmZsb3dHcm91cHMpO1xuICAgICAgICBtZW1GbG9hdGluZ1Rvb2xiYXJCdXR0b24uZ2V0T3B0KHRvb2xiYXIpLmVhY2goZnVuY3Rpb24gKGZsb2F0aW5nVG9vbGJhckJ1dHRvbikge1xuICAgICAgICAgIEZsb2F0aW5nVG9vbGJhckJ1dHRvbi5zZXRHcm91cHMoZmxvYXRpbmdUb29sYmFyQnV0dG9uLCBidWlsZEdyb3VwcyhvdmVyZmxvd0dyb3VwcykpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZhY3RvcnkkYyA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMsIHNwZWMsIGV4dGVybmFscykge1xuICAgICAgdmFyIG1lbUZsb2F0aW5nVG9vbGJhckJ1dHRvbiA9IHJlY29yZChGbG9hdGluZ1Rvb2xiYXJCdXR0b24uc2tldGNoKHtcbiAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gRnV0dXJlLm51KGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgICAgICByZXNvbHZlKGJ1aWxkR3JvdXBzKGRldGFpbC5vdmVyZmxvd0dyb3Vwcy5nZXQoKSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBsYXlvdXRzOiB7XG4gICAgICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgICAgICBzb3V0aGVhc3QkMVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uUnRsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICBzb3V0aGVhc3QkMSxcbiAgICAgICAgICAgICAgc291dGh3ZXN0JDFcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbkJvdHRvbUx0cjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgbm9ydGh3ZXN0JDEsXG4gICAgICAgICAgICAgIG5vcnRoZWFzdCQxXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25Cb3R0b21SdGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgICAgICBub3J0aHdlc3QkMVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdldEJvdW5kczogc3BlYy5nZXRPdmVyZmxvd0JvdW5kcyxcbiAgICAgICAgbGF6eVNpbms6IGRldGFpbC5sYXp5U2luayxcbiAgICAgICAgZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZDoge30sXG4gICAgICAgIG1hcmtlcnM6IHsgdG9nZ2xlZENsYXNzOiBkZXRhaWwubWFya2Vycy5vdmVyZmxvd1RvZ2dsZWRDbGFzcyB9LFxuICAgICAgICBwYXJ0czoge1xuICAgICAgICAgIGJ1dHRvbjogZXh0ZXJuYWxzWydvdmVyZmxvdy1idXR0b24nXSgpLFxuICAgICAgICAgIHRvb2xiYXI6IGV4dGVybmFscy5vdmVyZmxvdygpXG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxuICAgICAgICBiZWhhdmlvdXJzOiBhdWdtZW50KGRldGFpbC5zcGxpdFRvb2xiYXJCZWhhdmlvdXJzLCBbQ291cGxpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG90aGVyczoge1xuICAgICAgICAgICAgICBvdmVyZmxvd0dyb3VwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRvb2xiYXJHcm91cC5za2V0Y2goX19hc3NpZ24oX19hc3NpZ24oe30sIGV4dGVybmFsc1snb3ZlcmZsb3ctZ3JvdXAnXSgpKSwgeyBpdGVtczogW21lbUZsb2F0aW5nVG9vbGJhckJ1dHRvbi5hc1NwZWMoKV0gfSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSldKSxcbiAgICAgICAgYXBpczoge1xuICAgICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gKHRvb2xiYXIsIGdyb3Vwcykge1xuICAgICAgICAgICAgZGV0YWlsLmJ1aWx0R3JvdXBzLnNldChtYXAoZ3JvdXBzLCB0b29sYmFyLmdldFN5c3RlbSgpLmJ1aWxkKSk7XG4gICAgICAgICAgICByZWZyZXNoJDEodG9vbGJhciwgbWVtRmxvYXRpbmdUb29sYmFyQnV0dG9uLCBkZXRhaWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gKHRvb2xiYXIpIHtcbiAgICAgICAgICAgIHJldHVybiByZWZyZXNoJDEodG9vbGJhciwgbWVtRmxvYXRpbmdUb29sYmFyQnV0dG9uLCBkZXRhaWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgbWVtRmxvYXRpbmdUb29sYmFyQnV0dG9uLmdldE9wdCh0b29sYmFyKS5lYWNoKGZ1bmN0aW9uIChmbG9hdGluZ1Rvb2xiYXJCdXR0b24pIHtcbiAgICAgICAgICAgICAgRmxvYXRpbmdUb29sYmFyQnV0dG9uLnRvZ2dsZShmbG9hdGluZ1Rvb2xiYXJCdXR0b24pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpc09wZW46IGZ1bmN0aW9uICh0b29sYmFyKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtRmxvYXRpbmdUb29sYmFyQnV0dG9uLmdldE9wdCh0b29sYmFyKS5tYXAoRmxvYXRpbmdUb29sYmFyQnV0dG9uLmlzT3BlbikuZ2V0T3IoZmFsc2UpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVwb3NpdGlvbjogZnVuY3Rpb24gKHRvb2xiYXIpIHtcbiAgICAgICAgICAgIG1lbUZsb2F0aW5nVG9vbGJhckJ1dHRvbi5nZXRPcHQodG9vbGJhcikuZWFjaChmdW5jdGlvbiAoZmxvYXRpbmdUb29sYmFyQnV0dG9uKSB7XG4gICAgICAgICAgICAgIEZsb2F0aW5nVG9vbGJhckJ1dHRvbi5yZXBvc2l0aW9uKGZsb2F0aW5nVG9vbGJhckJ1dHRvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE92ZXJmbG93OiBmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgcmV0dXJuIG1lbUZsb2F0aW5nVG9vbGJhckJ1dHRvbi5nZXRPcHQodG9vbGJhcikuYmluZChGbG9hdGluZ1Rvb2xiYXJCdXR0b24uZ2V0VG9vbGJhcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IHsgYXR0cmlidXRlczogeyByb2xlOiAnZ3JvdXAnIH0gfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTcGxpdEZsb2F0aW5nVG9vbGJhciA9IGNvbXBvc2l0ZSQxKHtcbiAgICAgIG5hbWU6ICdTcGxpdEZsb2F0aW5nVG9vbGJhcicsXG4gICAgICBjb25maWdGaWVsZHM6IHNjaGVtYSRtKCksXG4gICAgICBwYXJ0RmllbGRzOiBwYXJ0cyQ4KCksXG4gICAgICBmYWN0b3J5OiBmYWN0b3J5JGMsXG4gICAgICBhcGlzOiB7XG4gICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gKGFwaXMsIHRvb2xiYXIsIGdyb3Vwcykge1xuICAgICAgICAgIGFwaXMuc2V0R3JvdXBzKHRvb2xiYXIsIGdyb3Vwcyk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uIChhcGlzLCB0b29sYmFyKSB7XG4gICAgICAgICAgYXBpcy5yZWZyZXNoKHRvb2xiYXIpO1xuICAgICAgICB9LFxuICAgICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiAoYXBpcywgdG9vbGJhcikge1xuICAgICAgICAgIGFwaXMucmVwb3NpdGlvbih0b29sYmFyKTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAoYXBpcywgdG9vbGJhcikge1xuICAgICAgICAgIGFwaXMudG9nZ2xlKHRvb2xiYXIpO1xuICAgICAgICB9LFxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uIChhcGlzLCB0b29sYmFyKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuaXNPcGVuKHRvb2xiYXIpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPdmVyZmxvdzogZnVuY3Rpb24gKGFwaXMsIHRvb2xiYXIpIHtcbiAgICAgICAgICByZXR1cm4gYXBpcy5nZXRPdmVyZmxvdyh0b29sYmFyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIGdldEFuaW1hdGlvblJvb3QgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzbGlkZUNvbmZpZykge1xuICAgICAgcmV0dXJuIHNsaWRlQ29uZmlnLmdldEFuaW1hdGlvblJvb3QuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjb21wb25lbnQuZWxlbWVudDtcbiAgICAgIH0sIGZ1bmN0aW9uIChnZXQpIHtcbiAgICAgICAgcmV0dXJuIGdldChjb21wb25lbnQpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnZXREaW1lbnNpb25Qcm9wZXJ0eSA9IGZ1bmN0aW9uIChzbGlkZUNvbmZpZykge1xuICAgICAgcmV0dXJuIHNsaWRlQ29uZmlnLmRpbWVuc2lvbi5wcm9wZXJ0eTtcbiAgICB9O1xuICAgIHZhciBnZXREaW1lbnNpb24gPSBmdW5jdGlvbiAoc2xpZGVDb25maWcsIGVsZW0pIHtcbiAgICAgIHJldHVybiBzbGlkZUNvbmZpZy5kaW1lbnNpb24uZ2V0RGltZW5zaW9uKGVsZW0pO1xuICAgIH07XG4gICAgdmFyIGRpc2FibGVUcmFuc2l0aW9ucyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnKSB7XG4gICAgICB2YXIgcm9vdCA9IGdldEFuaW1hdGlvblJvb3QoY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICByZW1vdmUkNShyb290LCBbXG4gICAgICAgIHNsaWRlQ29uZmlnLnNocmlua2luZ0NsYXNzLFxuICAgICAgICBzbGlkZUNvbmZpZy5ncm93aW5nQ2xhc3NcbiAgICAgIF0pO1xuICAgIH07XG4gICAgdmFyIHNldFNocnVuayA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnKSB7XG4gICAgICByZW1vdmUkNChjb21wb25lbnQuZWxlbWVudCwgc2xpZGVDb25maWcub3BlbkNsYXNzKTtcbiAgICAgIGFkZCQyKGNvbXBvbmVudC5lbGVtZW50LCBzbGlkZUNvbmZpZy5jbG9zZWRDbGFzcyk7XG4gICAgICBzZXQkMihjb21wb25lbnQuZWxlbWVudCwgZ2V0RGltZW5zaW9uUHJvcGVydHkoc2xpZGVDb25maWcpLCAnMHB4Jyk7XG4gICAgICByZWZsb3coY29tcG9uZW50LmVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIHNldEdyb3duID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcpIHtcbiAgICAgIHJlbW92ZSQ0KGNvbXBvbmVudC5lbGVtZW50LCBzbGlkZUNvbmZpZy5jbG9zZWRDbGFzcyk7XG4gICAgICBhZGQkMihjb21wb25lbnQuZWxlbWVudCwgc2xpZGVDb25maWcub3BlbkNsYXNzKTtcbiAgICAgIHJlbW92ZSQ2KGNvbXBvbmVudC5lbGVtZW50LCBnZXREaW1lbnNpb25Qcm9wZXJ0eShzbGlkZUNvbmZpZykpO1xuICAgIH07XG4gICAgdmFyIGRvSW1tZWRpYXRlU2hyaW5rID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUsIF9jYWxjdWxhdGVkU2l6ZSkge1xuICAgICAgc2xpZGVTdGF0ZS5zZXRDb2xsYXBzZWQoKTtcbiAgICAgIHNldCQyKGNvbXBvbmVudC5lbGVtZW50LCBnZXREaW1lbnNpb25Qcm9wZXJ0eShzbGlkZUNvbmZpZyksIGdldERpbWVuc2lvbihzbGlkZUNvbmZpZywgY29tcG9uZW50LmVsZW1lbnQpKTtcbiAgICAgIHJlZmxvdyhjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICBkaXNhYmxlVHJhbnNpdGlvbnMoY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICBzZXRTaHJ1bmsoY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICBzbGlkZUNvbmZpZy5vblN0YXJ0U2hyaW5rKGNvbXBvbmVudCk7XG4gICAgICBzbGlkZUNvbmZpZy5vblNocnVuayhjb21wb25lbnQpO1xuICAgIH07XG4gICAgdmFyIGRvU3RhcnRTaHJpbmsgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzbGlkZUNvbmZpZywgc2xpZGVTdGF0ZSwgY2FsY3VsYXRlZFNpemUpIHtcbiAgICAgIHZhciBzaXplID0gY2FsY3VsYXRlZFNpemUuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnZXREaW1lbnNpb24oc2xpZGVDb25maWcsIGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIH0pO1xuICAgICAgc2xpZGVTdGF0ZS5zZXRDb2xsYXBzZWQoKTtcbiAgICAgIHNldCQyKGNvbXBvbmVudC5lbGVtZW50LCBnZXREaW1lbnNpb25Qcm9wZXJ0eShzbGlkZUNvbmZpZyksIHNpemUpO1xuICAgICAgcmVmbG93KGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIHZhciByb290ID0gZ2V0QW5pbWF0aW9uUm9vdChjb21wb25lbnQsIHNsaWRlQ29uZmlnKTtcbiAgICAgIHJlbW92ZSQ0KHJvb3QsIHNsaWRlQ29uZmlnLmdyb3dpbmdDbGFzcyk7XG4gICAgICBhZGQkMihyb290LCBzbGlkZUNvbmZpZy5zaHJpbmtpbmdDbGFzcyk7XG4gICAgICBzZXRTaHJ1bmsoY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICBzbGlkZUNvbmZpZy5vblN0YXJ0U2hyaW5rKGNvbXBvbmVudCk7XG4gICAgfTtcbiAgICB2YXIgZG9TdGFydFNtYXJ0U2hyaW5rID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUpIHtcbiAgICAgIHZhciBzaXplID0gZ2V0RGltZW5zaW9uKHNsaWRlQ29uZmlnLCBjb21wb25lbnQuZWxlbWVudCk7XG4gICAgICB2YXIgc2hyaW5rZXIgPSBzaXplID09PSAnMHB4JyA/IGRvSW1tZWRpYXRlU2hyaW5rIDogZG9TdGFydFNocmluaztcbiAgICAgIHNocmlua2VyKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUsIE9wdGlvbmFsLnNvbWUoc2l6ZSkpO1xuICAgIH07XG4gICAgdmFyIGRvU3RhcnRHcm93ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUpIHtcbiAgICAgIHZhciByb290ID0gZ2V0QW5pbWF0aW9uUm9vdChjb21wb25lbnQsIHNsaWRlQ29uZmlnKTtcbiAgICAgIHZhciB3YXNTaHJpbmtpbmcgPSBoYXMkMihyb290LCBzbGlkZUNvbmZpZy5zaHJpbmtpbmdDbGFzcyk7XG4gICAgICB2YXIgYmVmb3JlU2l6ZSA9IGdldERpbWVuc2lvbihzbGlkZUNvbmZpZywgY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgc2V0R3Jvd24oY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICB2YXIgZnVsbFNpemUgPSBnZXREaW1lbnNpb24oc2xpZGVDb25maWcsIGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIHZhciBzdGFydFBhcnRpYWxHcm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXQkMihjb21wb25lbnQuZWxlbWVudCwgZ2V0RGltZW5zaW9uUHJvcGVydHkoc2xpZGVDb25maWcpLCBiZWZvcmVTaXplKTtcbiAgICAgICAgcmVmbG93KGNvbXBvbmVudC5lbGVtZW50KTtcbiAgICAgIH07XG4gICAgICB2YXIgc3RhcnRDb21wbGV0ZUdyb3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNldFNocnVuayhjb21wb25lbnQsIHNsaWRlQ29uZmlnKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0U3RhcnRTaXplID0gd2FzU2hyaW5raW5nID8gc3RhcnRQYXJ0aWFsR3JvdyA6IHN0YXJ0Q29tcGxldGVHcm93O1xuICAgICAgc2V0U3RhcnRTaXplKCk7XG4gICAgICByZW1vdmUkNChyb290LCBzbGlkZUNvbmZpZy5zaHJpbmtpbmdDbGFzcyk7XG4gICAgICBhZGQkMihyb290LCBzbGlkZUNvbmZpZy5ncm93aW5nQ2xhc3MpO1xuICAgICAgc2V0R3Jvd24oY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICBzZXQkMihjb21wb25lbnQuZWxlbWVudCwgZ2V0RGltZW5zaW9uUHJvcGVydHkoc2xpZGVDb25maWcpLCBmdWxsU2l6ZSk7XG4gICAgICBzbGlkZVN0YXRlLnNldEV4cGFuZGVkKCk7XG4gICAgICBzbGlkZUNvbmZpZy5vblN0YXJ0R3Jvdyhjb21wb25lbnQpO1xuICAgIH07XG4gICAgdmFyIHJlZnJlc2gkMiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnLCBzbGlkZVN0YXRlKSB7XG4gICAgICBpZiAoc2xpZGVTdGF0ZS5pc0V4cGFuZGVkKCkpIHtcbiAgICAgICAgcmVtb3ZlJDYoY29tcG9uZW50LmVsZW1lbnQsIGdldERpbWVuc2lvblByb3BlcnR5KHNsaWRlQ29uZmlnKSk7XG4gICAgICAgIHZhciBmdWxsU2l6ZSA9IGdldERpbWVuc2lvbihzbGlkZUNvbmZpZywgY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICBzZXQkMihjb21wb25lbnQuZWxlbWVudCwgZ2V0RGltZW5zaW9uUHJvcGVydHkoc2xpZGVDb25maWcpLCBmdWxsU2l6ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ3JvdyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnLCBzbGlkZVN0YXRlKSB7XG4gICAgICBpZiAoIXNsaWRlU3RhdGUuaXNFeHBhbmRlZCgpKSB7XG4gICAgICAgIGRvU3RhcnRHcm93KGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHNocmluayA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnLCBzbGlkZVN0YXRlKSB7XG4gICAgICBpZiAoc2xpZGVTdGF0ZS5pc0V4cGFuZGVkKCkpIHtcbiAgICAgICAgZG9TdGFydFNtYXJ0U2hyaW5rKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGltbWVkaWF0ZVNocmluayA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnLCBzbGlkZVN0YXRlKSB7XG4gICAgICBpZiAoc2xpZGVTdGF0ZS5pc0V4cGFuZGVkKCkpIHtcbiAgICAgICAgZG9JbW1lZGlhdGVTaHJpbmsoY29tcG9uZW50LCBzbGlkZUNvbmZpZywgc2xpZGVTdGF0ZSwgT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBoYXNHcm93biA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnLCBzbGlkZVN0YXRlKSB7XG4gICAgICByZXR1cm4gc2xpZGVTdGF0ZS5pc0V4cGFuZGVkKCk7XG4gICAgfTtcbiAgICB2YXIgaGFzU2hydW5rID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUpIHtcbiAgICAgIHJldHVybiBzbGlkZVN0YXRlLmlzQ29sbGFwc2VkKCk7XG4gICAgfTtcbiAgICB2YXIgaXNHcm93aW5nID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIF9zbGlkZVN0YXRlKSB7XG4gICAgICB2YXIgcm9vdCA9IGdldEFuaW1hdGlvblJvb3QoY29tcG9uZW50LCBzbGlkZUNvbmZpZyk7XG4gICAgICByZXR1cm4gaGFzJDIocm9vdCwgc2xpZGVDb25maWcuZ3Jvd2luZ0NsYXNzKSA9PT0gdHJ1ZTtcbiAgICB9O1xuICAgIHZhciBpc1Nocmlua2luZyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNsaWRlQ29uZmlnLCBfc2xpZGVTdGF0ZSkge1xuICAgICAgdmFyIHJvb3QgPSBnZXRBbmltYXRpb25Sb290KGNvbXBvbmVudCwgc2xpZGVDb25maWcpO1xuICAgICAgcmV0dXJuIGhhcyQyKHJvb3QsIHNsaWRlQ29uZmlnLnNocmlua2luZ0NsYXNzKSA9PT0gdHJ1ZTtcbiAgICB9O1xuICAgIHZhciBpc1RyYW5zaXRpb25pbmcgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzbGlkZUNvbmZpZywgc2xpZGVTdGF0ZSkge1xuICAgICAgcmV0dXJuIGlzR3Jvd2luZyhjb21wb25lbnQsIHNsaWRlQ29uZmlnKSB8fCBpc1Nocmlua2luZyhjb21wb25lbnQsIHNsaWRlQ29uZmlnKTtcbiAgICB9O1xuICAgIHZhciB0b2dnbGVHcm93ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc2xpZGVDb25maWcsIHNsaWRlU3RhdGUpIHtcbiAgICAgIHZhciBmID0gc2xpZGVTdGF0ZS5pc0V4cGFuZGVkKCkgPyBkb1N0YXJ0U21hcnRTaHJpbmsgOiBkb1N0YXJ0R3JvdztcbiAgICAgIGYoY29tcG9uZW50LCBzbGlkZUNvbmZpZywgc2xpZGVTdGF0ZSk7XG4gICAgfTtcblxuICAgIHZhciBTbGlkaW5nQXBpcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICByZWZyZXNoOiByZWZyZXNoJDIsXG4gICAgICAgIGdyb3c6IGdyb3csXG4gICAgICAgIHNocmluazogc2hyaW5rLFxuICAgICAgICBpbW1lZGlhdGVTaHJpbms6IGltbWVkaWF0ZVNocmluayxcbiAgICAgICAgaGFzR3Jvd246IGhhc0dyb3duLFxuICAgICAgICBoYXNTaHJ1bms6IGhhc1NocnVuayxcbiAgICAgICAgaXNHcm93aW5nOiBpc0dyb3dpbmcsXG4gICAgICAgIGlzU2hyaW5raW5nOiBpc1Nocmlua2luZyxcbiAgICAgICAgaXNUcmFuc2l0aW9uaW5nOiBpc1RyYW5zaXRpb25pbmcsXG4gICAgICAgIHRvZ2dsZUdyb3c6IHRvZ2dsZUdyb3csXG4gICAgICAgIGRpc2FibGVUcmFuc2l0aW9uczogZGlzYWJsZVRyYW5zaXRpb25zXG4gICAgfSk7XG5cbiAgICB2YXIgZXhoaWJpdCQ2ID0gZnVuY3Rpb24gKGJhc2UsIHNsaWRlQ29uZmlnLCBfc2xpZGVTdGF0ZSkge1xuICAgICAgdmFyIGV4cGFuZGVkID0gc2xpZGVDb25maWcuZXhwYW5kZWQ7XG4gICAgICByZXR1cm4gZXhwYW5kZWQgPyBudSQ2KHtcbiAgICAgICAgY2xhc3NlczogW3NsaWRlQ29uZmlnLm9wZW5DbGFzc10sXG4gICAgICAgIHN0eWxlczoge31cbiAgICAgIH0pIDogbnUkNih7XG4gICAgICAgIGNsYXNzZXM6IFtzbGlkZUNvbmZpZy5jbG9zZWRDbGFzc10sXG4gICAgICAgIHN0eWxlczogd3JhcCQxKHNsaWRlQ29uZmlnLmRpbWVuc2lvbi5wcm9wZXJ0eSwgJzBweCcpXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBldmVudHMkZCA9IGZ1bmN0aW9uIChzbGlkZUNvbmZpZywgc2xpZGVTdGF0ZSkge1xuICAgICAgcmV0dXJuIGRlcml2ZShbcnVuT25Tb3VyY2UodHJhbnNpdGlvbmVuZCgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHZhciByYXcgPSBzaW11bGF0ZWRFdmVudC5ldmVudC5yYXc7XG4gICAgICAgICAgaWYgKHJhdy5wcm9wZXJ0eU5hbWUgPT09IHNsaWRlQ29uZmlnLmRpbWVuc2lvbi5wcm9wZXJ0eSkge1xuICAgICAgICAgICAgZGlzYWJsZVRyYW5zaXRpb25zKGNvbXBvbmVudCwgc2xpZGVDb25maWcpO1xuICAgICAgICAgICAgaWYgKHNsaWRlU3RhdGUuaXNFeHBhbmRlZCgpKSB7XG4gICAgICAgICAgICAgIHJlbW92ZSQ2KGNvbXBvbmVudC5lbGVtZW50LCBzbGlkZUNvbmZpZy5kaW1lbnNpb24ucHJvcGVydHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5vdGlmeSA9IHNsaWRlU3RhdGUuaXNFeHBhbmRlZCgpID8gc2xpZGVDb25maWcub25Hcm93biA6IHNsaWRlQ29uZmlnLm9uU2hydW5rO1xuICAgICAgICAgICAgbm90aWZ5KGNvbXBvbmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KV0pO1xuICAgIH07XG5cbiAgICB2YXIgQWN0aXZlU2xpZGluZyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBleGhpYml0OiBleGhpYml0JDYsXG4gICAgICAgIGV2ZW50czogZXZlbnRzJGRcbiAgICB9KTtcblxuICAgIHZhciBTbGlkaW5nU2NoZW1hID0gW1xuICAgICAgc3RyaWN0JDEoJ2Nsb3NlZENsYXNzJyksXG4gICAgICBzdHJpY3QkMSgnb3BlbkNsYXNzJyksXG4gICAgICBzdHJpY3QkMSgnc2hyaW5raW5nQ2xhc3MnKSxcbiAgICAgIHN0cmljdCQxKCdncm93aW5nQ2xhc3MnKSxcbiAgICAgIG9wdGlvbignZ2V0QW5pbWF0aW9uUm9vdCcpLFxuICAgICAgb25IYW5kbGVyKCdvblNocnVuaycpLFxuICAgICAgb25IYW5kbGVyKCdvblN0YXJ0U2hyaW5rJyksXG4gICAgICBvbkhhbmRsZXIoJ29uR3Jvd24nKSxcbiAgICAgIG9uSGFuZGxlcignb25TdGFydEdyb3cnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdleHBhbmRlZCcsIGZhbHNlKSxcbiAgICAgIHN0cmljdE9mKCdkaW1lbnNpb24nLCBjaG9vc2UkMSgncHJvcGVydHknLCB7XG4gICAgICAgIHdpZHRoOiBbXG4gICAgICAgICAgb3V0cHV0KCdwcm9wZXJ0eScsICd3aWR0aCcpLFxuICAgICAgICAgIG91dHB1dCgnZ2V0RGltZW5zaW9uJywgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBnZXQkOChlbGVtKSArICdweCc7XG4gICAgICAgICAgfSlcbiAgICAgICAgXSxcbiAgICAgICAgaGVpZ2h0OiBbXG4gICAgICAgICAgb3V0cHV0KCdwcm9wZXJ0eScsICdoZWlnaHQnKSxcbiAgICAgICAgICBvdXRwdXQoJ2dldERpbWVuc2lvbicsIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0JDcoZWxlbSkgKyAncHgnO1xuICAgICAgICAgIH0pXG4gICAgICAgIF1cbiAgICAgIH0pKVxuICAgIF07XG5cbiAgICB2YXIgaW5pdCQ5ID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHZhciBzdGF0ZSA9IENlbGwoc3BlYy5leHBhbmRlZCk7XG4gICAgICB2YXIgcmVhZFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJ2V4cGFuZGVkOiAnICsgc3RhdGUuZ2V0KCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG51JDUoe1xuICAgICAgICBpc0V4cGFuZGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLmdldCgpID09PSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBpc0NvbGxhcHNlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzdGF0ZS5nZXQoKSA9PT0gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIHNldENvbGxhcHNlZDogY3Vycnkoc3RhdGUuc2V0LCBmYWxzZSksXG4gICAgICAgIHNldEV4cGFuZGVkOiBjdXJyeShzdGF0ZS5zZXQsIHRydWUpLFxuICAgICAgICByZWFkU3RhdGU6IHJlYWRTdGF0ZVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBTbGlkaW5nU3RhdGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgaW5pdDogaW5pdCQ5XG4gICAgfSk7XG5cbiAgICB2YXIgU2xpZGluZyA9IGNyZWF0ZSQxKHtcbiAgICAgIGZpZWxkczogU2xpZGluZ1NjaGVtYSxcbiAgICAgIG5hbWU6ICdzbGlkaW5nJyxcbiAgICAgIGFjdGl2ZTogQWN0aXZlU2xpZGluZyxcbiAgICAgIGFwaXM6IFNsaWRpbmdBcGlzLFxuICAgICAgc3RhdGU6IFNsaWRpbmdTdGF0ZVxuICAgIH0pO1xuXG4gICAgdmFyIHNjaGVtYSRwID0gY29uc3RhbnQoW1xuICAgICAgbWFya2VycyhbXG4gICAgICAgICdjbG9zZWRDbGFzcycsXG4gICAgICAgICdvcGVuQ2xhc3MnLFxuICAgICAgICAnc2hyaW5raW5nQ2xhc3MnLFxuICAgICAgICAnZ3Jvd2luZ0NsYXNzJyxcbiAgICAgICAgJ292ZXJmbG93VG9nZ2xlZENsYXNzJ1xuICAgICAgXSksXG4gICAgICBvbkhhbmRsZXIoJ29uT3BlbmVkJyksXG4gICAgICBvbkhhbmRsZXIoJ29uQ2xvc2VkJylcbiAgICBdLmNvbmNhdChzY2hlbWEkbCgpKSk7XG4gICAgdmFyIHBhcnRzJGIgPSBjb25zdGFudChbXG4gICAgICByZXF1aXJlZCh7XG4gICAgICAgIGZhY3Rvcnk6IFRvb2xiYXIsXG4gICAgICAgIHNjaGVtYTogc2NoZW1hJGsoKSxcbiAgICAgICAgbmFtZTogJ3ByaW1hcnknXG4gICAgICB9KSxcbiAgICAgIHJlcXVpcmVkKHtcbiAgICAgICAgZmFjdG9yeTogVG9vbGJhcixcbiAgICAgICAgc2NoZW1hOiBzY2hlbWEkaygpLFxuICAgICAgICBuYW1lOiAnb3ZlcmZsb3cnLFxuICAgICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG9vbGJhckJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICAgICAgU2xpZGluZy5jb25maWcoe1xuICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogeyBwcm9wZXJ0eTogJ2hlaWdodCcgfSxcbiAgICAgICAgICAgICAgICBjbG9zZWRDbGFzczogZGV0YWlsLm1hcmtlcnMuY2xvc2VkQ2xhc3MsXG4gICAgICAgICAgICAgICAgb3BlbkNsYXNzOiBkZXRhaWwubWFya2Vycy5vcGVuQ2xhc3MsXG4gICAgICAgICAgICAgICAgc2hyaW5raW5nQ2xhc3M6IGRldGFpbC5tYXJrZXJzLnNocmlua2luZ0NsYXNzLFxuICAgICAgICAgICAgICAgIGdyb3dpbmdDbGFzczogZGV0YWlsLm1hcmtlcnMuZ3Jvd2luZ0NsYXNzLFxuICAgICAgICAgICAgICAgIG9uU2hydW5rOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICAgICAgZ2V0UGFydChjb21wLCBkZXRhaWwsICdvdmVyZmxvdy1idXR0b24nKS5lYWNoKGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgVG9nZ2xpbmcub2ZmKGJ1dHRvbik7XG4gICAgICAgICAgICAgICAgICAgIEZvY3VzaW5nLmZvY3VzKGJ1dHRvbik7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGRldGFpbC5vbkNsb3NlZChjb21wKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uR3Jvd246IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICBLZXlpbmcuZm9jdXNJbihjb21wKTtcbiAgICAgICAgICAgICAgICAgIGRldGFpbC5vbk9wZW5lZChjb21wKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uU3RhcnRHcm93OiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICAgICAgZ2V0UGFydChjb21wLCBkZXRhaWwsICdvdmVyZmxvdy1idXR0b24nKS5lYWNoKFRvZ2dsaW5nLm9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnYWN5Y2xpYycsXG4gICAgICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgICBnZXRQYXJ0KGNvbXAsIGRldGFpbCwgJ292ZXJmbG93LWJ1dHRvbicpLmVhY2goRm9jdXNpbmcuZm9jdXMpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIGV4dGVybmFsJDEoe1xuICAgICAgICBuYW1lOiAnb3ZlcmZsb3ctYnV0dG9uJyxcbiAgICAgICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJ1dHRvbkJlaGF2aW91cnM6IGRlcml2ZSQxKFtUb2dnbGluZy5jb25maWcoe1xuICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiBkZXRhaWwubWFya2Vycy5vdmVyZmxvd1RvZ2dsZWRDbGFzcyxcbiAgICAgICAgICAgICAgICBhcmlhOiB7IG1vZGU6ICdwcmVzc2VkJyB9LFxuICAgICAgICAgICAgICAgIHRvZ2dsZU9uRXhlY3V0ZTogZmFsc2VcbiAgICAgICAgICAgICAgfSldKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgZXh0ZXJuYWwkMSh7IG5hbWU6ICdvdmVyZmxvdy1ncm91cCcgfSlcbiAgICBdKTtcblxuICAgIHZhciBpc09wZW4kMSA9IGZ1bmN0aW9uICh0b29sYmFyLCBkZXRhaWwpIHtcbiAgICAgIHJldHVybiBnZXRQYXJ0KHRvb2xiYXIsIGRldGFpbCwgJ292ZXJmbG93JykubWFwKFNsaWRpbmcuaGFzR3Jvd24pLmdldE9yKGZhbHNlKTtcbiAgICB9O1xuICAgIHZhciB0b2dnbGVUb29sYmFyID0gZnVuY3Rpb24gKHRvb2xiYXIsIGRldGFpbCkge1xuICAgICAgZ2V0UGFydCh0b29sYmFyLCBkZXRhaWwsICdvdmVyZmxvdy1idXR0b24nKS5iaW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldFBhcnQodG9vbGJhciwgZGV0YWlsLCAnb3ZlcmZsb3cnKTtcbiAgICAgIH0pLmVhY2goZnVuY3Rpb24gKG92ZXJmKSB7XG4gICAgICAgIHJlZnJlc2gkMyh0b29sYmFyLCBkZXRhaWwpO1xuICAgICAgICBTbGlkaW5nLnRvZ2dsZUdyb3cob3ZlcmYpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVmcmVzaCQzID0gZnVuY3Rpb24gKHRvb2xiYXIsIGRldGFpbCkge1xuICAgICAgZ2V0UGFydCh0b29sYmFyLCBkZXRhaWwsICdvdmVyZmxvdycpLmVhY2goZnVuY3Rpb24gKG92ZXJmbG93KSB7XG4gICAgICAgIHJlZnJlc2godG9vbGJhciwgZGV0YWlsLCBmdW5jdGlvbiAoZ3JvdXBzKSB7XG4gICAgICAgICAgdmFyIGJ1aWx0R3JvdXBzID0gbWFwKGdyb3VwcywgZnVuY3Rpb24gKGcpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmVtYWRlJDEoZyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgVG9vbGJhci5zZXRHcm91cHMob3ZlcmZsb3csIGJ1aWx0R3JvdXBzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGdldFBhcnQodG9vbGJhciwgZGV0YWlsLCAnb3ZlcmZsb3ctYnV0dG9uJykuZWFjaChmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgaWYgKFNsaWRpbmcuaGFzR3Jvd24ob3ZlcmZsb3cpKSB7XG4gICAgICAgICAgICBUb2dnbGluZy5vbihidXR0b24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFNsaWRpbmcucmVmcmVzaChvdmVyZmxvdyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmYWN0b3J5JGQgPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzLCBzcGVjLCBleHRlcm5hbHMpIHtcbiAgICAgIHZhciB0b29sYmFyVG9nZ2xlRXZlbnQgPSAnYWxsb3kudG9vbGJhci50b2dnbGUnO1xuICAgICAgdmFyIGRvU2V0R3JvdXBzID0gZnVuY3Rpb24gKHRvb2xiYXIsIGdyb3Vwcykge1xuICAgICAgICB2YXIgYnVpbHQgPSBtYXAoZ3JvdXBzLCB0b29sYmFyLmdldFN5c3RlbSgpLmJ1aWxkKTtcbiAgICAgICAgZGV0YWlsLmJ1aWx0R3JvdXBzLnNldChidWlsdCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHMsXG4gICAgICAgIGJlaGF2aW91cnM6IGF1Z21lbnQoZGV0YWlsLnNwbGl0VG9vbGJhckJlaGF2aW91cnMsIFtcbiAgICAgICAgICBDb3VwbGluZy5jb25maWcoe1xuICAgICAgICAgICAgb3RoZXJzOiB7XG4gICAgICAgICAgICAgIG92ZXJmbG93R3JvdXA6IGZ1bmN0aW9uICh0b29sYmFyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFRvb2xiYXJHcm91cC5za2V0Y2goX19hc3NpZ24oX19hc3NpZ24oe30sIGV4dGVybmFsc1snb3ZlcmZsb3ctZ3JvdXAnXSgpKSwge1xuICAgICAgICAgICAgICAgICAgaXRlbXM6IFtCdXR0b24uc2tldGNoKF9fYXNzaWduKF9fYXNzaWduKHt9LCBleHRlcm5hbHNbJ292ZXJmbG93LWJ1dHRvbiddKCkpLCB7XG4gICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoX2J1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCh0b29sYmFyLCB0b29sYmFyVG9nZ2xlRXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkpXVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNvbmZpZygndG9vbGJhci10b2dnbGUtZXZlbnRzJywgW3J1bih0b29sYmFyVG9nZ2xlRXZlbnQsIGZ1bmN0aW9uICh0b29sYmFyKSB7XG4gICAgICAgICAgICAgIHRvZ2dsZVRvb2xiYXIodG9vbGJhciwgZGV0YWlsKTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgXSksXG4gICAgICAgIGFwaXM6IHtcbiAgICAgICAgICBzZXRHcm91cHM6IGZ1bmN0aW9uICh0b29sYmFyLCBncm91cHMpIHtcbiAgICAgICAgICAgIGRvU2V0R3JvdXBzKHRvb2xiYXIsIGdyb3Vwcyk7XG4gICAgICAgICAgICByZWZyZXNoJDModG9vbGJhciwgZGV0YWlsKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uICh0b29sYmFyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVmcmVzaCQzKHRvb2xiYXIsIGRldGFpbCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uICh0b29sYmFyKSB7XG4gICAgICAgICAgICByZXR1cm4gdG9nZ2xlVG9vbGJhcih0b29sYmFyLCBkZXRhaWwpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaXNPcGVuOiBmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgcmV0dXJuIGlzT3BlbiQxKHRvb2xiYXIsIGRldGFpbCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IHsgYXR0cmlidXRlczogeyByb2xlOiAnZ3JvdXAnIH0gfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTcGxpdFNsaWRpbmdUb29sYmFyID0gY29tcG9zaXRlJDEoe1xuICAgICAgbmFtZTogJ1NwbGl0U2xpZGluZ1Rvb2xiYXInLFxuICAgICAgY29uZmlnRmllbGRzOiBzY2hlbWEkcCgpLFxuICAgICAgcGFydEZpZWxkczogcGFydHMkYigpLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSRkLFxuICAgICAgYXBpczoge1xuICAgICAgICBzZXRHcm91cHM6IGZ1bmN0aW9uIChhcGlzLCB0b29sYmFyLCBncm91cHMpIHtcbiAgICAgICAgICBhcGlzLnNldEdyb3Vwcyh0b29sYmFyLCBncm91cHMpO1xuICAgICAgICB9LFxuICAgICAgICByZWZyZXNoOiBmdW5jdGlvbiAoYXBpcywgdG9vbGJhcikge1xuICAgICAgICAgIGFwaXMucmVmcmVzaCh0b29sYmFyKTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAoYXBpcywgdG9vbGJhcikge1xuICAgICAgICAgIGFwaXMudG9nZ2xlKHRvb2xiYXIpO1xuICAgICAgICB9LFxuICAgICAgICBpc09wZW46IGZ1bmN0aW9uIChhcGlzLCB0b29sYmFyKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuaXNPcGVuKHRvb2xiYXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgdG9vbGJhckhlaWdodENoYW5nZSA9IGNvbnN0YW50KGdlbmVyYXRlJDEoJ3Rvb2xiYXItaGVpZ2h0LWNoYW5nZScpKTtcblxuICAgIHZhciByZW5kZXJUb29sYmFyR3JvdXBDb21tb24gPSBmdW5jdGlvbiAodG9vbGJhckdyb3VwKSB7XG4gICAgICB2YXIgYXR0cmlidXRlcyA9IHRvb2xiYXJHcm91cC50aXRsZS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgfSwgZnVuY3Rpb24gKHRpdGxlKSB7XG4gICAgICAgIHJldHVybiB7IGF0dHJpYnV0ZXM6IHsgdGl0bGU6IHRpdGxlIH0gfTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiBfX2Fzc2lnbih7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10b29sYmFyX19ncm91cCddXG4gICAgICAgIH0sIGF0dHJpYnV0ZXMpLFxuICAgICAgICBjb21wb25lbnRzOiBbVG9vbGJhckdyb3VwLnBhcnRzLml0ZW1zKHt9KV0sXG4gICAgICAgIGl0ZW1zOiB0b29sYmFyR3JvdXAuaXRlbXMsXG4gICAgICAgIG1hcmtlcnM6IHsgaXRlbVNlbGVjdG9yOiAnKjpub3QoLnRveC1zcGxpdC1idXR0b24pID4gLnRveC10YnRuOm5vdChbZGlzYWJsZWRdKSwgJyArICcudG94LXNwbGl0LWJ1dHRvbjpub3QoW2Rpc2FibGVkXSksICcgKyAnLnRveC10b29sYmFyLW5hdi1qczpub3QoW2Rpc2FibGVkXSknIH0sXG4gICAgICAgIHRncm91cEJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSlcbiAgICAgICAgXSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyVG9vbGJhckdyb3VwID0gZnVuY3Rpb24gKHRvb2xiYXJHcm91cCkge1xuICAgICAgcmV0dXJuIFRvb2xiYXJHcm91cC5za2V0Y2gocmVuZGVyVG9vbGJhckdyb3VwQ29tbW9uKHRvb2xiYXJHcm91cCkpO1xuICAgIH07XG4gICAgdmFyIGdldFRvb2xiYXJiZWhhdmlvdXJzID0gZnVuY3Rpb24gKHRvb2xiYXJTcGVjLCBtb2RlTmFtZSkge1xuICAgICAgdmFyIG9uQXR0YWNoZWQgPSBydW5PbkF0dGFjaGVkKGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgdmFyIGdyb3VwcyA9IG1hcCh0b29sYmFyU3BlYy5pbml0R3JvdXBzLCByZW5kZXJUb29sYmFyR3JvdXApO1xuICAgICAgICBUb29sYmFyLnNldEdyb3Vwcyhjb21wb25lbnQsIGdyb3Vwcyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZXJpdmUkMShbXG4gICAgICAgIERpc2FibGluZ0NvbmZpZ3MudG9vbGJhckJ1dHRvbih0b29sYmFyU3BlYy5wcm92aWRlcnMuaXNEaXNhYmxlZCksXG4gICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICBtb2RlOiBtb2RlTmFtZSxcbiAgICAgICAgICBvbkVzY2FwZTogdG9vbGJhclNwZWMub25Fc2NhcGUsXG4gICAgICAgICAgc2VsZWN0b3I6ICcudG94LXRvb2xiYXJfX2dyb3VwJ1xuICAgICAgICB9KSxcbiAgICAgICAgY29uZmlnKCd0b29sYmFyLWV2ZW50cycsIFtvbkF0dGFjaGVkXSlcbiAgICAgIF0pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlck1vcmVUb29sYmFyQ29tbW9uID0gZnVuY3Rpb24gKHRvb2xiYXJTcGVjKSB7XG4gICAgICB2YXIgbW9kZU5hbWUgPSB0b29sYmFyU3BlYy5jeWNsaWNLZXlpbmcgPyAnY3ljbGljJyA6ICdhY3ljbGljJztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogdG9vbGJhclNwZWMudWlkLFxuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXRvb2xiYXItb3ZlcmxvcmQnXVxuICAgICAgICB9LFxuICAgICAgICBwYXJ0czoge1xuICAgICAgICAgICdvdmVyZmxvdy1ncm91cCc6IHJlbmRlclRvb2xiYXJHcm91cENvbW1vbih7XG4gICAgICAgICAgICB0aXRsZTogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgICAgaXRlbXM6IFtdXG4gICAgICAgICAgfSksXG4gICAgICAgICAgJ292ZXJmbG93LWJ1dHRvbic6IHJlbmRlckljb25CdXR0b25TcGVjKHtcbiAgICAgICAgICAgIG5hbWU6ICdtb3JlJyxcbiAgICAgICAgICAgIGljb246IE9wdGlvbmFsLnNvbWUoJ21vcmUtZHJhd2VyJyksXG4gICAgICAgICAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgICAgICAgICB0b29sdGlwOiBPcHRpb25hbC5zb21lKCdNb3JlLi4uJyksXG4gICAgICAgICAgICBwcmltYXJ5OiBmYWxzZSxcbiAgICAgICAgICAgIGJvcmRlcmxlc3M6IGZhbHNlXG4gICAgICAgICAgfSwgT3B0aW9uYWwubm9uZSgpLCB0b29sYmFyU3BlYy5wcm92aWRlcnMpXG4gICAgICAgIH0sXG4gICAgICAgIHNwbGl0VG9vbGJhckJlaGF2aW91cnM6IGdldFRvb2xiYXJiZWhhdmlvdXJzKHRvb2xiYXJTcGVjLCBtb2RlTmFtZSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRmxvYXRpbmdNb3JlVG9vbGJhciA9IGZ1bmN0aW9uICh0b29sYmFyU3BlYykge1xuICAgICAgdmFyIGJhc2VTcGVjID0gcmVuZGVyTW9yZVRvb2xiYXJDb21tb24odG9vbGJhclNwZWMpO1xuICAgICAgdmFyIG92ZXJmbG93WE9mZnNldCA9IDQ7XG4gICAgICB2YXIgcHJpbWFyeSA9IFNwbGl0RmxvYXRpbmdUb29sYmFyLnBhcnRzLnByaW1hcnkoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXRvb2xiYXJfX3ByaW1hcnknXVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBTcGxpdEZsb2F0aW5nVG9vbGJhci5za2V0Y2goX19hc3NpZ24oX19hc3NpZ24oe30sIGJhc2VTcGVjKSwge1xuICAgICAgICBsYXp5U2luazogdG9vbGJhclNwZWMuZ2V0U2luayxcbiAgICAgICAgZ2V0T3ZlcmZsb3dCb3VuZHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgaGVhZGVyRWxlbSA9IHRvb2xiYXJTcGVjLm1vcmVEcmF3ZXJEYXRhLmxhenlIZWFkZXIoKS5lbGVtZW50O1xuICAgICAgICAgIHZhciBoZWFkZXJCb3VuZHMgPSBhYnNvbHV0ZSQxKGhlYWRlckVsZW0pO1xuICAgICAgICAgIHZhciBkb2NFbGVtID0gZG9jdW1lbnRFbGVtZW50KGhlYWRlckVsZW0pO1xuICAgICAgICAgIHZhciBkb2NCb3VuZHMgPSBhYnNvbHV0ZSQxKGRvY0VsZW0pO1xuICAgICAgICAgIHZhciBoZWlnaHQgPSBNYXRoLm1heChkb2NFbGVtLmRvbS5zY3JvbGxIZWlnaHQsIGRvY0JvdW5kcy5oZWlnaHQpO1xuICAgICAgICAgIHJldHVybiBib3VuZHMkMShoZWFkZXJCb3VuZHMueCArIG92ZXJmbG93WE9mZnNldCwgZG9jQm91bmRzLnksIGhlYWRlckJvdW5kcy53aWR0aCAtIG92ZXJmbG93WE9mZnNldCAqIDIsIGhlaWdodCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhcnRzOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYmFzZVNwZWMucGFydHMpLCB7XG4gICAgICAgICAgb3ZlcmZsb3c6IHtcbiAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10b29sYmFyX19vdmVyZmxvdyddLFxuICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB0b29sYmFyU3BlYy5hdHRyaWJ1dGVzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgY29tcG9uZW50czogW3ByaW1hcnldLFxuICAgICAgICBtYXJrZXJzOiB7IG92ZXJmbG93VG9nZ2xlZENsYXNzOiAndG94LXRidG4tLWVuYWJsZWQnIH1cbiAgICAgIH0pKTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJTbGlkaW5nTW9yZVRvb2xiYXIgPSBmdW5jdGlvbiAodG9vbGJhclNwZWMpIHtcbiAgICAgIHZhciBwcmltYXJ5ID0gU3BsaXRTbGlkaW5nVG9vbGJhci5wYXJ0cy5wcmltYXJ5KHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10b29sYmFyX19wcmltYXJ5J11cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgb3ZlcmZsb3cgPSBTcGxpdFNsaWRpbmdUb29sYmFyLnBhcnRzLm92ZXJmbG93KHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10b29sYmFyX19vdmVyZmxvdyddXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIGJhc2VTcGVjID0gcmVuZGVyTW9yZVRvb2xiYXJDb21tb24odG9vbGJhclNwZWMpO1xuICAgICAgcmV0dXJuIFNwbGl0U2xpZGluZ1Rvb2xiYXIuc2tldGNoKF9fYXNzaWduKF9fYXNzaWduKHt9LCBiYXNlU3BlYyksIHtcbiAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgIHByaW1hcnksXG4gICAgICAgICAgb3ZlcmZsb3dcbiAgICAgICAgXSxcbiAgICAgICAgbWFya2Vyczoge1xuICAgICAgICAgIG9wZW5DbGFzczogJ3RveC10b29sYmFyX19vdmVyZmxvdy0tb3BlbicsXG4gICAgICAgICAgY2xvc2VkQ2xhc3M6ICd0b3gtdG9vbGJhcl9fb3ZlcmZsb3ctLWNsb3NlZCcsXG4gICAgICAgICAgZ3Jvd2luZ0NsYXNzOiAndG94LXRvb2xiYXJfX292ZXJmbG93LS1ncm93aW5nJyxcbiAgICAgICAgICBzaHJpbmtpbmdDbGFzczogJ3RveC10b29sYmFyX19vdmVyZmxvdy0tc2hyaW5raW5nJyxcbiAgICAgICAgICBvdmVyZmxvd1RvZ2dsZWRDbGFzczogJ3RveC10YnRuLS1lbmFibGVkJ1xuICAgICAgICB9LFxuICAgICAgICBvbk9wZW5lZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICBjb21wLmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFt0b29sYmFySGVpZ2h0Q2hhbmdlKCldLCB7IHR5cGU6ICdvcGVuZWQnIH0pO1xuICAgICAgICB9LFxuICAgICAgICBvbkNsb3NlZDogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICBjb21wLmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFt0b29sYmFySGVpZ2h0Q2hhbmdlKCldLCB7IHR5cGU6ICdjbG9zZWQnIH0pO1xuICAgICAgICB9XG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyVG9vbGJhciA9IGZ1bmN0aW9uICh0b29sYmFyU3BlYykge1xuICAgICAgdmFyIG1vZGVOYW1lID0gdG9vbGJhclNwZWMuY3ljbGljS2V5aW5nID8gJ2N5Y2xpYycgOiAnYWN5Y2xpYyc7XG4gICAgICByZXR1cm4gVG9vbGJhci5za2V0Y2goe1xuICAgICAgICB1aWQ6IHRvb2xiYXJTcGVjLnVpZCxcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10b29sYmFyJ10uY29uY2F0KHRvb2xiYXJTcGVjLnR5cGUgPT09IFRvb2xiYXJNb2RlLnNjcm9sbGluZyA/IFsndG94LXRvb2xiYXItLXNjcm9sbGluZyddIDogW10pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtUb29sYmFyLnBhcnRzLmdyb3Vwcyh7fSldLFxuICAgICAgICB0b29sYmFyQmVoYXZpb3VyczogZ2V0VG9vbGJhcmJlaGF2aW91cnModG9vbGJhclNwZWMsIG1vZGVOYW1lKVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBncm91cFRvb2xiYXJCdXR0b25TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIHN0cmljdE9mKCdpdGVtcycsIG9uZU9mKFtcbiAgICAgICAgYXJyT2ZPYmokMShbXG4gICAgICAgICAgc3RyaWN0U3RyaW5nKCduYW1lJyksXG4gICAgICAgICAgc3RyaWN0QXJyYXlPZignaXRlbXMnLCBzdHJpbmcpXG4gICAgICAgIF0pLFxuICAgICAgICBzdHJpbmdcbiAgICAgIF0pKVxuICAgIF0uY29uY2F0KGJhc2VUb29sYmFyQnV0dG9uRmllbGRzKSk7XG4gICAgdmFyIGNyZWF0ZUdyb3VwVG9vbGJhckJ1dHRvbiA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ0dyb3VwVG9vbGJhckJ1dHRvbicsIGdyb3VwVG9vbGJhckJ1dHRvblNjaGVtYSwgc3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBiYXNlTWVudUJ1dHRvbkZpZWxkcyA9IFtcbiAgICAgIG9wdGlvblN0cmluZygndGV4dCcpLFxuICAgICAgb3B0aW9uU3RyaW5nKCd0b29sdGlwJyksXG4gICAgICBvcHRpb25TdHJpbmcoJ2ljb24nKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdmZXRjaCcpLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uU2V0dXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBub29wO1xuICAgICAgfSlcbiAgICBdO1xuXG4gICAgdmFyIE1lbnVCdXR0b25TY2hlbWEgPSBvYmpPZihfX3NwcmVhZEFycmF5cyhbc3RyaWN0U3RyaW5nKCd0eXBlJyldLCBiYXNlTWVudUJ1dHRvbkZpZWxkcykpO1xuICAgIHZhciBjcmVhdGVNZW51QnV0dG9uID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygnbWVudWJ1dHRvbicsIE1lbnVCdXR0b25TY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgc3BsaXRCdXR0b25TY2hlbWEgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIG9wdGlvblN0cmluZygndG9vbHRpcCcpLFxuICAgICAgb3B0aW9uU3RyaW5nKCdpY29uJyksXG4gICAgICBvcHRpb25TdHJpbmcoJ3RleHQnKSxcbiAgICAgIG9wdGlvbkZ1bmN0aW9uKCdzZWxlY3QnKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdmZXRjaCcpLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uU2V0dXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBub29wO1xuICAgICAgfSksXG4gICAgICBkZWZhdWx0ZWRTdHJpbmdFbnVtKCdwcmVzZXRzJywgJ25vcm1hbCcsIFtcbiAgICAgICAgJ25vcm1hbCcsXG4gICAgICAgICdjb2xvcicsXG4gICAgICAgICdsaXN0cHJldmlldydcbiAgICAgIF0pLFxuICAgICAgZGVmYXVsdGVkJDEoJ2NvbHVtbnMnLCAxKSxcbiAgICAgIHN0cmljdEZ1bmN0aW9uKCdvbkFjdGlvbicpLFxuICAgICAgc3RyaWN0RnVuY3Rpb24oJ29uSXRlbUFjdGlvbicpXG4gICAgXSk7XG4gICAgdmFyIGNyZWF0ZVNwbGl0QnV0dG9uID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiBhc1JhdygnU3BsaXRCdXR0b24nLCBzcGxpdEJ1dHRvblNjaGVtYSwgc3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBldmVudHMkZSA9IGZ1bmN0aW9uIChyZWZsZWN0aW5nQ29uZmlnLCByZWZsZWN0aW5nU3RhdGUpIHtcbiAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkYXRhKSB7XG4gICAgICAgIHJlZmxlY3RpbmdDb25maWcudXBkYXRlU3RhdGUuZWFjaChmdW5jdGlvbiAodXBkYXRlU3RhdGUpIHtcbiAgICAgICAgICB2YXIgbmV3U3RhdGUgPSB1cGRhdGVTdGF0ZShjb21wb25lbnQsIGRhdGEpO1xuICAgICAgICAgIHJlZmxlY3RpbmdTdGF0ZS5zZXQobmV3U3RhdGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVmbGVjdGluZ0NvbmZpZy5yZW5kZXJDb21wb25lbnRzLmVhY2goZnVuY3Rpb24gKHJlbmRlckNvbXBvbmVudHMpIHtcbiAgICAgICAgICB2YXIgbmV3Q29tcG9uZW50cyA9IHJlbmRlckNvbXBvbmVudHMoZGF0YSwgcmVmbGVjdGluZ1N0YXRlLmdldCgpKTtcbiAgICAgICAgICB2YXIgbmV3Q2hpbGRyZW4gPSBtYXAobmV3Q29tcG9uZW50cywgY29tcG9uZW50LmdldFN5c3RlbSgpLmJ1aWxkKTtcbiAgICAgICAgICByZXBsYWNlQ2hpbGRyZW4oY29tcG9uZW50LCBuZXdDaGlsZHJlbik7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBkZXJpdmUoW1xuICAgICAgICBydW4ocmVjZWl2ZSgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBtZXNzYWdlKSB7XG4gICAgICAgICAgdmFyIHJlY2VpdmluZ0RhdGEgPSBtZXNzYWdlO1xuICAgICAgICAgIGlmICghcmVjZWl2aW5nRGF0YS51bml2ZXJzYWwpIHtcbiAgICAgICAgICAgIHZhciBjaGFubmVsID0gcmVmbGVjdGluZ0NvbmZpZy5jaGFubmVsO1xuICAgICAgICAgICAgaWYgKGNvbnRhaW5zKHJlY2VpdmluZ0RhdGEuY2hhbm5lbHMsIGNoYW5uZWwpKSB7XG4gICAgICAgICAgICAgIHVwZGF0ZShjb21wb25lbnQsIHJlY2VpdmluZ0RhdGEuZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KSxcbiAgICAgICAgcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgcmVmbGVjdGluZ0NvbmZpZy5pbml0aWFsRGF0YS5lYWNoKGZ1bmN0aW9uIChyYXdEYXRhKSB7XG4gICAgICAgICAgICB1cGRhdGUoY29tcCwgcmF3RGF0YSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICBdKTtcbiAgICB9O1xuXG4gICAgdmFyIEFjdGl2ZVJlZmxlY3RpbmcgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMkZVxuICAgIH0pO1xuXG4gICAgdmFyIGdldFN0YXRlJDIgPSBmdW5jdGlvbiAoY29tcG9uZW50LCByZXBsYWNlQ29uZmlnLCByZWZsZWN0U3RhdGUpIHtcbiAgICAgIHJldHVybiByZWZsZWN0U3RhdGU7XG4gICAgfTtcblxuICAgIHZhciBSZWZsZWN0aW5nQXBpcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBnZXRTdGF0ZTogZ2V0U3RhdGUkMlxuICAgIH0pO1xuXG4gICAgdmFyIFJlZmxlY3RpbmdTY2hlbWEgPSBbXG4gICAgICBzdHJpY3QkMSgnY2hhbm5lbCcpLFxuICAgICAgb3B0aW9uKCdyZW5kZXJDb21wb25lbnRzJyksXG4gICAgICBvcHRpb24oJ3VwZGF0ZVN0YXRlJyksXG4gICAgICBvcHRpb24oJ2luaXRpYWxEYXRhJylcbiAgICBdO1xuXG4gICAgdmFyIGluaXQkYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjZWxsID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIHNldCA9IGZ1bmN0aW9uIChvcHRTKSB7XG4gICAgICAgIHJldHVybiBjZWxsLnNldChvcHRTKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjZWxsLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjZWxsLmdldCgpO1xuICAgICAgfTtcbiAgICAgIHZhciByZWFkU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjZWxsLmdldCgpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAnbm9uZSc7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgcmV0dXJuIHg7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlYWRTdGF0ZTogcmVhZFN0YXRlLFxuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGNsZWFyOiBjbGVhclxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIFJlZmxlY3RpbmdTdGF0ZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBpbml0OiBpbml0JGFcbiAgICB9KTtcblxuICAgIHZhciBSZWZsZWN0aW5nID0gY3JlYXRlJDEoe1xuICAgICAgZmllbGRzOiBSZWZsZWN0aW5nU2NoZW1hLFxuICAgICAgbmFtZTogJ3JlZmxlY3RpbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVSZWZsZWN0aW5nLFxuICAgICAgYXBpczogUmVmbGVjdGluZ0FwaXMsXG4gICAgICBzdGF0ZTogUmVmbGVjdGluZ1N0YXRlXG4gICAgfSk7XG5cbiAgICB2YXIgc2NoZW1hJHEgPSBjb25zdGFudChbXG4gICAgICBzdHJpY3QkMSgndG9nZ2xlQ2xhc3MnKSxcbiAgICAgIHN0cmljdCQxKCdmZXRjaCcpLFxuICAgICAgb25TdHJpY3RIYW5kbGVyKCdvbkV4ZWN1dGUnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdnZXRIb3RzcG90JywgT3B0aW9uYWwuc29tZSksXG4gICAgICBkZWZhdWx0ZWQkMSgnZ2V0QW5jaG9yT3ZlcnJpZGVzJywgY29uc3RhbnQoe30pKSxcbiAgICAgIHNjaGVtYSQxKCksXG4gICAgICBvblN0cmljdEhhbmRsZXIoJ29uSXRlbUV4ZWN1dGUnKSxcbiAgICAgIG9wdGlvbignbGF6eVNpbmsnKSxcbiAgICAgIHN0cmljdCQxKCdkb20nKSxcbiAgICAgIG9uSGFuZGxlcignb25PcGVuJyksXG4gICAgICBmaWVsZCQxKCdzcGxpdERyb3Bkb3duQmVoYXZpb3VycycsIFtcbiAgICAgICAgQ291cGxpbmcsXG4gICAgICAgIEtleWluZyxcbiAgICAgICAgRm9jdXNpbmdcbiAgICAgIF0pLFxuICAgICAgZGVmYXVsdGVkJDEoJ21hdGNoV2lkdGgnLCBmYWxzZSksXG4gICAgICBkZWZhdWx0ZWQkMSgndXNlTWluV2lkdGgnLCBmYWxzZSksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRPcmRlcicsIHt9KSxcbiAgICAgIG9wdGlvbigncm9sZScpXG4gICAgXS5jb25jYXQoc2FuZGJveEZpZWxkcygpKSk7XG4gICAgdmFyIGFycm93UGFydCA9IHJlcXVpcmVkKHtcbiAgICAgIGZhY3Rvcnk6IEJ1dHRvbixcbiAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdkb20nKV0sXG4gICAgICBuYW1lOiAnYXJyb3cnLFxuICAgICAgZGVmYXVsdHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHsgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW0ZvY3VzaW5nLnJldm9rZSgpXSkgfTtcbiAgICAgIH0sXG4gICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgICAgYXR0cmlidXRlczogeyByb2xlOiAncHJlc2VudGF0aW9uJyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChhcnJvdykge1xuICAgICAgICAgICAgYXJyb3cuZ2V0U3lzdGVtKCkuZ2V0QnlVaWQoZGV0YWlsLnVpZCkuZWFjaChlbWl0RXhlY3V0ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBkZXJpdmUkMShbVG9nZ2xpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiBmYWxzZSxcbiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3M6IGRldGFpbC50b2dnbGVDbGFzc1xuICAgICAgICAgICAgfSldKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBidXR0b25QYXJ0ID0gcmVxdWlyZWQoe1xuICAgICAgZmFjdG9yeTogQnV0dG9uLFxuICAgICAgc2NoZW1hOiBbc3RyaWN0JDEoJ2RvbScpXSxcbiAgICAgIG5hbWU6ICdidXR0b24nLFxuICAgICAgZGVmYXVsdHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHsgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW0ZvY3VzaW5nLnJldm9rZSgpXSkgfTtcbiAgICAgIH0sXG4gICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ3NwYW4nLFxuICAgICAgICAgICAgYXR0cmlidXRlczogeyByb2xlOiAncHJlc2VudGF0aW9uJyB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChidG4pIHtcbiAgICAgICAgICAgIGJ0bi5nZXRTeXN0ZW0oKS5nZXRCeVVpZChkZXRhaWwudWlkKS5lYWNoKGZ1bmN0aW9uIChzcGxpdERyb3Bkb3duKSB7XG4gICAgICAgICAgICAgIGRldGFpbC5vbkV4ZWN1dGUoc3BsaXREcm9wZG93biwgYnRuKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgcGFydHMkYyA9IGNvbnN0YW50KFtcbiAgICAgIGFycm93UGFydCxcbiAgICAgIGJ1dHRvblBhcnQsXG4gICAgICBvcHRpb25hbCh7XG4gICAgICAgIGZhY3Rvcnk6IHtcbiAgICAgICAgICBza2V0Y2g6IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB1aWQ6IHNwZWMudWlkLFxuICAgICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgICB0YWc6ICdzcGFuJyxcbiAgICAgICAgICAgICAgICBzdHlsZXM6IHsgZGlzcGxheTogJ25vbmUnIH0sXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczogeyAnYXJpYS1oaWRkZW4nOiAndHJ1ZScgfSxcbiAgICAgICAgICAgICAgICBpbm5lckh0bWw6IHNwZWMudGV4dFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2NoZW1hOiBbc3RyaWN0JDEoJ3RleHQnKV0sXG4gICAgICAgIG5hbWU6ICdhcmlhLWRlc2NyaXB0b3InXG4gICAgICB9KSxcbiAgICAgIGV4dGVybmFsJDEoe1xuICAgICAgICBzY2hlbWE6IFt0aWVyZWRNZW51TWFya2VycygpXSxcbiAgICAgICAgbmFtZTogJ21lbnUnLFxuICAgICAgICBkZWZhdWx0czogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uICh0bWVudSwgaXRlbSkge1xuICAgICAgICAgICAgICB0bWVudS5nZXRTeXN0ZW0oKS5nZXRCeVVpZChkZXRhaWwudWlkKS5lYWNoKGZ1bmN0aW9uIChzcGxpdERyb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgZGV0YWlsLm9uSXRlbUV4ZWN1dGUoc3BsaXREcm9wZG93biwgdG1lbnUsIGl0ZW0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHBhcnRUeXBlKClcbiAgICBdKTtcblxuICAgIHZhciBmYWN0b3J5JGUgPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzLCBzcGVjLCBleHRlcm5hbHMpIHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHZhciBzd2l0Y2hUb01lbnUgPSBmdW5jdGlvbiAoc2FuZGJveCkge1xuICAgICAgICBDb21wb3NpbmcuZ2V0Q3VycmVudChzYW5kYm94KS5lYWNoKGZ1bmN0aW9uIChjdXJyZW50KSB7XG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLmhpZ2hsaWdodEZpcnN0KGN1cnJlbnQpO1xuICAgICAgICAgIEtleWluZy5mb2N1c0luKGN1cnJlbnQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgYWN0aW9uID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICB2YXIgb25PcGVuU3luYyA9IHN3aXRjaFRvTWVudTtcbiAgICAgICAgdG9nZ2xlUG9wdXAoZGV0YWlsLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICB9LCBjb21wb25lbnQsIGV4dGVybmFscywgb25PcGVuU3luYywgSGlnaGxpZ2h0T25PcGVuLkhpZ2hsaWdodEZpcnN0KS5nZXQobm9vcCk7XG4gICAgICB9O1xuICAgICAgdmFyIG9wZW5NZW51ID0gZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgYWN0aW9uKGNvbXApO1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZXhlY3V0ZU9uQnV0dG9uID0gZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGdldFBhcnRPckRpZShjb21wLCBkZXRhaWwsICdidXR0b24nKTtcbiAgICAgICAgZW1pdEV4ZWN1dGUoYnV0dG9uKTtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIGJ1dHRvbkV2ZW50cyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZXJpdmUoW3J1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXBvbmVudCwgX3NpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgdmFyIGFyaWFEZXNjcmlwdG9yID0gZ2V0UGFydChjb21wb25lbnQsIGRldGFpbCwgJ2FyaWEtZGVzY3JpcHRvcicpO1xuICAgICAgICAgIGFyaWFEZXNjcmlwdG9yLmVhY2goZnVuY3Rpb24gKGRlc2NyaXB0b3IpIHtcbiAgICAgICAgICAgIHZhciBkZXNjcmlwdG9ySWQgPSBnZW5lcmF0ZSQxKCdhcmlhJyk7XG4gICAgICAgICAgICBzZXQkMShkZXNjcmlwdG9yLmVsZW1lbnQsICdpZCcsIGRlc2NyaXB0b3JJZCk7XG4gICAgICAgICAgICBzZXQkMShjb21wb25lbnQuZWxlbWVudCwgJ2FyaWEtZGVzY3JpYmVkYnknLCBkZXNjcmlwdG9ySWQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KV0pKSwgZXZlbnRzJDcoT3B0aW9uYWwuc29tZShhY3Rpb24pKSk7XG4gICAgICB2YXIgYXBpcyA9IHtcbiAgICAgICAgcmVwb3NpdGlvbk1lbnVzOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIGlmIChUb2dnbGluZy5pc09uKGNvbXApKSB7XG4gICAgICAgICAgICByZXBvc2l0aW9uTWVudXMoY29tcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHMsXG4gICAgICAgIGFwaXM6IGFwaXMsXG4gICAgICAgIGV2ZW50T3JkZXI6IF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZXRhaWwuZXZlbnRPcmRlciksIChfYSA9IHt9LCBfYVtleGVjdXRlKCldID0gW1xuICAgICAgICAgICdkaXNhYmxpbmcnLFxuICAgICAgICAgICd0b2dnbGluZycsXG4gICAgICAgICAgJ2FsbG95LmJhc2UuYmVoYXZpb3VyJ1xuICAgICAgICBdLCBfYSkpLFxuICAgICAgICBldmVudHM6IGJ1dHRvbkV2ZW50cyxcbiAgICAgICAgYmVoYXZpb3VyczogYXVnbWVudChkZXRhaWwuc3BsaXREcm9wZG93bkJlaGF2aW91cnMsIFtcbiAgICAgICAgICBDb3VwbGluZy5jb25maWcoe1xuICAgICAgICAgICAgb3RoZXJzOiB7XG4gICAgICAgICAgICAgIHNhbmRib3g6IGZ1bmN0aW9uIChob3RzcG90KSB7XG4gICAgICAgICAgICAgICAgdmFyIGFycm93ID0gZ2V0UGFydE9yRGllKGhvdHNwb3QsIGRldGFpbCwgJ2Fycm93Jyk7XG4gICAgICAgICAgICAgICAgdmFyIGV4dHJhcyA9IHtcbiAgICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBUb2dnbGluZy5vbihhcnJvdyk7XG4gICAgICAgICAgICAgICAgICAgIFRvZ2dsaW5nLm9uKGhvdHNwb3QpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgVG9nZ2xpbmcub2ZmKGFycm93KTtcbiAgICAgICAgICAgICAgICAgICAgVG9nZ2xpbmcub2ZmKGhvdHNwb3QpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1ha2VTYW5kYm94KGRldGFpbCwgaG90c3BvdCwgZXh0cmFzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgb25TcGFjZTogZXhlY3V0ZU9uQnV0dG9uLFxuICAgICAgICAgICAgb25FbnRlcjogZXhlY3V0ZU9uQnV0dG9uLFxuICAgICAgICAgICAgb25Eb3duOiBvcGVuTWVudVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgVG9nZ2xpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIHRvZ2dsZU9uRXhlY3V0ZTogZmFsc2UsXG4gICAgICAgICAgICBhcmlhOiB7IG1vZGU6ICdleHBhbmRlZCcgfVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pLFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IHtcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAncm9sZSc6IGRldGFpbC5yb2xlLmdldE9yKCdidXR0b24nKSxcbiAgICAgICAgICAgICdhcmlhLWhhc3BvcHVwJzogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTcGxpdERyb3Bkb3duID0gY29tcG9zaXRlJDEoe1xuICAgICAgbmFtZTogJ1NwbGl0RHJvcGRvd24nLFxuICAgICAgY29uZmlnRmllbGRzOiBzY2hlbWEkcSgpLFxuICAgICAgcGFydEZpZWxkczogcGFydHMkYygpLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSRlLFxuICAgICAgYXBpczoge1xuICAgICAgICByZXBvc2l0aW9uTWVudXM6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMucmVwb3NpdGlvbk1lbnVzKGNvbXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgZ2V0QnV0dG9uQXBpID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuaXNEaXNhYmxlZChjb21wb25lbnQpO1xuICAgICAgICB9LFxuICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgcmV0dXJuIERpc2FibGluZy5zZXQoY29tcG9uZW50LCBzdGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0VG9nZ2xlQXBpID0gZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2V0QWN0aXZlOiBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICBUb2dnbGluZy5zZXQoY29tcG9uZW50LCBzdGF0ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzQWN0aXZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFRvZ2dsaW5nLmlzT24oY29tcG9uZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuaXNEaXNhYmxlZChjb21wb25lbnQpO1xuICAgICAgICB9LFxuICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgcmV0dXJuIERpc2FibGluZy5zZXQoY29tcG9uZW50LCBzdGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0VG9vbHRpcEF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAodG9vbHRpcCwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4gdG9vbHRpcC5tYXAoZnVuY3Rpb24gKHRvb2x0aXApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUodG9vbHRpcCksXG4gICAgICAgICAgJ3RpdGxlJzogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZSh0b29sdGlwKVxuICAgICAgICB9O1xuICAgICAgfSkuZ2V0T3Ioe30pO1xuICAgIH07XG4gICAgdmFyIGZvY3VzQnV0dG9uRXZlbnQgPSBnZW5lcmF0ZSQxKCdmb2N1cy1idXR0b24nKTtcbiAgICB2YXIgcnRsSWNvbiQxID0gW1xuICAgICAgJ2NoZWNrbGlzdCcsXG4gICAgICAnb3JkZXJlZC1saXN0J1xuICAgIF07XG4gICAgdmFyIHJ0bFRyYW5zZm9ybSQxID0gW1xuICAgICAgJ2luZGVudCcsXG4gICAgICAnb3V0ZGVudCcsXG4gICAgICAndGFibGUtaW5zZXJ0LWNvbHVtbi1hZnRlcicsXG4gICAgICAndGFibGUtaW5zZXJ0LWNvbHVtbi1iZWZvcmUnLFxuICAgICAgJ3Vub3JkZXJlZC1saXN0J1xuICAgIF07XG4gICAgdmFyIHJlbmRlckNvbW1vblN0cnVjdHVyZSA9IGZ1bmN0aW9uIChpY29uLCB0ZXh0LCB0b29sdGlwLCByZWNlaXZlciwgYmVoYXZpb3VycywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgX2Q7XG4gICAgICB2YXIgZ2V0SWNvbk5hbWUgPSBmdW5jdGlvbiAoaWNvbk5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGdsb2JhbCQ2LmlzUnRsKCkgJiYgY29udGFpbnMocnRsSWNvbiQxLCBpY29uTmFtZSkgPyBpY29uTmFtZSArICctcnRsJyA6IGljb25OYW1lO1xuICAgICAgfTtcbiAgICAgIHZhciBuZWVkc1J0bENsYXNzID0gZ2xvYmFsJDYuaXNSdGwoKSAmJiBpY29uLmV4aXN0cyhmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gY29udGFpbnMocnRsVHJhbnNmb3JtJDEsIG5hbWUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXRidG4nXS5jb25jYXQodGV4dC5pc1NvbWUoKSA/IFsndG94LXRidG4tLXNlbGVjdCddIDogW10pLmNvbmNhdChuZWVkc1J0bENsYXNzID8gWyd0b3gtdGJ0bl9faWNvbi1ydGwnXSA6IFtdKSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBnZXRUb29sdGlwQXR0cmlidXRlcyh0b29sdGlwLCBwcm92aWRlcnNCYWNrc3RhZ2UpXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudFJlbmRlclBpcGVsaW5lKFtcbiAgICAgICAgICBpY29uLm1hcChmdW5jdGlvbiAoaWNvbk5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJJY29uRnJvbVBhY2soZ2V0SWNvbk5hbWUoaWNvbk5hbWUpLCBwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHRleHQubWFwKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyTGFiZWwkMSh0ZXh0LCAndG94LXRidG4nLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgICAgIH0pXG4gICAgICAgIF0pLFxuICAgICAgICBldmVudE9yZGVyOiAoX2QgPSB7fSwgX2RbbW91c2Vkb3duKCldID0gW1xuICAgICAgICAgICdmb2N1c2luZycsXG4gICAgICAgICAgJ2FsbG95LmJhc2UuYmVoYXZpb3VyJyxcbiAgICAgICAgICAnY29tbW9uLWJ1dHRvbi1kaXNwbGF5LWV2ZW50cydcbiAgICAgICAgXSwgX2QpLFxuICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgRGlzYWJsaW5nQ29uZmlncy50b29sYmFyQnV0dG9uKHByb3ZpZGVyc0JhY2tzdGFnZS5pc0Rpc2FibGVkKSxcbiAgICAgICAgICByZWNlaXZpbmdDb25maWcoKSxcbiAgICAgICAgICBjb25maWcoJ2NvbW1vbi1idXR0b24tZGlzcGxheS1ldmVudHMnLCBbcnVuKG1vdXNlZG93bigpLCBmdW5jdGlvbiAoYnV0dG9uLCBzZSkge1xuICAgICAgICAgICAgICBzZS5ldmVudC5wcmV2ZW50KCk7XG4gICAgICAgICAgICAgIGVtaXQoYnV0dG9uLCBmb2N1c0J1dHRvbkV2ZW50KTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgXS5jb25jYXQocmVjZWl2ZXIubWFwKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgcmV0dXJuIFJlZmxlY3RpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGNoYW5uZWw6IHIsXG4gICAgICAgICAgICBpbml0aWFsRGF0YToge1xuICAgICAgICAgICAgICBpY29uOiBpY29uLFxuICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVuZGVyQ29tcG9uZW50czogZnVuY3Rpb24gKGRhdGEsIF9zdGF0ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gY29tcG9uZW50UmVuZGVyUGlwZWxpbmUoW1xuICAgICAgICAgICAgICAgIGRhdGEuaWNvbi5tYXAoZnVuY3Rpb24gKGljb25OYW1lKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVySWNvbkZyb21QYWNrKGdldEljb25OYW1lKGljb25OYW1lKSwgcHJvdmlkZXJzQmFja3N0YWdlLmljb25zKTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBkYXRhLnRleHQubWFwKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyTGFiZWwkMSh0ZXh0LCAndG94LXRidG4nLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KS50b0FycmF5KCkpLmNvbmNhdChiZWhhdmlvdXJzLmdldE9yKFtdKSkpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlckZsb2F0aW5nVG9vbGJhckJ1dHRvbiA9IGZ1bmN0aW9uIChzcGVjLCBiYWNrc3RhZ2UsIGlkZW50aWZ5QnV0dG9ucywgYXR0cmlidXRlcykge1xuICAgICAgdmFyIHNoYXJlZEJhY2tzdGFnZSA9IGJhY2tzdGFnZS5zaGFyZWQ7XG4gICAgICByZXR1cm4gRmxvYXRpbmdUb29sYmFyQnV0dG9uLnNrZXRjaCh7XG4gICAgICAgIGxhenlTaW5rOiBzaGFyZWRCYWNrc3RhZ2UuZ2V0U2luayxcbiAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gRnV0dXJlLm51KGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgICAgICByZXNvbHZlKG1hcChpZGVudGlmeUJ1dHRvbnMoc3BlYy5pdGVtcyksIHJlbmRlclRvb2xiYXJHcm91cCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBtYXJrZXJzOiB7IHRvZ2dsZWRDbGFzczogJ3RveC10YnRuLS1lbmFibGVkJyB9LFxuICAgICAgICBwYXJ0czoge1xuICAgICAgICAgIGJ1dHRvbjogcmVuZGVyQ29tbW9uU3RydWN0dXJlKHNwZWMuaWNvbiwgc3BlYy50ZXh0LCBzcGVjLnRvb2x0aXAsIE9wdGlvbmFsLm5vbmUoKSwgT3B0aW9uYWwubm9uZSgpLCBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzKSxcbiAgICAgICAgICB0b29sYmFyOiB7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtdG9vbGJhcl9fb3ZlcmZsb3cnXSxcbiAgICAgICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlc1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQ29tbW9uVG9vbGJhckJ1dHRvbiA9IGZ1bmN0aW9uIChzcGVjLCBzcGVjaWFsaXNhdGlvbiwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgZWRpdG9yT2ZmQ2VsbCA9IENlbGwobm9vcCk7XG4gICAgICB2YXIgc3RydWN0dXJlID0gcmVuZGVyQ29tbW9uU3RydWN0dXJlKHNwZWMuaWNvbiwgc3BlYy50ZXh0LCBzcGVjLnRvb2x0aXAsIE9wdGlvbmFsLm5vbmUoKSwgT3B0aW9uYWwubm9uZSgpLCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgICAgcmV0dXJuIEJ1dHRvbi5za2V0Y2goe1xuICAgICAgICBkb206IHN0cnVjdHVyZS5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IHN0cnVjdHVyZS5jb21wb25lbnRzLFxuICAgICAgICBldmVudE9yZGVyOiB0b29sYmFyQnV0dG9uRXZlbnRPcmRlcixcbiAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIGNvbmZpZygndG9vbGJhci1idXR0b24tZXZlbnRzJywgW1xuICAgICAgICAgICAgb25Ub29sYmFyQnV0dG9uRXhlY3V0ZSh7XG4gICAgICAgICAgICAgIG9uQWN0aW9uOiBzcGVjLm9uQWN0aW9uLFxuICAgICAgICAgICAgICBnZXRBcGk6IHNwZWNpYWxpc2F0aW9uLmdldEFwaVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBvbkNvbnRyb2xBdHRhY2hlZChzcGVjaWFsaXNhdGlvbiwgZWRpdG9yT2ZmQ2VsbCksXG4gICAgICAgICAgICBvbkNvbnRyb2xEZXRhY2hlZChzcGVjaWFsaXNhdGlvbiwgZWRpdG9yT2ZmQ2VsbClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLnRvb2xiYXJCdXR0b24oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNwZWMuZGlzYWJsZWQgfHwgcHJvdmlkZXJzQmFja3N0YWdlLmlzRGlzYWJsZWQoKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICByZWNlaXZpbmdDb25maWcoKVxuICAgICAgICBdLmNvbmNhdChzcGVjaWFsaXNhdGlvbi50b29sYmFyQnV0dG9uQmVoYXZpb3VycykpXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJUb29sYmFyQnV0dG9uID0gZnVuY3Rpb24gKHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIHJlbmRlclRvb2xiYXJCdXR0b25XaXRoKHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSwgW10pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlclRvb2xiYXJCdXR0b25XaXRoID0gZnVuY3Rpb24gKHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSwgYm9udXNFdmVudHMpIHtcbiAgICAgIHJldHVybiByZW5kZXJDb21tb25Ub29sYmFyQnV0dG9uKHNwZWMsIHtcbiAgICAgICAgdG9vbGJhckJ1dHRvbkJlaGF2aW91cnM6IFtdLmNvbmNhdChib251c0V2ZW50cy5sZW5ndGggPiAwID8gW2NvbmZpZygndG9vbGJhckJ1dHRvbldpdGgnLCBib251c0V2ZW50cyldIDogW10pLFxuICAgICAgICBnZXRBcGk6IGdldEJ1dHRvbkFwaSxcbiAgICAgICAgb25TZXR1cDogc3BlYy5vblNldHVwXG4gICAgICB9LCBwcm92aWRlcnNCYWNrc3RhZ2UpO1xuICAgIH07XG4gICAgdmFyIHJlbmRlclRvb2xiYXJUb2dnbGVCdXR0b24gPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4gcmVuZGVyVG9vbGJhclRvZ2dsZUJ1dHRvbldpdGgoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlLCBbXSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyVG9vbGJhclRvZ2dsZUJ1dHRvbldpdGggPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlLCBib251c0V2ZW50cykge1xuICAgICAgcmV0dXJuIGRlZXBNZXJnZShyZW5kZXJDb21tb25Ub29sYmFyQnV0dG9uKHNwZWMsIHtcbiAgICAgICAgdG9vbGJhckJ1dHRvbkJlaGF2aW91cnM6IFtcbiAgICAgICAgICBSZXBsYWNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBUb2dnbGluZy5jb25maWcoe1xuICAgICAgICAgICAgdG9nZ2xlQ2xhc3M6ICd0b3gtdGJ0bi0tZW5hYmxlZCcsXG4gICAgICAgICAgICBhcmlhOiB7IG1vZGU6ICdwcmVzc2VkJyB9LFxuICAgICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiBmYWxzZVxuICAgICAgICAgIH0pXG4gICAgICAgIF0uY29uY2F0KGJvbnVzRXZlbnRzLmxlbmd0aCA+IDAgPyBbY29uZmlnKCd0b29sYmFyVG9nZ2xlQnV0dG9uV2l0aCcsIGJvbnVzRXZlbnRzKV0gOiBbXSksXG4gICAgICAgIGdldEFwaTogZ2V0VG9nZ2xlQXBpLFxuICAgICAgICBvblNldHVwOiBzcGVjLm9uU2V0dXBcbiAgICAgIH0sIHByb3ZpZGVyc0JhY2tzdGFnZSkpO1xuICAgIH07XG4gICAgdmFyIGZldGNoQ2hvaWNlcyA9IGZ1bmN0aW9uIChnZXRBcGksIHNwZWMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIHJldHVybiBGdXR1cmUubnUoZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgcmV0dXJuIHNwZWMuZmV0Y2goY2FsbGJhY2spO1xuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oY3JlYXRlVGllcmVkRGF0YUZyb20oZGVlcE1lcmdlKGNyZWF0ZVBhcnRpYWxDaG9pY2VNZW51KGdlbmVyYXRlJDEoJ21lbnUtdmFsdWUnKSwgaXRlbXMsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgc3BlYy5vbkl0ZW1BY3Rpb24oZ2V0QXBpKGNvbXApLCB2YWx1ZSk7XG4gICAgICAgICAgfSwgc3BlYy5jb2x1bW5zLCBzcGVjLnByZXNldHMsIEl0ZW1SZXNwb25zZSQxLkNMT1NFX09OX0VYRUNVVEUsIHNwZWMuc2VsZWN0LmdldE9yKG5ldmVyKSwgcHJvdmlkZXJzQmFja3N0YWdlKSwge1xuICAgICAgICAgICAgbW92ZW1lbnQ6IGRlcml2ZU1lbnVNb3ZlbWVudChzcGVjLmNvbHVtbnMsIHNwZWMucHJlc2V0cyksXG4gICAgICAgICAgICBtZW51QmVoYXZpb3VyczogU2ltcGxlQmVoYXZpb3Vycy51bm5hbWVkRXZlbnRzKHNwZWMuY29sdW1ucyAhPT0gJ2F1dG8nID8gW10gOiBbcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgICAgZGV0ZWN0U2l6ZShjb21wLCA0LCBjbGFzc0ZvclByZXNldChzcGVjLnByZXNldHMpKS5lYWNoKGZ1bmN0aW9uIChfZCkge1xuICAgICAgICAgICAgICAgICAgdmFyIG51bVJvd3MgPSBfZC5udW1Sb3dzLCBudW1Db2x1bW5zID0gX2QubnVtQ29sdW1ucztcbiAgICAgICAgICAgICAgICAgIEtleWluZy5zZXRHcmlkU2l6ZShjb21wLCBudW1Sb3dzLCBudW1Db2x1bW5zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSldKVxuICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJTcGxpdEJ1dHRvbiA9IGZ1bmN0aW9uIChzcGVjLCBzaGFyZWRCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBfZDtcbiAgICAgIHZhciBkaXNwbGF5Q2hhbm5lbCA9IGdlbmVyYXRlJDEoJ2NoYW5uZWwtdXBkYXRlLXNwbGl0LWRyb3Bkb3duLWRpc3BsYXknKTtcbiAgICAgIHZhciBnZXRBcGkgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuaXNEaXNhYmxlZChjb21wKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldERpc2FibGVkOiBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBEaXNhYmxpbmcuc2V0KGNvbXAsIHN0YXRlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldEljb25GaWxsOiBmdW5jdGlvbiAoaWQsIHZhbHVlKSB7XG4gICAgICAgICAgICBkZXNjZW5kYW50JDEoY29tcC5lbGVtZW50LCAnc3ZnIHBhdGhbaWQ9XCInICsgaWQgKyAnXCJdLCByZWN0W2lkPVwiJyArIGlkICsgJ1wiXScpLmVhY2goZnVuY3Rpb24gKHVuZGVybGluZVBhdGgpIHtcbiAgICAgICAgICAgICAgc2V0JDEodW5kZXJsaW5lUGF0aCwgJ2ZpbGwnLCB2YWx1ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldEljb25TdHJva2U6IGZ1bmN0aW9uIChpZCwgdmFsdWUpIHtcbiAgICAgICAgICAgIGRlc2NlbmRhbnQkMShjb21wLmVsZW1lbnQsICdzdmcgcGF0aFtpZD1cIicgKyBpZCArICdcIl0sIHJlY3RbaWQ9XCInICsgaWQgKyAnXCJdJykuZWFjaChmdW5jdGlvbiAodW5kZXJsaW5lUGF0aCkge1xuICAgICAgICAgICAgICBzZXQkMSh1bmRlcmxpbmVQYXRoLCAnc3Ryb2tlJywgdmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgaWYgKGNvbXAuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgICAgICBzZXQkMShjb21wLmVsZW1lbnQsICdhcmlhLXByZXNzZWQnLCBzdGF0ZSk7XG4gICAgICAgICAgICAgIGRlc2NlbmRhbnQkMShjb21wLmVsZW1lbnQsICdzcGFuJykuZWFjaChmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgY29tcC5nZXRTeXN0ZW0oKS5nZXRCeURvbShidXR0b24pLmVhY2goZnVuY3Rpb24gKGJ1dHRvbkNvbXApIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBUb2dnbGluZy5zZXQoYnV0dG9uQ29tcCwgc3RhdGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGlzQWN0aXZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVzY2VuZGFudCQxKGNvbXAuZWxlbWVudCwgJ3NwYW4nKS5leGlzdHMoZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICAgICAgICBpZiAoY29tcC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbXAuZ2V0U3lzdGVtKCkuZ2V0QnlEb20oYnV0dG9uKS5leGlzdHMoVG9nZ2xpbmcuaXNPbik7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGVkaXRvck9mZkNlbGwgPSBDZWxsKG5vb3ApO1xuICAgICAgdmFyIHNwZWNpYWxpc2F0aW9uID0ge1xuICAgICAgICBnZXRBcGk6IGdldEFwaSxcbiAgICAgICAgb25TZXR1cDogc3BlYy5vblNldHVwXG4gICAgICB9O1xuICAgICAgcmV0dXJuIFNwbGl0RHJvcGRvd24uc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1zcGxpdC1idXR0b24nXSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBfX2Fzc2lnbih7ICdhcmlhLXByZXNzZWQnOiBmYWxzZSB9LCBnZXRUb29sdGlwQXR0cmlidXRlcyhzcGVjLnRvb2x0aXAsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMpKVxuICAgICAgICB9LFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgICBzcGVjLm9uQWN0aW9uKGdldEFwaShidXR0b24pKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25JdGVtRXhlY3V0ZTogZnVuY3Rpb24gKF9hLCBfYiwgX2MpIHtcbiAgICAgICAgfSxcbiAgICAgICAgc3BsaXREcm9wZG93bkJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLnNwbGl0QnV0dG9uKHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaXNEaXNhYmxlZCksXG4gICAgICAgICAgcmVjZWl2aW5nQ29uZmlnKCksXG4gICAgICAgICAgY29uZmlnKCdzcGxpdC1kcm9wZG93bi1ldmVudHMnLCBbXG4gICAgICAgICAgICBydW4oZm9jdXNCdXR0b25FdmVudCwgRm9jdXNpbmcuZm9jdXMpLFxuICAgICAgICAgICAgb25Db250cm9sQXR0YWNoZWQoc3BlY2lhbGlzYXRpb24sIGVkaXRvck9mZkNlbGwpLFxuICAgICAgICAgICAgb25Db250cm9sRGV0YWNoZWQoc3BlY2lhbGlzYXRpb24sIGVkaXRvck9mZkNlbGwpXG4gICAgICAgICAgXSksXG4gICAgICAgICAgVW5zZWxlY3RpbmcuY29uZmlnKHt9KVxuICAgICAgICBdKSxcbiAgICAgICAgZXZlbnRPcmRlcjogKF9kID0ge30sIF9kW2F0dGFjaGVkVG9Eb20oKV0gPSBbXG4gICAgICAgICAgJ2FsbG95LmJhc2UuYmVoYXZpb3VyJyxcbiAgICAgICAgICAnc3BsaXQtZHJvcGRvd24tZXZlbnRzJ1xuICAgICAgICBdLCBfZCksXG4gICAgICAgIHRvZ2dsZUNsYXNzOiAndG94LXRidG4tLWVuYWJsZWQnLFxuICAgICAgICBsYXp5U2luazogc2hhcmVkQmFja3N0YWdlLmdldFNpbmssXG4gICAgICAgIGZldGNoOiBmZXRjaENob2ljZXMoZ2V0QXBpLCBzcGVjLCBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzKSxcbiAgICAgICAgcGFydHM6IHsgbWVudTogcGFydChmYWxzZSwgc3BlYy5jb2x1bW5zLCBzcGVjLnByZXNldHMpIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICBTcGxpdERyb3Bkb3duLnBhcnRzLmJ1dHRvbihyZW5kZXJDb21tb25TdHJ1Y3R1cmUoc3BlYy5pY29uLCBzcGVjLnRleHQsIE9wdGlvbmFsLm5vbmUoKSwgT3B0aW9uYWwuc29tZShkaXNwbGF5Q2hhbm5lbCksIE9wdGlvbmFsLnNvbWUoW1RvZ2dsaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiAndG94LXRidG4tLWVuYWJsZWQnLFxuICAgICAgICAgICAgICB0b2dnbGVPbkV4ZWN1dGU6IGZhbHNlXG4gICAgICAgICAgICB9KV0pLCBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzKSksXG4gICAgICAgICAgU3BsaXREcm9wZG93bi5wYXJ0cy5hcnJvdyh7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgICAgICd0b3gtdGJ0bicsXG4gICAgICAgICAgICAgICAgJ3RveC1zcGxpdC1idXR0b25fX2NoZXZyb24nXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIGlubmVySHRtbDogZ2V0JGUoJ2NoZXZyb24tZG93bicsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaWNvbnMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLnNwbGl0QnV0dG9uKHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMuaXNEaXNhYmxlZCksXG4gICAgICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFNwbGl0RHJvcGRvd24ucGFydHNbJ2FyaWEtZGVzY3JpcHRvciddKHsgdGV4dDogc2hhcmVkQmFja3N0YWdlLnByb3ZpZGVycy50cmFuc2xhdGUoJ1RvIG9wZW4gdGhlIHBvcHVwLCBwcmVzcyBTaGlmdCtFbnRlcicpIH0pXG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0Rm9ybUFwaSA9IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlbWl0KGlucHV0LCBzYW5kYm94Q2xvc2UoKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFJlcHJlc2VudGluZy5nZXRWYWx1ZShpbnB1dCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcnVuT25FeGVjdXRlJDEgPSBmdW5jdGlvbiAobWVtSW5wdXQsIG9yaWdpbmFsKSB7XG4gICAgICByZXR1cm4gcnVuKGludGVybmFsVG9vbGJhckJ1dHRvbkV4ZWN1dGUsIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICB2YXIgaW5wdXQgPSBtZW1JbnB1dC5nZXQoY29tcCk7XG4gICAgICAgIHZhciBmb3JtQXBpID0gZ2V0Rm9ybUFwaShpbnB1dCk7XG4gICAgICAgIG9yaWdpbmFsLm9uQWN0aW9uKGZvcm1BcGksIHNlLmV2ZW50LmJ1dHRvbkFwaSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJDb250ZXh0QnV0dG9uID0gZnVuY3Rpb24gKG1lbUlucHV0LCBidXR0b24sIGV4dHJhcykge1xuICAgICAgdmFyIF9hID0gYnV0dG9uLm9yaWdpbmFsLCBwcmltYXJ5ID0gX2EucHJpbWFyeSwgcmVzdCA9IF9fcmVzdChfYSwgWydwcmltYXJ5J10pO1xuICAgICAgdmFyIGJyaWRnZWQgPSBnZXRPckRpZShjcmVhdGVUb29sYmFyQnV0dG9uKF9fYXNzaWduKF9fYXNzaWduKHt9LCByZXN0KSwge1xuICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgb25BY3Rpb246IG5vb3BcbiAgICAgIH0pKSk7XG4gICAgICByZXR1cm4gcmVuZGVyVG9vbGJhckJ1dHRvbldpdGgoYnJpZGdlZCwgZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLCBbcnVuT25FeGVjdXRlJDEobWVtSW5wdXQsIGJ1dHRvbildKTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJDb250ZXh0VG9nZ2xlQnV0dG9uID0gZnVuY3Rpb24gKG1lbUlucHV0LCBidXR0b24sIGV4dHJhcykge1xuICAgICAgdmFyIF9hID0gYnV0dG9uLm9yaWdpbmFsLCBwcmltYXJ5ID0gX2EucHJpbWFyeSwgcmVzdCA9IF9fcmVzdChfYSwgWydwcmltYXJ5J10pO1xuICAgICAgdmFyIGJyaWRnZWQgPSBnZXRPckRpZShjcmVhdGVUb2dnbGVCdXR0b24oX19hc3NpZ24oX19hc3NpZ24oe30sIHJlc3QpLCB7XG4gICAgICAgIHR5cGU6ICd0b2dnbGVidXR0b24nLFxuICAgICAgICBvbkFjdGlvbjogbm9vcFxuICAgICAgfSkpKTtcbiAgICAgIHJldHVybiByZW5kZXJUb29sYmFyVG9nZ2xlQnV0dG9uV2l0aChicmlkZ2VkLCBleHRyYXMuYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMsIFtydW5PbkV4ZWN1dGUkMShtZW1JbnB1dCwgYnV0dG9uKV0pO1xuICAgIH07XG4gICAgdmFyIGdlbmVyYXRlT25lJDEgPSBmdW5jdGlvbiAobWVtSW5wdXQsIGJ1dHRvbiwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgZXh0cmFzID0geyBiYWNrc3RhZ2U6IHsgc2hhcmVkOiB7IHByb3ZpZGVyczogcHJvdmlkZXJzQmFja3N0YWdlIH0gfSB9O1xuICAgICAgaWYgKGJ1dHRvbi50eXBlID09PSAnY29udGV4dGZvcm10b2dnbGVidXR0b24nKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJDb250ZXh0VG9nZ2xlQnV0dG9uKG1lbUlucHV0LCBidXR0b24sIGV4dHJhcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVuZGVyQ29udGV4dEJ1dHRvbihtZW1JbnB1dCwgYnV0dG9uLCBleHRyYXMpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGdlbmVyYXRlJDcgPSBmdW5jdGlvbiAobWVtSW5wdXQsIGJ1dHRvbnMsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgdmFyIG1lbWVudG9zID0gbWFwKGJ1dHRvbnMsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgcmV0dXJuIHJlY29yZChnZW5lcmF0ZU9uZSQxKG1lbUlucHV0LCBidXR0b24sIHByb3ZpZGVyc0JhY2tzdGFnZSkpO1xuICAgICAgfSk7XG4gICAgICB2YXIgYXNTcGVjcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG1hcChtZW1lbnRvcywgZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgIHJldHVybiBtZW0uYXNTcGVjKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBmaW5kUHJpbWFyeSA9IGZ1bmN0aW9uIChjb21wSW5TeXN0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGZpbmRNYXAoYnV0dG9ucywgZnVuY3Rpb24gKGJ1dHRvbiwgaSkge1xuICAgICAgICAgIGlmIChidXR0b24ucHJpbWFyeSkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20obWVtZW50b3NbaV0pLmJpbmQoZnVuY3Rpb24gKG1lbSkge1xuICAgICAgICAgICAgICByZXR1cm4gbWVtLmdldE9wdChjb21wSW5TeXN0ZW0pO1xuICAgICAgICAgICAgfSkuZmlsdGVyKG5vdChEaXNhYmxpbmcuaXNEaXNhYmxlZCkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXNTcGVjczogYXNTcGVjcyxcbiAgICAgICAgZmluZFByaW1hcnk6IGZpbmRQcmltYXJ5XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgYnVpbGRJbml0R3JvdXBzID0gZnVuY3Rpb24gKGN0eCwgcHJvdmlkZXJzKSB7XG4gICAgICB2YXIgaW5wdXRBdHRyaWJ1dGVzID0gY3R4LmxhYmVsLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9LCBmdW5jdGlvbiAobGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHsgJ2FyaWEtbGFiZWwnOiBsYWJlbCB9O1xuICAgICAgfSk7XG4gICAgICB2YXIgbWVtSW5wdXQgPSByZWNvcmQoSW5wdXQuc2tldGNoKHtcbiAgICAgICAgaW5wdXRDbGFzc2VzOiBbXG4gICAgICAgICAgJ3RveC10b29sYmFyLXRleHRmaWVsZCcsXG4gICAgICAgICAgJ3RveC10b29sYmFyLW5hdi1qcydcbiAgICAgICAgXSxcbiAgICAgICAgZGF0YTogY3R4LmluaXRWYWx1ZSgpLFxuICAgICAgICBpbnB1dEF0dHJpYnV0ZXM6IGlucHV0QXR0cmlidXRlcyxcbiAgICAgICAgc2VsZWN0T25Gb2N1czogdHJ1ZSxcbiAgICAgICAgaW5wdXRCZWhhdmlvdXJzOiBkZXJpdmUkMShbS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnc3BlY2lhbCcsXG4gICAgICAgICAgICBvbkVudGVyOiBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbW1hbmRzLmZpbmRQcmltYXJ5KGlucHV0KS5tYXAoZnVuY3Rpb24gKHByaW1hcnkpIHtcbiAgICAgICAgICAgICAgICBlbWl0RXhlY3V0ZShwcmltYXJ5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25MZWZ0OiBmdW5jdGlvbiAoY29tcCwgc2UpIHtcbiAgICAgICAgICAgICAgc2UuY3V0KCk7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25SaWdodDogZnVuY3Rpb24gKGNvbXAsIHNlKSB7XG4gICAgICAgICAgICAgIHNlLmN1dCgpO1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXSlcbiAgICAgIH0pKTtcbiAgICAgIHZhciBjb21tYW5kcyA9IGdlbmVyYXRlJDcobWVtSW5wdXQsIGN0eC5jb21tYW5kcywgcHJvdmlkZXJzKTtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgIGl0ZW1zOiBbbWVtSW5wdXQuYXNTcGVjKCldXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgIGl0ZW1zOiBjb21tYW5kcy5hc1NwZWNzKClcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJDb250ZXh0Rm9ybSA9IGZ1bmN0aW9uICh0b29sYmFyVHlwZSwgY3R4LCBwcm92aWRlcnMpIHtcbiAgICAgIHJldHVybiByZW5kZXJUb29sYmFyKHtcbiAgICAgICAgdHlwZTogdG9vbGJhclR5cGUsXG4gICAgICAgIHVpZDogZ2VuZXJhdGUkMSgnY29udGV4dC10b29sYmFyJyksXG4gICAgICAgIGluaXRHcm91cHM6IGJ1aWxkSW5pdEdyb3VwcyhjdHgsIHByb3ZpZGVycyksXG4gICAgICAgIG9uRXNjYXBlOiBPcHRpb25hbC5ub25lLFxuICAgICAgICBjeWNsaWNLZXlpbmc6IHRydWUsXG4gICAgICAgIHByb3ZpZGVyczogcHJvdmlkZXJzXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBDb250ZXh0Rm9ybSA9IHtcbiAgICAgIHJlbmRlckNvbnRleHRGb3JtOiByZW5kZXJDb250ZXh0Rm9ybSxcbiAgICAgIGJ1aWxkSW5pdEdyb3VwczogYnVpbGRJbml0R3JvdXBzXG4gICAgfTtcblxuICAgIHZhciBnZXRIb3Jpem9udGFsQm91bmRzID0gZnVuY3Rpb24gKGNvbnRlbnRBcmVhQm94LCB2aWV3cG9ydEJvdW5kcykge1xuICAgICAgdmFyIHggPSBNYXRoLm1heCh2aWV3cG9ydEJvdW5kcy54LCBjb250ZW50QXJlYUJveC54KTtcbiAgICAgIHZhciBjb250ZW50Qm94V2lkdGggPSBjb250ZW50QXJlYUJveC5yaWdodCAtIHg7XG4gICAgICB2YXIgbWF4Vmlld3BvcnRXaWR0aCA9IHZpZXdwb3J0Qm91bmRzLndpZHRoIC0gKHggLSB2aWV3cG9ydEJvdW5kcy54KTtcbiAgICAgIHZhciB3aWR0aCA9IE1hdGgubWluKGNvbnRlbnRCb3hXaWR0aCwgbWF4Vmlld3BvcnRXaWR0aCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB4LFxuICAgICAgICB3aWR0aDogd2lkdGhcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0VmVydGljYWxCb3VuZHMgPSBmdW5jdGlvbiAoZWRpdG9yLCBjb250ZW50QXJlYUJveCwgdmlld3BvcnRCb3VuZHMsIGlzVG9vbGJhckxvY2F0aW9uVG9wKSB7XG4gICAgICB2YXIgY29udGFpbmVyID0gU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldENvbnRhaW5lcigpKTtcbiAgICAgIHZhciBoZWFkZXIgPSBkZXNjZW5kYW50JDEoY29udGFpbmVyLCAnLnRveC1lZGl0b3ItaGVhZGVyJykuZ2V0T3IoY29udGFpbmVyKTtcbiAgICAgIHZhciBoZWFkZXJCb3ggPSBib3goaGVhZGVyKTtcbiAgICAgIHZhciBpc1Rvb2xiYXJCZWxvd0NvbnRlbnRBcmVhID0gaGVhZGVyQm94LnkgPj0gY29udGVudEFyZWFCb3guYm90dG9tO1xuICAgICAgdmFyIGlzVG9vbGJhckFib3ZlID0gaXNUb29sYmFyTG9jYXRpb25Ub3AgJiYgIWlzVG9vbGJhckJlbG93Q29udGVudEFyZWE7XG4gICAgICBpZiAoZWRpdG9yLmlubGluZSAmJiBpc1Rvb2xiYXJBYm92ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHk6IE1hdGgubWF4KGhlYWRlckJveC5ib3R0b20sIHZpZXdwb3J0Qm91bmRzLnkpLFxuICAgICAgICAgIGJvdHRvbTogdmlld3BvcnRCb3VuZHMuYm90dG9tXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoZWRpdG9yLmlubGluZSAmJiAhaXNUb29sYmFyQWJvdmUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB5OiB2aWV3cG9ydEJvdW5kcy55LFxuICAgICAgICAgIGJvdHRvbTogTWF0aC5taW4oaGVhZGVyQm94LnksIHZpZXdwb3J0Qm91bmRzLmJvdHRvbSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHZhciBjb250YWluZXJCb3VuZHMgPSBib3goY29udGFpbmVyKTtcbiAgICAgIGlmIChpc1Rvb2xiYXJBYm92ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHk6IE1hdGgubWF4KGhlYWRlckJveC5ib3R0b20sIHZpZXdwb3J0Qm91bmRzLnkpLFxuICAgICAgICAgIGJvdHRvbTogTWF0aC5taW4oY29udGFpbmVyQm91bmRzLmJvdHRvbSwgdmlld3BvcnRCb3VuZHMuYm90dG9tKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeTogTWF0aC5tYXgoY29udGFpbmVyQm91bmRzLnksIHZpZXdwb3J0Qm91bmRzLnkpLFxuICAgICAgICBib3R0b206IE1hdGgubWluKGhlYWRlckJveC55LCB2aWV3cG9ydEJvdW5kcy5ib3R0b20pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldENvbnRleHRUb29sYmFyQm91bmRzID0gZnVuY3Rpb24gKGVkaXRvciwgc2hhcmVkQmFja3N0YWdlKSB7XG4gICAgICB2YXIgdmlld3BvcnRCb3VuZHMgPSBnZXRCb3VuZHMod2luZG93KTtcbiAgICAgIHZhciBjb250ZW50QXJlYUJveCA9IGJveChTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0Q29udGVudEFyZWFDb250YWluZXIoKSkpO1xuICAgICAgdmFyIHRvb2xiYXJPck1lbnViYXJFbmFibGVkID0gaXNNZW51YmFyRW5hYmxlZChlZGl0b3IpIHx8IGlzVG9vbGJhckVuYWJsZWQoZWRpdG9yKSB8fCBpc011bHRpcGxlVG9vbGJhcnMoZWRpdG9yKTtcbiAgICAgIHZhciBfYSA9IGdldEhvcml6b250YWxCb3VuZHMoY29udGVudEFyZWFCb3gsIHZpZXdwb3J0Qm91bmRzKSwgeCA9IF9hLngsIHdpZHRoID0gX2Eud2lkdGg7XG4gICAgICBpZiAoZWRpdG9yLmlubGluZSAmJiAhdG9vbGJhck9yTWVudWJhckVuYWJsZWQpIHtcbiAgICAgICAgcmV0dXJuIGJvdW5kcyQxKHgsIHZpZXdwb3J0Qm91bmRzLnksIHdpZHRoLCB2aWV3cG9ydEJvdW5kcy5oZWlnaHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGlzVG9vbGJhclRvcCA9IHNoYXJlZEJhY2tzdGFnZS5oZWFkZXIuaXNQb3NpdGlvbmVkQXRUb3AoKTtcbiAgICAgICAgdmFyIF9iID0gZ2V0VmVydGljYWxCb3VuZHMoZWRpdG9yLCBjb250ZW50QXJlYUJveCwgdmlld3BvcnRCb3VuZHMsIGlzVG9vbGJhclRvcCksIHkgPSBfYi55LCBib3R0b20gPSBfYi5ib3R0b207XG4gICAgICAgIHJldHVybiBib3VuZHMkMSh4LCB5LCB3aWR0aCwgYm90dG9tIC0geSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBtYXRjaFRhcmdldFdpdGggPSBmdW5jdGlvbiAoZWxlbSwgY2FuZGlkYXRlcykge1xuICAgICAgdmFyIGN0eHMgPSBmaWx0ZXIoY2FuZGlkYXRlcywgZnVuY3Rpb24gKHRvb2xiYXJBcGkpIHtcbiAgICAgICAgcmV0dXJuIHRvb2xiYXJBcGkucHJlZGljYXRlKGVsZW0uZG9tKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIF9hID0gcGFydGl0aW9uKGN0eHMsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgcmV0dXJuIHQudHlwZSA9PT0gJ2NvbnRleHR0b29sYmFyJztcbiAgICAgICAgfSksIHBhc3MgPSBfYS5wYXNzLCBmYWlsID0gX2EuZmFpbDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRleHRUb29sYmFyczogcGFzcyxcbiAgICAgICAgY29udGV4dEZvcm1zOiBmYWlsXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGZpbHRlckJ5UG9zaXRpb25Gb3JTdGFydE5vZGUgPSBmdW5jdGlvbiAodG9vbGJhcnMpIHtcbiAgICAgIGlmICh0b29sYmFycy5sZW5ndGggPD0gMSkge1xuICAgICAgICByZXR1cm4gdG9vbGJhcnM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZG9lc1Bvc2l0aW9uRXhpc3QgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gZXhpc3RzKHRvb2xiYXJzLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHQucG9zaXRpb24gPT09IHZhbHVlO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgZmlsdGVyVG9vbGJhcnNCeVBvc2l0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIGZpbHRlcih0b29sYmFycywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0LnBvc2l0aW9uID09PSB2YWx1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGhhc1NlbGVjdGlvblRvb2xiYXJzID0gZG9lc1Bvc2l0aW9uRXhpc3QoJ3NlbGVjdGlvbicpO1xuICAgICAgICB2YXIgaGFzTm9kZVRvb2xiYXJzID0gZG9lc1Bvc2l0aW9uRXhpc3QoJ25vZGUnKTtcbiAgICAgICAgaWYgKGhhc1NlbGVjdGlvblRvb2xiYXJzIHx8IGhhc05vZGVUb29sYmFycykge1xuICAgICAgICAgIGlmIChoYXNOb2RlVG9vbGJhcnMgJiYgaGFzU2VsZWN0aW9uVG9vbGJhcnMpIHtcbiAgICAgICAgICAgIHZhciBub2RlVG9vbGJhcnMgPSBmaWx0ZXJUb29sYmFyc0J5UG9zaXRpb24oJ25vZGUnKTtcbiAgICAgICAgICAgIHZhciBzZWxlY3Rpb25Ub29sYmFycyA9IG1hcChmaWx0ZXJUb29sYmFyc0J5UG9zaXRpb24oJ3NlbGVjdGlvbicpLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIHQpLCB7IHBvc2l0aW9uOiAnbm9kZScgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBub2RlVG9vbGJhcnMuY29uY2F0KHNlbGVjdGlvblRvb2xiYXJzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGhhc1NlbGVjdGlvblRvb2xiYXJzID8gZmlsdGVyVG9vbGJhcnNCeVBvc2l0aW9uKCdzZWxlY3Rpb24nKSA6IGZpbHRlclRvb2xiYXJzQnlQb3NpdGlvbignbm9kZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmlsdGVyVG9vbGJhcnNCeVBvc2l0aW9uKCdsaW5lJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBmaWx0ZXJCeVBvc2l0aW9uRm9yQW5jZXN0b3JOb2RlID0gZnVuY3Rpb24gKHRvb2xiYXJzKSB7XG4gICAgICBpZiAodG9vbGJhcnMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgcmV0dXJuIHRvb2xiYXJzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGZpbmRQb3NpdGlvbl8xID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIGZpbmQodG9vbGJhcnMsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdC5wb3NpdGlvbiA9PT0gdmFsdWU7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBiYXNlUG9zaXRpb24gPSBmaW5kUG9zaXRpb25fMSgnc2VsZWN0aW9uJykub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGZpbmRQb3NpdGlvbl8xKCdub2RlJyk7XG4gICAgICAgIH0pLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBmaW5kUG9zaXRpb25fMSgnbGluZScpO1xuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICByZXR1cm4gdC5wb3NpdGlvbjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBiYXNlUG9zaXRpb24uZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9LCBmdW5jdGlvbiAocG9zKSB7XG4gICAgICAgICAgcmV0dXJuIGZpbHRlcih0b29sYmFycywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0LnBvc2l0aW9uID09PSBwb3M7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG1hdGNoU3RhcnROb2RlID0gZnVuY3Rpb24gKGVsZW0sIG5vZGVDYW5kaWRhdGVzLCBlZGl0b3JDYW5kaWRhdGVzKSB7XG4gICAgICB2YXIgbm9kZU1hdGNoZXMgPSBtYXRjaFRhcmdldFdpdGgoZWxlbSwgbm9kZUNhbmRpZGF0ZXMpO1xuICAgICAgaWYgKG5vZGVNYXRjaGVzLmNvbnRleHRGb3Jtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBlbGVtOiBlbGVtLFxuICAgICAgICAgIHRvb2xiYXJzOiBbbm9kZU1hdGNoZXMuY29udGV4dEZvcm1zWzBdXVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBlZGl0b3JNYXRjaGVzID0gbWF0Y2hUYXJnZXRXaXRoKGVsZW0sIGVkaXRvckNhbmRpZGF0ZXMpO1xuICAgICAgICBpZiAoZWRpdG9yTWF0Y2hlcy5jb250ZXh0Rm9ybXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIGVsZW06IGVsZW0sXG4gICAgICAgICAgICB0b29sYmFyczogW2VkaXRvck1hdGNoZXMuY29udGV4dEZvcm1zWzBdXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKG5vZGVNYXRjaGVzLmNvbnRleHRUb29sYmFycy5sZW5ndGggPiAwIHx8IGVkaXRvck1hdGNoZXMuY29udGV4dFRvb2xiYXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgdG9vbGJhcnMgPSBmaWx0ZXJCeVBvc2l0aW9uRm9yU3RhcnROb2RlKG5vZGVNYXRjaGVzLmNvbnRleHRUb29sYmFycy5jb25jYXQoZWRpdG9yTWF0Y2hlcy5jb250ZXh0VG9vbGJhcnMpKTtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgICBlbGVtOiBlbGVtLFxuICAgICAgICAgICAgdG9vbGJhcnM6IHRvb2xiYXJzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG1hdGNoQW5jZXN0b3IgPSBmdW5jdGlvbiAoaXNSb290LCBzdGFydE5vZGUsIHNjb3Blcykge1xuICAgICAgaWYgKGlzUm9vdChzdGFydE5vZGUpKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYW5jZXN0b3Ioc3RhcnROb2RlLCBmdW5jdGlvbiAoYW5jZXN0b3JFbGVtKSB7XG4gICAgICAgICAgdmFyIF9hID0gbWF0Y2hUYXJnZXRXaXRoKGFuY2VzdG9yRWxlbSwgc2NvcGVzLmluTm9kZVNjb3BlKSwgY29udGV4dFRvb2xiYXJzID0gX2EuY29udGV4dFRvb2xiYXJzLCBjb250ZXh0Rm9ybXMgPSBfYS5jb250ZXh0Rm9ybXM7XG4gICAgICAgICAgdmFyIHRvb2xiYXJzID0gY29udGV4dEZvcm1zLmxlbmd0aCA+IDAgPyBjb250ZXh0Rm9ybXMgOiBmaWx0ZXJCeVBvc2l0aW9uRm9yQW5jZXN0b3JOb2RlKGNvbnRleHRUb29sYmFycyk7XG4gICAgICAgICAgcmV0dXJuIHRvb2xiYXJzLmxlbmd0aCA+IDAgPyBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIGVsZW06IGFuY2VzdG9yRWxlbSxcbiAgICAgICAgICAgIHRvb2xiYXJzOiB0b29sYmFyc1xuICAgICAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9LCBpc1Jvb3QpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGxvb2t1cCQxID0gZnVuY3Rpb24gKHNjb3BlcywgZWRpdG9yKSB7XG4gICAgICB2YXIgcm9vdEVsZW0gPSBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0Qm9keSgpKTtcbiAgICAgIHZhciBpc1Jvb3QgPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gZXEkMShlbGVtLCByb290RWxlbSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzT3V0c2lkZVJvb3QgPSBmdW5jdGlvbiAoc3RhcnROb2RlKSB7XG4gICAgICAgIHJldHVybiAhaXNSb290KHN0YXJ0Tm9kZSkgJiYgIWNvbnRhaW5zJDIocm9vdEVsZW0sIHN0YXJ0Tm9kZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHN0YXJ0Tm9kZSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpKTtcbiAgICAgIGlmIChpc091dHNpZGVSb290KHN0YXJ0Tm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtYXRjaFN0YXJ0Tm9kZShzdGFydE5vZGUsIHNjb3Blcy5pbk5vZGVTY29wZSwgc2NvcGVzLmluRWRpdG9yU2NvcGUpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hBbmNlc3Rvcihpc1Jvb3QsIHN0YXJ0Tm9kZSwgc2NvcGVzKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgY2F0ZWdvcmlzZSA9IGZ1bmN0aW9uIChjb250ZXh0VG9vbGJhcnMsIG5hdmlnYXRlKSB7XG4gICAgICB2YXIgZm9ybXMgPSB7fTtcbiAgICAgIHZhciBpbk5vZGVTY29wZSA9IFtdO1xuICAgICAgdmFyIGluRWRpdG9yU2NvcGUgPSBbXTtcbiAgICAgIHZhciBmb3JtTmF2aWdhdG9ycyA9IHt9O1xuICAgICAgdmFyIGxvb2t1cFRhYmxlID0ge307XG4gICAgICB2YXIgcmVnaXN0ZXJGb3JtID0gZnVuY3Rpb24gKGtleSwgdG9vbGJhclNwZWMpIHtcbiAgICAgICAgdmFyIGNvbnRleHRGb3JtID0gZ2V0T3JEaWUoY3JlYXRlQ29udGV4dEZvcm0odG9vbGJhclNwZWMpKTtcbiAgICAgICAgZm9ybXNba2V5XSA9IGNvbnRleHRGb3JtO1xuICAgICAgICBjb250ZXh0Rm9ybS5sYXVuY2gubWFwKGZ1bmN0aW9uIChsYXVuY2gpIHtcbiAgICAgICAgICBmb3JtTmF2aWdhdG9yc1snZm9ybTonICsga2V5ICsgJyddID0gX19hc3NpZ24oX19hc3NpZ24oe30sIHRvb2xiYXJTcGVjLmxhdW5jaCksIHtcbiAgICAgICAgICAgIHR5cGU6IGxhdW5jaC50eXBlID09PSAnY29udGV4dGZvcm10b2dnbGVidXR0b24nID8gJ3RvZ2dsZWJ1dHRvbicgOiAnYnV0dG9uJyxcbiAgICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIG5hdmlnYXRlKGNvbnRleHRGb3JtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChjb250ZXh0Rm9ybS5zY29wZSA9PT0gJ2VkaXRvcicpIHtcbiAgICAgICAgICBpbkVkaXRvclNjb3BlLnB1c2goY29udGV4dEZvcm0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGluTm9kZVNjb3BlLnB1c2goY29udGV4dEZvcm0pO1xuICAgICAgICB9XG4gICAgICAgIGxvb2t1cFRhYmxlW2tleV0gPSBjb250ZXh0Rm9ybTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVnaXN0ZXJUb29sYmFyID0gZnVuY3Rpb24gKGtleSwgdG9vbGJhclNwZWMpIHtcbiAgICAgICAgY3JlYXRlQ29udGV4dFRvb2xiYXIodG9vbGJhclNwZWMpLmVhY2goZnVuY3Rpb24gKGNvbnRleHRUb29sYmFyKSB7XG4gICAgICAgICAgaWYgKHRvb2xiYXJTcGVjLnNjb3BlID09PSAnZWRpdG9yJykge1xuICAgICAgICAgICAgaW5FZGl0b3JTY29wZS5wdXNoKGNvbnRleHRUb29sYmFyKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5Ob2RlU2NvcGUucHVzaChjb250ZXh0VG9vbGJhcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvb2t1cFRhYmxlW2tleV0gPSBjb250ZXh0VG9vbGJhcjtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGtleXMkMSA9IGtleXMoY29udGV4dFRvb2xiYXJzKTtcbiAgICAgIGVhY2goa2V5cyQxLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHZhciB0b29sYmFyQXBpID0gY29udGV4dFRvb2xiYXJzW2tleV07XG4gICAgICAgIGlmICh0b29sYmFyQXBpLnR5cGUgPT09ICdjb250ZXh0Zm9ybScpIHtcbiAgICAgICAgICByZWdpc3RlckZvcm0oa2V5LCB0b29sYmFyQXBpKTtcbiAgICAgICAgfSBlbHNlIGlmICh0b29sYmFyQXBpLnR5cGUgPT09ICdjb250ZXh0dG9vbGJhcicpIHtcbiAgICAgICAgICByZWdpc3RlclRvb2xiYXIoa2V5LCB0b29sYmFyQXBpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmb3JtczogZm9ybXMsXG4gICAgICAgIGluTm9kZVNjb3BlOiBpbk5vZGVTY29wZSxcbiAgICAgICAgaW5FZGl0b3JTY29wZTogaW5FZGl0b3JTY29wZSxcbiAgICAgICAgbG9va3VwVGFibGU6IGxvb2t1cFRhYmxlLFxuICAgICAgICBmb3JtTmF2aWdhdG9yczogZm9ybU5hdmlnYXRvcnNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBmb3J3YXJkU2xpZGVFdmVudCA9IGdlbmVyYXRlJDEoJ2ZvcndhcmQtc2xpZGUnKTtcbiAgICB2YXIgYmFja1NsaWRlRXZlbnQgPSBnZW5lcmF0ZSQxKCdiYWNrd2FyZC1zbGlkZScpO1xuICAgIHZhciBjaGFuZ2VTbGlkZUV2ZW50ID0gZ2VuZXJhdGUkMSgnY2hhbmdlLXNsaWRlLWV2ZW50Jyk7XG4gICAgdmFyIHJlc2l6aW5nQ2xhc3MgPSAndG94LXBvcC0tcmVzaXppbmcnO1xuICAgIHZhciByZW5kZXJDb250ZXh0VG9vbGJhciA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICB2YXIgc3RhY2sgPSBDZWxsKFtdKTtcbiAgICAgIHJldHVybiBJbmxpbmVWaWV3LnNrZXRjaCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtcG9wJ11cbiAgICAgICAgfSxcbiAgICAgICAgZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZDogeyBldmVudDogJ2RvTm90RGlzbWlzc1lldCcgfSxcbiAgICAgICAgb25TaG93OiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHN0YWNrLnNldChbXSk7XG4gICAgICAgICAgSW5saW5lVmlldy5nZXRDb250ZW50KGNvbXApLmVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJlbW92ZSQ2KGMuZWxlbWVudCwgJ3Zpc2liaWxpdHknKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZW1vdmUkNChjb21wLmVsZW1lbnQsIHJlc2l6aW5nQ2xhc3MpO1xuICAgICAgICAgIHJlbW92ZSQ2KGNvbXAuZWxlbWVudCwgJ3dpZHRoJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGlubGluZUJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBjb25maWcoJ2NvbnRleHQtdG9vbGJhci1ldmVudHMnLCBbXG4gICAgICAgICAgICBydW5PblNvdXJjZSh0cmFuc2l0aW9uZW5kKCksIGZ1bmN0aW9uIChjb21wLCBfc2UpIHtcbiAgICAgICAgICAgICAgcmVtb3ZlJDQoY29tcC5lbGVtZW50LCByZXNpemluZ0NsYXNzKTtcbiAgICAgICAgICAgICAgcmVtb3ZlJDYoY29tcC5lbGVtZW50LCAnd2lkdGgnKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcnVuKGNoYW5nZVNsaWRlRXZlbnQsIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICAgICAgICB2YXIgZWxlbSA9IGNvbXAuZWxlbWVudDtcbiAgICAgICAgICAgICAgcmVtb3ZlJDYoZWxlbSwgJ3dpZHRoJyk7XG4gICAgICAgICAgICAgIHZhciBjdXJyZW50V2lkdGggPSBnZXQkOChlbGVtKTtcbiAgICAgICAgICAgICAgSW5saW5lVmlldy5zZXRDb250ZW50KGNvbXAsIHNlLmV2ZW50LmNvbnRlbnRzKTtcbiAgICAgICAgICAgICAgYWRkJDIoZWxlbSwgcmVzaXppbmdDbGFzcyk7XG4gICAgICAgICAgICAgIHZhciBuZXdXaWR0aCA9IGdldCQ4KGVsZW0pO1xuICAgICAgICAgICAgICBzZXQkMihlbGVtLCAnd2lkdGgnLCBjdXJyZW50V2lkdGggKyAncHgnKTtcbiAgICAgICAgICAgICAgSW5saW5lVmlldy5nZXRDb250ZW50KGNvbXApLmVhY2goZnVuY3Rpb24gKG5ld0NvbnRlbnRzKSB7XG4gICAgICAgICAgICAgICAgc2UuZXZlbnQuZm9jdXMuYmluZChmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgICAgZm9jdXMkMShmKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBzZWFyY2goZWxlbSk7XG4gICAgICAgICAgICAgICAgfSkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICBLZXlpbmcuZm9jdXNJbihuZXdDb250ZW50cyk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aXZlKGdldFJvb3ROb2RlKGVsZW0pKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGdsb2JhbCQyLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNldCQyKGNvbXAuZWxlbWVudCwgJ3dpZHRoJywgbmV3V2lkdGggKyAncHgnKTtcbiAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ1bihmb3J3YXJkU2xpZGVFdmVudCwgZnVuY3Rpb24gKGNvbXAsIHNlKSB7XG4gICAgICAgICAgICAgIElubGluZVZpZXcuZ2V0Q29udGVudChjb21wKS5lYWNoKGZ1bmN0aW9uIChvbGRDb250ZW50cykge1xuICAgICAgICAgICAgICAgIHN0YWNrLnNldChzdGFjay5nZXQoKS5jb25jYXQoW3tcbiAgICAgICAgICAgICAgICAgICAgYmFyOiBvbGRDb250ZW50cyxcbiAgICAgICAgICAgICAgICAgICAgZm9jdXM6IGFjdGl2ZShnZXRSb290Tm9kZShjb21wLmVsZW1lbnQpKVxuICAgICAgICAgICAgICAgICAgfV0pKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIGNoYW5nZVNsaWRlRXZlbnQsIHtcbiAgICAgICAgICAgICAgICBjb250ZW50czogc2UuZXZlbnQuZm9yd2FyZENvbnRlbnRzLFxuICAgICAgICAgICAgICAgIGZvY3VzOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ1bihiYWNrU2xpZGVFdmVudCwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBsYXN0KHN0YWNrLmdldCgpKS5lYWNoKGZ1bmN0aW9uIChsYXN0KSB7XG4gICAgICAgICAgICAgICAgc3RhY2suc2V0KHN0YWNrLmdldCgpLnNsaWNlKDAsIHN0YWNrLmdldCgpLmxlbmd0aCAtIDEpKTtcbiAgICAgICAgICAgICAgICBlbWl0V2l0aChjb21wLCBjaGFuZ2VTbGlkZUV2ZW50LCB7XG4gICAgICAgICAgICAgICAgICBjb250ZW50czogcHJlbWFkZSQxKGxhc3QuYmFyKSxcbiAgICAgICAgICAgICAgICAgIGZvY3VzOiBsYXN0LmZvY3VzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdzcGVjaWFsJyxcbiAgICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICByZXR1cm4gbGFzdChzdGFjay5nZXQoKSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNwZWMub25Fc2NhcGUoKTtcbiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKF8pIHtcbiAgICAgICAgICAgICAgICBlbWl0KGNvbXAsIGJhY2tTbGlkZUV2ZW50KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgXSksXG4gICAgICAgIGxhenlTaW5rOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFJlc3VsdC52YWx1ZShzcGVjLnNpbmspO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGdlbmVyYXRlU2VsZWN0SXRlbXMgPSBmdW5jdGlvbiAoX2VkaXRvciwgYmFja3N0YWdlLCBzcGVjKSB7XG4gICAgICB2YXIgZ2VuZXJhdGVJdGVtID0gZnVuY3Rpb24gKHJhd0l0ZW0sIHJlc3BvbnNlLCBkaXNhYmxlZCwgdmFsdWUpIHtcbiAgICAgICAgdmFyIHRyYW5zbGF0ZWRUZXh0ID0gYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMudHJhbnNsYXRlKHJhd0l0ZW0udGl0bGUpO1xuICAgICAgICBpZiAocmF3SXRlbS50eXBlID09PSAnc2VwYXJhdG9yJykge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIHR5cGU6ICdzZXBhcmF0b3InLFxuICAgICAgICAgICAgdGV4dDogdHJhbnNsYXRlZFRleHRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChyYXdJdGVtLnR5cGUgPT09ICdzdWJtZW51Jykge1xuICAgICAgICAgIHZhciBpdGVtcyA9IGJpbmQocmF3SXRlbS5nZXRTdHlsZUl0ZW1zKCksIGZ1bmN0aW9uIChzaSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRlKHNpLCByZXNwb25zZSwgdmFsdWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gMCAmJiBpdGVtcy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgICB0eXBlOiAnbmVzdGVkbWVudWl0ZW0nLFxuICAgICAgICAgICAgICB0ZXh0OiB0cmFuc2xhdGVkVGV4dCxcbiAgICAgICAgICAgICAgZGlzYWJsZWQ6IGl0ZW1zLmxlbmd0aCA8PSAwLFxuICAgICAgICAgICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYmluZChyYXdJdGVtLmdldFN0eWxlSXRlbXMoKSwgZnVuY3Rpb24gKHNpKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGUoc2ksIHJlc3BvbnNlLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShfX2Fzc2lnbih7XG4gICAgICAgICAgICB0eXBlOiAndG9nZ2xlbWVudWl0ZW0nLFxuICAgICAgICAgICAgdGV4dDogdHJhbnNsYXRlZFRleHQsXG4gICAgICAgICAgICBpY29uOiByYXdJdGVtLmljb24sXG4gICAgICAgICAgICBhY3RpdmU6IHJhd0l0ZW0uaXNTZWxlY3RlZCh2YWx1ZSksXG4gICAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgICAgICBvbkFjdGlvbjogc3BlYy5vbkFjdGlvbihyYXdJdGVtKVxuICAgICAgICAgIH0sIHJhd0l0ZW0uZ2V0U3R5bGVQcmV2aWV3KCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKHByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiB7IG1ldGE6IHsgc3R5bGU6IHByZXZpZXcgfSB9O1xuICAgICAgICAgIH0pKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgdmFsaWRhdGUgPSBmdW5jdGlvbiAoaXRlbSwgcmVzcG9uc2UsIHZhbHVlKSB7XG4gICAgICAgIHZhciBpbnZhbGlkID0gaXRlbS50eXBlID09PSAnZm9ybWF0dGVyJyAmJiBzcGVjLmlzSW52YWxpZChpdGVtKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGludmFsaWQgPyBbXSA6IGdlbmVyYXRlSXRlbShpdGVtLCByZXNwb25zZSwgZmFsc2UsIHZhbHVlKS50b0FycmF5KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGdlbmVyYXRlSXRlbShpdGVtLCByZXNwb25zZSwgaW52YWxpZCwgdmFsdWUpLnRvQXJyYXkoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciB2YWxpZGF0ZUl0ZW1zID0gZnVuY3Rpb24gKHByZUl0ZW1zKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHNwZWMuZ2V0Q3VycmVudFZhbHVlKCk7XG4gICAgICAgIHZhciByZXNwb25zZSA9IHNwZWMuc2hvdWxkSGlkZSA/IDAgOiAxO1xuICAgICAgICByZXR1cm4gYmluZChwcmVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gdmFsaWRhdGUoaXRlbSwgcmVzcG9uc2UsIHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldEZldGNoID0gZnVuY3Rpb24gKGJhY2tzdGFnZSwgZ2V0U3R5bGVJdGVtcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNvbXAsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyIHByZUl0ZW1zID0gZ2V0U3R5bGVJdGVtcygpO1xuICAgICAgICAgIHZhciBpdGVtcyA9IHZhbGlkYXRlSXRlbXMocHJlSXRlbXMpO1xuICAgICAgICAgIHZhciBtZW51ID0gYnVpbGQkMihpdGVtcywgSXRlbVJlc3BvbnNlJDEuQ0xPU0VfT05fRVhFQ1VURSwgYmFja3N0YWdlLCBmYWxzZSk7XG4gICAgICAgICAgY2FsbGJhY2sobWVudSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWRhdGVJdGVtczogdmFsaWRhdGVJdGVtcyxcbiAgICAgICAgZ2V0RmV0Y2g6IGdldEZldGNoXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZU1lbnVJdGVtcyA9IGZ1bmN0aW9uIChlZGl0b3IsIGJhY2tzdGFnZSwgc3BlYykge1xuICAgICAgdmFyIGRhdGFzZXQgPSBzcGVjLmRhdGFzZXQ7XG4gICAgICB2YXIgZ2V0U3R5bGVJdGVtcyA9IGRhdGFzZXQudHlwZSA9PT0gJ2Jhc2ljJyA/IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG1hcChkYXRhc2V0LmRhdGEsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIHByb2Nlc3NCYXNpYyhkLCBzcGVjLmlzU2VsZWN0ZWRGb3IsIHNwZWMuZ2V0UHJldmlld0Zvcik7XG4gICAgICAgIH0pO1xuICAgICAgfSA6IGRhdGFzZXQuZ2V0RGF0YTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGl0ZW1zOiBnZW5lcmF0ZVNlbGVjdEl0ZW1zKGVkaXRvciwgYmFja3N0YWdlLCBzcGVjKSxcbiAgICAgICAgZ2V0U3R5bGVJdGVtczogZ2V0U3R5bGVJdGVtc1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVTZWxlY3RCdXR0b24gPSBmdW5jdGlvbiAoZWRpdG9yLCBiYWNrc3RhZ2UsIHNwZWMpIHtcbiAgICAgIHZhciBfYSA9IGNyZWF0ZU1lbnVJdGVtcyhlZGl0b3IsIGJhY2tzdGFnZSwgc3BlYyksIGl0ZW1zID0gX2EuaXRlbXMsIGdldFN0eWxlSXRlbXMgPSBfYS5nZXRTdHlsZUl0ZW1zO1xuICAgICAgdmFyIGdldEFwaSA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIHJldHVybiB7IGdldENvbXBvbmVudDogY29uc3RhbnQoY29tcCkgfTtcbiAgICAgIH07XG4gICAgICB2YXIgb25TZXR1cCA9IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgdmFyIHVwZGF0ZVRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGNvbXAgPSBhcGkuZ2V0Q29tcG9uZW50KCk7XG4gICAgICAgICAgaWYgKGNvbXAuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgICAgc3BlYy51cGRhdGVUZXh0KGNvbXApO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdXBkYXRlVGV4dCgpO1xuICAgICAgICBlZGl0b3Iub24oJ05vZGVDaGFuZ2UnLCB1cGRhdGVUZXh0KTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3Iub2ZmKCdOb2RlQ2hhbmdlJywgdXBkYXRlVGV4dCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHJlbmRlckNvbW1vbkRyb3Bkb3duKHtcbiAgICAgICAgdGV4dDogc3BlYy5pY29uLmlzU29tZSgpID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuc29tZSgnJyksXG4gICAgICAgIGljb246IHNwZWMuaWNvbixcbiAgICAgICAgdG9vbHRpcDogT3B0aW9uYWwuZnJvbShzcGVjLnRvb2x0aXApLFxuICAgICAgICByb2xlOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGZldGNoOiBpdGVtcy5nZXRGZXRjaChiYWNrc3RhZ2UsIGdldFN0eWxlSXRlbXMpLFxuICAgICAgICBvblNldHVwOiBvblNldHVwLFxuICAgICAgICBnZXRBcGk6IGdldEFwaSxcbiAgICAgICAgY29sdW1uczogMSxcbiAgICAgICAgcHJlc2V0czogJ25vcm1hbCcsXG4gICAgICAgIGNsYXNzZXM6IHNwZWMuaWNvbi5pc1NvbWUoKSA/IFtdIDogWydiZXNwb2tlJ10sXG4gICAgICAgIGRyb3Bkb3duQmVoYXZpb3VyczogW11cbiAgICAgIH0sICd0b3gtdGJ0bicsIGJhY2tzdGFnZS5zaGFyZWQpO1xuICAgIH07XG5cbiAgICB2YXIgcHJvY2VzcyA9IGZ1bmN0aW9uIChyYXdGb3JtYXRzKSB7XG4gICAgICByZXR1cm4gbWFwKHJhd0Zvcm1hdHMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciB0aXRsZSA9IGl0ZW0sIGZvcm1hdCA9IGl0ZW07XG4gICAgICAgIHZhciB2YWx1ZXMgPSBpdGVtLnNwbGl0KCc9Jyk7XG4gICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgIHRpdGxlID0gdmFsdWVzWzBdO1xuICAgICAgICAgIGZvcm1hdCA9IHZhbHVlc1sxXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICBmb3JtYXQ6IGZvcm1hdFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYnVpbGRCYXNpY1N0YXRpY0RhdGFzZXQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogJ2Jhc2ljJyxcbiAgICAgICAgZGF0YTogZGF0YVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBEZWxpbWl0ZXI7XG4gICAgKGZ1bmN0aW9uIChEZWxpbWl0ZXIpIHtcbiAgICAgIERlbGltaXRlcltEZWxpbWl0ZXJbJ1NlbWlDb2xvbiddID0gMF0gPSAnU2VtaUNvbG9uJztcbiAgICAgIERlbGltaXRlcltEZWxpbWl0ZXJbJ1NwYWNlJ10gPSAxXSA9ICdTcGFjZSc7XG4gICAgfShEZWxpbWl0ZXIgfHwgKERlbGltaXRlciA9IHt9KSkpO1xuICAgIHZhciBzcGxpdCA9IGZ1bmN0aW9uIChyYXdGb3JtYXRzLCBkZWxpbWl0ZXIpIHtcbiAgICAgIGlmIChkZWxpbWl0ZXIgPT09IERlbGltaXRlci5TZW1pQ29sb24pIHtcbiAgICAgICAgcmV0dXJuIHJhd0Zvcm1hdHMucmVwbGFjZSgvOyQvLCAnJykuc3BsaXQoJzsnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByYXdGb3JtYXRzLnNwbGl0KCcgJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgYnVpbGRCYXNpY1NldHRpbmdzRGF0YXNldCA9IGZ1bmN0aW9uIChlZGl0b3IsIHNldHRpbmdOYW1lLCBkZWZhdWx0cywgZGVsaW1pdGVyKSB7XG4gICAgICB2YXIgcmF3Rm9ybWF0cyA9IGVkaXRvci5nZXRQYXJhbShzZXR0aW5nTmFtZSwgZGVmYXVsdHMsICdzdHJpbmcnKTtcbiAgICAgIHZhciBkYXRhID0gcHJvY2VzcyhzcGxpdChyYXdGb3JtYXRzLCBkZWxpbWl0ZXIpKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdiYXNpYycsXG4gICAgICAgIGRhdGE6IGRhdGFcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhbGlnbk1lbnVJdGVtcyA9IFtcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6ICdMZWZ0JyxcbiAgICAgICAgaWNvbjogJ2FsaWduLWxlZnQnLFxuICAgICAgICBmb3JtYXQ6ICdhbGlnbmxlZnQnLFxuICAgICAgICBjb21tYW5kOiAnSnVzdGlmeUxlZnQnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ0NlbnRlcicsXG4gICAgICAgIGljb246ICdhbGlnbi1jZW50ZXInLFxuICAgICAgICBmb3JtYXQ6ICdhbGlnbmNlbnRlcicsXG4gICAgICAgIGNvbW1hbmQ6ICdKdXN0aWZ5Q2VudGVyJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6ICdSaWdodCcsXG4gICAgICAgIGljb246ICdhbGlnbi1yaWdodCcsXG4gICAgICAgIGZvcm1hdDogJ2FsaWducmlnaHQnLFxuICAgICAgICBjb21tYW5kOiAnSnVzdGlmeVJpZ2h0J1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6ICdKdXN0aWZ5JyxcbiAgICAgICAgaWNvbjogJ2FsaWduLWp1c3RpZnknLFxuICAgICAgICBmb3JtYXQ6ICdhbGlnbmp1c3RpZnknLFxuICAgICAgICBjb21tYW5kOiAnSnVzdGlmeUZ1bGwnXG4gICAgICB9XG4gICAgXTtcbiAgICB2YXIgZ2V0U3BlYyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBnZXRNYXRjaGluZ1ZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmluZChhbGlnbk1lbnVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmZvcm1hdHRlci5tYXRjaChpdGVtLmZvcm1hdCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBpc1NlbGVjdGVkRm9yID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZm9ybWF0dGVyLm1hdGNoKGZvcm1hdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGdldFByZXZpZXdGb3IgPSBmdW5jdGlvbiAoX2Zvcm1hdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZVNlbGVjdE1lbnVJY29uID0gZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgdmFyIG1hdGNoID0gZ2V0TWF0Y2hpbmdWYWx1ZSgpO1xuICAgICAgICB2YXIgYWxpZ25tZW50ID0gbWF0Y2guZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdsZWZ0JztcbiAgICAgICAgfSwgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gaXRlbS50aXRsZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgZW1pdFdpdGgoY29tcCwgdXBkYXRlTWVudUljb24sIHsgaWNvbjogJ2FsaWduLScgKyBhbGlnbm1lbnQgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGRhdGFzZXQgPSBidWlsZEJhc2ljU3RhdGljRGF0YXNldChhbGlnbk1lbnVJdGVtcyk7XG4gICAgICB2YXIgb25BY3Rpb24gPSBmdW5jdGlvbiAocmF3SXRlbSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBmaW5kKGFsaWduTWVudUl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZm9ybWF0ID09PSByYXdJdGVtLmZvcm1hdDtcbiAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKGl0ZW0uY29tbWFuZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG9vbHRpcDogJ0FsaWduJyxcbiAgICAgICAgaWNvbjogT3B0aW9uYWwuc29tZSgnYWxpZ24tbGVmdCcpLFxuICAgICAgICBpc1NlbGVjdGVkRm9yOiBpc1NlbGVjdGVkRm9yLFxuICAgICAgICBnZXRDdXJyZW50VmFsdWU6IE9wdGlvbmFsLm5vbmUsXG4gICAgICAgIGdldFByZXZpZXdGb3I6IGdldFByZXZpZXdGb3IsXG4gICAgICAgIG9uQWN0aW9uOiBvbkFjdGlvbixcbiAgICAgICAgdXBkYXRlVGV4dDogdXBkYXRlU2VsZWN0TWVudUljb24sXG4gICAgICAgIGRhdGFzZXQ6IGRhdGFzZXQsXG4gICAgICAgIHNob3VsZEhpZGU6IGZhbHNlLFxuICAgICAgICBpc0ludmFsaWQ6IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuICFlZGl0b3IuZm9ybWF0dGVyLmNhbkFwcGx5KGl0ZW0uZm9ybWF0KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVBbGlnblNlbGVjdCA9IGZ1bmN0aW9uIChlZGl0b3IsIGJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZVNlbGVjdEJ1dHRvbihlZGl0b3IsIGJhY2tzdGFnZSwgZ2V0U3BlYyhlZGl0b3IpKTtcbiAgICB9O1xuICAgIHZhciBhbGlnblNlbGVjdE1lbnUgPSBmdW5jdGlvbiAoZWRpdG9yLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBtZW51SXRlbXMgPSBjcmVhdGVNZW51SXRlbXMoZWRpdG9yLCBiYWNrc3RhZ2UsIGdldFNwZWMoZWRpdG9yKSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTmVzdGVkTWVudUl0ZW0oJ2FsaWduJywge1xuICAgICAgICB0ZXh0OiBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycy50cmFuc2xhdGUoJ0FsaWduJyksXG4gICAgICAgIGdldFN1Ym1lbnVJdGVtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtZW51SXRlbXMuaXRlbXMudmFsaWRhdGVJdGVtcyhtZW51SXRlbXMuZ2V0U3R5bGVJdGVtcygpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBkZWZhdWx0Rm9udHNGb3JtYXRzID0gJ0FuZGFsZSBNb25vPWFuZGFsZSBtb25vLG1vbm9zcGFjZTsnICsgJ0FyaWFsPWFyaWFsLGhlbHZldGljYSxzYW5zLXNlcmlmOycgKyAnQXJpYWwgQmxhY2s9YXJpYWwgYmxhY2ssc2Fucy1zZXJpZjsnICsgJ0Jvb2sgQW50aXF1YT1ib29rIGFudGlxdWEscGFsYXRpbm8sc2VyaWY7JyArICdDb21pYyBTYW5zIE1TPWNvbWljIHNhbnMgbXMsc2Fucy1zZXJpZjsnICsgJ0NvdXJpZXIgTmV3PWNvdXJpZXIgbmV3LGNvdXJpZXIsbW9ub3NwYWNlOycgKyAnR2VvcmdpYT1nZW9yZ2lhLHBhbGF0aW5vLHNlcmlmOycgKyAnSGVsdmV0aWNhPWhlbHZldGljYSxhcmlhbCxzYW5zLXNlcmlmOycgKyAnSW1wYWN0PWltcGFjdCxzYW5zLXNlcmlmOycgKyAnU3ltYm9sPXN5bWJvbDsnICsgJ1RhaG9tYT10YWhvbWEsYXJpYWwsaGVsdmV0aWNhLHNhbnMtc2VyaWY7JyArICdUZXJtaW5hbD10ZXJtaW5hbCxtb25hY28sbW9ub3NwYWNlOycgKyAnVGltZXMgTmV3IFJvbWFuPXRpbWVzIG5ldyByb21hbix0aW1lcyxzZXJpZjsnICsgJ1RyZWJ1Y2hldCBNUz10cmVidWNoZXQgbXMsZ2VuZXZhLHNhbnMtc2VyaWY7JyArICdWZXJkYW5hPXZlcmRhbmEsZ2VuZXZhLHNhbnMtc2VyaWY7JyArICdXZWJkaW5ncz13ZWJkaW5nczsnICsgJ1dpbmdkaW5ncz13aW5nZGluZ3MsemFwZiBkaW5nYmF0cyc7XG4gICAgdmFyIHN5c3RlbVN0YWNrRm9udHMgPSBbXG4gICAgICAnLWFwcGxlLXN5c3RlbScsXG4gICAgICAnU2Vnb2UgVUknLFxuICAgICAgJ1JvYm90bycsXG4gICAgICAnSGVsdmV0aWNhIE5ldWUnLFxuICAgICAgJ3NhbnMtc2VyaWYnXG4gICAgXTtcbiAgICB2YXIgc3BsaXRGb250cyA9IGZ1bmN0aW9uIChmb250RmFtaWx5KSB7XG4gICAgICB2YXIgZm9udHMgPSBmb250RmFtaWx5LnNwbGl0KC9cXHMqLFxccyovKTtcbiAgICAgIHJldHVybiBtYXAoZm9udHMsIGZ1bmN0aW9uIChmb250KSB7XG4gICAgICAgIHJldHVybiBmb250LnJlcGxhY2UoL15bJ1wiXSt8WydcIl0rJC9nLCAnJyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpc1N5c3RlbUZvbnRTdGFjayA9IGZ1bmN0aW9uIChmb250RmFtaWx5KSB7XG4gICAgICB2YXIgbWF0Y2hlc1N5c3RlbVN0YWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZm9udHMgPSBzcGxpdEZvbnRzKGZvbnRGYW1pbHkudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIHJldHVybiBmb3JhbGwoc3lzdGVtU3RhY2tGb250cywgZnVuY3Rpb24gKGZvbnQpIHtcbiAgICAgICAgICByZXR1cm4gZm9udHMuaW5kZXhPZihmb250LnRvTG93ZXJDYXNlKCkpID4gLTE7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmb250RmFtaWx5LmluZGV4T2YoJy1hcHBsZS1zeXN0ZW0nKSA9PT0gMCAmJiBtYXRjaGVzU3lzdGVtU3RhY2soKTtcbiAgICB9O1xuICAgIHZhciBnZXRTcGVjJDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgZ2V0TWF0Y2hpbmdWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGdldEZpcnN0Rm9udCA9IGZ1bmN0aW9uIChmb250RmFtaWx5KSB7XG4gICAgICAgICAgcmV0dXJuIGZvbnRGYW1pbHkgPyBzcGxpdEZvbnRzKGZvbnRGYW1pbHkpWzBdIDogJyc7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBmb250RmFtaWx5ID0gZWRpdG9yLnF1ZXJ5Q29tbWFuZFZhbHVlKCdGb250TmFtZScpO1xuICAgICAgICB2YXIgaXRlbXMgPSBkYXRhc2V0LmRhdGE7XG4gICAgICAgIHZhciBmb250ID0gZm9udEZhbWlseSA/IGZvbnRGYW1pbHkudG9Mb3dlckNhc2UoKSA6ICcnO1xuICAgICAgICB2YXIgbWF0Y2hPcHQgPSBmaW5kKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHZhciBmb3JtYXQgPSBpdGVtLmZvcm1hdDtcbiAgICAgICAgICByZXR1cm4gZm9ybWF0LnRvTG93ZXJDYXNlKCkgPT09IGZvbnQgfHwgZ2V0Rmlyc3RGb250KGZvcm1hdCkudG9Mb3dlckNhc2UoKSA9PT0gZ2V0Rmlyc3RGb250KGZvbnQpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH0pLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChpc1N5c3RlbUZvbnRTdGFjayhmb250KSkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oe1xuICAgICAgICAgICAgICB0aXRsZTogJ1N5c3RlbSBGb250JyxcbiAgICAgICAgICAgICAgZm9ybWF0OiBmb250XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1hdGNoT3B0OiBtYXRjaE9wdCxcbiAgICAgICAgICBmb250OiBmb250RmFtaWx5XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2VsZWN0ZWRGb3IgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlT3B0KSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlT3B0LmV4aXN0cyhmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5mb3JtYXQgPT09IGl0ZW07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGdldEN1cnJlbnRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1hdGNoT3B0ID0gZ2V0TWF0Y2hpbmdWYWx1ZSgpLm1hdGNoT3B0O1xuICAgICAgICByZXR1cm4gbWF0Y2hPcHQ7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFByZXZpZXdGb3IgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBzdHlsZXM6IGl0ZW0uaW5kZXhPZignZGluZ3MnKSA9PT0gLTEgPyB7ICdmb250LWZhbWlseSc6IGl0ZW0gfSA6IHt9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIG9uQWN0aW9uID0gZnVuY3Rpb24gKHJhd0l0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ0ZvbnROYW1lJywgZmFsc2UsIHJhd0l0ZW0uZm9ybWF0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlU2VsZWN0TWVudVRleHQgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICB2YXIgX2EgPSBnZXRNYXRjaGluZ1ZhbHVlKCksIG1hdGNoT3B0ID0gX2EubWF0Y2hPcHQsIGZvbnQgPSBfYS5mb250O1xuICAgICAgICB2YXIgdGV4dCA9IG1hdGNoT3B0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBmb250O1xuICAgICAgICB9LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHJldHVybiBpdGVtLnRpdGxlO1xuICAgICAgICB9KTtcbiAgICAgICAgZW1pdFdpdGgoY29tcCwgdXBkYXRlTWVudVRleHQsIHsgdGV4dDogdGV4dCB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZGF0YXNldCA9IGJ1aWxkQmFzaWNTZXR0aW5nc0RhdGFzZXQoZWRpdG9yLCAnZm9udF9mb3JtYXRzJywgZGVmYXVsdEZvbnRzRm9ybWF0cywgRGVsaW1pdGVyLlNlbWlDb2xvbik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b29sdGlwOiAnRm9udHMnLFxuICAgICAgICBpY29uOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIGlzU2VsZWN0ZWRGb3I6IGlzU2VsZWN0ZWRGb3IsXG4gICAgICAgIGdldEN1cnJlbnRWYWx1ZTogZ2V0Q3VycmVudFZhbHVlLFxuICAgICAgICBnZXRQcmV2aWV3Rm9yOiBnZXRQcmV2aWV3Rm9yLFxuICAgICAgICBvbkFjdGlvbjogb25BY3Rpb24sXG4gICAgICAgIHVwZGF0ZVRleHQ6IHVwZGF0ZVNlbGVjdE1lbnVUZXh0LFxuICAgICAgICBkYXRhc2V0OiBkYXRhc2V0LFxuICAgICAgICBzaG91bGRIaWRlOiBmYWxzZSxcbiAgICAgICAgaXNJbnZhbGlkOiBuZXZlclxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVGb250U2VsZWN0ID0gZnVuY3Rpb24gKGVkaXRvciwgYmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4gY3JlYXRlU2VsZWN0QnV0dG9uKGVkaXRvciwgYmFja3N0YWdlLCBnZXRTcGVjJDEoZWRpdG9yKSk7XG4gICAgfTtcbiAgICB2YXIgZm9udFNlbGVjdE1lbnUgPSBmdW5jdGlvbiAoZWRpdG9yLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBtZW51SXRlbXMgPSBjcmVhdGVNZW51SXRlbXMoZWRpdG9yLCBiYWNrc3RhZ2UsIGdldFNwZWMkMShlZGl0b3IpKTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGROZXN0ZWRNZW51SXRlbSgnZm9udGZvcm1hdHMnLCB7XG4gICAgICAgIHRleHQ6IGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLnRyYW5zbGF0ZSgnRm9udHMnKSxcbiAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1lbnVJdGVtcy5pdGVtcy52YWxpZGF0ZUl0ZW1zKG1lbnVJdGVtcy5nZXRTdHlsZUl0ZW1zKCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGRlZmF1bHRGb250c2l6ZUZvcm1hdHMgPSAnOHB0IDEwcHQgMTJwdCAxNHB0IDE4cHQgMjRwdCAzNnB0JztcbiAgICB2YXIgbGVnYWN5Rm9udFNpemVzID0ge1xuICAgICAgJzhwdCc6ICcxJyxcbiAgICAgICcxMHB0JzogJzInLFxuICAgICAgJzEycHQnOiAnMycsXG4gICAgICAnMTRwdCc6ICc0JyxcbiAgICAgICcxOHB0JzogJzUnLFxuICAgICAgJzI0cHQnOiAnNicsXG4gICAgICAnMzZwdCc6ICc3J1xuICAgIH07XG4gICAgdmFyIGtleXdvcmRGb250U2l6ZXMgPSB7XG4gICAgICAneHgtc21hbGwnOiAnN3B0JyxcbiAgICAgICd4LXNtYWxsJzogJzhwdCcsXG4gICAgICAnc21hbGwnOiAnMTBwdCcsXG4gICAgICAnbWVkaXVtJzogJzEycHQnLFxuICAgICAgJ2xhcmdlJzogJzE0cHQnLFxuICAgICAgJ3gtbGFyZ2UnOiAnMThwdCcsXG4gICAgICAneHgtbGFyZ2UnOiAnMjRwdCdcbiAgICB9O1xuICAgIHZhciByb3VuZCQxID0gZnVuY3Rpb24gKG51bWJlciwgcHJlY2lzaW9uKSB7XG4gICAgICB2YXIgZmFjdG9yID0gTWF0aC5wb3coMTAsIHByZWNpc2lvbik7XG4gICAgICByZXR1cm4gTWF0aC5yb3VuZChudW1iZXIgKiBmYWN0b3IpIC8gZmFjdG9yO1xuICAgIH07XG4gICAgdmFyIHRvUHQgPSBmdW5jdGlvbiAoZm9udFNpemUsIHByZWNpc2lvbikge1xuICAgICAgaWYgKC9bMC05Ll0rcHgkLy50ZXN0KGZvbnRTaXplKSkge1xuICAgICAgICByZXR1cm4gcm91bmQkMShwYXJzZUludChmb250U2l6ZSwgMTApICogNzIgLyA5NiwgcHJlY2lzaW9uIHx8IDApICsgJ3B0JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBnZXQkMShrZXl3b3JkRm9udFNpemVzLCBmb250U2l6ZSkuZ2V0T3IoZm9udFNpemUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHRvTGVnYWN5ID0gZnVuY3Rpb24gKGZvbnRTaXplKSB7XG4gICAgICByZXR1cm4gZ2V0JDEobGVnYWN5Rm9udFNpemVzLCBmb250U2l6ZSkuZ2V0T3IoJycpO1xuICAgIH07XG4gICAgdmFyIGdldFNwZWMkMiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBnZXRNYXRjaGluZ1ZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbWF0Y2hPcHQgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIHZhciBpdGVtcyA9IGRhdGFzZXQuZGF0YTtcbiAgICAgICAgdmFyIGZvbnRTaXplID0gZWRpdG9yLnF1ZXJ5Q29tbWFuZFZhbHVlKCdGb250U2l6ZScpO1xuICAgICAgICBpZiAoZm9udFNpemUpIHtcbiAgICAgICAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIChwcmVjaXNpb24pIHtcbiAgICAgICAgICAgIHZhciBwdCA9IHRvUHQoZm9udFNpemUsIHByZWNpc2lvbik7XG4gICAgICAgICAgICB2YXIgbGVnYWN5ID0gdG9MZWdhY3kocHQpO1xuICAgICAgICAgICAgbWF0Y2hPcHQgPSBmaW5kKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gaXRlbS5mb3JtYXQgPT09IGZvbnRTaXplIHx8IGl0ZW0uZm9ybWF0ID09PSBwdCB8fCBpdGVtLmZvcm1hdCA9PT0gbGVnYWN5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBmb3IgKHZhciBwcmVjaXNpb24gPSAzOyBtYXRjaE9wdC5pc05vbmUoKSAmJiBwcmVjaXNpb24gPj0gMDsgcHJlY2lzaW9uLS0pIHtcbiAgICAgICAgICAgIF9sb29wXzEocHJlY2lzaW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtYXRjaE9wdDogbWF0Y2hPcHQsXG4gICAgICAgICAgc2l6ZTogZm9udFNpemVcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNTZWxlY3RlZEZvciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWVPcHQpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWVPcHQuZXhpc3RzKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmZvcm1hdCA9PT0gaXRlbTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0Q3VycmVudFZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbWF0Y2hPcHQgPSBnZXRNYXRjaGluZ1ZhbHVlKCkubWF0Y2hPcHQ7XG4gICAgICAgIHJldHVybiBtYXRjaE9wdDtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0UHJldmlld0ZvciA9IGNvbnN0YW50KE9wdGlvbmFsLm5vbmUpO1xuICAgICAgdmFyIG9uQWN0aW9uID0gZnVuY3Rpb24gKHJhd0l0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ0ZvbnRTaXplJywgZmFsc2UsIHJhd0l0ZW0uZm9ybWF0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlU2VsZWN0TWVudVRleHQgPSBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICB2YXIgX2EgPSBnZXRNYXRjaGluZ1ZhbHVlKCksIG1hdGNoT3B0ID0gX2EubWF0Y2hPcHQsIHNpemUgPSBfYS5zaXplO1xuICAgICAgICB2YXIgdGV4dCA9IG1hdGNoT3B0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzaXplO1xuICAgICAgICB9LCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2gudGl0bGU7XG4gICAgICAgIH0pO1xuICAgICAgICBlbWl0V2l0aChjb21wLCB1cGRhdGVNZW51VGV4dCwgeyB0ZXh0OiB0ZXh0IH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBkYXRhc2V0ID0gYnVpbGRCYXNpY1NldHRpbmdzRGF0YXNldChlZGl0b3IsICdmb250c2l6ZV9mb3JtYXRzJywgZGVmYXVsdEZvbnRzaXplRm9ybWF0cywgRGVsaW1pdGVyLlNwYWNlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvb2x0aXA6ICdGb250IHNpemVzJyxcbiAgICAgICAgaWNvbjogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBpc1NlbGVjdGVkRm9yOiBpc1NlbGVjdGVkRm9yLFxuICAgICAgICBnZXRQcmV2aWV3Rm9yOiBnZXRQcmV2aWV3Rm9yLFxuICAgICAgICBnZXRDdXJyZW50VmFsdWU6IGdldEN1cnJlbnRWYWx1ZSxcbiAgICAgICAgb25BY3Rpb246IG9uQWN0aW9uLFxuICAgICAgICB1cGRhdGVUZXh0OiB1cGRhdGVTZWxlY3RNZW51VGV4dCxcbiAgICAgICAgZGF0YXNldDogZGF0YXNldCxcbiAgICAgICAgc2hvdWxkSGlkZTogZmFsc2UsXG4gICAgICAgIGlzSW52YWxpZDogbmV2ZXJcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlRm9udHNpemVTZWxlY3QgPSBmdW5jdGlvbiAoZWRpdG9yLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiBjcmVhdGVTZWxlY3RCdXR0b24oZWRpdG9yLCBiYWNrc3RhZ2UsIGdldFNwZWMkMihlZGl0b3IpKTtcbiAgICB9O1xuICAgIHZhciBmb250c2l6ZVNlbGVjdE1lbnUgPSBmdW5jdGlvbiAoZWRpdG9yLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBtZW51SXRlbXMgPSBjcmVhdGVNZW51SXRlbXMoZWRpdG9yLCBiYWNrc3RhZ2UsIGdldFNwZWMkMihlZGl0b3IpKTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGROZXN0ZWRNZW51SXRlbSgnZm9udHNpemVzJywge1xuICAgICAgICB0ZXh0OiAnRm9udCBzaXplcycsXG4gICAgICAgIGdldFN1Ym1lbnVJdGVtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtZW51SXRlbXMuaXRlbXMudmFsaWRhdGVJdGVtcyhtZW51SXRlbXMuZ2V0U3R5bGVJdGVtcygpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBmaW5kTmVhcmVzdCA9IGZ1bmN0aW9uIChlZGl0b3IsIGdldFN0eWxlcykge1xuICAgICAgdmFyIHN0eWxlcyA9IGdldFN0eWxlcygpO1xuICAgICAgdmFyIGZvcm1hdHMgPSBtYXAoc3R5bGVzLCBmdW5jdGlvbiAoc3R5bGUpIHtcbiAgICAgICAgcmV0dXJuIHN0eWxlLmZvcm1hdDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZWRpdG9yLmZvcm1hdHRlci5jbG9zZXN0KGZvcm1hdHMpKS5iaW5kKGZ1bmN0aW9uIChmbXQpIHtcbiAgICAgICAgcmV0dXJuIGZpbmQoc3R5bGVzLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHJldHVybiBkYXRhLmZvcm1hdCA9PT0gZm10O1xuICAgICAgICB9KTtcbiAgICAgIH0pLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc29tZUlmKGVkaXRvci5mb3JtYXR0ZXIubWF0Y2goJ3AnKSwge1xuICAgICAgICAgIHRpdGxlOiAnUGFyYWdyYXBoJyxcbiAgICAgICAgICBmb3JtYXQ6ICdwJ1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcmV2b2NhYmxlID0gZnVuY3Rpb24gKGRvUmV2b2tlKSB7XG4gICAgICB2YXIgc3ViamVjdCA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciByZXZva2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LmdldCgpLmVhY2goZG9SZXZva2UpO1xuICAgICAgfTtcbiAgICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV2b2tlKCk7XG4gICAgICAgIHN1YmplY3Quc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV2b2tlKCk7XG4gICAgICAgIHN1YmplY3Quc2V0KE9wdGlvbmFsLnNvbWUocykpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgaXNTZXQ6IGlzU2V0LFxuICAgICAgICBzZXQ6IHNldFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkZXN0cm95YWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiByZXZvY2FibGUoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMuZGVzdHJveSgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdW5iaW5kYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiByZXZvY2FibGUoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMudW5iaW5kKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB2YWx1ZSQzID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN1YmplY3QgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5zZXQoT3B0aW9uYWwuc29tZShzKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5lYWNoKGYpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGlzU2V0OiBpc1NldCxcbiAgICAgICAgb246IG9uXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgb25TZXR1cEZvcm1hdFRvZ2dsZSA9IGZ1bmN0aW9uIChlZGl0b3IsIG5hbWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgIHZhciBib3VuZENhbGxiYWNrID0gdW5iaW5kYWJsZSgpO1xuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhcGkuc2V0QWN0aXZlKGVkaXRvci5mb3JtYXR0ZXIubWF0Y2gobmFtZSkpO1xuICAgICAgICAgIHZhciBiaW5kaW5nID0gZWRpdG9yLmZvcm1hdHRlci5mb3JtYXRDaGFuZ2VkKG5hbWUsIGFwaS5zZXRBY3RpdmUpO1xuICAgICAgICAgIGJvdW5kQ2FsbGJhY2suc2V0KGJpbmRpbmcpO1xuICAgICAgICB9O1xuICAgICAgICBlZGl0b3IuaW5pdGlhbGl6ZWQgPyBpbml0KCkgOiBlZGl0b3Iub24oJ2luaXQnLCBpbml0KTtcbiAgICAgICAgcmV0dXJuIGJvdW5kQ2FsbGJhY2suY2xlYXI7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG9uQWN0aW9uVG9nZ2xlRm9ybWF0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyYXdJdGVtKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VUb2dnbGVGb3JtYXQnLCBmYWxzZSwgcmF3SXRlbS5mb3JtYXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGRlZmF1bHRCbG9ja3MgPSAnUGFyYWdyYXBoPXA7JyArICdIZWFkaW5nIDE9aDE7JyArICdIZWFkaW5nIDI9aDI7JyArICdIZWFkaW5nIDM9aDM7JyArICdIZWFkaW5nIDQ9aDQ7JyArICdIZWFkaW5nIDU9aDU7JyArICdIZWFkaW5nIDY9aDY7JyArICdQcmVmb3JtYXR0ZWQ9cHJlJztcbiAgICB2YXIgZ2V0U3BlYyQzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGlzU2VsZWN0ZWRGb3IgPSBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGVkaXRvci5mb3JtYXR0ZXIubWF0Y2goZm9ybWF0KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0UHJldmlld0ZvciA9IGZ1bmN0aW9uIChmb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgZm10ID0gZWRpdG9yLmZvcm1hdHRlci5nZXQoZm9ybWF0KTtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgICB0YWc6IGZtdC5sZW5ndGggPiAwID8gZm10WzBdLmlubGluZSB8fCBmbXRbMF0uYmxvY2sgfHwgJ2RpdicgOiAnZGl2JyxcbiAgICAgICAgICAgIHN0eWxlczogZWRpdG9yLmRvbS5wYXJzZVN0eWxlKGVkaXRvci5mb3JtYXR0ZXIuZ2V0Q3NzVGV4dChmb3JtYXQpKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGVTZWxlY3RNZW51VGV4dCA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIHZhciBkZXRlY3RlZEZvcm1hdCA9IGZpbmROZWFyZXN0KGVkaXRvciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBkYXRhc2V0LmRhdGE7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdGV4dCA9IGRldGVjdGVkRm9ybWF0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAnUGFyYWdyYXBoJztcbiAgICAgICAgfSwgZnVuY3Rpb24gKGZtdCkge1xuICAgICAgICAgIHJldHVybiBmbXQudGl0bGU7XG4gICAgICAgIH0pO1xuICAgICAgICBlbWl0V2l0aChjb21wLCB1cGRhdGVNZW51VGV4dCwgeyB0ZXh0OiB0ZXh0IH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBkYXRhc2V0ID0gYnVpbGRCYXNpY1NldHRpbmdzRGF0YXNldChlZGl0b3IsICdibG9ja19mb3JtYXRzJywgZGVmYXVsdEJsb2NrcywgRGVsaW1pdGVyLlNlbWlDb2xvbik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b29sdGlwOiAnQmxvY2tzJyxcbiAgICAgICAgaWNvbjogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBpc1NlbGVjdGVkRm9yOiBpc1NlbGVjdGVkRm9yLFxuICAgICAgICBnZXRDdXJyZW50VmFsdWU6IE9wdGlvbmFsLm5vbmUsXG4gICAgICAgIGdldFByZXZpZXdGb3I6IGdldFByZXZpZXdGb3IsXG4gICAgICAgIG9uQWN0aW9uOiBvbkFjdGlvblRvZ2dsZUZvcm1hdChlZGl0b3IpLFxuICAgICAgICB1cGRhdGVUZXh0OiB1cGRhdGVTZWxlY3RNZW51VGV4dCxcbiAgICAgICAgZGF0YXNldDogZGF0YXNldCxcbiAgICAgICAgc2hvdWxkSGlkZTogZmFsc2UsXG4gICAgICAgIGlzSW52YWxpZDogZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gIWVkaXRvci5mb3JtYXR0ZXIuY2FuQXBwbHkoaXRlbS5mb3JtYXQpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZUZvcm1hdFNlbGVjdCA9IGZ1bmN0aW9uIChlZGl0b3IsIGJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZVNlbGVjdEJ1dHRvbihlZGl0b3IsIGJhY2tzdGFnZSwgZ2V0U3BlYyQzKGVkaXRvcikpO1xuICAgIH07XG4gICAgdmFyIGZvcm1hdFNlbGVjdE1lbnUgPSBmdW5jdGlvbiAoZWRpdG9yLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBtZW51SXRlbXMgPSBjcmVhdGVNZW51SXRlbXMoZWRpdG9yLCBiYWNrc3RhZ2UsIGdldFNwZWMkMyhlZGl0b3IpKTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGROZXN0ZWRNZW51SXRlbSgnYmxvY2tmb3JtYXRzJywge1xuICAgICAgICB0ZXh0OiAnQmxvY2tzJyxcbiAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1lbnVJdGVtcy5pdGVtcy52YWxpZGF0ZUl0ZW1zKG1lbnVJdGVtcy5nZXRTdHlsZUl0ZW1zKCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGdldFNwZWMkNCA9IGZ1bmN0aW9uIChlZGl0b3IsIGRhdGFzZXQpIHtcbiAgICAgIHZhciBpc1NlbGVjdGVkRm9yID0gZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZm9ybWF0dGVyLm1hdGNoKGZvcm1hdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGdldFByZXZpZXdGb3IgPSBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGZtdCA9IGVkaXRvci5mb3JtYXR0ZXIuZ2V0KGZvcm1hdCk7XG4gICAgICAgICAgcmV0dXJuIGZtdCAhPT0gdW5kZWZpbmVkID8gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgICB0YWc6IGZtdC5sZW5ndGggPiAwID8gZm10WzBdLmlubGluZSB8fCBmbXRbMF0uYmxvY2sgfHwgJ2RpdicgOiAnZGl2JyxcbiAgICAgICAgICAgIHN0eWxlczogZWRpdG9yLmRvbS5wYXJzZVN0eWxlKGVkaXRvci5mb3JtYXR0ZXIuZ2V0Q3NzVGV4dChmb3JtYXQpKVxuICAgICAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGVTZWxlY3RNZW51VGV4dCA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIHZhciBnZXRGb3JtYXRJdGVtcyA9IGZ1bmN0aW9uIChmbXQpIHtcbiAgICAgICAgICB2YXIgc3VicyA9IGZtdC5pdGVtcztcbiAgICAgICAgICByZXR1cm4gc3VicyAhPT0gdW5kZWZpbmVkICYmIHN1YnMubGVuZ3RoID4gMCA/IGJpbmQoc3VicywgZ2V0Rm9ybWF0SXRlbXMpIDogW3tcbiAgICAgICAgICAgICAgdGl0bGU6IGZtdC50aXRsZSxcbiAgICAgICAgICAgICAgZm9ybWF0OiBmbXQuZm9ybWF0XG4gICAgICAgICAgICB9XTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGZsYXR0ZW5lZEl0ZW1zID0gYmluZChnZXRTdHlsZUZvcm1hdHMoZWRpdG9yKSwgZ2V0Rm9ybWF0SXRlbXMpO1xuICAgICAgICB2YXIgZGV0ZWN0ZWRGb3JtYXQgPSBmaW5kTmVhcmVzdChlZGl0b3IsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZmxhdHRlbmVkSXRlbXM7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgdGV4dCA9IGRldGVjdGVkRm9ybWF0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAnUGFyYWdyYXBoJztcbiAgICAgICAgfSwgZnVuY3Rpb24gKGZtdCkge1xuICAgICAgICAgIHJldHVybiBmbXQudGl0bGU7XG4gICAgICAgIH0pO1xuICAgICAgICBlbWl0V2l0aChjb21wLCB1cGRhdGVNZW51VGV4dCwgeyB0ZXh0OiB0ZXh0IH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvb2x0aXA6ICdGb3JtYXRzJyxcbiAgICAgICAgaWNvbjogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBpc1NlbGVjdGVkRm9yOiBpc1NlbGVjdGVkRm9yLFxuICAgICAgICBnZXRDdXJyZW50VmFsdWU6IE9wdGlvbmFsLm5vbmUsXG4gICAgICAgIGdldFByZXZpZXdGb3I6IGdldFByZXZpZXdGb3IsXG4gICAgICAgIG9uQWN0aW9uOiBvbkFjdGlvblRvZ2dsZUZvcm1hdChlZGl0b3IpLFxuICAgICAgICB1cGRhdGVUZXh0OiB1cGRhdGVTZWxlY3RNZW51VGV4dCxcbiAgICAgICAgc2hvdWxkSGlkZTogZWRpdG9yLmdldFBhcmFtKCdzdHlsZV9mb3JtYXRzX2F1dG9oaWRlJywgZmFsc2UsICdib29sZWFuJyksXG4gICAgICAgIGlzSW52YWxpZDogZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gIWVkaXRvci5mb3JtYXR0ZXIuY2FuQXBwbHkoaXRlbS5mb3JtYXQpO1xuICAgICAgICB9LFxuICAgICAgICBkYXRhc2V0OiBkYXRhc2V0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVN0eWxlU2VsZWN0ID0gZnVuY3Rpb24gKGVkaXRvciwgYmFja3N0YWdlKSB7XG4gICAgICB2YXIgZGF0YXNldCA9IF9fYXNzaWduKHsgdHlwZTogJ2FkdmFuY2VkJyB9LCBiYWNrc3RhZ2Uuc3R5bGVzZWxlY3QpO1xuICAgICAgcmV0dXJuIGNyZWF0ZVNlbGVjdEJ1dHRvbihlZGl0b3IsIGJhY2tzdGFnZSwgZ2V0U3BlYyQ0KGVkaXRvciwgZGF0YXNldCkpO1xuICAgIH07XG4gICAgdmFyIHN0eWxlU2VsZWN0TWVudSA9IGZ1bmN0aW9uIChlZGl0b3IsIGJhY2tzdGFnZSkge1xuICAgICAgdmFyIGRhdGFzZXQgPSBfX2Fzc2lnbih7IHR5cGU6ICdhZHZhbmNlZCcgfSwgYmFja3N0YWdlLnN0eWxlc2VsZWN0KTtcbiAgICAgIHZhciBtZW51SXRlbXMgPSBjcmVhdGVNZW51SXRlbXMoZWRpdG9yLCBiYWNrc3RhZ2UsIGdldFNwZWMkNChlZGl0b3IsIGRhdGFzZXQpKTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGROZXN0ZWRNZW51SXRlbSgnZm9ybWF0cycsIHtcbiAgICAgICAgdGV4dDogJ0Zvcm1hdHMnLFxuICAgICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWVudUl0ZW1zLml0ZW1zLnZhbGlkYXRlSXRlbXMobWVudUl0ZW1zLmdldFN0eWxlSXRlbXMoKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZGVmYXVsdFRvb2xiYXIgPSBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdoaXN0b3J5JyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAndW5kbycsXG4gICAgICAgICAgJ3JlZG8nXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdzdHlsZXMnLFxuICAgICAgICBpdGVtczogWydzdHlsZXNlbGVjdCddXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnZm9ybWF0dGluZycsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgJ2JvbGQnLFxuICAgICAgICAgICdpdGFsaWMnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdhbGlnbm1lbnQnLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgICdhbGlnbmxlZnQnLFxuICAgICAgICAgICdhbGlnbmNlbnRlcicsXG4gICAgICAgICAgJ2FsaWducmlnaHQnLFxuICAgICAgICAgICdhbGlnbmp1c3RpZnknXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdpbmRlbnRhdGlvbicsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgJ291dGRlbnQnLFxuICAgICAgICAgICdpbmRlbnQnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdwZXJtYW5lbnQgcGVuJyxcbiAgICAgICAgaXRlbXM6IFsncGVybWFuZW50cGVuJ11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdjb21tZW50cycsXG4gICAgICAgIGl0ZW1zOiBbJ2FkZGNvbW1lbnQnXVxuICAgICAgfVxuICAgIF07XG4gICAgdmFyIHJlbmRlckZyb21CcmlkZ2UgPSBmdW5jdGlvbiAoYnJpZGdlQnVpbGRlciwgcmVuZGVyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNwZWMsIGV4dHJhcywgZWRpdG9yKSB7XG4gICAgICAgIHZhciBpbnRlcm5hbCA9IGJyaWRnZUJ1aWxkZXIoc3BlYykubWFwRXJyb3IoZnVuY3Rpb24gKGVyckluZm8pIHtcbiAgICAgICAgICByZXR1cm4gZm9ybWF0RXJyb3IoZXJySW5mbyk7XG4gICAgICAgIH0pLmdldE9yRGllKCk7XG4gICAgICAgIHJldHVybiByZW5kZXIoaW50ZXJuYWwsIGV4dHJhcywgZWRpdG9yKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdHlwZXMgPSB7XG4gICAgICBidXR0b246IHJlbmRlckZyb21CcmlkZ2UoY3JlYXRlVG9vbGJhckJ1dHRvbiwgZnVuY3Rpb24gKHMsIGV4dHJhcykge1xuICAgICAgICByZXR1cm4gcmVuZGVyVG9vbGJhckJ1dHRvbihzLCBleHRyYXMuYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMpO1xuICAgICAgfSksXG4gICAgICB0b2dnbGVidXR0b246IHJlbmRlckZyb21CcmlkZ2UoY3JlYXRlVG9nZ2xlQnV0dG9uLCBmdW5jdGlvbiAocywgZXh0cmFzKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJUb29sYmFyVG9nZ2xlQnV0dG9uKHMsIGV4dHJhcy5iYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgICB9KSxcbiAgICAgIG1lbnVidXR0b246IHJlbmRlckZyb21CcmlkZ2UoY3JlYXRlTWVudUJ1dHRvbiwgZnVuY3Rpb24gKHMsIGV4dHJhcykge1xuICAgICAgICByZXR1cm4gcmVuZGVyTWVudUJ1dHRvbihzLCAndG94LXRidG4nLCBleHRyYXMuYmFja3N0YWdlLCBPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfSksXG4gICAgICBzcGxpdGJ1dHRvbjogcmVuZGVyRnJvbUJyaWRnZShjcmVhdGVTcGxpdEJ1dHRvbiwgZnVuY3Rpb24gKHMsIGV4dHJhcykge1xuICAgICAgICByZXR1cm4gcmVuZGVyU3BsaXRCdXR0b24ocywgZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQpO1xuICAgICAgfSksXG4gICAgICBncm91cHRvb2xiYXJidXR0b246IHJlbmRlckZyb21CcmlkZ2UoY3JlYXRlR3JvdXBUb29sYmFyQnV0dG9uLCBmdW5jdGlvbiAocywgZXh0cmFzLCBlZGl0b3IpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB2YXIgYnV0dG9ucyA9IGVkaXRvci51aS5yZWdpc3RyeS5nZXRBbGwoKS5idXR0b25zO1xuICAgICAgICB2YXIgaWRlbnRpZnkgPSBmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgIHJldHVybiBpZGVudGlmeUJ1dHRvbnMoZWRpdG9yLCB7XG4gICAgICAgICAgICBidXR0b25zOiBidXR0b25zLFxuICAgICAgICAgICAgdG9vbGJhcjogdG9vbGJhcixcbiAgICAgICAgICAgIGFsbG93VG9vbGJhckdyb3VwczogZmFsc2VcbiAgICAgICAgICB9LCBleHRyYXMsIE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0gKF9hID0ge30sIF9hW0F0dHJpYnV0ZV0gPSBleHRyYXMuYmFja3N0YWdlLnNoYXJlZC5oZWFkZXIuaXNQb3NpdGlvbmVkQXRUb3AoKSA/IEF0dHJpYnV0ZVZhbHVlLlRvcFRvQm90dG9tIDogQXR0cmlidXRlVmFsdWUuQm90dG9tVG9Ub3AsIF9hKTtcbiAgICAgICAgc3dpdGNoIChnZXRUb29sYmFyTW9kZShlZGl0b3IpKSB7XG4gICAgICAgIGNhc2UgVG9vbGJhck1vZGUuZmxvYXRpbmc6XG4gICAgICAgICAgcmV0dXJuIHJlbmRlckZsb2F0aW5nVG9vbGJhckJ1dHRvbihzLCBleHRyYXMuYmFja3N0YWdlLCBpZGVudGlmeSwgYXR0cmlidXRlcyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUb29sYmFyIGdyb3VwcyBhcmUgb25seSBzdXBwb3J0ZWQgd2hlbiB1c2luZyBmbG9hdGluZyB0b29sYmFyIG1vZGUnKTtcbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgICBzdHlsZVNlbGVjdEJ1dHRvbjogZnVuY3Rpb24gKGVkaXRvciwgZXh0cmFzKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVTdHlsZVNlbGVjdChlZGl0b3IsIGV4dHJhcy5iYWNrc3RhZ2UpO1xuICAgICAgfSxcbiAgICAgIGZvbnRzaXplU2VsZWN0QnV0dG9uOiBmdW5jdGlvbiAoZWRpdG9yLCBleHRyYXMpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUZvbnRzaXplU2VsZWN0KGVkaXRvciwgZXh0cmFzLmJhY2tzdGFnZSk7XG4gICAgICB9LFxuICAgICAgZm9udFNlbGVjdEJ1dHRvbjogZnVuY3Rpb24gKGVkaXRvciwgZXh0cmFzKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVGb250U2VsZWN0KGVkaXRvciwgZXh0cmFzLmJhY2tzdGFnZSk7XG4gICAgICB9LFxuICAgICAgZm9ybWF0QnV0dG9uOiBmdW5jdGlvbiAoZWRpdG9yLCBleHRyYXMpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUZvcm1hdFNlbGVjdChlZGl0b3IsIGV4dHJhcy5iYWNrc3RhZ2UpO1xuICAgICAgfSxcbiAgICAgIGFsaWduTWVudUJ1dHRvbjogZnVuY3Rpb24gKGVkaXRvciwgZXh0cmFzKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVBbGlnblNlbGVjdChlZGl0b3IsIGV4dHJhcy5iYWNrc3RhZ2UpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGV4dHJhY3RGcm9tID0gZnVuY3Rpb24gKHNwZWMsIGV4dHJhcywgZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2V0JDEodHlwZXMsIHNwZWMudHlwZSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NraXBwaW5nIGJ1dHRvbiBkZWZpbmVkIGJ5Jywgc3BlYyk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9LCBmdW5jdGlvbiAocmVuZGVyKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHJlbmRlcihzcGVjLCBleHRyYXMsIGVkaXRvcikpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYmVzcG9rZUJ1dHRvbnMgPSB7XG4gICAgICBzdHlsZXNlbGVjdDogdHlwZXMuc3R5bGVTZWxlY3RCdXR0b24sXG4gICAgICBmb250c2l6ZXNlbGVjdDogdHlwZXMuZm9udHNpemVTZWxlY3RCdXR0b24sXG4gICAgICBmb250c2VsZWN0OiB0eXBlcy5mb250U2VsZWN0QnV0dG9uLFxuICAgICAgZm9ybWF0c2VsZWN0OiB0eXBlcy5mb3JtYXRCdXR0b24sXG4gICAgICBhbGlnbjogdHlwZXMuYWxpZ25NZW51QnV0dG9uXG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlVW51c2VkRGVmYXVsdHMgPSBmdW5jdGlvbiAoYnV0dG9ucykge1xuICAgICAgdmFyIGZpbHRlcmVkSXRlbUdyb3VwcyA9IG1hcChkZWZhdWx0VG9vbGJhciwgZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IGZpbHRlcihncm91cC5pdGVtcywgZnVuY3Rpb24gKHN1Ykl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gaGFzKGJ1dHRvbnMsIHN1Ykl0ZW0pIHx8IGhhcyhiZXNwb2tlQnV0dG9ucywgc3ViSXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IGdyb3VwLm5hbWUsXG4gICAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmaWx0ZXIoZmlsdGVyZWRJdGVtR3JvdXBzLCBmdW5jdGlvbiAoZ3JvdXApIHtcbiAgICAgICAgcmV0dXJuIGdyb3VwLml0ZW1zLmxlbmd0aCA+IDA7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjb252ZXJ0U3RyaW5nVG9vbGJhciA9IGZ1bmN0aW9uIChzdHJUb29sYmFyKSB7XG4gICAgICB2YXIgZ3JvdXBzU3RyaW5ncyA9IHN0clRvb2xiYXIuc3BsaXQoJ3wnKTtcbiAgICAgIHJldHVybiBtYXAoZ3JvdXBzU3RyaW5ncywgZnVuY3Rpb24gKGcpIHtcbiAgICAgICAgcmV0dXJuIHsgaXRlbXM6IGcudHJpbSgpLnNwbGl0KCcgJykgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzVG9vbGJhckdyb3VwU2V0dGluZ0FycmF5ID0gZnVuY3Rpb24gKHRvb2xiYXIpIHtcbiAgICAgIHJldHVybiBpc0FycmF5T2YodG9vbGJhciwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuIGhhcyh0LCAnbmFtZScpICYmIGhhcyh0LCAnaXRlbXMnKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVRvb2xiYXIgPSBmdW5jdGlvbiAodG9vbGJhckNvbmZpZykge1xuICAgICAgdmFyIHRvb2xiYXIgPSB0b29sYmFyQ29uZmlnLnRvb2xiYXI7XG4gICAgICB2YXIgYnV0dG9ucyA9IHRvb2xiYXJDb25maWcuYnV0dG9ucztcbiAgICAgIGlmICh0b29sYmFyID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9IGVsc2UgaWYgKHRvb2xiYXIgPT09IHVuZGVmaW5lZCB8fCB0b29sYmFyID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiByZW1vdmVVbnVzZWREZWZhdWx0cyhidXR0b25zKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNTdHJpbmcodG9vbGJhcikpIHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRTdHJpbmdUb29sYmFyKHRvb2xiYXIpO1xuICAgICAgfSBlbHNlIGlmIChpc1Rvb2xiYXJHcm91cFNldHRpbmdBcnJheSh0b29sYmFyKSkge1xuICAgICAgICByZXR1cm4gdG9vbGJhcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Rvb2xiYXIgdHlwZSBzaG91bGQgYmUgc3RyaW5nLCBzdHJpbmdbXSwgYm9vbGVhbiBvciBUb29sYmFyR3JvdXBbXScpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbG9va3VwQnV0dG9uID0gZnVuY3Rpb24gKGVkaXRvciwgYnV0dG9ucywgdG9vbGJhckl0ZW0sIGFsbG93VG9vbGJhckdyb3VwcywgZXh0cmFzLCBwcmVmaXhlcykge1xuICAgICAgcmV0dXJuIGdldCQxKGJ1dHRvbnMsIHRvb2xiYXJJdGVtLnRvTG93ZXJDYXNlKCkpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcHJlZml4ZXMuYmluZChmdW5jdGlvbiAocHMpIHtcbiAgICAgICAgICByZXR1cm4gZmluZE1hcChwcywgZnVuY3Rpb24gKHByZWZpeCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldCQxKGJ1dHRvbnMsIHByZWZpeCArIHRvb2xiYXJJdGVtLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0JDEoYmVzcG9rZUJ1dHRvbnMsIHRvb2xiYXJJdGVtLnRvTG93ZXJDYXNlKCkpLm1hcChmdW5jdGlvbiAocikge1xuICAgICAgICAgIHJldHVybiByKGVkaXRvciwgZXh0cmFzKTtcbiAgICAgICAgfSkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgICBpZiAoc3BlYy50eXBlID09PSAnZ3JvdXB0b29sYmFyYnV0dG9uJyAmJiAhYWxsb3dUb29sYmFyR3JvdXBzKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdJZ25vcmluZyB0aGUgXFwnJyArIHRvb2xiYXJJdGVtICsgJ1xcJyB0b29sYmFyIGJ1dHRvbi4gR3JvdXAgdG9vbGJhciBidXR0b25zIGFyZSBvbmx5IHN1cHBvcnRlZCB3aGVuIHVzaW5nIGZsb2F0aW5nIHRvb2xiYXIgbW9kZSBhbmQgY2Fubm90IGJlIG5lc3RlZC4nKTtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBleHRyYWN0RnJvbShzcGVjLCBleHRyYXMsIGVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlkZW50aWZ5QnV0dG9ucyA9IGZ1bmN0aW9uIChlZGl0b3IsIHRvb2xiYXJDb25maWcsIGV4dHJhcywgcHJlZml4ZXMpIHtcbiAgICAgIHZhciB0b29sYmFyR3JvdXBzID0gY3JlYXRlVG9vbGJhcih0b29sYmFyQ29uZmlnKTtcbiAgICAgIHZhciBncm91cHMgPSBtYXAodG9vbGJhckdyb3VwcywgZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IGJpbmQoZ3JvdXAuaXRlbXMsIGZ1bmN0aW9uICh0b29sYmFySXRlbSkge1xuICAgICAgICAgIHJldHVybiB0b29sYmFySXRlbS50cmltKCkubGVuZ3RoID09PSAwID8gW10gOiBsb29rdXBCdXR0b24oZWRpdG9yLCB0b29sYmFyQ29uZmlnLmJ1dHRvbnMsIHRvb2xiYXJJdGVtLCB0b29sYmFyQ29uZmlnLmFsbG93VG9vbGJhckdyb3VwcywgZXh0cmFzLCBwcmVmaXhlcykudG9BcnJheSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0aXRsZTogT3B0aW9uYWwuZnJvbShlZGl0b3IudHJhbnNsYXRlKGdyb3VwLm5hbWUpKSxcbiAgICAgICAgICBpdGVtczogaXRlbXNcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZpbHRlcihncm91cHMsIGZ1bmN0aW9uIChncm91cCkge1xuICAgICAgICByZXR1cm4gZ3JvdXAuaXRlbXMubGVuZ3RoID4gMDtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgYnViYmxlU2l6ZSA9IDEyO1xuICAgIHZhciBidWJibGVBbGlnbm1lbnRzJDEgPSB7XG4gICAgICB2YWxpZ25DZW50cmU6IFtdLFxuICAgICAgYWxpZ25DZW50cmU6IFtdLFxuICAgICAgYWxpZ25MZWZ0OiBbJ3RveC1wb3AtLWFsaWduLWxlZnQnXSxcbiAgICAgIGFsaWduUmlnaHQ6IFsndG94LXBvcC0tYWxpZ24tcmlnaHQnXSxcbiAgICAgIHJpZ2h0OiBbJ3RveC1wb3AtLXJpZ2h0J10sXG4gICAgICBsZWZ0OiBbJ3RveC1wb3AtLWxlZnQnXSxcbiAgICAgIGJvdHRvbTogWyd0b3gtcG9wLS1ib3R0b20nXSxcbiAgICAgIHRvcDogWyd0b3gtcG9wLS10b3AnXVxuICAgIH07XG4gICAgdmFyIGFuY2hvck92ZXJyaWRlcyA9IHtcbiAgICAgIG1heEhlaWdodEZ1bmN0aW9uOiBleHBhbmRhYmxlKCksXG4gICAgICBtYXhXaWR0aEZ1bmN0aW9uOiBleHBhbmRhYmxlJDEoKVxuICAgIH07XG4gICAgdmFyIGRlc2t0b3BBbmNob3JTcGVjTGF5b3V0cyA9IHtcbiAgICAgIG9uTHRyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgbm9ydGgkMSxcbiAgICAgICAgICBzb3V0aCQxLFxuICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoJDMsXG4gICAgICAgICAgc291dGgkMyxcbiAgICAgICAgICBub3J0aGVhc3QkMyxcbiAgICAgICAgICBzb3V0aGVhc3QkMyxcbiAgICAgICAgICBub3J0aHdlc3QkMyxcbiAgICAgICAgICBzb3V0aHdlc3QkM1xuICAgICAgICBdO1xuICAgICAgfSxcbiAgICAgIG9uUnRsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgbm9ydGgkMSxcbiAgICAgICAgICBzb3V0aCQxLFxuICAgICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRoJDMsXG4gICAgICAgICAgc291dGgkMyxcbiAgICAgICAgICBub3J0aHdlc3QkMyxcbiAgICAgICAgICBzb3V0aHdlc3QkMyxcbiAgICAgICAgICBub3J0aGVhc3QkMyxcbiAgICAgICAgICBzb3V0aGVhc3QkM1xuICAgICAgICBdO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG1vYmlsZUFuY2hvclNwZWNMYXlvdXRzID0ge1xuICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBzb3V0aCQxLFxuICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoJDEsXG4gICAgICAgICAgbm9ydGgkMyxcbiAgICAgICAgICBzb3V0aCQzLFxuICAgICAgICAgIG5vcnRoZWFzdCQzLFxuICAgICAgICAgIHNvdXRoZWFzdCQzLFxuICAgICAgICAgIG5vcnRod2VzdCQzLFxuICAgICAgICAgIHNvdXRod2VzdCQzXG4gICAgICAgIF07XG4gICAgICB9LFxuICAgICAgb25SdGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBzb3V0aCQxLFxuICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRoJDEsXG4gICAgICAgICAgbm9ydGgkMyxcbiAgICAgICAgICBzb3V0aCQzLFxuICAgICAgICAgIG5vcnRod2VzdCQzLFxuICAgICAgICAgIHNvdXRod2VzdCQzLFxuICAgICAgICAgIG5vcnRoZWFzdCQzLFxuICAgICAgICAgIHNvdXRoZWFzdCQzXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0QW5jaG9yTGF5b3V0ID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBpc1RvdWNoKSB7XG4gICAgICBpZiAocG9zaXRpb24gPT09ICdsaW5lJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJ1YmJsZTogbnUkOChidWJibGVTaXplLCAwLCBidWJibGVBbGlnbm1lbnRzJDEpLFxuICAgICAgICAgIGxheW91dHM6IHtcbiAgICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbZWFzdCQxXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblJ0bDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gW3dlc3QkMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdmVycmlkZXM6IGFuY2hvck92ZXJyaWRlc1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBidWJibGU6IG51JDgoMCwgYnViYmxlU2l6ZSwgYnViYmxlQWxpZ25tZW50cyQxKSxcbiAgICAgICAgICBsYXlvdXRzOiBpc1RvdWNoID8gbW9iaWxlQW5jaG9yU3BlY0xheW91dHMgOiBkZXNrdG9wQW5jaG9yU3BlY0xheW91dHMsXG4gICAgICAgICAgb3ZlcnJpZGVzOiBhbmNob3JPdmVycmlkZXNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciByZWdpc3RlciQ0ID0gZnVuY3Rpb24gKGVkaXRvciwgcmVnaXN0cnlDb250ZXh0VG9vbGJhcnMsIHNpbmssIGV4dHJhcykge1xuICAgICAgdmFyIGlzVG91Y2ggPSBkZXRlY3QkMygpLmRldmljZVR5cGUuaXNUb3VjaDtcbiAgICAgIHZhciBjb250ZXh0YmFyID0gYnVpbGQkMShyZW5kZXJDb250ZXh0VG9vbGJhcih7XG4gICAgICAgIHNpbms6IHNpbmssXG4gICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICAgIHZhciBnZXRCb3VuZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnZXRDb250ZXh0VG9vbGJhckJvdW5kcyhlZGl0b3IsIGV4dHJhcy5iYWNrc3RhZ2Uuc2hhcmVkKTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNSYW5nZU92ZXJsYXBwaW5nID0gZnVuY3Rpb24gKGFUb3AsIGFCb3R0b20sIGJUb3AsIGJCb3R0b20pIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KGFUb3AsIGJUb3ApIDw9IE1hdGgubWluKGFCb3R0b20sIGJCb3R0b20pO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRMYXN0RWxlbWVudFZlcnRpY2FsQm91bmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub2RlQm91bmRzID0gbGFzdEVsZW1lbnQuZ2V0KCkuZmlsdGVyKGZ1bmN0aW9uIChlbGUpIHtcbiAgICAgICAgICByZXR1cm4gaW5Cb2R5KFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsZSkpO1xuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGVsZSkge1xuICAgICAgICAgIHJldHVybiBlbGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGRpZmZUb3AgPSBlZGl0b3IuaW5saW5lID8gZ2V0JDkoKS50b3AgOiBhYnNvbHV0ZSQxKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXRCb2R5KCkpKS55O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHk6IG5vZGVCb3VuZHMudG9wICsgZGlmZlRvcCxcbiAgICAgICAgICBib3R0b206IG5vZGVCb3VuZHMuYm90dG9tICsgZGlmZlRvcFxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBzaG91bGRDb250ZXh0VG9vbGJhckhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChpc1RvdWNoKCkgJiYgZXh0cmFzLmJhY2tzdGFnZS5pc0NvbnRleHRNZW51T3BlbigpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxhc3RFbGVtZW50Qm91bmRzID0gZ2V0TGFzdEVsZW1lbnRWZXJ0aWNhbEJvdW5kKCk7XG4gICAgICAgIHZhciBjb250ZXh0VG9vbGJhckJvdW5kcyA9IGdldEJvdW5kcygpO1xuICAgICAgICByZXR1cm4gIWlzUmFuZ2VPdmVybGFwcGluZyhsYXN0RWxlbWVudEJvdW5kcy55LCBsYXN0RWxlbWVudEJvdW5kcy5ib3R0b20sIGNvbnRleHRUb29sYmFyQm91bmRzLnksIGNvbnRleHRUb29sYmFyQm91bmRzLmJvdHRvbSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsYXN0QW5jaG9yLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICBJbmxpbmVWaWV3LmhpZGUoY29udGV4dGJhcik7XG4gICAgICB9O1xuICAgICAgdmFyIGZvcmNlSGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgSW5saW5lVmlldy5oaWRlKGNvbnRleHRiYXIpO1xuICAgICAgfTtcbiAgICAgIHZhciBoaWRlT3JSZXBvc2l0aW9uSWZOZWNlc3NhcnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxhc3RBbmNob3IuZ2V0KCkuZWFjaChmdW5jdGlvbiAoYW5jaG9yKSB7XG4gICAgICAgICAgdmFyIGNvbnRleHRCYXJFbGUgPSBjb250ZXh0YmFyLmVsZW1lbnQ7XG4gICAgICAgICAgcmVtb3ZlJDYoY29udGV4dEJhckVsZSwgJ2Rpc3BsYXknKTtcbiAgICAgICAgICBpZiAoc2hvdWxkQ29udGV4dFRvb2xiYXJIaWRlKCkpIHtcbiAgICAgICAgICAgIHNldCQyKGNvbnRleHRCYXJFbGUsICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgUG9zaXRpb25pbmcucG9zaXRpb25XaXRoaW5Cb3VuZHMoc2luaywgYW5jaG9yLCBjb250ZXh0YmFyLCBPcHRpb25hbC5zb21lKGdldEJvdW5kcygpKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgbGFzdEFuY2hvciA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciBsYXN0RWxlbWVudCA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciB0aW1lciA9IENlbGwobnVsbCk7XG4gICAgICB2YXIgd3JhcEluUG9wRGlhbG9nID0gZnVuY3Rpb24gKHRvb2xiYXJTcGVjKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtcG9wX19kaWFsb2cnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcG9uZW50czogW3Rvb2xiYXJTcGVjXSxcbiAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBLZXlpbmcuY29uZmlnKHsgbW9kZTogJ2FjeWNsaWMnIH0pLFxuICAgICAgICAgICAgY29uZmlnKCdwb3AtZGlhbG9nLXdyYXAtZXZlbnRzJywgW1xuICAgICAgICAgICAgICBydW5PbkF0dGFjaGVkKGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLnNob3J0Y3V0cy5hZGQoJ2N0cmwrRjknLCAnZm9jdXMgc3RhdHVzYmFyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIEtleWluZy5mb2N1c0luKGNvbXApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgcnVuT25EZXRhY2hlZChmdW5jdGlvbiAoX2NvbXApIHtcbiAgICAgICAgICAgICAgICBlZGl0b3Iuc2hvcnRjdXRzLnJlbW92ZSgnY3RybCtGOScpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSlcbiAgICAgICAgICBdKVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRTY29wZXMgPSBjYWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2F0ZWdvcmlzZShyZWdpc3RyeUNvbnRleHRUb29sYmFycywgZnVuY3Rpb24gKHRvb2xiYXJBcGkpIHtcbiAgICAgICAgICB2YXIgYWxsb3lTcGVjID0gYnVpbGRUb29sYmFyKFt0b29sYmFyQXBpXSk7XG4gICAgICAgICAgZW1pdFdpdGgoY29udGV4dGJhciwgZm9yd2FyZFNsaWRlRXZlbnQsIHsgZm9yd2FyZENvbnRlbnRzOiB3cmFwSW5Qb3BEaWFsb2coYWxsb3lTcGVjKSB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBidWlsZENvbnRleHRUb29sYmFyR3JvdXBzID0gZnVuY3Rpb24gKGFsbEJ1dHRvbnMsIGN0eCkge1xuICAgICAgICByZXR1cm4gaWRlbnRpZnlCdXR0b25zKGVkaXRvciwge1xuICAgICAgICAgIGJ1dHRvbnM6IGFsbEJ1dHRvbnMsXG4gICAgICAgICAgdG9vbGJhcjogY3R4Lml0ZW1zLFxuICAgICAgICAgIGFsbG93VG9vbGJhckdyb3VwczogZmFsc2VcbiAgICAgICAgfSwgZXh0cmFzLCBPcHRpb25hbC5zb21lKFsnZm9ybTonXSkpO1xuICAgICAgfTtcbiAgICAgIHZhciBidWlsZENvbnRleHRNZW51R3JvdXBzID0gZnVuY3Rpb24gKGN0eCwgcHJvdmlkZXJzKSB7XG4gICAgICAgIHJldHVybiBDb250ZXh0Rm9ybS5idWlsZEluaXRHcm91cHMoY3R4LCBwcm92aWRlcnMpO1xuICAgICAgfTtcbiAgICAgIHZhciBidWlsZFRvb2xiYXIgPSBmdW5jdGlvbiAodG9vbGJhcnMpIHtcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSBlZGl0b3IudWkucmVnaXN0cnkuZ2V0QWxsKCkuYnV0dG9ucztcbiAgICAgICAgdmFyIHNjb3BlcyA9IGdldFNjb3BlcygpO1xuICAgICAgICB2YXIgYWxsQnV0dG9ucyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBidXR0b25zKSwgc2NvcGVzLmZvcm1OYXZpZ2F0b3JzKTtcbiAgICAgICAgdmFyIHRvb2xiYXJUeXBlID0gZ2V0VG9vbGJhck1vZGUoZWRpdG9yKSA9PT0gVG9vbGJhck1vZGUuc2Nyb2xsaW5nID8gVG9vbGJhck1vZGUuc2Nyb2xsaW5nIDogVG9vbGJhck1vZGUuZGVmYXVsdDtcbiAgICAgICAgdmFyIGluaXRHcm91cHMgPSBmbGF0dGVuKG1hcCh0b29sYmFycywgZnVuY3Rpb24gKGN0eCkge1xuICAgICAgICAgIHJldHVybiBjdHgudHlwZSA9PT0gJ2NvbnRleHR0b29sYmFyJyA/IGJ1aWxkQ29udGV4dFRvb2xiYXJHcm91cHMoYWxsQnV0dG9ucywgY3R4KSA6IGJ1aWxkQ29udGV4dE1lbnVHcm91cHMoY3R4LCBleHRyYXMuYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiByZW5kZXJUb29sYmFyKHtcbiAgICAgICAgICB0eXBlOiB0b29sYmFyVHlwZSxcbiAgICAgICAgICB1aWQ6IGdlbmVyYXRlJDEoJ2NvbnRleHQtdG9vbGJhcicpLFxuICAgICAgICAgIGluaXRHcm91cHM6IGluaXRHcm91cHMsXG4gICAgICAgICAgb25Fc2NhcGU6IE9wdGlvbmFsLm5vbmUsXG4gICAgICAgICAgY3ljbGljS2V5aW5nOiB0cnVlLFxuICAgICAgICAgIHByb3ZpZGVyczogZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbihzaG93Q29udGV4dFRvb2xiYXJFdmVudCwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHNjb3BlcyA9IGdldFNjb3BlcygpO1xuICAgICAgICBnZXQkMShzY29wZXMubG9va3VwVGFibGUsIGUudG9vbGJhcktleSkuZWFjaChmdW5jdGlvbiAoY3R4KSB7XG4gICAgICAgICAgbGF1bmNoQ29udGV4dChbY3R4XSwgZS50YXJnZXQgPT09IGVkaXRvciA/IE9wdGlvbmFsLm5vbmUoKSA6IE9wdGlvbmFsLnNvbWUoZSkpO1xuICAgICAgICAgIElubGluZVZpZXcuZ2V0Q29udGVudChjb250ZXh0YmFyKS5lYWNoKEtleWluZy5mb2N1c0luKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBnZXRBbmNob3IgPSBmdW5jdGlvbiAocG9zaXRpb24sIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGFuY2hvcmFnZSA9IHBvc2l0aW9uID09PSAnbm9kZScgPyBleHRyYXMuYmFja3N0YWdlLnNoYXJlZC5hbmNob3JzLm5vZGUoZWxlbWVudCkgOiBleHRyYXMuYmFja3N0YWdlLnNoYXJlZC5hbmNob3JzLmN1cnNvcigpO1xuICAgICAgICByZXR1cm4gZGVlcE1lcmdlKGFuY2hvcmFnZSwgZ2V0QW5jaG9yTGF5b3V0KHBvc2l0aW9uLCBpc1RvdWNoKCkpKTtcbiAgICAgIH07XG4gICAgICB2YXIgbGF1bmNoQ29udGV4dCA9IGZ1bmN0aW9uICh0b29sYmFyQXBpLCBlbGVtKSB7XG4gICAgICAgIGNsZWFyVGltZXIoKTtcbiAgICAgICAgaWYgKGlzVG91Y2goKSAmJiBleHRyYXMuYmFja3N0YWdlLmlzQ29udGV4dE1lbnVPcGVuKCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRvb2xiYXJTcGVjID0gYnVpbGRUb29sYmFyKHRvb2xiYXJBcGkpO1xuICAgICAgICB2YXIgc0VsZW0gPSBlbGVtLm1hcChTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgICAgIHZhciBhbmNob3IgPSBnZXRBbmNob3IodG9vbGJhckFwaVswXS5wb3NpdGlvbiwgc0VsZW0pO1xuICAgICAgICBsYXN0QW5jaG9yLnNldChPcHRpb25hbC5zb21lKGFuY2hvcikpO1xuICAgICAgICBsYXN0RWxlbWVudC5zZXQoZWxlbSk7XG4gICAgICAgIHZhciBjb250ZXh0QmFyRWxlID0gY29udGV4dGJhci5lbGVtZW50O1xuICAgICAgICByZW1vdmUkNihjb250ZXh0QmFyRWxlLCAnZGlzcGxheScpO1xuICAgICAgICBJbmxpbmVWaWV3LnNob3dXaXRoaW5Cb3VuZHMoY29udGV4dGJhciwgYW5jaG9yLCB3cmFwSW5Qb3BEaWFsb2codG9vbGJhclNwZWMpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZ2V0Qm91bmRzKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNob3VsZENvbnRleHRUb29sYmFySGlkZSgpKSB7XG4gICAgICAgICAgc2V0JDIoY29udGV4dEJhckVsZSwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGxhdW5jaENvbnRleHRUb29sYmFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIWVkaXRvci5oYXNGb2N1cygpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzY29wZXMgPSBnZXRTY29wZXMoKTtcbiAgICAgICAgbG9va3VwJDEoc2NvcGVzLCBlZGl0b3IpLmZvbGQoY2xvc2UsIGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgICAgbGF1bmNoQ29udGV4dChpbmZvLnRvb2xiYXJzLCBPcHRpb25hbC5zb21lKGluZm8uZWxlbS5kb20pKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNsZWFyVGltZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdXJyZW50ID0gdGltZXIuZ2V0KCk7XG4gICAgICAgIGlmIChjdXJyZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgZ2xvYmFsJDIuY2xlYXJUaW1lb3V0KGN1cnJlbnQpO1xuICAgICAgICAgIHRpbWVyLnNldChudWxsKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBhc3luY09wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNsZWFyVGltZXIoKTtcbiAgICAgICAgdGltZXIuc2V0KGdsb2JhbCQyLnNldEVkaXRvclRpbWVvdXQoZWRpdG9yLCBsYXVuY2hDb250ZXh0VG9vbGJhciwgMCkpO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZWRpdG9yLm9uKGhpZGVDb250ZXh0VG9vbGJhckV2ZW50LCBmb3JjZUhpZGUpO1xuICAgICAgICBlZGl0b3Iub24oJ1Njcm9sbENvbnRlbnQgU2Nyb2xsV2luZG93IGxvbmdwcmVzcycsIGhpZGVPclJlcG9zaXRpb25JZk5lY2Vzc2FyeSk7XG4gICAgICAgIGVkaXRvci5vbignY2xpY2sga2V5dXAgZm9jdXMgU2V0Q29udGVudCBPYmplY3RSZXNpemVkIFJlc2l6ZUVkaXRvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhc3luY09wZW4oKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRvci5vbignZm9jdXNvdXQnLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgICBnbG9iYWwkMi5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHNlYXJjaChzaW5rLmVsZW1lbnQpLmlzTm9uZSgpICYmIHNlYXJjaChjb250ZXh0YmFyLmVsZW1lbnQpLmlzTm9uZSgpKSB7XG4gICAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3Iub24oJ1N3aXRjaE1vZGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKGVkaXRvci5tb2RlLmlzUmVhZE9ubHkoKSkge1xuICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3Iub24oJ0FmdGVyUHJvZ3Jlc3NTdGF0ZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGlmIChldmVudC5zdGF0ZSkge1xuICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVkaXRvci5oYXNGb2N1cygpKSB7XG4gICAgICAgICAgICBhc3luY09wZW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3Iub24oJ05vZGVDaGFuZ2UnLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgICBzZWFyY2goY29udGV4dGJhci5lbGVtZW50KS5mb2xkKGFzeW5jT3Blbiwgbm9vcCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzZXR1cCQzID0gZnVuY3Rpb24gKGVkaXRvciwgbW90aGVyc2hpcCwgdWlNb3RoZXJzaGlwKSB7XG4gICAgICB2YXIgYnJvYWRjYXN0RXZlbnQgPSBmdW5jdGlvbiAobmFtZSwgZXZ0KSB7XG4gICAgICAgIGVhY2goW1xuICAgICAgICAgIG1vdGhlcnNoaXAsXG4gICAgICAgICAgdWlNb3RoZXJzaGlwXG4gICAgICAgIF0sIGZ1bmN0aW9uIChzaGlwKSB7XG4gICAgICAgICAgc2hpcC5icm9hZGNhc3RFdmVudChuYW1lLCBldnQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgYnJvYWRjYXN0T24gPSBmdW5jdGlvbiAoY2hhbm5lbCwgbWVzc2FnZSkge1xuICAgICAgICBlYWNoKFtcbiAgICAgICAgICBtb3RoZXJzaGlwLFxuICAgICAgICAgIHVpTW90aGVyc2hpcFxuICAgICAgICBdLCBmdW5jdGlvbiAoc2hpcCkge1xuICAgICAgICAgIHNoaXAuYnJvYWRjYXN0T24oW2NoYW5uZWxdLCBtZXNzYWdlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZpcmVEaXNtaXNzUG9wdXBzID0gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICByZXR1cm4gYnJvYWRjYXN0T24oZGlzbWlzc1BvcHVwcygpLCB7IHRhcmdldDogZXZ0LnRhcmdldCB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgb25Ub3VjaHN0YXJ0ID0gYmluZCQzKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRvY3VtZW50KSwgJ3RvdWNoc3RhcnQnLCBmaXJlRGlzbWlzc1BvcHVwcyk7XG4gICAgICB2YXIgb25Ub3VjaG1vdmUgPSBiaW5kJDMoU3VnYXJFbGVtZW50LmZyb21Eb20oZG9jdW1lbnQpLCAndG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICByZXR1cm4gYnJvYWRjYXN0RXZlbnQoZG9jdW1lbnRUb3VjaG1vdmUoKSwgZXZ0KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIG9uVG91Y2hlbmQgPSBiaW5kJDMoU3VnYXJFbGVtZW50LmZyb21Eb20oZG9jdW1lbnQpLCAndG91Y2hlbmQnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgIHJldHVybiBicm9hZGNhc3RFdmVudChkb2N1bWVudFRvdWNoZW5kKCksIGV2dCk7XG4gICAgICB9KTtcbiAgICAgIHZhciBvbk1vdXNlZG93biA9IGJpbmQkMyhTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudCksICdtb3VzZWRvd24nLCBmaXJlRGlzbWlzc1BvcHVwcyk7XG4gICAgICB2YXIgb25Nb3VzZXVwID0gYmluZCQzKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRvY3VtZW50KSwgJ21vdXNldXAnLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgIGlmIChldnQucmF3LmJ1dHRvbiA9PT0gMCkge1xuICAgICAgICAgIGJyb2FkY2FzdE9uKG1vdXNlUmVsZWFzZWQoKSwgeyB0YXJnZXQ6IGV2dC50YXJnZXQgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIG9uQ29udGVudENsaWNrID0gZnVuY3Rpb24gKHJhdykge1xuICAgICAgICByZXR1cm4gYnJvYWRjYXN0T24oZGlzbWlzc1BvcHVwcygpLCB7IHRhcmdldDogU3VnYXJFbGVtZW50LmZyb21Eb20ocmF3LnRhcmdldCkgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uQ29udGVudE1vdXNldXAgPSBmdW5jdGlvbiAocmF3KSB7XG4gICAgICAgIGlmIChyYXcuYnV0dG9uID09PSAwKSB7XG4gICAgICAgICAgYnJvYWRjYXN0T24obW91c2VSZWxlYXNlZCgpLCB7IHRhcmdldDogU3VnYXJFbGVtZW50LmZyb21Eb20ocmF3LnRhcmdldCkgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgb25XaW5kb3dTY3JvbGwgPSBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgIHJldHVybiBicm9hZGNhc3RFdmVudCh3aW5kb3dTY3JvbGwoKSwgZnJvbVJhd0V2ZW50JDEoZXZ0KSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uV2luZG93UmVzaXplID0gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICBicm9hZGNhc3RPbihyZXBvc2l0aW9uUG9wdXBzKCksIHt9KTtcbiAgICAgICAgYnJvYWRjYXN0RXZlbnQod2luZG93UmVzaXplKCksIGZyb21SYXdFdmVudCQxKGV2dCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkVkaXRvclJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGJyb2FkY2FzdE9uKHJlcG9zaXRpb25Qb3B1cHMoKSwge30pO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkVkaXRvclByb2dyZXNzID0gZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICBpZiAoZXZ0LnN0YXRlKSB7XG4gICAgICAgICAgYnJvYWRjYXN0T24oZGlzbWlzc1BvcHVwcygpLCB7IHRhcmdldDogU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldENvbnRhaW5lcigpKSB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbignUG9zdFJlbmRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZWRpdG9yLm9uKCdjbGljaycsIG9uQ29udGVudENsaWNrKTtcbiAgICAgICAgZWRpdG9yLm9uKCd0YXAnLCBvbkNvbnRlbnRDbGljayk7XG4gICAgICAgIGVkaXRvci5vbignbW91c2V1cCcsIG9uQ29udGVudE1vdXNldXApO1xuICAgICAgICBlZGl0b3Iub24oJ1Njcm9sbFdpbmRvdycsIG9uV2luZG93U2Nyb2xsKTtcbiAgICAgICAgZWRpdG9yLm9uKCdSZXNpemVXaW5kb3cnLCBvbldpbmRvd1Jlc2l6ZSk7XG4gICAgICAgIGVkaXRvci5vbignUmVzaXplRWRpdG9yJywgb25FZGl0b3JSZXNpemUpO1xuICAgICAgICBlZGl0b3Iub24oJ0FmdGVyUHJvZ3Jlc3NTdGF0ZScsIG9uRWRpdG9yUHJvZ3Jlc3MpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3Iub24oJ3JlbW92ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZWRpdG9yLm9mZignY2xpY2snLCBvbkNvbnRlbnRDbGljayk7XG4gICAgICAgIGVkaXRvci5vZmYoJ3RhcCcsIG9uQ29udGVudENsaWNrKTtcbiAgICAgICAgZWRpdG9yLm9mZignbW91c2V1cCcsIG9uQ29udGVudE1vdXNldXApO1xuICAgICAgICBlZGl0b3Iub2ZmKCdTY3JvbGxXaW5kb3cnLCBvbldpbmRvd1Njcm9sbCk7XG4gICAgICAgIGVkaXRvci5vZmYoJ1Jlc2l6ZVdpbmRvdycsIG9uV2luZG93UmVzaXplKTtcbiAgICAgICAgZWRpdG9yLm9mZignUmVzaXplRWRpdG9yJywgb25FZGl0b3JSZXNpemUpO1xuICAgICAgICBlZGl0b3Iub2ZmKCdBZnRlclByb2dyZXNzU3RhdGUnLCBvbkVkaXRvclByb2dyZXNzKTtcbiAgICAgICAgb25Nb3VzZWRvd24udW5iaW5kKCk7XG4gICAgICAgIG9uVG91Y2hzdGFydC51bmJpbmQoKTtcbiAgICAgICAgb25Ub3VjaG1vdmUudW5iaW5kKCk7XG4gICAgICAgIG9uVG91Y2hlbmQudW5iaW5kKCk7XG4gICAgICAgIG9uTW91c2V1cC51bmJpbmQoKTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdkZXRhY2gnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRldGFjaFN5c3RlbShtb3RoZXJzaGlwKTtcbiAgICAgICAgZGV0YWNoU3lzdGVtKHVpTW90aGVyc2hpcCk7XG4gICAgICAgIG1vdGhlcnNoaXAuZGVzdHJveSgpO1xuICAgICAgICB1aU1vdGhlcnNoaXAuZGVzdHJveSgpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBwYXJ0cyRkID0gQWxsb3lQYXJ0cztcbiAgICB2YXIgcGFydFR5cGUkMSA9IFBhcnRUeXBlO1xuXG4gICAgdmFyIHNjaGVtYSRyID0gY29uc3RhbnQoW1xuICAgICAgZGVmYXVsdGVkJDEoJ3NoZWxsJywgZmFsc2UpLFxuICAgICAgc3RyaWN0JDEoJ21ha2VJdGVtJyksXG4gICAgICBkZWZhdWx0ZWQkMSgnc2V0dXBJdGVtJywgbm9vcCksXG4gICAgICBTa2V0Y2hCZWhhdmlvdXJzLmZpZWxkKCdsaXN0QmVoYXZpb3VycycsIFtSZXBsYWNpbmddKVxuICAgIF0pO1xuICAgIHZhciBjdXN0b21MaXN0RGV0YWlsID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHsgYmVoYXZpb3VyczogZGVyaXZlJDEoW1JlcGxhY2luZy5jb25maWcoe30pXSkgfTtcbiAgICB9O1xuICAgIHZhciBpdGVtc1BhcnQgPSBvcHRpb25hbCh7XG4gICAgICBuYW1lOiAnaXRlbXMnLFxuICAgICAgb3ZlcnJpZGVzOiBjdXN0b21MaXN0RGV0YWlsXG4gICAgfSk7XG4gICAgdmFyIHBhcnRzJGUgPSBjb25zdGFudChbaXRlbXNQYXJ0XSk7XG4gICAgdmFyIG5hbWUkMiA9IGNvbnN0YW50KCdDdXN0b21MaXN0Jyk7XG5cbiAgICB2YXIgZmFjdG9yeSRmID0gZnVuY3Rpb24gKGRldGFpbCwgY29tcG9uZW50cywgX3NwZWMsIF9leHRlcm5hbCkge1xuICAgICAgdmFyIHNldEl0ZW1zID0gZnVuY3Rpb24gKGxpc3QsIGl0ZW1zKSB7XG4gICAgICAgIGdldExpc3RDb250YWluZXIobGlzdCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignQ3VzdG9tIExpc3Qgd2FzIGRlZmluZWQgdG8gbm90IGJlIGEgc2hlbGwsIGJ1dCBubyBpdGVtIGNvbnRhaW5lciB3YXMgc3BlY2lmaWVkIGluIGNvbXBvbmVudHMnKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0N1c3RvbSBMaXN0IHdhcyBkZWZpbmVkIHRvIG5vdCBiZSBhIHNoZWxsLCBidXQgbm8gaXRlbSBjb250YWluZXIgd2FzIHNwZWNpZmllZCBpbiBjb21wb25lbnRzJyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgICB2YXIgaXRlbUNvbXBzID0gUmVwbGFjaW5nLmNvbnRlbnRzKGNvbnRhaW5lcik7XG4gICAgICAgICAgdmFyIG51bUxpc3RzUmVxdWlyZWQgPSBpdGVtcy5sZW5ndGg7XG4gICAgICAgICAgdmFyIG51bUxpc3RzVG9BZGQgPSBudW1MaXN0c1JlcXVpcmVkIC0gaXRlbUNvbXBzLmxlbmd0aDtcbiAgICAgICAgICB2YXIgaXRlbXNUb0FkZCA9IG51bUxpc3RzVG9BZGQgPiAwID8gcmFuZ2UobnVtTGlzdHNUb0FkZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGRldGFpbC5tYWtlSXRlbSgpO1xuICAgICAgICAgIH0pIDogW107XG4gICAgICAgICAgdmFyIGl0ZW1zVG9SZW1vdmUgPSBpdGVtQ29tcHMuc2xpY2UobnVtTGlzdHNSZXF1aXJlZCk7XG4gICAgICAgICAgZWFjaChpdGVtc1RvUmVtb3ZlLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlcGxhY2luZy5yZW1vdmUoY29udGFpbmVyLCBpdGVtKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBlYWNoKGl0ZW1zVG9BZGQsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVwbGFjaW5nLmFwcGVuZChjb250YWluZXIsIGl0ZW0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZhciBidWlsdExpc3RzID0gUmVwbGFjaW5nLmNvbnRlbnRzKGNvbnRhaW5lcik7XG4gICAgICAgICAgZWFjaChidWlsdExpc3RzLCBmdW5jdGlvbiAoaXRlbSwgaSkge1xuICAgICAgICAgICAgZGV0YWlsLnNldHVwSXRlbShsaXN0LCBpdGVtLCBpdGVtc1tpXSwgaSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBleHRyYSA9IGRldGFpbC5zaGVsbCA/IHtcbiAgICAgICAgYmVoYXZpb3VyczogW1JlcGxhY2luZy5jb25maWcoe30pXSxcbiAgICAgICAgY29tcG9uZW50czogW11cbiAgICAgIH0gOiB7XG4gICAgICAgIGJlaGF2aW91cnM6IFtdLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzXG4gICAgICB9O1xuICAgICAgdmFyIGdldExpc3RDb250YWluZXIgPSBmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiBkZXRhaWwuc2hlbGwgPyBPcHRpb25hbC5zb21lKGNvbXBvbmVudCkgOiBnZXRQYXJ0KGNvbXBvbmVudCwgZGV0YWlsLCAnaXRlbXMnKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogZXh0cmEuY29tcG9uZW50cyxcbiAgICAgICAgYmVoYXZpb3VyczogYXVnbWVudChkZXRhaWwubGlzdEJlaGF2aW91cnMsIGV4dHJhLmJlaGF2aW91cnMpLFxuICAgICAgICBhcGlzOiB7IHNldEl0ZW1zOiBzZXRJdGVtcyB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIEN1c3RvbUxpc3QgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiBuYW1lJDIoKSxcbiAgICAgIGNvbmZpZ0ZpZWxkczogc2NoZW1hJHIoKSxcbiAgICAgIHBhcnRGaWVsZHM6IHBhcnRzJGUoKSxcbiAgICAgIGZhY3Rvcnk6IGZhY3RvcnkkZixcbiAgICAgIGFwaXM6IHtcbiAgICAgICAgc2V0SXRlbXM6IGZ1bmN0aW9uIChhcGlzLCBsaXN0LCBpdGVtcykge1xuICAgICAgICAgIGFwaXMuc2V0SXRlbXMobGlzdCwgaXRlbXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgc2V0dXAkNCA9IG5vb3A7XG4gICAgdmFyIGlzRG9ja2VkID0gbmV2ZXI7XG4gICAgdmFyIGdldEJlaGF2aW91cnMkMiA9IGNvbnN0YW50KFtdKTtcblxuICAgIHZhciBTdGF0aWNIZWFkZXIgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgc2V0dXA6IHNldHVwJDQsXG4gICAgICAgIGlzRG9ja2VkOiBpc0RvY2tlZCxcbiAgICAgICAgZ2V0QmVoYXZpb3VyczogZ2V0QmVoYXZpb3VycyQyXG4gICAgfSk7XG5cbiAgICB2YXIgZ2V0T2Zmc2V0UGFyZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBpc0ZpeGVkID0gZ2V0UmF3KGVsZW1lbnQsICdwb3NpdGlvbicpLmlzKCdmaXhlZCcpO1xuICAgICAgdmFyIG9mZnNldFBhcmVudCQxID0gaXNGaXhlZCA/IE9wdGlvbmFsLm5vbmUoKSA6IG9mZnNldFBhcmVudChlbGVtZW50KTtcbiAgICAgIHJldHVybiBvZmZzZXRQYXJlbnQkMS5vclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1hcmtlciA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdzcGFuJyk7XG4gICAgICAgIHJldHVybiBwYXJlbnQoZWxlbWVudCkuYmluZChmdW5jdGlvbiAocGFyZW50KSB7XG4gICAgICAgICAgYXBwZW5kKHBhcmVudCwgbWFya2VyKTtcbiAgICAgICAgICB2YXIgb2Zmc2V0UGFyZW50JDEgPSBvZmZzZXRQYXJlbnQobWFya2VyKTtcbiAgICAgICAgICByZW1vdmUobWFya2VyKTtcbiAgICAgICAgICByZXR1cm4gb2Zmc2V0UGFyZW50JDE7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3JpZ2luID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBnZXRPZmZzZXRQYXJlbnQoZWxlbWVudCkubWFwKGFic29sdXRlKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24oMCwgMCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG1vcnBoQWR0ID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHsgc3RhdGljOiBbXSB9LFxuICAgICAgeyBhYnNvbHV0ZTogWydwb3NpdGlvbkNzcyddIH0sXG4gICAgICB7IGZpeGVkOiBbJ3Bvc2l0aW9uQ3NzJ10gfVxuICAgIF0pO1xuICAgIHZhciBhcHBlYXIgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb250ZXh0dWFsSW5mbykge1xuICAgICAgdmFyIGVsZW0gPSBjb21wb25lbnQuZWxlbWVudDtcbiAgICAgIGFkZCQyKGVsZW0sIGNvbnRleHR1YWxJbmZvLnRyYW5zaXRpb25DbGFzcyk7XG4gICAgICByZW1vdmUkNChlbGVtLCBjb250ZXh0dWFsSW5mby5mYWRlT3V0Q2xhc3MpO1xuICAgICAgYWRkJDIoZWxlbSwgY29udGV4dHVhbEluZm8uZmFkZUluQ2xhc3MpO1xuICAgICAgY29udGV4dHVhbEluZm8ub25TaG93KGNvbXBvbmVudCk7XG4gICAgfTtcbiAgICB2YXIgZGlzYXBwZWFyID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29udGV4dHVhbEluZm8pIHtcbiAgICAgIHZhciBlbGVtID0gY29tcG9uZW50LmVsZW1lbnQ7XG4gICAgICBhZGQkMihlbGVtLCBjb250ZXh0dWFsSW5mby50cmFuc2l0aW9uQ2xhc3MpO1xuICAgICAgcmVtb3ZlJDQoZWxlbSwgY29udGV4dHVhbEluZm8uZmFkZUluQ2xhc3MpO1xuICAgICAgYWRkJDIoZWxlbSwgY29udGV4dHVhbEluZm8uZmFkZU91dENsYXNzKTtcbiAgICAgIGNvbnRleHR1YWxJbmZvLm9uSGlkZShjb21wb25lbnQpO1xuICAgIH07XG4gICAgdmFyIGlzUGFydGlhbGx5VmlzaWJsZSA9IGZ1bmN0aW9uIChib3gsIHZpZXdwb3J0KSB7XG4gICAgICByZXR1cm4gYm94LnkgPCB2aWV3cG9ydC5ib3R0b20gJiYgYm94LmJvdHRvbSA+IHZpZXdwb3J0Lnk7XG4gICAgfTtcbiAgICB2YXIgaXNUb3BDb21wbGV0ZWx5VmlzaWJsZSA9IGZ1bmN0aW9uIChib3gsIHZpZXdwb3J0KSB7XG4gICAgICByZXR1cm4gYm94LnkgPj0gdmlld3BvcnQueTtcbiAgICB9O1xuICAgIHZhciBpc0JvdHRvbUNvbXBsZXRlbHlWaXNpYmxlID0gZnVuY3Rpb24gKGJveCwgdmlld3BvcnQpIHtcbiAgICAgIHJldHVybiBib3guYm90dG9tIDw9IHZpZXdwb3J0LmJvdHRvbTtcbiAgICB9O1xuICAgIHZhciBpc1Zpc2libGVGb3JNb2RlcyA9IGZ1bmN0aW9uIChtb2RlcywgYm94LCB2aWV3cG9ydCkge1xuICAgICAgcmV0dXJuIGZvcmFsbChtb2RlcywgZnVuY3Rpb24gKG1vZGUpIHtcbiAgICAgICAgc3dpdGNoIChtb2RlKSB7XG4gICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgcmV0dXJuIGlzQm90dG9tQ29tcGxldGVseVZpc2libGUoYm94LCB2aWV3cG9ydCk7XG4gICAgICAgIGNhc2UgJ3RvcCc6XG4gICAgICAgICAgcmV0dXJuIGlzVG9wQ29tcGxldGVseVZpc2libGUoYm94LCB2aWV3cG9ydCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFByaW9yID0gZnVuY3Rpb24gKGVsZW0sIHN0YXRlKSB7XG4gICAgICByZXR1cm4gc3RhdGUuZ2V0SW5pdGlhbFBvc2l0aW9uKCkubWFwKGZ1bmN0aW9uIChwb3MpIHtcbiAgICAgICAgcmV0dXJuIGJvdW5kcyQxKHBvcy5ib3VuZHMueCwgcG9zLmJvdW5kcy55LCBnZXQkOChlbGVtKSwgZ2V0JDcoZWxlbSkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc3RvcmVQcmlvciA9IGZ1bmN0aW9uIChlbGVtLCBib3gsIHN0YXRlKSB7XG4gICAgICBzdGF0ZS5zZXRJbml0aWFsUG9zaXRpb24oT3B0aW9uYWwuc29tZSh7XG4gICAgICAgIHN0eWxlOiBnZXRBbGxSYXcoZWxlbSksXG4gICAgICAgIHBvc2l0aW9uOiBnZXQkNShlbGVtLCAncG9zaXRpb24nKSB8fCAnc3RhdGljJyxcbiAgICAgICAgYm91bmRzOiBib3hcbiAgICAgIH0pKTtcbiAgICB9O1xuICAgIHZhciByZXZlcnRUb09yaWdpbmFsID0gZnVuY3Rpb24gKGVsZW0sIGJveCQxLCBzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlLmdldEluaXRpYWxQb3NpdGlvbigpLmJpbmQoZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgIHN0YXRlLnNldEluaXRpYWxQb3NpdGlvbihPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICBzd2l0Y2ggKHBvc2l0aW9uLnBvc2l0aW9uKSB7XG4gICAgICAgIGNhc2UgJ3N0YXRpYyc6XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUobW9ycGhBZHQuc3RhdGljKCkpO1xuICAgICAgICBjYXNlICdhYnNvbHV0ZSc6XG4gICAgICAgICAgdmFyIG9mZnNldEJveF8xID0gZ2V0T2Zmc2V0UGFyZW50KGVsZW0pLm1hcChib3gpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGJveChib2R5KCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKG1vcnBoQWR0LmFic29sdXRlKE51UG9zaXRpb25Dc3MoJ2Fic29sdXRlJywgZ2V0JDEocG9zaXRpb24uc3R5bGUsICdsZWZ0JykubWFwKGZ1bmN0aW9uIChfbGVmdCkge1xuICAgICAgICAgICAgcmV0dXJuIGJveCQxLnggLSBvZmZzZXRCb3hfMS54O1xuICAgICAgICAgIH0pLCBnZXQkMShwb3NpdGlvbi5zdHlsZSwgJ3RvcCcpLm1hcChmdW5jdGlvbiAoX3RvcCkge1xuICAgICAgICAgICAgcmV0dXJuIGJveCQxLnkgLSBvZmZzZXRCb3hfMS55O1xuICAgICAgICAgIH0pLCBnZXQkMShwb3NpdGlvbi5zdHlsZSwgJ3JpZ2h0JykubWFwKGZ1bmN0aW9uIChfcmlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybiBvZmZzZXRCb3hfMS5yaWdodCAtIGJveCQxLnJpZ2h0O1xuICAgICAgICAgIH0pLCBnZXQkMShwb3NpdGlvbi5zdHlsZSwgJ2JvdHRvbScpLm1hcChmdW5jdGlvbiAoX2JvdHRvbSkge1xuICAgICAgICAgICAgcmV0dXJuIG9mZnNldEJveF8xLmJvdHRvbSAtIGJveCQxLmJvdHRvbTtcbiAgICAgICAgICB9KSkpKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBtb3JwaFRvT3JpZ2luYWwgPSBmdW5jdGlvbiAoZWxlbSwgdmlld3BvcnQsIHN0YXRlKSB7XG4gICAgICByZXR1cm4gZ2V0UHJpb3IoZWxlbSwgc3RhdGUpLmZpbHRlcihmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgIHJldHVybiBpc1Zpc2libGVGb3JNb2RlcyhzdGF0ZS5nZXRNb2RlcygpLCBib3gsIHZpZXdwb3J0KTtcbiAgICAgIH0pLmJpbmQoZnVuY3Rpb24gKGJveCkge1xuICAgICAgICByZXR1cm4gcmV2ZXJ0VG9PcmlnaW5hbChlbGVtLCBib3gsIHN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1vcnBoVG9GaXhlZCA9IGZ1bmN0aW9uIChlbGVtLCB2aWV3cG9ydCwgc3RhdGUpIHtcbiAgICAgIHZhciBib3gkMSA9IGJveChlbGVtKTtcbiAgICAgIGlmICghaXNWaXNpYmxlRm9yTW9kZXMoc3RhdGUuZ2V0TW9kZXMoKSwgYm94JDEsIHZpZXdwb3J0KSkge1xuICAgICAgICBzdG9yZVByaW9yKGVsZW0sIGJveCQxLCBzdGF0ZSk7XG4gICAgICAgIHZhciB3aW5Cb3ggPSB3aW4oKTtcbiAgICAgICAgdmFyIGxlZnQgPSBib3gkMS54IC0gd2luQm94Lng7XG4gICAgICAgIHZhciB0b3BfMSA9IHZpZXdwb3J0LnkgLSB3aW5Cb3gueTtcbiAgICAgICAgdmFyIGJvdHRvbSA9IHdpbkJveC5ib3R0b20gLSB2aWV3cG9ydC5ib3R0b207XG4gICAgICAgIHZhciBpc1RvcCA9IGJveCQxLnkgPD0gdmlld3BvcnQueTtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUobW9ycGhBZHQuZml4ZWQoTnVQb3NpdGlvbkNzcygnZml4ZWQnLCBPcHRpb25hbC5zb21lKGxlZnQpLCBpc1RvcCA/IE9wdGlvbmFsLnNvbWUodG9wXzEpIDogT3B0aW9uYWwubm9uZSgpLCBPcHRpb25hbC5ub25lKCksICFpc1RvcCA/IE9wdGlvbmFsLnNvbWUoYm90dG9tKSA6IE9wdGlvbmFsLm5vbmUoKSkpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0TW9ycGggPSBmdW5jdGlvbiAoY29tcG9uZW50LCB2aWV3cG9ydCwgc3RhdGUpIHtcbiAgICAgIHZhciBlbGVtID0gY29tcG9uZW50LmVsZW1lbnQ7XG4gICAgICB2YXIgaXNEb2NrZWQgPSBnZXRSYXcoZWxlbSwgJ3Bvc2l0aW9uJykuaXMoJ2ZpeGVkJyk7XG4gICAgICByZXR1cm4gaXNEb2NrZWQgPyBtb3JwaFRvT3JpZ2luYWwoZWxlbSwgdmlld3BvcnQsIHN0YXRlKSA6IG1vcnBoVG9GaXhlZChlbGVtLCB2aWV3cG9ydCwgc3RhdGUpO1xuICAgIH07XG4gICAgdmFyIGdldE1vcnBoVG9PcmlnaW5hbCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHN0YXRlKSB7XG4gICAgICB2YXIgZWxlbSA9IGNvbXBvbmVudC5lbGVtZW50O1xuICAgICAgcmV0dXJuIGdldFByaW9yKGVsZW0sIHN0YXRlKS5iaW5kKGZ1bmN0aW9uIChib3gpIHtcbiAgICAgICAgcmV0dXJuIHJldmVydFRvT3JpZ2luYWwoZWxlbSwgYm94LCBzdGF0ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG1vcnBoVG9TdGF0aWMgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb25maWcpIHtcbiAgICAgIGVhY2goW1xuICAgICAgICAnbGVmdCcsXG4gICAgICAgICdyaWdodCcsXG4gICAgICAgICd0b3AnLFxuICAgICAgICAnYm90dG9tJyxcbiAgICAgICAgJ3Bvc2l0aW9uJ1xuICAgICAgXSwgZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgICAgcmV0dXJuIHJlbW92ZSQ2KGNvbXBvbmVudC5lbGVtZW50LCBwcm9wKTtcbiAgICAgIH0pO1xuICAgICAgY29uZmlnLm9uVW5kb2NrZWQoY29tcG9uZW50KTtcbiAgICB9O1xuICAgIHZhciBtb3JwaFRvQ29vcmQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb25maWcsIHBvc2l0aW9uKSB7XG4gICAgICBhcHBseVBvc2l0aW9uQ3NzKGNvbXBvbmVudC5lbGVtZW50LCBwb3NpdGlvbik7XG4gICAgICB2YXIgbWV0aG9kID0gcG9zaXRpb24ucG9zaXRpb24gPT09ICdmaXhlZCcgPyBjb25maWcub25Eb2NrZWQgOiBjb25maWcub25VbmRvY2tlZDtcbiAgICAgIG1ldGhvZChjb21wb25lbnQpO1xuICAgIH07XG4gICAgdmFyIHVwZGF0ZVZpc2liaWxpdHkgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb25maWcsIHN0YXRlLCB2aWV3cG9ydCwgbW9ycGhUb0RvY2tlZCkge1xuICAgICAgaWYgKG1vcnBoVG9Eb2NrZWQgPT09IHZvaWQgMCkge1xuICAgICAgICBtb3JwaFRvRG9ja2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25maWcuY29udGV4dHVhbC5lYWNoKGZ1bmN0aW9uIChjb250ZXh0SW5mbykge1xuICAgICAgICBjb250ZXh0SW5mby5sYXp5Q29udGV4dChjb21wb25lbnQpLmVhY2goZnVuY3Rpb24gKGJveCkge1xuICAgICAgICAgIHZhciBpc1Zpc2libGUgPSBpc1BhcnRpYWxseVZpc2libGUoYm94LCB2aWV3cG9ydCk7XG4gICAgICAgICAgaWYgKGlzVmlzaWJsZSAhPT0gc3RhdGUuaXNWaXNpYmxlKCkpIHtcbiAgICAgICAgICAgIHN0YXRlLnNldFZpc2libGUoaXNWaXNpYmxlKTtcbiAgICAgICAgICAgIGlmIChtb3JwaFRvRG9ja2VkICYmICFpc1Zpc2libGUpIHtcbiAgICAgICAgICAgICAgYWRkJDMoY29tcG9uZW50LmVsZW1lbnQsIFtjb250ZXh0SW5mby5mYWRlT3V0Q2xhc3NdKTtcbiAgICAgICAgICAgICAgY29udGV4dEluZm8ub25IaWRlKGNvbXBvbmVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gaXNWaXNpYmxlID8gYXBwZWFyIDogZGlzYXBwZWFyO1xuICAgICAgICAgICAgICBtZXRob2QoY29tcG9uZW50LCBjb250ZXh0SW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZnJlc2hJbnRlcm5hbCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGNvbmZpZywgc3RhdGUpIHtcbiAgICAgIHZhciB2aWV3cG9ydCA9IGNvbmZpZy5sYXp5Vmlld3BvcnQoY29tcG9uZW50KTtcbiAgICAgIHZhciBpc0RvY2tlZCA9IHN0YXRlLmlzRG9ja2VkKCk7XG4gICAgICBpZiAoaXNEb2NrZWQpIHtcbiAgICAgICAgdXBkYXRlVmlzaWJpbGl0eShjb21wb25lbnQsIGNvbmZpZywgc3RhdGUsIHZpZXdwb3J0KTtcbiAgICAgIH1cbiAgICAgIGdldE1vcnBoKGNvbXBvbmVudCwgdmlld3BvcnQsIHN0YXRlKS5lYWNoKGZ1bmN0aW9uIChtb3JwaCkge1xuICAgICAgICBzdGF0ZS5zZXREb2NrZWQoIWlzRG9ja2VkKTtcbiAgICAgICAgbW9ycGguZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG1vcnBoVG9TdGF0aWMoY29tcG9uZW50LCBjb25maWcpO1xuICAgICAgICB9LCBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgICAgICByZXR1cm4gbW9ycGhUb0Nvb3JkKGNvbXBvbmVudCwgY29uZmlnLCBwb3NpdGlvbik7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChwb3NpdGlvbikge1xuICAgICAgICAgIHVwZGF0ZVZpc2liaWxpdHkoY29tcG9uZW50LCBjb25maWcsIHN0YXRlLCB2aWV3cG9ydCwgdHJ1ZSk7XG4gICAgICAgICAgbW9ycGhUb0Nvb3JkKGNvbXBvbmVudCwgY29uZmlnLCBwb3NpdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVzZXRJbnRlcm5hbCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGNvbmZpZywgc3RhdGUpIHtcbiAgICAgIHZhciBlbGVtID0gY29tcG9uZW50LmVsZW1lbnQ7XG4gICAgICBzdGF0ZS5zZXREb2NrZWQoZmFsc2UpO1xuICAgICAgZ2V0TW9ycGhUb09yaWdpbmFsKGNvbXBvbmVudCwgc3RhdGUpLmVhY2goZnVuY3Rpb24gKG1vcnBoKSB7XG4gICAgICAgIG1vcnBoLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtb3JwaFRvU3RhdGljKGNvbXBvbmVudCwgY29uZmlnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICAgICAgcmV0dXJuIG1vcnBoVG9Db29yZChjb21wb25lbnQsIGNvbmZpZywgcG9zaXRpb24pO1xuICAgICAgICB9LCBub29wKTtcbiAgICAgIH0pO1xuICAgICAgc3RhdGUuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgIGNvbmZpZy5jb250ZXh0dWFsLmVhY2goZnVuY3Rpb24gKGNvbnRleHRJbmZvKSB7XG4gICAgICAgIHJlbW92ZSQ1KGVsZW0sIFtcbiAgICAgICAgICBjb250ZXh0SW5mby5mYWRlSW5DbGFzcyxcbiAgICAgICAgICBjb250ZXh0SW5mby5mYWRlT3V0Q2xhc3MsXG4gICAgICAgICAgY29udGV4dEluZm8udHJhbnNpdGlvbkNsYXNzXG4gICAgICAgIF0pO1xuICAgICAgICBjb250ZXh0SW5mby5vblNob3coY29tcG9uZW50KTtcbiAgICAgIH0pO1xuICAgICAgcmVmcmVzaCQ0KGNvbXBvbmVudCwgY29uZmlnLCBzdGF0ZSk7XG4gICAgfTtcbiAgICB2YXIgcmVmcmVzaCQ0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29uZmlnLCBzdGF0ZSkge1xuICAgICAgaWYgKGNvbXBvbmVudC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgIHJlZnJlc2hJbnRlcm5hbChjb21wb25lbnQsIGNvbmZpZywgc3RhdGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlc2V0ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29uZmlnLCBzdGF0ZSkge1xuICAgICAgaWYgKHN0YXRlLmlzRG9ja2VkKCkpIHtcbiAgICAgICAgcmVzZXRJbnRlcm5hbChjb21wb25lbnQsIGNvbmZpZywgc3RhdGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzRG9ja2VkJDEgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBjb25maWcsIHN0YXRlKSB7XG4gICAgICByZXR1cm4gc3RhdGUuaXNEb2NrZWQoKTtcbiAgICB9O1xuICAgIHZhciBzZXRNb2RlcyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGNvbmZpZywgc3RhdGUsIG1vZGVzKSB7XG4gICAgICByZXR1cm4gc3RhdGUuc2V0TW9kZXMobW9kZXMpO1xuICAgIH07XG4gICAgdmFyIGdldE1vZGVzID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29uZmlnLCBzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlLmdldE1vZGVzKCk7XG4gICAgfTtcblxuICAgIHZhciBEb2NraW5nQXBpcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICByZWZyZXNoOiByZWZyZXNoJDQsXG4gICAgICAgIHJlc2V0OiByZXNldCxcbiAgICAgICAgaXNEb2NrZWQ6IGlzRG9ja2VkJDEsXG4gICAgICAgIGdldE1vZGVzOiBnZXRNb2RlcyxcbiAgICAgICAgc2V0TW9kZXM6IHNldE1vZGVzXG4gICAgfSk7XG5cbiAgICB2YXIgZXZlbnRzJGYgPSBmdW5jdGlvbiAoZG9ja0luZm8sIGRvY2tTdGF0ZSkge1xuICAgICAgcmV0dXJuIGRlcml2ZShbXG4gICAgICAgIHJ1bk9uU291cmNlKHRyYW5zaXRpb25lbmQoKSwgZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICBkb2NrSW5mby5jb250ZXh0dWFsLmVhY2goZnVuY3Rpb24gKGNvbnRleHRJbmZvKSB7XG4gICAgICAgICAgICBpZiAoaGFzJDIoY29tcG9uZW50LmVsZW1lbnQsIGNvbnRleHRJbmZvLnRyYW5zaXRpb25DbGFzcykpIHtcbiAgICAgICAgICAgICAgcmVtb3ZlJDUoY29tcG9uZW50LmVsZW1lbnQsIFtcbiAgICAgICAgICAgICAgICBjb250ZXh0SW5mby50cmFuc2l0aW9uQ2xhc3MsXG4gICAgICAgICAgICAgICAgY29udGV4dEluZm8uZmFkZUluQ2xhc3NcbiAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgIHZhciBub3RpZnkgPSBkb2NrU3RhdGUuaXNWaXNpYmxlKCkgPyBjb250ZXh0SW5mby5vblNob3duIDogY29udGV4dEluZm8ub25IaWRkZW47XG4gICAgICAgICAgICAgIG5vdGlmeShjb21wb25lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KSxcbiAgICAgICAgcnVuKHdpbmRvd1Njcm9sbCgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBfKSB7XG4gICAgICAgICAgcmVmcmVzaCQ0KGNvbXBvbmVudCwgZG9ja0luZm8sIGRvY2tTdGF0ZSk7XG4gICAgICAgIH0pLFxuICAgICAgICBydW4od2luZG93UmVzaXplKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIF8pIHtcbiAgICAgICAgICByZXNldChjb21wb25lbnQsIGRvY2tJbmZvLCBkb2NrU3RhdGUpO1xuICAgICAgICB9KVxuICAgICAgXSk7XG4gICAgfTtcblxuICAgIHZhciBBY3RpdmVEb2NraW5nID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGV2ZW50czogZXZlbnRzJGZcbiAgICB9KTtcblxuICAgIHZhciBEb2NraW5nU2NoZW1hID0gW1xuICAgICAgb3B0aW9uT2JqT2YoJ2NvbnRleHR1YWwnLCBbXG4gICAgICAgIHN0cmljdFN0cmluZygnZmFkZUluQ2xhc3MnKSxcbiAgICAgICAgc3RyaWN0U3RyaW5nKCdmYWRlT3V0Q2xhc3MnKSxcbiAgICAgICAgc3RyaWN0U3RyaW5nKCd0cmFuc2l0aW9uQ2xhc3MnKSxcbiAgICAgICAgc3RyaWN0RnVuY3Rpb24oJ2xhenlDb250ZXh0JyksXG4gICAgICAgIG9uSGFuZGxlcignb25TaG93JyksXG4gICAgICAgIG9uSGFuZGxlcignb25TaG93bicpLFxuICAgICAgICBvbkhhbmRsZXIoJ29uSGlkZScpLFxuICAgICAgICBvbkhhbmRsZXIoJ29uSGlkZGVuJylcbiAgICAgIF0pLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ2xhenlWaWV3cG9ydCcsIHdpbiksXG4gICAgICBkZWZhdWx0ZWRBcnJheU9mKCdtb2RlcycsIFtcbiAgICAgICAgJ3RvcCcsXG4gICAgICAgICdib3R0b20nXG4gICAgICBdLCBzdHJpbmcpLFxuICAgICAgb25IYW5kbGVyKCdvbkRvY2tlZCcpLFxuICAgICAgb25IYW5kbGVyKCdvblVuZG9ja2VkJylcbiAgICBdO1xuXG4gICAgdmFyIGluaXQkYiA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICB2YXIgZG9ja2VkID0gQ2VsbChmYWxzZSk7XG4gICAgICB2YXIgdmlzaWJsZSA9IENlbGwodHJ1ZSk7XG4gICAgICB2YXIgaW5pdGlhbEJvdW5kcyA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciBtb2RlcyA9IENlbGwoc3BlYy5tb2Rlcyk7XG4gICAgICB2YXIgcmVhZFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJ2RvY2tlZDogICcgKyBkb2NrZWQuZ2V0KCkgKyAnLCB2aXNpYmxlOiAnICsgdmlzaWJsZS5nZXQoKSArICcsIG1vZGVzOiAnICsgbW9kZXMuZ2V0KCkuam9pbignLCcpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBudSQ1KHtcbiAgICAgICAgaXNEb2NrZWQ6IGRvY2tlZC5nZXQsXG4gICAgICAgIHNldERvY2tlZDogZG9ja2VkLnNldCxcbiAgICAgICAgZ2V0SW5pdGlhbFBvc2l0aW9uOiBpbml0aWFsQm91bmRzLmdldCxcbiAgICAgICAgc2V0SW5pdGlhbFBvc2l0aW9uOiBpbml0aWFsQm91bmRzLnNldCxcbiAgICAgICAgaXNWaXNpYmxlOiB2aXNpYmxlLmdldCxcbiAgICAgICAgc2V0VmlzaWJsZTogdmlzaWJsZS5zZXQsXG4gICAgICAgIGdldE1vZGVzOiBtb2Rlcy5nZXQsXG4gICAgICAgIHNldE1vZGVzOiBtb2Rlcy5zZXQsXG4gICAgICAgIHJlYWRTdGF0ZTogcmVhZFN0YXRlXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIERvY2tpbmdTdGF0ZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBpbml0OiBpbml0JGJcbiAgICB9KTtcblxuICAgIHZhciBEb2NraW5nID0gY3JlYXRlJDEoe1xuICAgICAgZmllbGRzOiBEb2NraW5nU2NoZW1hLFxuICAgICAgbmFtZTogJ2RvY2tpbmcnLFxuICAgICAgYWN0aXZlOiBBY3RpdmVEb2NraW5nLFxuICAgICAgYXBpczogRG9ja2luZ0FwaXMsXG4gICAgICBzdGF0ZTogRG9ja2luZ1N0YXRlXG4gICAgfSk7XG5cbiAgICB2YXIgdmlzaWJpbGl0eSA9IHtcbiAgICAgIGZhZGVJbkNsYXNzOiAndG94LWVkaXRvci1kb2NrLWZhZGVpbicsXG4gICAgICBmYWRlT3V0Q2xhc3M6ICd0b3gtZWRpdG9yLWRvY2stZmFkZW91dCcsXG4gICAgICB0cmFuc2l0aW9uQ2xhc3M6ICd0b3gtZWRpdG9yLWRvY2stdHJhbnNpdGlvbidcbiAgICB9O1xuICAgIHZhciBlZGl0b3JTdGlja3lPbkNsYXNzID0gJ3RveC10aW55bWNlLS10b29sYmFyLXN0aWNreS1vbic7XG4gICAgdmFyIGVkaXRvclN0aWNreU9mZkNsYXNzID0gJ3RveC10aW55bWNlLS10b29sYmFyLXN0aWNreS1vZmYnO1xuICAgIHZhciBzY3JvbGxGcm9tQmVoaW5kSGVhZGVyID0gZnVuY3Rpb24gKGUsIGNvbnRhaW5lckhlYWRlcikge1xuICAgICAgdmFyIGRvYyA9IG93bmVyKGNvbnRhaW5lckhlYWRlcik7XG4gICAgICB2YXIgdmlld0hlaWdodCA9IGRvYy5kb20uZGVmYXVsdFZpZXcuaW5uZXJIZWlnaHQ7XG4gICAgICB2YXIgc2Nyb2xsUG9zID0gZ2V0JDkoZG9jKTtcbiAgICAgIHZhciBtYXJrZXJFbGVtZW50ID0gU3VnYXJFbGVtZW50LmZyb21Eb20oZS5lbG0pO1xuICAgICAgdmFyIG1hcmtlclBvcyA9IGFic29sdXRlJDEobWFya2VyRWxlbWVudCk7XG4gICAgICB2YXIgbWFya2VySGVpZ2h0ID0gZ2V0JDcobWFya2VyRWxlbWVudCk7XG4gICAgICB2YXIgbWFya2VyVG9wID0gbWFya2VyUG9zLnk7XG4gICAgICB2YXIgbWFya2VyQm90dG9tID0gbWFya2VyVG9wICsgbWFya2VySGVpZ2h0O1xuICAgICAgdmFyIGVkaXRvckhlYWRlclBvcyA9IGFic29sdXRlKGNvbnRhaW5lckhlYWRlcik7XG4gICAgICB2YXIgZWRpdG9ySGVhZGVySGVpZ2h0ID0gZ2V0JDcoY29udGFpbmVySGVhZGVyKTtcbiAgICAgIHZhciBlZGl0b3JIZWFkZXJUb3AgPSBlZGl0b3JIZWFkZXJQb3MudG9wO1xuICAgICAgdmFyIGVkaXRvckhlYWRlckJvdHRvbSA9IGVkaXRvckhlYWRlclRvcCArIGVkaXRvckhlYWRlckhlaWdodDtcbiAgICAgIHZhciBlZGl0b3JIZWFkZXJEb2NrZWRBdFRvcCA9IE1hdGguYWJzKGVkaXRvckhlYWRlclRvcCAtIHNjcm9sbFBvcy50b3ApIDwgMjtcbiAgICAgIHZhciBlZGl0b3JIZWFkZXJEb2NrZWRBdEJvdHRvbSA9IE1hdGguYWJzKGVkaXRvckhlYWRlckJvdHRvbSAtIChzY3JvbGxQb3MudG9wICsgdmlld0hlaWdodCkpIDwgMjtcbiAgICAgIGlmIChlZGl0b3JIZWFkZXJEb2NrZWRBdFRvcCAmJiBtYXJrZXJUb3AgPCBlZGl0b3JIZWFkZXJCb3R0b20pIHtcbiAgICAgICAgdG8oc2Nyb2xsUG9zLmxlZnQsIG1hcmtlclRvcCAtIGVkaXRvckhlYWRlckhlaWdodCwgZG9jKTtcbiAgICAgIH0gZWxzZSBpZiAoZWRpdG9ySGVhZGVyRG9ja2VkQXRCb3R0b20gJiYgbWFya2VyQm90dG9tID4gZWRpdG9ySGVhZGVyVG9wKSB7XG4gICAgICAgIHZhciB5ID0gbWFya2VyVG9wIC0gdmlld0hlaWdodCArIG1hcmtlckhlaWdodCArIGVkaXRvckhlYWRlckhlaWdodDtcbiAgICAgICAgdG8oc2Nyb2xsUG9zLmxlZnQsIHksIGRvYyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaXNEb2NrZWRNb2RlID0gZnVuY3Rpb24gKGhlYWRlciwgbW9kZSkge1xuICAgICAgcmV0dXJuIGNvbnRhaW5zKERvY2tpbmcuZ2V0TW9kZXMoaGVhZGVyKSwgbW9kZSk7XG4gICAgfTtcbiAgICB2YXIgdXBkYXRlSWZyYW1lQ29udGVudEZsb3cgPSBmdW5jdGlvbiAoaGVhZGVyKSB7XG4gICAgICB2YXIgZ2V0T2NjdXBpZWRIZWlnaHQgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgIHJldHVybiBnZXRPdXRlciQxKGVsbSkgKyAocGFyc2VJbnQoZ2V0JDUoZWxtLCAnbWFyZ2luLXRvcCcpLCAxMCkgfHwgMCkgKyAocGFyc2VJbnQoZ2V0JDUoZWxtLCAnbWFyZ2luLWJvdHRvbScpLCAxMCkgfHwgMCk7XG4gICAgICB9O1xuICAgICAgdmFyIGVsbSA9IGhlYWRlci5lbGVtZW50O1xuICAgICAgcGFyZW50KGVsbSkuZWFjaChmdW5jdGlvbiAocGFyZW50RWxlbSkge1xuICAgICAgICB2YXIgcGFkZGluZyA9ICdwYWRkaW5nLScgKyBEb2NraW5nLmdldE1vZGVzKGhlYWRlcilbMF07XG4gICAgICAgIGlmIChEb2NraW5nLmlzRG9ja2VkKGhlYWRlcikpIHtcbiAgICAgICAgICB2YXIgcGFyZW50V2lkdGggPSBnZXQkOChwYXJlbnRFbGVtKTtcbiAgICAgICAgICBzZXQkMihlbG0sICd3aWR0aCcsIHBhcmVudFdpZHRoICsgJ3B4Jyk7XG4gICAgICAgICAgc2V0JDIocGFyZW50RWxlbSwgcGFkZGluZywgZ2V0T2NjdXBpZWRIZWlnaHQoZWxtKSArICdweCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlbW92ZSQ2KGVsbSwgJ3dpZHRoJyk7XG4gICAgICAgICAgcmVtb3ZlJDYocGFyZW50RWxlbSwgcGFkZGluZyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHVwZGF0ZVNpbmtWaXNpYmlsaXR5ID0gZnVuY3Rpb24gKHNpbmtFbGVtLCB2aXNpYmxlKSB7XG4gICAgICBpZiAodmlzaWJsZSkge1xuICAgICAgICByZW1vdmUkNChzaW5rRWxlbSwgdmlzaWJpbGl0eS5mYWRlT3V0Q2xhc3MpO1xuICAgICAgICBhZGQkMyhzaW5rRWxlbSwgW1xuICAgICAgICAgIHZpc2liaWxpdHkudHJhbnNpdGlvbkNsYXNzLFxuICAgICAgICAgIHZpc2liaWxpdHkuZmFkZUluQ2xhc3NcbiAgICAgICAgXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZW1vdmUkNChzaW5rRWxlbSwgdmlzaWJpbGl0eS5mYWRlSW5DbGFzcyk7XG4gICAgICAgIGFkZCQzKHNpbmtFbGVtLCBbXG4gICAgICAgICAgdmlzaWJpbGl0eS5mYWRlT3V0Q2xhc3MsXG4gICAgICAgICAgdmlzaWJpbGl0eS50cmFuc2l0aW9uQ2xhc3NcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgdXBkYXRlRWRpdG9yQ2xhc3NlcyA9IGZ1bmN0aW9uIChlZGl0b3IsIGRvY2tlZCkge1xuICAgICAgdmFyIGVkaXRvckNvbnRhaW5lciA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXRDb250YWluZXIoKSk7XG4gICAgICBpZiAoZG9ja2VkKSB7XG4gICAgICAgIGFkZCQyKGVkaXRvckNvbnRhaW5lciwgZWRpdG9yU3RpY2t5T25DbGFzcyk7XG4gICAgICAgIHJlbW92ZSQ0KGVkaXRvckNvbnRhaW5lciwgZWRpdG9yU3RpY2t5T2ZmQ2xhc3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWRkJDIoZWRpdG9yQ29udGFpbmVyLCBlZGl0b3JTdGlja3lPZmZDbGFzcyk7XG4gICAgICAgIHJlbW92ZSQ0KGVkaXRvckNvbnRhaW5lciwgZWRpdG9yU3RpY2t5T25DbGFzcyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVzdG9yZUZvY3VzID0gZnVuY3Rpb24gKGhlYWRlckVsZW0sIGZvY3VzZWRFbGVtKSB7XG4gICAgICB2YXIgb3duZXJEb2MgPSBvd25lcihmb2N1c2VkRWxlbSk7XG4gICAgICBhY3RpdmUob3duZXJEb2MpLmZpbHRlcihmdW5jdGlvbiAoYWN0aXZlRWxtKSB7XG4gICAgICAgIHJldHVybiAhZXEkMShmb2N1c2VkRWxlbSwgYWN0aXZlRWxtKTtcbiAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoYWN0aXZlRWxtKSB7XG4gICAgICAgIHJldHVybiBlcSQxKGFjdGl2ZUVsbSwgU3VnYXJFbGVtZW50LmZyb21Eb20ob3duZXJEb2MuZG9tLmJvZHkpKSB8fCBjb250YWlucyQyKGhlYWRlckVsZW0sIGFjdGl2ZUVsbSk7XG4gICAgICB9KS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZvY3VzJDEoZm9jdXNlZEVsZW0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmluZEZvY3VzZWRFbGVtID0gZnVuY3Rpb24gKHJvb3RFbG0sIGxhenlTaW5rKSB7XG4gICAgICByZXR1cm4gc2VhcmNoKHJvb3RFbG0pLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbGF6eVNpbmsoKS50b09wdGlvbmFsKCkuYmluZChmdW5jdGlvbiAoc2luaykge1xuICAgICAgICAgIHJldHVybiBzZWFyY2goc2luay5lbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzZXR1cCQ1ID0gZnVuY3Rpb24gKGVkaXRvciwgc2hhcmVkQmFja3N0YWdlLCBsYXp5SGVhZGVyKSB7XG4gICAgICBpZiAoIWVkaXRvci5pbmxpbmUpIHtcbiAgICAgICAgaWYgKCFzaGFyZWRCYWNrc3RhZ2UuaGVhZGVyLmlzUG9zaXRpb25lZEF0VG9wKCkpIHtcbiAgICAgICAgICBlZGl0b3Iub24oJ1Jlc2l6ZUVkaXRvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxhenlIZWFkZXIoKS5lYWNoKERvY2tpbmcucmVzZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVkaXRvci5vbignUmVzaXplV2luZG93IFJlc2l6ZUVkaXRvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBsYXp5SGVhZGVyKCkuZWFjaCh1cGRhdGVJZnJhbWVDb250ZW50Rmxvdyk7XG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3Iub24oJ1NraW5Mb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbGF6eUhlYWRlcigpLmVhY2goZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIERvY2tpbmcuaXNEb2NrZWQoY29tcCkgPyBEb2NraW5nLnJlc2V0KGNvbXApIDogRG9ja2luZy5yZWZyZXNoKGNvbXApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLm9uKCdGdWxsc2NyZWVuU3RhdGVDaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxhenlIZWFkZXIoKS5lYWNoKERvY2tpbmcucmVzZXQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVkaXRvci5vbignQWZ0ZXJTY3JvbGxJbnRvVmlldycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGxhenlIZWFkZXIoKS5lYWNoKGZ1bmN0aW9uIChoZWFkZXIpIHtcbiAgICAgICAgICBEb2NraW5nLnJlZnJlc2goaGVhZGVyKTtcbiAgICAgICAgICB2YXIgaGVhZGVyRWxlbSA9IGhlYWRlci5lbGVtZW50O1xuICAgICAgICAgIGlmIChpc1Zpc2libGUoaGVhZGVyRWxlbSkpIHtcbiAgICAgICAgICAgIHNjcm9sbEZyb21CZWhpbmRIZWFkZXIoZSwgaGVhZGVyRWxlbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdQb3N0UmVuZGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB1cGRhdGVFZGl0b3JDbGFzc2VzKGVkaXRvciwgZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaXNEb2NrZWQkMiA9IGZ1bmN0aW9uIChsYXp5SGVhZGVyKSB7XG4gICAgICByZXR1cm4gbGF6eUhlYWRlcigpLm1hcChEb2NraW5nLmlzRG9ja2VkKS5nZXRPcihmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SWZyYW1lQmVoYXZpb3VycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHJldHVybiBbUmVjZWl2aW5nLmNvbmZpZyh7IGNoYW5uZWxzOiAoX2EgPSB7fSwgX2FbdG9vbGJhckhlaWdodENoYW5nZSgpXSA9IHsgb25SZWNlaXZlOiB1cGRhdGVJZnJhbWVDb250ZW50RmxvdyB9LCBfYSkgfSldO1xuICAgIH07XG4gICAgdmFyIGdldEJlaGF2aW91cnMkMyA9IGZ1bmN0aW9uIChlZGl0b3IsIHNoYXJlZEJhY2tzdGFnZSkge1xuICAgICAgdmFyIGZvY3VzZWRFbG0gPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgbGF6eVNpbmsgPSBzaGFyZWRCYWNrc3RhZ2UuZ2V0U2luaztcbiAgICAgIHZhciBydW5PblNpbmtFbGVtZW50ID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgbGF6eVNpbmsoKS5lYWNoKGZ1bmN0aW9uIChzaW5rKSB7XG4gICAgICAgICAgcmV0dXJuIGYoc2luay5lbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uRG9ja2luZ1N3aXRjaCA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgIGlmICghZWRpdG9yLmlubGluZSkge1xuICAgICAgICAgIHVwZGF0ZUlmcmFtZUNvbnRlbnRGbG93KGNvbXApO1xuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZUVkaXRvckNsYXNzZXMoZWRpdG9yLCBEb2NraW5nLmlzRG9ja2VkKGNvbXApKTtcbiAgICAgICAgY29tcC5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbcmVwb3NpdGlvblBvcHVwcygpXSwge30pO1xuICAgICAgICBsYXp5U2luaygpLmVhY2goZnVuY3Rpb24gKHNpbmspIHtcbiAgICAgICAgICByZXR1cm4gc2luay5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbcmVwb3NpdGlvblBvcHVwcygpXSwge30pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgYWRkaXRpb25hbEJlaGF2aW91cnMgPSBlZGl0b3IuaW5saW5lID8gW10gOiBnZXRJZnJhbWVCZWhhdmlvdXJzKCk7XG4gICAgICByZXR1cm4gX19zcHJlYWRBcnJheXMoW1xuICAgICAgICBGb2N1c2luZy5jb25maWcoe30pLFxuICAgICAgICBEb2NraW5nLmNvbmZpZyh7XG4gICAgICAgICAgY29udGV4dHVhbDogX19hc3NpZ24oe1xuICAgICAgICAgICAgbGF6eUNvbnRleHQ6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIHZhciBoZWFkZXJIZWlnaHQgPSBnZXRPdXRlciQxKGNvbXAuZWxlbWVudCk7XG4gICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlZGl0b3IuaW5saW5lID8gZWRpdG9yLmdldENvbnRlbnRBcmVhQ29udGFpbmVyKCkgOiBlZGl0b3IuZ2V0Q29udGFpbmVyKCk7XG4gICAgICAgICAgICAgIHZhciBib3gkMSA9IGJveChTdWdhckVsZW1lbnQuZnJvbURvbShjb250YWluZXIpKTtcbiAgICAgICAgICAgICAgdmFyIGJveEhlaWdodCA9IGJveCQxLmhlaWdodCAtIGhlYWRlckhlaWdodDtcbiAgICAgICAgICAgICAgdmFyIHRvcEJvdW5kID0gYm94JDEueSArIChpc0RvY2tlZE1vZGUoY29tcCwgJ3RvcCcpID8gMCA6IGhlYWRlckhlaWdodCk7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGJvdW5kcyQxKGJveCQxLngsIHRvcEJvdW5kLCBib3gkMS53aWR0aCwgYm94SGVpZ2h0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJ1bk9uU2lua0VsZW1lbnQoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlU2lua1Zpc2liaWxpdHkoZWxlbSwgdHJ1ZSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uU2hvd246IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIHJ1bk9uU2lua0VsZW1lbnQoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVtb3ZlJDUoZWxlbSwgW1xuICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eS50cmFuc2l0aW9uQ2xhc3MsXG4gICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5LmZhZGVJbkNsYXNzXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBmb2N1c2VkRWxtLmdldCgpLmVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgICByZXN0b3JlRm9jdXMoY29tcC5lbGVtZW50LCBlbGVtKTtcbiAgICAgICAgICAgICAgICBmb2N1c2VkRWxtLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIGZvY3VzZWRFbG0uc2V0KGZpbmRGb2N1c2VkRWxlbShjb21wLmVsZW1lbnQsIGxhenlTaW5rKSk7XG4gICAgICAgICAgICAgIHJ1bk9uU2lua0VsZW1lbnQoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlU2lua1Zpc2liaWxpdHkoZWxlbSwgZmFsc2UpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkhpZGRlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBydW5PblNpbmtFbGVtZW50KGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlbW92ZSQ1KGVsZW0sIFt2aXNpYmlsaXR5LnRyYW5zaXRpb25DbGFzc10pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCB2aXNpYmlsaXR5KSxcbiAgICAgICAgICBtb2RlczogW3NoYXJlZEJhY2tzdGFnZS5oZWFkZXIuZ2V0RG9ja2luZ01vZGUoKV0sXG4gICAgICAgICAgb25Eb2NrZWQ6IG9uRG9ja2luZ1N3aXRjaCxcbiAgICAgICAgICBvblVuZG9ja2VkOiBvbkRvY2tpbmdTd2l0Y2hcbiAgICAgICAgfSlcbiAgICAgIF0sIGFkZGl0aW9uYWxCZWhhdmlvdXJzKTtcbiAgICB9O1xuXG4gICAgdmFyIFN0aWNreUhlYWRlciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBzZXR1cDogc2V0dXAkNSxcbiAgICAgICAgaXNEb2NrZWQ6IGlzRG9ja2VkJDIsXG4gICAgICAgIGdldEJlaGF2aW91cnM6IGdldEJlaGF2aW91cnMkM1xuICAgIH0pO1xuXG4gICAgdmFyIHJlbmRlckhlYWRlciA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICB2YXIgZWRpdG9yID0gc3BlYy5lZGl0b3I7XG4gICAgICB2YXIgZ2V0QmVoYXZpb3VycyA9IHNwZWMuc3RpY2t5ID8gZ2V0QmVoYXZpb3VycyQzIDogZ2V0QmVoYXZpb3VycyQyO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBzcGVjLnVpZCxcbiAgICAgICAgZG9tOiBzcGVjLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogc3BlYy5jb21wb25lbnRzLFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShnZXRCZWhhdmlvdXJzKGVkaXRvciwgc3BlYy5zaGFyZWRCYWNrc3RhZ2UpKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGZhY3RvcnkkZyA9IGZ1bmN0aW9uIChkZXRhaWwsIHNwZWMpIHtcbiAgICAgIHZhciBzZXRNZW51cyA9IGZ1bmN0aW9uIChjb21wLCBtZW51cykge1xuICAgICAgICB2YXIgbmV3TWVudXMgPSBtYXAobWVudXMsIGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgdmFyIGJ1dHRvblNwZWMgPSB7XG4gICAgICAgICAgICB0eXBlOiAnbWVudWJ1dHRvbicsXG4gICAgICAgICAgICB0ZXh0OiBtLnRleHQsXG4gICAgICAgICAgICBmZXRjaDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKG0uZ2V0SXRlbXMoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICB2YXIgaW50ZXJuYWwgPSBjcmVhdGVNZW51QnV0dG9uKGJ1dHRvblNwZWMpLm1hcEVycm9yKGZ1bmN0aW9uIChlcnJJbmZvKSB7XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0RXJyb3IoZXJySW5mbyk7XG4gICAgICAgICAgfSkuZ2V0T3JEaWUoKTtcbiAgICAgICAgICByZXR1cm4gcmVuZGVyTWVudUJ1dHRvbihpbnRlcm5hbCwgJ3RveC1tYnRuJywgc3BlYy5iYWNrc3RhZ2UsIE9wdGlvbmFsLnNvbWUoJ21lbnVpdGVtJykpO1xuICAgICAgICB9KTtcbiAgICAgICAgUmVwbGFjaW5nLnNldChjb21wLCBuZXdNZW51cyk7XG4gICAgICB9O1xuICAgICAgdmFyIGFwaXMgPSB7XG4gICAgICAgIGZvY3VzOiBLZXlpbmcuZm9jdXNJbixcbiAgICAgICAgc2V0TWVudXM6IHNldE1lbnVzXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IFtdLFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgUmVwbGFjaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgY29uZmlnKCdtZW51YmFyLWV2ZW50cycsIFtcbiAgICAgICAgICAgIHJ1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXBvbmVudCkge1xuICAgICAgICAgICAgICBkZXRhaWwub25TZXR1cChjb21wb25lbnQpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydW4obW91c2VvdmVyKCksIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICAgICAgICBkZXNjZW5kYW50JDEoY29tcC5lbGVtZW50LCAnLicgKyAndG94LW1idG4tLWFjdGl2ZScpLmVhY2goZnVuY3Rpb24gKGFjdGl2ZUJ1dHRvbikge1xuICAgICAgICAgICAgICAgIGNsb3Nlc3QkMyhzZS5ldmVudC50YXJnZXQsICcuJyArICd0b3gtbWJ0bicpLmVhY2goZnVuY3Rpb24gKGhvdmVyZWRCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgIGlmICghZXEkMShhY3RpdmVCdXR0b24sIGhvdmVyZWRCdXR0b24pKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXAuZ2V0U3lzdGVtKCkuZ2V0QnlEb20oYWN0aXZlQnV0dG9uKS5lYWNoKGZ1bmN0aW9uIChhY3RpdmVDb21wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29tcC5nZXRTeXN0ZW0oKS5nZXRCeURvbShob3ZlcmVkQnV0dG9uKS5lYWNoKGZ1bmN0aW9uIChob3ZlcmVkQ29tcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgRHJvcGRvd24uZXhwYW5kKGhvdmVyZWRDb21wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIERyb3Bkb3duLmNsb3NlKGFjdGl2ZUNvbXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNpbmcuZm9jdXMoaG92ZXJlZENvbXApO1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ1bihmb2N1c1NoaWZ0ZWQoKSwgZnVuY3Rpb24gKGNvbXAsIHNlKSB7XG4gICAgICAgICAgICAgIHNlLmV2ZW50LnByZXZGb2N1cy5iaW5kKGZ1bmN0aW9uIChwcmV2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbXAuZ2V0U3lzdGVtKCkuZ2V0QnlEb20ocHJldikudG9PcHRpb25hbCgpO1xuICAgICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uIChwcmV2KSB7XG4gICAgICAgICAgICAgICAgc2UuZXZlbnQubmV3Rm9jdXMuYmluZChmdW5jdGlvbiAobnUpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wLmdldFN5c3RlbSgpLmdldEJ5RG9tKG51KS50b09wdGlvbmFsKCk7XG4gICAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAobnUpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChEcm9wZG93bi5pc09wZW4ocHJldikpIHtcbiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd24uZXhwYW5kKG51KTtcbiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd24uY2xvc2UocHJldik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKSxcbiAgICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdmbG93JyxcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyAndG94LW1idG4nLFxuICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIGRldGFpbC5vbkVzY2FwZShjb21wKTtcbiAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KVxuICAgICAgICBdKSxcbiAgICAgICAgYXBpczogYXBpcyxcbiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IGF0dHJpYnV0ZXM6IHsgcm9sZTogJ21lbnViYXInIH0gfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTaWx2ZXJNZW51YmFyID0gc2luZ2xlJDIoe1xuICAgICAgZmFjdG9yeTogZmFjdG9yeSRnLFxuICAgICAgbmFtZTogJ3NpbHZlci5NZW51YmFyJyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogW1xuICAgICAgICBzdHJpY3QkMSgnZG9tJyksXG4gICAgICAgIHN0cmljdCQxKCd1aWQnKSxcbiAgICAgICAgc3RyaWN0JDEoJ29uRXNjYXBlJyksXG4gICAgICAgIHN0cmljdCQxKCdiYWNrc3RhZ2UnKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ29uU2V0dXAnLCBub29wKVxuICAgICAgXSxcbiAgICAgIGFwaXM6IHtcbiAgICAgICAgZm9jdXM6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgYXBpcy5mb2N1cyhjb21wKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0TWVudXM6IGZ1bmN0aW9uIChhcGlzLCBjb21wLCBtZW51cykge1xuICAgICAgICAgIGFwaXMuc2V0TWVudXMoY29tcCwgbWVudXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgb3duZXIkNCA9ICdjb250YWluZXInO1xuICAgIHZhciBzY2hlbWEkcyA9IFtmaWVsZCQxKCdzbG90QmVoYXZpb3VycycsIFtdKV07XG4gICAgdmFyIGdldFBhcnROYW1lJDEgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgcmV0dXJuICc8YWxsb3kuZmllbGQuJyArIG5hbWUgKyAnPic7XG4gICAgfTtcbiAgICB2YXIgc2tldGNoJDIgPSBmdW5jdGlvbiAoc1NwZWMpIHtcbiAgICAgIHZhciBwYXJ0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJlY29yZCA9IFtdO1xuICAgICAgICB2YXIgc2xvdCA9IGZ1bmN0aW9uIChuYW1lLCBjb25maWcpIHtcbiAgICAgICAgICByZWNvcmQucHVzaChuYW1lKTtcbiAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVPbmUob3duZXIkNCwgZ2V0UGFydE5hbWUkMShuYW1lKSwgY29uZmlnKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzbG90OiBzbG90LFxuICAgICAgICAgIHJlY29yZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KCk7XG4gICAgICB2YXIgc3BlYyA9IHNTcGVjKHBhcnRzKTtcbiAgICAgIHZhciBwYXJ0TmFtZXMgPSBwYXJ0cy5yZWNvcmQoKTtcbiAgICAgIHZhciBmaWVsZFBhcnRzID0gbWFwKHBhcnROYW1lcywgZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIHJlcXVpcmVkKHtcbiAgICAgICAgICBuYW1lOiBuLFxuICAgICAgICAgIHBuYW1lOiBnZXRQYXJ0TmFtZSQxKG4pXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gY29tcG9zaXRlKG93bmVyJDQsIHNjaGVtYSRzLCBmaWVsZFBhcnRzLCBtYWtlJDcsIHNwZWMpO1xuICAgIH07XG4gICAgdmFyIG1ha2UkNyA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMpIHtcbiAgICAgIHZhciBnZXRTbG90TmFtZXMgPSBmdW5jdGlvbiAoXykge1xuICAgICAgICByZXR1cm4gZ2V0QWxsUGFydE5hbWVzKGRldGFpbCk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFNsb3QgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuIGdldFBhcnQoY29udGFpbmVyLCBkZXRhaWwsIGtleSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uU2xvdCA9IGZ1bmN0aW9uIChmLCBkZWYpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb250YWluZXIsIGtleSkge1xuICAgICAgICAgIHJldHVybiBnZXRQYXJ0KGNvbnRhaW5lciwgZGV0YWlsLCBrZXkpLm1hcChmdW5jdGlvbiAoc2xvdCkge1xuICAgICAgICAgICAgcmV0dXJuIGYoc2xvdCwga2V5KTtcbiAgICAgICAgICB9KS5nZXRPcihkZWYpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBvblNsb3RzID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb250YWluZXIsIGtleXMpIHtcbiAgICAgICAgICBlYWNoKGtleXMsIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBmKGNvbnRhaW5lciwga2V5KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZG9TaG93aW5nID0gZnVuY3Rpb24gKGNvbXAsIF9rZXkpIHtcbiAgICAgICAgcmV0dXJuIGdldCQzKGNvbXAuZWxlbWVudCwgJ2FyaWEtaGlkZGVuJykgIT09ICd0cnVlJztcbiAgICAgIH07XG4gICAgICB2YXIgZG9TaG93ID0gZnVuY3Rpb24gKGNvbXAsIGtleSkge1xuICAgICAgICBpZiAoIWRvU2hvd2luZyhjb21wKSkge1xuICAgICAgICAgIHZhciBlbGVtZW50ID0gY29tcC5lbGVtZW50O1xuICAgICAgICAgIHJlbW92ZSQ2KGVsZW1lbnQsICdkaXNwbGF5Jyk7XG4gICAgICAgICAgcmVtb3ZlJDEoZWxlbWVudCwgJ2FyaWEtaGlkZGVuJyk7XG4gICAgICAgICAgZW1pdFdpdGgoY29tcCwgc2xvdFZpc2liaWxpdHkoKSwge1xuICAgICAgICAgICAgbmFtZToga2V5LFxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGRvSGlkZSA9IGZ1bmN0aW9uIChjb21wLCBrZXkpIHtcbiAgICAgICAgaWYgKGRvU2hvd2luZyhjb21wKSkge1xuICAgICAgICAgIHZhciBlbGVtZW50ID0gY29tcC5lbGVtZW50O1xuICAgICAgICAgIHNldCQyKGVsZW1lbnQsICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICBzZXQkMShlbGVtZW50LCAnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgICAgIGVtaXRXaXRoKGNvbXAsIHNsb3RWaXNpYmlsaXR5KCksIHtcbiAgICAgICAgICAgIG5hbWU6IGtleSxcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgaXNTaG93aW5nID0gb25TbG90KGRvU2hvd2luZywgZmFsc2UpO1xuICAgICAgdmFyIGhpZGVTbG90ID0gb25TbG90KGRvSGlkZSk7XG4gICAgICB2YXIgaGlkZVNsb3RzID0gb25TbG90cyhoaWRlU2xvdCk7XG4gICAgICB2YXIgaGlkZUFsbFNsb3RzID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICByZXR1cm4gaGlkZVNsb3RzKGNvbnRhaW5lciwgZ2V0U2xvdE5hbWVzKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBzaG93U2xvdCA9IG9uU2xvdChkb1Nob3cpO1xuICAgICAgdmFyIGFwaXMgPSB7XG4gICAgICAgIGdldFNsb3ROYW1lczogZ2V0U2xvdE5hbWVzLFxuICAgICAgICBnZXRTbG90OiBnZXRTbG90LFxuICAgICAgICBpc1Nob3dpbmc6IGlzU2hvd2luZyxcbiAgICAgICAgaGlkZVNsb3Q6IGhpZGVTbG90LFxuICAgICAgICBoaWRlQWxsU2xvdHM6IGhpZGVBbGxTbG90cyxcbiAgICAgICAgc2hvd1Nsb3Q6IHNob3dTbG90XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHMsXG4gICAgICAgIGJlaGF2aW91cnM6IGdldCRkKGRldGFpbC5zbG90QmVoYXZpb3VycyksXG4gICAgICAgIGFwaXM6IGFwaXNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2xvdEFwaXMgPSBtYXAkMih7XG4gICAgICBnZXRTbG90TmFtZXM6IGZ1bmN0aW9uIChhcGlzLCBjKSB7XG4gICAgICAgIHJldHVybiBhcGlzLmdldFNsb3ROYW1lcyhjKTtcbiAgICAgIH0sXG4gICAgICBnZXRTbG90OiBmdW5jdGlvbiAoYXBpcywgYywga2V5KSB7XG4gICAgICAgIHJldHVybiBhcGlzLmdldFNsb3QoYywga2V5KTtcbiAgICAgIH0sXG4gICAgICBpc1Nob3dpbmc6IGZ1bmN0aW9uIChhcGlzLCBjLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuIGFwaXMuaXNTaG93aW5nKGMsIGtleSk7XG4gICAgICB9LFxuICAgICAgaGlkZVNsb3Q6IGZ1bmN0aW9uIChhcGlzLCBjLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuIGFwaXMuaGlkZVNsb3QoYywga2V5KTtcbiAgICAgIH0sXG4gICAgICBoaWRlQWxsU2xvdHM6IGZ1bmN0aW9uIChhcGlzLCBjKSB7XG4gICAgICAgIHJldHVybiBhcGlzLmhpZGVBbGxTbG90cyhjKTtcbiAgICAgIH0sXG4gICAgICBzaG93U2xvdDogZnVuY3Rpb24gKGFwaXMsIGMsIGtleSkge1xuICAgICAgICByZXR1cm4gYXBpcy5zaG93U2xvdChjLCBrZXkpO1xuICAgICAgfVxuICAgIH0sIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIG1ha2VBcGkodmFsdWUpO1xuICAgIH0pO1xuICAgIHZhciBTbG90Q29udGFpbmVyID0gX19hc3NpZ24oX19hc3NpZ24oe30sIHNsb3RBcGlzKSwgeyBza2V0Y2g6IHNrZXRjaCQyIH0pO1xuXG4gICAgdmFyIHNpZGViYXJTY2hlbWEgPSBvYmpPZihbXG4gICAgICBvcHRpb25TdHJpbmcoJ2ljb24nKSxcbiAgICAgIG9wdGlvblN0cmluZygndG9vbHRpcCcpLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uU2hvdycsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uSGlkZScsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uU2V0dXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBub29wO1xuICAgICAgfSlcbiAgICBdKTtcbiAgICB2YXIgY3JlYXRlU2lkZWJhciA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ3NpZGViYXInLCBzaWRlYmFyU2NoZW1hLCBzcGVjKTtcbiAgICB9O1xuXG4gICAgdmFyIHNldHVwJDYgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgc2lkZWJhcnMgPSBlZGl0b3IudWkucmVnaXN0cnkuZ2V0QWxsKCkuc2lkZWJhcnM7XG4gICAgICBlYWNoKGtleXMoc2lkZWJhcnMpLCBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgc3BlYyA9IHNpZGViYXJzW25hbWVdO1xuICAgICAgICB2YXIgaXNBY3RpdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZWRpdG9yLnF1ZXJ5Q29tbWFuZFZhbHVlKCdUb2dnbGVTaWRlYmFyJykpLmlzKG5hbWUpO1xuICAgICAgICB9O1xuICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkVG9nZ2xlQnV0dG9uKG5hbWUsIHtcbiAgICAgICAgICBpY29uOiBzcGVjLmljb24sXG4gICAgICAgICAgdG9vbHRpcDogc3BlYy50b29sdGlwLFxuICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoYnV0dG9uQXBpKSB7XG4gICAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ1RvZ2dsZVNpZGViYXInLCBmYWxzZSwgbmFtZSk7XG4gICAgICAgICAgICBidXR0b25BcGkuc2V0QWN0aXZlKGlzQWN0aXZlKCkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGJ1dHRvbkFwaSkge1xuICAgICAgICAgICAgdmFyIGhhbmRsZVRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbkFwaS5zZXRBY3RpdmUoaXNBY3RpdmUoKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZWRpdG9yLm9uKCdUb2dnbGVTaWRlYmFyJywgaGFuZGxlVG9nZ2xlKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGVkaXRvci5vZmYoJ1RvZ2dsZVNpZGViYXInLCBoYW5kbGVUb2dnbGUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0QXBpID0gZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY29tcC5lbGVtZW50LmRvbTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBtYWtlUGFuZWxzID0gZnVuY3Rpb24gKHBhcnRzLCBwYW5lbENvbmZpZ3MpIHtcbiAgICAgIHZhciBzcGVjcyA9IG1hcChrZXlzKHBhbmVsQ29uZmlncyksIGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBzcGVjID0gcGFuZWxDb25maWdzW25hbWVdO1xuICAgICAgICB2YXIgYnJpZGdlZCA9IGdldE9yRGllKGNyZWF0ZVNpZGViYXIoc3BlYykpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgZ2V0QXBpOiBnZXRBcGksXG4gICAgICAgICAgb25TZXR1cDogYnJpZGdlZC5vblNldHVwLFxuICAgICAgICAgIG9uU2hvdzogYnJpZGdlZC5vblNob3csXG4gICAgICAgICAgb25IaWRlOiBicmlkZ2VkLm9uSGlkZVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gbWFwKHNwZWNzLCBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgICB2YXIgZWRpdG9yT2ZmQ2VsbCA9IENlbGwobm9vcCk7XG4gICAgICAgIHJldHVybiBwYXJ0cy5zbG90KHNwZWMubmFtZSwge1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LXNpZGViYXJfX3BhbmUnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYmVoYXZpb3VyczogU2ltcGxlQmVoYXZpb3Vycy51bm5hbWVkRXZlbnRzKFtcbiAgICAgICAgICAgIG9uQ29udHJvbEF0dGFjaGVkKHNwZWMsIGVkaXRvck9mZkNlbGwpLFxuICAgICAgICAgICAgb25Db250cm9sRGV0YWNoZWQoc3BlYywgZWRpdG9yT2ZmQ2VsbCksXG4gICAgICAgICAgICBydW4oc2xvdFZpc2liaWxpdHkoKSwgZnVuY3Rpb24gKHNpZGVwYW5lbCwgc2UpIHtcbiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBzZS5ldmVudDtcbiAgICAgICAgICAgICAgdmFyIG9wdFNpZGVQYW5lbFNwZWMgPSBmaW5kKHNwZWNzLCBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5uYW1lID09PSBkYXRhLm5hbWU7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBvcHRTaWRlUGFuZWxTcGVjLmVhY2goZnVuY3Rpb24gKHNpZGVQYW5lbFNwZWMpIHtcbiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlciA9IGRhdGEudmlzaWJsZSA/IHNpZGVQYW5lbFNwZWMub25TaG93IDogc2lkZVBhbmVsU3BlYy5vbkhpZGU7XG4gICAgICAgICAgICAgICAgaGFuZGxlcihzaWRlUGFuZWxTcGVjLmdldEFwaShzaWRlcGFuZWwpKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF0pXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWFrZVNpZGViYXIgPSBmdW5jdGlvbiAocGFuZWxDb25maWdzKSB7XG4gICAgICByZXR1cm4gU2xvdENvbnRhaW5lci5za2V0Y2goZnVuY3Rpb24gKHBhcnRzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtc2lkZWJhcl9fcGFuZS1jb250YWluZXInXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcG9uZW50czogbWFrZVBhbmVscyhwYXJ0cywgcGFuZWxDb25maWdzKSxcbiAgICAgICAgICBzbG90QmVoYXZpb3VyczogU2ltcGxlQmVoYXZpb3Vycy51bm5hbWVkRXZlbnRzKFtydW5PbkF0dGFjaGVkKGZ1bmN0aW9uIChzbG90Q29udGFpbmVyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBTbG90Q29udGFpbmVyLmhpZGVBbGxTbG90cyhzbG90Q29udGFpbmVyKTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHNldFNpZGViYXIgPSBmdW5jdGlvbiAoc2lkZWJhciwgcGFuZWxDb25maWdzKSB7XG4gICAgICB2YXIgb3B0U2xpZGVyID0gQ29tcG9zaW5nLmdldEN1cnJlbnQoc2lkZWJhcik7XG4gICAgICBvcHRTbGlkZXIuZWFjaChmdW5jdGlvbiAoc2xpZGVyKSB7XG4gICAgICAgIHJldHVybiBSZXBsYWNpbmcuc2V0KHNsaWRlciwgW21ha2VTaWRlYmFyKHBhbmVsQ29uZmlncyldKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRvZ2dsZVNpZGViYXIgPSBmdW5jdGlvbiAoc2lkZWJhciwgbmFtZSkge1xuICAgICAgdmFyIG9wdFNsaWRlciA9IENvbXBvc2luZy5nZXRDdXJyZW50KHNpZGViYXIpO1xuICAgICAgb3B0U2xpZGVyLmVhY2goZnVuY3Rpb24gKHNsaWRlcikge1xuICAgICAgICB2YXIgb3B0U2xvdENvbnRhaW5lciA9IENvbXBvc2luZy5nZXRDdXJyZW50KHNsaWRlcik7XG4gICAgICAgIG9wdFNsb3RDb250YWluZXIuZWFjaChmdW5jdGlvbiAoc2xvdENvbnRhaW5lcikge1xuICAgICAgICAgIGlmIChTbGlkaW5nLmhhc0dyb3duKHNsaWRlcikpIHtcbiAgICAgICAgICAgIGlmIChTbG90Q29udGFpbmVyLmlzU2hvd2luZyhzbG90Q29udGFpbmVyLCBuYW1lKSkge1xuICAgICAgICAgICAgICBTbGlkaW5nLnNocmluayhzbGlkZXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgU2xvdENvbnRhaW5lci5oaWRlQWxsU2xvdHMoc2xvdENvbnRhaW5lcik7XG4gICAgICAgICAgICAgIFNsb3RDb250YWluZXIuc2hvd1Nsb3Qoc2xvdENvbnRhaW5lciwgbmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFNsb3RDb250YWluZXIuaGlkZUFsbFNsb3RzKHNsb3RDb250YWluZXIpO1xuICAgICAgICAgICAgU2xvdENvbnRhaW5lci5zaG93U2xvdChzbG90Q29udGFpbmVyLCBuYW1lKTtcbiAgICAgICAgICAgIFNsaWRpbmcuZ3JvdyhzbGlkZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB3aGljaFNpZGViYXIgPSBmdW5jdGlvbiAoc2lkZWJhcikge1xuICAgICAgdmFyIG9wdFNsaWRlciA9IENvbXBvc2luZy5nZXRDdXJyZW50KHNpZGViYXIpO1xuICAgICAgcmV0dXJuIG9wdFNsaWRlci5iaW5kKGZ1bmN0aW9uIChzbGlkZXIpIHtcbiAgICAgICAgdmFyIHNpZGViYXJPcGVuID0gU2xpZGluZy5pc0dyb3dpbmcoc2xpZGVyKSB8fCBTbGlkaW5nLmhhc0dyb3duKHNsaWRlcik7XG4gICAgICAgIGlmIChzaWRlYmFyT3Blbikge1xuICAgICAgICAgIHZhciBvcHRTbG90Q29udGFpbmVyID0gQ29tcG9zaW5nLmdldEN1cnJlbnQoc2xpZGVyKTtcbiAgICAgICAgICByZXR1cm4gb3B0U2xvdENvbnRhaW5lci5iaW5kKGZ1bmN0aW9uIChzbG90Q29udGFpbmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZmluZChTbG90Q29udGFpbmVyLmdldFNsb3ROYW1lcyhzbG90Q29udGFpbmVyKSwgZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFNsb3RDb250YWluZXIuaXNTaG93aW5nKHNsb3RDb250YWluZXIsIG5hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZml4U2l6ZSA9IGdlbmVyYXRlJDEoJ0ZpeFNpemVFdmVudCcpO1xuICAgIHZhciBhdXRvU2l6ZSA9IGdlbmVyYXRlJDEoJ0F1dG9TaXplRXZlbnQnKTtcbiAgICB2YXIgcmVuZGVyU2lkZWJhciA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IHNwZWMudWlkLFxuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXNpZGViYXInXSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHJvbGU6ICdjb21wbGVtZW50YXJ5JyB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtc2lkZWJhcl9fc2xpZGVyJ11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbXSxcbiAgICAgICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICAgICAgU2xpZGluZy5jb25maWcoe1xuICAgICAgICAgICAgICAgIGRpbWVuc2lvbjogeyBwcm9wZXJ0eTogJ3dpZHRoJyB9LFxuICAgICAgICAgICAgICAgIGNsb3NlZENsYXNzOiAndG94LXNpZGViYXItLXNsaWRpbmctY2xvc2VkJyxcbiAgICAgICAgICAgICAgICBvcGVuQ2xhc3M6ICd0b3gtc2lkZWJhci0tc2xpZGluZy1vcGVuJyxcbiAgICAgICAgICAgICAgICBzaHJpbmtpbmdDbGFzczogJ3RveC1zaWRlYmFyLS1zbGlkaW5nLXNocmlua2luZycsXG4gICAgICAgICAgICAgICAgZ3Jvd2luZ0NsYXNzOiAndG94LXNpZGViYXItLXNsaWRpbmctZ3Jvd2luZycsXG4gICAgICAgICAgICAgICAgb25TaHJ1bms6IGZ1bmN0aW9uIChzbGlkZXIpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBvcHRTbG90Q29udGFpbmVyID0gQ29tcG9zaW5nLmdldEN1cnJlbnQoc2xpZGVyKTtcbiAgICAgICAgICAgICAgICAgIG9wdFNsb3RDb250YWluZXIuZWFjaChTbG90Q29udGFpbmVyLmhpZGVBbGxTbG90cyk7XG4gICAgICAgICAgICAgICAgICBlbWl0KHNsaWRlciwgYXV0b1NpemUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25Hcm93bjogZnVuY3Rpb24gKHNsaWRlcikge1xuICAgICAgICAgICAgICAgICAgZW1pdChzbGlkZXIsIGF1dG9TaXplKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uU3RhcnRHcm93OiBmdW5jdGlvbiAoc2xpZGVyKSB7XG4gICAgICAgICAgICAgICAgICBlbWl0V2l0aChzbGlkZXIsIGZpeFNpemUsIHsgd2lkdGg6IGdldFJhdyhzbGlkZXIuZWxlbWVudCwgJ3dpZHRoJykuZ2V0T3IoJycpIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25TdGFydFNocmluazogZnVuY3Rpb24gKHNsaWRlcikge1xuICAgICAgICAgICAgICAgICAgZW1pdFdpdGgoc2xpZGVyLCBmaXhTaXplLCB7IHdpZHRoOiBnZXQkOChzbGlkZXIuZWxlbWVudCkgKyAncHgnIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIFJlcGxhY2luZy5jb25maWcoe30pLFxuICAgICAgICAgICAgICBDb21wb3NpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgICBmaW5kOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gUmVwbGFjaW5nLmNvbnRlbnRzKGNvbXApO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlYWQoY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgfV0sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBDb21wb3NpbmdDb25maWdzLmNoaWxkQXQoMCksXG4gICAgICAgICAgY29uZmlnKCdzaWRlYmFyLXNsaWRpbmctZXZlbnRzJywgW1xuICAgICAgICAgICAgcnVuKGZpeFNpemUsIGZ1bmN0aW9uIChjb21wLCBzZSkge1xuICAgICAgICAgICAgICBzZXQkMihjb21wLmVsZW1lbnQsICd3aWR0aCcsIHNlLmV2ZW50LndpZHRoKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcnVuKGF1dG9TaXplLCBmdW5jdGlvbiAoY29tcCwgX3NlKSB7XG4gICAgICAgICAgICAgIHJlbW92ZSQ2KGNvbXAuZWxlbWVudCwgJ3dpZHRoJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF0pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2V0QXR0cnMgPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBlbGVtLmRvbS5hdHRyaWJ1dGVzICE9PSB1bmRlZmluZWQgPyBlbGVtLmRvbS5hdHRyaWJ1dGVzIDogW107XG4gICAgICByZXR1cm4gZm9sZGwoYXR0cmlidXRlcywgZnVuY3Rpb24gKGIsIGF0dHIpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoYXR0ci5uYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICAgICAgcmV0dXJuIGI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBiKSwgKF9hID0ge30sIF9hW2F0dHIubmFtZV0gPSBhdHRyLnZhbHVlLCBfYSkpO1xuICAgICAgICB9XG4gICAgICB9LCB7fSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2xhc3NlcyA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZWxlbS5kb20uY2xhc3NMaXN0LCAwKTtcbiAgICB9O1xuICAgIHZhciBmcm9tSHRtbCQyID0gZnVuY3Rpb24gKGh0bWwpIHtcbiAgICAgIHZhciBlbGVtID0gU3VnYXJFbGVtZW50LmZyb21IdG1sKGh0bWwpO1xuICAgICAgdmFyIGNoaWxkcmVuJDEgPSBjaGlsZHJlbihlbGVtKTtcbiAgICAgIHZhciBhdHRycyA9IGdldEF0dHJzKGVsZW0pO1xuICAgICAgdmFyIGNsYXNzZXMgPSBnZXRDbGFzc2VzKGVsZW0pO1xuICAgICAgdmFyIGNvbnRlbnRzID0gY2hpbGRyZW4kMS5sZW5ndGggPT09IDAgPyB7fSA6IHsgaW5uZXJIdG1sOiBnZXQkMihlbGVtKSB9O1xuICAgICAgcmV0dXJuIF9fYXNzaWduKHtcbiAgICAgICAgdGFnOiBuYW1lKGVsZW0pLFxuICAgICAgICBjbGFzc2VzOiBjbGFzc2VzLFxuICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyc1xuICAgICAgfSwgY29udGVudHMpO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyU3Bpbm5lciA9IGZ1bmN0aW9uIChwcm92aWRlckJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7ICdhcmlhLWxhYmVsJzogcHJvdmlkZXJCYWNrc3RhZ2UudHJhbnNsYXRlKCdMb2FkaW5nLi4uJykgfSxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10aHJvYmJlcl9fYnVzeS1zcGlubmVyJ11cbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogW3sgZG9tOiBmcm9tSHRtbCQyKCc8ZGl2IGNsYXNzPVwidG94LXNwaW5uZXJcIj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48L2Rpdj4nKSB9XSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgICAgb25UYWI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUodHJ1ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25TaGlmdFRhYjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBGb2N1c2luZy5jb25maWcoe30pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHRvZ2dsZVRocm9iYmVyID0gZnVuY3Rpb24gKGNvbXAsIHN0YXRlLCBwcm92aWRlckJhY2tzdGFnZSkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBjb21wLmVsZW1lbnQ7XG4gICAgICBpZiAoc3RhdGUgPT09IHRydWUpIHtcbiAgICAgICAgUmVwbGFjaW5nLnNldChjb21wLCBbcmVuZGVyU3Bpbm5lcihwcm92aWRlckJhY2tzdGFnZSldKTtcbiAgICAgICAgcmVtb3ZlJDYoZWxlbWVudCwgJ2Rpc3BsYXknKTtcbiAgICAgICAgcmVtb3ZlJDEoZWxlbWVudCwgJ2FyaWEtaGlkZGVuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBSZXBsYWNpbmcuc2V0KGNvbXAsIFtdKTtcbiAgICAgICAgc2V0JDIoZWxlbWVudCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICBzZXQkMShlbGVtZW50LCAnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlbmRlclRocm9iYmVyID0gZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogc3BlYy51aWQsXG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgYXR0cmlidXRlczogeyAnYXJpYS1oaWRkZW4nOiAndHJ1ZScgfSxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC10aHJvYmJlciddLFxuICAgICAgICAgIHN0eWxlczogeyBkaXNwbGF5OiAnbm9uZScgfVxuICAgICAgICB9LFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbUmVwbGFjaW5nLmNvbmZpZyh7fSldKSxcbiAgICAgICAgY29tcG9uZW50czogW11cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2V0dXAkNyA9IGZ1bmN0aW9uIChlZGl0b3IsIGxhenlUaHJvYmJlciwgc2hhcmVkQmFja3N0YWdlKSB7XG4gICAgICB2YXIgdGhyb2JiZXJTdGF0ZSA9IENlbGwoZmFsc2UpO1xuICAgICAgdmFyIHRpbWVyID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIHRvZ2dsZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICBpZiAoc3RhdGUgIT09IHRocm9iYmVyU3RhdGUuZ2V0KCkpIHtcbiAgICAgICAgICB0b2dnbGVUaHJvYmJlcihsYXp5VGhyb2JiZXIoKSwgc3RhdGUsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMpO1xuICAgICAgICAgIHRocm9iYmVyU3RhdGUuc2V0KHN0YXRlKTtcbiAgICAgICAgICBlZGl0b3IuZmlyZSgnQWZ0ZXJQcm9ncmVzc1N0YXRlJywgeyBzdGF0ZTogc3RhdGUgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBlZGl0b3Iub24oJ1Byb2dyZXNzU3RhdGUnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aW1lci5nZXQoKS5lYWNoKGdsb2JhbCQyLmNsZWFyVGltZW91dCk7XG4gICAgICAgIGlmIChpc051bWJlcihlLnRpbWUpKSB7XG4gICAgICAgICAgdmFyIHRpbWVySWQgPSBnbG9iYWwkMi5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRvZ2dsZShlLnN0YXRlKTtcbiAgICAgICAgICB9LCBlLnRpbWUpO1xuICAgICAgICAgIHRpbWVyLnNldChPcHRpb25hbC5zb21lKHRpbWVySWQpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0b2dnbGUoZS5zdGF0ZSk7XG4gICAgICAgICAgdGltZXIuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZmFjdG9yeSRoID0gZnVuY3Rpb24gKGRldGFpbCwgY29tcG9uZW50cywgX3NwZWMpIHtcbiAgICAgIHZhciBhcGlzID0ge1xuICAgICAgICBnZXRTb2NrZXQ6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICdzb2NrZXQnKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0U2lkZWJhcjogZnVuY3Rpb24gKGNvbXAsIHBhbmVsQ29uZmlncykge1xuICAgICAgICAgIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICdzaWRlYmFyJykuZWFjaChmdW5jdGlvbiAoc2lkZWJhcikge1xuICAgICAgICAgICAgcmV0dXJuIHNldFNpZGViYXIoc2lkZWJhciwgcGFuZWxDb25maWdzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9nZ2xlU2lkZWJhcjogZnVuY3Rpb24gKGNvbXAsIG5hbWUpIHtcbiAgICAgICAgICBwYXJ0cyRkLmdldFBhcnQoY29tcCwgZGV0YWlsLCAnc2lkZWJhcicpLmVhY2goZnVuY3Rpb24gKHNpZGViYXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0b2dnbGVTaWRlYmFyKHNpZGViYXIsIG5hbWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB3aGljaFNpZGViYXI6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICdzaWRlYmFyJykuYmluZCh3aGljaFNpZGViYXIpLmdldE9yTnVsbCgpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRIZWFkZXI6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICdoZWFkZXInKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VG9vbGJhcjogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICByZXR1cm4gcGFydHMkZC5nZXRQYXJ0KGNvbXAsIGRldGFpbCwgJ3Rvb2xiYXInKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0VG9vbGJhcjogZnVuY3Rpb24gKGNvbXAsIGdyb3Vwcykge1xuICAgICAgICAgIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICd0b29sYmFyJykuZWFjaChmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgdG9vbGJhci5nZXRBcGlzKCkuc2V0R3JvdXBzKHRvb2xiYXIsIGdyb3Vwcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldFRvb2xiYXJzOiBmdW5jdGlvbiAoY29tcCwgdG9vbGJhcnMpIHtcbiAgICAgICAgICBwYXJ0cyRkLmdldFBhcnQoY29tcCwgZGV0YWlsLCAnbXVsdGlwbGUtdG9vbGJhcicpLmVhY2goZnVuY3Rpb24gKG1Ub29sYmFyKSB7XG4gICAgICAgICAgICBDdXN0b21MaXN0LnNldEl0ZW1zKG1Ub29sYmFyLCB0b29sYmFycyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlZnJlc2hUb29sYmFyOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHZhciB0b29sYmFyID0gcGFydHMkZC5nZXRQYXJ0KGNvbXAsIGRldGFpbCwgJ3Rvb2xiYXInKTtcbiAgICAgICAgICB0b29sYmFyLmVhY2goZnVuY3Rpb24gKHRvb2xiYXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0b29sYmFyLmdldEFwaXMoKS5yZWZyZXNoKHRvb2xiYXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0b2dnbGVUb29sYmFyRHJhd2VyOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICd0b29sYmFyJykuZWFjaChmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICAgICAgbWFwRnJvbSh0b29sYmFyLmdldEFwaXMoKS50b2dnbGUsIGZ1bmN0aW9uICh0b2dnbGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRvZ2dsZSh0b29sYmFyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBpc1Rvb2xiYXJEcmF3ZXJUb2dnbGVkOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHJldHVybiBwYXJ0cyRkLmdldFBhcnQoY29tcCwgZGV0YWlsLCAndG9vbGJhcicpLmJpbmQoZnVuY3Rpb24gKHRvb2xiYXIpIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKHRvb2xiYXIuZ2V0QXBpcygpLmlzT3BlbikubWFwKGZ1bmN0aW9uIChpc09wZW4pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGlzT3Blbih0b29sYmFyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLmdldE9yKGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VGhyb2JiZXI6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICd0aHJvYmJlcicpO1xuICAgICAgICB9LFxuICAgICAgICBmb2N1c1Rvb2xiYXI6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgdmFyIG9wdFRvb2xiYXIgPSBwYXJ0cyRkLmdldFBhcnQoY29tcCwgZGV0YWlsLCAndG9vbGJhcicpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICdtdWx0aXBsZS10b29sYmFyJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgb3B0VG9vbGJhci5lYWNoKGZ1bmN0aW9uICh0b29sYmFyKSB7XG4gICAgICAgICAgICBLZXlpbmcuZm9jdXNJbih0b29sYmFyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0TWVudWJhcjogZnVuY3Rpb24gKGNvbXAsIG1lbnVzKSB7XG4gICAgICAgICAgcGFydHMkZC5nZXRQYXJ0KGNvbXAsIGRldGFpbCwgJ21lbnViYXInKS5lYWNoKGZ1bmN0aW9uIChtZW51YmFyKSB7XG4gICAgICAgICAgICBTaWx2ZXJNZW51YmFyLnNldE1lbnVzKG1lbnViYXIsIG1lbnVzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZm9jdXNNZW51YmFyOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHBhcnRzJGQuZ2V0UGFydChjb21wLCBkZXRhaWwsICdtZW51YmFyJykuZWFjaChmdW5jdGlvbiAobWVudWJhcikge1xuICAgICAgICAgICAgU2lsdmVyTWVudWJhci5mb2N1cyhtZW51YmFyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVpZDogZGV0YWlsLnVpZCxcbiAgICAgICAgZG9tOiBkZXRhaWwuZG9tLFxuICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzLFxuICAgICAgICBhcGlzOiBhcGlzLFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXRhaWwuYmVoYXZpb3Vyc1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBwYXJ0TWVudWJhciA9IHBhcnRUeXBlJDEub3B0aW9uYWwoe1xuICAgICAgZmFjdG9yeTogU2lsdmVyTWVudWJhcixcbiAgICAgIG5hbWU6ICdtZW51YmFyJyxcbiAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdiYWNrc3RhZ2UnKV1cbiAgICB9KTtcbiAgICB2YXIgdG9vbGJhckZhY3RvcnkgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgaWYgKHNwZWMudHlwZSA9PT0gVG9vbGJhck1vZGUuc2xpZGluZykge1xuICAgICAgICByZXR1cm4gcmVuZGVyU2xpZGluZ01vcmVUb29sYmFyO1xuICAgICAgfSBlbHNlIGlmIChzcGVjLnR5cGUgPT09IFRvb2xiYXJNb2RlLmZsb2F0aW5nKSB7XG4gICAgICAgIHJldHVybiByZW5kZXJGbG9hdGluZ01vcmVUb29sYmFyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlclRvb2xiYXI7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcGFydE11bHRpcGxlVG9vbGJhciA9IHBhcnRUeXBlJDEub3B0aW9uYWwoe1xuICAgICAgZmFjdG9yeToge1xuICAgICAgICBza2V0Y2g6IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICAgICAgcmV0dXJuIEN1c3RvbUxpc3Quc2tldGNoKHtcbiAgICAgICAgICAgIHVpZDogc3BlYy51aWQsXG4gICAgICAgICAgICBkb206IHNwZWMuZG9tLFxuICAgICAgICAgICAgbGlzdEJlaGF2aW91cnM6IGRlcml2ZSQxKFtLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgICAgICBtb2RlOiAnYWN5Y2xpYycsXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICcudG94LXRvb2xiYXInXG4gICAgICAgICAgICAgIH0pXSksXG4gICAgICAgICAgICBtYWtlSXRlbTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVuZGVyVG9vbGJhcih7XG4gICAgICAgICAgICAgICAgdHlwZTogc3BlYy50eXBlLFxuICAgICAgICAgICAgICAgIHVpZDogZ2VuZXJhdGUkMSgnbXVsdGlwbGUtdG9vbGJhci1pdGVtJyksXG4gICAgICAgICAgICAgICAgY3ljbGljS2V5aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpbml0R3JvdXBzOiBbXSxcbiAgICAgICAgICAgICAgICBwcm92aWRlcnM6IHNwZWMucHJvdmlkZXJzLFxuICAgICAgICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICBzcGVjLm9uRXNjYXBlKCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldHVwSXRlbTogZnVuY3Rpb24gKF9tVG9vbGJhciwgdGMsIGRhdGEsIF9pbmRleCkge1xuICAgICAgICAgICAgICBUb29sYmFyLnNldEdyb3Vwcyh0YywgZGF0YSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hlbGw6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG5hbWU6ICdtdWx0aXBsZS10b29sYmFyJyxcbiAgICAgIHNjaGVtYTogW1xuICAgICAgICBzdHJpY3QkMSgnZG9tJyksXG4gICAgICAgIHN0cmljdCQxKCdvbkVzY2FwZScpXG4gICAgICBdXG4gICAgfSk7XG4gICAgdmFyIHBhcnRUb29sYmFyID0gcGFydFR5cGUkMS5vcHRpb25hbCh7XG4gICAgICBmYWN0b3J5OiB7XG4gICAgICAgIHNrZXRjaDogZnVuY3Rpb24gKHNwZWMpIHtcbiAgICAgICAgICB2YXIgcmVuZGVyZXIgPSB0b29sYmFyRmFjdG9yeShzcGVjKTtcbiAgICAgICAgICB2YXIgdG9vbGJhclNwZWMgPSB7XG4gICAgICAgICAgICB0eXBlOiBzcGVjLnR5cGUsXG4gICAgICAgICAgICB1aWQ6IHNwZWMudWlkLFxuICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgc3BlYy5vbkVzY2FwZSgpO1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjeWNsaWNLZXlpbmc6IGZhbHNlLFxuICAgICAgICAgICAgaW5pdEdyb3VwczogW10sXG4gICAgICAgICAgICBnZXRTaW5rOiBzcGVjLmdldFNpbmssXG4gICAgICAgICAgICBwcm92aWRlcnM6IHNwZWMucHJvdmlkZXJzLFxuICAgICAgICAgICAgbW9yZURyYXdlckRhdGE6IHtcbiAgICAgICAgICAgICAgbGF6eVRvb2xiYXI6IHNwZWMubGF6eVRvb2xiYXIsXG4gICAgICAgICAgICAgIGxhenlNb3JlQnV0dG9uOiBzcGVjLmxhenlNb3JlQnV0dG9uLFxuICAgICAgICAgICAgICBsYXp5SGVhZGVyOiBzcGVjLmxhenlIZWFkZXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBzcGVjLmF0dHJpYnV0ZXNcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiByZW5kZXJlcih0b29sYmFyU3BlYyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBuYW1lOiAndG9vbGJhcicsXG4gICAgICBzY2hlbWE6IFtcbiAgICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgICBzdHJpY3QkMSgnb25Fc2NhcGUnKSxcbiAgICAgICAgc3RyaWN0JDEoJ2dldFNpbmsnKVxuICAgICAgXVxuICAgIH0pO1xuICAgIHZhciBwYXJ0SGVhZGVyID0gcGFydFR5cGUkMS5vcHRpb25hbCh7XG4gICAgICBmYWN0b3J5OiB7IHNrZXRjaDogcmVuZGVySGVhZGVyIH0sXG4gICAgICBuYW1lOiAnaGVhZGVyJyxcbiAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdkb20nKV1cbiAgICB9KTtcbiAgICB2YXIgcGFydFNvY2tldCA9IHBhcnRUeXBlJDEub3B0aW9uYWwoe1xuICAgICAgbmFtZTogJ3NvY2tldCcsXG4gICAgICBzY2hlbWE6IFtzdHJpY3QkMSgnZG9tJyldXG4gICAgfSk7XG4gICAgdmFyIHBhcnRTaWRlYmFyID0gcGFydFR5cGUkMS5vcHRpb25hbCh7XG4gICAgICBmYWN0b3J5OiB7IHNrZXRjaDogcmVuZGVyU2lkZWJhciB9LFxuICAgICAgbmFtZTogJ3NpZGViYXInLFxuICAgICAgc2NoZW1hOiBbc3RyaWN0JDEoJ2RvbScpXVxuICAgIH0pO1xuICAgIHZhciBwYXJ0VGhyb2JiZXIgPSBwYXJ0VHlwZSQxLm9wdGlvbmFsKHtcbiAgICAgIGZhY3Rvcnk6IHsgc2tldGNoOiByZW5kZXJUaHJvYmJlciB9LFxuICAgICAgbmFtZTogJ3Rocm9iYmVyJyxcbiAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdkb20nKV1cbiAgICB9KTtcbiAgICB2YXIgT3V0ZXJDb250YWluZXIgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnT3V0ZXJDb250YWluZXInLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSRoLFxuICAgICAgY29uZmlnRmllbGRzOiBbXG4gICAgICAgIHN0cmljdCQxKCdkb20nKSxcbiAgICAgICAgc3RyaWN0JDEoJ2JlaGF2aW91cnMnKVxuICAgICAgXSxcbiAgICAgIHBhcnRGaWVsZHM6IFtcbiAgICAgICAgcGFydEhlYWRlcixcbiAgICAgICAgcGFydE1lbnViYXIsXG4gICAgICAgIHBhcnRUb29sYmFyLFxuICAgICAgICBwYXJ0TXVsdGlwbGVUb29sYmFyLFxuICAgICAgICBwYXJ0U29ja2V0LFxuICAgICAgICBwYXJ0U2lkZWJhcixcbiAgICAgICAgcGFydFRocm9iYmVyXG4gICAgICBdLFxuICAgICAgYXBpczoge1xuICAgICAgICBnZXRTb2NrZXQ6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuZ2V0U29ja2V0KGNvbXApO1xuICAgICAgICB9LFxuICAgICAgICBzZXRTaWRlYmFyOiBmdW5jdGlvbiAoYXBpcywgY29tcCwgcGFuZWxDb25maWdzKSB7XG4gICAgICAgICAgYXBpcy5zZXRTaWRlYmFyKGNvbXAsIHBhbmVsQ29uZmlncyk7XG4gICAgICAgIH0sXG4gICAgICAgIHRvZ2dsZVNpZGViYXI6IGZ1bmN0aW9uIChhcGlzLCBjb21wLCBuYW1lKSB7XG4gICAgICAgICAgYXBpcy50b2dnbGVTaWRlYmFyKGNvbXAsIG5hbWUpO1xuICAgICAgICB9LFxuICAgICAgICB3aGljaFNpZGViYXI6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMud2hpY2hTaWRlYmFyKGNvbXApO1xuICAgICAgICB9LFxuICAgICAgICBnZXRIZWFkZXI6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuZ2V0SGVhZGVyKGNvbXApO1xuICAgICAgICB9LFxuICAgICAgICBnZXRUb29sYmFyOiBmdW5jdGlvbiAoYXBpcywgY29tcCkge1xuICAgICAgICAgIHJldHVybiBhcGlzLmdldFRvb2xiYXIoY29tcCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldFRvb2xiYXI6IGZ1bmN0aW9uIChhcGlzLCBjb21wLCBncnBzKSB7XG4gICAgICAgICAgdmFyIGdyb3VwcyA9IG1hcChncnBzLCBmdW5jdGlvbiAoZ3JwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyVG9vbGJhckdyb3VwKGdycCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYXBpcy5zZXRUb29sYmFyKGNvbXAsIGdyb3Vwcyk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldFRvb2xiYXJzOiBmdW5jdGlvbiAoYXBpcywgY29tcCwgdHMpIHtcbiAgICAgICAgICB2YXIgcmVuZGVyZWRUb29sYmFycyA9IG1hcCh0cywgZnVuY3Rpb24gKGcpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXAoZywgcmVuZGVyVG9vbGJhckdyb3VwKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhcGlzLnNldFRvb2xiYXJzKGNvbXAsIHJlbmRlcmVkVG9vbGJhcnMpO1xuICAgICAgICB9LFxuICAgICAgICByZWZyZXNoVG9vbGJhcjogZnVuY3Rpb24gKGFwaXMsIGNvbXApIHtcbiAgICAgICAgICByZXR1cm4gYXBpcy5yZWZyZXNoVG9vbGJhcihjb21wKTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9nZ2xlVG9vbGJhckRyYXdlcjogZnVuY3Rpb24gKGFwaXMsIGNvbXApIHtcbiAgICAgICAgICBhcGlzLnRvZ2dsZVRvb2xiYXJEcmF3ZXIoY29tcCk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzVG9vbGJhckRyYXdlclRvZ2dsZWQ6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuaXNUb29sYmFyRHJhd2VyVG9nZ2xlZChjb21wKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VGhyb2JiZXI6IGZ1bmN0aW9uIChhcGlzLCBjb21wKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuZ2V0VGhyb2JiZXIoY29tcCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldE1lbnViYXI6IGZ1bmN0aW9uIChhcGlzLCBjb21wLCBtZW51cykge1xuICAgICAgICAgIGFwaXMuc2V0TWVudWJhcihjb21wLCBtZW51cyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzTWVudWJhcjogZnVuY3Rpb24gKGFwaXMsIGNvbXApIHtcbiAgICAgICAgICBhcGlzLmZvY3VzTWVudWJhcihjb21wKTtcbiAgICAgICAgfSxcbiAgICAgICAgZm9jdXNUb29sYmFyOiBmdW5jdGlvbiAoYXBpcywgY29tcCkge1xuICAgICAgICAgIGFwaXMuZm9jdXNUb29sYmFyKGNvbXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgZGVmYXVsdE1lbnViYXIgPSAnZmlsZSBlZGl0IHZpZXcgaW5zZXJ0IGZvcm1hdCB0b29scyB0YWJsZSBoZWxwJztcbiAgICB2YXIgZGVmYXVsdE1lbnVzID0ge1xuICAgICAgZmlsZToge1xuICAgICAgICB0aXRsZTogJ0ZpbGUnLFxuICAgICAgICBpdGVtczogJ25ld2RvY3VtZW50IHJlc3RvcmVkcmFmdCB8IHByZXZpZXcgfCBleHBvcnQgcHJpbnQgfCBkZWxldGVhbGxjb252ZXJzYXRpb25zJ1xuICAgICAgfSxcbiAgICAgIGVkaXQ6IHtcbiAgICAgICAgdGl0bGU6ICdFZGl0JyxcbiAgICAgICAgaXRlbXM6ICd1bmRvIHJlZG8gfCBjdXQgY29weSBwYXN0ZSBwYXN0ZXRleHQgfCBzZWxlY3RhbGwgfCBzZWFyY2hyZXBsYWNlJ1xuICAgICAgfSxcbiAgICAgIHZpZXc6IHtcbiAgICAgICAgdGl0bGU6ICdWaWV3JyxcbiAgICAgICAgaXRlbXM6ICdjb2RlIHwgdmlzdWFsYWlkIHZpc3VhbGNoYXJzIHZpc3VhbGJsb2NrcyB8IHNwZWxsY2hlY2tlciB8IHByZXZpZXcgZnVsbHNjcmVlbiB8IHNob3djb21tZW50cydcbiAgICAgIH0sXG4gICAgICBpbnNlcnQ6IHtcbiAgICAgICAgdGl0bGU6ICdJbnNlcnQnLFxuICAgICAgICBpdGVtczogJ2ltYWdlIGxpbmsgbWVkaWEgYWRkY29tbWVudCBwYWdlZW1iZWQgdGVtcGxhdGUgY29kZXNhbXBsZSBpbnNlcnR0YWJsZSB8IGNoYXJtYXAgZW1vdGljb25zIGhyIHwgcGFnZWJyZWFrIG5vbmJyZWFraW5nIGFuY2hvciB0b2MgfCBpbnNlcnRkYXRldGltZSdcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgdGl0bGU6ICdGb3JtYXQnLFxuICAgICAgICBpdGVtczogJ2JvbGQgaXRhbGljIHVuZGVybGluZSBzdHJpa2V0aHJvdWdoIHN1cGVyc2NyaXB0IHN1YnNjcmlwdCBjb2RlZm9ybWF0IHwgZm9ybWF0cyBibG9ja2Zvcm1hdHMgZm9udGZvcm1hdHMgZm9udHNpemVzIGFsaWduIGxpbmVoZWlnaHQgfCBmb3JlY29sb3IgYmFja2NvbG9yIHwgcmVtb3ZlZm9ybWF0J1xuICAgICAgfSxcbiAgICAgIHRvb2xzOiB7XG4gICAgICAgIHRpdGxlOiAnVG9vbHMnLFxuICAgICAgICBpdGVtczogJ3NwZWxsY2hlY2tlciBzcGVsbGNoZWNrZXJsYW5ndWFnZSB8IGExMXljaGVjayBjb2RlIHdvcmRjb3VudCdcbiAgICAgIH0sXG4gICAgICB0YWJsZToge1xuICAgICAgICB0aXRsZTogJ1RhYmxlJyxcbiAgICAgICAgaXRlbXM6ICdpbnNlcnR0YWJsZSB8IGNlbGwgcm93IGNvbHVtbiB8IGFkdnRhYmxlc29ydCB8IHRhYmxlcHJvcHMgZGVsZXRldGFibGUnXG4gICAgICB9LFxuICAgICAgaGVscDoge1xuICAgICAgICB0aXRsZTogJ0hlbHAnLFxuICAgICAgICBpdGVtczogJ2hlbHAnXG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbWFrZSQ4ID0gZnVuY3Rpb24gKG1lbnUsIHJlZ2lzdHJ5LCBlZGl0b3IpIHtcbiAgICAgIHZhciByZW1vdmVkTWVudUl0ZW1zID0gZ2V0UmVtb3ZlZE1lbnVJdGVtcyhlZGl0b3IpLnNwbGl0KC9bICxdLyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0ZXh0OiBtZW51LnRpdGxlLFxuICAgICAgICBnZXRJdGVtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBiaW5kKG1lbnUuaXRlbXMsIGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICB2YXIgaXRlbU5hbWUgPSBpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBpZiAoaXRlbU5hbWUudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV4aXN0cyhyZW1vdmVkTWVudUl0ZW1zLCBmdW5jdGlvbiAocmVtb3ZlZE1lbnVJdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlbW92ZWRNZW51SXRlbSA9PT0gaXRlbU5hbWU7XG4gICAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbU5hbWUgPT09ICdzZXBhcmF0b3InIHx8IGl0ZW1OYW1lID09PSAnfCcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFt7IHR5cGU6ICdzZXBhcmF0b3InIH1dO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZWdpc3RyeS5tZW51SXRlbXNbaXRlbU5hbWVdKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbcmVnaXN0cnkubWVudUl0ZW1zW2l0ZW1OYW1lXV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcGFyc2VJdGVtc1N0cmluZyA9IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgaWYgKHR5cGVvZiBpdGVtcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIGl0ZW1zLnNwbGl0KCcgJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gaXRlbXM7XG4gICAgfTtcbiAgICB2YXIgaWRlbnRpZnlNZW51cyA9IGZ1bmN0aW9uIChlZGl0b3IsIHJlZ2lzdHJ5KSB7XG4gICAgICB2YXIgcmF3TWVudURhdGEgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZGVmYXVsdE1lbnVzKSwgcmVnaXN0cnkubWVudXMpO1xuICAgICAgdmFyIHVzZXJEZWZpbmVkTWVudXMgPSBrZXlzKHJlZ2lzdHJ5Lm1lbnVzKS5sZW5ndGggPiAwO1xuICAgICAgdmFyIG1lbnViYXIgPSByZWdpc3RyeS5tZW51YmFyID09PSB1bmRlZmluZWQgfHwgcmVnaXN0cnkubWVudWJhciA9PT0gdHJ1ZSA/IHBhcnNlSXRlbXNTdHJpbmcoZGVmYXVsdE1lbnViYXIpIDogcGFyc2VJdGVtc1N0cmluZyhyZWdpc3RyeS5tZW51YmFyID09PSBmYWxzZSA/ICcnIDogcmVnaXN0cnkubWVudWJhcik7XG4gICAgICB2YXIgdmFsaWRNZW51cyA9IGZpbHRlcihtZW51YmFyLCBmdW5jdGlvbiAobWVudU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHVzZXJEZWZpbmVkTWVudXMgPyByZWdpc3RyeS5tZW51cy5oYXNPd25Qcm9wZXJ0eShtZW51TmFtZSkgJiYgcmVnaXN0cnkubWVudXNbbWVudU5hbWVdLmhhc093blByb3BlcnR5KCdpdGVtcycpIHx8IGRlZmF1bHRNZW51cy5oYXNPd25Qcm9wZXJ0eShtZW51TmFtZSkgOiBkZWZhdWx0TWVudXMuaGFzT3duUHJvcGVydHkobWVudU5hbWUpO1xuICAgICAgfSk7XG4gICAgICB2YXIgbWVudXMgPSBtYXAodmFsaWRNZW51cywgZnVuY3Rpb24gKG1lbnVOYW1lKSB7XG4gICAgICAgIHZhciBtZW51RGF0YSA9IHJhd01lbnVEYXRhW21lbnVOYW1lXTtcbiAgICAgICAgcmV0dXJuIG1ha2UkOCh7XG4gICAgICAgICAgdGl0bGU6IG1lbnVEYXRhLnRpdGxlLFxuICAgICAgICAgIGl0ZW1zOiBwYXJzZUl0ZW1zU3RyaW5nKG1lbnVEYXRhLml0ZW1zKVxuICAgICAgICB9LCByZWdpc3RyeSwgZWRpdG9yKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZpbHRlcihtZW51cywgZnVuY3Rpb24gKG1lbnUpIHtcbiAgICAgICAgdmFyIGlzTm90U2VwYXJhdG9yID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gaXRlbS50eXBlICE9PSAnc2VwYXJhdG9yJztcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG1lbnUuZ2V0SXRlbXMoKS5sZW5ndGggPiAwICYmIGV4aXN0cyhtZW51LmdldEl0ZW1zKCksIGlzTm90U2VwYXJhdG9yKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZmlyZVNraW5Mb2FkZWQkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBkb25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3IuX3NraW5Mb2FkZWQgPSB0cnVlO1xuICAgICAgICBmaXJlU2tpbkxvYWRlZChlZGl0b3IpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChlZGl0b3IuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWRpdG9yLm9uKCdpbml0JywgZG9uZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZmlyZVNraW5Mb2FkRXJyb3IkMSA9IGZ1bmN0aW9uIChlZGl0b3IsIGVycikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZpcmVTa2luTG9hZEVycm9yKGVkaXRvciwgeyBtZXNzYWdlOiBlcnIgfSk7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgbG9hZFN0eWxlc2hlZXQgPSBmdW5jdGlvbiAoZWRpdG9yLCBzdHlsZXNoZWV0VXJsLCBzdHlsZVNoZWV0TG9hZGVyKSB7XG4gICAgICByZXR1cm4gbmV3IGdsb2JhbCQ0KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgc3R5bGVTaGVldExvYWRlci5sb2FkKHN0eWxlc2hlZXRVcmwsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIGVkaXRvci5vbigncmVtb3ZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzdHlsZVNoZWV0TG9hZGVyLnVubG9hZChzdHlsZXNoZWV0VXJsKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBsb2FkVWlTa2lucyA9IGZ1bmN0aW9uIChlZGl0b3IsIHNraW5VcmwpIHtcbiAgICAgIHZhciBza2luVWlDc3MgPSBza2luVXJsICsgJy9za2luLm1pbi5jc3MnO1xuICAgICAgcmV0dXJuIGxvYWRTdHlsZXNoZWV0KGVkaXRvciwgc2tpblVpQ3NzLCBlZGl0b3IudWkuc3R5bGVTaGVldExvYWRlcik7XG4gICAgfTtcbiAgICB2YXIgbG9hZFNoYWRvd0RvbVVpU2tpbnMgPSBmdW5jdGlvbiAoZWRpdG9yLCBza2luVXJsKSB7XG4gICAgICB2YXIgaXNJblNoYWRvd1Jvb3QkMSA9IGlzSW5TaGFkb3dSb290KFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXRFbGVtZW50KCkpKTtcbiAgICAgIGlmIChpc0luU2hhZG93Um9vdCQxKSB7XG4gICAgICAgIHZhciBzaGFkb3dEb21Ta2luQ3NzID0gc2tpblVybCArICcvc2tpbi5zaGFkb3dkb20ubWluLmNzcyc7XG4gICAgICAgIHJldHVybiBsb2FkU3R5bGVzaGVldChlZGl0b3IsIHNoYWRvd0RvbVNraW5Dc3MsIGdsb2JhbCQ1LkRPTS5zdHlsZVNoZWV0TG9hZGVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBnbG9iYWwkNC5yZXNvbHZlKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbG9hZFNraW4gPSBmdW5jdGlvbiAoaXNJbmxpbmUsIGVkaXRvcikge1xuICAgICAgdmFyIHNraW5VcmwgPSBnZXRTa2luVXJsKGVkaXRvcik7XG4gICAgICBpZiAoc2tpblVybCkge1xuICAgICAgICBlZGl0b3IuY29udGVudENTUy5wdXNoKHNraW5VcmwgKyAoaXNJbmxpbmUgPyAnL2NvbnRlbnQuaW5saW5lJyA6ICcvY29udGVudCcpICsgJy5taW4uY3NzJyk7XG4gICAgICB9XG4gICAgICBpZiAoaXNTa2luRGlzYWJsZWQoZWRpdG9yKSA9PT0gZmFsc2UgJiYgaXNTdHJpbmcoc2tpblVybCkpIHtcbiAgICAgICAgZ2xvYmFsJDQuYWxsKFtcbiAgICAgICAgICBsb2FkVWlTa2lucyhlZGl0b3IsIHNraW5VcmwpLFxuICAgICAgICAgIGxvYWRTaGFkb3dEb21VaVNraW5zKGVkaXRvciwgc2tpblVybClcbiAgICAgICAgXSkudGhlbihmaXJlU2tpbkxvYWRlZCQxKGVkaXRvciksIGZpcmVTa2luTG9hZEVycm9yJDEoZWRpdG9yLCAnU2tpbiBjb3VsZCBub3QgYmUgbG9hZGVkJykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmlyZVNraW5Mb2FkZWQkMShlZGl0b3IpKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaWZyYW1lID0gY3VycnkobG9hZFNraW4sIGZhbHNlKTtcbiAgICB2YXIgaW5saW5lID0gY3VycnkobG9hZFNraW4sIHRydWUpO1xuXG4gICAgdmFyIHNldFRvb2xiYXIgPSBmdW5jdGlvbiAoZWRpdG9yLCB1aUNvbXBvbmVudHMsIHJhd1VpQ29uZmlnLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBjb21wID0gdWlDb21wb25lbnRzLm91dGVyQ29udGFpbmVyO1xuICAgICAgdmFyIHRvb2xiYXJDb25maWcgPSByYXdVaUNvbmZpZy50b29sYmFyO1xuICAgICAgdmFyIHRvb2xiYXJCdXR0b25zQ29uZmlnID0gcmF3VWlDb25maWcuYnV0dG9ucztcbiAgICAgIGlmIChpc0FycmF5T2YodG9vbGJhckNvbmZpZywgaXNTdHJpbmcpKSB7XG4gICAgICAgIHZhciB0b29sYmFycyA9IHRvb2xiYXJDb25maWcubWFwKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgIHRvb2xiYXI6IHQsXG4gICAgICAgICAgICBidXR0b25zOiB0b29sYmFyQnV0dG9uc0NvbmZpZyxcbiAgICAgICAgICAgIGFsbG93VG9vbGJhckdyb3VwczogcmF3VWlDb25maWcuYWxsb3dUb29sYmFyR3JvdXBzXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gaWRlbnRpZnlCdXR0b25zKGVkaXRvciwgY29uZmlnLCB7IGJhY2tzdGFnZTogYmFja3N0YWdlIH0sIE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICBPdXRlckNvbnRhaW5lci5zZXRUb29sYmFycyhjb21wLCB0b29sYmFycyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBPdXRlckNvbnRhaW5lci5zZXRUb29sYmFyKGNvbXAsIGlkZW50aWZ5QnV0dG9ucyhlZGl0b3IsIHJhd1VpQ29uZmlnLCB7IGJhY2tzdGFnZTogYmFja3N0YWdlIH0sIE9wdGlvbmFsLm5vbmUoKSkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZGV0ZWN0aW9uID0gZGV0ZWN0JDMoKTtcbiAgICB2YXIgaXNpT1MxMiA9IGRldGVjdGlvbi5vcy5pc2lPUygpICYmIGRldGVjdGlvbi5vcy52ZXJzaW9uLm1ham9yIDw9IDEyO1xuICAgIHZhciBzZXR1cEV2ZW50cyA9IGZ1bmN0aW9uIChlZGl0b3IsIHVpQ29tcG9uZW50cykge1xuICAgICAgdmFyIGRvbSA9IGVkaXRvci5kb207XG4gICAgICB2YXIgY29udGVudFdpbmRvdyA9IGVkaXRvci5nZXRXaW4oKTtcbiAgICAgIHZhciBpbml0aWFsRG9jRWxlID0gZWRpdG9yLmdldERvYygpLmRvY3VtZW50RWxlbWVudDtcbiAgICAgIHZhciBsYXN0V2luZG93RGltZW5zaW9ucyA9IENlbGwoU3VnYXJQb3NpdGlvbihjb250ZW50V2luZG93LmlubmVyV2lkdGgsIGNvbnRlbnRXaW5kb3cuaW5uZXJIZWlnaHQpKTtcbiAgICAgIHZhciBsYXN0RG9jdW1lbnREaW1lbnNpb25zID0gQ2VsbChTdWdhclBvc2l0aW9uKGluaXRpYWxEb2NFbGUub2Zmc2V0V2lkdGgsIGluaXRpYWxEb2NFbGUub2Zmc2V0SGVpZ2h0KSk7XG4gICAgICB2YXIgcmVzaXplV2luZG93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3V0ZXIgPSBsYXN0V2luZG93RGltZW5zaW9ucy5nZXQoKTtcbiAgICAgICAgaWYgKG91dGVyLmxlZnQgIT09IGNvbnRlbnRXaW5kb3cuaW5uZXJXaWR0aCB8fCBvdXRlci50b3AgIT09IGNvbnRlbnRXaW5kb3cuaW5uZXJIZWlnaHQpIHtcbiAgICAgICAgICBsYXN0V2luZG93RGltZW5zaW9ucy5zZXQoU3VnYXJQb3NpdGlvbihjb250ZW50V2luZG93LmlubmVyV2lkdGgsIGNvbnRlbnRXaW5kb3cuaW5uZXJIZWlnaHQpKTtcbiAgICAgICAgICBmaXJlUmVzaXplQ29udGVudChlZGl0b3IpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHJlc2l6ZURvY3VtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZG9jRWxlID0gZWRpdG9yLmdldERvYygpLmRvY3VtZW50RWxlbWVudDtcbiAgICAgICAgdmFyIGlubmVyID0gbGFzdERvY3VtZW50RGltZW5zaW9ucy5nZXQoKTtcbiAgICAgICAgaWYgKGlubmVyLmxlZnQgIT09IGRvY0VsZS5vZmZzZXRXaWR0aCB8fCBpbm5lci50b3AgIT09IGRvY0VsZS5vZmZzZXRIZWlnaHQpIHtcbiAgICAgICAgICBsYXN0RG9jdW1lbnREaW1lbnNpb25zLnNldChTdWdhclBvc2l0aW9uKGRvY0VsZS5vZmZzZXRXaWR0aCwgZG9jRWxlLm9mZnNldEhlaWdodCkpO1xuICAgICAgICAgIGZpcmVSZXNpemVDb250ZW50KGVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgc2Nyb2xsID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGZpcmVTY3JvbGxDb250ZW50KGVkaXRvciwgZSk7XG4gICAgICB9O1xuICAgICAgZG9tLmJpbmQoY29udGVudFdpbmRvdywgJ3Jlc2l6ZScsIHJlc2l6ZVdpbmRvdyk7XG4gICAgICBkb20uYmluZChjb250ZW50V2luZG93LCAnc2Nyb2xsJywgc2Nyb2xsKTtcbiAgICAgIHZhciBlbGVtZW50TG9hZCA9IGNhcHR1cmUkMShTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0Qm9keSgpKSwgJ2xvYWQnLCByZXNpemVEb2N1bWVudCk7XG4gICAgICB2YXIgbW90aGVyc2hpcCA9IHVpQ29tcG9uZW50cy51aU1vdGhlcnNoaXAuZWxlbWVudDtcbiAgICAgIGVkaXRvci5vbignaGlkZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2V0JDIobW90aGVyc2hpcCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3Iub24oJ3Nob3cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlbW92ZSQ2KG1vdGhlcnNoaXAsICdkaXNwbGF5Jyk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5vbignTm9kZUNoYW5nZScsIHJlc2l6ZURvY3VtZW50KTtcbiAgICAgIGVkaXRvci5vbigncmVtb3ZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBlbGVtZW50TG9hZC51bmJpbmQoKTtcbiAgICAgICAgZG9tLnVuYmluZChjb250ZW50V2luZG93LCAncmVzaXplJywgcmVzaXplV2luZG93KTtcbiAgICAgICAgZG9tLnVuYmluZChjb250ZW50V2luZG93LCAnc2Nyb2xsJywgc2Nyb2xsKTtcbiAgICAgICAgY29udGVudFdpbmRvdyA9IG51bGw7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXIkMSA9IGZ1bmN0aW9uIChlZGl0b3IsIHVpQ29tcG9uZW50cywgcmF3VWlDb25maWcsIGJhY2tzdGFnZSwgYXJncykge1xuICAgICAgdmFyIGxhc3RUb29sYmFyV2lkdGggPSBDZWxsKDApO1xuICAgICAgdmFyIG91dGVyQ29udGFpbmVyID0gdWlDb21wb25lbnRzLm91dGVyQ29udGFpbmVyO1xuICAgICAgaWZyYW1lKGVkaXRvcik7XG4gICAgICB2YXIgZVRhcmdldE5vZGUgPSBTdWdhckVsZW1lbnQuZnJvbURvbShhcmdzLnRhcmdldE5vZGUpO1xuICAgICAgdmFyIHVpUm9vdCA9IGdldENvbnRlbnRDb250YWluZXIoZ2V0Um9vdE5vZGUoZVRhcmdldE5vZGUpKTtcbiAgICAgIGF0dGFjaFN5c3RlbUFmdGVyKGVUYXJnZXROb2RlLCB1aUNvbXBvbmVudHMubW90aGVyc2hpcCk7XG4gICAgICBhdHRhY2hTeXN0ZW0odWlSb290LCB1aUNvbXBvbmVudHMudWlNb3RoZXJzaGlwKTtcbiAgICAgIGVkaXRvci5vbignUG9zdFJlbmRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2V0VG9vbGJhcihlZGl0b3IsIHVpQ29tcG9uZW50cywgcmF3VWlDb25maWcsIGJhY2tzdGFnZSk7XG4gICAgICAgIGxhc3RUb29sYmFyV2lkdGguc2V0KGVkaXRvci5nZXRXaW4oKS5pbm5lcldpZHRoKTtcbiAgICAgICAgT3V0ZXJDb250YWluZXIuc2V0TWVudWJhcihvdXRlckNvbnRhaW5lciwgaWRlbnRpZnlNZW51cyhlZGl0b3IsIHJhd1VpQ29uZmlnKSk7XG4gICAgICAgIE91dGVyQ29udGFpbmVyLnNldFNpZGViYXIob3V0ZXJDb250YWluZXIsIHJhd1VpQ29uZmlnLnNpZGViYXIpO1xuICAgICAgICBzZXR1cEV2ZW50cyhlZGl0b3IsIHVpQ29tcG9uZW50cyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBzb2NrZXQgPSBPdXRlckNvbnRhaW5lci5nZXRTb2NrZXQob3V0ZXJDb250YWluZXIpLmdldE9yRGllKCdDb3VsZCBub3QgZmluZCBleHBlY3RlZCBzb2NrZXQgZWxlbWVudCcpO1xuICAgICAgaWYgKGlzaU9TMTIpIHtcbiAgICAgICAgc2V0QWxsJDEoc29ja2V0LmVsZW1lbnQsIHtcbiAgICAgICAgICAnb3ZlcmZsb3cnOiAnc2Nyb2xsJyxcbiAgICAgICAgICAnLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmcnOiAndG91Y2gnXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbGltaXQgPSBmaXJzdChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yLmZpcmUoJ1Njcm9sbENvbnRlbnQnKTtcbiAgICAgICAgfSwgMjApO1xuICAgICAgICB2YXIgdW5iaW5kZXIgPSBiaW5kJDMoc29ja2V0LmVsZW1lbnQsICdzY3JvbGwnLCBsaW1pdC50aHJvdHRsZSk7XG4gICAgICAgIGVkaXRvci5vbigncmVtb3ZlJywgdW5iaW5kZXIudW5iaW5kKTtcbiAgICAgIH1cbiAgICAgIHNldHVwUmVhZG9ubHlNb2RlU3dpdGNoKGVkaXRvciwgdWlDb21wb25lbnRzKTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdUb2dnbGVTaWRlYmFyJywgZnVuY3Rpb24gKF91aSwgdmFsdWUpIHtcbiAgICAgICAgT3V0ZXJDb250YWluZXIudG9nZ2xlU2lkZWJhcihvdXRlckNvbnRhaW5lciwgdmFsdWUpO1xuICAgICAgICBlZGl0b3IuZmlyZSgnVG9nZ2xlU2lkZWJhcicpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IuYWRkUXVlcnlWYWx1ZUhhbmRsZXIoJ1RvZ2dsZVNpZGViYXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBPdXRlckNvbnRhaW5lci53aGljaFNpZGViYXIob3V0ZXJDb250YWluZXIpO1xuICAgICAgfSk7XG4gICAgICB2YXIgdG9vbGJhck1vZGUgPSBnZXRUb29sYmFyTW9kZShlZGl0b3IpO1xuICAgICAgdmFyIHJlZnJlc2hEcmF3ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIE91dGVyQ29udGFpbmVyLnJlZnJlc2hUb29sYmFyKHVpQ29tcG9uZW50cy5vdXRlckNvbnRhaW5lcik7XG4gICAgICB9O1xuICAgICAgaWYgKHRvb2xiYXJNb2RlID09PSBUb29sYmFyTW9kZS5zbGlkaW5nIHx8IHRvb2xiYXJNb2RlID09PSBUb29sYmFyTW9kZS5mbG9hdGluZykge1xuICAgICAgICBlZGl0b3Iub24oJ1Jlc2l6ZVdpbmRvdyBSZXNpemVFZGl0b3IgUmVzaXplQ29udGVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgd2lkdGggPSBlZGl0b3IuZ2V0V2luKCkuaW5uZXJXaWR0aDtcbiAgICAgICAgICBpZiAod2lkdGggIT09IGxhc3RUb29sYmFyV2lkdGguZ2V0KCkpIHtcbiAgICAgICAgICAgIHJlZnJlc2hEcmF3ZXIoKTtcbiAgICAgICAgICAgIGxhc3RUb29sYmFyV2lkdGguc2V0KHdpZHRoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdmFyIGFwaSA9IHtcbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYnJvYWRjYXN0UmVhZG9ubHkodWlDb21wb25lbnRzLCBmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBicm9hZGNhc3RSZWFkb25seSh1aUNvbXBvbmVudHMsIHRydWUpO1xuICAgICAgICB9LFxuICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIERpc2FibGluZy5pc0Rpc2FibGVkKG91dGVyQ29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlmcmFtZUNvbnRhaW5lcjogc29ja2V0LmVsZW1lbnQuZG9tLFxuICAgICAgICBlZGl0b3JDb250YWluZXI6IG91dGVyQ29udGFpbmVyLmVsZW1lbnQuZG9tLFxuICAgICAgICBhcGk6IGFwaVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIElmcmFtZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICByZW5kZXI6IHJlbmRlciQxXG4gICAgfSk7XG5cbiAgICB2YXIgcGFyc2VUb0ludCA9IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHZhciByZSA9IC9eWzAtOVxcLl0rKHxweCkkL2k7XG4gICAgICBpZiAocmUudGVzdCgnJyArIHZhbCkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUocGFyc2VJbnQoJycgKyB2YWwsIDEwKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIG51bVRvUHggPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgICByZXR1cm4gaXNOdW1iZXIodmFsKSA/IHZhbCArICdweCcgOiB2YWw7XG4gICAgfTtcbiAgICB2YXIgY2FsY0NhcHBlZFNpemUgPSBmdW5jdGlvbiAoc2l6ZSwgbWluU2l6ZSwgbWF4U2l6ZSkge1xuICAgICAgdmFyIG1pbk92ZXJyaWRlID0gbWluU2l6ZS5maWx0ZXIoZnVuY3Rpb24gKG1pbikge1xuICAgICAgICByZXR1cm4gc2l6ZSA8IG1pbjtcbiAgICAgIH0pO1xuICAgICAgdmFyIG1heE92ZXJyaWRlID0gbWF4U2l6ZS5maWx0ZXIoZnVuY3Rpb24gKG1heCkge1xuICAgICAgICByZXR1cm4gc2l6ZSA+IG1heDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1pbk92ZXJyaWRlLm9yKG1heE92ZXJyaWRlKS5nZXRPcihzaXplKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldEhlaWdodCQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGJhc2VIZWlnaHQgPSBnZXRIZWlnaHRTZXR0aW5nKGVkaXRvcik7XG4gICAgICB2YXIgbWluSGVpZ2h0ID0gZ2V0TWluSGVpZ2h0U2V0dGluZyhlZGl0b3IpO1xuICAgICAgdmFyIG1heEhlaWdodCA9IGdldE1heEhlaWdodFNldHRpbmcoZWRpdG9yKTtcbiAgICAgIHJldHVybiBwYXJzZVRvSW50KGJhc2VIZWlnaHQpLm1hcChmdW5jdGlvbiAoaGVpZ2h0KSB7XG4gICAgICAgIHJldHVybiBjYWxjQ2FwcGVkU2l6ZShoZWlnaHQsIG1pbkhlaWdodCwgbWF4SGVpZ2h0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldEhlaWdodFdpdGhGYWxsYmFjayA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBoZWlnaHQgPSBnZXRIZWlnaHQkMShlZGl0b3IpO1xuICAgICAgcmV0dXJuIGhlaWdodC5nZXRPcihnZXRIZWlnaHRTZXR0aW5nKGVkaXRvcikpO1xuICAgIH07XG4gICAgdmFyIGdldFdpZHRoJDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgYmFzZVdpZHRoID0gZ2V0V2lkdGhTZXR0aW5nKGVkaXRvcik7XG4gICAgICB2YXIgbWluV2lkdGggPSBnZXRNaW5XaWR0aFNldHRpbmcoZWRpdG9yKTtcbiAgICAgIHZhciBtYXhXaWR0aCA9IGdldE1heFdpZHRoU2V0dGluZyhlZGl0b3IpO1xuICAgICAgcmV0dXJuIHBhcnNlVG9JbnQoYmFzZVdpZHRoKS5tYXAoZnVuY3Rpb24gKHdpZHRoKSB7XG4gICAgICAgIHJldHVybiBjYWxjQ2FwcGVkU2l6ZSh3aWR0aCwgbWluV2lkdGgsIG1heFdpZHRoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFdpZHRoV2l0aEZhbGxiYWNrID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHdpZHRoID0gZ2V0V2lkdGgkMShlZGl0b3IpO1xuICAgICAgcmV0dXJuIHdpZHRoLmdldE9yKGdldFdpZHRoU2V0dGluZyhlZGl0b3IpKTtcbiAgICB9O1xuXG4gICAgdmFyIElubGluZUhlYWRlciA9IGZ1bmN0aW9uIChlZGl0b3IsIHRhcmdldEVsbSwgdWlDb21wb25lbnRzLCBiYWNrc3RhZ2UsIGZsb2F0Q29udGFpbmVyKSB7XG4gICAgICB2YXIgdWlNb3RoZXJzaGlwID0gdWlDb21wb25lbnRzLnVpTW90aGVyc2hpcCwgb3V0ZXJDb250YWluZXIgPSB1aUNvbXBvbmVudHMub3V0ZXJDb250YWluZXI7XG4gICAgICB2YXIgRE9NID0gZ2xvYmFsJDUuRE9NO1xuICAgICAgdmFyIHVzZUZpeGVkVG9vbGJhckNvbnRhaW5lciA9IHVzZUZpeGVkQ29udGFpbmVyKGVkaXRvcik7XG4gICAgICB2YXIgaXNTdGlja3kgPSBpc1N0aWNreVRvb2xiYXIoZWRpdG9yKTtcbiAgICAgIHZhciBlZGl0b3JNYXhXaWR0aE9wdCA9IGdldE1heFdpZHRoU2V0dGluZyhlZGl0b3IpLm9yKGdldFdpZHRoJDEoZWRpdG9yKSk7XG4gICAgICB2YXIgaGVhZGVyQmFja3N0YWdlID0gYmFja3N0YWdlLnNoYXJlZC5oZWFkZXI7XG4gICAgICB2YXIgaXNQb3NpdGlvbmVkQXRUb3AgPSBoZWFkZXJCYWNrc3RhZ2UuaXNQb3NpdGlvbmVkQXRUb3A7XG4gICAgICB2YXIgdG9vbGJhck1vZGUgPSBnZXRUb29sYmFyTW9kZShlZGl0b3IpO1xuICAgICAgdmFyIGlzU3BsaXRUb29sYmFyID0gdG9vbGJhck1vZGUgPT09IFRvb2xiYXJNb2RlLnNsaWRpbmcgfHwgdG9vbGJhck1vZGUgPT09IFRvb2xiYXJNb2RlLmZsb2F0aW5nO1xuICAgICAgdmFyIHZpc2libGUgPSBDZWxsKGZhbHNlKTtcbiAgICAgIHZhciBpc1Zpc2libGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2aXNpYmxlLmdldCgpICYmICFlZGl0b3IucmVtb3ZlZDtcbiAgICAgIH07XG4gICAgICB2YXIgY2FsY1Rvb2xiYXJPZmZzZXQgPSBmdW5jdGlvbiAodG9vbGJhcikge1xuICAgICAgICByZXR1cm4gaXNTcGxpdFRvb2xiYXIgPyB0b29sYmFyLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9LCBmdW5jdGlvbiAodGJhcikge1xuICAgICAgICAgIHJldHVybiB0YmFyLmNvbXBvbmVudHMoKS5sZW5ndGggPiAxID8gZ2V0JDcodGJhci5jb21wb25lbnRzKClbMV0uZWxlbWVudCkgOiAwO1xuICAgICAgICB9KSA6IDA7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGNNb2RlID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICBzd2l0Y2ggKGdldFRvb2xiYXJMb2NhdGlvbihlZGl0b3IpKSB7XG4gICAgICAgIGNhc2UgVG9vbGJhckxvY2F0aW9uLmF1dG86XG4gICAgICAgICAgdmFyIHRvb2xiYXJfMSA9IE91dGVyQ29udGFpbmVyLmdldFRvb2xiYXIob3V0ZXJDb250YWluZXIpO1xuICAgICAgICAgIHZhciBvZmZzZXQgPSBjYWxjVG9vbGJhck9mZnNldCh0b29sYmFyXzEpO1xuICAgICAgICAgIHZhciB0b29sYmFySGVpZ2h0ID0gZ2V0JDcoY29udGFpbmVyLmVsZW1lbnQpIC0gb2Zmc2V0O1xuICAgICAgICAgIHZhciB0YXJnZXRCb3VuZHMgPSBib3godGFyZ2V0RWxtKTtcbiAgICAgICAgICB2YXIgcm9vbUF0VG9wID0gdGFyZ2V0Qm91bmRzLnkgPiB0b29sYmFySGVpZ2h0O1xuICAgICAgICAgIGlmIChyb29tQXRUb3ApIHtcbiAgICAgICAgICAgIHJldHVybiAndG9wJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGRvYyA9IGRvY3VtZW50RWxlbWVudCh0YXJnZXRFbG0pO1xuICAgICAgICAgICAgdmFyIGRvY0hlaWdodCA9IE1hdGgubWF4KGRvYy5kb20uc2Nyb2xsSGVpZ2h0LCBnZXQkNyhkb2MpKTtcbiAgICAgICAgICAgIHZhciByb29tQXRCb3R0b20gPSB0YXJnZXRCb3VuZHMuYm90dG9tIDwgZG9jSGVpZ2h0IC0gdG9vbGJhckhlaWdodDtcbiAgICAgICAgICAgIGlmIChyb29tQXRCb3R0b20pIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdib3R0b20nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFyIHdpbkJvdW5kcyA9IHdpbigpO1xuICAgICAgICAgICAgICB2YXIgaXNSb29tQXRCb3R0b21WaWV3cG9ydCA9IHdpbkJvdW5kcy5ib3R0b20gPCB0YXJnZXRCb3VuZHMuYm90dG9tIC0gdG9vbGJhckhlaWdodDtcbiAgICAgICAgICAgICAgcmV0dXJuIGlzUm9vbUF0Qm90dG9tVmlld3BvcnQgPyAnYm90dG9tJyA6ICd0b3AnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgY2FzZSBUb29sYmFyTG9jYXRpb24uYm90dG9tOlxuICAgICAgICAgIHJldHVybiAnYm90dG9tJztcbiAgICAgICAgY2FzZSBUb29sYmFyTG9jYXRpb24udG9wOlxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiAndG9wJztcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBzZXR1cE1vZGUgPSBmdW5jdGlvbiAobW9kZSkge1xuICAgICAgICB2YXIgY29udGFpbmVyID0gZmxvYXRDb250YWluZXIuZ2V0KCk7XG4gICAgICAgIERvY2tpbmcuc2V0TW9kZXMoY29udGFpbmVyLCBbbW9kZV0pO1xuICAgICAgICBoZWFkZXJCYWNrc3RhZ2Uuc2V0RG9ja2luZ01vZGUobW9kZSk7XG4gICAgICAgIHZhciB2ZXJ0aWNhbERpciA9IGlzUG9zaXRpb25lZEF0VG9wKCkgPyBBdHRyaWJ1dGVWYWx1ZS5Ub3BUb0JvdHRvbSA6IEF0dHJpYnV0ZVZhbHVlLkJvdHRvbVRvVG9wO1xuICAgICAgICBzZXQkMShjb250YWluZXIuZWxlbWVudCwgQXR0cmlidXRlLCB2ZXJ0aWNhbERpcik7XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZUNocm9tZVdpZHRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbWF4V2lkdGggPSBlZGl0b3JNYXhXaWR0aE9wdC5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgYm9keU1hcmdpbiA9IHBhcnNlVG9JbnQoZ2V0JDUoYm9keSgpLCAnbWFyZ2luLWxlZnQnKSkuZ2V0T3IoMCk7XG4gICAgICAgICAgcmV0dXJuIGdldCQ4KGJvZHkoKSkgLSBhYnNvbHV0ZSh0YXJnZXRFbG0pLmxlZnQgKyBib2R5TWFyZ2luO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0JDIoZmxvYXRDb250YWluZXIuZ2V0KCkuZWxlbWVudCwgJ21heC13aWR0aCcsIG1heFdpZHRoICsgJ3B4Jyk7XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZUNocm9tZVBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9vbGJhciA9IE91dGVyQ29udGFpbmVyLmdldFRvb2xiYXIob3V0ZXJDb250YWluZXIpO1xuICAgICAgICB2YXIgb2Zmc2V0ID0gY2FsY1Rvb2xiYXJPZmZzZXQodG9vbGJhcik7XG4gICAgICAgIHZhciB0YXJnZXRCb3VuZHMgPSBib3godGFyZ2V0RWxtKTtcbiAgICAgICAgdmFyIHRvcCA9IGlzUG9zaXRpb25lZEF0VG9wKCkgPyBNYXRoLm1heCh0YXJnZXRCb3VuZHMueSAtIGdldCQ3KGZsb2F0Q29udGFpbmVyLmdldCgpLmVsZW1lbnQpICsgb2Zmc2V0LCAwKSA6IHRhcmdldEJvdW5kcy5ib3R0b207XG4gICAgICAgIHNldEFsbCQxKG91dGVyQ29udGFpbmVyLmVsZW1lbnQsIHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICB0b3A6IE1hdGgucm91bmQodG9wKSArICdweCcsXG4gICAgICAgICAgbGVmdDogTWF0aC5yb3VuZCh0YXJnZXRCb3VuZHMueCkgKyAncHgnXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciByZXBvc2l0aW9uUG9wdXBzJDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHVpTW90aGVyc2hpcC5icm9hZGNhc3RPbihbcmVwb3NpdGlvblBvcHVwcygpXSwge30pO1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGVDaHJvbWVVaSA9IGZ1bmN0aW9uIChyZXNldERvY2tpbmcpIHtcbiAgICAgICAgaWYgKHJlc2V0RG9ja2luZyA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmVzZXREb2NraW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1Zpc2libGUoKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXVzZUZpeGVkVG9vbGJhckNvbnRhaW5lcikge1xuICAgICAgICAgIHVwZGF0ZUNocm9tZVdpZHRoKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzU3BsaXRUb29sYmFyKSB7XG4gICAgICAgICAgT3V0ZXJDb250YWluZXIucmVmcmVzaFRvb2xiYXIob3V0ZXJDb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdXNlRml4ZWRUb29sYmFyQ29udGFpbmVyKSB7XG4gICAgICAgICAgdXBkYXRlQ2hyb21lUG9zaXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTdGlja3kpIHtcbiAgICAgICAgICB2YXIgZmxvYXRDb250YWluZXJDb21wID0gZmxvYXRDb250YWluZXIuZ2V0KCk7XG4gICAgICAgICAgcmVzZXREb2NraW5nID8gRG9ja2luZy5yZXNldChmbG9hdENvbnRhaW5lckNvbXApIDogRG9ja2luZy5yZWZyZXNoKGZsb2F0Q29udGFpbmVyQ29tcCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVwb3NpdGlvblBvcHVwcyQxKCk7XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZU1vZGUgPSBmdW5jdGlvbiAodXBkYXRlVWkpIHtcbiAgICAgICAgaWYgKHVwZGF0ZVVpID09PSB2b2lkIDApIHtcbiAgICAgICAgICB1cGRhdGVVaSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZUZpeGVkVG9vbGJhckNvbnRhaW5lciB8fCAhaXNTdGlja3kgfHwgIWlzVmlzaWJsZSgpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjdXJyZW50TW9kZSA9IGhlYWRlckJhY2tzdGFnZS5nZXREb2NraW5nTW9kZSgpO1xuICAgICAgICB2YXIgbmV3TW9kZSA9IGNhbGNNb2RlKGZsb2F0Q29udGFpbmVyLmdldCgpKTtcbiAgICAgICAgaWYgKG5ld01vZGUgIT09IGN1cnJlbnRNb2RlKSB7XG4gICAgICAgICAgc2V0dXBNb2RlKG5ld01vZGUpO1xuICAgICAgICAgIGlmICh1cGRhdGVVaSkge1xuICAgICAgICAgICAgdXBkYXRlQ2hyb21lVWkodHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHNob3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZpc2libGUuc2V0KHRydWUpO1xuICAgICAgICBzZXQkMihvdXRlckNvbnRhaW5lci5lbGVtZW50LCAnZGlzcGxheScsICdmbGV4Jyk7XG4gICAgICAgIERPTS5hZGRDbGFzcyhlZGl0b3IuZ2V0Qm9keSgpLCAnbWNlLWVkaXQtZm9jdXMnKTtcbiAgICAgICAgcmVtb3ZlJDYodWlNb3RoZXJzaGlwLmVsZW1lbnQsICdkaXNwbGF5Jyk7XG4gICAgICAgIHVwZGF0ZU1vZGUoZmFsc2UpO1xuICAgICAgICB1cGRhdGVDaHJvbWVVaSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBoaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2aXNpYmxlLnNldChmYWxzZSk7XG4gICAgICAgIGlmICh1aUNvbXBvbmVudHMub3V0ZXJDb250YWluZXIpIHtcbiAgICAgICAgICBzZXQkMihvdXRlckNvbnRhaW5lci5lbGVtZW50LCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgRE9NLnJlbW92ZUNsYXNzKGVkaXRvci5nZXRCb2R5KCksICdtY2UtZWRpdC1mb2N1cycpO1xuICAgICAgICB9XG4gICAgICAgIHNldCQyKHVpTW90aGVyc2hpcC5lbGVtZW50LCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWaXNpYmxlOiBpc1Zpc2libGUsXG4gICAgICAgIGlzUG9zaXRpb25lZEF0VG9wOiBpc1Bvc2l0aW9uZWRBdFRvcCxcbiAgICAgICAgc2hvdzogc2hvdyxcbiAgICAgICAgaGlkZTogaGlkZSxcbiAgICAgICAgdXBkYXRlOiB1cGRhdGVDaHJvbWVVaSxcbiAgICAgICAgdXBkYXRlTW9kZTogdXBkYXRlTW9kZSxcbiAgICAgICAgcmVwb3NpdGlvblBvcHVwczogcmVwb3NpdGlvblBvcHVwcyQxXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2V0VGFyZ2V0UG9zQW5kQm91bmRzID0gZnVuY3Rpb24gKHRhcmdldEVsbSwgaXNUb29sYmFyVG9wKSB7XG4gICAgICB2YXIgYm91bmRzID0gYm94KHRhcmdldEVsbSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3M6IGlzVG9vbGJhclRvcCA/IGJvdW5kcy55IDogYm91bmRzLmJvdHRvbSxcbiAgICAgICAgYm91bmRzOiBib3VuZHNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2V0dXBFdmVudHMkMSA9IGZ1bmN0aW9uIChlZGl0b3IsIHRhcmdldEVsbSwgdWksIHRvb2xiYXJQZXJzaXN0KSB7XG4gICAgICB2YXIgcHJldlBvc0FuZEJvdW5kcyA9IENlbGwoZ2V0VGFyZ2V0UG9zQW5kQm91bmRzKHRhcmdldEVsbSwgdWkuaXNQb3NpdGlvbmVkQXRUb3AoKSkpO1xuICAgICAgdmFyIHJlc2l6ZUNvbnRlbnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgX2EgPSBnZXRUYXJnZXRQb3NBbmRCb3VuZHModGFyZ2V0RWxtLCB1aS5pc1Bvc2l0aW9uZWRBdFRvcCgpKSwgcG9zID0gX2EucG9zLCBib3VuZHMgPSBfYS5ib3VuZHM7XG4gICAgICAgIHZhciBfYiA9IHByZXZQb3NBbmRCb3VuZHMuZ2V0KCksIHByZXZQb3MgPSBfYi5wb3MsIHByZXZCb3VuZHMgPSBfYi5ib3VuZHM7XG4gICAgICAgIHZhciBoYXNSZXNpemVkID0gYm91bmRzLmhlaWdodCAhPT0gcHJldkJvdW5kcy5oZWlnaHQgfHwgYm91bmRzLndpZHRoICE9PSBwcmV2Qm91bmRzLndpZHRoO1xuICAgICAgICBwcmV2UG9zQW5kQm91bmRzLnNldCh7XG4gICAgICAgICAgcG9zOiBwb3MsXG4gICAgICAgICAgYm91bmRzOiBib3VuZHNcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChoYXNSZXNpemVkKSB7XG4gICAgICAgICAgZmlyZVJlc2l6ZUNvbnRlbnQoZWRpdG9yLCBlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodWkuaXNWaXNpYmxlKCkpIHtcbiAgICAgICAgICBpZiAocHJldlBvcyAhPT0gcG9zKSB7XG4gICAgICAgICAgICB1aS51cGRhdGUodHJ1ZSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChoYXNSZXNpemVkKSB7XG4gICAgICAgICAgICB1aS51cGRhdGVNb2RlKCk7XG4gICAgICAgICAgICB1aS5yZXBvc2l0aW9uUG9wdXBzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaWYgKCF0b29sYmFyUGVyc2lzdCkge1xuICAgICAgICBlZGl0b3Iub24oJ2FjdGl2YXRlJywgdWkuc2hvdyk7XG4gICAgICAgIGVkaXRvci5vbignZGVhY3RpdmF0ZScsIHVpLmhpZGUpO1xuICAgICAgfVxuICAgICAgZWRpdG9yLm9uKCdTa2luTG9hZGVkIFJlc2l6ZVdpbmRvdycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLnVwZGF0ZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdOb2RlQ2hhbmdlIGtleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBnbG9iYWwkMi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiByZXNpemVDb250ZW50KGUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdTY3JvbGxXaW5kb3cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS51cGRhdGVNb2RlKCk7XG4gICAgICB9KTtcbiAgICAgIHZhciBlbGVtZW50TG9hZCA9IHVuYmluZGFibGUoKTtcbiAgICAgIGVsZW1lbnRMb2FkLnNldChjYXB0dXJlJDEoU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldEJvZHkoKSksICdsb2FkJywgcmVzaXplQ29udGVudCkpO1xuICAgICAgZWRpdG9yLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVsZW1lbnRMb2FkLmNsZWFyKCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXIkMiA9IGZ1bmN0aW9uIChlZGl0b3IsIHVpQ29tcG9uZW50cywgcmF3VWlDb25maWcsIGJhY2tzdGFnZSwgYXJncykge1xuICAgICAgdmFyIG1vdGhlcnNoaXAgPSB1aUNvbXBvbmVudHMubW90aGVyc2hpcCwgdWlNb3RoZXJzaGlwID0gdWlDb21wb25lbnRzLnVpTW90aGVyc2hpcCwgb3V0ZXJDb250YWluZXIgPSB1aUNvbXBvbmVudHMub3V0ZXJDb250YWluZXI7XG4gICAgICB2YXIgZmxvYXRDb250YWluZXIgPSBDZWxsKG51bGwpO1xuICAgICAgdmFyIHRhcmdldEVsbSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGFyZ3MudGFyZ2V0Tm9kZSk7XG4gICAgICB2YXIgdWkgPSBJbmxpbmVIZWFkZXIoZWRpdG9yLCB0YXJnZXRFbG0sIHVpQ29tcG9uZW50cywgYmFja3N0YWdlLCBmbG9hdENvbnRhaW5lcik7XG4gICAgICB2YXIgdG9vbGJhclBlcnNpc3QgPSBpc1Rvb2xiYXJQZXJzaXN0KGVkaXRvcik7XG4gICAgICBpbmxpbmUoZWRpdG9yKTtcbiAgICAgIHZhciByZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChmbG9hdENvbnRhaW5lci5nZXQoKSkge1xuICAgICAgICAgIHVpLnNob3coKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZmxvYXRDb250YWluZXIuc2V0KE91dGVyQ29udGFpbmVyLmdldEhlYWRlcihvdXRlckNvbnRhaW5lcikuZ2V0T3JEaWUoKSk7XG4gICAgICAgIHZhciB1aUNvbnRhaW5lciA9IGdldFVpQ29udGFpbmVyKGVkaXRvcik7XG4gICAgICAgIGF0dGFjaFN5c3RlbSh1aUNvbnRhaW5lciwgbW90aGVyc2hpcCk7XG4gICAgICAgIGF0dGFjaFN5c3RlbSh1aUNvbnRhaW5lciwgdWlNb3RoZXJzaGlwKTtcbiAgICAgICAgc2V0VG9vbGJhcihlZGl0b3IsIHVpQ29tcG9uZW50cywgcmF3VWlDb25maWcsIGJhY2tzdGFnZSk7XG4gICAgICAgIE91dGVyQ29udGFpbmVyLnNldE1lbnViYXIob3V0ZXJDb250YWluZXIsIGlkZW50aWZ5TWVudXMoZWRpdG9yLCByYXdVaUNvbmZpZykpO1xuICAgICAgICB1aS5zaG93KCk7XG4gICAgICAgIHNldHVwRXZlbnRzJDEoZWRpdG9yLCB0YXJnZXRFbG0sIHVpLCB0b29sYmFyUGVyc2lzdCk7XG4gICAgICAgIGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbignc2hvdycsIHJlbmRlcik7XG4gICAgICBlZGl0b3Iub24oJ2hpZGUnLCB1aS5oaWRlKTtcbiAgICAgIGlmICghdG9vbGJhclBlcnNpc3QpIHtcbiAgICAgICAgZWRpdG9yLm9uKCdmb2N1cycsIHJlbmRlcik7XG4gICAgICAgIGVkaXRvci5vbignYmx1cicsIHVpLmhpZGUpO1xuICAgICAgfVxuICAgICAgZWRpdG9yLm9uKCdpbml0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZWRpdG9yLmhhc0ZvY3VzKCkgfHwgdG9vbGJhclBlcnNpc3QpIHtcbiAgICAgICAgICByZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBzZXR1cFJlYWRvbmx5TW9kZVN3aXRjaChlZGl0b3IsIHVpQ29tcG9uZW50cyk7XG4gICAgICB2YXIgYXBpID0ge1xuICAgICAgICBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdWkuc2hvdygpO1xuICAgICAgICB9LFxuICAgICAgICBoaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdWkuaGlkZSgpO1xuICAgICAgICB9LFxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBicm9hZGNhc3RSZWFkb25seSh1aUNvbXBvbmVudHMsIGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJyb2FkY2FzdFJlYWRvbmx5KHVpQ29tcG9uZW50cywgdHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gRGlzYWJsaW5nLmlzRGlzYWJsZWQob3V0ZXJDb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWRpdG9yQ29udGFpbmVyOiBvdXRlckNvbnRhaW5lci5lbGVtZW50LmRvbSxcbiAgICAgICAgYXBpOiBhcGlcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBJbmxpbmUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICAgICAgcmVuZGVyOiByZW5kZXIkMlxuICAgIH0pO1xuXG4gICAgdmFyIHJlZ2lzdGVyJDUgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgYWxpZ25Ub29sYmFyQnV0dG9ucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdhbGlnbmxlZnQnLFxuICAgICAgICAgIHRleHQ6ICdBbGlnbiBsZWZ0JyxcbiAgICAgICAgICBjbWQ6ICdKdXN0aWZ5TGVmdCcsXG4gICAgICAgICAgaWNvbjogJ2FsaWduLWxlZnQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYWxpZ25jZW50ZXInLFxuICAgICAgICAgIHRleHQ6ICdBbGlnbiBjZW50ZXInLFxuICAgICAgICAgIGNtZDogJ0p1c3RpZnlDZW50ZXInLFxuICAgICAgICAgIGljb246ICdhbGlnbi1jZW50ZXInXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYWxpZ25yaWdodCcsXG4gICAgICAgICAgdGV4dDogJ0FsaWduIHJpZ2h0JyxcbiAgICAgICAgICBjbWQ6ICdKdXN0aWZ5UmlnaHQnLFxuICAgICAgICAgIGljb246ICdhbGlnbi1yaWdodCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdhbGlnbmp1c3RpZnknLFxuICAgICAgICAgIHRleHQ6ICdKdXN0aWZ5JyxcbiAgICAgICAgICBjbWQ6ICdKdXN0aWZ5RnVsbCcsXG4gICAgICAgICAgaWNvbjogJ2FsaWduLWp1c3RpZnknXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICBnbG9iYWwkYy5lYWNoKGFsaWduVG9vbGJhckJ1dHRvbnMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24oaXRlbS5uYW1lLCB7XG4gICAgICAgICAgdG9vbHRpcDogaXRlbS50ZXh0LFxuICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKGl0ZW0uY21kKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGljb246IGl0ZW0uaWNvbixcbiAgICAgICAgICBvblNldHVwOiBvblNldHVwRm9ybWF0VG9nZ2xlKGVkaXRvciwgaXRlbS5uYW1lKVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGFsaWduTm9uZVRvb2xiYXJCdXR0b24gPSB7XG4gICAgICAgIG5hbWU6ICdhbGlnbm5vbmUnLFxuICAgICAgICB0ZXh0OiAnTm8gYWxpZ25tZW50JyxcbiAgICAgICAgY21kOiAnSnVzdGlmeU5vbmUnLFxuICAgICAgICBpY29uOiAnYWxpZ24tbm9uZSdcbiAgICAgIH07XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKGFsaWduTm9uZVRvb2xiYXJCdXR0b24ubmFtZSwge1xuICAgICAgICB0b29sdGlwOiBhbGlnbk5vbmVUb29sYmFyQnV0dG9uLnRleHQsXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGVkaXRvci5leGVjQ29tbWFuZChhbGlnbk5vbmVUb29sYmFyQnV0dG9uLmNtZCk7XG4gICAgICAgIH0sXG4gICAgICAgIGljb246IGFsaWduTm9uZVRvb2xiYXJCdXR0b24uaWNvblxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZWdpc3RlciQ2ID0gZnVuY3Rpb24gKGVkaXRvciwgYmFja3N0YWdlKSB7XG4gICAgICBhbGlnblNlbGVjdE1lbnUoZWRpdG9yLCBiYWNrc3RhZ2UpO1xuICAgICAgZm9udFNlbGVjdE1lbnUoZWRpdG9yLCBiYWNrc3RhZ2UpO1xuICAgICAgc3R5bGVTZWxlY3RNZW51KGVkaXRvciwgYmFja3N0YWdlKTtcbiAgICAgIGZvcm1hdFNlbGVjdE1lbnUoZWRpdG9yLCBiYWNrc3RhZ2UpO1xuICAgICAgZm9udHNpemVTZWxlY3RNZW51KGVkaXRvciwgYmFja3N0YWdlKTtcbiAgICB9O1xuXG4gICAgdmFyIHRvZ2dsZU91dGRlbnRTdGF0ZSA9IGZ1bmN0aW9uIChhcGksIGVkaXRvcikge1xuICAgICAgYXBpLnNldERpc2FibGVkKCFlZGl0b3IucXVlcnlDb21tYW5kU3RhdGUoJ291dGRlbnQnKSk7XG4gICAgICB2YXIgb25Ob2RlQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBhcGkuc2V0RGlzYWJsZWQoIWVkaXRvci5xdWVyeUNvbW1hbmRTdGF0ZSgnb3V0ZGVudCcpKTtcbiAgICAgIH07XG4gICAgICBlZGl0b3Iub24oJ05vZGVDaGFuZ2UnLCBvbk5vZGVDaGFuZ2UpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGVkaXRvci5vZmYoJ05vZGVDaGFuZ2UnLCBvbk5vZGVDaGFuZ2UpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlckJ1dHRvbnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCdvdXRkZW50Jywge1xuICAgICAgICB0b29sdGlwOiAnRGVjcmVhc2UgaW5kZW50JyxcbiAgICAgICAgaWNvbjogJ291dGRlbnQnLFxuICAgICAgICBvblNldHVwOiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgcmV0dXJuIHRvZ2dsZU91dGRlbnRTdGF0ZShhcGksIGVkaXRvcik7XG4gICAgICAgIH0sXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGVkaXRvci5leGVjQ29tbWFuZCgnb3V0ZGVudCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRCdXR0b24oJ2luZGVudCcsIHtcbiAgICAgICAgdG9vbHRpcDogJ0luY3JlYXNlIGluZGVudCcsXG4gICAgICAgIGljb246ICdpbmRlbnQnLFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoJ2luZGVudCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlciQ3ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmVnaXN0ZXJCdXR0b25zKGVkaXRvcik7XG4gICAgfTtcblxuICAgIHZhciB1bml0cyA9IHtcbiAgICAgIHVuc3VwcG9ydGVkTGVuZ3RoOiBbXG4gICAgICAgICdlbScsXG4gICAgICAgICdleCcsXG4gICAgICAgICdjYXAnLFxuICAgICAgICAnY2gnLFxuICAgICAgICAnaWMnLFxuICAgICAgICAncmVtJyxcbiAgICAgICAgJ2xoJyxcbiAgICAgICAgJ3JsaCcsXG4gICAgICAgICd2dycsXG4gICAgICAgICd2aCcsXG4gICAgICAgICd2aScsXG4gICAgICAgICd2YicsXG4gICAgICAgICd2bWluJyxcbiAgICAgICAgJ3ZtYXgnLFxuICAgICAgICAnY20nLFxuICAgICAgICAnbW0nLFxuICAgICAgICAnUScsXG4gICAgICAgICdpbicsXG4gICAgICAgICdwYycsXG4gICAgICAgICdwdCcsXG4gICAgICAgICdweCdcbiAgICAgIF0sXG4gICAgICBmaXhlZDogW1xuICAgICAgICAncHgnLFxuICAgICAgICAncHQnXG4gICAgICBdLFxuICAgICAgcmVsYXRpdmU6IFsnJSddLFxuICAgICAgZW1wdHk6IFsnJ11cbiAgICB9O1xuICAgIHZhciBwYXR0ZXJuID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRlY2ltYWxEaWdpdHMgPSAnWzAtOV0rJztcbiAgICAgIHZhciBzaWduZWRJbnRlZ2VyID0gJ1srLV0/JyArIGRlY2ltYWxEaWdpdHM7XG4gICAgICB2YXIgZXhwb25lbnRQYXJ0ID0gJ1tlRV0nICsgc2lnbmVkSW50ZWdlcjtcbiAgICAgIHZhciBkb3QgPSAnXFxcXC4nO1xuICAgICAgdmFyIG9wdCA9IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICByZXR1cm4gJyg/OicgKyBpbnB1dCArICcpPyc7XG4gICAgICB9O1xuICAgICAgdmFyIHVuc2lnbmVkRGVjaW1hbExpdGVyYWwgPSBbXG4gICAgICAgICdJbmZpbml0eScsXG4gICAgICAgIGRlY2ltYWxEaWdpdHMgKyBkb3QgKyBvcHQoZGVjaW1hbERpZ2l0cykgKyBvcHQoZXhwb25lbnRQYXJ0KSxcbiAgICAgICAgZG90ICsgZGVjaW1hbERpZ2l0cyArIG9wdChleHBvbmVudFBhcnQpLFxuICAgICAgICBkZWNpbWFsRGlnaXRzICsgb3B0KGV4cG9uZW50UGFydClcbiAgICAgIF0uam9pbignfCcpO1xuICAgICAgdmFyIGZsb2F0ID0gJ1srLV0/KD86JyArIHVuc2lnbmVkRGVjaW1hbExpdGVyYWwgKyAnKSc7XG4gICAgICByZXR1cm4gbmV3IFJlZ0V4cCgnXignICsgZmxvYXQgKyAnKSguKikkJyk7XG4gICAgfSgpO1xuICAgIHZhciBpc1VuaXQgPSBmdW5jdGlvbiAodW5pdCwgYWNjZXB0ZWQpIHtcbiAgICAgIHJldHVybiBleGlzdHMoYWNjZXB0ZWQsIGZ1bmN0aW9uIChhY2MpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0cyh1bml0c1thY2NdLCBmdW5jdGlvbiAoY2hlY2spIHtcbiAgICAgICAgICByZXR1cm4gdW5pdCA9PT0gY2hlY2s7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcGFyc2UgPSBmdW5jdGlvbiAoaW5wdXQsIGFjY2VwdGVkKSB7XG4gICAgICB2YXIgbWF0Y2ggPSBPcHRpb25hbC5mcm9tKHBhdHRlcm4uZXhlYyhpbnB1dCkpO1xuICAgICAgcmV0dXJuIG1hdGNoLmJpbmQoZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IE51bWJlcihhcnJheVsxXSk7XG4gICAgICAgIHZhciB1bml0UmF3ID0gYXJyYXlbMl07XG4gICAgICAgIGlmIChpc1VuaXQodW5pdFJhdywgYWNjZXB0ZWQpKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgdW5pdDogdW5pdFJhd1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG5vcm1hbGlzZSA9IGZ1bmN0aW9uIChpbnB1dCwgYWNjZXB0ZWQpIHtcbiAgICAgIHJldHVybiBwYXJzZShpbnB1dCwgYWNjZXB0ZWQpLm1hcChmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gX2EudmFsdWUsIHVuaXQgPSBfYS51bml0O1xuICAgICAgICByZXR1cm4gdmFsdWUgKyB1bml0O1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBub3JtYWxpc2VMaW5lSGVpZ2h0ID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICByZXR1cm4gbm9ybWFsaXNlKGlucHV0LCBbXG4gICAgICAgICdmaXhlZCcsXG4gICAgICAgICdyZWxhdGl2ZScsXG4gICAgICAgICdlbXB0eSdcbiAgICAgIF0pLmdldE9yKGlucHV0KTtcbiAgICB9O1xuICAgIHZhciBnZXRMaW5lSGVpZ2h0cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBvcHRpb25zID0gZ2V0TGluZUhlaWdodEZvcm1hdHMoZWRpdG9yKTtcbiAgICAgIHZhciBhcGlzID0gbmV3IE1hcCgpO1xuICAgICAgdmFyIGxhc3RBcGkgPSBkZXN0cm95YWJsZSgpO1xuICAgICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3VycmVudCA9IG5vcm1hbGlzZUxpbmVIZWlnaHQoZWRpdG9yLnF1ZXJ5Q29tbWFuZFZhbHVlKCdMaW5lSGVpZ2h0JykpO1xuICAgICAgICBPcHRpb25hbC5mcm9tKGFwaXMuZ2V0KGN1cnJlbnQpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbGFzdEFwaS5jbGVhcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgbGFzdEFwaS5zZXQoe1xuICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBhcGkuc2V0QWN0aXZlKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhcGkuc2V0QWN0aXZlKHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICBlZGl0b3Iub24oJ25vZGVDaGFuZ2UnLCBjYWxsYmFjayk7XG4gICAgICByZXR1cm4gbWFwKG9wdGlvbnMsIGZ1bmN0aW9uICh2YWx1ZSwgaSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHR5cGU6ICd0b2dnbGVtZW51aXRlbScsXG4gICAgICAgICAgdGV4dDogdmFsdWUsXG4gICAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgICAgYXBpcy5zZXQobm9ybWFsaXNlTGluZUhlaWdodCh2YWx1ZSksIGFwaSk7XG4gICAgICAgICAgICBpZiAoaSArIDEgPT09IG9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGVkaXRvci5vZmYoJ25vZGVDaGFuZ2UnLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgbGFzdEFwaS5jbGVhcigpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoJ0xpbmVIZWlnaHQnLCBmYWxzZSwgdmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyTWVudUl0ZW1zID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE5lc3RlZE1lbnVJdGVtKCdsaW5laGVpZ2h0Jywge1xuICAgICAgICB0eXBlOiAnbmVzdGVkbWVudWl0ZW0nLFxuICAgICAgICB0ZXh0OiAnTGluZSBoZWlnaHQnLFxuICAgICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0TGluZUhlaWdodHMoZWRpdG9yKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJCdXR0b25zJDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUJ1dHRvbignbGluZWhlaWdodCcsIHtcbiAgICAgICAgdG9vbHRpcDogJ0xpbmUgaGVpZ2h0JyxcbiAgICAgICAgaWNvbjogJ2xpbmUtaGVpZ2h0JyxcbiAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhnZXRMaW5lSGVpZ2h0cyhlZGl0b3IpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXIkOCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJlZ2lzdGVyTWVudUl0ZW1zKGVkaXRvcik7XG4gICAgICByZWdpc3RlckJ1dHRvbnMkMShlZGl0b3IpO1xuICAgIH07XG5cbiAgICB2YXIgdG9nZ2xlRm9ybWF0ID0gZnVuY3Rpb24gKGVkaXRvciwgZm10KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZVRvZ2dsZUZvcm1hdCcsIGZhbHNlLCBmbXQpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlckZvcm1hdEJ1dHRvbnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBnbG9iYWwkYy5lYWNoKFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdib2xkJyxcbiAgICAgICAgICB0ZXh0OiAnQm9sZCcsXG4gICAgICAgICAgaWNvbjogJ2JvbGQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnaXRhbGljJyxcbiAgICAgICAgICB0ZXh0OiAnSXRhbGljJyxcbiAgICAgICAgICBpY29uOiAnaXRhbGljJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3VuZGVybGluZScsXG4gICAgICAgICAgdGV4dDogJ1VuZGVybGluZScsXG4gICAgICAgICAgaWNvbjogJ3VuZGVybGluZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdzdHJpa2V0aHJvdWdoJyxcbiAgICAgICAgICB0ZXh0OiAnU3RyaWtldGhyb3VnaCcsXG4gICAgICAgICAgaWNvbjogJ3N0cmlrZS10aHJvdWdoJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3N1YnNjcmlwdCcsXG4gICAgICAgICAgdGV4dDogJ1N1YnNjcmlwdCcsXG4gICAgICAgICAgaWNvbjogJ3N1YnNjcmlwdCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdzdXBlcnNjcmlwdCcsXG4gICAgICAgICAgdGV4dDogJ1N1cGVyc2NyaXB0JyxcbiAgICAgICAgICBpY29uOiAnc3VwZXJzY3JpcHQnXG4gICAgICAgIH1cbiAgICAgIF0sIGZ1bmN0aW9uIChidG4sIF9pZHgpIHtcbiAgICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZFRvZ2dsZUJ1dHRvbihidG4ubmFtZSwge1xuICAgICAgICAgIHRvb2x0aXA6IGJ0bi50ZXh0LFxuICAgICAgICAgIGljb246IGJ0bi5pY29uLFxuICAgICAgICAgIG9uU2V0dXA6IG9uU2V0dXBGb3JtYXRUb2dnbGUoZWRpdG9yLCBidG4ubmFtZSksXG4gICAgICAgICAgb25BY3Rpb246IHRvZ2dsZUZvcm1hdChlZGl0b3IsIGJ0bi5uYW1lKVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gNjsgaSsrKSB7XG4gICAgICAgIHZhciBuYW1lXzEgPSAnaCcgKyBpO1xuICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkVG9nZ2xlQnV0dG9uKG5hbWVfMSwge1xuICAgICAgICAgIHRleHQ6IG5hbWVfMS50b1VwcGVyQ2FzZSgpLFxuICAgICAgICAgIHRvb2x0aXA6ICdIZWFkaW5nICcgKyBpLFxuICAgICAgICAgIG9uU2V0dXA6IG9uU2V0dXBGb3JtYXRUb2dnbGUoZWRpdG9yLCBuYW1lXzEpLFxuICAgICAgICAgIG9uQWN0aW9uOiB0b2dnbGVGb3JtYXQoZWRpdG9yLCBuYW1lXzEpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyQ29tbWFuZEJ1dHRvbnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBnbG9iYWwkYy5lYWNoKFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdjdXQnLFxuICAgICAgICAgIHRleHQ6ICdDdXQnLFxuICAgICAgICAgIGFjdGlvbjogJ0N1dCcsXG4gICAgICAgICAgaWNvbjogJ2N1dCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdjb3B5JyxcbiAgICAgICAgICB0ZXh0OiAnQ29weScsXG4gICAgICAgICAgYWN0aW9uOiAnQ29weScsXG4gICAgICAgICAgaWNvbjogJ2NvcHknXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAncGFzdGUnLFxuICAgICAgICAgIHRleHQ6ICdQYXN0ZScsXG4gICAgICAgICAgYWN0aW9uOiAnUGFzdGUnLFxuICAgICAgICAgIGljb246ICdwYXN0ZSdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdoZWxwJyxcbiAgICAgICAgICB0ZXh0OiAnSGVscCcsXG4gICAgICAgICAgYWN0aW9uOiAnbWNlSGVscCcsXG4gICAgICAgICAgaWNvbjogJ2hlbHAnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnc2VsZWN0YWxsJyxcbiAgICAgICAgICB0ZXh0OiAnU2VsZWN0IGFsbCcsXG4gICAgICAgICAgYWN0aW9uOiAnU2VsZWN0QWxsJyxcbiAgICAgICAgICBpY29uOiAnc2VsZWN0LWFsbCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICduZXdkb2N1bWVudCcsXG4gICAgICAgICAgdGV4dDogJ05ldyBkb2N1bWVudCcsXG4gICAgICAgICAgYWN0aW9uOiAnbWNlTmV3RG9jdW1lbnQnLFxuICAgICAgICAgIGljb246ICduZXctZG9jdW1lbnQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAncmVtb3ZlZm9ybWF0JyxcbiAgICAgICAgICB0ZXh0OiAnQ2xlYXIgZm9ybWF0dGluZycsXG4gICAgICAgICAgYWN0aW9uOiAnUmVtb3ZlRm9ybWF0JyxcbiAgICAgICAgICBpY29uOiAncmVtb3ZlLWZvcm1hdHRpbmcnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAncmVtb3ZlJyxcbiAgICAgICAgICB0ZXh0OiAnUmVtb3ZlJyxcbiAgICAgICAgICBhY3Rpb246ICdEZWxldGUnLFxuICAgICAgICAgIGljb246ICdyZW1vdmUnXG4gICAgICAgIH1cbiAgICAgIF0sIGZ1bmN0aW9uIChidG4pIHtcbiAgICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbihidG4ubmFtZSwge1xuICAgICAgICAgIHRvb2x0aXA6IGJ0bi50ZXh0LFxuICAgICAgICAgIGljb246IGJ0bi5pY29uLFxuICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKGJ0bi5hY3Rpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlckNvbW1hbmRUb2dnbGVCdXR0b25zID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZ2xvYmFsJGMuZWFjaChbe1xuICAgICAgICAgIG5hbWU6ICdibG9ja3F1b3RlJyxcbiAgICAgICAgICB0ZXh0OiAnQmxvY2txdW90ZScsXG4gICAgICAgICAgYWN0aW9uOiAnbWNlQmxvY2tRdW90ZScsXG4gICAgICAgICAgaWNvbjogJ3F1b3RlJ1xuICAgICAgICB9XSwgZnVuY3Rpb24gKGJ0bikge1xuICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkVG9nZ2xlQnV0dG9uKGJ0bi5uYW1lLCB7XG4gICAgICAgICAgdG9vbHRpcDogYnRuLnRleHQsXG4gICAgICAgICAgaWNvbjogYnRuLmljb24sXG4gICAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoYnRuLmFjdGlvbik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblNldHVwOiBvblNldHVwRm9ybWF0VG9nZ2xlKGVkaXRvciwgYnRuLm5hbWUpXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJCdXR0b25zJDIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZWdpc3RlckZvcm1hdEJ1dHRvbnMoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyQ29tbWFuZEJ1dHRvbnMoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyQ29tbWFuZFRvZ2dsZUJ1dHRvbnMoZWRpdG9yKTtcbiAgICB9O1xuICAgIHZhciByZWdpc3Rlck1lbnVJdGVtcyQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZ2xvYmFsJGMuZWFjaChbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYm9sZCcsXG4gICAgICAgICAgdGV4dDogJ0JvbGQnLFxuICAgICAgICAgIGFjdGlvbjogJ0JvbGQnLFxuICAgICAgICAgIGljb246ICdib2xkJyxcbiAgICAgICAgICBzaG9ydGN1dDogJ01ldGErQidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdpdGFsaWMnLFxuICAgICAgICAgIHRleHQ6ICdJdGFsaWMnLFxuICAgICAgICAgIGFjdGlvbjogJ0l0YWxpYycsXG4gICAgICAgICAgaWNvbjogJ2l0YWxpYycsXG4gICAgICAgICAgc2hvcnRjdXQ6ICdNZXRhK0knXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAndW5kZXJsaW5lJyxcbiAgICAgICAgICB0ZXh0OiAnVW5kZXJsaW5lJyxcbiAgICAgICAgICBhY3Rpb246ICdVbmRlcmxpbmUnLFxuICAgICAgICAgIGljb246ICd1bmRlcmxpbmUnLFxuICAgICAgICAgIHNob3J0Y3V0OiAnTWV0YStVJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3N0cmlrZXRocm91Z2gnLFxuICAgICAgICAgIHRleHQ6ICdTdHJpa2V0aHJvdWdoJyxcbiAgICAgICAgICBhY3Rpb246ICdTdHJpa2V0aHJvdWdoJyxcbiAgICAgICAgICBpY29uOiAnc3RyaWtlLXRocm91Z2gnLFxuICAgICAgICAgIHNob3J0Y3V0OiAnJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3N1YnNjcmlwdCcsXG4gICAgICAgICAgdGV4dDogJ1N1YnNjcmlwdCcsXG4gICAgICAgICAgYWN0aW9uOiAnU3Vic2NyaXB0JyxcbiAgICAgICAgICBpY29uOiAnc3Vic2NyaXB0JyxcbiAgICAgICAgICBzaG9ydGN1dDogJydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdzdXBlcnNjcmlwdCcsXG4gICAgICAgICAgdGV4dDogJ1N1cGVyc2NyaXB0JyxcbiAgICAgICAgICBhY3Rpb246ICdTdXBlcnNjcmlwdCcsXG4gICAgICAgICAgaWNvbjogJ3N1cGVyc2NyaXB0JyxcbiAgICAgICAgICBzaG9ydGN1dDogJydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdyZW1vdmVmb3JtYXQnLFxuICAgICAgICAgIHRleHQ6ICdDbGVhciBmb3JtYXR0aW5nJyxcbiAgICAgICAgICBhY3Rpb246ICdSZW1vdmVGb3JtYXQnLFxuICAgICAgICAgIGljb246ICdyZW1vdmUtZm9ybWF0dGluZycsXG4gICAgICAgICAgc2hvcnRjdXQ6ICcnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnbmV3ZG9jdW1lbnQnLFxuICAgICAgICAgIHRleHQ6ICdOZXcgZG9jdW1lbnQnLFxuICAgICAgICAgIGFjdGlvbjogJ21jZU5ld0RvY3VtZW50JyxcbiAgICAgICAgICBpY29uOiAnbmV3LWRvY3VtZW50JyxcbiAgICAgICAgICBzaG9ydGN1dDogJydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdjdXQnLFxuICAgICAgICAgIHRleHQ6ICdDdXQnLFxuICAgICAgICAgIGFjdGlvbjogJ0N1dCcsXG4gICAgICAgICAgaWNvbjogJ2N1dCcsXG4gICAgICAgICAgc2hvcnRjdXQ6ICdNZXRhK1gnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnY29weScsXG4gICAgICAgICAgdGV4dDogJ0NvcHknLFxuICAgICAgICAgIGFjdGlvbjogJ0NvcHknLFxuICAgICAgICAgIGljb246ICdjb3B5JyxcbiAgICAgICAgICBzaG9ydGN1dDogJ01ldGErQydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdwYXN0ZScsXG4gICAgICAgICAgdGV4dDogJ1Bhc3RlJyxcbiAgICAgICAgICBhY3Rpb246ICdQYXN0ZScsXG4gICAgICAgICAgaWNvbjogJ3Bhc3RlJyxcbiAgICAgICAgICBzaG9ydGN1dDogJ01ldGErVidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdzZWxlY3RhbGwnLFxuICAgICAgICAgIHRleHQ6ICdTZWxlY3QgYWxsJyxcbiAgICAgICAgICBhY3Rpb246ICdTZWxlY3RBbGwnLFxuICAgICAgICAgIGljb246ICdzZWxlY3QtYWxsJyxcbiAgICAgICAgICBzaG9ydGN1dDogJ01ldGErQSdcbiAgICAgICAgfVxuICAgICAgXSwgZnVuY3Rpb24gKGJ0bikge1xuICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oYnRuLm5hbWUsIHtcbiAgICAgICAgICB0ZXh0OiBidG4udGV4dCxcbiAgICAgICAgICBpY29uOiBidG4uaWNvbixcbiAgICAgICAgICBzaG9ydGN1dDogYnRuLnNob3J0Y3V0LFxuICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKGJ0bi5hY3Rpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgnY29kZWZvcm1hdCcsIHtcbiAgICAgICAgdGV4dDogJ0NvZGUnLFxuICAgICAgICBpY29uOiAnc291cmNlY29kZScsXG4gICAgICAgIG9uQWN0aW9uOiB0b2dnbGVGb3JtYXQoZWRpdG9yLCAnY29kZScpXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlciQ5ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmVnaXN0ZXJCdXR0b25zJDIoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyTWVudUl0ZW1zJDEoZWRpdG9yKTtcbiAgICB9O1xuXG4gICAgdmFyIHRvZ2dsZVVuZG9SZWRvU3RhdGUgPSBmdW5jdGlvbiAoYXBpLCBlZGl0b3IsIHR5cGUpIHtcbiAgICAgIHZhciBjaGVja1N0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLnVuZG9NYW5hZ2VyID8gZWRpdG9yLnVuZG9NYW5hZ2VyW3R5cGVdKCkgOiBmYWxzZTtcbiAgICAgIH07XG4gICAgICB2YXIgb25VbmRvU3RhdGVDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFwaS5zZXREaXNhYmxlZChlZGl0b3IubW9kZS5pc1JlYWRPbmx5KCkgfHwgIWNoZWNrU3RhdGUoKSk7XG4gICAgICB9O1xuICAgICAgYXBpLnNldERpc2FibGVkKCFjaGVja1N0YXRlKCkpO1xuICAgICAgZWRpdG9yLm9uKCdVbmRvIFJlZG8gQWRkVW5kbyBUeXBpbmdVbmRvIENsZWFyVW5kb3MgU3dpdGNoTW9kZScsIG9uVW5kb1N0YXRlQ2hhbmdlKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBlZGl0b3Iub2ZmKCdVbmRvIFJlZG8gQWRkVW5kbyBUeXBpbmdVbmRvIENsZWFyVW5kb3MgU3dpdGNoTW9kZScsIG9uVW5kb1N0YXRlQ2hhbmdlKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJNZW51SXRlbXMkMiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndW5kbycsIHtcbiAgICAgICAgdGV4dDogJ1VuZG8nLFxuICAgICAgICBpY29uOiAndW5kbycsXG4gICAgICAgIHNob3J0Y3V0OiAnTWV0YStaJyxcbiAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgIHJldHVybiB0b2dnbGVVbmRvUmVkb1N0YXRlKGFwaSwgZWRpdG9yLCAnaGFzVW5kbycpO1xuICAgICAgICB9LFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoJ3VuZG8nKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3JlZG8nLCB7XG4gICAgICAgIHRleHQ6ICdSZWRvJyxcbiAgICAgICAgaWNvbjogJ3JlZG8nLFxuICAgICAgICBzaG9ydGN1dDogJ01ldGErWScsXG4gICAgICAgIG9uU2V0dXA6IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICByZXR1cm4gdG9nZ2xlVW5kb1JlZG9TdGF0ZShhcGksIGVkaXRvciwgJ2hhc1JlZG8nKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKCdyZWRvJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyQnV0dG9ucyQzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigndW5kbycsIHtcbiAgICAgICAgdG9vbHRpcDogJ1VuZG8nLFxuICAgICAgICBpY29uOiAndW5kbycsXG4gICAgICAgIG9uU2V0dXA6IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICByZXR1cm4gdG9nZ2xlVW5kb1JlZG9TdGF0ZShhcGksIGVkaXRvciwgJ2hhc1VuZG8nKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKCd1bmRvJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigncmVkbycsIHtcbiAgICAgICAgdG9vbHRpcDogJ1JlZG8nLFxuICAgICAgICBpY29uOiAncmVkbycsXG4gICAgICAgIG9uU2V0dXA6IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICByZXR1cm4gdG9nZ2xlVW5kb1JlZG9TdGF0ZShhcGksIGVkaXRvciwgJ2hhc1JlZG8nKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKCdyZWRvJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyJGEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZWdpc3Rlck1lbnVJdGVtcyQyKGVkaXRvcik7XG4gICAgICByZWdpc3RlckJ1dHRvbnMkMyhlZGl0b3IpO1xuICAgIH07XG5cbiAgICB2YXIgdG9nZ2xlVmlzdWFsQWlkU3RhdGUgPSBmdW5jdGlvbiAoYXBpLCBlZGl0b3IpIHtcbiAgICAgIGFwaS5zZXRBY3RpdmUoZWRpdG9yLmhhc1Zpc3VhbCk7XG4gICAgICB2YXIgb25WaXN1YWxBaWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBhcGkuc2V0QWN0aXZlKGUuaGFzVmlzdWFsKTtcbiAgICAgIH07XG4gICAgICBlZGl0b3Iub24oJ1Zpc3VhbEFpZCcsIG9uVmlzdWFsQWlkKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBlZGl0b3Iub2ZmKCdWaXN1YWxBaWQnLCBvblZpc3VhbEFpZCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyTWVudUl0ZW1zJDMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkVG9nZ2xlTWVudUl0ZW0oJ3Zpc3VhbGFpZCcsIHtcbiAgICAgICAgdGV4dDogJ1Zpc3VhbCBhaWRzJyxcbiAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICAgIHJldHVybiB0b2dnbGVWaXN1YWxBaWRTdGF0ZShhcGksIGVkaXRvcik7XG4gICAgICAgIH0sXG4gICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VUb2dnbGVWaXN1YWxBaWQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXJUb29sYmFyQnV0dG9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigndmlzdWFsYWlkJywge1xuICAgICAgICB0b29sdGlwOiAnVmlzdWFsIGFpZHMnLFxuICAgICAgICB0ZXh0OiAnVmlzdWFsIGFpZHMnLFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZVRvZ2dsZVZpc3VhbEFpZCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlciRiID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmVnaXN0ZXJUb29sYmFyQnV0dG9uKGVkaXRvcik7XG4gICAgICByZWdpc3Rlck1lbnVJdGVtcyQzKGVkaXRvcik7XG4gICAgfTtcblxuICAgIHZhciBzZXR1cCQ4ID0gZnVuY3Rpb24gKGVkaXRvciwgYmFja3N0YWdlKSB7XG4gICAgICByZWdpc3RlciQ1KGVkaXRvcik7XG4gICAgICByZWdpc3RlciQ5KGVkaXRvcik7XG4gICAgICByZWdpc3RlciQ2KGVkaXRvciwgYmFja3N0YWdlKTtcbiAgICAgIHJlZ2lzdGVyJGEoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyJDEoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyJGIoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyJDcoZWRpdG9yKTtcbiAgICAgIHJlZ2lzdGVyJDgoZWRpdG9yKTtcbiAgICB9O1xuXG4gICAgdmFyIG51JGQgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYW5jaG9yOiAnbWFrZXNoaWZ0JyxcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0cmFuc3Bvc2UkMSA9IGZ1bmN0aW9uIChwb3MsIGR4LCBkeSkge1xuICAgICAgcmV0dXJuIG51JGQocG9zLnggKyBkeCwgcG9zLnkgKyBkeSk7XG4gICAgfTtcbiAgICB2YXIgaXNUb3VjaEV2ZW50JDEgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGUudHlwZSA9PT0gJ2xvbmdwcmVzcycgfHwgZS50eXBlLmluZGV4T2YoJ3RvdWNoJykgPT09IDA7XG4gICAgfTtcbiAgICB2YXIgZnJvbVBhZ2VYWSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoaXNUb3VjaEV2ZW50JDEoZSkpIHtcbiAgICAgICAgdmFyIHRvdWNoID0gZS50b3VjaGVzWzBdO1xuICAgICAgICByZXR1cm4gbnUkZCh0b3VjaC5wYWdlWCwgdG91Y2gucGFnZVkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51JGQoZS5wYWdlWCwgZS5wYWdlWSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZnJvbUNsaWVudFhZID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChpc1RvdWNoRXZlbnQkMShlKSkge1xuICAgICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgICAgIHJldHVybiBudSRkKHRvdWNoLmNsaWVudFgsIHRvdWNoLmNsaWVudFkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51JGQoZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHRyYW5zcG9zZUNvbnRlbnRBcmVhQ29udGFpbmVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHBvcykge1xuICAgICAgdmFyIGNvbnRhaW5lclBvcyA9IGdsb2JhbCQ1LkRPTS5nZXRQb3MoZWxlbWVudCk7XG4gICAgICByZXR1cm4gdHJhbnNwb3NlJDEocG9zLCBjb250YWluZXJQb3MueCwgY29udGFpbmVyUG9zLnkpO1xuICAgIH07XG4gICAgdmFyIGdldFBvaW50QW5jaG9yID0gZnVuY3Rpb24gKGVkaXRvciwgZSkge1xuICAgICAgaWYgKGUudHlwZSA9PT0gJ2NvbnRleHRtZW51JyB8fCBlLnR5cGUgPT09ICdsb25ncHJlc3MnKSB7XG4gICAgICAgIGlmIChlZGl0b3IuaW5saW5lKSB7XG4gICAgICAgICAgcmV0dXJuIGZyb21QYWdlWFkoZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRyYW5zcG9zZUNvbnRlbnRBcmVhQ29udGFpbmVyKGVkaXRvci5nZXRDb250ZW50QXJlYUNvbnRhaW5lcigpLCBmcm9tQ2xpZW50WFkoZSkpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uQW5jaG9yKGVkaXRvcik7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0U2VsZWN0aW9uQW5jaG9yID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYW5jaG9yOiAnc2VsZWN0aW9uJyxcbiAgICAgICAgcm9vdDogU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCkpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldE5vZGVBbmNob3IkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFuY2hvcjogJ25vZGUnLFxuICAgICAgICBub2RlOiBPcHRpb25hbC5zb21lKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5zZWxlY3Rpb24uZ2V0Tm9kZSgpKSksXG4gICAgICAgIHJvb3Q6IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXRCb2R5KCkpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgaW5pdEFuZFNob3cgPSBmdW5jdGlvbiAoZWRpdG9yLCBlLCBidWlsZE1lbnUsIGJhY2tzdGFnZSwgY29udGV4dG1lbnUsIHVzZU5vZGVBbmNob3IpIHtcbiAgICAgIHZhciBpdGVtcyA9IGJ1aWxkTWVudSgpO1xuICAgICAgdmFyIGFuY2hvclNwZWMgPSB1c2VOb2RlQW5jaG9yID8gZ2V0Tm9kZUFuY2hvciQxKGVkaXRvcikgOiBnZXRQb2ludEFuY2hvcihlZGl0b3IsIGUpO1xuICAgICAgYnVpbGQkMihpdGVtcywgSXRlbVJlc3BvbnNlJDEuQ0xPU0VfT05fRVhFQ1VURSwgYmFja3N0YWdlLCBmYWxzZSkubWFwKGZ1bmN0aW9uIChtZW51RGF0YSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIElubGluZVZpZXcuc2hvd01lbnVBdChjb250ZXh0bWVudSwgYW5jaG9yU3BlYywge1xuICAgICAgICAgIG1lbnU6IHsgbWFya2VyczogbWFya2VycyQxKCdub3JtYWwnKSB9LFxuICAgICAgICAgIGRhdGE6IG1lbnVEYXRhXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBsYXlvdXRzID0ge1xuICAgICAgb25MdHI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBzb3V0aCQxLFxuICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoJDEsXG4gICAgICAgICAgbm9ydGgkMyxcbiAgICAgICAgICBzb3V0aCQzLFxuICAgICAgICAgIG5vcnRoZWFzdCQzLFxuICAgICAgICAgIHNvdXRoZWFzdCQzLFxuICAgICAgICAgIG5vcnRod2VzdCQzLFxuICAgICAgICAgIHNvdXRod2VzdCQzXG4gICAgICAgIF07XG4gICAgICB9LFxuICAgICAgb25SdGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBzb3V0aCQxLFxuICAgICAgICAgIHNvdXRod2VzdCQxLFxuICAgICAgICAgIHNvdXRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRod2VzdCQxLFxuICAgICAgICAgIG5vcnRoZWFzdCQxLFxuICAgICAgICAgIG5vcnRoJDEsXG4gICAgICAgICAgbm9ydGgkMyxcbiAgICAgICAgICBzb3V0aCQzLFxuICAgICAgICAgIG5vcnRod2VzdCQzLFxuICAgICAgICAgIHNvdXRod2VzdCQzLFxuICAgICAgICAgIG5vcnRoZWFzdCQzLFxuICAgICAgICAgIHNvdXRoZWFzdCQzXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgYnViYmxlU2l6ZSQxID0gMTI7XG4gICAgdmFyIGJ1YmJsZUFsaWdubWVudHMkMiA9IHtcbiAgICAgIHZhbGlnbkNlbnRyZTogW10sXG4gICAgICBhbGlnbkNlbnRyZTogW10sXG4gICAgICBhbGlnbkxlZnQ6IFsndG94LXBvcC0tYWxpZ24tbGVmdCddLFxuICAgICAgYWxpZ25SaWdodDogWyd0b3gtcG9wLS1hbGlnbi1yaWdodCddLFxuICAgICAgcmlnaHQ6IFsndG94LXBvcC0tcmlnaHQnXSxcbiAgICAgIGxlZnQ6IFsndG94LXBvcC0tbGVmdCddLFxuICAgICAgYm90dG9tOiBbJ3RveC1wb3AtLWJvdHRvbSddLFxuICAgICAgdG9wOiBbJ3RveC1wb3AtLXRvcCddXG4gICAgfTtcbiAgICB2YXIgaXNUb3VjaFdpdGhpblNlbGVjdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IsIGUpIHtcbiAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uO1xuICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpIHx8IGUudG91Y2hlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0b3VjaF8xID0gZS50b3VjaGVzWzBdO1xuICAgICAgICB2YXIgcm5nID0gc2VsZWN0aW9uLmdldFJuZygpO1xuICAgICAgICB2YXIgcm5nUmVjdE9wdCA9IGdldEZpcnN0UmVjdCQxKGVkaXRvci5nZXRXaW4oKSwgU2ltU2VsZWN0aW9uLmRvbVJhbmdlKHJuZykpO1xuICAgICAgICByZXR1cm4gcm5nUmVjdE9wdC5leGlzdHMoZnVuY3Rpb24gKHJuZ1JlY3QpIHtcbiAgICAgICAgICByZXR1cm4gcm5nUmVjdC5sZWZ0IDw9IHRvdWNoXzEuY2xpZW50WCAmJiBybmdSZWN0LnJpZ2h0ID49IHRvdWNoXzEuY2xpZW50WCAmJiBybmdSZWN0LnRvcCA8PSB0b3VjaF8xLmNsaWVudFkgJiYgcm5nUmVjdC5ib3R0b20gPj0gdG91Y2hfMS5jbGllbnRZO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRQb2ludEFuY2hvclNwZWMgPSBmdW5jdGlvbiAoZWRpdG9yLCBlKSB7XG4gICAgICByZXR1cm4gX19hc3NpZ24oe1xuICAgICAgICBidWJibGU6IG51JDgoMCwgYnViYmxlU2l6ZSQxLCBidWJibGVBbGlnbm1lbnRzJDIpLFxuICAgICAgICBsYXlvdXRzOiBsYXlvdXRzLFxuICAgICAgICBvdmVycmlkZXM6IHtcbiAgICAgICAgICBtYXhXaWR0aEZ1bmN0aW9uOiBleHBhbmRhYmxlJDEoKSxcbiAgICAgICAgICBtYXhIZWlnaHRGdW5jdGlvbjogZXhwYW5kYWJsZSgpXG4gICAgICAgIH1cbiAgICAgIH0sIGdldFBvaW50QW5jaG9yKGVkaXRvciwgZSkpO1xuICAgIH07XG4gICAgdmFyIHNldHVwaU9TT3ZlcnJpZGVzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIG9yaWdpbmFsU2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKTtcbiAgICAgIHZhciBzZWxlY3Rpb25SZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2xvYmFsJDIuc2V0RWRpdG9yVGltZW91dChlZGl0b3IsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhvcmlnaW5hbFNlbGVjdGlvbik7XG4gICAgICAgIH0sIDEwKTtcbiAgICAgICAgdW5iaW5kRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgIH07XG4gICAgICBlZGl0b3Iub25jZSgndG91Y2hlbmQnLCBzZWxlY3Rpb25SZXNldCk7XG4gICAgICB2YXIgcHJldmVudE1vdXNlZG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgIH07XG4gICAgICBlZGl0b3Iub24oJ21vdXNlZG93bicsIHByZXZlbnRNb3VzZWRvd24sIHRydWUpO1xuICAgICAgdmFyIGNsZWFyU2VsZWN0aW9uUmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1bmJpbmRFdmVudExpc3RlbmVycygpO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbmNlKCdsb25ncHJlc3NjYW5jZWwnLCBjbGVhclNlbGVjdGlvblJlc2V0KTtcbiAgICAgIHZhciB1bmJpbmRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZWRpdG9yLm9mZigndG91Y2hlbmQnLCBzZWxlY3Rpb25SZXNldCk7XG4gICAgICAgIGVkaXRvci5vZmYoJ2xvbmdwcmVzc2NhbmNlbCcsIGNsZWFyU2VsZWN0aW9uUmVzZXQpO1xuICAgICAgICBlZGl0b3Iub2ZmKCdtb3VzZWRvd24nLCBwcmV2ZW50TW91c2Vkb3duKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2hvdyA9IGZ1bmN0aW9uIChlZGl0b3IsIGUsIGl0ZW1zLCBiYWNrc3RhZ2UsIGNvbnRleHRtZW51LCB1c2VOb2RlQW5jaG9yLCBoaWdobGlnaHRJbW1lZGlhdGVseSkge1xuICAgICAgdmFyIGFuY2hvclNwZWMgPSB1c2VOb2RlQW5jaG9yID8gZ2V0Tm9kZUFuY2hvciQxKGVkaXRvcikgOiBnZXRQb2ludEFuY2hvclNwZWMoZWRpdG9yLCBlKTtcbiAgICAgIGJ1aWxkJDIoaXRlbXMsIEl0ZW1SZXNwb25zZSQxLkNMT1NFX09OX0VYRUNVVEUsIGJhY2tzdGFnZSwgdHJ1ZSkubWFwKGZ1bmN0aW9uIChtZW51RGF0YSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIElubGluZVZpZXcuc2hvd01lbnVXaXRoaW5Cb3VuZHMoY29udGV4dG1lbnUsIGFuY2hvclNwZWMsIHtcbiAgICAgICAgICBtZW51OiB7XG4gICAgICAgICAgICBtYXJrZXJzOiBtYXJrZXJzJDEoJ25vcm1hbCcpLFxuICAgICAgICAgICAgaGlnaGxpZ2h0SW1tZWRpYXRlbHk6IGhpZ2hsaWdodEltbWVkaWF0ZWx5XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkYXRhOiBtZW51RGF0YSxcbiAgICAgICAgICB0eXBlOiAnaG9yaXpvbnRhbCdcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGdldENvbnRleHRUb29sYmFyQm91bmRzKGVkaXRvciwgYmFja3N0YWdlLnNoYXJlZCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLmZpcmUoaGlkZUNvbnRleHRUb29sYmFyRXZlbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5pdEFuZFNob3ckMSA9IGZ1bmN0aW9uIChlZGl0b3IsIGUsIGJ1aWxkTWVudSwgYmFja3N0YWdlLCBjb250ZXh0bWVudSwgdXNlTm9kZUFuY2hvcikge1xuICAgICAgdmFyIGRldGVjdGlvbiA9IGRldGVjdCQzKCk7XG4gICAgICB2YXIgaXNpT1MgPSBkZXRlY3Rpb24ub3MuaXNpT1MoKTtcbiAgICAgIHZhciBpc09TWCA9IGRldGVjdGlvbi5vcy5pc09TWCgpO1xuICAgICAgdmFyIGlzQW5kcm9pZCA9IGRldGVjdGlvbi5vcy5pc0FuZHJvaWQoKTtcbiAgICAgIHZhciBpc1RvdWNoID0gZGV0ZWN0aW9uLmRldmljZVR5cGUuaXNUb3VjaCgpO1xuICAgICAgdmFyIHNob3VsZEhpZ2hsaWdodEltbWVkaWF0ZWx5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gIShpc0FuZHJvaWQgfHwgaXNpT1MgfHwgaXNPU1ggJiYgaXNUb3VjaCk7XG4gICAgICB9O1xuICAgICAgdmFyIG9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpdGVtcyA9IGJ1aWxkTWVudSgpO1xuICAgICAgICBzaG93KGVkaXRvciwgZSwgaXRlbXMsIGJhY2tzdGFnZSwgY29udGV4dG1lbnUsIHVzZU5vZGVBbmNob3IsIHNob3VsZEhpZ2hsaWdodEltbWVkaWF0ZWx5KCkpO1xuICAgICAgfTtcbiAgICAgIGlmICgoaXNPU1ggfHwgaXNpT1MpICYmICF1c2VOb2RlQW5jaG9yKSB7XG4gICAgICAgIHZhciBvcGVuaU9TXzEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2V0dXBpT1NPdmVycmlkZXMoZWRpdG9yKTtcbiAgICAgICAgICBvcGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChpc1RvdWNoV2l0aGluU2VsZWN0aW9uKGVkaXRvciwgZSkpIHtcbiAgICAgICAgICBvcGVuaU9TXzEoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlZGl0b3Iub25jZSgnc2VsZWN0aW9uY2hhbmdlJywgb3BlbmlPU18xKTtcbiAgICAgICAgICBlZGl0b3Iub25jZSgndG91Y2hlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZWRpdG9yLm9mZignc2VsZWN0aW9uY2hhbmdlJywgb3BlbmlPU18xKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGlzQW5kcm9pZCAmJiAhdXNlTm9kZUFuY2hvcikge1xuICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24oZS50YXJnZXQsIDApO1xuICAgICAgICB9XG4gICAgICAgIG9wZW4oKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHBhdGNoUGlwZUNvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgIHJldHVybiB0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJyA/IGNvbmZpZy5zcGxpdCgvWyAsXS8pIDogY29uZmlnO1xuICAgIH07XG4gICAgdmFyIHNob3VsZE5ldmVyVXNlTmF0aXZlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnY29udGV4dG1lbnVfbmV2ZXJfdXNlX25hdGl2ZScsIGZhbHNlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGdldE1lbnVJdGVtcyA9IGZ1bmN0aW9uIChlZGl0b3IsIG5hbWUsIGRlZmF1bHRJdGVtcykge1xuICAgICAgdmFyIGNvbnRleHRNZW51cyA9IGVkaXRvci51aS5yZWdpc3RyeS5nZXRBbGwoKS5jb250ZXh0TWVudXM7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShlZGl0b3IuZ2V0UGFyYW0obmFtZSkpLm1hcChwYXRjaFBpcGVDb25maWcpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmlsdGVyKHBhdGNoUGlwZUNvbmZpZyhkZWZhdWx0SXRlbXMpLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHJldHVybiBoYXMoY29udGV4dE1lbnVzLCBpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpc0NvbnRleHRNZW51RGlzYWJsZWQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdjb250ZXh0bWVudScpID09PSBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBnZXRDb250ZXh0TWVudSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnZXRNZW51SXRlbXMoZWRpdG9yLCAnY29udGV4dG1lbnUnLCAnbGluayBsaW5rY2hlY2tlciBpbWFnZSBpbWFnZXRvb2xzIHRhYmxlIHNwZWxsY2hlY2tlciBjb25maWd1cmVwZXJtYW5lbnRwZW4nKTtcbiAgICB9O1xuICAgIHZhciBnZXRBdm9pZE92ZXJsYXBTZWxlY3RvciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2NvbnRleHRtZW51X2F2b2lkX292ZXJsYXAnLCAnJywgJ3N0cmluZycpO1xuICAgIH07XG5cbiAgICB2YXIgaXNTZXBhcmF0b3IkMSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gaXNTdHJpbmcoaXRlbSkgPyBpdGVtID09PSAnfCcgOiBpdGVtLnR5cGUgPT09ICdzZXBhcmF0b3InO1xuICAgIH07XG4gICAgdmFyIHNlcGFyYXRvciQzID0geyB0eXBlOiAnc2VwYXJhdG9yJyB9O1xuICAgIHZhciBtYWtlQ29udGV4dEl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIGNvbW1vbk1lbnVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0ZXh0OiBpdGVtLnRleHQsXG4gICAgICAgICAgaWNvbjogaXRlbS5pY29uLFxuICAgICAgICAgIGRpc2FibGVkOiBpdGVtLmRpc2FibGVkLFxuICAgICAgICAgIHNob3J0Y3V0OiBpdGVtLnNob3J0Y3V0XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgaWYgKGlzU3RyaW5nKGl0ZW0pKSB7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3dpdGNoIChpdGVtLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnc2VwYXJhdG9yJzpcbiAgICAgICAgICByZXR1cm4gc2VwYXJhdG9yJDM7XG4gICAgICAgIGNhc2UgJ3N1Ym1lbnUnOlxuICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7IHR5cGU6ICduZXN0ZWRtZW51aXRlbScgfSwgY29tbW9uTWVudUl0ZW0oaXRlbSkpLCB7XG4gICAgICAgICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gaXRlbS5nZXRTdWJtZW51SXRlbXMoKTtcbiAgICAgICAgICAgICAgaWYgKGlzU3RyaW5nKGl0ZW1zKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtcztcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFwKGl0ZW1zLCBtYWtlQ29udGV4dEl0ZW0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHsgdHlwZTogJ21lbnVpdGVtJyB9LCBjb21tb25NZW51SXRlbShpdGVtKSksIHsgb25BY3Rpb246IG5vYXJnKGl0ZW0ub25BY3Rpb24pIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgYWRkQ29udGV4dE1lbnVHcm91cCA9IGZ1bmN0aW9uICh4cywgZ3JvdXBJdGVtcykge1xuICAgICAgaWYgKGdyb3VwSXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB4cztcbiAgICAgIH1cbiAgICAgIHZhciBsYXN0TWVudUl0ZW0gPSBsYXN0KHhzKS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuICFpc1NlcGFyYXRvciQxKGl0ZW0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgYmVmb3JlID0gbGFzdE1lbnVJdGVtLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9LCBmdW5jdGlvbiAoXykge1xuICAgICAgICByZXR1cm4gW3NlcGFyYXRvciQzXTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHhzLmNvbmNhdChiZWZvcmUpLmNvbmNhdChncm91cEl0ZW1zKS5jb25jYXQoW3NlcGFyYXRvciQzXSk7XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGVDb250ZXh0TWVudSA9IGZ1bmN0aW9uIChjb250ZXh0TWVudXMsIG1lbnVDb25maWcsIHNlbGVjdGVkRWxlbWVudCkge1xuICAgICAgdmFyIHNlY3Rpb25zID0gZm9sZGwobWVudUNvbmZpZywgZnVuY3Rpb24gKGFjYywgbmFtZSkge1xuICAgICAgICByZXR1cm4gZ2V0JDEoY29udGV4dE1lbnVzLCBuYW1lLnRvTG93ZXJDYXNlKCkpLm1hcChmdW5jdGlvbiAobWVudSkge1xuICAgICAgICAgIHZhciBpdGVtcyA9IG1lbnUudXBkYXRlKHNlbGVjdGVkRWxlbWVudCk7XG4gICAgICAgICAgaWYgKGlzU3RyaW5nKGl0ZW1zKSkge1xuICAgICAgICAgICAgcmV0dXJuIGFkZENvbnRleHRNZW51R3JvdXAoYWNjLCBpdGVtcy5zcGxpdCgnICcpKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBhbGxJdGVtcyA9IG1hcChpdGVtcywgbWFrZUNvbnRleHRJdGVtKTtcbiAgICAgICAgICAgIHJldHVybiBhZGRDb250ZXh0TWVudUdyb3VwKGFjYywgYWxsSXRlbXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjYy5jb25jYXQoW25hbWVdKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBbXSk7XG4gICAgICBpZiAoc2VjdGlvbnMubGVuZ3RoID4gMCAmJiBpc1NlcGFyYXRvciQxKHNlY3Rpb25zW3NlY3Rpb25zLmxlbmd0aCAtIDFdKSkge1xuICAgICAgICBzZWN0aW9ucy5wb3AoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZWN0aW9ucztcbiAgICB9O1xuICAgIHZhciBpc05hdGl2ZU92ZXJyaWRlS2V5RXZlbnQgPSBmdW5jdGlvbiAoZWRpdG9yLCBlKSB7XG4gICAgICByZXR1cm4gZS5jdHJsS2V5ICYmICFzaG91bGROZXZlclVzZU5hdGl2ZShlZGl0b3IpO1xuICAgIH07XG4gICAgdmFyIGlzVHJpZ2dlcmVkQnlLZXlib2FyZCA9IGZ1bmN0aW9uIChlZGl0b3IsIGUpIHtcbiAgICAgIHJldHVybiBlLnR5cGUgIT09ICdsb25ncHJlc3MnICYmIChlLmJ1dHRvbiAhPT0gMiB8fCBlLnRhcmdldCA9PT0gZWRpdG9yLmdldEJvZHkoKSAmJiBlLnBvaW50ZXJUeXBlID09PSAnJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U2VsZWN0ZWRFbGVtZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgZSkge1xuICAgICAgcmV0dXJuIGlzVHJpZ2dlcmVkQnlLZXlib2FyZChlZGl0b3IsIGUpID8gZWRpdG9yLnNlbGVjdGlvbi5nZXRTdGFydCh0cnVlKSA6IGUudGFyZ2V0O1xuICAgIH07XG4gICAgdmFyIHNob3VsZFVzZU5vZGVBbmNob3IgPSBmdW5jdGlvbiAoZWRpdG9yLCBlKSB7XG4gICAgICB2YXIgc2VsZWN0b3IgPSBnZXRBdm9pZE92ZXJsYXBTZWxlY3RvcihlZGl0b3IpO1xuICAgICAgaWYgKGlzVHJpZ2dlcmVkQnlLZXlib2FyZChlZGl0b3IsIGUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChzZWxlY3Rvcikge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gZ2V0U2VsZWN0ZWRFbGVtZW50KGVkaXRvciwgZSk7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDQoU3VnYXJFbGVtZW50LmZyb21Eb20odGFyZ2V0KSwgc2VsZWN0b3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHNldHVwJDkgPSBmdW5jdGlvbiAoZWRpdG9yLCBsYXp5U2luaywgYmFja3N0YWdlKSB7XG4gICAgICB2YXIgZGV0ZWN0aW9uID0gZGV0ZWN0JDMoKTtcbiAgICAgIHZhciBpc1RvdWNoID0gZGV0ZWN0aW9uLmRldmljZVR5cGUuaXNUb3VjaDtcbiAgICAgIHZhciBjb250ZXh0bWVudSA9IGJ1aWxkJDEoSW5saW5lVmlldy5za2V0Y2goe1xuICAgICAgICBkb206IHsgdGFnOiAnZGl2JyB9LFxuICAgICAgICBsYXp5U2luazogbGF6eVNpbmssXG4gICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGVkaXRvci5mb2N1cygpO1xuICAgICAgICB9LFxuICAgICAgICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gYmFja3N0YWdlLnNldENvbnRleHRNZW51U3RhdGUodHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBiYWNrc3RhZ2Uuc2V0Q29udGV4dE1lbnVTdGF0ZShmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZpcmVEaXNtaXNzYWxFdmVudEluc3RlYWQ6IHt9LFxuICAgICAgICBpbmxpbmVCZWhhdmlvdXJzOiBkZXJpdmUkMShbY29uZmlnKCdkaXNtaXNzQ29udGV4dE1lbnUnLCBbcnVuKGRpc21pc3NSZXF1ZXN0ZWQoKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBTYW5kYm94aW5nLmNsb3NlKGNvbXApO1xuICAgICAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgIH0pXSldKVxuICAgICAgfSkpO1xuICAgICAgdmFyIGhpZGVDb250ZXh0TWVudSA9IGZ1bmN0aW9uIChfZSkge1xuICAgICAgICByZXR1cm4gSW5saW5lVmlldy5oaWRlKGNvbnRleHRtZW51KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2hvd0NvbnRleHRNZW51ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKHNob3VsZE5ldmVyVXNlTmF0aXZlKGVkaXRvcikpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzTmF0aXZlT3ZlcnJpZGVLZXlFdmVudChlZGl0b3IsIGUpIHx8IGlzQ29udGV4dE1lbnVEaXNhYmxlZChlZGl0b3IpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB1c2VOb2RlQW5jaG9yID0gc2hvdWxkVXNlTm9kZUFuY2hvcihlZGl0b3IsIGUpO1xuICAgICAgICB2YXIgYnVpbGRNZW51ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBzZWxlY3RlZEVsZW1lbnQgPSBnZXRTZWxlY3RlZEVsZW1lbnQoZWRpdG9yLCBlKTtcbiAgICAgICAgICB2YXIgcmVnaXN0cnkgPSBlZGl0b3IudWkucmVnaXN0cnkuZ2V0QWxsKCk7XG4gICAgICAgICAgdmFyIG1lbnVDb25maWcgPSBnZXRDb250ZXh0TWVudShlZGl0b3IpO1xuICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUNvbnRleHRNZW51KHJlZ2lzdHJ5LmNvbnRleHRNZW51cywgbWVudUNvbmZpZywgc2VsZWN0ZWRFbGVtZW50KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGluaXRBbmRTaG93JDIgPSBpc1RvdWNoKCkgPyBpbml0QW5kU2hvdyQxIDogaW5pdEFuZFNob3c7XG4gICAgICAgIGluaXRBbmRTaG93JDIoZWRpdG9yLCBlLCBidWlsZE1lbnUsIGJhY2tzdGFnZSwgY29udGV4dG1lbnUsIHVzZU5vZGVBbmNob3IpO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhpZGVFdmVudHMgPSAnUmVzaXplRWRpdG9yIFNjcm9sbENvbnRlbnQgU2Nyb2xsV2luZG93IGxvbmdwcmVzc2NhbmNlbCcgKyAoaXNUb3VjaCgpID8gJycgOiAnIFJlc2l6ZVdpbmRvdycpO1xuICAgICAgICBlZGl0b3Iub24oaGlkZUV2ZW50cywgaGlkZUNvbnRleHRNZW51KTtcbiAgICAgICAgZWRpdG9yLm9uKCdsb25ncHJlc3MgY29udGV4dG1lbnUnLCBzaG93Q29udGV4dE1lbnUpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBhZHQkYyA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7XG4gICAgICAgIG9mZnNldDogW1xuICAgICAgICAgICd4JyxcbiAgICAgICAgICAneSdcbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgYWJzb2x1dGU6IFtcbiAgICAgICAgICAneCcsXG4gICAgICAgICAgJ3knXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZpeGVkOiBbXG4gICAgICAgICAgJ3gnLFxuICAgICAgICAgICd5J1xuICAgICAgICBdXG4gICAgICB9XG4gICAgXSk7XG4gICAgdmFyIHN1YnRyYWN0ID0gZnVuY3Rpb24gKGNoYW5nZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgICByZXR1cm4gcG9pbnQudHJhbnNsYXRlKC1jaGFuZ2UubGVmdCwgLWNoYW5nZS50b3ApO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBhZGQkNCA9IGZ1bmN0aW9uIChjaGFuZ2UpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgcmV0dXJuIHBvaW50LnRyYW5zbGF0ZShjaGFuZ2UubGVmdCwgY2hhbmdlLnRvcCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHRyYW5zZm9ybSQxID0gZnVuY3Rpb24gKGNoYW5nZXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICByZXR1cm4gZm9sZGwoY2hhbmdlcywgZnVuY3Rpb24gKHJlc3QsIGYpIHtcbiAgICAgICAgICByZXR1cm4gZihyZXN0KTtcbiAgICAgICAgfSwgU3VnYXJQb3NpdGlvbih4LCB5KSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGFzRml4ZWQgPSBmdW5jdGlvbiAoY29vcmQsIHNjcm9sbCwgb3JpZ2luKSB7XG4gICAgICByZXR1cm4gY29vcmQuZm9sZCh0cmFuc2Zvcm0kMShbXG4gICAgICAgIGFkZCQ0KG9yaWdpbiksXG4gICAgICAgIHN1YnRyYWN0KHNjcm9sbClcbiAgICAgIF0pLCB0cmFuc2Zvcm0kMShbc3VidHJhY3Qoc2Nyb2xsKV0pLCB0cmFuc2Zvcm0kMShbXSkpO1xuICAgIH07XG4gICAgdmFyIGFzQWJzb2x1dGUgPSBmdW5jdGlvbiAoY29vcmQsIHNjcm9sbCwgb3JpZ2luKSB7XG4gICAgICByZXR1cm4gY29vcmQuZm9sZCh0cmFuc2Zvcm0kMShbYWRkJDQob3JpZ2luKV0pLCB0cmFuc2Zvcm0kMShbXSksIHRyYW5zZm9ybSQxKFthZGQkNChzY3JvbGwpXSkpO1xuICAgIH07XG4gICAgdmFyIGFzT2Zmc2V0ID0gZnVuY3Rpb24gKGNvb3JkLCBzY3JvbGwsIG9yaWdpbikge1xuICAgICAgcmV0dXJuIGNvb3JkLmZvbGQodHJhbnNmb3JtJDEoW10pLCB0cmFuc2Zvcm0kMShbc3VidHJhY3Qob3JpZ2luKV0pLCB0cmFuc2Zvcm0kMShbXG4gICAgICAgIGFkZCQ0KHNjcm9sbCksXG4gICAgICAgIHN1YnRyYWN0KG9yaWdpbilcbiAgICAgIF0pKTtcbiAgICB9O1xuICAgIHZhciB3aXRoaW5SYW5nZSA9IGZ1bmN0aW9uIChjb29yZDEsIGNvb3JkMiwgeFJhbmdlLCB5UmFuZ2UsIHNjcm9sbCwgb3JpZ2luKSB7XG4gICAgICB2YXIgYTEgPSBhc0Fic29sdXRlKGNvb3JkMSwgc2Nyb2xsLCBvcmlnaW4pO1xuICAgICAgdmFyIGEyID0gYXNBYnNvbHV0ZShjb29yZDIsIHNjcm9sbCwgb3JpZ2luKTtcbiAgICAgIHJldHVybiBNYXRoLmFicyhhMS5sZWZ0IC0gYTIubGVmdCkgPD0geFJhbmdlICYmIE1hdGguYWJzKGExLnRvcCAtIGEyLnRvcCkgPD0geVJhbmdlO1xuICAgIH07XG4gICAgdmFyIGdldERlbHRhcyA9IGZ1bmN0aW9uIChjb29yZDEsIGNvb3JkMiwgeFJhbmdlLCB5UmFuZ2UsIHNjcm9sbCwgb3JpZ2luKSB7XG4gICAgICB2YXIgYTEgPSBhc0Fic29sdXRlKGNvb3JkMSwgc2Nyb2xsLCBvcmlnaW4pO1xuICAgICAgdmFyIGEyID0gYXNBYnNvbHV0ZShjb29yZDIsIHNjcm9sbCwgb3JpZ2luKTtcbiAgICAgIHZhciBsZWZ0ID0gTWF0aC5hYnMoYTEubGVmdCAtIGEyLmxlZnQpO1xuICAgICAgdmFyIHRvcCA9IE1hdGguYWJzKGExLnRvcCAtIGEyLnRvcCk7XG4gICAgICByZXR1cm4gU3VnYXJQb3NpdGlvbihsZWZ0LCB0b3ApO1xuICAgIH07XG4gICAgdmFyIHRvU3R5bGVzID0gZnVuY3Rpb24gKGNvb3JkLCBzY3JvbGwsIG9yaWdpbikge1xuICAgICAgdmFyIHN0eWxlc09wdCA9IGNvb3JkLmZvbGQoZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBwb3NpdGlvbjogT3B0aW9uYWwuc29tZSgnYWJzb2x1dGUnKSxcbiAgICAgICAgICBsZWZ0OiBPcHRpb25hbC5zb21lKHggKyAncHgnKSxcbiAgICAgICAgICB0b3A6IE9wdGlvbmFsLnNvbWUoeSArICdweCcpXG4gICAgICAgIH07XG4gICAgICB9LCBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHBvc2l0aW9uOiBPcHRpb25hbC5zb21lKCdhYnNvbHV0ZScpLFxuICAgICAgICAgIGxlZnQ6IE9wdGlvbmFsLnNvbWUoeCAtIG9yaWdpbi5sZWZ0ICsgJ3B4JyksXG4gICAgICAgICAgdG9wOiBPcHRpb25hbC5zb21lKHkgLSBvcmlnaW4udG9wICsgJ3B4JylcbiAgICAgICAgfTtcbiAgICAgIH0sIGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcG9zaXRpb246IE9wdGlvbmFsLnNvbWUoJ2ZpeGVkJyksXG4gICAgICAgICAgbGVmdDogT3B0aW9uYWwuc29tZSh4ICsgJ3B4JyksXG4gICAgICAgICAgdG9wOiBPcHRpb25hbC5zb21lKHkgKyAncHgnKVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gX19hc3NpZ24oe1xuICAgICAgICByaWdodDogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICBib3R0b206IE9wdGlvbmFsLm5vbmUoKVxuICAgICAgfSwgc3R5bGVzT3B0KTtcbiAgICB9O1xuICAgIHZhciB0cmFuc2xhdGUkMiA9IGZ1bmN0aW9uIChjb29yZCwgZGVsdGFYLCBkZWx0YVkpIHtcbiAgICAgIHJldHVybiBjb29yZC5mb2xkKGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiBvZmZzZXQoeCArIGRlbHRhWCwgeSArIGRlbHRhWSk7XG4gICAgICB9LCBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICByZXR1cm4gYWJzb2x1dGUkMyh4ICsgZGVsdGFYLCB5ICsgZGVsdGFZKTtcbiAgICAgIH0sIGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiBmaXhlZCQxKHggKyBkZWx0YVgsIHkgKyBkZWx0YVkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYWJzb3JiID0gZnVuY3Rpb24gKHBhcnRpYWxDb29yZCwgb3JpZ2luYWxDb29yZCwgc2Nyb2xsLCBvcmlnaW4pIHtcbiAgICAgIHZhciBhYnNvcmJPbmUgPSBmdW5jdGlvbiAoc3RlbmNpbCwgbnUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChvcHRYLCBvcHRZKSB7XG4gICAgICAgICAgdmFyIG9yaWdpbmFsID0gc3RlbmNpbChvcmlnaW5hbENvb3JkLCBzY3JvbGwsIG9yaWdpbik7XG4gICAgICAgICAgcmV0dXJuIG51KG9wdFguZ2V0T3Iob3JpZ2luYWwubGVmdCksIG9wdFkuZ2V0T3Iob3JpZ2luYWwudG9wKSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHBhcnRpYWxDb29yZC5mb2xkKGFic29yYk9uZShhc09mZnNldCwgb2Zmc2V0KSwgYWJzb3JiT25lKGFzQWJzb2x1dGUsIGFic29sdXRlJDMpLCBhYnNvcmJPbmUoYXNGaXhlZCwgZml4ZWQkMSkpO1xuICAgIH07XG4gICAgdmFyIG9mZnNldCA9IGFkdCRjLm9mZnNldDtcbiAgICB2YXIgYWJzb2x1dGUkMyA9IGFkdCRjLmFic29sdXRlO1xuICAgIHZhciBmaXhlZCQxID0gYWR0JGMuZml4ZWQ7XG5cbiAgICB2YXIgcGFyc2VBdHRyVG9JbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgbmFtZSkge1xuICAgICAgdmFyIHZhbHVlID0gZ2V0JDMoZWxlbWVudCwgbmFtZSk7XG4gICAgICByZXR1cm4gaXNVbmRlZmluZWQodmFsdWUpID8gTmFOIDogcGFyc2VJbnQodmFsdWUsIDEwKTtcbiAgICB9O1xuICAgIHZhciBnZXQkZiA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNuYXBzSW5mbykge1xuICAgICAgdmFyIGVsZW1lbnQgPSBjb21wb25lbnQuZWxlbWVudDtcbiAgICAgIHZhciB4ID0gcGFyc2VBdHRyVG9JbnQoZWxlbWVudCwgc25hcHNJbmZvLmxlZnRBdHRyKTtcbiAgICAgIHZhciB5ID0gcGFyc2VBdHRyVG9JbnQoZWxlbWVudCwgc25hcHNJbmZvLnRvcEF0dHIpO1xuICAgICAgcmV0dXJuIGlzTmFOKHgpIHx8IGlzTmFOKHkpID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuc29tZShTdWdhclBvc2l0aW9uKHgsIHkpKTtcbiAgICB9O1xuICAgIHZhciBzZXQkOCA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNuYXBzSW5mbywgcHQpIHtcbiAgICAgIHZhciBlbGVtZW50ID0gY29tcG9uZW50LmVsZW1lbnQ7XG4gICAgICBzZXQkMShlbGVtZW50LCBzbmFwc0luZm8ubGVmdEF0dHIsIHB0LmxlZnQgKyAncHgnKTtcbiAgICAgIHNldCQxKGVsZW1lbnQsIHNuYXBzSW5mby50b3BBdHRyLCBwdC50b3AgKyAncHgnKTtcbiAgICB9O1xuICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNuYXBzSW5mbykge1xuICAgICAgdmFyIGVsZW1lbnQgPSBjb21wb25lbnQuZWxlbWVudDtcbiAgICAgIHJlbW92ZSQxKGVsZW1lbnQsIHNuYXBzSW5mby5sZWZ0QXR0cik7XG4gICAgICByZW1vdmUkMShlbGVtZW50LCBzbmFwc0luZm8udG9wQXR0cik7XG4gICAgfTtcblxuICAgIHZhciBnZXRDb29yZHMgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzbmFwSW5mbywgY29vcmQsIGRlbHRhKSB7XG4gICAgICByZXR1cm4gZ2V0JGYoY29tcG9uZW50LCBzbmFwSW5mbykuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjb29yZDtcbiAgICAgIH0sIGZ1bmN0aW9uIChmaXhlZCkge1xuICAgICAgICByZXR1cm4gZml4ZWQkMShmaXhlZC5sZWZ0ICsgZGVsdGEubGVmdCwgZml4ZWQudG9wICsgZGVsdGEudG9wKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1vdmVPclNuYXAgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBzbmFwSW5mbywgY29vcmQsIGRlbHRhLCBzY3JvbGwsIG9yaWdpbikge1xuICAgICAgdmFyIG5ld0Nvb3JkID0gZ2V0Q29vcmRzKGNvbXBvbmVudCwgc25hcEluZm8sIGNvb3JkLCBkZWx0YSk7XG4gICAgICB2YXIgc25hcCA9IHNuYXBJbmZvLm11c3RTbmFwID8gZmluZENsb3Nlc3RTbmFwKGNvbXBvbmVudCwgc25hcEluZm8sIG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbikgOiBmaW5kU25hcChjb21wb25lbnQsIHNuYXBJbmZvLCBuZXdDb29yZCwgc2Nyb2xsLCBvcmlnaW4pO1xuICAgICAgdmFyIGZpeGVkQ29vcmQgPSBhc0ZpeGVkKG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbik7XG4gICAgICBzZXQkOChjb21wb25lbnQsIHNuYXBJbmZvLCBmaXhlZENvb3JkKTtcbiAgICAgIHJldHVybiBzbmFwLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvb3JkOiBmaXhlZCQxKGZpeGVkQ29vcmQubGVmdCwgZml4ZWRDb29yZC50b3ApLFxuICAgICAgICAgIGV4dHJhOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgfTtcbiAgICAgIH0sIGZ1bmN0aW9uIChzcGFubmVkKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY29vcmQ6IHNwYW5uZWQub3V0cHV0LFxuICAgICAgICAgIGV4dHJhOiBzcGFubmVkLmV4dHJhXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzdG9wRHJhZyA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHNuYXBJbmZvKSB7XG4gICAgICBjbGVhcihjb21wb25lbnQsIHNuYXBJbmZvKTtcbiAgICB9O1xuICAgIHZhciBmaW5kTWF0Y2hpbmdTbmFwID0gZnVuY3Rpb24gKHNuYXBzLCBuZXdDb29yZCwgc2Nyb2xsLCBvcmlnaW4pIHtcbiAgICAgIHJldHVybiBmaW5kTWFwKHNuYXBzLCBmdW5jdGlvbiAoc25hcCkge1xuICAgICAgICB2YXIgc2Vuc29yID0gc25hcC5zZW5zb3I7XG4gICAgICAgIHZhciBpblJhbmdlID0gd2l0aGluUmFuZ2UobmV3Q29vcmQsIHNlbnNvciwgc25hcC5yYW5nZS5sZWZ0LCBzbmFwLnJhbmdlLnRvcCwgc2Nyb2xsLCBvcmlnaW4pO1xuICAgICAgICByZXR1cm4gaW5SYW5nZSA/IE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgIG91dHB1dDogYWJzb3JiKHNuYXAub3V0cHV0LCBuZXdDb29yZCwgc2Nyb2xsLCBvcmlnaW4pLFxuICAgICAgICAgIGV4dHJhOiBzbmFwLmV4dHJhXG4gICAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmluZENsb3Nlc3RTbmFwID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc25hcEluZm8sIG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbikge1xuICAgICAgdmFyIHNuYXBzID0gc25hcEluZm8uZ2V0U25hcFBvaW50cyhjb21wb25lbnQpO1xuICAgICAgdmFyIG1hdGNoU25hcCA9IGZpbmRNYXRjaGluZ1NuYXAoc25hcHMsIG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbik7XG4gICAgICByZXR1cm4gbWF0Y2hTbmFwLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYmVzdFNuYXAgPSBmb2xkbChzbmFwcywgZnVuY3Rpb24gKGFjYywgc25hcCkge1xuICAgICAgICAgIHZhciBzZW5zb3IgPSBzbmFwLnNlbnNvcjtcbiAgICAgICAgICB2YXIgZGVsdGFzID0gZ2V0RGVsdGFzKG5ld0Nvb3JkLCBzZW5zb3IsIHNuYXAucmFuZ2UubGVmdCwgc25hcC5yYW5nZS50b3AsIHNjcm9sbCwgb3JpZ2luKTtcbiAgICAgICAgICByZXR1cm4gYWNjLmRlbHRhcy5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGRlbHRhczogT3B0aW9uYWwuc29tZShkZWx0YXMpLFxuICAgICAgICAgICAgICBzbmFwOiBPcHRpb25hbC5zb21lKHNuYXApXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChiZXN0RGVsdGFzKSB7XG4gICAgICAgICAgICB2YXIgY3VyckF2ZyA9IChkZWx0YXMubGVmdCArIGRlbHRhcy50b3ApIC8gMjtcbiAgICAgICAgICAgIHZhciBiZXN0QXZnID0gKGJlc3REZWx0YXMubGVmdCArIGJlc3REZWx0YXMudG9wKSAvIDI7XG4gICAgICAgICAgICBpZiAoY3VyckF2ZyA8PSBiZXN0QXZnKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZGVsdGFzOiBPcHRpb25hbC5zb21lKGRlbHRhcyksXG4gICAgICAgICAgICAgICAgc25hcDogT3B0aW9uYWwuc29tZShzbmFwKVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwge1xuICAgICAgICAgIGRlbHRhczogT3B0aW9uYWwubm9uZSgpLFxuICAgICAgICAgIHNuYXA6IE9wdGlvbmFsLm5vbmUoKVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGJlc3RTbmFwLnNuYXAubWFwKGZ1bmN0aW9uIChzbmFwKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG91dHB1dDogYWJzb3JiKHNuYXAub3V0cHV0LCBuZXdDb29yZCwgc2Nyb2xsLCBvcmlnaW4pLFxuICAgICAgICAgICAgZXh0cmE6IHNuYXAuZXh0cmFcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZpbmRTbmFwID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgc25hcEluZm8sIG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbikge1xuICAgICAgdmFyIHNuYXBzID0gc25hcEluZm8uZ2V0U25hcFBvaW50cyhjb21wb25lbnQpO1xuICAgICAgcmV0dXJuIGZpbmRNYXRjaGluZ1NuYXAoc25hcHMsIG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbik7XG4gICAgfTtcbiAgICB2YXIgc25hcFRvID0gZnVuY3Rpb24gKHNuYXAsIHNjcm9sbCwgb3JpZ2luKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb29yZDogYWJzb3JiKHNuYXAub3V0cHV0LCBzbmFwLm91dHB1dCwgc2Nyb2xsLCBvcmlnaW4pLFxuICAgICAgICBleHRyYTogc25hcC5leHRyYVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNuYXBUbyQxID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgZHJhZ0NvbmZpZywgX3N0YXRlLCBzbmFwKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gZHJhZ0NvbmZpZy5nZXRUYXJnZXQoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgaWYgKGRyYWdDb25maWcucmVwb3NpdGlvblRhcmdldCkge1xuICAgICAgICB2YXIgZG9jID0gb3duZXIoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICB2YXIgc2Nyb2xsXzEgPSBnZXQkOShkb2MpO1xuICAgICAgICB2YXIgb3JpZ2luXzEgPSBnZXRPcmlnaW4odGFyZ2V0KTtcbiAgICAgICAgdmFyIHNuYXBQaW4gPSBzbmFwVG8oc25hcCwgc2Nyb2xsXzEsIG9yaWdpbl8xKTtcbiAgICAgICAgdmFyIHN0eWxlcyA9IHRvU3R5bGVzKHNuYXBQaW4uY29vcmQsIHNjcm9sbF8xLCBvcmlnaW5fMSk7XG4gICAgICAgIHNldE9wdGlvbnModGFyZ2V0LCBzdHlsZXMpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgRHJhZ2dpbmdBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIHNuYXBUbzogc25hcFRvJDFcbiAgICB9KTtcblxuICAgIHZhciBpbml0aWFsQXR0cmlidXRlID0gJ2RhdGEtaW5pdGlhbC16LWluZGV4JztcbiAgICB2YXIgcmVzZXRaSW5kZXggPSBmdW5jdGlvbiAoYmxvY2tlcikge1xuICAgICAgcGFyZW50KGJsb2NrZXIuZWxlbWVudCkuZmlsdGVyKGlzRWxlbWVudCkuZWFjaChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICBnZXRPcHQocm9vdCwgaW5pdGlhbEF0dHJpYnV0ZSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHJlbW92ZSQ2KHJvb3QsICd6LWluZGV4Jyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh6SW5kZXgpIHtcbiAgICAgICAgICByZXR1cm4gc2V0JDIocm9vdCwgJ3otaW5kZXgnLCB6SW5kZXgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVtb3ZlJDEocm9vdCwgaW5pdGlhbEF0dHJpYnV0ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjaGFuZ2VaSW5kZXggPSBmdW5jdGlvbiAoYmxvY2tlcikge1xuICAgICAgcGFyZW50KGJsb2NrZXIuZWxlbWVudCkuZmlsdGVyKGlzRWxlbWVudCkuZWFjaChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICBnZXRSYXcocm9vdCwgJ3otaW5kZXgnKS5lYWNoKGZ1bmN0aW9uICh6aW5kZXgpIHtcbiAgICAgICAgICBzZXQkMShyb290LCBpbml0aWFsQXR0cmlidXRlLCB6aW5kZXgpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0JDIocm9vdCwgJ3otaW5kZXgnLCBnZXQkNShibG9ja2VyLmVsZW1lbnQsICd6LWluZGV4JykpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5zdGlnYXRlID0gZnVuY3Rpb24gKGFueUNvbXBvbmVudCwgYmxvY2tlcikge1xuICAgICAgYW55Q29tcG9uZW50LmdldFN5c3RlbSgpLmFkZFRvR3VpKGJsb2NrZXIpO1xuICAgICAgY2hhbmdlWkluZGV4KGJsb2NrZXIpO1xuICAgIH07XG4gICAgdmFyIGRpc2NhcmQgPSBmdW5jdGlvbiAoYmxvY2tlcikge1xuICAgICAgcmVzZXRaSW5kZXgoYmxvY2tlcik7XG4gICAgICBibG9ja2VyLmdldFN5c3RlbSgpLnJlbW92ZUZyb21HdWkoYmxvY2tlcik7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlQ29tcG9uZW50ID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgYmxvY2tlckNsYXNzLCBibG9ja2VyRXZlbnRzKSB7XG4gICAgICByZXR1cm4gY29tcG9uZW50LmdldFN5c3RlbSgpLmJ1aWxkKENvbnRhaW5lci5za2V0Y2goe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICBzdHlsZXM6IHtcbiAgICAgICAgICAgICdsZWZ0JzogJzBweCcsXG4gICAgICAgICAgICAndG9wJzogJzBweCcsXG4gICAgICAgICAgICAnd2lkdGgnOiAnMTAwJScsXG4gICAgICAgICAgICAnaGVpZ2h0JzogJzEwMCUnLFxuICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2ZpeGVkJyxcbiAgICAgICAgICAgICd6LWluZGV4JzogJzEwMDAwMDAwMDAwMDAwMDAnXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbGFzc2VzOiBbYmxvY2tlckNsYXNzXVxuICAgICAgICB9LFxuICAgICAgICBldmVudHM6IGJsb2NrZXJFdmVudHNcbiAgICAgIH0pKTtcbiAgICB9O1xuXG4gICAgdmFyIFNuYXBTY2hlbWEgPSBvcHRpb25PYmpPZignc25hcHMnLCBbXG4gICAgICBzdHJpY3QkMSgnZ2V0U25hcFBvaW50cycpLFxuICAgICAgb25IYW5kbGVyKCdvblNlbnNvcicpLFxuICAgICAgc3RyaWN0JDEoJ2xlZnRBdHRyJyksXG4gICAgICBzdHJpY3QkMSgndG9wQXR0cicpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2xhenlWaWV3cG9ydCcsIHdpbiksXG4gICAgICBkZWZhdWx0ZWQkMSgnbXVzdFNuYXAnLCBmYWxzZSlcbiAgICBdKTtcblxuICAgIHZhciBzY2hlbWEkdCA9IFtcbiAgICAgIGRlZmF1bHRlZCQxKCd1c2VGaXhlZCcsIG5ldmVyKSxcbiAgICAgIHN0cmljdCQxKCdibG9ja2VyQ2xhc3MnKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdnZXRUYXJnZXQnLCBpZGVudGl0eSksXG4gICAgICBkZWZhdWx0ZWQkMSgnb25EcmFnJywgbm9vcCksXG4gICAgICBkZWZhdWx0ZWQkMSgncmVwb3NpdGlvblRhcmdldCcsIHRydWUpLFxuICAgICAgZGVmYXVsdGVkJDEoJ29uRHJvcCcsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ2dldEJvdW5kcycsIHdpbiksXG4gICAgICBTbmFwU2NoZW1hXG4gICAgXTtcblxuICAgIHZhciBnZXRDdXJyZW50Q29vcmQgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICByZXR1cm4gbGlmdDMoZ2V0UmF3KHRhcmdldCwgJ2xlZnQnKSwgZ2V0UmF3KHRhcmdldCwgJ3RvcCcpLCBnZXRSYXcodGFyZ2V0LCAncG9zaXRpb24nKSwgZnVuY3Rpb24gKGxlZnQsIHRvcCwgcG9zaXRpb24pIHtcbiAgICAgICAgdmFyIG51ID0gcG9zaXRpb24gPT09ICdmaXhlZCcgPyBmaXhlZCQxIDogb2Zmc2V0O1xuICAgICAgICByZXR1cm4gbnUocGFyc2VJbnQobGVmdCwgMTApLCBwYXJzZUludCh0b3AsIDEwKSk7XG4gICAgICB9KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxvY2F0aW9uID0gYWJzb2x1dGUodGFyZ2V0KTtcbiAgICAgICAgcmV0dXJuIGFic29sdXRlJDMobG9jYXRpb24ubGVmdCwgbG9jYXRpb24udG9wKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNsYW1wQ29vcmRzID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29vcmRzLCBzY3JvbGwsIG9yaWdpbiwgc3RhcnREYXRhKSB7XG4gICAgICB2YXIgYm91bmRzID0gc3RhcnREYXRhLmJvdW5kcztcbiAgICAgIHZhciBhYnNvbHV0ZUNvb3JkID0gYXNBYnNvbHV0ZShjb29yZHMsIHNjcm9sbCwgb3JpZ2luKTtcbiAgICAgIHZhciBuZXdYID0gY2xhbXAoYWJzb2x1dGVDb29yZC5sZWZ0LCBib3VuZHMueCwgYm91bmRzLnggKyBib3VuZHMud2lkdGggLSBzdGFydERhdGEud2lkdGgpO1xuICAgICAgdmFyIG5ld1kgPSBjbGFtcChhYnNvbHV0ZUNvb3JkLnRvcCwgYm91bmRzLnksIGJvdW5kcy55ICsgYm91bmRzLmhlaWdodCAtIHN0YXJ0RGF0YS5oZWlnaHQpO1xuICAgICAgdmFyIG5ld0Nvb3JkcyA9IGFic29sdXRlJDMobmV3WCwgbmV3WSk7XG4gICAgICByZXR1cm4gY29vcmRzLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2Zmc2V0JDEgPSBhc09mZnNldChuZXdDb29yZHMsIHNjcm9sbCwgb3JpZ2luKTtcbiAgICAgICAgcmV0dXJuIG9mZnNldChvZmZzZXQkMS5sZWZ0LCBvZmZzZXQkMS50b3ApO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3Q29vcmRzO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZml4ZWQgPSBhc0ZpeGVkKG5ld0Nvb3Jkcywgc2Nyb2xsLCBvcmlnaW4pO1xuICAgICAgICByZXR1cm4gZml4ZWQkMShmaXhlZC5sZWZ0LCBmaXhlZC50b3ApO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY2FsY05ld0Nvb3JkID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgb3B0U25hcHMsIGN1cnJlbnRDb29yZCwgc2Nyb2xsLCBvcmlnaW4sIGRlbHRhLCBzdGFydERhdGEpIHtcbiAgICAgIHZhciBuZXdDb29yZCA9IG9wdFNuYXBzLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJhbnNsYXRlZCA9IHRyYW5zbGF0ZSQyKGN1cnJlbnRDb29yZCwgZGVsdGEubGVmdCwgZGVsdGEudG9wKTtcbiAgICAgICAgdmFyIGZpeGVkQ29vcmQgPSBhc0ZpeGVkKHRyYW5zbGF0ZWQsIHNjcm9sbCwgb3JpZ2luKTtcbiAgICAgICAgcmV0dXJuIGZpeGVkJDEoZml4ZWRDb29yZC5sZWZ0LCBmaXhlZENvb3JkLnRvcCk7XG4gICAgICB9LCBmdW5jdGlvbiAoc25hcEluZm8pIHtcbiAgICAgICAgdmFyIHNuYXBwaW5nID0gbW92ZU9yU25hcChjb21wb25lbnQsIHNuYXBJbmZvLCBjdXJyZW50Q29vcmQsIGRlbHRhLCBzY3JvbGwsIG9yaWdpbik7XG4gICAgICAgIHNuYXBwaW5nLmV4dHJhLmVhY2goZnVuY3Rpb24gKGV4dHJhKSB7XG4gICAgICAgICAgc25hcEluZm8ub25TZW5zb3IoY29tcG9uZW50LCBleHRyYSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc25hcHBpbmcuY29vcmQ7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjbGFtcENvb3Jkcyhjb21wb25lbnQsIG5ld0Nvb3JkLCBzY3JvbGwsIG9yaWdpbiwgc3RhcnREYXRhKTtcbiAgICB9O1xuICAgIHZhciBkcmFnQnkgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBkcmFnQ29uZmlnLCBzdGFydERhdGEsIGRlbHRhKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gZHJhZ0NvbmZpZy5nZXRUYXJnZXQoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgaWYgKGRyYWdDb25maWcucmVwb3NpdGlvblRhcmdldCkge1xuICAgICAgICB2YXIgZG9jID0gb3duZXIoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICB2YXIgc2Nyb2xsXzEgPSBnZXQkOShkb2MpO1xuICAgICAgICB2YXIgb3JpZ2luXzEgPSBnZXRPcmlnaW4odGFyZ2V0KTtcbiAgICAgICAgdmFyIGN1cnJlbnRDb29yZCA9IGdldEN1cnJlbnRDb29yZCh0YXJnZXQpO1xuICAgICAgICB2YXIgbmV3Q29vcmQgPSBjYWxjTmV3Q29vcmQoY29tcG9uZW50LCBkcmFnQ29uZmlnLnNuYXBzLCBjdXJyZW50Q29vcmQsIHNjcm9sbF8xLCBvcmlnaW5fMSwgZGVsdGEsIHN0YXJ0RGF0YSk7XG4gICAgICAgIHZhciBzdHlsZXMgPSB0b1N0eWxlcyhuZXdDb29yZCwgc2Nyb2xsXzEsIG9yaWdpbl8xKTtcbiAgICAgICAgc2V0T3B0aW9ucyh0YXJnZXQsIHN0eWxlcyk7XG4gICAgICB9XG4gICAgICBkcmFnQ29uZmlnLm9uRHJhZyhjb21wb25lbnQsIHRhcmdldCwgZGVsdGEpO1xuICAgIH07XG5cbiAgICB2YXIgY2FsY1N0YXJ0RGF0YSA9IGZ1bmN0aW9uIChkcmFnQ29uZmlnLCBjb21wKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBib3VuZHM6IGRyYWdDb25maWcuZ2V0Qm91bmRzKCksXG4gICAgICAgIGhlaWdodDogZ2V0T3V0ZXIkMShjb21wLmVsZW1lbnQpLFxuICAgICAgICB3aWR0aDogZ2V0T3V0ZXIkMihjb21wLmVsZW1lbnQpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1vdmUkMSA9IGZ1bmN0aW9uIChjb21wb25lbnQsIGRyYWdDb25maWcsIGRyYWdTdGF0ZSwgZHJhZ01vZGUsIGV2ZW50KSB7XG4gICAgICB2YXIgZGVsdGEgPSBkcmFnU3RhdGUudXBkYXRlKGRyYWdNb2RlLCBldmVudCk7XG4gICAgICB2YXIgZHJhZ1N0YXJ0RGF0YSA9IGRyYWdTdGF0ZS5nZXRTdGFydERhdGEoKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNhbGNTdGFydERhdGEoZHJhZ0NvbmZpZywgY29tcG9uZW50KTtcbiAgICAgIH0pO1xuICAgICAgZGVsdGEuZWFjaChmdW5jdGlvbiAoZGx0KSB7XG4gICAgICAgIGRyYWdCeShjb21wb25lbnQsIGRyYWdDb25maWcsIGRyYWdTdGFydERhdGEsIGRsdCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzdG9wID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgYmxvY2tlciwgZHJhZ0NvbmZpZywgZHJhZ1N0YXRlKSB7XG4gICAgICBibG9ja2VyLmVhY2goZGlzY2FyZCk7XG4gICAgICBkcmFnQ29uZmlnLnNuYXBzLmVhY2goZnVuY3Rpb24gKHNuYXBJbmZvKSB7XG4gICAgICAgIHN0b3BEcmFnKGNvbXBvbmVudCwgc25hcEluZm8pO1xuICAgICAgfSk7XG4gICAgICB2YXIgdGFyZ2V0ID0gZHJhZ0NvbmZpZy5nZXRUYXJnZXQoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgZHJhZ1N0YXRlLnJlc2V0KCk7XG4gICAgICBkcmFnQ29uZmlnLm9uRHJvcChjb21wb25lbnQsIHRhcmdldCk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlcnMgPSBmdW5jdGlvbiAoZXZlbnRzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGRyYWdDb25maWcsIGRyYWdTdGF0ZSkge1xuICAgICAgICB2YXIgdXBkYXRlU3RhcnRTdGF0ZSA9IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgZHJhZ1N0YXRlLnNldFN0YXJ0RGF0YShjYWxjU3RhcnREYXRhKGRyYWdDb25maWcsIGNvbXApKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRlcml2ZShfX3NwcmVhZEFycmF5cyhbcnVuKHdpbmRvd1Njcm9sbCgpLCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgZHJhZ1N0YXRlLmdldFN0YXJ0RGF0YSgpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlU3RhcnRTdGF0ZShjb21wKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pXSwgZXZlbnRzKGRyYWdDb25maWcsIGRyYWdTdGF0ZSwgdXBkYXRlU3RhcnRTdGF0ZSkpKTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBpbml0JGMgPSBmdW5jdGlvbiAoZHJhZ0FwaSkge1xuICAgICAgcmV0dXJuIGRlcml2ZShbXG4gICAgICAgIHJ1bihtb3VzZWRvd24oKSwgZHJhZ0FwaS5mb3JjZURyb3ApLFxuICAgICAgICBydW4obW91c2V1cCgpLCBkcmFnQXBpLmRyb3ApLFxuICAgICAgICBydW4obW91c2Vtb3ZlKCksIGZ1bmN0aW9uIChjb21wLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIGRyYWdBcGkubW92ZShzaW11bGF0ZWRFdmVudC5ldmVudCk7XG4gICAgICAgIH0pLFxuICAgICAgICBydW4obW91c2VvdXQoKSwgZHJhZ0FwaS5kZWxheURyb3ApXG4gICAgICBdKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldERhdGEkMSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oU3VnYXJQb3NpdGlvbihldmVudC54LCBldmVudC55KSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGVsdGEkMSA9IGZ1bmN0aW9uIChvbGQsIG51KSB7XG4gICAgICByZXR1cm4gU3VnYXJQb3NpdGlvbihudS5sZWZ0IC0gb2xkLmxlZnQsIG51LnRvcCAtIG9sZC50b3ApO1xuICAgIH07XG5cbiAgICB2YXIgTW91c2VEYXRhID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGdldERhdGE6IGdldERhdGEkMSxcbiAgICAgICAgZ2V0RGVsdGE6IGdldERlbHRhJDFcbiAgICB9KTtcblxuICAgIHZhciBldmVudHMkZyA9IGZ1bmN0aW9uIChkcmFnQ29uZmlnLCBkcmFnU3RhdGUsIHVwZGF0ZVN0YXJ0U3RhdGUpIHtcbiAgICAgIHJldHVybiBbcnVuKG1vdXNlZG93bigpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHZhciByYXcgPSBzaW11bGF0ZWRFdmVudC5ldmVudC5yYXc7XG4gICAgICAgICAgaWYgKHJhdy5idXR0b24gIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICAgIHZhciBzdG9wJDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RvcChjb21wb25lbnQsIE9wdGlvbmFsLnNvbWUoYmxvY2tlciksIGRyYWdDb25maWcsIGRyYWdTdGF0ZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICB2YXIgZGVsYXlEcm9wID0gRGVsYXllZEZ1bmN0aW9uKHN0b3AkMSwgMjAwKTtcbiAgICAgICAgICB2YXIgZHJhZ0FwaSA9IHtcbiAgICAgICAgICAgIGRyb3A6IHN0b3AkMSxcbiAgICAgICAgICAgIGRlbGF5RHJvcDogZGVsYXlEcm9wLnNjaGVkdWxlLFxuICAgICAgICAgICAgZm9yY2VEcm9wOiBzdG9wJDEsXG4gICAgICAgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgZGVsYXlEcm9wLmNhbmNlbCgpO1xuICAgICAgICAgICAgICBtb3ZlJDEoY29tcG9uZW50LCBkcmFnQ29uZmlnLCBkcmFnU3RhdGUsIE1vdXNlRGF0YSwgZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIGJsb2NrZXIgPSBjcmVhdGVDb21wb25lbnQoY29tcG9uZW50LCBkcmFnQ29uZmlnLmJsb2NrZXJDbGFzcywgaW5pdCRjKGRyYWdBcGkpKTtcbiAgICAgICAgICB2YXIgc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1cGRhdGVTdGFydFN0YXRlKGNvbXBvbmVudCk7XG4gICAgICAgICAgICBpbnN0aWdhdGUoY29tcG9uZW50LCBibG9ja2VyKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHN0YXJ0KCk7XG4gICAgICAgIH0pXTtcbiAgICB9O1xuICAgIHZhciBzY2hlbWEkdSA9IF9fc3ByZWFkQXJyYXlzKHNjaGVtYSR0LCBbb3V0cHV0KCdkcmFnZ2VyJywgeyBoYW5kbGVyczogaGFuZGxlcnMoZXZlbnRzJGcpIH0pXSk7XG5cbiAgICB2YXIgaW5pdCRkID0gZnVuY3Rpb24gKGRyYWdBcGkpIHtcbiAgICAgIHJldHVybiBkZXJpdmUoW1xuICAgICAgICBydW4odG91Y2hzdGFydCgpLCBkcmFnQXBpLmZvcmNlRHJvcCksXG4gICAgICAgIHJ1bih0b3VjaGVuZCgpLCBkcmFnQXBpLmRyb3ApLFxuICAgICAgICBydW4odG91Y2hjYW5jZWwoKSwgZHJhZ0FwaS5kcm9wKSxcbiAgICAgICAgcnVuKHRvdWNobW92ZSgpLCBmdW5jdGlvbiAoY29tcCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICBkcmFnQXBpLm1vdmUoc2ltdWxhdGVkRXZlbnQuZXZlbnQpO1xuICAgICAgICB9KVxuICAgICAgXSk7XG4gICAgfTtcblxuICAgIHZhciBnZXREYXRhRnJvbSA9IGZ1bmN0aW9uICh0b3VjaGVzKSB7XG4gICAgICB2YXIgdG91Y2ggPSB0b3VjaGVzWzBdO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoU3VnYXJQb3NpdGlvbih0b3VjaC5jbGllbnRYLCB0b3VjaC5jbGllbnRZKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGF0YSQyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICB2YXIgcmF3ID0gZXZlbnQucmF3O1xuICAgICAgdmFyIHRvdWNoZXMgPSByYXcudG91Y2hlcztcbiAgICAgIHJldHVybiB0b3VjaGVzLmxlbmd0aCA9PT0gMSA/IGdldERhdGFGcm9tKHRvdWNoZXMpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGdldERlbHRhJDIgPSBmdW5jdGlvbiAob2xkLCBudSkge1xuICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24obnUubGVmdCAtIG9sZC5sZWZ0LCBudS50b3AgLSBvbGQudG9wKTtcbiAgICB9O1xuXG4gICAgdmFyIFRvdWNoRGF0YSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBnZXREYXRhOiBnZXREYXRhJDIsXG4gICAgICAgIGdldERlbHRhOiBnZXREZWx0YSQyXG4gICAgfSk7XG5cbiAgICB2YXIgZXZlbnRzJGggPSBmdW5jdGlvbiAoZHJhZ0NvbmZpZywgZHJhZ1N0YXRlLCB1cGRhdGVTdGFydFN0YXRlKSB7XG4gICAgICB2YXIgYmxvY2tlckNlbGwgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBydW4odG91Y2hzdGFydCgpLCBmdW5jdGlvbiAoY29tcG9uZW50LCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgIHNpbXVsYXRlZEV2ZW50LnN0b3AoKTtcbiAgICAgICAgICB2YXIgc3RvcCQxID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RvcChjb21wb25lbnQsIGJsb2NrZXJDZWxsLmdldCgpLCBkcmFnQ29uZmlnLCBkcmFnU3RhdGUpO1xuICAgICAgICAgICAgYmxvY2tlckNlbGwuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICB2YXIgZHJhZ0FwaSA9IHtcbiAgICAgICAgICAgIGRyb3A6IHN0b3AkMSxcbiAgICAgICAgICAgIGRlbGF5RHJvcDogbm9vcCxcbiAgICAgICAgICAgIGZvcmNlRHJvcDogc3RvcCQxLFxuICAgICAgICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgIG1vdmUkMShjb21wb25lbnQsIGRyYWdDb25maWcsIGRyYWdTdGF0ZSwgVG91Y2hEYXRhLCBldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICB2YXIgYmxvY2tlciA9IGNyZWF0ZUNvbXBvbmVudChjb21wb25lbnQsIGRyYWdDb25maWcuYmxvY2tlckNsYXNzLCBpbml0JGQoZHJhZ0FwaSkpO1xuICAgICAgICAgIGJsb2NrZXJDZWxsLnNldChPcHRpb25hbC5zb21lKGJsb2NrZXIpKTtcbiAgICAgICAgICB2YXIgc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1cGRhdGVTdGFydFN0YXRlKGNvbXBvbmVudCk7XG4gICAgICAgICAgICBpbnN0aWdhdGUoY29tcG9uZW50LCBibG9ja2VyKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHN0YXJ0KCk7XG4gICAgICAgIH0pLFxuICAgICAgICBydW4odG91Y2htb3ZlKCksIGZ1bmN0aW9uIChjb21wb25lbnQsIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgc2ltdWxhdGVkRXZlbnQuc3RvcCgpO1xuICAgICAgICAgIG1vdmUkMShjb21wb25lbnQsIGRyYWdDb25maWcsIGRyYWdTdGF0ZSwgVG91Y2hEYXRhLCBzaW11bGF0ZWRFdmVudC5ldmVudCk7XG4gICAgICAgIH0pLFxuICAgICAgICBydW4odG91Y2hlbmQoKSwgZnVuY3Rpb24gKGNvbXBvbmVudCwgc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICBzaW11bGF0ZWRFdmVudC5zdG9wKCk7XG4gICAgICAgICAgc3RvcChjb21wb25lbnQsIGJsb2NrZXJDZWxsLmdldCgpLCBkcmFnQ29uZmlnLCBkcmFnU3RhdGUpO1xuICAgICAgICAgIGJsb2NrZXJDZWxsLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICB9KSxcbiAgICAgICAgcnVuKHRvdWNoY2FuY2VsKCksIGZ1bmN0aW9uIChjb21wb25lbnQpIHtcbiAgICAgICAgICBzdG9wKGNvbXBvbmVudCwgYmxvY2tlckNlbGwuZ2V0KCksIGRyYWdDb25maWcsIGRyYWdTdGF0ZSk7XG4gICAgICAgICAgYmxvY2tlckNlbGwuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgIH0pXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIHNjaGVtYSR2ID0gX19zcHJlYWRBcnJheXMoc2NoZW1hJHQsIFtvdXRwdXQoJ2RyYWdnZXInLCB7IGhhbmRsZXJzOiBoYW5kbGVycyhldmVudHMkaCkgfSldKTtcblxuICAgIHZhciBldmVudHMkaSA9IGZ1bmN0aW9uIChkcmFnQ29uZmlnLCBkcmFnU3RhdGUsIHVwZGF0ZVN0YXJ0U3RhdGUpIHtcbiAgICAgIHJldHVybiBfX3NwcmVhZEFycmF5cyhldmVudHMkZyhkcmFnQ29uZmlnLCBkcmFnU3RhdGUsIHVwZGF0ZVN0YXJ0U3RhdGUpLCBldmVudHMkaChkcmFnQ29uZmlnLCBkcmFnU3RhdGUsIHVwZGF0ZVN0YXJ0U3RhdGUpKTtcbiAgICB9O1xuICAgIHZhciBzY2hlbWEkdyA9IF9fc3ByZWFkQXJyYXlzKHNjaGVtYSR0LCBbb3V0cHV0KCdkcmFnZ2VyJywgeyBoYW5kbGVyczogaGFuZGxlcnMoZXZlbnRzJGkpIH0pXSk7XG5cbiAgICB2YXIgbW91c2UgPSBzY2hlbWEkdTtcbiAgICB2YXIgdG91Y2ggPSBzY2hlbWEkdjtcbiAgICB2YXIgbW91c2VPclRvdWNoID0gc2NoZW1hJHc7XG5cbiAgICB2YXIgRHJhZ2dpbmdCcmFuY2hlcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBtb3VzZTogbW91c2UsXG4gICAgICAgIHRvdWNoOiB0b3VjaCxcbiAgICAgICAgbW91c2VPclRvdWNoOiBtb3VzZU9yVG91Y2hcbiAgICB9KTtcblxuICAgIHZhciBpbml0JGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcHJldmlvdXMgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICB2YXIgc3RhcnREYXRhID0gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIHJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBwcmV2aW91cyA9IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgc3RhcnREYXRhID0gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBjYWxjdWxhdGVEZWx0YSA9IGZ1bmN0aW9uIChtb2RlLCBudSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gcHJldmlvdXMubWFwKGZ1bmN0aW9uIChvbGQpIHtcbiAgICAgICAgICByZXR1cm4gbW9kZS5nZXREZWx0YShvbGQsIG51KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHByZXZpb3VzID0gT3B0aW9uYWwuc29tZShudSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9O1xuICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uIChtb2RlLCBkcmFnRXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIG1vZGUuZ2V0RGF0YShkcmFnRXZlbnQpLmJpbmQoZnVuY3Rpb24gKG51RGF0YSkge1xuICAgICAgICAgIHJldHVybiBjYWxjdWxhdGVEZWx0YShtb2RlLCBudURhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0U3RhcnREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgc3RhcnREYXRhID0gT3B0aW9uYWwuc29tZShkYXRhKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0U3RhcnREYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3RhcnREYXRhO1xuICAgICAgfTtcbiAgICAgIHZhciByZWFkU3RhdGUgPSBjb25zdGFudCh7fSk7XG4gICAgICByZXR1cm4gbnUkNSh7XG4gICAgICAgIHJlYWRTdGF0ZTogcmVhZFN0YXRlLFxuICAgICAgICByZXNldDogcmVzZXQsXG4gICAgICAgIHVwZGF0ZTogdXBkYXRlLFxuICAgICAgICBnZXRTdGFydERhdGE6IGdldFN0YXJ0RGF0YSxcbiAgICAgICAgc2V0U3RhcnREYXRhOiBzZXRTdGFydERhdGFcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgRHJhZ1N0YXRlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGluaXQ6IGluaXQkZVxuICAgIH0pO1xuXG4gICAgdmFyIERyYWdnaW5nID0gY3JlYXRlTW9kZXMkMSh7XG4gICAgICBicmFuY2hLZXk6ICdtb2RlJyxcbiAgICAgIGJyYW5jaGVzOiBEcmFnZ2luZ0JyYW5jaGVzLFxuICAgICAgbmFtZTogJ2RyYWdnaW5nJyxcbiAgICAgIGFjdGl2ZToge1xuICAgICAgICBldmVudHM6IGZ1bmN0aW9uIChkcmFnQ29uZmlnLCBkcmFnU3RhdGUpIHtcbiAgICAgICAgICB2YXIgZHJhZ2dlciA9IGRyYWdDb25maWcuZHJhZ2dlcjtcbiAgICAgICAgICByZXR1cm4gZHJhZ2dlci5oYW5kbGVycyhkcmFnQ29uZmlnLCBkcmFnU3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXh0cmE6IHtcbiAgICAgICAgc25hcDogZnVuY3Rpb24gKHNDb25maWcpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2Vuc29yOiBzQ29uZmlnLnNlbnNvcixcbiAgICAgICAgICAgIHJhbmdlOiBzQ29uZmlnLnJhbmdlLFxuICAgICAgICAgICAgb3V0cHV0OiBzQ29uZmlnLm91dHB1dCxcbiAgICAgICAgICAgIGV4dHJhOiBPcHRpb25hbC5mcm9tKHNDb25maWcuZXh0cmEpXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHN0YXRlOiBEcmFnU3RhdGUsXG4gICAgICBhcGlzOiBEcmFnZ2luZ0FwaXNcbiAgICB9KTtcblxuICAgIHZhciBzbmFwV2lkdGggPSA0MDtcbiAgICB2YXIgc25hcE9mZnNldCA9IHNuYXBXaWR0aCAvIDI7XG4gICAgdmFyIGNhbGNTbmFwID0gZnVuY3Rpb24gKHNlbGVjdG9yT3B0LCB0ZCwgeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgcmV0dXJuIHNlbGVjdG9yT3B0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gRHJhZ2dpbmcuc25hcCh7XG4gICAgICAgICAgc2Vuc29yOiBhYnNvbHV0ZSQzKHggLSBzbmFwT2Zmc2V0LCB5IC0gc25hcE9mZnNldCksXG4gICAgICAgICAgcmFuZ2U6IFN1Z2FyUG9zaXRpb24od2lkdGgsIGhlaWdodCksXG4gICAgICAgICAgb3V0cHV0OiBhYnNvbHV0ZSQzKE9wdGlvbmFsLnNvbWUoeCksIE9wdGlvbmFsLnNvbWUoeSkpLFxuICAgICAgICAgIGV4dHJhOiB7IHRkOiB0ZCB9XG4gICAgICAgIH0pO1xuICAgICAgfSwgZnVuY3Rpb24gKHNlbGVjdG9ySGFuZGxlKSB7XG4gICAgICAgIHZhciBzZW5zb3JMZWZ0ID0geCAtIHNuYXBPZmZzZXQ7XG4gICAgICAgIHZhciBzZW5zb3JUb3AgPSB5IC0gc25hcE9mZnNldDtcbiAgICAgICAgdmFyIHNlbnNvcldpZHRoID0gc25hcFdpZHRoO1xuICAgICAgICB2YXIgc2Vuc29ySGVpZ2h0ID0gc25hcFdpZHRoO1xuICAgICAgICB2YXIgcmVjdCA9IHNlbGVjdG9ySGFuZGxlLmVsZW1lbnQuZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZXR1cm4gRHJhZ2dpbmcuc25hcCh7XG4gICAgICAgICAgc2Vuc29yOiBhYnNvbHV0ZSQzKHNlbnNvckxlZnQsIHNlbnNvclRvcCksXG4gICAgICAgICAgcmFuZ2U6IFN1Z2FyUG9zaXRpb24oc2Vuc29yV2lkdGgsIHNlbnNvckhlaWdodCksXG4gICAgICAgICAgb3V0cHV0OiBhYnNvbHV0ZSQzKE9wdGlvbmFsLnNvbWUoeCAtIHJlY3Qud2lkdGggLyAyKSwgT3B0aW9uYWwuc29tZSh5IC0gcmVjdC5oZWlnaHQgLyAyKSksXG4gICAgICAgICAgZXh0cmE6IHsgdGQ6IHRkIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRTbmFwc0NvbmZpZyA9IGZ1bmN0aW9uIChnZXRTbmFwUG9pbnRzLCBjZWxsLCBvbkNoYW5nZSkge1xuICAgICAgdmFyIGlzU2FtZUNlbGwgPSBmdW5jdGlvbiAoY2VsbE9wdCwgdGQpIHtcbiAgICAgICAgcmV0dXJuIGNlbGxPcHQuZXhpc3RzKGZ1bmN0aW9uIChjdXJyZW50VGQpIHtcbiAgICAgICAgICByZXR1cm4gZXEkMShjdXJyZW50VGQsIHRkKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0U25hcFBvaW50czogZ2V0U25hcFBvaW50cyxcbiAgICAgICAgbGVmdEF0dHI6ICdkYXRhLWRyYWctbGVmdCcsXG4gICAgICAgIHRvcEF0dHI6ICdkYXRhLWRyYWctdG9wJyxcbiAgICAgICAgb25TZW5zb3I6IGZ1bmN0aW9uIChjb21wb25lbnQsIGV4dHJhKSB7XG4gICAgICAgICAgdmFyIHRkID0gZXh0cmEudGQ7XG4gICAgICAgICAgaWYgKCFpc1NhbWVDZWxsKGNlbGwuZ2V0KCksIHRkKSkge1xuICAgICAgICAgICAgY2VsbC5zZXQoT3B0aW9uYWwuc29tZSh0ZCkpO1xuICAgICAgICAgICAgb25DaGFuZ2UodGQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbXVzdFNuYXA6IHRydWVcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlU2VsZWN0b3IgPSBmdW5jdGlvbiAoc25hcHMpIHtcbiAgICAgIHJldHVybiByZWNvcmQoQnV0dG9uLnNrZXRjaCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtc2VsZWN0b3InXVxuICAgICAgICB9LFxuICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgRHJhZ2dpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdtb3VzZU9yVG91Y2gnLFxuICAgICAgICAgICAgYmxvY2tlckNsYXNzOiAnYmxvY2tlcicsXG4gICAgICAgICAgICBzbmFwczogc25hcHNcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBVbnNlbGVjdGluZy5jb25maWcoe30pXG4gICAgICAgIF0pLFxuICAgICAgICBldmVudE9yZGVyOiB7XG4gICAgICAgICAgbW91c2Vkb3duOiBbXG4gICAgICAgICAgICAnZHJhZ2dpbmcnLFxuICAgICAgICAgICAgJ2FsbG95LmJhc2UuYmVoYXZpb3VyJ1xuICAgICAgICAgIF0sXG4gICAgICAgICAgdG91Y2hzdGFydDogW1xuICAgICAgICAgICAgJ2RyYWdnaW5nJyxcbiAgICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cidcbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH0pKTtcbiAgICB9O1xuICAgIHZhciBzZXR1cCRhID0gZnVuY3Rpb24gKGVkaXRvciwgc2luaykge1xuICAgICAgdmFyIHRsVGRzID0gQ2VsbChbXSk7XG4gICAgICB2YXIgYnJUZHMgPSBDZWxsKFtdKTtcbiAgICAgIHZhciBpc1Zpc2libGUgPSBDZWxsKGZhbHNlKTtcbiAgICAgIHZhciBzdGFydENlbGwgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgZmluaXNoQ2VsbCA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciBnZXRUb3BMZWZ0U25hcCA9IGZ1bmN0aW9uICh0ZCkge1xuICAgICAgICB2YXIgYm94ID0gYWJzb2x1dGUkMSh0ZCk7XG4gICAgICAgIHJldHVybiBjYWxjU25hcChtZW1Ub3BMZWZ0LmdldE9wdChzaW5rKSwgdGQsIGJveC54LCBib3gueSwgYm94LndpZHRoLCBib3guaGVpZ2h0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VG9wTGVmdFNuYXBzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbWFwKHRsVGRzLmdldCgpLCBmdW5jdGlvbiAodGQpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0VG9wTGVmdFNuYXAodGQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0Qm90dG9tUmlnaHRTbmFwID0gZnVuY3Rpb24gKHRkKSB7XG4gICAgICAgIHZhciBib3ggPSBhYnNvbHV0ZSQxKHRkKTtcbiAgICAgICAgcmV0dXJuIGNhbGNTbmFwKG1lbUJvdHRvbVJpZ2h0LmdldE9wdChzaW5rKSwgdGQsIGJveC5yaWdodCwgYm94LmJvdHRvbSwgYm94LndpZHRoLCBib3guaGVpZ2h0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0Qm90dG9tUmlnaHRTbmFwcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG1hcChiclRkcy5nZXQoKSwgZnVuY3Rpb24gKHRkKSB7XG4gICAgICAgICAgcmV0dXJuIGdldEJvdHRvbVJpZ2h0U25hcCh0ZCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b3BMZWZ0U25hcHMgPSBnZXRTbmFwc0NvbmZpZyhnZXRUb3BMZWZ0U25hcHMsIHN0YXJ0Q2VsbCwgZnVuY3Rpb24gKHN0YXJ0KSB7XG4gICAgICAgIGZpbmlzaENlbGwuZ2V0KCkuZWFjaChmdW5jdGlvbiAoZmluaXNoKSB7XG4gICAgICAgICAgZWRpdG9yLmZpcmUoJ1RhYmxlU2VsZWN0b3JDaGFuZ2UnLCB7XG4gICAgICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgICAgICBmaW5pc2g6IGZpbmlzaFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGJvdHRvbVJpZ2h0U25hcHMgPSBnZXRTbmFwc0NvbmZpZyhnZXRCb3R0b21SaWdodFNuYXBzLCBmaW5pc2hDZWxsLCBmdW5jdGlvbiAoZmluaXNoKSB7XG4gICAgICAgIHN0YXJ0Q2VsbC5nZXQoKS5lYWNoKGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgICAgIGVkaXRvci5maXJlKCdUYWJsZVNlbGVjdG9yQ2hhbmdlJywge1xuICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgZmluaXNoOiBmaW5pc2hcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBtZW1Ub3BMZWZ0ID0gY3JlYXRlU2VsZWN0b3IodG9wTGVmdFNuYXBzKTtcbiAgICAgIHZhciBtZW1Cb3R0b21SaWdodCA9IGNyZWF0ZVNlbGVjdG9yKGJvdHRvbVJpZ2h0U25hcHMpO1xuICAgICAgdmFyIHRvcExlZnQgPSBidWlsZCQxKG1lbVRvcExlZnQuYXNTcGVjKCkpO1xuICAgICAgdmFyIGJvdHRvbVJpZ2h0ID0gYnVpbGQkMShtZW1Cb3R0b21SaWdodC5hc1NwZWMoKSk7XG4gICAgICB2YXIgc2hvd09ySGlkZUhhbmRsZSA9IGZ1bmN0aW9uIChzZWxlY3RvciwgY2VsbCwgaXNBYm92ZSwgaXNCZWxvdykge1xuICAgICAgICB2YXIgY2VsbFJlY3QgPSBjZWxsLmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgcmVtb3ZlJDYoc2VsZWN0b3IuZWxlbWVudCwgJ2Rpc3BsYXknKTtcbiAgICAgICAgdmFyIHZpZXdwb3J0SGVpZ2h0ID0gZGVmYXVsdFZpZXcoU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldEJvZHkoKSkpLmRvbS5pbm5lckhlaWdodDtcbiAgICAgICAgdmFyIGFib3ZlVmlld3BvcnQgPSBpc0Fib3ZlKGNlbGxSZWN0KTtcbiAgICAgICAgdmFyIGJlbG93Vmlld3BvcnQgPSBpc0JlbG93KGNlbGxSZWN0LCB2aWV3cG9ydEhlaWdodCk7XG4gICAgICAgIGlmIChhYm92ZVZpZXdwb3J0IHx8IGJlbG93Vmlld3BvcnQpIHtcbiAgICAgICAgICBzZXQkMihzZWxlY3Rvci5lbGVtZW50LCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgc25hcFRvID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBjZWxsLCBnZXRTbmFwQ29uZmlnLCBwb3MpIHtcbiAgICAgICAgdmFyIHNuYXAgPSBnZXRTbmFwQ29uZmlnKGNlbGwpO1xuICAgICAgICBEcmFnZ2luZy5zbmFwVG8oc2VsZWN0b3IsIHNuYXApO1xuICAgICAgICB2YXIgaXNBYm92ZSA9IGZ1bmN0aW9uIChyZWN0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlY3RbcG9zXSA8IDA7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBpc0JlbG93ID0gZnVuY3Rpb24gKHJlY3QsIHZpZXdwb3J0SGVpZ2h0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlY3RbcG9zXSA+IHZpZXdwb3J0SGVpZ2h0O1xuICAgICAgICB9O1xuICAgICAgICBzaG93T3JIaWRlSGFuZGxlKHNlbGVjdG9yLCBjZWxsLCBpc0Fib3ZlLCBpc0JlbG93KTtcbiAgICAgIH07XG4gICAgICB2YXIgc25hcFRvcExlZnQgPSBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICByZXR1cm4gc25hcFRvKHRvcExlZnQsIGNlbGwsIGdldFRvcExlZnRTbmFwLCAndG9wJyk7XG4gICAgICB9O1xuICAgICAgdmFyIHNuYXBMYXN0VG9wTGVmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHN0YXJ0Q2VsbC5nZXQoKS5lYWNoKHNuYXBUb3BMZWZ0KTtcbiAgICAgIH07XG4gICAgICB2YXIgc25hcEJvdHRvbVJpZ2h0ID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIHNuYXBUbyhib3R0b21SaWdodCwgY2VsbCwgZ2V0Qm90dG9tUmlnaHRTbmFwLCAnYm90dG9tJyk7XG4gICAgICB9O1xuICAgICAgdmFyIHNuYXBMYXN0Qm90dG9tUmlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmaW5pc2hDZWxsLmdldCgpLmVhY2goc25hcEJvdHRvbVJpZ2h0KTtcbiAgICAgIH07XG4gICAgICBpZiAoZGV0ZWN0JDMoKS5kZXZpY2VUeXBlLmlzVG91Y2goKSkge1xuICAgICAgICBlZGl0b3Iub24oJ1RhYmxlU2VsZWN0aW9uQ2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBpZiAoIWlzVmlzaWJsZS5nZXQoKSkge1xuICAgICAgICAgICAgYXR0YWNoJDEoc2luaywgdG9wTGVmdCk7XG4gICAgICAgICAgICBhdHRhY2gkMShzaW5rLCBib3R0b21SaWdodCk7XG4gICAgICAgICAgICBpc1Zpc2libGUuc2V0KHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzdGFydENlbGwuc2V0KE9wdGlvbmFsLnNvbWUoZS5zdGFydCkpO1xuICAgICAgICAgIGZpbmlzaENlbGwuc2V0KE9wdGlvbmFsLnNvbWUoZS5maW5pc2gpKTtcbiAgICAgICAgICBlLm90aGVyQ2VsbHMuZWFjaChmdW5jdGlvbiAob3RoZXJDZWxscykge1xuICAgICAgICAgICAgdGxUZHMuc2V0KG90aGVyQ2VsbHMudXBPckxlZnRDZWxscyk7XG4gICAgICAgICAgICBiclRkcy5zZXQob3RoZXJDZWxscy5kb3duT3JSaWdodENlbGxzKTtcbiAgICAgICAgICAgIHNuYXBUb3BMZWZ0KGUuc3RhcnQpO1xuICAgICAgICAgICAgc25hcEJvdHRvbVJpZ2h0KGUuZmluaXNoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRvci5vbignUmVzaXplRWRpdG9yIFJlc2l6ZVdpbmRvdyBTY3JvbGxDb250ZW50JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNuYXBMYXN0VG9wTGVmdCgpO1xuICAgICAgICAgIHNuYXBMYXN0Qm90dG9tUmlnaHQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRvci5vbignVGFibGVTZWxlY3Rpb25DbGVhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoaXNWaXNpYmxlLmdldCgpKSB7XG4gICAgICAgICAgICBkZXRhY2godG9wTGVmdCk7XG4gICAgICAgICAgICBkZXRhY2goYm90dG9tUmlnaHQpO1xuICAgICAgICAgICAgaXNWaXNpYmxlLnNldChmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YXJ0Q2VsbC5zZXQoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgICBmaW5pc2hDZWxsLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGlzSGlkZGVuJDEgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICBpZiAoZWxtLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgIGlmIChlbG0ubm9kZU5hbWUgPT09ICdCUicgfHwgISFlbG0uZ2V0QXR0cmlidXRlKCdkYXRhLW1jZS1ib2d1cycpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLXR5cGUnKSA9PT0gJ2Jvb2ttYXJrJykge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRWxlbWVudFBhdGggPSBmdW5jdGlvbiAoZWRpdG9yLCBzZXR0aW5ncywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICBpZiAoIXNldHRpbmdzLmRlbGltaXRlcikge1xuICAgICAgICBzZXR0aW5ncy5kZWxpbWl0ZXIgPSAnXFx4QkInO1xuICAgICAgfVxuICAgICAgdmFyIGdldERhdGFQYXRoID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIHBhcnRzID0gZGF0YSB8fCBbXTtcbiAgICAgICAgdmFyIG5ld1BhdGhFbGVtZW50cyA9IG1hcChwYXJ0cywgZnVuY3Rpb24gKHBhcnQsIGluZGV4KSB7XG4gICAgICAgICAgcmV0dXJuIEJ1dHRvbi5za2V0Y2goe1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LXN0YXR1c2Jhcl9fcGF0aC1pdGVtJ10sXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAncm9sZSc6ICdidXR0b24nLFxuICAgICAgICAgICAgICAgICdkYXRhLWluZGV4JzogaW5kZXgsXG4gICAgICAgICAgICAgICAgJ3RhYi1pbmRleCc6IC0xLFxuICAgICAgICAgICAgICAgICdhcmlhLWxldmVsJzogaW5kZXggKyAxXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGlubmVySHRtbDogcGFydC5uYW1lXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoX2J0bikge1xuICAgICAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QocGFydC5lbGVtZW50KTtcbiAgICAgICAgICAgICAgZWRpdG9yLm5vZGVDaGFuZ2VkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgICAgICBEaXNhYmxpbmdDb25maWdzLmJ1dHRvbihwcm92aWRlcnNCYWNrc3RhZ2UuaXNEaXNhYmxlZCksXG4gICAgICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGRpdmlkZXIgPSB7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtc3RhdHVzYmFyX19wYXRoLWRpdmlkZXInXSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgJ2FyaWEtaGlkZGVuJzogdHJ1ZSB9LFxuICAgICAgICAgICAgaW5uZXJIdG1sOiAnICcgKyBzZXR0aW5ncy5kZWxpbWl0ZXIgKyAnICdcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBmb2xkbChuZXdQYXRoRWxlbWVudHMuc2xpY2UoMSksIGZ1bmN0aW9uIChhY2MsIGVsZW1lbnQpIHtcbiAgICAgICAgICB2YXIgbmV3QWNjID0gYWNjO1xuICAgICAgICAgIG5ld0FjYy5wdXNoKGRpdmlkZXIpO1xuICAgICAgICAgIG5ld0FjYy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgIHJldHVybiBuZXdBY2M7XG4gICAgICAgIH0sIFtuZXdQYXRoRWxlbWVudHNbMF1dKTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlUGF0aCA9IGZ1bmN0aW9uIChwYXJlbnRzKSB7XG4gICAgICAgIHZhciBuZXdQYXRoID0gW107XG4gICAgICAgIHZhciBpID0gcGFyZW50cy5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0gPiAwKSB7XG4gICAgICAgICAgdmFyIHBhcmVudF8xID0gcGFyZW50c1tpXTtcbiAgICAgICAgICBpZiAocGFyZW50XzEubm9kZVR5cGUgPT09IDEgJiYgIWlzSGlkZGVuJDEocGFyZW50XzEpKSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IGVkaXRvci5maXJlKCdSZXNvbHZlTmFtZScsIHtcbiAgICAgICAgICAgICAgbmFtZTogcGFyZW50XzEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgdGFyZ2V0OiBwYXJlbnRfMVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIWFyZ3MuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICAgICAgbmV3UGF0aC5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBhcmdzLm5hbWUsXG4gICAgICAgICAgICAgICAgZWxlbWVudDogcGFyZW50XzFcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXJncy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSB7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3UGF0aDtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXN0YXR1c2Jhcl9fcGF0aCddLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgcm9sZTogJ25hdmlnYXRpb24nIH1cbiAgICAgICAgfSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ2Zsb3cnLFxuICAgICAgICAgICAgc2VsZWN0b3I6ICdkaXZbcm9sZT1idXR0b25dJ1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIERpc2FibGluZy5jb25maWcoeyBkaXNhYmxlZDogcHJvdmlkZXJzQmFja3N0YWdlLmlzRGlzYWJsZWQgfSksXG4gICAgICAgICAgcmVjZWl2aW5nQ29uZmlnKCksXG4gICAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBSZXBsYWNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBjb25maWcoJ2VsZW1lbnRQYXRoRXZlbnRzJywgW3J1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXAsIF9lKSB7XG4gICAgICAgICAgICAgIGVkaXRvci5zaG9ydGN1dHMuYWRkKCdhbHQrRjExJywgJ2ZvY3VzIHN0YXR1c2JhciBlbGVtZW50cGF0aCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gS2V5aW5nLmZvY3VzSW4oY29tcCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBlZGl0b3Iub24oJ05vZGVDaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdQYXRoID0gdXBkYXRlUGF0aChlLnBhcmVudHMpO1xuICAgICAgICAgICAgICAgIGlmIChuZXdQYXRoLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgIFJlcGxhY2luZy5zZXQoY29tcCwgZ2V0RGF0YVBhdGgobmV3UGF0aCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBSZXBsYWNpbmcuc2V0KGNvbXAsIFtdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSldKVxuICAgICAgICBdKSxcbiAgICAgICAgY29tcG9uZW50czogW11cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBSZXNpemVUeXBlcztcbiAgICAoZnVuY3Rpb24gKFJlc2l6ZVR5cGVzKSB7XG4gICAgICBSZXNpemVUeXBlc1tSZXNpemVUeXBlc1snTm9uZSddID0gMF0gPSAnTm9uZSc7XG4gICAgICBSZXNpemVUeXBlc1tSZXNpemVUeXBlc1snQm90aCddID0gMV0gPSAnQm90aCc7XG4gICAgICBSZXNpemVUeXBlc1tSZXNpemVUeXBlc1snVmVydGljYWwnXSA9IDJdID0gJ1ZlcnRpY2FsJztcbiAgICB9KFJlc2l6ZVR5cGVzIHx8IChSZXNpemVUeXBlcyA9IHt9KSkpO1xuICAgIHZhciBnZXREaW1lbnNpb25zID0gZnVuY3Rpb24gKGVkaXRvciwgZGVsdGFzLCByZXNpemVUeXBlLCBvcmlnaW5hbEhlaWdodCwgb3JpZ2luYWxXaWR0aCkge1xuICAgICAgdmFyIGRpbWVuc2lvbnMgPSB7fTtcbiAgICAgIGRpbWVuc2lvbnMuaGVpZ2h0ID0gY2FsY0NhcHBlZFNpemUob3JpZ2luYWxIZWlnaHQgKyBkZWx0YXMudG9wLCBnZXRNaW5IZWlnaHRTZXR0aW5nKGVkaXRvciksIGdldE1heEhlaWdodFNldHRpbmcoZWRpdG9yKSk7XG4gICAgICBpZiAocmVzaXplVHlwZSA9PT0gUmVzaXplVHlwZXMuQm90aCkge1xuICAgICAgICBkaW1lbnNpb25zLndpZHRoID0gY2FsY0NhcHBlZFNpemUob3JpZ2luYWxXaWR0aCArIGRlbHRhcy5sZWZ0LCBnZXRNaW5XaWR0aFNldHRpbmcoZWRpdG9yKSwgZ2V0TWF4V2lkdGhTZXR0aW5nKGVkaXRvcikpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRpbWVuc2lvbnM7XG4gICAgfTtcbiAgICB2YXIgcmVzaXplJDMgPSBmdW5jdGlvbiAoZWRpdG9yLCBkZWx0YXMsIHJlc2l6ZVR5cGUpIHtcbiAgICAgIHZhciBjb250YWluZXIgPSBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0Q29udGFpbmVyKCkpO1xuICAgICAgdmFyIGRpbWVuc2lvbnMgPSBnZXREaW1lbnNpb25zKGVkaXRvciwgZGVsdGFzLCByZXNpemVUeXBlLCBnZXQkNyhjb250YWluZXIpLCBnZXQkOChjb250YWluZXIpKTtcbiAgICAgIGVhY2gkMShkaW1lbnNpb25zLCBmdW5jdGlvbiAodmFsLCBkaW0pIHtcbiAgICAgICAgcmV0dXJuIHNldCQyKGNvbnRhaW5lciwgZGltLCBudW1Ub1B4KHZhbCkpO1xuICAgICAgfSk7XG4gICAgICBmaXJlUmVzaXplRWRpdG9yKGVkaXRvcik7XG4gICAgfTtcblxuICAgIHZhciBnZXRSZXNpemVUeXBlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGZhbGxiYWNrID0gIWVkaXRvci5oYXNQbHVnaW4oJ2F1dG9yZXNpemUnKTtcbiAgICAgIHZhciByZXNpemUgPSBlZGl0b3IuZ2V0UGFyYW0oJ3Jlc2l6ZScsIGZhbGxiYWNrKTtcbiAgICAgIGlmIChyZXNpemUgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBSZXNpemVUeXBlcy5Ob25lO1xuICAgICAgfSBlbHNlIGlmIChyZXNpemUgPT09ICdib3RoJykge1xuICAgICAgICByZXR1cm4gUmVzaXplVHlwZXMuQm90aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBSZXNpemVUeXBlcy5WZXJ0aWNhbDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBrZXlib2FyZEhhbmRsZXIgPSBmdW5jdGlvbiAoZWRpdG9yLCByZXNpemVUeXBlLCB4LCB5KSB7XG4gICAgICB2YXIgc2NhbGUgPSAyMDtcbiAgICAgIHZhciBkZWx0YSA9IFN1Z2FyUG9zaXRpb24oeCAqIHNjYWxlLCB5ICogc2NhbGUpO1xuICAgICAgcmVzaXplJDMoZWRpdG9yLCBkZWx0YSwgcmVzaXplVHlwZSk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJSZXNpemVIYW5kbGVyID0gZnVuY3Rpb24gKGVkaXRvciwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgcmVzaXplVHlwZSA9IGdldFJlc2l6ZVR5cGUoZWRpdG9yKTtcbiAgICAgIGlmIChyZXNpemVUeXBlID09PSBSZXNpemVUeXBlcy5Ob25lKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtc3RhdHVzYmFyX19yZXNpemUtaGFuZGxlJ10sXG4gICAgICAgICAgYXR0cmlidXRlczogeyB0aXRsZTogcHJvdmlkZXJzQmFja3N0YWdlLnRyYW5zbGF0ZSgnUmVzaXplJykgfSxcbiAgICAgICAgICBpbm5lckh0bWw6IGdldCRlKCdyZXNpemUtaGFuZGxlJywgcHJvdmlkZXJzQmFja3N0YWdlLmljb25zKVxuICAgICAgICB9LFxuICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgRHJhZ2dpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdtb3VzZScsXG4gICAgICAgICAgICByZXBvc2l0aW9uVGFyZ2V0OiBmYWxzZSxcbiAgICAgICAgICAgIG9uRHJhZzogZnVuY3Rpb24gKF9jb21wLCBfdGFyZ2V0LCBkZWx0YSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzaXplJDMoZWRpdG9yLCBkZWx0YSwgcmVzaXplVHlwZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmxvY2tlckNsYXNzOiAndG94LWJsb2NrZXInXG4gICAgICAgICAgfSksXG4gICAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBtb2RlOiAnc3BlY2lhbCcsXG4gICAgICAgICAgICBvbkxlZnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGtleWJvYXJkSGFuZGxlcihlZGl0b3IsIHJlc2l6ZVR5cGUsIC0xLCAwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblJpZ2h0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBrZXlib2FyZEhhbmRsZXIoZWRpdG9yLCByZXNpemVUeXBlLCAxLCAwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvblVwOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBrZXlib2FyZEhhbmRsZXIoZWRpdG9yLCByZXNpemVUeXBlLCAwLCAtMSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBrZXlib2FyZEhhbmRsZXIoZWRpdG9yLCByZXNpemVUeXBlLCAwLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICBUYWJzdG9wcGluZy5jb25maWcoe30pLFxuICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSlcbiAgICAgICAgXSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVyV29yZENvdW50ID0gZnVuY3Rpb24gKGVkaXRvciwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgX2E7XG4gICAgICB2YXIgcmVwbGFjZUNvdW50VGV4dCA9IGZ1bmN0aW9uIChjb21wLCBjb3VudCwgbW9kZSkge1xuICAgICAgICByZXR1cm4gUmVwbGFjaW5nLnNldChjb21wLCBbdGV4dChwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKFtcbiAgICAgICAgICAgICd7MH0gJyArIG1vZGUsXG4gICAgICAgICAgICBjb3VudFttb2RlXVxuICAgICAgICAgIF0pKV0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBCdXR0b24uc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnYnV0dG9uJyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1zdGF0dXNiYXJfX3dvcmRjb3VudCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtdLFxuICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgRGlzYWJsaW5nQ29uZmlncy5idXR0b24ocHJvdmlkZXJzQmFja3N0YWdlLmlzRGlzYWJsZWQpLFxuICAgICAgICAgIHJlY2VpdmluZ0NvbmZpZygpLFxuICAgICAgICAgIFRhYnN0b3BwaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgUmVwbGFjaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWVtb3J5JyxcbiAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgbW9kZTogJ3dvcmRzJyxcbiAgICAgICAgICAgICAgICBjb3VudDoge1xuICAgICAgICAgICAgICAgICAgd29yZHM6IDAsXG4gICAgICAgICAgICAgICAgICBjaGFyYWN0ZXJzOiAwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgY29uZmlnKCd3b3JkY291bnQtZXZlbnRzJywgW1xuICAgICAgICAgICAgcnVuT25FeGVjdXRlKGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgICAgIHZhciBjdXJyZW50VmFsID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGNvbXApO1xuICAgICAgICAgICAgICB2YXIgbmV3TW9kZSA9IGN1cnJlbnRWYWwubW9kZSA9PT0gJ3dvcmRzJyA/ICdjaGFyYWN0ZXJzJyA6ICd3b3Jkcyc7XG4gICAgICAgICAgICAgIFJlcHJlc2VudGluZy5zZXRWYWx1ZShjb21wLCB7XG4gICAgICAgICAgICAgICAgbW9kZTogbmV3TW9kZSxcbiAgICAgICAgICAgICAgICBjb3VudDogY3VycmVudFZhbC5jb3VudFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmVwbGFjZUNvdW50VGV4dChjb21wLCBjdXJyZW50VmFsLmNvdW50LCBuZXdNb2RlKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICBlZGl0b3Iub24oJ3dvcmRDb3VudFVwZGF0ZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGUgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoY29tcCkubW9kZTtcbiAgICAgICAgICAgICAgICBSZXByZXNlbnRpbmcuc2V0VmFsdWUoY29tcCwge1xuICAgICAgICAgICAgICAgICAgbW9kZTogbW9kZSxcbiAgICAgICAgICAgICAgICAgIGNvdW50OiBlLndvcmRDb3VudFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJlcGxhY2VDb3VudFRleHQoY29tcCwgZS53b3JkQ291bnQsIG1vZGUpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgXSlcbiAgICAgICAgXSksXG4gICAgICAgIGV2ZW50T3JkZXI6IChfYSA9IHt9LCBfYVtleGVjdXRlKCldID0gW1xuICAgICAgICAgICdkaXNhYmxpbmcnLFxuICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cicsXG4gICAgICAgICAgJ3dvcmRjb3VudC1ldmVudHMnXG4gICAgICAgIF0sIF9hKVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJTdGF0dXNiYXIgPSBmdW5jdGlvbiAoZWRpdG9yLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciByZW5kZXJCcmFuZGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxhYmVsID0gZ2xvYmFsJDYudHJhbnNsYXRlKFtcbiAgICAgICAgICAnUG93ZXJlZCBieSB7MH0nLFxuICAgICAgICAgICdUaW55J1xuICAgICAgICBdKTtcbiAgICAgICAgdmFyIGxpbmtIdG1sID0gJzxhIGhyZWY9XCJodHRwczovL3d3dy50aW55LmNsb3VkLz91dG1fY2FtcGFpZ249ZWRpdG9yX3JlZmVycmFsJmFtcDt1dG1fbWVkaXVtPXBvd2VyZWRieSZhbXA7dXRtX3NvdXJjZT10aW55bWNlJmFtcDt1dG1fY29udGVudD12NVwiIHJlbD1cIm5vb3BlbmVyXCIgdGFyZ2V0PVwiX2JsYW5rXCIgdGFiaW5kZXg9XCItMVwiIGFyaWEtbGFiZWw9XCInICsgbGFiZWwgKyAnXCI+JyArIGxhYmVsICsgJzwvYT4nO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnc3BhbicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1zdGF0dXNiYXJfX2JyYW5kaW5nJ10sXG4gICAgICAgICAgICBpbm5lckh0bWw6IGxpbmtIdG1sXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRUZXh0Q29tcG9uZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBbXTtcbiAgICAgICAgaWYgKGVkaXRvci5nZXRQYXJhbSgnZWxlbWVudHBhdGgnLCB0cnVlLCAnYm9vbGVhbicpKSB7XG4gICAgICAgICAgY29tcG9uZW50cy5wdXNoKHJlbmRlckVsZW1lbnRQYXRoKGVkaXRvciwge30sIHByb3ZpZGVyc0JhY2tzdGFnZSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlZGl0b3IuaGFzUGx1Z2luKCd3b3JkY291bnQnKSkge1xuICAgICAgICAgIGNvbXBvbmVudHMucHVzaChyZW5kZXJXb3JkQ291bnQoZWRpdG9yLCBwcm92aWRlcnNCYWNrc3RhZ2UpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWRpdG9yLmdldFBhcmFtKCdicmFuZGluZycsIHRydWUsICdib29sZWFuJykpIHtcbiAgICAgICAgICBjb21wb25lbnRzLnB1c2gocmVuZGVyQnJhbmRpbmcoKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbXBvbmVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiBbe1xuICAgICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LXN0YXR1c2Jhcl9fdGV4dC1jb250YWluZXInXVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjb21wb25lbnRzOiBjb21wb25lbnRzXG4gICAgICAgICAgICB9XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9O1xuICAgICAgdmFyIGdldENvbXBvbmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb21wb25lbnRzID0gZ2V0VGV4dENvbXBvbmVudHMoKTtcbiAgICAgICAgdmFyIHJlc2l6ZUhhbmRsZXIgPSByZW5kZXJSZXNpemVIYW5kbGVyKGVkaXRvciwgcHJvdmlkZXJzQmFja3N0YWdlKTtcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudHMuY29uY2F0KHJlc2l6ZUhhbmRsZXIudG9BcnJheSgpKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXN0YXR1c2JhciddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IGdldENvbXBvbmVudHMoKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNldHVwJGIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgX2E7XG4gICAgICB2YXIgaXNJbmxpbmUgPSBlZGl0b3IuaW5saW5lO1xuICAgICAgdmFyIG1vZGUgPSBpc0lubGluZSA/IElubGluZSA6IElmcmFtZTtcbiAgICAgIHZhciBoZWFkZXIgPSBpc1N0aWNreVRvb2xiYXIoZWRpdG9yKSA/IFN0aWNreUhlYWRlciA6IFN0YXRpY0hlYWRlcjtcbiAgICAgIHZhciBsYXp5T3V0ZXJDb250YWluZXIgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICB2YXIgcGxhdGZvcm0gPSBkZXRlY3QkMygpO1xuICAgICAgdmFyIGlzSUUgPSBwbGF0Zm9ybS5icm93c2VyLmlzSUUoKTtcbiAgICAgIHZhciBwbGF0Zm9ybUNsYXNzZXMgPSBpc0lFID8gWyd0b3gtcGxhdGZvcm0taWUnXSA6IFtdO1xuICAgICAgdmFyIGlzVG91Y2ggPSBwbGF0Zm9ybS5kZXZpY2VUeXBlLmlzVG91Y2goKTtcbiAgICAgIHZhciB0b3VjaFBsYXRmb3JtQ2xhc3MgPSAndG94LXBsYXRmb3JtLXRvdWNoJztcbiAgICAgIHZhciBkZXZpY2VDbGFzc2VzID0gaXNUb3VjaCA/IFt0b3VjaFBsYXRmb3JtQ2xhc3NdIDogW107XG4gICAgICB2YXIgaXNUb29sYmFyQm90dG9tID0gaXNUb29sYmFyTG9jYXRpb25Cb3R0b20oZWRpdG9yKTtcbiAgICAgIHZhciB1aUNvbnRhaW5lciA9IGdldFVpQ29udGFpbmVyKGVkaXRvcik7XG4gICAgICB2YXIgZGlyQXR0cmlidXRlcyA9IGdsb2JhbCQ2LmlzUnRsKCkgPyB7IGF0dHJpYnV0ZXM6IHsgZGlyOiAncnRsJyB9IH0gOiB7fTtcbiAgICAgIHZhciB2ZXJ0aWNhbERpckF0dHJpYnV0ZXMgPSB7IGF0dHJpYnV0ZXM6IChfYSA9IHt9LCBfYVtBdHRyaWJ1dGVdID0gaXNUb29sYmFyQm90dG9tID8gQXR0cmlidXRlVmFsdWUuQm90dG9tVG9Ub3AgOiBBdHRyaWJ1dGVWYWx1ZS5Ub3BUb0JvdHRvbSwgX2EpIH07XG4gICAgICB2YXIgbGF6eUhlYWRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGxhenlPdXRlckNvbnRhaW5lci5iaW5kKE91dGVyQ29udGFpbmVyLmdldEhlYWRlcik7XG4gICAgICB9O1xuICAgICAgdmFyIGlzSGVhZGVyRG9ja2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaGVhZGVyLmlzRG9ja2VkKGxhenlIZWFkZXIpO1xuICAgICAgfTtcbiAgICAgIHZhciByZXNpemVVaU1vdGhlcnNoaXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNldCQyKHVpTW90aGVyc2hpcC5lbGVtZW50LCAnd2lkdGgnLCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoICsgJ3B4Jyk7XG4gICAgICB9O1xuICAgICAgdmFyIG1ha2VTaW5rRGVmaW5pdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGlzR3JpZFVpQ29udGFpbmVyID0gZXEkMShib2R5KCksIHVpQ29udGFpbmVyKSAmJiBnZXQkNSh1aUNvbnRhaW5lciwgJ2Rpc3BsYXknKSA9PT0gJ2dyaWQnO1xuICAgICAgICB2YXIgc2lua1NwZWMgPSB7XG4gICAgICAgICAgZG9tOiBfX2Fzc2lnbih7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgICAndG94JyxcbiAgICAgICAgICAgICAgJ3RveC1zaWx2ZXItc2luaycsXG4gICAgICAgICAgICAgICd0b3gtdGlueW1jZS1hdXgnXG4gICAgICAgICAgICBdLmNvbmNhdChwbGF0Zm9ybUNsYXNzZXMpLmNvbmNhdChkZXZpY2VDbGFzc2VzKVxuICAgICAgICAgIH0sIGRpckF0dHJpYnV0ZXMpLFxuICAgICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtQb3NpdGlvbmluZy5jb25maWcoe1xuICAgICAgICAgICAgICB1c2VGaXhlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpc0hlYWRlckRvY2tlZCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KV0pXG4gICAgICAgIH07XG4gICAgICAgIHZhciByZWFjdGl2ZVdpZHRoU3BlYyA9IHtcbiAgICAgICAgICBkb206IHsgc3R5bGVzOiB7IHdpZHRoOiBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoICsgJ3B4JyB9IH0sXG4gICAgICAgICAgZXZlbnRzOiBkZXJpdmUoW3J1bih3aW5kb3dSZXNpemUoKSwgcmVzaXplVWlNb3RoZXJzaGlwKV0pXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkZWVwTWVyZ2Uoc2lua1NwZWMsIGlzR3JpZFVpQ29udGFpbmVyID8gcmVhY3RpdmVXaWR0aFNwZWMgOiB7fSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNpbmsgPSBidWlsZCQxKG1ha2VTaW5rRGVmaW5pdGlvbigpKTtcbiAgICAgIHZhciBsYXp5U2luayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFJlc3VsdC52YWx1ZShzaW5rKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWVtQW5jaG9yQmFyID0gcmVjb3JkKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1hbmNob3JiYXInXVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBsYXp5QW5jaG9yQmFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbGF6eU91dGVyQ29udGFpbmVyLmJpbmQoZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgIHJldHVybiBtZW1BbmNob3JCYXIuZ2V0T3B0KGNvbnRhaW5lcik7XG4gICAgICAgIH0pLmdldE9yRGllKCdDb3VsZCBub3QgZmluZCBhIGFuY2hvciBiYXIgZWxlbWVudCcpO1xuICAgICAgfTtcbiAgICAgIHZhciBsYXp5VG9vbGJhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGxhenlPdXRlckNvbnRhaW5lci5iaW5kKGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgICByZXR1cm4gT3V0ZXJDb250YWluZXIuZ2V0VG9vbGJhcihjb250YWluZXIpO1xuICAgICAgICB9KS5nZXRPckRpZSgnQ291bGQgbm90IGZpbmQgbW9yZSB0b29sYmFyIGVsZW1lbnQnKTtcbiAgICAgIH07XG4gICAgICB2YXIgbGF6eVRocm9iYmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbGF6eU91dGVyQ29udGFpbmVyLmJpbmQoZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgICAgICAgIHJldHVybiBPdXRlckNvbnRhaW5lci5nZXRUaHJvYmJlcihjb250YWluZXIpO1xuICAgICAgICB9KS5nZXRPckRpZSgnQ291bGQgbm90IGZpbmQgdGhyb2JiZXIgZWxlbWVudCcpO1xuICAgICAgfTtcbiAgICAgIHZhciBiYWNrc3RhZ2UgPSBpbml0JDgoc2luaywgZWRpdG9yLCBsYXp5QW5jaG9yQmFyKTtcbiAgICAgIHZhciBwYXJ0TWVudWJhciA9IE91dGVyQ29udGFpbmVyLnBhcnRzLm1lbnViYXIoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LW1lbnViYXInXVxuICAgICAgICB9LFxuICAgICAgICBiYWNrc3RhZ2U6IGJhY2tzdGFnZSxcbiAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgdG9vbGJhck1vZGUgPSBnZXRUb29sYmFyTW9kZShlZGl0b3IpO1xuICAgICAgdmFyIHBhcnRUb29sYmFyID0gT3V0ZXJDb250YWluZXIucGFydHMudG9vbGJhcihfX2Fzc2lnbih7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtdG9vbGJhciddXG4gICAgICAgIH0sXG4gICAgICAgIGdldFNpbms6IGxhenlTaW5rLFxuICAgICAgICBwcm92aWRlcnM6IGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLFxuICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICB9LFxuICAgICAgICB0eXBlOiB0b29sYmFyTW9kZSxcbiAgICAgICAgbGF6eVRvb2xiYXI6IGxhenlUb29sYmFyLFxuICAgICAgICBsYXp5SGVhZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGxhenlIZWFkZXIoKS5nZXRPckRpZSgnQ291bGQgbm90IGZpbmQgaGVhZGVyIGVsZW1lbnQnKTtcbiAgICAgICAgfVxuICAgICAgfSwgdmVydGljYWxEaXJBdHRyaWJ1dGVzKSk7XG4gICAgICB2YXIgcGFydE11bHRpcGxlVG9vbGJhciA9IE91dGVyQ29udGFpbmVyLnBhcnRzWydtdWx0aXBsZS10b29sYmFyJ10oe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXRvb2xiYXItb3ZlcmxvcmQnXVxuICAgICAgICB9LFxuICAgICAgICBwcm92aWRlcnM6IGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLFxuICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICB9LFxuICAgICAgICB0eXBlOiB0b29sYmFyTW9kZVxuICAgICAgfSk7XG4gICAgICB2YXIgcGFydFNvY2tldCA9IE91dGVyQ29udGFpbmVyLnBhcnRzLnNvY2tldCh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtZWRpdC1hcmVhJ11cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgcGFydFNpZGViYXIgPSBPdXRlckNvbnRhaW5lci5wYXJ0cy5zaWRlYmFyKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1zaWRlYmFyJ11cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgcGFydFRocm9iYmVyID0gT3V0ZXJDb250YWluZXIucGFydHMudGhyb2JiZXIoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXRocm9iYmVyJ11cbiAgICAgICAgfSxcbiAgICAgICAgYmFja3N0YWdlOiBiYWNrc3RhZ2VcbiAgICAgIH0pO1xuICAgICAgdmFyIHNiID0gZWRpdG9yLmdldFBhcmFtKCdzdGF0dXNiYXInLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgICAgdmFyIHN0YXR1c2JhciA9IHNiICYmICFpc0lubGluZSA/IE9wdGlvbmFsLnNvbWUocmVuZGVyU3RhdHVzYmFyKGVkaXRvciwgYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIHZhciBzb2NrZXRTaWRlYmFyQ29udGFpbmVyID0ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LXNpZGViYXItd3JhcCddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICBwYXJ0U29ja2V0LFxuICAgICAgICAgIHBhcnRTaWRlYmFyXG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgICB2YXIgaGFzTXVsdGlwbGVUb29sYmFyID0gaXNNdWx0aXBsZVRvb2xiYXJzKGVkaXRvcik7XG4gICAgICB2YXIgaGFzVG9vbGJhciA9IGlzVG9vbGJhckVuYWJsZWQoZWRpdG9yKTtcbiAgICAgIHZhciBoYXNNZW51YmFyID0gaXNNZW51YmFyRW5hYmxlZChlZGl0b3IpO1xuICAgICAgdmFyIGdldFBhcnRUb29sYmFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaGFzTXVsdGlwbGVUb29sYmFyKSB7XG4gICAgICAgICAgcmV0dXJuIFtwYXJ0TXVsdGlwbGVUb29sYmFyXTtcbiAgICAgICAgfSBlbHNlIGlmIChoYXNUb29sYmFyKSB7XG4gICAgICAgICAgcmV0dXJuIFtwYXJ0VG9vbGJhcl07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHBhcnRIZWFkZXIgPSBPdXRlckNvbnRhaW5lci5wYXJ0cy5oZWFkZXIoe1xuICAgICAgICBkb206IF9fYXNzaWduKHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWVkaXRvci1oZWFkZXInXVxuICAgICAgICB9LCB2ZXJ0aWNhbERpckF0dHJpYnV0ZXMpLFxuICAgICAgICBjb21wb25lbnRzOiBmbGF0dGVuKFtcbiAgICAgICAgICBoYXNNZW51YmFyID8gW3BhcnRNZW51YmFyXSA6IFtdLFxuICAgICAgICAgIGdldFBhcnRUb29sYmFyKCksXG4gICAgICAgICAgdXNlRml4ZWRDb250YWluZXIoZWRpdG9yKSA/IFtdIDogW21lbUFuY2hvckJhci5hc1NwZWMoKV1cbiAgICAgICAgXSksXG4gICAgICAgIHN0aWNreTogaXNTdGlja3lUb29sYmFyKGVkaXRvciksXG4gICAgICAgIGVkaXRvcjogZWRpdG9yLFxuICAgICAgICBzaGFyZWRCYWNrc3RhZ2U6IGJhY2tzdGFnZS5zaGFyZWRcbiAgICAgIH0pO1xuICAgICAgdmFyIGVkaXRvckNvbXBvbmVudHMgPSBmbGF0dGVuKFtcbiAgICAgICAgaXNUb29sYmFyQm90dG9tID8gW10gOiBbcGFydEhlYWRlcl0sXG4gICAgICAgIGlzSW5saW5lID8gW10gOiBbc29ja2V0U2lkZWJhckNvbnRhaW5lcl0sXG4gICAgICAgIGlzVG9vbGJhckJvdHRvbSA/IFtwYXJ0SGVhZGVyXSA6IFtdXG4gICAgICBdKTtcbiAgICAgIHZhciBlZGl0b3JDb250YWluZXIgPSB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtZWRpdG9yLWNvbnRhaW5lciddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IGVkaXRvckNvbXBvbmVudHNcbiAgICAgIH07XG4gICAgICB2YXIgY29udGFpbmVyQ29tcG9uZW50cyA9IGZsYXR0ZW4oW1xuICAgICAgICBbZWRpdG9yQ29udGFpbmVyXSxcbiAgICAgICAgaXNJbmxpbmUgPyBbXSA6IHN0YXR1c2Jhci50b0FycmF5KCksXG4gICAgICAgIFtwYXJ0VGhyb2JiZXJdXG4gICAgICBdKTtcbiAgICAgIHZhciBpc0hpZGRlbiA9IGlzRGlzdHJhY3Rpb25GcmVlKGVkaXRvcik7XG4gICAgICB2YXIgYXR0cmlidXRlcyA9IF9fYXNzaWduKF9fYXNzaWduKHsgcm9sZTogJ2FwcGxpY2F0aW9uJyB9LCBnbG9iYWwkNi5pc1J0bCgpID8geyBkaXI6ICdydGwnIH0gOiB7fSksIGlzSGlkZGVuID8geyAnYXJpYS1oaWRkZW4nOiAndHJ1ZScgfSA6IHt9KTtcbiAgICAgIHZhciBvdXRlckNvbnRhaW5lciA9IGJ1aWxkJDEoT3V0ZXJDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAndG94JyxcbiAgICAgICAgICAgICd0b3gtdGlueW1jZSdcbiAgICAgICAgICBdLmNvbmNhdChpc0lubGluZSA/IFsndG94LXRpbnltY2UtaW5saW5lJ10gOiBbXSkuY29uY2F0KGlzVG9vbGJhckJvdHRvbSA/IFsndG94LXRpbnltY2UtLXRvb2xiYXItYm90dG9tJ10gOiBbXSkuY29uY2F0KGRldmljZUNsYXNzZXMpLmNvbmNhdChwbGF0Zm9ybUNsYXNzZXMpLFxuICAgICAgICAgIHN0eWxlczogX19hc3NpZ24oeyB2aXNpYmlsaXR5OiAnaGlkZGVuJyB9LCBpc0hpZGRlbiA/IHtcbiAgICAgICAgICAgIG9wYWNpdHk6ICcwJyxcbiAgICAgICAgICAgIGJvcmRlcjogJzAnXG4gICAgICAgICAgfSA6IHt9KSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGVzXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbnRhaW5lckNvbXBvbmVudHMsXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICByZWNlaXZpbmdDb25maWcoKSxcbiAgICAgICAgICBEaXNhYmxpbmcuY29uZmlnKHsgZGlzYWJsZUNsYXNzOiAndG94LXRpbnltY2UtLWRpc2FibGVkJyB9KSxcbiAgICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdjeWNsaWMnLFxuICAgICAgICAgICAgc2VsZWN0b3I6ICcudG94LW1lbnViYXIsIC50b3gtdG9vbGJhciwgLnRveC10b29sYmFyX19wcmltYXJ5LCAudG94LXRvb2xiYXJfX292ZXJmbG93LS1vcGVuLCAudG94LXNpZGViYXJfX292ZXJmbG93LS1vcGVuLCAudG94LXN0YXR1c2Jhcl9fcGF0aCwgLnRveC1zdGF0dXNiYXJfX3dvcmRjb3VudCwgLnRveC1zdGF0dXNiYXJfX2JyYW5kaW5nIGEsIC50b3gtc3RhdHVzYmFyX19yZXNpemUtaGFuZGxlJ1xuICAgICAgICAgIH0pXG4gICAgICAgIF0pXG4gICAgICB9KSk7XG4gICAgICBsYXp5T3V0ZXJDb250YWluZXIgPSBPcHRpb25hbC5zb21lKG91dGVyQ29udGFpbmVyKTtcbiAgICAgIGVkaXRvci5zaG9ydGN1dHMuYWRkKCdhbHQrRjknLCAnZm9jdXMgbWVudWJhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgT3V0ZXJDb250YWluZXIuZm9jdXNNZW51YmFyKG91dGVyQ29udGFpbmVyKTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnNob3J0Y3V0cy5hZGQoJ2FsdCtGMTAnLCAnZm9jdXMgdG9vbGJhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgT3V0ZXJDb250YWluZXIuZm9jdXNUb29sYmFyKG91dGVyQ29udGFpbmVyKTtcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLmFkZENvbW1hbmQoJ1RvZ2dsZVRvb2xiYXJEcmF3ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIE91dGVyQ29udGFpbmVyLnRvZ2dsZVRvb2xiYXJEcmF3ZXIob3V0ZXJDb250YWluZXIpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IuYWRkUXVlcnlTdGF0ZUhhbmRsZXIoJ1RvZ2dsZVRvb2xiYXJEcmF3ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBPdXRlckNvbnRhaW5lci5pc1Rvb2xiYXJEcmF3ZXJUb2dnbGVkKG91dGVyQ29udGFpbmVyKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIG1vdGhlcnNoaXAgPSB0YWtlb3ZlcihvdXRlckNvbnRhaW5lcik7XG4gICAgICB2YXIgdWlNb3RoZXJzaGlwID0gdGFrZW92ZXIoc2luayk7XG4gICAgICBzZXR1cCQzKGVkaXRvciwgbW90aGVyc2hpcCwgdWlNb3RoZXJzaGlwKTtcbiAgICAgIHZhciBnZXRVaSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNoYW5uZWxzID0ge1xuICAgICAgICAgIGJyb2FkY2FzdEFsbDogdWlNb3RoZXJzaGlwLmJyb2FkY2FzdCxcbiAgICAgICAgICBicm9hZGNhc3RPbjogdWlNb3RoZXJzaGlwLmJyb2FkY2FzdE9uLFxuICAgICAgICAgIHJlZ2lzdGVyOiBub29wXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7IGNoYW5uZWxzOiBjaGFubmVscyB9O1xuICAgICAgfTtcbiAgICAgIHZhciBzZXRFZGl0b3JTaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFyc2VkSGVpZ2h0ID0gbnVtVG9QeChnZXRIZWlnaHRXaXRoRmFsbGJhY2soZWRpdG9yKSk7XG4gICAgICAgIHZhciBwYXJzZWRXaWR0aCA9IG51bVRvUHgoZ2V0V2lkdGhXaXRoRmFsbGJhY2soZWRpdG9yKSk7XG4gICAgICAgIGlmICghZWRpdG9yLmlubGluZSkge1xuICAgICAgICAgIGlmIChpc1ZhbGlkVmFsdWUoJ2RpdicsICd3aWR0aCcsIHBhcnNlZFdpZHRoKSkge1xuICAgICAgICAgICAgc2V0JDIob3V0ZXJDb250YWluZXIuZWxlbWVudCwgJ3dpZHRoJywgcGFyc2VkV2lkdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNWYWxpZFZhbHVlKCdkaXYnLCAnaGVpZ2h0JywgcGFyc2VkSGVpZ2h0KSkge1xuICAgICAgICAgICAgc2V0JDIob3V0ZXJDb250YWluZXIuZWxlbWVudCwgJ2hlaWdodCcsIHBhcnNlZEhlaWdodCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNldCQyKG91dGVyQ29udGFpbmVyLmVsZW1lbnQsICdoZWlnaHQnLCAnMjAwcHgnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcnNlZEhlaWdodDtcbiAgICAgIH07XG4gICAgICB2YXIgcmVuZGVyVUkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhlYWRlci5zZXR1cChlZGl0b3IsIGJhY2tzdGFnZS5zaGFyZWQsIGxhenlIZWFkZXIpO1xuICAgICAgICBzZXR1cCQ4KGVkaXRvciwgYmFja3N0YWdlKTtcbiAgICAgICAgc2V0dXAkOShlZGl0b3IsIGxhenlTaW5rLCBiYWNrc3RhZ2UpO1xuICAgICAgICBzZXR1cCQ2KGVkaXRvcik7XG4gICAgICAgIHNldHVwJDcoZWRpdG9yLCBsYXp5VGhyb2JiZXIsIGJhY2tzdGFnZS5zaGFyZWQpO1xuICAgICAgICBtYXAkMihnZXRUb29sYmFyR3JvdXBzKGVkaXRvciksIGZ1bmN0aW9uICh0b29sYmFyR3JvdXBCdXR0b25Db25maWcsIG5hbWUpIHtcbiAgICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkR3JvdXBUb29sYmFyQnV0dG9uKG5hbWUsIHRvb2xiYXJHcm91cEJ1dHRvbkNvbmZpZyk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgX2EgPSBlZGl0b3IudWkucmVnaXN0cnkuZ2V0QWxsKCksIGJ1dHRvbnMgPSBfYS5idXR0b25zLCBtZW51SXRlbXMgPSBfYS5tZW51SXRlbXMsIGNvbnRleHRUb29sYmFycyA9IF9hLmNvbnRleHRUb29sYmFycywgc2lkZWJhcnMgPSBfYS5zaWRlYmFycztcbiAgICAgICAgdmFyIHRvb2xiYXJPcHQgPSBnZXRNdWx0aXBsZVRvb2xiYXJzU2V0dGluZyhlZGl0b3IpO1xuICAgICAgICB2YXIgcmF3VWlDb25maWcgPSB7XG4gICAgICAgICAgbWVudUl0ZW1zOiBtZW51SXRlbXMsXG4gICAgICAgICAgbWVudXM6IGdldE1lbnVzKGVkaXRvciksXG4gICAgICAgICAgbWVudWJhcjogZ2V0TWVudWJhcihlZGl0b3IpLFxuICAgICAgICAgIHRvb2xiYXI6IHRvb2xiYXJPcHQuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0VG9vbGJhcihlZGl0b3IpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGFsbG93VG9vbGJhckdyb3VwczogdG9vbGJhck1vZGUgPT09IFRvb2xiYXJNb2RlLmZsb2F0aW5nLFxuICAgICAgICAgIGJ1dHRvbnM6IGJ1dHRvbnMsXG4gICAgICAgICAgc2lkZWJhcjogc2lkZWJhcnNcbiAgICAgICAgfTtcbiAgICAgICAgcmVnaXN0ZXIkNChlZGl0b3IsIGNvbnRleHRUb29sYmFycywgc2luaywgeyBiYWNrc3RhZ2U6IGJhY2tzdGFnZSB9KTtcbiAgICAgICAgc2V0dXAkYShlZGl0b3IsIHNpbmspO1xuICAgICAgICB2YXIgZWxtID0gZWRpdG9yLmdldEVsZW1lbnQoKTtcbiAgICAgICAgdmFyIGhlaWdodCA9IHNldEVkaXRvclNpemUoKTtcbiAgICAgICAgdmFyIHVpQ29tcG9uZW50cyA9IHtcbiAgICAgICAgICBtb3RoZXJzaGlwOiBtb3RoZXJzaGlwLFxuICAgICAgICAgIHVpTW90aGVyc2hpcDogdWlNb3RoZXJzaGlwLFxuICAgICAgICAgIG91dGVyQ29udGFpbmVyOiBvdXRlckNvbnRhaW5lclxuICAgICAgICB9O1xuICAgICAgICB2YXIgYXJncyA9IHtcbiAgICAgICAgICB0YXJnZXROb2RlOiBlbG0sXG4gICAgICAgICAgaGVpZ2h0OiBoZWlnaHRcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG1vZGUucmVuZGVyKGVkaXRvciwgdWlDb21wb25lbnRzLCByYXdVaUNvbmZpZywgYmFja3N0YWdlLCBhcmdzKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtb3RoZXJzaGlwOiBtb3RoZXJzaGlwLFxuICAgICAgICB1aU1vdGhlcnNoaXA6IHVpTW90aGVyc2hpcCxcbiAgICAgICAgYmFja3N0YWdlOiBiYWNrc3RhZ2UsXG4gICAgICAgIHJlbmRlclVJOiByZW5kZXJVSSxcbiAgICAgICAgZ2V0VWk6IGdldFVpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZGVzY3JpYmVkQnkgPSBmdW5jdGlvbiAoZGVzY3JpYmVkRWxlbWVudCwgZGVzY3JpYmVFbGVtZW50KSB7XG4gICAgICB2YXIgZGVzY3JpYmVJZCA9IE9wdGlvbmFsLmZyb20oZ2V0JDMoZGVzY3JpYmVkRWxlbWVudCwgJ2lkJykpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZSQxKCdkaWFsb2ctZGVzY3JpYmUnKTtcbiAgICAgICAgc2V0JDEoZGVzY3JpYmVFbGVtZW50LCAnaWQnLCBpZCk7XG4gICAgICAgIHJldHVybiBpZDtcbiAgICAgIH0sIGlkZW50aXR5KTtcbiAgICAgIHNldCQxKGRlc2NyaWJlZEVsZW1lbnQsICdhcmlhLWRlc2NyaWJlZGJ5JywgZGVzY3JpYmVJZCk7XG4gICAgfTtcblxuICAgIHZhciBsYWJlbGxlZEJ5ID0gZnVuY3Rpb24gKGxhYmVsbGVkRWxlbWVudCwgbGFiZWxFbGVtZW50KSB7XG4gICAgICB2YXIgbGFiZWxJZCA9IGdldE9wdChsYWJlbGxlZEVsZW1lbnQsICdpZCcpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaWQgPSBnZW5lcmF0ZSQxKCdkaWFsb2ctbGFiZWwnKTtcbiAgICAgICAgc2V0JDEobGFiZWxFbGVtZW50LCAnaWQnLCBpZCk7XG4gICAgICAgIHJldHVybiBpZDtcbiAgICAgIH0sIGlkZW50aXR5KTtcbiAgICAgIHNldCQxKGxhYmVsbGVkRWxlbWVudCwgJ2FyaWEtbGFiZWxsZWRieScsIGxhYmVsSWQpO1xuICAgIH07XG5cbiAgICB2YXIgc2NoZW1hJHggPSBjb25zdGFudChbXG4gICAgICBzdHJpY3QkMSgnbGF6eVNpbmsnKSxcbiAgICAgIG9wdGlvbignZHJhZ0Jsb2NrQ2xhc3MnKSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdnZXRCb3VuZHMnLCB3aW4pLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VzZVRhYnN0b3BBdCcsIGFsd2F5cyksXG4gICAgICBkZWZhdWx0ZWQkMSgnZXZlbnRPcmRlcicsIHt9KSxcbiAgICAgIGZpZWxkJDEoJ21vZGFsQmVoYXZpb3VycycsIFtLZXlpbmddKSxcbiAgICAgIG9uS2V5Ym9hcmRIYW5kbGVyKCdvbkV4ZWN1dGUnKSxcbiAgICAgIG9uU3RyaWN0S2V5Ym9hcmRIYW5kbGVyKCdvbkVzY2FwZScpXG4gICAgXSk7XG4gICAgdmFyIGJhc2ljID0geyBza2V0Y2g6IGlkZW50aXR5IH07XG4gICAgdmFyIHBhcnRzJGYgPSBjb25zdGFudChbXG4gICAgICBvcHRpb25hbCh7XG4gICAgICAgIG5hbWU6ICdkcmFnaGFuZGxlJyxcbiAgICAgICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiAoZGV0YWlsLCBzcGVjKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtEcmFnZ2luZy5jb25maWcoe1xuICAgICAgICAgICAgICAgIG1vZGU6ICdtb3VzZScsXG4gICAgICAgICAgICAgICAgZ2V0VGFyZ2V0OiBmdW5jdGlvbiAoaGFuZGxlKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gYW5jZXN0b3IkMihoYW5kbGUsICdbcm9sZT1cImRpYWxvZ1wiXScpLmdldE9yKGhhbmRsZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBibG9ja2VyQ2xhc3M6IGRldGFpbC5kcmFnQmxvY2tDbGFzcy5nZXRPckRpZShuZXcgRXJyb3IoJ1RoZSBkcmFnIGJsb2NrZXIgY2xhc3Mgd2FzIG5vdCBzcGVjaWZpZWQgZm9yIGEgZGlhbG9nIHdpdGggYSBkcmFnIGhhbmRsZTogXFxuJyArIEpTT04uc3RyaW5naWZ5KHNwZWMsIG51bGwsIDIpKS5tZXNzYWdlKSxcbiAgICAgICAgICAgICAgICBnZXRCb3VuZHM6IGRldGFpbC5nZXREcmFnQm91bmRzXG4gICAgICAgICAgICAgIH0pXSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHJlcXVpcmVkKHtcbiAgICAgICAgc2NoZW1hOiBbc3RyaWN0JDEoJ2RvbScpXSxcbiAgICAgICAgbmFtZTogJ3RpdGxlJ1xuICAgICAgfSksXG4gICAgICByZXF1aXJlZCh7XG4gICAgICAgIGZhY3Rvcnk6IGJhc2ljLFxuICAgICAgICBzY2hlbWE6IFtzdHJpY3QkMSgnZG9tJyldLFxuICAgICAgICBuYW1lOiAnY2xvc2UnXG4gICAgICB9KSxcbiAgICAgIHJlcXVpcmVkKHtcbiAgICAgICAgZmFjdG9yeTogYmFzaWMsXG4gICAgICAgIHNjaGVtYTogW3N0cmljdCQxKCdkb20nKV0sXG4gICAgICAgIG5hbWU6ICdib2R5J1xuICAgICAgfSksXG4gICAgICBvcHRpb25hbCh7XG4gICAgICAgIGZhY3Rvcnk6IGJhc2ljLFxuICAgICAgICBzY2hlbWE6IFtzdHJpY3QkMSgnZG9tJyldLFxuICAgICAgICBuYW1lOiAnZm9vdGVyJ1xuICAgICAgfSksXG4gICAgICBleHRlcm5hbCQxKHtcbiAgICAgICAgZmFjdG9yeToge1xuICAgICAgICAgIHNrZXRjaDogZnVuY3Rpb24gKHNwZWMsIGRldGFpbCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBzcGVjKSwge1xuICAgICAgICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgICAgICAgIGNvbXBvbmVudHM6IGRldGFpbC5jb21wb25lbnRzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNjaGVtYTogW1xuICAgICAgICAgIGRlZmF1bHRlZCQxKCdkb20nLCB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgc3R5bGVzOiB7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICBsZWZ0OiAnMHB4JyxcbiAgICAgICAgICAgICAgdG9wOiAnMHB4JyxcbiAgICAgICAgICAgICAgcmlnaHQ6ICcwcHgnLFxuICAgICAgICAgICAgICBib3R0b206ICcwcHgnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgZGVmYXVsdGVkJDEoJ2NvbXBvbmVudHMnLCBbXSlcbiAgICAgICAgXSxcbiAgICAgICAgbmFtZTogJ2Jsb2NrZXInXG4gICAgICB9KVxuICAgIF0pO1xuXG4gICAgdmFyIGJsb2NrID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29uZmlnLCBzdGF0ZSwgZ2V0QnVzeVNwZWMpIHtcbiAgICAgIHNldCQxKGNvbXBvbmVudC5lbGVtZW50LCAnYXJpYS1idXN5JywgdHJ1ZSk7XG4gICAgICB2YXIgcm9vdCA9IGNvbmZpZy5nZXRSb290KGNvbXBvbmVudCkuZ2V0T3IoY29tcG9uZW50KTtcbiAgICAgIHZhciBibG9ja2VyQmVoYXZpb3VycyA9IGRlcml2ZSQxKFtcbiAgICAgICAgS2V5aW5nLmNvbmZpZyh7XG4gICAgICAgICAgbW9kZTogJ3NwZWNpYWwnLFxuICAgICAgICAgIG9uVGFiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uU2hpZnRUYWI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSlcbiAgICAgIF0pO1xuICAgICAgdmFyIGJsb2NrU3BlYyA9IGdldEJ1c3lTcGVjKHJvb3QsIGJsb2NrZXJCZWhhdmlvdXJzKTtcbiAgICAgIHZhciBibG9ja2VyID0gcm9vdC5nZXRTeXN0ZW0oKS5idWlsZChibG9ja1NwZWMpO1xuICAgICAgUmVwbGFjaW5nLmFwcGVuZChyb290LCBwcmVtYWRlJDEoYmxvY2tlcikpO1xuICAgICAgaWYgKGJsb2NrZXIuaGFzQ29uZmlndXJlZChLZXlpbmcpKSB7XG4gICAgICAgIEtleWluZy5mb2N1c0luKGJsb2NrZXIpO1xuICAgICAgfVxuICAgICAgaWYgKCFzdGF0ZS5pc0Jsb2NrZWQoKSkge1xuICAgICAgICBjb25maWcub25CbG9jayhjb21wb25lbnQpO1xuICAgICAgfVxuICAgICAgc3RhdGUuYmxvY2tXaXRoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFJlcGxhY2luZy5yZW1vdmUocm9vdCwgYmxvY2tlcik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB1bmJsb2NrID0gZnVuY3Rpb24gKGNvbXBvbmVudCwgY29uZmlnLCBzdGF0ZSkge1xuICAgICAgcmVtb3ZlJDEoY29tcG9uZW50LmVsZW1lbnQsICdhcmlhLWJ1c3knKTtcbiAgICAgIGlmIChzdGF0ZS5pc0Jsb2NrZWQoKSkge1xuICAgICAgICBjb25maWcub25VbmJsb2NrKGNvbXBvbmVudCk7XG4gICAgICB9XG4gICAgICBzdGF0ZS5jbGVhcigpO1xuICAgIH07XG5cbiAgICB2YXIgQmxvY2tpbmdBcGlzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuICAgICAgICBfX3Byb3RvX186IG51bGwsXG4gICAgICAgIGJsb2NrOiBibG9jayxcbiAgICAgICAgdW5ibG9jazogdW5ibG9ja1xuICAgIH0pO1xuXG4gICAgdmFyIEJsb2NraW5nU2NoZW1hID0gW1xuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ2dldFJvb3QnLCBPcHRpb25hbC5ub25lKSxcbiAgICAgIG9uSGFuZGxlcignb25CbG9jaycpLFxuICAgICAgb25IYW5kbGVyKCdvblVuYmxvY2snKVxuICAgIF07XG5cbiAgICB2YXIgaW5pdCRmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGJsb2NrZXIgPSBkZXN0cm95YWJsZSgpO1xuICAgICAgdmFyIGJsb2NrV2l0aCA9IGZ1bmN0aW9uIChkZXN0cm95KSB7XG4gICAgICAgIGJsb2NrZXIuc2V0KHsgZGVzdHJveTogZGVzdHJveSB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbnUkNSh7XG4gICAgICAgIHJlYWRTdGF0ZTogYmxvY2tlci5pc1NldCxcbiAgICAgICAgYmxvY2tXaXRoOiBibG9ja1dpdGgsXG4gICAgICAgIGNsZWFyOiBibG9ja2VyLmNsZWFyLFxuICAgICAgICBpc0Jsb2NrZWQ6IGJsb2NrZXIuaXNTZXRcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgQmxvY2tpbmdTdGF0ZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICAgICAgX19wcm90b19fOiBudWxsLFxuICAgICAgICBpbml0OiBpbml0JGZcbiAgICB9KTtcblxuICAgIHZhciBCbG9ja2luZyA9IGNyZWF0ZSQxKHtcbiAgICAgIGZpZWxkczogQmxvY2tpbmdTY2hlbWEsXG4gICAgICBuYW1lOiAnYmxvY2tpbmcnLFxuICAgICAgYXBpczogQmxvY2tpbmdBcGlzLFxuICAgICAgc3RhdGU6IEJsb2NraW5nU3RhdGVcbiAgICB9KTtcblxuICAgIHZhciBmYWN0b3J5JGkgPSBmdW5jdGlvbiAoZGV0YWlsLCBjb21wb25lbnRzLCBzcGVjLCBleHRlcm5hbHMpIHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHZhciBkaWFsb2dDb21wID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIHNob3dEaWFsb2cgPSBmdW5jdGlvbiAoZGlhbG9nKSB7XG4gICAgICAgIGRpYWxvZ0NvbXAuc2V0KE9wdGlvbmFsLnNvbWUoZGlhbG9nKSk7XG4gICAgICAgIHZhciBzaW5rID0gZGV0YWlsLmxhenlTaW5rKGRpYWxvZykuZ2V0T3JEaWUoKTtcbiAgICAgICAgdmFyIGV4dGVybmFsQmxvY2tlciA9IGV4dGVybmFscy5ibG9ja2VyKCk7XG4gICAgICAgIHZhciBibG9ja2VyID0gc2luay5nZXRTeXN0ZW0oKS5idWlsZChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZXh0ZXJuYWxCbG9ja2VyKSwge1xuICAgICAgICAgIGNvbXBvbmVudHM6IGV4dGVybmFsQmxvY2tlci5jb21wb25lbnRzLmNvbmNhdChbcHJlbWFkZSQxKGRpYWxvZyldKSxcbiAgICAgICAgICBiZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICBGb2N1c2luZy5jb25maWcoe30pLFxuICAgICAgICAgICAgY29uZmlnKCdkaWFsb2ctYmxvY2tlci1ldmVudHMnLCBbcnVuT25Tb3VyY2UoZm9jdXNpbigpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgS2V5aW5nLmZvY3VzSW4oZGlhbG9nKTtcbiAgICAgICAgICAgICAgfSldKVxuICAgICAgICAgIF0pXG4gICAgICAgIH0pKTtcbiAgICAgICAgYXR0YWNoJDEoc2luaywgYmxvY2tlcik7XG4gICAgICAgIEtleWluZy5mb2N1c0luKGRpYWxvZyk7XG4gICAgICB9O1xuICAgICAgdmFyIGhpZGVEaWFsb2cgPSBmdW5jdGlvbiAoZGlhbG9nKSB7XG4gICAgICAgIGRpYWxvZ0NvbXAuc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgIHBhcmVudChkaWFsb2cuZWxlbWVudCkuZWFjaChmdW5jdGlvbiAoYmxvY2tlckRvbSkge1xuICAgICAgICAgIGRpYWxvZy5nZXRTeXN0ZW0oKS5nZXRCeURvbShibG9ja2VyRG9tKS5lYWNoKGZ1bmN0aW9uIChibG9ja2VyKSB7XG4gICAgICAgICAgICBkZXRhY2goYmxvY2tlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXREaWFsb2dCb2R5ID0gZnVuY3Rpb24gKGRpYWxvZykge1xuICAgICAgICByZXR1cm4gZ2V0UGFydE9yRGllKGRpYWxvZywgZGV0YWlsLCAnYm9keScpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXREaWFsb2dGb290ZXIgPSBmdW5jdGlvbiAoZGlhbG9nKSB7XG4gICAgICAgIHJldHVybiBnZXRQYXJ0T3JEaWUoZGlhbG9nLCBkZXRhaWwsICdmb290ZXInKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0QnVzeSA9IGZ1bmN0aW9uIChkaWFsb2csIGdldEJ1c3lTcGVjKSB7XG4gICAgICAgIEJsb2NraW5nLmJsb2NrKGRpYWxvZywgZ2V0QnVzeVNwZWMpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXRJZGxlID0gZnVuY3Rpb24gKGRpYWxvZykge1xuICAgICAgICBCbG9ja2luZy51bmJsb2NrKGRpYWxvZyk7XG4gICAgICB9O1xuICAgICAgdmFyIG1vZGFsRXZlbnRzSWQgPSBnZW5lcmF0ZSQxKCdtb2RhbC1ldmVudHMnKTtcbiAgICAgIHZhciBldmVudE9yZGVyID0gX19hc3NpZ24oX19hc3NpZ24oe30sIGRldGFpbC5ldmVudE9yZGVyKSwgKF9hID0ge30sIF9hW2F0dGFjaGVkVG9Eb20oKV0gPSBbbW9kYWxFdmVudHNJZF0uY29uY2F0KGRldGFpbC5ldmVudE9yZGVyWydhbGxveS5zeXN0ZW0uYXR0YWNoZWQnXSB8fCBbXSksIF9hKSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcbiAgICAgICAgYXBpczoge1xuICAgICAgICAgIHNob3c6IHNob3dEaWFsb2csXG4gICAgICAgICAgaGlkZTogaGlkZURpYWxvZyxcbiAgICAgICAgICBnZXRCb2R5OiBnZXREaWFsb2dCb2R5LFxuICAgICAgICAgIGdldEZvb3RlcjogZ2V0RGlhbG9nRm9vdGVyLFxuICAgICAgICAgIHNldElkbGU6IHNldElkbGUsXG4gICAgICAgICAgc2V0QnVzeTogc2V0QnVzeVxuICAgICAgICB9LFxuICAgICAgICBldmVudE9yZGVyOiBldmVudE9yZGVyLFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IHtcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAncm9sZSc6ICdkaWFsb2cnLFxuICAgICAgICAgICAgJ2FyaWEtbW9kYWwnOiAndHJ1ZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJlaGF2aW91cnM6IGF1Z21lbnQoZGV0YWlsLm1vZGFsQmVoYXZpb3VycywgW1xuICAgICAgICAgIFJlcGxhY2luZy5jb25maWcoe30pLFxuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ2N5Y2xpYycsXG4gICAgICAgICAgICBvbkVudGVyOiBkZXRhaWwub25FeGVjdXRlLFxuICAgICAgICAgICAgb25Fc2NhcGU6IGRldGFpbC5vbkVzY2FwZSxcbiAgICAgICAgICAgIHVzZVRhYnN0b3BBdDogZGV0YWlsLnVzZVRhYnN0b3BBdFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIEJsb2NraW5nLmNvbmZpZyh7IGdldFJvb3Q6IGRpYWxvZ0NvbXAuZ2V0IH0pLFxuICAgICAgICAgIGNvbmZpZyhtb2RhbEV2ZW50c0lkLCBbcnVuT25BdHRhY2hlZChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgICBsYWJlbGxlZEJ5KGMuZWxlbWVudCwgZ2V0UGFydE9yRGllKGMsIGRldGFpbCwgJ3RpdGxlJykuZWxlbWVudCk7XG4gICAgICAgICAgICAgIGRlc2NyaWJlZEJ5KGMuZWxlbWVudCwgZ2V0UGFydE9yRGllKGMsIGRldGFpbCwgJ2JvZHknKS5lbGVtZW50KTtcbiAgICAgICAgICAgIH0pXSlcbiAgICAgICAgXSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgTW9kYWxEaWFsb2cgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnTW9kYWxEaWFsb2cnLFxuICAgICAgY29uZmlnRmllbGRzOiBzY2hlbWEkeCgpLFxuICAgICAgcGFydEZpZWxkczogcGFydHMkZigpLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSRpLFxuICAgICAgYXBpczoge1xuICAgICAgICBzaG93OiBmdW5jdGlvbiAoYXBpcywgZGlhbG9nKSB7XG4gICAgICAgICAgYXBpcy5zaG93KGRpYWxvZyk7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uIChhcGlzLCBkaWFsb2cpIHtcbiAgICAgICAgICBhcGlzLmhpZGUoZGlhbG9nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Qm9keTogZnVuY3Rpb24gKGFwaXMsIGRpYWxvZykge1xuICAgICAgICAgIHJldHVybiBhcGlzLmdldEJvZHkoZGlhbG9nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Rm9vdGVyOiBmdW5jdGlvbiAoYXBpcywgZGlhbG9nKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaXMuZ2V0Rm9vdGVyKGRpYWxvZyk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldEJ1c3k6IGZ1bmN0aW9uIChhcGlzLCBkaWFsb2csIGdldEJ1c3lTcGVjKSB7XG4gICAgICAgICAgYXBpcy5zZXRCdXN5KGRpYWxvZywgZ2V0QnVzeVNwZWMpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRJZGxlOiBmdW5jdGlvbiAoYXBpcywgZGlhbG9nKSB7XG4gICAgICAgICAgYXBpcy5zZXRJZGxlKGRpYWxvZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBkaWFsb2dUb2dnbGVNZW51SXRlbVNjaGVtYSA9IG9iak9mKFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgc3RyaWN0U3RyaW5nKCduYW1lJylcbiAgICBdLmNvbmNhdChjb21tb25NZW51SXRlbUZpZWxkcykpO1xuICAgIHZhciBkaWFsb2dUb2dnbGVNZW51SXRlbURhdGFQcm9jZXNzb3IgPSBib29sZWFuO1xuXG4gICAgdmFyIGJhc2VGb290ZXJCdXR0b25GaWVsZHMgPSBbXG4gICAgICBmaWVsZCgnbmFtZScsICduYW1lJywgZGVmYXVsdGVkVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2VuZXJhdGUkMSgnYnV0dG9uLW5hbWUnKTtcbiAgICAgIH0pLCBzdHJpbmcpLFxuICAgICAgb3B0aW9uU3RyaW5nKCdpY29uJyksXG4gICAgICBkZWZhdWx0ZWRTdHJpbmdFbnVtKCdhbGlnbicsICdlbmQnLCBbXG4gICAgICAgICdzdGFydCcsXG4gICAgICAgICdlbmQnXG4gICAgICBdKSxcbiAgICAgIGRlZmF1bHRlZEJvb2xlYW4oJ3ByaW1hcnknLCBmYWxzZSksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdkaXNhYmxlZCcsIGZhbHNlKVxuICAgIF07XG4gICAgdmFyIGRpYWxvZ0Zvb3RlckJ1dHRvbkZpZWxkcyA9IF9fc3ByZWFkQXJyYXlzKGJhc2VGb290ZXJCdXR0b25GaWVsZHMsIFtzdHJpY3RTdHJpbmcoJ3RleHQnKV0pO1xuICAgIHZhciBub3JtYWxGb290ZXJCdXR0b25GaWVsZHMgPSBfX3NwcmVhZEFycmF5cyhbc3RyaWN0U3RyaW5nRW51bSgndHlwZScsIFtcbiAgICAgICAgJ3N1Ym1pdCcsXG4gICAgICAgICdjYW5jZWwnLFxuICAgICAgICAnY3VzdG9tJ1xuICAgICAgXSldLCBkaWFsb2dGb290ZXJCdXR0b25GaWVsZHMpO1xuICAgIHZhciBtZW51Rm9vdGVyQnV0dG9uRmllbGRzID0gX19zcHJlYWRBcnJheXMoW1xuICAgICAgc3RyaWN0U3RyaW5nRW51bSgndHlwZScsIFsnbWVudSddKSxcbiAgICAgIG9wdGlvblN0cmluZygndGV4dCcpLFxuICAgICAgb3B0aW9uU3RyaW5nKCd0b29sdGlwJyksXG4gICAgICBvcHRpb25TdHJpbmcoJ2ljb24nKSxcbiAgICAgIHN0cmljdEFycmF5T2YoJ2l0ZW1zJywgZGlhbG9nVG9nZ2xlTWVudUl0ZW1TY2hlbWEpXG4gICAgXSwgYmFzZUZvb3RlckJ1dHRvbkZpZWxkcyk7XG4gICAgdmFyIGRpYWxvZ0Zvb3RlckJ1dHRvblNjaGVtYSA9IGNob29zZSQxKCd0eXBlJywge1xuICAgICAgc3VibWl0OiBub3JtYWxGb290ZXJCdXR0b25GaWVsZHMsXG4gICAgICBjYW5jZWw6IG5vcm1hbEZvb3RlckJ1dHRvbkZpZWxkcyxcbiAgICAgIGN1c3RvbTogbm9ybWFsRm9vdGVyQnV0dG9uRmllbGRzLFxuICAgICAgbWVudTogbWVudUZvb3RlckJ1dHRvbkZpZWxkc1xuICAgIH0pO1xuXG4gICAgdmFyIGFsZXJ0QmFubmVyRmllbGRzID0gW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0eXBlJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ3RleHQnKSxcbiAgICAgIHN0cmljdFN0cmluZ0VudW0oJ2xldmVsJywgW1xuICAgICAgICAnaW5mbycsXG4gICAgICAgICd3YXJuJyxcbiAgICAgICAgJ2Vycm9yJyxcbiAgICAgICAgJ3N1Y2Nlc3MnXG4gICAgICBdKSxcbiAgICAgIHN0cmljdFN0cmluZygnaWNvbicpLFxuICAgICAgZGVmYXVsdGVkJDEoJ3VybCcsICcnKVxuICAgIF07XG4gICAgdmFyIGFsZXJ0QmFubmVyU2NoZW1hID0gb2JqT2YoYWxlcnRCYW5uZXJGaWVsZHMpO1xuXG4gICAgdmFyIGNyZWF0ZUJhckZpZWxkcyA9IGZ1bmN0aW9uIChpdGVtc0ZpZWxkKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgICAgaXRlbXNGaWVsZFxuICAgICAgXTtcbiAgICB9O1xuXG4gICAgdmFyIGJ1dHRvbkZpZWxkcyA9IFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgc3RyaWN0U3RyaW5nKCd0ZXh0JyksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdkaXNhYmxlZCcsIGZhbHNlKSxcbiAgICAgIGRlZmF1bHRlZEJvb2xlYW4oJ3ByaW1hcnknLCBmYWxzZSksXG4gICAgICBmaWVsZCgnbmFtZScsICduYW1lJywgZGVmYXVsdGVkVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2VuZXJhdGUkMSgnYnV0dG9uLW5hbWUnKTtcbiAgICAgIH0pLCBzdHJpbmcpLFxuICAgICAgb3B0aW9uU3RyaW5nKCdpY29uJyksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdib3JkZXJsZXNzJywgZmFsc2UpXG4gICAgXTtcbiAgICB2YXIgYnV0dG9uU2NoZW1hID0gb2JqT2YoYnV0dG9uRmllbGRzKTtcblxuICAgIHZhciBjaGVja2JveEZpZWxkcyA9IFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgc3RyaWN0U3RyaW5nKCduYW1lJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ2xhYmVsJyksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdkaXNhYmxlZCcsIGZhbHNlKVxuICAgIF07XG4gICAgdmFyIGNoZWNrYm94U2NoZW1hID0gb2JqT2YoY2hlY2tib3hGaWVsZHMpO1xuICAgIHZhciBjaGVja2JveERhdGFQcm9jZXNzb3IgPSBib29sZWFuO1xuXG4gICAgdmFyIGZvcm1Db21wb25lbnRGaWVsZHMgPSBbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIHN0cmljdFN0cmluZygnbmFtZScpXG4gICAgXTtcbiAgICB2YXIgZm9ybUNvbXBvbmVudFdpdGhMYWJlbEZpZWxkcyA9IGZvcm1Db21wb25lbnRGaWVsZHMuY29uY2F0KFtvcHRpb25TdHJpbmcoJ2xhYmVsJyldKTtcblxuICAgIHZhciBjb2xsZWN0aW9uRmllbGRzID0gZm9ybUNvbXBvbmVudFdpdGhMYWJlbEZpZWxkcy5jb25jYXQoW2RlZmF1bHRlZCQxKCdjb2x1bW5zJywgJ2F1dG8nKV0pO1xuICAgIHZhciBjb2xsZWN0aW9uU2NoZW1hID0gb2JqT2YoY29sbGVjdGlvbkZpZWxkcyk7XG4gICAgdmFyIGNvbGxlY3Rpb25EYXRhUHJvY2Vzc29yID0gYXJyT2ZPYmokMShbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3ZhbHVlJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ3RleHQnKSxcbiAgICAgIHN0cmljdFN0cmluZygnaWNvbicpXG4gICAgXSk7XG5cbiAgICB2YXIgY29sb3JJbnB1dEZpZWxkcyA9IGZvcm1Db21wb25lbnRXaXRoTGFiZWxGaWVsZHM7XG4gICAgdmFyIGNvbG9ySW5wdXRTY2hlbWEgPSBvYmpPZihjb2xvcklucHV0RmllbGRzKTtcbiAgICB2YXIgY29sb3JJbnB1dERhdGFQcm9jZXNzb3IgPSBzdHJpbmc7XG5cbiAgICB2YXIgY29sb3JQaWNrZXJGaWVsZHMgPSBmb3JtQ29tcG9uZW50V2l0aExhYmVsRmllbGRzO1xuICAgIHZhciBjb2xvclBpY2tlclNjaGVtYSA9IG9iak9mKGNvbG9yUGlja2VyRmllbGRzKTtcbiAgICB2YXIgY29sb3JQaWNrZXJEYXRhUHJvY2Vzc29yID0gc3RyaW5nO1xuXG4gICAgdmFyIGN1c3RvbUVkaXRvckZpZWxkcyA9IGZvcm1Db21wb25lbnRGaWVsZHMuY29uY2F0KFtcbiAgICAgIGRlZmF1bHRlZFN0cmluZygndGFnJywgJ3RleHRhcmVhJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ3NjcmlwdElkJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ3NjcmlwdFVybCcpLFxuICAgICAgZGVmYXVsdGVkUG9zdE1zZygnc2V0dGluZ3MnLCB1bmRlZmluZWQpXG4gICAgXSk7XG4gICAgdmFyIGN1c3RvbUVkaXRvckZpZWxkc09sZCA9IGZvcm1Db21wb25lbnRGaWVsZHMuY29uY2F0KFtcbiAgICAgIGRlZmF1bHRlZFN0cmluZygndGFnJywgJ3RleHRhcmVhJyksXG4gICAgICBzdHJpY3RGdW5jdGlvbignaW5pdCcpXG4gICAgXSk7XG4gICAgdmFyIGN1c3RvbUVkaXRvclNjaGVtYSA9IHZhbHVlT2YoZnVuY3Rpb24gKHYpIHtcbiAgICAgIHJldHVybiBhc1JhdygnY3VzdG9tZWRpdG9yLm9sZCcsIG9iak9mT25seShjdXN0b21FZGl0b3JGaWVsZHNPbGQpLCB2KS5vclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGFzUmF3KCdjdXN0b21lZGl0b3IubmV3Jywgb2JqT2ZPbmx5KGN1c3RvbUVkaXRvckZpZWxkcyksIHYpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgdmFyIGN1c3RvbUVkaXRvckRhdGFQcm9jZXNzb3IgPSBzdHJpbmc7XG5cbiAgICB2YXIgZHJvcFpvbmVGaWVsZHMgPSBmb3JtQ29tcG9uZW50V2l0aExhYmVsRmllbGRzO1xuICAgIHZhciBkcm9wWm9uZVNjaGVtYSA9IG9iak9mKGRyb3Bab25lRmllbGRzKTtcbiAgICB2YXIgZHJvcFpvbmVEYXRhUHJvY2Vzc29yID0gYXJyT2ZWYWwoKTtcblxuICAgIHZhciBjcmVhdGVHcmlkRmllbGRzID0gZnVuY3Rpb24gKGl0ZW1zRmllbGQpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgICBzdHJpY3ROdW1iZXIoJ2NvbHVtbnMnKSxcbiAgICAgICAgaXRlbXNGaWVsZFxuICAgICAgXTtcbiAgICB9O1xuXG4gICAgdmFyIGh0bWxQYW5lbEZpZWxkcyA9IFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgc3RyaWN0U3RyaW5nKCdodG1sJyksXG4gICAgICBkZWZhdWx0ZWRTdHJpbmdFbnVtKCdwcmVzZXRzJywgJ3ByZXNlbnRhdGlvbicsIFtcbiAgICAgICAgJ3ByZXNlbnRhdGlvbicsXG4gICAgICAgICdkb2N1bWVudCdcbiAgICAgIF0pXG4gICAgXTtcbiAgICB2YXIgaHRtbFBhbmVsU2NoZW1hID0gb2JqT2YoaHRtbFBhbmVsRmllbGRzKTtcblxuICAgIHZhciBpZnJhbWVGaWVsZHMgPSBmb3JtQ29tcG9uZW50V2l0aExhYmVsRmllbGRzLmNvbmNhdChbZGVmYXVsdGVkQm9vbGVhbignc2FuZGJveGVkJywgdHJ1ZSldKTtcbiAgICB2YXIgaWZyYW1lU2NoZW1hID0gb2JqT2YoaWZyYW1lRmllbGRzKTtcbiAgICB2YXIgaWZyYW1lRGF0YVByb2Nlc3NvciA9IHN0cmluZztcblxuICAgIHZhciBpbWFnZVRvb2xzRmllbGRzID0gZm9ybUNvbXBvbmVudFdpdGhMYWJlbEZpZWxkcy5jb25jYXQoW3N0cmljdE9mKCdjdXJyZW50U3RhdGUnLCBvYmpPZihbXG4gICAgICAgIHN0cmljdCQxKCdibG9iJyksXG4gICAgICAgIHN0cmljdFN0cmluZygndXJsJylcbiAgICAgIF0pKV0pO1xuICAgIHZhciBpbWFnZVRvb2xzU2NoZW1hID0gb2JqT2YoaW1hZ2VUb29sc0ZpZWxkcyk7XG5cbiAgICB2YXIgaW5wdXRGaWVsZHMgPSBmb3JtQ29tcG9uZW50V2l0aExhYmVsRmllbGRzLmNvbmNhdChbXG4gICAgICBvcHRpb25TdHJpbmcoJ2lucHV0TW9kZScpLFxuICAgICAgb3B0aW9uU3RyaW5nKCdwbGFjZWhvbGRlcicpLFxuICAgICAgZGVmYXVsdGVkQm9vbGVhbignbWF4aW1pemVkJywgZmFsc2UpLFxuICAgICAgZGVmYXVsdGVkQm9vbGVhbignZGlzYWJsZWQnLCBmYWxzZSlcbiAgICBdKTtcbiAgICB2YXIgaW5wdXRTY2hlbWEgPSBvYmpPZihpbnB1dEZpZWxkcyk7XG4gICAgdmFyIGlucHV0RGF0YVByb2Nlc3NvciA9IHN0cmluZztcblxuICAgIHZhciBjcmVhdGVMYWJlbEZpZWxkcyA9IGZ1bmN0aW9uIChpdGVtc0ZpZWxkKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgICAgc3RyaWN0U3RyaW5nKCdsYWJlbCcpLFxuICAgICAgICBpdGVtc0ZpZWxkXG4gICAgICBdO1xuICAgIH07XG5cbiAgICB2YXIgbGlzdEJveFNpbmdsZUl0ZW1GaWVsZHMgPSBbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3RleHQnKSxcbiAgICAgIHN0cmljdFN0cmluZygndmFsdWUnKVxuICAgIF07XG4gICAgdmFyIGxpc3RCb3hOZXN0ZWRJdGVtRmllbGRzID0gW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0ZXh0JyksXG4gICAgICBzdHJpY3RBcnJheU9mKCdpdGVtcycsIHRodW5rT2YoJ2l0ZW1zJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbGlzdEJveEl0ZW1TY2hlbWE7XG4gICAgICB9KSlcbiAgICBdO1xuICAgIHZhciBsaXN0Qm94SXRlbVNjaGVtYSA9IG9uZU9mKFtcbiAgICAgIG9iak9mKGxpc3RCb3hTaW5nbGVJdGVtRmllbGRzKSxcbiAgICAgIG9iak9mKGxpc3RCb3hOZXN0ZWRJdGVtRmllbGRzKVxuICAgIF0pO1xuICAgIHZhciBsaXN0Qm94RmllbGRzID0gZm9ybUNvbXBvbmVudFdpdGhMYWJlbEZpZWxkcy5jb25jYXQoW1xuICAgICAgc3RyaWN0QXJyYXlPZignaXRlbXMnLCBsaXN0Qm94SXRlbVNjaGVtYSksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdkaXNhYmxlZCcsIGZhbHNlKVxuICAgIF0pO1xuICAgIHZhciBsaXN0Qm94U2NoZW1hID0gb2JqT2YobGlzdEJveEZpZWxkcyk7XG4gICAgdmFyIGxpc3RCb3hEYXRhUHJvY2Vzc29yID0gc3RyaW5nO1xuXG4gICAgdmFyIHNlbGVjdEJveEZpZWxkcyA9IGZvcm1Db21wb25lbnRXaXRoTGFiZWxGaWVsZHMuY29uY2F0KFtcbiAgICAgIHN0cmljdEFycmF5T2ZPYmooJ2l0ZW1zJywgW1xuICAgICAgICBzdHJpY3RTdHJpbmcoJ3RleHQnKSxcbiAgICAgICAgc3RyaWN0U3RyaW5nKCd2YWx1ZScpXG4gICAgICBdKSxcbiAgICAgIGRlZmF1bHRlZE51bWJlcignc2l6ZScsIDEpLFxuICAgICAgZGVmYXVsdGVkQm9vbGVhbignZGlzYWJsZWQnLCBmYWxzZSlcbiAgICBdKTtcbiAgICB2YXIgc2VsZWN0Qm94U2NoZW1hID0gb2JqT2Yoc2VsZWN0Qm94RmllbGRzKTtcbiAgICB2YXIgc2VsZWN0Qm94RGF0YVByb2Nlc3NvciA9IHN0cmluZztcblxuICAgIHZhciBzaXplSW5wdXRGaWVsZHMgPSBmb3JtQ29tcG9uZW50V2l0aExhYmVsRmllbGRzLmNvbmNhdChbXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdjb25zdHJhaW4nLCB0cnVlKSxcbiAgICAgIGRlZmF1bHRlZEJvb2xlYW4oJ2Rpc2FibGVkJywgZmFsc2UpXG4gICAgXSk7XG4gICAgdmFyIHNpemVJbnB1dFNjaGVtYSA9IG9iak9mKHNpemVJbnB1dEZpZWxkcyk7XG4gICAgdmFyIHNpemVJbnB1dERhdGFQcm9jZXNzb3IgPSBvYmpPZihbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3dpZHRoJyksXG4gICAgICBzdHJpY3RTdHJpbmcoJ2hlaWdodCcpXG4gICAgXSk7XG5cbiAgICB2YXIgdGFibGVGaWVsZHMgPSBbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIHN0cmljdEFycmF5T2YoJ2hlYWRlcicsIHN0cmluZyksXG4gICAgICBzdHJpY3RBcnJheU9mKCdjZWxscycsIGFyck9mKHN0cmluZykpXG4gICAgXTtcbiAgICB2YXIgdGFibGVTY2hlbWEgPSBvYmpPZih0YWJsZUZpZWxkcyk7XG5cbiAgICB2YXIgdGV4dEFyZWFGaWVsZHMgPSBmb3JtQ29tcG9uZW50V2l0aExhYmVsRmllbGRzLmNvbmNhdChbXG4gICAgICBvcHRpb25TdHJpbmcoJ3BsYWNlaG9sZGVyJyksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdtYXhpbWl6ZWQnLCBmYWxzZSksXG4gICAgICBkZWZhdWx0ZWRCb29sZWFuKCdkaXNhYmxlZCcsIGZhbHNlKVxuICAgIF0pO1xuICAgIHZhciB0ZXh0QXJlYVNjaGVtYSA9IG9iak9mKHRleHRBcmVhRmllbGRzKTtcbiAgICB2YXIgdGV4dEFyZWFEYXRhUHJvY2Vzc29yID0gc3RyaW5nO1xuXG4gICAgdmFyIHVybElucHV0RmllbGRzID0gZm9ybUNvbXBvbmVudFdpdGhMYWJlbEZpZWxkcy5jb25jYXQoW1xuICAgICAgZGVmYXVsdGVkU3RyaW5nRW51bSgnZmlsZXR5cGUnLCAnZmlsZScsIFtcbiAgICAgICAgJ2ltYWdlJyxcbiAgICAgICAgJ21lZGlhJyxcbiAgICAgICAgJ2ZpbGUnXG4gICAgICBdKSxcbiAgICAgIGRlZmF1bHRlZCQxKCdkaXNhYmxlZCcsIGZhbHNlKVxuICAgIF0pO1xuICAgIHZhciB1cmxJbnB1dFNjaGVtYSA9IG9iak9mKHVybElucHV0RmllbGRzKTtcbiAgICB2YXIgdXJsSW5wdXREYXRhUHJvY2Vzc29yID0gb2JqT2YoW1xuICAgICAgc3RyaWN0U3RyaW5nKCd2YWx1ZScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ21ldGEnLCB7fSlcbiAgICBdKTtcblxuICAgIHZhciBjcmVhdGVJdGVtc0ZpZWxkID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBmaWVsZCgnaXRlbXMnLCAnaXRlbXMnLCBzdHJpY3QoKSwgYXJyT2YodmFsdWVPZihmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gYXNSYXcoJ0NoZWNraW5nIGl0ZW0gb2YgJyArIG5hbWUsIGl0ZW1TY2hlbWEkMywgdikuZm9sZChmdW5jdGlvbiAoc0Vycikge1xuICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyb3IoZm9ybWF0RXJyb3Ioc0VycikpO1xuICAgICAgICB9LCBmdW5jdGlvbiAocGFzc1ZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIFJlc3VsdC52YWx1ZShwYXNzVmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pKSk7XG4gICAgfTtcbiAgICB2YXIgaXRlbVNjaGVtYSQzID0gdmFsdWVUaHVua09mKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBjaG9vc2VQcm9jZXNzb3IoJ3R5cGUnLCB7XG4gICAgICAgIGFsZXJ0YmFubmVyOiBhbGVydEJhbm5lclNjaGVtYSxcbiAgICAgICAgYmFyOiBvYmpPZihjcmVhdGVCYXJGaWVsZHMoY3JlYXRlSXRlbXNGaWVsZCgnYmFyJykpKSxcbiAgICAgICAgYnV0dG9uOiBidXR0b25TY2hlbWEsXG4gICAgICAgIGNoZWNrYm94OiBjaGVja2JveFNjaGVtYSxcbiAgICAgICAgY29sb3JpbnB1dDogY29sb3JJbnB1dFNjaGVtYSxcbiAgICAgICAgY29sb3JwaWNrZXI6IGNvbG9yUGlja2VyU2NoZW1hLFxuICAgICAgICBkcm9wem9uZTogZHJvcFpvbmVTY2hlbWEsXG4gICAgICAgIGdyaWQ6IG9iak9mKGNyZWF0ZUdyaWRGaWVsZHMoY3JlYXRlSXRlbXNGaWVsZCgnZ3JpZCcpKSksXG4gICAgICAgIGlmcmFtZTogaWZyYW1lU2NoZW1hLFxuICAgICAgICBpbnB1dDogaW5wdXRTY2hlbWEsXG4gICAgICAgIGxpc3Rib3g6IGxpc3RCb3hTY2hlbWEsXG4gICAgICAgIHNlbGVjdGJveDogc2VsZWN0Qm94U2NoZW1hLFxuICAgICAgICBzaXplaW5wdXQ6IHNpemVJbnB1dFNjaGVtYSxcbiAgICAgICAgdGV4dGFyZWE6IHRleHRBcmVhU2NoZW1hLFxuICAgICAgICB1cmxpbnB1dDogdXJsSW5wdXRTY2hlbWEsXG4gICAgICAgIGN1c3RvbWVkaXRvcjogY3VzdG9tRWRpdG9yU2NoZW1hLFxuICAgICAgICBodG1scGFuZWw6IGh0bWxQYW5lbFNjaGVtYSxcbiAgICAgICAgaW1hZ2V0b29sczogaW1hZ2VUb29sc1NjaGVtYSxcbiAgICAgICAgY29sbGVjdGlvbjogY29sbGVjdGlvblNjaGVtYSxcbiAgICAgICAgbGFiZWw6IG9iak9mKGNyZWF0ZUxhYmVsRmllbGRzKGNyZWF0ZUl0ZW1zRmllbGQoJ2xhYmVsJykpKSxcbiAgICAgICAgdGFibGU6IHRhYmxlU2NoZW1hLFxuICAgICAgICBwYW5lbDogcGFuZWxTY2hlbWFcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHZhciBwYW5lbEZpZWxkcyA9IFtcbiAgICAgIHN0cmljdFN0cmluZygndHlwZScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2NsYXNzZXMnLCBbXSksXG4gICAgICBzdHJpY3RBcnJheU9mKCdpdGVtcycsIGl0ZW1TY2hlbWEkMylcbiAgICBdO1xuICAgIHZhciBwYW5lbFNjaGVtYSA9IG9iak9mKHBhbmVsRmllbGRzKTtcblxuICAgIHZhciB0YWJGaWVsZHMgPSBbXG4gICAgICBmaWVsZCgnbmFtZScsICduYW1lJywgZGVmYXVsdGVkVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2VuZXJhdGUkMSgndGFiLW5hbWUnKTtcbiAgICAgIH0pLCBzdHJpbmcpLFxuICAgICAgc3RyaWN0U3RyaW5nKCd0aXRsZScpLFxuICAgICAgc3RyaWN0QXJyYXlPZignaXRlbXMnLCBpdGVtU2NoZW1hJDMpXG4gICAgXTtcbiAgICB2YXIgdGFiUGFuZWxGaWVsZHMgPSBbXG4gICAgICBzdHJpY3RTdHJpbmcoJ3R5cGUnKSxcbiAgICAgIHN0cmljdEFycmF5T2ZPYmooJ3RhYnMnLCB0YWJGaWVsZHMpXG4gICAgXTtcbiAgICB2YXIgdGFiUGFuZWxTY2hlbWEgPSBvYmpPZih0YWJQYW5lbEZpZWxkcyk7XG5cbiAgICB2YXIgZGlhbG9nQnV0dG9uRmllbGRzID0gZGlhbG9nRm9vdGVyQnV0dG9uRmllbGRzO1xuICAgIHZhciBkaWFsb2dCdXR0b25TY2hlbWEgPSBkaWFsb2dGb290ZXJCdXR0b25TY2hlbWE7XG4gICAgdmFyIGRpYWxvZ1NjaGVtYSA9IG9iak9mKFtcbiAgICAgIHN0cmljdFN0cmluZygndGl0bGUnKSxcbiAgICAgIHN0cmljdE9mKCdib2R5JywgY2hvb3NlUHJvY2Vzc29yKCd0eXBlJywge1xuICAgICAgICBwYW5lbDogcGFuZWxTY2hlbWEsXG4gICAgICAgIHRhYnBhbmVsOiB0YWJQYW5lbFNjaGVtYVxuICAgICAgfSkpLFxuICAgICAgZGVmYXVsdGVkU3RyaW5nKCdzaXplJywgJ25vcm1hbCcpLFxuICAgICAgc3RyaWN0QXJyYXlPZignYnV0dG9ucycsIGRpYWxvZ0J1dHRvblNjaGVtYSksXG4gICAgICBkZWZhdWx0ZWQkMSgnaW5pdGlhbERhdGEnLCB7fSksXG4gICAgICBkZWZhdWx0ZWRGdW5jdGlvbignb25BY3Rpb24nLCBub29wKSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdvbkNoYW5nZScsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uU3VibWl0Jywgbm9vcCksXG4gICAgICBkZWZhdWx0ZWRGdW5jdGlvbignb25DbG9zZScsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uQ2FuY2VsJywgbm9vcCksXG4gICAgICBkZWZhdWx0ZWQkMSgnb25UYWJDaGFuZ2UnLCBub29wKVxuICAgIF0pO1xuICAgIHZhciBjcmVhdGVEaWFsb2cgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIGFzUmF3KCdkaWFsb2cnLCBkaWFsb2dTY2hlbWEsIHNwZWMpO1xuICAgIH07XG5cbiAgICB2YXIgdXJsRGlhbG9nQnV0dG9uU2NoZW1hID0gb2JqT2YoX19zcHJlYWRBcnJheXMoW3N0cmljdFN0cmluZ0VudW0oJ3R5cGUnLCBbXG4gICAgICAgICdjYW5jZWwnLFxuICAgICAgICAnY3VzdG9tJ1xuICAgICAgXSldLCBkaWFsb2dCdXR0b25GaWVsZHMpKTtcbiAgICB2YXIgdXJsRGlhbG9nU2NoZW1hID0gb2JqT2YoW1xuICAgICAgc3RyaWN0U3RyaW5nKCd0aXRsZScpLFxuICAgICAgc3RyaWN0U3RyaW5nKCd1cmwnKSxcbiAgICAgIG9wdGlvbk51bWJlcignaGVpZ2h0JyksXG4gICAgICBvcHRpb25OdW1iZXIoJ3dpZHRoJyksXG4gICAgICBvcHRpb25BcnJheU9mKCdidXR0b25zJywgdXJsRGlhbG9nQnV0dG9uU2NoZW1hKSxcbiAgICAgIGRlZmF1bHRlZEZ1bmN0aW9uKCdvbkFjdGlvbicsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uQ2FuY2VsJywgbm9vcCksXG4gICAgICBkZWZhdWx0ZWRGdW5jdGlvbignb25DbG9zZScsIG5vb3ApLFxuICAgICAgZGVmYXVsdGVkRnVuY3Rpb24oJ29uTWVzc2FnZScsIG5vb3ApXG4gICAgXSk7XG4gICAgdmFyIGNyZWF0ZVVybERpYWxvZyA9IGZ1bmN0aW9uIChzcGVjKSB7XG4gICAgICByZXR1cm4gYXNSYXcoJ2RpYWxvZycsIHVybERpYWxvZ1NjaGVtYSwgc3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBnZXRBbGxPYmplY3RzID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgaWYgKGlzT2JqZWN0KG9iaikpIHtcbiAgICAgICAgcmV0dXJuIFtvYmpdLmNvbmNhdChiaW5kKHZhbHVlcyhvYmopLCBnZXRBbGxPYmplY3RzKSk7XG4gICAgICB9IGVsc2UgaWYgKGlzQXJyYXkob2JqKSkge1xuICAgICAgICByZXR1cm4gYmluZChvYmosIGdldEFsbE9iamVjdHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaXNOYW1lZEl0ZW0gPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gaXNTdHJpbmcob2JqLnR5cGUpICYmIGlzU3RyaW5nKG9iai5uYW1lKTtcbiAgICB9O1xuICAgIHZhciBkYXRhUHJvY2Vzc29ycyA9IHtcbiAgICAgIGNoZWNrYm94OiBjaGVja2JveERhdGFQcm9jZXNzb3IsXG4gICAgICBjb2xvcmlucHV0OiBjb2xvcklucHV0RGF0YVByb2Nlc3NvcixcbiAgICAgIGNvbG9ycGlja2VyOiBjb2xvclBpY2tlckRhdGFQcm9jZXNzb3IsXG4gICAgICBkcm9wem9uZTogZHJvcFpvbmVEYXRhUHJvY2Vzc29yLFxuICAgICAgaW5wdXQ6IGlucHV0RGF0YVByb2Nlc3NvcixcbiAgICAgIGlmcmFtZTogaWZyYW1lRGF0YVByb2Nlc3NvcixcbiAgICAgIHNpemVpbnB1dDogc2l6ZUlucHV0RGF0YVByb2Nlc3NvcixcbiAgICAgIHNlbGVjdGJveDogc2VsZWN0Qm94RGF0YVByb2Nlc3NvcixcbiAgICAgIGxpc3Rib3g6IGxpc3RCb3hEYXRhUHJvY2Vzc29yLFxuICAgICAgc2l6ZTogc2l6ZUlucHV0RGF0YVByb2Nlc3NvcixcbiAgICAgIHRleHRhcmVhOiB0ZXh0QXJlYURhdGFQcm9jZXNzb3IsXG4gICAgICB1cmxpbnB1dDogdXJsSW5wdXREYXRhUHJvY2Vzc29yLFxuICAgICAgY3VzdG9tZWRpdG9yOiBjdXN0b21FZGl0b3JEYXRhUHJvY2Vzc29yLFxuICAgICAgY29sbGVjdGlvbjogY29sbGVjdGlvbkRhdGFQcm9jZXNzb3IsXG4gICAgICB0b2dnbGVtZW51aXRlbTogZGlhbG9nVG9nZ2xlTWVudUl0ZW1EYXRhUHJvY2Vzc29yXG4gICAgfTtcbiAgICB2YXIgZ2V0RGF0YVByb2Nlc3NvciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShkYXRhUHJvY2Vzc29yc1tpdGVtLnR5cGVdKTtcbiAgICB9O1xuICAgIHZhciBnZXROYW1lZEl0ZW1zID0gZnVuY3Rpb24gKHN0cnVjdHVyZSkge1xuICAgICAgcmV0dXJuIGZpbHRlcihnZXRBbGxPYmplY3RzKHN0cnVjdHVyZSksIGlzTmFtZWRJdGVtKTtcbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZURhdGFWYWxpZGF0b3IgPSBmdW5jdGlvbiAoc3RydWN0dXJlKSB7XG4gICAgICB2YXIgbmFtZWRJdGVtcyA9IGdldE5hbWVkSXRlbXMoc3RydWN0dXJlKTtcbiAgICAgIHZhciBmaWVsZHMgPSBiaW5kKG5hbWVkSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBnZXREYXRhUHJvY2Vzc29yKGl0ZW0pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKHNjaGVtYSkge1xuICAgICAgICAgIHJldHVybiBbc3RyaWN0T2YoaXRlbS5uYW1lLCBzY2hlbWEpXTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvYmpPZihmaWVsZHMpO1xuICAgIH07XG5cbiAgICB2YXIgZXh0cmFjdCQxID0gZnVuY3Rpb24gKHN0cnVjdHVyZSkge1xuICAgICAgdmFyIGludGVybmFsRGlhbG9nID0gZ2V0T3JEaWUoY3JlYXRlRGlhbG9nKHN0cnVjdHVyZSkpO1xuICAgICAgdmFyIGRhdGFWYWxpZGF0b3IgPSBjcmVhdGVEYXRhVmFsaWRhdG9yKHN0cnVjdHVyZSk7XG4gICAgICB2YXIgaW5pdGlhbERhdGEgPSBzdHJ1Y3R1cmUuaW5pdGlhbERhdGE7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbnRlcm5hbERpYWxvZzogaW50ZXJuYWxEaWFsb2csXG4gICAgICAgIGRhdGFWYWxpZGF0b3I6IGRhdGFWYWxpZGF0b3IsXG4gICAgICAgIGluaXRpYWxEYXRhOiBpbml0aWFsRGF0YVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBEaWFsb2dNYW5hZ2VyID0ge1xuICAgICAgb3BlbjogZnVuY3Rpb24gKGZhY3RvcnksIHN0cnVjdHVyZSkge1xuICAgICAgICB2YXIgZXh0cmFjdGlvbiA9IGV4dHJhY3QkMShzdHJ1Y3R1cmUpO1xuICAgICAgICByZXR1cm4gZmFjdG9yeShleHRyYWN0aW9uLmludGVybmFsRGlhbG9nLCBleHRyYWN0aW9uLmluaXRpYWxEYXRhLCBleHRyYWN0aW9uLmRhdGFWYWxpZGF0b3IpO1xuICAgICAgfSxcbiAgICAgIG9wZW5Vcmw6IGZ1bmN0aW9uIChmYWN0b3J5LCBzdHJ1Y3R1cmUpIHtcbiAgICAgICAgdmFyIGludGVybmFsRGlhbG9nID0gZ2V0T3JEaWUoY3JlYXRlVXJsRGlhbG9nKHN0cnVjdHVyZSkpO1xuICAgICAgICByZXR1cm4gZmFjdG9yeShpbnRlcm5hbERpYWxvZyk7XG4gICAgICB9LFxuICAgICAgcmVkaWFsOiBmdW5jdGlvbiAoc3RydWN0dXJlKSB7XG4gICAgICAgIHJldHVybiBleHRyYWN0JDEoc3RydWN0dXJlKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHRvVmFsaWRWYWx1ZXMgPSBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgICB2YXIgZXJyb3JzID0gW107XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICBlYWNoJDEodmFsdWVzLCBmdW5jdGlvbiAodmFsdWUsIG5hbWUpIHtcbiAgICAgICAgdmFsdWUuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2gobmFtZSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgcmVzdWx0W25hbWVdID0gdjtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBlcnJvcnMubGVuZ3RoID4gMCA/IFJlc3VsdC5lcnJvcihlcnJvcnMpIDogUmVzdWx0LnZhbHVlKHJlc3VsdCk7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJCb2R5UGFuZWwgPSBmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICB2YXIgbWVtRm9ybSA9IHJlY29yZChGb3JtLnNrZXRjaChmdW5jdGlvbiAocGFydHMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1mb3JtJ10uY29uY2F0KHNwZWMuY2xhc3NlcylcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBvbmVudHM6IG1hcChzcGVjLml0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGludGVycHJldEluRm9ybShwYXJ0cywgaXRlbSwgYmFja3N0YWdlKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgICAgfSkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2JvZHknXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbe1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19fYm9keS1jb250ZW50J11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbbWVtRm9ybS5hc1NwZWMoKV1cbiAgICAgICAgICB9XSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ2FjeWNsaWMnLFxuICAgICAgICAgICAgdXNlVGFic3RvcEF0OiBub3QoaXNQc2V1ZG9TdG9wKVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIENvbXBvc2luZ0NvbmZpZ3MubWVtZW50byhtZW1Gb3JtKSxcbiAgICAgICAgICBSZXByZXNlbnRpbmdDb25maWdzLm1lbWVudG8obWVtRm9ybSwge1xuICAgICAgICAgICAgcG9zdHByb2Nlc3M6IGZ1bmN0aW9uIChmb3JtVmFsdWUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRvVmFsaWRWYWx1ZXMoZm9ybVZhbHVlKS5mb2xkKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodmFscykge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxzO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICBdKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGZhY3RvcnkkaiA9IGZ1bmN0aW9uIChkZXRhaWwsIF9zcGVjKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogZGV0YWlsLmNvbXBvbmVudHMsXG4gICAgICAgIGV2ZW50czogZXZlbnRzJDcoZGV0YWlsLmFjdGlvbiksXG4gICAgICAgIGJlaGF2aW91cnM6IGF1Z21lbnQoZGV0YWlsLnRhYkJ1dHRvbkJlaGF2aW91cnMsIFtcbiAgICAgICAgICBGb2N1c2luZy5jb25maWcoe30pLFxuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ2V4ZWN1dGlvbicsXG4gICAgICAgICAgICB1c2VTcGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHVzZUVudGVyOiB0cnVlXG4gICAgICAgICAgfSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWVtb3J5JyxcbiAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiBkZXRhaWwudmFsdWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICBdKSxcbiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiBkZXRhaWwuZG9tTW9kaWZpY2F0aW9uXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFRhYkJ1dHRvbiA9IHNpbmdsZSQyKHtcbiAgICAgIG5hbWU6ICdUYWJCdXR0b24nLFxuICAgICAgY29uZmlnRmllbGRzOiBbXG4gICAgICAgIGRlZmF1bHRlZCQxKCd1aWQnLCB1bmRlZmluZWQpLFxuICAgICAgICBzdHJpY3QkMSgndmFsdWUnKSxcbiAgICAgICAgZmllbGQoJ2RvbScsICdkb20nLCBtZXJnZVdpdGhUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgJ3JvbGUnOiAndGFiJyxcbiAgICAgICAgICAgICAgJ2lkJzogZ2VuZXJhdGUkMSgnYXJpYScpLFxuICAgICAgICAgICAgICAnYXJpYS1zZWxlY3RlZCc6ICdmYWxzZSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9KSwgYW55VmFsdWUkMSgpKSxcbiAgICAgICAgb3B0aW9uKCdhY3Rpb24nKSxcbiAgICAgICAgZGVmYXVsdGVkJDEoJ2RvbU1vZGlmaWNhdGlvbicsIHt9KSxcbiAgICAgICAgZmllbGQkMSgndGFiQnV0dG9uQmVoYXZpb3VycycsIFtcbiAgICAgICAgICBGb2N1c2luZyxcbiAgICAgICAgICBLZXlpbmcsXG4gICAgICAgICAgUmVwcmVzZW50aW5nXG4gICAgICAgIF0pLFxuICAgICAgICBzdHJpY3QkMSgndmlldycpXG4gICAgICBdLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSRqXG4gICAgfSk7XG5cbiAgICB2YXIgc2NoZW1hJHkgPSBjb25zdGFudChbXG4gICAgICBzdHJpY3QkMSgndGFicycpLFxuICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgZGVmYXVsdGVkJDEoJ2NsaWNrVG9EaXNtaXNzJywgZmFsc2UpLFxuICAgICAgZmllbGQkMSgndGFiYmFyQmVoYXZpb3VycycsIFtcbiAgICAgICAgSGlnaGxpZ2h0aW5nLFxuICAgICAgICBLZXlpbmdcbiAgICAgIF0pLFxuICAgICAgbWFya2VycyhbXG4gICAgICAgICd0YWJDbGFzcycsXG4gICAgICAgICdzZWxlY3RlZENsYXNzJ1xuICAgICAgXSlcbiAgICBdKTtcbiAgICB2YXIgdGFic1BhcnQgPSBncm91cCh7XG4gICAgICBmYWN0b3J5OiBUYWJCdXR0b24sXG4gICAgICBuYW1lOiAndGFicycsXG4gICAgICB1bml0OiAndGFiJyxcbiAgICAgIG92ZXJyaWRlczogZnVuY3Rpb24gKGJhckRldGFpbCkge1xuICAgICAgICB2YXIgZGlzbWlzc1RhYiQxID0gZnVuY3Rpb24gKHRhYmJhciwgYnV0dG9uKSB7XG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLmRlaGlnaGxpZ2h0KHRhYmJhciwgYnV0dG9uKTtcbiAgICAgICAgICBlbWl0V2l0aCh0YWJiYXIsIGRpc21pc3NUYWIoKSwge1xuICAgICAgICAgICAgdGFiYmFyOiB0YWJiYXIsXG4gICAgICAgICAgICBidXR0b246IGJ1dHRvblxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgY2hhbmdlVGFiJDEgPSBmdW5jdGlvbiAodGFiYmFyLCBidXR0b24pIHtcbiAgICAgICAgICBIaWdobGlnaHRpbmcuaGlnaGxpZ2h0KHRhYmJhciwgYnV0dG9uKTtcbiAgICAgICAgICBlbWl0V2l0aCh0YWJiYXIsIGNoYW5nZVRhYigpLCB7XG4gICAgICAgICAgICB0YWJiYXI6IHRhYmJhcixcbiAgICAgICAgICAgIGJ1dHRvbjogYnV0dG9uXG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgICB2YXIgdGFiYmFyID0gYnV0dG9uLmdldFN5c3RlbSgpLmdldEJ5VWlkKGJhckRldGFpbC51aWQpLmdldE9yRGllKCk7XG4gICAgICAgICAgICB2YXIgYWN0aXZlQnV0dG9uID0gSGlnaGxpZ2h0aW5nLmlzSGlnaGxpZ2h0ZWQodGFiYmFyLCBidXR0b24pO1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAoYWN0aXZlQnV0dG9uICYmIGJhckRldGFpbC5jbGlja1RvRGlzbWlzcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkaXNtaXNzVGFiJDE7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWFjdGl2ZUJ1dHRvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBjaGFuZ2VUYWIkMTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9vcDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSgpO1xuICAgICAgICAgICAgcmVzcG9uc2UodGFiYmFyLCBidXR0b24pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7IGNsYXNzZXM6IFtiYXJEZXRhaWwubWFya2Vycy50YWJDbGFzc10gfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBwYXJ0cyRnID0gY29uc3RhbnQoW3RhYnNQYXJ0XSk7XG5cbiAgICB2YXIgZmFjdG9yeSRrID0gZnVuY3Rpb24gKGRldGFpbCwgY29tcG9uZW50cywgX3NwZWMsIF9leHRlcm5hbHMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICd1aWQnOiBkZXRhaWwudWlkLFxuICAgICAgICAnZG9tJzogZGV0YWlsLmRvbSxcbiAgICAgICAgY29tcG9uZW50czogY29tcG9uZW50cyxcbiAgICAgICAgJ2RlYnVnLnNrZXRjaGVyJzogJ1RhYmJhcicsXG4gICAgICAgICdkb21Nb2RpZmljYXRpb24nOiB7IGF0dHJpYnV0ZXM6IHsgcm9sZTogJ3RhYmxpc3QnIH0gfSxcbiAgICAgICAgJ2JlaGF2aW91cnMnOiBhdWdtZW50KGRldGFpbC50YWJiYXJCZWhhdmlvdXJzLCBbXG4gICAgICAgICAgSGlnaGxpZ2h0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBoaWdobGlnaHRDbGFzczogZGV0YWlsLm1hcmtlcnMuc2VsZWN0ZWRDbGFzcyxcbiAgICAgICAgICAgIGl0ZW1DbGFzczogZGV0YWlsLm1hcmtlcnMudGFiQ2xhc3MsXG4gICAgICAgICAgICBvbkhpZ2hsaWdodDogZnVuY3Rpb24gKHRhYmJhciwgdGFiKSB7XG4gICAgICAgICAgICAgIHNldCQxKHRhYi5lbGVtZW50LCAnYXJpYS1zZWxlY3RlZCcsICd0cnVlJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25EZWhpZ2hsaWdodDogZnVuY3Rpb24gKHRhYmJhciwgdGFiKSB7XG4gICAgICAgICAgICAgIHNldCQxKHRhYi5lbGVtZW50LCAnYXJpYS1zZWxlY3RlZCcsICdmYWxzZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ2Zsb3cnLFxuICAgICAgICAgICAgZ2V0SW5pdGlhbDogZnVuY3Rpb24gKHRhYmJhcikge1xuICAgICAgICAgICAgICByZXR1cm4gSGlnaGxpZ2h0aW5nLmdldEhpZ2hsaWdodGVkKHRhYmJhcikubWFwKGZ1bmN0aW9uICh0YWIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFiLmVsZW1lbnQ7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyBkZXRhaWwubWFya2Vycy50YWJDbGFzcyxcbiAgICAgICAgICAgIGV4ZWN1dGVPbk1vdmU6IHRydWVcbiAgICAgICAgICB9KVxuICAgICAgICBdKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBUYWJiYXIgPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnVGFiYmFyJyxcbiAgICAgIGNvbmZpZ0ZpZWxkczogc2NoZW1hJHkoKSxcbiAgICAgIHBhcnRGaWVsZHM6IHBhcnRzJGcoKSxcbiAgICAgIGZhY3Rvcnk6IGZhY3Rvcnkka1xuICAgIH0pO1xuXG4gICAgdmFyIGZhY3RvcnkkbCA9IGZ1bmN0aW9uIChkZXRhaWwsIF9zcGVjKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1aWQ6IGRldGFpbC51aWQsXG4gICAgICAgIGRvbTogZGV0YWlsLmRvbSxcbiAgICAgICAgYmVoYXZpb3VyczogYXVnbWVudChkZXRhaWwudGFidmlld0JlaGF2aW91cnMsIFtSZXBsYWNpbmcuY29uZmlnKHt9KV0pLFxuICAgICAgICBkb21Nb2RpZmljYXRpb246IHsgYXR0cmlidXRlczogeyByb2xlOiAndGFicGFuZWwnIH0gfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBUYWJ2aWV3ID0gc2luZ2xlJDIoe1xuICAgICAgbmFtZTogJ1RhYnZpZXcnLFxuICAgICAgY29uZmlnRmllbGRzOiBbZmllbGQkMSgndGFidmlld0JlaGF2aW91cnMnLCBbUmVwbGFjaW5nXSldLFxuICAgICAgZmFjdG9yeTogZmFjdG9yeSRsXG4gICAgfSk7XG5cbiAgICB2YXIgc2NoZW1hJHogPSBjb25zdGFudChbXG4gICAgICBkZWZhdWx0ZWQkMSgnc2VsZWN0Rmlyc3QnLCB0cnVlKSxcbiAgICAgIG9uSGFuZGxlcignb25DaGFuZ2VUYWInKSxcbiAgICAgIG9uSGFuZGxlcignb25EaXNtaXNzVGFiJyksXG4gICAgICBkZWZhdWx0ZWQkMSgndGFicycsIFtdKSxcbiAgICAgIGZpZWxkJDEoJ3RhYlNlY3Rpb25CZWhhdmlvdXJzJywgW10pXG4gICAgXSk7XG4gICAgdmFyIGJhclBhcnQgPSByZXF1aXJlZCh7XG4gICAgICBmYWN0b3J5OiBUYWJiYXIsXG4gICAgICBzY2hlbWE6IFtcbiAgICAgICAgc3RyaWN0JDEoJ2RvbScpLFxuICAgICAgICBzdHJpY3RPYmpPZignbWFya2VycycsIFtcbiAgICAgICAgICBzdHJpY3QkMSgndGFiQ2xhc3MnKSxcbiAgICAgICAgICBzdHJpY3QkMSgnc2VsZWN0ZWRDbGFzcycpXG4gICAgICAgIF0pXG4gICAgICBdLFxuICAgICAgbmFtZTogJ3RhYmJhcicsXG4gICAgICBkZWZhdWx0czogZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICByZXR1cm4geyB0YWJzOiBkZXRhaWwudGFicyB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciB2aWV3UGFydCA9IHJlcXVpcmVkKHtcbiAgICAgIGZhY3Rvcnk6IFRhYnZpZXcsXG4gICAgICBuYW1lOiAndGFidmlldydcbiAgICB9KTtcbiAgICB2YXIgcGFydHMkaCA9IGNvbnN0YW50KFtcbiAgICAgIGJhclBhcnQsXG4gICAgICB2aWV3UGFydFxuICAgIF0pO1xuXG4gICAgdmFyIGZhY3RvcnkkbSA9IGZ1bmN0aW9uIChkZXRhaWwsIGNvbXBvbmVudHMsIF9zcGVjLCBfZXh0ZXJuYWxzKSB7XG4gICAgICB2YXIgY2hhbmdlVGFiJDEgPSBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgIHZhciB0YWJWYWx1ZSA9IFJlcHJlc2VudGluZy5nZXRWYWx1ZShidXR0b24pO1xuICAgICAgICBnZXRQYXJ0KGJ1dHRvbiwgZGV0YWlsLCAndGFidmlldycpLmVhY2goZnVuY3Rpb24gKHRhYnZpZXcpIHtcbiAgICAgICAgICB2YXIgdGFiV2l0aFZhbHVlID0gZmluZChkZXRhaWwudGFicywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0LnZhbHVlID09PSB0YWJWYWx1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0YWJXaXRoVmFsdWUuZWFjaChmdW5jdGlvbiAodGFiRGF0YSkge1xuICAgICAgICAgICAgdmFyIHBhbmVsID0gdGFiRGF0YS52aWV3KCk7XG4gICAgICAgICAgICBnZXRPcHQoYnV0dG9uLmVsZW1lbnQsICdpZCcpLmVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgIHNldCQxKHRhYnZpZXcuZWxlbWVudCwgJ2FyaWEtbGFiZWxsZWRieScsIGlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgUmVwbGFjaW5nLnNldCh0YWJ2aWV3LCBwYW5lbCk7XG4gICAgICAgICAgICBkZXRhaWwub25DaGFuZ2VUYWIodGFidmlldywgYnV0dG9uLCBwYW5lbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjaGFuZ2VUYWJCeSA9IGZ1bmN0aW9uIChzZWN0aW9uLCBieVByZWQpIHtcbiAgICAgICAgZ2V0UGFydChzZWN0aW9uLCBkZXRhaWwsICd0YWJiYXInKS5lYWNoKGZ1bmN0aW9uICh0YWJiYXIpIHtcbiAgICAgICAgICBieVByZWQodGFiYmFyKS5lYWNoKGVtaXRFeGVjdXRlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdWlkOiBkZXRhaWwudWlkLFxuICAgICAgICBkb206IGRldGFpbC5kb20sXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHMsXG4gICAgICAgIGJlaGF2aW91cnM6IGdldCRkKGRldGFpbC50YWJTZWN0aW9uQmVoYXZpb3VycyksXG4gICAgICAgIGV2ZW50czogZGVyaXZlKGZsYXR0ZW4oW1xuICAgICAgICAgIGRldGFpbC5zZWxlY3RGaXJzdCA/IFtydW5PbkF0dGFjaGVkKGZ1bmN0aW9uIChzZWN0aW9uLCBfc2ltdWxhdGVkRXZlbnQpIHtcbiAgICAgICAgICAgICAgY2hhbmdlVGFiQnkoc2VjdGlvbiwgSGlnaGxpZ2h0aW5nLmdldEZpcnN0KTtcbiAgICAgICAgICAgIH0pXSA6IFtdLFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIHJ1bihjaGFuZ2VUYWIoKSwgZnVuY3Rpb24gKHNlY3Rpb24sIHNpbXVsYXRlZEV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhciBidXR0b24gPSBzaW11bGF0ZWRFdmVudC5ldmVudC5idXR0b247XG4gICAgICAgICAgICAgIGNoYW5nZVRhYiQxKGJ1dHRvbik7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ1bihkaXNtaXNzVGFiKCksIGZ1bmN0aW9uIChzZWN0aW9uLCBzaW11bGF0ZWRFdmVudCkge1xuICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gc2ltdWxhdGVkRXZlbnQuZXZlbnQuYnV0dG9uO1xuICAgICAgICAgICAgICBkZXRhaWwub25EaXNtaXNzVGFiKHNlY3Rpb24sIGJ1dHRvbik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF1cbiAgICAgICAgXSkpLFxuICAgICAgICBhcGlzOiB7XG4gICAgICAgICAgZ2V0Vmlld0l0ZW1zOiBmdW5jdGlvbiAoc2VjdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGdldFBhcnQoc2VjdGlvbiwgZGV0YWlsLCAndGFidmlldycpLm1hcChmdW5jdGlvbiAodGFidmlldykge1xuICAgICAgICAgICAgICByZXR1cm4gUmVwbGFjaW5nLmNvbnRlbnRzKHRhYnZpZXcpO1xuICAgICAgICAgICAgfSkuZ2V0T3IoW10pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2hvd1RhYjogZnVuY3Rpb24gKHNlY3Rpb24sIHRhYktleSkge1xuICAgICAgICAgICAgdmFyIGdldFRhYklmTm90QWN0aXZlID0gZnVuY3Rpb24gKHRhYmJhcikge1xuICAgICAgICAgICAgICB2YXIgY2FuZGlkYXRlcyA9IEhpZ2hsaWdodGluZy5nZXRDYW5kaWRhdGVzKHRhYmJhcik7XG4gICAgICAgICAgICAgIHZhciBvcHRUYWIgPSBmaW5kKGNhbmRpZGF0ZXMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlcHJlc2VudGluZy5nZXRWYWx1ZShjKSA9PT0gdGFiS2V5O1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIG9wdFRhYi5maWx0ZXIoZnVuY3Rpb24gKHRhYikge1xuICAgICAgICAgICAgICAgIHJldHVybiAhSGlnaGxpZ2h0aW5nLmlzSGlnaGxpZ2h0ZWQodGFiYmFyLCB0YWIpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjaGFuZ2VUYWJCeShzZWN0aW9uLCBnZXRUYWJJZk5vdEFjdGl2ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFRhYlNlY3Rpb24gPSBjb21wb3NpdGUkMSh7XG4gICAgICBuYW1lOiAnVGFiU2VjdGlvbicsXG4gICAgICBjb25maWdGaWVsZHM6IHNjaGVtYSR6KCksXG4gICAgICBwYXJ0RmllbGRzOiBwYXJ0cyRoKCksXG4gICAgICBmYWN0b3J5OiBmYWN0b3J5JG0sXG4gICAgICBhcGlzOiB7XG4gICAgICAgIGdldFZpZXdJdGVtczogZnVuY3Rpb24gKGFwaXMsIGNvbXBvbmVudCkge1xuICAgICAgICAgIHJldHVybiBhcGlzLmdldFZpZXdJdGVtcyhjb21wb25lbnQpO1xuICAgICAgICB9LFxuICAgICAgICBzaG93VGFiOiBmdW5jdGlvbiAoYXBpcywgY29tcG9uZW50LCB0YWJLZXkpIHtcbiAgICAgICAgICBhcGlzLnNob3dUYWIoY29tcG9uZW50LCB0YWJLZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgbWVhc3VyZUhlaWdodHMgPSBmdW5jdGlvbiAoYWxsVGFicywgdGFidmlldywgdGFidmlld0NvbXApIHtcbiAgICAgIHJldHVybiBtYXAoYWxsVGFicywgZnVuY3Rpb24gKF90YWIsIGkpIHtcbiAgICAgICAgUmVwbGFjaW5nLnNldCh0YWJ2aWV3Q29tcCwgYWxsVGFic1tpXS52aWV3KCkpO1xuICAgICAgICB2YXIgcmVjdCA9IHRhYnZpZXcuZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBSZXBsYWNpbmcuc2V0KHRhYnZpZXdDb21wLCBbXSk7XG4gICAgICAgIHJldHVybiByZWN0LmhlaWdodDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldE1heEhlaWdodCA9IGZ1bmN0aW9uIChoZWlnaHRzKSB7XG4gICAgICByZXR1cm4gaGVhZChzb3J0KGhlaWdodHMsIGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIGlmIChhID4gYikge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfSBlbHNlIGlmIChhIDwgYikge1xuICAgICAgICAgIHJldHVybiArMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgIH07XG4gICAgdmFyIGdldE1heFRhYnZpZXdIZWlnaHQgPSBmdW5jdGlvbiAoZGlhbG9nLCB0YWJ2aWV3LCB0YWJsaXN0KSB7XG4gICAgICB2YXIgZG9jdW1lbnRFbGVtZW50JDEgPSBkb2N1bWVudEVsZW1lbnQoZGlhbG9nKS5kb207XG4gICAgICB2YXIgcm9vdEVsbSA9IGFuY2VzdG9yJDIoZGlhbG9nLCAnLnRveC1kaWFsb2ctd3JhcCcpLmdldE9yKGRpYWxvZyk7XG4gICAgICB2YXIgaXNGaXhlZCA9IGdldCQ1KHJvb3RFbG0sICdwb3NpdGlvbicpID09PSAnZml4ZWQnO1xuICAgICAgdmFyIG1heEhlaWdodDtcbiAgICAgIGlmIChpc0ZpeGVkKSB7XG4gICAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4KGRvY3VtZW50RWxlbWVudCQxLmNsaWVudEhlaWdodCwgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4KGRvY3VtZW50RWxlbWVudCQxLm9mZnNldEhlaWdodCwgZG9jdW1lbnRFbGVtZW50JDEuc2Nyb2xsSGVpZ2h0KTtcbiAgICAgIH1cbiAgICAgIHZhciB0YWJ2aWV3SGVpZ2h0ID0gZ2V0JDcodGFidmlldyk7XG4gICAgICB2YXIgaXNUYWJMaXN0QmVzaWRlID0gdGFidmlldy5kb20ub2Zmc2V0TGVmdCA+PSB0YWJsaXN0LmRvbS5vZmZzZXRMZWZ0ICsgZ2V0JDgodGFibGlzdCk7XG4gICAgICB2YXIgY3VycmVudFRhYkhlaWdodCA9IGlzVGFiTGlzdEJlc2lkZSA/IE1hdGgubWF4KGdldCQ3KHRhYmxpc3QpLCB0YWJ2aWV3SGVpZ2h0KSA6IHRhYnZpZXdIZWlnaHQ7XG4gICAgICB2YXIgZGlhbG9nVG9wTWFyZ2luID0gcGFyc2VJbnQoZ2V0JDUoZGlhbG9nLCAnbWFyZ2luLXRvcCcpLCAxMCkgfHwgMDtcbiAgICAgIHZhciBkaWFsb2dCb3R0b21NYXJnaW4gPSBwYXJzZUludChnZXQkNShkaWFsb2csICdtYXJnaW4tYm90dG9tJyksIDEwKSB8fCAwO1xuICAgICAgdmFyIGRpYWxvZ0hlaWdodCA9IGdldCQ3KGRpYWxvZykgKyBkaWFsb2dUb3BNYXJnaW4gKyBkaWFsb2dCb3R0b21NYXJnaW47XG4gICAgICB2YXIgY2hyb21lSGVpZ2h0ID0gZGlhbG9nSGVpZ2h0IC0gY3VycmVudFRhYkhlaWdodDtcbiAgICAgIHJldHVybiBtYXhIZWlnaHQgLSBjaHJvbWVIZWlnaHQ7XG4gICAgfTtcbiAgICB2YXIgc2hvd1RhYiA9IGZ1bmN0aW9uIChhbGxUYWJzLCBjb21wKSB7XG4gICAgICBoZWFkKGFsbFRhYnMpLmVhY2goZnVuY3Rpb24gKHRhYikge1xuICAgICAgICByZXR1cm4gVGFiU2VjdGlvbi5zaG93VGFiKGNvbXAsIHRhYi52YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzZXRUYWJ2aWV3SGVpZ2h0ID0gZnVuY3Rpb24gKHRhYnZpZXcsIGhlaWdodCkge1xuICAgICAgc2V0JDIodGFidmlldywgJ2hlaWdodCcsIGhlaWdodCArICdweCcpO1xuICAgICAgaWYgKCFkZXRlY3QkMygpLmJyb3dzZXIuaXNJRSgpKSB7XG4gICAgICAgIHNldCQyKHRhYnZpZXcsICdmbGV4LWJhc2lzJywgaGVpZ2h0ICsgJ3B4Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZW1vdmUkNih0YWJ2aWV3LCAnZmxleC1iYXNpcycpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHVwZGF0ZVRhYnZpZXdIZWlnaHQgPSBmdW5jdGlvbiAoZGlhbG9nQm9keSwgdGFidmlldywgbWF4VGFiSGVpZ2h0KSB7XG4gICAgICBhbmNlc3RvciQyKGRpYWxvZ0JvZHksICdbcm9sZT1cImRpYWxvZ1wiXScpLmVhY2goZnVuY3Rpb24gKGRpYWxvZykge1xuICAgICAgICBkZXNjZW5kYW50JDEoZGlhbG9nLCAnW3JvbGU9XCJ0YWJsaXN0XCJdJykuZWFjaChmdW5jdGlvbiAodGFibGlzdCkge1xuICAgICAgICAgIG1heFRhYkhlaWdodC5nZXQoKS5tYXAoZnVuY3Rpb24gKGhlaWdodCkge1xuICAgICAgICAgICAgc2V0JDIodGFidmlldywgJ2hlaWdodCcsICcwJyk7XG4gICAgICAgICAgICBzZXQkMih0YWJ2aWV3LCAnZmxleC1iYXNpcycsICcwJyk7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oaGVpZ2h0LCBnZXRNYXhUYWJ2aWV3SGVpZ2h0KGRpYWxvZywgdGFidmlldywgdGFibGlzdCkpO1xuICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKGhlaWdodCkge1xuICAgICAgICAgICAgc2V0VGFidmlld0hlaWdodCh0YWJ2aWV3LCBoZWlnaHQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFRhYnZpZXcgPSBmdW5jdGlvbiAoZGlhbG9nKSB7XG4gICAgICByZXR1cm4gZGVzY2VuZGFudCQxKGRpYWxvZywgJ1tyb2xlPVwidGFicGFuZWxcIl0nKTtcbiAgICB9O1xuICAgIHZhciBzZXRNb2RlID0gZnVuY3Rpb24gKGFsbFRhYnMpIHtcbiAgICAgIHZhciBzbWFydFRhYkhlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1heFRhYkhlaWdodCA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgdmFyIGV4dHJhRXZlbnRzID0gW1xuICAgICAgICAgIHJ1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHZhciBkaWFsb2cgPSBjb21wLmVsZW1lbnQ7XG4gICAgICAgICAgICBnZXRUYWJ2aWV3KGRpYWxvZykuZWFjaChmdW5jdGlvbiAodGFidmlldykge1xuICAgICAgICAgICAgICBzZXQkMih0YWJ2aWV3LCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgY29tcC5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0YWJ2aWV3KS50b09wdGlvbmFsKCkuZWFjaChmdW5jdGlvbiAodGFidmlld0NvbXApIHtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0cyA9IG1lYXN1cmVIZWlnaHRzKGFsbFRhYnMsIHRhYnZpZXcsIHRhYnZpZXdDb21wKTtcbiAgICAgICAgICAgICAgICB2YXIgbWF4VGFiSGVpZ2h0T3B0ID0gZ2V0TWF4SGVpZ2h0KGhlaWdodHMpO1xuICAgICAgICAgICAgICAgIG1heFRhYkhlaWdodC5zZXQobWF4VGFiSGVpZ2h0T3B0KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHVwZGF0ZVRhYnZpZXdIZWlnaHQoZGlhbG9nLCB0YWJ2aWV3LCBtYXhUYWJIZWlnaHQpO1xuICAgICAgICAgICAgICByZW1vdmUkNih0YWJ2aWV3LCAndmlzaWJpbGl0eScpO1xuICAgICAgICAgICAgICBzaG93VGFiKGFsbFRhYnMsIGNvbXApO1xuICAgICAgICAgICAgICBnbG9iYWwkMi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZVRhYnZpZXdIZWlnaHQoZGlhbG9nLCB0YWJ2aWV3LCBtYXhUYWJIZWlnaHQpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bih3aW5kb3dSZXNpemUoKSwgZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICAgIHZhciBkaWFsb2cgPSBjb21wLmVsZW1lbnQ7XG4gICAgICAgICAgICBnZXRUYWJ2aWV3KGRpYWxvZykuZWFjaChmdW5jdGlvbiAodGFidmlldykge1xuICAgICAgICAgICAgICB1cGRhdGVUYWJ2aWV3SGVpZ2h0KGRpYWxvZywgdGFidmlldywgbWF4VGFiSGVpZ2h0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bihmb3JtUmVzaXplRXZlbnQsIGZ1bmN0aW9uIChjb21wLCBfc2UpIHtcbiAgICAgICAgICAgIHZhciBkaWFsb2cgPSBjb21wLmVsZW1lbnQ7XG4gICAgICAgICAgICBnZXRUYWJ2aWV3KGRpYWxvZykuZWFjaChmdW5jdGlvbiAodGFidmlldykge1xuICAgICAgICAgICAgICB2YXIgb2xkRm9jdXMgPSBhY3RpdmUoZ2V0Um9vdE5vZGUodGFidmlldykpO1xuICAgICAgICAgICAgICBzZXQkMih0YWJ2aWV3LCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgdmFyIG9sZEhlaWdodCA9IGdldFJhdyh0YWJ2aWV3LCAnaGVpZ2h0JykubWFwKGZ1bmN0aW9uIChoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGgsIDEwKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJlbW92ZSQ2KHRhYnZpZXcsICdoZWlnaHQnKTtcbiAgICAgICAgICAgICAgcmVtb3ZlJDYodGFidmlldywgJ2ZsZXgtYmFzaXMnKTtcbiAgICAgICAgICAgICAgdmFyIG5ld0hlaWdodCA9IHRhYnZpZXcuZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgICAgICAgdmFyIGhhc0dyb3duID0gb2xkSGVpZ2h0LmZvcmFsbChmdW5jdGlvbiAoaCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXdIZWlnaHQgPiBoO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKGhhc0dyb3duKSB7XG4gICAgICAgICAgICAgICAgbWF4VGFiSGVpZ2h0LnNldChPcHRpb25hbC5mcm9tKG5ld0hlaWdodCkpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVRhYnZpZXdIZWlnaHQoZGlhbG9nLCB0YWJ2aWV3LCBtYXhUYWJIZWlnaHQpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9sZEhlaWdodC5lYWNoKGZ1bmN0aW9uIChoKSB7XG4gICAgICAgICAgICAgICAgICBzZXRUYWJ2aWV3SGVpZ2h0KHRhYnZpZXcsIGgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJlbW92ZSQ2KHRhYnZpZXcsICd2aXNpYmlsaXR5Jyk7XG4gICAgICAgICAgICAgIG9sZEZvY3VzLmVhY2goZm9jdXMkMSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICBdO1xuICAgICAgICB2YXIgc2VsZWN0Rmlyc3QgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBleHRyYUV2ZW50czogZXh0cmFFdmVudHMsXG4gICAgICAgICAgc2VsZWN0Rmlyc3Q6IHNlbGVjdEZpcnN0XG4gICAgICAgIH07XG4gICAgICB9KCk7XG4gICAgICB2YXIgbmFpdmVUYWJIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBleHRyYUV2ZW50cyA9IFtdO1xuICAgICAgICB2YXIgc2VsZWN0Rmlyc3QgPSB0cnVlO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGV4dHJhRXZlbnRzOiBleHRyYUV2ZW50cyxcbiAgICAgICAgICBzZWxlY3RGaXJzdDogc2VsZWN0Rmlyc3RcbiAgICAgICAgfTtcbiAgICAgIH0oKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNtYXJ0VGFiSGVpZ2h0OiBzbWFydFRhYkhlaWdodCxcbiAgICAgICAgbmFpdmVUYWJIZWlnaHQ6IG5haXZlVGFiSGVpZ2h0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgU2VuZERhdGFUb1NlY3Rpb25DaGFubmVsID0gJ3NlbmQtZGF0YS10by1zZWN0aW9uJztcbiAgICB2YXIgU2VuZERhdGFUb1ZpZXdDaGFubmVsID0gJ3NlbmQtZGF0YS10by12aWV3JztcbiAgICB2YXIgcmVuZGVyVGFiUGFuZWwgPSBmdW5jdGlvbiAoc3BlYywgYmFja3N0YWdlKSB7XG4gICAgICB2YXIgc3RvcmVkVmFsdWUgPSBDZWxsKHt9KTtcbiAgICAgIHZhciB1cGRhdGVEYXRhV2l0aEZvcm0gPSBmdW5jdGlvbiAoZm9ybSkge1xuICAgICAgICB2YXIgZm9ybURhdGEgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUoZm9ybSk7XG4gICAgICAgIHZhciB2YWxpZERhdGEgPSB0b1ZhbGlkVmFsdWVzKGZvcm1EYXRhKS5nZXRPcih7fSk7XG4gICAgICAgIHZhciBjdXJyZW50RGF0YSA9IHN0b3JlZFZhbHVlLmdldCgpO1xuICAgICAgICB2YXIgbmV3RGF0YSA9IGRlZXBNZXJnZShjdXJyZW50RGF0YSwgdmFsaWREYXRhKTtcbiAgICAgICAgc3RvcmVkVmFsdWUuc2V0KG5ld0RhdGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXREYXRhT25Gb3JtID0gZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgdmFyIHRhYkRhdGEgPSBzdG9yZWRWYWx1ZS5nZXQoKTtcbiAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGZvcm0sIHRhYkRhdGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBvbGRUYWIgPSBDZWxsKG51bGwpO1xuICAgICAgdmFyIGFsbFRhYnMgPSBtYXAoc3BlYy50YWJzLCBmdW5jdGlvbiAodGFiKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsdWU6IHRhYi5uYW1lLFxuICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19fYm9keS1uYXYtaXRlbSddLFxuICAgICAgICAgICAgaW5uZXJIdG1sOiBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycy50cmFuc2xhdGUodGFiLnRpdGxlKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmlldzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFtGb3JtLnNrZXRjaChmdW5jdGlvbiAocGFydHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWZvcm0nXVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHM6IG1hcCh0YWIuaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnRlcnByZXRJbkZvcm0ocGFydHMsIGl0ZW0sIGJhY2tzdGFnZSk7XG4gICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIGZvcm1CZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgICAgICAgICAgIEtleWluZy5jb25maWcoe1xuICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdhY3ljbGljJyxcbiAgICAgICAgICAgICAgICAgICAgICB1c2VUYWJzdG9wQXQ6IG5vdChpc1BzZXVkb1N0b3ApXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBjb25maWcoJ1RhYlZpZXcuZm9ybS5ldmVudHMnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgcnVuT25BdHRhY2hlZChzZXREYXRhT25Gb3JtKSxcbiAgICAgICAgICAgICAgICAgICAgICBydW5PbkRldGFjaGVkKHVwZGF0ZURhdGFXaXRoRm9ybSlcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIFJlY2VpdmluZy5jb25maWcoe1xuICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiB3cmFwQWxsJDEoW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6IFNlbmREYXRhVG9TZWN0aW9uQ2hhbm5lbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHsgb25SZWNlaXZlOiB1cGRhdGVEYXRhV2l0aEZvcm0gfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBTZW5kRGF0YVRvVmlld0NoYW5uZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7IG9uUmVjZWl2ZTogc2V0RGF0YU9uRm9ybSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHRhYk1vZGUgPSBzZXRNb2RlKGFsbFRhYnMpLnNtYXJ0VGFiSGVpZ2h0O1xuICAgICAgcmV0dXJuIFRhYlNlY3Rpb24uc2tldGNoKHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2JvZHknXVxuICAgICAgICB9LFxuICAgICAgICBvbkNoYW5nZVRhYjogZnVuY3Rpb24gKHNlY3Rpb24sIGJ1dHRvbiwgX3ZpZXdJdGVtcykge1xuICAgICAgICAgIHZhciBuYW1lID0gUmVwcmVzZW50aW5nLmdldFZhbHVlKGJ1dHRvbik7XG4gICAgICAgICAgZW1pdFdpdGgoc2VjdGlvbiwgZm9ybVRhYkNoYW5nZUV2ZW50LCB7XG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgb2xkTmFtZTogb2xkVGFiLmdldCgpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgb2xkVGFiLnNldChuYW1lKTtcbiAgICAgICAgfSxcbiAgICAgICAgdGFiczogYWxsVGFicyxcbiAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgIFRhYlNlY3Rpb24ucGFydHMudGFiYmFyKHtcbiAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2JvZHktbmF2J11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbVGFiYmFyLnBhcnRzLnRhYnMoe30pXSxcbiAgICAgICAgICAgIG1hcmtlcnM6IHtcbiAgICAgICAgICAgICAgdGFiQ2xhc3M6ICd0b3gtdGFiJyxcbiAgICAgICAgICAgICAgc2VsZWN0ZWRDbGFzczogJ3RveC1kaWFsb2dfX2JvZHktbmF2LWl0ZW0tLWFjdGl2ZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0YWJiYXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbVGFic3RvcHBpbmcuY29uZmlnKHt9KV0pXG4gICAgICAgICAgfSksXG4gICAgICAgICAgVGFiU2VjdGlvbi5wYXJ0cy50YWJ2aWV3KHtcbiAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2JvZHktY29udGVudCddXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgXSxcbiAgICAgICAgc2VsZWN0Rmlyc3Q6IHRhYk1vZGUuc2VsZWN0Rmlyc3QsXG4gICAgICAgIHRhYlNlY3Rpb25CZWhhdmlvdXJzOiBkZXJpdmUkMShbXG4gICAgICAgICAgY29uZmlnKCd0YWJwYW5lbCcsIHRhYk1vZGUuZXh0cmFFdmVudHMpLFxuICAgICAgICAgIEtleWluZy5jb25maWcoeyBtb2RlOiAnYWN5Y2xpYycgfSksXG4gICAgICAgICAgQ29tcG9zaW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBmaW5kOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgICAgICByZXR1cm4gaGVhZChUYWJTZWN0aW9uLmdldFZpZXdJdGVtcyhjb21wKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBzdG9yZToge1xuICAgICAgICAgICAgICBtb2RlOiAnbWFudWFsJyxcbiAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uICh0c2VjdGlvbikge1xuICAgICAgICAgICAgICAgIHRzZWN0aW9uLmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFtTZW5kRGF0YVRvU2VjdGlvbkNoYW5uZWxdLCB7fSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0b3JlZFZhbHVlLmdldCgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gKHRzZWN0aW9uLCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHN0b3JlZFZhbHVlLnNldCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgdHNlY3Rpb24uZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW1NlbmREYXRhVG9WaWV3Q2hhbm5lbF0sIHt9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGRpYWxvZ0NoYW5uZWwgPSBnZW5lcmF0ZSQxKCd1cGRhdGUtZGlhbG9nJyk7XG4gICAgdmFyIHRpdGxlQ2hhbm5lbCA9IGdlbmVyYXRlJDEoJ3VwZGF0ZS10aXRsZScpO1xuICAgIHZhciBib2R5Q2hhbm5lbCA9IGdlbmVyYXRlJDEoJ3VwZGF0ZS1ib2R5Jyk7XG4gICAgdmFyIGZvb3RlckNoYW5uZWwgPSBnZW5lcmF0ZSQxKCd1cGRhdGUtZm9vdGVyJyk7XG4gICAgdmFyIGJvZHlTZW5kTWVzc2FnZUNoYW5uZWwgPSBnZW5lcmF0ZSQxKCdib2R5LXNlbmQtbWVzc2FnZScpO1xuXG4gICAgdmFyIHJlbmRlckJvZHkgPSBmdW5jdGlvbiAoc3BlYywgaWQsIGJhY2tzdGFnZSwgYXJpYUF0dHJzKSB7XG4gICAgICB2YXIgcmVuZGVyQ29tcG9uZW50cyA9IGZ1bmN0aW9uIChpbmNvbWluZykge1xuICAgICAgICBzd2l0Y2ggKGluY29taW5nLmJvZHkudHlwZSkge1xuICAgICAgICBjYXNlICd0YWJwYW5lbCc6IHtcbiAgICAgICAgICAgIHJldHVybiBbcmVuZGVyVGFiUGFuZWwoaW5jb21pbmcuYm9keSwgYmFja3N0YWdlKV07XG4gICAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICByZXR1cm4gW3JlbmRlckJvZHlQYW5lbChpbmNvbWluZy5ib2R5LCBiYWNrc3RhZ2UpXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlU3RhdGUgPSBmdW5jdGlvbiAoX2NvbXAsIGluY29taW5nKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBpc1RhYlBhbmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5jb21pbmcuYm9keS50eXBlID09PSAndGFicGFuZWwnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGFyaWFBdHRyaWJ1dGVzID0geyAnYXJpYS1saXZlJzogJ3BvbGl0ZScgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtZGlhbG9nX19jb250ZW50LWpzJ10sXG4gICAgICAgICAgYXR0cmlidXRlczogX19hc3NpZ24oX19hc3NpZ24oe30sIGlkLm1hcChmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgaWQ6IHggfTtcbiAgICAgICAgICB9KS5nZXRPcih7fSkpLCBhcmlhQXR0cnMgPyBhcmlhQXR0cmlidXRlcyA6IHt9KVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbXSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgIENvbXBvc2luZ0NvbmZpZ3MuY2hpbGRBdCgwKSxcbiAgICAgICAgICBSZWZsZWN0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBjaGFubmVsOiBib2R5Q2hhbm5lbCxcbiAgICAgICAgICAgIHVwZGF0ZVN0YXRlOiB1cGRhdGVTdGF0ZSxcbiAgICAgICAgICAgIHJlbmRlckNvbXBvbmVudHM6IHJlbmRlckNvbXBvbmVudHMsXG4gICAgICAgICAgICBpbml0aWFsRGF0YTogc3BlY1xuICAgICAgICAgIH0pXG4gICAgICAgIF0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlcklubGluZUJvZHkgPSBmdW5jdGlvbiAoc3BlYywgY29udGVudElkLCBiYWNrc3RhZ2UsIGFyaWFBdHRycykge1xuICAgICAgcmV0dXJuIHJlbmRlckJvZHkoc3BlYywgT3B0aW9uYWwuc29tZShjb250ZW50SWQpLCBiYWNrc3RhZ2UsIGFyaWFBdHRycyk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyTW9kYWxCb2R5ID0gZnVuY3Rpb24gKHNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgdmFyIGJvZHlTcGVjID0gcmVuZGVyQm9keShzcGVjLCBPcHRpb25hbC5ub25lKCksIGJhY2tzdGFnZSwgZmFsc2UpO1xuICAgICAgcmV0dXJuIE1vZGFsRGlhbG9nLnBhcnRzLmJvZHkoYm9keVNwZWMpO1xuICAgIH07XG4gICAgdmFyIHJlbmRlcklmcmFtZUJvZHkgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIGJvZHlTcGVjID0ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19fY29udGVudC1qcyddXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudHM6IFt7XG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZGlhbG9nX19ib2R5LWlmcmFtZSddXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcG9uZW50czogW2NyYWZ0KHtcbiAgICAgICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgICAgIHRhZzogJ2lmcmFtZScsXG4gICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7IHNyYzogc3BlYy51cmwgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1xuICAgICAgICAgICAgICAgICAgVGFic3RvcHBpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICAgICAgICAgIEZvY3VzaW5nLmNvbmZpZyh7fSlcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICB9XSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW0tleWluZy5jb25maWcoe1xuICAgICAgICAgICAgbW9kZTogJ2FjeWNsaWMnLFxuICAgICAgICAgICAgdXNlVGFic3RvcEF0OiBub3QoaXNQc2V1ZG9TdG9wKVxuICAgICAgICAgIH0pXSlcbiAgICAgIH07XG4gICAgICByZXR1cm4gTW9kYWxEaWFsb2cucGFydHMuYm9keShib2R5U3BlYyk7XG4gICAgfTtcblxuICAgIHZhciBpc1RvdWNoID0gZ2xvYmFsJDguZGV2aWNlVHlwZS5pc1RvdWNoKCk7XG4gICAgdmFyIGhpZGRlbkhlYWRlciA9IGZ1bmN0aW9uICh0aXRsZSwgY2xvc2UpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgc3R5bGVzOiB7IGRpc3BsYXk6ICdub25lJyB9LFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19faGVhZGVyJ11cbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgIGNsb3NlXG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcENsb3NlID0gZnVuY3Rpb24gKG9uQ2xvc2UsIHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIE1vZGFsRGlhbG9nLnBhcnRzLmNsb3NlKEJ1dHRvbi5za2V0Y2goe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICd0b3gtYnV0dG9uJyxcbiAgICAgICAgICAgICd0b3gtYnV0dG9uLS1pY29uJyxcbiAgICAgICAgICAgICd0b3gtYnV0dG9uLS1uYWtlZCdcbiAgICAgICAgICBdLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICd0eXBlJzogJ2J1dHRvbicsXG4gICAgICAgICAgICAnYXJpYS1sYWJlbCc6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUoJ0Nsb3NlJylcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGFjdGlvbjogb25DbG9zZSxcbiAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogZGVyaXZlJDEoW1RhYnN0b3BwaW5nLmNvbmZpZyh7fSldKVxuICAgICAgfSkpO1xuICAgIH07XG4gICAgdmFyIHBVbnRpdGxlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBNb2RhbERpYWxvZy5wYXJ0cy50aXRsZSh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogWyd0b3gtZGlhbG9nX190aXRsZSddLFxuICAgICAgICAgIGlubmVySHRtbDogJycsXG4gICAgICAgICAgc3R5bGVzOiB7IGRpc3BsYXk6ICdub25lJyB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHBCb2R5TWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiBNb2RhbERpYWxvZy5wYXJ0cy5ib2R5KHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2JvZHknXVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbe1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19fYm9keS1jb250ZW50J11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbeyBkb206IGZyb21IdG1sJDIoJzxwPicgKyBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKG1lc3NhZ2UpICsgJzwvcD4nKSB9XVxuICAgICAgICAgIH1dXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwRm9vdGVyID0gZnVuY3Rpb24gKGJ1dHRvbnMpIHtcbiAgICAgIHJldHVybiBNb2RhbERpYWxvZy5wYXJ0cy5mb290ZXIoe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19fZm9vdGVyJ11cbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogYnV0dG9uc1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcEZvb3Rlckdyb3VwID0gZnVuY3Rpb24gKHN0YXJ0QnV0dG9ucywgZW5kQnV0dG9ucykge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgQ29udGFpbmVyLnNrZXRjaCh7XG4gICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgY2xhc3NlczogWyd0b3gtZGlhbG9nX19mb290ZXItc3RhcnQnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcG9uZW50czogc3RhcnRCdXR0b25zXG4gICAgICAgIH0pLFxuICAgICAgICBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2Zvb3Rlci1lbmQnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcG9uZW50czogZW5kQnV0dG9uc1xuICAgICAgICB9KVxuICAgICAgXTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJEaWFsb2cgPSBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgdmFyIF9hO1xuICAgICAgdmFyIGRpYWxvZ0NsYXNzID0gJ3RveC1kaWFsb2cnO1xuICAgICAgdmFyIGJsb2NrZXJDbGFzcyA9IGRpYWxvZ0NsYXNzICsgJy13cmFwJztcbiAgICAgIHZhciBibG9ja2VyQmFja2Ryb3BDbGFzcyA9IGJsb2NrZXJDbGFzcyArICdfX2JhY2tkcm9wJztcbiAgICAgIHZhciBzY3JvbGxMb2NrQ2xhc3MgPSBkaWFsb2dDbGFzcyArICdfX2Rpc2FibGUtc2Nyb2xsJztcbiAgICAgIHJldHVybiBNb2RhbERpYWxvZy5za2V0Y2goe1xuICAgICAgICBsYXp5U2luazogc3BlYy5sYXp5U2luayxcbiAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIChjb21wKSB7XG4gICAgICAgICAgc3BlYy5vbkVzY2FwZShjb21wKTtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgdXNlVGFic3RvcEF0OiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiAhaXNQc2V1ZG9TdG9wKGVsZW0pO1xuICAgICAgICB9LFxuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFtkaWFsb2dDbGFzc10uY29uY2F0KHNwZWMuZXh0cmFDbGFzc2VzKSxcbiAgICAgICAgICBzdHlsZXM6IF9fYXNzaWduKHsgcG9zaXRpb246ICdyZWxhdGl2ZScgfSwgc3BlYy5leHRyYVN0eWxlcylcbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgIHNwZWMuaGVhZGVyLFxuICAgICAgICAgIHNwZWMuYm9keVxuICAgICAgICBdLCBzcGVjLmZvb3Rlci50b0FycmF5KCkpLFxuICAgICAgICBwYXJ0czoge1xuICAgICAgICAgIGJsb2NrZXI6IHtcbiAgICAgICAgICAgIGRvbTogZnJvbUh0bWwkMignPGRpdiBjbGFzcz1cIicgKyBibG9ja2VyQ2xhc3MgKyAnXCI+PC9kaXY+JyksXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbe1xuICAgICAgICAgICAgICAgIGRvbToge1xuICAgICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IGlzVG91Y2ggPyBbXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrZXJCYWNrZHJvcENsYXNzLFxuICAgICAgICAgICAgICAgICAgICBibG9ja2VyQmFja2Ryb3BDbGFzcyArICctLW9wYXF1ZSdcbiAgICAgICAgICAgICAgICAgIF0gOiBbYmxvY2tlckJhY2tkcm9wQ2xhc3NdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZHJhZ0Jsb2NrQ2xhc3M6IGJsb2NrZXJDbGFzcyxcbiAgICAgICAgbW9kYWxCZWhhdmlvdXJzOiBkZXJpdmUkMShfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBjb25maWcoJ2RpYWxvZy1ldmVudHMnLCBzcGVjLmRpYWxvZ0V2ZW50cy5jb25jYXQoW3J1bk9uU291cmNlKGZvY3VzaW4oKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBLZXlpbmcuZm9jdXNJbihjb21wKTtcbiAgICAgICAgICAgIH0pXSkpLFxuICAgICAgICAgIGNvbmZpZygnc2Nyb2xsLWxvY2snLCBbXG4gICAgICAgICAgICBydW5PbkF0dGFjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgYWRkJDIoYm9keSgpLCBzY3JvbGxMb2NrQ2xhc3MpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydW5PbkRldGFjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmVtb3ZlJDQoYm9keSgpLCBzY3JvbGxMb2NrQ2xhc3MpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICBdKVxuICAgICAgICBdLCBzcGVjLmV4dHJhQmVoYXZpb3VycykpLFxuICAgICAgICBldmVudE9yZGVyOiBfX2Fzc2lnbigoX2EgPSB7fSwgX2FbZXhlY3V0ZSgpXSA9IFsnZGlhbG9nLWV2ZW50cyddLCBfYVthdHRhY2hlZFRvRG9tKCldID0gW1xuICAgICAgICAgICdzY3JvbGwtbG9jaycsXG4gICAgICAgICAgJ2RpYWxvZy1ldmVudHMnLFxuICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cidcbiAgICAgICAgXSwgX2FbZGV0YWNoZWRGcm9tRG9tKCldID0gW1xuICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cicsXG4gICAgICAgICAgJ2RpYWxvZy1ldmVudHMnLFxuICAgICAgICAgICdzY3JvbGwtbG9jaydcbiAgICAgICAgXSwgX2EpLCBzcGVjLmV2ZW50T3JkZXIpXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHJlbmRlckNsb3NlID0gZnVuY3Rpb24gKHByb3ZpZGVyc0JhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIEJ1dHRvbi5za2V0Y2goe1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdidXR0b24nLFxuICAgICAgICAgIGNsYXNzZXM6IFtcbiAgICAgICAgICAgICd0b3gtYnV0dG9uJyxcbiAgICAgICAgICAgICd0b3gtYnV0dG9uLS1pY29uJyxcbiAgICAgICAgICAgICd0b3gtYnV0dG9uLS1uYWtlZCdcbiAgICAgICAgICBdLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICd0eXBlJzogJ2J1dHRvbicsXG4gICAgICAgICAgICAnYXJpYS1sYWJlbCc6IHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUoJ0Nsb3NlJyksXG4gICAgICAgICAgICAndGl0bGUnOiBwcm92aWRlcnNCYWNrc3RhZ2UudHJhbnNsYXRlKCdDbG9zZScpXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnRzOiBbe1xuICAgICAgICAgICAgZG9tOiB7XG4gICAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICAgIGNsYXNzZXM6IFsndG94LWljb24nXSxcbiAgICAgICAgICAgICAgaW5uZXJIdG1sOiBnZXQkZSgnY2xvc2UnLCBwcm92aWRlcnNCYWNrc3RhZ2UuaWNvbnMpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfV0sXG4gICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKGNvbXApIHtcbiAgICAgICAgICBlbWl0KGNvbXAsIGZvcm1DYW5jZWxFdmVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlbmRlclRpdGxlID0gZnVuY3Rpb24gKHNwZWMsIGlkLCBwcm92aWRlcnNCYWNrc3RhZ2UpIHtcbiAgICAgIHZhciByZW5kZXJDb21wb25lbnRzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIFt0ZXh0KHByb3ZpZGVyc0JhY2tzdGFnZS50cmFuc2xhdGUoZGF0YS50aXRsZSkpXTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IHtcbiAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgIGNsYXNzZXM6IFsndG94LWRpYWxvZ19fdGl0bGUnXSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBfX2Fzc2lnbih7fSwgaWQubWFwKGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICByZXR1cm4geyBpZDogeCB9O1xuICAgICAgICAgIH0pLmdldE9yKHt9KSlcbiAgICAgICAgfSxcbiAgICAgICAgY29tcG9uZW50czogcmVuZGVyQ29tcG9uZW50cyhzcGVjKSxcbiAgICAgICAgYmVoYXZpb3VyczogZGVyaXZlJDEoW1JlZmxlY3RpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGNoYW5uZWw6IHRpdGxlQ2hhbm5lbCxcbiAgICAgICAgICAgIHJlbmRlckNvbXBvbmVudHM6IHJlbmRlckNvbXBvbmVudHNcbiAgICAgICAgICB9KV0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbmRlckRyYWdIYW5kbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4geyBkb206IGZyb21IdG1sJDIoJzxkaXYgY2xhc3M9XCJ0b3gtZGlhbG9nX19kcmFnaGFuZGxlXCI+PC9kaXY+JykgfTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJJbmxpbmVIZWFkZXIgPSBmdW5jdGlvbiAoc3BlYywgdGl0bGVJZCwgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICByZXR1cm4gQ29udGFpbmVyLnNrZXRjaCh7XG4gICAgICAgIGRvbTogZnJvbUh0bWwkMignPGRpdiBjbGFzcz1cInRveC1kaWFsb2dfX2hlYWRlclwiPjwvZGl2PicpLFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgcmVuZGVyVGl0bGUoc3BlYywgT3B0aW9uYWwuc29tZSh0aXRsZUlkKSwgcHJvdmlkZXJzQmFja3N0YWdlKSxcbiAgICAgICAgICByZW5kZXJEcmFnSGFuZGxlKCksXG4gICAgICAgICAgcmVuZGVyQ2xvc2UocHJvdmlkZXJzQmFja3N0YWdlKVxuICAgICAgICBdLFxuICAgICAgICBjb250YWluZXJCZWhhdmlvdXJzOiBkZXJpdmUkMShbRHJhZ2dpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdtb3VzZScsXG4gICAgICAgICAgICBibG9ja2VyQ2xhc3M6ICdibG9ja2VyJyxcbiAgICAgICAgICAgIGdldFRhcmdldDogZnVuY3Rpb24gKGhhbmRsZSkge1xuICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdCQzKGhhbmRsZSwgJ1tyb2xlPVwiZGlhbG9nXCJdJykuZ2V0T3JEaWUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzbmFwczoge1xuICAgICAgICAgICAgICBnZXRTbmFwUG9pbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBsZWZ0QXR0cjogJ2RhdGEtZHJhZy1sZWZ0JyxcbiAgICAgICAgICAgICAgdG9wQXR0cjogJ2RhdGEtZHJhZy10b3AnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSldKVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyTW9kYWxIZWFkZXIgPSBmdW5jdGlvbiAoc3BlYywgcHJvdmlkZXJzQmFja3N0YWdlKSB7XG4gICAgICB2YXIgcFRpdGxlID0gTW9kYWxEaWFsb2cucGFydHMudGl0bGUocmVuZGVyVGl0bGUoc3BlYywgT3B0aW9uYWwubm9uZSgpLCBwcm92aWRlcnNCYWNrc3RhZ2UpKTtcbiAgICAgIHZhciBwSGFuZGxlID0gTW9kYWxEaWFsb2cucGFydHMuZHJhZ2hhbmRsZShyZW5kZXJEcmFnSGFuZGxlKCkpO1xuICAgICAgdmFyIHBDbG9zZSA9IE1vZGFsRGlhbG9nLnBhcnRzLmNsb3NlKHJlbmRlckNsb3NlKHByb3ZpZGVyc0JhY2tzdGFnZSkpO1xuICAgICAgdmFyIGNvbXBvbmVudHMgPSBbcFRpdGxlXS5jb25jYXQoc3BlYy5kcmFnZ2FibGUgPyBbcEhhbmRsZV0gOiBbXSkuY29uY2F0KFtwQ2xvc2VdKTtcbiAgICAgIHJldHVybiBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgZG9tOiBmcm9tSHRtbCQyKCc8ZGl2IGNsYXNzPVwidG94LWRpYWxvZ19faGVhZGVyXCI+PC9kaXY+JyksXG4gICAgICAgIGNvbXBvbmVudHM6IGNvbXBvbmVudHNcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0SGVhZGVyID0gZnVuY3Rpb24gKHRpdGxlLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiByZW5kZXJNb2RhbEhlYWRlcih7XG4gICAgICAgIHRpdGxlOiBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycy50cmFuc2xhdGUodGl0bGUpLFxuICAgICAgICBkcmFnZ2FibGU6IGJhY2tzdGFnZS5kaWFsb2cuaXNEcmFnZ2FibGVNb2RhbCgpXG4gICAgICB9LCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0QnVzeVNwZWMgPSBmdW5jdGlvbiAobWVzc2FnZSwgYnMsIHByb3ZpZGVycykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tOiB7XG4gICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2J1c3ktc3Bpbm5lciddLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IHsgJ2FyaWEtbGFiZWwnOiBwcm92aWRlcnMudHJhbnNsYXRlKG1lc3NhZ2UpIH0sXG4gICAgICAgICAgc3R5bGVzOiB7XG4gICAgICAgICAgICBsZWZ0OiAnMHB4JyxcbiAgICAgICAgICAgIHJpZ2h0OiAnMHB4JyxcbiAgICAgICAgICAgIGJvdHRvbTogJzBweCcsXG4gICAgICAgICAgICB0b3A6ICcwcHgnLFxuICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJlaGF2aW91cnM6IGJzLFxuICAgICAgICBjb21wb25lbnRzOiBbeyBkb206IGZyb21IdG1sJDIoJzxkaXYgY2xhc3M9XCJ0b3gtc3Bpbm5lclwiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjwvZGl2PicpIH1dXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldEV2ZW50RXh0cmFzID0gZnVuY3Rpb24gKGxhenlEaWFsb2csIHByb3ZpZGVycywgZXh0cmEpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZXh0cmEuY2xvc2VXaW5kb3coKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25CbG9jazogZnVuY3Rpb24gKGJsb2NrRXZlbnQpIHtcbiAgICAgICAgICBNb2RhbERpYWxvZy5zZXRCdXN5KGxhenlEaWFsb2coKSwgZnVuY3Rpb24gKF9jb21wLCBicykge1xuICAgICAgICAgICAgcmV0dXJuIGdldEJ1c3lTcGVjKGJsb2NrRXZlbnQubWVzc2FnZSwgYnMsIHByb3ZpZGVycyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uVW5ibG9jazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIE1vZGFsRGlhbG9nLnNldElkbGUobGF6eURpYWxvZygpKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZW5kZXJNb2RhbERpYWxvZyA9IGZ1bmN0aW9uIChzcGVjLCBpbml0aWFsRGF0YSwgZGlhbG9nRXZlbnRzLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHZhciBfYTtcbiAgICAgIHZhciB1cGRhdGVTdGF0ZSA9IGZ1bmN0aW9uIChfY29tcCwgaW5jb21pbmcpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoaW5jb21pbmcpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBidWlsZCQxKHJlbmRlckRpYWxvZyhfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3BlYyksIHtcbiAgICAgICAgbGF6eVNpbms6IGJhY2tzdGFnZS5zaGFyZWQuZ2V0U2luayxcbiAgICAgICAgZXh0cmFCZWhhdmlvdXJzOiBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgUmVmbGVjdGluZy5jb25maWcoe1xuICAgICAgICAgICAgY2hhbm5lbDogZGlhbG9nQ2hhbm5lbCxcbiAgICAgICAgICAgIHVwZGF0ZVN0YXRlOiB1cGRhdGVTdGF0ZSxcbiAgICAgICAgICAgIGluaXRpYWxEYXRhOiBpbml0aWFsRGF0YVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIFJlcHJlc2VudGluZ0NvbmZpZ3MubWVtb3J5KHt9KVxuICAgICAgICBdLCBzcGVjLmV4dHJhQmVoYXZpb3VycyksXG4gICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIGVtaXQoY29tcCwgZm9ybUNhbmNlbEV2ZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgZGlhbG9nRXZlbnRzOiBkaWFsb2dFdmVudHMsXG4gICAgICAgIGV2ZW50T3JkZXI6IChfYSA9IHt9LCBfYVtyZWNlaXZlKCldID0gW1xuICAgICAgICAgIFJlZmxlY3RpbmcubmFtZSgpLFxuICAgICAgICAgIFJlY2VpdmluZy5uYW1lKClcbiAgICAgICAgXSwgX2FbYXR0YWNoZWRUb0RvbSgpXSA9IFtcbiAgICAgICAgICAnc2Nyb2xsLWxvY2snLFxuICAgICAgICAgIFJlZmxlY3RpbmcubmFtZSgpLFxuICAgICAgICAgICdtZXNzYWdlcycsXG4gICAgICAgICAgJ2RpYWxvZy1ldmVudHMnLFxuICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cidcbiAgICAgICAgXSwgX2FbZGV0YWNoZWRGcm9tRG9tKCldID0gW1xuICAgICAgICAgICdhbGxveS5iYXNlLmJlaGF2aW91cicsXG4gICAgICAgICAgJ2RpYWxvZy1ldmVudHMnLFxuICAgICAgICAgICdtZXNzYWdlcycsXG4gICAgICAgICAgUmVmbGVjdGluZy5uYW1lKCksXG4gICAgICAgICAgJ3Njcm9sbC1sb2NrJ1xuICAgICAgICBdLCBfYSlcbiAgICAgIH0pKSk7XG4gICAgfTtcbiAgICB2YXIgbWFwTWVudUJ1dHRvbnMgPSBmdW5jdGlvbiAoYnV0dG9ucykge1xuICAgICAgdmFyIG1hcEl0ZW1zID0gZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICB2YXIgaXRlbXMgPSBtYXAoYnV0dG9uLml0ZW1zLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHZhciBjZWxsID0gQ2VsbChmYWxzZSk7XG4gICAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBpdGVtKSwgeyBzdG9yYWdlOiBjZWxsIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBidXR0b24pLCB7IGl0ZW1zOiBpdGVtcyB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbWFwKGJ1dHRvbnMsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgaWYgKGJ1dHRvbi50eXBlID09PSAnbWVudScpIHtcbiAgICAgICAgICByZXR1cm4gbWFwSXRlbXMoYnV0dG9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZXh0cmFjdENlbGxzVG9PYmplY3QgPSBmdW5jdGlvbiAoYnV0dG9ucykge1xuICAgICAgcmV0dXJuIGZvbGRsKGJ1dHRvbnMsIGZ1bmN0aW9uIChhY2MsIGJ1dHRvbikge1xuICAgICAgICBpZiAoYnV0dG9uLnR5cGUgPT09ICdtZW51Jykge1xuICAgICAgICAgIHZhciBtZW51QnV0dG9uID0gYnV0dG9uO1xuICAgICAgICAgIHJldHVybiBmb2xkbChtZW51QnV0dG9uLml0ZW1zLCBmdW5jdGlvbiAoaW5uZXJBY2MsIGl0ZW0pIHtcbiAgICAgICAgICAgIGlubmVyQWNjW2l0ZW0ubmFtZV0gPSBpdGVtLnN0b3JhZ2U7XG4gICAgICAgICAgICByZXR1cm4gaW5uZXJBY2M7XG4gICAgICAgICAgfSwgYWNjKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSwge30pO1xuICAgIH07XG5cbiAgICB2YXIgaW5pdENvbW1vbkV2ZW50cyA9IGZ1bmN0aW9uIChmaXJlQXBpRXZlbnQsIGV4dHJhcykge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgcnVuV2l0aFRhcmdldChmb2N1c2luKCksIG9uRm9jdXMkMSksXG4gICAgICAgIGZpcmVBcGlFdmVudChmb3JtQ2xvc2VFdmVudCwgZnVuY3Rpb24gKF9hcGksIHNwZWMpIHtcbiAgICAgICAgICBleHRyYXMub25DbG9zZSgpO1xuICAgICAgICAgIHNwZWMub25DbG9zZSgpO1xuICAgICAgICB9KSxcbiAgICAgICAgZmlyZUFwaUV2ZW50KGZvcm1DYW5jZWxFdmVudCwgZnVuY3Rpb24gKGFwaSwgc3BlYywgX2V2ZW50LCBzZWxmKSB7XG4gICAgICAgICAgc3BlYy5vbkNhbmNlbChhcGkpO1xuICAgICAgICAgIGVtaXQoc2VsZiwgZm9ybUNsb3NlRXZlbnQpO1xuICAgICAgICB9KSxcbiAgICAgICAgcnVuKGZvcm1VbmJsb2NrRXZlbnQsIGZ1bmN0aW9uIChfYywgX3NlKSB7XG4gICAgICAgICAgcmV0dXJuIGV4dHJhcy5vblVuYmxvY2soKTtcbiAgICAgICAgfSksXG4gICAgICAgIHJ1bihmb3JtQmxvY2tFdmVudCwgZnVuY3Rpb24gKF9jLCBzZSkge1xuICAgICAgICAgIHJldHVybiBleHRyYXMub25CbG9jayhzZS5ldmVudCk7XG4gICAgICAgIH0pXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIGluaXRVcmxEaWFsb2cgPSBmdW5jdGlvbiAoZ2V0SW5zdGFuY2VBcGksIGV4dHJhcykge1xuICAgICAgdmFyIGZpcmVBcGlFdmVudCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGYpIHtcbiAgICAgICAgcmV0dXJuIHJ1bihldmVudE5hbWUsIGZ1bmN0aW9uIChjLCBzZSkge1xuICAgICAgICAgIHdpdGhTcGVjKGMsIGZ1bmN0aW9uIChzcGVjLCBfYykge1xuICAgICAgICAgICAgZihnZXRJbnN0YW5jZUFwaSgpLCBzcGVjLCBzZS5ldmVudCwgYyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB3aXRoU3BlYyA9IGZ1bmN0aW9uIChjLCBmKSB7XG4gICAgICAgIFJlZmxlY3RpbmcuZ2V0U3RhdGUoYykuZ2V0KCkuZWFjaChmdW5jdGlvbiAoY3VycmVudERpYWxvZykge1xuICAgICAgICAgIGYoY3VycmVudERpYWxvZywgYyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBfX3NwcmVhZEFycmF5cyhpbml0Q29tbW9uRXZlbnRzKGZpcmVBcGlFdmVudCwgZXh0cmFzKSwgW2ZpcmVBcGlFdmVudChmb3JtQWN0aW9uRXZlbnQsIGZ1bmN0aW9uIChhcGksIHNwZWMsIGV2ZW50KSB7XG4gICAgICAgICAgc3BlYy5vbkFjdGlvbihhcGksIHsgbmFtZTogZXZlbnQubmFtZSB9KTtcbiAgICAgICAgfSldKTtcbiAgICB9O1xuICAgIHZhciBpbml0RGlhbG9nID0gZnVuY3Rpb24gKGdldEluc3RhbmNlQXBpLCBleHRyYXMsIGdldFNpbmspIHtcbiAgICAgIHZhciBmaXJlQXBpRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBmKSB7XG4gICAgICAgIHJldHVybiBydW4oZXZlbnROYW1lLCBmdW5jdGlvbiAoYywgc2UpIHtcbiAgICAgICAgICB3aXRoU3BlYyhjLCBmdW5jdGlvbiAoc3BlYywgX2MpIHtcbiAgICAgICAgICAgIGYoZ2V0SW5zdGFuY2VBcGkoKSwgc3BlYywgc2UuZXZlbnQsIGMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgd2l0aFNwZWMgPSBmdW5jdGlvbiAoYywgZikge1xuICAgICAgICBSZWZsZWN0aW5nLmdldFN0YXRlKGMpLmdldCgpLmVhY2goZnVuY3Rpb24gKGN1cnJlbnREaWFsb2dJbml0KSB7XG4gICAgICAgICAgZihjdXJyZW50RGlhbG9nSW5pdC5pbnRlcm5hbERpYWxvZywgYyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBfX3NwcmVhZEFycmF5cyhpbml0Q29tbW9uRXZlbnRzKGZpcmVBcGlFdmVudCwgZXh0cmFzKSwgW1xuICAgICAgICBmaXJlQXBpRXZlbnQoZm9ybVN1Ym1pdEV2ZW50LCBmdW5jdGlvbiAoYXBpLCBzcGVjKSB7XG4gICAgICAgICAgcmV0dXJuIHNwZWMub25TdWJtaXQoYXBpKTtcbiAgICAgICAgfSksXG4gICAgICAgIGZpcmVBcGlFdmVudChmb3JtQ2hhbmdlRXZlbnQsIGZ1bmN0aW9uIChhcGksIHNwZWMsIGV2ZW50KSB7XG4gICAgICAgICAgc3BlYy5vbkNoYW5nZShhcGksIHsgbmFtZTogZXZlbnQubmFtZSB9KTtcbiAgICAgICAgfSksXG4gICAgICAgIGZpcmVBcGlFdmVudChmb3JtQWN0aW9uRXZlbnQsIGZ1bmN0aW9uIChhcGksIHNwZWMsIGV2ZW50LCBjb21wb25lbnQpIHtcbiAgICAgICAgICB2YXIgZm9jdXNJbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBLZXlpbmcuZm9jdXNJbihjb21wb25lbnQpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIGlzRGlzYWJsZWQgPSBmdW5jdGlvbiAoZm9jdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGhhcyQxKGZvY3VzZWQsICdkaXNhYmxlZCcpIHx8IGdldE9wdChmb2N1c2VkLCAnYXJpYS1kaXNhYmxlZCcpLmV4aXN0cyhmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgIHJldHVybiB2YWwgPT09ICd0cnVlJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIHJvb3ROb2RlID0gZ2V0Um9vdE5vZGUoY29tcG9uZW50LmVsZW1lbnQpO1xuICAgICAgICAgIHZhciBjdXJyZW50ID0gYWN0aXZlKHJvb3ROb2RlKTtcbiAgICAgICAgICBzcGVjLm9uQWN0aW9uKGFwaSwge1xuICAgICAgICAgICAgbmFtZTogZXZlbnQubmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiBldmVudC52YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGFjdGl2ZShyb290Tm9kZSkuZm9sZChmb2N1c0luLCBmdW5jdGlvbiAoZm9jdXNlZCkge1xuICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQoZm9jdXNlZCkpIHtcbiAgICAgICAgICAgICAgZm9jdXNJbigpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50LmV4aXN0cyhmdW5jdGlvbiAoY3VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zJDIoZm9jdXNlZCwgY3VyKSAmJiBpc0Rpc2FibGVkKGN1cik7XG4gICAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICAgIGZvY3VzSW4oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGdldFNpbmsoKS50b09wdGlvbmFsKCkuZmlsdGVyKGZ1bmN0aW9uIChzaW5rKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFjb250YWlucyQyKHNpbmsuZWxlbWVudCwgZm9jdXNlZCk7XG4gICAgICAgICAgICAgIH0pLmVhY2goZm9jdXNJbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLFxuICAgICAgICBmaXJlQXBpRXZlbnQoZm9ybVRhYkNoYW5nZUV2ZW50LCBmdW5jdGlvbiAoYXBpLCBzcGVjLCBldmVudCkge1xuICAgICAgICAgIHNwZWMub25UYWJDaGFuZ2UoYXBpLCB7XG4gICAgICAgICAgICBuZXdUYWJOYW1lOiBldmVudC5uYW1lLFxuICAgICAgICAgICAgb2xkVGFiTmFtZTogZXZlbnQub2xkTmFtZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KSxcbiAgICAgICAgcnVuT25EZXRhY2hlZChmdW5jdGlvbiAoY29tcG9uZW50KSB7XG4gICAgICAgICAgdmFyIGFwaSA9IGdldEluc3RhbmNlQXBpKCk7XG4gICAgICAgICAgUmVwcmVzZW50aW5nLnNldFZhbHVlKGNvbXBvbmVudCwgYXBpLmdldERhdGEoKSk7XG4gICAgICAgIH0pXG4gICAgICBdKTtcbiAgICB9O1xuICAgIHZhciBTaWx2ZXJEaWFsb2dFdmVudHMgPSB7XG4gICAgICBpbml0VXJsRGlhbG9nOiBpbml0VXJsRGlhbG9nLFxuICAgICAgaW5pdERpYWxvZzogaW5pdERpYWxvZ1xuICAgIH07XG5cbiAgICB2YXIgbWFrZUJ1dHRvbiA9IGZ1bmN0aW9uIChidXR0b24sIGJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIHJlbmRlckZvb3RlckJ1dHRvbihidXR0b24sIGJ1dHRvbi50eXBlLCBiYWNrc3RhZ2UpO1xuICAgIH07XG4gICAgdmFyIGxvb2t1cCQyID0gZnVuY3Rpb24gKGNvbXBJblN5c3RlbSwgZm9vdGVyQnV0dG9ucywgYnV0dG9uTmFtZSkge1xuICAgICAgcmV0dXJuIGZpbmQoZm9vdGVyQnV0dG9ucywgZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICByZXR1cm4gYnV0dG9uLm5hbWUgPT09IGJ1dHRvbk5hbWU7XG4gICAgICB9KS5iaW5kKGZ1bmN0aW9uIChtZW1CdXR0b24pIHtcbiAgICAgICAgcmV0dXJuIG1lbUJ1dHRvbi5tZW1lbnRvLmdldE9wdChjb21wSW5TeXN0ZW0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyQ29tcG9uZW50cyA9IGZ1bmN0aW9uIChfZGF0YSwgc3RhdGUpIHtcbiAgICAgIHZhciBmb290ZXJCdXR0b25zID0gc3RhdGUubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzLmZvb3RlckJ1dHRvbnM7XG4gICAgICB9KS5nZXRPcihbXSk7XG4gICAgICB2YXIgYnV0dG9uR3JvdXBzID0gcGFydGl0aW9uKGZvb3RlckJ1dHRvbnMsIGZ1bmN0aW9uIChidXR0b24pIHtcbiAgICAgICAgcmV0dXJuIGJ1dHRvbi5hbGlnbiA9PT0gJ3N0YXJ0JztcbiAgICAgIH0pO1xuICAgICAgdmFyIG1ha2VHcm91cCA9IGZ1bmN0aW9uIChlZGdlLCBidXR0b25zKSB7XG4gICAgICAgIHJldHVybiBDb250YWluZXIuc2tldGNoKHtcbiAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBjbGFzc2VzOiBbJ3RveC1kaWFsb2dfX2Zvb3Rlci0nICsgZWRnZV1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBvbmVudHM6IG1hcChidXR0b25zLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgICByZXR1cm4gYnV0dG9uLm1lbWVudG8uYXNTcGVjKCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHN0YXJ0QnV0dG9ucyA9IG1ha2VHcm91cCgnc3RhcnQnLCBidXR0b25Hcm91cHMucGFzcyk7XG4gICAgICB2YXIgZW5kQnV0dG9ucyA9IG1ha2VHcm91cCgnZW5kJywgYnV0dG9uR3JvdXBzLmZhaWwpO1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgc3RhcnRCdXR0b25zLFxuICAgICAgICBlbmRCdXR0b25zXG4gICAgICBdO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckZvb3RlciA9IGZ1bmN0aW9uIChpbml0U3BlYywgYmFja3N0YWdlKSB7XG4gICAgICB2YXIgdXBkYXRlU3RhdGUgPSBmdW5jdGlvbiAoX2NvbXAsIGRhdGEpIHtcbiAgICAgICAgdmFyIGZvb3RlckJ1dHRvbnMgPSBtYXAoZGF0YS5idXR0b25zLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgdmFyIG1lbUJ1dHRvbiA9IHJlY29yZChtYWtlQnV0dG9uKGJ1dHRvbiwgYmFja3N0YWdlKSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IGJ1dHRvbi5uYW1lLFxuICAgICAgICAgICAgYWxpZ246IGJ1dHRvbi5hbGlnbixcbiAgICAgICAgICAgIG1lbWVudG86IG1lbUJ1dHRvblxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbG9va3VwQnlOYW1lID0gZnVuY3Rpb24gKGNvbXBJblN5c3RlbSwgYnV0dG9uTmFtZSkge1xuICAgICAgICAgIHJldHVybiBsb29rdXAkMihjb21wSW5TeXN0ZW0sIGZvb3RlckJ1dHRvbnMsIGJ1dHRvbk5hbWUpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgbG9va3VwQnlOYW1lOiBsb29rdXBCeU5hbWUsXG4gICAgICAgICAgZm9vdGVyQnV0dG9uczogZm9vdGVyQnV0dG9uc1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb206IGZyb21IdG1sJDIoJzxkaXYgY2xhc3M9XCJ0b3gtZGlhbG9nX19mb290ZXJcIj48L2Rpdj4nKSxcbiAgICAgICAgY29tcG9uZW50czogW10sXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtSZWZsZWN0aW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBjaGFubmVsOiBmb290ZXJDaGFubmVsLFxuICAgICAgICAgICAgaW5pdGlhbERhdGE6IGluaXRTcGVjLFxuICAgICAgICAgICAgdXBkYXRlU3RhdGU6IHVwZGF0ZVN0YXRlLFxuICAgICAgICAgICAgcmVuZGVyQ29tcG9uZW50czogcmVuZGVyQ29tcG9uZW50c1xuICAgICAgICAgIH0pXSlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVuZGVySW5saW5lRm9vdGVyID0gZnVuY3Rpb24gKGluaXRTcGVjLCBiYWNrc3RhZ2UpIHtcbiAgICAgIHJldHVybiByZW5kZXJGb290ZXIoaW5pdFNwZWMsIGJhY2tzdGFnZSk7XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyTW9kYWxGb290ZXIgPSBmdW5jdGlvbiAoaW5pdFNwZWMsIGJhY2tzdGFnZSkge1xuICAgICAgcmV0dXJuIE1vZGFsRGlhbG9nLnBhcnRzLmZvb3RlcihyZW5kZXJGb290ZXIoaW5pdFNwZWMsIGJhY2tzdGFnZSkpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0Q29tcEJ5TmFtZSA9IGZ1bmN0aW9uIChhY2Nlc3MsIG5hbWUpIHtcbiAgICAgIHZhciByb290ID0gYWNjZXNzLmdldFJvb3QoKTtcbiAgICAgIGlmIChyb290LmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgdmFyIGZvcm1fMSA9IENvbXBvc2luZy5nZXRDdXJyZW50KGFjY2Vzcy5nZXRGb3JtV3JhcHBlcigpKS5nZXRPcihhY2Nlc3MuZ2V0Rm9ybVdyYXBwZXIoKSk7XG4gICAgICAgIHJldHVybiBGb3JtLmdldEZpZWxkKGZvcm1fMSwgbmFtZSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGZvb3RlciA9IGFjY2Vzcy5nZXRGb290ZXIoKTtcbiAgICAgICAgICB2YXIgZm9vdGVyU3RhdGUgPSBSZWZsZWN0aW5nLmdldFN0YXRlKGZvb3Rlcik7XG4gICAgICAgICAgcmV0dXJuIGZvb3RlclN0YXRlLmdldCgpLmJpbmQoZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgIHJldHVybiBmLmxvb2t1cEJ5TmFtZShmb3JtXzEsIG5hbWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBmdW5jdGlvbiAoY29tcCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGNvbXApO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgdmFsaWRhdGVEYXRhID0gZnVuY3Rpb24gKGFjY2VzcywgZGF0YSkge1xuICAgICAgdmFyIHJvb3QgPSBhY2Nlc3MuZ2V0Um9vdCgpO1xuICAgICAgcmV0dXJuIFJlZmxlY3RpbmcuZ2V0U3RhdGUocm9vdCkuZ2V0KCkubWFwKGZ1bmN0aW9uIChkaWFsb2dTdGF0ZSkge1xuICAgICAgICByZXR1cm4gZ2V0T3JEaWUoYXNSYXcoJ2RhdGEnLCBkaWFsb2dTdGF0ZS5kYXRhVmFsaWRhdG9yLCBkYXRhKSk7XG4gICAgICB9KS5nZXRPcihkYXRhKTtcbiAgICB9O1xuICAgIHZhciBnZXREaWFsb2dBcGkgPSBmdW5jdGlvbiAoYWNjZXNzLCBkb1JlZGlhbCwgbWVudUl0ZW1TdGF0ZXMpIHtcbiAgICAgIHZhciB3aXRoUm9vdCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHZhciByb290ID0gYWNjZXNzLmdldFJvb3QoKTtcbiAgICAgICAgaWYgKHJvb3QuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgIGYocm9vdCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgZ2V0RGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJvb3QgPSBhY2Nlc3MuZ2V0Um9vdCgpO1xuICAgICAgICB2YXIgdmFsdWVDb21wID0gcm9vdC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpID8gYWNjZXNzLmdldEZvcm1XcmFwcGVyKCkgOiByb290O1xuICAgICAgICB2YXIgcmVwcmVzZW50ZWRWYWx1ZXMgPSBSZXByZXNlbnRpbmcuZ2V0VmFsdWUodmFsdWVDb21wKTtcbiAgICAgICAgdmFyIG1lbnVJdGVtQ3VycmVudFN0YXRlID0gbWFwJDIobWVudUl0ZW1TdGF0ZXMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGNlbGwuZ2V0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIHJlcHJlc2VudGVkVmFsdWVzKSwgbWVudUl0ZW1DdXJyZW50U3RhdGUpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXREYXRhID0gZnVuY3Rpb24gKG5ld0RhdGEpIHtcbiAgICAgICAgd2l0aFJvb3QoZnVuY3Rpb24gKF8pIHtcbiAgICAgICAgICB2YXIgcHJldkRhdGEgPSBpbnN0YW5jZUFwaS5nZXREYXRhKCk7XG4gICAgICAgICAgdmFyIG1lcmdlZERhdGEgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgcHJldkRhdGEpLCBuZXdEYXRhKTtcbiAgICAgICAgICB2YXIgbmV3SW50ZXJuYWxEYXRhID0gdmFsaWRhdGVEYXRhKGFjY2VzcywgbWVyZ2VkRGF0YSk7XG4gICAgICAgICAgdmFyIGZvcm0gPSBhY2Nlc3MuZ2V0Rm9ybVdyYXBwZXIoKTtcbiAgICAgICAgICBSZXByZXNlbnRpbmcuc2V0VmFsdWUoZm9ybSwgbmV3SW50ZXJuYWxEYXRhKTtcbiAgICAgICAgICBlYWNoJDEobWVudUl0ZW1TdGF0ZXMsIGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgICAgICAgICBpZiAoaGFzKG1lcmdlZERhdGEsIGspKSB7XG4gICAgICAgICAgICAgIHYuc2V0KG1lcmdlZERhdGFba10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZGlzYWJsZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIGdldENvbXBCeU5hbWUoYWNjZXNzLCBuYW1lKS5lYWNoKERpc2FibGluZy5kaXNhYmxlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZW5hYmxlID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgZ2V0Q29tcEJ5TmFtZShhY2Nlc3MsIG5hbWUpLmVhY2goRGlzYWJsaW5nLmVuYWJsZSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZvY3VzID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgZ2V0Q29tcEJ5TmFtZShhY2Nlc3MsIG5hbWUpLmVhY2goRm9jdXNpbmcuZm9jdXMpO1xuICAgICAgfTtcbiAgICAgIHZhciBibG9jayA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIGlmICghaXNTdHJpbmcobWVzc2FnZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBkaWFsb2dJbnN0YW5jZUFQSS5ibG9jayBmdW5jdGlvbiBzaG91bGQgYmUgcGFzc2VkIGEgYmxvY2tpbmcgbWVzc2FnZSBvZiB0eXBlIHN0cmluZyBhcyBhbiBhcmd1bWVudCcpO1xuICAgICAgICB9XG4gICAgICAgIHdpdGhSb290KGZ1bmN0aW9uIChyb290KSB7XG4gICAgICAgICAgZW1pdFdpdGgocm9vdCwgZm9ybUJsb2NrRXZlbnQsIHsgbWVzc2FnZTogbWVzc2FnZSB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHVuYmxvY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpdGhSb290KGZ1bmN0aW9uIChyb290KSB7XG4gICAgICAgICAgZW1pdChyb290LCBmb3JtVW5ibG9ja0V2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNob3dUYWIgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB3aXRoUm9vdChmdW5jdGlvbiAoXykge1xuICAgICAgICAgIHZhciBib2R5ID0gYWNjZXNzLmdldEJvZHkoKTtcbiAgICAgICAgICB2YXIgYm9keVN0YXRlID0gUmVmbGVjdGluZy5nZXRTdGF0ZShib2R5KTtcbiAgICAgICAgICBpZiAoYm9keVN0YXRlLmdldCgpLmV4aXN0cyhmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgICByZXR1cm4gYi5pc1RhYlBhbmVsKCk7XG4gICAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgQ29tcG9zaW5nLmdldEN1cnJlbnQoYm9keSkuZWFjaChmdW5jdGlvbiAodGFiU2VjdGlvbikge1xuICAgICAgICAgICAgICBUYWJTZWN0aW9uLnNob3dUYWIodGFiU2VjdGlvbiwgbmFtZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciByZWRpYWwgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICB3aXRoUm9vdChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICAgIHZhciBkaWFsb2dJbml0ID0gZG9SZWRpYWwoZCk7XG4gICAgICAgICAgcm9vdC5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbZGlhbG9nQ2hhbm5lbF0sIGRpYWxvZ0luaXQpO1xuICAgICAgICAgIHJvb3QuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW3RpdGxlQ2hhbm5lbF0sIGRpYWxvZ0luaXQuaW50ZXJuYWxEaWFsb2cpO1xuICAgICAgICAgIHJvb3QuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW2JvZHlDaGFubmVsXSwgZGlhbG9nSW5pdC5pbnRlcm5hbERpYWxvZyk7XG4gICAgICAgICAgcm9vdC5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbZm9vdGVyQ2hhbm5lbF0sIGRpYWxvZ0luaXQuaW50ZXJuYWxEaWFsb2cpO1xuICAgICAgICAgIGluc3RhbmNlQXBpLnNldERhdGEoZGlhbG9nSW5pdC5pbml0aWFsRGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2l0aFJvb3QoZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgICAgICBlbWl0KHJvb3QsIGZvcm1DbG9zZUV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGluc3RhbmNlQXBpID0ge1xuICAgICAgICBnZXREYXRhOiBnZXREYXRhLFxuICAgICAgICBzZXREYXRhOiBzZXREYXRhLFxuICAgICAgICBkaXNhYmxlOiBkaXNhYmxlLFxuICAgICAgICBlbmFibGU6IGVuYWJsZSxcbiAgICAgICAgZm9jdXM6IGZvY3VzLFxuICAgICAgICBibG9jazogYmxvY2ssXG4gICAgICAgIHVuYmxvY2s6IHVuYmxvY2ssXG4gICAgICAgIHNob3dUYWI6IHNob3dUYWIsXG4gICAgICAgIHJlZGlhbDogcmVkaWFsLFxuICAgICAgICBjbG9zZTogY2xvc2VcbiAgICAgIH07XG4gICAgICByZXR1cm4gaW5zdGFuY2VBcGk7XG4gICAgfTtcblxuICAgIHZhciBnZXREaWFsb2dTaXplQ2xhc3NlcyA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICBzd2l0Y2ggKHNpemUpIHtcbiAgICAgIGNhc2UgJ2xhcmdlJzpcbiAgICAgICAgcmV0dXJuIFsndG94LWRpYWxvZy0td2lkdGgtbGcnXTtcbiAgICAgIGNhc2UgJ21lZGl1bSc6XG4gICAgICAgIHJldHVybiBbJ3RveC1kaWFsb2ctLXdpZHRoLW1kJ107XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVuZGVyRGlhbG9nJDEgPSBmdW5jdGlvbiAoZGlhbG9nSW5pdCwgZXh0cmEsIGJhY2tzdGFnZSkge1xuICAgICAgdmFyIGhlYWRlciA9IGdldEhlYWRlcihkaWFsb2dJbml0LmludGVybmFsRGlhbG9nLnRpdGxlLCBiYWNrc3RhZ2UpO1xuICAgICAgdmFyIGJvZHkgPSByZW5kZXJNb2RhbEJvZHkoeyBib2R5OiBkaWFsb2dJbml0LmludGVybmFsRGlhbG9nLmJvZHkgfSwgYmFja3N0YWdlKTtcbiAgICAgIHZhciBzdG9yYWdlZE1lbnVCdXR0b25zID0gbWFwTWVudUJ1dHRvbnMoZGlhbG9nSW5pdC5pbnRlcm5hbERpYWxvZy5idXR0b25zKTtcbiAgICAgIHZhciBvYmpPZkNlbGxzID0gZXh0cmFjdENlbGxzVG9PYmplY3Qoc3RvcmFnZWRNZW51QnV0dG9ucyk7XG4gICAgICB2YXIgZm9vdGVyID0gcmVuZGVyTW9kYWxGb290ZXIoeyBidXR0b25zOiBzdG9yYWdlZE1lbnVCdXR0b25zIH0sIGJhY2tzdGFnZSk7XG4gICAgICB2YXIgZGlhbG9nRXZlbnRzID0gU2lsdmVyRGlhbG9nRXZlbnRzLmluaXREaWFsb2coZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gaW5zdGFuY2VBcGk7XG4gICAgICB9LCBnZXRFdmVudEV4dHJhcyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkaWFsb2c7XG4gICAgICB9LCBiYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycywgZXh0cmEpLCBiYWNrc3RhZ2Uuc2hhcmVkLmdldFNpbmspO1xuICAgICAgdmFyIGRpYWxvZ1NpemUgPSBnZXREaWFsb2dTaXplQ2xhc3NlcyhkaWFsb2dJbml0LmludGVybmFsRGlhbG9nLnNpemUpO1xuICAgICAgdmFyIHNwZWMgPSB7XG4gICAgICAgIGhlYWRlcjogaGVhZGVyLFxuICAgICAgICBib2R5OiBib2R5LFxuICAgICAgICBmb290ZXI6IE9wdGlvbmFsLnNvbWUoZm9vdGVyKSxcbiAgICAgICAgZXh0cmFDbGFzc2VzOiBkaWFsb2dTaXplLFxuICAgICAgICBleHRyYUJlaGF2aW91cnM6IFtdLFxuICAgICAgICBleHRyYVN0eWxlczoge31cbiAgICAgIH07XG4gICAgICB2YXIgZGlhbG9nID0gcmVuZGVyTW9kYWxEaWFsb2coc3BlYywgZGlhbG9nSW5pdCwgZGlhbG9nRXZlbnRzLCBiYWNrc3RhZ2UpO1xuICAgICAgdmFyIG1vZGFsQWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZ2V0Rm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgb3V0ZXJGb3JtID0gTW9kYWxEaWFsb2cuZ2V0Qm9keShkaWFsb2cpO1xuICAgICAgICAgIHJldHVybiBDb21wb3NpbmcuZ2V0Q3VycmVudChvdXRlckZvcm0pLmdldE9yKG91dGVyRm9ybSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ2V0Um9vdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGRpYWxvZztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldEJvZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBNb2RhbERpYWxvZy5nZXRCb2R5KGRpYWxvZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRGb290ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBNb2RhbERpYWxvZy5nZXRGb290ZXIoZGlhbG9nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldEZvcm1XcmFwcGVyOiBnZXRGb3JtXG4gICAgICAgIH07XG4gICAgICB9KCk7XG4gICAgICB2YXIgaW5zdGFuY2VBcGkgPSBnZXREaWFsb2dBcGkobW9kYWxBY2Nlc3MsIGV4dHJhLnJlZGlhbCwgb2JqT2ZDZWxscyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkaWFsb2c6IGRpYWxvZyxcbiAgICAgICAgaW5zdGFuY2VBcGk6IGluc3RhbmNlQXBpXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgcmVuZGVySW5saW5lRGlhbG9nID0gZnVuY3Rpb24gKGRpYWxvZ0luaXQsIGV4dHJhLCBiYWNrc3RhZ2UsIGFyaWFBdHRycykge1xuICAgICAgdmFyIF9hLCBfYjtcbiAgICAgIHZhciBkaWFsb2dMYWJlbElkID0gZ2VuZXJhdGUkMSgnZGlhbG9nLWxhYmVsJyk7XG4gICAgICB2YXIgZGlhbG9nQ29udGVudElkID0gZ2VuZXJhdGUkMSgnZGlhbG9nLWNvbnRlbnQnKTtcbiAgICAgIHZhciB1cGRhdGVTdGF0ZSA9IGZ1bmN0aW9uIChfY29tcCwgaW5jb21pbmcpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoaW5jb21pbmcpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZW1IZWFkZXIgPSByZWNvcmQocmVuZGVySW5saW5lSGVhZGVyKHtcbiAgICAgICAgdGl0bGU6IGRpYWxvZ0luaXQuaW50ZXJuYWxEaWFsb2cudGl0bGUsXG4gICAgICAgIGRyYWdnYWJsZTogdHJ1ZVxuICAgICAgfSwgZGlhbG9nTGFiZWxJZCwgYmFja3N0YWdlLnNoYXJlZC5wcm92aWRlcnMpKTtcbiAgICAgIHZhciBtZW1Cb2R5ID0gcmVjb3JkKHJlbmRlcklubGluZUJvZHkoeyBib2R5OiBkaWFsb2dJbml0LmludGVybmFsRGlhbG9nLmJvZHkgfSwgZGlhbG9nQ29udGVudElkLCBiYWNrc3RhZ2UsIGFyaWFBdHRycykpO1xuICAgICAgdmFyIHN0b3JhZ2VkTWVudUJ1dHRvbnMgPSBtYXBNZW51QnV0dG9ucyhkaWFsb2dJbml0LmludGVybmFsRGlhbG9nLmJ1dHRvbnMpO1xuICAgICAgdmFyIG9iak9mQ2VsbHMgPSBleHRyYWN0Q2VsbHNUb09iamVjdChzdG9yYWdlZE1lbnVCdXR0b25zKTtcbiAgICAgIHZhciBtZW1Gb290ZXIgPSByZWNvcmQocmVuZGVySW5saW5lRm9vdGVyKHsgYnV0dG9uczogc3RvcmFnZWRNZW51QnV0dG9ucyB9LCBiYWNrc3RhZ2UpKTtcbiAgICAgIHZhciBkaWFsb2dFdmVudHMgPSBTaWx2ZXJEaWFsb2dFdmVudHMuaW5pdERpYWxvZyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBpbnN0YW5jZUFwaTtcbiAgICAgIH0sIHtcbiAgICAgICAgb25CbG9jazogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgQmxvY2tpbmcuYmxvY2soZGlhbG9nLCBmdW5jdGlvbiAoX2NvbXAsIGJzKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0QnVzeVNwZWMoZXZlbnQubWVzc2FnZSwgYnMsIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VbmJsb2NrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgQmxvY2tpbmcudW5ibG9jayhkaWFsb2cpO1xuICAgICAgICB9LFxuICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGV4dHJhLmNsb3NlV2luZG93KCk7XG4gICAgICAgIH1cbiAgICAgIH0sIGJhY2tzdGFnZS5zaGFyZWQuZ2V0U2luayk7XG4gICAgICB2YXIgZGlhbG9nID0gYnVpbGQkMSh7XG4gICAgICAgIGRvbToge1xuICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgY2xhc3NlczogW1xuICAgICAgICAgICAgJ3RveC1kaWFsb2cnLFxuICAgICAgICAgICAgJ3RveC1kaWFsb2ctaW5saW5lJ1xuICAgICAgICAgIF0sXG4gICAgICAgICAgYXR0cmlidXRlczogKF9hID0geyByb2xlOiAnZGlhbG9nJyB9LCBfYVsnYXJpYS1sYWJlbGxlZGJ5J10gPSBkaWFsb2dMYWJlbElkLCBfYVsnYXJpYS1kZXNjcmliZWRieSddID0gJycgKyBkaWFsb2dDb250ZW50SWQsIF9hKVxuICAgICAgICB9LFxuICAgICAgICBldmVudE9yZGVyOiAoX2IgPSB7fSwgX2JbcmVjZWl2ZSgpXSA9IFtcbiAgICAgICAgICBSZWZsZWN0aW5nLm5hbWUoKSxcbiAgICAgICAgICBSZWNlaXZpbmcubmFtZSgpXG4gICAgICAgIF0sIF9iW2V4ZWN1dGUoKV0gPSBbJ2V4ZWN1dGUtb24tZm9ybSddLCBfYlthdHRhY2hlZFRvRG9tKCldID0gW1xuICAgICAgICAgICdyZWZsZWN0aW5nJyxcbiAgICAgICAgICAnZXhlY3V0ZS1vbi1mb3JtJ1xuICAgICAgICBdLCBfYiksXG4gICAgICAgIGJlaGF2aW91cnM6IGRlcml2ZSQxKFtcbiAgICAgICAgICBLZXlpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIG1vZGU6ICdjeWNsaWMnLFxuICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgIGVtaXQoYywgZm9ybUNsb3NlRXZlbnQpO1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh0cnVlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1c2VUYWJzdG9wQXQ6IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHJldHVybiAhaXNQc2V1ZG9TdG9wKGVsZW0pICYmIChuYW1lKGVsZW0pICE9PSAnYnV0dG9uJyB8fCBnZXQkMyhlbGVtLCAnZGlzYWJsZWQnKSAhPT0gJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgUmVmbGVjdGluZy5jb25maWcoe1xuICAgICAgICAgICAgY2hhbm5lbDogZGlhbG9nQ2hhbm5lbCxcbiAgICAgICAgICAgIHVwZGF0ZVN0YXRlOiB1cGRhdGVTdGF0ZSxcbiAgICAgICAgICAgIGluaXRpYWxEYXRhOiBkaWFsb2dJbml0XG4gICAgICAgICAgfSksXG4gICAgICAgICAgRm9jdXNpbmcuY29uZmlnKHt9KSxcbiAgICAgICAgICBjb25maWcoJ2V4ZWN1dGUtb24tZm9ybScsIGRpYWxvZ0V2ZW50cy5jb25jYXQoW3J1bk9uU291cmNlKGZvY3VzaW4oKSwgZnVuY3Rpb24gKGNvbXAsIF9zZSkge1xuICAgICAgICAgICAgICBLZXlpbmcuZm9jdXNJbihjb21wKTtcbiAgICAgICAgICAgIH0pXSkpLFxuICAgICAgICAgIEJsb2NraW5nLmNvbmZpZyh7XG4gICAgICAgICAgICBnZXRSb290OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGRpYWxvZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSksXG4gICAgICAgICAgUmVwbGFjaW5nLmNvbmZpZyh7fSksXG4gICAgICAgICAgUmVwcmVzZW50aW5nQ29uZmlncy5tZW1vcnkoe30pXG4gICAgICAgIF0pLFxuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgbWVtSGVhZGVyLmFzU3BlYygpLFxuICAgICAgICAgIG1lbUJvZHkuYXNTcGVjKCksXG4gICAgICAgICAgbWVtRm9vdGVyLmFzU3BlYygpXG4gICAgICAgIF1cbiAgICAgIH0pO1xuICAgICAgdmFyIGluc3RhbmNlQXBpID0gZ2V0RGlhbG9nQXBpKHtcbiAgICAgICAgZ2V0Um9vdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBkaWFsb2c7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEZvb3RlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBtZW1Gb290ZXIuZ2V0KGRpYWxvZyk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEJvZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbWVtQm9keS5nZXQoZGlhbG9nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Rm9ybVdyYXBwZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgYm9keSA9IG1lbUJvZHkuZ2V0KGRpYWxvZyk7XG4gICAgICAgICAgcmV0dXJuIENvbXBvc2luZy5nZXRDdXJyZW50KGJvZHkpLmdldE9yKGJvZHkpO1xuICAgICAgICB9XG4gICAgICB9LCBleHRyYS5yZWRpYWwsIG9iak9mQ2VsbHMpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGlhbG9nOiBkaWFsb2csXG4gICAgICAgIGluc3RhbmNlQXBpOiBpbnN0YW5jZUFwaVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCRoID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5VUkknKTtcblxuICAgIHZhciBnZXRVcmxEaWFsb2dBcGkgPSBmdW5jdGlvbiAocm9vdCkge1xuICAgICAgdmFyIHdpdGhSb290ID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgaWYgKHJvb3QuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgIGYocm9vdCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgYmxvY2sgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICBpZiAoIWlzU3RyaW5nKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgdXJsRGlhbG9nSW5zdGFuY2VBUEkuYmxvY2sgZnVuY3Rpb24gc2hvdWxkIGJlIHBhc3NlZCBhIGJsb2NraW5nIG1lc3NhZ2Ugb2YgdHlwZSBzdHJpbmcgYXMgYW4gYXJndW1lbnQnKTtcbiAgICAgICAgfVxuICAgICAgICB3aXRoUm9vdChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICAgIGVtaXRXaXRoKHJvb3QsIGZvcm1CbG9ja0V2ZW50LCB7IG1lc3NhZ2U6IG1lc3NhZ2UgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB1bmJsb2NrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB3aXRoUm9vdChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICAgIGVtaXQocm9vdCwgZm9ybVVuYmxvY2tFdmVudCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2l0aFJvb3QoZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgICAgICBlbWl0KHJvb3QsIGZvcm1DbG9zZUV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNlbmRNZXNzYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgd2l0aFJvb3QoZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgICAgICByb290LmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFtib2R5U2VuZE1lc3NhZ2VDaGFubmVsXSwgZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJsb2NrOiBibG9jayxcbiAgICAgICAgdW5ibG9jazogdW5ibG9jayxcbiAgICAgICAgY2xvc2U6IGNsb3NlLFxuICAgICAgICBzZW5kTWVzc2FnZTogc2VuZE1lc3NhZ2VcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBTVVBQT1JURURfTUVTU0FHRV9BQ1RJT05TID0gW1xuICAgICAgJ2luc2VydENvbnRlbnQnLFxuICAgICAgJ3NldENvbnRlbnQnLFxuICAgICAgJ2V4ZWNDb21tYW5kJyxcbiAgICAgICdjbG9zZScsXG4gICAgICAnYmxvY2snLFxuICAgICAgJ3VuYmxvY2snXG4gICAgXTtcbiAgICB2YXIgaXNTdXBwb3J0ZWRNZXNzYWdlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIHJldHVybiBpc09iamVjdChkYXRhKSAmJiBTVVBQT1JURURfTUVTU0FHRV9BQ1RJT05TLmluZGV4T2YoZGF0YS5tY2VBY3Rpb24pICE9PSAtMTtcbiAgICB9O1xuICAgIHZhciBpc0N1c3RvbU1lc3NhZ2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgcmV0dXJuICFpc1N1cHBvcnRlZE1lc3NhZ2UoZGF0YSkgJiYgaXNPYmplY3QoZGF0YSkgJiYgaGFzKGRhdGEsICdtY2VBY3Rpb24nKTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVNZXNzYWdlID0gZnVuY3Rpb24gKGVkaXRvciwgYXBpLCBkYXRhKSB7XG4gICAgICBzd2l0Y2ggKGRhdGEubWNlQWN0aW9uKSB7XG4gICAgICBjYXNlICdpbnNlcnRDb250ZW50JzpcbiAgICAgICAgZWRpdG9yLmluc2VydENvbnRlbnQoZGF0YS5jb250ZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzZXRDb250ZW50JzpcbiAgICAgICAgZWRpdG9yLnNldENvbnRlbnQoZGF0YS5jb250ZW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdleGVjQ29tbWFuZCc6XG4gICAgICAgIHZhciB1aSA9IGlzQm9vbGVhbihkYXRhLnVpKSA/IGRhdGEudWkgOiBmYWxzZTtcbiAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKGRhdGEuY21kLCB1aSwgZGF0YS52YWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnY2xvc2UnOlxuICAgICAgICBhcGkuY2xvc2UoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdibG9jayc6XG4gICAgICAgIGFwaS5ibG9jayhkYXRhLm1lc3NhZ2UpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3VuYmxvY2snOlxuICAgICAgICBhcGkudW5ibG9jaygpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciByZW5kZXJVcmxEaWFsb2cgPSBmdW5jdGlvbiAoaW50ZXJuYWxEaWFsb2csIGV4dHJhLCBlZGl0b3IsIGJhY2tzdGFnZSkge1xuICAgICAgdmFyIF9hO1xuICAgICAgdmFyIGhlYWRlciA9IGdldEhlYWRlcihpbnRlcm5hbERpYWxvZy50aXRsZSwgYmFja3N0YWdlKTtcbiAgICAgIHZhciBib2R5ID0gcmVuZGVySWZyYW1lQm9keShpbnRlcm5hbERpYWxvZyk7XG4gICAgICB2YXIgZm9vdGVyID0gaW50ZXJuYWxEaWFsb2cuYnV0dG9ucy5iaW5kKGZ1bmN0aW9uIChidXR0b25zKSB7XG4gICAgICAgIGlmIChidXR0b25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUocmVuZGVyTW9kYWxGb290ZXIoeyBidXR0b25zOiBidXR0b25zIH0sIGJhY2tzdGFnZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBkaWFsb2dFdmVudHMgPSBTaWx2ZXJEaWFsb2dFdmVudHMuaW5pdFVybERpYWxvZyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBpbnN0YW5jZUFwaTtcbiAgICAgIH0sIGdldEV2ZW50RXh0cmFzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRpYWxvZztcbiAgICAgIH0sIGJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLCBleHRyYSkpO1xuICAgICAgdmFyIHN0eWxlcyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBpbnRlcm5hbERpYWxvZy5oZWlnaHQuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICAgIH0sIGZ1bmN0aW9uIChoZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAnbWF4LWhlaWdodCc6IGhlaWdodCArICdweCdcbiAgICAgICAgfTtcbiAgICAgIH0pKSwgaW50ZXJuYWxEaWFsb2cud2lkdGguZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICAgIH0sIGZ1bmN0aW9uICh3aWR0aCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICd3aWR0aCc6IHdpZHRoICsgJ3B4JyxcbiAgICAgICAgICAnbWF4LXdpZHRoJzogd2lkdGggKyAncHgnXG4gICAgICAgIH07XG4gICAgICB9KSk7XG4gICAgICB2YXIgY2xhc3NlcyA9IGludGVybmFsRGlhbG9nLndpZHRoLmlzTm9uZSgpICYmIGludGVybmFsRGlhbG9nLmhlaWdodC5pc05vbmUoKSA/IFsndG94LWRpYWxvZy0td2lkdGgtbGcnXSA6IFtdO1xuICAgICAgdmFyIGlmcmFtZVVyaSA9IG5ldyBnbG9iYWwkaChpbnRlcm5hbERpYWxvZy51cmwsIHsgYmFzZV91cmk6IG5ldyBnbG9iYWwkaCh3aW5kb3cubG9jYXRpb24uaHJlZikgfSk7XG4gICAgICB2YXIgaWZyYW1lRG9tYWluID0gaWZyYW1lVXJpLnByb3RvY29sICsgJzovLycgKyBpZnJhbWVVcmkuaG9zdCArIChpZnJhbWVVcmkucG9ydCA/ICc6JyArIGlmcmFtZVVyaS5wb3J0IDogJycpO1xuICAgICAgdmFyIG1lc3NhZ2VIYW5kbGVyVW5iaW5kZXIgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgZXh0cmFCZWhhdmlvdXJzID0gW1xuICAgICAgICBjb25maWcoJ21lc3NhZ2VzJywgW1xuICAgICAgICAgIHJ1bk9uQXR0YWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHVuYmluZCA9IGJpbmQkMyhTdWdhckVsZW1lbnQuZnJvbURvbSh3aW5kb3cpLCAnbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgIGlmIChpZnJhbWVVcmkuaXNTYW1lT3JpZ2luKG5ldyBnbG9iYWwkaChlLnJhdy5vcmlnaW4pKSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZS5yYXcuZGF0YTtcbiAgICAgICAgICAgICAgICBpZiAoaXNTdXBwb3J0ZWRNZXNzYWdlKGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICBoYW5kbGVNZXNzYWdlKGVkaXRvciwgaW5zdGFuY2VBcGksIGRhdGEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDdXN0b21NZXNzYWdlKGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICBpbnRlcm5hbERpYWxvZy5vbk1lc3NhZ2UoaW5zdGFuY2VBcGksIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtZXNzYWdlSGFuZGxlclVuYmluZGVyLnNldChPcHRpb25hbC5zb21lKHVuYmluZCkpO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIHJ1bk9uRGV0YWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbWVzc2FnZUhhbmRsZXJVbmJpbmRlci5nZXQoKS5lYWNoKGZ1bmN0aW9uICh1bmJpbmRlcikge1xuICAgICAgICAgICAgICByZXR1cm4gdW5iaW5kZXIudW5iaW5kKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICBdKSxcbiAgICAgICAgUmVjZWl2aW5nLmNvbmZpZyh7XG4gICAgICAgICAgY2hhbm5lbHM6IChfYSA9IHt9LCBfYVtib2R5U2VuZE1lc3NhZ2VDaGFubmVsXSA9IHtcbiAgICAgICAgICAgIG9uUmVjZWl2ZTogZnVuY3Rpb24gKGNvbXAsIGRhdGEpIHtcbiAgICAgICAgICAgICAgZGVzY2VuZGFudCQxKGNvbXAuZWxlbWVudCwgJ2lmcmFtZScpLmVhY2goZnVuY3Rpb24gKGlmcmFtZUVsZSkge1xuICAgICAgICAgICAgICAgIHZhciBpZnJhbWVXaW4gPSBpZnJhbWVFbGUuZG9tLmNvbnRlbnRXaW5kb3c7XG4gICAgICAgICAgICAgICAgaWZyYW1lV2luLnBvc3RNZXNzYWdlKGRhdGEsIGlmcmFtZURvbWFpbik7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIF9hKVxuICAgICAgICB9KVxuICAgICAgXTtcbiAgICAgIHZhciBzcGVjID0ge1xuICAgICAgICBoZWFkZXI6IGhlYWRlcixcbiAgICAgICAgYm9keTogYm9keSxcbiAgICAgICAgZm9vdGVyOiBmb290ZXIsXG4gICAgICAgIGV4dHJhQ2xhc3NlczogY2xhc3NlcyxcbiAgICAgICAgZXh0cmFCZWhhdmlvdXJzOiBleHRyYUJlaGF2aW91cnMsXG4gICAgICAgIGV4dHJhU3R5bGVzOiBzdHlsZXNcbiAgICAgIH07XG4gICAgICB2YXIgZGlhbG9nID0gcmVuZGVyTW9kYWxEaWFsb2coc3BlYywgaW50ZXJuYWxEaWFsb2csIGRpYWxvZ0V2ZW50cywgYmFja3N0YWdlKTtcbiAgICAgIHZhciBpbnN0YW5jZUFwaSA9IGdldFVybERpYWxvZ0FwaShkaWFsb2cpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGlhbG9nOiBkaWFsb2csXG4gICAgICAgIGluc3RhbmNlQXBpOiBpbnN0YW5jZUFwaVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNldHVwJGMgPSBmdW5jdGlvbiAoZXh0cmFzKSB7XG4gICAgICB2YXIgc2hhcmVkQmFja3N0YWdlID0gZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQ7XG4gICAgICB2YXIgb3BlbiA9IGZ1bmN0aW9uIChtZXNzYWdlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgY2xvc2VEaWFsb2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgTW9kYWxEaWFsb2cuaGlkZShhbGVydERpYWxvZyk7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG1lbUZvb3RlckNsb3NlID0gcmVjb3JkKHJlbmRlckZvb3RlckJ1dHRvbih7XG4gICAgICAgICAgbmFtZTogJ2Nsb3NlLWFsZXJ0JyxcbiAgICAgICAgICB0ZXh0OiAnT0snLFxuICAgICAgICAgIHByaW1hcnk6IHRydWUsXG4gICAgICAgICAgYWxpZ246ICdlbmQnLFxuICAgICAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICAgICAgICBpY29uOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgfSwgJ2NhbmNlbCcsIGV4dHJhcy5iYWNrc3RhZ2UpKTtcbiAgICAgICAgdmFyIHRpdGxlU3BlYyA9IHBVbnRpdGxlZCgpO1xuICAgICAgICB2YXIgY2xvc2VTcGVjID0gcENsb3NlKGNsb3NlRGlhbG9nLCBzaGFyZWRCYWNrc3RhZ2UucHJvdmlkZXJzKTtcbiAgICAgICAgdmFyIGFsZXJ0RGlhbG9nID0gYnVpbGQkMShyZW5kZXJEaWFsb2coe1xuICAgICAgICAgIGxhenlTaW5rOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2hhcmVkQmFja3N0YWdlLmdldFNpbmsoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhlYWRlcjogaGlkZGVuSGVhZGVyKHRpdGxlU3BlYywgY2xvc2VTcGVjKSxcbiAgICAgICAgICBib2R5OiBwQm9keU1lc3NhZ2UobWVzc2FnZSwgc2hhcmVkQmFja3N0YWdlLnByb3ZpZGVycyksXG4gICAgICAgICAgZm9vdGVyOiBPcHRpb25hbC5zb21lKHBGb290ZXIocEZvb3Rlckdyb3VwKFtdLCBbbWVtRm9vdGVyQ2xvc2UuYXNTcGVjKCldKSkpLFxuICAgICAgICAgIG9uRXNjYXBlOiBjbG9zZURpYWxvZyxcbiAgICAgICAgICBleHRyYUNsYXNzZXM6IFsndG94LWFsZXJ0LWRpYWxvZyddLFxuICAgICAgICAgIGV4dHJhQmVoYXZpb3VyczogW10sXG4gICAgICAgICAgZXh0cmFTdHlsZXM6IHt9LFxuICAgICAgICAgIGRpYWxvZ0V2ZW50czogW3J1bihmb3JtQ2FuY2VsRXZlbnQsIGNsb3NlRGlhbG9nKV0sXG4gICAgICAgICAgZXZlbnRPcmRlcjoge31cbiAgICAgICAgfSkpO1xuICAgICAgICBNb2RhbERpYWxvZy5zaG93KGFsZXJ0RGlhbG9nKTtcbiAgICAgICAgdmFyIGZvb3RlckNsb3NlQnV0dG9uID0gbWVtRm9vdGVyQ2xvc2UuZ2V0KGFsZXJ0RGlhbG9nKTtcbiAgICAgICAgRm9jdXNpbmcuZm9jdXMoZm9vdGVyQ2xvc2VCdXR0b24pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7IG9wZW46IG9wZW4gfTtcbiAgICB9O1xuXG4gICAgdmFyIHNldHVwJGQgPSBmdW5jdGlvbiAoZXh0cmFzKSB7XG4gICAgICB2YXIgc2hhcmVkQmFja3N0YWdlID0gZXh0cmFzLmJhY2tzdGFnZS5zaGFyZWQ7XG4gICAgICB2YXIgb3BlbiA9IGZ1bmN0aW9uIChtZXNzYWdlLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgY2xvc2VEaWFsb2cgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICBNb2RhbERpYWxvZy5oaWRlKGNvbmZpcm1EaWFsb2cpO1xuICAgICAgICAgIGNhbGxiYWNrKHN0YXRlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG1lbUZvb3RlclllcyA9IHJlY29yZChyZW5kZXJGb290ZXJCdXR0b24oe1xuICAgICAgICAgIG5hbWU6ICd5ZXMnLFxuICAgICAgICAgIHRleHQ6ICdZZXMnLFxuICAgICAgICAgIHByaW1hcnk6IHRydWUsXG4gICAgICAgICAgYWxpZ246ICdlbmQnLFxuICAgICAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICAgICAgICBpY29uOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgfSwgJ3N1Ym1pdCcsIGV4dHJhcy5iYWNrc3RhZ2UpKTtcbiAgICAgICAgdmFyIGZvb3Rlck5vID0gcmVuZGVyRm9vdGVyQnV0dG9uKHtcbiAgICAgICAgICBuYW1lOiAnbm8nLFxuICAgICAgICAgIHRleHQ6ICdObycsXG4gICAgICAgICAgcHJpbWFyeTogZmFsc2UsXG4gICAgICAgICAgYWxpZ246ICdlbmQnLFxuICAgICAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICAgICAgICBpY29uOiBPcHRpb25hbC5ub25lKClcbiAgICAgICAgfSwgJ2NhbmNlbCcsIGV4dHJhcy5iYWNrc3RhZ2UpO1xuICAgICAgICB2YXIgdGl0bGVTcGVjID0gcFVudGl0bGVkKCk7XG4gICAgICAgIHZhciBjbG9zZVNwZWMgPSBwQ2xvc2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjbG9zZURpYWxvZyhmYWxzZSk7XG4gICAgICAgIH0sIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMpO1xuICAgICAgICB2YXIgY29uZmlybURpYWxvZyA9IGJ1aWxkJDEocmVuZGVyRGlhbG9nKHtcbiAgICAgICAgICBsYXp5U2luazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNoYXJlZEJhY2tzdGFnZS5nZXRTaW5rKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBoZWFkZXI6IGhpZGRlbkhlYWRlcih0aXRsZVNwZWMsIGNsb3NlU3BlYyksXG4gICAgICAgICAgYm9keTogcEJvZHlNZXNzYWdlKG1lc3NhZ2UsIHNoYXJlZEJhY2tzdGFnZS5wcm92aWRlcnMpLFxuICAgICAgICAgIGZvb3RlcjogT3B0aW9uYWwuc29tZShwRm9vdGVyKHBGb290ZXJHcm91cChbXSwgW1xuICAgICAgICAgICAgZm9vdGVyTm8sXG4gICAgICAgICAgICBtZW1Gb290ZXJZZXMuYXNTcGVjKClcbiAgICAgICAgICBdKSkpLFxuICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xvc2VEaWFsb2coZmFsc2UpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXh0cmFDbGFzc2VzOiBbJ3RveC1jb25maXJtLWRpYWxvZyddLFxuICAgICAgICAgIGV4dHJhQmVoYXZpb3VyczogW10sXG4gICAgICAgICAgZXh0cmFTdHlsZXM6IHt9LFxuICAgICAgICAgIGRpYWxvZ0V2ZW50czogW1xuICAgICAgICAgICAgcnVuKGZvcm1DYW5jZWxFdmVudCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gY2xvc2VEaWFsb2coZmFsc2UpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBydW4oZm9ybVN1Ym1pdEV2ZW50LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjbG9zZURpYWxvZyh0cnVlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgXSxcbiAgICAgICAgICBldmVudE9yZGVyOiB7fVxuICAgICAgICB9KSk7XG4gICAgICAgIE1vZGFsRGlhbG9nLnNob3coY29uZmlybURpYWxvZyk7XG4gICAgICAgIHZhciBmb290ZXJZZXNCdXR0b24gPSBtZW1Gb290ZXJZZXMuZ2V0KGNvbmZpcm1EaWFsb2cpO1xuICAgICAgICBGb2N1c2luZy5mb2N1cyhmb290ZXJZZXNCdXR0b24pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7IG9wZW46IG9wZW4gfTtcbiAgICB9O1xuXG4gICAgdmFyIHZhbGlkYXRlRGF0YSQxID0gZnVuY3Rpb24gKGRhdGEsIHZhbGlkYXRvcikge1xuICAgICAgcmV0dXJuIGdldE9yRGllKGFzUmF3KCdkYXRhJywgdmFsaWRhdG9yLCBkYXRhKSk7XG4gICAgfTtcbiAgICB2YXIgaXNBbGVydE9yQ29uZmlybURpYWxvZyA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIHJldHVybiBjbG9zZXN0JDQodGFyZ2V0LCAnLnRveC1hbGVydC1kaWFsb2cnKSB8fCBjbG9zZXN0JDQodGFyZ2V0LCAnLnRveC1jb25maXJtLWRpYWxvZycpO1xuICAgIH07XG4gICAgdmFyIGlubGluZUFkZGl0aW9uYWxCZWhhdmlvdXJzID0gZnVuY3Rpb24gKGVkaXRvciwgaXNTdGlja3lUb29sYmFyLCBpc1Rvb2xiYXJMb2NhdGlvblRvcCkge1xuICAgICAgaWYgKGlzU3RpY2t5VG9vbGJhciAmJiBpc1Rvb2xiYXJMb2NhdGlvblRvcCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gW0RvY2tpbmcuY29uZmlnKHtcbiAgICAgICAgICAgIGNvbnRleHR1YWw6IHtcbiAgICAgICAgICAgICAgbGF6eUNvbnRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShib3goU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldENvbnRlbnRBcmVhQ29udGFpbmVyKCkpKSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZhZGVJbkNsYXNzOiAndG94LWRpYWxvZy1kb2NrLWZhZGVpbicsXG4gICAgICAgICAgICAgIGZhZGVPdXRDbGFzczogJ3RveC1kaWFsb2ctZG9jay1mYWRlb3V0JyxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbkNsYXNzOiAndG94LWRpYWxvZy1kb2NrLXRyYW5zaXRpb24nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW9kZXM6IFsndG9wJ11cbiAgICAgICAgICB9KV07XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0dXAkZSA9IGZ1bmN0aW9uIChleHRyYXMpIHtcbiAgICAgIHZhciBiYWNrc3RhZ2UgPSBleHRyYXMuYmFja3N0YWdlO1xuICAgICAgdmFyIGVkaXRvciA9IGV4dHJhcy5lZGl0b3I7XG4gICAgICB2YXIgaXNTdGlja3lUb29sYmFyJDEgPSBpc1N0aWNreVRvb2xiYXIoZWRpdG9yKTtcbiAgICAgIHZhciBhbGVydERpYWxvZyA9IHNldHVwJGMoZXh0cmFzKTtcbiAgICAgIHZhciBjb25maXJtRGlhbG9nID0gc2V0dXAkZChleHRyYXMpO1xuICAgICAgdmFyIG9wZW4gPSBmdW5jdGlvbiAoY29uZmlnLCBwYXJhbXMsIGNsb3NlV2luZG93KSB7XG4gICAgICAgIGlmIChwYXJhbXMgIT09IHVuZGVmaW5lZCAmJiBwYXJhbXMuaW5saW5lID09PSAndG9vbGJhcicpIHtcbiAgICAgICAgICByZXR1cm4gb3BlbklubGluZURpYWxvZyhjb25maWcsIGJhY2tzdGFnZS5zaGFyZWQuYW5jaG9ycy5pbmxpbmVEaWFsb2coKSwgY2xvc2VXaW5kb3csIHBhcmFtcy5hcmlhQXR0cnMpO1xuICAgICAgICB9IGVsc2UgaWYgKHBhcmFtcyAhPT0gdW5kZWZpbmVkICYmIHBhcmFtcy5pbmxpbmUgPT09ICdjdXJzb3InKSB7XG4gICAgICAgICAgcmV0dXJuIG9wZW5JbmxpbmVEaWFsb2coY29uZmlnLCBiYWNrc3RhZ2Uuc2hhcmVkLmFuY2hvcnMuY3Vyc29yKCksIGNsb3NlV2luZG93LCBwYXJhbXMuYXJpYUF0dHJzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gb3Blbk1vZGFsRGlhbG9nKGNvbmZpZywgY2xvc2VXaW5kb3cpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIG9wZW5VcmwgPSBmdW5jdGlvbiAoY29uZmlnLCBjbG9zZVdpbmRvdykge1xuICAgICAgICByZXR1cm4gb3Blbk1vZGFsVXJsRGlhbG9nKGNvbmZpZywgY2xvc2VXaW5kb3cpO1xuICAgICAgfTtcbiAgICAgIHZhciBvcGVuTW9kYWxVcmxEaWFsb2cgPSBmdW5jdGlvbiAoY29uZmlnLCBjbG9zZVdpbmRvdykge1xuICAgICAgICB2YXIgZmFjdG9yeSA9IGZ1bmN0aW9uIChjb250ZW50cykge1xuICAgICAgICAgIHZhciBkaWFsb2cgPSByZW5kZXJVcmxEaWFsb2coY29udGVudHMsIHtcbiAgICAgICAgICAgIGNsb3NlV2luZG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIE1vZGFsRGlhbG9nLmhpZGUoZGlhbG9nLmRpYWxvZyk7XG4gICAgICAgICAgICAgIGNsb3NlV2luZG93KGRpYWxvZy5pbnN0YW5jZUFwaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgZWRpdG9yLCBiYWNrc3RhZ2UpO1xuICAgICAgICAgIE1vZGFsRGlhbG9nLnNob3coZGlhbG9nLmRpYWxvZyk7XG4gICAgICAgICAgcmV0dXJuIGRpYWxvZy5pbnN0YW5jZUFwaTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIERpYWxvZ01hbmFnZXIub3BlblVybChmYWN0b3J5LCBjb25maWcpO1xuICAgICAgfTtcbiAgICAgIHZhciBvcGVuTW9kYWxEaWFsb2cgPSBmdW5jdGlvbiAoY29uZmlnLCBjbG9zZVdpbmRvdykge1xuICAgICAgICB2YXIgZmFjdG9yeSA9IGZ1bmN0aW9uIChjb250ZW50cywgaW50ZXJuYWxJbml0aWFsRGF0YSwgZGF0YVZhbGlkYXRvcikge1xuICAgICAgICAgIHZhciBpbml0aWFsRGF0YSA9IGludGVybmFsSW5pdGlhbERhdGE7XG4gICAgICAgICAgdmFyIGRpYWxvZ0luaXQgPSB7XG4gICAgICAgICAgICBkYXRhVmFsaWRhdG9yOiBkYXRhVmFsaWRhdG9yLFxuICAgICAgICAgICAgaW5pdGlhbERhdGE6IGluaXRpYWxEYXRhLFxuICAgICAgICAgICAgaW50ZXJuYWxEaWFsb2c6IGNvbnRlbnRzXG4gICAgICAgICAgfTtcbiAgICAgICAgICB2YXIgZGlhbG9nID0gcmVuZGVyRGlhbG9nJDEoZGlhbG9nSW5pdCwge1xuICAgICAgICAgICAgcmVkaWFsOiBEaWFsb2dNYW5hZ2VyLnJlZGlhbCxcbiAgICAgICAgICAgIGNsb3NlV2luZG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIE1vZGFsRGlhbG9nLmhpZGUoZGlhbG9nLmRpYWxvZyk7XG4gICAgICAgICAgICAgIGNsb3NlV2luZG93KGRpYWxvZy5pbnN0YW5jZUFwaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgYmFja3N0YWdlKTtcbiAgICAgICAgICBNb2RhbERpYWxvZy5zaG93KGRpYWxvZy5kaWFsb2cpO1xuICAgICAgICAgIGRpYWxvZy5pbnN0YW5jZUFwaS5zZXREYXRhKGluaXRpYWxEYXRhKTtcbiAgICAgICAgICByZXR1cm4gZGlhbG9nLmluc3RhbmNlQXBpO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gRGlhbG9nTWFuYWdlci5vcGVuKGZhY3RvcnksIGNvbmZpZyk7XG4gICAgICB9O1xuICAgICAgdmFyIG9wZW5JbmxpbmVEaWFsb2cgPSBmdW5jdGlvbiAoY29uZmlnJDEsIGFuY2hvciwgY2xvc2VXaW5kb3csIGFyaWFBdHRycykge1xuICAgICAgICB2YXIgZmFjdG9yeSA9IGZ1bmN0aW9uIChjb250ZW50cywgaW50ZXJuYWxJbml0aWFsRGF0YSwgZGF0YVZhbGlkYXRvcikge1xuICAgICAgICAgIHZhciBpbml0aWFsRGF0YSA9IHZhbGlkYXRlRGF0YSQxKGludGVybmFsSW5pdGlhbERhdGEsIGRhdGFWYWxpZGF0b3IpO1xuICAgICAgICAgIHZhciBpbmxpbmVEaWFsb2cgPSB2YWx1ZSQzKCk7XG4gICAgICAgICAgdmFyIGlzVG9vbGJhckxvY2F0aW9uVG9wID0gYmFja3N0YWdlLnNoYXJlZC5oZWFkZXIuaXNQb3NpdGlvbmVkQXRUb3AoKTtcbiAgICAgICAgICB2YXIgZGlhbG9nSW5pdCA9IHtcbiAgICAgICAgICAgIGRhdGFWYWxpZGF0b3I6IGRhdGFWYWxpZGF0b3IsXG4gICAgICAgICAgICBpbml0aWFsRGF0YTogaW5pdGlhbERhdGEsXG4gICAgICAgICAgICBpbnRlcm5hbERpYWxvZzogY29udGVudHNcbiAgICAgICAgICB9O1xuICAgICAgICAgIHZhciByZWZyZXNoRG9ja2luZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBpbmxpbmVEaWFsb2cub24oZnVuY3Rpb24gKGRpYWxvZykge1xuICAgICAgICAgICAgICBJbmxpbmVWaWV3LnJlcG9zaXRpb24oZGlhbG9nKTtcbiAgICAgICAgICAgICAgRG9ja2luZy5yZWZyZXNoKGRpYWxvZyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHZhciBkaWFsb2dVaSA9IHJlbmRlcklubGluZURpYWxvZyhkaWFsb2dJbml0LCB7XG4gICAgICAgICAgICByZWRpYWw6IERpYWxvZ01hbmFnZXIucmVkaWFsLFxuICAgICAgICAgICAgY2xvc2VXaW5kb3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgaW5saW5lRGlhbG9nLm9uKElubGluZVZpZXcuaGlkZSk7XG4gICAgICAgICAgICAgIGVkaXRvci5vZmYoJ1Jlc2l6ZUVkaXRvcicsIHJlZnJlc2hEb2NraW5nKTtcbiAgICAgICAgICAgICAgaW5saW5lRGlhbG9nLmNsZWFyKCk7XG4gICAgICAgICAgICAgIGNsb3NlV2luZG93KGRpYWxvZ1VpLmluc3RhbmNlQXBpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBiYWNrc3RhZ2UsIGFyaWFBdHRycyk7XG4gICAgICAgICAgdmFyIGlubGluZURpYWxvZ0NvbXAgPSBidWlsZCQxKElubGluZVZpZXcuc2tldGNoKF9fYXNzaWduKF9fYXNzaWduKHtcbiAgICAgICAgICAgIGxhenlTaW5rOiBiYWNrc3RhZ2Uuc2hhcmVkLmdldFNpbmssXG4gICAgICAgICAgICBkb206IHtcbiAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgY2xhc3NlczogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaXJlRGlzbWlzc2FsRXZlbnRJbnN0ZWFkOiB7fVxuICAgICAgICAgIH0sIGlzVG9vbGJhckxvY2F0aW9uVG9wID8ge30gOiB7IGZpcmVSZXBvc2l0aW9uRXZlbnRJbnN0ZWFkOiB7fSB9KSwge1xuICAgICAgICAgICAgaW5saW5lQmVoYXZpb3VyczogZGVyaXZlJDEoX19zcHJlYWRBcnJheXMoW2NvbmZpZygnd2luZG93LW1hbmFnZXItaW5saW5lLWV2ZW50cycsIFtydW4oZGlzbWlzc1JlcXVlc3RlZCgpLCBmdW5jdGlvbiAoX2NvbXAsIF9zZSkge1xuICAgICAgICAgICAgICAgICAgZW1pdChkaWFsb2dVaS5kaWFsb2csIGZvcm1DYW5jZWxFdmVudCk7XG4gICAgICAgICAgICAgICAgfSldKV0sIGlubGluZUFkZGl0aW9uYWxCZWhhdmlvdXJzKGVkaXRvciwgaXNTdGlja3lUb29sYmFyJDEsIGlzVG9vbGJhckxvY2F0aW9uVG9wKSkpLFxuICAgICAgICAgICAgaXNFeHRyYVBhcnQ6IGZ1bmN0aW9uIChfY29tcCwgdGFyZ2V0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBpc0FsZXJ0T3JDb25maXJtRGlhbG9nKHRhcmdldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSkpKTtcbiAgICAgICAgICBpbmxpbmVEaWFsb2cuc2V0KGlubGluZURpYWxvZ0NvbXApO1xuICAgICAgICAgIElubGluZVZpZXcuc2hvd1dpdGhpbihpbmxpbmVEaWFsb2dDb21wLCBhbmNob3IsIHByZW1hZGUkMShkaWFsb2dVaS5kaWFsb2cpLCBPcHRpb25hbC5zb21lKGJvZHkoKSkpO1xuICAgICAgICAgIGlmICghaXNTdGlja3lUb29sYmFyJDEgfHwgIWlzVG9vbGJhckxvY2F0aW9uVG9wKSB7XG4gICAgICAgICAgICBEb2NraW5nLnJlZnJlc2goaW5saW5lRGlhbG9nQ29tcCk7XG4gICAgICAgICAgICBlZGl0b3Iub24oJ1Jlc2l6ZUVkaXRvcicsIHJlZnJlc2hEb2NraW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGlhbG9nVWkuaW5zdGFuY2VBcGkuc2V0RGF0YShpbml0aWFsRGF0YSk7XG4gICAgICAgICAgS2V5aW5nLmZvY3VzSW4oZGlhbG9nVWkuZGlhbG9nKTtcbiAgICAgICAgICByZXR1cm4gZGlhbG9nVWkuaW5zdGFuY2VBcGk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBEaWFsb2dNYW5hZ2VyLm9wZW4oZmFjdG9yeSwgY29uZmlnJDEpO1xuICAgICAgfTtcbiAgICAgIHZhciBjb25maXJtID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbmZpcm1EaWFsb2cub3BlbihtZXNzYWdlLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICBjYWxsYmFjayhzdGF0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBhbGVydCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBjYWxsYmFjaykge1xuICAgICAgICBhbGVydERpYWxvZy5vcGVuKG1lc3NhZ2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xvc2UgPSBmdW5jdGlvbiAoaW5zdGFuY2VBcGkpIHtcbiAgICAgICAgaW5zdGFuY2VBcGkuY2xvc2UoKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvcGVuOiBvcGVuLFxuICAgICAgICBvcGVuVXJsOiBvcGVuVXJsLFxuICAgICAgICBhbGVydDogYWxlcnQsXG4gICAgICAgIGNsb3NlOiBjbG9zZSxcbiAgICAgICAgY29uZmlybTogY29uZmlybVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gVGhlbWUgKCkge1xuICAgICAgZ2xvYmFsJDEuYWRkKCdzaWx2ZXInLCBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICAgIHZhciBfYSA9IHNldHVwJGIoZWRpdG9yKSwgdWlNb3RoZXJzaGlwID0gX2EudWlNb3RoZXJzaGlwLCBiYWNrc3RhZ2UgPSBfYS5iYWNrc3RhZ2UsIHJlbmRlclVJID0gX2EucmVuZGVyVUksIGdldFVpID0gX2EuZ2V0VWk7XG4gICAgICAgIEF1dG9jb21wbGV0ZXIucmVnaXN0ZXIoZWRpdG9yLCBiYWNrc3RhZ2Uuc2hhcmVkKTtcbiAgICAgICAgdmFyIHdpbmRvd01nciA9IHNldHVwJGUoe1xuICAgICAgICAgIGVkaXRvcjogZWRpdG9yLFxuICAgICAgICAgIGJhY2tzdGFnZTogYmFja3N0YWdlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHJlbmRlclVJOiByZW5kZXJVSSxcbiAgICAgICAgICBnZXRXaW5kb3dNYW5hZ2VySW1wbDogY29uc3RhbnQod2luZG93TWdyKSxcbiAgICAgICAgICBnZXROb3RpZmljYXRpb25NYW5hZ2VySW1wbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIE5vdGlmaWNhdGlvbk1hbmFnZXJJbXBsKGVkaXRvciwgeyBiYWNrc3RhZ2U6IGJhY2tzdGFnZSB9LCB1aU1vdGhlcnNoaXApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdWk6IGdldFVpKClcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIFRoZW1lKCk7XG5cbn0oKSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBOzs7Ozs7OztBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7O0EiLCJzb3VyY2VSb290IjoiIn0=