(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_image_index_js"],{

/***/ "./node_modules/tinymce/plugins/image/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/image/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "image" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/image')
//   ES2015:
//     import 'tinymce/plugins/image'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/image/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/image/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/image/plugin.js ***!
  \******************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var eq = function (t) {
      return function (a) {
        return t === a;
      };
    };
    var isString = isType('string');
    var isObject = isType('object');
    var isArray = isType('array');
    var isNull = eq(null);
    var isBoolean = isSimpleType('boolean');
    var isNullable = function (a) {
      return a === null || a === undefined;
    };
    var isNonNullable = function (a) {
      return !isNullable(a);
    };
    var isNumber = isSimpleType('number');

    var noop = function () {
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var never = constant(false);
    var always = constant(true);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var keys = Object.keys;
    var hasOwnProperty = Object.hasOwnProperty;
    var each = function (obj, f) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        f(x, i);
      }
    };
    var objAcc = function (r) {
      return function (x, i) {
        r[i] = x;
      };
    };
    var internalFilter = function (obj, pred, onTrue, onFalse) {
      var r = {};
      each(obj, function (x, i) {
        (pred(x, i) ? onTrue : onFalse)(x, i);
      });
      return r;
    };
    var filter = function (obj, pred) {
      var t = {};
      internalFilter(obj, pred, objAcc(t), noop);
      return t;
    };
    var has = function (obj, key) {
      return hasOwnProperty.call(obj, key);
    };
    var hasNonNullableKey = function (obj, key) {
      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;
    };

    var nativePush = Array.prototype.push;
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var get = function (xs, i) {
      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();
    };
    var head = function (xs) {
      return get(xs, 0);
    };
    var findMap = function (arr, f) {
      for (var i = 0; i < arr.length; i++) {
        var r = f(arr[i], i);
        if (r.isSome()) {
          return r;
        }
      }
      return Optional.none();
    };

    var Global = typeof window !== 'undefined' ? window : Function('return this;')();

    var rawSet = function (dom, key, value) {
      if (isString(value) || isBoolean(value) || isNumber(value)) {
        dom.setAttribute(key, value + '');
      } else {
        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);
        throw new Error('Attribute value was not simple');
      }
    };
    var set = function (element, key, value) {
      rawSet(element.dom, key, value);
    };
    var remove = function (element, key) {
      element.dom.removeAttribute(key);
    };

    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw new Error('HTML must have a single root node');
      }
      return fromDom(div.childNodes[0]);
    };
    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };
    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };
    var fromDom = function (node) {
      if (node === null || node === undefined) {
        throw new Error('Node cannot be null or undefined');
      }
      return { dom: node };
    };
    var fromPoint = function (docElm, x, y) {
      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);
    };
    var SugarElement = {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom,
      fromPoint: fromPoint
    };

    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');

    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Promise');

    var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');

    var hasDimensions = function (editor) {
      return editor.getParam('image_dimensions', true, 'boolean');
    };
    var hasAdvTab = function (editor) {
      return editor.getParam('image_advtab', false, 'boolean');
    };
    var hasUploadTab = function (editor) {
      return editor.getParam('image_uploadtab', true, 'boolean');
    };
    var getPrependUrl = function (editor) {
      return editor.getParam('image_prepend_url', '', 'string');
    };
    var getClassList = function (editor) {
      return editor.getParam('image_class_list');
    };
    var hasDescription = function (editor) {
      return editor.getParam('image_description', true, 'boolean');
    };
    var hasImageTitle = function (editor) {
      return editor.getParam('image_title', false, 'boolean');
    };
    var hasImageCaption = function (editor) {
      return editor.getParam('image_caption', false, 'boolean');
    };
    var getImageList = function (editor) {
      return editor.getParam('image_list', false);
    };
    var hasUploadUrl = function (editor) {
      return isNonNullable(editor.getParam('images_upload_url'));
    };
    var hasUploadHandler = function (editor) {
      return isNonNullable(editor.getParam('images_upload_handler'));
    };
    var showAccessibilityOptions = function (editor) {
      return editor.getParam('a11y_advanced_options', false, 'boolean');
    };
    var isAutomaticUploadsEnabled = function (editor) {
      return editor.getParam('automatic_uploads', true, 'boolean');
    };

    var parseIntAndGetMax = function (val1, val2) {
      return Math.max(parseInt(val1, 10), parseInt(val2, 10));
    };
    var getImageSize = function (url) {
      return new global$2(function (callback) {
        var img = document.createElement('img');
        var done = function (dimensions) {
          if (img.parentNode) {
            img.parentNode.removeChild(img);
          }
          callback(dimensions);
        };
        img.onload = function () {
          var width = parseIntAndGetMax(img.width, img.clientWidth);
          var height = parseIntAndGetMax(img.height, img.clientHeight);
          var dimensions = {
            width: width,
            height: height
          };
          done(global$2.resolve(dimensions));
        };
        img.onerror = function () {
          done(global$2.reject('Failed to get image dimensions for: ' + url));
        };
        var style = img.style;
        style.visibility = 'hidden';
        style.position = 'fixed';
        style.bottom = style.left = '0px';
        style.width = style.height = 'auto';
        document.body.appendChild(img);
        img.src = url;
      });
    };
    var removePixelSuffix = function (value) {
      if (value) {
        value = value.replace(/px$/, '');
      }
      return value;
    };
    var addPixelSuffix = function (value) {
      if (value.length > 0 && /^[0-9]+$/.test(value)) {
        value += 'px';
      }
      return value;
    };
    var mergeMargins = function (css) {
      if (css.margin) {
        var splitMargin = String(css.margin).split(' ');
        switch (splitMargin.length) {
        case 1:
          css['margin-top'] = css['margin-top'] || splitMargin[0];
          css['margin-right'] = css['margin-right'] || splitMargin[0];
          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];
          css['margin-left'] = css['margin-left'] || splitMargin[0];
          break;
        case 2:
          css['margin-top'] = css['margin-top'] || splitMargin[0];
          css['margin-right'] = css['margin-right'] || splitMargin[1];
          css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];
          css['margin-left'] = css['margin-left'] || splitMargin[1];
          break;
        case 3:
          css['margin-top'] = css['margin-top'] || splitMargin[0];
          css['margin-right'] = css['margin-right'] || splitMargin[1];
          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];
          css['margin-left'] = css['margin-left'] || splitMargin[1];
          break;
        case 4:
          css['margin-top'] = css['margin-top'] || splitMargin[0];
          css['margin-right'] = css['margin-right'] || splitMargin[1];
          css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];
          css['margin-left'] = css['margin-left'] || splitMargin[3];
        }
        delete css.margin;
      }
      return css;
    };
    var createImageList = function (editor, callback) {
      var imageList = getImageList(editor);
      if (typeof imageList === 'string') {
        global$3.send({
          url: imageList,
          success: function (text) {
            callback(JSON.parse(text));
          }
        });
      } else if (typeof imageList === 'function') {
        imageList(callback);
      } else {
        callback(imageList);
      }
    };
    var waitLoadImage = function (editor, data, imgElm) {
      var selectImage = function () {
        imgElm.onload = imgElm.onerror = null;
        if (editor.selection) {
          editor.selection.select(imgElm);
          editor.nodeChanged();
        }
      };
      imgElm.onload = function () {
        if (!data.width && !data.height && hasDimensions(editor)) {
          editor.dom.setAttribs(imgElm, {
            width: String(imgElm.clientWidth),
            height: String(imgElm.clientHeight)
          });
        }
        selectImage();
      };
      imgElm.onerror = selectImage;
    };
    var blobToDataUri = function (blob) {
      return new global$2(function (resolve, reject) {
        var reader = new FileReader();
        reader.onload = function () {
          resolve(reader.result);
        };
        reader.onerror = function () {
          reject(reader.error.message);
        };
        reader.readAsDataURL(blob);
      });
    };
    var isPlaceholderImage = function (imgElm) {
      return imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));
    };

    var DOM = global$1.DOM;
    var getHspace = function (image) {
      if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {
        return removePixelSuffix(image.style.marginLeft);
      } else {
        return '';
      }
    };
    var getVspace = function (image) {
      if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {
        return removePixelSuffix(image.style.marginTop);
      } else {
        return '';
      }
    };
    var getBorder = function (image) {
      if (image.style.borderWidth) {
        return removePixelSuffix(image.style.borderWidth);
      } else {
        return '';
      }
    };
    var getAttrib = function (image, name) {
      if (image.hasAttribute(name)) {
        return image.getAttribute(name);
      } else {
        return '';
      }
    };
    var getStyle = function (image, name) {
      return image.style[name] ? image.style[name] : '';
    };
    var hasCaption = function (image) {
      return image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';
    };
    var updateAttrib = function (image, name, value) {
      if (value === '') {
        image.removeAttribute(name);
      } else {
        image.setAttribute(name, value);
      }
    };
    var wrapInFigure = function (image) {
      var figureElm = DOM.create('figure', { class: 'image' });
      DOM.insertAfter(figureElm, image);
      figureElm.appendChild(image);
      figureElm.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));
      figureElm.contentEditable = 'false';
    };
    var removeFigure = function (image) {
      var figureElm = image.parentNode;
      DOM.insertAfter(image, figureElm);
      DOM.remove(figureElm);
    };
    var toggleCaption = function (image) {
      if (hasCaption(image)) {
        removeFigure(image);
      } else {
        wrapInFigure(image);
      }
    };
    var normalizeStyle = function (image, normalizeCss) {
      var attrValue = image.getAttribute('style');
      var value = normalizeCss(attrValue !== null ? attrValue : '');
      if (value.length > 0) {
        image.setAttribute('style', value);
        image.setAttribute('data-mce-style', value);
      } else {
        image.removeAttribute('style');
      }
    };
    var setSize = function (name, normalizeCss) {
      return function (image, name, value) {
        if (image.style[name]) {
          image.style[name] = addPixelSuffix(value);
          normalizeStyle(image, normalizeCss);
        } else {
          updateAttrib(image, name, value);
        }
      };
    };
    var getSize = function (image, name) {
      if (image.style[name]) {
        return removePixelSuffix(image.style[name]);
      } else {
        return getAttrib(image, name);
      }
    };
    var setHspace = function (image, value) {
      var pxValue = addPixelSuffix(value);
      image.style.marginLeft = pxValue;
      image.style.marginRight = pxValue;
    };
    var setVspace = function (image, value) {
      var pxValue = addPixelSuffix(value);
      image.style.marginTop = pxValue;
      image.style.marginBottom = pxValue;
    };
    var setBorder = function (image, value) {
      var pxValue = addPixelSuffix(value);
      image.style.borderWidth = pxValue;
    };
    var setBorderStyle = function (image, value) {
      image.style.borderStyle = value;
    };
    var getBorderStyle = function (image) {
      return getStyle(image, 'borderStyle');
    };
    var isFigure = function (elm) {
      return elm.nodeName === 'FIGURE';
    };
    var isImage = function (elm) {
      return elm.nodeName === 'IMG';
    };
    var getIsDecorative = function (image) {
      return DOM.getAttrib(image, 'alt').length === 0 && DOM.getAttrib(image, 'role') === 'presentation';
    };
    var getAlt = function (image) {
      if (getIsDecorative(image)) {
        return '';
      } else {
        return getAttrib(image, 'alt');
      }
    };
    var defaultData = function () {
      return {
        src: '',
        alt: '',
        title: '',
        width: '',
        height: '',
        class: '',
        style: '',
        caption: false,
        hspace: '',
        vspace: '',
        border: '',
        borderStyle: '',
        isDecorative: false
      };
    };
    var getStyleValue = function (normalizeCss, data) {
      var image = document.createElement('img');
      updateAttrib(image, 'style', data.style);
      if (getHspace(image) || data.hspace !== '') {
        setHspace(image, data.hspace);
      }
      if (getVspace(image) || data.vspace !== '') {
        setVspace(image, data.vspace);
      }
      if (getBorder(image) || data.border !== '') {
        setBorder(image, data.border);
      }
      if (getBorderStyle(image) || data.borderStyle !== '') {
        setBorderStyle(image, data.borderStyle);
      }
      return normalizeCss(image.getAttribute('style'));
    };
    var create = function (normalizeCss, data) {
      var image = document.createElement('img');
      write(normalizeCss, __assign(__assign({}, data), { caption: false }), image);
      setAlt(image, data.alt, data.isDecorative);
      if (data.caption) {
        var figure = DOM.create('figure', { class: 'image' });
        figure.appendChild(image);
        figure.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));
        figure.contentEditable = 'false';
        return figure;
      } else {
        return image;
      }
    };
    var read = function (normalizeCss, image) {
      return {
        src: getAttrib(image, 'src'),
        alt: getAlt(image),
        title: getAttrib(image, 'title'),
        width: getSize(image, 'width'),
        height: getSize(image, 'height'),
        class: getAttrib(image, 'class'),
        style: normalizeCss(getAttrib(image, 'style')),
        caption: hasCaption(image),
        hspace: getHspace(image),
        vspace: getVspace(image),
        border: getBorder(image),
        borderStyle: getStyle(image, 'borderStyle'),
        isDecorative: getIsDecorative(image)
      };
    };
    var updateProp = function (image, oldData, newData, name, set) {
      if (newData[name] !== oldData[name]) {
        set(image, name, newData[name]);
      }
    };
    var setAlt = function (image, alt, isDecorative) {
      if (isDecorative) {
        DOM.setAttrib(image, 'role', 'presentation');
        var sugarImage = SugarElement.fromDom(image);
        set(sugarImage, 'alt', '');
      } else {
        if (isNull(alt)) {
          var sugarImage = SugarElement.fromDom(image);
          remove(sugarImage, 'alt');
        } else {
          var sugarImage = SugarElement.fromDom(image);
          set(sugarImage, 'alt', alt);
        }
        if (DOM.getAttrib(image, 'role') === 'presentation') {
          DOM.setAttrib(image, 'role', '');
        }
      }
    };
    var updateAlt = function (image, oldData, newData) {
      if (newData.alt !== oldData.alt || newData.isDecorative !== oldData.isDecorative) {
        setAlt(image, newData.alt, newData.isDecorative);
      }
    };
    var normalized = function (set, normalizeCss) {
      return function (image, name, value) {
        set(image, value);
        normalizeStyle(image, normalizeCss);
      };
    };
    var write = function (normalizeCss, newData, image) {
      var oldData = read(normalizeCss, image);
      updateProp(image, oldData, newData, 'caption', function (image, _name, _value) {
        return toggleCaption(image);
      });
      updateProp(image, oldData, newData, 'src', updateAttrib);
      updateProp(image, oldData, newData, 'title', updateAttrib);
      updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));
      updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));
      updateProp(image, oldData, newData, 'class', updateAttrib);
      updateProp(image, oldData, newData, 'style', normalized(function (image, value) {
        return updateAttrib(image, 'style', value);
      }, normalizeCss));
      updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));
      updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));
      updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));
      updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));
      updateAlt(image, oldData, newData);
    };

    var normalizeCss = function (editor, cssText) {
      var css = editor.dom.styles.parse(cssText);
      var mergedCss = mergeMargins(css);
      var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));
      return editor.dom.styles.serialize(compressed);
    };
    var getSelectedImage = function (editor) {
      var imgElm = editor.selection.getNode();
      var figureElm = editor.dom.getParent(imgElm, 'figure.image');
      if (figureElm) {
        return editor.dom.select('img', figureElm)[0];
      }
      if (imgElm && (imgElm.nodeName !== 'IMG' || isPlaceholderImage(imgElm))) {
        return null;
      }
      return imgElm;
    };
    var splitTextBlock = function (editor, figure) {
      var dom = editor.dom;
      var textBlockElements = filter(editor.schema.getTextBlockElements(), function (_, parentElm) {
        return !editor.schema.isValidChild(parentElm, 'figure');
      });
      var textBlock = dom.getParent(figure.parentNode, function (node) {
        return hasNonNullableKey(textBlockElements, node.nodeName);
      }, editor.getBody());
      if (textBlock) {
        return dom.split(textBlock, figure);
      } else {
        return figure;
      }
    };
    var readImageDataFromSelection = function (editor) {
      var image = getSelectedImage(editor);
      return image ? read(function (css) {
        return normalizeCss(editor, css);
      }, image) : defaultData();
    };
    var insertImageAtCaret = function (editor, data) {
      var elm = create(function (css) {
        return normalizeCss(editor, css);
      }, data);
      editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');
      editor.focus();
      editor.selection.setContent(elm.outerHTML);
      var insertedElm = editor.dom.select('*[data-mce-id="__mcenew"]')[0];
      editor.dom.setAttrib(insertedElm, 'data-mce-id', null);
      if (isFigure(insertedElm)) {
        var figure = splitTextBlock(editor, insertedElm);
        editor.selection.select(figure);
      } else {
        editor.selection.select(insertedElm);
      }
    };
    var syncSrcAttr = function (editor, image) {
      editor.dom.setAttrib(image, 'src', image.getAttribute('src'));
    };
    var deleteImage = function (editor, image) {
      if (image) {
        var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;
        editor.dom.remove(elm);
        editor.focus();
        editor.nodeChanged();
        if (editor.dom.isEmpty(editor.getBody())) {
          editor.setContent('');
          editor.selection.setCursorLocation();
        }
      }
    };
    var writeImageDataToSelection = function (editor, data) {
      var image = getSelectedImage(editor);
      write(function (css) {
        return normalizeCss(editor, css);
      }, data, image);
      syncSrcAttr(editor, image);
      if (isFigure(image.parentNode)) {
        var figure = image.parentNode;
        splitTextBlock(editor, figure);
        editor.selection.select(image.parentNode);
      } else {
        editor.selection.select(image);
        waitLoadImage(editor, data, image);
      }
    };
    var insertOrUpdateImage = function (editor, partialData) {
      var image = getSelectedImage(editor);
      if (image) {
        var selectedImageData = read(function (css) {
          return normalizeCss(editor, css);
        }, image);
        var data = __assign(__assign({}, selectedImageData), partialData);
        if (data.src) {
          writeImageDataToSelection(editor, data);
        } else {
          deleteImage(editor, image);
        }
      } else if (partialData.src) {
        insertImageAtCaret(editor, __assign(__assign({}, defaultData()), partialData));
      }
    };

    var hasOwnProperty$1 = Object.prototype.hasOwnProperty;
    var deep = function (old, nu) {
      var bothObjects = isObject(old) && isObject(nu);
      return bothObjects ? deepMerge(old, nu) : nu;
    };
    var baseMerge = function (merger) {
      return function () {
        var objects = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          objects[_i] = arguments[_i];
        }
        if (objects.length === 0) {
          throw new Error('Can\'t merge zero objects');
        }
        var ret = {};
        for (var j = 0; j < objects.length; j++) {
          var curObject = objects[j];
          for (var key in curObject) {
            if (hasOwnProperty$1.call(curObject, key)) {
              ret[key] = merger(ret[key], curObject[key]);
            }
          }
        }
        return ret;
      };
    };
    var deepMerge = baseMerge(deep);

    var isNotEmpty = function (s) {
      return s.length > 0;
    };

    var global$4 = tinymce.util.Tools.resolve('tinymce.util.ImageUploader');

    var global$5 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var getValue = function (item) {
      return isString(item.value) ? item.value : '';
    };
    var getText = function (item) {
      if (isString(item.text)) {
        return item.text;
      } else if (isString(item.title)) {
        return item.title;
      } else {
        return '';
      }
    };
    var sanitizeList = function (list, extractValue) {
      var out = [];
      global$5.each(list, function (item) {
        var text = getText(item);
        if (item.menu !== undefined) {
          var items = sanitizeList(item.menu, extractValue);
          out.push({
            text: text,
            items: items
          });
        } else {
          var value = extractValue(item);
          out.push({
            text: text,
            value: value
          });
        }
      });
      return out;
    };
    var sanitizer = function (extracter) {
      if (extracter === void 0) {
        extracter = getValue;
      }
      return function (list) {
        if (list) {
          return Optional.from(list).map(function (list) {
            return sanitizeList(list, extracter);
          });
        } else {
          return Optional.none();
        }
      };
    };
    var sanitize = function (list) {
      return sanitizer(getValue)(list);
    };
    var isGroup = function (item) {
      return Object.prototype.hasOwnProperty.call(item, 'items');
    };
    var findEntryDelegate = function (list, value) {
      return findMap(list, function (item) {
        if (isGroup(item)) {
          return findEntryDelegate(item.items, value);
        } else if (item.value === value) {
          return Optional.some(item);
        } else {
          return Optional.none();
        }
      });
    };
    var findEntry = function (optList, value) {
      return optList.bind(function (list) {
        return findEntryDelegate(list, value);
      });
    };
    var ListUtils = {
      sanitizer: sanitizer,
      sanitize: sanitize,
      findEntry: findEntry
    };

    var makeTab = function (_info) {
      return {
        title: 'Advanced',
        name: 'advanced',
        items: [
          {
            type: 'input',
            label: 'Style',
            name: 'style'
          },
          {
            type: 'grid',
            columns: 2,
            items: [
              {
                type: 'input',
                label: 'Vertical space',
                name: 'vspace',
                inputMode: 'numeric'
              },
              {
                type: 'input',
                label: 'Horizontal space',
                name: 'hspace',
                inputMode: 'numeric'
              },
              {
                type: 'input',
                label: 'Border width',
                name: 'border',
                inputMode: 'numeric'
              },
              {
                type: 'listbox',
                name: 'borderstyle',
                label: 'Border style',
                items: [
                  {
                    text: 'Select...',
                    value: ''
                  },
                  {
                    text: 'Solid',
                    value: 'solid'
                  },
                  {
                    text: 'Dotted',
                    value: 'dotted'
                  },
                  {
                    text: 'Dashed',
                    value: 'dashed'
                  },
                  {
                    text: 'Double',
                    value: 'double'
                  },
                  {
                    text: 'Groove',
                    value: 'groove'
                  },
                  {
                    text: 'Ridge',
                    value: 'ridge'
                  },
                  {
                    text: 'Inset',
                    value: 'inset'
                  },
                  {
                    text: 'Outset',
                    value: 'outset'
                  },
                  {
                    text: 'None',
                    value: 'none'
                  },
                  {
                    text: 'Hidden',
                    value: 'hidden'
                  }
                ]
              }
            ]
          }
        ]
      };
    };
    var AdvTab = { makeTab: makeTab };

    var collect = function (editor) {
      var urlListSanitizer = ListUtils.sanitizer(function (item) {
        return editor.convertURL(item.value || item.url, 'src');
      });
      var futureImageList = new global$2(function (completer) {
        createImageList(editor, function (imageList) {
          completer(urlListSanitizer(imageList).map(function (items) {
            return flatten([
              [{
                  text: 'None',
                  value: ''
                }],
              items
            ]);
          }));
        });
      });
      var classList = ListUtils.sanitize(getClassList(editor));
      var hasAdvTab$1 = hasAdvTab(editor);
      var hasUploadTab$1 = hasUploadTab(editor);
      var hasUploadUrl$1 = hasUploadUrl(editor);
      var hasUploadHandler$1 = hasUploadHandler(editor);
      var image = readImageDataFromSelection(editor);
      var hasDescription$1 = hasDescription(editor);
      var hasImageTitle$1 = hasImageTitle(editor);
      var hasDimensions$1 = hasDimensions(editor);
      var hasImageCaption$1 = hasImageCaption(editor);
      var hasAccessibilityOptions = showAccessibilityOptions(editor);
      var automaticUploads = isAutomaticUploadsEnabled(editor);
      var prependURL = Optional.some(getPrependUrl(editor)).filter(function (preUrl) {
        return isString(preUrl) && preUrl.length > 0;
      });
      return futureImageList.then(function (imageList) {
        return {
          image: image,
          imageList: imageList,
          classList: classList,
          hasAdvTab: hasAdvTab$1,
          hasUploadTab: hasUploadTab$1,
          hasUploadUrl: hasUploadUrl$1,
          hasUploadHandler: hasUploadHandler$1,
          hasDescription: hasDescription$1,
          hasImageTitle: hasImageTitle$1,
          hasDimensions: hasDimensions$1,
          hasImageCaption: hasImageCaption$1,
          prependURL: prependURL,
          hasAccessibilityOptions: hasAccessibilityOptions,
          automaticUploads: automaticUploads
        };
      });
    };

    var makeItems = function (info) {
      var imageUrl = {
        name: 'src',
        type: 'urlinput',
        filetype: 'image',
        label: 'Source'
      };
      var imageList = info.imageList.map(function (items) {
        return {
          name: 'images',
          type: 'listbox',
          label: 'Image list',
          items: items
        };
      });
      var imageDescription = {
        name: 'alt',
        type: 'input',
        label: 'Alternative description',
        disabled: info.hasAccessibilityOptions && info.image.isDecorative
      };
      var imageTitle = {
        name: 'title',
        type: 'input',
        label: 'Image title'
      };
      var imageDimensions = {
        name: 'dimensions',
        type: 'sizeinput'
      };
      var isDecorative = {
        type: 'label',
        label: 'Accessibility',
        items: [{
            name: 'isDecorative',
            type: 'checkbox',
            label: 'Image is decorative'
          }]
      };
      var classList = info.classList.map(function (items) {
        return {
          name: 'classes',
          type: 'listbox',
          label: 'Class',
          items: items
        };
      });
      var caption = {
        type: 'label',
        label: 'Caption',
        items: [{
            type: 'checkbox',
            name: 'caption',
            label: 'Show caption'
          }]
      };
      var getDialogContainerType = function (useColumns) {
        return useColumns ? {
          type: 'grid',
          columns: 2
        } : { type: 'panel' };
      };
      return flatten([
        [imageUrl],
        imageList.toArray(),
        info.hasAccessibilityOptions && info.hasDescription ? [isDecorative] : [],
        info.hasDescription ? [imageDescription] : [],
        info.hasImageTitle ? [imageTitle] : [],
        info.hasDimensions ? [imageDimensions] : [],
        [__assign(__assign({}, getDialogContainerType(info.classList.isSome() && info.hasImageCaption)), {
            items: flatten([
              classList.toArray(),
              info.hasImageCaption ? [caption] : []
            ])
          })]
      ]);
    };
    var makeTab$1 = function (info) {
      return {
        title: 'General',
        name: 'general',
        items: makeItems(info)
      };
    };
    var MainTab = {
      makeTab: makeTab$1,
      makeItems: makeItems
    };

    var makeTab$2 = function (_info) {
      var items = [{
          type: 'dropzone',
          name: 'fileinput'
        }];
      return {
        title: 'Upload',
        name: 'upload',
        items: items
      };
    };
    var UploadTab = { makeTab: makeTab$2 };

    var createState = function (info) {
      return {
        prevImage: ListUtils.findEntry(info.imageList, info.image.src),
        prevAlt: info.image.alt,
        open: true
      };
    };
    var fromImageData = function (image) {
      return {
        src: {
          value: image.src,
          meta: {}
        },
        images: image.src,
        alt: image.alt,
        title: image.title,
        dimensions: {
          width: image.width,
          height: image.height
        },
        classes: image.class,
        caption: image.caption,
        style: image.style,
        vspace: image.vspace,
        border: image.border,
        hspace: image.hspace,
        borderstyle: image.borderStyle,
        fileinput: [],
        isDecorative: image.isDecorative
      };
    };
    var toImageData = function (data, removeEmptyAlt) {
      return {
        src: data.src.value,
        alt: data.alt.length === 0 && removeEmptyAlt ? null : data.alt,
        title: data.title,
        width: data.dimensions.width,
        height: data.dimensions.height,
        class: data.classes,
        style: data.style,
        caption: data.caption,
        hspace: data.hspace,
        vspace: data.vspace,
        border: data.border,
        borderStyle: data.borderstyle,
        isDecorative: data.isDecorative
      };
    };
    var addPrependUrl2 = function (info, srcURL) {
      if (!/^(?:[a-zA-Z]+:)?\/\//.test(srcURL)) {
        return info.prependURL.bind(function (prependUrl) {
          if (srcURL.substring(0, prependUrl.length) !== prependUrl) {
            return Optional.some(prependUrl + srcURL);
          }
          return Optional.none();
        });
      }
      return Optional.none();
    };
    var addPrependUrl = function (info, api) {
      var data = api.getData();
      addPrependUrl2(info, data.src.value).each(function (srcURL) {
        api.setData({
          src: {
            value: srcURL,
            meta: data.src.meta
          }
        });
      });
    };
    var formFillFromMeta2 = function (info, data, meta) {
      if (info.hasDescription && isString(meta.alt)) {
        data.alt = meta.alt;
      }
      if (info.hasAccessibilityOptions) {
        data.isDecorative = meta.isDecorative || data.isDecorative || false;
      }
      if (info.hasImageTitle && isString(meta.title)) {
        data.title = meta.title;
      }
      if (info.hasDimensions) {
        if (isString(meta.width)) {
          data.dimensions.width = meta.width;
        }
        if (isString(meta.height)) {
          data.dimensions.height = meta.height;
        }
      }
      if (isString(meta.class)) {
        ListUtils.findEntry(info.classList, meta.class).each(function (entry) {
          data.classes = entry.value;
        });
      }
      if (info.hasImageCaption) {
        if (isBoolean(meta.caption)) {
          data.caption = meta.caption;
        }
      }
      if (info.hasAdvTab) {
        if (isString(meta.style)) {
          data.style = meta.style;
        }
        if (isString(meta.vspace)) {
          data.vspace = meta.vspace;
        }
        if (isString(meta.border)) {
          data.border = meta.border;
        }
        if (isString(meta.hspace)) {
          data.hspace = meta.hspace;
        }
        if (isString(meta.borderstyle)) {
          data.borderstyle = meta.borderstyle;
        }
      }
    };
    var formFillFromMeta = function (info, api) {
      var data = api.getData();
      var meta = data.src.meta;
      if (meta !== undefined) {
        var newData = deepMerge({}, data);
        formFillFromMeta2(info, newData, meta);
        api.setData(newData);
      }
    };
    var calculateImageSize = function (helpers, info, state, api) {
      var data = api.getData();
      var url = data.src.value;
      var meta = data.src.meta || {};
      if (!meta.width && !meta.height && info.hasDimensions) {
        if (isNotEmpty(url)) {
          helpers.imageSize(url).then(function (size) {
            if (state.open) {
              api.setData({ dimensions: size });
            }
          }).catch(function (e) {
            return console.error(e);
          });
        } else {
          api.setData({
            dimensions: {
              width: '',
              height: ''
            }
          });
        }
      }
    };
    var updateImagesDropdown = function (info, state, api) {
      var data = api.getData();
      var image = ListUtils.findEntry(info.imageList, data.src.value);
      state.prevImage = image;
      api.setData({
        images: image.map(function (entry) {
          return entry.value;
        }).getOr('')
      });
    };
    var changeSrc = function (helpers, info, state, api) {
      addPrependUrl(info, api);
      formFillFromMeta(info, api);
      calculateImageSize(helpers, info, state, api);
      updateImagesDropdown(info, state, api);
    };
    var changeImages = function (helpers, info, state, api) {
      var data = api.getData();
      var image = ListUtils.findEntry(info.imageList, data.images);
      image.each(function (img) {
        var updateAlt = data.alt === '' || state.prevImage.map(function (image) {
          return image.text === data.alt;
        }).getOr(false);
        if (updateAlt) {
          if (img.value === '') {
            api.setData({
              src: img,
              alt: state.prevAlt
            });
          } else {
            api.setData({
              src: img,
              alt: img.text
            });
          }
        } else {
          api.setData({ src: img });
        }
      });
      state.prevImage = image;
      changeSrc(helpers, info, state, api);
    };
    var calcVSpace = function (css) {
      var matchingTopBottom = css['margin-top'] && css['margin-bottom'] && css['margin-top'] === css['margin-bottom'];
      return matchingTopBottom ? removePixelSuffix(String(css['margin-top'])) : '';
    };
    var calcHSpace = function (css) {
      var matchingLeftRight = css['margin-right'] && css['margin-left'] && css['margin-right'] === css['margin-left'];
      return matchingLeftRight ? removePixelSuffix(String(css['margin-right'])) : '';
    };
    var calcBorderWidth = function (css) {
      return css['border-width'] ? removePixelSuffix(String(css['border-width'])) : '';
    };
    var calcBorderStyle = function (css) {
      return css['border-style'] ? String(css['border-style']) : '';
    };
    var calcStyle = function (parseStyle, serializeStyle, css) {
      return serializeStyle(parseStyle(serializeStyle(css)));
    };
    var changeStyle2 = function (parseStyle, serializeStyle, data) {
      var css = mergeMargins(parseStyle(data.style));
      var dataCopy = deepMerge({}, data);
      dataCopy.vspace = calcVSpace(css);
      dataCopy.hspace = calcHSpace(css);
      dataCopy.border = calcBorderWidth(css);
      dataCopy.borderstyle = calcBorderStyle(css);
      dataCopy.style = calcStyle(parseStyle, serializeStyle, css);
      return dataCopy;
    };
    var changeStyle = function (helpers, api) {
      var data = api.getData();
      var newData = changeStyle2(helpers.parseStyle, helpers.serializeStyle, data);
      api.setData(newData);
    };
    var changeAStyle = function (helpers, info, api) {
      var data = deepMerge(fromImageData(info.image), api.getData());
      var style = getStyleValue(helpers.normalizeCss, toImageData(data, false));
      api.setData({ style: style });
    };
    var changeFileInput = function (helpers, info, state, api) {
      var data = api.getData();
      api.block('Uploading image');
      head(data.fileinput).fold(function () {
        api.unblock();
      }, function (file) {
        var blobUri = URL.createObjectURL(file);
        var finalize = function () {
          api.unblock();
          URL.revokeObjectURL(blobUri);
        };
        var updateSrcAndSwitchTab = function (url) {
          api.setData({
            src: {
              value: url,
              meta: {}
            }
          });
          api.showTab('general');
          changeSrc(helpers, info, state, api);
        };
        blobToDataUri(file).then(function (dataUrl) {
          var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);
          if (info.automaticUploads) {
            helpers.uploadImage(blobInfo).then(function (result) {
              updateSrcAndSwitchTab(result.url);
              finalize();
            }).catch(function (err) {
              finalize();
              helpers.alertErr(err);
            });
          } else {
            helpers.addToBlobCache(blobInfo);
            updateSrcAndSwitchTab(blobInfo.blobUri());
            api.unblock();
          }
        });
      });
    };
    var changeHandler = function (helpers, info, state) {
      return function (api, evt) {
        if (evt.name === 'src') {
          changeSrc(helpers, info, state, api);
        } else if (evt.name === 'images') {
          changeImages(helpers, info, state, api);
        } else if (evt.name === 'alt') {
          state.prevAlt = api.getData().alt;
        } else if (evt.name === 'style') {
          changeStyle(helpers, api);
        } else if (evt.name === 'vspace' || evt.name === 'hspace' || evt.name === 'border' || evt.name === 'borderstyle') {
          changeAStyle(helpers, info, api);
        } else if (evt.name === 'fileinput') {
          changeFileInput(helpers, info, state, api);
        } else if (evt.name === 'isDecorative') {
          if (api.getData().isDecorative) {
            api.disable('alt');
          } else {
            api.enable('alt');
          }
        }
      };
    };
    var closeHandler = function (state) {
      return function () {
        state.open = false;
      };
    };
    var makeDialogBody = function (info) {
      if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {
        var tabPanel = {
          type: 'tabpanel',
          tabs: flatten([
            [MainTab.makeTab(info)],
            info.hasAdvTab ? [AdvTab.makeTab(info)] : [],
            info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []
          ])
        };
        return tabPanel;
      } else {
        var panel = {
          type: 'panel',
          items: MainTab.makeItems(info)
        };
        return panel;
      }
    };
    var makeDialog = function (helpers) {
      return function (info) {
        var state = createState(info);
        return {
          title: 'Insert/Edit Image',
          size: 'normal',
          body: makeDialogBody(info),
          buttons: [
            {
              type: 'cancel',
              name: 'cancel',
              text: 'Cancel'
            },
            {
              type: 'submit',
              name: 'save',
              text: 'Save',
              primary: true
            }
          ],
          initialData: fromImageData(info.image),
          onSubmit: helpers.onSubmit(info),
          onChange: changeHandler(helpers, info, state),
          onClose: closeHandler(state)
        };
      };
    };
    var submitHandler = function (editor) {
      return function (info) {
        return function (api) {
          var data = deepMerge(fromImageData(info.image), api.getData());
          editor.execCommand('mceUpdateImage', false, toImageData(data, info.hasAccessibilityOptions));
          editor.editorUpload.uploadImagesAuto();
          api.close();
        };
      };
    };
    var imageSize = function (editor) {
      return function (url) {
        return getImageSize(editor.documentBaseURI.toAbsolute(url)).then(function (dimensions) {
          return {
            width: String(dimensions.width),
            height: String(dimensions.height)
          };
        });
      };
    };
    var createBlobCache = function (editor) {
      return function (file, blobUri, dataUrl) {
        return editor.editorUpload.blobCache.create({
          blob: file,
          blobUri: blobUri,
          name: file.name ? file.name.replace(/\.[^\.]+$/, '') : null,
          filename: file.name,
          base64: dataUrl.split(',')[1]
        });
      };
    };
    var addToBlobCache = function (editor) {
      return function (blobInfo) {
        editor.editorUpload.blobCache.add(blobInfo);
      };
    };
    var alertErr = function (editor) {
      return function (message) {
        editor.windowManager.alert(message);
      };
    };
    var normalizeCss$1 = function (editor) {
      return function (cssText) {
        return normalizeCss(editor, cssText);
      };
    };
    var parseStyle = function (editor) {
      return function (cssText) {
        return editor.dom.parseStyle(cssText);
      };
    };
    var serializeStyle = function (editor) {
      return function (stylesArg, name) {
        return editor.dom.serializeStyle(stylesArg, name);
      };
    };
    var uploadImage = function (editor) {
      return function (blobInfo) {
        return global$4(editor).upload([blobInfo], false).then(function (results) {
          if (results.length === 0) {
            return global$2.reject('Failed to upload image');
          } else if (results[0].status === false) {
            return global$2.reject(results[0].error.message);
          } else {
            return results[0];
          }
        });
      };
    };
    var Dialog = function (editor) {
      var helpers = {
        onSubmit: submitHandler(editor),
        imageSize: imageSize(editor),
        addToBlobCache: addToBlobCache(editor),
        createBlobCache: createBlobCache(editor),
        alertErr: alertErr(editor),
        normalizeCss: normalizeCss$1(editor),
        parseStyle: parseStyle(editor),
        serializeStyle: serializeStyle(editor),
        uploadImage: uploadImage(editor)
      };
      var open = function () {
        collect(editor).then(makeDialog(helpers)).then(editor.windowManager.open);
      };
      return { open: open };
    };

    var register = function (editor) {
      editor.addCommand('mceImage', Dialog(editor).open);
      editor.addCommand('mceUpdateImage', function (_ui, data) {
        editor.undoManager.transact(function () {
          return insertOrUpdateImage(editor, data);
        });
      });
    };

    var hasImageClass = function (node) {
      var className = node.attr('class');
      return className && /\bimage\b/.test(className);
    };
    var toggleContentEditableState = function (state) {
      return function (nodes) {
        var i = nodes.length;
        var toggleContentEditable = function (node) {
          node.attr('contenteditable', state ? 'true' : null);
        };
        while (i--) {
          var node = nodes[i];
          if (hasImageClass(node)) {
            node.attr('contenteditable', state ? 'false' : null);
            global$5.each(node.getAll('figcaption'), toggleContentEditable);
          }
        }
      };
    };
    var setup = function (editor) {
      editor.on('PreInit', function () {
        editor.parser.addNodeFilter('figure', toggleContentEditableState(true));
        editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));
      });
    };

    var register$1 = function (editor) {
      editor.ui.registry.addToggleButton('image', {
        icon: 'image',
        tooltip: 'Insert/edit image',
        onAction: Dialog(editor).open,
        onSetup: function (buttonApi) {
          return editor.selection.selectorChangedWithUnbind('img:not([data-mce-object],[data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;
        }
      });
      editor.ui.registry.addMenuItem('image', {
        icon: 'image',
        text: 'Image...',
        onAction: Dialog(editor).open
      });
      editor.ui.registry.addContextMenu('image', {
        update: function (element) {
          return isFigure(element) || isImage(element) && !isPlaceholderImage(element) ? ['image'] : [];
        }
      });
    };

    function Plugin () {
      global.add('image', function (editor) {
        setup(editor);
        register$1(editor);
        register(editor);
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX2ltYWdlX2luZGV4X2pzLmNodW5rLmpzIiwic291cmNlcyI6WyIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy9pbWFnZS9pbmRleC5qcyIsIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL2ltYWdlL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcImltYWdlXCIgcGx1Z2luIGZvciB1c2FnZSB3aXRoIG1vZHVsZSBsb2FkZXJzXG4vLyBVc2FnZTpcbi8vICAgQ29tbW9uSlM6XG4vLyAgICAgcmVxdWlyZSgndGlueW1jZS9wbHVnaW5zL2ltYWdlJylcbi8vICAgRVMyMDE1OlxuLy8gICAgIGltcG9ydCAndGlueW1jZS9wbHVnaW5zL2ltYWdlJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpXG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH07XG4gICAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgdmFyIHR5cGVPZiA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICB2YXIgdCA9IHR5cGVvZiB4O1xuICAgICAgaWYgKHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuICdudWxsJztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKEFycmF5LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHgpIHx8IHguY29uc3RydWN0b3IgJiYgeC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnQXJyYXknKSkge1xuICAgICAgICByZXR1cm4gJ2FycmF5JztcbiAgICAgIH0gZWxzZSBpZiAodCA9PT0gJ29iamVjdCcgJiYgKFN0cmluZy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZih4KSB8fCB4LmNvbnN0cnVjdG9yICYmIHguY29uc3RydWN0b3IubmFtZSA9PT0gJ1N0cmluZycpKSB7XG4gICAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlT2YodmFsdWUpID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc1NpbXBsZVR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBlcSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuIHQgPT09IGE7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzU3RyaW5nID0gaXNUeXBlKCdzdHJpbmcnKTtcbiAgICB2YXIgaXNPYmplY3QgPSBpc1R5cGUoJ29iamVjdCcpO1xuICAgIHZhciBpc0FycmF5ID0gaXNUeXBlKCdhcnJheScpO1xuICAgIHZhciBpc051bGwgPSBlcShudWxsKTtcbiAgICB2YXIgaXNCb29sZWFuID0gaXNTaW1wbGVUeXBlKCdib29sZWFuJyk7XG4gICAgdmFyIGlzTnVsbGFibGUgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGEgPT09IG51bGwgfHwgYSA9PT0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdmFyIGlzTm9uTnVsbGFibGUgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuICFpc051bGxhYmxlKGEpO1xuICAgIH07XG4gICAgdmFyIGlzTnVtYmVyID0gaXNTaW1wbGVUeXBlKCdudW1iZXInKTtcblxuICAgIHZhciBub29wID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgdmFyIGNvbnN0YW50ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG5ldmVyID0gY29uc3RhbnQoZmFsc2UpO1xuICAgIHZhciBhbHdheXMgPSBjb25zdGFudCh0cnVlKTtcblxuICAgIHZhciBub25lID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE5PTkU7XG4gICAgfTtcbiAgICB2YXIgTk9ORSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlcSA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHJldHVybiBvLmlzTm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBjYWxsID0gZnVuY3Rpb24gKHRodW5rKSB7XG4gICAgICAgIHJldHVybiB0aHVuaygpO1xuICAgICAgfTtcbiAgICAgIHZhciBpZCA9IGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIHJldHVybiBuO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIF9zKSB7XG4gICAgICAgICAgcmV0dXJuIG4oKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IG5ldmVyLFxuICAgICAgICBpc1NvbWU6IG5ldmVyLFxuICAgICAgICBpc05vbmU6IGFsd2F5cyxcbiAgICAgICAgZ2V0T3I6IGlkLFxuICAgICAgICBnZXRPclRodW5rOiBjYWxsLFxuICAgICAgICBnZXRPckRpZTogZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cgfHwgJ2Vycm9yOiBnZXRPckRpZSBjYWxsZWQgb24gbm9uZS4nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0T3JOdWxsOiBjb25zdGFudChudWxsKSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50KHVuZGVmaW5lZCksXG4gICAgICAgIG9yOiBpZCxcbiAgICAgICAgb3JUaHVuazogY2FsbCxcbiAgICAgICAgbWFwOiBub25lLFxuICAgICAgICBlYWNoOiBub29wLFxuICAgICAgICBiaW5kOiBub25lLFxuICAgICAgICBleGlzdHM6IG5ldmVyLFxuICAgICAgICBmb3JhbGw6IGFsd2F5cyxcbiAgICAgICAgZmlsdGVyOiBub25lLFxuICAgICAgICBlcXVhbHM6IGVxLFxuICAgICAgICBlcXVhbHNfOiBlcSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9TdHJpbmc6IGNvbnN0YW50KCdub25lKCknKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9KCk7XG4gICAgdmFyIHNvbWUgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgdmFyIGNvbnN0YW50X2EgPSBjb25zdGFudChhKTtcbiAgICAgIHZhciBzZWxmID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbWU7XG4gICAgICB9O1xuICAgICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZihhKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWUgPSB7XG4gICAgICAgIGZvbGQ6IGZ1bmN0aW9uIChuLCBzKSB7XG4gICAgICAgICAgcmV0dXJuIHMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzOiBmdW5jdGlvbiAodikge1xuICAgICAgICAgIHJldHVybiBhID09PSB2O1xuICAgICAgICB9LFxuICAgICAgICBpc1NvbWU6IGFsd2F5cyxcbiAgICAgICAgaXNOb25lOiBuZXZlcixcbiAgICAgICAgZ2V0T3I6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yVGh1bms6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yRGllOiBjb25zdGFudF9hLFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yVW5kZWZpbmVkOiBjb25zdGFudF9hLFxuICAgICAgICBvcjogc2VsZixcbiAgICAgICAgb3JUaHVuazogc2VsZixcbiAgICAgICAgbWFwOiBmdW5jdGlvbiAoZikge1xuICAgICAgICAgIHJldHVybiBzb21lKGYoYSkpO1xuICAgICAgICB9LFxuICAgICAgICBlYWNoOiBmdW5jdGlvbiAoZikge1xuICAgICAgICAgIGYoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmQ6IGJpbmQsXG4gICAgICAgIGV4aXN0czogYmluZCxcbiAgICAgICAgZm9yYWxsOiBiaW5kLFxuICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIGYoYSkgPyBtZSA6IE5PTkU7XG4gICAgICAgIH0sXG4gICAgICAgIHRvQXJyYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gW2FdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAnc29tZSgnICsgYSArICcpJztcbiAgICAgICAgfSxcbiAgICAgICAgZXF1YWxzOiBmdW5jdGlvbiAobykge1xuICAgICAgICAgIHJldHVybiBvLmlzKGEpO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHNfOiBmdW5jdGlvbiAobywgZWxlbWVudEVxKSB7XG4gICAgICAgICAgcmV0dXJuIG8uZm9sZChuZXZlciwgZnVuY3Rpb24gKGIpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50RXEoYSwgYik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gbWU7XG4gICAgfTtcbiAgICB2YXIgZnJvbSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQgPyBOT05FIDogc29tZSh2YWx1ZSk7XG4gICAgfTtcbiAgICB2YXIgT3B0aW9uYWwgPSB7XG4gICAgICBzb21lOiBzb21lLFxuICAgICAgbm9uZTogbm9uZSxcbiAgICAgIGZyb206IGZyb21cbiAgICB9O1xuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cztcbiAgICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QuaGFzT3duUHJvcGVydHk7XG4gICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAob2JqLCBmKSB7XG4gICAgICB2YXIgcHJvcHMgPSBrZXlzKG9iaik7XG4gICAgICBmb3IgKHZhciBrID0gMCwgbGVuID0gcHJvcHMubGVuZ3RoOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgdmFyIGkgPSBwcm9wc1trXTtcbiAgICAgICAgdmFyIHggPSBvYmpbaV07XG4gICAgICAgIGYoeCwgaSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgb2JqQWNjID0gZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoeCwgaSkge1xuICAgICAgICByW2ldID0geDtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaW50ZXJuYWxGaWx0ZXIgPSBmdW5jdGlvbiAob2JqLCBwcmVkLCBvblRydWUsIG9uRmFsc2UpIHtcbiAgICAgIHZhciByID0ge307XG4gICAgICBlYWNoKG9iaiwgZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgKHByZWQoeCwgaSkgPyBvblRydWUgOiBvbkZhbHNlKSh4LCBpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZmlsdGVyID0gZnVuY3Rpb24gKG9iaiwgcHJlZCkge1xuICAgICAgdmFyIHQgPSB7fTtcbiAgICAgIGludGVybmFsRmlsdGVyKG9iaiwgcHJlZCwgb2JqQWNjKHQpLCBub29wKTtcbiAgICAgIHJldHVybiB0O1xuICAgIH07XG4gICAgdmFyIGhhcyA9IGZ1bmN0aW9uIChvYmosIGtleSkge1xuICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpO1xuICAgIH07XG4gICAgdmFyIGhhc05vbk51bGxhYmxlS2V5ID0gZnVuY3Rpb24gKG9iaiwga2V5KSB7XG4gICAgICByZXR1cm4gaGFzKG9iaiwga2V5KSAmJiBvYmpba2V5XSAhPT0gdW5kZWZpbmVkICYmIG9ialtrZXldICE9PSBudWxsO1xuICAgIH07XG5cbiAgICB2YXIgbmF0aXZlUHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICAgIHZhciBmbGF0dGVuID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICB2YXIgciA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIGlmICghaXNBcnJheSh4c1tpXSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Fyci5mbGF0dGVuIGl0ZW0gJyArIGkgKyAnIHdhcyBub3QgYW4gYXJyYXksIGlucHV0OiAnICsgeHMpO1xuICAgICAgICB9XG4gICAgICAgIG5hdGl2ZVB1c2guYXBwbHkociwgeHNbaV0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKHhzLCBpKSB7XG4gICAgICByZXR1cm4gaSA+PSAwICYmIGkgPCB4cy5sZW5ndGggPyBPcHRpb25hbC5zb21lKHhzW2ldKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBoZWFkID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICByZXR1cm4gZ2V0KHhzLCAwKTtcbiAgICB9O1xuICAgIHZhciBmaW5kTWFwID0gZnVuY3Rpb24gKGFyciwgZikge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHIgPSBmKGFycltpXSwgaSk7XG4gICAgICAgIGlmIChyLmlzU29tZSgpKSB7XG4gICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcblxuICAgIHZhciBHbG9iYWwgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpczsnKSgpO1xuXG4gICAgdmFyIHJhd1NldCA9IGZ1bmN0aW9uIChkb20sIGtleSwgdmFsdWUpIHtcbiAgICAgIGlmIChpc1N0cmluZyh2YWx1ZSkgfHwgaXNCb29sZWFuKHZhbHVlKSB8fCBpc051bWJlcih2YWx1ZSkpIHtcbiAgICAgICAgZG9tLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlICsgJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBjYWxsIHRvIEF0dHJpYnV0ZS5zZXQuIEtleSAnLCBrZXksICc6OiBWYWx1ZSAnLCB2YWx1ZSwgJzo6IEVsZW1lbnQgJywgZG9tKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRyaWJ1dGUgdmFsdWUgd2FzIG5vdCBzaW1wbGUnKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCwga2V5LCB2YWx1ZSkge1xuICAgICAgcmF3U2V0KGVsZW1lbnQuZG9tLCBrZXksIHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciByZW1vdmUgPSBmdW5jdGlvbiAoZWxlbWVudCwga2V5KSB7XG4gICAgICBlbGVtZW50LmRvbS5yZW1vdmVBdHRyaWJ1dGUoa2V5KTtcbiAgICB9O1xuXG4gICAgdmFyIGZyb21IdG1sID0gZnVuY3Rpb24gKGh0bWwsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgZGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICBpZiAoIWRpdi5oYXNDaGlsZE5vZGVzKCkgfHwgZGl2LmNoaWxkTm9kZXMubGVuZ3RoID4gMSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdIVE1MIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlJywgaHRtbCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSFRNTCBtdXN0IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJvbURvbShkaXYuY2hpbGROb2Rlc1swXSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbVRhZyA9IGZ1bmN0aW9uICh0YWcsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgbm9kZSA9IGRvYy5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICByZXR1cm4gZnJvbURvbShub2RlKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGV4dCA9IGZ1bmN0aW9uICh0ZXh0LCBzY29wZSkge1xuICAgICAgdmFyIGRvYyA9IHNjb3BlIHx8IGRvY3VtZW50O1xuICAgICAgdmFyIG5vZGUgPSBkb2MuY3JlYXRlVGV4dE5vZGUodGV4dCk7XG4gICAgICByZXR1cm4gZnJvbURvbShub2RlKTtcbiAgICB9O1xuICAgIHZhciBmcm9tRG9tID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vZGUgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyBkb206IG5vZGUgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tUG9pbnQgPSBmdW5jdGlvbiAoZG9jRWxtLCB4LCB5KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShkb2NFbG0uZG9tLmVsZW1lbnRGcm9tUG9pbnQoeCwgeSkpLm1hcChmcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBTdWdhckVsZW1lbnQgPSB7XG4gICAgICBmcm9tSHRtbDogZnJvbUh0bWwsXG4gICAgICBmcm9tVGFnOiBmcm9tVGFnLFxuICAgICAgZnJvbVRleHQ6IGZyb21UZXh0LFxuICAgICAgZnJvbURvbTogZnJvbURvbSxcbiAgICAgIGZyb21Qb2ludDogZnJvbVBvaW50XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkMSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5ET01VdGlscycpO1xuXG4gICAgdmFyIGdsb2JhbCQyID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5Qcm9taXNlJyk7XG5cbiAgICB2YXIgZ2xvYmFsJDMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLlhIUicpO1xuXG4gICAgdmFyIGhhc0RpbWVuc2lvbnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdpbWFnZV9kaW1lbnNpb25zJywgdHJ1ZSwgJ2Jvb2xlYW4nKTtcbiAgICB9O1xuICAgIHZhciBoYXNBZHZUYWIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdpbWFnZV9hZHZ0YWInLCBmYWxzZSwgJ2Jvb2xlYW4nKTtcbiAgICB9O1xuICAgIHZhciBoYXNVcGxvYWRUYWIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdpbWFnZV91cGxvYWR0YWInLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGdldFByZXBlbmRVcmwgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdpbWFnZV9wcmVwZW5kX3VybCcsICcnLCAnc3RyaW5nJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2xhc3NMaXN0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnaW1hZ2VfY2xhc3NfbGlzdCcpO1xuICAgIH07XG4gICAgdmFyIGhhc0Rlc2NyaXB0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnaW1hZ2VfZGVzY3JpcHRpb24nLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGhhc0ltYWdlVGl0bGUgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdpbWFnZV90aXRsZScsIGZhbHNlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGhhc0ltYWdlQ2FwdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ltYWdlX2NhcHRpb24nLCBmYWxzZSwgJ2Jvb2xlYW4nKTtcbiAgICB9O1xuICAgIHZhciBnZXRJbWFnZUxpc3QgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdpbWFnZV9saXN0JywgZmFsc2UpO1xuICAgIH07XG4gICAgdmFyIGhhc1VwbG9hZFVybCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBpc05vbk51bGxhYmxlKGVkaXRvci5nZXRQYXJhbSgnaW1hZ2VzX3VwbG9hZF91cmwnKSk7XG4gICAgfTtcbiAgICB2YXIgaGFzVXBsb2FkSGFuZGxlciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBpc05vbk51bGxhYmxlKGVkaXRvci5nZXRQYXJhbSgnaW1hZ2VzX3VwbG9hZF9oYW5kbGVyJykpO1xuICAgIH07XG4gICAgdmFyIHNob3dBY2Nlc3NpYmlsaXR5T3B0aW9ucyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ExMXlfYWR2YW5jZWRfb3B0aW9ucycsIGZhbHNlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGlzQXV0b21hdGljVXBsb2Fkc0VuYWJsZWQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdhdXRvbWF0aWNfdXBsb2FkcycsIHRydWUsICdib29sZWFuJyk7XG4gICAgfTtcblxuICAgIHZhciBwYXJzZUludEFuZEdldE1heCA9IGZ1bmN0aW9uICh2YWwxLCB2YWwyKSB7XG4gICAgICByZXR1cm4gTWF0aC5tYXgocGFyc2VJbnQodmFsMSwgMTApLCBwYXJzZUludCh2YWwyLCAxMCkpO1xuICAgIH07XG4gICAgdmFyIGdldEltYWdlU2l6ZSA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgIHJldHVybiBuZXcgZ2xvYmFsJDIoZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgdmFyIGRvbmUgPSBmdW5jdGlvbiAoZGltZW5zaW9ucykge1xuICAgICAgICAgIGlmIChpbWcucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgaW1nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW1nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FsbGJhY2soZGltZW5zaW9ucyk7XG4gICAgICAgIH07XG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHdpZHRoID0gcGFyc2VJbnRBbmRHZXRNYXgoaW1nLndpZHRoLCBpbWcuY2xpZW50V2lkdGgpO1xuICAgICAgICAgIHZhciBoZWlnaHQgPSBwYXJzZUludEFuZEdldE1heChpbWcuaGVpZ2h0LCBpbWcuY2xpZW50SGVpZ2h0KTtcbiAgICAgICAgICB2YXIgZGltZW5zaW9ucyA9IHtcbiAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICAgICAgfTtcbiAgICAgICAgICBkb25lKGdsb2JhbCQyLnJlc29sdmUoZGltZW5zaW9ucykpO1xuICAgICAgICB9O1xuICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBkb25lKGdsb2JhbCQyLnJlamVjdCgnRmFpbGVkIHRvIGdldCBpbWFnZSBkaW1lbnNpb25zIGZvcjogJyArIHVybCkpO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc3R5bGUgPSBpbWcuc3R5bGU7XG4gICAgICAgIHN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICAgICAgc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBzdHlsZS5ib3R0b20gPSBzdHlsZS5sZWZ0ID0gJzBweCc7XG4gICAgICAgIHN0eWxlLndpZHRoID0gc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltZyk7XG4gICAgICAgIGltZy5zcmMgPSB1cmw7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW1vdmVQaXhlbFN1ZmZpeCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvcHgkLywgJycpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH07XG4gICAgdmFyIGFkZFBpeGVsU3VmZml4ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCAmJiAvXlswLTldKyQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHZhbHVlICs9ICdweCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfTtcbiAgICB2YXIgbWVyZ2VNYXJnaW5zID0gZnVuY3Rpb24gKGNzcykge1xuICAgICAgaWYgKGNzcy5tYXJnaW4pIHtcbiAgICAgICAgdmFyIHNwbGl0TWFyZ2luID0gU3RyaW5nKGNzcy5tYXJnaW4pLnNwbGl0KCcgJyk7XG4gICAgICAgIHN3aXRjaCAoc3BsaXRNYXJnaW4ubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICBjc3NbJ21hcmdpbi10b3AnXSA9IGNzc1snbWFyZ2luLXRvcCddIHx8IHNwbGl0TWFyZ2luWzBdO1xuICAgICAgICAgIGNzc1snbWFyZ2luLXJpZ2h0J10gPSBjc3NbJ21hcmdpbi1yaWdodCddIHx8IHNwbGl0TWFyZ2luWzBdO1xuICAgICAgICAgIGNzc1snbWFyZ2luLWJvdHRvbSddID0gY3NzWydtYXJnaW4tYm90dG9tJ10gfHwgc3BsaXRNYXJnaW5bMF07XG4gICAgICAgICAgY3NzWydtYXJnaW4tbGVmdCddID0gY3NzWydtYXJnaW4tbGVmdCddIHx8IHNwbGl0TWFyZ2luWzBdO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgY3NzWydtYXJnaW4tdG9wJ10gPSBjc3NbJ21hcmdpbi10b3AnXSB8fCBzcGxpdE1hcmdpblswXTtcbiAgICAgICAgICBjc3NbJ21hcmdpbi1yaWdodCddID0gY3NzWydtYXJnaW4tcmlnaHQnXSB8fCBzcGxpdE1hcmdpblsxXTtcbiAgICAgICAgICBjc3NbJ21hcmdpbi1ib3R0b20nXSA9IGNzc1snbWFyZ2luLWJvdHRvbSddIHx8IHNwbGl0TWFyZ2luWzBdO1xuICAgICAgICAgIGNzc1snbWFyZ2luLWxlZnQnXSA9IGNzc1snbWFyZ2luLWxlZnQnXSB8fCBzcGxpdE1hcmdpblsxXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgIGNzc1snbWFyZ2luLXRvcCddID0gY3NzWydtYXJnaW4tdG9wJ10gfHwgc3BsaXRNYXJnaW5bMF07XG4gICAgICAgICAgY3NzWydtYXJnaW4tcmlnaHQnXSA9IGNzc1snbWFyZ2luLXJpZ2h0J10gfHwgc3BsaXRNYXJnaW5bMV07XG4gICAgICAgICAgY3NzWydtYXJnaW4tYm90dG9tJ10gPSBjc3NbJ21hcmdpbi1ib3R0b20nXSB8fCBzcGxpdE1hcmdpblsyXTtcbiAgICAgICAgICBjc3NbJ21hcmdpbi1sZWZ0J10gPSBjc3NbJ21hcmdpbi1sZWZ0J10gfHwgc3BsaXRNYXJnaW5bMV07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgNDpcbiAgICAgICAgICBjc3NbJ21hcmdpbi10b3AnXSA9IGNzc1snbWFyZ2luLXRvcCddIHx8IHNwbGl0TWFyZ2luWzBdO1xuICAgICAgICAgIGNzc1snbWFyZ2luLXJpZ2h0J10gPSBjc3NbJ21hcmdpbi1yaWdodCddIHx8IHNwbGl0TWFyZ2luWzFdO1xuICAgICAgICAgIGNzc1snbWFyZ2luLWJvdHRvbSddID0gY3NzWydtYXJnaW4tYm90dG9tJ10gfHwgc3BsaXRNYXJnaW5bMl07XG4gICAgICAgICAgY3NzWydtYXJnaW4tbGVmdCddID0gY3NzWydtYXJnaW4tbGVmdCddIHx8IHNwbGl0TWFyZ2luWzNdO1xuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSBjc3MubWFyZ2luO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNzcztcbiAgICB9O1xuICAgIHZhciBjcmVhdGVJbWFnZUxpc3QgPSBmdW5jdGlvbiAoZWRpdG9yLCBjYWxsYmFjaykge1xuICAgICAgdmFyIGltYWdlTGlzdCA9IGdldEltYWdlTGlzdChlZGl0b3IpO1xuICAgICAgaWYgKHR5cGVvZiBpbWFnZUxpc3QgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGdsb2JhbCQzLnNlbmQoe1xuICAgICAgICAgIHVybDogaW1hZ2VMaXN0LFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgICBjYWxsYmFjayhKU09OLnBhcnNlKHRleHQpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW1hZ2VMaXN0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGltYWdlTGlzdChjYWxsYmFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhpbWFnZUxpc3QpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHdhaXRMb2FkSW1hZ2UgPSBmdW5jdGlvbiAoZWRpdG9yLCBkYXRhLCBpbWdFbG0pIHtcbiAgICAgIHZhciBzZWxlY3RJbWFnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaW1nRWxtLm9ubG9hZCA9IGltZ0VsbS5vbmVycm9yID0gbnVsbDtcbiAgICAgICAgaWYgKGVkaXRvci5zZWxlY3Rpb24pIHtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNlbGVjdChpbWdFbG0pO1xuICAgICAgICAgIGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaW1nRWxtLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFkYXRhLndpZHRoICYmICFkYXRhLmhlaWdodCAmJiBoYXNEaW1lbnNpb25zKGVkaXRvcikpIHtcbiAgICAgICAgICBlZGl0b3IuZG9tLnNldEF0dHJpYnMoaW1nRWxtLCB7XG4gICAgICAgICAgICB3aWR0aDogU3RyaW5nKGltZ0VsbS5jbGllbnRXaWR0aCksXG4gICAgICAgICAgICBoZWlnaHQ6IFN0cmluZyhpbWdFbG0uY2xpZW50SGVpZ2h0KVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHNlbGVjdEltYWdlKCk7XG4gICAgICB9O1xuICAgICAgaW1nRWxtLm9uZXJyb3IgPSBzZWxlY3RJbWFnZTtcbiAgICB9O1xuICAgIHZhciBibG9iVG9EYXRhVXJpID0gZnVuY3Rpb24gKGJsb2IpIHtcbiAgICAgIHJldHVybiBuZXcgZ2xvYmFsJDIoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXNvbHZlKHJlYWRlci5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZWplY3QocmVhZGVyLmVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9O1xuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzUGxhY2Vob2xkZXJJbWFnZSA9IGZ1bmN0aW9uIChpbWdFbG0pIHtcbiAgICAgIHJldHVybiBpbWdFbG0ubm9kZU5hbWUgPT09ICdJTUcnICYmIChpbWdFbG0uaGFzQXR0cmlidXRlKCdkYXRhLW1jZS1vYmplY3QnKSB8fCBpbWdFbG0uaGFzQXR0cmlidXRlKCdkYXRhLW1jZS1wbGFjZWhvbGRlcicpKTtcbiAgICB9O1xuXG4gICAgdmFyIERPTSA9IGdsb2JhbCQxLkRPTTtcbiAgICB2YXIgZ2V0SHNwYWNlID0gZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICBpZiAoaW1hZ2Uuc3R5bGUubWFyZ2luTGVmdCAmJiBpbWFnZS5zdHlsZS5tYXJnaW5SaWdodCAmJiBpbWFnZS5zdHlsZS5tYXJnaW5MZWZ0ID09PSBpbWFnZS5zdHlsZS5tYXJnaW5SaWdodCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlUGl4ZWxTdWZmaXgoaW1hZ2Uuc3R5bGUubWFyZ2luTGVmdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0VnNwYWNlID0gZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICBpZiAoaW1hZ2Uuc3R5bGUubWFyZ2luVG9wICYmIGltYWdlLnN0eWxlLm1hcmdpbkJvdHRvbSAmJiBpbWFnZS5zdHlsZS5tYXJnaW5Ub3AgPT09IGltYWdlLnN0eWxlLm1hcmdpbkJvdHRvbSkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlUGl4ZWxTdWZmaXgoaW1hZ2Uuc3R5bGUubWFyZ2luVG9wKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRCb3JkZXIgPSBmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgIGlmIChpbWFnZS5zdHlsZS5ib3JkZXJXaWR0aCkge1xuICAgICAgICByZXR1cm4gcmVtb3ZlUGl4ZWxTdWZmaXgoaW1hZ2Uuc3R5bGUuYm9yZGVyV2lkdGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGdldEF0dHJpYiA9IGZ1bmN0aW9uIChpbWFnZSwgbmFtZSkge1xuICAgICAgaWYgKGltYWdlLmhhc0F0dHJpYnV0ZShuYW1lKSkge1xuICAgICAgICByZXR1cm4gaW1hZ2UuZ2V0QXR0cmlidXRlKG5hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGdldFN0eWxlID0gZnVuY3Rpb24gKGltYWdlLCBuYW1lKSB7XG4gICAgICByZXR1cm4gaW1hZ2Uuc3R5bGVbbmFtZV0gPyBpbWFnZS5zdHlsZVtuYW1lXSA6ICcnO1xuICAgIH07XG4gICAgdmFyIGhhc0NhcHRpb24gPSBmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgIHJldHVybiBpbWFnZS5wYXJlbnROb2RlICE9PSBudWxsICYmIGltYWdlLnBhcmVudE5vZGUubm9kZU5hbWUgPT09ICdGSUdVUkUnO1xuICAgIH07XG4gICAgdmFyIHVwZGF0ZUF0dHJpYiA9IGZ1bmN0aW9uIChpbWFnZSwgbmFtZSwgdmFsdWUpIHtcbiAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgaW1hZ2UucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB3cmFwSW5GaWd1cmUgPSBmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgIHZhciBmaWd1cmVFbG0gPSBET00uY3JlYXRlKCdmaWd1cmUnLCB7IGNsYXNzOiAnaW1hZ2UnIH0pO1xuICAgICAgRE9NLmluc2VydEFmdGVyKGZpZ3VyZUVsbSwgaW1hZ2UpO1xuICAgICAgZmlndXJlRWxtLmFwcGVuZENoaWxkKGltYWdlKTtcbiAgICAgIGZpZ3VyZUVsbS5hcHBlbmRDaGlsZChET00uY3JlYXRlKCdmaWdjYXB0aW9uJywgeyBjb250ZW50RWRpdGFibGU6ICd0cnVlJyB9LCAnQ2FwdGlvbicpKTtcbiAgICAgIGZpZ3VyZUVsbS5jb250ZW50RWRpdGFibGUgPSAnZmFsc2UnO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZUZpZ3VyZSA9IGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgdmFyIGZpZ3VyZUVsbSA9IGltYWdlLnBhcmVudE5vZGU7XG4gICAgICBET00uaW5zZXJ0QWZ0ZXIoaW1hZ2UsIGZpZ3VyZUVsbSk7XG4gICAgICBET00ucmVtb3ZlKGZpZ3VyZUVsbSk7XG4gICAgfTtcbiAgICB2YXIgdG9nZ2xlQ2FwdGlvbiA9IGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgaWYgKGhhc0NhcHRpb24oaW1hZ2UpKSB7XG4gICAgICAgIHJlbW92ZUZpZ3VyZShpbWFnZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3cmFwSW5GaWd1cmUoaW1hZ2UpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZVN0eWxlID0gZnVuY3Rpb24gKGltYWdlLCBub3JtYWxpemVDc3MpIHtcbiAgICAgIHZhciBhdHRyVmFsdWUgPSBpbWFnZS5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICB2YXIgdmFsdWUgPSBub3JtYWxpemVDc3MoYXR0clZhbHVlICE9PSBudWxsID8gYXR0clZhbHVlIDogJycpO1xuICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdzdHlsZScsIHZhbHVlKTtcbiAgICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLW1jZS1zdHlsZScsIHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGltYWdlLnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXRTaXplID0gZnVuY3Rpb24gKG5hbWUsIG5vcm1hbGl6ZUNzcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpbWFnZSwgbmFtZSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKGltYWdlLnN0eWxlW25hbWVdKSB7XG4gICAgICAgICAgaW1hZ2Uuc3R5bGVbbmFtZV0gPSBhZGRQaXhlbFN1ZmZpeCh2YWx1ZSk7XG4gICAgICAgICAgbm9ybWFsaXplU3R5bGUoaW1hZ2UsIG5vcm1hbGl6ZUNzcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXBkYXRlQXR0cmliKGltYWdlLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0U2l6ZSA9IGZ1bmN0aW9uIChpbWFnZSwgbmFtZSkge1xuICAgICAgaWYgKGltYWdlLnN0eWxlW25hbWVdKSB7XG4gICAgICAgIHJldHVybiByZW1vdmVQaXhlbFN1ZmZpeChpbWFnZS5zdHlsZVtuYW1lXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZ2V0QXR0cmliKGltYWdlLCBuYW1lKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXRIc3BhY2UgPSBmdW5jdGlvbiAoaW1hZ2UsIHZhbHVlKSB7XG4gICAgICB2YXIgcHhWYWx1ZSA9IGFkZFBpeGVsU3VmZml4KHZhbHVlKTtcbiAgICAgIGltYWdlLnN0eWxlLm1hcmdpbkxlZnQgPSBweFZhbHVlO1xuICAgICAgaW1hZ2Uuc3R5bGUubWFyZ2luUmlnaHQgPSBweFZhbHVlO1xuICAgIH07XG4gICAgdmFyIHNldFZzcGFjZSA9IGZ1bmN0aW9uIChpbWFnZSwgdmFsdWUpIHtcbiAgICAgIHZhciBweFZhbHVlID0gYWRkUGl4ZWxTdWZmaXgodmFsdWUpO1xuICAgICAgaW1hZ2Uuc3R5bGUubWFyZ2luVG9wID0gcHhWYWx1ZTtcbiAgICAgIGltYWdlLnN0eWxlLm1hcmdpbkJvdHRvbSA9IHB4VmFsdWU7XG4gICAgfTtcbiAgICB2YXIgc2V0Qm9yZGVyID0gZnVuY3Rpb24gKGltYWdlLCB2YWx1ZSkge1xuICAgICAgdmFyIHB4VmFsdWUgPSBhZGRQaXhlbFN1ZmZpeCh2YWx1ZSk7XG4gICAgICBpbWFnZS5zdHlsZS5ib3JkZXJXaWR0aCA9IHB4VmFsdWU7XG4gICAgfTtcbiAgICB2YXIgc2V0Qm9yZGVyU3R5bGUgPSBmdW5jdGlvbiAoaW1hZ2UsIHZhbHVlKSB7XG4gICAgICBpbWFnZS5zdHlsZS5ib3JkZXJTdHlsZSA9IHZhbHVlO1xuICAgIH07XG4gICAgdmFyIGdldEJvcmRlclN0eWxlID0gZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICByZXR1cm4gZ2V0U3R5bGUoaW1hZ2UsICdib3JkZXJTdHlsZScpO1xuICAgIH07XG4gICAgdmFyIGlzRmlndXJlID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGVsbS5ub2RlTmFtZSA9PT0gJ0ZJR1VSRSc7XG4gICAgfTtcbiAgICB2YXIgaXNJbWFnZSA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBlbG0ubm9kZU5hbWUgPT09ICdJTUcnO1xuICAgIH07XG4gICAgdmFyIGdldElzRGVjb3JhdGl2ZSA9IGZ1bmN0aW9uIChpbWFnZSkge1xuICAgICAgcmV0dXJuIERPTS5nZXRBdHRyaWIoaW1hZ2UsICdhbHQnKS5sZW5ndGggPT09IDAgJiYgRE9NLmdldEF0dHJpYihpbWFnZSwgJ3JvbGUnKSA9PT0gJ3ByZXNlbnRhdGlvbic7XG4gICAgfTtcbiAgICB2YXIgZ2V0QWx0ID0gZnVuY3Rpb24gKGltYWdlKSB7XG4gICAgICBpZiAoZ2V0SXNEZWNvcmF0aXZlKGltYWdlKSkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZ2V0QXR0cmliKGltYWdlLCAnYWx0Jyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzcmM6ICcnLFxuICAgICAgICBhbHQ6ICcnLFxuICAgICAgICB0aXRsZTogJycsXG4gICAgICAgIHdpZHRoOiAnJyxcbiAgICAgICAgaGVpZ2h0OiAnJyxcbiAgICAgICAgY2xhc3M6ICcnLFxuICAgICAgICBzdHlsZTogJycsXG4gICAgICAgIGNhcHRpb246IGZhbHNlLFxuICAgICAgICBoc3BhY2U6ICcnLFxuICAgICAgICB2c3BhY2U6ICcnLFxuICAgICAgICBib3JkZXI6ICcnLFxuICAgICAgICBib3JkZXJTdHlsZTogJycsXG4gICAgICAgIGlzRGVjb3JhdGl2ZTogZmFsc2VcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0U3R5bGVWYWx1ZSA9IGZ1bmN0aW9uIChub3JtYWxpemVDc3MsIGRhdGEpIHtcbiAgICAgIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgdXBkYXRlQXR0cmliKGltYWdlLCAnc3R5bGUnLCBkYXRhLnN0eWxlKTtcbiAgICAgIGlmIChnZXRIc3BhY2UoaW1hZ2UpIHx8IGRhdGEuaHNwYWNlICE9PSAnJykge1xuICAgICAgICBzZXRIc3BhY2UoaW1hZ2UsIGRhdGEuaHNwYWNlKTtcbiAgICAgIH1cbiAgICAgIGlmIChnZXRWc3BhY2UoaW1hZ2UpIHx8IGRhdGEudnNwYWNlICE9PSAnJykge1xuICAgICAgICBzZXRWc3BhY2UoaW1hZ2UsIGRhdGEudnNwYWNlKTtcbiAgICAgIH1cbiAgICAgIGlmIChnZXRCb3JkZXIoaW1hZ2UpIHx8IGRhdGEuYm9yZGVyICE9PSAnJykge1xuICAgICAgICBzZXRCb3JkZXIoaW1hZ2UsIGRhdGEuYm9yZGVyKTtcbiAgICAgIH1cbiAgICAgIGlmIChnZXRCb3JkZXJTdHlsZShpbWFnZSkgfHwgZGF0YS5ib3JkZXJTdHlsZSAhPT0gJycpIHtcbiAgICAgICAgc2V0Qm9yZGVyU3R5bGUoaW1hZ2UsIGRhdGEuYm9yZGVyU3R5bGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5vcm1hbGl6ZUNzcyhpbWFnZS5nZXRBdHRyaWJ1dGUoJ3N0eWxlJykpO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZSA9IGZ1bmN0aW9uIChub3JtYWxpemVDc3MsIGRhdGEpIHtcbiAgICAgIHZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgd3JpdGUobm9ybWFsaXplQ3NzLCBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZGF0YSksIHsgY2FwdGlvbjogZmFsc2UgfSksIGltYWdlKTtcbiAgICAgIHNldEFsdChpbWFnZSwgZGF0YS5hbHQsIGRhdGEuaXNEZWNvcmF0aXZlKTtcbiAgICAgIGlmIChkYXRhLmNhcHRpb24pIHtcbiAgICAgICAgdmFyIGZpZ3VyZSA9IERPTS5jcmVhdGUoJ2ZpZ3VyZScsIHsgY2xhc3M6ICdpbWFnZScgfSk7XG4gICAgICAgIGZpZ3VyZS5hcHBlbmRDaGlsZChpbWFnZSk7XG4gICAgICAgIGZpZ3VyZS5hcHBlbmRDaGlsZChET00uY3JlYXRlKCdmaWdjYXB0aW9uJywgeyBjb250ZW50RWRpdGFibGU6ICd0cnVlJyB9LCAnQ2FwdGlvbicpKTtcbiAgICAgICAgZmlndXJlLmNvbnRlbnRFZGl0YWJsZSA9ICdmYWxzZSc7XG4gICAgICAgIHJldHVybiBmaWd1cmU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gaW1hZ2U7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVhZCA9IGZ1bmN0aW9uIChub3JtYWxpemVDc3MsIGltYWdlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzcmM6IGdldEF0dHJpYihpbWFnZSwgJ3NyYycpLFxuICAgICAgICBhbHQ6IGdldEFsdChpbWFnZSksXG4gICAgICAgIHRpdGxlOiBnZXRBdHRyaWIoaW1hZ2UsICd0aXRsZScpLFxuICAgICAgICB3aWR0aDogZ2V0U2l6ZShpbWFnZSwgJ3dpZHRoJyksXG4gICAgICAgIGhlaWdodDogZ2V0U2l6ZShpbWFnZSwgJ2hlaWdodCcpLFxuICAgICAgICBjbGFzczogZ2V0QXR0cmliKGltYWdlLCAnY2xhc3MnKSxcbiAgICAgICAgc3R5bGU6IG5vcm1hbGl6ZUNzcyhnZXRBdHRyaWIoaW1hZ2UsICdzdHlsZScpKSxcbiAgICAgICAgY2FwdGlvbjogaGFzQ2FwdGlvbihpbWFnZSksXG4gICAgICAgIGhzcGFjZTogZ2V0SHNwYWNlKGltYWdlKSxcbiAgICAgICAgdnNwYWNlOiBnZXRWc3BhY2UoaW1hZ2UpLFxuICAgICAgICBib3JkZXI6IGdldEJvcmRlcihpbWFnZSksXG4gICAgICAgIGJvcmRlclN0eWxlOiBnZXRTdHlsZShpbWFnZSwgJ2JvcmRlclN0eWxlJyksXG4gICAgICAgIGlzRGVjb3JhdGl2ZTogZ2V0SXNEZWNvcmF0aXZlKGltYWdlKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB1cGRhdGVQcm9wID0gZnVuY3Rpb24gKGltYWdlLCBvbGREYXRhLCBuZXdEYXRhLCBuYW1lLCBzZXQpIHtcbiAgICAgIGlmIChuZXdEYXRhW25hbWVdICE9PSBvbGREYXRhW25hbWVdKSB7XG4gICAgICAgIHNldChpbWFnZSwgbmFtZSwgbmV3RGF0YVtuYW1lXSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0QWx0ID0gZnVuY3Rpb24gKGltYWdlLCBhbHQsIGlzRGVjb3JhdGl2ZSkge1xuICAgICAgaWYgKGlzRGVjb3JhdGl2ZSkge1xuICAgICAgICBET00uc2V0QXR0cmliKGltYWdlLCAncm9sZScsICdwcmVzZW50YXRpb24nKTtcbiAgICAgICAgdmFyIHN1Z2FySW1hZ2UgPSBTdWdhckVsZW1lbnQuZnJvbURvbShpbWFnZSk7XG4gICAgICAgIHNldChzdWdhckltYWdlLCAnYWx0JywgJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGlzTnVsbChhbHQpKSB7XG4gICAgICAgICAgdmFyIHN1Z2FySW1hZ2UgPSBTdWdhckVsZW1lbnQuZnJvbURvbShpbWFnZSk7XG4gICAgICAgICAgcmVtb3ZlKHN1Z2FySW1hZ2UsICdhbHQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgc3VnYXJJbWFnZSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGltYWdlKTtcbiAgICAgICAgICBzZXQoc3VnYXJJbWFnZSwgJ2FsdCcsIGFsdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKERPTS5nZXRBdHRyaWIoaW1hZ2UsICdyb2xlJykgPT09ICdwcmVzZW50YXRpb24nKSB7XG4gICAgICAgICAgRE9NLnNldEF0dHJpYihpbWFnZSwgJ3JvbGUnLCAnJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB1cGRhdGVBbHQgPSBmdW5jdGlvbiAoaW1hZ2UsIG9sZERhdGEsIG5ld0RhdGEpIHtcbiAgICAgIGlmIChuZXdEYXRhLmFsdCAhPT0gb2xkRGF0YS5hbHQgfHwgbmV3RGF0YS5pc0RlY29yYXRpdmUgIT09IG9sZERhdGEuaXNEZWNvcmF0aXZlKSB7XG4gICAgICAgIHNldEFsdChpbWFnZSwgbmV3RGF0YS5hbHQsIG5ld0RhdGEuaXNEZWNvcmF0aXZlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBub3JtYWxpemVkID0gZnVuY3Rpb24gKHNldCwgbm9ybWFsaXplQ3NzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGltYWdlLCBuYW1lLCB2YWx1ZSkge1xuICAgICAgICBzZXQoaW1hZ2UsIHZhbHVlKTtcbiAgICAgICAgbm9ybWFsaXplU3R5bGUoaW1hZ2UsIG5vcm1hbGl6ZUNzcyk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHdyaXRlID0gZnVuY3Rpb24gKG5vcm1hbGl6ZUNzcywgbmV3RGF0YSwgaW1hZ2UpIHtcbiAgICAgIHZhciBvbGREYXRhID0gcmVhZChub3JtYWxpemVDc3MsIGltYWdlKTtcbiAgICAgIHVwZGF0ZVByb3AoaW1hZ2UsIG9sZERhdGEsIG5ld0RhdGEsICdjYXB0aW9uJywgZnVuY3Rpb24gKGltYWdlLCBfbmFtZSwgX3ZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0b2dnbGVDYXB0aW9uKGltYWdlKTtcbiAgICAgIH0pO1xuICAgICAgdXBkYXRlUHJvcChpbWFnZSwgb2xkRGF0YSwgbmV3RGF0YSwgJ3NyYycsIHVwZGF0ZUF0dHJpYik7XG4gICAgICB1cGRhdGVQcm9wKGltYWdlLCBvbGREYXRhLCBuZXdEYXRhLCAndGl0bGUnLCB1cGRhdGVBdHRyaWIpO1xuICAgICAgdXBkYXRlUHJvcChpbWFnZSwgb2xkRGF0YSwgbmV3RGF0YSwgJ3dpZHRoJywgc2V0U2l6ZSgnd2lkdGgnLCBub3JtYWxpemVDc3MpKTtcbiAgICAgIHVwZGF0ZVByb3AoaW1hZ2UsIG9sZERhdGEsIG5ld0RhdGEsICdoZWlnaHQnLCBzZXRTaXplKCdoZWlnaHQnLCBub3JtYWxpemVDc3MpKTtcbiAgICAgIHVwZGF0ZVByb3AoaW1hZ2UsIG9sZERhdGEsIG5ld0RhdGEsICdjbGFzcycsIHVwZGF0ZUF0dHJpYik7XG4gICAgICB1cGRhdGVQcm9wKGltYWdlLCBvbGREYXRhLCBuZXdEYXRhLCAnc3R5bGUnLCBub3JtYWxpemVkKGZ1bmN0aW9uIChpbWFnZSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHVwZGF0ZUF0dHJpYihpbWFnZSwgJ3N0eWxlJywgdmFsdWUpO1xuICAgICAgfSwgbm9ybWFsaXplQ3NzKSk7XG4gICAgICB1cGRhdGVQcm9wKGltYWdlLCBvbGREYXRhLCBuZXdEYXRhLCAnaHNwYWNlJywgbm9ybWFsaXplZChzZXRIc3BhY2UsIG5vcm1hbGl6ZUNzcykpO1xuICAgICAgdXBkYXRlUHJvcChpbWFnZSwgb2xkRGF0YSwgbmV3RGF0YSwgJ3ZzcGFjZScsIG5vcm1hbGl6ZWQoc2V0VnNwYWNlLCBub3JtYWxpemVDc3MpKTtcbiAgICAgIHVwZGF0ZVByb3AoaW1hZ2UsIG9sZERhdGEsIG5ld0RhdGEsICdib3JkZXInLCBub3JtYWxpemVkKHNldEJvcmRlciwgbm9ybWFsaXplQ3NzKSk7XG4gICAgICB1cGRhdGVQcm9wKGltYWdlLCBvbGREYXRhLCBuZXdEYXRhLCAnYm9yZGVyU3R5bGUnLCBub3JtYWxpemVkKHNldEJvcmRlclN0eWxlLCBub3JtYWxpemVDc3MpKTtcbiAgICAgIHVwZGF0ZUFsdChpbWFnZSwgb2xkRGF0YSwgbmV3RGF0YSk7XG4gICAgfTtcblxuICAgIHZhciBub3JtYWxpemVDc3MgPSBmdW5jdGlvbiAoZWRpdG9yLCBjc3NUZXh0KSB7XG4gICAgICB2YXIgY3NzID0gZWRpdG9yLmRvbS5zdHlsZXMucGFyc2UoY3NzVGV4dCk7XG4gICAgICB2YXIgbWVyZ2VkQ3NzID0gbWVyZ2VNYXJnaW5zKGNzcyk7XG4gICAgICB2YXIgY29tcHJlc3NlZCA9IGVkaXRvci5kb20uc3R5bGVzLnBhcnNlKGVkaXRvci5kb20uc3R5bGVzLnNlcmlhbGl6ZShtZXJnZWRDc3MpKTtcbiAgICAgIHJldHVybiBlZGl0b3IuZG9tLnN0eWxlcy5zZXJpYWxpemUoY29tcHJlc3NlZCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U2VsZWN0ZWRJbWFnZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBpbWdFbG0gPSBlZGl0b3Iuc2VsZWN0aW9uLmdldE5vZGUoKTtcbiAgICAgIHZhciBmaWd1cmVFbG0gPSBlZGl0b3IuZG9tLmdldFBhcmVudChpbWdFbG0sICdmaWd1cmUuaW1hZ2UnKTtcbiAgICAgIGlmIChmaWd1cmVFbG0pIHtcbiAgICAgICAgcmV0dXJuIGVkaXRvci5kb20uc2VsZWN0KCdpbWcnLCBmaWd1cmVFbG0pWzBdO1xuICAgICAgfVxuICAgICAgaWYgKGltZ0VsbSAmJiAoaW1nRWxtLm5vZGVOYW1lICE9PSAnSU1HJyB8fCBpc1BsYWNlaG9sZGVySW1hZ2UoaW1nRWxtKSkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gaW1nRWxtO1xuICAgIH07XG4gICAgdmFyIHNwbGl0VGV4dEJsb2NrID0gZnVuY3Rpb24gKGVkaXRvciwgZmlndXJlKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciB0ZXh0QmxvY2tFbGVtZW50cyA9IGZpbHRlcihlZGl0b3Iuc2NoZW1hLmdldFRleHRCbG9ja0VsZW1lbnRzKCksIGZ1bmN0aW9uIChfLCBwYXJlbnRFbG0pIHtcbiAgICAgICAgcmV0dXJuICFlZGl0b3Iuc2NoZW1hLmlzVmFsaWRDaGlsZChwYXJlbnRFbG0sICdmaWd1cmUnKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHRleHRCbG9jayA9IGRvbS5nZXRQYXJlbnQoZmlndXJlLnBhcmVudE5vZGUsIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiBoYXNOb25OdWxsYWJsZUtleSh0ZXh0QmxvY2tFbGVtZW50cywgbm9kZS5ub2RlTmFtZSk7XG4gICAgICB9LCBlZGl0b3IuZ2V0Qm9keSgpKTtcbiAgICAgIGlmICh0ZXh0QmxvY2spIHtcbiAgICAgICAgcmV0dXJuIGRvbS5zcGxpdCh0ZXh0QmxvY2ssIGZpZ3VyZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmlndXJlO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlYWRJbWFnZURhdGFGcm9tU2VsZWN0aW9uID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGltYWdlID0gZ2V0U2VsZWN0ZWRJbWFnZShlZGl0b3IpO1xuICAgICAgcmV0dXJuIGltYWdlID8gcmVhZChmdW5jdGlvbiAoY3NzKSB7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVDc3MoZWRpdG9yLCBjc3MpO1xuICAgICAgfSwgaW1hZ2UpIDogZGVmYXVsdERhdGEoKTtcbiAgICB9O1xuICAgIHZhciBpbnNlcnRJbWFnZUF0Q2FyZXQgPSBmdW5jdGlvbiAoZWRpdG9yLCBkYXRhKSB7XG4gICAgICB2YXIgZWxtID0gY3JlYXRlKGZ1bmN0aW9uIChjc3MpIHtcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZUNzcyhlZGl0b3IsIGNzcyk7XG4gICAgICB9LCBkYXRhKTtcbiAgICAgIGVkaXRvci5kb20uc2V0QXR0cmliKGVsbSwgJ2RhdGEtbWNlLWlkJywgJ19fbWNlbmV3Jyk7XG4gICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Q29udGVudChlbG0ub3V0ZXJIVE1MKTtcbiAgICAgIHZhciBpbnNlcnRlZEVsbSA9IGVkaXRvci5kb20uc2VsZWN0KCcqW2RhdGEtbWNlLWlkPVwiX19tY2VuZXdcIl0nKVswXTtcbiAgICAgIGVkaXRvci5kb20uc2V0QXR0cmliKGluc2VydGVkRWxtLCAnZGF0YS1tY2UtaWQnLCBudWxsKTtcbiAgICAgIGlmIChpc0ZpZ3VyZShpbnNlcnRlZEVsbSkpIHtcbiAgICAgICAgdmFyIGZpZ3VyZSA9IHNwbGl0VGV4dEJsb2NrKGVkaXRvciwgaW5zZXJ0ZWRFbG0pO1xuICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNlbGVjdChmaWd1cmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QoaW5zZXJ0ZWRFbG0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHN5bmNTcmNBdHRyID0gZnVuY3Rpb24gKGVkaXRvciwgaW1hZ2UpIHtcbiAgICAgIGVkaXRvci5kb20uc2V0QXR0cmliKGltYWdlLCAnc3JjJywgaW1hZ2UuZ2V0QXR0cmlidXRlKCdzcmMnKSk7XG4gICAgfTtcbiAgICB2YXIgZGVsZXRlSW1hZ2UgPSBmdW5jdGlvbiAoZWRpdG9yLCBpbWFnZSkge1xuICAgICAgaWYgKGltYWdlKSB7XG4gICAgICAgIHZhciBlbG0gPSBlZGl0b3IuZG9tLmlzKGltYWdlLnBhcmVudE5vZGUsICdmaWd1cmUuaW1hZ2UnKSA/IGltYWdlLnBhcmVudE5vZGUgOiBpbWFnZTtcbiAgICAgICAgZWRpdG9yLmRvbS5yZW1vdmUoZWxtKTtcbiAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgIGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuICAgICAgICBpZiAoZWRpdG9yLmRvbS5pc0VtcHR5KGVkaXRvci5nZXRCb2R5KCkpKSB7XG4gICAgICAgICAgZWRpdG9yLnNldENvbnRlbnQoJycpO1xuICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHdyaXRlSW1hZ2VEYXRhVG9TZWxlY3Rpb24gPSBmdW5jdGlvbiAoZWRpdG9yLCBkYXRhKSB7XG4gICAgICB2YXIgaW1hZ2UgPSBnZXRTZWxlY3RlZEltYWdlKGVkaXRvcik7XG4gICAgICB3cml0ZShmdW5jdGlvbiAoY3NzKSB7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVDc3MoZWRpdG9yLCBjc3MpO1xuICAgICAgfSwgZGF0YSwgaW1hZ2UpO1xuICAgICAgc3luY1NyY0F0dHIoZWRpdG9yLCBpbWFnZSk7XG4gICAgICBpZiAoaXNGaWd1cmUoaW1hZ2UucGFyZW50Tm9kZSkpIHtcbiAgICAgICAgdmFyIGZpZ3VyZSA9IGltYWdlLnBhcmVudE5vZGU7XG4gICAgICAgIHNwbGl0VGV4dEJsb2NrKGVkaXRvciwgZmlndXJlKTtcbiAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZWxlY3QoaW1hZ2UucGFyZW50Tm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNlbGVjdChpbWFnZSk7XG4gICAgICAgIHdhaXRMb2FkSW1hZ2UoZWRpdG9yLCBkYXRhLCBpbWFnZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0T3JVcGRhdGVJbWFnZSA9IGZ1bmN0aW9uIChlZGl0b3IsIHBhcnRpYWxEYXRhKSB7XG4gICAgICB2YXIgaW1hZ2UgPSBnZXRTZWxlY3RlZEltYWdlKGVkaXRvcik7XG4gICAgICBpZiAoaW1hZ2UpIHtcbiAgICAgICAgdmFyIHNlbGVjdGVkSW1hZ2VEYXRhID0gcmVhZChmdW5jdGlvbiAoY3NzKSB7XG4gICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZUNzcyhlZGl0b3IsIGNzcyk7XG4gICAgICAgIH0sIGltYWdlKTtcbiAgICAgICAgdmFyIGRhdGEgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc2VsZWN0ZWRJbWFnZURhdGEpLCBwYXJ0aWFsRGF0YSk7XG4gICAgICAgIGlmIChkYXRhLnNyYykge1xuICAgICAgICAgIHdyaXRlSW1hZ2VEYXRhVG9TZWxlY3Rpb24oZWRpdG9yLCBkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZWxldGVJbWFnZShlZGl0b3IsIGltYWdlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChwYXJ0aWFsRGF0YS5zcmMpIHtcbiAgICAgICAgaW5zZXJ0SW1hZ2VBdENhcmV0KGVkaXRvciwgX19hc3NpZ24oX19hc3NpZ24oe30sIGRlZmF1bHREYXRhKCkpLCBwYXJ0aWFsRGF0YSkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaGFzT3duUHJvcGVydHkkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG4gICAgdmFyIGRlZXAgPSBmdW5jdGlvbiAob2xkLCBudSkge1xuICAgICAgdmFyIGJvdGhPYmplY3RzID0gaXNPYmplY3Qob2xkKSAmJiBpc09iamVjdChudSk7XG4gICAgICByZXR1cm4gYm90aE9iamVjdHMgPyBkZWVwTWVyZ2Uob2xkLCBudSkgOiBudTtcbiAgICB9O1xuICAgIHZhciBiYXNlTWVyZ2UgPSBmdW5jdGlvbiAobWVyZ2VyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqZWN0cyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIG9iamVjdHNbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqZWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3QgbWVyZ2UgemVybyBvYmplY3RzJyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJldCA9IHt9O1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9iamVjdHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICB2YXIgY3VyT2JqZWN0ID0gb2JqZWN0c1tqXTtcbiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gY3VyT2JqZWN0KSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkkMS5jYWxsKGN1ck9iamVjdCwga2V5KSkge1xuICAgICAgICAgICAgICByZXRba2V5XSA9IG1lcmdlcihyZXRba2V5XSwgY3VyT2JqZWN0W2tleV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkZWVwTWVyZ2UgPSBiYXNlTWVyZ2UoZGVlcCk7XG5cbiAgICB2YXIgaXNOb3RFbXB0eSA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICByZXR1cm4gcy5sZW5ndGggPiAwO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDQgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLkltYWdlVXBsb2FkZXInKTtcblxuICAgIHZhciBnbG9iYWwkNSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVG9vbHMnKTtcblxuICAgIHZhciBnZXRWYWx1ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gaXNTdHJpbmcoaXRlbS52YWx1ZSkgPyBpdGVtLnZhbHVlIDogJyc7XG4gICAgfTtcbiAgICB2YXIgZ2V0VGV4dCA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpZiAoaXNTdHJpbmcoaXRlbS50ZXh0KSkge1xuICAgICAgICByZXR1cm4gaXRlbS50ZXh0O1xuICAgICAgfSBlbHNlIGlmIChpc1N0cmluZyhpdGVtLnRpdGxlKSkge1xuICAgICAgICByZXR1cm4gaXRlbS50aXRsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzYW5pdGl6ZUxpc3QgPSBmdW5jdGlvbiAobGlzdCwgZXh0cmFjdFZhbHVlKSB7XG4gICAgICB2YXIgb3V0ID0gW107XG4gICAgICBnbG9iYWwkNS5lYWNoKGxpc3QsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gZ2V0VGV4dChpdGVtKTtcbiAgICAgICAgaWYgKGl0ZW0ubWVudSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdmFyIGl0ZW1zID0gc2FuaXRpemVMaXN0KGl0ZW0ubWVudSwgZXh0cmFjdFZhbHVlKTtcbiAgICAgICAgICBvdXQucHVzaCh7XG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHZhbHVlID0gZXh0cmFjdFZhbHVlKGl0ZW0pO1xuICAgICAgICAgIG91dC5wdXNoKHtcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gb3V0O1xuICAgIH07XG4gICAgdmFyIHNhbml0aXplciA9IGZ1bmN0aW9uIChleHRyYWN0ZXIpIHtcbiAgICAgIGlmIChleHRyYWN0ZXIgPT09IHZvaWQgMCkge1xuICAgICAgICBleHRyYWN0ZXIgPSBnZXRWYWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICBpZiAobGlzdCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGxpc3QpLm1hcChmdW5jdGlvbiAobGlzdCkge1xuICAgICAgICAgICAgcmV0dXJuIHNhbml0aXplTGlzdChsaXN0LCBleHRyYWN0ZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2FuaXRpemUgPSBmdW5jdGlvbiAobGlzdCkge1xuICAgICAgcmV0dXJuIHNhbml0aXplcihnZXRWYWx1ZSkobGlzdCk7XG4gICAgfTtcbiAgICB2YXIgaXNHcm91cCA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGl0ZW0sICdpdGVtcycpO1xuICAgIH07XG4gICAgdmFyIGZpbmRFbnRyeURlbGVnYXRlID0gZnVuY3Rpb24gKGxpc3QsIHZhbHVlKSB7XG4gICAgICByZXR1cm4gZmluZE1hcChsaXN0LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICBpZiAoaXNHcm91cChpdGVtKSkge1xuICAgICAgICAgIHJldHVybiBmaW5kRW50cnlEZWxlZ2F0ZShpdGVtLml0ZW1zLCB2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbS52YWx1ZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShpdGVtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmaW5kRW50cnkgPSBmdW5jdGlvbiAob3B0TGlzdCwgdmFsdWUpIHtcbiAgICAgIHJldHVybiBvcHRMaXN0LmJpbmQoZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRFbnRyeURlbGVnYXRlKGxpc3QsIHZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIExpc3RVdGlscyA9IHtcbiAgICAgIHNhbml0aXplcjogc2FuaXRpemVyLFxuICAgICAgc2FuaXRpemU6IHNhbml0aXplLFxuICAgICAgZmluZEVudHJ5OiBmaW5kRW50cnlcbiAgICB9O1xuXG4gICAgdmFyIG1ha2VUYWIgPSBmdW5jdGlvbiAoX2luZm8pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpdGxlOiAnQWR2YW5jZWQnLFxuICAgICAgICBuYW1lOiAnYWR2YW5jZWQnLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgICBsYWJlbDogJ1N0eWxlJyxcbiAgICAgICAgICAgIG5hbWU6ICdzdHlsZSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdncmlkJyxcbiAgICAgICAgICAgIGNvbHVtbnM6IDIsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ1ZlcnRpY2FsIHNwYWNlJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAndnNwYWNlJyxcbiAgICAgICAgICAgICAgICBpbnB1dE1vZGU6ICdudW1lcmljJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0hvcml6b250YWwgc3BhY2UnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdoc3BhY2UnLFxuICAgICAgICAgICAgICAgIGlucHV0TW9kZTogJ251bWVyaWMnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQm9yZGVyIHdpZHRoJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnYm9yZGVyJyxcbiAgICAgICAgICAgICAgICBpbnB1dE1vZGU6ICdudW1lcmljJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2xpc3Rib3gnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdib3JkZXJzdHlsZScsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdCb3JkZXIgc3R5bGUnLFxuICAgICAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdTZWxlY3QuLi4nLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJydcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdTb2xpZCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnc29saWQnXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRG90dGVkJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdkb3R0ZWQnXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGFzaGVkJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdkYXNoZWQnXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRG91YmxlJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdkb3VibGUnXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnR3Jvb3ZlJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdncm9vdmUnXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnUmlkZ2UnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3JpZGdlJ1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0luc2V0JyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdpbnNldCdcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdPdXRzZXQnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ291dHNldCdcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdOb25lJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdub25lJ1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0hpZGRlbicsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBBZHZUYWIgPSB7IG1ha2VUYWI6IG1ha2VUYWIgfTtcblxuICAgIHZhciBjb2xsZWN0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHVybExpc3RTYW5pdGl6ZXIgPSBMaXN0VXRpbHMuc2FuaXRpemVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBlZGl0b3IuY29udmVydFVSTChpdGVtLnZhbHVlIHx8IGl0ZW0udXJsLCAnc3JjJyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBmdXR1cmVJbWFnZUxpc3QgPSBuZXcgZ2xvYmFsJDIoZnVuY3Rpb24gKGNvbXBsZXRlcikge1xuICAgICAgICBjcmVhdGVJbWFnZUxpc3QoZWRpdG9yLCBmdW5jdGlvbiAoaW1hZ2VMaXN0KSB7XG4gICAgICAgICAgY29tcGxldGVyKHVybExpc3RTYW5pdGl6ZXIoaW1hZ2VMaXN0KS5tYXAoZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgICAgICByZXR1cm4gZmxhdHRlbihbXG4gICAgICAgICAgICAgIFt7XG4gICAgICAgICAgICAgICAgICB0ZXh0OiAnTm9uZScsXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogJydcbiAgICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgICAgaXRlbXNcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBjbGFzc0xpc3QgPSBMaXN0VXRpbHMuc2FuaXRpemUoZ2V0Q2xhc3NMaXN0KGVkaXRvcikpO1xuICAgICAgdmFyIGhhc0FkdlRhYiQxID0gaGFzQWR2VGFiKGVkaXRvcik7XG4gICAgICB2YXIgaGFzVXBsb2FkVGFiJDEgPSBoYXNVcGxvYWRUYWIoZWRpdG9yKTtcbiAgICAgIHZhciBoYXNVcGxvYWRVcmwkMSA9IGhhc1VwbG9hZFVybChlZGl0b3IpO1xuICAgICAgdmFyIGhhc1VwbG9hZEhhbmRsZXIkMSA9IGhhc1VwbG9hZEhhbmRsZXIoZWRpdG9yKTtcbiAgICAgIHZhciBpbWFnZSA9IHJlYWRJbWFnZURhdGFGcm9tU2VsZWN0aW9uKGVkaXRvcik7XG4gICAgICB2YXIgaGFzRGVzY3JpcHRpb24kMSA9IGhhc0Rlc2NyaXB0aW9uKGVkaXRvcik7XG4gICAgICB2YXIgaGFzSW1hZ2VUaXRsZSQxID0gaGFzSW1hZ2VUaXRsZShlZGl0b3IpO1xuICAgICAgdmFyIGhhc0RpbWVuc2lvbnMkMSA9IGhhc0RpbWVuc2lvbnMoZWRpdG9yKTtcbiAgICAgIHZhciBoYXNJbWFnZUNhcHRpb24kMSA9IGhhc0ltYWdlQ2FwdGlvbihlZGl0b3IpO1xuICAgICAgdmFyIGhhc0FjY2Vzc2liaWxpdHlPcHRpb25zID0gc2hvd0FjY2Vzc2liaWxpdHlPcHRpb25zKGVkaXRvcik7XG4gICAgICB2YXIgYXV0b21hdGljVXBsb2FkcyA9IGlzQXV0b21hdGljVXBsb2Fkc0VuYWJsZWQoZWRpdG9yKTtcbiAgICAgIHZhciBwcmVwZW5kVVJMID0gT3B0aW9uYWwuc29tZShnZXRQcmVwZW5kVXJsKGVkaXRvcikpLmZpbHRlcihmdW5jdGlvbiAocHJlVXJsKSB7XG4gICAgICAgIHJldHVybiBpc1N0cmluZyhwcmVVcmwpICYmIHByZVVybC5sZW5ndGggPiAwO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZnV0dXJlSW1hZ2VMaXN0LnRoZW4oZnVuY3Rpb24gKGltYWdlTGlzdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGltYWdlOiBpbWFnZSxcbiAgICAgICAgICBpbWFnZUxpc3Q6IGltYWdlTGlzdCxcbiAgICAgICAgICBjbGFzc0xpc3Q6IGNsYXNzTGlzdCxcbiAgICAgICAgICBoYXNBZHZUYWI6IGhhc0FkdlRhYiQxLFxuICAgICAgICAgIGhhc1VwbG9hZFRhYjogaGFzVXBsb2FkVGFiJDEsXG4gICAgICAgICAgaGFzVXBsb2FkVXJsOiBoYXNVcGxvYWRVcmwkMSxcbiAgICAgICAgICBoYXNVcGxvYWRIYW5kbGVyOiBoYXNVcGxvYWRIYW5kbGVyJDEsXG4gICAgICAgICAgaGFzRGVzY3JpcHRpb246IGhhc0Rlc2NyaXB0aW9uJDEsXG4gICAgICAgICAgaGFzSW1hZ2VUaXRsZTogaGFzSW1hZ2VUaXRsZSQxLFxuICAgICAgICAgIGhhc0RpbWVuc2lvbnM6IGhhc0RpbWVuc2lvbnMkMSxcbiAgICAgICAgICBoYXNJbWFnZUNhcHRpb246IGhhc0ltYWdlQ2FwdGlvbiQxLFxuICAgICAgICAgIHByZXBlbmRVUkw6IHByZXBlbmRVUkwsXG4gICAgICAgICAgaGFzQWNjZXNzaWJpbGl0eU9wdGlvbnM6IGhhc0FjY2Vzc2liaWxpdHlPcHRpb25zLFxuICAgICAgICAgIGF1dG9tYXRpY1VwbG9hZHM6IGF1dG9tYXRpY1VwbG9hZHNcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgbWFrZUl0ZW1zID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIHZhciBpbWFnZVVybCA9IHtcbiAgICAgICAgbmFtZTogJ3NyYycsXG4gICAgICAgIHR5cGU6ICd1cmxpbnB1dCcsXG4gICAgICAgIGZpbGV0eXBlOiAnaW1hZ2UnLFxuICAgICAgICBsYWJlbDogJ1NvdXJjZSdcbiAgICAgIH07XG4gICAgICB2YXIgaW1hZ2VMaXN0ID0gaW5mby5pbWFnZUxpc3QubWFwKGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6ICdpbWFnZXMnLFxuICAgICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgICBsYWJlbDogJ0ltYWdlIGxpc3QnLFxuICAgICAgICAgIGl0ZW1zOiBpdGVtc1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB2YXIgaW1hZ2VEZXNjcmlwdGlvbiA9IHtcbiAgICAgICAgbmFtZTogJ2FsdCcsXG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIGxhYmVsOiAnQWx0ZXJuYXRpdmUgZGVzY3JpcHRpb24nLFxuICAgICAgICBkaXNhYmxlZDogaW5mby5oYXNBY2Nlc3NpYmlsaXR5T3B0aW9ucyAmJiBpbmZvLmltYWdlLmlzRGVjb3JhdGl2ZVxuICAgICAgfTtcbiAgICAgIHZhciBpbWFnZVRpdGxlID0ge1xuICAgICAgICBuYW1lOiAndGl0bGUnLFxuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBsYWJlbDogJ0ltYWdlIHRpdGxlJ1xuICAgICAgfTtcbiAgICAgIHZhciBpbWFnZURpbWVuc2lvbnMgPSB7XG4gICAgICAgIG5hbWU6ICdkaW1lbnNpb25zJyxcbiAgICAgICAgdHlwZTogJ3NpemVpbnB1dCdcbiAgICAgIH07XG4gICAgICB2YXIgaXNEZWNvcmF0aXZlID0ge1xuICAgICAgICB0eXBlOiAnbGFiZWwnLFxuICAgICAgICBsYWJlbDogJ0FjY2Vzc2liaWxpdHknLFxuICAgICAgICBpdGVtczogW3tcbiAgICAgICAgICAgIG5hbWU6ICdpc0RlY29yYXRpdmUnLFxuICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICAgICAgICAgIGxhYmVsOiAnSW1hZ2UgaXMgZGVjb3JhdGl2ZSdcbiAgICAgICAgICB9XVxuICAgICAgfTtcbiAgICAgIHZhciBjbGFzc0xpc3QgPSBpbmZvLmNsYXNzTGlzdC5tYXAoZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogJ2NsYXNzZXMnLFxuICAgICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgICBsYWJlbDogJ0NsYXNzJyxcbiAgICAgICAgICBpdGVtczogaXRlbXNcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGNhcHRpb24gPSB7XG4gICAgICAgIHR5cGU6ICdsYWJlbCcsXG4gICAgICAgIGxhYmVsOiAnQ2FwdGlvbicsXG4gICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICAgICAgICAgIG5hbWU6ICdjYXB0aW9uJyxcbiAgICAgICAgICAgIGxhYmVsOiAnU2hvdyBjYXB0aW9uJ1xuICAgICAgICAgIH1dXG4gICAgICB9O1xuICAgICAgdmFyIGdldERpYWxvZ0NvbnRhaW5lclR5cGUgPSBmdW5jdGlvbiAodXNlQ29sdW1ucykge1xuICAgICAgICByZXR1cm4gdXNlQ29sdW1ucyA/IHtcbiAgICAgICAgICB0eXBlOiAnZ3JpZCcsXG4gICAgICAgICAgY29sdW1uczogMlxuICAgICAgICB9IDogeyB0eXBlOiAncGFuZWwnIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGZsYXR0ZW4oW1xuICAgICAgICBbaW1hZ2VVcmxdLFxuICAgICAgICBpbWFnZUxpc3QudG9BcnJheSgpLFxuICAgICAgICBpbmZvLmhhc0FjY2Vzc2liaWxpdHlPcHRpb25zICYmIGluZm8uaGFzRGVzY3JpcHRpb24gPyBbaXNEZWNvcmF0aXZlXSA6IFtdLFxuICAgICAgICBpbmZvLmhhc0Rlc2NyaXB0aW9uID8gW2ltYWdlRGVzY3JpcHRpb25dIDogW10sXG4gICAgICAgIGluZm8uaGFzSW1hZ2VUaXRsZSA/IFtpbWFnZVRpdGxlXSA6IFtdLFxuICAgICAgICBpbmZvLmhhc0RpbWVuc2lvbnMgPyBbaW1hZ2VEaW1lbnNpb25zXSA6IFtdLFxuICAgICAgICBbX19hc3NpZ24oX19hc3NpZ24oe30sIGdldERpYWxvZ0NvbnRhaW5lclR5cGUoaW5mby5jbGFzc0xpc3QuaXNTb21lKCkgJiYgaW5mby5oYXNJbWFnZUNhcHRpb24pKSwge1xuICAgICAgICAgICAgaXRlbXM6IGZsYXR0ZW4oW1xuICAgICAgICAgICAgICBjbGFzc0xpc3QudG9BcnJheSgpLFxuICAgICAgICAgICAgICBpbmZvLmhhc0ltYWdlQ2FwdGlvbiA/IFtjYXB0aW9uXSA6IFtdXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIH0pXVxuICAgICAgXSk7XG4gICAgfTtcbiAgICB2YXIgbWFrZVRhYiQxID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpdGxlOiAnR2VuZXJhbCcsXG4gICAgICAgIG5hbWU6ICdnZW5lcmFsJyxcbiAgICAgICAgaXRlbXM6IG1ha2VJdGVtcyhpbmZvKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBNYWluVGFiID0ge1xuICAgICAgbWFrZVRhYjogbWFrZVRhYiQxLFxuICAgICAgbWFrZUl0ZW1zOiBtYWtlSXRlbXNcbiAgICB9O1xuXG4gICAgdmFyIG1ha2VUYWIkMiA9IGZ1bmN0aW9uIChfaW5mbykge1xuICAgICAgdmFyIGl0ZW1zID0gW3tcbiAgICAgICAgICB0eXBlOiAnZHJvcHpvbmUnLFxuICAgICAgICAgIG5hbWU6ICdmaWxlaW5wdXQnXG4gICAgICAgIH1dO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGl0bGU6ICdVcGxvYWQnLFxuICAgICAgICBuYW1lOiAndXBsb2FkJyxcbiAgICAgICAgaXRlbXM6IGl0ZW1zXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFVwbG9hZFRhYiA9IHsgbWFrZVRhYjogbWFrZVRhYiQyIH07XG5cbiAgICB2YXIgY3JlYXRlU3RhdGUgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJldkltYWdlOiBMaXN0VXRpbHMuZmluZEVudHJ5KGluZm8uaW1hZ2VMaXN0LCBpbmZvLmltYWdlLnNyYyksXG4gICAgICAgIHByZXZBbHQ6IGluZm8uaW1hZ2UuYWx0LFxuICAgICAgICBvcGVuOiB0cnVlXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGZyb21JbWFnZURhdGEgPSBmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNyYzoge1xuICAgICAgICAgIHZhbHVlOiBpbWFnZS5zcmMsXG4gICAgICAgICAgbWV0YToge31cbiAgICAgICAgfSxcbiAgICAgICAgaW1hZ2VzOiBpbWFnZS5zcmMsXG4gICAgICAgIGFsdDogaW1hZ2UuYWx0LFxuICAgICAgICB0aXRsZTogaW1hZ2UudGl0bGUsXG4gICAgICAgIGRpbWVuc2lvbnM6IHtcbiAgICAgICAgICB3aWR0aDogaW1hZ2Uud2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHRcbiAgICAgICAgfSxcbiAgICAgICAgY2xhc3NlczogaW1hZ2UuY2xhc3MsXG4gICAgICAgIGNhcHRpb246IGltYWdlLmNhcHRpb24sXG4gICAgICAgIHN0eWxlOiBpbWFnZS5zdHlsZSxcbiAgICAgICAgdnNwYWNlOiBpbWFnZS52c3BhY2UsXG4gICAgICAgIGJvcmRlcjogaW1hZ2UuYm9yZGVyLFxuICAgICAgICBoc3BhY2U6IGltYWdlLmhzcGFjZSxcbiAgICAgICAgYm9yZGVyc3R5bGU6IGltYWdlLmJvcmRlclN0eWxlLFxuICAgICAgICBmaWxlaW5wdXQ6IFtdLFxuICAgICAgICBpc0RlY29yYXRpdmU6IGltYWdlLmlzRGVjb3JhdGl2ZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0b0ltYWdlRGF0YSA9IGZ1bmN0aW9uIChkYXRhLCByZW1vdmVFbXB0eUFsdCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3JjOiBkYXRhLnNyYy52YWx1ZSxcbiAgICAgICAgYWx0OiBkYXRhLmFsdC5sZW5ndGggPT09IDAgJiYgcmVtb3ZlRW1wdHlBbHQgPyBudWxsIDogZGF0YS5hbHQsXG4gICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLFxuICAgICAgICB3aWR0aDogZGF0YS5kaW1lbnNpb25zLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGRhdGEuZGltZW5zaW9ucy5oZWlnaHQsXG4gICAgICAgIGNsYXNzOiBkYXRhLmNsYXNzZXMsXG4gICAgICAgIHN0eWxlOiBkYXRhLnN0eWxlLFxuICAgICAgICBjYXB0aW9uOiBkYXRhLmNhcHRpb24sXG4gICAgICAgIGhzcGFjZTogZGF0YS5oc3BhY2UsXG4gICAgICAgIHZzcGFjZTogZGF0YS52c3BhY2UsXG4gICAgICAgIGJvcmRlcjogZGF0YS5ib3JkZXIsXG4gICAgICAgIGJvcmRlclN0eWxlOiBkYXRhLmJvcmRlcnN0eWxlLFxuICAgICAgICBpc0RlY29yYXRpdmU6IGRhdGEuaXNEZWNvcmF0aXZlXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGFkZFByZXBlbmRVcmwyID0gZnVuY3Rpb24gKGluZm8sIHNyY1VSTCkge1xuICAgICAgaWYgKCEvXig/OlthLXpBLVpdKzopP1xcL1xcLy8udGVzdChzcmNVUkwpKSB7XG4gICAgICAgIHJldHVybiBpbmZvLnByZXBlbmRVUkwuYmluZChmdW5jdGlvbiAocHJlcGVuZFVybCkge1xuICAgICAgICAgIGlmIChzcmNVUkwuc3Vic3RyaW5nKDAsIHByZXBlbmRVcmwubGVuZ3RoKSAhPT0gcHJlcGVuZFVybCkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUocHJlcGVuZFVybCArIHNyY1VSTCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBhZGRQcmVwZW5kVXJsID0gZnVuY3Rpb24gKGluZm8sIGFwaSkge1xuICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgYWRkUHJlcGVuZFVybDIoaW5mbywgZGF0YS5zcmMudmFsdWUpLmVhY2goZnVuY3Rpb24gKHNyY1VSTCkge1xuICAgICAgICBhcGkuc2V0RGF0YSh7XG4gICAgICAgICAgc3JjOiB7XG4gICAgICAgICAgICB2YWx1ZTogc3JjVVJMLFxuICAgICAgICAgICAgbWV0YTogZGF0YS5zcmMubWV0YVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmb3JtRmlsbEZyb21NZXRhMiA9IGZ1bmN0aW9uIChpbmZvLCBkYXRhLCBtZXRhKSB7XG4gICAgICBpZiAoaW5mby5oYXNEZXNjcmlwdGlvbiAmJiBpc1N0cmluZyhtZXRhLmFsdCkpIHtcbiAgICAgICAgZGF0YS5hbHQgPSBtZXRhLmFsdDtcbiAgICAgIH1cbiAgICAgIGlmIChpbmZvLmhhc0FjY2Vzc2liaWxpdHlPcHRpb25zKSB7XG4gICAgICAgIGRhdGEuaXNEZWNvcmF0aXZlID0gbWV0YS5pc0RlY29yYXRpdmUgfHwgZGF0YS5pc0RlY29yYXRpdmUgfHwgZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoaW5mby5oYXNJbWFnZVRpdGxlICYmIGlzU3RyaW5nKG1ldGEudGl0bGUpKSB7XG4gICAgICAgIGRhdGEudGl0bGUgPSBtZXRhLnRpdGxlO1xuICAgICAgfVxuICAgICAgaWYgKGluZm8uaGFzRGltZW5zaW9ucykge1xuICAgICAgICBpZiAoaXNTdHJpbmcobWV0YS53aWR0aCkpIHtcbiAgICAgICAgICBkYXRhLmRpbWVuc2lvbnMud2lkdGggPSBtZXRhLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1N0cmluZyhtZXRhLmhlaWdodCkpIHtcbiAgICAgICAgICBkYXRhLmRpbWVuc2lvbnMuaGVpZ2h0ID0gbWV0YS5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpc1N0cmluZyhtZXRhLmNsYXNzKSkge1xuICAgICAgICBMaXN0VXRpbHMuZmluZEVudHJ5KGluZm8uY2xhc3NMaXN0LCBtZXRhLmNsYXNzKS5lYWNoKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgIGRhdGEuY2xhc3NlcyA9IGVudHJ5LnZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChpbmZvLmhhc0ltYWdlQ2FwdGlvbikge1xuICAgICAgICBpZiAoaXNCb29sZWFuKG1ldGEuY2FwdGlvbikpIHtcbiAgICAgICAgICBkYXRhLmNhcHRpb24gPSBtZXRhLmNhcHRpb247XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpbmZvLmhhc0FkdlRhYikge1xuICAgICAgICBpZiAoaXNTdHJpbmcobWV0YS5zdHlsZSkpIHtcbiAgICAgICAgICBkYXRhLnN0eWxlID0gbWV0YS5zdHlsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTdHJpbmcobWV0YS52c3BhY2UpKSB7XG4gICAgICAgICAgZGF0YS52c3BhY2UgPSBtZXRhLnZzcGFjZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTdHJpbmcobWV0YS5ib3JkZXIpKSB7XG4gICAgICAgICAgZGF0YS5ib3JkZXIgPSBtZXRhLmJvcmRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTdHJpbmcobWV0YS5oc3BhY2UpKSB7XG4gICAgICAgICAgZGF0YS5oc3BhY2UgPSBtZXRhLmhzcGFjZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNTdHJpbmcobWV0YS5ib3JkZXJzdHlsZSkpIHtcbiAgICAgICAgICBkYXRhLmJvcmRlcnN0eWxlID0gbWV0YS5ib3JkZXJzdHlsZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGZvcm1GaWxsRnJvbU1ldGEgPSBmdW5jdGlvbiAoaW5mbywgYXBpKSB7XG4gICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICB2YXIgbWV0YSA9IGRhdGEuc3JjLm1ldGE7XG4gICAgICBpZiAobWV0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhciBuZXdEYXRhID0gZGVlcE1lcmdlKHt9LCBkYXRhKTtcbiAgICAgICAgZm9ybUZpbGxGcm9tTWV0YTIoaW5mbywgbmV3RGF0YSwgbWV0YSk7XG4gICAgICAgIGFwaS5zZXREYXRhKG5ld0RhdGEpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNhbGN1bGF0ZUltYWdlU2l6ZSA9IGZ1bmN0aW9uIChoZWxwZXJzLCBpbmZvLCBzdGF0ZSwgYXBpKSB7XG4gICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICB2YXIgdXJsID0gZGF0YS5zcmMudmFsdWU7XG4gICAgICB2YXIgbWV0YSA9IGRhdGEuc3JjLm1ldGEgfHwge307XG4gICAgICBpZiAoIW1ldGEud2lkdGggJiYgIW1ldGEuaGVpZ2h0ICYmIGluZm8uaGFzRGltZW5zaW9ucykge1xuICAgICAgICBpZiAoaXNOb3RFbXB0eSh1cmwpKSB7XG4gICAgICAgICAgaGVscGVycy5pbWFnZVNpemUodXJsKS50aGVuKGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgICAgICBpZiAoc3RhdGUub3Blbikge1xuICAgICAgICAgICAgICBhcGkuc2V0RGF0YSh7IGRpbWVuc2lvbnM6IHNpemUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFwaS5zZXREYXRhKHtcbiAgICAgICAgICAgIGRpbWVuc2lvbnM6IHtcbiAgICAgICAgICAgICAgd2lkdGg6ICcnLFxuICAgICAgICAgICAgICBoZWlnaHQ6ICcnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB1cGRhdGVJbWFnZXNEcm9wZG93biA9IGZ1bmN0aW9uIChpbmZvLCBzdGF0ZSwgYXBpKSB7XG4gICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICB2YXIgaW1hZ2UgPSBMaXN0VXRpbHMuZmluZEVudHJ5KGluZm8uaW1hZ2VMaXN0LCBkYXRhLnNyYy52YWx1ZSk7XG4gICAgICBzdGF0ZS5wcmV2SW1hZ2UgPSBpbWFnZTtcbiAgICAgIGFwaS5zZXREYXRhKHtcbiAgICAgICAgaW1hZ2VzOiBpbWFnZS5tYXAoZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgICAgcmV0dXJuIGVudHJ5LnZhbHVlO1xuICAgICAgICB9KS5nZXRPcignJylcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNoYW5nZVNyYyA9IGZ1bmN0aW9uIChoZWxwZXJzLCBpbmZvLCBzdGF0ZSwgYXBpKSB7XG4gICAgICBhZGRQcmVwZW5kVXJsKGluZm8sIGFwaSk7XG4gICAgICBmb3JtRmlsbEZyb21NZXRhKGluZm8sIGFwaSk7XG4gICAgICBjYWxjdWxhdGVJbWFnZVNpemUoaGVscGVycywgaW5mbywgc3RhdGUsIGFwaSk7XG4gICAgICB1cGRhdGVJbWFnZXNEcm9wZG93bihpbmZvLCBzdGF0ZSwgYXBpKTtcbiAgICB9O1xuICAgIHZhciBjaGFuZ2VJbWFnZXMgPSBmdW5jdGlvbiAoaGVscGVycywgaW5mbywgc3RhdGUsIGFwaSkge1xuICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgdmFyIGltYWdlID0gTGlzdFV0aWxzLmZpbmRFbnRyeShpbmZvLmltYWdlTGlzdCwgZGF0YS5pbWFnZXMpO1xuICAgICAgaW1hZ2UuZWFjaChmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAgIHZhciB1cGRhdGVBbHQgPSBkYXRhLmFsdCA9PT0gJycgfHwgc3RhdGUucHJldkltYWdlLm1hcChmdW5jdGlvbiAoaW1hZ2UpIHtcbiAgICAgICAgICByZXR1cm4gaW1hZ2UudGV4dCA9PT0gZGF0YS5hbHQ7XG4gICAgICAgIH0pLmdldE9yKGZhbHNlKTtcbiAgICAgICAgaWYgKHVwZGF0ZUFsdCkge1xuICAgICAgICAgIGlmIChpbWcudmFsdWUgPT09ICcnKSB7XG4gICAgICAgICAgICBhcGkuc2V0RGF0YSh7XG4gICAgICAgICAgICAgIHNyYzogaW1nLFxuICAgICAgICAgICAgICBhbHQ6IHN0YXRlLnByZXZBbHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcGkuc2V0RGF0YSh7XG4gICAgICAgICAgICAgIHNyYzogaW1nLFxuICAgICAgICAgICAgICBhbHQ6IGltZy50ZXh0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXBpLnNldERhdGEoeyBzcmM6IGltZyB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBzdGF0ZS5wcmV2SW1hZ2UgPSBpbWFnZTtcbiAgICAgIGNoYW5nZVNyYyhoZWxwZXJzLCBpbmZvLCBzdGF0ZSwgYXBpKTtcbiAgICB9O1xuICAgIHZhciBjYWxjVlNwYWNlID0gZnVuY3Rpb24gKGNzcykge1xuICAgICAgdmFyIG1hdGNoaW5nVG9wQm90dG9tID0gY3NzWydtYXJnaW4tdG9wJ10gJiYgY3NzWydtYXJnaW4tYm90dG9tJ10gJiYgY3NzWydtYXJnaW4tdG9wJ10gPT09IGNzc1snbWFyZ2luLWJvdHRvbSddO1xuICAgICAgcmV0dXJuIG1hdGNoaW5nVG9wQm90dG9tID8gcmVtb3ZlUGl4ZWxTdWZmaXgoU3RyaW5nKGNzc1snbWFyZ2luLXRvcCddKSkgOiAnJztcbiAgICB9O1xuICAgIHZhciBjYWxjSFNwYWNlID0gZnVuY3Rpb24gKGNzcykge1xuICAgICAgdmFyIG1hdGNoaW5nTGVmdFJpZ2h0ID0gY3NzWydtYXJnaW4tcmlnaHQnXSAmJiBjc3NbJ21hcmdpbi1sZWZ0J10gJiYgY3NzWydtYXJnaW4tcmlnaHQnXSA9PT0gY3NzWydtYXJnaW4tbGVmdCddO1xuICAgICAgcmV0dXJuIG1hdGNoaW5nTGVmdFJpZ2h0ID8gcmVtb3ZlUGl4ZWxTdWZmaXgoU3RyaW5nKGNzc1snbWFyZ2luLXJpZ2h0J10pKSA6ICcnO1xuICAgIH07XG4gICAgdmFyIGNhbGNCb3JkZXJXaWR0aCA9IGZ1bmN0aW9uIChjc3MpIHtcbiAgICAgIHJldHVybiBjc3NbJ2JvcmRlci13aWR0aCddID8gcmVtb3ZlUGl4ZWxTdWZmaXgoU3RyaW5nKGNzc1snYm9yZGVyLXdpZHRoJ10pKSA6ICcnO1xuICAgIH07XG4gICAgdmFyIGNhbGNCb3JkZXJTdHlsZSA9IGZ1bmN0aW9uIChjc3MpIHtcbiAgICAgIHJldHVybiBjc3NbJ2JvcmRlci1zdHlsZSddID8gU3RyaW5nKGNzc1snYm9yZGVyLXN0eWxlJ10pIDogJyc7XG4gICAgfTtcbiAgICB2YXIgY2FsY1N0eWxlID0gZnVuY3Rpb24gKHBhcnNlU3R5bGUsIHNlcmlhbGl6ZVN0eWxlLCBjc3MpIHtcbiAgICAgIHJldHVybiBzZXJpYWxpemVTdHlsZShwYXJzZVN0eWxlKHNlcmlhbGl6ZVN0eWxlKGNzcykpKTtcbiAgICB9O1xuICAgIHZhciBjaGFuZ2VTdHlsZTIgPSBmdW5jdGlvbiAocGFyc2VTdHlsZSwgc2VyaWFsaXplU3R5bGUsIGRhdGEpIHtcbiAgICAgIHZhciBjc3MgPSBtZXJnZU1hcmdpbnMocGFyc2VTdHlsZShkYXRhLnN0eWxlKSk7XG4gICAgICB2YXIgZGF0YUNvcHkgPSBkZWVwTWVyZ2Uoe30sIGRhdGEpO1xuICAgICAgZGF0YUNvcHkudnNwYWNlID0gY2FsY1ZTcGFjZShjc3MpO1xuICAgICAgZGF0YUNvcHkuaHNwYWNlID0gY2FsY0hTcGFjZShjc3MpO1xuICAgICAgZGF0YUNvcHkuYm9yZGVyID0gY2FsY0JvcmRlcldpZHRoKGNzcyk7XG4gICAgICBkYXRhQ29weS5ib3JkZXJzdHlsZSA9IGNhbGNCb3JkZXJTdHlsZShjc3MpO1xuICAgICAgZGF0YUNvcHkuc3R5bGUgPSBjYWxjU3R5bGUocGFyc2VTdHlsZSwgc2VyaWFsaXplU3R5bGUsIGNzcyk7XG4gICAgICByZXR1cm4gZGF0YUNvcHk7XG4gICAgfTtcbiAgICB2YXIgY2hhbmdlU3R5bGUgPSBmdW5jdGlvbiAoaGVscGVycywgYXBpKSB7XG4gICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICB2YXIgbmV3RGF0YSA9IGNoYW5nZVN0eWxlMihoZWxwZXJzLnBhcnNlU3R5bGUsIGhlbHBlcnMuc2VyaWFsaXplU3R5bGUsIGRhdGEpO1xuICAgICAgYXBpLnNldERhdGEobmV3RGF0YSk7XG4gICAgfTtcbiAgICB2YXIgY2hhbmdlQVN0eWxlID0gZnVuY3Rpb24gKGhlbHBlcnMsIGluZm8sIGFwaSkge1xuICAgICAgdmFyIGRhdGEgPSBkZWVwTWVyZ2UoZnJvbUltYWdlRGF0YShpbmZvLmltYWdlKSwgYXBpLmdldERhdGEoKSk7XG4gICAgICB2YXIgc3R5bGUgPSBnZXRTdHlsZVZhbHVlKGhlbHBlcnMubm9ybWFsaXplQ3NzLCB0b0ltYWdlRGF0YShkYXRhLCBmYWxzZSkpO1xuICAgICAgYXBpLnNldERhdGEoeyBzdHlsZTogc3R5bGUgfSk7XG4gICAgfTtcbiAgICB2YXIgY2hhbmdlRmlsZUlucHV0ID0gZnVuY3Rpb24gKGhlbHBlcnMsIGluZm8sIHN0YXRlLCBhcGkpIHtcbiAgICAgIHZhciBkYXRhID0gYXBpLmdldERhdGEoKTtcbiAgICAgIGFwaS5ibG9jaygnVXBsb2FkaW5nIGltYWdlJyk7XG4gICAgICBoZWFkKGRhdGEuZmlsZWlucHV0KS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXBpLnVuYmxvY2soKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICAgIHZhciBibG9iVXJpID0gVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKTtcbiAgICAgICAgdmFyIGZpbmFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGFwaS51bmJsb2NrKCk7XG4gICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChibG9iVXJpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHVwZGF0ZVNyY0FuZFN3aXRjaFRhYiA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICBhcGkuc2V0RGF0YSh7XG4gICAgICAgICAgICBzcmM6IHtcbiAgICAgICAgICAgICAgdmFsdWU6IHVybCxcbiAgICAgICAgICAgICAgbWV0YToge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhcGkuc2hvd1RhYignZ2VuZXJhbCcpO1xuICAgICAgICAgIGNoYW5nZVNyYyhoZWxwZXJzLCBpbmZvLCBzdGF0ZSwgYXBpKTtcbiAgICAgICAgfTtcbiAgICAgICAgYmxvYlRvRGF0YVVyaShmaWxlKS50aGVuKGZ1bmN0aW9uIChkYXRhVXJsKSB7XG4gICAgICAgICAgdmFyIGJsb2JJbmZvID0gaGVscGVycy5jcmVhdGVCbG9iQ2FjaGUoZmlsZSwgYmxvYlVyaSwgZGF0YVVybCk7XG4gICAgICAgICAgaWYgKGluZm8uYXV0b21hdGljVXBsb2Fkcykge1xuICAgICAgICAgICAgaGVscGVycy51cGxvYWRJbWFnZShibG9iSW5mbykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgIHVwZGF0ZVNyY0FuZFN3aXRjaFRhYihyZXN1bHQudXJsKTtcbiAgICAgICAgICAgICAgZmluYWxpemUoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgZmluYWxpemUoKTtcbiAgICAgICAgICAgICAgaGVscGVycy5hbGVydEVycihlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhlbHBlcnMuYWRkVG9CbG9iQ2FjaGUoYmxvYkluZm8pO1xuICAgICAgICAgICAgdXBkYXRlU3JjQW5kU3dpdGNoVGFiKGJsb2JJbmZvLmJsb2JVcmkoKSk7XG4gICAgICAgICAgICBhcGkudW5ibG9jaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBjaGFuZ2VIYW5kbGVyID0gZnVuY3Rpb24gKGhlbHBlcnMsIGluZm8sIHN0YXRlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGFwaSwgZXZ0KSB7XG4gICAgICAgIGlmIChldnQubmFtZSA9PT0gJ3NyYycpIHtcbiAgICAgICAgICBjaGFuZ2VTcmMoaGVscGVycywgaW5mbywgc3RhdGUsIGFwaSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0Lm5hbWUgPT09ICdpbWFnZXMnKSB7XG4gICAgICAgICAgY2hhbmdlSW1hZ2VzKGhlbHBlcnMsIGluZm8sIHN0YXRlLCBhcGkpO1xuICAgICAgICB9IGVsc2UgaWYgKGV2dC5uYW1lID09PSAnYWx0Jykge1xuICAgICAgICAgIHN0YXRlLnByZXZBbHQgPSBhcGkuZ2V0RGF0YSgpLmFsdDtcbiAgICAgICAgfSBlbHNlIGlmIChldnQubmFtZSA9PT0gJ3N0eWxlJykge1xuICAgICAgICAgIGNoYW5nZVN0eWxlKGhlbHBlcnMsIGFwaSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0Lm5hbWUgPT09ICd2c3BhY2UnIHx8IGV2dC5uYW1lID09PSAnaHNwYWNlJyB8fCBldnQubmFtZSA9PT0gJ2JvcmRlcicgfHwgZXZ0Lm5hbWUgPT09ICdib3JkZXJzdHlsZScpIHtcbiAgICAgICAgICBjaGFuZ2VBU3R5bGUoaGVscGVycywgaW5mbywgYXBpKTtcbiAgICAgICAgfSBlbHNlIGlmIChldnQubmFtZSA9PT0gJ2ZpbGVpbnB1dCcpIHtcbiAgICAgICAgICBjaGFuZ2VGaWxlSW5wdXQoaGVscGVycywgaW5mbywgc3RhdGUsIGFwaSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0Lm5hbWUgPT09ICdpc0RlY29yYXRpdmUnKSB7XG4gICAgICAgICAgaWYgKGFwaS5nZXREYXRhKCkuaXNEZWNvcmF0aXZlKSB7XG4gICAgICAgICAgICBhcGkuZGlzYWJsZSgnYWx0Jyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFwaS5lbmFibGUoJ2FsdCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjbG9zZUhhbmRsZXIgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN0YXRlLm9wZW4gPSBmYWxzZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbWFrZURpYWxvZ0JvZHkgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgaWYgKGluZm8uaGFzQWR2VGFiIHx8IGluZm8uaGFzVXBsb2FkVXJsIHx8IGluZm8uaGFzVXBsb2FkSGFuZGxlcikge1xuICAgICAgICB2YXIgdGFiUGFuZWwgPSB7XG4gICAgICAgICAgdHlwZTogJ3RhYnBhbmVsJyxcbiAgICAgICAgICB0YWJzOiBmbGF0dGVuKFtcbiAgICAgICAgICAgIFtNYWluVGFiLm1ha2VUYWIoaW5mbyldLFxuICAgICAgICAgICAgaW5mby5oYXNBZHZUYWIgPyBbQWR2VGFiLm1ha2VUYWIoaW5mbyldIDogW10sXG4gICAgICAgICAgICBpbmZvLmhhc1VwbG9hZFRhYiAmJiAoaW5mby5oYXNVcGxvYWRVcmwgfHwgaW5mby5oYXNVcGxvYWRIYW5kbGVyKSA/IFtVcGxvYWRUYWIubWFrZVRhYihpbmZvKV0gOiBbXVxuICAgICAgICAgIF0pXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0YWJQYW5lbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBwYW5lbCA9IHtcbiAgICAgICAgICB0eXBlOiAncGFuZWwnLFxuICAgICAgICAgIGl0ZW1zOiBNYWluVGFiLm1ha2VJdGVtcyhpbmZvKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gcGFuZWw7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbWFrZURpYWxvZyA9IGZ1bmN0aW9uIChoZWxwZXJzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgdmFyIHN0YXRlID0gY3JlYXRlU3RhdGUoaW5mbyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGl0bGU6ICdJbnNlcnQvRWRpdCBJbWFnZScsXG4gICAgICAgICAgc2l6ZTogJ25vcm1hbCcsXG4gICAgICAgICAgYm9keTogbWFrZURpYWxvZ0JvZHkoaW5mbyksXG4gICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAnY2FuY2VsJyxcbiAgICAgICAgICAgICAgbmFtZTogJ2NhbmNlbCcsXG4gICAgICAgICAgICAgIHRleHQ6ICdDYW5jZWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAnc3VibWl0JyxcbiAgICAgICAgICAgICAgbmFtZTogJ3NhdmUnLFxuICAgICAgICAgICAgICB0ZXh0OiAnU2F2ZScsXG4gICAgICAgICAgICAgIHByaW1hcnk6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIGluaXRpYWxEYXRhOiBmcm9tSW1hZ2VEYXRhKGluZm8uaW1hZ2UpLFxuICAgICAgICAgIG9uU3VibWl0OiBoZWxwZXJzLm9uU3VibWl0KGluZm8pLFxuICAgICAgICAgIG9uQ2hhbmdlOiBjaGFuZ2VIYW5kbGVyKGhlbHBlcnMsIGluZm8sIHN0YXRlKSxcbiAgICAgICAgICBvbkNsb3NlOiBjbG9zZUhhbmRsZXIoc3RhdGUpXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHN1Ym1pdEhhbmRsZXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICB2YXIgZGF0YSA9IGRlZXBNZXJnZShmcm9tSW1hZ2VEYXRhKGluZm8uaW1hZ2UpLCBhcGkuZ2V0RGF0YSgpKTtcbiAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZVVwZGF0ZUltYWdlJywgZmFsc2UsIHRvSW1hZ2VEYXRhKGRhdGEsIGluZm8uaGFzQWNjZXNzaWJpbGl0eU9wdGlvbnMpKTtcbiAgICAgICAgICBlZGl0b3IuZWRpdG9yVXBsb2FkLnVwbG9hZEltYWdlc0F1dG8oKTtcbiAgICAgICAgICBhcGkuY2xvc2UoKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaW1hZ2VTaXplID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgcmV0dXJuIGdldEltYWdlU2l6ZShlZGl0b3IuZG9jdW1lbnRCYXNlVVJJLnRvQWJzb2x1dGUodXJsKSkudGhlbihmdW5jdGlvbiAoZGltZW5zaW9ucykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3aWR0aDogU3RyaW5nKGRpbWVuc2lvbnMud2lkdGgpLFxuICAgICAgICAgICAgaGVpZ2h0OiBTdHJpbmcoZGltZW5zaW9ucy5oZWlnaHQpXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZUJsb2JDYWNoZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZmlsZSwgYmxvYlVyaSwgZGF0YVVybCkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmVkaXRvclVwbG9hZC5ibG9iQ2FjaGUuY3JlYXRlKHtcbiAgICAgICAgICBibG9iOiBmaWxlLFxuICAgICAgICAgIGJsb2JVcmk6IGJsb2JVcmksXG4gICAgICAgICAgbmFtZTogZmlsZS5uYW1lID8gZmlsZS5uYW1lLnJlcGxhY2UoL1xcLlteXFwuXSskLywgJycpIDogbnVsbCxcbiAgICAgICAgICBmaWxlbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgIGJhc2U2NDogZGF0YVVybC5zcGxpdCgnLCcpWzFdXG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBhZGRUb0Jsb2JDYWNoZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoYmxvYkluZm8pIHtcbiAgICAgICAgZWRpdG9yLmVkaXRvclVwbG9hZC5ibG9iQ2FjaGUuYWRkKGJsb2JJbmZvKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYWxlcnRFcnIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgZWRpdG9yLndpbmRvd01hbmFnZXIuYWxlcnQobWVzc2FnZSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZUNzcyQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjc3NUZXh0KSB7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVDc3MoZWRpdG9yLCBjc3NUZXh0KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcGFyc2VTdHlsZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoY3NzVGV4dCkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmRvbS5wYXJzZVN0eWxlKGNzc1RleHQpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzZXJpYWxpemVTdHlsZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoc3R5bGVzQXJnLCBuYW1lKSB7XG4gICAgICAgIHJldHVybiBlZGl0b3IuZG9tLnNlcmlhbGl6ZVN0eWxlKHN0eWxlc0FyZywgbmFtZSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHVwbG9hZEltYWdlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChibG9iSW5mbykge1xuICAgICAgICByZXR1cm4gZ2xvYmFsJDQoZWRpdG9yKS51cGxvYWQoW2Jsb2JJbmZvXSwgZmFsc2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iYWwkMi5yZWplY3QoJ0ZhaWxlZCB0byB1cGxvYWQgaW1hZ2UnKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdHNbMF0uc3RhdHVzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIGdsb2JhbCQyLnJlamVjdChyZXN1bHRzWzBdLmVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0c1swXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBEaWFsb2cgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgaGVscGVycyA9IHtcbiAgICAgICAgb25TdWJtaXQ6IHN1Ym1pdEhhbmRsZXIoZWRpdG9yKSxcbiAgICAgICAgaW1hZ2VTaXplOiBpbWFnZVNpemUoZWRpdG9yKSxcbiAgICAgICAgYWRkVG9CbG9iQ2FjaGU6IGFkZFRvQmxvYkNhY2hlKGVkaXRvciksXG4gICAgICAgIGNyZWF0ZUJsb2JDYWNoZTogY3JlYXRlQmxvYkNhY2hlKGVkaXRvciksXG4gICAgICAgIGFsZXJ0RXJyOiBhbGVydEVycihlZGl0b3IpLFxuICAgICAgICBub3JtYWxpemVDc3M6IG5vcm1hbGl6ZUNzcyQxKGVkaXRvciksXG4gICAgICAgIHBhcnNlU3R5bGU6IHBhcnNlU3R5bGUoZWRpdG9yKSxcbiAgICAgICAgc2VyaWFsaXplU3R5bGU6IHNlcmlhbGl6ZVN0eWxlKGVkaXRvciksXG4gICAgICAgIHVwbG9hZEltYWdlOiB1cGxvYWRJbWFnZShlZGl0b3IpXG4gICAgICB9O1xuICAgICAgdmFyIG9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbGxlY3QoZWRpdG9yKS50aGVuKG1ha2VEaWFsb2coaGVscGVycykpLnRoZW4oZWRpdG9yLndpbmRvd01hbmFnZXIub3Blbik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHsgb3Blbjogb3BlbiB9O1xuICAgIH07XG5cbiAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IuYWRkQ29tbWFuZCgnbWNlSW1hZ2UnLCBEaWFsb2coZWRpdG9yKS5vcGVuKTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VVcGRhdGVJbWFnZScsIGZ1bmN0aW9uIChfdWksIGRhdGEpIHtcbiAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gaW5zZXJ0T3JVcGRhdGVJbWFnZShlZGl0b3IsIGRhdGEpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgaGFzSW1hZ2VDbGFzcyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICB2YXIgY2xhc3NOYW1lID0gbm9kZS5hdHRyKCdjbGFzcycpO1xuICAgICAgcmV0dXJuIGNsYXNzTmFtZSAmJiAvXFxiaW1hZ2VcXGIvLnRlc3QoY2xhc3NOYW1lKTtcbiAgICB9O1xuICAgIHZhciB0b2dnbGVDb250ZW50RWRpdGFibGVTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChub2Rlcykge1xuICAgICAgICB2YXIgaSA9IG5vZGVzLmxlbmd0aDtcbiAgICAgICAgdmFyIHRvZ2dsZUNvbnRlbnRFZGl0YWJsZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgbm9kZS5hdHRyKCdjb250ZW50ZWRpdGFibGUnLCBzdGF0ZSA/ICd0cnVlJyA6IG51bGwpO1xuICAgICAgICB9O1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgdmFyIG5vZGUgPSBub2Rlc1tpXTtcbiAgICAgICAgICBpZiAoaGFzSW1hZ2VDbGFzcyhub2RlKSkge1xuICAgICAgICAgICAgbm9kZS5hdHRyKCdjb250ZW50ZWRpdGFibGUnLCBzdGF0ZSA/ICdmYWxzZScgOiBudWxsKTtcbiAgICAgICAgICAgIGdsb2JhbCQ1LmVhY2gobm9kZS5nZXRBbGwoJ2ZpZ2NhcHRpb24nKSwgdG9nZ2xlQ29udGVudEVkaXRhYmxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgc2V0dXAgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3Iub24oJ1ByZUluaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVkaXRvci5wYXJzZXIuYWRkTm9kZUZpbHRlcignZmlndXJlJywgdG9nZ2xlQ29udGVudEVkaXRhYmxlU3RhdGUodHJ1ZSkpO1xuICAgICAgICBlZGl0b3Iuc2VyaWFsaXplci5hZGROb2RlRmlsdGVyKCdmaWd1cmUnLCB0b2dnbGVDb250ZW50RWRpdGFibGVTdGF0ZShmYWxzZSkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZWdpc3RlciQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZFRvZ2dsZUJ1dHRvbignaW1hZ2UnLCB7XG4gICAgICAgIGljb246ICdpbWFnZScsXG4gICAgICAgIHRvb2x0aXA6ICdJbnNlcnQvZWRpdCBpbWFnZScsXG4gICAgICAgIG9uQWN0aW9uOiBEaWFsb2coZWRpdG9yKS5vcGVuLFxuICAgICAgICBvblNldHVwOiBmdW5jdGlvbiAoYnV0dG9uQXBpKSB7XG4gICAgICAgICAgcmV0dXJuIGVkaXRvci5zZWxlY3Rpb24uc2VsZWN0b3JDaGFuZ2VkV2l0aFVuYmluZCgnaW1nOm5vdChbZGF0YS1tY2Utb2JqZWN0XSxbZGF0YS1tY2UtcGxhY2Vob2xkZXJdKSxmaWd1cmUuaW1hZ2UnLCBidXR0b25BcGkuc2V0QWN0aXZlKS51bmJpbmQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCdpbWFnZScsIHtcbiAgICAgICAgaWNvbjogJ2ltYWdlJyxcbiAgICAgICAgdGV4dDogJ0ltYWdlLi4uJyxcbiAgICAgICAgb25BY3Rpb246IERpYWxvZyhlZGl0b3IpLm9wZW5cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZENvbnRleHRNZW51KCdpbWFnZScsIHtcbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgIHJldHVybiBpc0ZpZ3VyZShlbGVtZW50KSB8fCBpc0ltYWdlKGVsZW1lbnQpICYmICFpc1BsYWNlaG9sZGVySW1hZ2UoZWxlbWVudCkgPyBbJ2ltYWdlJ10gOiBbXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFBsdWdpbiAoKSB7XG4gICAgICBnbG9iYWwuYWRkKCdpbWFnZScsIGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgc2V0dXAoZWRpdG9yKTtcbiAgICAgICAgcmVnaXN0ZXIkMShlZGl0b3IpO1xuICAgICAgICByZWdpc3RlcihlZGl0b3IpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgUGx1Z2luKCk7XG5cbn0oKSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBOzs7Ozs7OztBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7O0EiLCJzb3VyY2VSb290IjoiIn0=