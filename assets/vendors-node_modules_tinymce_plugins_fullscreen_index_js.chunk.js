(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_fullscreen_index_js"],{

/***/ "./node_modules/tinymce/plugins/fullscreen/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/tinymce/plugins/fullscreen/index.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "fullscreen" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/fullscreen')
//   ES2015:
//     import 'tinymce/plugins/fullscreen'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/fullscreen/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/fullscreen/plugin.js":
/*!***********************************************************!*\
  !*** ./node_modules/tinymce/plugins/fullscreen/plugin.js ***!
  \***********************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var get = function (fullscreenState) {
      return {
        isFullscreen: function () {
          return fullscreenState.get() !== null;
        }
      };
    };

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var isString = isType('string');
    var isArray = isType('array');
    var isBoolean = isSimpleType('boolean');
    var isNullable = function (a) {
      return a === null || a === undefined;
    };
    var isNonNullable = function (a) {
      return !isNullable(a);
    };
    var isFunction = isSimpleType('function');
    var isNumber = isSimpleType('number');

    var noop = function () {
    };
    var compose = function (fa, fb) {
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        return fa(fb.apply(null, args));
      };
    };
    var compose1 = function (fbc, fab) {
      return function (a) {
        return fbc(fab(a));
      };
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    function curry(fn) {
      var initialArgs = [];
      for (var _i = 1; _i < arguments.length; _i++) {
        initialArgs[_i - 1] = arguments[_i];
      }
      return function () {
        var restArgs = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          restArgs[_i] = arguments[_i];
        }
        var all = initialArgs.concat(restArgs);
        return fn.apply(null, all);
      };
    }
    var never = constant(false);
    var always = constant(true);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var revocable = function (doRevoke) {
      var subject = Cell(Optional.none());
      var revoke = function () {
        return subject.get().each(doRevoke);
      };
      var clear = function () {
        revoke();
        subject.set(Optional.none());
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var set = function (s) {
        revoke();
        subject.set(Optional.some(s));
      };
      return {
        clear: clear,
        isSet: isSet,
        set: set
      };
    };
    var unbindable = function () {
      return revocable(function (s) {
        return s.unbind();
      });
    };
    var value = function () {
      var subject = Cell(Optional.none());
      var clear = function () {
        return subject.set(Optional.none());
      };
      var set = function (s) {
        return subject.set(Optional.some(s));
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var on = function (f) {
        return subject.get().each(f);
      };
      return {
        clear: clear,
        set: set,
        isSet: isSet,
        on: on
      };
    };

    var nativePush = Array.prototype.push;
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var filter = function (xs, pred) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          r.push(x);
        }
      }
      return r;
    };
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var bind = function (xs, f) {
      return flatten(map(xs, f));
    };
    var get$1 = function (xs, i) {
      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();
    };
    var head = function (xs) {
      return get$1(xs, 0);
    };

    var keys = Object.keys;
    var each$1 = function (obj, f) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        f(x, i);
      }
    };

    var isSupported = function (dom) {
      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);
    };

    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw new Error('HTML must have a single root node');
      }
      return fromDom(div.childNodes[0]);
    };
    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };
    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };
    var fromDom = function (node) {
      if (node === null || node === undefined) {
        throw new Error('Node cannot be null or undefined');
      }
      return { dom: node };
    };
    var fromPoint = function (docElm, x, y) {
      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);
    };
    var SugarElement = {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom,
      fromPoint: fromPoint
    };

    var Global = typeof window !== 'undefined' ? window : Function('return this;')();

    var DOCUMENT = 9;
    var DOCUMENT_FRAGMENT = 11;
    var ELEMENT = 1;
    var TEXT = 3;

    var type = function (element) {
      return element.dom.nodeType;
    };
    var isType$1 = function (t) {
      return function (element) {
        return type(element) === t;
      };
    };
    var isElement = isType$1(ELEMENT);
    var isText = isType$1(TEXT);
    var isDocument = isType$1(DOCUMENT);
    var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);

    var is = function (element, selector) {
      var dom = element.dom;
      if (dom.nodeType !== ELEMENT) {
        return false;
      } else {
        var elem = dom;
        if (elem.matches !== undefined) {
          return elem.matches(selector);
        } else if (elem.msMatchesSelector !== undefined) {
          return elem.msMatchesSelector(selector);
        } else if (elem.webkitMatchesSelector !== undefined) {
          return elem.webkitMatchesSelector(selector);
        } else if (elem.mozMatchesSelector !== undefined) {
          return elem.mozMatchesSelector(selector);
        } else {
          throw new Error('Browser lacks native selectors');
        }
      }
    };
    var bypassSelector = function (dom) {
      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;
    };
    var all = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom;
      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);
    };

    var eq = function (e1, e2) {
      return e1.dom === e2.dom;
    };

    var owner = function (element) {
      return SugarElement.fromDom(element.dom.ownerDocument);
    };
    var documentOrOwner = function (dos) {
      return isDocument(dos) ? dos : owner(dos);
    };
    var parent = function (element) {
      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);
    };
    var parents = function (element, isRoot) {
      var stop = isFunction(isRoot) ? isRoot : never;
      var dom = element.dom;
      var ret = [];
      while (dom.parentNode !== null && dom.parentNode !== undefined) {
        var rawParent = dom.parentNode;
        var p = SugarElement.fromDom(rawParent);
        ret.push(p);
        if (stop(p) === true) {
          break;
        } else {
          dom = rawParent;
        }
      }
      return ret;
    };
    var siblings = function (element) {
      var filterSelf = function (elements) {
        return filter(elements, function (x) {
          return !eq(element, x);
        });
      };
      return parent(element).map(children).map(filterSelf).getOr([]);
    };
    var children = function (element) {
      return map(element.dom.childNodes, SugarElement.fromDom);
    };

    var isShadowRoot = function (dos) {
      return isDocumentFragment(dos) && isNonNullable(dos.dom.host);
    };
    var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);
    var isSupported$1 = constant(supported);
    var getRootNode = supported ? function (e) {
      return SugarElement.fromDom(e.dom.getRootNode());
    } : documentOrOwner;
    var getShadowRoot = function (e) {
      var r = getRootNode(e);
      return isShadowRoot(r) ? Optional.some(r) : Optional.none();
    };
    var getShadowHost = function (e) {
      return SugarElement.fromDom(e.dom.host);
    };
    var getOriginalEventTarget = function (event) {
      if (isSupported$1() && isNonNullable(event.target)) {
        var el = SugarElement.fromDom(event.target);
        if (isElement(el) && isOpenShadowHost(el)) {
          if (event.composed && event.composedPath) {
            var composedPath = event.composedPath();
            if (composedPath) {
              return head(composedPath);
            }
          }
        }
      }
      return Optional.from(event.target);
    };
    var isOpenShadowHost = function (element) {
      return isNonNullable(element.dom.shadowRoot);
    };

    var inBody = function (element) {
      var dom = isText(element) ? element.dom.parentNode : element.dom;
      if (dom === undefined || dom === null || dom.ownerDocument === null) {
        return false;
      }
      var doc = dom.ownerDocument;
      return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {
        return doc.body.contains(dom);
      }, compose1(inBody, getShadowHost));
    };
    var getBody = function (doc) {
      var b = doc.dom.body;
      if (b === null || b === undefined) {
        throw new Error('Body is not available yet');
      }
      return SugarElement.fromDom(b);
    };

    var rawSet = function (dom, key, value) {
      if (isString(value) || isBoolean(value) || isNumber(value)) {
        dom.setAttribute(key, value + '');
      } else {
        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);
        throw new Error('Attribute value was not simple');
      }
    };
    var set = function (element, key, value) {
      rawSet(element.dom, key, value);
    };
    var get$2 = function (element, key) {
      var v = element.dom.getAttribute(key);
      return v === null ? undefined : v;
    };
    var remove = function (element, key) {
      element.dom.removeAttribute(key);
    };

    var internalSet = function (dom, property, value) {
      if (!isString(value)) {
        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);
        throw new Error('CSS value must be a string: ' + value);
      }
      if (isSupported(dom)) {
        dom.style.setProperty(property, value);
      }
    };
    var setAll = function (element, css) {
      var dom = element.dom;
      each$1(css, function (v, k) {
        internalSet(dom, k, v);
      });
    };
    var get$3 = function (element, property) {
      var dom = element.dom;
      var styles = window.getComputedStyle(dom);
      var r = styles.getPropertyValue(property);
      return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;
    };
    var getUnsafeProperty = function (dom, property) {
      return isSupported(dom) ? dom.style.getPropertyValue(property) : '';
    };

    var mkEvent = function (target, x, y, stop, prevent, kill, raw) {
      return {
        target: target,
        x: x,
        y: y,
        stop: stop,
        prevent: prevent,
        kill: kill,
        raw: raw
      };
    };
    var fromRawEvent = function (rawEvent) {
      var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));
      var stop = function () {
        return rawEvent.stopPropagation();
      };
      var prevent = function () {
        return rawEvent.preventDefault();
      };
      var kill = compose(prevent, stop);
      return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);
    };
    var handle = function (filter, handler) {
      return function (rawEvent) {
        if (filter(rawEvent)) {
          handler(fromRawEvent(rawEvent));
        }
      };
    };
    var binder = function (element, event, filter, handler, useCapture) {
      var wrapped = handle(filter, handler);
      element.dom.addEventListener(event, wrapped, useCapture);
      return { unbind: curry(unbind, element, event, wrapped, useCapture) };
    };
    var bind$1 = function (element, event, filter, handler) {
      return binder(element, event, filter, handler, false);
    };
    var unbind = function (element, event, handler, useCapture) {
      element.dom.removeEventListener(event, handler, useCapture);
    };

    var filter$1 = always;
    var bind$2 = function (element, event, handler) {
      return bind$1(element, event, filter$1, handler);
    };

    var r = function (left, top) {
      var translate = function (x, y) {
        return r(left + x, top + y);
      };
      return {
        left: left,
        top: top,
        translate: translate
      };
    };
    var SugarPosition = r;

    var get$4 = function (_DOC) {
      var doc = _DOC !== undefined ? _DOC.dom : document;
      var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;
      var y = doc.body.scrollTop || doc.documentElement.scrollTop;
      return SugarPosition(x, y);
    };

    var get$5 = function (_win) {
      var win = _win === undefined ? window : _win;
      return Optional.from(win['visualViewport']);
    };
    var bounds = function (x, y, width, height) {
      return {
        x: x,
        y: y,
        width: width,
        height: height,
        right: x + width,
        bottom: y + height
      };
    };
    var getBounds = function (_win) {
      var win = _win === undefined ? window : _win;
      var doc = win.document;
      var scroll = get$4(SugarElement.fromDom(doc));
      return get$5(win).fold(function () {
        var html = win.document.documentElement;
        var width = html.clientWidth;
        var height = html.clientHeight;
        return bounds(scroll.left, scroll.top, width, height);
      }, function (visualViewport) {
        return bounds(Math.max(visualViewport.pageLeft, scroll.left), Math.max(visualViewport.pageTop, scroll.top), visualViewport.width, visualViewport.height);
      });
    };
    var bind$3 = function (name, callback, _win) {
      return get$5(_win).map(function (visualViewport) {
        var handler = function (e) {
          return callback(fromRawEvent(e));
        };
        visualViewport.addEventListener(name, handler);
        return {
          unbind: function () {
            return visualViewport.removeEventListener(name, handler);
          }
        };
      }).getOrThunk(function () {
        return { unbind: noop };
      });
    };

    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');

    var global$2 = tinymce.util.Tools.resolve('tinymce.Env');

    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Delay');

    var fireFullscreenStateChanged = function (editor, state) {
      editor.fire('FullscreenStateChanged', { state: state });
    };

    var getFullscreenNative = function (editor) {
      return editor.getParam('fullscreen_native', false, 'boolean');
    };

    var getFullscreenRoot = function (editor) {
      var elem = SugarElement.fromDom(editor.getElement());
      return getShadowRoot(elem).map(getShadowHost).getOrThunk(function () {
        return getBody(owner(elem));
      });
    };
    var getFullscreenElement = function (root) {
      if (root.fullscreenElement !== undefined) {
        return root.fullscreenElement;
      } else if (root.msFullscreenElement !== undefined) {
        return root.msFullscreenElement;
      } else if (root.webkitFullscreenElement !== undefined) {
        return root.webkitFullscreenElement;
      } else {
        return null;
      }
    };
    var getFullscreenchangeEventName = function () {
      if (document.fullscreenElement !== undefined) {
        return 'fullscreenchange';
      } else if (document.msFullscreenElement !== undefined) {
        return 'MSFullscreenChange';
      } else if (document.webkitFullscreenElement !== undefined) {
        return 'webkitfullscreenchange';
      } else {
        return 'fullscreenchange';
      }
    };
    var requestFullscreen = function (sugarElem) {
      var elem = sugarElem.dom;
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.msRequestFullscreen) {
        elem.msRequestFullscreen();
      } else if (elem.webkitRequestFullScreen) {
        elem.webkitRequestFullScreen();
      }
    };
    var exitFullscreen = function (sugarDoc) {
      var doc = sugarDoc.dom;
      if (doc.exitFullscreen) {
        doc.exitFullscreen();
      } else if (doc.msExitFullscreen) {
        doc.msExitFullscreen();
      } else if (doc.webkitCancelFullScreen) {
        doc.webkitCancelFullScreen();
      }
    };
    var isFullscreenElement = function (elem) {
      return elem.dom === getFullscreenElement(owner(elem).dom);
    };

    var ancestors = function (scope, predicate, isRoot) {
      return filter(parents(scope, isRoot), predicate);
    };
    var siblings$1 = function (scope, predicate) {
      return filter(siblings(scope), predicate);
    };

    var all$1 = function (selector) {
      return all(selector);
    };
    var ancestors$1 = function (scope, selector, isRoot) {
      return ancestors(scope, function (e) {
        return is(e, selector);
      }, isRoot);
    };
    var siblings$2 = function (scope, selector) {
      return siblings$1(scope, function (e) {
        return is(e, selector);
      });
    };

    var attr = 'data-ephox-mobile-fullscreen-style';
    var siblingStyles = 'display:none!important;';
    var ancestorPosition = 'position:absolute!important;';
    var ancestorStyles = 'top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;';
    var bgFallback = 'background-color:rgb(255,255,255)!important;';
    var isAndroid = global$2.os.isAndroid();
    var matchColor = function (editorBody) {
      var color = get$3(editorBody, 'background-color');
      return color !== undefined && color !== '' ? 'background-color:' + color + '!important' : bgFallback;
    };
    var clobberStyles = function (dom, container, editorBody) {
      var gatherSiblings = function (element) {
        return siblings$2(element, '*:not(.tox-silver-sink)');
      };
      var clobber = function (clobberStyle) {
        return function (element) {
          var styles = get$2(element, 'style');
          var backup = styles === undefined ? 'no-styles' : styles.trim();
          if (backup === clobberStyle) {
            return;
          } else {
            set(element, attr, backup);
            setAll(element, dom.parseStyle(clobberStyle));
          }
        };
      };
      var ancestors = ancestors$1(container, '*');
      var siblings = bind(ancestors, gatherSiblings);
      var bgColor = matchColor(editorBody);
      each(siblings, clobber(siblingStyles));
      each(ancestors, clobber(ancestorPosition + ancestorStyles + bgColor));
      var containerStyles = isAndroid === true ? '' : ancestorPosition;
      clobber(containerStyles + ancestorStyles + bgColor)(container);
    };
    var restoreStyles = function (dom) {
      var clobberedEls = all$1('[' + attr + ']');
      each(clobberedEls, function (element) {
        var restore = get$2(element, attr);
        if (restore !== 'no-styles') {
          setAll(element, dom.parseStyle(restore));
        } else {
          remove(element, 'style');
        }
        remove(element, attr);
      });
    };

    var DOM = global$1.DOM;
    var getScrollPos = function () {
      var vp = getBounds(window);
      return {
        x: vp.x,
        y: vp.y
      };
    };
    var setScrollPos = function (pos) {
      window.scrollTo(pos.x, pos.y);
    };
    var viewportUpdate = get$5().fold(function () {
      return {
        bind: noop,
        unbind: noop
      };
    }, function (visualViewport) {
      var editorContainer = value();
      var resizeBinder = unbindable();
      var scrollBinder = unbindable();
      var refreshScroll = function () {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
      };
      var refreshVisualViewport = function () {
        window.requestAnimationFrame(function () {
          editorContainer.on(function (container) {
            return setAll(container, {
              top: visualViewport.offsetTop + 'px',
              left: visualViewport.offsetLeft + 'px',
              height: visualViewport.height + 'px',
              width: visualViewport.width + 'px'
            });
          });
        });
      };
      var update = global$3.throttle(function () {
        refreshScroll();
        refreshVisualViewport();
      }, 50);
      var bind = function (element) {
        editorContainer.set(element);
        update();
        resizeBinder.set(bind$3('resize', update));
        scrollBinder.set(bind$3('scroll', update));
      };
      var unbind = function () {
        editorContainer.on(function () {
          resizeBinder.clear();
          scrollBinder.clear();
        });
        editorContainer.clear();
      };
      return {
        bind: bind,
        unbind: unbind
      };
    });
    var toggleFullscreen = function (editor, fullscreenState) {
      var body = document.body;
      var documentElement = document.documentElement;
      var editorContainer = editor.getContainer();
      var editorContainerS = SugarElement.fromDom(editorContainer);
      var fullscreenRoot = getFullscreenRoot(editor);
      var fullscreenInfo = fullscreenState.get();
      var editorBody = SugarElement.fromDom(editor.getBody());
      var isTouch = global$2.deviceType.isTouch();
      var editorContainerStyle = editorContainer.style;
      var iframe = editor.iframeElement;
      var iframeStyle = iframe.style;
      var handleClasses = function (handler) {
        handler(body, 'tox-fullscreen');
        handler(documentElement, 'tox-fullscreen');
        handler(editorContainer, 'tox-fullscreen');
        getShadowRoot(editorContainerS).map(function (root) {
          return getShadowHost(root).dom;
        }).each(function (host) {
          handler(host, 'tox-fullscreen');
          handler(host, 'tox-shadowhost');
        });
      };
      var cleanup = function () {
        if (isTouch) {
          restoreStyles(editor.dom);
        }
        handleClasses(DOM.removeClass);
        viewportUpdate.unbind();
        Optional.from(fullscreenState.get()).each(function (info) {
          return info.fullscreenChangeHandler.unbind();
        });
      };
      if (!fullscreenInfo) {
        var fullscreenChangeHandler = bind$2(owner(fullscreenRoot), getFullscreenchangeEventName(), function (_evt) {
          if (getFullscreenNative(editor)) {
            if (!isFullscreenElement(fullscreenRoot) && fullscreenState.get() !== null) {
              toggleFullscreen(editor, fullscreenState);
            }
          }
        });
        var newFullScreenInfo = {
          scrollPos: getScrollPos(),
          containerWidth: editorContainerStyle.width,
          containerHeight: editorContainerStyle.height,
          containerTop: editorContainerStyle.top,
          containerLeft: editorContainerStyle.left,
          iframeWidth: iframeStyle.width,
          iframeHeight: iframeStyle.height,
          fullscreenChangeHandler: fullscreenChangeHandler
        };
        if (isTouch) {
          clobberStyles(editor.dom, editorContainerS, editorBody);
        }
        iframeStyle.width = iframeStyle.height = '100%';
        editorContainerStyle.width = editorContainerStyle.height = '';
        handleClasses(DOM.addClass);
        viewportUpdate.bind(editorContainerS);
        editor.on('remove', cleanup);
        fullscreenState.set(newFullScreenInfo);
        if (getFullscreenNative(editor)) {
          requestFullscreen(fullscreenRoot);
        }
        fireFullscreenStateChanged(editor, true);
      } else {
        fullscreenInfo.fullscreenChangeHandler.unbind();
        if (getFullscreenNative(editor) && isFullscreenElement(fullscreenRoot)) {
          exitFullscreen(owner(fullscreenRoot));
        }
        iframeStyle.width = fullscreenInfo.iframeWidth;
        iframeStyle.height = fullscreenInfo.iframeHeight;
        editorContainerStyle.width = fullscreenInfo.containerWidth;
        editorContainerStyle.height = fullscreenInfo.containerHeight;
        editorContainerStyle.top = fullscreenInfo.containerTop;
        editorContainerStyle.left = fullscreenInfo.containerLeft;
        setScrollPos(fullscreenInfo.scrollPos);
        fullscreenState.set(null);
        fireFullscreenStateChanged(editor, false);
        cleanup();
        editor.off('remove', cleanup);
      }
    };

    var register = function (editor, fullscreenState) {
      editor.addCommand('mceFullScreen', function () {
        toggleFullscreen(editor, fullscreenState);
      });
    };

    var makeSetupHandler = function (editor, fullscreenState) {
      return function (api) {
        api.setActive(fullscreenState.get() !== null);
        var editorEventCallback = function (e) {
          return api.setActive(e.state);
        };
        editor.on('FullscreenStateChanged', editorEventCallback);
        return function () {
          return editor.off('FullscreenStateChanged', editorEventCallback);
        };
      };
    };
    var register$1 = function (editor, fullscreenState) {
      editor.ui.registry.addToggleMenuItem('fullscreen', {
        text: 'Fullscreen',
        icon: 'fullscreen',
        shortcut: 'Meta+Shift+F',
        onAction: function () {
          return editor.execCommand('mceFullScreen');
        },
        onSetup: makeSetupHandler(editor, fullscreenState)
      });
      editor.ui.registry.addToggleButton('fullscreen', {
        tooltip: 'Fullscreen',
        icon: 'fullscreen',
        onAction: function () {
          return editor.execCommand('mceFullScreen');
        },
        onSetup: makeSetupHandler(editor, fullscreenState)
      });
    };

    function Plugin () {
      global.add('fullscreen', function (editor) {
        var fullscreenState = Cell(null);
        if (editor.inline) {
          return get(fullscreenState);
        }
        register(editor, fullscreenState);
        register$1(editor, fullscreenState);
        editor.addShortcut('Meta+Shift+F', '', 'mceFullScreen');
        return get(fullscreenState);
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX2Z1bGxzY3JlZW5faW5kZXhfanMuY2h1bmsuanMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL2Z1bGxzY3JlZW4vaW5kZXguanMiLCIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy9mdWxsc2NyZWVuL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcImZ1bGxzY3JlZW5cIiBwbHVnaW4gZm9yIHVzYWdlIHdpdGggbW9kdWxlIGxvYWRlcnNcbi8vIFVzYWdlOlxuLy8gICBDb21tb25KUzpcbi8vICAgICByZXF1aXJlKCd0aW55bWNlL3BsdWdpbnMvZnVsbHNjcmVlbicpXG4vLyAgIEVTMjAxNTpcbi8vICAgICBpbXBvcnQgJ3RpbnltY2UvcGx1Z2lucy9mdWxsc2NyZWVuJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgQ2VsbCA9IGZ1bmN0aW9uIChpbml0aWFsKSB7XG4gICAgICB2YXIgdmFsdWUgPSBpbml0aWFsO1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB2YWx1ZSA9IHY7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIGdldCA9IGZ1bmN0aW9uIChmdWxsc2NyZWVuU3RhdGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzRnVsbHNjcmVlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBmdWxsc2NyZWVuU3RhdGUuZ2V0KCkgIT09IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciB0eXBlT2YgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdmFyIHQgPSB0eXBlb2YgeDtcbiAgICAgIGlmICh4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiAnbnVsbCc7XG4gICAgICB9IGVsc2UgaWYgKHQgPT09ICdvYmplY3QnICYmIChBcnJheS5wcm90b3R5cGUuaXNQcm90b3R5cGVPZih4KSB8fCB4LmNvbnN0cnVjdG9yICYmIHguY29uc3RydWN0b3IubmFtZSA9PT0gJ0FycmF5JykpIHtcbiAgICAgICAgcmV0dXJuICdhcnJheSc7XG4gICAgICB9IGVsc2UgaWYgKHQgPT09ICdvYmplY3QnICYmIChTdHJpbmcucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoeCkgfHwgeC5jb25zdHJ1Y3RvciAmJiB4LmNvbnN0cnVjdG9yLm5hbWUgPT09ICdTdHJpbmcnKSkge1xuICAgICAgICByZXR1cm4gJ3N0cmluZyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpc1R5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZU9mKHZhbHVlKSA9PT0gdHlwZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNTaW1wbGVUeXBlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gdHlwZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNTdHJpbmcgPSBpc1R5cGUoJ3N0cmluZycpO1xuICAgIHZhciBpc0FycmF5ID0gaXNUeXBlKCdhcnJheScpO1xuICAgIHZhciBpc0Jvb2xlYW4gPSBpc1NpbXBsZVR5cGUoJ2Jvb2xlYW4nKTtcbiAgICB2YXIgaXNOdWxsYWJsZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICByZXR1cm4gYSA9PT0gbnVsbCB8fCBhID09PSB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICB2YXIgaXNOb25OdWxsYWJsZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICByZXR1cm4gIWlzTnVsbGFibGUoYSk7XG4gICAgfTtcbiAgICB2YXIgaXNGdW5jdGlvbiA9IGlzU2ltcGxlVHlwZSgnZnVuY3Rpb24nKTtcbiAgICB2YXIgaXNOdW1iZXIgPSBpc1NpbXBsZVR5cGUoJ251bWJlcicpO1xuXG4gICAgdmFyIG5vb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgfTtcbiAgICB2YXIgY29tcG9zZSA9IGZ1bmN0aW9uIChmYSwgZmIpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYShmYi5hcHBseShudWxsLCBhcmdzKSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNvbXBvc2UxID0gZnVuY3Rpb24gKGZiYywgZmFiKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgcmV0dXJuIGZiYyhmYWIoYSkpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjb25zdGFudCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIGN1cnJ5KGZuKSB7XG4gICAgICB2YXIgaW5pdGlhbEFyZ3MgPSBbXTtcbiAgICAgIGZvciAodmFyIF9pID0gMTsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIGluaXRpYWxBcmdzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJlc3RBcmdzID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgcmVzdEFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYWxsID0gaW5pdGlhbEFyZ3MuY29uY2F0KHJlc3RBcmdzKTtcbiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KG51bGwsIGFsbCk7XG4gICAgICB9O1xuICAgIH1cbiAgICB2YXIgbmV2ZXIgPSBjb25zdGFudChmYWxzZSk7XG4gICAgdmFyIGFsd2F5cyA9IGNvbnN0YW50KHRydWUpO1xuXG4gICAgdmFyIG5vbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gTk9ORTtcbiAgICB9O1xuICAgIHZhciBOT05FID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVxID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIG8uaXNOb25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAodGh1bmspIHtcbiAgICAgICAgcmV0dXJuIHRodW5rKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGlkID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBmb2xkOiBmdW5jdGlvbiAobiwgX3MpIHtcbiAgICAgICAgICByZXR1cm4gbigpO1xuICAgICAgICB9LFxuICAgICAgICBpczogbmV2ZXIsXG4gICAgICAgIGlzU29tZTogbmV2ZXIsXG4gICAgICAgIGlzTm9uZTogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWQsXG4gICAgICAgIGdldE9yVGh1bms6IGNhbGwsXG4gICAgICAgIGdldE9yRGllOiBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyB8fCAnZXJyb3I6IGdldE9yRGllIGNhbGxlZCBvbiBub25lLicpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50KG51bGwpLFxuICAgICAgICBnZXRPclVuZGVmaW5lZDogY29uc3RhbnQodW5kZWZpbmVkKSxcbiAgICAgICAgb3I6IGlkLFxuICAgICAgICBvclRodW5rOiBjYWxsLFxuICAgICAgICBtYXA6IG5vbmUsXG4gICAgICAgIGVhY2g6IG5vb3AsXG4gICAgICAgIGJpbmQ6IG5vbmUsXG4gICAgICAgIGV4aXN0czogbmV2ZXIsXG4gICAgICAgIGZvcmFsbDogYWx3YXlzLFxuICAgICAgICBmaWx0ZXI6IG5vbmUsXG4gICAgICAgIGVxdWFsczogZXEsXG4gICAgICAgIGVxdWFsc186IGVxLFxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogY29uc3RhbnQoJ25vbmUoKScpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH0oKTtcbiAgICB2YXIgc29tZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICB2YXIgY29uc3RhbnRfYSA9IGNvbnN0YW50KGEpO1xuICAgICAgdmFyIHNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtZTtcbiAgICAgIH07XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIHMpIHtcbiAgICAgICAgICByZXR1cm4gcyhhKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IHY7XG4gICAgICAgIH0sXG4gICAgICAgIGlzU29tZTogYWx3YXlzLFxuICAgICAgICBpc05vbmU6IG5ldmVyLFxuICAgICAgICBnZXRPcjogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JEaWU6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yTnVsbDogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50X2EsXG4gICAgICAgIG9yOiBzZWxmLFxuICAgICAgICBvclRodW5rOiBzZWxmLFxuICAgICAgICBtYXA6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIHNvbWUoZihhKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVhY2g6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgZihhKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgZXhpc3RzOiBiaW5kLFxuICAgICAgICBmb3JhbGw6IGJpbmQsXG4gICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gZihhKSA/IG1lIDogTk9ORTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbYV07XG4gICAgICAgIH0sXG4gICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdzb21lKCcgKyBhICsgJyknO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgcmV0dXJuIG8uaXMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVxdWFsc186IGZ1bmN0aW9uIChvLCBlbGVtZW50RXEpIHtcbiAgICAgICAgICByZXR1cm4gby5mb2xkKG5ldmVyLCBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRFcShhLCBiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9O1xuICAgIHZhciBmcm9tID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IE5PTkUgOiBzb21lKHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBPcHRpb25hbCA9IHtcbiAgICAgIHNvbWU6IHNvbWUsXG4gICAgICBub25lOiBub25lLFxuICAgICAgZnJvbTogZnJvbVxuICAgIH07XG5cbiAgICB2YXIgcmV2b2NhYmxlID0gZnVuY3Rpb24gKGRvUmV2b2tlKSB7XG4gICAgICB2YXIgc3ViamVjdCA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciByZXZva2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LmdldCgpLmVhY2goZG9SZXZva2UpO1xuICAgICAgfTtcbiAgICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV2b2tlKCk7XG4gICAgICAgIHN1YmplY3Quc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV2b2tlKCk7XG4gICAgICAgIHN1YmplY3Quc2V0KE9wdGlvbmFsLnNvbWUocykpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgaXNTZXQ6IGlzU2V0LFxuICAgICAgICBzZXQ6IHNldFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB1bmJpbmRhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHJldm9jYWJsZShmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gcy51bmJpbmQoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN1YmplY3QgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5zZXQoT3B0aW9uYWwuc29tZShzKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5lYWNoKGYpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGlzU2V0OiBpc1NldCxcbiAgICAgICAgb246IG9uXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgbmF0aXZlUHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICAgIHZhciBtYXAgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHZhciBsZW4gPSB4cy5sZW5ndGg7XG4gICAgICB2YXIgciA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICByW2ldID0gZih4LCBpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBmKHgsIGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGZpbHRlciA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBpZiAocHJlZCh4LCBpKSkge1xuICAgICAgICAgIHIucHVzaCh4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICBpZiAoIWlzQXJyYXkoeHNbaV0pKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcnIuZmxhdHRlbiBpdGVtICcgKyBpICsgJyB3YXMgbm90IGFuIGFycmF5LCBpbnB1dDogJyArIHhzKTtcbiAgICAgICAgfVxuICAgICAgICBuYXRpdmVQdXNoLmFwcGx5KHIsIHhzW2ldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHJldHVybiBmbGF0dGVuKG1hcCh4cywgZikpO1xuICAgIH07XG4gICAgdmFyIGdldCQxID0gZnVuY3Rpb24gKHhzLCBpKSB7XG4gICAgICByZXR1cm4gaSA+PSAwICYmIGkgPCB4cy5sZW5ndGggPyBPcHRpb25hbC5zb21lKHhzW2ldKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBoZWFkID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICByZXR1cm4gZ2V0JDEoeHMsIDApO1xuICAgIH07XG5cbiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzO1xuICAgIHZhciBlYWNoJDEgPSBmdW5jdGlvbiAob2JqLCBmKSB7XG4gICAgICB2YXIgcHJvcHMgPSBrZXlzKG9iaik7XG4gICAgICBmb3IgKHZhciBrID0gMCwgbGVuID0gcHJvcHMubGVuZ3RoOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgdmFyIGkgPSBwcm9wc1trXTtcbiAgICAgICAgdmFyIHggPSBvYmpbaV07XG4gICAgICAgIGYoeCwgaSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBpc1N1cHBvcnRlZCA9IGZ1bmN0aW9uIChkb20pIHtcbiAgICAgIHJldHVybiBkb20uc3R5bGUgIT09IHVuZGVmaW5lZCAmJiBpc0Z1bmN0aW9uKGRvbS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKTtcbiAgICB9O1xuXG4gICAgdmFyIGZyb21IdG1sID0gZnVuY3Rpb24gKGh0bWwsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgZGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICBpZiAoIWRpdi5oYXNDaGlsZE5vZGVzKCkgfHwgZGl2LmNoaWxkTm9kZXMubGVuZ3RoID4gMSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdIVE1MIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlJywgaHRtbCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSFRNTCBtdXN0IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJvbURvbShkaXYuY2hpbGROb2Rlc1swXSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbVRhZyA9IGZ1bmN0aW9uICh0YWcsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgbm9kZSA9IGRvYy5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICByZXR1cm4gZnJvbURvbShub2RlKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGV4dCA9IGZ1bmN0aW9uICh0ZXh0LCBzY29wZSkge1xuICAgICAgdmFyIGRvYyA9IHNjb3BlIHx8IGRvY3VtZW50O1xuICAgICAgdmFyIG5vZGUgPSBkb2MuY3JlYXRlVGV4dE5vZGUodGV4dCk7XG4gICAgICByZXR1cm4gZnJvbURvbShub2RlKTtcbiAgICB9O1xuICAgIHZhciBmcm9tRG9tID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIGlmIChub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vZGUgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4geyBkb206IG5vZGUgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tUG9pbnQgPSBmdW5jdGlvbiAoZG9jRWxtLCB4LCB5KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShkb2NFbG0uZG9tLmVsZW1lbnRGcm9tUG9pbnQoeCwgeSkpLm1hcChmcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBTdWdhckVsZW1lbnQgPSB7XG4gICAgICBmcm9tSHRtbDogZnJvbUh0bWwsXG4gICAgICBmcm9tVGFnOiBmcm9tVGFnLFxuICAgICAgZnJvbVRleHQ6IGZyb21UZXh0LFxuICAgICAgZnJvbURvbTogZnJvbURvbSxcbiAgICAgIGZyb21Qb2ludDogZnJvbVBvaW50XG4gICAgfTtcblxuICAgIHZhciBHbG9iYWwgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpczsnKSgpO1xuXG4gICAgdmFyIERPQ1VNRU5UID0gOTtcbiAgICB2YXIgRE9DVU1FTlRfRlJBR01FTlQgPSAxMTtcbiAgICB2YXIgRUxFTUVOVCA9IDE7XG4gICAgdmFyIFRFWFQgPSAzO1xuXG4gICAgdmFyIHR5cGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLm5vZGVUeXBlO1xuICAgIH07XG4gICAgdmFyIGlzVHlwZSQxID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdHlwZShlbGVtZW50KSA9PT0gdDtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNFbGVtZW50ID0gaXNUeXBlJDEoRUxFTUVOVCk7XG4gICAgdmFyIGlzVGV4dCA9IGlzVHlwZSQxKFRFWFQpO1xuICAgIHZhciBpc0RvY3VtZW50ID0gaXNUeXBlJDEoRE9DVU1FTlQpO1xuICAgIHZhciBpc0RvY3VtZW50RnJhZ21lbnQgPSBpc1R5cGUkMShET0NVTUVOVF9GUkFHTUVOVCk7XG5cbiAgICB2YXIgaXMgPSBmdW5jdGlvbiAoZWxlbWVudCwgc2VsZWN0b3IpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIGlmIChkb20ubm9kZVR5cGUgIT09IEVMRU1FTlQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGVsZW0gPSBkb207XG4gICAgICAgIGlmIChlbGVtLm1hdGNoZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLm1hdGNoZXMoc2VsZWN0b3IpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubXNNYXRjaGVzU2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLndlYmtpdE1hdGNoZXNTZWxlY3RvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuIGVsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLm1vek1hdGNoZXNTZWxlY3RvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuIGVsZW0ubW96TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Jyb3dzZXIgbGFja3MgbmF0aXZlIHNlbGVjdG9ycycpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgYnlwYXNzU2VsZWN0b3IgPSBmdW5jdGlvbiAoZG9tKSB7XG4gICAgICByZXR1cm4gZG9tLm5vZGVUeXBlICE9PSBFTEVNRU5UICYmIGRvbS5ub2RlVHlwZSAhPT0gRE9DVU1FTlQgJiYgZG9tLm5vZGVUeXBlICE9PSBET0NVTUVOVF9GUkFHTUVOVCB8fCBkb20uY2hpbGRFbGVtZW50Q291bnQgPT09IDA7XG4gICAgfTtcbiAgICB2YXIgYWxsID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBzY29wZSkge1xuICAgICAgdmFyIGJhc2UgPSBzY29wZSA9PT0gdW5kZWZpbmVkID8gZG9jdW1lbnQgOiBzY29wZS5kb207XG4gICAgICByZXR1cm4gYnlwYXNzU2VsZWN0b3IoYmFzZSkgPyBbXSA6IG1hcChiYXNlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLCBTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcblxuICAgIHZhciBlcSA9IGZ1bmN0aW9uIChlMSwgZTIpIHtcbiAgICAgIHJldHVybiBlMS5kb20gPT09IGUyLmRvbTtcbiAgICB9O1xuXG4gICAgdmFyIG93bmVyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShlbGVtZW50LmRvbS5vd25lckRvY3VtZW50KTtcbiAgICB9O1xuICAgIHZhciBkb2N1bWVudE9yT3duZXIgPSBmdW5jdGlvbiAoZG9zKSB7XG4gICAgICByZXR1cm4gaXNEb2N1bWVudChkb3MpID8gZG9zIDogb3duZXIoZG9zKTtcbiAgICB9O1xuICAgIHZhciBwYXJlbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZWxlbWVudC5kb20ucGFyZW50Tm9kZSkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBwYXJlbnRzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGlzUm9vdCkge1xuICAgICAgdmFyIHN0b3AgPSBpc0Z1bmN0aW9uKGlzUm9vdCkgPyBpc1Jvb3QgOiBuZXZlcjtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgIHdoaWxlIChkb20ucGFyZW50Tm9kZSAhPT0gbnVsbCAmJiBkb20ucGFyZW50Tm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhciByYXdQYXJlbnQgPSBkb20ucGFyZW50Tm9kZTtcbiAgICAgICAgdmFyIHAgPSBTdWdhckVsZW1lbnQuZnJvbURvbShyYXdQYXJlbnQpO1xuICAgICAgICByZXQucHVzaChwKTtcbiAgICAgICAgaWYgKHN0b3AocCkgPT09IHRydWUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkb20gPSByYXdQYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfTtcbiAgICB2YXIgc2libGluZ3MgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGZpbHRlclNlbGYgPSBmdW5jdGlvbiAoZWxlbWVudHMpIHtcbiAgICAgICAgcmV0dXJuIGZpbHRlcihlbGVtZW50cywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICByZXR1cm4gIWVxKGVsZW1lbnQsIHgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gcGFyZW50KGVsZW1lbnQpLm1hcChjaGlsZHJlbikubWFwKGZpbHRlclNlbGYpLmdldE9yKFtdKTtcbiAgICB9O1xuICAgIHZhciBjaGlsZHJlbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gbWFwKGVsZW1lbnQuZG9tLmNoaWxkTm9kZXMsIFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzU2hhZG93Um9vdCA9IGZ1bmN0aW9uIChkb3MpIHtcbiAgICAgIHJldHVybiBpc0RvY3VtZW50RnJhZ21lbnQoZG9zKSAmJiBpc05vbk51bGxhYmxlKGRvcy5kb20uaG9zdCk7XG4gICAgfTtcbiAgICB2YXIgc3VwcG9ydGVkID0gaXNGdW5jdGlvbihFbGVtZW50LnByb3RvdHlwZS5hdHRhY2hTaGFkb3cpICYmIGlzRnVuY3Rpb24oTm9kZS5wcm90b3R5cGUuZ2V0Um9vdE5vZGUpO1xuICAgIHZhciBpc1N1cHBvcnRlZCQxID0gY29uc3RhbnQoc3VwcG9ydGVkKTtcbiAgICB2YXIgZ2V0Um9vdE5vZGUgPSBzdXBwb3J0ZWQgPyBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGUuZG9tLmdldFJvb3ROb2RlKCkpO1xuICAgIH0gOiBkb2N1bWVudE9yT3duZXI7XG4gICAgdmFyIGdldFNoYWRvd1Jvb3QgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHIgPSBnZXRSb290Tm9kZShlKTtcbiAgICAgIHJldHVybiBpc1NoYWRvd1Jvb3QocikgPyBPcHRpb25hbC5zb21lKHIpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGdldFNoYWRvd0hvc3QgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGUuZG9tLmhvc3QpO1xuICAgIH07XG4gICAgdmFyIGdldE9yaWdpbmFsRXZlbnRUYXJnZXQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmIChpc1N1cHBvcnRlZCQxKCkgJiYgaXNOb25OdWxsYWJsZShldmVudC50YXJnZXQpKSB7XG4gICAgICAgIHZhciBlbCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmIChpc0VsZW1lbnQoZWwpICYmIGlzT3BlblNoYWRvd0hvc3QoZWwpKSB7XG4gICAgICAgICAgaWYgKGV2ZW50LmNvbXBvc2VkICYmIGV2ZW50LmNvbXBvc2VkUGF0aCkge1xuICAgICAgICAgICAgdmFyIGNvbXBvc2VkUGF0aCA9IGV2ZW50LmNvbXBvc2VkUGF0aCgpO1xuICAgICAgICAgICAgaWYgKGNvbXBvc2VkUGF0aCkge1xuICAgICAgICAgICAgICByZXR1cm4gaGVhZChjb21wb3NlZFBhdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZXZlbnQudGFyZ2V0KTtcbiAgICB9O1xuICAgIHZhciBpc09wZW5TaGFkb3dIb3N0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBpc05vbk51bGxhYmxlKGVsZW1lbnQuZG9tLnNoYWRvd1Jvb3QpO1xuICAgIH07XG5cbiAgICB2YXIgaW5Cb2R5ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBpc1RleHQoZWxlbWVudCkgPyBlbGVtZW50LmRvbS5wYXJlbnROb2RlIDogZWxlbWVudC5kb207XG4gICAgICBpZiAoZG9tID09PSB1bmRlZmluZWQgfHwgZG9tID09PSBudWxsIHx8IGRvbS5vd25lckRvY3VtZW50ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBkb2MgPSBkb20ub3duZXJEb2N1bWVudDtcbiAgICAgIHJldHVybiBnZXRTaGFkb3dSb290KFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRvbSkpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZG9jLmJvZHkuY29udGFpbnMoZG9tKTtcbiAgICAgIH0sIGNvbXBvc2UxKGluQm9keSwgZ2V0U2hhZG93SG9zdCkpO1xuICAgIH07XG4gICAgdmFyIGdldEJvZHkgPSBmdW5jdGlvbiAoZG9jKSB7XG4gICAgICB2YXIgYiA9IGRvYy5kb20uYm9keTtcbiAgICAgIGlmIChiID09PSBudWxsIHx8IGIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JvZHkgaXMgbm90IGF2YWlsYWJsZSB5ZXQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShiKTtcbiAgICB9O1xuXG4gICAgdmFyIHJhd1NldCA9IGZ1bmN0aW9uIChkb20sIGtleSwgdmFsdWUpIHtcbiAgICAgIGlmIChpc1N0cmluZyh2YWx1ZSkgfHwgaXNCb29sZWFuKHZhbHVlKSB8fCBpc051bWJlcih2YWx1ZSkpIHtcbiAgICAgICAgZG9tLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlICsgJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBjYWxsIHRvIEF0dHJpYnV0ZS5zZXQuIEtleSAnLCBrZXksICc6OiBWYWx1ZSAnLCB2YWx1ZSwgJzo6IEVsZW1lbnQgJywgZG9tKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRyaWJ1dGUgdmFsdWUgd2FzIG5vdCBzaW1wbGUnKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCwga2V5LCB2YWx1ZSkge1xuICAgICAgcmF3U2V0KGVsZW1lbnQuZG9tLCBrZXksIHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBnZXQkMiA9IGZ1bmN0aW9uIChlbGVtZW50LCBrZXkpIHtcbiAgICAgIHZhciB2ID0gZWxlbWVudC5kb20uZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgICByZXR1cm4gdiA9PT0gbnVsbCA/IHVuZGVmaW5lZCA6IHY7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSkge1xuICAgICAgZWxlbWVudC5kb20ucmVtb3ZlQXR0cmlidXRlKGtleSk7XG4gICAgfTtcblxuICAgIHZhciBpbnRlcm5hbFNldCA9IGZ1bmN0aW9uIChkb20sIHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgaWYgKCFpc1N0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBjYWxsIHRvIENTUy5zZXQuIFByb3BlcnR5ICcsIHByb3BlcnR5LCAnOjogVmFsdWUgJywgdmFsdWUsICc6OiBFbGVtZW50ICcsIGRvbSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ1NTIHZhbHVlIG11c3QgYmUgYSBzdHJpbmc6ICcgKyB2YWx1ZSk7XG4gICAgICB9XG4gICAgICBpZiAoaXNTdXBwb3J0ZWQoZG9tKSkge1xuICAgICAgICBkb20uc3R5bGUuc2V0UHJvcGVydHkocHJvcGVydHksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXRBbGwgPSBmdW5jdGlvbiAoZWxlbWVudCwgY3NzKSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBlYWNoJDEoY3NzLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICBpbnRlcm5hbFNldChkb20sIGssIHYpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0JDMgPSBmdW5jdGlvbiAoZWxlbWVudCwgcHJvcGVydHkpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIHZhciBzdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShkb20pO1xuICAgICAgdmFyIHIgPSBzdHlsZXMuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSk7XG4gICAgICByZXR1cm4gciA9PT0gJycgJiYgIWluQm9keShlbGVtZW50KSA/IGdldFVuc2FmZVByb3BlcnR5KGRvbSwgcHJvcGVydHkpIDogcjtcbiAgICB9O1xuICAgIHZhciBnZXRVbnNhZmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIChkb20sIHByb3BlcnR5KSB7XG4gICAgICByZXR1cm4gaXNTdXBwb3J0ZWQoZG9tKSA/IGRvbS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5KSA6ICcnO1xuICAgIH07XG5cbiAgICB2YXIgbWtFdmVudCA9IGZ1bmN0aW9uICh0YXJnZXQsIHgsIHksIHN0b3AsIHByZXZlbnQsIGtpbGwsIHJhdykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgIHg6IHgsXG4gICAgICAgIHk6IHksXG4gICAgICAgIHN0b3A6IHN0b3AsXG4gICAgICAgIHByZXZlbnQ6IHByZXZlbnQsXG4gICAgICAgIGtpbGw6IGtpbGwsXG4gICAgICAgIHJhdzogcmF3XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGZyb21SYXdFdmVudCA9IGZ1bmN0aW9uIChyYXdFdmVudCkge1xuICAgICAgdmFyIHRhcmdldCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGdldE9yaWdpbmFsRXZlbnRUYXJnZXQocmF3RXZlbnQpLmdldE9yKHJhd0V2ZW50LnRhcmdldCkpO1xuICAgICAgdmFyIHN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByYXdFdmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH07XG4gICAgICB2YXIgcHJldmVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJhd0V2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9O1xuICAgICAgdmFyIGtpbGwgPSBjb21wb3NlKHByZXZlbnQsIHN0b3ApO1xuICAgICAgcmV0dXJuIG1rRXZlbnQodGFyZ2V0LCByYXdFdmVudC5jbGllbnRYLCByYXdFdmVudC5jbGllbnRZLCBzdG9wLCBwcmV2ZW50LCBraWxsLCByYXdFdmVudCk7XG4gICAgfTtcbiAgICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gKGZpbHRlciwgaGFuZGxlcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyYXdFdmVudCkge1xuICAgICAgICBpZiAoZmlsdGVyKHJhd0V2ZW50KSkge1xuICAgICAgICAgIGhhbmRsZXIoZnJvbVJhd0V2ZW50KHJhd0V2ZW50KSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYmluZGVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50LCBmaWx0ZXIsIGhhbmRsZXIsIHVzZUNhcHR1cmUpIHtcbiAgICAgIHZhciB3cmFwcGVkID0gaGFuZGxlKGZpbHRlciwgaGFuZGxlcik7XG4gICAgICBlbGVtZW50LmRvbS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCB3cmFwcGVkLCB1c2VDYXB0dXJlKTtcbiAgICAgIHJldHVybiB7IHVuYmluZDogY3VycnkodW5iaW5kLCBlbGVtZW50LCBldmVudCwgd3JhcHBlZCwgdXNlQ2FwdHVyZSkgfTtcbiAgICB9O1xuICAgIHZhciBiaW5kJDEgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGZpbHRlciwgaGFuZGxlcikge1xuICAgICAgcmV0dXJuIGJpbmRlcihlbGVtZW50LCBldmVudCwgZmlsdGVyLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgdW5iaW5kID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyLCB1c2VDYXB0dXJlKSB7XG4gICAgICBlbGVtZW50LmRvbS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCB1c2VDYXB0dXJlKTtcbiAgICB9O1xuXG4gICAgdmFyIGZpbHRlciQxID0gYWx3YXlzO1xuICAgIHZhciBiaW5kJDIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIpIHtcbiAgICAgIHJldHVybiBiaW5kJDEoZWxlbWVudCwgZXZlbnQsIGZpbHRlciQxLCBoYW5kbGVyKTtcbiAgICB9O1xuXG4gICAgdmFyIHIgPSBmdW5jdGlvbiAobGVmdCwgdG9wKSB7XG4gICAgICB2YXIgdHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIHIobGVmdCArIHgsIHRvcCArIHkpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgIHRvcDogdG9wLFxuICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTdWdhclBvc2l0aW9uID0gcjtcblxuICAgIHZhciBnZXQkNCA9IGZ1bmN0aW9uIChfRE9DKSB7XG4gICAgICB2YXIgZG9jID0gX0RPQyAhPT0gdW5kZWZpbmVkID8gX0RPQy5kb20gOiBkb2N1bWVudDtcbiAgICAgIHZhciB4ID0gZG9jLmJvZHkuc2Nyb2xsTGVmdCB8fCBkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQ7XG4gICAgICB2YXIgeSA9IGRvYy5ib2R5LnNjcm9sbFRvcCB8fCBkb2MuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgIHJldHVybiBTdWdhclBvc2l0aW9uKHgsIHkpO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0JDUgPSBmdW5jdGlvbiAoX3dpbikge1xuICAgICAgdmFyIHdpbiA9IF93aW4gPT09IHVuZGVmaW5lZCA/IHdpbmRvdyA6IF93aW47XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbSh3aW5bJ3Zpc3VhbFZpZXdwb3J0J10pO1xuICAgIH07XG4gICAgdmFyIGJvdW5kcyA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5LFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICByaWdodDogeCArIHdpZHRoLFxuICAgICAgICBib3R0b206IHkgKyBoZWlnaHRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0Qm91bmRzID0gZnVuY3Rpb24gKF93aW4pIHtcbiAgICAgIHZhciB3aW4gPSBfd2luID09PSB1bmRlZmluZWQgPyB3aW5kb3cgOiBfd2luO1xuICAgICAgdmFyIGRvYyA9IHdpbi5kb2N1bWVudDtcbiAgICAgIHZhciBzY3JvbGwgPSBnZXQkNChTdWdhckVsZW1lbnQuZnJvbURvbShkb2MpKTtcbiAgICAgIHJldHVybiBnZXQkNSh3aW4pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaHRtbCA9IHdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICAgIHZhciB3aWR0aCA9IGh0bWwuY2xpZW50V2lkdGg7XG4gICAgICAgIHZhciBoZWlnaHQgPSBodG1sLmNsaWVudEhlaWdodDtcbiAgICAgICAgcmV0dXJuIGJvdW5kcyhzY3JvbGwubGVmdCwgc2Nyb2xsLnRvcCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICB9LCBmdW5jdGlvbiAodmlzdWFsVmlld3BvcnQpIHtcbiAgICAgICAgcmV0dXJuIGJvdW5kcyhNYXRoLm1heCh2aXN1YWxWaWV3cG9ydC5wYWdlTGVmdCwgc2Nyb2xsLmxlZnQpLCBNYXRoLm1heCh2aXN1YWxWaWV3cG9ydC5wYWdlVG9wLCBzY3JvbGwudG9wKSwgdmlzdWFsVmlld3BvcnQud2lkdGgsIHZpc3VhbFZpZXdwb3J0LmhlaWdodCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBiaW5kJDMgPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2ssIF93aW4pIHtcbiAgICAgIHJldHVybiBnZXQkNShfd2luKS5tYXAoZnVuY3Rpb24gKHZpc3VhbFZpZXdwb3J0KSB7XG4gICAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZnJvbVJhd0V2ZW50KGUpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmlzdWFsVmlld3BvcnQuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBoYW5kbGVyKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1bmJpbmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB2aXN1YWxWaWV3cG9ydC5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIGhhbmRsZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4geyB1bmJpbmQ6IG5vb3AgfTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDEgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5kb20uRE9NVXRpbHMnKTtcblxuICAgIHZhciBnbG9iYWwkMiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLkVudicpO1xuXG4gICAgdmFyIGdsb2JhbCQzID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5EZWxheScpO1xuXG4gICAgdmFyIGZpcmVGdWxsc2NyZWVuU3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKGVkaXRvciwgc3RhdGUpIHtcbiAgICAgIGVkaXRvci5maXJlKCdGdWxsc2NyZWVuU3RhdGVDaGFuZ2VkJywgeyBzdGF0ZTogc3RhdGUgfSk7XG4gICAgfTtcblxuICAgIHZhciBnZXRGdWxsc2NyZWVuTmF0aXZlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnZnVsbHNjcmVlbl9uYXRpdmUnLCBmYWxzZSwgJ2Jvb2xlYW4nKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldEZ1bGxzY3JlZW5Sb290ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGVsZW0gPSBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0RWxlbWVudCgpKTtcbiAgICAgIHJldHVybiBnZXRTaGFkb3dSb290KGVsZW0pLm1hcChnZXRTaGFkb3dIb3N0KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldEJvZHkob3duZXIoZWxlbSkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RnVsbHNjcmVlbkVsZW1lbnQgPSBmdW5jdGlvbiAocm9vdCkge1xuICAgICAgaWYgKHJvb3QuZnVsbHNjcmVlbkVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gcm9vdC5mdWxsc2NyZWVuRWxlbWVudDtcbiAgICAgIH0gZWxzZSBpZiAocm9vdC5tc0Z1bGxzY3JlZW5FbGVtZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHJvb3QubXNGdWxsc2NyZWVuRWxlbWVudDtcbiAgICAgIH0gZWxzZSBpZiAocm9vdC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiByb290LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0RnVsbHNjcmVlbmNoYW5nZUV2ZW50TmFtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAnZnVsbHNjcmVlbmNoYW5nZSc7XG4gICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gJ01TRnVsbHNjcmVlbkNoYW5nZSc7XG4gICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuICd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnZnVsbHNjcmVlbmNoYW5nZSc7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVxdWVzdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoc3VnYXJFbGVtKSB7XG4gICAgICB2YXIgZWxlbSA9IHN1Z2FyRWxlbS5kb207XG4gICAgICBpZiAoZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICBlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKCk7XG4gICAgICB9IGVsc2UgaWYgKGVsZW0ubXNSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICBlbGVtLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTtcbiAgICAgIH0gZWxzZSBpZiAoZWxlbS53ZWJraXRSZXF1ZXN0RnVsbFNjcmVlbikge1xuICAgICAgICBlbGVtLndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZXhpdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoc3VnYXJEb2MpIHtcbiAgICAgIHZhciBkb2MgPSBzdWdhckRvYy5kb207XG4gICAgICBpZiAoZG9jLmV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgIGRvYy5leGl0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmIChkb2MubXNFeGl0RnVsbHNjcmVlbikge1xuICAgICAgICBkb2MubXNFeGl0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmIChkb2Mud2Via2l0Q2FuY2VsRnVsbFNjcmVlbikge1xuICAgICAgICBkb2Mud2Via2l0Q2FuY2VsRnVsbFNjcmVlbigpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGlzRnVsbHNjcmVlbkVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgcmV0dXJuIGVsZW0uZG9tID09PSBnZXRGdWxsc2NyZWVuRWxlbWVudChvd25lcihlbGVtKS5kb20pO1xuICAgIH07XG5cbiAgICB2YXIgYW5jZXN0b3JzID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGZpbHRlcihwYXJlbnRzKHNjb3BlLCBpc1Jvb3QpLCBwcmVkaWNhdGUpO1xuICAgIH07XG4gICAgdmFyIHNpYmxpbmdzJDEgPSBmdW5jdGlvbiAoc2NvcGUsIHByZWRpY2F0ZSkge1xuICAgICAgcmV0dXJuIGZpbHRlcihzaWJsaW5ncyhzY29wZSksIHByZWRpY2F0ZSk7XG4gICAgfTtcblxuICAgIHZhciBhbGwkMSA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGFsbChzZWxlY3Rvcik7XG4gICAgfTtcbiAgICB2YXIgYW5jZXN0b3JzJDEgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdG9yLCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBhbmNlc3RvcnMoc2NvcGUsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBpcyhlLCBzZWxlY3Rvcik7XG4gICAgICB9LCBpc1Jvb3QpO1xuICAgIH07XG4gICAgdmFyIHNpYmxpbmdzJDIgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdG9yKSB7XG4gICAgICByZXR1cm4gc2libGluZ3MkMShzY29wZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGlzKGUsIHNlbGVjdG9yKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgYXR0ciA9ICdkYXRhLWVwaG94LW1vYmlsZS1mdWxsc2NyZWVuLXN0eWxlJztcbiAgICB2YXIgc2libGluZ1N0eWxlcyA9ICdkaXNwbGF5Om5vbmUhaW1wb3J0YW50Oyc7XG4gICAgdmFyIGFuY2VzdG9yUG9zaXRpb24gPSAncG9zaXRpb246YWJzb2x1dGUhaW1wb3J0YW50Oyc7XG4gICAgdmFyIGFuY2VzdG9yU3R5bGVzID0gJ3RvcDowIWltcG9ydGFudDtsZWZ0OjAhaW1wb3J0YW50O21hcmdpbjowIWltcG9ydGFudDtwYWRkaW5nOjAhaW1wb3J0YW50O3dpZHRoOjEwMCUhaW1wb3J0YW50O2hlaWdodDoxMDAlIWltcG9ydGFudDtvdmVyZmxvdzp2aXNpYmxlIWltcG9ydGFudDsnO1xuICAgIHZhciBiZ0ZhbGxiYWNrID0gJ2JhY2tncm91bmQtY29sb3I6cmdiKDI1NSwyNTUsMjU1KSFpbXBvcnRhbnQ7JztcbiAgICB2YXIgaXNBbmRyb2lkID0gZ2xvYmFsJDIub3MuaXNBbmRyb2lkKCk7XG4gICAgdmFyIG1hdGNoQ29sb3IgPSBmdW5jdGlvbiAoZWRpdG9yQm9keSkge1xuICAgICAgdmFyIGNvbG9yID0gZ2V0JDMoZWRpdG9yQm9keSwgJ2JhY2tncm91bmQtY29sb3InKTtcbiAgICAgIHJldHVybiBjb2xvciAhPT0gdW5kZWZpbmVkICYmIGNvbG9yICE9PSAnJyA/ICdiYWNrZ3JvdW5kLWNvbG9yOicgKyBjb2xvciArICchaW1wb3J0YW50JyA6IGJnRmFsbGJhY2s7XG4gICAgfTtcbiAgICB2YXIgY2xvYmJlclN0eWxlcyA9IGZ1bmN0aW9uIChkb20sIGNvbnRhaW5lciwgZWRpdG9yQm9keSkge1xuICAgICAgdmFyIGdhdGhlclNpYmxpbmdzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHNpYmxpbmdzJDIoZWxlbWVudCwgJyo6bm90KC50b3gtc2lsdmVyLXNpbmspJyk7XG4gICAgICB9O1xuICAgICAgdmFyIGNsb2JiZXIgPSBmdW5jdGlvbiAoY2xvYmJlclN0eWxlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgIHZhciBzdHlsZXMgPSBnZXQkMihlbGVtZW50LCAnc3R5bGUnKTtcbiAgICAgICAgICB2YXIgYmFja3VwID0gc3R5bGVzID09PSB1bmRlZmluZWQgPyAnbm8tc3R5bGVzJyA6IHN0eWxlcy50cmltKCk7XG4gICAgICAgICAgaWYgKGJhY2t1cCA9PT0gY2xvYmJlclN0eWxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNldChlbGVtZW50LCBhdHRyLCBiYWNrdXApO1xuICAgICAgICAgICAgc2V0QWxsKGVsZW1lbnQsIGRvbS5wYXJzZVN0eWxlKGNsb2JiZXJTdHlsZSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgYW5jZXN0b3JzID0gYW5jZXN0b3JzJDEoY29udGFpbmVyLCAnKicpO1xuICAgICAgdmFyIHNpYmxpbmdzID0gYmluZChhbmNlc3RvcnMsIGdhdGhlclNpYmxpbmdzKTtcbiAgICAgIHZhciBiZ0NvbG9yID0gbWF0Y2hDb2xvcihlZGl0b3JCb2R5KTtcbiAgICAgIGVhY2goc2libGluZ3MsIGNsb2JiZXIoc2libGluZ1N0eWxlcykpO1xuICAgICAgZWFjaChhbmNlc3RvcnMsIGNsb2JiZXIoYW5jZXN0b3JQb3NpdGlvbiArIGFuY2VzdG9yU3R5bGVzICsgYmdDb2xvcikpO1xuICAgICAgdmFyIGNvbnRhaW5lclN0eWxlcyA9IGlzQW5kcm9pZCA9PT0gdHJ1ZSA/ICcnIDogYW5jZXN0b3JQb3NpdGlvbjtcbiAgICAgIGNsb2JiZXIoY29udGFpbmVyU3R5bGVzICsgYW5jZXN0b3JTdHlsZXMgKyBiZ0NvbG9yKShjb250YWluZXIpO1xuICAgIH07XG4gICAgdmFyIHJlc3RvcmVTdHlsZXMgPSBmdW5jdGlvbiAoZG9tKSB7XG4gICAgICB2YXIgY2xvYmJlcmVkRWxzID0gYWxsJDEoJ1snICsgYXR0ciArICddJyk7XG4gICAgICBlYWNoKGNsb2JiZXJlZEVscywgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHJlc3RvcmUgPSBnZXQkMihlbGVtZW50LCBhdHRyKTtcbiAgICAgICAgaWYgKHJlc3RvcmUgIT09ICduby1zdHlsZXMnKSB7XG4gICAgICAgICAgc2V0QWxsKGVsZW1lbnQsIGRvbS5wYXJzZVN0eWxlKHJlc3RvcmUpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZW1vdmUoZWxlbWVudCwgJ3N0eWxlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmVtb3ZlKGVsZW1lbnQsIGF0dHIpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBET00gPSBnbG9iYWwkMS5ET007XG4gICAgdmFyIGdldFNjcm9sbFBvcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB2cCA9IGdldEJvdW5kcyh3aW5kb3cpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogdnAueCxcbiAgICAgICAgeTogdnAueVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzZXRTY3JvbGxQb3MgPSBmdW5jdGlvbiAocG9zKSB7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8ocG9zLngsIHBvcy55KTtcbiAgICB9O1xuICAgIHZhciB2aWV3cG9ydFVwZGF0ZSA9IGdldCQ1KCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBiaW5kOiBub29wLFxuICAgICAgICB1bmJpbmQ6IG5vb3BcbiAgICAgIH07XG4gICAgfSwgZnVuY3Rpb24gKHZpc3VhbFZpZXdwb3J0KSB7XG4gICAgICB2YXIgZWRpdG9yQ29udGFpbmVyID0gdmFsdWUoKTtcbiAgICAgIHZhciByZXNpemVCaW5kZXIgPSB1bmJpbmRhYmxlKCk7XG4gICAgICB2YXIgc2Nyb2xsQmluZGVyID0gdW5iaW5kYWJsZSgpO1xuICAgICAgdmFyIHJlZnJlc2hTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7XG4gICAgICB9O1xuICAgICAgdmFyIHJlZnJlc2hWaXN1YWxWaWV3cG9ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZWRpdG9yQ29udGFpbmVyLm9uKGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXRBbGwoY29udGFpbmVyLCB7XG4gICAgICAgICAgICAgIHRvcDogdmlzdWFsVmlld3BvcnQub2Zmc2V0VG9wICsgJ3B4JyxcbiAgICAgICAgICAgICAgbGVmdDogdmlzdWFsVmlld3BvcnQub2Zmc2V0TGVmdCArICdweCcsXG4gICAgICAgICAgICAgIGhlaWdodDogdmlzdWFsVmlld3BvcnQuaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgICAgd2lkdGg6IHZpc3VhbFZpZXdwb3J0LndpZHRoICsgJ3B4J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciB1cGRhdGUgPSBnbG9iYWwkMy50aHJvdHRsZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlZnJlc2hTY3JvbGwoKTtcbiAgICAgICAgcmVmcmVzaFZpc3VhbFZpZXdwb3J0KCk7XG4gICAgICB9LCA1MCk7XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIGVkaXRvckNvbnRhaW5lci5zZXQoZWxlbWVudCk7XG4gICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICByZXNpemVCaW5kZXIuc2V0KGJpbmQkMygncmVzaXplJywgdXBkYXRlKSk7XG4gICAgICAgIHNjcm9sbEJpbmRlci5zZXQoYmluZCQzKCdzY3JvbGwnLCB1cGRhdGUpKTtcbiAgICAgIH07XG4gICAgICB2YXIgdW5iaW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3JDb250YWluZXIub24oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJlc2l6ZUJpbmRlci5jbGVhcigpO1xuICAgICAgICAgIHNjcm9sbEJpbmRlci5jbGVhcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yQ29udGFpbmVyLmNsZWFyKCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgdW5iaW5kOiB1bmJpbmRcbiAgICAgIH07XG4gICAgfSk7XG4gICAgdmFyIHRvZ2dsZUZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoZWRpdG9yLCBmdWxsc2NyZWVuU3RhdGUpIHtcbiAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keTtcbiAgICAgIHZhciBkb2N1bWVudEVsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICB2YXIgZWRpdG9yQ29udGFpbmVyID0gZWRpdG9yLmdldENvbnRhaW5lcigpO1xuICAgICAgdmFyIGVkaXRvckNvbnRhaW5lclMgPSBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3JDb250YWluZXIpO1xuICAgICAgdmFyIGZ1bGxzY3JlZW5Sb290ID0gZ2V0RnVsbHNjcmVlblJvb3QoZWRpdG9yKTtcbiAgICAgIHZhciBmdWxsc2NyZWVuSW5mbyA9IGZ1bGxzY3JlZW5TdGF0ZS5nZXQoKTtcbiAgICAgIHZhciBlZGl0b3JCb2R5ID0gU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldEJvZHkoKSk7XG4gICAgICB2YXIgaXNUb3VjaCA9IGdsb2JhbCQyLmRldmljZVR5cGUuaXNUb3VjaCgpO1xuICAgICAgdmFyIGVkaXRvckNvbnRhaW5lclN0eWxlID0gZWRpdG9yQ29udGFpbmVyLnN0eWxlO1xuICAgICAgdmFyIGlmcmFtZSA9IGVkaXRvci5pZnJhbWVFbGVtZW50O1xuICAgICAgdmFyIGlmcmFtZVN0eWxlID0gaWZyYW1lLnN0eWxlO1xuICAgICAgdmFyIGhhbmRsZUNsYXNzZXMgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICBoYW5kbGVyKGJvZHksICd0b3gtZnVsbHNjcmVlbicpO1xuICAgICAgICBoYW5kbGVyKGRvY3VtZW50RWxlbWVudCwgJ3RveC1mdWxsc2NyZWVuJyk7XG4gICAgICAgIGhhbmRsZXIoZWRpdG9yQ29udGFpbmVyLCAndG94LWZ1bGxzY3JlZW4nKTtcbiAgICAgICAgZ2V0U2hhZG93Um9vdChlZGl0b3JDb250YWluZXJTKS5tYXAoZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0U2hhZG93SG9zdChyb290KS5kb207XG4gICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKGhvc3QpIHtcbiAgICAgICAgICBoYW5kbGVyKGhvc3QsICd0b3gtZnVsbHNjcmVlbicpO1xuICAgICAgICAgIGhhbmRsZXIoaG9zdCwgJ3RveC1zaGFkb3dob3N0Jyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjbGVhbnVwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaXNUb3VjaCkge1xuICAgICAgICAgIHJlc3RvcmVTdHlsZXMoZWRpdG9yLmRvbSk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlQ2xhc3NlcyhET00ucmVtb3ZlQ2xhc3MpO1xuICAgICAgICB2aWV3cG9ydFVwZGF0ZS51bmJpbmQoKTtcbiAgICAgICAgT3B0aW9uYWwuZnJvbShmdWxsc2NyZWVuU3RhdGUuZ2V0KCkpLmVhY2goZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgICByZXR1cm4gaW5mby5mdWxsc2NyZWVuQ2hhbmdlSGFuZGxlci51bmJpbmQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgaWYgKCFmdWxsc2NyZWVuSW5mbykge1xuICAgICAgICB2YXIgZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXIgPSBiaW5kJDIob3duZXIoZnVsbHNjcmVlblJvb3QpLCBnZXRGdWxsc2NyZWVuY2hhbmdlRXZlbnROYW1lKCksIGZ1bmN0aW9uIChfZXZ0KSB7XG4gICAgICAgICAgaWYgKGdldEZ1bGxzY3JlZW5OYXRpdmUoZWRpdG9yKSkge1xuICAgICAgICAgICAgaWYgKCFpc0Z1bGxzY3JlZW5FbGVtZW50KGZ1bGxzY3JlZW5Sb290KSAmJiBmdWxsc2NyZWVuU3RhdGUuZ2V0KCkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdG9nZ2xlRnVsbHNjcmVlbihlZGl0b3IsIGZ1bGxzY3JlZW5TdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG5ld0Z1bGxTY3JlZW5JbmZvID0ge1xuICAgICAgICAgIHNjcm9sbFBvczogZ2V0U2Nyb2xsUG9zKCksXG4gICAgICAgICAgY29udGFpbmVyV2lkdGg6IGVkaXRvckNvbnRhaW5lclN0eWxlLndpZHRoLFxuICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogZWRpdG9yQ29udGFpbmVyU3R5bGUuaGVpZ2h0LFxuICAgICAgICAgIGNvbnRhaW5lclRvcDogZWRpdG9yQ29udGFpbmVyU3R5bGUudG9wLFxuICAgICAgICAgIGNvbnRhaW5lckxlZnQ6IGVkaXRvckNvbnRhaW5lclN0eWxlLmxlZnQsXG4gICAgICAgICAgaWZyYW1lV2lkdGg6IGlmcmFtZVN0eWxlLndpZHRoLFxuICAgICAgICAgIGlmcmFtZUhlaWdodDogaWZyYW1lU3R5bGUuaGVpZ2h0LFxuICAgICAgICAgIGZ1bGxzY3JlZW5DaGFuZ2VIYW5kbGVyOiBmdWxsc2NyZWVuQ2hhbmdlSGFuZGxlclxuICAgICAgICB9O1xuICAgICAgICBpZiAoaXNUb3VjaCkge1xuICAgICAgICAgIGNsb2JiZXJTdHlsZXMoZWRpdG9yLmRvbSwgZWRpdG9yQ29udGFpbmVyUywgZWRpdG9yQm9keSk7XG4gICAgICAgIH1cbiAgICAgICAgaWZyYW1lU3R5bGUud2lkdGggPSBpZnJhbWVTdHlsZS5oZWlnaHQgPSAnMTAwJSc7XG4gICAgICAgIGVkaXRvckNvbnRhaW5lclN0eWxlLndpZHRoID0gZWRpdG9yQ29udGFpbmVyU3R5bGUuaGVpZ2h0ID0gJyc7XG4gICAgICAgIGhhbmRsZUNsYXNzZXMoRE9NLmFkZENsYXNzKTtcbiAgICAgICAgdmlld3BvcnRVcGRhdGUuYmluZChlZGl0b3JDb250YWluZXJTKTtcbiAgICAgICAgZWRpdG9yLm9uKCdyZW1vdmUnLCBjbGVhbnVwKTtcbiAgICAgICAgZnVsbHNjcmVlblN0YXRlLnNldChuZXdGdWxsU2NyZWVuSW5mbyk7XG4gICAgICAgIGlmIChnZXRGdWxsc2NyZWVuTmF0aXZlKGVkaXRvcikpIHtcbiAgICAgICAgICByZXF1ZXN0RnVsbHNjcmVlbihmdWxsc2NyZWVuUm9vdCk7XG4gICAgICAgIH1cbiAgICAgICAgZmlyZUZ1bGxzY3JlZW5TdGF0ZUNoYW5nZWQoZWRpdG9yLCB0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZ1bGxzY3JlZW5JbmZvLmZ1bGxzY3JlZW5DaGFuZ2VIYW5kbGVyLnVuYmluZCgpO1xuICAgICAgICBpZiAoZ2V0RnVsbHNjcmVlbk5hdGl2ZShlZGl0b3IpICYmIGlzRnVsbHNjcmVlbkVsZW1lbnQoZnVsbHNjcmVlblJvb3QpKSB7XG4gICAgICAgICAgZXhpdEZ1bGxzY3JlZW4ob3duZXIoZnVsbHNjcmVlblJvb3QpKTtcbiAgICAgICAgfVxuICAgICAgICBpZnJhbWVTdHlsZS53aWR0aCA9IGZ1bGxzY3JlZW5JbmZvLmlmcmFtZVdpZHRoO1xuICAgICAgICBpZnJhbWVTdHlsZS5oZWlnaHQgPSBmdWxsc2NyZWVuSW5mby5pZnJhbWVIZWlnaHQ7XG4gICAgICAgIGVkaXRvckNvbnRhaW5lclN0eWxlLndpZHRoID0gZnVsbHNjcmVlbkluZm8uY29udGFpbmVyV2lkdGg7XG4gICAgICAgIGVkaXRvckNvbnRhaW5lclN0eWxlLmhlaWdodCA9IGZ1bGxzY3JlZW5JbmZvLmNvbnRhaW5lckhlaWdodDtcbiAgICAgICAgZWRpdG9yQ29udGFpbmVyU3R5bGUudG9wID0gZnVsbHNjcmVlbkluZm8uY29udGFpbmVyVG9wO1xuICAgICAgICBlZGl0b3JDb250YWluZXJTdHlsZS5sZWZ0ID0gZnVsbHNjcmVlbkluZm8uY29udGFpbmVyTGVmdDtcbiAgICAgICAgc2V0U2Nyb2xsUG9zKGZ1bGxzY3JlZW5JbmZvLnNjcm9sbFBvcyk7XG4gICAgICAgIGZ1bGxzY3JlZW5TdGF0ZS5zZXQobnVsbCk7XG4gICAgICAgIGZpcmVGdWxsc2NyZWVuU3RhdGVDaGFuZ2VkKGVkaXRvciwgZmFsc2UpO1xuICAgICAgICBjbGVhbnVwKCk7XG4gICAgICAgIGVkaXRvci5vZmYoJ3JlbW92ZScsIGNsZWFudXApO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoZWRpdG9yLCBmdWxsc2NyZWVuU3RhdGUpIHtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VGdWxsU2NyZWVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB0b2dnbGVGdWxsc2NyZWVuKGVkaXRvciwgZnVsbHNjcmVlblN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgbWFrZVNldHVwSGFuZGxlciA9IGZ1bmN0aW9uIChlZGl0b3IsIGZ1bGxzY3JlZW5TdGF0ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgYXBpLnNldEFjdGl2ZShmdWxsc2NyZWVuU3RhdGUuZ2V0KCkgIT09IG51bGwpO1xuICAgICAgICB2YXIgZWRpdG9yRXZlbnRDYWxsYmFjayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGFwaS5zZXRBY3RpdmUoZS5zdGF0ZSk7XG4gICAgICAgIH07XG4gICAgICAgIGVkaXRvci5vbignRnVsbHNjcmVlblN0YXRlQ2hhbmdlZCcsIGVkaXRvckV2ZW50Q2FsbGJhY2spO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3Iub2ZmKCdGdWxsc2NyZWVuU3RhdGVDaGFuZ2VkJywgZWRpdG9yRXZlbnRDYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyJDEgPSBmdW5jdGlvbiAoZWRpdG9yLCBmdWxsc2NyZWVuU3RhdGUpIHtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVNZW51SXRlbSgnZnVsbHNjcmVlbicsIHtcbiAgICAgICAgdGV4dDogJ0Z1bGxzY3JlZW4nLFxuICAgICAgICBpY29uOiAnZnVsbHNjcmVlbicsXG4gICAgICAgIHNob3J0Y3V0OiAnTWV0YStTaGlmdCtGJyxcbiAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VGdWxsU2NyZWVuJyk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uU2V0dXA6IG1ha2VTZXR1cEhhbmRsZXIoZWRpdG9yLCBmdWxsc2NyZWVuU3RhdGUpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24oJ2Z1bGxzY3JlZW4nLCB7XG4gICAgICAgIHRvb2x0aXA6ICdGdWxsc2NyZWVuJyxcbiAgICAgICAgaWNvbjogJ2Z1bGxzY3JlZW4nLFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZUZ1bGxTY3JlZW4nKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TZXR1cDogbWFrZVNldHVwSGFuZGxlcihlZGl0b3IsIGZ1bGxzY3JlZW5TdGF0ZSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBQbHVnaW4gKCkge1xuICAgICAgZ2xvYmFsLmFkZCgnZnVsbHNjcmVlbicsIGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgdmFyIGZ1bGxzY3JlZW5TdGF0ZSA9IENlbGwobnVsbCk7XG4gICAgICAgIGlmIChlZGl0b3IuaW5saW5lKSB7XG4gICAgICAgICAgcmV0dXJuIGdldChmdWxsc2NyZWVuU3RhdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJlZ2lzdGVyKGVkaXRvciwgZnVsbHNjcmVlblN0YXRlKTtcbiAgICAgICAgcmVnaXN0ZXIkMShlZGl0b3IsIGZ1bGxzY3JlZW5TdGF0ZSk7XG4gICAgICAgIGVkaXRvci5hZGRTaG9ydGN1dCgnTWV0YStTaGlmdCtGJywgJycsICdtY2VGdWxsU2NyZWVuJyk7XG4gICAgICAgIHJldHVybiBnZXQoZnVsbHNjcmVlblN0YXRlKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIFBsdWdpbigpO1xuXG59KCkpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QTs7Ozs7Ozs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QTs7QSIsInNvdXJjZVJvb3QiOiIifQ==