(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_paste_index_js"],{

/***/ "./node_modules/tinymce/plugins/paste/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/paste/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "paste" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/paste')
//   ES2015:
//     import 'tinymce/plugins/paste'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/paste/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/paste/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/paste/plugin.js ***!
  \******************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var hasProPlugin = function (editor) {
      if (editor.hasPlugin('powerpaste', true)) {
        if (typeof window.console !== 'undefined' && window.console.log) {
          window.console.log('PowerPaste is incompatible with Paste plugin! Remove \'paste\' from the \'plugins\' option.');
        }
        return true;
      } else {
        return false;
      }
    };

    var get = function (clipboard, quirks) {
      return {
        clipboard: clipboard,
        quirks: quirks
      };
    };

    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var isNullable = function (a) {
      return a === null || a === undefined;
    };
    var isNonNullable = function (a) {
      return !isNullable(a);
    };
    var isFunction = isSimpleType('function');

    var noop = function () {
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var never = constant(false);
    var always = constant(true);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var nativeSlice = Array.prototype.slice;
    var exists = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return true;
        }
      }
      return false;
    };
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var filter = function (xs, pred) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          r.push(x);
        }
      }
      return r;
    };
    var foldl = function (xs, f, acc) {
      each(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var from$1 = isFunction(Array.from) ? Array.from : function (x) {
      return nativeSlice.call(x);
    };

    var value = function () {
      var subject = Cell(Optional.none());
      var clear = function () {
        return subject.set(Optional.none());
      };
      var set = function (s) {
        return subject.set(Optional.some(s));
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var on = function (f) {
        return subject.get().each(f);
      };
      return {
        clear: clear,
        set: set,
        isSet: isSet,
        on: on
      };
    };

    var checkRange = function (str, substr, start) {
      return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;
    };
    var startsWith = function (str, prefix) {
      return checkRange(str, prefix, 0);
    };
    var endsWith = function (str, suffix) {
      return checkRange(str, suffix, str.length - suffix.length);
    };
    var repeat = function (s, count) {
      return count <= 0 ? '' : new Array(count + 1).join(s);
    };

    var global$1 = tinymce.util.Tools.resolve('tinymce.Env');

    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Delay');

    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Promise');

    var global$4 = tinymce.util.Tools.resolve('tinymce.util.VK');

    var firePastePreProcess = function (editor, html, internal, isWordHtml) {
      return editor.fire('PastePreProcess', {
        content: html,
        internal: internal,
        wordContent: isWordHtml
      });
    };
    var firePastePostProcess = function (editor, node, internal, isWordHtml) {
      return editor.fire('PastePostProcess', {
        node: node,
        internal: internal,
        wordContent: isWordHtml
      });
    };
    var firePastePlainTextToggle = function (editor, state) {
      return editor.fire('PastePlainTextToggle', { state: state });
    };
    var firePaste = function (editor, ieFake) {
      return editor.fire('paste', { ieFake: ieFake });
    };

    var global$5 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var shouldBlockDrop = function (editor) {
      return editor.getParam('paste_block_drop', false);
    };
    var shouldPasteDataImages = function (editor) {
      return editor.getParam('paste_data_images', false);
    };
    var shouldFilterDrop = function (editor) {
      return editor.getParam('paste_filter_drop', true);
    };
    var getPreProcess = function (editor) {
      return editor.getParam('paste_preprocess');
    };
    var getPostProcess = function (editor) {
      return editor.getParam('paste_postprocess');
    };
    var getWebkitStyles = function (editor) {
      return editor.getParam('paste_webkit_styles');
    };
    var shouldRemoveWebKitStyles = function (editor) {
      return editor.getParam('paste_remove_styles_if_webkit', true);
    };
    var shouldMergeFormats = function (editor) {
      return editor.getParam('paste_merge_formats', true);
    };
    var isSmartPasteEnabled = function (editor) {
      return editor.getParam('smart_paste', true);
    };
    var isPasteAsTextEnabled = function (editor) {
      return editor.getParam('paste_as_text', false);
    };
    var getRetainStyleProps = function (editor) {
      return editor.getParam('paste_retain_style_properties');
    };
    var getWordValidElements = function (editor) {
      var defaultValidElements = '-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,' + '-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,' + 'td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody';
      return editor.getParam('paste_word_valid_elements', defaultValidElements);
    };
    var shouldConvertWordFakeLists = function (editor) {
      return editor.getParam('paste_convert_word_fake_lists', true);
    };
    var shouldUseDefaultFilters = function (editor) {
      return editor.getParam('paste_enable_default_filters', true);
    };
    var getValidate = function (editor) {
      return editor.getParam('validate');
    };
    var getAllowHtmlDataUrls = function (editor) {
      return editor.getParam('allow_html_data_urls', false, 'boolean');
    };
    var getPasteDataImages = function (editor) {
      return editor.getParam('paste_data_images', false, 'boolean');
    };
    var getImagesDataImgFilter = function (editor) {
      return editor.getParam('images_dataimg_filter');
    };
    var getImagesReuseFilename = function (editor) {
      return editor.getParam('images_reuse_filename');
    };
    var getForcedRootBlock = function (editor) {
      return editor.getParam('forced_root_block');
    };
    var getForcedRootBlockAttrs = function (editor) {
      return editor.getParam('forced_root_block_attrs');
    };
    var getTabSpaces = function (editor) {
      return editor.getParam('paste_tab_spaces', 4, 'number');
    };
    var getAllowedImageFileTypes = function (editor) {
      var defaultImageFileTypes = 'jpeg,jpg,jpe,jfi,jif,jfif,png,gif,bmp,webp';
      return global$5.explode(editor.getParam('images_file_types', defaultImageFileTypes, 'string'));
    };

    var internalMimeType = 'x-tinymce/html';
    var internalMark = '<!-- ' + internalMimeType + ' -->';
    var mark = function (html) {
      return internalMark + html;
    };
    var unmark = function (html) {
      return html.replace(internalMark, '');
    };
    var isMarked = function (html) {
      return html.indexOf(internalMark) !== -1;
    };
    var internalHtmlMime = function () {
      return internalMimeType;
    };

    var global$6 = tinymce.util.Tools.resolve('tinymce.html.Entities');

    var isPlainText = function (text) {
      return !/<(?:\/?(?!(?:div|p|br|span)>)\w+|(?:(?!(?:span style="white-space:\s?pre;?">)|br\s?\/>))\w+\s[^>]+)>/i.test(text);
    };
    var toBRs = function (text) {
      return text.replace(/\r?\n/g, '<br>');
    };
    var openContainer = function (rootTag, rootAttrs) {
      var key;
      var attrs = [];
      var tag = '<' + rootTag;
      if (typeof rootAttrs === 'object') {
        for (key in rootAttrs) {
          if (rootAttrs.hasOwnProperty(key)) {
            attrs.push(key + '="' + global$6.encodeAllRaw(rootAttrs[key]) + '"');
          }
        }
        if (attrs.length) {
          tag += ' ' + attrs.join(' ');
        }
      }
      return tag + '>';
    };
    var toBlockElements = function (text, rootTag, rootAttrs) {
      var blocks = text.split(/\n\n/);
      var tagOpen = openContainer(rootTag, rootAttrs);
      var tagClose = '</' + rootTag + '>';
      var paragraphs = global$5.map(blocks, function (p) {
        return p.split(/\n/).join('<br />');
      });
      var stitch = function (p) {
        return tagOpen + p + tagClose;
      };
      return paragraphs.length === 1 ? paragraphs[0] : global$5.map(paragraphs, stitch).join('');
    };
    var convert = function (text, rootTag, rootAttrs) {
      return rootTag ? toBlockElements(text, rootTag === true ? 'p' : rootTag, rootAttrs) : toBRs(text);
    };

    var global$7 = tinymce.util.Tools.resolve('tinymce.html.DomParser');

    var global$8 = tinymce.util.Tools.resolve('tinymce.html.Serializer');

    var nbsp = '\xA0';

    var global$9 = tinymce.util.Tools.resolve('tinymce.html.Node');

    var global$a = tinymce.util.Tools.resolve('tinymce.html.Schema');

    var filter$1 = function (content, items) {
      global$5.each(items, function (v) {
        if (v.constructor === RegExp) {
          content = content.replace(v, '');
        } else {
          content = content.replace(v[0], v[1]);
        }
      });
      return content;
    };
    var innerText = function (html) {
      var schema = global$a();
      var domParser = global$7({}, schema);
      var text = '';
      var shortEndedElements = schema.getShortEndedElements();
      var ignoreElements = global$5.makeMap('script noscript style textarea video audio iframe object', ' ');
      var blockElements = schema.getBlockElements();
      var walk = function (node) {
        var name = node.name, currentNode = node;
        if (name === 'br') {
          text += '\n';
          return;
        }
        if (name === 'wbr') {
          return;
        }
        if (shortEndedElements[name]) {
          text += ' ';
        }
        if (ignoreElements[name]) {
          text += ' ';
          return;
        }
        if (node.type === 3) {
          text += node.value;
        }
        if (!node.shortEnded) {
          if (node = node.firstChild) {
            do {
              walk(node);
            } while (node = node.next);
          }
        }
        if (blockElements[name] && currentNode.next) {
          text += '\n';
          if (name === 'p') {
            text += '\n';
          }
        }
      };
      html = filter$1(html, [/<!\[[^\]]+\]>/g]);
      walk(domParser.parse(html));
      return text;
    };
    var trimHtml = function (html) {
      var trimSpaces = function (all, s1, s2) {
        if (!s1 && !s2) {
          return ' ';
        }
        return nbsp;
      };
      html = filter$1(html, [
        /^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/ig,
        /<!--StartFragment-->|<!--EndFragment-->/g,
        [
          /( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,
          trimSpaces
        ],
        /<br class="Apple-interchange-newline">/g,
        /<br>$/i
      ]);
      return html;
    };
    var createIdGenerator = function (prefix) {
      var count = 0;
      return function () {
        return prefix + count++;
      };
    };
    var getImageMimeType = function (ext) {
      var lowerExt = ext.toLowerCase();
      var mimeOverrides = {
        jpg: 'jpeg',
        jpe: 'jpeg',
        jfi: 'jpeg',
        jif: 'jpeg',
        jfif: 'jpeg',
        pjpeg: 'jpeg',
        pjp: 'jpeg',
        svg: 'svg+xml'
      };
      return global$5.hasOwn(mimeOverrides, lowerExt) ? 'image/' + mimeOverrides[lowerExt] : 'image/' + lowerExt;
    };

    var isWordContent = function (content) {
      return /<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument/i.test(content) || /class="OutlineElement/.test(content) || /id="?docs\-internal\-guid\-/.test(content);
    };
    var isNumericList = function (text) {
      var found;
      var patterns = [
        /^[IVXLMCD]+\.[ \u00a0]/,
        /^[ivxlmcd]+\.[ \u00a0]/,
        /^[a-z]{1,2}[\.\)][ \u00a0]/,
        /^[A-Z]{1,2}[\.\)][ \u00a0]/,
        /^[0-9]+\.[ \u00a0]/,
        /^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,
        /^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/
      ];
      text = text.replace(/^[\u00a0 ]+/, '');
      global$5.each(patterns, function (pattern) {
        if (pattern.test(text)) {
          found = true;
          return false;
        }
      });
      return found;
    };
    var isBulletList = function (text) {
      return /^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(text);
    };
    var convertFakeListsToProperLists = function (node) {
      var currentListNode, prevListNode, lastLevel = 1;
      var getText = function (node) {
        var txt = '';
        if (node.type === 3) {
          return node.value;
        }
        if (node = node.firstChild) {
          do {
            txt += getText(node);
          } while (node = node.next);
        }
        return txt;
      };
      var trimListStart = function (node, regExp) {
        if (node.type === 3) {
          if (regExp.test(node.value)) {
            node.value = node.value.replace(regExp, '');
            return false;
          }
        }
        if (node = node.firstChild) {
          do {
            if (!trimListStart(node, regExp)) {
              return false;
            }
          } while (node = node.next);
        }
        return true;
      };
      var removeIgnoredNodes = function (node) {
        if (node._listIgnore) {
          node.remove();
          return;
        }
        if (node = node.firstChild) {
          do {
            removeIgnoredNodes(node);
          } while (node = node.next);
        }
      };
      var convertParagraphToLi = function (paragraphNode, listName, start) {
        var level = paragraphNode._listLevel || lastLevel;
        if (level !== lastLevel) {
          if (level < lastLevel) {
            if (currentListNode) {
              currentListNode = currentListNode.parent.parent;
            }
          } else {
            prevListNode = currentListNode;
            currentListNode = null;
          }
        }
        if (!currentListNode || currentListNode.name !== listName) {
          prevListNode = prevListNode || currentListNode;
          currentListNode = new global$9(listName, 1);
          if (start > 1) {
            currentListNode.attr('start', '' + start);
          }
          paragraphNode.wrap(currentListNode);
        } else {
          currentListNode.append(paragraphNode);
        }
        paragraphNode.name = 'li';
        if (level > lastLevel && prevListNode) {
          prevListNode.lastChild.append(currentListNode);
        }
        lastLevel = level;
        removeIgnoredNodes(paragraphNode);
        trimListStart(paragraphNode, /^\u00a0+/);
        trimListStart(paragraphNode, /^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);
        trimListStart(paragraphNode, /^\u00a0+/);
      };
      var elements = [];
      var child = node.firstChild;
      while (typeof child !== 'undefined' && child !== null) {
        elements.push(child);
        child = child.walk();
        if (child !== null) {
          while (typeof child !== 'undefined' && child.parent !== node) {
            child = child.walk();
          }
        }
      }
      for (var i = 0; i < elements.length; i++) {
        node = elements[i];
        if (node.name === 'p' && node.firstChild) {
          var nodeText = getText(node);
          if (isBulletList(nodeText)) {
            convertParagraphToLi(node, 'ul');
            continue;
          }
          if (isNumericList(nodeText)) {
            var matches = /([0-9]+)\./.exec(nodeText);
            var start = 1;
            if (matches) {
              start = parseInt(matches[1], 10);
            }
            convertParagraphToLi(node, 'ol', start);
            continue;
          }
          if (node._listLevel) {
            convertParagraphToLi(node, 'ul', 1);
            continue;
          }
          currentListNode = null;
        } else {
          prevListNode = currentListNode;
          currentListNode = null;
        }
      }
    };
    var filterStyles = function (editor, validStyles, node, styleValue) {
      var outputStyles = {}, matches;
      var styles = editor.dom.parseStyle(styleValue);
      global$5.each(styles, function (value, name) {
        switch (name) {
        case 'mso-list':
          matches = /\w+ \w+([0-9]+)/i.exec(styleValue);
          if (matches) {
            node._listLevel = parseInt(matches[1], 10);
          }
          if (/Ignore/i.test(value) && node.firstChild) {
            node._listIgnore = true;
            node.firstChild._listIgnore = true;
          }
          break;
        case 'horiz-align':
          name = 'text-align';
          break;
        case 'vert-align':
          name = 'vertical-align';
          break;
        case 'font-color':
        case 'mso-foreground':
          name = 'color';
          break;
        case 'mso-background':
        case 'mso-highlight':
          name = 'background';
          break;
        case 'font-weight':
        case 'font-style':
          if (value !== 'normal') {
            outputStyles[name] = value;
          }
          return;
        case 'mso-element':
          if (/^(comment|comment-list)$/i.test(value)) {
            node.remove();
            return;
          }
          break;
        }
        if (name.indexOf('mso-comment') === 0) {
          node.remove();
          return;
        }
        if (name.indexOf('mso-') === 0) {
          return;
        }
        if (getRetainStyleProps(editor) === 'all' || validStyles && validStyles[name]) {
          outputStyles[name] = value;
        }
      });
      if (/(bold)/i.test(outputStyles['font-weight'])) {
        delete outputStyles['font-weight'];
        node.wrap(new global$9('b', 1));
      }
      if (/(italic)/i.test(outputStyles['font-style'])) {
        delete outputStyles['font-style'];
        node.wrap(new global$9('i', 1));
      }
      outputStyles = editor.dom.serializeStyle(outputStyles, node.name);
      if (outputStyles) {
        return outputStyles;
      }
      return null;
    };
    var filterWordContent = function (editor, content) {
      var validStyles;
      var retainStyleProperties = getRetainStyleProps(editor);
      if (retainStyleProperties) {
        validStyles = global$5.makeMap(retainStyleProperties.split(/[, ]/));
      }
      content = filter$1(content, [
        /<br class="?Apple-interchange-newline"?>/gi,
        /<b[^>]+id="?docs-internal-[^>]*>/gi,
        /<!--[\s\S]+?-->/gi,
        /<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,
        [
          /<(\/?)s>/gi,
          '<$1strike>'
        ],
        [
          /&nbsp;/gi,
          nbsp
        ],
        [
          /<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,
          function (str, spaces) {
            return spaces.length > 0 ? spaces.replace(/./, ' ').slice(Math.floor(spaces.length / 2)).split('').join(nbsp) : '';
          }
        ]
      ]);
      var validElements = getWordValidElements(editor);
      var schema = global$a({
        valid_elements: validElements,
        valid_children: '-li[p]'
      });
      global$5.each(schema.elements, function (rule) {
        if (!rule.attributes.class) {
          rule.attributes.class = {};
          rule.attributesOrder.push('class');
        }
        if (!rule.attributes.style) {
          rule.attributes.style = {};
          rule.attributesOrder.push('style');
        }
      });
      var domParser = global$7({}, schema);
      domParser.addAttributeFilter('style', function (nodes) {
        var i = nodes.length, node;
        while (i--) {
          node = nodes[i];
          node.attr('style', filterStyles(editor, validStyles, node, node.attr('style')));
          if (node.name === 'span' && node.parent && !node.attributes.length) {
            node.unwrap();
          }
        }
      });
      domParser.addAttributeFilter('class', function (nodes) {
        var i = nodes.length, node, className;
        while (i--) {
          node = nodes[i];
          className = node.attr('class');
          if (/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)) {
            node.remove();
          }
          node.attr('class', null);
        }
      });
      domParser.addNodeFilter('del', function (nodes) {
        var i = nodes.length;
        while (i--) {
          nodes[i].remove();
        }
      });
      domParser.addNodeFilter('a', function (nodes) {
        var i = nodes.length, node, href, name;
        while (i--) {
          node = nodes[i];
          href = node.attr('href');
          name = node.attr('name');
          if (href && href.indexOf('#_msocom_') !== -1) {
            node.remove();
            continue;
          }
          if (href && href.indexOf('file://') === 0) {
            href = href.split('#')[1];
            if (href) {
              href = '#' + href;
            }
          }
          if (!href && !name) {
            node.unwrap();
          } else {
            if (name && !/^_?(?:toc|edn|ftn)/i.test(name)) {
              node.unwrap();
              continue;
            }
            node.attr({
              href: href,
              name: name
            });
          }
        }
      });
      var rootNode = domParser.parse(content);
      if (shouldConvertWordFakeLists(editor)) {
        convertFakeListsToProperLists(rootNode);
      }
      content = global$8({ validate: getValidate(editor) }, schema).serialize(rootNode);
      return content;
    };
    var preProcess = function (editor, content) {
      return shouldUseDefaultFilters(editor) ? filterWordContent(editor, content) : content;
    };

    var preProcess$1 = function (editor, html) {
      var parser = global$7({}, editor.schema);
      parser.addNodeFilter('meta', function (nodes) {
        global$5.each(nodes, function (node) {
          node.remove();
        });
      });
      var fragment = parser.parse(html, {
        forced_root_block: false,
        isRootContent: true
      });
      return global$8({ validate: getValidate(editor) }, editor.schema).serialize(fragment);
    };
    var processResult = function (content, cancelled) {
      return {
        content: content,
        cancelled: cancelled
      };
    };
    var postProcessFilter = function (editor, html, internal, isWordHtml) {
      var tempBody = editor.dom.create('div', { style: 'display:none' }, html);
      var postProcessArgs = firePastePostProcess(editor, tempBody, internal, isWordHtml);
      return processResult(postProcessArgs.node.innerHTML, postProcessArgs.isDefaultPrevented());
    };
    var filterContent = function (editor, content, internal, isWordHtml) {
      var preProcessArgs = firePastePreProcess(editor, content, internal, isWordHtml);
      var filteredContent = preProcess$1(editor, preProcessArgs.content);
      if (editor.hasEventListeners('PastePostProcess') && !preProcessArgs.isDefaultPrevented()) {
        return postProcessFilter(editor, filteredContent, internal, isWordHtml);
      } else {
        return processResult(filteredContent, preProcessArgs.isDefaultPrevented());
      }
    };
    var process = function (editor, html, internal) {
      var isWordHtml = isWordContent(html);
      var content = isWordHtml ? preProcess(editor, html) : html;
      return filterContent(editor, content, internal, isWordHtml);
    };

    var pasteHtml = function (editor, html) {
      editor.insertContent(html, {
        merge: shouldMergeFormats(editor),
        paste: true
      });
      return true;
    };
    var isAbsoluteUrl = function (url) {
      return /^https?:\/\/[\w\?\-\/+=.&%@~#]+$/i.test(url);
    };
    var isImageUrl = function (editor, url) {
      return isAbsoluteUrl(url) && exists(getAllowedImageFileTypes(editor), function (type) {
        return endsWith(url.toLowerCase(), '.' + type.toLowerCase());
      });
    };
    var createImage = function (editor, url, pasteHtmlFn) {
      editor.undoManager.extra(function () {
        pasteHtmlFn(editor, url);
      }, function () {
        editor.insertContent('<img src="' + url + '">');
      });
      return true;
    };
    var createLink = function (editor, url, pasteHtmlFn) {
      editor.undoManager.extra(function () {
        pasteHtmlFn(editor, url);
      }, function () {
        editor.execCommand('mceInsertLink', false, url);
      });
      return true;
    };
    var linkSelection = function (editor, html, pasteHtmlFn) {
      return editor.selection.isCollapsed() === false && isAbsoluteUrl(html) ? createLink(editor, html, pasteHtmlFn) : false;
    };
    var insertImage = function (editor, html, pasteHtmlFn) {
      return isImageUrl(editor, html) ? createImage(editor, html, pasteHtmlFn) : false;
    };
    var smartInsertContent = function (editor, html) {
      global$5.each([
        linkSelection,
        insertImage,
        pasteHtml
      ], function (action) {
        return action(editor, html, pasteHtml) !== true;
      });
    };
    var insertContent = function (editor, html, pasteAsText) {
      if (pasteAsText || isSmartPasteEnabled(editor) === false) {
        pasteHtml(editor, html);
      } else {
        smartInsertContent(editor, html);
      }
    };

    var isCollapsibleWhitespace = function (c) {
      return ' \f\t\x0B'.indexOf(c) !== -1;
    };
    var isNewLineChar = function (c) {
      return c === '\n' || c === '\r';
    };
    var isNewline = function (text, idx) {
      return idx < text.length && idx >= 0 ? isNewLineChar(text[idx]) : false;
    };
    var normalizeWhitespace = function (editor, text) {
      var tabSpace = repeat(' ', getTabSpaces(editor));
      var normalizedText = text.replace(/\t/g, tabSpace);
      var result = foldl(normalizedText, function (acc, c) {
        if (isCollapsibleWhitespace(c) || c === nbsp) {
          if (acc.pcIsSpace || acc.str === '' || acc.str.length === normalizedText.length - 1 || isNewline(normalizedText, acc.str.length + 1)) {
            return {
              pcIsSpace: false,
              str: acc.str + nbsp
            };
          } else {
            return {
              pcIsSpace: true,
              str: acc.str + ' '
            };
          }
        } else {
          return {
            pcIsSpace: isNewLineChar(c),
            str: acc.str + c
          };
        }
      }, {
        pcIsSpace: false,
        str: ''
      });
      return result.str;
    };

    var doPaste = function (editor, content, internal, pasteAsText) {
      var args = process(editor, content, internal);
      if (args.cancelled === false) {
        insertContent(editor, args.content, pasteAsText);
      }
    };
    var pasteHtml$1 = function (editor, html, internalFlag) {
      var internal = internalFlag ? internalFlag : isMarked(html);
      doPaste(editor, unmark(html), internal, false);
    };
    var pasteText = function (editor, text) {
      var encodedText = editor.dom.encode(text).replace(/\r\n/g, '\n');
      var normalizedText = normalizeWhitespace(editor, encodedText);
      var html = convert(normalizedText, getForcedRootBlock(editor), getForcedRootBlockAttrs(editor));
      doPaste(editor, html, false, true);
    };
    var getDataTransferItems = function (dataTransfer) {
      var items = {};
      var mceInternalUrlPrefix = 'data:text/mce-internal,';
      if (dataTransfer) {
        if (dataTransfer.getData) {
          var legacyText = dataTransfer.getData('Text');
          if (legacyText && legacyText.length > 0) {
            if (legacyText.indexOf(mceInternalUrlPrefix) === -1) {
              items['text/plain'] = legacyText;
            }
          }
        }
        if (dataTransfer.types) {
          for (var i = 0; i < dataTransfer.types.length; i++) {
            var contentType = dataTransfer.types[i];
            try {
              items[contentType] = dataTransfer.getData(contentType);
            } catch (ex) {
              items[contentType] = '';
            }
          }
        }
      }
      return items;
    };
    var getClipboardContent = function (editor, clipboardEvent) {
      return getDataTransferItems(clipboardEvent.clipboardData || editor.getDoc().dataTransfer);
    };
    var hasContentType = function (clipboardContent, mimeType) {
      return mimeType in clipboardContent && clipboardContent[mimeType].length > 0;
    };
    var hasHtmlOrText = function (content) {
      return hasContentType(content, 'text/html') || hasContentType(content, 'text/plain');
    };
    var parseDataUri = function (uri) {
      var matches = /data:([^;]+);base64,([a-z0-9\+\/=]+)/i.exec(uri);
      if (matches) {
        return {
          type: matches[1],
          data: decodeURIComponent(matches[2])
        };
      } else {
        return {
          type: null,
          data: null
        };
      }
    };
    var isValidDataUriImage = function (editor, imgElm) {
      var filter = getImagesDataImgFilter(editor);
      return filter ? filter(imgElm) : true;
    };
    var extractFilename = function (editor, str) {
      var m = str.match(/([\s\S]+?)(?:\.[a-z0-9.]+)$/i);
      return isNonNullable(m) ? editor.dom.encode(m[1]) : null;
    };
    var uniqueId = createIdGenerator('mceclip');
    var pasteImage = function (editor, imageItem) {
      var _a = parseDataUri(imageItem.uri), base64 = _a.data, type = _a.type;
      var id = uniqueId();
      var file = imageItem.blob;
      var img = new Image();
      img.src = imageItem.uri;
      if (isValidDataUriImage(editor, img)) {
        var blobCache = editor.editorUpload.blobCache;
        var blobInfo = void 0;
        var existingBlobInfo = blobCache.getByData(base64, type);
        if (!existingBlobInfo) {
          var useFileName = getImagesReuseFilename(editor) && isNonNullable(file.name);
          var name_1 = useFileName ? extractFilename(editor, file.name) : id;
          var filename = useFileName ? file.name : undefined;
          blobInfo = blobCache.create(id, file, base64, name_1, filename);
          blobCache.add(blobInfo);
        } else {
          blobInfo = existingBlobInfo;
        }
        pasteHtml$1(editor, '<img src="' + blobInfo.blobUri() + '">', false);
      } else {
        pasteHtml$1(editor, '<img src="' + imageItem.uri + '">', false);
      }
    };
    var isClipboardEvent = function (event) {
      return event.type === 'paste';
    };
    var isDataTransferItem = function (item) {
      return isNonNullable(item.getAsFile);
    };
    var readFilesAsDataUris = function (items) {
      return global$3.all(map(items, function (item) {
        return new global$3(function (resolve) {
          var blob = isDataTransferItem(item) ? item.getAsFile() : item;
          var reader = new window.FileReader();
          reader.onload = function () {
            resolve({
              blob: blob,
              uri: reader.result
            });
          };
          reader.readAsDataURL(blob);
        });
      }));
    };
    var isImage = function (editor) {
      var allowedExtensions = getAllowedImageFileTypes(editor);
      return function (file) {
        return startsWith(file.type, 'image/') && exists(allowedExtensions, function (extension) {
          return getImageMimeType(extension) === file.type;
        });
      };
    };
    var getImagesFromDataTransfer = function (editor, dataTransfer) {
      var items = dataTransfer.items ? map(from$1(dataTransfer.items), function (item) {
        return item.getAsFile();
      }) : [];
      var files = dataTransfer.files ? from$1(dataTransfer.files) : [];
      return filter(items.length > 0 ? items : files, isImage(editor));
    };
    var pasteImageData = function (editor, e, rng) {
      var dataTransfer = isClipboardEvent(e) ? e.clipboardData : e.dataTransfer;
      if (getPasteDataImages(editor) && dataTransfer) {
        var images = getImagesFromDataTransfer(editor, dataTransfer);
        if (images.length > 0) {
          e.preventDefault();
          readFilesAsDataUris(images).then(function (fileResults) {
            if (rng) {
              editor.selection.setRng(rng);
            }
            each(fileResults, function (result) {
              pasteImage(editor, result);
            });
          });
          return true;
        }
      }
      return false;
    };
    var isBrokenAndroidClipboardEvent = function (e) {
      var clipboardData = e.clipboardData;
      return navigator.userAgent.indexOf('Android') !== -1 && clipboardData && clipboardData.items && clipboardData.items.length === 0;
    };
    var isKeyboardPasteEvent = function (e) {
      return global$4.metaKeyPressed(e) && e.keyCode === 86 || e.shiftKey && e.keyCode === 45;
    };
    var registerEventHandlers = function (editor, pasteBin, pasteFormat) {
      var keyboardPasteEvent = value();
      var keyboardPastePressed = value();
      var keyboardPastePlainTextState;
      editor.on('keyup', keyboardPastePressed.clear);
      editor.on('keydown', function (e) {
        var removePasteBinOnKeyUp = function (e) {
          if (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {
            pasteBin.remove();
          }
        };
        if (isKeyboardPasteEvent(e) && !e.isDefaultPrevented()) {
          keyboardPastePlainTextState = e.shiftKey && e.keyCode === 86;
          if (keyboardPastePlainTextState && global$1.webkit && navigator.userAgent.indexOf('Version/') !== -1) {
            return;
          }
          e.stopImmediatePropagation();
          keyboardPasteEvent.set(e);
          keyboardPastePressed.set(true);
          if (global$1.ie && keyboardPastePlainTextState) {
            e.preventDefault();
            firePaste(editor, true);
            return;
          }
          pasteBin.remove();
          pasteBin.create();
          editor.once('keyup', removePasteBinOnKeyUp);
          editor.once('paste', function () {
            editor.off('keyup', removePasteBinOnKeyUp);
          });
        }
      });
      var insertClipboardContent = function (editor, clipboardContent, isKeyBoardPaste, plainTextMode, internal) {
        var content;
        if (hasContentType(clipboardContent, 'text/html')) {
          content = clipboardContent['text/html'];
        } else {
          content = pasteBin.getHtml();
          internal = internal ? internal : isMarked(content);
          if (pasteBin.isDefaultContent(content)) {
            plainTextMode = true;
          }
        }
        content = trimHtml(content);
        pasteBin.remove();
        var isPlainTextHtml = internal === false && isPlainText(content);
        var isAbsoluteUrl$1 = isAbsoluteUrl(content);
        if (!content.length || isPlainTextHtml && !isAbsoluteUrl$1) {
          plainTextMode = true;
        }
        if (plainTextMode || isAbsoluteUrl$1) {
          if (hasContentType(clipboardContent, 'text/plain') && isPlainTextHtml) {
            content = clipboardContent['text/plain'];
          } else {
            content = innerText(content);
          }
        }
        if (pasteBin.isDefaultContent(content)) {
          if (!isKeyBoardPaste) {
            editor.windowManager.alert('Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.');
          }
          return;
        }
        if (plainTextMode) {
          pasteText(editor, content);
        } else {
          pasteHtml$1(editor, content, internal);
        }
      };
      var getLastRng = function () {
        return pasteBin.getLastRng() || editor.selection.getRng();
      };
      editor.on('paste', function (e) {
        var isKeyboardPaste = keyboardPasteEvent.isSet() || keyboardPastePressed.isSet();
        if (isKeyboardPaste) {
          keyboardPasteEvent.clear();
        }
        var clipboardContent = getClipboardContent(editor, e);
        var plainTextMode = pasteFormat.get() === 'text' || keyboardPastePlainTextState;
        var internal = hasContentType(clipboardContent, internalHtmlMime());
        keyboardPastePlainTextState = false;
        if (e.isDefaultPrevented() || isBrokenAndroidClipboardEvent(e)) {
          pasteBin.remove();
          return;
        }
        if (!hasHtmlOrText(clipboardContent) && pasteImageData(editor, e, getLastRng())) {
          pasteBin.remove();
          return;
        }
        if (!isKeyboardPaste) {
          e.preventDefault();
        }
        if (global$1.ie && (!isKeyboardPaste || e.ieFake) && !hasContentType(clipboardContent, 'text/html')) {
          pasteBin.create();
          editor.dom.bind(pasteBin.getEl(), 'paste', function (e) {
            e.stopPropagation();
          });
          editor.getDoc().execCommand('Paste', false, null);
          clipboardContent['text/html'] = pasteBin.getHtml();
        }
        if (hasContentType(clipboardContent, 'text/html')) {
          e.preventDefault();
          if (!internal) {
            internal = isMarked(clipboardContent['text/html']);
          }
          insertClipboardContent(editor, clipboardContent, isKeyboardPaste, plainTextMode, internal);
        } else {
          global$2.setEditorTimeout(editor, function () {
            insertClipboardContent(editor, clipboardContent, isKeyboardPaste, plainTextMode, internal);
          }, 0);
        }
      });
    };
    var registerEventsAndFilters = function (editor, pasteBin, pasteFormat) {
      registerEventHandlers(editor, pasteBin, pasteFormat);
      var src;
      editor.parser.addNodeFilter('img', function (nodes, name, args) {
        var isPasteInsert = function (args) {
          return args.data && args.data.paste === true;
        };
        var remove = function (node) {
          if (!node.attr('data-mce-object') && src !== global$1.transparentSrc) {
            node.remove();
          }
        };
        var isWebKitFakeUrl = function (src) {
          return src.indexOf('webkit-fake-url') === 0;
        };
        var isDataUri = function (src) {
          return src.indexOf('data:') === 0;
        };
        if (!getPasteDataImages(editor) && isPasteInsert(args)) {
          var i = nodes.length;
          while (i--) {
            src = nodes[i].attr('src');
            if (!src) {
              continue;
            }
            if (isWebKitFakeUrl(src)) {
              remove(nodes[i]);
            } else if (!getAllowHtmlDataUrls(editor) && isDataUri(src)) {
              remove(nodes[i]);
            }
          }
        }
      });
    };

    var getPasteBinParent = function (editor) {
      return global$1.ie && editor.inline ? document.body : editor.getBody();
    };
    var isExternalPasteBin = function (editor) {
      return getPasteBinParent(editor) !== editor.getBody();
    };
    var delegatePasteEvents = function (editor, pasteBinElm, pasteBinDefaultContent) {
      if (isExternalPasteBin(editor)) {
        editor.dom.bind(pasteBinElm, 'paste keyup', function (_e) {
          if (!isDefault(editor, pasteBinDefaultContent)) {
            editor.fire('paste');
          }
        });
      }
    };
    var create = function (editor, lastRngCell, pasteBinDefaultContent) {
      var dom = editor.dom, body = editor.getBody();
      lastRngCell.set(editor.selection.getRng());
      var pasteBinElm = editor.dom.add(getPasteBinParent(editor), 'div', {
        'id': 'mcepastebin',
        'class': 'mce-pastebin',
        'contentEditable': true,
        'data-mce-bogus': 'all',
        'style': 'position: fixed; top: 50%; width: 10px; height: 10px; overflow: hidden; opacity: 0'
      }, pasteBinDefaultContent);
      if (global$1.ie || global$1.gecko) {
        dom.setStyle(pasteBinElm, 'left', dom.getStyle(body, 'direction', true) === 'rtl' ? 65535 : -65535);
      }
      dom.bind(pasteBinElm, 'beforedeactivate focusin focusout', function (e) {
        e.stopPropagation();
      });
      delegatePasteEvents(editor, pasteBinElm, pasteBinDefaultContent);
      pasteBinElm.focus();
      editor.selection.select(pasteBinElm, true);
    };
    var remove = function (editor, lastRngCell) {
      if (getEl(editor)) {
        var pasteBinClone = void 0;
        var lastRng = lastRngCell.get();
        while (pasteBinClone = editor.dom.get('mcepastebin')) {
          editor.dom.remove(pasteBinClone);
          editor.dom.unbind(pasteBinClone);
        }
        if (lastRng) {
          editor.selection.setRng(lastRng);
        }
      }
      lastRngCell.set(null);
    };
    var getEl = function (editor) {
      return editor.dom.get('mcepastebin');
    };
    var getHtml = function (editor) {
      var copyAndRemove = function (toElm, fromElm) {
        toElm.appendChild(fromElm);
        editor.dom.remove(fromElm, true);
      };
      var pasteBinClones = global$5.grep(getPasteBinParent(editor).childNodes, function (elm) {
        return elm.id === 'mcepastebin';
      });
      var pasteBinElm = pasteBinClones.shift();
      global$5.each(pasteBinClones, function (pasteBinClone) {
        copyAndRemove(pasteBinElm, pasteBinClone);
      });
      var dirtyWrappers = editor.dom.select('div[id=mcepastebin]', pasteBinElm);
      for (var i = dirtyWrappers.length - 1; i >= 0; i--) {
        var cleanWrapper = editor.dom.create('div');
        pasteBinElm.insertBefore(cleanWrapper, dirtyWrappers[i]);
        copyAndRemove(cleanWrapper, dirtyWrappers[i]);
      }
      return pasteBinElm ? pasteBinElm.innerHTML : '';
    };
    var getLastRng = function (lastRng) {
      return lastRng.get();
    };
    var isDefaultContent = function (pasteBinDefaultContent, content) {
      return content === pasteBinDefaultContent;
    };
    var isPasteBin = function (elm) {
      return elm && elm.id === 'mcepastebin';
    };
    var isDefault = function (editor, pasteBinDefaultContent) {
      var pasteBinElm = getEl(editor);
      return isPasteBin(pasteBinElm) && isDefaultContent(pasteBinDefaultContent, pasteBinElm.innerHTML);
    };
    var PasteBin = function (editor) {
      var lastRng = Cell(null);
      var pasteBinDefaultContent = '%MCEPASTEBIN%';
      return {
        create: function () {
          return create(editor, lastRng, pasteBinDefaultContent);
        },
        remove: function () {
          return remove(editor, lastRng);
        },
        getEl: function () {
          return getEl(editor);
        },
        getHtml: function () {
          return getHtml(editor);
        },
        getLastRng: function () {
          return getLastRng(lastRng);
        },
        isDefault: function () {
          return isDefault(editor, pasteBinDefaultContent);
        },
        isDefaultContent: function (content) {
          return isDefaultContent(pasteBinDefaultContent, content);
        }
      };
    };

    var Clipboard = function (editor, pasteFormat) {
      var pasteBin = PasteBin(editor);
      editor.on('PreInit', function () {
        return registerEventsAndFilters(editor, pasteBin, pasteFormat);
      });
      return {
        pasteFormat: pasteFormat,
        pasteHtml: function (html, internalFlag) {
          return pasteHtml$1(editor, html, internalFlag);
        },
        pasteText: function (text) {
          return pasteText(editor, text);
        },
        pasteImageData: function (e, rng) {
          return pasteImageData(editor, e, rng);
        },
        getDataTransferItems: getDataTransferItems,
        hasHtmlOrText: hasHtmlOrText,
        hasContentType: hasContentType
      };
    };

    var togglePlainTextPaste = function (editor, clipboard) {
      if (clipboard.pasteFormat.get() === 'text') {
        clipboard.pasteFormat.set('html');
        firePastePlainTextToggle(editor, false);
      } else {
        clipboard.pasteFormat.set('text');
        firePastePlainTextToggle(editor, true);
      }
      editor.focus();
    };

    var register = function (editor, clipboard) {
      editor.addCommand('mceTogglePlainTextPaste', function () {
        togglePlainTextPaste(editor, clipboard);
      });
      editor.addCommand('mceInsertClipboardContent', function (ui, value) {
        if (value.content) {
          clipboard.pasteHtml(value.content, value.internal);
        }
        if (value.text) {
          clipboard.pasteText(value.text);
        }
      });
    };

    var hasWorkingClipboardApi = function (clipboardData) {
      return global$1.iOS === false && typeof (clipboardData === null || clipboardData === void 0 ? void 0 : clipboardData.setData) === 'function';
    };
    var setHtml5Clipboard = function (clipboardData, html, text) {
      if (hasWorkingClipboardApi(clipboardData)) {
        try {
          clipboardData.clearData();
          clipboardData.setData('text/html', html);
          clipboardData.setData('text/plain', text);
          clipboardData.setData(internalHtmlMime(), html);
          return true;
        } catch (e) {
          return false;
        }
      } else {
        return false;
      }
    };
    var setClipboardData = function (evt, data, fallback, done) {
      if (setHtml5Clipboard(evt.clipboardData, data.html, data.text)) {
        evt.preventDefault();
        done();
      } else {
        fallback(data.html, done);
      }
    };
    var fallback = function (editor) {
      return function (html, done) {
        var markedHtml = mark(html);
        var outer = editor.dom.create('div', {
          'contenteditable': 'false',
          'data-mce-bogus': 'all'
        });
        var inner = editor.dom.create('div', { contenteditable: 'true' }, markedHtml);
        editor.dom.setStyles(outer, {
          position: 'fixed',
          top: '0',
          left: '-3000px',
          width: '1000px',
          overflow: 'hidden'
        });
        outer.appendChild(inner);
        editor.dom.add(editor.getBody(), outer);
        var range = editor.selection.getRng();
        inner.focus();
        var offscreenRange = editor.dom.createRng();
        offscreenRange.selectNodeContents(inner);
        editor.selection.setRng(offscreenRange);
        global$2.setTimeout(function () {
          editor.selection.setRng(range);
          outer.parentNode.removeChild(outer);
          done();
        }, 0);
      };
    };
    var getData = function (editor) {
      return {
        html: editor.selection.getContent({ contextual: true }),
        text: editor.selection.getContent({ format: 'text' })
      };
    };
    var isTableSelection = function (editor) {
      return !!editor.dom.getParent(editor.selection.getStart(), 'td[data-mce-selected],th[data-mce-selected]', editor.getBody());
    };
    var hasSelectedContent = function (editor) {
      return !editor.selection.isCollapsed() || isTableSelection(editor);
    };
    var cut = function (editor) {
      return function (evt) {
        if (hasSelectedContent(editor)) {
          setClipboardData(evt, getData(editor), fallback(editor), function () {
            if (global$1.browser.isChrome() || global$1.browser.isFirefox()) {
              var rng_1 = editor.selection.getRng();
              global$2.setEditorTimeout(editor, function () {
                editor.selection.setRng(rng_1);
                editor.execCommand('Delete');
              }, 0);
            } else {
              editor.execCommand('Delete');
            }
          });
        }
      };
    };
    var copy = function (editor) {
      return function (evt) {
        if (hasSelectedContent(editor)) {
          setClipboardData(evt, getData(editor), fallback(editor), noop);
        }
      };
    };
    var register$1 = function (editor) {
      editor.on('cut', cut(editor));
      editor.on('copy', copy(editor));
    };

    var global$b = tinymce.util.Tools.resolve('tinymce.dom.RangeUtils');

    var getCaretRangeFromEvent = function (editor, e) {
      return global$b.getCaretRangeFromPoint(e.clientX, e.clientY, editor.getDoc());
    };
    var isPlainTextFileUrl = function (content) {
      var plainTextContent = content['text/plain'];
      return plainTextContent ? plainTextContent.indexOf('file://') === 0 : false;
    };
    var setFocusedRange = function (editor, rng) {
      editor.focus();
      editor.selection.setRng(rng);
    };
    var setup = function (editor, clipboard, draggingInternallyState) {
      if (shouldBlockDrop(editor)) {
        editor.on('dragend dragover draggesture dragdrop drop drag', function (e) {
          e.preventDefault();
          e.stopPropagation();
        });
      }
      if (!shouldPasteDataImages(editor)) {
        editor.on('drop', function (e) {
          var dataTransfer = e.dataTransfer;
          if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {
            e.preventDefault();
          }
        });
      }
      editor.on('drop', function (e) {
        var rng = getCaretRangeFromEvent(editor, e);
        if (e.isDefaultPrevented() || draggingInternallyState.get()) {
          return;
        }
        var dropContent = clipboard.getDataTransferItems(e.dataTransfer);
        var internal = clipboard.hasContentType(dropContent, internalHtmlMime());
        if ((!clipboard.hasHtmlOrText(dropContent) || isPlainTextFileUrl(dropContent)) && clipboard.pasteImageData(e, rng)) {
          return;
        }
        if (rng && shouldFilterDrop(editor)) {
          var content_1 = dropContent['mce-internal'] || dropContent['text/html'] || dropContent['text/plain'];
          if (content_1) {
            e.preventDefault();
            global$2.setEditorTimeout(editor, function () {
              editor.undoManager.transact(function () {
                if (dropContent['mce-internal']) {
                  editor.execCommand('Delete');
                }
                setFocusedRange(editor, rng);
                content_1 = trimHtml(content_1);
                if (!dropContent['text/html']) {
                  clipboard.pasteText(content_1);
                } else {
                  clipboard.pasteHtml(content_1, internal);
                }
              });
            });
          }
        }
      });
      editor.on('dragstart', function (_e) {
        draggingInternallyState.set(true);
      });
      editor.on('dragover dragend', function (e) {
        if (shouldPasteDataImages(editor) && draggingInternallyState.get() === false) {
          e.preventDefault();
          setFocusedRange(editor, getCaretRangeFromEvent(editor, e));
        }
        if (e.type === 'dragend') {
          draggingInternallyState.set(false);
        }
      });
    };

    var setup$1 = function (editor) {
      var plugin = editor.plugins.paste;
      var preProcess = getPreProcess(editor);
      if (preProcess) {
        editor.on('PastePreProcess', function (e) {
          preProcess.call(plugin, plugin, e);
        });
      }
      var postProcess = getPostProcess(editor);
      if (postProcess) {
        editor.on('PastePostProcess', function (e) {
          postProcess.call(plugin, plugin, e);
        });
      }
    };

    var addPreProcessFilter = function (editor, filterFunc) {
      editor.on('PastePreProcess', function (e) {
        e.content = filterFunc(editor, e.content, e.internal, e.wordContent);
      });
    };
    var addPostProcessFilter = function (editor, filterFunc) {
      editor.on('PastePostProcess', function (e) {
        filterFunc(editor, e.node);
      });
    };
    var removeExplorerBrElementsAfterBlocks = function (editor, html) {
      if (!isWordContent(html)) {
        return html;
      }
      var blockElements = [];
      global$5.each(editor.schema.getBlockElements(), function (block, blockName) {
        blockElements.push(blockName);
      });
      var explorerBlocksRegExp = new RegExp('(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?(' + blockElements.join('|') + ')[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*', 'g');
      html = filter$1(html, [[
          explorerBlocksRegExp,
          '$1'
        ]]);
      html = filter$1(html, [
        [
          /<br><br>/g,
          '<BR><BR>'
        ],
        [
          /<br>/g,
          ' '
        ],
        [
          /<BR><BR>/g,
          '<br>'
        ]
      ]);
      return html;
    };
    var removeWebKitStyles = function (editor, content, internal, isWordHtml) {
      if (isWordHtml || internal) {
        return content;
      }
      var webKitStylesSetting = getWebkitStyles(editor);
      var webKitStyles;
      if (shouldRemoveWebKitStyles(editor) === false || webKitStylesSetting === 'all') {
        return content;
      }
      if (webKitStylesSetting) {
        webKitStyles = webKitStylesSetting.split(/[, ]/);
      }
      if (webKitStyles) {
        var dom_1 = editor.dom, node_1 = editor.selection.getNode();
        content = content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi, function (all, before, value, after) {
          var inputStyles = dom_1.parseStyle(dom_1.decode(value));
          var outputStyles = {};
          if (webKitStyles === 'none') {
            return before + after;
          }
          for (var i = 0; i < webKitStyles.length; i++) {
            var inputValue = inputStyles[webKitStyles[i]], currentValue = dom_1.getStyle(node_1, webKitStyles[i], true);
            if (/color/.test(webKitStyles[i])) {
              inputValue = dom_1.toHex(inputValue);
              currentValue = dom_1.toHex(currentValue);
            }
            if (currentValue !== inputValue) {
              outputStyles[webKitStyles[i]] = inputValue;
            }
          }
          outputStyles = dom_1.serializeStyle(outputStyles, 'span');
          if (outputStyles) {
            return before + ' style="' + outputStyles + '"' + after;
          }
          return before + after;
        });
      } else {
        content = content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi, '$1$3');
      }
      content = content.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi, function (all, before, value, after) {
        return before + ' style="' + value + '"' + after;
      });
      return content;
    };
    var removeUnderlineAndFontInAnchor = function (editor, root) {
      editor.$('a', root).find('font,u').each(function (i, node) {
        editor.dom.remove(node, true);
      });
    };
    var setup$2 = function (editor) {
      if (global$1.webkit) {
        addPreProcessFilter(editor, removeWebKitStyles);
      }
      if (global$1.ie) {
        addPreProcessFilter(editor, removeExplorerBrElementsAfterBlocks);
        addPostProcessFilter(editor, removeUnderlineAndFontInAnchor);
      }
    };

    var makeSetupHandler = function (editor, clipboard) {
      return function (api) {
        api.setActive(clipboard.pasteFormat.get() === 'text');
        var pastePlainTextToggleHandler = function (e) {
          return api.setActive(e.state);
        };
        editor.on('PastePlainTextToggle', pastePlainTextToggleHandler);
        return function () {
          return editor.off('PastePlainTextToggle', pastePlainTextToggleHandler);
        };
      };
    };
    var register$2 = function (editor, clipboard) {
      editor.ui.registry.addToggleButton('pastetext', {
        active: false,
        icon: 'paste-text',
        tooltip: 'Paste as text',
        onAction: function () {
          return editor.execCommand('mceTogglePlainTextPaste');
        },
        onSetup: makeSetupHandler(editor, clipboard)
      });
      editor.ui.registry.addToggleMenuItem('pastetext', {
        text: 'Paste as text',
        icon: 'paste-text',
        onAction: function () {
          return editor.execCommand('mceTogglePlainTextPaste');
        },
        onSetup: makeSetupHandler(editor, clipboard)
      });
    };

    function Plugin () {
      global.add('paste', function (editor) {
        if (hasProPlugin(editor) === false) {
          var draggingInternallyState = Cell(false);
          var pasteFormat = Cell(isPasteAsTextEnabled(editor) ? 'text' : 'html');
          var clipboard = Clipboard(editor, pasteFormat);
          var quirks = setup$2(editor);
          register$2(editor, clipboard);
          register(editor, clipboard);
          setup$1(editor);
          register$1(editor);
          setup(editor, clipboard, draggingInternallyState);
          return get(clipboard, quirks);
        }
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX3Bhc3RlX2luZGV4X2pzLmNodW5rLmpzIiwic291cmNlcyI6WyIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy9wYXN0ZS9pbmRleC5qcyIsIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL3Bhc3RlL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcInBhc3RlXCIgcGx1Z2luIGZvciB1c2FnZSB3aXRoIG1vZHVsZSBsb2FkZXJzXG4vLyBVc2FnZTpcbi8vICAgQ29tbW9uSlM6XG4vLyAgICAgcmVxdWlyZSgndGlueW1jZS9wbHVnaW5zL3Bhc3RlJylcbi8vICAgRVMyMDE1OlxuLy8gICAgIGltcG9ydCAndGlueW1jZS9wbHVnaW5zL3Bhc3RlJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgQ2VsbCA9IGZ1bmN0aW9uIChpbml0aWFsKSB7XG4gICAgICB2YXIgdmFsdWUgPSBpbml0aWFsO1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB2YWx1ZSA9IHY7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIGhhc1Byb1BsdWdpbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGlmIChlZGl0b3IuaGFzUGx1Z2luKCdwb3dlcnBhc3RlJywgdHJ1ZSkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmNvbnNvbGUubG9nKSB7XG4gICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdQb3dlclBhc3RlIGlzIGluY29tcGF0aWJsZSB3aXRoIFBhc3RlIHBsdWdpbiEgUmVtb3ZlIFxcJ3Bhc3RlXFwnIGZyb20gdGhlIFxcJ3BsdWdpbnNcXCcgb3B0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKGNsaXBib2FyZCwgcXVpcmtzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbGlwYm9hcmQ6IGNsaXBib2FyZCxcbiAgICAgICAgcXVpcmtzOiBxdWlya3NcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBpc1NpbXBsZVR5cGUgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSB0eXBlO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc051bGxhYmxlID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIHJldHVybiBhID09PSBudWxsIHx8IGEgPT09IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHZhciBpc05vbk51bGxhYmxlID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIHJldHVybiAhaXNOdWxsYWJsZShhKTtcbiAgICB9O1xuICAgIHZhciBpc0Z1bmN0aW9uID0gaXNTaW1wbGVUeXBlKCdmdW5jdGlvbicpO1xuXG4gICAgdmFyIG5vb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgfTtcbiAgICB2YXIgY29uc3RhbnQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbmV2ZXIgPSBjb25zdGFudChmYWxzZSk7XG4gICAgdmFyIGFsd2F5cyA9IGNvbnN0YW50KHRydWUpO1xuXG4gICAgdmFyIG5vbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gTk9ORTtcbiAgICB9O1xuICAgIHZhciBOT05FID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVxID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIG8uaXNOb25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAodGh1bmspIHtcbiAgICAgICAgcmV0dXJuIHRodW5rKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGlkID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBmb2xkOiBmdW5jdGlvbiAobiwgX3MpIHtcbiAgICAgICAgICByZXR1cm4gbigpO1xuICAgICAgICB9LFxuICAgICAgICBpczogbmV2ZXIsXG4gICAgICAgIGlzU29tZTogbmV2ZXIsXG4gICAgICAgIGlzTm9uZTogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWQsXG4gICAgICAgIGdldE9yVGh1bms6IGNhbGwsXG4gICAgICAgIGdldE9yRGllOiBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyB8fCAnZXJyb3I6IGdldE9yRGllIGNhbGxlZCBvbiBub25lLicpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50KG51bGwpLFxuICAgICAgICBnZXRPclVuZGVmaW5lZDogY29uc3RhbnQodW5kZWZpbmVkKSxcbiAgICAgICAgb3I6IGlkLFxuICAgICAgICBvclRodW5rOiBjYWxsLFxuICAgICAgICBtYXA6IG5vbmUsXG4gICAgICAgIGVhY2g6IG5vb3AsXG4gICAgICAgIGJpbmQ6IG5vbmUsXG4gICAgICAgIGV4aXN0czogbmV2ZXIsXG4gICAgICAgIGZvcmFsbDogYWx3YXlzLFxuICAgICAgICBmaWx0ZXI6IG5vbmUsXG4gICAgICAgIGVxdWFsczogZXEsXG4gICAgICAgIGVxdWFsc186IGVxLFxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogY29uc3RhbnQoJ25vbmUoKScpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH0oKTtcbiAgICB2YXIgc29tZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICB2YXIgY29uc3RhbnRfYSA9IGNvbnN0YW50KGEpO1xuICAgICAgdmFyIHNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtZTtcbiAgICAgIH07XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIHMpIHtcbiAgICAgICAgICByZXR1cm4gcyhhKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IHY7XG4gICAgICAgIH0sXG4gICAgICAgIGlzU29tZTogYWx3YXlzLFxuICAgICAgICBpc05vbmU6IG5ldmVyLFxuICAgICAgICBnZXRPcjogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JEaWU6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yTnVsbDogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50X2EsXG4gICAgICAgIG9yOiBzZWxmLFxuICAgICAgICBvclRodW5rOiBzZWxmLFxuICAgICAgICBtYXA6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIHNvbWUoZihhKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVhY2g6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgZihhKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgZXhpc3RzOiBiaW5kLFxuICAgICAgICBmb3JhbGw6IGJpbmQsXG4gICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gZihhKSA/IG1lIDogTk9ORTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbYV07XG4gICAgICAgIH0sXG4gICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdzb21lKCcgKyBhICsgJyknO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgcmV0dXJuIG8uaXMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVxdWFsc186IGZ1bmN0aW9uIChvLCBlbGVtZW50RXEpIHtcbiAgICAgICAgICByZXR1cm4gby5mb2xkKG5ldmVyLCBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRFcShhLCBiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9O1xuICAgIHZhciBmcm9tID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IE5PTkUgOiBzb21lKHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBPcHRpb25hbCA9IHtcbiAgICAgIHNvbWU6IHNvbWUsXG4gICAgICBub25lOiBub25lLFxuICAgICAgZnJvbTogZnJvbVxuICAgIH07XG5cbiAgICB2YXIgbmF0aXZlU2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG4gICAgdmFyIGV4aXN0cyA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIGlmIChwcmVkKHgsIGkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBtYXAgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHZhciBsZW4gPSB4cy5sZW5ndGg7XG4gICAgICB2YXIgciA9IG5ldyBBcnJheShsZW4pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICByW2ldID0gZih4LCBpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBmKHgsIGkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGZpbHRlciA9IGZ1bmN0aW9uICh4cywgcHJlZCkge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBpZiAocHJlZCh4LCBpKSkge1xuICAgICAgICAgIHIucHVzaCh4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZm9sZGwgPSBmdW5jdGlvbiAoeHMsIGYsIGFjYykge1xuICAgICAgZWFjaCh4cywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgYWNjID0gZihhY2MsIHgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH07XG4gICAgdmFyIGZyb20kMSA9IGlzRnVuY3Rpb24oQXJyYXkuZnJvbSkgPyBBcnJheS5mcm9tIDogZnVuY3Rpb24gKHgpIHtcbiAgICAgIHJldHVybiBuYXRpdmVTbGljZS5jYWxsKHgpO1xuICAgIH07XG5cbiAgICB2YXIgdmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc3ViamVjdCA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHN1YmplY3Quc2V0KE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIHNldCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LnNldChPcHRpb25hbC5zb21lKHMpKTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNTZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LmdldCgpLmlzU29tZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBvbiA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LmdldCgpLmVhY2goZik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2xlYXI6IGNsZWFyLFxuICAgICAgICBzZXQ6IHNldCxcbiAgICAgICAgaXNTZXQ6IGlzU2V0LFxuICAgICAgICBvbjogb25cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBjaGVja1JhbmdlID0gZnVuY3Rpb24gKHN0ciwgc3Vic3RyLCBzdGFydCkge1xuICAgICAgcmV0dXJuIHN1YnN0ciA9PT0gJycgfHwgc3RyLmxlbmd0aCA+PSBzdWJzdHIubGVuZ3RoICYmIHN0ci5zdWJzdHIoc3RhcnQsIHN0YXJ0ICsgc3Vic3RyLmxlbmd0aCkgPT09IHN1YnN0cjtcbiAgICB9O1xuICAgIHZhciBzdGFydHNXaXRoID0gZnVuY3Rpb24gKHN0ciwgcHJlZml4KSB7XG4gICAgICByZXR1cm4gY2hlY2tSYW5nZShzdHIsIHByZWZpeCwgMCk7XG4gICAgfTtcbiAgICB2YXIgZW5kc1dpdGggPSBmdW5jdGlvbiAoc3RyLCBzdWZmaXgpIHtcbiAgICAgIHJldHVybiBjaGVja1JhbmdlKHN0ciwgc3VmZml4LCBzdHIubGVuZ3RoIC0gc3VmZml4Lmxlbmd0aCk7XG4gICAgfTtcbiAgICB2YXIgcmVwZWF0ID0gZnVuY3Rpb24gKHMsIGNvdW50KSB7XG4gICAgICByZXR1cm4gY291bnQgPD0gMCA/ICcnIDogbmV3IEFycmF5KGNvdW50ICsgMSkuam9pbihzKTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCQxID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuRW52Jyk7XG5cbiAgICB2YXIgZ2xvYmFsJDIgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLkRlbGF5Jyk7XG5cbiAgICB2YXIgZ2xvYmFsJDMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS51dGlsLlByb21pc2UnKTtcblxuICAgIHZhciBnbG9iYWwkNCA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVksnKTtcblxuICAgIHZhciBmaXJlUGFzdGVQcmVQcm9jZXNzID0gZnVuY3Rpb24gKGVkaXRvciwgaHRtbCwgaW50ZXJuYWwsIGlzV29yZEh0bWwpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZmlyZSgnUGFzdGVQcmVQcm9jZXNzJywge1xuICAgICAgICBjb250ZW50OiBodG1sLFxuICAgICAgICBpbnRlcm5hbDogaW50ZXJuYWwsXG4gICAgICAgIHdvcmRDb250ZW50OiBpc1dvcmRIdG1sXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmaXJlUGFzdGVQb3N0UHJvY2VzcyA9IGZ1bmN0aW9uIChlZGl0b3IsIG5vZGUsIGludGVybmFsLCBpc1dvcmRIdG1sKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmZpcmUoJ1Bhc3RlUG9zdFByb2Nlc3MnLCB7XG4gICAgICAgIG5vZGU6IG5vZGUsXG4gICAgICAgIGludGVybmFsOiBpbnRlcm5hbCxcbiAgICAgICAgd29yZENvbnRlbnQ6IGlzV29yZEh0bWxcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGZpcmVQYXN0ZVBsYWluVGV4dFRvZ2dsZSA9IGZ1bmN0aW9uIChlZGl0b3IsIHN0YXRlKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmZpcmUoJ1Bhc3RlUGxhaW5UZXh0VG9nZ2xlJywgeyBzdGF0ZTogc3RhdGUgfSk7XG4gICAgfTtcbiAgICB2YXIgZmlyZVBhc3RlID0gZnVuY3Rpb24gKGVkaXRvciwgaWVGYWtlKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmZpcmUoJ3Bhc3RlJywgeyBpZUZha2U6IGllRmFrZSB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCQ1ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5Ub29scycpO1xuXG4gICAgdmFyIHNob3VsZEJsb2NrRHJvcCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX2Jsb2NrX2Ryb3AnLCBmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgc2hvdWxkUGFzdGVEYXRhSW1hZ2VzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfZGF0YV9pbWFnZXMnLCBmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgc2hvdWxkRmlsdGVyRHJvcCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX2ZpbHRlcl9kcm9wJywgdHJ1ZSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UHJlUHJvY2VzcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX3ByZXByb2Nlc3MnKTtcbiAgICB9O1xuICAgIHZhciBnZXRQb3N0UHJvY2VzcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX3Bvc3Rwcm9jZXNzJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0V2Via2l0U3R5bGVzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfd2Via2l0X3N0eWxlcycpO1xuICAgIH07XG4gICAgdmFyIHNob3VsZFJlbW92ZVdlYktpdFN0eWxlcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX3JlbW92ZV9zdHlsZXNfaWZfd2Via2l0JywgdHJ1ZSk7XG4gICAgfTtcbiAgICB2YXIgc2hvdWxkTWVyZ2VGb3JtYXRzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfbWVyZ2VfZm9ybWF0cycsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIGlzU21hcnRQYXN0ZUVuYWJsZWQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdzbWFydF9wYXN0ZScsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIGlzUGFzdGVBc1RleHRFbmFibGVkID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfYXNfdGV4dCcsIGZhbHNlKTtcbiAgICB9O1xuICAgIHZhciBnZXRSZXRhaW5TdHlsZVByb3BzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfcmV0YWluX3N0eWxlX3Byb3BlcnRpZXMnKTtcbiAgICB9O1xuICAgIHZhciBnZXRXb3JkVmFsaWRFbGVtZW50cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBkZWZhdWx0VmFsaWRFbGVtZW50cyA9ICctc3Ryb25nL2IsLWVtL2ksLXUsLXNwYW4sLXAsLW9sLC11bCwtbGksLWgxLC1oMiwtaDMsLWg0LC1oNSwtaDYsJyArICctcC9kaXYsLWFbaHJlZnxuYW1lXSxzdWIsc3VwLHN0cmlrZSxicixkZWwsdGFibGVbd2lkdGhdLHRyLCcgKyAndGRbY29sc3Bhbnxyb3dzcGFufHdpZHRoXSx0aFtjb2xzcGFufHJvd3NwYW58d2lkdGhdLHRoZWFkLHRmb290LHRib2R5JztcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX3dvcmRfdmFsaWRfZWxlbWVudHMnLCBkZWZhdWx0VmFsaWRFbGVtZW50cyk7XG4gICAgfTtcbiAgICB2YXIgc2hvdWxkQ29udmVydFdvcmRGYWtlTGlzdHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdwYXN0ZV9jb252ZXJ0X3dvcmRfZmFrZV9saXN0cycsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIHNob3VsZFVzZURlZmF1bHRGaWx0ZXJzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfZW5hYmxlX2RlZmF1bHRfZmlsdGVycycsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIGdldFZhbGlkYXRlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndmFsaWRhdGUnKTtcbiAgICB9O1xuICAgIHZhciBnZXRBbGxvd0h0bWxEYXRhVXJscyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2FsbG93X2h0bWxfZGF0YV91cmxzJywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UGFzdGVEYXRhSW1hZ2VzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgncGFzdGVfZGF0YV9pbWFnZXMnLCBmYWxzZSwgJ2Jvb2xlYW4nKTtcbiAgICB9O1xuICAgIHZhciBnZXRJbWFnZXNEYXRhSW1nRmlsdGVyID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnaW1hZ2VzX2RhdGFpbWdfZmlsdGVyJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SW1hZ2VzUmV1c2VGaWxlbmFtZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ltYWdlc19yZXVzZV9maWxlbmFtZScpO1xuICAgIH07XG4gICAgdmFyIGdldEZvcmNlZFJvb3RCbG9jayA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ2ZvcmNlZF9yb290X2Jsb2NrJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Rm9yY2VkUm9vdEJsb2NrQXR0cnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdmb3JjZWRfcm9vdF9ibG9ja19hdHRycycpO1xuICAgIH07XG4gICAgdmFyIGdldFRhYlNwYWNlcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3Bhc3RlX3RhYl9zcGFjZXMnLCA0LCAnbnVtYmVyJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0QWxsb3dlZEltYWdlRmlsZVR5cGVzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGRlZmF1bHRJbWFnZUZpbGVUeXBlcyA9ICdqcGVnLGpwZyxqcGUsamZpLGppZixqZmlmLHBuZyxnaWYsYm1wLHdlYnAnO1xuICAgICAgcmV0dXJuIGdsb2JhbCQ1LmV4cGxvZGUoZWRpdG9yLmdldFBhcmFtKCdpbWFnZXNfZmlsZV90eXBlcycsIGRlZmF1bHRJbWFnZUZpbGVUeXBlcywgJ3N0cmluZycpKTtcbiAgICB9O1xuXG4gICAgdmFyIGludGVybmFsTWltZVR5cGUgPSAneC10aW55bWNlL2h0bWwnO1xuICAgIHZhciBpbnRlcm5hbE1hcmsgPSAnPCEtLSAnICsgaW50ZXJuYWxNaW1lVHlwZSArICcgLS0+JztcbiAgICB2YXIgbWFyayA9IGZ1bmN0aW9uIChodG1sKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWxNYXJrICsgaHRtbDtcbiAgICB9O1xuICAgIHZhciB1bm1hcmsgPSBmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgcmV0dXJuIGh0bWwucmVwbGFjZShpbnRlcm5hbE1hcmssICcnKTtcbiAgICB9O1xuICAgIHZhciBpc01hcmtlZCA9IGZ1bmN0aW9uIChodG1sKSB7XG4gICAgICByZXR1cm4gaHRtbC5pbmRleE9mKGludGVybmFsTWFyaykgIT09IC0xO1xuICAgIH07XG4gICAgdmFyIGludGVybmFsSHRtbE1pbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWxNaW1lVHlwZTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCQ2ID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuaHRtbC5FbnRpdGllcycpO1xuXG4gICAgdmFyIGlzUGxhaW5UZXh0ID0gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiAhLzwoPzpcXC8/KD8hKD86ZGl2fHB8YnJ8c3Bhbik+KVxcdyt8KD86KD8hKD86c3BhbiBzdHlsZT1cIndoaXRlLXNwYWNlOlxccz9wcmU7P1wiPil8YnJcXHM/XFwvPikpXFx3K1xcc1tePl0rKT4vaS50ZXN0KHRleHQpO1xuICAgIH07XG4gICAgdmFyIHRvQlJzID0gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xccj9cXG4vZywgJzxicj4nKTtcbiAgICB9O1xuICAgIHZhciBvcGVuQ29udGFpbmVyID0gZnVuY3Rpb24gKHJvb3RUYWcsIHJvb3RBdHRycykge1xuICAgICAgdmFyIGtleTtcbiAgICAgIHZhciBhdHRycyA9IFtdO1xuICAgICAgdmFyIHRhZyA9ICc8JyArIHJvb3RUYWc7XG4gICAgICBpZiAodHlwZW9mIHJvb3RBdHRycyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgZm9yIChrZXkgaW4gcm9vdEF0dHJzKSB7XG4gICAgICAgICAgaWYgKHJvb3RBdHRycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICBhdHRycy5wdXNoKGtleSArICc9XCInICsgZ2xvYmFsJDYuZW5jb2RlQWxsUmF3KHJvb3RBdHRyc1trZXldKSArICdcIicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYXR0cnMubGVuZ3RoKSB7XG4gICAgICAgICAgdGFnICs9ICcgJyArIGF0dHJzLmpvaW4oJyAnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhZyArICc+JztcbiAgICB9O1xuICAgIHZhciB0b0Jsb2NrRWxlbWVudHMgPSBmdW5jdGlvbiAodGV4dCwgcm9vdFRhZywgcm9vdEF0dHJzKSB7XG4gICAgICB2YXIgYmxvY2tzID0gdGV4dC5zcGxpdCgvXFxuXFxuLyk7XG4gICAgICB2YXIgdGFnT3BlbiA9IG9wZW5Db250YWluZXIocm9vdFRhZywgcm9vdEF0dHJzKTtcbiAgICAgIHZhciB0YWdDbG9zZSA9ICc8LycgKyByb290VGFnICsgJz4nO1xuICAgICAgdmFyIHBhcmFncmFwaHMgPSBnbG9iYWwkNS5tYXAoYmxvY2tzLCBmdW5jdGlvbiAocCkge1xuICAgICAgICByZXR1cm4gcC5zcGxpdCgvXFxuLykuam9pbignPGJyIC8+Jyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBzdGl0Y2ggPSBmdW5jdGlvbiAocCkge1xuICAgICAgICByZXR1cm4gdGFnT3BlbiArIHAgKyB0YWdDbG9zZTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gcGFyYWdyYXBocy5sZW5ndGggPT09IDEgPyBwYXJhZ3JhcGhzWzBdIDogZ2xvYmFsJDUubWFwKHBhcmFncmFwaHMsIHN0aXRjaCkuam9pbignJyk7XG4gICAgfTtcbiAgICB2YXIgY29udmVydCA9IGZ1bmN0aW9uICh0ZXh0LCByb290VGFnLCByb290QXR0cnMpIHtcbiAgICAgIHJldHVybiByb290VGFnID8gdG9CbG9ja0VsZW1lbnRzKHRleHQsIHJvb3RUYWcgPT09IHRydWUgPyAncCcgOiByb290VGFnLCByb290QXR0cnMpIDogdG9CUnModGV4dCk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkNyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmh0bWwuRG9tUGFyc2VyJyk7XG5cbiAgICB2YXIgZ2xvYmFsJDggPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5odG1sLlNlcmlhbGl6ZXInKTtcblxuICAgIHZhciBuYnNwID0gJ1xceEEwJztcblxuICAgIHZhciBnbG9iYWwkOSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmh0bWwuTm9kZScpO1xuXG4gICAgdmFyIGdsb2JhbCRhID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuaHRtbC5TY2hlbWEnKTtcblxuICAgIHZhciBmaWx0ZXIkMSA9IGZ1bmN0aW9uIChjb250ZW50LCBpdGVtcykge1xuICAgICAgZ2xvYmFsJDUuZWFjaChpdGVtcywgZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgaWYgKHYuY29uc3RydWN0b3IgPT09IFJlZ0V4cCkge1xuICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UodiwgJycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UodlswXSwgdlsxXSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfTtcbiAgICB2YXIgaW5uZXJUZXh0ID0gZnVuY3Rpb24gKGh0bWwpIHtcbiAgICAgIHZhciBzY2hlbWEgPSBnbG9iYWwkYSgpO1xuICAgICAgdmFyIGRvbVBhcnNlciA9IGdsb2JhbCQ3KHt9LCBzY2hlbWEpO1xuICAgICAgdmFyIHRleHQgPSAnJztcbiAgICAgIHZhciBzaG9ydEVuZGVkRWxlbWVudHMgPSBzY2hlbWEuZ2V0U2hvcnRFbmRlZEVsZW1lbnRzKCk7XG4gICAgICB2YXIgaWdub3JlRWxlbWVudHMgPSBnbG9iYWwkNS5tYWtlTWFwKCdzY3JpcHQgbm9zY3JpcHQgc3R5bGUgdGV4dGFyZWEgdmlkZW8gYXVkaW8gaWZyYW1lIG9iamVjdCcsICcgJyk7XG4gICAgICB2YXIgYmxvY2tFbGVtZW50cyA9IHNjaGVtYS5nZXRCbG9ja0VsZW1lbnRzKCk7XG4gICAgICB2YXIgd2FsayA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHZhciBuYW1lID0gbm9kZS5uYW1lLCBjdXJyZW50Tm9kZSA9IG5vZGU7XG4gICAgICAgIGlmIChuYW1lID09PSAnYnInKSB7XG4gICAgICAgICAgdGV4dCArPSAnXFxuJztcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5hbWUgPT09ICd3YnInKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaG9ydEVuZGVkRWxlbWVudHNbbmFtZV0pIHtcbiAgICAgICAgICB0ZXh0ICs9ICcgJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaWdub3JlRWxlbWVudHNbbmFtZV0pIHtcbiAgICAgICAgICB0ZXh0ICs9ICcgJztcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gMykge1xuICAgICAgICAgIHRleHQgKz0gbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW5vZGUuc2hvcnRFbmRlZCkge1xuICAgICAgICAgIGlmIChub2RlID0gbm9kZS5maXJzdENoaWxkKSB7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgIHdhbGsobm9kZSk7XG4gICAgICAgICAgICB9IHdoaWxlIChub2RlID0gbm9kZS5uZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJsb2NrRWxlbWVudHNbbmFtZV0gJiYgY3VycmVudE5vZGUubmV4dCkge1xuICAgICAgICAgIHRleHQgKz0gJ1xcbic7XG4gICAgICAgICAgaWYgKG5hbWUgPT09ICdwJykge1xuICAgICAgICAgICAgdGV4dCArPSAnXFxuJztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBodG1sID0gZmlsdGVyJDEoaHRtbCwgWy88IVxcW1teXFxdXStcXF0+L2ddKTtcbiAgICAgIHdhbGsoZG9tUGFyc2VyLnBhcnNlKGh0bWwpKTtcbiAgICAgIHJldHVybiB0ZXh0O1xuICAgIH07XG4gICAgdmFyIHRyaW1IdG1sID0gZnVuY3Rpb24gKGh0bWwpIHtcbiAgICAgIHZhciB0cmltU3BhY2VzID0gZnVuY3Rpb24gKGFsbCwgczEsIHMyKSB7XG4gICAgICAgIGlmICghczEgJiYgIXMyKSB7XG4gICAgICAgICAgcmV0dXJuICcgJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmJzcDtcbiAgICAgIH07XG4gICAgICBodG1sID0gZmlsdGVyJDEoaHRtbCwgW1xuICAgICAgICAvXltcXHNcXFNdKjxib2R5W14+XSo+XFxzKnxcXHMqPFxcL2JvZHlbXj5dKj5bXFxzXFxTXSokL2lnLFxuICAgICAgICAvPCEtLVN0YXJ0RnJhZ21lbnQtLT58PCEtLUVuZEZyYWdtZW50LS0+L2csXG4gICAgICAgIFtcbiAgICAgICAgICAvKCA/KTxzcGFuIGNsYXNzPVwiQXBwbGUtY29udmVydGVkLXNwYWNlXCI+XFx1MDBhMDxcXC9zcGFuPiggPykvZyxcbiAgICAgICAgICB0cmltU3BhY2VzXG4gICAgICAgIF0sXG4gICAgICAgIC88YnIgY2xhc3M9XCJBcHBsZS1pbnRlcmNoYW5nZS1uZXdsaW5lXCI+L2csXG4gICAgICAgIC88YnI+JC9pXG4gICAgICBdKTtcbiAgICAgIHJldHVybiBodG1sO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZUlkR2VuZXJhdG9yID0gZnVuY3Rpb24gKHByZWZpeCkge1xuICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwcmVmaXggKyBjb3VudCsrO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZXRJbWFnZU1pbWVUeXBlID0gZnVuY3Rpb24gKGV4dCkge1xuICAgICAgdmFyIGxvd2VyRXh0ID0gZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICB2YXIgbWltZU92ZXJyaWRlcyA9IHtcbiAgICAgICAganBnOiAnanBlZycsXG4gICAgICAgIGpwZTogJ2pwZWcnLFxuICAgICAgICBqZmk6ICdqcGVnJyxcbiAgICAgICAgamlmOiAnanBlZycsXG4gICAgICAgIGpmaWY6ICdqcGVnJyxcbiAgICAgICAgcGpwZWc6ICdqcGVnJyxcbiAgICAgICAgcGpwOiAnanBlZycsXG4gICAgICAgIHN2ZzogJ3N2Zyt4bWwnXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGdsb2JhbCQ1Lmhhc093bihtaW1lT3ZlcnJpZGVzLCBsb3dlckV4dCkgPyAnaW1hZ2UvJyArIG1pbWVPdmVycmlkZXNbbG93ZXJFeHRdIDogJ2ltYWdlLycgKyBsb3dlckV4dDtcbiAgICB9O1xuXG4gICAgdmFyIGlzV29yZENvbnRlbnQgPSBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgcmV0dXJuIC88Zm9udCBmYWNlPVwiVGltZXMgTmV3IFJvbWFuXCJ8Y2xhc3M9XCI/TXNvfHN0eWxlPVwiW15cIl0qXFxibXNvLXxzdHlsZT0nW14nXSpcXGJtc28tfHc6V29yZERvY3VtZW50L2kudGVzdChjb250ZW50KSB8fCAvY2xhc3M9XCJPdXRsaW5lRWxlbWVudC8udGVzdChjb250ZW50KSB8fCAvaWQ9XCI/ZG9jc1xcLWludGVybmFsXFwtZ3VpZFxcLS8udGVzdChjb250ZW50KTtcbiAgICB9O1xuICAgIHZhciBpc051bWVyaWNMaXN0ID0gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHZhciBmb3VuZDtcbiAgICAgIHZhciBwYXR0ZXJucyA9IFtcbiAgICAgICAgL15bSVZYTE1DRF0rXFwuWyBcXHUwMGEwXS8sXG4gICAgICAgIC9eW2l2eGxtY2RdK1xcLlsgXFx1MDBhMF0vLFxuICAgICAgICAvXlthLXpdezEsMn1bXFwuXFwpXVsgXFx1MDBhMF0vLFxuICAgICAgICAvXltBLVpdezEsMn1bXFwuXFwpXVsgXFx1MDBhMF0vLFxuICAgICAgICAvXlswLTldK1xcLlsgXFx1MDBhMF0vLFxuICAgICAgICAvXltcXHUzMDA3XFx1NGUwMFxcdTRlOGNcXHU0ZTA5XFx1NTZkYlxcdTRlOTRcXHU1MTZkXFx1NGUwM1xcdTUxNmJcXHU0ZTVkXStcXC5bIFxcdTAwYTBdLyxcbiAgICAgICAgL15bXFx1NThmMVxcdTVmMTBcXHU1M2MyXFx1NTZkYlxcdTRmMGRcXHU1MTZkXFx1NGUwM1xcdTUxNmJcXHU0ZTVkXFx1NjJmZV0rXFwuWyBcXHUwMGEwXS9cbiAgICAgIF07XG4gICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9eW1xcdTAwYTAgXSsvLCAnJyk7XG4gICAgICBnbG9iYWwkNS5lYWNoKHBhdHRlcm5zLCBmdW5jdGlvbiAocGF0dGVybikge1xuICAgICAgICBpZiAocGF0dGVybi50ZXN0KHRleHQpKSB7XG4gICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gZm91bmQ7XG4gICAgfTtcbiAgICB2YXIgaXNCdWxsZXRMaXN0ID0gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiAvXltcXHNcXHUwMGEwXSpbXFx1MjAyMlxcdTAwYjdcXHUwMGE3XFx1MjVDRl1cXHMqLy50ZXN0KHRleHQpO1xuICAgIH07XG4gICAgdmFyIGNvbnZlcnRGYWtlTGlzdHNUb1Byb3Blckxpc3RzID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHZhciBjdXJyZW50TGlzdE5vZGUsIHByZXZMaXN0Tm9kZSwgbGFzdExldmVsID0gMTtcbiAgICAgIHZhciBnZXRUZXh0ID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgdmFyIHR4dCA9ICcnO1xuICAgICAgICBpZiAobm9kZS50eXBlID09PSAzKSB7XG4gICAgICAgICAgcmV0dXJuIG5vZGUudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICBkbyB7XG4gICAgICAgICAgICB0eHQgKz0gZ2V0VGV4dChub2RlKTtcbiAgICAgICAgICB9IHdoaWxlIChub2RlID0gbm9kZS5uZXh0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHh0O1xuICAgICAgfTtcbiAgICAgIHZhciB0cmltTGlzdFN0YXJ0ID0gZnVuY3Rpb24gKG5vZGUsIHJlZ0V4cCkge1xuICAgICAgICBpZiAobm9kZS50eXBlID09PSAzKSB7XG4gICAgICAgICAgaWYgKHJlZ0V4cC50ZXN0KG5vZGUudmFsdWUpKSB7XG4gICAgICAgICAgICBub2RlLnZhbHVlID0gbm9kZS52YWx1ZS5yZXBsYWNlKHJlZ0V4cCwgJycpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSA9IG5vZGUuZmlyc3RDaGlsZCkge1xuICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmICghdHJpbUxpc3RTdGFydChub2RlLCByZWdFeHApKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IHdoaWxlIChub2RlID0gbm9kZS5uZXh0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVtb3ZlSWdub3JlZE5vZGVzID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgaWYgKG5vZGUuX2xpc3RJZ25vcmUpIHtcbiAgICAgICAgICBub2RlLnJlbW92ZSgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSA9IG5vZGUuZmlyc3RDaGlsZCkge1xuICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgIHJlbW92ZUlnbm9yZWROb2Rlcyhub2RlKTtcbiAgICAgICAgICB9IHdoaWxlIChub2RlID0gbm9kZS5uZXh0KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBjb252ZXJ0UGFyYWdyYXBoVG9MaSA9IGZ1bmN0aW9uIChwYXJhZ3JhcGhOb2RlLCBsaXN0TmFtZSwgc3RhcnQpIHtcbiAgICAgICAgdmFyIGxldmVsID0gcGFyYWdyYXBoTm9kZS5fbGlzdExldmVsIHx8IGxhc3RMZXZlbDtcbiAgICAgICAgaWYgKGxldmVsICE9PSBsYXN0TGV2ZWwpIHtcbiAgICAgICAgICBpZiAobGV2ZWwgPCBsYXN0TGV2ZWwpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGlzdE5vZGUpIHtcbiAgICAgICAgICAgICAgY3VycmVudExpc3ROb2RlID0gY3VycmVudExpc3ROb2RlLnBhcmVudC5wYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByZXZMaXN0Tm9kZSA9IGN1cnJlbnRMaXN0Tm9kZTtcbiAgICAgICAgICAgIGN1cnJlbnRMaXN0Tm9kZSA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghY3VycmVudExpc3ROb2RlIHx8IGN1cnJlbnRMaXN0Tm9kZS5uYW1lICE9PSBsaXN0TmFtZSkge1xuICAgICAgICAgIHByZXZMaXN0Tm9kZSA9IHByZXZMaXN0Tm9kZSB8fCBjdXJyZW50TGlzdE5vZGU7XG4gICAgICAgICAgY3VycmVudExpc3ROb2RlID0gbmV3IGdsb2JhbCQ5KGxpc3ROYW1lLCAxKTtcbiAgICAgICAgICBpZiAoc3RhcnQgPiAxKSB7XG4gICAgICAgICAgICBjdXJyZW50TGlzdE5vZGUuYXR0cignc3RhcnQnLCAnJyArIHN0YXJ0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGFyYWdyYXBoTm9kZS53cmFwKGN1cnJlbnRMaXN0Tm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudExpc3ROb2RlLmFwcGVuZChwYXJhZ3JhcGhOb2RlKTtcbiAgICAgICAgfVxuICAgICAgICBwYXJhZ3JhcGhOb2RlLm5hbWUgPSAnbGknO1xuICAgICAgICBpZiAobGV2ZWwgPiBsYXN0TGV2ZWwgJiYgcHJldkxpc3ROb2RlKSB7XG4gICAgICAgICAgcHJldkxpc3ROb2RlLmxhc3RDaGlsZC5hcHBlbmQoY3VycmVudExpc3ROb2RlKTtcbiAgICAgICAgfVxuICAgICAgICBsYXN0TGV2ZWwgPSBsZXZlbDtcbiAgICAgICAgcmVtb3ZlSWdub3JlZE5vZGVzKHBhcmFncmFwaE5vZGUpO1xuICAgICAgICB0cmltTGlzdFN0YXJ0KHBhcmFncmFwaE5vZGUsIC9eXFx1MDBhMCsvKTtcbiAgICAgICAgdHJpbUxpc3RTdGFydChwYXJhZ3JhcGhOb2RlLCAvXlxccyooW1xcdTIwMjJcXHUwMGI3XFx1MDBhN1xcdTI1Q0ZdfFxcdytcXC4pLyk7XG4gICAgICAgIHRyaW1MaXN0U3RhcnQocGFyYWdyYXBoTm9kZSwgL15cXHUwMGEwKy8pO1xuICAgICAgfTtcbiAgICAgIHZhciBlbGVtZW50cyA9IFtdO1xuICAgICAgdmFyIGNoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuICAgICAgd2hpbGUgKHR5cGVvZiBjaGlsZCAhPT0gJ3VuZGVmaW5lZCcgJiYgY2hpbGQgIT09IG51bGwpIHtcbiAgICAgICAgZWxlbWVudHMucHVzaChjaGlsZCk7XG4gICAgICAgIGNoaWxkID0gY2hpbGQud2FsaygpO1xuICAgICAgICBpZiAoY2hpbGQgIT09IG51bGwpIHtcbiAgICAgICAgICB3aGlsZSAodHlwZW9mIGNoaWxkICE9PSAndW5kZWZpbmVkJyAmJiBjaGlsZC5wYXJlbnQgIT09IG5vZGUpIHtcbiAgICAgICAgICAgIGNoaWxkID0gY2hpbGQud2FsaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBub2RlID0gZWxlbWVudHNbaV07XG4gICAgICAgIGlmIChub2RlLm5hbWUgPT09ICdwJyAmJiBub2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICB2YXIgbm9kZVRleHQgPSBnZXRUZXh0KG5vZGUpO1xuICAgICAgICAgIGlmIChpc0J1bGxldExpc3Qobm9kZVRleHQpKSB7XG4gICAgICAgICAgICBjb252ZXJ0UGFyYWdyYXBoVG9MaShub2RlLCAndWwnKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNOdW1lcmljTGlzdChub2RlVGV4dCkpIHtcbiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gLyhbMC05XSspXFwuLy5leGVjKG5vZGVUZXh0KTtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IDE7XG4gICAgICAgICAgICBpZiAobWF0Y2hlcykge1xuICAgICAgICAgICAgICBzdGFydCA9IHBhcnNlSW50KG1hdGNoZXNbMV0sIDEwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnZlcnRQYXJhZ3JhcGhUb0xpKG5vZGUsICdvbCcsIHN0YXJ0KTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobm9kZS5fbGlzdExldmVsKSB7XG4gICAgICAgICAgICBjb252ZXJ0UGFyYWdyYXBoVG9MaShub2RlLCAndWwnLCAxKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50TGlzdE5vZGUgPSBudWxsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByZXZMaXN0Tm9kZSA9IGN1cnJlbnRMaXN0Tm9kZTtcbiAgICAgICAgICBjdXJyZW50TGlzdE5vZGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZmlsdGVyU3R5bGVzID0gZnVuY3Rpb24gKGVkaXRvciwgdmFsaWRTdHlsZXMsIG5vZGUsIHN0eWxlVmFsdWUpIHtcbiAgICAgIHZhciBvdXRwdXRTdHlsZXMgPSB7fSwgbWF0Y2hlcztcbiAgICAgIHZhciBzdHlsZXMgPSBlZGl0b3IuZG9tLnBhcnNlU3R5bGUoc3R5bGVWYWx1ZSk7XG4gICAgICBnbG9iYWwkNS5lYWNoKHN0eWxlcywgZnVuY3Rpb24gKHZhbHVlLCBuYW1lKSB7XG4gICAgICAgIHN3aXRjaCAobmFtZSkge1xuICAgICAgICBjYXNlICdtc28tbGlzdCc6XG4gICAgICAgICAgbWF0Y2hlcyA9IC9cXHcrIFxcdysoWzAtOV0rKS9pLmV4ZWMoc3R5bGVWYWx1ZSk7XG4gICAgICAgICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgICAgICAgIG5vZGUuX2xpc3RMZXZlbCA9IHBhcnNlSW50KG1hdGNoZXNbMV0sIDEwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKC9JZ25vcmUvaS50ZXN0KHZhbHVlKSAmJiBub2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICAgIG5vZGUuX2xpc3RJZ25vcmUgPSB0cnVlO1xuICAgICAgICAgICAgbm9kZS5maXJzdENoaWxkLl9saXN0SWdub3JlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2hvcml6LWFsaWduJzpcbiAgICAgICAgICBuYW1lID0gJ3RleHQtYWxpZ24nO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd2ZXJ0LWFsaWduJzpcbiAgICAgICAgICBuYW1lID0gJ3ZlcnRpY2FsLWFsaWduJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZm9udC1jb2xvcic6XG4gICAgICAgIGNhc2UgJ21zby1mb3JlZ3JvdW5kJzpcbiAgICAgICAgICBuYW1lID0gJ2NvbG9yJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbXNvLWJhY2tncm91bmQnOlxuICAgICAgICBjYXNlICdtc28taGlnaGxpZ2h0JzpcbiAgICAgICAgICBuYW1lID0gJ2JhY2tncm91bmQnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdmb250LXdlaWdodCc6XG4gICAgICAgIGNhc2UgJ2ZvbnQtc3R5bGUnOlxuICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJ25vcm1hbCcpIHtcbiAgICAgICAgICAgIG91dHB1dFN0eWxlc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNhc2UgJ21zby1lbGVtZW50JzpcbiAgICAgICAgICBpZiAoL14oY29tbWVudHxjb21tZW50LWxpc3QpJC9pLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAobmFtZS5pbmRleE9mKCdtc28tY29tbWVudCcpID09PSAwKSB7XG4gICAgICAgICAgbm9kZS5yZW1vdmUoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5hbWUuaW5kZXhPZignbXNvLScpID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChnZXRSZXRhaW5TdHlsZVByb3BzKGVkaXRvcikgPT09ICdhbGwnIHx8IHZhbGlkU3R5bGVzICYmIHZhbGlkU3R5bGVzW25hbWVdKSB7XG4gICAgICAgICAgb3V0cHV0U3R5bGVzW25hbWVdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKC8oYm9sZCkvaS50ZXN0KG91dHB1dFN0eWxlc1snZm9udC13ZWlnaHQnXSkpIHtcbiAgICAgICAgZGVsZXRlIG91dHB1dFN0eWxlc1snZm9udC13ZWlnaHQnXTtcbiAgICAgICAgbm9kZS53cmFwKG5ldyBnbG9iYWwkOSgnYicsIDEpKTtcbiAgICAgIH1cbiAgICAgIGlmICgvKGl0YWxpYykvaS50ZXN0KG91dHB1dFN0eWxlc1snZm9udC1zdHlsZSddKSkge1xuICAgICAgICBkZWxldGUgb3V0cHV0U3R5bGVzWydmb250LXN0eWxlJ107XG4gICAgICAgIG5vZGUud3JhcChuZXcgZ2xvYmFsJDkoJ2knLCAxKSk7XG4gICAgICB9XG4gICAgICBvdXRwdXRTdHlsZXMgPSBlZGl0b3IuZG9tLnNlcmlhbGl6ZVN0eWxlKG91dHB1dFN0eWxlcywgbm9kZS5uYW1lKTtcbiAgICAgIGlmIChvdXRwdXRTdHlsZXMpIHtcbiAgICAgICAgcmV0dXJuIG91dHB1dFN0eWxlcztcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgdmFyIGZpbHRlcldvcmRDb250ZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgY29udGVudCkge1xuICAgICAgdmFyIHZhbGlkU3R5bGVzO1xuICAgICAgdmFyIHJldGFpblN0eWxlUHJvcGVydGllcyA9IGdldFJldGFpblN0eWxlUHJvcHMoZWRpdG9yKTtcbiAgICAgIGlmIChyZXRhaW5TdHlsZVByb3BlcnRpZXMpIHtcbiAgICAgICAgdmFsaWRTdHlsZXMgPSBnbG9iYWwkNS5tYWtlTWFwKHJldGFpblN0eWxlUHJvcGVydGllcy5zcGxpdCgvWywgXS8pKTtcbiAgICAgIH1cbiAgICAgIGNvbnRlbnQgPSBmaWx0ZXIkMShjb250ZW50LCBbXG4gICAgICAgIC88YnIgY2xhc3M9XCI/QXBwbGUtaW50ZXJjaGFuZ2UtbmV3bGluZVwiPz4vZ2ksXG4gICAgICAgIC88YltePl0raWQ9XCI/ZG9jcy1pbnRlcm5hbC1bXj5dKj4vZ2ksXG4gICAgICAgIC88IS0tW1xcc1xcU10rPy0tPi9naSxcbiAgICAgICAgLzwoIXxzY3JpcHRbXj5dKj4uKj88XFwvc2NyaXB0KD89Wz5cXHNdKXxcXC8/KFxcP3htbCg6XFx3Kyk/fGltZ3xtZXRhfGxpbmt8c3R5bGV8XFx3OlxcdyspKD89W1xcc1xcLz5dKSlbXj5dKj4vZ2ksXG4gICAgICAgIFtcbiAgICAgICAgICAvPChcXC8/KXM+L2dpLFxuICAgICAgICAgICc8JDFzdHJpa2U+J1xuICAgICAgICBdLFxuICAgICAgICBbXG4gICAgICAgICAgLyZuYnNwOy9naSxcbiAgICAgICAgICBuYnNwXG4gICAgICAgIF0sXG4gICAgICAgIFtcbiAgICAgICAgICAvPHNwYW5cXHMrc3R5bGVcXHMqPVxccypcIlxccyptc28tc3BhY2VydW5cXHMqOlxccyp5ZXNcXHMqOz9cXHMqXCJcXHMqPihbXFxzXFx1MDBhMF0qKTxcXC9zcGFuPi9naSxcbiAgICAgICAgICBmdW5jdGlvbiAoc3RyLCBzcGFjZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBzcGFjZXMubGVuZ3RoID4gMCA/IHNwYWNlcy5yZXBsYWNlKC8uLywgJyAnKS5zbGljZShNYXRoLmZsb29yKHNwYWNlcy5sZW5ndGggLyAyKSkuc3BsaXQoJycpLmpvaW4obmJzcCkgOiAnJztcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIF0pO1xuICAgICAgdmFyIHZhbGlkRWxlbWVudHMgPSBnZXRXb3JkVmFsaWRFbGVtZW50cyhlZGl0b3IpO1xuICAgICAgdmFyIHNjaGVtYSA9IGdsb2JhbCRhKHtcbiAgICAgICAgdmFsaWRfZWxlbWVudHM6IHZhbGlkRWxlbWVudHMsXG4gICAgICAgIHZhbGlkX2NoaWxkcmVuOiAnLWxpW3BdJ1xuICAgICAgfSk7XG4gICAgICBnbG9iYWwkNS5lYWNoKHNjaGVtYS5lbGVtZW50cywgZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgICAgaWYgKCFydWxlLmF0dHJpYnV0ZXMuY2xhc3MpIHtcbiAgICAgICAgICBydWxlLmF0dHJpYnV0ZXMuY2xhc3MgPSB7fTtcbiAgICAgICAgICBydWxlLmF0dHJpYnV0ZXNPcmRlci5wdXNoKCdjbGFzcycpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcnVsZS5hdHRyaWJ1dGVzLnN0eWxlKSB7XG4gICAgICAgICAgcnVsZS5hdHRyaWJ1dGVzLnN0eWxlID0ge307XG4gICAgICAgICAgcnVsZS5hdHRyaWJ1dGVzT3JkZXIucHVzaCgnc3R5bGUnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgZG9tUGFyc2VyID0gZ2xvYmFsJDcoe30sIHNjaGVtYSk7XG4gICAgICBkb21QYXJzZXIuYWRkQXR0cmlidXRlRmlsdGVyKCdzdHlsZScsIGZ1bmN0aW9uIChub2Rlcykge1xuICAgICAgICB2YXIgaSA9IG5vZGVzLmxlbmd0aCwgbm9kZTtcbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgIG5vZGUgPSBub2Rlc1tpXTtcbiAgICAgICAgICBub2RlLmF0dHIoJ3N0eWxlJywgZmlsdGVyU3R5bGVzKGVkaXRvciwgdmFsaWRTdHlsZXMsIG5vZGUsIG5vZGUuYXR0cignc3R5bGUnKSkpO1xuICAgICAgICAgIGlmIChub2RlLm5hbWUgPT09ICdzcGFuJyAmJiBub2RlLnBhcmVudCAmJiAhbm9kZS5hdHRyaWJ1dGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgbm9kZS51bndyYXAoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZG9tUGFyc2VyLmFkZEF0dHJpYnV0ZUZpbHRlcignY2xhc3MnLCBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgdmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGUsIGNsYXNzTmFtZTtcbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgIG5vZGUgPSBub2Rlc1tpXTtcbiAgICAgICAgICBjbGFzc05hbWUgPSBub2RlLmF0dHIoJ2NsYXNzJyk7XG4gICAgICAgICAgaWYgKC9eKE1zb0NvbW1lbnRSZWZlcmVuY2V8TXNvQ29tbWVudFRleHR8bXNvRGVsKSQvaS50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgICAgIG5vZGUucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5vZGUuYXR0cignY2xhc3MnLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBkb21QYXJzZXIuYWRkTm9kZUZpbHRlcignZGVsJywgZnVuY3Rpb24gKG5vZGVzKSB7XG4gICAgICAgIHZhciBpID0gbm9kZXMubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgbm9kZXNbaV0ucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZG9tUGFyc2VyLmFkZE5vZGVGaWx0ZXIoJ2EnLCBmdW5jdGlvbiAobm9kZXMpIHtcbiAgICAgICAgdmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGUsIGhyZWYsIG5hbWU7XG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICBub2RlID0gbm9kZXNbaV07XG4gICAgICAgICAgaHJlZiA9IG5vZGUuYXR0cignaHJlZicpO1xuICAgICAgICAgIG5hbWUgPSBub2RlLmF0dHIoJ25hbWUnKTtcbiAgICAgICAgICBpZiAoaHJlZiAmJiBocmVmLmluZGV4T2YoJyNfbXNvY29tXycpICE9PSAtMSkge1xuICAgICAgICAgICAgbm9kZS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaHJlZiAmJiBocmVmLmluZGV4T2YoJ2ZpbGU6Ly8nKSA9PT0gMCkge1xuICAgICAgICAgICAgaHJlZiA9IGhyZWYuc3BsaXQoJyMnKVsxXTtcbiAgICAgICAgICAgIGlmIChocmVmKSB7XG4gICAgICAgICAgICAgIGhyZWYgPSAnIycgKyBocmVmO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWhyZWYgJiYgIW5hbWUpIHtcbiAgICAgICAgICAgIG5vZGUudW53cmFwKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChuYW1lICYmICEvXl8/KD86dG9jfGVkbnxmdG4pL2kudGVzdChuYW1lKSkge1xuICAgICAgICAgICAgICBub2RlLnVud3JhcCgpO1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGUuYXR0cih7XG4gICAgICAgICAgICAgIGhyZWY6IGhyZWYsXG4gICAgICAgICAgICAgIG5hbWU6IG5hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgcm9vdE5vZGUgPSBkb21QYXJzZXIucGFyc2UoY29udGVudCk7XG4gICAgICBpZiAoc2hvdWxkQ29udmVydFdvcmRGYWtlTGlzdHMoZWRpdG9yKSkge1xuICAgICAgICBjb252ZXJ0RmFrZUxpc3RzVG9Qcm9wZXJMaXN0cyhyb290Tm9kZSk7XG4gICAgICB9XG4gICAgICBjb250ZW50ID0gZ2xvYmFsJDgoeyB2YWxpZGF0ZTogZ2V0VmFsaWRhdGUoZWRpdG9yKSB9LCBzY2hlbWEpLnNlcmlhbGl6ZShyb290Tm9kZSk7XG4gICAgICByZXR1cm4gY29udGVudDtcbiAgICB9O1xuICAgIHZhciBwcmVQcm9jZXNzID0gZnVuY3Rpb24gKGVkaXRvciwgY29udGVudCkge1xuICAgICAgcmV0dXJuIHNob3VsZFVzZURlZmF1bHRGaWx0ZXJzKGVkaXRvcikgPyBmaWx0ZXJXb3JkQ29udGVudChlZGl0b3IsIGNvbnRlbnQpIDogY29udGVudDtcbiAgICB9O1xuXG4gICAgdmFyIHByZVByb2Nlc3MkMSA9IGZ1bmN0aW9uIChlZGl0b3IsIGh0bWwpIHtcbiAgICAgIHZhciBwYXJzZXIgPSBnbG9iYWwkNyh7fSwgZWRpdG9yLnNjaGVtYSk7XG4gICAgICBwYXJzZXIuYWRkTm9kZUZpbHRlcignbWV0YScsIGZ1bmN0aW9uIChub2Rlcykge1xuICAgICAgICBnbG9iYWwkNS5lYWNoKG5vZGVzLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIG5vZGUucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgZnJhZ21lbnQgPSBwYXJzZXIucGFyc2UoaHRtbCwge1xuICAgICAgICBmb3JjZWRfcm9vdF9ibG9jazogZmFsc2UsXG4gICAgICAgIGlzUm9vdENvbnRlbnQ6IHRydWVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGdsb2JhbCQ4KHsgdmFsaWRhdGU6IGdldFZhbGlkYXRlKGVkaXRvcikgfSwgZWRpdG9yLnNjaGVtYSkuc2VyaWFsaXplKGZyYWdtZW50KTtcbiAgICB9O1xuICAgIHZhciBwcm9jZXNzUmVzdWx0ID0gZnVuY3Rpb24gKGNvbnRlbnQsIGNhbmNlbGxlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udGVudDogY29udGVudCxcbiAgICAgICAgY2FuY2VsbGVkOiBjYW5jZWxsZWRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcG9zdFByb2Nlc3NGaWx0ZXIgPSBmdW5jdGlvbiAoZWRpdG9yLCBodG1sLCBpbnRlcm5hbCwgaXNXb3JkSHRtbCkge1xuICAgICAgdmFyIHRlbXBCb2R5ID0gZWRpdG9yLmRvbS5jcmVhdGUoJ2RpdicsIHsgc3R5bGU6ICdkaXNwbGF5Om5vbmUnIH0sIGh0bWwpO1xuICAgICAgdmFyIHBvc3RQcm9jZXNzQXJncyA9IGZpcmVQYXN0ZVBvc3RQcm9jZXNzKGVkaXRvciwgdGVtcEJvZHksIGludGVybmFsLCBpc1dvcmRIdG1sKTtcbiAgICAgIHJldHVybiBwcm9jZXNzUmVzdWx0KHBvc3RQcm9jZXNzQXJncy5ub2RlLmlubmVySFRNTCwgcG9zdFByb2Nlc3NBcmdzLmlzRGVmYXVsdFByZXZlbnRlZCgpKTtcbiAgICB9O1xuICAgIHZhciBmaWx0ZXJDb250ZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgY29udGVudCwgaW50ZXJuYWwsIGlzV29yZEh0bWwpIHtcbiAgICAgIHZhciBwcmVQcm9jZXNzQXJncyA9IGZpcmVQYXN0ZVByZVByb2Nlc3MoZWRpdG9yLCBjb250ZW50LCBpbnRlcm5hbCwgaXNXb3JkSHRtbCk7XG4gICAgICB2YXIgZmlsdGVyZWRDb250ZW50ID0gcHJlUHJvY2VzcyQxKGVkaXRvciwgcHJlUHJvY2Vzc0FyZ3MuY29udGVudCk7XG4gICAgICBpZiAoZWRpdG9yLmhhc0V2ZW50TGlzdGVuZXJzKCdQYXN0ZVBvc3RQcm9jZXNzJykgJiYgIXByZVByb2Nlc3NBcmdzLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgIHJldHVybiBwb3N0UHJvY2Vzc0ZpbHRlcihlZGl0b3IsIGZpbHRlcmVkQ29udGVudCwgaW50ZXJuYWwsIGlzV29yZEh0bWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NSZXN1bHQoZmlsdGVyZWRDb250ZW50LCBwcmVQcm9jZXNzQXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcHJvY2VzcyA9IGZ1bmN0aW9uIChlZGl0b3IsIGh0bWwsIGludGVybmFsKSB7XG4gICAgICB2YXIgaXNXb3JkSHRtbCA9IGlzV29yZENvbnRlbnQoaHRtbCk7XG4gICAgICB2YXIgY29udGVudCA9IGlzV29yZEh0bWwgPyBwcmVQcm9jZXNzKGVkaXRvciwgaHRtbCkgOiBodG1sO1xuICAgICAgcmV0dXJuIGZpbHRlckNvbnRlbnQoZWRpdG9yLCBjb250ZW50LCBpbnRlcm5hbCwgaXNXb3JkSHRtbCk7XG4gICAgfTtcblxuICAgIHZhciBwYXN0ZUh0bWwgPSBmdW5jdGlvbiAoZWRpdG9yLCBodG1sKSB7XG4gICAgICBlZGl0b3IuaW5zZXJ0Q29udGVudChodG1sLCB7XG4gICAgICAgIG1lcmdlOiBzaG91bGRNZXJnZUZvcm1hdHMoZWRpdG9yKSxcbiAgICAgICAgcGFzdGU6IHRydWVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICB2YXIgaXNBYnNvbHV0ZVVybCA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgIHJldHVybiAvXmh0dHBzPzpcXC9cXC9bXFx3XFw/XFwtXFwvKz0uJiVAfiNdKyQvaS50ZXN0KHVybCk7XG4gICAgfTtcbiAgICB2YXIgaXNJbWFnZVVybCA9IGZ1bmN0aW9uIChlZGl0b3IsIHVybCkge1xuICAgICAgcmV0dXJuIGlzQWJzb2x1dGVVcmwodXJsKSAmJiBleGlzdHMoZ2V0QWxsb3dlZEltYWdlRmlsZVR5cGVzKGVkaXRvciksIGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHJldHVybiBlbmRzV2l0aCh1cmwudG9Mb3dlckNhc2UoKSwgJy4nICsgdHlwZS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZUltYWdlID0gZnVuY3Rpb24gKGVkaXRvciwgdXJsLCBwYXN0ZUh0bWxGbikge1xuICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLmV4dHJhKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcGFzdGVIdG1sRm4oZWRpdG9yLCB1cmwpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3IuaW5zZXJ0Q29udGVudCgnPGltZyBzcmM9XCInICsgdXJsICsgJ1wiPicpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVMaW5rID0gZnVuY3Rpb24gKGVkaXRvciwgdXJsLCBwYXN0ZUh0bWxGbikge1xuICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLmV4dHJhKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcGFzdGVIdG1sRm4oZWRpdG9yLCB1cmwpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZUluc2VydExpbmsnLCBmYWxzZSwgdXJsKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICB2YXIgbGlua1NlbGVjdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IsIGh0bWwsIHBhc3RlSHRtbEZuKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLnNlbGVjdGlvbi5pc0NvbGxhcHNlZCgpID09PSBmYWxzZSAmJiBpc0Fic29sdXRlVXJsKGh0bWwpID8gY3JlYXRlTGluayhlZGl0b3IsIGh0bWwsIHBhc3RlSHRtbEZuKSA6IGZhbHNlO1xuICAgIH07XG4gICAgdmFyIGluc2VydEltYWdlID0gZnVuY3Rpb24gKGVkaXRvciwgaHRtbCwgcGFzdGVIdG1sRm4pIHtcbiAgICAgIHJldHVybiBpc0ltYWdlVXJsKGVkaXRvciwgaHRtbCkgPyBjcmVhdGVJbWFnZShlZGl0b3IsIGh0bWwsIHBhc3RlSHRtbEZuKSA6IGZhbHNlO1xuICAgIH07XG4gICAgdmFyIHNtYXJ0SW5zZXJ0Q29udGVudCA9IGZ1bmN0aW9uIChlZGl0b3IsIGh0bWwpIHtcbiAgICAgIGdsb2JhbCQ1LmVhY2goW1xuICAgICAgICBsaW5rU2VsZWN0aW9uLFxuICAgICAgICBpbnNlcnRJbWFnZSxcbiAgICAgICAgcGFzdGVIdG1sXG4gICAgICBdLCBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBhY3Rpb24oZWRpdG9yLCBodG1sLCBwYXN0ZUh0bWwpICE9PSB0cnVlO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0Q29udGVudCA9IGZ1bmN0aW9uIChlZGl0b3IsIGh0bWwsIHBhc3RlQXNUZXh0KSB7XG4gICAgICBpZiAocGFzdGVBc1RleHQgfHwgaXNTbWFydFBhc3RlRW5hYmxlZChlZGl0b3IpID09PSBmYWxzZSkge1xuICAgICAgICBwYXN0ZUh0bWwoZWRpdG9yLCBodG1sKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNtYXJ0SW5zZXJ0Q29udGVudChlZGl0b3IsIGh0bWwpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaXNDb2xsYXBzaWJsZVdoaXRlc3BhY2UgPSBmdW5jdGlvbiAoYykge1xuICAgICAgcmV0dXJuICcgXFxmXFx0XFx4MEInLmluZGV4T2YoYykgIT09IC0xO1xuICAgIH07XG4gICAgdmFyIGlzTmV3TGluZUNoYXIgPSBmdW5jdGlvbiAoYykge1xuICAgICAgcmV0dXJuIGMgPT09ICdcXG4nIHx8IGMgPT09ICdcXHInO1xuICAgIH07XG4gICAgdmFyIGlzTmV3bGluZSA9IGZ1bmN0aW9uICh0ZXh0LCBpZHgpIHtcbiAgICAgIHJldHVybiBpZHggPCB0ZXh0Lmxlbmd0aCAmJiBpZHggPj0gMCA/IGlzTmV3TGluZUNoYXIodGV4dFtpZHhdKSA6IGZhbHNlO1xuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZVdoaXRlc3BhY2UgPSBmdW5jdGlvbiAoZWRpdG9yLCB0ZXh0KSB7XG4gICAgICB2YXIgdGFiU3BhY2UgPSByZXBlYXQoJyAnLCBnZXRUYWJTcGFjZXMoZWRpdG9yKSk7XG4gICAgICB2YXIgbm9ybWFsaXplZFRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcdC9nLCB0YWJTcGFjZSk7XG4gICAgICB2YXIgcmVzdWx0ID0gZm9sZGwobm9ybWFsaXplZFRleHQsIGZ1bmN0aW9uIChhY2MsIGMpIHtcbiAgICAgICAgaWYgKGlzQ29sbGFwc2libGVXaGl0ZXNwYWNlKGMpIHx8IGMgPT09IG5ic3ApIHtcbiAgICAgICAgICBpZiAoYWNjLnBjSXNTcGFjZSB8fCBhY2Muc3RyID09PSAnJyB8fCBhY2Muc3RyLmxlbmd0aCA9PT0gbm9ybWFsaXplZFRleHQubGVuZ3RoIC0gMSB8fCBpc05ld2xpbmUobm9ybWFsaXplZFRleHQsIGFjYy5zdHIubGVuZ3RoICsgMSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBjSXNTcGFjZTogZmFsc2UsXG4gICAgICAgICAgICAgIHN0cjogYWNjLnN0ciArIG5ic3BcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHBjSXNTcGFjZTogdHJ1ZSxcbiAgICAgICAgICAgICAgc3RyOiBhY2Muc3RyICsgJyAnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGNJc1NwYWNlOiBpc05ld0xpbmVDaGFyKGMpLFxuICAgICAgICAgICAgc3RyOiBhY2Muc3RyICsgY1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAgcGNJc1NwYWNlOiBmYWxzZSxcbiAgICAgICAgc3RyOiAnJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0LnN0cjtcbiAgICB9O1xuXG4gICAgdmFyIGRvUGFzdGUgPSBmdW5jdGlvbiAoZWRpdG9yLCBjb250ZW50LCBpbnRlcm5hbCwgcGFzdGVBc1RleHQpIHtcbiAgICAgIHZhciBhcmdzID0gcHJvY2VzcyhlZGl0b3IsIGNvbnRlbnQsIGludGVybmFsKTtcbiAgICAgIGlmIChhcmdzLmNhbmNlbGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgaW5zZXJ0Q29udGVudChlZGl0b3IsIGFyZ3MuY29udGVudCwgcGFzdGVBc1RleHQpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHBhc3RlSHRtbCQxID0gZnVuY3Rpb24gKGVkaXRvciwgaHRtbCwgaW50ZXJuYWxGbGFnKSB7XG4gICAgICB2YXIgaW50ZXJuYWwgPSBpbnRlcm5hbEZsYWcgPyBpbnRlcm5hbEZsYWcgOiBpc01hcmtlZChodG1sKTtcbiAgICAgIGRvUGFzdGUoZWRpdG9yLCB1bm1hcmsoaHRtbCksIGludGVybmFsLCBmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgcGFzdGVUZXh0ID0gZnVuY3Rpb24gKGVkaXRvciwgdGV4dCkge1xuICAgICAgdmFyIGVuY29kZWRUZXh0ID0gZWRpdG9yLmRvbS5lbmNvZGUodGV4dCkucmVwbGFjZSgvXFxyXFxuL2csICdcXG4nKTtcbiAgICAgIHZhciBub3JtYWxpemVkVGV4dCA9IG5vcm1hbGl6ZVdoaXRlc3BhY2UoZWRpdG9yLCBlbmNvZGVkVGV4dCk7XG4gICAgICB2YXIgaHRtbCA9IGNvbnZlcnQobm9ybWFsaXplZFRleHQsIGdldEZvcmNlZFJvb3RCbG9jayhlZGl0b3IpLCBnZXRGb3JjZWRSb290QmxvY2tBdHRycyhlZGl0b3IpKTtcbiAgICAgIGRvUGFzdGUoZWRpdG9yLCBodG1sLCBmYWxzZSwgdHJ1ZSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGF0YVRyYW5zZmVySXRlbXMgPSBmdW5jdGlvbiAoZGF0YVRyYW5zZmVyKSB7XG4gICAgICB2YXIgaXRlbXMgPSB7fTtcbiAgICAgIHZhciBtY2VJbnRlcm5hbFVybFByZWZpeCA9ICdkYXRhOnRleHQvbWNlLWludGVybmFsLCc7XG4gICAgICBpZiAoZGF0YVRyYW5zZmVyKSB7XG4gICAgICAgIGlmIChkYXRhVHJhbnNmZXIuZ2V0RGF0YSkge1xuICAgICAgICAgIHZhciBsZWdhY3lUZXh0ID0gZGF0YVRyYW5zZmVyLmdldERhdGEoJ1RleHQnKTtcbiAgICAgICAgICBpZiAobGVnYWN5VGV4dCAmJiBsZWdhY3lUZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmIChsZWdhY3lUZXh0LmluZGV4T2YobWNlSW50ZXJuYWxVcmxQcmVmaXgpID09PSAtMSkge1xuICAgICAgICAgICAgICBpdGVtc1sndGV4dC9wbGFpbiddID0gbGVnYWN5VGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGFUcmFuc2Zlci50eXBlcykge1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YVRyYW5zZmVyLnR5cGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudFR5cGUgPSBkYXRhVHJhbnNmZXIudHlwZXNbaV07XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBpdGVtc1tjb250ZW50VHlwZV0gPSBkYXRhVHJhbnNmZXIuZ2V0RGF0YShjb250ZW50VHlwZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICBpdGVtc1tjb250ZW50VHlwZV0gPSAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBpdGVtcztcbiAgICB9O1xuICAgIHZhciBnZXRDbGlwYm9hcmRDb250ZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgY2xpcGJvYXJkRXZlbnQpIHtcbiAgICAgIHJldHVybiBnZXREYXRhVHJhbnNmZXJJdGVtcyhjbGlwYm9hcmRFdmVudC5jbGlwYm9hcmREYXRhIHx8IGVkaXRvci5nZXREb2MoKS5kYXRhVHJhbnNmZXIpO1xuICAgIH07XG4gICAgdmFyIGhhc0NvbnRlbnRUeXBlID0gZnVuY3Rpb24gKGNsaXBib2FyZENvbnRlbnQsIG1pbWVUeXBlKSB7XG4gICAgICByZXR1cm4gbWltZVR5cGUgaW4gY2xpcGJvYXJkQ29udGVudCAmJiBjbGlwYm9hcmRDb250ZW50W21pbWVUeXBlXS5sZW5ndGggPiAwO1xuICAgIH07XG4gICAgdmFyIGhhc0h0bWxPclRleHQgPSBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgcmV0dXJuIGhhc0NvbnRlbnRUeXBlKGNvbnRlbnQsICd0ZXh0L2h0bWwnKSB8fCBoYXNDb250ZW50VHlwZShjb250ZW50LCAndGV4dC9wbGFpbicpO1xuICAgIH07XG4gICAgdmFyIHBhcnNlRGF0YVVyaSA9IGZ1bmN0aW9uICh1cmkpIHtcbiAgICAgIHZhciBtYXRjaGVzID0gL2RhdGE6KFteO10rKTtiYXNlNjQsKFthLXowLTlcXCtcXC89XSspL2kuZXhlYyh1cmkpO1xuICAgICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBtYXRjaGVzWzFdLFxuICAgICAgICAgIGRhdGE6IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaGVzWzJdKVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBudWxsLFxuICAgICAgICAgIGRhdGE6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBpc1ZhbGlkRGF0YVVyaUltYWdlID0gZnVuY3Rpb24gKGVkaXRvciwgaW1nRWxtKSB7XG4gICAgICB2YXIgZmlsdGVyID0gZ2V0SW1hZ2VzRGF0YUltZ0ZpbHRlcihlZGl0b3IpO1xuICAgICAgcmV0dXJuIGZpbHRlciA/IGZpbHRlcihpbWdFbG0pIDogdHJ1ZTtcbiAgICB9O1xuICAgIHZhciBleHRyYWN0RmlsZW5hbWUgPSBmdW5jdGlvbiAoZWRpdG9yLCBzdHIpIHtcbiAgICAgIHZhciBtID0gc3RyLm1hdGNoKC8oW1xcc1xcU10rPykoPzpcXC5bYS16MC05Ll0rKSQvaSk7XG4gICAgICByZXR1cm4gaXNOb25OdWxsYWJsZShtKSA/IGVkaXRvci5kb20uZW5jb2RlKG1bMV0pIDogbnVsbDtcbiAgICB9O1xuICAgIHZhciB1bmlxdWVJZCA9IGNyZWF0ZUlkR2VuZXJhdG9yKCdtY2VjbGlwJyk7XG4gICAgdmFyIHBhc3RlSW1hZ2UgPSBmdW5jdGlvbiAoZWRpdG9yLCBpbWFnZUl0ZW0pIHtcbiAgICAgIHZhciBfYSA9IHBhcnNlRGF0YVVyaShpbWFnZUl0ZW0udXJpKSwgYmFzZTY0ID0gX2EuZGF0YSwgdHlwZSA9IF9hLnR5cGU7XG4gICAgICB2YXIgaWQgPSB1bmlxdWVJZCgpO1xuICAgICAgdmFyIGZpbGUgPSBpbWFnZUl0ZW0uYmxvYjtcbiAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGltZy5zcmMgPSBpbWFnZUl0ZW0udXJpO1xuICAgICAgaWYgKGlzVmFsaWREYXRhVXJpSW1hZ2UoZWRpdG9yLCBpbWcpKSB7XG4gICAgICAgIHZhciBibG9iQ2FjaGUgPSBlZGl0b3IuZWRpdG9yVXBsb2FkLmJsb2JDYWNoZTtcbiAgICAgICAgdmFyIGJsb2JJbmZvID0gdm9pZCAwO1xuICAgICAgICB2YXIgZXhpc3RpbmdCbG9iSW5mbyA9IGJsb2JDYWNoZS5nZXRCeURhdGEoYmFzZTY0LCB0eXBlKTtcbiAgICAgICAgaWYgKCFleGlzdGluZ0Jsb2JJbmZvKSB7XG4gICAgICAgICAgdmFyIHVzZUZpbGVOYW1lID0gZ2V0SW1hZ2VzUmV1c2VGaWxlbmFtZShlZGl0b3IpICYmIGlzTm9uTnVsbGFibGUoZmlsZS5uYW1lKTtcbiAgICAgICAgICB2YXIgbmFtZV8xID0gdXNlRmlsZU5hbWUgPyBleHRyYWN0RmlsZW5hbWUoZWRpdG9yLCBmaWxlLm5hbWUpIDogaWQ7XG4gICAgICAgICAgdmFyIGZpbGVuYW1lID0gdXNlRmlsZU5hbWUgPyBmaWxlLm5hbWUgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgYmxvYkluZm8gPSBibG9iQ2FjaGUuY3JlYXRlKGlkLCBmaWxlLCBiYXNlNjQsIG5hbWVfMSwgZmlsZW5hbWUpO1xuICAgICAgICAgIGJsb2JDYWNoZS5hZGQoYmxvYkluZm8pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJsb2JJbmZvID0gZXhpc3RpbmdCbG9iSW5mbztcbiAgICAgICAgfVxuICAgICAgICBwYXN0ZUh0bWwkMShlZGl0b3IsICc8aW1nIHNyYz1cIicgKyBibG9iSW5mby5ibG9iVXJpKCkgKyAnXCI+JywgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFzdGVIdG1sJDEoZWRpdG9yLCAnPGltZyBzcmM9XCInICsgaW1hZ2VJdGVtLnVyaSArICdcIj4nLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaXNDbGlwYm9hcmRFdmVudCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgcmV0dXJuIGV2ZW50LnR5cGUgPT09ICdwYXN0ZSc7XG4gICAgfTtcbiAgICB2YXIgaXNEYXRhVHJhbnNmZXJJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHJldHVybiBpc05vbk51bGxhYmxlKGl0ZW0uZ2V0QXNGaWxlKTtcbiAgICB9O1xuICAgIHZhciByZWFkRmlsZXNBc0RhdGFVcmlzID0gZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICByZXR1cm4gZ2xvYmFsJDMuYWxsKG1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBnbG9iYWwkMyhmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgICAgICAgIHZhciBibG9iID0gaXNEYXRhVHJhbnNmZXJJdGVtKGl0ZW0pID8gaXRlbS5nZXRBc0ZpbGUoKSA6IGl0ZW07XG4gICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyB3aW5kb3cuRmlsZVJlYWRlcigpO1xuICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgYmxvYjogYmxvYixcbiAgICAgICAgICAgICAgdXJpOiByZWFkZXIucmVzdWx0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGJsb2IpO1xuICAgICAgICB9KTtcbiAgICAgIH0pKTtcbiAgICB9O1xuICAgIHZhciBpc0ltYWdlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGFsbG93ZWRFeHRlbnNpb25zID0gZ2V0QWxsb3dlZEltYWdlRmlsZVR5cGVzKGVkaXRvcik7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIHN0YXJ0c1dpdGgoZmlsZS50eXBlLCAnaW1hZ2UvJykgJiYgZXhpc3RzKGFsbG93ZWRFeHRlbnNpb25zLCBmdW5jdGlvbiAoZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGdldEltYWdlTWltZVR5cGUoZXh0ZW5zaW9uKSA9PT0gZmlsZS50eXBlO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0SW1hZ2VzRnJvbURhdGFUcmFuc2ZlciA9IGZ1bmN0aW9uIChlZGl0b3IsIGRhdGFUcmFuc2Zlcikge1xuICAgICAgdmFyIGl0ZW1zID0gZGF0YVRyYW5zZmVyLml0ZW1zID8gbWFwKGZyb20kMShkYXRhVHJhbnNmZXIuaXRlbXMpLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gaXRlbS5nZXRBc0ZpbGUoKTtcbiAgICAgIH0pIDogW107XG4gICAgICB2YXIgZmlsZXMgPSBkYXRhVHJhbnNmZXIuZmlsZXMgPyBmcm9tJDEoZGF0YVRyYW5zZmVyLmZpbGVzKSA6IFtdO1xuICAgICAgcmV0dXJuIGZpbHRlcihpdGVtcy5sZW5ndGggPiAwID8gaXRlbXMgOiBmaWxlcywgaXNJbWFnZShlZGl0b3IpKTtcbiAgICB9O1xuICAgIHZhciBwYXN0ZUltYWdlRGF0YSA9IGZ1bmN0aW9uIChlZGl0b3IsIGUsIHJuZykge1xuICAgICAgdmFyIGRhdGFUcmFuc2ZlciA9IGlzQ2xpcGJvYXJkRXZlbnQoZSkgPyBlLmNsaXBib2FyZERhdGEgOiBlLmRhdGFUcmFuc2ZlcjtcbiAgICAgIGlmIChnZXRQYXN0ZURhdGFJbWFnZXMoZWRpdG9yKSAmJiBkYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgdmFyIGltYWdlcyA9IGdldEltYWdlc0Zyb21EYXRhVHJhbnNmZXIoZWRpdG9yLCBkYXRhVHJhbnNmZXIpO1xuICAgICAgICBpZiAoaW1hZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgcmVhZEZpbGVzQXNEYXRhVXJpcyhpbWFnZXMpLnRoZW4oZnVuY3Rpb24gKGZpbGVSZXN1bHRzKSB7XG4gICAgICAgICAgICBpZiAocm5nKSB7XG4gICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlYWNoKGZpbGVSZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgIHBhc3RlSW1hZ2UoZWRpdG9yLCByZXN1bHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBpc0Jyb2tlbkFuZHJvaWRDbGlwYm9hcmRFdmVudCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgY2xpcGJvYXJkRGF0YSA9IGUuY2xpcGJvYXJkRGF0YTtcbiAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FuZHJvaWQnKSAhPT0gLTEgJiYgY2xpcGJvYXJkRGF0YSAmJiBjbGlwYm9hcmREYXRhLml0ZW1zICYmIGNsaXBib2FyZERhdGEuaXRlbXMubGVuZ3RoID09PSAwO1xuICAgIH07XG4gICAgdmFyIGlzS2V5Ym9hcmRQYXN0ZUV2ZW50ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBnbG9iYWwkNC5tZXRhS2V5UHJlc3NlZChlKSAmJiBlLmtleUNvZGUgPT09IDg2IHx8IGUuc2hpZnRLZXkgJiYgZS5rZXlDb2RlID09PSA0NTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlckV2ZW50SGFuZGxlcnMgPSBmdW5jdGlvbiAoZWRpdG9yLCBwYXN0ZUJpbiwgcGFzdGVGb3JtYXQpIHtcbiAgICAgIHZhciBrZXlib2FyZFBhc3RlRXZlbnQgPSB2YWx1ZSgpO1xuICAgICAgdmFyIGtleWJvYXJkUGFzdGVQcmVzc2VkID0gdmFsdWUoKTtcbiAgICAgIHZhciBrZXlib2FyZFBhc3RlUGxhaW5UZXh0U3RhdGU7XG4gICAgICBlZGl0b3Iub24oJ2tleXVwJywga2V5Ym9hcmRQYXN0ZVByZXNzZWQuY2xlYXIpO1xuICAgICAgZWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHJlbW92ZVBhc3RlQmluT25LZXlVcCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgaWYgKGlzS2V5Ym9hcmRQYXN0ZUV2ZW50KGUpICYmICFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgICBwYXN0ZUJpbi5yZW1vdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChpc0tleWJvYXJkUGFzdGVFdmVudChlKSAmJiAhZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgIGtleWJvYXJkUGFzdGVQbGFpblRleHRTdGF0ZSA9IGUuc2hpZnRLZXkgJiYgZS5rZXlDb2RlID09PSA4NjtcbiAgICAgICAgICBpZiAoa2V5Ym9hcmRQYXN0ZVBsYWluVGV4dFN0YXRlICYmIGdsb2JhbCQxLndlYmtpdCAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1ZlcnNpb24vJykgIT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAga2V5Ym9hcmRQYXN0ZUV2ZW50LnNldChlKTtcbiAgICAgICAgICBrZXlib2FyZFBhc3RlUHJlc3NlZC5zZXQodHJ1ZSk7XG4gICAgICAgICAgaWYgKGdsb2JhbCQxLmllICYmIGtleWJvYXJkUGFzdGVQbGFpblRleHRTdGF0ZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZmlyZVBhc3RlKGVkaXRvciwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHBhc3RlQmluLnJlbW92ZSgpO1xuICAgICAgICAgIHBhc3RlQmluLmNyZWF0ZSgpO1xuICAgICAgICAgIGVkaXRvci5vbmNlKCdrZXl1cCcsIHJlbW92ZVBhc3RlQmluT25LZXlVcCk7XG4gICAgICAgICAgZWRpdG9yLm9uY2UoJ3Bhc3RlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZWRpdG9yLm9mZigna2V5dXAnLCByZW1vdmVQYXN0ZUJpbk9uS2V5VXApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBpbnNlcnRDbGlwYm9hcmRDb250ZW50ID0gZnVuY3Rpb24gKGVkaXRvciwgY2xpcGJvYXJkQ29udGVudCwgaXNLZXlCb2FyZFBhc3RlLCBwbGFpblRleHRNb2RlLCBpbnRlcm5hbCkge1xuICAgICAgICB2YXIgY29udGVudDtcbiAgICAgICAgaWYgKGhhc0NvbnRlbnRUeXBlKGNsaXBib2FyZENvbnRlbnQsICd0ZXh0L2h0bWwnKSkge1xuICAgICAgICAgIGNvbnRlbnQgPSBjbGlwYm9hcmRDb250ZW50Wyd0ZXh0L2h0bWwnXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb250ZW50ID0gcGFzdGVCaW4uZ2V0SHRtbCgpO1xuICAgICAgICAgIGludGVybmFsID0gaW50ZXJuYWwgPyBpbnRlcm5hbCA6IGlzTWFya2VkKGNvbnRlbnQpO1xuICAgICAgICAgIGlmIChwYXN0ZUJpbi5pc0RlZmF1bHRDb250ZW50KGNvbnRlbnQpKSB7XG4gICAgICAgICAgICBwbGFpblRleHRNb2RlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29udGVudCA9IHRyaW1IdG1sKGNvbnRlbnQpO1xuICAgICAgICBwYXN0ZUJpbi5yZW1vdmUoKTtcbiAgICAgICAgdmFyIGlzUGxhaW5UZXh0SHRtbCA9IGludGVybmFsID09PSBmYWxzZSAmJiBpc1BsYWluVGV4dChjb250ZW50KTtcbiAgICAgICAgdmFyIGlzQWJzb2x1dGVVcmwkMSA9IGlzQWJzb2x1dGVVcmwoY29udGVudCk7XG4gICAgICAgIGlmICghY29udGVudC5sZW5ndGggfHwgaXNQbGFpblRleHRIdG1sICYmICFpc0Fic29sdXRlVXJsJDEpIHtcbiAgICAgICAgICBwbGFpblRleHRNb2RlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGxhaW5UZXh0TW9kZSB8fCBpc0Fic29sdXRlVXJsJDEpIHtcbiAgICAgICAgICBpZiAoaGFzQ29udGVudFR5cGUoY2xpcGJvYXJkQ29udGVudCwgJ3RleHQvcGxhaW4nKSAmJiBpc1BsYWluVGV4dEh0bWwpIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSBjbGlwYm9hcmRDb250ZW50Wyd0ZXh0L3BsYWluJ107XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRlbnQgPSBpbm5lclRleHQoY29udGVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYXN0ZUJpbi5pc0RlZmF1bHRDb250ZW50KGNvbnRlbnQpKSB7XG4gICAgICAgICAgaWYgKCFpc0tleUJvYXJkUGFzdGUpIHtcbiAgICAgICAgICAgIGVkaXRvci53aW5kb3dNYW5hZ2VyLmFsZXJ0KCdQbGVhc2UgdXNlIEN0cmwrVi9DbWQrViBrZXlib2FyZCBzaG9ydGN1dHMgdG8gcGFzdGUgY29udGVudHMuJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGxhaW5UZXh0TW9kZSkge1xuICAgICAgICAgIHBhc3RlVGV4dChlZGl0b3IsIGNvbnRlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhc3RlSHRtbCQxKGVkaXRvciwgY29udGVudCwgaW50ZXJuYWwpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGdldExhc3RSbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBwYXN0ZUJpbi5nZXRMYXN0Um5nKCkgfHwgZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKTtcbiAgICAgIH07XG4gICAgICBlZGl0b3Iub24oJ3Bhc3RlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGlzS2V5Ym9hcmRQYXN0ZSA9IGtleWJvYXJkUGFzdGVFdmVudC5pc1NldCgpIHx8IGtleWJvYXJkUGFzdGVQcmVzc2VkLmlzU2V0KCk7XG4gICAgICAgIGlmIChpc0tleWJvYXJkUGFzdGUpIHtcbiAgICAgICAgICBrZXlib2FyZFBhc3RlRXZlbnQuY2xlYXIoKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2xpcGJvYXJkQ29udGVudCA9IGdldENsaXBib2FyZENvbnRlbnQoZWRpdG9yLCBlKTtcbiAgICAgICAgdmFyIHBsYWluVGV4dE1vZGUgPSBwYXN0ZUZvcm1hdC5nZXQoKSA9PT0gJ3RleHQnIHx8IGtleWJvYXJkUGFzdGVQbGFpblRleHRTdGF0ZTtcbiAgICAgICAgdmFyIGludGVybmFsID0gaGFzQ29udGVudFR5cGUoY2xpcGJvYXJkQ29udGVudCwgaW50ZXJuYWxIdG1sTWltZSgpKTtcbiAgICAgICAga2V5Ym9hcmRQYXN0ZVBsYWluVGV4dFN0YXRlID0gZmFsc2U7XG4gICAgICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGlzQnJva2VuQW5kcm9pZENsaXBib2FyZEV2ZW50KGUpKSB7XG4gICAgICAgICAgcGFzdGVCaW4ucmVtb3ZlKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaGFzSHRtbE9yVGV4dChjbGlwYm9hcmRDb250ZW50KSAmJiBwYXN0ZUltYWdlRGF0YShlZGl0b3IsIGUsIGdldExhc3RSbmcoKSkpIHtcbiAgICAgICAgICBwYXN0ZUJpbi5yZW1vdmUoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc0tleWJvYXJkUGFzdGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGdsb2JhbCQxLmllICYmICghaXNLZXlib2FyZFBhc3RlIHx8IGUuaWVGYWtlKSAmJiAhaGFzQ29udGVudFR5cGUoY2xpcGJvYXJkQ29udGVudCwgJ3RleHQvaHRtbCcpKSB7XG4gICAgICAgICAgcGFzdGVCaW4uY3JlYXRlKCk7XG4gICAgICAgICAgZWRpdG9yLmRvbS5iaW5kKHBhc3RlQmluLmdldEVsKCksICdwYXN0ZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGVkaXRvci5nZXREb2MoKS5leGVjQ29tbWFuZCgnUGFzdGUnLCBmYWxzZSwgbnVsbCk7XG4gICAgICAgICAgY2xpcGJvYXJkQ29udGVudFsndGV4dC9odG1sJ10gPSBwYXN0ZUJpbi5nZXRIdG1sKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc0NvbnRlbnRUeXBlKGNsaXBib2FyZENvbnRlbnQsICd0ZXh0L2h0bWwnKSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpZiAoIWludGVybmFsKSB7XG4gICAgICAgICAgICBpbnRlcm5hbCA9IGlzTWFya2VkKGNsaXBib2FyZENvbnRlbnRbJ3RleHQvaHRtbCddKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW5zZXJ0Q2xpcGJvYXJkQ29udGVudChlZGl0b3IsIGNsaXBib2FyZENvbnRlbnQsIGlzS2V5Ym9hcmRQYXN0ZSwgcGxhaW5UZXh0TW9kZSwgaW50ZXJuYWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdsb2JhbCQyLnNldEVkaXRvclRpbWVvdXQoZWRpdG9yLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbnNlcnRDbGlwYm9hcmRDb250ZW50KGVkaXRvciwgY2xpcGJvYXJkQ29udGVudCwgaXNLZXlib2FyZFBhc3RlLCBwbGFpblRleHRNb2RlLCBpbnRlcm5hbCk7XG4gICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyRXZlbnRzQW5kRmlsdGVycyA9IGZ1bmN0aW9uIChlZGl0b3IsIHBhc3RlQmluLCBwYXN0ZUZvcm1hdCkge1xuICAgICAgcmVnaXN0ZXJFdmVudEhhbmRsZXJzKGVkaXRvciwgcGFzdGVCaW4sIHBhc3RlRm9ybWF0KTtcbiAgICAgIHZhciBzcmM7XG4gICAgICBlZGl0b3IucGFyc2VyLmFkZE5vZGVGaWx0ZXIoJ2ltZycsIGZ1bmN0aW9uIChub2RlcywgbmFtZSwgYXJncykge1xuICAgICAgICB2YXIgaXNQYXN0ZUluc2VydCA9IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgcmV0dXJuIGFyZ3MuZGF0YSAmJiBhcmdzLmRhdGEucGFzdGUgPT09IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZhciByZW1vdmUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgIGlmICghbm9kZS5hdHRyKCdkYXRhLW1jZS1vYmplY3QnKSAmJiBzcmMgIT09IGdsb2JhbCQxLnRyYW5zcGFyZW50U3JjKSB7XG4gICAgICAgICAgICBub2RlLnJlbW92ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGlzV2ViS2l0RmFrZVVybCA9IGZ1bmN0aW9uIChzcmMpIHtcbiAgICAgICAgICByZXR1cm4gc3JjLmluZGV4T2YoJ3dlYmtpdC1mYWtlLXVybCcpID09PSAwO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgaXNEYXRhVXJpID0gZnVuY3Rpb24gKHNyYykge1xuICAgICAgICAgIHJldHVybiBzcmMuaW5kZXhPZignZGF0YTonKSA9PT0gMDtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCFnZXRQYXN0ZURhdGFJbWFnZXMoZWRpdG9yKSAmJiBpc1Bhc3RlSW5zZXJ0KGFyZ3MpKSB7XG4gICAgICAgICAgdmFyIGkgPSBub2Rlcy5sZW5ndGg7XG4gICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgc3JjID0gbm9kZXNbaV0uYXR0cignc3JjJyk7XG4gICAgICAgICAgICBpZiAoIXNyYykge1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1dlYktpdEZha2VVcmwoc3JjKSkge1xuICAgICAgICAgICAgICByZW1vdmUobm9kZXNbaV0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghZ2V0QWxsb3dIdG1sRGF0YVVybHMoZWRpdG9yKSAmJiBpc0RhdGFVcmkoc3JjKSkge1xuICAgICAgICAgICAgICByZW1vdmUobm9kZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnZXRQYXN0ZUJpblBhcmVudCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnbG9iYWwkMS5pZSAmJiBlZGl0b3IuaW5saW5lID8gZG9jdW1lbnQuYm9keSA6IGVkaXRvci5nZXRCb2R5KCk7XG4gICAgfTtcbiAgICB2YXIgaXNFeHRlcm5hbFBhc3RlQmluID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGdldFBhc3RlQmluUGFyZW50KGVkaXRvcikgIT09IGVkaXRvci5nZXRCb2R5KCk7XG4gICAgfTtcbiAgICB2YXIgZGVsZWdhdGVQYXN0ZUV2ZW50cyA9IGZ1bmN0aW9uIChlZGl0b3IsIHBhc3RlQmluRWxtLCBwYXN0ZUJpbkRlZmF1bHRDb250ZW50KSB7XG4gICAgICBpZiAoaXNFeHRlcm5hbFBhc3RlQmluKGVkaXRvcikpIHtcbiAgICAgICAgZWRpdG9yLmRvbS5iaW5kKHBhc3RlQmluRWxtLCAncGFzdGUga2V5dXAnLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgICBpZiAoIWlzRGVmYXVsdChlZGl0b3IsIHBhc3RlQmluRGVmYXVsdENvbnRlbnQpKSB7XG4gICAgICAgICAgICBlZGl0b3IuZmlyZSgncGFzdGUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGNyZWF0ZSA9IGZ1bmN0aW9uIChlZGl0b3IsIGxhc3RSbmdDZWxsLCBwYXN0ZUJpbkRlZmF1bHRDb250ZW50KSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbSwgYm9keSA9IGVkaXRvci5nZXRCb2R5KCk7XG4gICAgICBsYXN0Um5nQ2VsbC5zZXQoZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKSk7XG4gICAgICB2YXIgcGFzdGVCaW5FbG0gPSBlZGl0b3IuZG9tLmFkZChnZXRQYXN0ZUJpblBhcmVudChlZGl0b3IpLCAnZGl2Jywge1xuICAgICAgICAnaWQnOiAnbWNlcGFzdGViaW4nLFxuICAgICAgICAnY2xhc3MnOiAnbWNlLXBhc3RlYmluJyxcbiAgICAgICAgJ2NvbnRlbnRFZGl0YWJsZSc6IHRydWUsXG4gICAgICAgICdkYXRhLW1jZS1ib2d1cyc6ICdhbGwnLFxuICAgICAgICAnc3R5bGUnOiAncG9zaXRpb246IGZpeGVkOyB0b3A6IDUwJTsgd2lkdGg6IDEwcHg7IGhlaWdodDogMTBweDsgb3ZlcmZsb3c6IGhpZGRlbjsgb3BhY2l0eTogMCdcbiAgICAgIH0sIHBhc3RlQmluRGVmYXVsdENvbnRlbnQpO1xuICAgICAgaWYgKGdsb2JhbCQxLmllIHx8IGdsb2JhbCQxLmdlY2tvKSB7XG4gICAgICAgIGRvbS5zZXRTdHlsZShwYXN0ZUJpbkVsbSwgJ2xlZnQnLCBkb20uZ2V0U3R5bGUoYm9keSwgJ2RpcmVjdGlvbicsIHRydWUpID09PSAncnRsJyA/IDY1NTM1IDogLTY1NTM1KTtcbiAgICAgIH1cbiAgICAgIGRvbS5iaW5kKHBhc3RlQmluRWxtLCAnYmVmb3JlZGVhY3RpdmF0ZSBmb2N1c2luIGZvY3Vzb3V0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH0pO1xuICAgICAgZGVsZWdhdGVQYXN0ZUV2ZW50cyhlZGl0b3IsIHBhc3RlQmluRWxtLCBwYXN0ZUJpbkRlZmF1bHRDb250ZW50KTtcbiAgICAgIHBhc3RlQmluRWxtLmZvY3VzKCk7XG4gICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNlbGVjdChwYXN0ZUJpbkVsbSwgdHJ1ZSk7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlID0gZnVuY3Rpb24gKGVkaXRvciwgbGFzdFJuZ0NlbGwpIHtcbiAgICAgIGlmIChnZXRFbChlZGl0b3IpKSB7XG4gICAgICAgIHZhciBwYXN0ZUJpbkNsb25lID0gdm9pZCAwO1xuICAgICAgICB2YXIgbGFzdFJuZyA9IGxhc3RSbmdDZWxsLmdldCgpO1xuICAgICAgICB3aGlsZSAocGFzdGVCaW5DbG9uZSA9IGVkaXRvci5kb20uZ2V0KCdtY2VwYXN0ZWJpbicpKSB7XG4gICAgICAgICAgZWRpdG9yLmRvbS5yZW1vdmUocGFzdGVCaW5DbG9uZSk7XG4gICAgICAgICAgZWRpdG9yLmRvbS51bmJpbmQocGFzdGVCaW5DbG9uZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhc3RSbmcpIHtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhsYXN0Um5nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGFzdFJuZ0NlbGwuc2V0KG51bGwpO1xuICAgIH07XG4gICAgdmFyIGdldEVsID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5kb20uZ2V0KCdtY2VwYXN0ZWJpbicpO1xuICAgIH07XG4gICAgdmFyIGdldEh0bWwgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgY29weUFuZFJlbW92ZSA9IGZ1bmN0aW9uICh0b0VsbSwgZnJvbUVsbSkge1xuICAgICAgICB0b0VsbS5hcHBlbmRDaGlsZChmcm9tRWxtKTtcbiAgICAgICAgZWRpdG9yLmRvbS5yZW1vdmUoZnJvbUVsbSwgdHJ1ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHBhc3RlQmluQ2xvbmVzID0gZ2xvYmFsJDUuZ3JlcChnZXRQYXN0ZUJpblBhcmVudChlZGl0b3IpLmNoaWxkTm9kZXMsIGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgICAgcmV0dXJuIGVsbS5pZCA9PT0gJ21jZXBhc3RlYmluJztcbiAgICAgIH0pO1xuICAgICAgdmFyIHBhc3RlQmluRWxtID0gcGFzdGVCaW5DbG9uZXMuc2hpZnQoKTtcbiAgICAgIGdsb2JhbCQ1LmVhY2gocGFzdGVCaW5DbG9uZXMsIGZ1bmN0aW9uIChwYXN0ZUJpbkNsb25lKSB7XG4gICAgICAgIGNvcHlBbmRSZW1vdmUocGFzdGVCaW5FbG0sIHBhc3RlQmluQ2xvbmUpO1xuICAgICAgfSk7XG4gICAgICB2YXIgZGlydHlXcmFwcGVycyA9IGVkaXRvci5kb20uc2VsZWN0KCdkaXZbaWQ9bWNlcGFzdGViaW5dJywgcGFzdGVCaW5FbG0pO1xuICAgICAgZm9yICh2YXIgaSA9IGRpcnR5V3JhcHBlcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIGNsZWFuV3JhcHBlciA9IGVkaXRvci5kb20uY3JlYXRlKCdkaXYnKTtcbiAgICAgICAgcGFzdGVCaW5FbG0uaW5zZXJ0QmVmb3JlKGNsZWFuV3JhcHBlciwgZGlydHlXcmFwcGVyc1tpXSk7XG4gICAgICAgIGNvcHlBbmRSZW1vdmUoY2xlYW5XcmFwcGVyLCBkaXJ0eVdyYXBwZXJzW2ldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXN0ZUJpbkVsbSA/IHBhc3RlQmluRWxtLmlubmVySFRNTCA6ICcnO1xuICAgIH07XG4gICAgdmFyIGdldExhc3RSbmcgPSBmdW5jdGlvbiAobGFzdFJuZykge1xuICAgICAgcmV0dXJuIGxhc3RSbmcuZ2V0KCk7XG4gICAgfTtcbiAgICB2YXIgaXNEZWZhdWx0Q29udGVudCA9IGZ1bmN0aW9uIChwYXN0ZUJpbkRlZmF1bHRDb250ZW50LCBjb250ZW50KSB7XG4gICAgICByZXR1cm4gY29udGVudCA9PT0gcGFzdGVCaW5EZWZhdWx0Q29udGVudDtcbiAgICB9O1xuICAgIHZhciBpc1Bhc3RlQmluID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGVsbSAmJiBlbG0uaWQgPT09ICdtY2VwYXN0ZWJpbic7XG4gICAgfTtcbiAgICB2YXIgaXNEZWZhdWx0ID0gZnVuY3Rpb24gKGVkaXRvciwgcGFzdGVCaW5EZWZhdWx0Q29udGVudCkge1xuICAgICAgdmFyIHBhc3RlQmluRWxtID0gZ2V0RWwoZWRpdG9yKTtcbiAgICAgIHJldHVybiBpc1Bhc3RlQmluKHBhc3RlQmluRWxtKSAmJiBpc0RlZmF1bHRDb250ZW50KHBhc3RlQmluRGVmYXVsdENvbnRlbnQsIHBhc3RlQmluRWxtLmlubmVySFRNTCk7XG4gICAgfTtcbiAgICB2YXIgUGFzdGVCaW4gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgbGFzdFJuZyA9IENlbGwobnVsbCk7XG4gICAgICB2YXIgcGFzdGVCaW5EZWZhdWx0Q29udGVudCA9ICclTUNFUEFTVEVCSU4lJztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjcmVhdGUoZWRpdG9yLCBsYXN0Um5nLCBwYXN0ZUJpbkRlZmF1bHRDb250ZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHJlbW92ZShlZGl0b3IsIGxhc3RSbmcpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRFbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXRFbChlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRIdG1sOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGdldEh0bWwoZWRpdG9yKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0TGFzdFJuZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXRMYXN0Um5nKGxhc3RSbmcpO1xuICAgICAgICB9LFxuICAgICAgICBpc0RlZmF1bHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gaXNEZWZhdWx0KGVkaXRvciwgcGFzdGVCaW5EZWZhdWx0Q29udGVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIGlzRGVmYXVsdENvbnRlbnQ6IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGlzRGVmYXVsdENvbnRlbnQocGFzdGVCaW5EZWZhdWx0Q29udGVudCwgY29udGVudCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBDbGlwYm9hcmQgPSBmdW5jdGlvbiAoZWRpdG9yLCBwYXN0ZUZvcm1hdCkge1xuICAgICAgdmFyIHBhc3RlQmluID0gUGFzdGVCaW4oZWRpdG9yKTtcbiAgICAgIGVkaXRvci5vbignUHJlSW5pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJlZ2lzdGVyRXZlbnRzQW5kRmlsdGVycyhlZGl0b3IsIHBhc3RlQmluLCBwYXN0ZUZvcm1hdCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhc3RlRm9ybWF0OiBwYXN0ZUZvcm1hdCxcbiAgICAgICAgcGFzdGVIdG1sOiBmdW5jdGlvbiAoaHRtbCwgaW50ZXJuYWxGbGFnKSB7XG4gICAgICAgICAgcmV0dXJuIHBhc3RlSHRtbCQxKGVkaXRvciwgaHRtbCwgaW50ZXJuYWxGbGFnKTtcbiAgICAgICAgfSxcbiAgICAgICAgcGFzdGVUZXh0OiBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICAgIHJldHVybiBwYXN0ZVRleHQoZWRpdG9yLCB0ZXh0KTtcbiAgICAgICAgfSxcbiAgICAgICAgcGFzdGVJbWFnZURhdGE6IGZ1bmN0aW9uIChlLCBybmcpIHtcbiAgICAgICAgICByZXR1cm4gcGFzdGVJbWFnZURhdGEoZWRpdG9yLCBlLCBybmcpO1xuICAgICAgICB9LFxuICAgICAgICBnZXREYXRhVHJhbnNmZXJJdGVtczogZ2V0RGF0YVRyYW5zZmVySXRlbXMsXG4gICAgICAgIGhhc0h0bWxPclRleHQ6IGhhc0h0bWxPclRleHQsXG4gICAgICAgIGhhc0NvbnRlbnRUeXBlOiBoYXNDb250ZW50VHlwZVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHRvZ2dsZVBsYWluVGV4dFBhc3RlID0gZnVuY3Rpb24gKGVkaXRvciwgY2xpcGJvYXJkKSB7XG4gICAgICBpZiAoY2xpcGJvYXJkLnBhc3RlRm9ybWF0LmdldCgpID09PSAndGV4dCcpIHtcbiAgICAgICAgY2xpcGJvYXJkLnBhc3RlRm9ybWF0LnNldCgnaHRtbCcpO1xuICAgICAgICBmaXJlUGFzdGVQbGFpblRleHRUb2dnbGUoZWRpdG9yLCBmYWxzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjbGlwYm9hcmQucGFzdGVGb3JtYXQuc2V0KCd0ZXh0Jyk7XG4gICAgICAgIGZpcmVQYXN0ZVBsYWluVGV4dFRvZ2dsZShlZGl0b3IsIHRydWUpO1xuICAgICAgfVxuICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgfTtcblxuICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIChlZGl0b3IsIGNsaXBib2FyZCkge1xuICAgICAgZWRpdG9yLmFkZENvbW1hbmQoJ21jZVRvZ2dsZVBsYWluVGV4dFBhc3RlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB0b2dnbGVQbGFpblRleHRQYXN0ZShlZGl0b3IsIGNsaXBib2FyZCk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VJbnNlcnRDbGlwYm9hcmRDb250ZW50JywgZnVuY3Rpb24gKHVpLCB2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUuY29udGVudCkge1xuICAgICAgICAgIGNsaXBib2FyZC5wYXN0ZUh0bWwodmFsdWUuY29udGVudCwgdmFsdWUuaW50ZXJuYWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZS50ZXh0KSB7XG4gICAgICAgICAgY2xpcGJvYXJkLnBhc3RlVGV4dCh2YWx1ZS50ZXh0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBoYXNXb3JraW5nQ2xpcGJvYXJkQXBpID0gZnVuY3Rpb24gKGNsaXBib2FyZERhdGEpIHtcbiAgICAgIHJldHVybiBnbG9iYWwkMS5pT1MgPT09IGZhbHNlICYmIHR5cGVvZiAoY2xpcGJvYXJkRGF0YSA9PT0gbnVsbCB8fCBjbGlwYm9hcmREYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbGlwYm9hcmREYXRhLnNldERhdGEpID09PSAnZnVuY3Rpb24nO1xuICAgIH07XG4gICAgdmFyIHNldEh0bWw1Q2xpcGJvYXJkID0gZnVuY3Rpb24gKGNsaXBib2FyZERhdGEsIGh0bWwsIHRleHQpIHtcbiAgICAgIGlmIChoYXNXb3JraW5nQ2xpcGJvYXJkQXBpKGNsaXBib2FyZERhdGEpKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY2xpcGJvYXJkRGF0YS5jbGVhckRhdGEoKTtcbiAgICAgICAgICBjbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvaHRtbCcsIGh0bWwpO1xuICAgICAgICAgIGNsaXBib2FyZERhdGEuc2V0RGF0YSgndGV4dC9wbGFpbicsIHRleHQpO1xuICAgICAgICAgIGNsaXBib2FyZERhdGEuc2V0RGF0YShpbnRlcm5hbEh0bWxNaW1lKCksIGh0bWwpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0Q2xpcGJvYXJkRGF0YSA9IGZ1bmN0aW9uIChldnQsIGRhdGEsIGZhbGxiYWNrLCBkb25lKSB7XG4gICAgICBpZiAoc2V0SHRtbDVDbGlwYm9hcmQoZXZ0LmNsaXBib2FyZERhdGEsIGRhdGEuaHRtbCwgZGF0YS50ZXh0KSkge1xuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmFsbGJhY2soZGF0YS5odG1sLCBkb25lKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBmYWxsYmFjayA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaHRtbCwgZG9uZSkge1xuICAgICAgICB2YXIgbWFya2VkSHRtbCA9IG1hcmsoaHRtbCk7XG4gICAgICAgIHZhciBvdXRlciA9IGVkaXRvci5kb20uY3JlYXRlKCdkaXYnLCB7XG4gICAgICAgICAgJ2NvbnRlbnRlZGl0YWJsZSc6ICdmYWxzZScsXG4gICAgICAgICAgJ2RhdGEtbWNlLWJvZ3VzJzogJ2FsbCdcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBpbm5lciA9IGVkaXRvci5kb20uY3JlYXRlKCdkaXYnLCB7IGNvbnRlbnRlZGl0YWJsZTogJ3RydWUnIH0sIG1hcmtlZEh0bWwpO1xuICAgICAgICBlZGl0b3IuZG9tLnNldFN0eWxlcyhvdXRlciwge1xuICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgIHRvcDogJzAnLFxuICAgICAgICAgIGxlZnQ6ICctMzAwMHB4JyxcbiAgICAgICAgICB3aWR0aDogJzEwMDBweCcsXG4gICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nXG4gICAgICAgIH0pO1xuICAgICAgICBvdXRlci5hcHBlbmRDaGlsZChpbm5lcik7XG4gICAgICAgIGVkaXRvci5kb20uYWRkKGVkaXRvci5nZXRCb2R5KCksIG91dGVyKTtcbiAgICAgICAgdmFyIHJhbmdlID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRSbmcoKTtcbiAgICAgICAgaW5uZXIuZm9jdXMoKTtcbiAgICAgICAgdmFyIG9mZnNjcmVlblJhbmdlID0gZWRpdG9yLmRvbS5jcmVhdGVSbmcoKTtcbiAgICAgICAgb2Zmc2NyZWVuUmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGlubmVyKTtcbiAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcob2Zmc2NyZWVuUmFuZ2UpO1xuICAgICAgICBnbG9iYWwkMi5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhyYW5nZSk7XG4gICAgICAgICAgb3V0ZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvdXRlcik7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LCAwKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0RGF0YSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGh0bWw6IGVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCh7IGNvbnRleHR1YWw6IHRydWUgfSksXG4gICAgICAgIHRleHQ6IGVkaXRvci5zZWxlY3Rpb24uZ2V0Q29udGVudCh7IGZvcm1hdDogJ3RleHQnIH0pXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzVGFibGVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gISFlZGl0b3IuZG9tLmdldFBhcmVudChlZGl0b3Iuc2VsZWN0aW9uLmdldFN0YXJ0KCksICd0ZFtkYXRhLW1jZS1zZWxlY3RlZF0sdGhbZGF0YS1tY2Utc2VsZWN0ZWRdJywgZWRpdG9yLmdldEJvZHkoKSk7XG4gICAgfTtcbiAgICB2YXIgaGFzU2VsZWN0ZWRDb250ZW50ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuICFlZGl0b3Iuc2VsZWN0aW9uLmlzQ29sbGFwc2VkKCkgfHwgaXNUYWJsZVNlbGVjdGlvbihlZGl0b3IpO1xuICAgIH07XG4gICAgdmFyIGN1dCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgIGlmIChoYXNTZWxlY3RlZENvbnRlbnQoZWRpdG9yKSkge1xuICAgICAgICAgIHNldENsaXBib2FyZERhdGEoZXZ0LCBnZXREYXRhKGVkaXRvciksIGZhbGxiYWNrKGVkaXRvciksIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChnbG9iYWwkMS5icm93c2VyLmlzQ2hyb21lKCkgfHwgZ2xvYmFsJDEuYnJvd3Nlci5pc0ZpcmVmb3goKSkge1xuICAgICAgICAgICAgICB2YXIgcm5nXzEgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuICAgICAgICAgICAgICBnbG9iYWwkMi5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJuZ18xKTtcbiAgICAgICAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ0RlbGV0ZScpO1xuICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVkaXRvci5leGVjQ29tbWFuZCgnRGVsZXRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29weSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgIGlmIChoYXNTZWxlY3RlZENvbnRlbnQoZWRpdG9yKSkge1xuICAgICAgICAgIHNldENsaXBib2FyZERhdGEoZXZ0LCBnZXREYXRhKGVkaXRvciksIGZhbGxiYWNrKGVkaXRvciksIG5vb3ApO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyJDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3Iub24oJ2N1dCcsIGN1dChlZGl0b3IpKTtcbiAgICAgIGVkaXRvci5vbignY29weScsIGNvcHkoZWRpdG9yKSk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkYiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLmRvbS5SYW5nZVV0aWxzJyk7XG5cbiAgICB2YXIgZ2V0Q2FyZXRSYW5nZUZyb21FdmVudCA9IGZ1bmN0aW9uIChlZGl0b3IsIGUpIHtcbiAgICAgIHJldHVybiBnbG9iYWwkYi5nZXRDYXJldFJhbmdlRnJvbVBvaW50KGUuY2xpZW50WCwgZS5jbGllbnRZLCBlZGl0b3IuZ2V0RG9jKCkpO1xuICAgIH07XG4gICAgdmFyIGlzUGxhaW5UZXh0RmlsZVVybCA9IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICB2YXIgcGxhaW5UZXh0Q29udGVudCA9IGNvbnRlbnRbJ3RleHQvcGxhaW4nXTtcbiAgICAgIHJldHVybiBwbGFpblRleHRDb250ZW50ID8gcGxhaW5UZXh0Q29udGVudC5pbmRleE9mKCdmaWxlOi8vJykgPT09IDAgOiBmYWxzZTtcbiAgICB9O1xuICAgIHZhciBzZXRGb2N1c2VkUmFuZ2UgPSBmdW5jdGlvbiAoZWRpdG9yLCBybmcpIHtcbiAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocm5nKTtcbiAgICB9O1xuICAgIHZhciBzZXR1cCA9IGZ1bmN0aW9uIChlZGl0b3IsIGNsaXBib2FyZCwgZHJhZ2dpbmdJbnRlcm5hbGx5U3RhdGUpIHtcbiAgICAgIGlmIChzaG91bGRCbG9ja0Ryb3AoZWRpdG9yKSkge1xuICAgICAgICBlZGl0b3Iub24oJ2RyYWdlbmQgZHJhZ292ZXIgZHJhZ2dlc3R1cmUgZHJhZ2Ryb3AgZHJvcCBkcmFnJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAoIXNob3VsZFBhc3RlRGF0YUltYWdlcyhlZGl0b3IpKSB7XG4gICAgICAgIGVkaXRvci5vbignZHJvcCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgdmFyIGRhdGFUcmFuc2ZlciA9IGUuZGF0YVRyYW5zZmVyO1xuICAgICAgICAgIGlmIChkYXRhVHJhbnNmZXIgJiYgZGF0YVRyYW5zZmVyLmZpbGVzICYmIGRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGVkaXRvci5vbignZHJvcCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBybmcgPSBnZXRDYXJldFJhbmdlRnJvbUV2ZW50KGVkaXRvciwgZSk7XG4gICAgICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGRyYWdnaW5nSW50ZXJuYWxseVN0YXRlLmdldCgpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkcm9wQ29udGVudCA9IGNsaXBib2FyZC5nZXREYXRhVHJhbnNmZXJJdGVtcyhlLmRhdGFUcmFuc2Zlcik7XG4gICAgICAgIHZhciBpbnRlcm5hbCA9IGNsaXBib2FyZC5oYXNDb250ZW50VHlwZShkcm9wQ29udGVudCwgaW50ZXJuYWxIdG1sTWltZSgpKTtcbiAgICAgICAgaWYgKCghY2xpcGJvYXJkLmhhc0h0bWxPclRleHQoZHJvcENvbnRlbnQpIHx8IGlzUGxhaW5UZXh0RmlsZVVybChkcm9wQ29udGVudCkpICYmIGNsaXBib2FyZC5wYXN0ZUltYWdlRGF0YShlLCBybmcpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChybmcgJiYgc2hvdWxkRmlsdGVyRHJvcChlZGl0b3IpKSB7XG4gICAgICAgICAgdmFyIGNvbnRlbnRfMSA9IGRyb3BDb250ZW50WydtY2UtaW50ZXJuYWwnXSB8fCBkcm9wQ29udGVudFsndGV4dC9odG1sJ10gfHwgZHJvcENvbnRlbnRbJ3RleHQvcGxhaW4nXTtcbiAgICAgICAgICBpZiAoY29udGVudF8xKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBnbG9iYWwkMi5zZXRFZGl0b3JUaW1lb3V0KGVkaXRvciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChkcm9wQ29udGVudFsnbWNlLWludGVybmFsJ10pIHtcbiAgICAgICAgICAgICAgICAgIGVkaXRvci5leGVjQ29tbWFuZCgnRGVsZXRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldEZvY3VzZWRSYW5nZShlZGl0b3IsIHJuZyk7XG4gICAgICAgICAgICAgICAgY29udGVudF8xID0gdHJpbUh0bWwoY29udGVudF8xKTtcbiAgICAgICAgICAgICAgICBpZiAoIWRyb3BDb250ZW50Wyd0ZXh0L2h0bWwnXSkge1xuICAgICAgICAgICAgICAgICAgY2xpcGJvYXJkLnBhc3RlVGV4dChjb250ZW50XzEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjbGlwYm9hcmQucGFzdGVIdG1sKGNvbnRlbnRfMSwgaW50ZXJuYWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLm9uKCdkcmFnc3RhcnQnLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgZHJhZ2dpbmdJbnRlcm5hbGx5U3RhdGUuc2V0KHRydWUpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3Iub24oJ2RyYWdvdmVyIGRyYWdlbmQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoc2hvdWxkUGFzdGVEYXRhSW1hZ2VzKGVkaXRvcikgJiYgZHJhZ2dpbmdJbnRlcm5hbGx5U3RhdGUuZ2V0KCkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHNldEZvY3VzZWRSYW5nZShlZGl0b3IsIGdldENhcmV0UmFuZ2VGcm9tRXZlbnQoZWRpdG9yLCBlKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUudHlwZSA9PT0gJ2RyYWdlbmQnKSB7XG4gICAgICAgICAgZHJhZ2dpbmdJbnRlcm5hbGx5U3RhdGUuc2V0KGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzZXR1cCQxID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHBsdWdpbiA9IGVkaXRvci5wbHVnaW5zLnBhc3RlO1xuICAgICAgdmFyIHByZVByb2Nlc3MgPSBnZXRQcmVQcm9jZXNzKGVkaXRvcik7XG4gICAgICBpZiAocHJlUHJvY2Vzcykge1xuICAgICAgICBlZGl0b3Iub24oJ1Bhc3RlUHJlUHJvY2VzcycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcHJlUHJvY2Vzcy5jYWxsKHBsdWdpbiwgcGx1Z2luLCBlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB2YXIgcG9zdFByb2Nlc3MgPSBnZXRQb3N0UHJvY2VzcyhlZGl0b3IpO1xuICAgICAgaWYgKHBvc3RQcm9jZXNzKSB7XG4gICAgICAgIGVkaXRvci5vbignUGFzdGVQb3N0UHJvY2VzcycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcG9zdFByb2Nlc3MuY2FsbChwbHVnaW4sIHBsdWdpbiwgZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgYWRkUHJlUHJvY2Vzc0ZpbHRlciA9IGZ1bmN0aW9uIChlZGl0b3IsIGZpbHRlckZ1bmMpIHtcbiAgICAgIGVkaXRvci5vbignUGFzdGVQcmVQcm9jZXNzJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5jb250ZW50ID0gZmlsdGVyRnVuYyhlZGl0b3IsIGUuY29udGVudCwgZS5pbnRlcm5hbCwgZS53b3JkQ29udGVudCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBhZGRQb3N0UHJvY2Vzc0ZpbHRlciA9IGZ1bmN0aW9uIChlZGl0b3IsIGZpbHRlckZ1bmMpIHtcbiAgICAgIGVkaXRvci5vbignUGFzdGVQb3N0UHJvY2VzcycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGZpbHRlckZ1bmMoZWRpdG9yLCBlLm5vZGUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlRXhwbG9yZXJCckVsZW1lbnRzQWZ0ZXJCbG9ja3MgPSBmdW5jdGlvbiAoZWRpdG9yLCBodG1sKSB7XG4gICAgICBpZiAoIWlzV29yZENvbnRlbnQoaHRtbCkpIHtcbiAgICAgICAgcmV0dXJuIGh0bWw7XG4gICAgICB9XG4gICAgICB2YXIgYmxvY2tFbGVtZW50cyA9IFtdO1xuICAgICAgZ2xvYmFsJDUuZWFjaChlZGl0b3Iuc2NoZW1hLmdldEJsb2NrRWxlbWVudHMoKSwgZnVuY3Rpb24gKGJsb2NrLCBibG9ja05hbWUpIHtcbiAgICAgICAgYmxvY2tFbGVtZW50cy5wdXNoKGJsb2NrTmFtZSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBleHBsb3JlckJsb2Nrc1JlZ0V4cCA9IG5ldyBSZWdFeHAoJyg/Ojxicj4mbmJzcDtbXFxcXHNcXFxcclxcXFxuXSt8PGJyPikqKDxcXFxcLz8oJyArIGJsb2NrRWxlbWVudHMuam9pbignfCcpICsgJylbXj5dKj4pKD86PGJyPiZuYnNwO1tcXFxcc1xcXFxyXFxcXG5dK3w8YnI+KSonLCAnZycpO1xuICAgICAgaHRtbCA9IGZpbHRlciQxKGh0bWwsIFtbXG4gICAgICAgICAgZXhwbG9yZXJCbG9ja3NSZWdFeHAsXG4gICAgICAgICAgJyQxJ1xuICAgICAgICBdXSk7XG4gICAgICBodG1sID0gZmlsdGVyJDEoaHRtbCwgW1xuICAgICAgICBbXG4gICAgICAgICAgLzxicj48YnI+L2csXG4gICAgICAgICAgJzxCUj48QlI+J1xuICAgICAgICBdLFxuICAgICAgICBbXG4gICAgICAgICAgLzxicj4vZyxcbiAgICAgICAgICAnICdcbiAgICAgICAgXSxcbiAgICAgICAgW1xuICAgICAgICAgIC88QlI+PEJSPi9nLFxuICAgICAgICAgICc8YnI+J1xuICAgICAgICBdXG4gICAgICBdKTtcbiAgICAgIHJldHVybiBodG1sO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZVdlYktpdFN0eWxlcyA9IGZ1bmN0aW9uIChlZGl0b3IsIGNvbnRlbnQsIGludGVybmFsLCBpc1dvcmRIdG1sKSB7XG4gICAgICBpZiAoaXNXb3JkSHRtbCB8fCBpbnRlcm5hbCkge1xuICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICAgIH1cbiAgICAgIHZhciB3ZWJLaXRTdHlsZXNTZXR0aW5nID0gZ2V0V2Via2l0U3R5bGVzKGVkaXRvcik7XG4gICAgICB2YXIgd2ViS2l0U3R5bGVzO1xuICAgICAgaWYgKHNob3VsZFJlbW92ZVdlYktpdFN0eWxlcyhlZGl0b3IpID09PSBmYWxzZSB8fCB3ZWJLaXRTdHlsZXNTZXR0aW5nID09PSAnYWxsJykge1xuICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICAgIH1cbiAgICAgIGlmICh3ZWJLaXRTdHlsZXNTZXR0aW5nKSB7XG4gICAgICAgIHdlYktpdFN0eWxlcyA9IHdlYktpdFN0eWxlc1NldHRpbmcuc3BsaXQoL1ssIF0vKTtcbiAgICAgIH1cbiAgICAgIGlmICh3ZWJLaXRTdHlsZXMpIHtcbiAgICAgICAgdmFyIGRvbV8xID0gZWRpdG9yLmRvbSwgbm9kZV8xID0gZWRpdG9yLnNlbGVjdGlvbi5nZXROb2RlKCk7XG4gICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLyg8W14+XSspIHN0eWxlPVwiKFteXCJdKilcIihbXj5dKj4pL2dpLCBmdW5jdGlvbiAoYWxsLCBiZWZvcmUsIHZhbHVlLCBhZnRlcikge1xuICAgICAgICAgIHZhciBpbnB1dFN0eWxlcyA9IGRvbV8xLnBhcnNlU3R5bGUoZG9tXzEuZGVjb2RlKHZhbHVlKSk7XG4gICAgICAgICAgdmFyIG91dHB1dFN0eWxlcyA9IHt9O1xuICAgICAgICAgIGlmICh3ZWJLaXRTdHlsZXMgPT09ICdub25lJykge1xuICAgICAgICAgICAgcmV0dXJuIGJlZm9yZSArIGFmdGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdlYktpdFN0eWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGlucHV0VmFsdWUgPSBpbnB1dFN0eWxlc1t3ZWJLaXRTdHlsZXNbaV1dLCBjdXJyZW50VmFsdWUgPSBkb21fMS5nZXRTdHlsZShub2RlXzEsIHdlYktpdFN0eWxlc1tpXSwgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAoL2NvbG9yLy50ZXN0KHdlYktpdFN0eWxlc1tpXSkpIHtcbiAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IGRvbV8xLnRvSGV4KGlucHV0VmFsdWUpO1xuICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBkb21fMS50b0hleChjdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSAhPT0gaW5wdXRWYWx1ZSkge1xuICAgICAgICAgICAgICBvdXRwdXRTdHlsZXNbd2ViS2l0U3R5bGVzW2ldXSA9IGlucHV0VmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIG91dHB1dFN0eWxlcyA9IGRvbV8xLnNlcmlhbGl6ZVN0eWxlKG91dHB1dFN0eWxlcywgJ3NwYW4nKTtcbiAgICAgICAgICBpZiAob3V0cHV0U3R5bGVzKSB7XG4gICAgICAgICAgICByZXR1cm4gYmVmb3JlICsgJyBzdHlsZT1cIicgKyBvdXRwdXRTdHlsZXMgKyAnXCInICsgYWZ0ZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBiZWZvcmUgKyBhZnRlcjtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC8oPFtePl0rKSBzdHlsZT1cIihbXlwiXSopXCIoW14+XSo+KS9naSwgJyQxJDMnKTtcbiAgICAgIH1cbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLyg8W14+XSspIGRhdGEtbWNlLXN0eWxlPVwiKFteXCJdKylcIihbXj5dKj4pL2dpLCBmdW5jdGlvbiAoYWxsLCBiZWZvcmUsIHZhbHVlLCBhZnRlcikge1xuICAgICAgICByZXR1cm4gYmVmb3JlICsgJyBzdHlsZT1cIicgKyB2YWx1ZSArICdcIicgKyBhZnRlcjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlVW5kZXJsaW5lQW5kRm9udEluQW5jaG9yID0gZnVuY3Rpb24gKGVkaXRvciwgcm9vdCkge1xuICAgICAgZWRpdG9yLiQoJ2EnLCByb290KS5maW5kKCdmb250LHUnKS5lYWNoKGZ1bmN0aW9uIChpLCBub2RlKSB7XG4gICAgICAgIGVkaXRvci5kb20ucmVtb3ZlKG5vZGUsIHRydWUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0dXAkMiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGlmIChnbG9iYWwkMS53ZWJraXQpIHtcbiAgICAgICAgYWRkUHJlUHJvY2Vzc0ZpbHRlcihlZGl0b3IsIHJlbW92ZVdlYktpdFN0eWxlcyk7XG4gICAgICB9XG4gICAgICBpZiAoZ2xvYmFsJDEuaWUpIHtcbiAgICAgICAgYWRkUHJlUHJvY2Vzc0ZpbHRlcihlZGl0b3IsIHJlbW92ZUV4cGxvcmVyQnJFbGVtZW50c0FmdGVyQmxvY2tzKTtcbiAgICAgICAgYWRkUG9zdFByb2Nlc3NGaWx0ZXIoZWRpdG9yLCByZW1vdmVVbmRlcmxpbmVBbmRGb250SW5BbmNob3IpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgbWFrZVNldHVwSGFuZGxlciA9IGZ1bmN0aW9uIChlZGl0b3IsIGNsaXBib2FyZCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgYXBpLnNldEFjdGl2ZShjbGlwYm9hcmQucGFzdGVGb3JtYXQuZ2V0KCkgPT09ICd0ZXh0Jyk7XG4gICAgICAgIHZhciBwYXN0ZVBsYWluVGV4dFRvZ2dsZUhhbmRsZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIHJldHVybiBhcGkuc2V0QWN0aXZlKGUuc3RhdGUpO1xuICAgICAgICB9O1xuICAgICAgICBlZGl0b3Iub24oJ1Bhc3RlUGxhaW5UZXh0VG9nZ2xlJywgcGFzdGVQbGFpblRleHRUb2dnbGVIYW5kbGVyKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLm9mZignUGFzdGVQbGFpblRleHRUb2dnbGUnLCBwYXN0ZVBsYWluVGV4dFRvZ2dsZUhhbmRsZXIpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByZWdpc3RlciQyID0gZnVuY3Rpb24gKGVkaXRvciwgY2xpcGJvYXJkKSB7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkVG9nZ2xlQnV0dG9uKCdwYXN0ZXRleHQnLCB7XG4gICAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgICAgIGljb246ICdwYXN0ZS10ZXh0JyxcbiAgICAgICAgdG9vbHRpcDogJ1Bhc3RlIGFzIHRleHQnLFxuICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZVRvZ2dsZVBsYWluVGV4dFBhc3RlJyk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uU2V0dXA6IG1ha2VTZXR1cEhhbmRsZXIoZWRpdG9yLCBjbGlwYm9hcmQpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVNZW51SXRlbSgncGFzdGV0ZXh0Jywge1xuICAgICAgICB0ZXh0OiAnUGFzdGUgYXMgdGV4dCcsXG4gICAgICAgIGljb246ICdwYXN0ZS10ZXh0JyxcbiAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VUb2dnbGVQbGFpblRleHRQYXN0ZScpO1xuICAgICAgICB9LFxuICAgICAgICBvblNldHVwOiBtYWtlU2V0dXBIYW5kbGVyKGVkaXRvciwgY2xpcGJvYXJkKVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIFBsdWdpbiAoKSB7XG4gICAgICBnbG9iYWwuYWRkKCdwYXN0ZScsIGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgaWYgKGhhc1Byb1BsdWdpbihlZGl0b3IpID09PSBmYWxzZSkge1xuICAgICAgICAgIHZhciBkcmFnZ2luZ0ludGVybmFsbHlTdGF0ZSA9IENlbGwoZmFsc2UpO1xuICAgICAgICAgIHZhciBwYXN0ZUZvcm1hdCA9IENlbGwoaXNQYXN0ZUFzVGV4dEVuYWJsZWQoZWRpdG9yKSA/ICd0ZXh0JyA6ICdodG1sJyk7XG4gICAgICAgICAgdmFyIGNsaXBib2FyZCA9IENsaXBib2FyZChlZGl0b3IsIHBhc3RlRm9ybWF0KTtcbiAgICAgICAgICB2YXIgcXVpcmtzID0gc2V0dXAkMihlZGl0b3IpO1xuICAgICAgICAgIHJlZ2lzdGVyJDIoZWRpdG9yLCBjbGlwYm9hcmQpO1xuICAgICAgICAgIHJlZ2lzdGVyKGVkaXRvciwgY2xpcGJvYXJkKTtcbiAgICAgICAgICBzZXR1cCQxKGVkaXRvcik7XG4gICAgICAgICAgcmVnaXN0ZXIkMShlZGl0b3IpO1xuICAgICAgICAgIHNldHVwKGVkaXRvciwgY2xpcGJvYXJkLCBkcmFnZ2luZ0ludGVybmFsbHlTdGF0ZSk7XG4gICAgICAgICAgcmV0dXJuIGdldChjbGlwYm9hcmQsIHF1aXJrcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIFBsdWdpbigpO1xuXG59KCkpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QTs7Ozs7Ozs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7O0EiLCJzb3VyY2VSb290IjoiIn0=