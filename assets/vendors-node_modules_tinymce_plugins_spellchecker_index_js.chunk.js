(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_spellchecker_index_js"],{

/***/ "./node_modules/tinymce/plugins/spellchecker/index.js":
/*!************************************************************!*\
  !*** ./node_modules/tinymce/plugins/spellchecker/index.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "spellchecker" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/spellchecker')
//   ES2015:
//     import 'tinymce/plugins/spellchecker'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/spellchecker/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/spellchecker/plugin.js":
/*!*************************************************************!*\
  !*** ./node_modules/tinymce/plugins/spellchecker/plugin.js ***!
  \*************************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var hasProPlugin = function (editor) {
      if (editor.hasPlugin('tinymcespellchecker', true)) {
        if (typeof window.console !== 'undefined' && window.console.log) {
          window.console.log('Spell Checker Pro is incompatible with Spell Checker plugin! ' + 'Remove \'spellchecker\' from the \'plugins\' option.');
        }
        return true;
      } else {
        return false;
      }
    };

    var hasOwnProperty = Object.hasOwnProperty;
    var isEmpty = function (r) {
      for (var x in r) {
        if (hasOwnProperty.call(r, x)) {
          return false;
        }
      }
      return true;
    };

    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var global$2 = tinymce.util.Tools.resolve('tinymce.util.URI');

    var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');

    var fireSpellcheckStart = function (editor) {
      return editor.fire('SpellcheckStart');
    };
    var fireSpellcheckEnd = function (editor) {
      return editor.fire('SpellcheckEnd');
    };

    var getLanguages = function (editor) {
      var defaultLanguages = 'English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv';
      return editor.getParam('spellchecker_languages', defaultLanguages);
    };
    var getLanguage = function (editor) {
      var defaultLanguage = editor.getParam('language', 'en');
      return editor.getParam('spellchecker_language', defaultLanguage);
    };
    var getRpcUrl = function (editor) {
      return editor.getParam('spellchecker_rpc_url');
    };
    var getSpellcheckerCallback = function (editor) {
      return editor.getParam('spellchecker_callback');
    };
    var getSpellcheckerWordcharPattern = function (editor) {
      var defaultPattern = new RegExp('[^' + '\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`' + '\xA7\xA9\xAB\xAE\xB1\xB6\xB7\xB8\xBB' + '\xBC\xBD\xBE\xBF\xD7\xF7\xA4\u201D\u201C\u201E\xA0\u2002\u2003\u2009' + ']+', 'g');
      return editor.getParam('spellchecker_wordchar_pattern', defaultPattern);
    };

    var isContentEditableFalse = function (node) {
      return node && node.nodeType === 1 && node.contentEditable === 'false';
    };
    var DomTextMatcher = function (node, editor) {
      var m, matches = [];
      var dom = editor.dom;
      var blockElementsMap = editor.schema.getBlockElements();
      var hiddenTextElementsMap = editor.schema.getWhiteSpaceElements();
      var shortEndedElementsMap = editor.schema.getShortEndedElements();
      var createMatch = function (m, data) {
        if (!m[0]) {
          throw new Error('findAndReplaceDOMText cannot handle zero-length matches');
        }
        return {
          start: m.index,
          end: m.index + m[0].length,
          text: m[0],
          data: data
        };
      };
      var getText = function (node) {
        var txt;
        if (node.nodeType === 3) {
          return node.data;
        }
        if (hiddenTextElementsMap[node.nodeName] && !blockElementsMap[node.nodeName]) {
          return '';
        }
        if (isContentEditableFalse(node)) {
          return '\n';
        }
        txt = '';
        if (blockElementsMap[node.nodeName] || shortEndedElementsMap[node.nodeName]) {
          txt += '\n';
        }
        if (node = node.firstChild) {
          do {
            txt += getText(node);
          } while (node = node.nextSibling);
        }
        return txt;
      };
      var stepThroughMatches = function (node, matches, replaceFn) {
        var startNode, endNode, startNodeIndex, endNodeIndex, innerNodes = [], atIndex = 0, curNode = node, matchLocation, matchIndex = 0;
        matches = matches.slice(0);
        matches.sort(function (a, b) {
          return a.start - b.start;
        });
        matchLocation = matches.shift();
        out:
          while (true) {
            if (blockElementsMap[curNode.nodeName] || shortEndedElementsMap[curNode.nodeName] || isContentEditableFalse(curNode)) {
              atIndex++;
            }
            if (curNode.nodeType === 3) {
              if (!endNode && curNode.length + atIndex >= matchLocation.end) {
                endNode = curNode;
                endNodeIndex = matchLocation.end - atIndex;
              } else if (startNode) {
                innerNodes.push(curNode);
              }
              if (!startNode && curNode.length + atIndex > matchLocation.start) {
                startNode = curNode;
                startNodeIndex = matchLocation.start - atIndex;
              }
              atIndex += curNode.length;
            }
            if (startNode && endNode) {
              curNode = replaceFn({
                startNode: startNode,
                startNodeIndex: startNodeIndex,
                endNode: endNode,
                endNodeIndex: endNodeIndex,
                innerNodes: innerNodes,
                match: matchLocation.text,
                matchIndex: matchIndex
              });
              atIndex -= endNode.length - endNodeIndex;
              startNode = null;
              endNode = null;
              innerNodes = [];
              matchLocation = matches.shift();
              matchIndex++;
              if (!matchLocation) {
                break;
              }
            } else if ((!hiddenTextElementsMap[curNode.nodeName] || blockElementsMap[curNode.nodeName]) && curNode.firstChild) {
              if (!isContentEditableFalse(curNode)) {
                curNode = curNode.firstChild;
                continue;
              }
            } else if (curNode.nextSibling) {
              curNode = curNode.nextSibling;
              continue;
            }
            while (true) {
              if (curNode.nextSibling) {
                curNode = curNode.nextSibling;
                break;
              } else if (curNode.parentNode !== node) {
                curNode = curNode.parentNode;
              } else {
                break out;
              }
            }
          }
      };
      var genReplacer = function (callback) {
        var makeReplacementNode = function (fill, matchIndex) {
          var match = matches[matchIndex];
          if (!match.stencil) {
            match.stencil = callback(match);
          }
          var clone = match.stencil.cloneNode(false);
          clone.setAttribute('data-mce-index', matchIndex);
          if (fill) {
            clone.appendChild(dom.doc.createTextNode(fill));
          }
          return clone;
        };
        return function (range) {
          var before;
          var after;
          var parentNode;
          var startNode = range.startNode;
          var endNode = range.endNode;
          var matchIndex = range.matchIndex;
          var doc = dom.doc;
          if (startNode === endNode) {
            var node_1 = startNode;
            parentNode = node_1.parentNode;
            if (range.startNodeIndex > 0) {
              before = doc.createTextNode(node_1.data.substring(0, range.startNodeIndex));
              parentNode.insertBefore(before, node_1);
            }
            var el = makeReplacementNode(range.match, matchIndex);
            parentNode.insertBefore(el, node_1);
            if (range.endNodeIndex < node_1.length) {
              after = doc.createTextNode(node_1.data.substring(range.endNodeIndex));
              parentNode.insertBefore(after, node_1);
            }
            node_1.parentNode.removeChild(node_1);
            return el;
          }
          before = doc.createTextNode(startNode.data.substring(0, range.startNodeIndex));
          after = doc.createTextNode(endNode.data.substring(range.endNodeIndex));
          var elA = makeReplacementNode(startNode.data.substring(range.startNodeIndex), matchIndex);
          for (var i = 0, l = range.innerNodes.length; i < l; ++i) {
            var innerNode = range.innerNodes[i];
            var innerEl = makeReplacementNode(innerNode.data, matchIndex);
            innerNode.parentNode.replaceChild(innerEl, innerNode);
          }
          var elB = makeReplacementNode(endNode.data.substring(0, range.endNodeIndex), matchIndex);
          parentNode = startNode.parentNode;
          parentNode.insertBefore(before, startNode);
          parentNode.insertBefore(elA, startNode);
          parentNode.removeChild(startNode);
          parentNode = endNode.parentNode;
          parentNode.insertBefore(elB, endNode);
          parentNode.insertBefore(after, endNode);
          parentNode.removeChild(endNode);
          return elB;
        };
      };
      var unwrapElement = function (element) {
        var parentNode = element.parentNode;
        while (element.childNodes.length > 0) {
          parentNode.insertBefore(element.childNodes[0], element);
        }
        parentNode.removeChild(element);
      };
      var hasClass = function (elm) {
        return elm.className.indexOf('mce-spellchecker-word') !== -1;
      };
      var getWrappersByIndex = function (index) {
        var elements = node.getElementsByTagName('*'), wrappers = [];
        index = typeof index === 'number' ? '' + index : null;
        for (var i = 0; i < elements.length; i++) {
          var element = elements[i], dataIndex = element.getAttribute('data-mce-index');
          if (dataIndex !== null && dataIndex.length && hasClass(element)) {
            if (dataIndex === index || index === null) {
              wrappers.push(element);
            }
          }
        }
        return wrappers;
      };
      var indexOf = function (match) {
        var i = matches.length;
        while (i--) {
          if (matches[i] === match) {
            return i;
          }
        }
        return -1;
      };
      function filter(callback) {
        var filteredMatches = [];
        each(function (match, i) {
          if (callback(match, i)) {
            filteredMatches.push(match);
          }
        });
        matches = filteredMatches;
        return this;
      }
      function each(callback) {
        for (var i = 0, l = matches.length; i < l; i++) {
          if (callback(matches[i], i) === false) {
            break;
          }
        }
        return this;
      }
      function wrap(callback) {
        if (matches.length) {
          stepThroughMatches(node, matches, genReplacer(callback));
        }
        return this;
      }
      function find(regex, data) {
        if (text && regex.global) {
          while (m = regex.exec(text)) {
            matches.push(createMatch(m, data));
          }
        }
        return this;
      }
      function unwrap(match) {
        var i;
        var elements = getWrappersByIndex(match ? indexOf(match) : null);
        i = elements.length;
        while (i--) {
          unwrapElement(elements[i]);
        }
        return this;
      }
      var matchFromElement = function (element) {
        return matches[element.getAttribute('data-mce-index')];
      };
      var elementFromMatch = function (match) {
        return getWrappersByIndex(indexOf(match))[0];
      };
      function add(start, length, data) {
        matches.push({
          start: start,
          end: start + length,
          text: text.substr(start, length),
          data: data
        });
        return this;
      }
      var rangeFromMatch = function (match) {
        var wrappers = getWrappersByIndex(indexOf(match));
        var rng = editor.dom.createRng();
        rng.setStartBefore(wrappers[0]);
        rng.setEndAfter(wrappers[wrappers.length - 1]);
        return rng;
      };
      var replace = function (match, text) {
        var rng = rangeFromMatch(match);
        rng.deleteContents();
        if (text.length > 0) {
          rng.insertNode(editor.dom.doc.createTextNode(text));
        }
        return rng;
      };
      function reset() {
        matches.splice(0, matches.length);
        unwrap();
        return this;
      }
      var text = getText(node);
      return {
        text: text,
        matches: matches,
        each: each,
        filter: filter,
        reset: reset,
        matchFromElement: matchFromElement,
        elementFromMatch: elementFromMatch,
        find: find,
        add: add,
        wrap: wrap,
        unwrap: unwrap,
        replace: replace,
        rangeFromMatch: rangeFromMatch,
        indexOf: indexOf
      };
    };

    var getTextMatcher = function (editor, textMatcherState) {
      if (!textMatcherState.get()) {
        var textMatcher = DomTextMatcher(editor.getBody(), editor);
        textMatcherState.set(textMatcher);
      }
      return textMatcherState.get();
    };
    var defaultSpellcheckCallback = function (editor, pluginUrl, currentLanguageState) {
      return function (method, text, doneCallback, errorCallback) {
        var data = {
          method: method,
          lang: currentLanguageState.get()
        };
        var postData = '';
        data[method === 'addToDictionary' ? 'word' : 'text'] = text;
        global$1.each(data, function (value, key) {
          if (postData) {
            postData += '&';
          }
          postData += key + '=' + encodeURIComponent(value);
        });
        global$3.send({
          url: new global$2(pluginUrl).toAbsolute(getRpcUrl(editor)),
          type: 'post',
          content_type: 'application/x-www-form-urlencoded',
          data: postData,
          success: function (result) {
            var parseResult = JSON.parse(result);
            if (!parseResult) {
              var message = editor.translate('Server response wasn\'t proper JSON.');
              errorCallback(message);
            } else if (parseResult.error) {
              errorCallback(parseResult.error);
            } else {
              doneCallback(parseResult);
            }
          },
          error: function () {
            var message = editor.translate('The spelling service was not found: (') + getRpcUrl(editor) + editor.translate(')');
            errorCallback(message);
          }
        });
      };
    };
    var sendRpcCall = function (editor, pluginUrl, currentLanguageState, name, data, successCallback, errorCallback) {
      var userSpellcheckCallback = getSpellcheckerCallback(editor);
      var spellCheckCallback = userSpellcheckCallback ? userSpellcheckCallback : defaultSpellcheckCallback(editor, pluginUrl, currentLanguageState);
      spellCheckCallback.call(editor.plugins.spellchecker, name, data, successCallback, errorCallback);
    };
    var spellcheck = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {
      if (finish(editor, startedState, textMatcherState)) {
        return;
      }
      var errorCallback = function (message) {
        editor.notificationManager.open({
          text: message,
          type: 'error'
        });
        editor.setProgressState(false);
        finish(editor, startedState, textMatcherState);
      };
      var successCallback = function (data) {
        markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);
      };
      editor.setProgressState(true);
      sendRpcCall(editor, pluginUrl, currentLanguageState, 'spellcheck', getTextMatcher(editor, textMatcherState).text, successCallback, errorCallback);
      editor.focus();
    };
    var checkIfFinished = function (editor, startedState, textMatcherState) {
      if (!editor.dom.select('span.mce-spellchecker-word').length) {
        finish(editor, startedState, textMatcherState);
      }
    };
    var addToDictionary = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans) {
      editor.setProgressState(true);
      sendRpcCall(editor, pluginUrl, currentLanguageState, 'addToDictionary', word, function () {
        editor.setProgressState(false);
        editor.dom.remove(spans, true);
        checkIfFinished(editor, startedState, textMatcherState);
      }, function (message) {
        editor.notificationManager.open({
          text: message,
          type: 'error'
        });
        editor.setProgressState(false);
      });
    };
    var ignoreWord = function (editor, startedState, textMatcherState, word, spans, all) {
      editor.selection.collapse();
      if (all) {
        global$1.each(editor.dom.select('span.mce-spellchecker-word'), function (span) {
          if (span.getAttribute('data-mce-word') === word) {
            editor.dom.remove(span, true);
          }
        });
      } else {
        editor.dom.remove(spans, true);
      }
      checkIfFinished(editor, startedState, textMatcherState);
    };
    var finish = function (editor, startedState, textMatcherState) {
      var bookmark = editor.selection.getBookmark();
      getTextMatcher(editor, textMatcherState).reset();
      editor.selection.moveToBookmark(bookmark);
      textMatcherState.set(null);
      if (startedState.get()) {
        startedState.set(false);
        fireSpellcheckEnd(editor);
        return true;
      }
    };
    var getElmIndex = function (elm) {
      var value = elm.getAttribute('data-mce-index');
      if (typeof value === 'number') {
        return '' + value;
      }
      return value;
    };
    var findSpansByIndex = function (editor, index) {
      var spans = [];
      var nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));
      if (nodes.length) {
        for (var i = 0; i < nodes.length; i++) {
          var nodeIndex = getElmIndex(nodes[i]);
          if (nodeIndex === null || !nodeIndex.length) {
            continue;
          }
          if (nodeIndex === index.toString()) {
            spans.push(nodes[i]);
          }
        }
      }
      return spans;
    };
    var markErrors = function (editor, startedState, textMatcherState, lastSuggestionsState, data) {
      var hasDictionarySupport = !!data.dictionary;
      var suggestions = data.words;
      editor.setProgressState(false);
      if (isEmpty(suggestions)) {
        var message = editor.translate('No misspellings found.');
        editor.notificationManager.open({
          text: message,
          type: 'info'
        });
        startedState.set(false);
        return;
      }
      lastSuggestionsState.set({
        suggestions: suggestions,
        hasDictionarySupport: hasDictionarySupport
      });
      var bookmark = editor.selection.getBookmark();
      getTextMatcher(editor, textMatcherState).find(getSpellcheckerWordcharPattern(editor)).filter(function (match) {
        return !!suggestions[match.text];
      }).wrap(function (match) {
        return editor.dom.create('span', {
          'class': 'mce-spellchecker-word',
          'aria-invalid': 'spelling',
          'data-mce-bogus': 1,
          'data-mce-word': match.text
        });
      });
      editor.selection.moveToBookmark(bookmark);
      startedState.set(true);
      fireSpellcheckStart(editor);
    };

    var get = function (editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState, _url) {
      var getWordCharPattern = function () {
        return getSpellcheckerWordcharPattern(editor);
      };
      var markErrors$1 = function (data) {
        markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);
      };
      return {
        getTextMatcher: textMatcherState.get,
        getWordCharPattern: getWordCharPattern,
        markErrors: markErrors$1,
        getLanguage: currentLanguageState.get
      };
    };

    var register = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {
      editor.addCommand('mceSpellCheck', function () {
        spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);
      });
    };

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };

    var spellcheckerEvents = 'SpellcheckStart SpellcheckEnd';
    var buildMenuItems = function (listName, languageValues) {
      var items = [];
      global$1.each(languageValues, function (languageValue) {
        items.push({
          selectable: true,
          text: languageValue.name,
          data: languageValue.value
        });
      });
      return items;
    };
    var getItems = function (editor) {
      return global$1.map(getLanguages(editor).split(','), function (langPair) {
        var langPairs = langPair.split('=');
        return {
          name: langPairs[0],
          value: langPairs[1]
        };
      });
    };
    var register$1 = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState) {
      var languageMenuItems = buildMenuItems('Language', getItems(editor));
      var startSpellchecking = function () {
        spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);
      };
      var buttonArgs = {
        tooltip: 'Spellcheck',
        onAction: startSpellchecking,
        icon: 'spell-check',
        onSetup: function (buttonApi) {
          var setButtonState = function () {
            buttonApi.setActive(startedState.get());
          };
          editor.on(spellcheckerEvents, setButtonState);
          return function () {
            editor.off(spellcheckerEvents, setButtonState);
          };
        }
      };
      var splitButtonArgs = __assign(__assign({}, buttonArgs), {
        type: 'splitbutton',
        select: function (value) {
          return value === currentLanguageState.get();
        },
        fetch: function (callback) {
          var items = global$1.map(languageMenuItems, function (languageItem) {
            return {
              type: 'choiceitem',
              value: languageItem.data,
              text: languageItem.text
            };
          });
          callback(items);
        },
        onItemAction: function (splitButtonApi, value) {
          currentLanguageState.set(value);
        }
      });
      if (languageMenuItems.length > 1) {
        editor.ui.registry.addSplitButton('spellchecker', splitButtonArgs);
      } else {
        editor.ui.registry.addToggleButton('spellchecker', buttonArgs);
      }
      editor.ui.registry.addToggleMenuItem('spellchecker', {
        text: 'Spellcheck',
        icon: 'spell-check',
        onSetup: function (menuApi) {
          menuApi.setActive(startedState.get());
          var setMenuItemCheck = function () {
            menuApi.setActive(startedState.get());
          };
          editor.on(spellcheckerEvents, setMenuItemCheck);
          return function () {
            editor.off(spellcheckerEvents, setMenuItemCheck);
          };
        },
        onAction: startSpellchecking
      });
    };

    var ignoreAll = true;
    var getSuggestions = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, word, spans) {
      var items = [];
      var suggestions = lastSuggestionsState.get().suggestions[word];
      global$1.each(suggestions, function (suggestion) {
        items.push({
          text: suggestion,
          onAction: function () {
            editor.insertContent(editor.dom.encode(suggestion));
            editor.dom.remove(spans);
            checkIfFinished(editor, startedState, textMatcherState);
          }
        });
      });
      var hasDictionarySupport = lastSuggestionsState.get().hasDictionarySupport;
      if (hasDictionarySupport) {
        items.push({ type: 'separator' });
        items.push({
          text: 'Add to dictionary',
          onAction: function () {
            addToDictionary(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans);
          }
        });
      }
      items.push.apply(items, [
        { type: 'separator' },
        {
          text: 'Ignore',
          onAction: function () {
            ignoreWord(editor, startedState, textMatcherState, word, spans);
          }
        },
        {
          text: 'Ignore all',
          onAction: function () {
            ignoreWord(editor, startedState, textMatcherState, word, spans, ignoreAll);
          }
        }
      ]);
      return items;
    };
    var setup = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState) {
      var update = function (element) {
        var target = element;
        if (target.className === 'mce-spellchecker-word') {
          var spans = findSpansByIndex(editor, getElmIndex(target));
          if (spans.length > 0) {
            var rng = editor.dom.createRng();
            rng.setStartBefore(spans[0]);
            rng.setEndAfter(spans[spans.length - 1]);
            editor.selection.setRng(rng);
            return getSuggestions(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, target.getAttribute('data-mce-word'), spans);
          }
        } else {
          return [];
        }
      };
      editor.ui.registry.addContextMenu('spellchecker', { update: update });
    };

    function Plugin () {
      global.add('spellchecker', function (editor, pluginUrl) {
        if (hasProPlugin(editor) === false) {
          var startedState = Cell(false);
          var currentLanguageState = Cell(getLanguage(editor));
          var textMatcherState = Cell(null);
          var lastSuggestionsState = Cell(null);
          register$1(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState);
          setup(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState);
          register(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);
          return get(editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState);
        }
      });
    }

    Plugin();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX3NwZWxsY2hlY2tlcl9pbmRleF9qcy5jaHVuay5qcyIsInNvdXJjZXMiOlsiL1VzZXJzL2xpdXlhbmcvcHJvamVjdHMvcmluZ3RvbmVfbmV3L25vZGVfbW9kdWxlcy90aW55bWNlL3BsdWdpbnMvc3BlbGxjaGVja2VyL2luZGV4LmpzIiwiL1VzZXJzL2xpdXlhbmcvcHJvamVjdHMvcmluZ3RvbmVfbmV3L25vZGVfbW9kdWxlcy90aW55bWNlL3BsdWdpbnMvc3BlbGxjaGVja2VyL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcInNwZWxsY2hlY2tlclwiIHBsdWdpbiBmb3IgdXNhZ2Ugd2l0aCBtb2R1bGUgbG9hZGVyc1xuLy8gVXNhZ2U6XG4vLyAgIENvbW1vbkpTOlxuLy8gICAgIHJlcXVpcmUoJ3RpbnltY2UvcGx1Z2lucy9zcGVsbGNoZWNrZXInKVxuLy8gICBFUzIwMTU6XG4vLyAgICAgaW1wb3J0ICd0aW55bWNlL3BsdWdpbnMvc3BlbGxjaGVja2VyJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgQ2VsbCA9IGZ1bmN0aW9uIChpbml0aWFsKSB7XG4gICAgICB2YXIgdmFsdWUgPSBpbml0aWFsO1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB2YWx1ZSA9IHY7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UuUGx1Z2luTWFuYWdlcicpO1xuXG4gICAgdmFyIGhhc1Byb1BsdWdpbiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGlmIChlZGl0b3IuaGFzUGx1Z2luKCd0aW55bWNlc3BlbGxjaGVja2VyJywgdHJ1ZSkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmNvbnNvbGUubG9nKSB7XG4gICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKCdTcGVsbCBDaGVja2VyIFBybyBpcyBpbmNvbXBhdGlibGUgd2l0aCBTcGVsbCBDaGVja2VyIHBsdWdpbiEgJyArICdSZW1vdmUgXFwnc3BlbGxjaGVja2VyXFwnIGZyb20gdGhlIFxcJ3BsdWdpbnNcXCcgb3B0aW9uLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QuaGFzT3duUHJvcGVydHk7XG4gICAgdmFyIGlzRW1wdHkgPSBmdW5jdGlvbiAocikge1xuICAgICAgZm9yICh2YXIgeCBpbiByKSB7XG4gICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHIsIHgpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCQxID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5Ub29scycpO1xuXG4gICAgdmFyIGdsb2JhbCQyID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoJ3RpbnltY2UudXRpbC5VUkknKTtcblxuICAgIHZhciBnbG9iYWwkMyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuWEhSJyk7XG5cbiAgICB2YXIgZmlyZVNwZWxsY2hlY2tTdGFydCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZmlyZSgnU3BlbGxjaGVja1N0YXJ0Jyk7XG4gICAgfTtcbiAgICB2YXIgZmlyZVNwZWxsY2hlY2tFbmQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmZpcmUoJ1NwZWxsY2hlY2tFbmQnKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldExhbmd1YWdlcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBkZWZhdWx0TGFuZ3VhZ2VzID0gJ0VuZ2xpc2g9ZW4sRGFuaXNoPWRhLER1dGNoPW5sLEZpbm5pc2g9ZmksRnJlbmNoPWZyX0ZSLEdlcm1hbj1kZSxJdGFsaWFuPWl0LFBvbGlzaD1wbCxQb3J0dWd1ZXNlPXB0X0JSLFNwYW5pc2g9ZXMsU3dlZGlzaD1zdic7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdzcGVsbGNoZWNrZXJfbGFuZ3VhZ2VzJywgZGVmYXVsdExhbmd1YWdlcyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TGFuZ3VhZ2UgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgZGVmYXVsdExhbmd1YWdlID0gZWRpdG9yLmdldFBhcmFtKCdsYW5ndWFnZScsICdlbicpO1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnc3BlbGxjaGVja2VyX2xhbmd1YWdlJywgZGVmYXVsdExhbmd1YWdlKTtcbiAgICB9O1xuICAgIHZhciBnZXRScGNVcmwgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdzcGVsbGNoZWNrZXJfcnBjX3VybCcpO1xuICAgIH07XG4gICAgdmFyIGdldFNwZWxsY2hlY2tlckNhbGxiYWNrID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgnc3BlbGxjaGVja2VyX2NhbGxiYWNrJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U3BlbGxjaGVja2VyV29yZGNoYXJQYXR0ZXJuID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGRlZmF1bHRQYXR0ZXJuID0gbmV3IFJlZ0V4cCgnW14nICsgJ1xcXFxzIVwiIyQlJigpKissLS4vOjs8PT4/QFtcXFxcXV5fe3x9YCcgKyAnXFx4QTdcXHhBOVxceEFCXFx4QUVcXHhCMVxceEI2XFx4QjdcXHhCOFxceEJCJyArICdcXHhCQ1xceEJEXFx4QkVcXHhCRlxceEQ3XFx4RjdcXHhBNFxcdTIwMURcXHUyMDFDXFx1MjAxRVxceEEwXFx1MjAwMlxcdTIwMDNcXHUyMDA5JyArICddKycsICdnJyk7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCdzcGVsbGNoZWNrZXJfd29yZGNoYXJfcGF0dGVybicsIGRlZmF1bHRQYXR0ZXJuKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzQ29udGVudEVkaXRhYmxlRmFsc2UgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMSAmJiBub2RlLmNvbnRlbnRFZGl0YWJsZSA9PT0gJ2ZhbHNlJztcbiAgICB9O1xuICAgIHZhciBEb21UZXh0TWF0Y2hlciA9IGZ1bmN0aW9uIChub2RlLCBlZGl0b3IpIHtcbiAgICAgIHZhciBtLCBtYXRjaGVzID0gW107XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBibG9ja0VsZW1lbnRzTWFwID0gZWRpdG9yLnNjaGVtYS5nZXRCbG9ja0VsZW1lbnRzKCk7XG4gICAgICB2YXIgaGlkZGVuVGV4dEVsZW1lbnRzTWFwID0gZWRpdG9yLnNjaGVtYS5nZXRXaGl0ZVNwYWNlRWxlbWVudHMoKTtcbiAgICAgIHZhciBzaG9ydEVuZGVkRWxlbWVudHNNYXAgPSBlZGl0b3Iuc2NoZW1hLmdldFNob3J0RW5kZWRFbGVtZW50cygpO1xuICAgICAgdmFyIGNyZWF0ZU1hdGNoID0gZnVuY3Rpb24gKG0sIGRhdGEpIHtcbiAgICAgICAgaWYgKCFtWzBdKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdmaW5kQW5kUmVwbGFjZURPTVRleHQgY2Fubm90IGhhbmRsZSB6ZXJvLWxlbmd0aCBtYXRjaGVzJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGFydDogbS5pbmRleCxcbiAgICAgICAgICBlbmQ6IG0uaW5kZXggKyBtWzBdLmxlbmd0aCxcbiAgICAgICAgICB0ZXh0OiBtWzBdLFxuICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VGV4dCA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHZhciB0eHQ7XG4gICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgcmV0dXJuIG5vZGUuZGF0YTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGlkZGVuVGV4dEVsZW1lbnRzTWFwW25vZGUubm9kZU5hbWVdICYmICFibG9ja0VsZW1lbnRzTWFwW25vZGUubm9kZU5hbWVdKSB7XG4gICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKG5vZGUpKSB7XG4gICAgICAgICAgcmV0dXJuICdcXG4nO1xuICAgICAgICB9XG4gICAgICAgIHR4dCA9ICcnO1xuICAgICAgICBpZiAoYmxvY2tFbGVtZW50c01hcFtub2RlLm5vZGVOYW1lXSB8fCBzaG9ydEVuZGVkRWxlbWVudHNNYXBbbm9kZS5ub2RlTmFtZV0pIHtcbiAgICAgICAgICB0eHQgKz0gJ1xcbic7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICBkbyB7XG4gICAgICAgICAgICB0eHQgKz0gZ2V0VGV4dChub2RlKTtcbiAgICAgICAgICB9IHdoaWxlIChub2RlID0gbm9kZS5uZXh0U2libGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHR4dDtcbiAgICAgIH07XG4gICAgICB2YXIgc3RlcFRocm91Z2hNYXRjaGVzID0gZnVuY3Rpb24gKG5vZGUsIG1hdGNoZXMsIHJlcGxhY2VGbikge1xuICAgICAgICB2YXIgc3RhcnROb2RlLCBlbmROb2RlLCBzdGFydE5vZGVJbmRleCwgZW5kTm9kZUluZGV4LCBpbm5lck5vZGVzID0gW10sIGF0SW5kZXggPSAwLCBjdXJOb2RlID0gbm9kZSwgbWF0Y2hMb2NhdGlvbiwgbWF0Y2hJbmRleCA9IDA7XG4gICAgICAgIG1hdGNoZXMgPSBtYXRjaGVzLnNsaWNlKDApO1xuICAgICAgICBtYXRjaGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICByZXR1cm4gYS5zdGFydCAtIGIuc3RhcnQ7XG4gICAgICAgIH0pO1xuICAgICAgICBtYXRjaExvY2F0aW9uID0gbWF0Y2hlcy5zaGlmdCgpO1xuICAgICAgICBvdXQ6XG4gICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIGlmIChibG9ja0VsZW1lbnRzTWFwW2N1ck5vZGUubm9kZU5hbWVdIHx8IHNob3J0RW5kZWRFbGVtZW50c01hcFtjdXJOb2RlLm5vZGVOYW1lXSB8fCBpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGN1ck5vZGUpKSB7XG4gICAgICAgICAgICAgIGF0SW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJOb2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgICAgIGlmICghZW5kTm9kZSAmJiBjdXJOb2RlLmxlbmd0aCArIGF0SW5kZXggPj0gbWF0Y2hMb2NhdGlvbi5lbmQpIHtcbiAgICAgICAgICAgICAgICBlbmROb2RlID0gY3VyTm9kZTtcbiAgICAgICAgICAgICAgICBlbmROb2RlSW5kZXggPSBtYXRjaExvY2F0aW9uLmVuZCAtIGF0SW5kZXg7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhcnROb2RlKSB7XG4gICAgICAgICAgICAgICAgaW5uZXJOb2Rlcy5wdXNoKGN1ck5vZGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICghc3RhcnROb2RlICYmIGN1ck5vZGUubGVuZ3RoICsgYXRJbmRleCA+IG1hdGNoTG9jYXRpb24uc3RhcnQpIHtcbiAgICAgICAgICAgICAgICBzdGFydE5vZGUgPSBjdXJOb2RlO1xuICAgICAgICAgICAgICAgIHN0YXJ0Tm9kZUluZGV4ID0gbWF0Y2hMb2NhdGlvbi5zdGFydCAtIGF0SW5kZXg7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYXRJbmRleCArPSBjdXJOb2RlLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGFydE5vZGUgJiYgZW5kTm9kZSkge1xuICAgICAgICAgICAgICBjdXJOb2RlID0gcmVwbGFjZUZuKHtcbiAgICAgICAgICAgICAgICBzdGFydE5vZGU6IHN0YXJ0Tm9kZSxcbiAgICAgICAgICAgICAgICBzdGFydE5vZGVJbmRleDogc3RhcnROb2RlSW5kZXgsXG4gICAgICAgICAgICAgICAgZW5kTm9kZTogZW5kTm9kZSxcbiAgICAgICAgICAgICAgICBlbmROb2RlSW5kZXg6IGVuZE5vZGVJbmRleCxcbiAgICAgICAgICAgICAgICBpbm5lck5vZGVzOiBpbm5lck5vZGVzLFxuICAgICAgICAgICAgICAgIG1hdGNoOiBtYXRjaExvY2F0aW9uLnRleHQsXG4gICAgICAgICAgICAgICAgbWF0Y2hJbmRleDogbWF0Y2hJbmRleFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYXRJbmRleCAtPSBlbmROb2RlLmxlbmd0aCAtIGVuZE5vZGVJbmRleDtcbiAgICAgICAgICAgICAgc3RhcnROb2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgZW5kTm9kZSA9IG51bGw7XG4gICAgICAgICAgICAgIGlubmVyTm9kZXMgPSBbXTtcbiAgICAgICAgICAgICAgbWF0Y2hMb2NhdGlvbiA9IG1hdGNoZXMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgbWF0Y2hJbmRleCsrO1xuICAgICAgICAgICAgICBpZiAoIW1hdGNoTG9jYXRpb24pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICgoIWhpZGRlblRleHRFbGVtZW50c01hcFtjdXJOb2RlLm5vZGVOYW1lXSB8fCBibG9ja0VsZW1lbnRzTWFwW2N1ck5vZGUubm9kZU5hbWVdKSAmJiBjdXJOb2RlLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICAgICAgaWYgKCFpc0NvbnRlbnRFZGl0YWJsZUZhbHNlKGN1ck5vZGUpKSB7XG4gICAgICAgICAgICAgICAgY3VyTm9kZSA9IGN1ck5vZGUuZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJOb2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgICAgIGN1ck5vZGUgPSBjdXJOb2RlLm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgIGlmIChjdXJOb2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgY3VyTm9kZSA9IGN1ck5vZGUubmV4dFNpYmxpbmc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VyTm9kZS5wYXJlbnROb2RlICE9PSBub2RlKSB7XG4gICAgICAgICAgICAgICAgY3VyTm9kZSA9IGN1ck5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBicmVhayBvdXQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGdlblJlcGxhY2VyID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBtYWtlUmVwbGFjZW1lbnROb2RlID0gZnVuY3Rpb24gKGZpbGwsIG1hdGNoSW5kZXgpIHtcbiAgICAgICAgICB2YXIgbWF0Y2ggPSBtYXRjaGVzW21hdGNoSW5kZXhdO1xuICAgICAgICAgIGlmICghbWF0Y2guc3RlbmNpbCkge1xuICAgICAgICAgICAgbWF0Y2guc3RlbmNpbCA9IGNhbGxiYWNrKG1hdGNoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGNsb25lID0gbWF0Y2guc3RlbmNpbC5jbG9uZU5vZGUoZmFsc2UpO1xuICAgICAgICAgIGNsb25lLnNldEF0dHJpYnV0ZSgnZGF0YS1tY2UtaW5kZXgnLCBtYXRjaEluZGV4KTtcbiAgICAgICAgICBpZiAoZmlsbCkge1xuICAgICAgICAgICAgY2xvbmUuYXBwZW5kQ2hpbGQoZG9tLmRvYy5jcmVhdGVUZXh0Tm9kZShmaWxsKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjbG9uZTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyYW5nZSkge1xuICAgICAgICAgIHZhciBiZWZvcmU7XG4gICAgICAgICAgdmFyIGFmdGVyO1xuICAgICAgICAgIHZhciBwYXJlbnROb2RlO1xuICAgICAgICAgIHZhciBzdGFydE5vZGUgPSByYW5nZS5zdGFydE5vZGU7XG4gICAgICAgICAgdmFyIGVuZE5vZGUgPSByYW5nZS5lbmROb2RlO1xuICAgICAgICAgIHZhciBtYXRjaEluZGV4ID0gcmFuZ2UubWF0Y2hJbmRleDtcbiAgICAgICAgICB2YXIgZG9jID0gZG9tLmRvYztcbiAgICAgICAgICBpZiAoc3RhcnROb2RlID09PSBlbmROb2RlKSB7XG4gICAgICAgICAgICB2YXIgbm9kZV8xID0gc3RhcnROb2RlO1xuICAgICAgICAgICAgcGFyZW50Tm9kZSA9IG5vZGVfMS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0Tm9kZUluZGV4ID4gMCkge1xuICAgICAgICAgICAgICBiZWZvcmUgPSBkb2MuY3JlYXRlVGV4dE5vZGUobm9kZV8xLmRhdGEuc3Vic3RyaW5nKDAsIHJhbmdlLnN0YXJ0Tm9kZUluZGV4KSk7XG4gICAgICAgICAgICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJlZm9yZSwgbm9kZV8xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBlbCA9IG1ha2VSZXBsYWNlbWVudE5vZGUocmFuZ2UubWF0Y2gsIG1hdGNoSW5kZXgpO1xuICAgICAgICAgICAgcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWwsIG5vZGVfMSk7XG4gICAgICAgICAgICBpZiAocmFuZ2UuZW5kTm9kZUluZGV4IDwgbm9kZV8xLmxlbmd0aCkge1xuICAgICAgICAgICAgICBhZnRlciA9IGRvYy5jcmVhdGVUZXh0Tm9kZShub2RlXzEuZGF0YS5zdWJzdHJpbmcocmFuZ2UuZW5kTm9kZUluZGV4KSk7XG4gICAgICAgICAgICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGFmdGVyLCBub2RlXzEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZV8xLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZV8xKTtcbiAgICAgICAgICAgIHJldHVybiBlbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYmVmb3JlID0gZG9jLmNyZWF0ZVRleHROb2RlKHN0YXJ0Tm9kZS5kYXRhLnN1YnN0cmluZygwLCByYW5nZS5zdGFydE5vZGVJbmRleCkpO1xuICAgICAgICAgIGFmdGVyID0gZG9jLmNyZWF0ZVRleHROb2RlKGVuZE5vZGUuZGF0YS5zdWJzdHJpbmcocmFuZ2UuZW5kTm9kZUluZGV4KSk7XG4gICAgICAgICAgdmFyIGVsQSA9IG1ha2VSZXBsYWNlbWVudE5vZGUoc3RhcnROb2RlLmRhdGEuc3Vic3RyaW5nKHJhbmdlLnN0YXJ0Tm9kZUluZGV4KSwgbWF0Y2hJbmRleCk7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSByYW5nZS5pbm5lck5vZGVzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgICAgICAgdmFyIGlubmVyTm9kZSA9IHJhbmdlLmlubmVyTm9kZXNbaV07XG4gICAgICAgICAgICB2YXIgaW5uZXJFbCA9IG1ha2VSZXBsYWNlbWVudE5vZGUoaW5uZXJOb2RlLmRhdGEsIG1hdGNoSW5kZXgpO1xuICAgICAgICAgICAgaW5uZXJOb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGlubmVyRWwsIGlubmVyTm9kZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBlbEIgPSBtYWtlUmVwbGFjZW1lbnROb2RlKGVuZE5vZGUuZGF0YS5zdWJzdHJpbmcoMCwgcmFuZ2UuZW5kTm9kZUluZGV4KSwgbWF0Y2hJbmRleCk7XG4gICAgICAgICAgcGFyZW50Tm9kZSA9IHN0YXJ0Tm9kZS5wYXJlbnROb2RlO1xuICAgICAgICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJlZm9yZSwgc3RhcnROb2RlKTtcbiAgICAgICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZShlbEEsIHN0YXJ0Tm9kZSk7XG4gICAgICAgICAgcGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzdGFydE5vZGUpO1xuICAgICAgICAgIHBhcmVudE5vZGUgPSBlbmROb2RlLnBhcmVudE5vZGU7XG4gICAgICAgICAgcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxCLCBlbmROb2RlKTtcbiAgICAgICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZShhZnRlciwgZW5kTm9kZSk7XG4gICAgICAgICAgcGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbmROb2RlKTtcbiAgICAgICAgICByZXR1cm4gZWxCO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciB1bndyYXBFbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICAgIHdoaWxlIChlbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW1lbnQuY2hpbGROb2Rlc1swXSwgZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcbiAgICAgIH07XG4gICAgICB2YXIgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgIHJldHVybiBlbG0uY2xhc3NOYW1lLmluZGV4T2YoJ21jZS1zcGVsbGNoZWNrZXItd29yZCcpICE9PSAtMTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0V3JhcHBlcnNCeUluZGV4ID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHZhciBlbGVtZW50cyA9IG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKSwgd3JhcHBlcnMgPSBbXTtcbiAgICAgICAgaW5kZXggPSB0eXBlb2YgaW5kZXggPT09ICdudW1iZXInID8gJycgKyBpbmRleCA6IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW2ldLCBkYXRhSW5kZXggPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtaW5kZXgnKTtcbiAgICAgICAgICBpZiAoZGF0YUluZGV4ICE9PSBudWxsICYmIGRhdGFJbmRleC5sZW5ndGggJiYgaGFzQ2xhc3MoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGlmIChkYXRhSW5kZXggPT09IGluZGV4IHx8IGluZGV4ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgIHdyYXBwZXJzLnB1c2goZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3cmFwcGVycztcbiAgICAgIH07XG4gICAgICB2YXIgaW5kZXhPZiA9IGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICB2YXIgaSA9IG1hdGNoZXMubGVuZ3RoO1xuICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgaWYgKG1hdGNoZXNbaV0gPT09IG1hdGNoKSB7XG4gICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfTtcbiAgICAgIGZ1bmN0aW9uIGZpbHRlcihjYWxsYmFjaykge1xuICAgICAgICB2YXIgZmlsdGVyZWRNYXRjaGVzID0gW107XG4gICAgICAgIGVhY2goZnVuY3Rpb24gKG1hdGNoLCBpKSB7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKG1hdGNoLCBpKSkge1xuICAgICAgICAgICAgZmlsdGVyZWRNYXRjaGVzLnB1c2gobWF0Y2gpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIG1hdGNoZXMgPSBmaWx0ZXJlZE1hdGNoZXM7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZWFjaChjYWxsYmFjaykge1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG1hdGNoZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKG1hdGNoZXNbaV0sIGkpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gd3JhcChjYWxsYmFjaykge1xuICAgICAgICBpZiAobWF0Y2hlcy5sZW5ndGgpIHtcbiAgICAgICAgICBzdGVwVGhyb3VnaE1hdGNoZXMobm9kZSwgbWF0Y2hlcywgZ2VuUmVwbGFjZXIoY2FsbGJhY2spKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGZpbmQocmVnZXgsIGRhdGEpIHtcbiAgICAgICAgaWYgKHRleHQgJiYgcmVnZXguZ2xvYmFsKSB7XG4gICAgICAgICAgd2hpbGUgKG0gPSByZWdleC5leGVjKHRleHQpKSB7XG4gICAgICAgICAgICBtYXRjaGVzLnB1c2goY3JlYXRlTWF0Y2gobSwgZGF0YSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIHVud3JhcChtYXRjaCkge1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gZ2V0V3JhcHBlcnNCeUluZGV4KG1hdGNoID8gaW5kZXhPZihtYXRjaCkgOiBudWxsKTtcbiAgICAgICAgaSA9IGVsZW1lbnRzLmxlbmd0aDtcbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgIHVud3JhcEVsZW1lbnQoZWxlbWVudHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgdmFyIG1hdGNoRnJvbUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlc1tlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1tY2UtaW5kZXgnKV07XG4gICAgICB9O1xuICAgICAgdmFyIGVsZW1lbnRGcm9tTWF0Y2ggPSBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGdldFdyYXBwZXJzQnlJbmRleChpbmRleE9mKG1hdGNoKSlbMF07XG4gICAgICB9O1xuICAgICAgZnVuY3Rpb24gYWRkKHN0YXJ0LCBsZW5ndGgsIGRhdGEpIHtcbiAgICAgICAgbWF0Y2hlcy5wdXNoKHtcbiAgICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgICAgZW5kOiBzdGFydCArIGxlbmd0aCxcbiAgICAgICAgICB0ZXh0OiB0ZXh0LnN1YnN0cihzdGFydCwgbGVuZ3RoKSxcbiAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHZhciByYW5nZUZyb21NYXRjaCA9IGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICB2YXIgd3JhcHBlcnMgPSBnZXRXcmFwcGVyc0J5SW5kZXgoaW5kZXhPZihtYXRjaCkpO1xuICAgICAgICB2YXIgcm5nID0gZWRpdG9yLmRvbS5jcmVhdGVSbmcoKTtcbiAgICAgICAgcm5nLnNldFN0YXJ0QmVmb3JlKHdyYXBwZXJzWzBdKTtcbiAgICAgICAgcm5nLnNldEVuZEFmdGVyKHdyYXBwZXJzW3dyYXBwZXJzLmxlbmd0aCAtIDFdKTtcbiAgICAgICAgcmV0dXJuIHJuZztcbiAgICAgIH07XG4gICAgICB2YXIgcmVwbGFjZSA9IGZ1bmN0aW9uIChtYXRjaCwgdGV4dCkge1xuICAgICAgICB2YXIgcm5nID0gcmFuZ2VGcm9tTWF0Y2gobWF0Y2gpO1xuICAgICAgICBybmcuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJuZy5pbnNlcnROb2RlKGVkaXRvci5kb20uZG9jLmNyZWF0ZVRleHROb2RlKHRleHQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcm5nO1xuICAgICAgfTtcbiAgICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgICBtYXRjaGVzLnNwbGljZSgwLCBtYXRjaGVzLmxlbmd0aCk7XG4gICAgICAgIHVud3JhcCgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHZhciB0ZXh0ID0gZ2V0VGV4dChub2RlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsXG4gICAgICAgIGVhY2g6IGVhY2gsXG4gICAgICAgIGZpbHRlcjogZmlsdGVyLFxuICAgICAgICByZXNldDogcmVzZXQsXG4gICAgICAgIG1hdGNoRnJvbUVsZW1lbnQ6IG1hdGNoRnJvbUVsZW1lbnQsXG4gICAgICAgIGVsZW1lbnRGcm9tTWF0Y2g6IGVsZW1lbnRGcm9tTWF0Y2gsXG4gICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgIGFkZDogYWRkLFxuICAgICAgICB3cmFwOiB3cmFwLFxuICAgICAgICB1bndyYXA6IHVud3JhcCxcbiAgICAgICAgcmVwbGFjZTogcmVwbGFjZSxcbiAgICAgICAgcmFuZ2VGcm9tTWF0Y2g6IHJhbmdlRnJvbU1hdGNoLFxuICAgICAgICBpbmRleE9mOiBpbmRleE9mXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZ2V0VGV4dE1hdGNoZXIgPSBmdW5jdGlvbiAoZWRpdG9yLCB0ZXh0TWF0Y2hlclN0YXRlKSB7XG4gICAgICBpZiAoIXRleHRNYXRjaGVyU3RhdGUuZ2V0KCkpIHtcbiAgICAgICAgdmFyIHRleHRNYXRjaGVyID0gRG9tVGV4dE1hdGNoZXIoZWRpdG9yLmdldEJvZHkoKSwgZWRpdG9yKTtcbiAgICAgICAgdGV4dE1hdGNoZXJTdGF0ZS5zZXQodGV4dE1hdGNoZXIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRleHRNYXRjaGVyU3RhdGUuZ2V0KCk7XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdFNwZWxsY2hlY2tDYWxsYmFjayA9IGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCwgY3VycmVudExhbmd1YWdlU3RhdGUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAobWV0aG9kLCB0ZXh0LCBkb25lQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgbWV0aG9kOiBtZXRob2QsXG4gICAgICAgICAgbGFuZzogY3VycmVudExhbmd1YWdlU3RhdGUuZ2V0KClcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHBvc3REYXRhID0gJyc7XG4gICAgICAgIGRhdGFbbWV0aG9kID09PSAnYWRkVG9EaWN0aW9uYXJ5JyA/ICd3b3JkJyA6ICd0ZXh0J10gPSB0ZXh0O1xuICAgICAgICBnbG9iYWwkMS5lYWNoKGRhdGEsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgaWYgKHBvc3REYXRhKSB7XG4gICAgICAgICAgICBwb3N0RGF0YSArPSAnJic7XG4gICAgICAgICAgfVxuICAgICAgICAgIHBvc3REYXRhICs9IGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBnbG9iYWwkMy5zZW5kKHtcbiAgICAgICAgICB1cmw6IG5ldyBnbG9iYWwkMihwbHVnaW5VcmwpLnRvQWJzb2x1dGUoZ2V0UnBjVXJsKGVkaXRvcikpLFxuICAgICAgICAgIHR5cGU6ICdwb3N0JyxcbiAgICAgICAgICBjb250ZW50X3R5cGU6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnLFxuICAgICAgICAgIGRhdGE6IHBvc3REYXRhLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHZhciBwYXJzZVJlc3VsdCA9IEpTT04ucGFyc2UocmVzdWx0KTtcbiAgICAgICAgICAgIGlmICghcGFyc2VSZXN1bHQpIHtcbiAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBlZGl0b3IudHJhbnNsYXRlKCdTZXJ2ZXIgcmVzcG9uc2Ugd2FzblxcJ3QgcHJvcGVyIEpTT04uJyk7XG4gICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2sobWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnNlUmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2socGFyc2VSZXN1bHQuZXJyb3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZG9uZUNhbGxiYWNrKHBhcnNlUmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGVkaXRvci50cmFuc2xhdGUoJ1RoZSBzcGVsbGluZyBzZXJ2aWNlIHdhcyBub3QgZm91bmQ6ICgnKSArIGdldFJwY1VybChlZGl0b3IpICsgZWRpdG9yLnRyYW5zbGF0ZSgnKScpO1xuICAgICAgICAgICAgZXJyb3JDYWxsYmFjayhtZXNzYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBzZW5kUnBjQ2FsbCA9IGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCwgY3VycmVudExhbmd1YWdlU3RhdGUsIG5hbWUsIGRhdGEsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICAgICAgdmFyIHVzZXJTcGVsbGNoZWNrQ2FsbGJhY2sgPSBnZXRTcGVsbGNoZWNrZXJDYWxsYmFjayhlZGl0b3IpO1xuICAgICAgdmFyIHNwZWxsQ2hlY2tDYWxsYmFjayA9IHVzZXJTcGVsbGNoZWNrQ2FsbGJhY2sgPyB1c2VyU3BlbGxjaGVja0NhbGxiYWNrIDogZGVmYXVsdFNwZWxsY2hlY2tDYWxsYmFjayhlZGl0b3IsIHBsdWdpblVybCwgY3VycmVudExhbmd1YWdlU3RhdGUpO1xuICAgICAgc3BlbGxDaGVja0NhbGxiYWNrLmNhbGwoZWRpdG9yLnBsdWdpbnMuc3BlbGxjaGVja2VyLCBuYW1lLCBkYXRhLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xuICAgIH07XG4gICAgdmFyIHNwZWxsY2hlY2sgPSBmdW5jdGlvbiAoZWRpdG9yLCBwbHVnaW5VcmwsIHN0YXJ0ZWRTdGF0ZSwgdGV4dE1hdGNoZXJTdGF0ZSwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUsIGN1cnJlbnRMYW5ndWFnZVN0YXRlKSB7XG4gICAgICBpZiAoZmluaXNoKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgZXJyb3JDYWxsYmFjayA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIGVkaXRvci5ub3RpZmljYXRpb25NYW5hZ2VyLm9wZW4oe1xuICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXG4gICAgICAgICAgdHlwZTogJ2Vycm9yJ1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLnNldFByb2dyZXNzU3RhdGUoZmFsc2UpO1xuICAgICAgICBmaW5pc2goZWRpdG9yLCBzdGFydGVkU3RhdGUsIHRleHRNYXRjaGVyU3RhdGUpO1xuICAgICAgfTtcbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBtYXJrRXJyb3JzKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgZGF0YSk7XG4gICAgICB9O1xuICAgICAgZWRpdG9yLnNldFByb2dyZXNzU3RhdGUodHJ1ZSk7XG4gICAgICBzZW5kUnBjQ2FsbChlZGl0b3IsIHBsdWdpblVybCwgY3VycmVudExhbmd1YWdlU3RhdGUsICdzcGVsbGNoZWNrJywgZ2V0VGV4dE1hdGNoZXIoZWRpdG9yLCB0ZXh0TWF0Y2hlclN0YXRlKS50ZXh0LCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xuICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgfTtcbiAgICB2YXIgY2hlY2tJZkZpbmlzaGVkID0gZnVuY3Rpb24gKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlKSB7XG4gICAgICBpZiAoIWVkaXRvci5kb20uc2VsZWN0KCdzcGFuLm1jZS1zcGVsbGNoZWNrZXItd29yZCcpLmxlbmd0aCkge1xuICAgICAgICBmaW5pc2goZWRpdG9yLCBzdGFydGVkU3RhdGUsIHRleHRNYXRjaGVyU3RhdGUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGFkZFRvRGljdGlvbmFyeSA9IGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSwgd29yZCwgc3BhbnMpIHtcbiAgICAgIGVkaXRvci5zZXRQcm9ncmVzc1N0YXRlKHRydWUpO1xuICAgICAgc2VuZFJwY0NhbGwoZWRpdG9yLCBwbHVnaW5VcmwsIGN1cnJlbnRMYW5ndWFnZVN0YXRlLCAnYWRkVG9EaWN0aW9uYXJ5Jywgd29yZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBlZGl0b3Iuc2V0UHJvZ3Jlc3NTdGF0ZShmYWxzZSk7XG4gICAgICAgIGVkaXRvci5kb20ucmVtb3ZlKHNwYW5zLCB0cnVlKTtcbiAgICAgICAgY2hlY2tJZkZpbmlzaGVkKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIGVkaXRvci5ub3RpZmljYXRpb25NYW5hZ2VyLm9wZW4oe1xuICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXG4gICAgICAgICAgdHlwZTogJ2Vycm9yJ1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLnNldFByb2dyZXNzU3RhdGUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaWdub3JlV29yZCA9IGZ1bmN0aW9uIChlZGl0b3IsIHN0YXJ0ZWRTdGF0ZSwgdGV4dE1hdGNoZXJTdGF0ZSwgd29yZCwgc3BhbnMsIGFsbCkge1xuICAgICAgZWRpdG9yLnNlbGVjdGlvbi5jb2xsYXBzZSgpO1xuICAgICAgaWYgKGFsbCkge1xuICAgICAgICBnbG9iYWwkMS5lYWNoKGVkaXRvci5kb20uc2VsZWN0KCdzcGFuLm1jZS1zcGVsbGNoZWNrZXItd29yZCcpLCBmdW5jdGlvbiAoc3Bhbikge1xuICAgICAgICAgIGlmIChzcGFuLmdldEF0dHJpYnV0ZSgnZGF0YS1tY2Utd29yZCcpID09PSB3b3JkKSB7XG4gICAgICAgICAgICBlZGl0b3IuZG9tLnJlbW92ZShzcGFuLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWRpdG9yLmRvbS5yZW1vdmUoc3BhbnMsIHRydWUpO1xuICAgICAgfVxuICAgICAgY2hlY2tJZkZpbmlzaGVkKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlKTtcbiAgICB9O1xuICAgIHZhciBmaW5pc2ggPSBmdW5jdGlvbiAoZWRpdG9yLCBzdGFydGVkU3RhdGUsIHRleHRNYXRjaGVyU3RhdGUpIHtcbiAgICAgIHZhciBib29rbWFyayA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Qm9va21hcmsoKTtcbiAgICAgIGdldFRleHRNYXRjaGVyKGVkaXRvciwgdGV4dE1hdGNoZXJTdGF0ZSkucmVzZXQoKTtcbiAgICAgIGVkaXRvci5zZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuICAgICAgdGV4dE1hdGNoZXJTdGF0ZS5zZXQobnVsbCk7XG4gICAgICBpZiAoc3RhcnRlZFN0YXRlLmdldCgpKSB7XG4gICAgICAgIHN0YXJ0ZWRTdGF0ZS5zZXQoZmFsc2UpO1xuICAgICAgICBmaXJlU3BlbGxjaGVja0VuZChlZGl0b3IpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRFbG1JbmRleCA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHZhciB2YWx1ZSA9IGVsbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWNlLWluZGV4Jyk7XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gJycgKyB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9O1xuICAgIHZhciBmaW5kU3BhbnNCeUluZGV4ID0gZnVuY3Rpb24gKGVkaXRvciwgaW5kZXgpIHtcbiAgICAgIHZhciBzcGFucyA9IFtdO1xuICAgICAgdmFyIG5vZGVzID0gZ2xvYmFsJDEudG9BcnJheShlZGl0b3IuZ2V0Qm9keSgpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzcGFuJykpO1xuICAgICAgaWYgKG5vZGVzLmxlbmd0aCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIG5vZGVJbmRleCA9IGdldEVsbUluZGV4KG5vZGVzW2ldKTtcbiAgICAgICAgICBpZiAobm9kZUluZGV4ID09PSBudWxsIHx8ICFub2RlSW5kZXgubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG5vZGVJbmRleCA9PT0gaW5kZXgudG9TdHJpbmcoKSkge1xuICAgICAgICAgICAgc3BhbnMucHVzaChub2Rlc1tpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3BhbnM7XG4gICAgfTtcbiAgICB2YXIgbWFya0Vycm9ycyA9IGZ1bmN0aW9uIChlZGl0b3IsIHN0YXJ0ZWRTdGF0ZSwgdGV4dE1hdGNoZXJTdGF0ZSwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUsIGRhdGEpIHtcbiAgICAgIHZhciBoYXNEaWN0aW9uYXJ5U3VwcG9ydCA9ICEhZGF0YS5kaWN0aW9uYXJ5O1xuICAgICAgdmFyIHN1Z2dlc3Rpb25zID0gZGF0YS53b3JkcztcbiAgICAgIGVkaXRvci5zZXRQcm9ncmVzc1N0YXRlKGZhbHNlKTtcbiAgICAgIGlmIChpc0VtcHR5KHN1Z2dlc3Rpb25zKSkge1xuICAgICAgICB2YXIgbWVzc2FnZSA9IGVkaXRvci50cmFuc2xhdGUoJ05vIG1pc3NwZWxsaW5ncyBmb3VuZC4nKTtcbiAgICAgICAgZWRpdG9yLm5vdGlmaWNhdGlvbk1hbmFnZXIub3Blbih7XG4gICAgICAgICAgdGV4dDogbWVzc2FnZSxcbiAgICAgICAgICB0eXBlOiAnaW5mbydcbiAgICAgICAgfSk7XG4gICAgICAgIHN0YXJ0ZWRTdGF0ZS5zZXQoZmFsc2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsYXN0U3VnZ2VzdGlvbnNTdGF0ZS5zZXQoe1xuICAgICAgICBzdWdnZXN0aW9uczogc3VnZ2VzdGlvbnMsXG4gICAgICAgIGhhc0RpY3Rpb25hcnlTdXBwb3J0OiBoYXNEaWN0aW9uYXJ5U3VwcG9ydFxuICAgICAgfSk7XG4gICAgICB2YXIgYm9va21hcmsgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldEJvb2ttYXJrKCk7XG4gICAgICBnZXRUZXh0TWF0Y2hlcihlZGl0b3IsIHRleHRNYXRjaGVyU3RhdGUpLmZpbmQoZ2V0U3BlbGxjaGVja2VyV29yZGNoYXJQYXR0ZXJuKGVkaXRvcikpLmZpbHRlcihmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuICEhc3VnZ2VzdGlvbnNbbWF0Y2gudGV4dF07XG4gICAgICB9KS53cmFwKGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmRvbS5jcmVhdGUoJ3NwYW4nLCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ21jZS1zcGVsbGNoZWNrZXItd29yZCcsXG4gICAgICAgICAgJ2FyaWEtaW52YWxpZCc6ICdzcGVsbGluZycsXG4gICAgICAgICAgJ2RhdGEtbWNlLWJvZ3VzJzogMSxcbiAgICAgICAgICAnZGF0YS1tY2Utd29yZCc6IG1hdGNoLnRleHRcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5zZWxlY3Rpb24ubW92ZVRvQm9va21hcmsoYm9va21hcmspO1xuICAgICAgc3RhcnRlZFN0YXRlLnNldCh0cnVlKTtcbiAgICAgIGZpcmVTcGVsbGNoZWNrU3RhcnQoZWRpdG9yKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldCA9IGZ1bmN0aW9uIChlZGl0b3IsIHN0YXJ0ZWRTdGF0ZSwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUsIHRleHRNYXRjaGVyU3RhdGUsIGN1cnJlbnRMYW5ndWFnZVN0YXRlLCBfdXJsKSB7XG4gICAgICB2YXIgZ2V0V29yZENoYXJQYXR0ZXJuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0U3BlbGxjaGVja2VyV29yZGNoYXJQYXR0ZXJuKGVkaXRvcik7XG4gICAgICB9O1xuICAgICAgdmFyIG1hcmtFcnJvcnMkMSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIG1hcmtFcnJvcnMoZWRpdG9yLCBzdGFydGVkU3RhdGUsIHRleHRNYXRjaGVyU3RhdGUsIGxhc3RTdWdnZXN0aW9uc1N0YXRlLCBkYXRhKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRUZXh0TWF0Y2hlcjogdGV4dE1hdGNoZXJTdGF0ZS5nZXQsXG4gICAgICAgIGdldFdvcmRDaGFyUGF0dGVybjogZ2V0V29yZENoYXJQYXR0ZXJuLFxuICAgICAgICBtYXJrRXJyb3JzOiBtYXJrRXJyb3JzJDEsXG4gICAgICAgIGdldExhbmd1YWdlOiBjdXJyZW50TGFuZ3VhZ2VTdGF0ZS5nZXRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgY3VycmVudExhbmd1YWdlU3RhdGUpIHtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VTcGVsbENoZWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzcGVsbGNoZWNrKGVkaXRvciwgcGx1Z2luVXJsLCBzdGFydGVkU3RhdGUsIHRleHRNYXRjaGVyU3RhdGUsIGxhc3RTdWdnZXN0aW9uc1N0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpXG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICAgIH07XG4gICAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgdmFyIHNwZWxsY2hlY2tlckV2ZW50cyA9ICdTcGVsbGNoZWNrU3RhcnQgU3BlbGxjaGVja0VuZCc7XG4gICAgdmFyIGJ1aWxkTWVudUl0ZW1zID0gZnVuY3Rpb24gKGxpc3ROYW1lLCBsYW5ndWFnZVZhbHVlcykge1xuICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICBnbG9iYWwkMS5lYWNoKGxhbmd1YWdlVmFsdWVzLCBmdW5jdGlvbiAobGFuZ3VhZ2VWYWx1ZSkge1xuICAgICAgICBpdGVtcy5wdXNoKHtcbiAgICAgICAgICBzZWxlY3RhYmxlOiB0cnVlLFxuICAgICAgICAgIHRleHQ6IGxhbmd1YWdlVmFsdWUubmFtZSxcbiAgICAgICAgICBkYXRhOiBsYW5ndWFnZVZhbHVlLnZhbHVlXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gaXRlbXM7XG4gICAgfTtcbiAgICB2YXIgZ2V0SXRlbXMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2xvYmFsJDEubWFwKGdldExhbmd1YWdlcyhlZGl0b3IpLnNwbGl0KCcsJyksIGZ1bmN0aW9uIChsYW5nUGFpcikge1xuICAgICAgICB2YXIgbGFuZ1BhaXJzID0gbGFuZ1BhaXIuc3BsaXQoJz0nKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBuYW1lOiBsYW5nUGFpcnNbMF0sXG4gICAgICAgICAgdmFsdWU6IGxhbmdQYWlyc1sxXVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVnaXN0ZXIkMSA9IGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUpIHtcbiAgICAgIHZhciBsYW5ndWFnZU1lbnVJdGVtcyA9IGJ1aWxkTWVudUl0ZW1zKCdMYW5ndWFnZScsIGdldEl0ZW1zKGVkaXRvcikpO1xuICAgICAgdmFyIHN0YXJ0U3BlbGxjaGVja2luZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3BlbGxjaGVjayhlZGl0b3IsIHBsdWdpblVybCwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgY3VycmVudExhbmd1YWdlU3RhdGUpO1xuICAgICAgfTtcbiAgICAgIHZhciBidXR0b25BcmdzID0ge1xuICAgICAgICB0b29sdGlwOiAnU3BlbGxjaGVjaycsXG4gICAgICAgIG9uQWN0aW9uOiBzdGFydFNwZWxsY2hlY2tpbmcsXG4gICAgICAgIGljb246ICdzcGVsbC1jaGVjaycsXG4gICAgICAgIG9uU2V0dXA6IGZ1bmN0aW9uIChidXR0b25BcGkpIHtcbiAgICAgICAgICB2YXIgc2V0QnV0dG9uU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBidXR0b25BcGkuc2V0QWN0aXZlKHN0YXJ0ZWRTdGF0ZS5nZXQoKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBlZGl0b3Iub24oc3BlbGxjaGVja2VyRXZlbnRzLCBzZXRCdXR0b25TdGF0ZSk7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGVkaXRvci5vZmYoc3BlbGxjaGVja2VyRXZlbnRzLCBzZXRCdXR0b25TdGF0ZSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBzcGxpdEJ1dHRvbkFyZ3MgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYnV0dG9uQXJncyksIHtcbiAgICAgICAgdHlwZTogJ3NwbGl0YnV0dG9uJyxcbiAgICAgICAgc2VsZWN0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IGN1cnJlbnRMYW5ndWFnZVN0YXRlLmdldCgpO1xuICAgICAgICB9LFxuICAgICAgICBmZXRjaDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyIGl0ZW1zID0gZ2xvYmFsJDEubWFwKGxhbmd1YWdlTWVudUl0ZW1zLCBmdW5jdGlvbiAobGFuZ3VhZ2VJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0eXBlOiAnY2hvaWNlaXRlbScsXG4gICAgICAgICAgICAgIHZhbHVlOiBsYW5ndWFnZUl0ZW0uZGF0YSxcbiAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2VJdGVtLnRleHRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY2FsbGJhY2soaXRlbXMpO1xuICAgICAgICB9LFxuICAgICAgICBvbkl0ZW1BY3Rpb246IGZ1bmN0aW9uIChzcGxpdEJ1dHRvbkFwaSwgdmFsdWUpIHtcbiAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2VTdGF0ZS5zZXQodmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChsYW5ndWFnZU1lbnVJdGVtcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRTcGxpdEJ1dHRvbignc3BlbGxjaGVja2VyJywgc3BsaXRCdXR0b25BcmdzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24oJ3NwZWxsY2hlY2tlcicsIGJ1dHRvbkFyZ3MpO1xuICAgICAgfVxuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZFRvZ2dsZU1lbnVJdGVtKCdzcGVsbGNoZWNrZXInLCB7XG4gICAgICAgIHRleHQ6ICdTcGVsbGNoZWNrJyxcbiAgICAgICAgaWNvbjogJ3NwZWxsLWNoZWNrJyxcbiAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gKG1lbnVBcGkpIHtcbiAgICAgICAgICBtZW51QXBpLnNldEFjdGl2ZShzdGFydGVkU3RhdGUuZ2V0KCkpO1xuICAgICAgICAgIHZhciBzZXRNZW51SXRlbUNoZWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbWVudUFwaS5zZXRBY3RpdmUoc3RhcnRlZFN0YXRlLmdldCgpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGVkaXRvci5vbihzcGVsbGNoZWNrZXJFdmVudHMsIHNldE1lbnVJdGVtQ2hlY2spO1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBlZGl0b3Iub2ZmKHNwZWxsY2hlY2tlckV2ZW50cywgc2V0TWVudUl0ZW1DaGVjayk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgb25BY3Rpb246IHN0YXJ0U3BlbGxjaGVja2luZ1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBpZ25vcmVBbGwgPSB0cnVlO1xuICAgIHZhciBnZXRTdWdnZXN0aW9ucyA9IGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUsIHN0YXJ0ZWRTdGF0ZSwgdGV4dE1hdGNoZXJTdGF0ZSwgY3VycmVudExhbmd1YWdlU3RhdGUsIHdvcmQsIHNwYW5zKSB7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICAgIHZhciBzdWdnZXN0aW9ucyA9IGxhc3RTdWdnZXN0aW9uc1N0YXRlLmdldCgpLnN1Z2dlc3Rpb25zW3dvcmRdO1xuICAgICAgZ2xvYmFsJDEuZWFjaChzdWdnZXN0aW9ucywgZnVuY3Rpb24gKHN1Z2dlc3Rpb24pIHtcbiAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgdGV4dDogc3VnZ2VzdGlvbixcbiAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZWRpdG9yLmluc2VydENvbnRlbnQoZWRpdG9yLmRvbS5lbmNvZGUoc3VnZ2VzdGlvbikpO1xuICAgICAgICAgICAgZWRpdG9yLmRvbS5yZW1vdmUoc3BhbnMpO1xuICAgICAgICAgICAgY2hlY2tJZkZpbmlzaGVkKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgaGFzRGljdGlvbmFyeVN1cHBvcnQgPSBsYXN0U3VnZ2VzdGlvbnNTdGF0ZS5nZXQoKS5oYXNEaWN0aW9uYXJ5U3VwcG9ydDtcbiAgICAgIGlmIChoYXNEaWN0aW9uYXJ5U3VwcG9ydCkge1xuICAgICAgICBpdGVtcy5wdXNoKHsgdHlwZTogJ3NlcGFyYXRvcicgfSk7XG4gICAgICAgIGl0ZW1zLnB1c2goe1xuICAgICAgICAgIHRleHQ6ICdBZGQgdG8gZGljdGlvbmFyeScsXG4gICAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGFkZFRvRGljdGlvbmFyeShlZGl0b3IsIHBsdWdpblVybCwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSwgd29yZCwgc3BhbnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpdGVtcy5wdXNoLmFwcGx5KGl0ZW1zLCBbXG4gICAgICAgIHsgdHlwZTogJ3NlcGFyYXRvcicgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRleHQ6ICdJZ25vcmUnLFxuICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZ25vcmVXb3JkKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCB3b3JkLCBzcGFucyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdGV4dDogJ0lnbm9yZSBhbGwnLFxuICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZ25vcmVXb3JkKGVkaXRvciwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCB3b3JkLCBzcGFucywgaWdub3JlQWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF0pO1xuICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH07XG4gICAgdmFyIHNldHVwID0gZnVuY3Rpb24gKGVkaXRvciwgcGx1Z2luVXJsLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSkge1xuICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSBlbGVtZW50O1xuICAgICAgICBpZiAodGFyZ2V0LmNsYXNzTmFtZSA9PT0gJ21jZS1zcGVsbGNoZWNrZXItd29yZCcpIHtcbiAgICAgICAgICB2YXIgc3BhbnMgPSBmaW5kU3BhbnNCeUluZGV4KGVkaXRvciwgZ2V0RWxtSW5kZXgodGFyZ2V0KSk7XG4gICAgICAgICAgaWYgKHNwYW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBybmcgPSBlZGl0b3IuZG9tLmNyZWF0ZVJuZygpO1xuICAgICAgICAgICAgcm5nLnNldFN0YXJ0QmVmb3JlKHNwYW5zWzBdKTtcbiAgICAgICAgICAgIHJuZy5zZXRFbmRBZnRlcihzcGFuc1tzcGFucy5sZW5ndGggLSAxXSk7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhybmcpO1xuICAgICAgICAgICAgcmV0dXJuIGdldFN1Z2dlc3Rpb25zKGVkaXRvciwgcGx1Z2luVXJsLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1tY2Utd29yZCcpLCBzcGFucyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRDb250ZXh0TWVudSgnc3BlbGxjaGVja2VyJywgeyB1cGRhdGU6IHVwZGF0ZSB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gUGx1Z2luICgpIHtcbiAgICAgIGdsb2JhbC5hZGQoJ3NwZWxsY2hlY2tlcicsIGZ1bmN0aW9uIChlZGl0b3IsIHBsdWdpblVybCkge1xuICAgICAgICBpZiAoaGFzUHJvUGx1Z2luKGVkaXRvcikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgdmFyIHN0YXJ0ZWRTdGF0ZSA9IENlbGwoZmFsc2UpO1xuICAgICAgICAgIHZhciBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSA9IENlbGwoZ2V0TGFuZ3VhZ2UoZWRpdG9yKSk7XG4gICAgICAgICAgdmFyIHRleHRNYXRjaGVyU3RhdGUgPSBDZWxsKG51bGwpO1xuICAgICAgICAgIHZhciBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSA9IENlbGwobnVsbCk7XG4gICAgICAgICAgcmVnaXN0ZXIkMShlZGl0b3IsIHBsdWdpblVybCwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUpO1xuICAgICAgICAgIHNldHVwKGVkaXRvciwgcGx1Z2luVXJsLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgc3RhcnRlZFN0YXRlLCB0ZXh0TWF0Y2hlclN0YXRlLCBjdXJyZW50TGFuZ3VhZ2VTdGF0ZSk7XG4gICAgICAgICAgcmVnaXN0ZXIoZWRpdG9yLCBwbHVnaW5VcmwsIHN0YXJ0ZWRTdGF0ZSwgdGV4dE1hdGNoZXJTdGF0ZSwgbGFzdFN1Z2dlc3Rpb25zU3RhdGUsIGN1cnJlbnRMYW5ndWFnZVN0YXRlKTtcbiAgICAgICAgICByZXR1cm4gZ2V0KGVkaXRvciwgc3RhcnRlZFN0YXRlLCBsYXN0U3VnZ2VzdGlvbnNTdGF0ZSwgdGV4dE1hdGNoZXJTdGF0ZSwgY3VycmVudExhbmd1YWdlU3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBQbHVnaW4oKTtcblxufSgpKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7Ozs7Ozs7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QTs7QSIsInNvdXJjZVJvb3QiOiIifQ==