(self["webpackChunkringtone"] = self["webpackChunkringtone"] || []).push([["vendors-node_modules_tinymce_plugins_table_index_js"],{

/***/ "./node_modules/tinymce/plugins/table/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/table/index.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __unused_webpack_exports, __webpack_require__) => {

// Exports the "table" plugin for usage with module loaders
// Usage:
//   CommonJS:
//     require('tinymce/plugins/table')
//   ES2015:
//     import 'tinymce/plugins/table'
__webpack_require__(/*! ./plugin.js */ "./node_modules/tinymce/plugins/table/plugin.js");

/***/ }),

/***/ "./node_modules/tinymce/plugins/table/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/table/plugin.js ***!
  \******************************************************/
/***/ (() => {

/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.8.1 (2021-05-20)
 */
(function () {
    'use strict';

    var typeOf = function (x) {
      var t = typeof x;
      if (x === null) {
        return 'null';
      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {
        return 'array';
      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {
        return 'string';
      } else {
        return t;
      }
    };
    var isType = function (type) {
      return function (value) {
        return typeOf(value) === type;
      };
    };
    var isSimpleType = function (type) {
      return function (value) {
        return typeof value === type;
      };
    };
    var eq = function (t) {
      return function (a) {
        return t === a;
      };
    };
    var isString = isType('string');
    var isObject = isType('object');
    var isArray = isType('array');
    var isBoolean = isSimpleType('boolean');
    var isUndefined = eq(undefined);
    var isNullable = function (a) {
      return a === null || a === undefined;
    };
    var isNonNullable = function (a) {
      return !isNullable(a);
    };
    var isFunction = isSimpleType('function');
    var isNumber = isSimpleType('number');

    var noop = function () {
    };
    var compose = function (fa, fb) {
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        return fa(fb.apply(null, args));
      };
    };
    var compose1 = function (fbc, fab) {
      return function (a) {
        return fbc(fab(a));
      };
    };
    var constant = function (value) {
      return function () {
        return value;
      };
    };
    var identity = function (x) {
      return x;
    };
    function curry(fn) {
      var initialArgs = [];
      for (var _i = 1; _i < arguments.length; _i++) {
        initialArgs[_i - 1] = arguments[_i];
      }
      return function () {
        var restArgs = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          restArgs[_i] = arguments[_i];
        }
        var all = initialArgs.concat(restArgs);
        return fn.apply(null, all);
      };
    }
    var not = function (f) {
      return function (t) {
        return !f(t);
      };
    };
    var die = function (msg) {
      return function () {
        throw new Error(msg);
      };
    };
    var never = constant(false);
    var always = constant(true);

    var none = function () {
      return NONE;
    };
    var NONE = function () {
      var eq = function (o) {
        return o.isNone();
      };
      var call = function (thunk) {
        return thunk();
      };
      var id = function (n) {
        return n;
      };
      var me = {
        fold: function (n, _s) {
          return n();
        },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        getOrNull: constant(null),
        getOrUndefined: constant(undefined),
        or: id,
        orThunk: call,
        map: none,
        each: noop,
        bind: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () {
          return [];
        },
        toString: constant('none()')
      };
      return me;
    }();
    var some = function (a) {
      var constant_a = constant(a);
      var self = function () {
        return me;
      };
      var bind = function (f) {
        return f(a);
      };
      var me = {
        fold: function (n, s) {
          return s(a);
        },
        is: function (v) {
          return a === v;
        },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        getOrNull: constant_a,
        getOrUndefined: constant_a,
        or: self,
        orThunk: self,
        map: function (f) {
          return some(f(a));
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(never, function (b) {
            return elementEq(a, b);
          });
        }
      };
      return me;
    };
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };
    var Optional = {
      some: some,
      none: none,
      from: from
    };

    var nativeSlice = Array.prototype.slice;
    var nativeIndexOf = Array.prototype.indexOf;
    var nativePush = Array.prototype.push;
    var rawIndexOf = function (ts, t) {
      return nativeIndexOf.call(ts, t);
    };
    var contains = function (xs, x) {
      return rawIndexOf(xs, x) > -1;
    };
    var exists = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return true;
        }
      }
      return false;
    };
    var range = function (num, f) {
      var r = [];
      for (var i = 0; i < num; i++) {
        r.push(f(i));
      }
      return r;
    };
    var map = function (xs, f) {
      var len = xs.length;
      var r = new Array(len);
      for (var i = 0; i < len; i++) {
        var x = xs[i];
        r[i] = f(x, i);
      }
      return r;
    };
    var each = function (xs, f) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        f(x, i);
      }
    };
    var eachr = function (xs, f) {
      for (var i = xs.length - 1; i >= 0; i--) {
        var x = xs[i];
        f(x, i);
      }
    };
    var partition = function (xs, pred) {
      var pass = [];
      var fail = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        var arr = pred(x, i) ? pass : fail;
        arr.push(x);
      }
      return {
        pass: pass,
        fail: fail
      };
    };
    var filter = function (xs, pred) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          r.push(x);
        }
      }
      return r;
    };
    var foldr = function (xs, f, acc) {
      eachr(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var foldl = function (xs, f, acc) {
      each(xs, function (x) {
        acc = f(acc, x);
      });
      return acc;
    };
    var findUntil = function (xs, pred, until) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return Optional.some(x);
        } else if (until(x, i)) {
          break;
        }
      }
      return Optional.none();
    };
    var find = function (xs, pred) {
      return findUntil(xs, pred, never);
    };
    var findIndex = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i)) {
          return Optional.some(i);
        }
      }
      return Optional.none();
    };
    var flatten = function (xs) {
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (!isArray(xs[i])) {
          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        }
        nativePush.apply(r, xs[i]);
      }
      return r;
    };
    var bind = function (xs, f) {
      return flatten(map(xs, f));
    };
    var forall = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; ++i) {
        var x = xs[i];
        if (pred(x, i) !== true) {
          return false;
        }
      }
      return true;
    };
    var reverse = function (xs) {
      var r = nativeSlice.call(xs, 0);
      r.reverse();
      return r;
    };
    var mapToObject = function (xs, f) {
      var r = {};
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        r[String(x)] = f(x, i);
      }
      return r;
    };
    var pure = function (x) {
      return [x];
    };
    var sort = function (xs, comparator) {
      var copy = nativeSlice.call(xs, 0);
      copy.sort(comparator);
      return copy;
    };
    var get = function (xs, i) {
      return i >= 0 && i < xs.length ? Optional.some(xs[i]) : Optional.none();
    };
    var head = function (xs) {
      return get(xs, 0);
    };
    var last = function (xs) {
      return get(xs, xs.length - 1);
    };
    var findMap = function (arr, f) {
      for (var i = 0; i < arr.length; i++) {
        var r = f(arr[i], i);
        if (r.isSome()) {
          return r;
        }
      }
      return Optional.none();
    };

    var __assign = function () {
      __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
          s = arguments[i];
          for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p))
              t[p] = s[p];
        }
        return t;
      };
      return __assign.apply(this, arguments);
    };
    function __spreadArrays() {
      for (var s = 0, i = 0, il = arguments.length; i < il; i++)
        s += arguments[i].length;
      for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
          r[k] = a[j];
      return r;
    }

    var cached = function (f) {
      var called = false;
      var r;
      return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        if (!called) {
          called = true;
          r = f.apply(null, args);
        }
        return r;
      };
    };

    var DeviceType = function (os, browser, userAgent, mediaMatch) {
      var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;
      var isiPhone = os.isiOS() && !isiPad;
      var isMobile = os.isiOS() || os.isAndroid();
      var isTouch = isMobile || mediaMatch('(pointer:coarse)');
      var isTablet = isiPad || !isiPhone && isMobile && mediaMatch('(min-device-width:768px)');
      var isPhone = isiPhone || isMobile && !isTablet;
      var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;
      var isDesktop = !isPhone && !isTablet && !iOSwebview;
      return {
        isiPad: constant(isiPad),
        isiPhone: constant(isiPhone),
        isTablet: constant(isTablet),
        isPhone: constant(isPhone),
        isTouch: constant(isTouch),
        isAndroid: os.isAndroid,
        isiOS: os.isiOS,
        isWebView: constant(iOSwebview),
        isDesktop: constant(isDesktop)
      };
    };

    var firstMatch = function (regexes, s) {
      for (var i = 0; i < regexes.length; i++) {
        var x = regexes[i];
        if (x.test(s)) {
          return x;
        }
      }
      return undefined;
    };
    var find$1 = function (regexes, agent) {
      var r = firstMatch(regexes, agent);
      if (!r) {
        return {
          major: 0,
          minor: 0
        };
      }
      var group = function (i) {
        return Number(agent.replace(r, '$' + i));
      };
      return nu(group(1), group(2));
    };
    var detect = function (versionRegexes, agent) {
      var cleanedAgent = String(agent).toLowerCase();
      if (versionRegexes.length === 0) {
        return unknown();
      }
      return find$1(versionRegexes, cleanedAgent);
    };
    var unknown = function () {
      return nu(0, 0);
    };
    var nu = function (major, minor) {
      return {
        major: major,
        minor: minor
      };
    };
    var Version = {
      nu: nu,
      detect: detect,
      unknown: unknown
    };

    var detect$1 = function (candidates, userAgent) {
      var agent = String(userAgent).toLowerCase();
      return find(candidates, function (candidate) {
        return candidate.search(agent);
      });
    };
    var detectBrowser = function (browsers, userAgent) {
      return detect$1(browsers, userAgent).map(function (browser) {
        var version = Version.detect(browser.versionRegexes, userAgent);
        return {
          current: browser.name,
          version: version
        };
      });
    };
    var detectOs = function (oses, userAgent) {
      return detect$1(oses, userAgent).map(function (os) {
        var version = Version.detect(os.versionRegexes, userAgent);
        return {
          current: os.name,
          version: version
        };
      });
    };
    var UaString = {
      detectBrowser: detectBrowser,
      detectOs: detectOs
    };

    var checkRange = function (str, substr, start) {
      return substr === '' || str.length >= substr.length && str.substr(start, start + substr.length) === substr;
    };
    var contains$1 = function (str, substr) {
      return str.indexOf(substr) !== -1;
    };
    var startsWith = function (str, prefix) {
      return checkRange(str, prefix, 0);
    };
    var endsWith = function (str, suffix) {
      return checkRange(str, suffix, str.length - suffix.length);
    };
    var blank = function (r) {
      return function (s) {
        return s.replace(r, '');
      };
    };
    var trim = blank(/^\s+|\s+$/g);
    var isNotEmpty = function (s) {
      return s.length > 0;
    };

    var normalVersionRegex = /.*?version\/\ ?([0-9]+)\.([0-9]+).*/;
    var checkContains = function (target) {
      return function (uastring) {
        return contains$1(uastring, target);
      };
    };
    var browsers = [
      {
        name: 'Edge',
        versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],
        search: function (uastring) {
          return contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');
        }
      },
      {
        name: 'Chrome',
        versionRegexes: [
          /.*?chrome\/([0-9]+)\.([0-9]+).*/,
          normalVersionRegex
        ],
        search: function (uastring) {
          return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');
        }
      },
      {
        name: 'IE',
        versionRegexes: [
          /.*?msie\ ?([0-9]+)\.([0-9]+).*/,
          /.*?rv:([0-9]+)\.([0-9]+).*/
        ],
        search: function (uastring) {
          return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');
        }
      },
      {
        name: 'Opera',
        versionRegexes: [
          normalVersionRegex,
          /.*?opera\/([0-9]+)\.([0-9]+).*/
        ],
        search: checkContains('opera')
      },
      {
        name: 'Firefox',
        versionRegexes: [/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],
        search: checkContains('firefox')
      },
      {
        name: 'Safari',
        versionRegexes: [
          normalVersionRegex,
          /.*?cpu os ([0-9]+)_([0-9]+).*/
        ],
        search: function (uastring) {
          return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');
        }
      }
    ];
    var oses = [
      {
        name: 'Windows',
        search: checkContains('win'),
        versionRegexes: [/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name: 'iOS',
        search: function (uastring) {
          return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');
        },
        versionRegexes: [
          /.*?version\/\ ?([0-9]+)\.([0-9]+).*/,
          /.*cpu os ([0-9]+)_([0-9]+).*/,
          /.*cpu iphone os ([0-9]+)_([0-9]+).*/
        ]
      },
      {
        name: 'Android',
        search: checkContains('android'),
        versionRegexes: [/.*?android\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name: 'OSX',
        search: checkContains('mac os x'),
        versionRegexes: [/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]
      },
      {
        name: 'Linux',
        search: checkContains('linux'),
        versionRegexes: []
      },
      {
        name: 'Solaris',
        search: checkContains('sunos'),
        versionRegexes: []
      },
      {
        name: 'FreeBSD',
        search: checkContains('freebsd'),
        versionRegexes: []
      },
      {
        name: 'ChromeOS',
        search: checkContains('cros'),
        versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/]
      }
    ];
    var PlatformInfo = {
      browsers: constant(browsers),
      oses: constant(oses)
    };

    var edge = 'Edge';
    var chrome = 'Chrome';
    var ie = 'IE';
    var opera = 'Opera';
    var firefox = 'Firefox';
    var safari = 'Safari';
    var unknown$1 = function () {
      return nu$1({
        current: undefined,
        version: Version.unknown()
      });
    };
    var nu$1 = function (info) {
      var current = info.current;
      var version = info.version;
      var isBrowser = function (name) {
        return function () {
          return current === name;
        };
      };
      return {
        current: current,
        version: version,
        isEdge: isBrowser(edge),
        isChrome: isBrowser(chrome),
        isIE: isBrowser(ie),
        isOpera: isBrowser(opera),
        isFirefox: isBrowser(firefox),
        isSafari: isBrowser(safari)
      };
    };
    var Browser = {
      unknown: unknown$1,
      nu: nu$1,
      edge: constant(edge),
      chrome: constant(chrome),
      ie: constant(ie),
      opera: constant(opera),
      firefox: constant(firefox),
      safari: constant(safari)
    };

    var windows = 'Windows';
    var ios = 'iOS';
    var android = 'Android';
    var linux = 'Linux';
    var osx = 'OSX';
    var solaris = 'Solaris';
    var freebsd = 'FreeBSD';
    var chromeos = 'ChromeOS';
    var unknown$2 = function () {
      return nu$2({
        current: undefined,
        version: Version.unknown()
      });
    };
    var nu$2 = function (info) {
      var current = info.current;
      var version = info.version;
      var isOS = function (name) {
        return function () {
          return current === name;
        };
      };
      return {
        current: current,
        version: version,
        isWindows: isOS(windows),
        isiOS: isOS(ios),
        isAndroid: isOS(android),
        isOSX: isOS(osx),
        isLinux: isOS(linux),
        isSolaris: isOS(solaris),
        isFreeBSD: isOS(freebsd),
        isChromeOS: isOS(chromeos)
      };
    };
    var OperatingSystem = {
      unknown: unknown$2,
      nu: nu$2,
      windows: constant(windows),
      ios: constant(ios),
      android: constant(android),
      linux: constant(linux),
      osx: constant(osx),
      solaris: constant(solaris),
      freebsd: constant(freebsd),
      chromeos: constant(chromeos)
    };

    var detect$2 = function (userAgent, mediaMatch) {
      var browsers = PlatformInfo.browsers();
      var oses = PlatformInfo.oses();
      var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);
      var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);
      var deviceType = DeviceType(os, browser, userAgent, mediaMatch);
      return {
        browser: browser,
        os: os,
        deviceType: deviceType
      };
    };
    var PlatformDetection = { detect: detect$2 };

    var mediaMatch = function (query) {
      return window.matchMedia(query).matches;
    };
    var platform = cached(function () {
      return PlatformDetection.detect(navigator.userAgent, mediaMatch);
    });
    var detect$3 = function () {
      return platform();
    };

    var compareDocumentPosition = function (a, b, match) {
      return (a.compareDocumentPosition(b) & match) !== 0;
    };
    var documentPositionContainedBy = function (a, b) {
      return compareDocumentPosition(a, b, Node.DOCUMENT_POSITION_CONTAINED_BY);
    };

    var COMMENT = 8;
    var DOCUMENT = 9;
    var DOCUMENT_FRAGMENT = 11;
    var ELEMENT = 1;
    var TEXT = 3;

    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw new Error('HTML must have a single root node');
      }
      return fromDom(div.childNodes[0]);
    };
    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };
    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };
    var fromDom = function (node) {
      if (node === null || node === undefined) {
        throw new Error('Node cannot be null or undefined');
      }
      return { dom: node };
    };
    var fromPoint = function (docElm, x, y) {
      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);
    };
    var SugarElement = {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom,
      fromPoint: fromPoint
    };

    var is = function (element, selector) {
      var dom = element.dom;
      if (dom.nodeType !== ELEMENT) {
        return false;
      } else {
        var elem = dom;
        if (elem.matches !== undefined) {
          return elem.matches(selector);
        } else if (elem.msMatchesSelector !== undefined) {
          return elem.msMatchesSelector(selector);
        } else if (elem.webkitMatchesSelector !== undefined) {
          return elem.webkitMatchesSelector(selector);
        } else if (elem.mozMatchesSelector !== undefined) {
          return elem.mozMatchesSelector(selector);
        } else {
          throw new Error('Browser lacks native selectors');
        }
      }
    };
    var bypassSelector = function (dom) {
      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT && dom.nodeType !== DOCUMENT_FRAGMENT || dom.childElementCount === 0;
    };
    var all = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom;
      return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), SugarElement.fromDom);
    };
    var one = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom;
      return bypassSelector(base) ? Optional.none() : Optional.from(base.querySelector(selector)).map(SugarElement.fromDom);
    };

    var eq$1 = function (e1, e2) {
      return e1.dom === e2.dom;
    };
    var regularContains = function (e1, e2) {
      var d1 = e1.dom;
      var d2 = e2.dom;
      return d1 === d2 ? false : d1.contains(d2);
    };
    var ieContains = function (e1, e2) {
      return documentPositionContainedBy(e1.dom, e2.dom);
    };
    var contains$2 = function (e1, e2) {
      return detect$3().browser.isIE() ? ieContains(e1, e2) : regularContains(e1, e2);
    };
    var is$1 = is;

    var keys = Object.keys;
    var hasOwnProperty = Object.hasOwnProperty;
    var each$1 = function (obj, f) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        f(x, i);
      }
    };
    var map$1 = function (obj, f) {
      return tupleMap(obj, function (x, i) {
        return {
          k: i,
          v: f(x, i)
        };
      });
    };
    var tupleMap = function (obj, f) {
      var r = {};
      each$1(obj, function (x, i) {
        var tuple = f(x, i);
        r[tuple.k] = tuple.v;
      });
      return r;
    };
    var objAcc = function (r) {
      return function (x, i) {
        r[i] = x;
      };
    };
    var internalFilter = function (obj, pred, onTrue, onFalse) {
      var r = {};
      each$1(obj, function (x, i) {
        (pred(x, i) ? onTrue : onFalse)(x, i);
      });
      return r;
    };
    var filter$1 = function (obj, pred) {
      var t = {};
      internalFilter(obj, pred, objAcc(t), noop);
      return t;
    };
    var mapToArray = function (obj, f) {
      var r = [];
      each$1(obj, function (value, name) {
        r.push(f(value, name));
      });
      return r;
    };
    var values = function (obj) {
      return mapToArray(obj, function (v) {
        return v;
      });
    };
    var size = function (obj) {
      return keys(obj).length;
    };
    var get$1 = function (obj, key) {
      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();
    };
    var has = function (obj, key) {
      return hasOwnProperty.call(obj, key);
    };
    var hasNonNullableKey = function (obj, key) {
      return has(obj, key) && obj[key] !== undefined && obj[key] !== null;
    };
    var isEmpty = function (r) {
      for (var x in r) {
        if (hasOwnProperty.call(r, x)) {
          return false;
        }
      }
      return true;
    };

    var validSectionList = [
      'tfoot',
      'thead',
      'tbody',
      'colgroup'
    ];
    var isValidSection = function (parentName) {
      return contains(validSectionList, parentName);
    };
    var grid = function (rows, columns) {
      return {
        rows: rows,
        columns: columns
      };
    };
    var address = function (row, column) {
      return {
        row: row,
        column: column
      };
    };
    var detail = function (element, rowspan, colspan) {
      return {
        element: element,
        rowspan: rowspan,
        colspan: colspan
      };
    };
    var detailnew = function (element, rowspan, colspan, isNew) {
      return {
        element: element,
        rowspan: rowspan,
        colspan: colspan,
        isNew: isNew
      };
    };
    var extended = function (element, rowspan, colspan, row, column, isLocked) {
      return {
        element: element,
        rowspan: rowspan,
        colspan: colspan,
        row: row,
        column: column,
        isLocked: isLocked
      };
    };
    var rowdata = function (element, cells, section) {
      return {
        element: element,
        cells: cells,
        section: section
      };
    };
    var elementnew = function (element, isNew, isLocked) {
      return {
        element: element,
        isNew: isNew,
        isLocked: isLocked
      };
    };
    var rowdatanew = function (element, cells, section, isNew) {
      return {
        element: element,
        cells: cells,
        section: section,
        isNew: isNew
      };
    };
    var rowcells = function (cells, section) {
      return {
        cells: cells,
        section: section
      };
    };
    var rowdetails = function (details, section) {
      return {
        details: details,
        section: section
      };
    };
    var bounds = function (startRow, startCol, finishRow, finishCol) {
      return {
        startRow: startRow,
        startCol: startCol,
        finishRow: finishRow,
        finishCol: finishCol
      };
    };
    var columnext = function (element, colspan, column) {
      return {
        element: element,
        colspan: colspan,
        column: column
      };
    };

    var Global = typeof window !== 'undefined' ? window : Function('return this;')();

    var name = function (element) {
      var r = element.dom.nodeName;
      return r.toLowerCase();
    };
    var type = function (element) {
      return element.dom.nodeType;
    };
    var isType$1 = function (t) {
      return function (element) {
        return type(element) === t;
      };
    };
    var isComment = function (element) {
      return type(element) === COMMENT || name(element) === '#comment';
    };
    var isElement = isType$1(ELEMENT);
    var isText = isType$1(TEXT);
    var isDocument = isType$1(DOCUMENT);
    var isDocumentFragment = isType$1(DOCUMENT_FRAGMENT);
    var isTag = function (tag) {
      return function (e) {
        return isElement(e) && name(e) === tag;
      };
    };

    var owner = function (element) {
      return SugarElement.fromDom(element.dom.ownerDocument);
    };
    var documentOrOwner = function (dos) {
      return isDocument(dos) ? dos : owner(dos);
    };
    var defaultView = function (element) {
      return SugarElement.fromDom(documentOrOwner(element).dom.defaultView);
    };
    var parent = function (element) {
      return Optional.from(element.dom.parentNode).map(SugarElement.fromDom);
    };
    var parents = function (element, isRoot) {
      var stop = isFunction(isRoot) ? isRoot : never;
      var dom = element.dom;
      var ret = [];
      while (dom.parentNode !== null && dom.parentNode !== undefined) {
        var rawParent = dom.parentNode;
        var p = SugarElement.fromDom(rawParent);
        ret.push(p);
        if (stop(p) === true) {
          break;
        } else {
          dom = rawParent;
        }
      }
      return ret;
    };
    var offsetParent = function (element) {
      return Optional.from(element.dom.offsetParent).map(SugarElement.fromDom);
    };
    var prevSibling = function (element) {
      return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom);
    };
    var nextSibling = function (element) {
      return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom);
    };
    var children = function (element) {
      return map(element.dom.childNodes, SugarElement.fromDom);
    };
    var child = function (element, index) {
      var cs = element.dom.childNodes;
      return Optional.from(cs[index]).map(SugarElement.fromDom);
    };
    var firstChild = function (element) {
      return child(element, 0);
    };

    var isShadowRoot = function (dos) {
      return isDocumentFragment(dos) && isNonNullable(dos.dom.host);
    };
    var supported = isFunction(Element.prototype.attachShadow) && isFunction(Node.prototype.getRootNode);
    var isSupported = constant(supported);
    var getRootNode = supported ? function (e) {
      return SugarElement.fromDom(e.dom.getRootNode());
    } : documentOrOwner;
    var getShadowRoot = function (e) {
      var r = getRootNode(e);
      return isShadowRoot(r) ? Optional.some(r) : Optional.none();
    };
    var getShadowHost = function (e) {
      return SugarElement.fromDom(e.dom.host);
    };
    var getOriginalEventTarget = function (event) {
      if (isSupported() && isNonNullable(event.target)) {
        var el = SugarElement.fromDom(event.target);
        if (isElement(el) && isOpenShadowHost(el)) {
          if (event.composed && event.composedPath) {
            var composedPath = event.composedPath();
            if (composedPath) {
              return head(composedPath);
            }
          }
        }
      }
      return Optional.from(event.target);
    };
    var isOpenShadowHost = function (element) {
      return isNonNullable(element.dom.shadowRoot);
    };

    var inBody = function (element) {
      var dom = isText(element) ? element.dom.parentNode : element.dom;
      if (dom === undefined || dom === null || dom.ownerDocument === null) {
        return false;
      }
      var doc = dom.ownerDocument;
      return getShadowRoot(SugarElement.fromDom(dom)).fold(function () {
        return doc.body.contains(dom);
      }, compose1(inBody, getShadowHost));
    };
    var body = function () {
      return getBody(SugarElement.fromDom(document));
    };
    var getBody = function (doc) {
      var b = doc.dom.body;
      if (b === null || b === undefined) {
        throw new Error('Body is not available yet');
      }
      return SugarElement.fromDom(b);
    };

    var ancestors = function (scope, predicate, isRoot) {
      return filter(parents(scope, isRoot), predicate);
    };
    var children$1 = function (scope, predicate) {
      return filter(children(scope), predicate);
    };
    var descendants = function (scope, predicate) {
      var result = [];
      each(children(scope), function (x) {
        if (predicate(x)) {
          result = result.concat([x]);
        }
        result = result.concat(descendants(x, predicate));
      });
      return result;
    };

    var ancestors$1 = function (scope, selector, isRoot) {
      return ancestors(scope, function (e) {
        return is(e, selector);
      }, isRoot);
    };
    var children$2 = function (scope, selector) {
      return children$1(scope, function (e) {
        return is(e, selector);
      });
    };
    var descendants$1 = function (scope, selector) {
      return all(selector, scope);
    };

    function ClosestOrAncestor (is, ancestor, scope, a, isRoot) {
      if (is(scope, a)) {
        return Optional.some(scope);
      } else if (isFunction(isRoot) && isRoot(scope)) {
        return Optional.none();
      } else {
        return ancestor(scope, a, isRoot);
      }
    }

    var ancestor = function (scope, predicate, isRoot) {
      var element = scope.dom;
      var stop = isFunction(isRoot) ? isRoot : never;
      while (element.parentNode) {
        element = element.parentNode;
        var el = SugarElement.fromDom(element);
        if (predicate(el)) {
          return Optional.some(el);
        } else if (stop(el)) {
          break;
        }
      }
      return Optional.none();
    };
    var closest = function (scope, predicate, isRoot) {
      var is = function (s, test) {
        return test(s);
      };
      return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);
    };
    var child$1 = function (scope, predicate) {
      var pred = function (node) {
        return predicate(SugarElement.fromDom(node));
      };
      var result = find(scope.dom.childNodes, pred);
      return result.map(SugarElement.fromDom);
    };
    var descendant = function (scope, predicate) {
      var descend = function (node) {
        for (var i = 0; i < node.childNodes.length; i++) {
          var child_1 = SugarElement.fromDom(node.childNodes[i]);
          if (predicate(child_1)) {
            return Optional.some(child_1);
          }
          var res = descend(node.childNodes[i]);
          if (res.isSome()) {
            return res;
          }
        }
        return Optional.none();
      };
      return descend(scope.dom);
    };

    var ancestor$1 = function (scope, selector, isRoot) {
      return ancestor(scope, function (e) {
        return is(e, selector);
      }, isRoot);
    };
    var child$2 = function (scope, selector) {
      return child$1(scope, function (e) {
        return is(e, selector);
      });
    };
    var descendant$1 = function (scope, selector) {
      return one(selector, scope);
    };
    var closest$1 = function (scope, selector, isRoot) {
      var is$1 = function (element, selector) {
        return is(element, selector);
      };
      return ClosestOrAncestor(is$1, ancestor$1, scope, selector, isRoot);
    };

    var rawSet = function (dom, key, value) {
      if (isString(value) || isBoolean(value) || isNumber(value)) {
        dom.setAttribute(key, value + '');
      } else {
        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);
        throw new Error('Attribute value was not simple');
      }
    };
    var set = function (element, key, value) {
      rawSet(element.dom, key, value);
    };
    var setAll = function (element, attrs) {
      var dom = element.dom;
      each$1(attrs, function (v, k) {
        rawSet(dom, k, v);
      });
    };
    var get$2 = function (element, key) {
      var v = element.dom.getAttribute(key);
      return v === null ? undefined : v;
    };
    var getOpt = function (element, key) {
      return Optional.from(get$2(element, key));
    };
    var remove = function (element, key) {
      element.dom.removeAttribute(key);
    };
    var clone = function (element) {
      return foldl(element.dom.attributes, function (acc, attr) {
        acc[attr.name] = attr.value;
        return acc;
      }, {});
    };

    var isSupported$1 = function (dom) {
      return dom.style !== undefined && isFunction(dom.style.getPropertyValue);
    };

    var internalSet = function (dom, property, value) {
      if (!isString(value)) {
        console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);
        throw new Error('CSS value must be a string: ' + value);
      }
      if (isSupported$1(dom)) {
        dom.style.setProperty(property, value);
      }
    };
    var internalRemove = function (dom, property) {
      if (isSupported$1(dom)) {
        dom.style.removeProperty(property);
      }
    };
    var set$1 = function (element, property, value) {
      var dom = element.dom;
      internalSet(dom, property, value);
    };
    var setAll$1 = function (element, css) {
      var dom = element.dom;
      each$1(css, function (v, k) {
        internalSet(dom, k, v);
      });
    };
    var get$3 = function (element, property) {
      var dom = element.dom;
      var styles = window.getComputedStyle(dom);
      var r = styles.getPropertyValue(property);
      return r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;
    };
    var getUnsafeProperty = function (dom, property) {
      return isSupported$1(dom) ? dom.style.getPropertyValue(property) : '';
    };
    var getRaw = function (element, property) {
      var dom = element.dom;
      var raw = getUnsafeProperty(dom, property);
      return Optional.from(raw).filter(function (r) {
        return r.length > 0;
      });
    };
    var remove$1 = function (element, property) {
      var dom = element.dom;
      internalRemove(dom, property);
      if (getOpt(element, 'style').map(trim).is('')) {
        remove(element, 'style');
      }
    };
    var copy = function (source, target) {
      var sourceDom = source.dom;
      var targetDom = target.dom;
      if (isSupported$1(sourceDom) && isSupported$1(targetDom)) {
        targetDom.style.cssText = sourceDom.style.cssText;
      }
    };

    var getAttrValue = function (cell, name, fallback) {
      if (fallback === void 0) {
        fallback = 0;
      }
      return getOpt(cell, name).map(function (value) {
        return parseInt(value, 10);
      }).getOr(fallback);
    };
    var getSpan = function (cell, type) {
      return getAttrValue(cell, type, 1);
    };
    var hasColspan = function (cell) {
      return getSpan(cell, 'colspan') > 1;
    };
    var hasRowspan = function (cell) {
      return getSpan(cell, 'rowspan') > 1;
    };
    var getCssValue = function (element, property) {
      return parseInt(get$3(element, property), 10);
    };
    var minWidth = constant(10);
    var minHeight = constant(10);

    var firstLayer = function (scope, selector) {
      return filterFirstLayer(scope, selector, always);
    };
    var filterFirstLayer = function (scope, selector, predicate) {
      return bind(children(scope), function (x) {
        if (is(x, selector)) {
          return predicate(x) ? [x] : [];
        } else {
          return filterFirstLayer(x, selector, predicate);
        }
      });
    };

    var lookup = function (tags, element, isRoot) {
      if (isRoot === void 0) {
        isRoot = never;
      }
      if (isRoot(element)) {
        return Optional.none();
      }
      if (contains(tags, name(element))) {
        return Optional.some(element);
      }
      var isRootOrUpperTable = function (elm) {
        return is(elm, 'table') || isRoot(elm);
      };
      return ancestor$1(element, tags.join(','), isRootOrUpperTable);
    };
    var cell = function (element, isRoot) {
      return lookup([
        'td',
        'th'
      ], element, isRoot);
    };
    var cells = function (ancestor) {
      return firstLayer(ancestor, 'th,td');
    };
    var columns = function (ancestor) {
      if (is(ancestor, 'colgroup')) {
        return children$2(ancestor, 'col');
      } else {
        return bind(columnGroups(ancestor), function (columnGroup) {
          return children$2(columnGroup, 'col');
        });
      }
    };
    var table = function (element, isRoot) {
      return closest$1(element, 'table', isRoot);
    };
    var rows = function (ancestor) {
      return firstLayer(ancestor, 'tr');
    };
    var columnGroups = function (ancestor) {
      return table(ancestor).fold(constant([]), function (table) {
        return children$2(table, 'colgroup');
      });
    };

    var fromRowsOrColGroups = function (elems, getSection) {
      return map(elems, function (row) {
        if (name(row) === 'colgroup') {
          var cells$1 = map(columns(row), function (column) {
            var colspan = getAttrValue(column, 'span', 1);
            return detail(column, 1, colspan);
          });
          return rowdata(row, cells$1, 'colgroup');
        } else {
          var cells$1 = map(cells(row), function (cell) {
            var rowspan = getAttrValue(cell, 'rowspan', 1);
            var colspan = getAttrValue(cell, 'colspan', 1);
            return detail(cell, rowspan, colspan);
          });
          return rowdata(row, cells$1, getSection(row));
        }
      });
    };
    var getParentSection = function (group) {
      return parent(group).map(function (parent) {
        var parentName = name(parent);
        return isValidSection(parentName) ? parentName : 'tbody';
      }).getOr('tbody');
    };
    var fromTable = function (table) {
      var rows$1 = rows(table);
      var columnGroups$1 = columnGroups(table);
      var elems = __spreadArrays(columnGroups$1, rows$1);
      return fromRowsOrColGroups(elems, getParentSection);
    };
    var fromPastedRows = function (elems, section) {
      return fromRowsOrColGroups(elems, function () {
        return section;
      });
    };

    var addCells = function (gridRow, index, cells) {
      var existingCells = gridRow.cells;
      var before = existingCells.slice(0, index);
      var after = existingCells.slice(index);
      var newCells = before.concat(cells).concat(after);
      return setCells(gridRow, newCells);
    };
    var addCell = function (gridRow, index, cell) {
      return addCells(gridRow, index, [cell]);
    };
    var mutateCell = function (gridRow, index, cell) {
      var cells = gridRow.cells;
      cells[index] = cell;
    };
    var setCells = function (gridRow, cells) {
      return rowcells(cells, gridRow.section);
    };
    var mapCells = function (gridRow, f) {
      var cells = gridRow.cells;
      var r = map(cells, f);
      return rowcells(r, gridRow.section);
    };
    var getCell = function (gridRow, index) {
      return gridRow.cells[index];
    };
    var getCellElement = function (gridRow, index) {
      return getCell(gridRow, index).element;
    };
    var cellLength = function (gridRow) {
      return gridRow.cells.length;
    };
    var extractGridDetails = function (grid) {
      var result = partition(grid, function (row) {
        return row.section === 'colgroup';
      });
      return {
        rows: result.fail,
        cols: result.pass
      };
    };

    var LOCKED_COL_ATTR = 'data-snooker-locked-cols';
    var getLockedColumnsFromTable = function (table) {
      return getOpt(table, LOCKED_COL_ATTR).bind(function (lockedColStr) {
        return Optional.from(lockedColStr.match(/\d+/g));
      }).map(function (lockedCols) {
        return mapToObject(lockedCols, always);
      });
    };
    var getLockedColumnsFromGrid = function (grid) {
      var locked = foldl(extractGridDetails(grid).rows, function (acc, row) {
        each(row.cells, function (cell, idx) {
          if (cell.isLocked) {
            acc[idx] = true;
          }
        });
        return acc;
      }, {});
      var lockedArr = mapToArray(locked, function (_val, key) {
        return parseInt(key, 10);
      });
      return sort(lockedArr);
    };

    var key = function (row, column) {
      return row + ',' + column;
    };
    var getAt = function (warehouse, row, column) {
      var raw = warehouse.access[key(row, column)];
      return raw !== undefined ? Optional.some(raw) : Optional.none();
    };
    var findItem = function (warehouse, item, comparator) {
      var filtered = filterItems(warehouse, function (detail) {
        return comparator(item, detail.element);
      });
      return filtered.length > 0 ? Optional.some(filtered[0]) : Optional.none();
    };
    var filterItems = function (warehouse, predicate) {
      var all = bind(warehouse.all, function (r) {
        return r.cells;
      });
      return filter(all, predicate);
    };
    var generateColumns = function (rowData) {
      var columnsGroup = {};
      var index = 0;
      each(rowData.cells, function (column) {
        var colspan = column.colspan;
        range(colspan, function (columnIndex) {
          var colIndex = index + columnIndex;
          columnsGroup[colIndex] = columnext(column.element, colspan, colIndex);
        });
        index += colspan;
      });
      return columnsGroup;
    };
    var generate = function (list) {
      var access = {};
      var cells = [];
      var columns = {};
      var tableOpt = head(list).map(function (rowData) {
        return rowData.element;
      }).bind(table);
      var lockedColumns = tableOpt.bind(getLockedColumnsFromTable).getOr({});
      var maxRows = 0;
      var maxColumns = 0;
      var rowCount = 0;
      each(list, function (rowData) {
        if (rowData.section === 'colgroup') {
          columns = generateColumns(rowData);
        } else {
          var currentRow_1 = [];
          each(rowData.cells, function (rowCell) {
            var start = 0;
            while (access[key(rowCount, start)] !== undefined) {
              start++;
            }
            var isLocked = hasNonNullableKey(lockedColumns, start.toString());
            var current = extended(rowCell.element, rowCell.rowspan, rowCell.colspan, rowCount, start, isLocked);
            for (var occupiedColumnPosition = 0; occupiedColumnPosition < rowCell.colspan; occupiedColumnPosition++) {
              for (var occupiedRowPosition = 0; occupiedRowPosition < rowCell.rowspan; occupiedRowPosition++) {
                var rowPosition = rowCount + occupiedRowPosition;
                var columnPosition = start + occupiedColumnPosition;
                var newpos = key(rowPosition, columnPosition);
                access[newpos] = current;
                maxColumns = Math.max(maxColumns, columnPosition + 1);
              }
            }
            currentRow_1.push(current);
          });
          maxRows++;
          cells.push(rowdata(rowData.element, currentRow_1, rowData.section));
          rowCount++;
        }
      });
      var grid$1 = grid(maxRows, maxColumns);
      return {
        grid: grid$1,
        access: access,
        all: cells,
        columns: columns
      };
    };
    var fromTable$1 = function (table) {
      var list = fromTable(table);
      return generate(list);
    };
    var justCells = function (warehouse) {
      return bind(warehouse.all, function (w) {
        return w.cells;
      });
    };
    var justColumns = function (warehouse) {
      return values(warehouse.columns);
    };
    var hasColumns = function (warehouse) {
      return keys(warehouse.columns).length > 0;
    };
    var getColumnAt = function (warehouse, columnIndex) {
      return Optional.from(warehouse.columns[columnIndex]);
    };
    var Warehouse = {
      fromTable: fromTable$1,
      generate: generate,
      getAt: getAt,
      findItem: findItem,
      filterItems: filterItems,
      justCells: justCells,
      justColumns: justColumns,
      hasColumns: hasColumns,
      getColumnAt: getColumnAt
    };

    var inSelection = function (bounds, detail) {
      var leftEdge = detail.column;
      var rightEdge = detail.column + detail.colspan - 1;
      var topEdge = detail.row;
      var bottomEdge = detail.row + detail.rowspan - 1;
      return leftEdge <= bounds.finishCol && rightEdge >= bounds.startCol && (topEdge <= bounds.finishRow && bottomEdge >= bounds.startRow);
    };
    var isWithin = function (bounds, detail) {
      return detail.column >= bounds.startCol && detail.column + detail.colspan - 1 <= bounds.finishCol && detail.row >= bounds.startRow && detail.row + detail.rowspan - 1 <= bounds.finishRow;
    };
    var isRectangular = function (warehouse, bounds) {
      var isRect = true;
      var detailIsWithin = curry(isWithin, bounds);
      for (var i = bounds.startRow; i <= bounds.finishRow; i++) {
        for (var j = bounds.startCol; j <= bounds.finishCol; j++) {
          isRect = isRect && Warehouse.getAt(warehouse, i, j).exists(detailIsWithin);
        }
      }
      return isRect ? Optional.some(bounds) : Optional.none();
    };

    var getBounds = function (detailA, detailB) {
      return bounds(Math.min(detailA.row, detailB.row), Math.min(detailA.column, detailB.column), Math.max(detailA.row + detailA.rowspan - 1, detailB.row + detailB.rowspan - 1), Math.max(detailA.column + detailA.colspan - 1, detailB.column + detailB.colspan - 1));
    };
    var getAnyBox = function (warehouse, startCell, finishCell) {
      var startCoords = Warehouse.findItem(warehouse, startCell, eq$1);
      var finishCoords = Warehouse.findItem(warehouse, finishCell, eq$1);
      return startCoords.bind(function (sc) {
        return finishCoords.map(function (fc) {
          return getBounds(sc, fc);
        });
      });
    };
    var getBox = function (warehouse, startCell, finishCell) {
      return getAnyBox(warehouse, startCell, finishCell).bind(function (bounds) {
        return isRectangular(warehouse, bounds);
      });
    };

    var moveBy = function (warehouse, cell, row, column) {
      return Warehouse.findItem(warehouse, cell, eq$1).bind(function (detail) {
        var startRow = row > 0 ? detail.row + detail.rowspan - 1 : detail.row;
        var startCol = column > 0 ? detail.column + detail.colspan - 1 : detail.column;
        var dest = Warehouse.getAt(warehouse, startRow + row, startCol + column);
        return dest.map(function (d) {
          return d.element;
        });
      });
    };
    var intercepts = function (warehouse, start, finish) {
      return getAnyBox(warehouse, start, finish).map(function (bounds) {
        var inside = Warehouse.filterItems(warehouse, curry(inSelection, bounds));
        return map(inside, function (detail) {
          return detail.element;
        });
      });
    };
    var parentCell = function (warehouse, innerCell) {
      var isContainedBy = function (c1, c2) {
        return contains$2(c2, c1);
      };
      return Warehouse.findItem(warehouse, innerCell, isContainedBy).map(function (detail) {
        return detail.element;
      });
    };

    var moveBy$1 = function (cell, deltaRow, deltaColumn) {
      return table(cell).bind(function (table) {
        var warehouse = getWarehouse(table);
        return moveBy(warehouse, cell, deltaRow, deltaColumn);
      });
    };
    var intercepts$1 = function (table, first, last) {
      var warehouse = getWarehouse(table);
      return intercepts(warehouse, first, last);
    };
    var nestedIntercepts = function (table, first, firstTable, last, lastTable) {
      var warehouse = getWarehouse(table);
      var optStartCell = eq$1(table, firstTable) ? Optional.some(first) : parentCell(warehouse, first);
      var optLastCell = eq$1(table, lastTable) ? Optional.some(last) : parentCell(warehouse, last);
      return optStartCell.bind(function (startCell) {
        return optLastCell.bind(function (lastCell) {
          return intercepts(warehouse, startCell, lastCell);
        });
      });
    };
    var getBox$1 = function (table, first, last) {
      var warehouse = getWarehouse(table);
      return getBox(warehouse, first, last);
    };
    var getWarehouse = Warehouse.fromTable;

    var before = function (marker, element) {
      var parent$1 = parent(marker);
      parent$1.each(function (v) {
        v.dom.insertBefore(element.dom, marker.dom);
      });
    };
    var after = function (marker, element) {
      var sibling = nextSibling(marker);
      sibling.fold(function () {
        var parent$1 = parent(marker);
        parent$1.each(function (v) {
          append(v, element);
        });
      }, function (v) {
        before(v, element);
      });
    };
    var prepend = function (parent, element) {
      var firstChild$1 = firstChild(parent);
      firstChild$1.fold(function () {
        append(parent, element);
      }, function (v) {
        parent.dom.insertBefore(element.dom, v.dom);
      });
    };
    var append = function (parent, element) {
      parent.dom.appendChild(element.dom);
    };
    var wrap = function (element, wrapper) {
      before(element, wrapper);
      append(wrapper, element);
    };

    var before$1 = function (marker, elements) {
      each(elements, function (x) {
        before(marker, x);
      });
    };
    var after$1 = function (marker, elements) {
      each(elements, function (x, i) {
        var e = i === 0 ? marker : elements[i - 1];
        after(e, x);
      });
    };
    var append$1 = function (parent, elements) {
      each(elements, function (x) {
        append(parent, x);
      });
    };

    var empty = function (element) {
      element.dom.textContent = '';
      each(children(element), function (rogue) {
        remove$2(rogue);
      });
    };
    var remove$2 = function (element) {
      var dom = element.dom;
      if (dom.parentNode !== null) {
        dom.parentNode.removeChild(dom);
      }
    };
    var unwrap = function (wrapper) {
      var children$1 = children(wrapper);
      if (children$1.length > 0) {
        before$1(wrapper, children$1);
      }
      remove$2(wrapper);
    };

    var NodeValue = function (is, name) {
      var get = function (element) {
        if (!is(element)) {
          throw new Error('Can only get ' + name + ' value of a ' + name + ' node');
        }
        return getOption(element).getOr('');
      };
      var getOption = function (element) {
        return is(element) ? Optional.from(element.dom.nodeValue) : Optional.none();
      };
      var set = function (element, value) {
        if (!is(element)) {
          throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');
        }
        element.dom.nodeValue = value;
      };
      return {
        get: get,
        getOption: getOption,
        set: set
      };
    };

    var api = NodeValue(isText, 'text');
    var get$4 = function (element) {
      return api.get(element);
    };
    var getOption = function (element) {
      return api.getOption(element);
    };
    var set$2 = function (element, value) {
      return api.set(element, value);
    };

    var TagBoundaries = [
      'body',
      'p',
      'div',
      'article',
      'aside',
      'figcaption',
      'figure',
      'footer',
      'header',
      'nav',
      'section',
      'ol',
      'ul',
      'li',
      'table',
      'thead',
      'tbody',
      'tfoot',
      'caption',
      'tr',
      'td',
      'th',
      'h1',
      'h2',
      'h3',
      'h4',
      'h5',
      'h6',
      'blockquote',
      'pre',
      'address'
    ];

    function DomUniverse () {
      var clone$1 = function (element) {
        return SugarElement.fromDom(element.dom.cloneNode(false));
      };
      var document = function (element) {
        return documentOrOwner(element).dom;
      };
      var isBoundary = function (element) {
        if (!isElement(element)) {
          return false;
        }
        if (name(element) === 'body') {
          return true;
        }
        return contains(TagBoundaries, name(element));
      };
      var isEmptyTag = function (element) {
        if (!isElement(element)) {
          return false;
        }
        return contains([
          'br',
          'img',
          'hr',
          'input'
        ], name(element));
      };
      var isNonEditable = function (element) {
        return isElement(element) && get$2(element, 'contenteditable') === 'false';
      };
      var comparePosition = function (element, other) {
        return element.dom.compareDocumentPosition(other.dom);
      };
      var copyAttributesTo = function (source, destination) {
        var as = clone(source);
        setAll(destination, as);
      };
      var isSpecial = function (element) {
        var tag = name(element);
        return contains([
          'script',
          'noscript',
          'iframe',
          'noframes',
          'noembed',
          'title',
          'style',
          'textarea',
          'xmp'
        ], tag);
      };
      return {
        up: constant({
          selector: ancestor$1,
          closest: closest$1,
          predicate: ancestor,
          all: parents
        }),
        down: constant({
          selector: descendants$1,
          predicate: descendants
        }),
        styles: constant({
          get: get$3,
          getRaw: getRaw,
          set: set$1,
          remove: remove$1
        }),
        attrs: constant({
          get: get$2,
          set: set,
          remove: remove,
          copyTo: copyAttributesTo
        }),
        insert: constant({
          before: before,
          after: after,
          afterAll: after$1,
          append: append,
          appendAll: append$1,
          prepend: prepend,
          wrap: wrap
        }),
        remove: constant({
          unwrap: unwrap,
          remove: remove$2
        }),
        create: constant({
          nu: SugarElement.fromTag,
          clone: clone$1,
          text: SugarElement.fromText
        }),
        query: constant({
          comparePosition: comparePosition,
          prevSibling: prevSibling,
          nextSibling: nextSibling
        }),
        property: constant({
          children: children,
          name: name,
          parent: parent,
          document: document,
          isText: isText,
          isComment: isComment,
          isElement: isElement,
          isSpecial: isSpecial,
          getText: get$4,
          setText: set$2,
          isBoundary: isBoundary,
          isEmptyTag: isEmptyTag,
          isNonEditable: isNonEditable
        }),
        eq: eq$1,
        is: is$1
      };
    }

    var all$1 = function (universe, look, elements, f) {
      var head = elements[0];
      var tail = elements.slice(1);
      return f(universe, look, head, tail);
    };
    var oneAll = function (universe, look, elements) {
      return elements.length > 0 ? all$1(universe, look, elements, unsafeOne) : Optional.none();
    };
    var unsafeOne = function (universe, look, head, tail) {
      var start = look(universe, head);
      return foldr(tail, function (b, a) {
        var current = look(universe, a);
        return commonElement(universe, b, current);
      }, start);
    };
    var commonElement = function (universe, start, end) {
      return start.bind(function (s) {
        return end.filter(curry(universe.eq, s));
      });
    };

    var eq$2 = function (universe, item) {
      return curry(universe.eq, item);
    };
    var ancestors$2 = function (universe, start, end, isRoot) {
      if (isRoot === void 0) {
        isRoot = never;
      }
      var ps1 = [start].concat(universe.up().all(start));
      var ps2 = [end].concat(universe.up().all(end));
      var prune = function (path) {
        var index = findIndex(path, isRoot);
        return index.fold(function () {
          return path;
        }, function (ind) {
          return path.slice(0, ind + 1);
        });
      };
      var pruned1 = prune(ps1);
      var pruned2 = prune(ps2);
      var shared = find(pruned1, function (x) {
        return exists(pruned2, eq$2(universe, x));
      });
      return {
        firstpath: pruned1,
        secondpath: pruned2,
        shared: shared
      };
    };

    var sharedOne = oneAll;
    var ancestors$3 = ancestors$2;

    var universe = DomUniverse();
    var sharedOne$1 = function (look, elements) {
      return sharedOne(universe, function (_universe, element) {
        return look(element);
      }, elements);
    };
    var ancestors$4 = function (start, finish, isRoot) {
      return ancestors$3(universe, start, finish, isRoot);
    };

    var lookupTable = function (container) {
      return ancestor$1(container, 'table');
    };
    var identify = function (start, finish, isRoot) {
      var getIsRoot = function (rootTable) {
        return function (element) {
          return isRoot !== undefined && isRoot(element) || eq$1(element, rootTable);
        };
      };
      if (eq$1(start, finish)) {
        return Optional.some({
          boxes: Optional.some([start]),
          start: start,
          finish: finish
        });
      } else {
        return lookupTable(start).bind(function (startTable) {
          return lookupTable(finish).bind(function (finishTable) {
            if (eq$1(startTable, finishTable)) {
              return Optional.some({
                boxes: intercepts$1(startTable, start, finish),
                start: start,
                finish: finish
              });
            } else if (contains$2(startTable, finishTable)) {
              var ancestorCells = ancestors$1(finish, 'td,th', getIsRoot(startTable));
              var finishCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : finish;
              return Optional.some({
                boxes: nestedIntercepts(startTable, start, startTable, finish, finishTable),
                start: start,
                finish: finishCell
              });
            } else if (contains$2(finishTable, startTable)) {
              var ancestorCells = ancestors$1(start, 'td,th', getIsRoot(finishTable));
              var startCell = ancestorCells.length > 0 ? ancestorCells[ancestorCells.length - 1] : start;
              return Optional.some({
                boxes: nestedIntercepts(finishTable, start, startTable, finish, finishTable),
                start: start,
                finish: startCell
              });
            } else {
              return ancestors$4(start, finish).shared.bind(function (lca) {
                return closest$1(lca, 'table', isRoot).bind(function (lcaTable) {
                  var finishAncestorCells = ancestors$1(finish, 'td,th', getIsRoot(lcaTable));
                  var finishCell = finishAncestorCells.length > 0 ? finishAncestorCells[finishAncestorCells.length - 1] : finish;
                  var startAncestorCells = ancestors$1(start, 'td,th', getIsRoot(lcaTable));
                  var startCell = startAncestorCells.length > 0 ? startAncestorCells[startAncestorCells.length - 1] : start;
                  return Optional.some({
                    boxes: nestedIntercepts(lcaTable, start, startTable, finish, finishTable),
                    start: startCell,
                    finish: finishCell
                  });
                });
              });
            }
          });
        });
      }
    };
    var retrieve = function (container, selector) {
      var sels = descendants$1(container, selector);
      return sels.length > 0 ? Optional.some(sels) : Optional.none();
    };
    var getLast = function (boxes, lastSelectedSelector) {
      return find(boxes, function (box) {
        return is(box, lastSelectedSelector);
      });
    };
    var getEdges = function (container, firstSelectedSelector, lastSelectedSelector) {
      return descendant$1(container, firstSelectedSelector).bind(function (first) {
        return descendant$1(container, lastSelectedSelector).bind(function (last) {
          return sharedOne$1(lookupTable, [
            first,
            last
          ]).map(function (table) {
            return {
              first: first,
              last: last,
              table: table
            };
          });
        });
      });
    };
    var expandTo = function (finish, firstSelectedSelector) {
      return ancestor$1(finish, 'table').bind(function (table) {
        return descendant$1(table, firstSelectedSelector).bind(function (start) {
          return identify(start, finish).bind(function (identified) {
            return identified.boxes.map(function (boxes) {
              return {
                boxes: boxes,
                start: identified.start,
                finish: identified.finish
              };
            });
          });
        });
      });
    };
    var shiftSelection = function (boxes, deltaRow, deltaColumn, firstSelectedSelector, lastSelectedSelector) {
      return getLast(boxes, lastSelectedSelector).bind(function (last) {
        return moveBy$1(last, deltaRow, deltaColumn).bind(function (finish) {
          return expandTo(finish, firstSelectedSelector);
        });
      });
    };

    var retrieve$1 = function (container, selector) {
      return retrieve(container, selector);
    };
    var retrieveBox = function (container, firstSelectedSelector, lastSelectedSelector) {
      return getEdges(container, firstSelectedSelector, lastSelectedSelector).bind(function (edges) {
        var isRoot = function (ancestor) {
          return eq$1(container, ancestor);
        };
        var sectionSelector = 'thead,tfoot,tbody,table';
        var firstAncestor = ancestor$1(edges.first, sectionSelector, isRoot);
        var lastAncestor = ancestor$1(edges.last, sectionSelector, isRoot);
        return firstAncestor.bind(function (fA) {
          return lastAncestor.bind(function (lA) {
            return eq$1(fA, lA) ? getBox$1(edges.table, edges.first, edges.last) : Optional.none();
          });
        });
      });
    };

    var generate$1 = function (cases) {
      if (!isArray(cases)) {
        throw new Error('cases must be an array');
      }
      if (cases.length === 0) {
        throw new Error('there must be at least one case');
      }
      var constructors = [];
      var adt = {};
      each(cases, function (acase, count) {
        var keys$1 = keys(acase);
        if (keys$1.length !== 1) {
          throw new Error('one and only one name per case');
        }
        var key = keys$1[0];
        var value = acase[key];
        if (adt[key] !== undefined) {
          throw new Error('duplicate key detected:' + key);
        } else if (key === 'cata') {
          throw new Error('cannot have a case named cata (sorry)');
        } else if (!isArray(value)) {
          throw new Error('case arguments must be an array');
        }
        constructors.push(key);
        adt[key] = function () {
          var args = [];
          for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
          }
          var argLength = args.length;
          if (argLength !== value.length) {
            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);
          }
          var match = function (branches) {
            var branchKeys = keys(branches);
            if (constructors.length !== branchKeys.length) {
              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\nActual: ' + branchKeys.join(','));
            }
            var allReqd = forall(constructors, function (reqKey) {
              return contains(branchKeys, reqKey);
            });
            if (!allReqd) {
              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\nRequired: ' + constructors.join(', '));
            }
            return branches[key].apply(null, args);
          };
          return {
            fold: function () {
              var foldArgs = [];
              for (var _i = 0; _i < arguments.length; _i++) {
                foldArgs[_i] = arguments[_i];
              }
              if (foldArgs.length !== cases.length) {
                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + foldArgs.length);
              }
              var target = foldArgs[count];
              return target.apply(null, args);
            },
            match: match,
            log: function (label) {
              console.log(label, {
                constructors: constructors,
                constructor: key,
                params: args
              });
            }
          };
        };
      });
      return adt;
    };
    var Adt = { generate: generate$1 };

    var type$1 = Adt.generate([
      { none: [] },
      { multiple: ['elements'] },
      { single: ['element'] }
    ]);
    var cata = function (subject, onNone, onMultiple, onSingle) {
      return subject.fold(onNone, onMultiple, onSingle);
    };
    var none$1 = type$1.none;
    var multiple = type$1.multiple;
    var single = type$1.single;

    var Selections = function (lazyRoot, getStart, selectedSelector) {
      var get = function () {
        return retrieve$1(lazyRoot(), selectedSelector).fold(function () {
          return getStart().map(single).getOrThunk(none$1);
        }, function (cells) {
          return multiple(cells);
        });
      };
      return { get: get };
    };

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var clone$1 = function (original, isDeep) {
      return SugarElement.fromDom(original.dom.cloneNode(isDeep));
    };
    var shallow = function (original) {
      return clone$1(original, false);
    };
    var deep = function (original) {
      return clone$1(original, true);
    };
    var shallowAs = function (original, tag) {
      var nu = SugarElement.fromTag(tag);
      var attributes = clone(original);
      setAll(nu, attributes);
      return nu;
    };
    var copy$1 = function (original, tag) {
      var nu = shallowAs(original, tag);
      var cloneChildren = children(deep(original));
      append$1(nu, cloneChildren);
      return nu;
    };

    var cat = function (arr) {
      var r = [];
      var push = function (x) {
        r.push(x);
      };
      for (var i = 0; i < arr.length; i++) {
        arr[i].each(push);
      }
      return r;
    };
    var lift2 = function (oa, ob, f) {
      return oa.isSome() && ob.isSome() ? Optional.some(f(oa.getOrDie(), ob.getOrDie())) : Optional.none();
    };
    var bindFrom = function (a, f) {
      return a !== undefined && a !== null ? f(a) : Optional.none();
    };
    var someIf = function (b, a) {
      return b ? Optional.some(a) : Optional.none();
    };

    var Dimension = function (name, getOffset) {
      var set = function (element, h) {
        if (!isNumber(h) && !h.match(/^[0-9]+$/)) {
          throw new Error(name + '.set accepts only positive integer values. Value was ' + h);
        }
        var dom = element.dom;
        if (isSupported$1(dom)) {
          dom.style[name] = h + 'px';
        }
      };
      var get = function (element) {
        var r = getOffset(element);
        if (r <= 0 || r === null) {
          var css = get$3(element, name);
          return parseFloat(css) || 0;
        }
        return r;
      };
      var getOuter = get;
      var aggregate = function (element, properties) {
        return foldl(properties, function (acc, property) {
          var val = get$3(element, property);
          var value = val === undefined ? 0 : parseInt(val, 10);
          return isNaN(value) ? acc : acc + value;
        }, 0);
      };
      var max = function (element, value, properties) {
        var cumulativeInclusions = aggregate(element, properties);
        var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;
        return absoluteMax;
      };
      return {
        set: set,
        get: get,
        getOuter: getOuter,
        aggregate: aggregate,
        max: max
      };
    };

    var api$1 = Dimension('width', function (element) {
      return element.dom.offsetWidth;
    });
    var get$5 = function (element) {
      return api$1.get(element);
    };
    var getOuter = function (element) {
      return api$1.getOuter(element);
    };

    var columns$1 = function (warehouse, isValidCell) {
      if (isValidCell === void 0) {
        isValidCell = always;
      }
      var grid = warehouse.grid;
      var cols = range(grid.columns, identity);
      var rowsArr = range(grid.rows, identity);
      return map(cols, function (col) {
        var getBlock = function () {
          return bind(rowsArr, function (r) {
            return Warehouse.getAt(warehouse, r, col).filter(function (detail) {
              return detail.column === col;
            }).toArray();
          });
        };
        var isValid = function (detail) {
          return detail.colspan === 1 && isValidCell(detail.element);
        };
        var getFallback = function () {
          return Warehouse.getAt(warehouse, 0, col);
        };
        return decide(getBlock, isValid, getFallback);
      });
    };
    var decide = function (getBlock, isValid, getFallback) {
      var inBlock = getBlock();
      var validInBlock = find(inBlock, isValid);
      var detailOption = validInBlock.orThunk(function () {
        return Optional.from(inBlock[0]).orThunk(getFallback);
      });
      return detailOption.map(function (detail) {
        return detail.element;
      });
    };
    var rows$1 = function (warehouse) {
      var grid = warehouse.grid;
      var rowsArr = range(grid.rows, identity);
      var cols = range(grid.columns, identity);
      return map(rowsArr, function (row) {
        var getBlock = function () {
          return bind(cols, function (c) {
            return Warehouse.getAt(warehouse, row, c).filter(function (detail) {
              return detail.row === row;
            }).fold(constant([]), function (detail) {
              return [detail];
            });
          });
        };
        var isSingle = function (detail) {
          return detail.rowspan === 1;
        };
        var getFallback = function () {
          return Warehouse.getAt(warehouse, row, 0);
        };
        return decide(getBlock, isSingle, getFallback);
      });
    };

    var deduce = function (xs, index) {
      if (index < 0 || index >= xs.length - 1) {
        return Optional.none();
      }
      var current = xs[index].fold(function () {
        var rest = reverse(xs.slice(0, index));
        return findMap(rest, function (a, i) {
          return a.map(function (aa) {
            return {
              value: aa,
              delta: i + 1
            };
          });
        });
      }, function (c) {
        return Optional.some({
          value: c,
          delta: 0
        });
      });
      var next = xs[index + 1].fold(function () {
        var rest = xs.slice(index + 1);
        return findMap(rest, function (a, i) {
          return a.map(function (aa) {
            return {
              value: aa,
              delta: i + 1
            };
          });
        });
      }, function (n) {
        return Optional.some({
          value: n,
          delta: 1
        });
      });
      return current.bind(function (c) {
        return next.map(function (n) {
          var extras = n.delta + c.delta;
          return Math.abs(n.value - c.value) / extras;
        });
      });
    };

    var onDirection = function (isLtr, isRtl) {
      return function (element) {
        return getDirection(element) === 'rtl' ? isRtl : isLtr;
      };
    };
    var getDirection = function (element) {
      return get$3(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';
    };

    var api$2 = Dimension('height', function (element) {
      var dom = element.dom;
      return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;
    });
    var get$6 = function (element) {
      return api$2.get(element);
    };
    var getOuter$1 = function (element) {
      return api$2.getOuter(element);
    };

    var r = function (left, top) {
      var translate = function (x, y) {
        return r(left + x, top + y);
      };
      return {
        left: left,
        top: top,
        translate: translate
      };
    };
    var SugarPosition = r;

    var boxPosition = function (dom) {
      var box = dom.getBoundingClientRect();
      return SugarPosition(box.left, box.top);
    };
    var firstDefinedOrZero = function (a, b) {
      if (a !== undefined) {
        return a;
      } else {
        return b !== undefined ? b : 0;
      }
    };
    var absolute = function (element) {
      var doc = element.dom.ownerDocument;
      var body = doc.body;
      var win = doc.defaultView;
      var html = doc.documentElement;
      if (body === element.dom) {
        return SugarPosition(body.offsetLeft, body.offsetTop);
      }
      var scrollTop = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageYOffset, html.scrollTop);
      var scrollLeft = firstDefinedOrZero(win === null || win === void 0 ? void 0 : win.pageXOffset, html.scrollLeft);
      var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);
      var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);
      return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);
    };
    var viewport = function (element) {
      var dom = element.dom;
      var doc = dom.ownerDocument;
      var body = doc.body;
      if (body === dom) {
        return SugarPosition(body.offsetLeft, body.offsetTop);
      }
      if (!inBody(element)) {
        return SugarPosition(0, 0);
      }
      return boxPosition(dom);
    };

    var rowInfo = function (row, y) {
      return {
        row: row,
        y: y
      };
    };
    var colInfo = function (col, x) {
      return {
        col: col,
        x: x
      };
    };
    var rtlEdge = function (cell) {
      var pos = absolute(cell);
      return pos.left + getOuter(cell);
    };
    var ltrEdge = function (cell) {
      return absolute(cell).left;
    };
    var getLeftEdge = function (index, cell) {
      return colInfo(index, ltrEdge(cell));
    };
    var getRightEdge = function (index, cell) {
      return colInfo(index, rtlEdge(cell));
    };
    var getTop = function (cell) {
      return absolute(cell).top;
    };
    var getTopEdge = function (index, cell) {
      return rowInfo(index, getTop(cell));
    };
    var getBottomEdge = function (index, cell) {
      return rowInfo(index, getTop(cell) + getOuter$1(cell));
    };
    var findPositions = function (getInnerEdge, getOuterEdge, array) {
      if (array.length === 0) {
        return [];
      }
      var lines = map(array.slice(1), function (cellOption, index) {
        return cellOption.map(function (cell) {
          return getInnerEdge(index, cell);
        });
      });
      var lastLine = array[array.length - 1].map(function (cell) {
        return getOuterEdge(array.length - 1, cell);
      });
      return lines.concat([lastLine]);
    };
    var negate = function (step) {
      return -step;
    };
    var height = {
      delta: identity,
      positions: function (optElements) {
        return findPositions(getTopEdge, getBottomEdge, optElements);
      },
      edge: getTop
    };
    var ltr = {
      delta: identity,
      edge: ltrEdge,
      positions: function (optElements) {
        return findPositions(getLeftEdge, getRightEdge, optElements);
      }
    };
    var rtl = {
      delta: negate,
      edge: rtlEdge,
      positions: function (optElements) {
        return findPositions(getRightEdge, getLeftEdge, optElements);
      }
    };
    var detect$4 = onDirection(ltr, rtl);
    var width = {
      delta: function (amount, table) {
        return detect$4(table).delta(amount, table);
      },
      positions: function (cols, table) {
        return detect$4(table).positions(cols, table);
      },
      edge: function (cell) {
        return detect$4(cell).edge(cell);
      }
    };

    var units = {
      unsupportedLength: [
        'em',
        'ex',
        'cap',
        'ch',
        'ic',
        'rem',
        'lh',
        'rlh',
        'vw',
        'vh',
        'vi',
        'vb',
        'vmin',
        'vmax',
        'cm',
        'mm',
        'Q',
        'in',
        'pc',
        'pt',
        'px'
      ],
      fixed: [
        'px',
        'pt'
      ],
      relative: ['%'],
      empty: ['']
    };
    var pattern = function () {
      var decimalDigits = '[0-9]+';
      var signedInteger = '[+-]?' + decimalDigits;
      var exponentPart = '[eE]' + signedInteger;
      var dot = '\\.';
      var opt = function (input) {
        return '(?:' + input + ')?';
      };
      var unsignedDecimalLiteral = [
        'Infinity',
        decimalDigits + dot + opt(decimalDigits) + opt(exponentPart),
        dot + decimalDigits + opt(exponentPart),
        decimalDigits + opt(exponentPart)
      ].join('|');
      var float = '[+-]?(?:' + unsignedDecimalLiteral + ')';
      return new RegExp('^(' + float + ')(.*)$');
    }();
    var isUnit = function (unit, accepted) {
      return exists(accepted, function (acc) {
        return exists(units[acc], function (check) {
          return unit === check;
        });
      });
    };
    var parse = function (input, accepted) {
      var match = Optional.from(pattern.exec(input));
      return match.bind(function (array) {
        var value = Number(array[1]);
        var unitRaw = array[2];
        if (isUnit(unitRaw, accepted)) {
          return Optional.some({
            value: value,
            unit: unitRaw
          });
        } else {
          return Optional.none();
        }
      });
    };

    var needManualCalc = function () {
      var browser = detect$3().browser;
      return browser.isIE() || browser.isEdge();
    };
    var toNumber = function (px, fallback) {
      var num = parseFloat(px);
      return isNaN(num) ? fallback : num;
    };
    var getProp = function (elm, name, fallback) {
      return toNumber(get$3(elm, name), fallback);
    };
    var getCalculatedHeight = function (cell) {
      var height = cell.dom.getBoundingClientRect().height;
      var boxSizing = get$3(cell, 'box-sizing');
      if (boxSizing === 'border-box') {
        return height;
      } else {
        var paddingTop = getProp(cell, 'padding-top', 0);
        var paddingBottom = getProp(cell, 'padding-bottom', 0);
        var borderTop = getProp(cell, 'border-top-width', 0);
        var borderBottom = getProp(cell, 'border-bottom-width', 0);
        var borders = borderTop + borderBottom;
        return height - paddingTop - paddingBottom - borders;
      }
    };
    var getCalculatedWidth = function (cell) {
      var width = cell.dom.getBoundingClientRect().width;
      var boxSizing = get$3(cell, 'box-sizing');
      if (boxSizing === 'border-box') {
        return width;
      } else {
        var paddingLeft = getProp(cell, 'padding-left', 0);
        var paddingRight = getProp(cell, 'padding-right', 0);
        var borderLeft = getProp(cell, 'border-left-width', 0);
        var borderRight = getProp(cell, 'border-right-width', 0);
        var borders = borderLeft + borderRight;
        return width - paddingLeft - paddingRight - borders;
      }
    };
    var getHeight = function (cell) {
      return needManualCalc() ? getCalculatedHeight(cell) : getProp(cell, 'height', get$6(cell));
    };
    var getWidth = function (cell) {
      return needManualCalc() ? getCalculatedWidth(cell) : getProp(cell, 'width', get$5(cell));
    };

    var rPercentageBasedSizeRegex = /(\d+(\.\d+)?)%/;
    var rPixelBasedSizeRegex = /(\d+(\.\d+)?)px|em/;
    var getPercentSize = function (elm, getter) {
      var relativeParent = offsetParent(elm).getOr(getBody(owner(elm)));
      return getter(elm) / getter(relativeParent) * 100;
    };
    var setPixelWidth = function (cell, amount) {
      set$1(cell, 'width', amount + 'px');
    };
    var setPercentageWidth = function (cell, amount) {
      set$1(cell, 'width', amount + '%');
    };
    var setHeight = function (cell, amount) {
      set$1(cell, 'height', amount + 'px');
    };
    var getHeightValue = function (cell) {
      return getRaw(cell, 'height').getOrThunk(function () {
        return getHeight(cell) + 'px';
      });
    };
    var convert = function (cell, number, getter, setter) {
      var newSize = table(cell).map(function (table) {
        var total = getter(table);
        return Math.floor(number / 100 * total);
      }).getOr(number);
      setter(cell, newSize);
      return newSize;
    };
    var normalizePixelSize = function (value, cell, getter, setter) {
      var number = parseInt(value, 10);
      return endsWith(value, '%') && name(cell) !== 'table' ? convert(cell, number, getter, setter) : number;
    };
    var getTotalHeight = function (cell) {
      var value = getHeightValue(cell);
      if (!value) {
        return get$6(cell);
      }
      return normalizePixelSize(value, cell, get$6, setHeight);
    };
    var get$7 = function (cell, type, f) {
      var v = f(cell);
      var span = getSpan(cell, type);
      return v / span;
    };
    var getRawWidth = function (element) {
      var cssWidth = getRaw(element, 'width');
      return cssWidth.fold(function () {
        return Optional.from(get$2(element, 'width'));
      }, function (width) {
        return Optional.some(width);
      });
    };
    var normalizePercentageWidth = function (cellWidth, tableSize) {
      return cellWidth / tableSize.pixelWidth() * 100;
    };
    var choosePercentageSize = function (element, width, tableSize) {
      var percentMatch = rPercentageBasedSizeRegex.exec(width);
      if (percentMatch !== null) {
        return parseFloat(percentMatch[1]);
      } else {
        var intWidth = getWidth(element);
        return normalizePercentageWidth(intWidth, tableSize);
      }
    };
    var getPercentageWidth = function (cell, tableSize) {
      var width = getRawWidth(cell);
      return width.fold(function () {
        var intWidth = get$5(cell);
        return normalizePercentageWidth(intWidth, tableSize);
      }, function (w) {
        return choosePercentageSize(cell, w, tableSize);
      });
    };
    var normalizePixelWidth = function (cellWidth, tableSize) {
      return cellWidth / 100 * tableSize.pixelWidth();
    };
    var choosePixelSize = function (element, width, tableSize) {
      var pixelMatch = rPixelBasedSizeRegex.exec(width);
      if (pixelMatch !== null) {
        return parseInt(pixelMatch[1], 10);
      }
      var percentMatch = rPercentageBasedSizeRegex.exec(width);
      if (percentMatch !== null) {
        var floatWidth = parseFloat(percentMatch[1]);
        return normalizePixelWidth(floatWidth, tableSize);
      }
      return getWidth(element);
    };
    var getPixelWidth = function (cell, tableSize) {
      var width = getRawWidth(cell);
      return width.fold(function () {
        return getWidth(cell);
      }, function (w) {
        return choosePixelSize(cell, w, tableSize);
      });
    };
    var getHeight$1 = function (cell) {
      return get$7(cell, 'rowspan', getTotalHeight);
    };
    var getGenericWidth = function (cell) {
      var width = getRawWidth(cell);
      return width.bind(function (w) {
        return parse(w, [
          'fixed',
          'relative',
          'empty'
        ]);
      });
    };
    var setGenericWidth = function (cell, amount, unit) {
      set$1(cell, 'width', amount + unit);
    };
    var getPixelTableWidth = function (table) {
      return get$5(table) + 'px';
    };
    var getPercentTableWidth = function (table) {
      return getPercentSize(table, get$5) + '%';
    };
    var isPercentSizing = function (table) {
      return getRawWidth(table).exists(function (size) {
        return rPercentageBasedSizeRegex.test(size);
      });
    };
    var isPixelSizing = function (table) {
      return getRawWidth(table).exists(function (size) {
        return rPixelBasedSizeRegex.test(size);
      });
    };
    var isNoneSizing = function (table) {
      return getRawWidth(table).isNone();
    };
    var percentageBasedSizeRegex = constant(rPercentageBasedSizeRegex);
    var pixelBasedSizeRegex = constant(rPixelBasedSizeRegex);

    var isCol = isTag('col');
    var getRaw$1 = function (cell, property, getter) {
      return getRaw(cell, property).fold(function () {
        return getter(cell) + 'px';
      }, function (raw) {
        return raw;
      });
    };
    var getRawW = function (cell, tableSize) {
      var fallback = function (e) {
        return isCol(e) ? get$5(e) : getPixelWidth(e, tableSize);
      };
      return getRaw$1(cell, 'width', fallback);
    };
    var getRawH = function (cell) {
      return getRaw$1(cell, 'height', getHeight$1);
    };
    var justCols = function (warehouse) {
      return map(Warehouse.justColumns(warehouse), function (column) {
        return Optional.from(column.element);
      });
    };
    var hasRawStyle = function (cell, prop) {
      return getRaw(cell, prop).isSome();
    };
    var isValidColumn = function (cell) {
      return !isCol(cell) || hasRawStyle(cell, 'width');
    };
    var getDimension = function (cellOpt, index, backups, filter, getter, fallback) {
      return cellOpt.filter(filter).fold(function () {
        return fallback(deduce(backups, index));
      }, function (cell) {
        return getter(cell);
      });
    };
    var getWidthFrom = function (warehouse, table, getWidth, fallback, tableSize) {
      var columnCells = columns$1(warehouse, function (cell) {
        return hasRawStyle(cell, 'width');
      });
      var columns = Warehouse.hasColumns(warehouse) ? justCols(warehouse) : columnCells;
      var backups = [Optional.some(width.edge(table))].concat(map(width.positions(columnCells, table), function (pos) {
        return pos.map(function (p) {
          return p.x;
        });
      }));
      var colFilter = not(hasColspan);
      return map(columns, function (cellOption, c) {
        return getDimension(cellOption, c, backups, colFilter, function (column) {
          if (isValidColumn(column)) {
            return getWidth(column, tableSize);
          } else {
            var cell = bindFrom(columnCells[c], identity);
            return getDimension(cell, c, backups, colFilter, function (cell) {
              return fallback(Optional.some(get$5(cell)));
            }, fallback);
          }
        }, fallback);
      });
    };
    var getDeduced = function (deduced) {
      return deduced.map(function (d) {
        return d + 'px';
      }).getOr('');
    };
    var getRawWidths = function (warehouse, table, tableSize) {
      return getWidthFrom(warehouse, table, getRawW, getDeduced, tableSize);
    };
    var getPercentageWidths = function (warehouse, table, tableSize) {
      return getWidthFrom(warehouse, table, getPercentageWidth, function (deduced) {
        return deduced.fold(function () {
          return tableSize.minCellWidth();
        }, function (cellWidth) {
          return cellWidth / tableSize.pixelWidth() * 100;
        });
      }, tableSize);
    };
    var getPixelWidths = function (warehouse, table, tableSize) {
      return getWidthFrom(warehouse, table, getPixelWidth, function (deduced) {
        return deduced.getOrThunk(tableSize.minCellWidth);
      }, tableSize);
    };
    var getHeightFrom = function (warehouse, table, direction, getHeight, fallback) {
      var rows = rows$1(warehouse);
      var backups = [Optional.some(direction.edge(table))].concat(map(direction.positions(rows, table), function (pos) {
        return pos.map(function (p) {
          return p.y;
        });
      }));
      return map(rows, function (cellOption, c) {
        return getDimension(cellOption, c, backups, not(hasRowspan), getHeight, fallback);
      });
    };
    var getPixelHeights = function (warehouse, table, direction) {
      return getHeightFrom(warehouse, table, direction, getHeight$1, function (deduced) {
        return deduced.getOrThunk(minHeight);
      });
    };
    var getRawHeights = function (warehouse, table, direction) {
      return getHeightFrom(warehouse, table, direction, getRawH, getDeduced);
    };

    var Cell = function (initial) {
      var value = initial;
      var get = function () {
        return value;
      };
      var set = function (v) {
        value = v;
      };
      return {
        get: get,
        set: set
      };
    };

    var noneSize = function (table) {
      var getWidth = function () {
        return get$5(table);
      };
      var zero = constant(0);
      var getWidths = function (warehouse, tableSize) {
        return getPixelWidths(warehouse, table, tableSize);
      };
      return {
        width: getWidth,
        pixelWidth: getWidth,
        getWidths: getWidths,
        getCellDelta: zero,
        singleColumnWidth: constant([0]),
        minCellWidth: zero,
        setElementWidth: noop,
        adjustTableWidth: noop,
        isRelative: true,
        label: 'none'
      };
    };
    var percentageSize = function (initialWidth, table) {
      var floatWidth = Cell(parseFloat(initialWidth));
      var pixelWidth = Cell(get$5(table));
      var getCellDelta = function (delta) {
        return delta / pixelWidth.get() * 100;
      };
      var singleColumnWidth = function (w, _delta) {
        return [100 - w];
      };
      var minCellWidth = function () {
        return minWidth() / pixelWidth.get() * 100;
      };
      var adjustTableWidth = function (delta) {
        var currentWidth = floatWidth.get();
        var change = delta / 100 * currentWidth;
        var newWidth = currentWidth + change;
        setPercentageWidth(table, newWidth);
        floatWidth.set(newWidth);
        pixelWidth.set(get$5(table));
      };
      var getWidths = function (warehouse, tableSize) {
        return getPercentageWidths(warehouse, table, tableSize);
      };
      return {
        width: floatWidth.get,
        pixelWidth: pixelWidth.get,
        getWidths: getWidths,
        getCellDelta: getCellDelta,
        singleColumnWidth: singleColumnWidth,
        minCellWidth: minCellWidth,
        setElementWidth: setPercentageWidth,
        adjustTableWidth: adjustTableWidth,
        isRelative: true,
        label: 'percent'
      };
    };
    var pixelSize = function (initialWidth, table) {
      var width = Cell(initialWidth);
      var getWidth = width.get;
      var getCellDelta = identity;
      var singleColumnWidth = function (w, delta) {
        var newNext = Math.max(minWidth(), w + delta);
        return [newNext - w];
      };
      var adjustTableWidth = function (delta) {
        var newWidth = getWidth() + delta;
        setPixelWidth(table, newWidth);
        width.set(newWidth);
      };
      var getWidths = function (warehouse, tableSize) {
        return getPixelWidths(warehouse, table, tableSize);
      };
      return {
        width: getWidth,
        pixelWidth: getWidth,
        getWidths: getWidths,
        getCellDelta: getCellDelta,
        singleColumnWidth: singleColumnWidth,
        minCellWidth: minWidth,
        setElementWidth: setPixelWidth,
        adjustTableWidth: adjustTableWidth,
        isRelative: false,
        label: 'pixel'
      };
    };
    var chooseSize = function (element, width) {
      var percentMatch = percentageBasedSizeRegex().exec(width);
      if (percentMatch !== null) {
        return percentageSize(percentMatch[1], element);
      }
      var pixelMatch = pixelBasedSizeRegex().exec(width);
      if (pixelMatch !== null) {
        var intWidth = parseInt(pixelMatch[1], 10);
        return pixelSize(intWidth, element);
      }
      var fallbackWidth = get$5(element);
      return pixelSize(fallbackWidth, element);
    };
    var getTableSize = function (table) {
      var width = getRawWidth(table);
      return width.fold(function () {
        return noneSize(table);
      }, function (w) {
        return chooseSize(table, w);
      });
    };
    var TableSize = {
      getTableSize: getTableSize,
      pixelSize: pixelSize,
      percentageSize: percentageSize,
      noneSize: noneSize
    };

    var statsStruct = function (minRow, minCol, maxRow, maxCol, allCells, selectedCells) {
      return {
        minRow: minRow,
        minCol: minCol,
        maxRow: maxRow,
        maxCol: maxCol,
        allCells: allCells,
        selectedCells: selectedCells
      };
    };
    var findSelectedStats = function (house, isSelected) {
      var totalColumns = house.grid.columns;
      var totalRows = house.grid.rows;
      var minRow = totalRows;
      var minCol = totalColumns;
      var maxRow = 0;
      var maxCol = 0;
      var allCells = [];
      var selectedCells = [];
      each$1(house.access, function (detail) {
        allCells.push(detail);
        if (isSelected(detail)) {
          selectedCells.push(detail);
          var startRow = detail.row;
          var endRow = startRow + detail.rowspan - 1;
          var startCol = detail.column;
          var endCol = startCol + detail.colspan - 1;
          if (startRow < minRow) {
            minRow = startRow;
          } else if (endRow > maxRow) {
            maxRow = endRow;
          }
          if (startCol < minCol) {
            minCol = startCol;
          } else if (endCol > maxCol) {
            maxCol = endCol;
          }
        }
      });
      return statsStruct(minRow, minCol, maxRow, maxCol, allCells, selectedCells);
    };
    var makeCell = function (list, seenSelected, rowIndex) {
      var row = list[rowIndex].element;
      var td = SugarElement.fromTag('td');
      append(td, SugarElement.fromTag('br'));
      var f = seenSelected ? append : prepend;
      f(row, td);
    };
    var fillInGaps = function (list, house, stats, isSelected) {
      var totalColumns = house.grid.columns;
      var totalRows = house.grid.rows;
      for (var i = 0; i < totalRows; i++) {
        var seenSelected = false;
        for (var j = 0; j < totalColumns; j++) {
          if (!(i < stats.minRow || i > stats.maxRow || j < stats.minCol || j > stats.maxCol)) {
            var needCell = Warehouse.getAt(house, i, j).filter(isSelected).isNone();
            if (needCell) {
              makeCell(list, seenSelected, i);
            } else {
              seenSelected = true;
            }
          }
        }
      }
    };
    var clean = function (replica, stats, house, widthDelta) {
      each$1(house.columns, function (col) {
        if (col.column < stats.minCol || col.column > stats.maxCol) {
          remove$2(col.element);
        }
      });
      var emptyRows = filter(firstLayer(replica, 'tr'), function (row) {
        return row.dom.childElementCount === 0;
      });
      each(emptyRows, remove$2);
      if (stats.minCol === stats.maxCol || stats.minRow === stats.maxRow) {
        each(firstLayer(replica, 'th,td'), function (cell) {
          remove(cell, 'rowspan');
          remove(cell, 'colspan');
        });
      }
      remove(replica, LOCKED_COL_ATTR);
      remove(replica, 'data-snooker-col-series');
      var tableSize = TableSize.getTableSize(replica);
      tableSize.adjustTableWidth(widthDelta);
    };
    var getTableWidthDelta = function (table, warehouse, tableSize, stats) {
      if (stats.minCol === 0 && warehouse.grid.columns === stats.maxCol + 1) {
        return 0;
      }
      var colWidths = getPixelWidths(warehouse, table, tableSize);
      var allColsWidth = foldl(colWidths, function (acc, width) {
        return acc + width;
      }, 0);
      var selectedColsWidth = foldl(colWidths.slice(stats.minCol, stats.maxCol + 1), function (acc, width) {
        return acc + width;
      }, 0);
      var newWidth = selectedColsWidth / allColsWidth * tableSize.pixelWidth();
      var delta = newWidth - tableSize.pixelWidth();
      return tableSize.getCellDelta(delta);
    };
    var extract = function (table, selectedSelector) {
      var isSelected = function (detail) {
        return is(detail.element, selectedSelector);
      };
      var replica = deep(table);
      var list = fromTable(replica);
      var tableSize = TableSize.getTableSize(table);
      var replicaHouse = Warehouse.generate(list);
      var replicaStats = findSelectedStats(replicaHouse, isSelected);
      var selector = 'th:not(' + selectedSelector + ')' + ',td:not(' + selectedSelector + ')';
      var unselectedCells = filterFirstLayer(replica, 'th,td', function (cell) {
        return is(cell, selector);
      });
      each(unselectedCells, remove$2);
      fillInGaps(list, replicaHouse, replicaStats, isSelected);
      var house = Warehouse.fromTable(table);
      var widthDelta = getTableWidthDelta(table, house, tableSize, replicaStats);
      clean(replica, replicaStats, replicaHouse, widthDelta);
      return replica;
    };

    var nbsp = '\xA0';

    var getEnd = function (element) {
      return name(element) === 'img' ? 1 : getOption(element).fold(function () {
        return children(element).length;
      }, function (v) {
        return v.length;
      });
    };
    var isTextNodeWithCursorPosition = function (el) {
      return getOption(el).filter(function (text) {
        return text.trim().length !== 0 || text.indexOf(nbsp) > -1;
      }).isSome();
    };
    var elementsWithCursorPosition = [
      'img',
      'br'
    ];
    var isCursorPosition = function (elem) {
      var hasCursorPosition = isTextNodeWithCursorPosition(elem);
      return hasCursorPosition || contains(elementsWithCursorPosition, name(elem));
    };

    var first = function (element) {
      return descendant(element, isCursorPosition);
    };
    var last$1 = function (element) {
      return descendantRtl(element, isCursorPosition);
    };
    var descendantRtl = function (scope, predicate) {
      var descend = function (element) {
        var children$1 = children(element);
        for (var i = children$1.length - 1; i >= 0; i--) {
          var child = children$1[i];
          if (predicate(child)) {
            return Optional.some(child);
          }
          var res = descend(child);
          if (res.isSome()) {
            return res;
          }
        }
        return Optional.none();
      };
      return descend(scope);
    };

    var transferableAttributes = {
      scope: [
        'row',
        'col'
      ]
    };
    var createCell = function () {
      var td = SugarElement.fromTag('td');
      append(td, SugarElement.fromTag('br'));
      return td;
    };
    var createCol = function () {
      return SugarElement.fromTag('col');
    };
    var createColgroup = function () {
      return SugarElement.fromTag('colgroup');
    };
    var replace = function (cell, tag, attrs) {
      var replica = copy$1(cell, tag);
      each$1(attrs, function (v, k) {
        if (v === null) {
          remove(replica, k);
        } else {
          set(replica, k, v);
        }
      });
      return replica;
    };
    var pasteReplace = function (cell) {
      return cell;
    };
    var newRow = function (doc) {
      return function () {
        return SugarElement.fromTag('tr', doc.dom);
      };
    };
    var cloneFormats = function (oldCell, newCell, formats) {
      var first$1 = first(oldCell);
      return first$1.map(function (firstText) {
        var formatSelector = formats.join(',');
        var parents = ancestors$1(firstText, formatSelector, function (element) {
          return eq$1(element, oldCell);
        });
        return foldr(parents, function (last, parent) {
          var clonedFormat = shallow(parent);
          remove(clonedFormat, 'contenteditable');
          append(last, clonedFormat);
          return clonedFormat;
        }, newCell);
      }).getOr(newCell);
    };
    var cloneAppropriateAttributes = function (original, clone) {
      each$1(transferableAttributes, function (validAttributes, attributeName) {
        return getOpt(original, attributeName).filter(function (attribute) {
          return contains(validAttributes, attribute);
        }).each(function (attribute) {
          return set(clone, attributeName, attribute);
        });
      });
    };
    var cellOperations = function (mutate, doc, formatsToClone) {
      var cloneCss = function (prev, clone) {
        copy(prev.element, clone);
        remove$1(clone, 'height');
        if (prev.colspan !== 1) {
          remove$1(clone, 'width');
        }
      };
      var newCell = function (prev) {
        var docu = owner(prev.element);
        var td = SugarElement.fromTag(name(prev.element), docu.dom);
        var formats = formatsToClone.getOr([
          'strong',
          'em',
          'b',
          'i',
          'span',
          'font',
          'h1',
          'h2',
          'h3',
          'h4',
          'h5',
          'h6',
          'p',
          'div'
        ]);
        var lastNode = formats.length > 0 ? cloneFormats(prev.element, td, formats) : td;
        append(lastNode, SugarElement.fromTag('br'));
        cloneCss(prev, td);
        cloneAppropriateAttributes(prev.element, td);
        mutate(prev.element, td);
        return td;
      };
      var newCol = function (prev) {
        var doc = owner(prev.element);
        var col = SugarElement.fromTag(name(prev.element), doc.dom);
        cloneCss(prev, col);
        mutate(prev.element, col);
        return col;
      };
      return {
        col: newCol,
        colgroup: createColgroup,
        row: newRow(doc),
        cell: newCell,
        replace: replace,
        gap: createCell
      };
    };
    var paste = function (doc) {
      return {
        col: createCol,
        colgroup: createColgroup,
        row: newRow(doc),
        cell: createCell,
        replace: pasteReplace,
        gap: createCell
      };
    };

    var fromHtml$1 = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      return children(SugarElement.fromDom(div));
    };
    var fromDom$1 = function (nodes) {
      return map(nodes, SugarElement.fromDom);
    };

    var getNodeName = function (elm) {
      return elm.nodeName.toLowerCase();
    };
    var getBody$1 = function (editor) {
      return SugarElement.fromDom(editor.getBody());
    };
    var getPixelWidth$1 = function (elm) {
      return elm.getBoundingClientRect().width;
    };
    var getPixelHeight = function (elm) {
      return elm.getBoundingClientRect().height;
    };
    var getIsRoot = function (editor) {
      return function (element) {
        return eq$1(element, getBody$1(editor));
      };
    };
    var removePxSuffix = function (size) {
      return size ? size.replace(/px$/, '') : '';
    };
    var addPxSuffix = function (size) {
      return /^\d+(\.\d+)?$/.test(size) ? size + 'px' : size;
    };
    var removeDataStyle = function (table) {
      remove(table, 'data-mce-style');
      var removeStyleAttribute = function (element) {
        return remove(element, 'data-mce-style');
      };
      each(cells(table), removeStyleAttribute);
      each(columns(table), removeStyleAttribute);
    };
    var getRawWidth$1 = function (editor, elm) {
      var raw = editor.dom.getStyle(elm, 'width') || editor.dom.getAttrib(elm, 'width');
      return Optional.from(raw).filter(isNotEmpty);
    };
    var isPercentage = function (value) {
      return /^(\d+(\.\d+)?)%$/.test(value);
    };
    var isPixel = function (value) {
      return /^(\d+(\.\d+)?)px$/.test(value);
    };
    var getSelectionStart = function (editor) {
      return SugarElement.fromDom(editor.selection.getStart());
    };

    var selection = function (selections) {
      return cata(selections.get(), constant([]), identity, pure);
    };
    var unmergable = function (selections) {
      var hasSpan = function (elem, type) {
        return getOpt(elem, type).exists(function (span) {
          return parseInt(span, 10) > 1;
        });
      };
      var hasRowOrColSpan = function (elem) {
        return hasSpan(elem, 'rowspan') || hasSpan(elem, 'colspan');
      };
      var candidates = selection(selections);
      return candidates.length > 0 && forall(candidates, hasRowOrColSpan) ? Optional.some(candidates) : Optional.none();
    };
    var mergable = function (table, selections, ephemera) {
      return cata(selections.get(), Optional.none, function (cells) {
        if (cells.length <= 1) {
          return Optional.none();
        } else {
          return retrieveBox(table, ephemera.firstSelectedSelector, ephemera.lastSelectedSelector).map(function (bounds) {
            return {
              bounds: bounds,
              cells: cells
            };
          });
        }
      }, Optional.none);
    };

    var strSelected = 'data-mce-selected';
    var strSelectedSelector = 'td[' + strSelected + '],th[' + strSelected + ']';
    var strAttributeSelector = '[' + strSelected + ']';
    var strFirstSelected = 'data-mce-first-selected';
    var strFirstSelectedSelector = 'td[' + strFirstSelected + '],th[' + strFirstSelected + ']';
    var strLastSelected = 'data-mce-last-selected';
    var strLastSelectedSelector = 'td[' + strLastSelected + '],th[' + strLastSelected + ']';
    var attributeSelector = strAttributeSelector;
    var ephemera = {
      selected: strSelected,
      selectedSelector: strSelectedSelector,
      firstSelected: strFirstSelected,
      firstSelectedSelector: strFirstSelectedSelector,
      lastSelected: strLastSelected,
      lastSelectedSelector: strLastSelectedSelector
    };

    var noMenu = function (cell) {
      return {
        element: cell,
        mergable: Optional.none(),
        unmergable: Optional.none(),
        selection: [cell]
      };
    };
    var forMenu = function (selections, table, cell) {
      return {
        element: cell,
        mergable: mergable(table, selections, ephemera),
        unmergable: unmergable(selections),
        selection: selection(selections)
      };
    };
    var paste$1 = function (element, clipboard, generators) {
      return {
        element: element,
        clipboard: clipboard,
        generators: generators
      };
    };
    var pasteRows = function (selections, cell, clipboard, generators) {
      return {
        selection: selection(selections),
        clipboard: clipboard,
        generators: generators
      };
    };

    var extractSelected = function (cells) {
      return table(cells[0]).map(function (table) {
        var replica = extract(table, attributeSelector);
        removeDataStyle(replica);
        return [replica];
      });
    };
    var serializeElements = function (editor, elements) {
      return map(elements, function (elm) {
        return editor.selection.serializer.serialize(elm.dom, {});
      }).join('');
    };
    var getTextContent = function (elements) {
      return map(elements, function (element) {
        return element.dom.innerText;
      }).join('');
    };
    var registerEvents = function (editor, selections, actions, cellSelection) {
      editor.on('BeforeGetContent', function (e) {
        var multiCellContext = function (cells) {
          e.preventDefault();
          extractSelected(cells).each(function (elements) {
            e.content = e.format === 'text' ? getTextContent(elements) : serializeElements(editor, elements);
          });
        };
        if (e.selection === true) {
          cata(selections.get(), noop, multiCellContext, noop);
        }
      });
      editor.on('BeforeSetContent', function (e) {
        if (e.selection === true && e.paste === true) {
          var cellOpt = Optional.from(editor.dom.getParent(editor.selection.getStart(), 'th,td'));
          cellOpt.each(function (domCell) {
            var cell = SugarElement.fromDom(domCell);
            table(cell).each(function (table) {
              var elements = filter(fromHtml$1(e.content), function (content) {
                return name(content) !== 'meta';
              });
              var isTable = function (elm) {
                return name(elm) === 'table';
              };
              if (elements.length === 1 && isTable(elements[0])) {
                e.preventDefault();
                var doc = SugarElement.fromDom(editor.getDoc());
                var generators = paste(doc);
                var targets = paste$1(cell, elements[0], generators);
                actions.pasteCells(table, targets).each(function (data) {
                  editor.selection.setRng(data.rng);
                  editor.focus();
                  cellSelection.clear(table);
                });
              }
            });
          });
        }
      });
    };

    var adt = Adt.generate([
      { none: [] },
      { only: ['index'] },
      {
        left: [
          'index',
          'next'
        ]
      },
      {
        middle: [
          'prev',
          'index',
          'next'
        ]
      },
      {
        right: [
          'prev',
          'index'
        ]
      }
    ]);
    var ColumnContext = __assign({}, adt);

    var neighbours = function (input, index) {
      if (input.length === 0) {
        return ColumnContext.none();
      }
      if (input.length === 1) {
        return ColumnContext.only(0);
      }
      if (index === 0) {
        return ColumnContext.left(0, 1);
      }
      if (index === input.length - 1) {
        return ColumnContext.right(index - 1, index);
      }
      if (index > 0 && index < input.length - 1) {
        return ColumnContext.middle(index - 1, index, index + 1);
      }
      return ColumnContext.none();
    };
    var determine = function (input, column, step, tableSize, resize) {
      var result = input.slice(0);
      var context = neighbours(input, column);
      var onNone = constant(map(result, constant(0)));
      var onOnly = function (index) {
        return tableSize.singleColumnWidth(result[index], step);
      };
      var onLeft = function (index, next) {
        return resize.calcLeftEdgeDeltas(result, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);
      };
      var onMiddle = function (prev, index, next) {
        return resize.calcMiddleDeltas(result, prev, index, next, step, tableSize.minCellWidth(), tableSize.isRelative);
      };
      var onRight = function (prev, index) {
        return resize.calcRightEdgeDeltas(result, prev, index, step, tableSize.minCellWidth(), tableSize.isRelative);
      };
      return context.fold(onNone, onOnly, onLeft, onMiddle, onRight);
    };

    var total = function (start, end, measures) {
      var r = 0;
      for (var i = start; i < end; i++) {
        r += measures[i] !== undefined ? measures[i] : 0;
      }
      return r;
    };
    var recalculateWidthForCells = function (warehouse, widths) {
      var all = Warehouse.justCells(warehouse);
      return map(all, function (cell) {
        var width = total(cell.column, cell.column + cell.colspan, widths);
        return {
          element: cell.element,
          width: width,
          colspan: cell.colspan
        };
      });
    };
    var recalculateWidthForColumns = function (warehouse, widths) {
      var groups = Warehouse.justColumns(warehouse);
      return map(groups, function (column, index) {
        return {
          element: column.element,
          width: widths[index],
          colspan: column.colspan
        };
      });
    };
    var recalculateHeightForCells = function (warehouse, heights) {
      var all = Warehouse.justCells(warehouse);
      return map(all, function (cell) {
        var height = total(cell.row, cell.row + cell.rowspan, heights);
        return {
          element: cell.element,
          height: height,
          rowspan: cell.rowspan
        };
      });
    };
    var matchRowHeight = function (warehouse, heights) {
      return map(warehouse.all, function (row, i) {
        return {
          element: row.element,
          height: heights[i]
        };
      });
    };

    var sumUp = function (newSize) {
      return foldr(newSize, function (b, a) {
        return b + a;
      }, 0);
    };
    var recalculate = function (warehouse, widths) {
      if (Warehouse.hasColumns(warehouse)) {
        return recalculateWidthForColumns(warehouse, widths);
      } else {
        return recalculateWidthForCells(warehouse, widths);
      }
    };
    var recalculateAndApply = function (warehouse, widths, tableSize) {
      var newSizes = recalculate(warehouse, widths);
      each(newSizes, function (cell) {
        tableSize.setElementWidth(cell.element, cell.width);
      });
    };
    var adjustWidth = function (table, delta, index, resizing, tableSize) {
      var warehouse = Warehouse.fromTable(table);
      var step = tableSize.getCellDelta(delta);
      var widths = tableSize.getWidths(warehouse, tableSize);
      var isLastColumn = index === warehouse.grid.columns - 1;
      var clampedStep = resizing.clampTableDelta(widths, index, step, tableSize.minCellWidth(), isLastColumn);
      var deltas = determine(widths, index, clampedStep, tableSize, resizing);
      var newWidths = map(deltas, function (dx, i) {
        return dx + widths[i];
      });
      recalculateAndApply(warehouse, newWidths, tableSize);
      resizing.resizeTable(tableSize.adjustTableWidth, clampedStep, isLastColumn);
    };
    var adjustHeight = function (table, delta, index, direction) {
      var warehouse = Warehouse.fromTable(table);
      var heights = getPixelHeights(warehouse, table, direction);
      var newHeights = map(heights, function (dy, i) {
        return index === i ? Math.max(delta + dy, minHeight()) : dy;
      });
      var newCellSizes = recalculateHeightForCells(warehouse, newHeights);
      var newRowSizes = matchRowHeight(warehouse, newHeights);
      each(newRowSizes, function (row) {
        setHeight(row.element, row.height);
      });
      each(newCellSizes, function (cell) {
        setHeight(cell.element, cell.height);
      });
      var total = sumUp(newHeights);
      setHeight(table, total);
    };
    var adjustAndRedistributeWidths = function (_table, list, details, tableSize, resizeBehaviour) {
      var warehouse = Warehouse.generate(list);
      var sizes = tableSize.getWidths(warehouse, tableSize);
      var tablePixelWidth = tableSize.pixelWidth();
      var _a = resizeBehaviour.calcRedestributedWidths(sizes, tablePixelWidth, details.pixelDelta, tableSize.isRelative), newSizes = _a.newSizes, delta = _a.delta;
      recalculateAndApply(warehouse, newSizes, tableSize);
      tableSize.adjustTableWidth(delta);
    };
    var adjustWidthTo = function (_table, list, _info, tableSize) {
      var warehouse = Warehouse.generate(list);
      var widths = tableSize.getWidths(warehouse, tableSize);
      recalculateAndApply(warehouse, widths, tableSize);
    };

    var zero = function (array) {
      return map(array, constant(0));
    };
    var surround = function (sizes, startIndex, endIndex, results, f) {
      return f(sizes.slice(0, startIndex)).concat(results).concat(f(sizes.slice(endIndex)));
    };
    var clampDeltaHelper = function (predicate) {
      return function (sizes, index, delta, minCellSize) {
        if (!predicate(delta)) {
          return delta;
        } else {
          var newSize = Math.max(minCellSize, sizes[index] - Math.abs(delta));
          var diff = Math.abs(newSize - sizes[index]);
          return delta >= 0 ? diff : -diff;
        }
      };
    };
    var clampNegativeDelta = clampDeltaHelper(function (delta) {
      return delta < 0;
    });
    var clampDelta = clampDeltaHelper(always);
    var resizeTable = function () {
      var calcFixedDeltas = function (sizes, index, next, delta, minCellSize) {
        var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);
        return surround(sizes, index, next + 1, [
          clampedDelta,
          0
        ], zero);
      };
      var calcRelativeDeltas = function (sizes, index, delta, minCellSize) {
        var ratio = (100 + delta) / 100;
        var newThis = Math.max(minCellSize, (sizes[index] + delta) / ratio);
        return map(sizes, function (size, idx) {
          var newSize = idx === index ? newThis : size / ratio;
          return newSize - size;
        });
      };
      var calcLeftEdgeDeltas = function (sizes, index, next, delta, minCellSize, isRelative) {
        if (isRelative) {
          return calcRelativeDeltas(sizes, index, delta, minCellSize);
        } else {
          return calcFixedDeltas(sizes, index, next, delta, minCellSize);
        }
      };
      var calcMiddleDeltas = function (sizes, _prev, index, next, delta, minCellSize, isRelative) {
        return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize, isRelative);
      };
      var resizeTable = function (resizer, delta) {
        return resizer(delta);
      };
      var calcRightEdgeDeltas = function (sizes, _prev, index, delta, minCellSize, isRelative) {
        if (isRelative) {
          return calcRelativeDeltas(sizes, index, delta, minCellSize);
        } else {
          var clampedDelta = clampNegativeDelta(sizes, index, delta, minCellSize);
          return zero(sizes.slice(0, index)).concat([clampedDelta]);
        }
      };
      var calcRedestributedWidths = function (sizes, totalWidth, pixelDelta, isRelative) {
        if (isRelative) {
          var tableWidth = totalWidth + pixelDelta;
          var ratio_1 = tableWidth / totalWidth;
          var newSizes = map(sizes, function (size) {
            return size / ratio_1;
          });
          return {
            delta: ratio_1 * 100 - 100,
            newSizes: newSizes
          };
        } else {
          return {
            delta: pixelDelta,
            newSizes: sizes
          };
        }
      };
      return {
        resizeTable: resizeTable,
        clampTableDelta: clampNegativeDelta,
        calcLeftEdgeDeltas: calcLeftEdgeDeltas,
        calcMiddleDeltas: calcMiddleDeltas,
        calcRightEdgeDeltas: calcRightEdgeDeltas,
        calcRedestributedWidths: calcRedestributedWidths
      };
    };
    var preserveTable = function () {
      var calcLeftEdgeDeltas = function (sizes, index, next, delta, minCellSize) {
        var idx = delta >= 0 ? next : index;
        var clampedDelta = clampDelta(sizes, idx, delta, minCellSize);
        return surround(sizes, index, next + 1, [
          clampedDelta,
          -clampedDelta
        ], zero);
      };
      var calcMiddleDeltas = function (sizes, _prev, index, next, delta, minCellSize) {
        return calcLeftEdgeDeltas(sizes, index, next, delta, minCellSize);
      };
      var resizeTable = function (resizer, delta, isLastColumn) {
        if (isLastColumn) {
          resizer(delta);
        }
      };
      var calcRightEdgeDeltas = function (sizes, _prev, _index, delta, _minCellSize, isRelative) {
        if (isRelative) {
          return zero(sizes);
        } else {
          var diff = delta / sizes.length;
          return map(sizes, constant(diff));
        }
      };
      var clampTableDelta = function (sizes, index, delta, minCellSize, isLastColumn) {
        if (isLastColumn) {
          if (delta >= 0) {
            return delta;
          } else {
            var maxDelta = foldl(sizes, function (a, b) {
              return a + b - minCellSize;
            }, 0);
            return Math.max(-maxDelta, delta);
          }
        } else {
          return clampNegativeDelta(sizes, index, delta, minCellSize);
        }
      };
      var calcRedestributedWidths = function (sizes, _totalWidth, _pixelDelta, _isRelative) {
        return {
          delta: 0,
          newSizes: sizes
        };
      };
      return {
        resizeTable: resizeTable,
        clampTableDelta: clampTableDelta,
        calcLeftEdgeDeltas: calcLeftEdgeDeltas,
        calcMiddleDeltas: calcMiddleDeltas,
        calcRightEdgeDeltas: calcRightEdgeDeltas,
        calcRedestributedWidths: calcRedestributedWidths
      };
    };

    var only = function (element, isResizable) {
      var parent = Optional.from(element.dom.documentElement).map(SugarElement.fromDom).getOr(element);
      return {
        parent: constant(parent),
        view: constant(element),
        origin: constant(SugarPosition(0, 0)),
        isResizable: isResizable
      };
    };
    var detached = function (editable, chrome, isResizable) {
      var origin = function () {
        return absolute(chrome);
      };
      return {
        parent: constant(chrome),
        view: constant(editable),
        origin: origin,
        isResizable: isResizable
      };
    };
    var body$1 = function (editable, chrome, isResizable) {
      return {
        parent: constant(chrome),
        view: constant(editable),
        origin: constant(SugarPosition(0, 0)),
        isResizable: isResizable
      };
    };
    var ResizeWire = {
      only: only,
      detached: detached,
      body: body$1
    };

    var adt$1 = Adt.generate([
      { invalid: ['raw'] },
      { pixels: ['value'] },
      { percent: ['value'] }
    ]);
    var validateFor = function (suffix, type, value) {
      var rawAmount = value.substring(0, value.length - suffix.length);
      var amount = parseFloat(rawAmount);
      return rawAmount === amount.toString() ? type(amount) : adt$1.invalid(value);
    };
    var from$1 = function (value) {
      if (endsWith(value, '%')) {
        return validateFor('%', adt$1.percent, value);
      }
      if (endsWith(value, 'px')) {
        return validateFor('px', adt$1.pixels, value);
      }
      return adt$1.invalid(value);
    };
    var Size = __assign(__assign({}, adt$1), { from: from$1 });

    var redistributeToPercent = function (widths, totalWidth) {
      return map(widths, function (w) {
        var colType = Size.from(w);
        return colType.fold(function () {
          return w;
        }, function (px) {
          var ratio = px / totalWidth * 100;
          return ratio + '%';
        }, function (pc) {
          return pc + '%';
        });
      });
    };
    var redistributeToPx = function (widths, totalWidth, newTotalWidth) {
      var scale = newTotalWidth / totalWidth;
      return map(widths, function (w) {
        var colType = Size.from(w);
        return colType.fold(function () {
          return w;
        }, function (px) {
          return px * scale + 'px';
        }, function (pc) {
          return pc / 100 * newTotalWidth + 'px';
        });
      });
    };
    var redistributeEmpty = function (newWidthType, columns) {
      var f = newWidthType.fold(function () {
        return constant('');
      }, function (pixels) {
        var num = pixels / columns;
        return constant(num + 'px');
      }, function () {
        var num = 100 / columns;
        return constant(num + '%');
      });
      return range(columns, f);
    };
    var redistributeValues = function (newWidthType, widths, totalWidth) {
      return newWidthType.fold(function () {
        return widths;
      }, function (px) {
        return redistributeToPx(widths, totalWidth, px);
      }, function (_pc) {
        return redistributeToPercent(widths, totalWidth);
      });
    };
    var redistribute = function (widths, totalWidth, newWidth) {
      var newType = Size.from(newWidth);
      var floats = forall(widths, function (s) {
        return s === '0px';
      }) ? redistributeEmpty(newType, widths.length) : redistributeValues(newType, widths, totalWidth);
      return normalize(floats);
    };
    var sum = function (values, fallback) {
      if (values.length === 0) {
        return fallback;
      }
      return foldr(values, function (rest, v) {
        return Size.from(v).fold(constant(0), identity, identity) + rest;
      }, 0);
    };
    var roundDown = function (num, unit) {
      var floored = Math.floor(num);
      return {
        value: floored + unit,
        remainder: num - floored
      };
    };
    var add = function (value, amount) {
      return Size.from(value).fold(constant(value), function (px) {
        return px + amount + 'px';
      }, function (pc) {
        return pc + amount + '%';
      });
    };
    var normalize = function (values) {
      if (values.length === 0) {
        return values;
      }
      var scan = foldr(values, function (rest, value) {
        var info = Size.from(value).fold(function () {
          return {
            value: value,
            remainder: 0
          };
        }, function (num) {
          return roundDown(num, 'px');
        }, function (num) {
          return {
            value: num + '%',
            remainder: 0
          };
        });
        return {
          output: [info.value].concat(rest.output),
          remainder: rest.remainder + info.remainder
        };
      }, {
        output: [],
        remainder: 0
      });
      var r = scan.output;
      return r.slice(0, r.length - 1).concat([add(r[r.length - 1], Math.round(scan.remainder))]);
    };
    var validate = Size.from;

    var redistributeToW = function (newWidths, cells, unit) {
      each(cells, function (cell) {
        var widths = newWidths.slice(cell.column, cell.colspan + cell.column);
        var w = sum(widths, minWidth());
        set$1(cell.element, 'width', w + unit);
      });
    };
    var redistributeToColumns = function (newWidths, columns, unit) {
      each(columns, function (column, index) {
        var width = sum([newWidths[index]], minWidth());
        set$1(column.element, 'width', width + unit);
      });
    };
    var redistributeToH = function (newHeights, rows, cells, unit) {
      each(cells, function (cell) {
        var heights = newHeights.slice(cell.row, cell.rowspan + cell.row);
        var h = sum(heights, minHeight());
        set$1(cell.element, 'height', h + unit);
      });
      each(rows, function (row, i) {
        set$1(row.element, 'height', newHeights[i]);
      });
    };
    var getUnit = function (newSize) {
      return validate(newSize).fold(constant('px'), constant('px'), constant('%'));
    };
    var redistribute$1 = function (table, optWidth, optHeight, tableSize) {
      var warehouse = Warehouse.fromTable(table);
      var rows = warehouse.all;
      var cells = Warehouse.justCells(warehouse);
      var columns = Warehouse.justColumns(warehouse);
      optWidth.each(function (newWidth) {
        var widthUnit = getUnit(newWidth);
        var totalWidth = get$5(table);
        var oldWidths = getRawWidths(warehouse, table, tableSize);
        var nuWidths = redistribute(oldWidths, totalWidth, newWidth);
        if (Warehouse.hasColumns(warehouse)) {
          redistributeToColumns(nuWidths, columns, widthUnit);
        } else {
          redistributeToW(nuWidths, cells, widthUnit);
        }
        set$1(table, 'width', newWidth);
      });
      optHeight.each(function (newHeight) {
        var hUnit = getUnit(newHeight);
        var totalHeight = get$6(table);
        var oldHeights = getRawHeights(warehouse, table, height);
        var nuHeights = redistribute(oldHeights, totalHeight, newHeight);
        redistributeToH(nuHeights, rows, cells, hUnit);
        set$1(table, 'height', newHeight);
      });
    };
    var isPercentSizing$1 = isPercentSizing;
    var isPixelSizing$1 = isPixelSizing;
    var isNoneSizing$1 = isNoneSizing;
    var getPercentTableWidth$1 = getPercentTableWidth;

    var getGridSize = function (table) {
      var warehouse = Warehouse.fromTable(table);
      return warehouse.grid;
    };

    var Event = function (fields) {
      var handlers = [];
      var bind = function (handler) {
        if (handler === undefined) {
          throw new Error('Event bind error: undefined handler');
        }
        handlers.push(handler);
      };
      var unbind = function (handler) {
        handlers = filter(handlers, function (h) {
          return h !== handler;
        });
      };
      var trigger = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        var event = {};
        each(fields, function (name, i) {
          event[name] = args[i];
        });
        each(handlers, function (handler) {
          handler(event);
        });
      };
      return {
        bind: bind,
        unbind: unbind,
        trigger: trigger
      };
    };

    var create = function (typeDefs) {
      var registry = map$1(typeDefs, function (event) {
        return {
          bind: event.bind,
          unbind: event.unbind
        };
      });
      var trigger = map$1(typeDefs, function (event) {
        return event.trigger;
      });
      return {
        registry: registry,
        trigger: trigger
      };
    };

    var last$2 = function (fn, rate) {
      var timer = null;
      var cancel = function () {
        if (timer !== null) {
          clearTimeout(timer);
          timer = null;
        }
      };
      var throttle = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
          args[_i] = arguments[_i];
        }
        if (timer !== null) {
          clearTimeout(timer);
        }
        timer = setTimeout(function () {
          fn.apply(null, args);
          timer = null;
        }, rate);
      };
      return {
        cancel: cancel,
        throttle: throttle
      };
    };

    var sort$1 = function (arr) {
      return arr.slice(0).sort();
    };
    var reqMessage = function (required, keys) {
      throw new Error('All required keys (' + sort$1(required).join(', ') + ') were not specified. Specified keys were: ' + sort$1(keys).join(', ') + '.');
    };
    var unsuppMessage = function (unsupported) {
      throw new Error('Unsupported keys for object: ' + sort$1(unsupported).join(', '));
    };
    var validateStrArr = function (label, array) {
      if (!isArray(array)) {
        throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');
      }
      each(array, function (a) {
        if (!isString(a)) {
          throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');
        }
      });
    };
    var invalidTypeMessage = function (incorrect, type) {
      throw new Error('All values need to be of type: ' + type + '. Keys (' + sort$1(incorrect).join(', ') + ') were not.');
    };
    var checkDupes = function (everything) {
      var sorted = sort$1(everything);
      var dupe = find(sorted, function (s, i) {
        return i < sorted.length - 1 && s === sorted[i + 1];
      });
      dupe.each(function (d) {
        throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');
      });
    };

    var base = function (handleUnsupported, required) {
      return baseWith(handleUnsupported, required, {
        validate: isFunction,
        label: 'function'
      });
    };
    var baseWith = function (handleUnsupported, required, pred) {
      if (required.length === 0) {
        throw new Error('You must specify at least one required field.');
      }
      validateStrArr('required', required);
      checkDupes(required);
      return function (obj) {
        var keys$1 = keys(obj);
        var allReqd = forall(required, function (req) {
          return contains(keys$1, req);
        });
        if (!allReqd) {
          reqMessage(required, keys$1);
        }
        handleUnsupported(required, keys$1);
        var invalidKeys = filter(required, function (key) {
          return !pred.validate(obj[key], key);
        });
        if (invalidKeys.length > 0) {
          invalidTypeMessage(invalidKeys, pred.label);
        }
        return obj;
      };
    };
    var handleExact = function (required, keys) {
      var unsupported = filter(keys, function (key) {
        return !contains(required, key);
      });
      if (unsupported.length > 0) {
        unsuppMessage(unsupported);
      }
    };
    var exactly = function (required) {
      return base(handleExact, required);
    };

    var DragMode = exactly([
      'compare',
      'extract',
      'mutate',
      'sink'
    ]);
    var DragSink = exactly([
      'element',
      'start',
      'stop',
      'destroy'
    ]);
    var DragApi = exactly([
      'forceDrop',
      'drop',
      'move',
      'delayDrop'
    ]);

    var InDrag = function () {
      var previous = Optional.none();
      var reset = function () {
        previous = Optional.none();
      };
      var update = function (mode, nu) {
        var result = previous.map(function (old) {
          return mode.compare(old, nu);
        });
        previous = Optional.some(nu);
        return result;
      };
      var onEvent = function (event, mode) {
        var dataOption = mode.extract(event);
        dataOption.each(function (data) {
          var offset = update(mode, data);
          offset.each(function (d) {
            events.trigger.move(d);
          });
        });
      };
      var events = create({ move: Event(['info']) });
      return {
        onEvent: onEvent,
        reset: reset,
        events: events.registry
      };
    };

    var NoDrag = function () {
      var events = create({ move: Event(['info']) });
      return {
        onEvent: noop,
        reset: noop,
        events: events.registry
      };
    };

    var Movement = function () {
      var noDragState = NoDrag();
      var inDragState = InDrag();
      var dragState = noDragState;
      var on = function () {
        dragState.reset();
        dragState = inDragState;
      };
      var off = function () {
        dragState.reset();
        dragState = noDragState;
      };
      var onEvent = function (event, mode) {
        dragState.onEvent(event, mode);
      };
      var isOn = function () {
        return dragState === inDragState;
      };
      return {
        on: on,
        off: off,
        isOn: isOn,
        onEvent: onEvent,
        events: inDragState.events
      };
    };

    var setup = function (mutation, mode, settings) {
      var active = false;
      var events = create({
        start: Event([]),
        stop: Event([])
      });
      var movement = Movement();
      var drop = function () {
        sink.stop();
        if (movement.isOn()) {
          movement.off();
          events.trigger.stop();
        }
      };
      var throttledDrop = last$2(drop, 200);
      var go = function (parent) {
        sink.start(parent);
        movement.on();
        events.trigger.start();
      };
      var mousemove = function (event) {
        throttledDrop.cancel();
        movement.onEvent(event, mode);
      };
      movement.events.move.bind(function (event) {
        mode.mutate(mutation, event.info);
      });
      var on = function () {
        active = true;
      };
      var off = function () {
        active = false;
      };
      var runIfActive = function (f) {
        return function () {
          var args = [];
          for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
          }
          if (active) {
            f.apply(null, args);
          }
        };
      };
      var sink = mode.sink(DragApi({
        forceDrop: drop,
        drop: runIfActive(drop),
        move: runIfActive(mousemove),
        delayDrop: runIfActive(throttledDrop.throttle)
      }), settings);
      var destroy = function () {
        sink.destroy();
      };
      return {
        element: sink.element,
        go: go,
        on: on,
        off: off,
        destroy: destroy,
        events: events.registry
      };
    };

    var mkEvent = function (target, x, y, stop, prevent, kill, raw) {
      return {
        target: target,
        x: x,
        y: y,
        stop: stop,
        prevent: prevent,
        kill: kill,
        raw: raw
      };
    };
    var fromRawEvent = function (rawEvent) {
      var target = SugarElement.fromDom(getOriginalEventTarget(rawEvent).getOr(rawEvent.target));
      var stop = function () {
        return rawEvent.stopPropagation();
      };
      var prevent = function () {
        return rawEvent.preventDefault();
      };
      var kill = compose(prevent, stop);
      return mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);
    };
    var handle = function (filter, handler) {
      return function (rawEvent) {
        if (filter(rawEvent)) {
          handler(fromRawEvent(rawEvent));
        }
      };
    };
    var binder = function (element, event, filter, handler, useCapture) {
      var wrapped = handle(filter, handler);
      element.dom.addEventListener(event, wrapped, useCapture);
      return { unbind: curry(unbind, element, event, wrapped, useCapture) };
    };
    var bind$1 = function (element, event, filter, handler) {
      return binder(element, event, filter, handler, false);
    };
    var unbind = function (element, event, handler, useCapture) {
      element.dom.removeEventListener(event, handler, useCapture);
    };

    var filter$2 = always;
    var bind$2 = function (element, event, handler) {
      return bind$1(element, event, filter$2, handler);
    };
    var fromRawEvent$1 = fromRawEvent;

    var read = function (element, attr) {
      var value = get$2(element, attr);
      return value === undefined || value === '' ? [] : value.split(' ');
    };
    var add$1 = function (element, attr, id) {
      var old = read(element, attr);
      var nu = old.concat([id]);
      set(element, attr, nu.join(' '));
      return true;
    };
    var remove$3 = function (element, attr, id) {
      var nu = filter(read(element, attr), function (v) {
        return v !== id;
      });
      if (nu.length > 0) {
        set(element, attr, nu.join(' '));
      } else {
        remove(element, attr);
      }
      return false;
    };

    var supports = function (element) {
      return element.dom.classList !== undefined;
    };
    var get$8 = function (element) {
      return read(element, 'class');
    };
    var add$2 = function (element, clazz) {
      return add$1(element, 'class', clazz);
    };
    var remove$4 = function (element, clazz) {
      return remove$3(element, 'class', clazz);
    };

    var add$3 = function (element, clazz) {
      if (supports(element)) {
        element.dom.classList.add(clazz);
      } else {
        add$2(element, clazz);
      }
    };
    var cleanClass = function (element) {
      var classList = supports(element) ? element.dom.classList : get$8(element);
      if (classList.length === 0) {
        remove(element, 'class');
      }
    };
    var remove$5 = function (element, clazz) {
      if (supports(element)) {
        var classList = element.dom.classList;
        classList.remove(clazz);
      } else {
        remove$4(element, clazz);
      }
      cleanClass(element);
    };
    var has$1 = function (element, clazz) {
      return supports(element) && element.dom.classList.contains(clazz);
    };

    var css = function (namespace) {
      var dashNamespace = namespace.replace(/\./g, '-');
      var resolve = function (str) {
        return dashNamespace + '-' + str;
      };
      return { resolve: resolve };
    };

    var styles = css('ephox-dragster');
    var resolve = styles.resolve;

    var Blocker = function (options) {
      var settings = __assign({ layerClass: resolve('blocker') }, options);
      var div = SugarElement.fromTag('div');
      set(div, 'role', 'presentation');
      setAll$1(div, {
        position: 'fixed',
        left: '0px',
        top: '0px',
        width: '100%',
        height: '100%'
      });
      add$3(div, resolve('blocker'));
      add$3(div, settings.layerClass);
      var element = function () {
        return div;
      };
      var destroy = function () {
        remove$2(div);
      };
      return {
        element: element,
        destroy: destroy
      };
    };

    var compare = function (old, nu) {
      return SugarPosition(nu.left - old.left, nu.top - old.top);
    };
    var extract$1 = function (event) {
      return Optional.some(SugarPosition(event.x, event.y));
    };
    var mutate = function (mutation, info) {
      mutation.mutate(info.left, info.top);
    };
    var sink = function (dragApi, settings) {
      var blocker = Blocker(settings);
      var mdown = bind$2(blocker.element(), 'mousedown', dragApi.forceDrop);
      var mup = bind$2(blocker.element(), 'mouseup', dragApi.drop);
      var mmove = bind$2(blocker.element(), 'mousemove', dragApi.move);
      var mout = bind$2(blocker.element(), 'mouseout', dragApi.delayDrop);
      var destroy = function () {
        blocker.destroy();
        mup.unbind();
        mmove.unbind();
        mout.unbind();
        mdown.unbind();
      };
      var start = function (parent) {
        append(parent, blocker.element());
      };
      var stop = function () {
        remove$2(blocker.element());
      };
      return DragSink({
        element: blocker.element,
        start: start,
        stop: stop,
        destroy: destroy
      });
    };
    var MouseDrag = DragMode({
      compare: compare,
      extract: extract$1,
      sink: sink,
      mutate: mutate
    });

    var transform = function (mutation, settings) {
      if (settings === void 0) {
        settings = {};
      }
      var mode = settings.mode !== undefined ? settings.mode : MouseDrag;
      return setup(mutation, mode, settings);
    };

    var isContentEditableTrue = function (elm) {
      return get$2(elm, 'contenteditable') === 'true';
    };
    var findClosestContentEditable = function (target, isRoot) {
      return closest$1(target, '[contenteditable]', isRoot);
    };

    var styles$1 = css('ephox-snooker');
    var resolve$1 = styles$1.resolve;

    var Mutation = function () {
      var events = create({
        drag: Event([
          'xDelta',
          'yDelta'
        ])
      });
      var mutate = function (x, y) {
        events.trigger.drag(x, y);
      };
      return {
        mutate: mutate,
        events: events.registry
      };
    };

    var BarMutation = function () {
      var events = create({
        drag: Event([
          'xDelta',
          'yDelta',
          'target'
        ])
      });
      var target = Optional.none();
      var delegate = Mutation();
      delegate.events.drag.bind(function (event) {
        target.each(function (t) {
          events.trigger.drag(event.xDelta, event.yDelta, t);
        });
      });
      var assign = function (t) {
        target = Optional.some(t);
      };
      var get = function () {
        return target;
      };
      return {
        assign: assign,
        get: get,
        mutate: delegate.mutate,
        events: events.registry
      };
    };

    var col = function (column, x, y, w, h) {
      var bar = SugarElement.fromTag('div');
      setAll$1(bar, {
        position: 'absolute',
        left: x - w / 2 + 'px',
        top: y + 'px',
        height: h + 'px',
        width: w + 'px'
      });
      setAll(bar, {
        'data-column': column,
        'role': 'presentation'
      });
      return bar;
    };
    var row = function (r, x, y, w, h) {
      var bar = SugarElement.fromTag('div');
      setAll$1(bar, {
        position: 'absolute',
        left: x + 'px',
        top: y - h / 2 + 'px',
        height: h + 'px',
        width: w + 'px'
      });
      setAll(bar, {
        'data-row': r,
        'role': 'presentation'
      });
      return bar;
    };

    var resizeBar = resolve$1('resizer-bar');
    var resizeRowBar = resolve$1('resizer-rows');
    var resizeColBar = resolve$1('resizer-cols');
    var BAR_THICKNESS = 7;
    var resizableRows = function (warehouse, isResizable) {
      return bind(warehouse.all, function (row, i) {
        return isResizable(row.element) ? [i] : [];
      });
    };
    var resizableColumns = function (warehouse, isResizable) {
      var resizableCols = [];
      range(warehouse.grid.columns, function (index) {
        var colElmOpt = Warehouse.getColumnAt(warehouse, index).map(function (col) {
          return col.element;
        });
        if (colElmOpt.forall(isResizable)) {
          resizableCols.push(index);
        }
      });
      return filter(resizableCols, function (colIndex) {
        var columnCells = Warehouse.filterItems(warehouse, function (cell) {
          return cell.column === colIndex;
        });
        return forall(columnCells, function (cell) {
          return isResizable(cell.element);
        });
      });
    };
    var destroy = function (wire) {
      var previous = descendants$1(wire.parent(), '.' + resizeBar);
      each(previous, remove$2);
    };
    var drawBar = function (wire, positions, create) {
      var origin = wire.origin();
      each(positions, function (cpOption) {
        cpOption.each(function (cp) {
          var bar = create(origin, cp);
          add$3(bar, resizeBar);
          append(wire.parent(), bar);
        });
      });
    };
    var refreshCol = function (wire, colPositions, position, tableHeight) {
      drawBar(wire, colPositions, function (origin, cp) {
        var colBar = col(cp.col, cp.x - origin.left, position.top - origin.top, BAR_THICKNESS, tableHeight);
        add$3(colBar, resizeColBar);
        return colBar;
      });
    };
    var refreshRow = function (wire, rowPositions, position, tableWidth) {
      drawBar(wire, rowPositions, function (origin, cp) {
        var rowBar = row(cp.row, position.left - origin.left, cp.y - origin.top, tableWidth, BAR_THICKNESS);
        add$3(rowBar, resizeRowBar);
        return rowBar;
      });
    };
    var refreshGrid = function (warhouse, wire, table, rows, cols) {
      var position = absolute(table);
      var isResizable = wire.isResizable;
      var rowPositions = rows.length > 0 ? height.positions(rows, table) : [];
      var resizableRowBars = rowPositions.length > 0 ? resizableRows(warhouse, isResizable) : [];
      var resizableRowPositions = filter(rowPositions, function (_pos, i) {
        return exists(resizableRowBars, function (barIndex) {
          return i === barIndex;
        });
      });
      refreshRow(wire, resizableRowPositions, position, getOuter(table));
      var colPositions = cols.length > 0 ? width.positions(cols, table) : [];
      var resizableColBars = colPositions.length > 0 ? resizableColumns(warhouse, isResizable) : [];
      var resizableColPositions = filter(colPositions, function (_pos, i) {
        return exists(resizableColBars, function (barIndex) {
          return i === barIndex;
        });
      });
      refreshCol(wire, resizableColPositions, position, getOuter$1(table));
    };
    var refresh = function (wire, table) {
      destroy(wire);
      if (wire.isResizable(table)) {
        var warehouse = Warehouse.fromTable(table);
        var rows = rows$1(warehouse);
        var cols = columns$1(warehouse);
        refreshGrid(warehouse, wire, table, rows, cols);
      }
    };
    var each$2 = function (wire, f) {
      var bars = descendants$1(wire.parent(), '.' + resizeBar);
      each(bars, f);
    };
    var hide = function (wire) {
      each$2(wire, function (bar) {
        set$1(bar, 'display', 'none');
      });
    };
    var show = function (wire) {
      each$2(wire, function (bar) {
        set$1(bar, 'display', 'block');
      });
    };
    var isRowBar = function (element) {
      return has$1(element, resizeRowBar);
    };
    var isColBar = function (element) {
      return has$1(element, resizeColBar);
    };

    var resizeBarDragging = resolve$1('resizer-bar-dragging');
    var BarManager = function (wire) {
      var mutation = BarMutation();
      var resizing = transform(mutation, {});
      var hoverTable = Optional.none();
      var getResizer = function (element, type) {
        return Optional.from(get$2(element, type));
      };
      mutation.events.drag.bind(function (event) {
        getResizer(event.target, 'data-row').each(function (_dataRow) {
          var currentRow = getCssValue(event.target, 'top');
          set$1(event.target, 'top', currentRow + event.yDelta + 'px');
        });
        getResizer(event.target, 'data-column').each(function (_dataCol) {
          var currentCol = getCssValue(event.target, 'left');
          set$1(event.target, 'left', currentCol + event.xDelta + 'px');
        });
      });
      var getDelta = function (target, dir) {
        var newX = getCssValue(target, dir);
        var oldX = getAttrValue(target, 'data-initial-' + dir, 0);
        return newX - oldX;
      };
      resizing.events.stop.bind(function () {
        mutation.get().each(function (target) {
          hoverTable.each(function (table) {
            getResizer(target, 'data-row').each(function (row) {
              var delta = getDelta(target, 'top');
              remove(target, 'data-initial-top');
              events.trigger.adjustHeight(table, delta, parseInt(row, 10));
            });
            getResizer(target, 'data-column').each(function (column) {
              var delta = getDelta(target, 'left');
              remove(target, 'data-initial-left');
              events.trigger.adjustWidth(table, delta, parseInt(column, 10));
            });
            refresh(wire, table);
          });
        });
      });
      var handler = function (target, dir) {
        events.trigger.startAdjust();
        mutation.assign(target);
        set(target, 'data-initial-' + dir, getCssValue(target, dir));
        add$3(target, resizeBarDragging);
        set$1(target, 'opacity', '0.2');
        resizing.go(wire.parent());
      };
      var mousedown = bind$2(wire.parent(), 'mousedown', function (event) {
        if (isRowBar(event.target)) {
          handler(event.target, 'top');
        }
        if (isColBar(event.target)) {
          handler(event.target, 'left');
        }
      });
      var isRoot = function (e) {
        return eq$1(e, wire.view());
      };
      var findClosestEditableTable = function (target) {
        return closest$1(target, 'table', isRoot).filter(function (table) {
          return findClosestContentEditable(table, isRoot).exists(isContentEditableTrue);
        });
      };
      var mouseover = bind$2(wire.view(), 'mouseover', function (event) {
        findClosestEditableTable(event.target).fold(function () {
          if (inBody(event.target)) {
            destroy(wire);
          }
        }, function (table) {
          hoverTable = Optional.some(table);
          refresh(wire, table);
        });
      });
      var destroy$1 = function () {
        mousedown.unbind();
        mouseover.unbind();
        resizing.destroy();
        destroy(wire);
      };
      var refresh$1 = function (tbl) {
        refresh(wire, tbl);
      };
      var events = create({
        adjustHeight: Event([
          'table',
          'delta',
          'row'
        ]),
        adjustWidth: Event([
          'table',
          'delta',
          'column'
        ]),
        startAdjust: Event([])
      });
      return {
        destroy: destroy$1,
        refresh: refresh$1,
        on: resizing.on,
        off: resizing.off,
        hideBars: curry(hide, wire),
        showBars: curry(show, wire),
        events: events.registry
      };
    };

    var create$1 = function (wire, resizing, lazySizing) {
      var hdirection = height;
      var vdirection = width;
      var manager = BarManager(wire);
      var events = create({
        beforeResize: Event([
          'table',
          'type'
        ]),
        afterResize: Event([
          'table',
          'type'
        ]),
        startDrag: Event([])
      });
      manager.events.adjustHeight.bind(function (event) {
        var table = event.table;
        events.trigger.beforeResize(table, 'row');
        var delta = hdirection.delta(event.delta, table);
        adjustHeight(table, delta, event.row, hdirection);
        events.trigger.afterResize(table, 'row');
      });
      manager.events.startAdjust.bind(function (_event) {
        events.trigger.startDrag();
      });
      manager.events.adjustWidth.bind(function (event) {
        var table = event.table;
        events.trigger.beforeResize(table, 'col');
        var delta = vdirection.delta(event.delta, table);
        var tableSize = lazySizing(table);
        adjustWidth(table, delta, event.column, resizing, tableSize);
        events.trigger.afterResize(table, 'col');
      });
      return {
        on: manager.on,
        off: manager.off,
        hideBars: manager.hideBars,
        showBars: manager.showBars,
        destroy: manager.destroy,
        events: events.registry
      };
    };
    var TableResize = { create: create$1 };

    var fireNewRow = function (editor, row) {
      return editor.fire('newrow', { node: row });
    };
    var fireNewCell = function (editor, cell) {
      return editor.fire('newcell', { node: cell });
    };
    var fireObjectResizeStart = function (editor, target, width, height, origin) {
      editor.fire('ObjectResizeStart', {
        target: target,
        width: width,
        height: height,
        origin: origin
      });
    };
    var fireObjectResized = function (editor, target, width, height, origin) {
      editor.fire('ObjectResized', {
        target: target,
        width: width,
        height: height,
        origin: origin
      });
    };
    var fireTableSelectionChange = function (editor, cells, start, finish, otherCells) {
      editor.fire('TableSelectionChange', {
        cells: cells,
        start: start,
        finish: finish,
        otherCells: otherCells
      });
    };
    var fireTableSelectionClear = function (editor) {
      editor.fire('TableSelectionClear');
    };
    var fireTableModified = function (editor, table, data) {
      editor.fire('TableModified', __assign(__assign({}, data), { table: table }));
    };
    var styleModified = {
      structure: false,
      style: true
    };
    var structureModified = {
      structure: true,
      style: false
    };

    var defaultTableToolbar = 'tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol';
    var defaultStyles = {
      'border-collapse': 'collapse',
      'width': '100%'
    };
    var determineDefaultStyles = function (editor) {
      if (isPixelsForced(editor)) {
        var editorWidth = editor.getBody().offsetWidth;
        return __assign(__assign({}, defaultStyles), { width: editorWidth + 'px' });
      } else if (isResponsiveForced(editor)) {
        return filter$1(defaultStyles, function (_value, key) {
          return key !== 'width';
        });
      } else {
        return defaultStyles;
      }
    };
    var defaultAttributes = { border: '1' };
    var defaultColumnResizingBehaviour = 'preservetable';
    var getTableSizingMode = function (editor) {
      return editor.getParam('table_sizing_mode', 'auto');
    };
    var getTableResponseWidth = function (editor) {
      return editor.getParam('table_responsive_width');
    };
    var getDefaultAttributes = function (editor) {
      return editor.getParam('table_default_attributes', defaultAttributes, 'object');
    };
    var getDefaultStyles = function (editor) {
      return editor.getParam('table_default_styles', determineDefaultStyles(editor), 'object');
    };
    var hasTableResizeBars = function (editor) {
      return editor.getParam('table_resize_bars', true, 'boolean');
    };
    var hasTabNavigation = function (editor) {
      return editor.getParam('table_tab_navigation', true, 'boolean');
    };
    var hasAdvancedCellTab = function (editor) {
      return editor.getParam('table_cell_advtab', true, 'boolean');
    };
    var hasAdvancedRowTab = function (editor) {
      return editor.getParam('table_row_advtab', true, 'boolean');
    };
    var hasAdvancedTableTab = function (editor) {
      return editor.getParam('table_advtab', true, 'boolean');
    };
    var hasAppearanceOptions = function (editor) {
      return editor.getParam('table_appearance_options', true, 'boolean');
    };
    var hasTableGrid = function (editor) {
      return editor.getParam('table_grid', true, 'boolean');
    };
    var shouldStyleWithCss = function (editor) {
      return editor.getParam('table_style_by_css', false, 'boolean');
    };
    var getCellClassList = function (editor) {
      return editor.getParam('table_cell_class_list', [], 'array');
    };
    var getRowClassList = function (editor) {
      return editor.getParam('table_row_class_list', [], 'array');
    };
    var getTableClassList = function (editor) {
      return editor.getParam('table_class_list', [], 'array');
    };
    var isPercentagesForced = function (editor) {
      return getTableSizingMode(editor) === 'relative' || getTableResponseWidth(editor) === true;
    };
    var isPixelsForced = function (editor) {
      return getTableSizingMode(editor) === 'fixed' || getTableResponseWidth(editor) === false;
    };
    var isResponsiveForced = function (editor) {
      return getTableSizingMode(editor) === 'responsive';
    };
    var getToolbar = function (editor) {
      return editor.getParam('table_toolbar', defaultTableToolbar);
    };
    var useColumnGroup = function (editor) {
      return editor.getParam('table_use_colgroups', false, 'boolean');
    };
    var getTableHeaderType = function (editor) {
      var defaultValue = 'section';
      var value = editor.getParam('table_header_type', defaultValue, 'string');
      var validValues = [
        'section',
        'cells',
        'sectionCells',
        'auto'
      ];
      if (!contains(validValues, value)) {
        return defaultValue;
      } else {
        return value;
      }
    };
    var getColumnResizingBehaviour = function (editor) {
      var validModes = [
        'preservetable',
        'resizetable'
      ];
      var givenMode = editor.getParam('table_column_resizing', defaultColumnResizingBehaviour, 'string');
      return find(validModes, function (mode) {
        return mode === givenMode;
      }).getOr(defaultColumnResizingBehaviour);
    };
    var isPreserveTableColumnResizing = function (editor) {
      return getColumnResizingBehaviour(editor) === 'preservetable';
    };
    var isResizeTableColumnResizing = function (editor) {
      return getColumnResizingBehaviour(editor) === 'resizetable';
    };
    var getCloneElements = function (editor) {
      var cloneElements = editor.getParam('table_clone_elements');
      if (isString(cloneElements)) {
        return Optional.some(cloneElements.split(/[ ,]/));
      } else if (Array.isArray(cloneElements)) {
        return Optional.some(cloneElements);
      } else {
        return Optional.none();
      }
    };
    var hasObjectResizing = function (editor) {
      var objectResizing = editor.getParam('object_resizing', true);
      return isString(objectResizing) ? objectResizing === 'table' : objectResizing;
    };

    var get$9 = function (editor, table) {
      if (isPercentagesForced(editor)) {
        var width = getRawWidth$1(editor, table.dom).filter(isPercentage).getOrThunk(function () {
          return getPercentTableWidth$1(table);
        });
        return TableSize.percentageSize(width, table);
      } else if (isPixelsForced(editor)) {
        return TableSize.pixelSize(get$5(table), table);
      } else {
        return TableSize.getTableSize(table);
      }
    };

    var cleanupLegacyAttributes = function (element) {
      remove(element, 'width');
    };
    var convertToPercentSize = function (table, tableSize) {
      var newWidth = getPercentTableWidth(table);
      redistribute$1(table, Optional.some(newWidth), Optional.none(), tableSize);
      cleanupLegacyAttributes(table);
    };
    var convertToPixelSize = function (table, tableSize) {
      var newWidth = getPixelTableWidth(table);
      redistribute$1(table, Optional.some(newWidth), Optional.none(), tableSize);
      cleanupLegacyAttributes(table);
    };
    var convertToNoneSize = function (table) {
      remove$1(table, 'width');
      var columns$1 = columns(table);
      var rowElements = columns$1.length > 0 ? columns$1 : cells(table);
      each(rowElements, function (cell) {
        remove$1(cell, 'width');
        cleanupLegacyAttributes(cell);
      });
      cleanupLegacyAttributes(table);
    };

    var enforcePercentage = function (editor, table) {
      var tableSizing = get$9(editor, table);
      convertToPercentSize(table, tableSizing);
    };
    var enforcePixels = function (editor, table) {
      var tableSizing = get$9(editor, table);
      convertToPixelSize(table, tableSizing);
    };
    var enforceNone = convertToNoneSize;
    var syncPixels = function (table) {
      var warehouse = Warehouse.fromTable(table);
      if (!Warehouse.hasColumns(warehouse)) {
        each(cells(table), function (cell) {
          var computedWidth = get$3(cell, 'width');
          set$1(cell, 'width', computedWidth);
          remove(cell, 'width');
        });
      }
    };

    var createContainer = function () {
      var container = SugarElement.fromTag('div');
      setAll$1(container, {
        position: 'static',
        height: '0',
        width: '0',
        padding: '0',
        margin: '0',
        border: '0'
      });
      append(body(), container);
      return container;
    };
    var get$a = function (editor, isResizable) {
      return editor.inline ? ResizeWire.body(getBody$1(editor), createContainer(), isResizable) : ResizeWire.only(SugarElement.fromDom(editor.getDoc()), isResizable);
    };
    var remove$6 = function (editor, wire) {
      if (editor.inline) {
        remove$2(wire.parent());
      }
    };

    var barResizerPrefix = 'bar-';
    var isResizable = function (elm) {
      return get$2(elm, 'data-mce-resize') !== 'false';
    };
    var getResizeHandler = function (editor) {
      var selectionRng = Optional.none();
      var resize = Optional.none();
      var wire = Optional.none();
      var startW;
      var startRawW;
      var isTable = function (elm) {
        return elm.nodeName === 'TABLE';
      };
      var lazyResize = function () {
        return resize;
      };
      var lazyWire = function () {
        return wire.getOr(ResizeWire.only(SugarElement.fromDom(editor.getBody()), isResizable));
      };
      var lazySizing = function (table) {
        return get$9(editor, table);
      };
      var lazyResizingBehaviour = function () {
        return isPreserveTableColumnResizing(editor) ? preserveTable() : resizeTable();
      };
      var getNumColumns = function (table) {
        return getGridSize(table).columns;
      };
      var afterCornerResize = function (table, origin, width) {
        var isRightEdgeResize = endsWith(origin, 'e');
        if (startRawW === '') {
          enforcePercentage(editor, table);
        }
        if (width !== startW && startRawW !== '') {
          set$1(table, 'width', startRawW);
          var resizing = lazyResizingBehaviour();
          var tableSize = lazySizing(table);
          var col = isPreserveTableColumnResizing(editor) || isRightEdgeResize ? getNumColumns(table) - 1 : 0;
          adjustWidth(table, width - startW, col, resizing, tableSize);
        } else if (isPercentage(startRawW)) {
          var percentW = parseFloat(startRawW.replace('%', ''));
          var targetPercentW = width * percentW / startW;
          set$1(table, 'width', targetPercentW + '%');
        }
        if (isPixel(startRawW)) {
          syncPixels(table);
        }
      };
      var destroy = function () {
        resize.each(function (sz) {
          sz.destroy();
        });
        wire.each(function (w) {
          remove$6(editor, w);
        });
      };
      editor.on('init', function () {
        var rawWire = get$a(editor, isResizable);
        wire = Optional.some(rawWire);
        if (hasObjectResizing(editor) && hasTableResizeBars(editor)) {
          var resizing = lazyResizingBehaviour();
          var sz = TableResize.create(rawWire, resizing, lazySizing);
          sz.on();
          sz.events.startDrag.bind(function (_event) {
            selectionRng = Optional.some(editor.selection.getRng());
          });
          sz.events.beforeResize.bind(function (event) {
            var rawTable = event.table.dom;
            fireObjectResizeStart(editor, rawTable, getPixelWidth$1(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);
          });
          sz.events.afterResize.bind(function (event) {
            var table = event.table;
            var rawTable = table.dom;
            removeDataStyle(table);
            selectionRng.each(function (rng) {
              editor.selection.setRng(rng);
              editor.focus();
            });
            fireObjectResized(editor, rawTable, getPixelWidth$1(rawTable), getPixelHeight(rawTable), barResizerPrefix + event.type);
            editor.undoManager.add();
          });
          resize = Optional.some(sz);
        }
      });
      editor.on('ObjectResizeStart', function (e) {
        var targetElm = e.target;
        if (isTable(targetElm)) {
          var table = SugarElement.fromDom(targetElm);
          each(editor.dom.select('.mce-clonedresizable'), function (clone) {
            editor.dom.addClass(clone, 'mce-' + getColumnResizingBehaviour(editor) + '-columns');
          });
          if (!isPixelSizing$1(table) && isPixelsForced(editor)) {
            enforcePixels(editor, table);
          } else if (!isPercentSizing$1(table) && isPercentagesForced(editor)) {
            enforcePercentage(editor, table);
          }
          if (isNoneSizing$1(table) && startsWith(e.origin, barResizerPrefix)) {
            enforcePercentage(editor, table);
          }
          startW = e.width;
          startRawW = isResponsiveForced(editor) ? '' : getRawWidth$1(editor, targetElm).getOr('');
        }
      });
      editor.on('ObjectResized', function (e) {
        var targetElm = e.target;
        if (isTable(targetElm)) {
          var table = SugarElement.fromDom(targetElm);
          var origin_1 = e.origin;
          if (startsWith(origin_1, 'corner-')) {
            afterCornerResize(table, origin_1, e.width);
          }
          removeDataStyle(table);
          fireTableModified(editor, table.dom, styleModified);
        }
      });
      editor.on('SwitchMode', function () {
        lazyResize().each(function (resize) {
          if (editor.mode.isReadOnly()) {
            resize.hideBars();
          } else {
            resize.showBars();
          }
        });
      });
      return {
        lazyResize: lazyResize,
        lazyWire: lazyWire,
        destroy: destroy
      };
    };

    var point = function (element, offset) {
      return {
        element: element,
        offset: offset
      };
    };

    var scan = function (universe, element, direction) {
      if (universe.property().isText(element) && universe.property().getText(element).trim().length === 0 || universe.property().isComment(element)) {
        return direction(element).bind(function (elem) {
          return scan(universe, elem, direction).orThunk(function () {
            return Optional.some(elem);
          });
        });
      } else {
        return Optional.none();
      }
    };
    var toEnd = function (universe, element) {
      if (universe.property().isText(element)) {
        return universe.property().getText(element).length;
      }
      var children = universe.property().children(element);
      return children.length;
    };
    var freefallRtl = function (universe, element) {
      var candidate = scan(universe, element, universe.query().prevSibling).getOr(element);
      if (universe.property().isText(candidate)) {
        return point(candidate, toEnd(universe, candidate));
      }
      var children = universe.property().children(candidate);
      return children.length > 0 ? freefallRtl(universe, children[children.length - 1]) : point(candidate, toEnd(universe, candidate));
    };

    var freefallRtl$1 = freefallRtl;

    var universe$1 = DomUniverse();
    var freefallRtl$2 = function (element) {
      return freefallRtl$1(universe$1, element);
    };

    var halve = function (main, other) {
      var colspan = getSpan(main, 'colspan');
      if (colspan === 1) {
        var width = getGenericWidth(main);
        width.each(function (w) {
          var newWidth = w.value / 2;
          setGenericWidth(main, newWidth, w.unit);
          setGenericWidth(other, newWidth, w.unit);
        });
      }
    };

    var setIfNot = function (element, property, value, ignore) {
      if (value === ignore) {
        remove(element, property);
      } else {
        set(element, property, value);
      }
    };
    var insert = function (table, selector, element) {
      last(children$2(table, selector)).fold(function () {
        return prepend(table, element);
      }, function (child) {
        return after(child, element);
      });
    };
    var generateSection = function (table, sectionName) {
      var section = child$2(table, sectionName).getOrThunk(function () {
        var newSection = SugarElement.fromTag(sectionName, owner(table).dom);
        if (sectionName === 'thead') {
          insert(table, 'caption,colgroup', newSection);
        } else if (sectionName === 'colgroup') {
          insert(table, 'caption', newSection);
        } else {
          append(table, newSection);
        }
        return newSection;
      });
      empty(section);
      return section;
    };
    var render = function (table, grid) {
      var newRows = [];
      var newCells = [];
      var syncRows = function (gridSection) {
        return map(gridSection, function (row) {
          if (row.isNew) {
            newRows.push(row.element);
          }
          var tr = row.element;
          empty(tr);
          each(row.cells, function (cell) {
            if (cell.isNew) {
              newCells.push(cell.element);
            }
            setIfNot(cell.element, 'colspan', cell.colspan, 1);
            setIfNot(cell.element, 'rowspan', cell.rowspan, 1);
            append(tr, cell.element);
          });
          return tr;
        });
      };
      var syncColGroup = function (gridSection) {
        return bind(gridSection, function (colGroup) {
          return map(colGroup.cells, function (col) {
            setIfNot(col.element, 'span', col.colspan, 1);
            return col.element;
          });
        });
      };
      var renderSection = function (gridSection, sectionName) {
        var section = generateSection(table, sectionName);
        var sync = sectionName === 'colgroup' ? syncColGroup : syncRows;
        var sectionElems = sync(gridSection);
        append$1(section, sectionElems);
      };
      var removeSection = function (sectionName) {
        child$2(table, sectionName).each(remove$2);
      };
      var renderOrRemoveSection = function (gridSection, sectionName) {
        if (gridSection.length > 0) {
          renderSection(gridSection, sectionName);
        } else {
          removeSection(sectionName);
        }
      };
      var headSection = [];
      var bodySection = [];
      var footSection = [];
      var columnGroupsSection = [];
      each(grid, function (row) {
        switch (row.section) {
        case 'thead':
          headSection.push(row);
          break;
        case 'tbody':
          bodySection.push(row);
          break;
        case 'tfoot':
          footSection.push(row);
          break;
        case 'colgroup':
          columnGroupsSection.push(row);
          break;
        }
      });
      renderOrRemoveSection(columnGroupsSection, 'colgroup');
      renderOrRemoveSection(headSection, 'thead');
      renderOrRemoveSection(bodySection, 'tbody');
      renderOrRemoveSection(footSection, 'tfoot');
      return {
        newRows: newRows,
        newCells: newCells
      };
    };
    var copy$2 = function (grid) {
      return map(grid, function (row) {
        var tr = shallow(row.element);
        each(row.cells, function (cell) {
          var clonedCell = deep(cell.element);
          setIfNot(clonedCell, 'colspan', cell.colspan, 1);
          setIfNot(clonedCell, 'rowspan', cell.rowspan, 1);
          append(tr, clonedCell);
        });
        return tr;
      });
    };

    var getColumn = function (grid, index) {
      return map(grid, function (row) {
        return getCell(row, index);
      });
    };
    var getRow = function (grid, index) {
      return grid[index];
    };
    var findDiff = function (xs, comp) {
      if (xs.length === 0) {
        return 0;
      }
      var first = xs[0];
      var index = findIndex(xs, function (x) {
        return !comp(first.element, x.element);
      });
      return index.fold(function () {
        return xs.length;
      }, function (ind) {
        return ind;
      });
    };
    var subgrid = function (grid, row, column, comparator) {
      var restOfRow = getRow(grid, row).cells.slice(column);
      var endColIndex = findDiff(restOfRow, comparator);
      var restOfColumn = getColumn(grid, column).slice(row);
      var endRowIndex = findDiff(restOfColumn, comparator);
      return {
        colspan: endColIndex,
        rowspan: endRowIndex
      };
    };

    var toDetails = function (grid, comparator) {
      var seen = map(grid, function (row) {
        return map(row.cells, never);
      });
      var updateSeen = function (rowIndex, columnIndex, rowspan, colspan) {
        for (var row = rowIndex; row < rowIndex + rowspan; row++) {
          for (var column = columnIndex; column < columnIndex + colspan; column++) {
            seen[row][column] = true;
          }
        }
      };
      return map(grid, function (row, rowIndex) {
        var details = bind(row.cells, function (cell, columnIndex) {
          if (seen[rowIndex][columnIndex] === false) {
            var result = subgrid(grid, rowIndex, columnIndex, comparator);
            updateSeen(rowIndex, columnIndex, result.rowspan, result.colspan);
            return [detailnew(cell.element, result.rowspan, result.colspan, cell.isNew)];
          } else {
            return [];
          }
        });
        return rowdetails(details, row.section);
      });
    };
    var toGrid = function (warehouse, generators, isNew) {
      var grid = [];
      if (Warehouse.hasColumns(warehouse)) {
        var groupElementNew = map(Warehouse.justColumns(warehouse), function (column) {
          return elementnew(column.element, isNew, false);
        });
        grid.push(rowcells(groupElementNew, 'colgroup'));
      }
      for (var rowIndex = 0; rowIndex < warehouse.grid.rows; rowIndex++) {
        var rowCells = [];
        for (var columnIndex = 0; columnIndex < warehouse.grid.columns; columnIndex++) {
          var element = Warehouse.getAt(warehouse, rowIndex, columnIndex).map(function (item) {
            return elementnew(item.element, isNew, item.isLocked);
          }).getOrThunk(function () {
            return elementnew(generators.gap(), true, false);
          });
          rowCells.push(element);
        }
        var row = rowcells(rowCells, warehouse.all[rowIndex].section);
        grid.push(row);
      }
      return grid;
    };

    var fromWarehouse = function (warehouse, generators) {
      return toGrid(warehouse, generators, false);
    };
    var deriveRows = function (rendered, generators) {
      var findRow = function (details) {
        var rowOfCells = findMap(details, function (detail) {
          return parent(detail.element).map(function (row) {
            var isNew = parent(row).isNone();
            return elementnew(row, isNew, false);
          });
        });
        return rowOfCells.getOrThunk(function () {
          return elementnew(generators.row(), true, false);
        });
      };
      return map(rendered, function (details) {
        var row = findRow(details.details);
        return rowdatanew(row.element, details.details, details.section, row.isNew);
      });
    };
    var toDetailList = function (grid, generators) {
      var rendered = toDetails(grid, eq$1);
      return deriveRows(rendered, generators);
    };
    var findInWarehouse = function (warehouse, element) {
      return findMap(warehouse.all, function (r) {
        return find(r.cells, function (e) {
          return eq$1(element, e.element);
        });
      });
    };
    var extractCells = function (warehouse, target, predicate) {
      var details = map(target.selection, function (cell$1) {
        return cell(cell$1).bind(function (lc) {
          return findInWarehouse(warehouse, lc);
        }).filter(predicate);
      });
      var cells = cat(details);
      return someIf(cells.length > 0, cells);
    };
    var run = function (operation, extract, adjustment, postAction, genWrappers) {
      return function (wire, table, target, generators, sizing, resizeBehaviour) {
        var warehouse = Warehouse.fromTable(table);
        var output = extract(warehouse, target).map(function (info) {
          var model = fromWarehouse(warehouse, generators);
          var result = operation(model, info, eq$1, genWrappers(generators));
          var lockedColumns = getLockedColumnsFromGrid(result.grid);
          var grid = toDetailList(result.grid, generators);
          return {
            info: info,
            grid: grid,
            cursor: result.cursor,
            lockedColumns: lockedColumns
          };
        });
        return output.bind(function (out) {
          var newElements = render(table, out.grid);
          var tableSizing = Optional.from(sizing).getOrThunk(function () {
            return TableSize.getTableSize(table);
          });
          var resizing = Optional.from(resizeBehaviour).getOrThunk(preserveTable);
          adjustment(table, out.grid, out.info, tableSizing, resizing);
          postAction(table);
          refresh(wire, table);
          remove(table, LOCKED_COL_ATTR);
          if (out.lockedColumns.length > 0) {
            set(table, LOCKED_COL_ATTR, out.lockedColumns.join(','));
          }
          return Optional.some({
            cursor: out.cursor,
            newRows: newElements.newRows,
            newCells: newElements.newCells
          });
        });
      };
    };
    var onCell = function (warehouse, target) {
      return cell(target.element).bind(function (cell) {
        return findInWarehouse(warehouse, cell);
      });
    };
    var onPaste = function (warehouse, target) {
      return cell(target.element).bind(function (cell) {
        return findInWarehouse(warehouse, cell).map(function (details) {
          var value = __assign(__assign({}, details), {
            generators: target.generators,
            clipboard: target.clipboard
          });
          return value;
        });
      });
    };
    var onPasteByEditor = function (warehouse, target) {
      return extractCells(warehouse, target, always).map(function (cells) {
        return {
          cells: cells,
          generators: target.generators,
          clipboard: target.clipboard
        };
      });
    };
    var onMergable = function (_warehouse, target) {
      return target.mergable;
    };
    var onUnmergable = function (_warehouse, target) {
      return target.unmergable;
    };
    var onCells = function (warehouse, target) {
      return extractCells(warehouse, target, always);
    };
    var onUnlockedCell = function (warehouse, target) {
      return onCell(warehouse, target).filter(function (detail) {
        return !detail.isLocked;
      });
    };
    var onUnlockedCells = function (warehouse, target) {
      return extractCells(warehouse, target, function (detail) {
        return !detail.isLocked;
      });
    };
    var isUnlockedTableCell = function (warehouse, cell) {
      return findInWarehouse(warehouse, cell).exists(function (detail) {
        return !detail.isLocked;
      });
    };
    var allUnlocked = function (warehouse, cells) {
      return forall(cells, function (cell) {
        return isUnlockedTableCell(warehouse, cell);
      });
    };
    var onUnlockedMergable = function (warehouse, target) {
      return onMergable(warehouse, target).filter(function (mergeable) {
        return allUnlocked(warehouse, mergeable.cells);
      });
    };
    var onUnlockedUnmergable = function (warehouse, target) {
      return onUnmergable(warehouse, target).filter(function (cells) {
        return allUnlocked(warehouse, cells);
      });
    };

    var merge = function (grid, bounds, comparator, substitution) {
      var rows = extractGridDetails(grid).rows;
      if (rows.length === 0) {
        return grid;
      }
      for (var i = bounds.startRow; i <= bounds.finishRow; i++) {
        for (var j = bounds.startCol; j <= bounds.finishCol; j++) {
          var row = rows[i];
          var isLocked = getCell(row, j).isLocked;
          mutateCell(row, j, elementnew(substitution(), false, isLocked));
        }
      }
      return grid;
    };
    var unmerge = function (grid, target, comparator, substitution) {
      var rows = extractGridDetails(grid).rows;
      var first = true;
      for (var i = 0; i < rows.length; i++) {
        for (var j = 0; j < cellLength(rows[0]); j++) {
          var row = rows[i];
          var currentCell = getCell(row, j);
          var currentCellElm = currentCell.element;
          var isToReplace = comparator(currentCellElm, target);
          if (isToReplace === true && first === false) {
            mutateCell(row, j, elementnew(substitution(), true, currentCell.isLocked));
          } else if (isToReplace === true) {
            first = false;
          }
        }
      }
      return grid;
    };
    var uniqueCells = function (row, comparator) {
      return foldl(row, function (rest, cell) {
        return exists(rest, function (currentCell) {
          return comparator(currentCell.element, cell.element);
        }) ? rest : rest.concat([cell]);
      }, []);
    };
    var splitCols = function (grid, index, comparator, substitution) {
      if (index > 0 && index < grid[0].cells.length) {
        each(grid, function (row) {
          var prevCell = row.cells[index - 1];
          var current = row.cells[index];
          var isToReplace = comparator(current.element, prevCell.element);
          if (isToReplace) {
            mutateCell(row, index, elementnew(substitution(), true, current.isLocked));
          }
        });
      }
      return grid;
    };
    var splitRows = function (grid, index, comparator, substitution) {
      var rows = extractGridDetails(grid).rows;
      if (index > 0 && index < rows.length) {
        var rowPrevCells = rows[index - 1].cells;
        var cells = uniqueCells(rowPrevCells, comparator);
        each(cells, function (cell) {
          var replacement = Optional.none();
          for (var i = index; i < rows.length; i++) {
            var _loop_1 = function (j) {
              var row = rows[i];
              var current = getCell(row, j);
              var isToReplace = comparator(current.element, cell.element);
              if (isToReplace) {
                if (replacement.isNone()) {
                  replacement = Optional.some(substitution());
                }
                replacement.each(function (sub) {
                  mutateCell(row, j, elementnew(sub, true, current.isLocked));
                });
              }
            };
            for (var j = 0; j < cellLength(rows[0]); j++) {
              _loop_1(j);
            }
          }
        });
      }
      return grid;
    };

    var value = function (o) {
      var is = function (v) {
        return o === v;
      };
      var or = function (_opt) {
        return value(o);
      };
      var orThunk = function (_f) {
        return value(o);
      };
      var map = function (f) {
        return value(f(o));
      };
      var mapError = function (_f) {
        return value(o);
      };
      var each = function (f) {
        f(o);
      };
      var bind = function (f) {
        return f(o);
      };
      var fold = function (_, onValue) {
        return onValue(o);
      };
      var exists = function (f) {
        return f(o);
      };
      var forall = function (f) {
        return f(o);
      };
      var toOptional = function () {
        return Optional.some(o);
      };
      return {
        is: is,
        isValue: always,
        isError: never,
        getOr: constant(o),
        getOrThunk: constant(o),
        getOrDie: constant(o),
        or: or,
        orThunk: orThunk,
        fold: fold,
        map: map,
        mapError: mapError,
        each: each,
        bind: bind,
        exists: exists,
        forall: forall,
        toOptional: toOptional
      };
    };
    var error = function (message) {
      var getOrThunk = function (f) {
        return f();
      };
      var getOrDie = function () {
        return die(String(message))();
      };
      var or = function (opt) {
        return opt;
      };
      var orThunk = function (f) {
        return f();
      };
      var map = function (_f) {
        return error(message);
      };
      var mapError = function (f) {
        return error(f(message));
      };
      var bind = function (_f) {
        return error(message);
      };
      var fold = function (onError, _) {
        return onError(message);
      };
      return {
        is: never,
        isValue: never,
        isError: always,
        getOr: identity,
        getOrThunk: getOrThunk,
        getOrDie: getOrDie,
        or: or,
        orThunk: orThunk,
        fold: fold,
        map: map,
        mapError: mapError,
        each: noop,
        bind: bind,
        exists: never,
        forall: always,
        toOptional: Optional.none
      };
    };
    var fromOption = function (opt, err) {
      return opt.fold(function () {
        return error(err);
      }, value);
    };
    var Result = {
      value: value,
      error: error,
      fromOption: fromOption
    };

    var measure = function (startAddress, gridA, gridB) {
      if (startAddress.row >= gridA.length || startAddress.column > cellLength(gridA[0])) {
        return Result.error('invalid start address out of table bounds, row: ' + startAddress.row + ', column: ' + startAddress.column);
      }
      var rowRemainder = gridA.slice(startAddress.row);
      var colRemainder = rowRemainder[0].cells.slice(startAddress.column);
      var colRequired = cellLength(gridB[0]);
      var rowRequired = gridB.length;
      return Result.value({
        rowDelta: rowRemainder.length - rowRequired,
        colDelta: colRemainder.length - colRequired
      });
    };
    var measureWidth = function (gridA, gridB) {
      var colLengthA = cellLength(gridA[0]);
      var colLengthB = cellLength(gridB[0]);
      return {
        rowDelta: 0,
        colDelta: colLengthA - colLengthB
      };
    };
    var measureHeight = function (gridA, gridB) {
      var rowLengthA = gridA.length;
      var rowLengthB = gridB.length;
      return {
        rowDelta: rowLengthA - rowLengthB,
        colDelta: 0
      };
    };
    var generateElements = function (amount, row, generators, isLocked) {
      var generator = row.section === 'colgroup' ? generators.col : generators.cell;
      return range(amount, function (idx) {
        return elementnew(generator(), true, isLocked(idx));
      });
    };
    var rowFill = function (grid, amount, generators, lockedColumns) {
      return grid.concat(range(amount, function () {
        var row = grid[grid.length - 1];
        var elements = generateElements(row.cells.length, row, generators, function (idx) {
          return has(lockedColumns, idx.toString());
        });
        return setCells(row, elements);
      }));
    };
    var colFill = function (grid, amount, generators, startIndex) {
      return map(grid, function (row) {
        var newChildren = generateElements(amount, row, generators, never);
        return addCells(row, startIndex, newChildren);
      });
    };
    var lockedColFill = function (grid, generators, lockedColumns) {
      return map(grid, function (row) {
        return foldl(lockedColumns, function (acc, colNum) {
          var newChild = generateElements(1, row, generators, always)[0];
          return addCell(acc, colNum, newChild);
        }, row);
      });
    };
    var tailor = function (gridA, delta, generators) {
      var fillCols = delta.colDelta < 0 ? colFill : identity;
      var fillRows = delta.rowDelta < 0 ? rowFill : identity;
      var lockedColumns = getLockedColumnsFromGrid(gridA);
      var gridWidth = cellLength(gridA[0]);
      var isLastColLocked = exists(lockedColumns, function (locked) {
        return locked === gridWidth - 1;
      });
      var modifiedCols = fillCols(gridA, Math.abs(delta.colDelta), generators, isLastColLocked ? gridWidth - 1 : gridWidth);
      var newLockedColumns = getLockedColumnsFromGrid(modifiedCols);
      return fillRows(modifiedCols, Math.abs(delta.rowDelta), generators, mapToObject(newLockedColumns, always));
    };

    var isSpanning = function (grid, row, col, comparator) {
      var candidate = getCell(grid[row], col);
      var matching = curry(comparator, candidate.element);
      var currentRow = grid[row];
      return grid.length > 1 && cellLength(currentRow) > 1 && (col > 0 && matching(getCellElement(currentRow, col - 1)) || col < currentRow.cells.length - 1 && matching(getCellElement(currentRow, col + 1)) || row > 0 && matching(getCellElement(grid[row - 1], col)) || row < grid.length - 1 && matching(getCellElement(grid[row + 1], col)));
    };
    var mergeTables = function (startAddress, gridA, gridB, generator, comparator, lockedColumns) {
      var startRow = startAddress.row;
      var startCol = startAddress.column;
      var mergeHeight = gridB.length;
      var mergeWidth = cellLength(gridB[0]);
      var endRow = startRow + mergeHeight;
      var endCol = startCol + mergeWidth + lockedColumns.length;
      var lockedColumnObj = mapToObject(lockedColumns, always);
      for (var r = startRow; r < endRow; r++) {
        var skippedCol = 0;
        for (var c = startCol; c < endCol; c++) {
          if (lockedColumnObj[c]) {
            skippedCol++;
            continue;
          }
          if (isSpanning(gridA, r, c, comparator)) {
            unmerge(gridA, getCellElement(gridA[r], c), comparator, generator.cell);
          }
          var gridBColIndex = c - startCol - skippedCol;
          var newCell = getCell(gridB[r - startRow], gridBColIndex);
          var newCellElm = newCell.element;
          var replacement = generator.replace(newCellElm);
          mutateCell(gridA[r], c, elementnew(replacement, true, newCell.isLocked));
        }
      }
      return gridA;
    };
    var getValidStartAddress = function (currentStartAddress, grid, lockedColumns) {
      var gridColLength = cellLength(grid[0]);
      var possibleColAddresses = range(gridColLength - currentStartAddress.column, function (num) {
        return num + currentStartAddress.column;
      });
      var validColAddress = find(possibleColAddresses, function (num) {
        return forall(lockedColumns, function (col) {
          return col !== num;
        });
      }).getOr(gridColLength - 1);
      return __assign(__assign({}, currentStartAddress), { column: validColAddress });
    };
    var getLockedColumnsWithinBounds = function (startAddress, grid, lockedColumns) {
      return filter(lockedColumns, function (colNum) {
        return colNum >= startAddress.column && colNum <= cellLength(grid[0]) + startAddress.column;
      });
    };
    var merge$1 = function (startAddress, gridA, gridB, generator, comparator) {
      var lockedColumns = getLockedColumnsFromGrid(gridA);
      var validStartAddress = getValidStartAddress(startAddress, gridA, lockedColumns);
      var lockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridB, lockedColumns);
      var result = measure(validStartAddress, gridA, gridB);
      return result.map(function (diff) {
        var delta = __assign(__assign({}, diff), { colDelta: diff.colDelta - lockedColumnsWithinBounds.length });
        var fittedGrid = tailor(gridA, delta, generator);
        var newLockedColumns = getLockedColumnsFromGrid(fittedGrid);
        var newLockedColumnsWithinBounds = getLockedColumnsWithinBounds(validStartAddress, gridB, newLockedColumns);
        return mergeTables(validStartAddress, fittedGrid, gridB, generator, comparator, newLockedColumnsWithinBounds);
      });
    };
    var insertCols = function (index, gridA, gridB, generator, comparator) {
      splitCols(gridA, index, comparator, generator.cell);
      var delta = measureHeight(gridB, gridA);
      var fittedNewGrid = tailor(gridB, delta, generator);
      var secondDelta = measureHeight(gridA, fittedNewGrid);
      var fittedOldGrid = tailor(gridA, secondDelta, generator);
      return map(fittedOldGrid, function (gridRow, i) {
        return addCells(gridRow, index, fittedNewGrid[i].cells);
      });
    };
    var insertRows = function (index, gridA, gridB, generator, comparator) {
      splitRows(gridA, index, comparator, generator.cell);
      var locked = getLockedColumnsFromGrid(gridA);
      var diff = measureWidth(gridA, gridB);
      var delta = __assign(__assign({}, diff), { colDelta: diff.colDelta - locked.length });
      var fittedOldGrid = tailor(gridA, delta, generator);
      var _a = extractGridDetails(fittedOldGrid), oldCols = _a.cols, oldRows = _a.rows;
      var newLocked = getLockedColumnsFromGrid(fittedOldGrid);
      var secondDiff = measureWidth(gridB, gridA);
      var secondDelta = __assign(__assign({}, secondDiff), { colDelta: secondDiff.colDelta + newLocked.length });
      var fittedGridB = lockedColFill(gridB, generator, newLocked);
      var fittedNewGrid = tailor(fittedGridB, secondDelta, generator);
      return oldCols.concat(oldRows.slice(0, index)).concat(fittedNewGrid).concat(oldRows.slice(index, oldRows.length));
    };

    var insertRowAt = function (grid, index, example, comparator, substitution) {
      var _a = extractGridDetails(grid), rows = _a.rows, cols = _a.cols;
      var before = rows.slice(0, index);
      var after = rows.slice(index);
      var between = mapCells(rows[example], function (ex, c) {
        var withinSpan = index > 0 && index < rows.length && comparator(getCellElement(rows[index - 1], c), getCellElement(rows[index], c));
        var ret = withinSpan ? getCell(rows[index], c) : elementnew(substitution(ex.element, comparator), true, ex.isLocked);
        return ret;
      });
      return cols.concat(before).concat([between]).concat(after);
    };
    var getElementFor = function (row, column, section, withinSpan, example, comparator, substitution) {
      if (section === 'colgroup' || !withinSpan) {
        var cell = getCell(row, example);
        return elementnew(substitution(cell.element, comparator), true, false);
      } else {
        return getCell(row, column);
      }
    };
    var insertColumnAt = function (grid, index, example, comparator, substitution) {
      return map(grid, function (row) {
        var withinSpan = index > 0 && index < cellLength(row) && comparator(getCellElement(row, index - 1), getCellElement(row, index));
        var sub = getElementFor(row, index, row.section, withinSpan, example, comparator, substitution);
        return addCell(row, index, sub);
      });
    };
    var deleteColumnsAt = function (grid, columns) {
      return bind(grid, function (row) {
        var existingCells = row.cells;
        var cells = foldr(columns, function (acc, column) {
          return column >= 0 && column < acc.length ? acc.slice(0, column).concat(acc.slice(column + 1)) : acc;
        }, existingCells);
        return cells.length > 0 ? [rowcells(cells, row.section)] : [];
      });
    };
    var deleteRowsAt = function (grid, start, finish) {
      var _a = extractGridDetails(grid), rows = _a.rows, cols = _a.cols;
      return cols.concat(rows.slice(0, start)).concat(rows.slice(finish + 1));
    };

    var replaceIn = function (grid, targets, comparator, substitution) {
      var isTarget = function (cell) {
        return exists(targets, function (target) {
          return comparator(cell.element, target.element);
        });
      };
      return map(grid, function (row) {
        return mapCells(row, function (cell) {
          return isTarget(cell) ? elementnew(substitution(cell.element, comparator), true, cell.isLocked) : cell;
        });
      });
    };
    var notStartRow = function (grid, rowIndex, colIndex, comparator) {
      return getCellElement(grid[rowIndex], colIndex) !== undefined && (rowIndex > 0 && comparator(getCellElement(grid[rowIndex - 1], colIndex), getCellElement(grid[rowIndex], colIndex)));
    };
    var notStartColumn = function (row, index, comparator) {
      return index > 0 && comparator(getCellElement(row, index - 1), getCellElement(row, index));
    };
    var replaceColumn = function (grid, index, comparator, substitution) {
      var rows = extractGridDetails(grid).rows;
      var targets = bind(rows, function (row, i) {
        var alreadyAdded = notStartRow(grid, i, index, comparator) || notStartColumn(row, index, comparator);
        return alreadyAdded ? [] : [getCell(row, index)];
      });
      return replaceIn(grid, targets, comparator, substitution);
    };
    var replaceRow = function (grid, index, comparator, substitution) {
      var rows = extractGridDetails(grid).rows;
      var targetRow = rows[index];
      var targets = bind(targetRow.cells, function (item, i) {
        var alreadyAdded = notStartRow(rows, index, i, comparator) || notStartColumn(targetRow, i, comparator);
        return alreadyAdded ? [] : [item];
      });
      return replaceIn(grid, targets, comparator, substitution);
    };

    var uniqueColumns = function (details) {
      var uniqueCheck = function (rest, detail) {
        var columnExists = exists(rest, function (currentDetail) {
          return currentDetail.column === detail.column;
        });
        return columnExists ? rest : rest.concat([detail]);
      };
      return foldl(details, uniqueCheck, []).sort(function (detailA, detailB) {
        return detailA.column - detailB.column;
      });
    };

    var elementToData = function (element) {
      var colspan = getAttrValue(element, 'colspan', 1);
      var rowspan = getAttrValue(element, 'rowspan', 1);
      return {
        element: element,
        colspan: colspan,
        rowspan: rowspan
      };
    };
    var modification = function (generators, toData) {
      if (toData === void 0) {
        toData = elementToData;
      }
      var position = Cell(Optional.none());
      var nu = function (data) {
        switch (name(data.element)) {
        case 'col':
          return generators.col(data);
        default:
          return generators.cell(data);
        }
      };
      var nuFrom = function (element) {
        var data = toData(element);
        return nu(data);
      };
      var add = function (element) {
        var replacement = nuFrom(element);
        if (position.get().isNone()) {
          position.set(Optional.some(replacement));
        }
        recent = Optional.some({
          item: element,
          replacement: replacement
        });
        return replacement;
      };
      var recent = Optional.none();
      var getOrInit = function (element, comparator) {
        return recent.fold(function () {
          return add(element);
        }, function (p) {
          return comparator(element, p.item) ? p.replacement : add(element);
        });
      };
      return {
        getOrInit: getOrInit,
        cursor: position.get
      };
    };
    var transform$1 = function (scope, tag) {
      return function (generators) {
        var position = Cell(Optional.none());
        var list = [];
        var find$1 = function (element, comparator) {
          return find(list, function (x) {
            return comparator(x.item, element);
          });
        };
        var makeNew = function (element) {
          var attrs = { scope: scope };
          var cell = generators.replace(element, tag, attrs);
          list.push({
            item: element,
            sub: cell
          });
          if (position.get().isNone()) {
            position.set(Optional.some(cell));
          }
          return cell;
        };
        var replaceOrInit = function (element, comparator) {
          if (name(element) === 'col') {
            return element;
          } else {
            return find$1(element, comparator).fold(function () {
              return makeNew(element);
            }, function (p) {
              return comparator(element, p.item) ? p.sub : makeNew(element);
            });
          }
        };
        return {
          replaceOrInit: replaceOrInit,
          cursor: position.get
        };
      };
    };
    var getScopeAttribute = function (cell) {
      return getOpt(cell, 'scope').map(function (attribute) {
        return attribute.substr(0, 3);
      });
    };
    var merging = function (generators) {
      var position = Cell(Optional.none());
      var unmerge = function (cell) {
        if (position.get().isNone()) {
          position.set(Optional.some(cell));
        }
        var scope = getScopeAttribute(cell);
        scope.each(function (attribute) {
          return set(cell, 'scope', attribute);
        });
        return function () {
          var raw = generators.cell({
            element: cell,
            colspan: 1,
            rowspan: 1
          });
          remove$1(raw, 'width');
          remove$1(cell, 'width');
          scope.each(function (attribute) {
            return set(raw, 'scope', attribute);
          });
          return raw;
        };
      };
      var merge = function (cells) {
        var getScopeProperty = function () {
          var stringAttributes = cat(map(cells, getScopeAttribute));
          if (stringAttributes.length === 0) {
            return Optional.none();
          } else {
            var baseScope_1 = stringAttributes[0];
            var scopes_1 = [
              'row',
              'col'
            ];
            var isMixed = exists(stringAttributes, function (attribute) {
              return attribute !== baseScope_1 && contains(scopes_1, attribute);
            });
            return isMixed ? Optional.none() : Optional.from(baseScope_1);
          }
        };
        remove$1(cells[0], 'width');
        getScopeProperty().fold(function () {
          return remove(cells[0], 'scope');
        }, function (attribute) {
          return set(cells[0], 'scope', attribute + 'group');
        });
        return constant(cells[0]);
      };
      return {
        unmerge: unmerge,
        merge: merge,
        cursor: position.get
      };
    };
    var Generators = {
      modification: modification,
      transform: transform$1,
      merging: merging
    };

    var blockList = [
      'body',
      'p',
      'div',
      'article',
      'aside',
      'figcaption',
      'figure',
      'footer',
      'header',
      'nav',
      'section',
      'ol',
      'ul',
      'table',
      'thead',
      'tfoot',
      'tbody',
      'caption',
      'tr',
      'td',
      'th',
      'h1',
      'h2',
      'h3',
      'h4',
      'h5',
      'h6',
      'blockquote',
      'pre',
      'address'
    ];
    var isList = function (universe, item) {
      var tagName = universe.property().name(item);
      return contains([
        'ol',
        'ul'
      ], tagName);
    };
    var isBlock = function (universe, item) {
      var tagName = universe.property().name(item);
      return contains(blockList, tagName);
    };
    var isEmptyTag = function (universe, item) {
      return contains([
        'br',
        'img',
        'hr',
        'input'
      ], universe.property().name(item));
    };

    var universe$2 = DomUniverse();
    var isBlock$1 = function (element) {
      return isBlock(universe$2, element);
    };
    var isList$1 = function (element) {
      return isList(universe$2, element);
    };
    var isEmptyTag$1 = function (element) {
      return isEmptyTag(universe$2, element);
    };

    var merge$2 = function (cells) {
      var isBr = function (el) {
        return name(el) === 'br';
      };
      var advancedBr = function (children) {
        return forall(children, function (c) {
          return isBr(c) || isText(c) && get$4(c).trim().length === 0;
        });
      };
      var isListItem = function (el) {
        return name(el) === 'li' || ancestor(el, isList$1).isSome();
      };
      var siblingIsBlock = function (el) {
        return nextSibling(el).map(function (rightSibling) {
          if (isBlock$1(rightSibling)) {
            return true;
          }
          if (isEmptyTag$1(rightSibling)) {
            return name(rightSibling) === 'img' ? false : true;
          }
          return false;
        }).getOr(false);
      };
      var markCell = function (cell) {
        return last$1(cell).bind(function (rightEdge) {
          var rightSiblingIsBlock = siblingIsBlock(rightEdge);
          return parent(rightEdge).map(function (parent) {
            return rightSiblingIsBlock === true || isListItem(parent) || isBr(rightEdge) || isBlock$1(parent) && !eq$1(cell, parent) ? [] : [SugarElement.fromTag('br')];
          });
        }).getOr([]);
      };
      var markContent = function () {
        var content = bind(cells, function (cell) {
          var children$1 = children(cell);
          return advancedBr(children$1) ? [] : children$1.concat(markCell(cell));
        });
        return content.length === 0 ? [SugarElement.fromTag('br')] : content;
      };
      var contents = markContent();
      empty(cells[0]);
      append$1(cells[0], contents);
    };

    var prune = function (table) {
      var cells$1 = cells(table);
      if (cells$1.length === 0) {
        remove$2(table);
      }
    };
    var outcome = function (grid, cursor) {
      return {
        grid: grid,
        cursor: cursor
      };
    };
    var elementFromGrid = function (grid, row, column) {
      var rows = extractGridDetails(grid).rows;
      return findIn(rows, row, column).orThunk(function () {
        return findIn(rows, 0, 0);
      });
    };
    var findIn = function (grid, row, column) {
      return Optional.from(grid[row]).bind(function (r) {
        return Optional.from(r.cells[column]).bind(function (c) {
          return Optional.from(c.element);
        });
      });
    };
    var bundle = function (grid, row, column) {
      var rows = extractGridDetails(grid).rows;
      return outcome(grid, findIn(rows, row, column));
    };
    var uniqueRows = function (details) {
      var rowCompilation = function (rest, detail) {
        var rowExists = exists(rest, function (currentDetail) {
          return currentDetail.row === detail.row;
        });
        return rowExists ? rest : rest.concat([detail]);
      };
      return foldl(details, rowCompilation, []).sort(function (detailA, detailB) {
        return detailA.row - detailB.row;
      });
    };
    var opInsertRowsBefore = function (grid, details, comparator, genWrappers) {
      var targetIndex = details[0].row;
      var rows = uniqueRows(details);
      var newGrid = foldr(rows, function (acc, row) {
        var newG = insertRowAt(acc.grid, targetIndex, row.row + acc.delta, comparator, genWrappers.getOrInit);
        return {
          grid: newG,
          delta: acc.delta + 1
        };
      }, {
        grid: grid,
        delta: 0
      }).grid;
      return bundle(newGrid, targetIndex, details[0].column);
    };
    var opInsertRowsAfter = function (grid, details, comparator, genWrappers) {
      var rows = uniqueRows(details);
      var target = rows[rows.length - 1];
      var targetIndex = target.row + target.rowspan;
      var newGrid = foldr(rows, function (newG, row) {
        return insertRowAt(newG, targetIndex, row.row, comparator, genWrappers.getOrInit);
      }, grid);
      return bundle(newGrid, targetIndex, details[0].column);
    };
    var opInsertColumnsBefore = function (grid, extractDetail, comparator, genWrappers) {
      var details = extractDetail.details;
      var columns = uniqueColumns(details);
      var targetIndex = columns[0].column;
      var newGrid = foldr(columns, function (acc, col) {
        var newG = insertColumnAt(acc.grid, targetIndex, col.column + acc.delta, comparator, genWrappers.getOrInit);
        return {
          grid: newG,
          delta: acc.delta + 1
        };
      }, {
        grid: grid,
        delta: 0
      }).grid;
      return bundle(newGrid, details[0].row, targetIndex);
    };
    var opInsertColumnsAfter = function (grid, extractDetail, comparator, genWrappers) {
      var details = extractDetail.details;
      var target = details[details.length - 1];
      var targetIndex = target.column + target.colspan;
      var columns = uniqueColumns(details);
      var newGrid = foldr(columns, function (newG, col) {
        return insertColumnAt(newG, targetIndex, col.column, comparator, genWrappers.getOrInit);
      }, grid);
      return bundle(newGrid, details[0].row, targetIndex);
    };
    var opMakeRowHeader = function (grid, detail, comparator, genWrappers) {
      var newGrid = replaceRow(grid, detail.row, comparator, genWrappers.replaceOrInit);
      return bundle(newGrid, detail.row, detail.column);
    };
    var opMakeRowsHeader = function (initialGrid, details, comparator, genWrappers) {
      var rows = uniqueRows(details);
      var replacer = function (currentGrid, row) {
        return replaceRow(currentGrid, row.row, comparator, genWrappers.replaceOrInit);
      };
      var newGrid = foldl(rows, replacer, initialGrid);
      return bundle(newGrid, details[0].row, details[0].column);
    };
    var opMakeColumnHeader = function (initialGrid, detail, comparator, genWrappers) {
      var newGrid = replaceColumn(initialGrid, detail.column, comparator, genWrappers.replaceOrInit);
      return bundle(newGrid, detail.row, detail.column);
    };
    var opMakeColumnsHeader = function (initialGrid, details, comparator, genWrappers) {
      var columns = uniqueColumns(details);
      var replacer = function (currentGrid, column) {
        return replaceColumn(currentGrid, column.column, comparator, genWrappers.replaceOrInit);
      };
      var newGrid = foldl(columns, replacer, initialGrid);
      return bundle(newGrid, details[0].row, details[0].column);
    };
    var opUnmakeRowHeader = function (grid, detail, comparator, genWrappers) {
      var newGrid = replaceRow(grid, detail.row, comparator, genWrappers.replaceOrInit);
      return bundle(newGrid, detail.row, detail.column);
    };
    var opUnmakeRowsHeader = function (initialGrid, details, comparator, genWrappers) {
      var rows = uniqueRows(details);
      var replacer = function (currentGrid, row) {
        return replaceRow(currentGrid, row.row, comparator, genWrappers.replaceOrInit);
      };
      var newGrid = foldl(rows, replacer, initialGrid);
      return bundle(newGrid, details[0].row, details[0].column);
    };
    var opUnmakeColumnHeader = function (initialGrid, detail, comparator, genWrappers) {
      var newGrid = replaceColumn(initialGrid, detail.column, comparator, genWrappers.replaceOrInit);
      return bundle(newGrid, detail.row, detail.column);
    };
    var opUnmakeColumnsHeader = function (initialGrid, details, comparator, genWrappers) {
      var columns = uniqueColumns(details);
      var replacer = function (currentGrid, column) {
        return replaceColumn(currentGrid, column.column, comparator, genWrappers.replaceOrInit);
      };
      var newGrid = foldl(columns, replacer, initialGrid);
      return bundle(newGrid, details[0].row, details[0].column);
    };
    var opEraseColumns = function (grid, extractDetail, _comparator, _genWrappers) {
      var columns = uniqueColumns(extractDetail.details);
      var newGrid = deleteColumnsAt(grid, map(columns, function (column) {
        return column.column;
      }));
      var cursor = elementFromGrid(newGrid, columns[0].row, columns[0].column);
      return outcome(newGrid, cursor);
    };
    var opEraseRows = function (grid, details, _comparator, _genWrappers) {
      var rows = uniqueRows(details);
      var newGrid = deleteRowsAt(grid, rows[0].row, rows[rows.length - 1].row);
      var cursor = elementFromGrid(newGrid, details[0].row, details[0].column);
      return outcome(newGrid, cursor);
    };
    var opMergeCells = function (grid, mergable, comparator, genWrappers) {
      var cells = mergable.cells;
      merge$2(cells);
      var newGrid = merge(grid, mergable.bounds, comparator, genWrappers.merge(cells));
      return outcome(newGrid, Optional.from(cells[0]));
    };
    var opUnmergeCells = function (grid, unmergable, comparator, genWrappers) {
      var unmerge$1 = function (b, cell) {
        return unmerge(b, cell, comparator, genWrappers.unmerge(cell));
      };
      var newGrid = foldr(unmergable, unmerge$1, grid);
      return outcome(newGrid, Optional.from(unmergable[0]));
    };
    var opPasteCells = function (grid, pasteDetails, comparator, _genWrappers) {
      var gridify = function (table, generators) {
        var wh = Warehouse.fromTable(table);
        return toGrid(wh, generators, true);
      };
      var gridB = gridify(pasteDetails.clipboard, pasteDetails.generators);
      var startAddress = address(pasteDetails.row, pasteDetails.column);
      var mergedGrid = merge$1(startAddress, grid, gridB, pasteDetails.generators, comparator);
      return mergedGrid.fold(function () {
        return outcome(grid, Optional.some(pasteDetails.element));
      }, function (newGrid) {
        var cursor = elementFromGrid(newGrid, pasteDetails.row, pasteDetails.column);
        return outcome(newGrid, cursor);
      });
    };
    var gridifyRows = function (rows, generators, context) {
      var pasteDetails = fromPastedRows(rows, context.section);
      var wh = Warehouse.generate(pasteDetails);
      return toGrid(wh, generators, true);
    };
    var opPasteColsBefore = function (grid, pasteDetails, comparator, _genWrappers) {
      var rows = extractGridDetails(grid).rows;
      var index = pasteDetails.cells[0].column;
      var context = rows[pasteDetails.cells[0].row];
      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);
      var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);
      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);
      return outcome(mergedGrid, cursor);
    };
    var opPasteColsAfter = function (grid, pasteDetails, comparator, _genWrappers) {
      var rows = extractGridDetails(grid).rows;
      var index = pasteDetails.cells[pasteDetails.cells.length - 1].column + pasteDetails.cells[pasteDetails.cells.length - 1].colspan;
      var context = rows[pasteDetails.cells[0].row];
      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);
      var mergedGrid = insertCols(index, grid, gridB, pasteDetails.generators, comparator);
      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);
      return outcome(mergedGrid, cursor);
    };
    var opPasteRowsBefore = function (grid, pasteDetails, comparator, _genWrappers) {
      var rows = extractGridDetails(grid).rows;
      var index = pasteDetails.cells[0].row;
      var context = rows[index];
      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);
      var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);
      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);
      return outcome(mergedGrid, cursor);
    };
    var opPasteRowsAfter = function (grid, pasteDetails, comparator, _genWrappers) {
      var rows = extractGridDetails(grid).rows;
      var index = pasteDetails.cells[pasteDetails.cells.length - 1].row + pasteDetails.cells[pasteDetails.cells.length - 1].rowspan;
      var context = rows[pasteDetails.cells[0].row];
      var gridB = gridifyRows(pasteDetails.clipboard, pasteDetails.generators, context);
      var mergedGrid = insertRows(index, grid, gridB, pasteDetails.generators, comparator);
      var cursor = elementFromGrid(mergedGrid, pasteDetails.cells[0].row, pasteDetails.cells[0].column);
      return outcome(mergedGrid, cursor);
    };
    var opGetColumnType = function (table, target) {
      var house = Warehouse.fromTable(table);
      var details = onCells(house, target);
      return details.bind(function (selectedCells) {
        var lastSelectedCell = selectedCells[selectedCells.length - 1];
        var minColRange = selectedCells[0].column;
        var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;
        var selectedColumnCells = flatten(map(house.all, function (row) {
          return filter(row.cells, function (cell) {
            return cell.column >= minColRange && cell.column < maxColRange;
          });
        }));
        return getCellsType(selectedColumnCells, function (cell) {
          return name(cell.element) === 'th';
        });
      }).getOr('');
    };
    var getCellsType = function (cells, headerPred) {
      var headerCells = filter(cells, headerPred);
      if (headerCells.length === 0) {
        return Optional.some('td');
      } else if (headerCells.length === cells.length) {
        return Optional.some('th');
      } else {
        return Optional.none();
      }
    };
    var resize = adjustWidthTo;
    var adjustAndRedistributeWidths$1 = adjustAndRedistributeWidths;
    var firstColumnIsLocked = function (_warehouse, details) {
      return exists(details, function (detail) {
        return detail.column === 0 && detail.isLocked;
      });
    };
    var lastColumnIsLocked = function (warehouse, details) {
      return exists(details, function (detail) {
        return detail.column + detail.colspan >= warehouse.grid.columns && detail.isLocked;
      });
    };
    var getColumnsWidth = function (warehouse, details) {
      var columns = columns$1(warehouse);
      var uniqueCols = uniqueColumns(details);
      return foldl(uniqueCols, function (acc, detail) {
        var column = columns[detail.column];
        var colWidth = column.map(getOuter).getOr(0);
        return acc + colWidth;
      }, 0);
    };
    var insertColumnsExtractor = function (before) {
      return function (warehouse, target) {
        return onCells(warehouse, target).filter(function (details) {
          var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;
          return !checkLocked(warehouse, details);
        }).map(function (details) {
          return {
            details: details,
            pixelDelta: getColumnsWidth(warehouse, details)
          };
        });
      };
    };
    var eraseColumnsExtractor = function (warehouse, target) {
      return onUnlockedCells(warehouse, target).map(function (details) {
        return {
          details: details,
          pixelDelta: -getColumnsWidth(warehouse, details)
        };
      });
    };
    var pasteColumnsExtractor = function (before) {
      return function (warehouse, target) {
        return onPasteByEditor(warehouse, target).filter(function (details) {
          var checkLocked = before ? firstColumnIsLocked : lastColumnIsLocked;
          return !checkLocked(warehouse, details.cells);
        });
      };
    };
    var insertRowsBefore = run(opInsertRowsBefore, onCells, noop, noop, Generators.modification);
    var insertRowsAfter = run(opInsertRowsAfter, onCells, noop, noop, Generators.modification);
    var insertColumnsBefore = run(opInsertColumnsBefore, insertColumnsExtractor(true), adjustAndRedistributeWidths$1, noop, Generators.modification);
    var insertColumnsAfter = run(opInsertColumnsAfter, insertColumnsExtractor(false), adjustAndRedistributeWidths$1, noop, Generators.modification);
    var eraseColumns = run(opEraseColumns, eraseColumnsExtractor, adjustAndRedistributeWidths$1, prune, Generators.modification);
    var eraseRows = run(opEraseRows, onCells, noop, prune, Generators.modification);
    var makeColumnHeader = run(opMakeColumnHeader, onUnlockedCell, noop, noop, Generators.transform('row', 'th'));
    var makeColumnsHeader = run(opMakeColumnsHeader, onUnlockedCells, noop, noop, Generators.transform('row', 'th'));
    var unmakeColumnHeader = run(opUnmakeColumnHeader, onUnlockedCell, noop, noop, Generators.transform(null, 'td'));
    var unmakeColumnsHeader = run(opUnmakeColumnsHeader, onUnlockedCells, noop, noop, Generators.transform(null, 'td'));
    var makeRowHeader = run(opMakeRowHeader, onCell, noop, noop, Generators.transform('col', 'th'));
    var makeRowsHeader = run(opMakeRowsHeader, onCells, noop, noop, Generators.transform('col', 'th'));
    var unmakeRowHeader = run(opUnmakeRowHeader, onCell, noop, noop, Generators.transform(null, 'td'));
    var unmakeRowsHeader = run(opUnmakeRowsHeader, onCells, noop, noop, Generators.transform(null, 'td'));
    var mergeCells = run(opMergeCells, onUnlockedMergable, resize, noop, Generators.merging);
    var unmergeCells = run(opUnmergeCells, onUnlockedUnmergable, resize, noop, Generators.merging);
    var pasteCells = run(opPasteCells, onPaste, resize, noop, Generators.modification);
    var pasteColsBefore = run(opPasteColsBefore, pasteColumnsExtractor(true), noop, noop, Generators.modification);
    var pasteColsAfter = run(opPasteColsAfter, pasteColumnsExtractor(false), noop, noop, Generators.modification);
    var pasteRowsBefore = run(opPasteRowsBefore, onPasteByEditor, noop, noop, Generators.modification);
    var pasteRowsAfter = run(opPasteRowsAfter, onPasteByEditor, noop, noop, Generators.modification);
    var getColumnType = opGetColumnType;

    var getSection = function (elm) {
      return getNodeName(elm.parentNode);
    };
    var mapSectionNameToType = function (section) {
      if (section === 'thead') {
        return 'header';
      } else if (section === 'tfoot') {
        return 'footer';
      } else {
        return 'body';
      }
    };
    var detectHeaderRow = function (editor, elm) {
      var isThead = getSection(elm) === 'thead';
      var areAllCellsThs = !exists(elm.cells, function (c) {
        return getNodeName(c) !== 'th';
      });
      return isThead || areAllCellsThs ? Optional.some({
        thead: isThead,
        ths: areAllCellsThs
      }) : Optional.none();
    };
    var getRowType = function (editor, elm) {
      return mapSectionNameToType(detectHeaderRow(editor, elm).fold(function () {
        return getSection(elm);
      }, function (_rowConfig) {
        return 'thead';
      }));
    };
    var switchRowSection = function (dom, rowElm, newSectionName) {
      var tableElm = dom.getParent(rowElm, 'table');
      var oldSectionElm = rowElm.parentNode;
      var oldSectionName = getNodeName(oldSectionElm);
      if (newSectionName !== oldSectionName) {
        var sectionElm_1 = dom.select(newSectionName, tableElm)[0];
        if (!sectionElm_1) {
          sectionElm_1 = dom.create(newSectionName);
          var firstTableChild_1 = tableElm.firstChild;
          if (newSectionName === 'thead') {
            last(children$2(SugarElement.fromDom(tableElm), 'caption,colgroup')).fold(function () {
              return tableElm.insertBefore(sectionElm_1, firstTableChild_1);
            }, function (c) {
              return dom.insertAfter(sectionElm_1, c.dom);
            });
          } else {
            tableElm.appendChild(sectionElm_1);
          }
        }
        if (newSectionName === 'tbody' && oldSectionName === 'thead' && sectionElm_1.firstChild) {
          sectionElm_1.insertBefore(rowElm, sectionElm_1.firstChild);
        } else {
          sectionElm_1.appendChild(rowElm);
        }
        if (!oldSectionElm.hasChildNodes()) {
          dom.remove(oldSectionElm);
        }
      }
    };
    var renameCell = function (editor, cell, newCellType) {
      if (isNonNullable(newCellType) && getNodeName(cell) !== newCellType) {
        var newCellElm = editor.dom.rename(cell, newCellType);
        fireNewCell(editor, newCellElm);
        return newCellElm;
      } else {
        return cell;
      }
    };
    var switchCellType = function (editor, cell, newCellType, scope) {
      var dom = editor.dom;
      var newCell = renameCell(editor, cell, newCellType);
      if (!isUndefined(scope)) {
        dom.setAttrib(newCell, 'scope', scope);
      }
      return newCell;
    };
    var switchCellsType = function (editor, cells, newCellType, scope) {
      return each(cells, function (c) {
        return switchCellType(editor, c, newCellType, scope);
      });
    };
    var switchSectionType = function (editor, rowElm, newType) {
      var determineHeaderRowType = function () {
        var allTableRows = table(SugarElement.fromDom(rowElm.cells[0])).map(function (table) {
          return rows(table);
        }).getOr([]);
        return findMap(allTableRows, function (row) {
          return detectHeaderRow(editor, row.dom);
        }).map(function (detectedType) {
          if (detectedType.thead && detectedType.ths) {
            return 'sectionCells';
          } else {
            return detectedType.thead ? 'section' : 'cells';
          }
        }).getOr('section');
      };
      var dom = editor.dom;
      if (newType === 'header') {
        var headerRowTypeSetting = getTableHeaderType(editor);
        var headerRowType = headerRowTypeSetting === 'auto' ? determineHeaderRowType() : headerRowTypeSetting;
        switchCellsType(editor, rowElm.cells, headerRowType === 'section' ? 'td' : 'th', 'col');
        switchRowSection(dom, rowElm, headerRowType === 'cells' ? 'tbody' : 'thead');
      } else {
        switchCellsType(editor, rowElm.cells, 'td', null);
        switchRowSection(dom, rowElm, newType === 'footer' ? 'tfoot' : 'tbody');
      }
    };

    var getSelectionStartCellFallback = function (start) {
      return table(start).bind(function (table) {
        return retrieve$1(table, ephemera.firstSelectedSelector);
      }).fold(function () {
        return start;
      }, function (cells) {
        return cells[0];
      });
    };
    var getSelectionStartFromSelector = function (selector) {
      return function (start, isRoot) {
        var startCellName = name(start);
        var startCell = startCellName === 'col' || startCellName === 'colgroup' ? getSelectionStartCellFallback(start) : start;
        return closest$1(startCell, selector, isRoot);
      };
    };
    var getSelectionStartCell = getSelectionStartFromSelector('th,td');
    var getSelectionStartCellOrCaption = getSelectionStartFromSelector('th,td,caption');
    var getCellsFromSelection = function (start, selections, isRoot) {
      return getSelectionStartCell(start, isRoot).map(function (_cell) {
        return selection(selections);
      }).getOr([]);
    };
    var getRowsFromSelection = function (start, selector) {
      var cellOpt = getSelectionStartCell(start);
      var rowsOpt = cellOpt.bind(function (cell) {
        return table(cell);
      }).map(function (table) {
        return rows(table);
      });
      return lift2(cellOpt, rowsOpt, function (cell, rows) {
        return filter(rows, function (row) {
          return exists(fromDom$1(row.dom.cells), function (rowCell) {
            return get$2(rowCell, selector) === '1' || eq$1(rowCell, cell);
          });
        });
      }).getOr([]);
    };

    var TableActions = function (editor, lazyWire, selections) {
      var isTableBody = function (editor) {
        return name(getBody$1(editor)) === 'table';
      };
      var lastRowGuard = function (table) {
        return isTableBody(editor) === false || getGridSize(table).rows > 1;
      };
      var lastColumnGuard = function (table) {
        return isTableBody(editor) === false || getGridSize(table).columns > 1;
      };
      var cloneFormats = getCloneElements(editor);
      var colMutationOp = isResizeTableColumnResizing(editor) ? noop : halve;
      var execute = function (operation, guard, mutate, lazyWire, effect) {
        return function (table, target) {
          removeDataStyle(table);
          var wire = lazyWire();
          var doc = SugarElement.fromDom(editor.getDoc());
          var generators = cellOperations(mutate, doc, cloneFormats);
          var sizing = get$9(editor, table);
          var resizeBehaviour = isResizeTableColumnResizing(editor) ? resizeTable() : preserveTable();
          return guard(table) ? operation(wire, table, target, generators, sizing, resizeBehaviour).bind(function (result) {
            each(result.newRows, function (row) {
              fireNewRow(editor, row.dom);
            });
            each(result.newCells, function (cell) {
              fireNewCell(editor, cell.dom);
            });
            return result.cursor.map(function (cell) {
              var des = freefallRtl$2(cell);
              var rng = editor.dom.createRng();
              rng.setStart(des.element.dom, des.offset);
              rng.setEnd(des.element.dom, des.offset);
              return {
                rng: rng,
                effect: effect
              };
            });
          }) : Optional.none();
        };
      };
      var deleteRow = execute(eraseRows, lastRowGuard, noop, lazyWire, structureModified);
      var deleteColumn = execute(eraseColumns, lastColumnGuard, noop, lazyWire, structureModified);
      var insertRowsBefore$1 = execute(insertRowsBefore, always, noop, lazyWire, structureModified);
      var insertRowsAfter$1 = execute(insertRowsAfter, always, noop, lazyWire, structureModified);
      var insertColumnsBefore$1 = execute(insertColumnsBefore, always, colMutationOp, lazyWire, structureModified);
      var insertColumnsAfter$1 = execute(insertColumnsAfter, always, colMutationOp, lazyWire, structureModified);
      var mergeCells$1 = execute(mergeCells, always, noop, lazyWire, structureModified);
      var unmergeCells$1 = execute(unmergeCells, always, noop, lazyWire, structureModified);
      var pasteColsBefore$1 = execute(pasteColsBefore, always, noop, lazyWire, structureModified);
      var pasteColsAfter$1 = execute(pasteColsAfter, always, noop, lazyWire, structureModified);
      var pasteRowsBefore$1 = execute(pasteRowsBefore, always, noop, lazyWire, structureModified);
      var pasteRowsAfter$1 = execute(pasteRowsAfter, always, noop, lazyWire, structureModified);
      var pasteCells$1 = execute(pasteCells, always, noop, lazyWire, structureModified);
      var extractType = function (args, validTypes) {
        return get$1(args, 'type').filter(function (type) {
          return contains(validTypes, type);
        });
      };
      var setTableCellType = function (editor, args) {
        return extractType(args, [
          'td',
          'th'
        ]).each(function (type) {
          var cells = map(getCellsFromSelection(getSelectionStart(editor), selections), function (c) {
            return c.dom;
          });
          switchCellsType(editor, cells, type, null);
        });
      };
      var setTableRowType = function (editor, args) {
        return extractType(args, [
          'header',
          'body',
          'footer'
        ]).each(function (type) {
          map(getRowsFromSelection(getSelectionStart(editor), ephemera.selected), function (row) {
            return switchSectionType(editor, row.dom, type);
          });
        });
      };
      var makeColumnsHeader$1 = execute(makeColumnsHeader, always, noop, lazyWire, structureModified);
      var unmakeColumnsHeader$1 = execute(unmakeColumnsHeader, always, noop, lazyWire, structureModified);
      var getTableRowType = function (editor) {
        var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);
        if (rows.length > 0) {
          var rowTypes = map(rows, function (r) {
            return getRowType(editor, r.dom);
          });
          var hasHeader = contains(rowTypes, 'header');
          var hasFooter = contains(rowTypes, 'footer');
          if (!hasHeader && !hasFooter) {
            return 'body';
          } else {
            var hasBody = contains(rowTypes, 'body');
            if (hasHeader && !hasBody && !hasFooter) {
              return 'header';
            } else if (!hasHeader && !hasBody && hasFooter) {
              return 'footer';
            } else {
              return '';
            }
          }
        }
      };
      var getTableCellType = function (editor) {
        return getCellsType(getCellsFromSelection(getSelectionStart(editor), selections), function (cell) {
          return name(cell) === 'th';
        }).getOr('');
      };
      var getTableColType = getColumnType;
      return {
        deleteRow: deleteRow,
        deleteColumn: deleteColumn,
        insertRowsBefore: insertRowsBefore$1,
        insertRowsAfter: insertRowsAfter$1,
        insertColumnsBefore: insertColumnsBefore$1,
        insertColumnsAfter: insertColumnsAfter$1,
        mergeCells: mergeCells$1,
        unmergeCells: unmergeCells$1,
        pasteColsBefore: pasteColsBefore$1,
        pasteColsAfter: pasteColsAfter$1,
        pasteRowsBefore: pasteRowsBefore$1,
        pasteRowsAfter: pasteRowsAfter$1,
        pasteCells: pasteCells$1,
        setTableCellType: setTableCellType,
        setTableRowType: setTableRowType,
        makeColumnsHeader: makeColumnsHeader$1,
        unmakeColumnsHeader: unmakeColumnsHeader$1,
        getTableRowType: getTableRowType,
        getTableCellType: getTableCellType,
        getTableColType: getTableColType
      };
    };

    var DefaultRenderOptions = {
      styles: {
        'border-collapse': 'collapse',
        'width': '100%'
      },
      attributes: { border: '1' },
      colGroups: false
    };
    var tableHeaderCell = function () {
      return SugarElement.fromTag('th');
    };
    var tableCell = function () {
      return SugarElement.fromTag('td');
    };
    var tableColumn = function () {
      return SugarElement.fromTag('col');
    };
    var createRow = function (columns, rowHeaders, columnHeaders, rowIndex) {
      var tr = SugarElement.fromTag('tr');
      for (var j = 0; j < columns; j++) {
        var td = rowIndex < rowHeaders || j < columnHeaders ? tableHeaderCell() : tableCell();
        if (j < columnHeaders) {
          set(td, 'scope', 'row');
        }
        if (rowIndex < rowHeaders) {
          set(td, 'scope', 'col');
        }
        append(td, SugarElement.fromTag('br'));
        append(tr, td);
      }
      return tr;
    };
    var createGroupRow = function (columns) {
      var columnGroup = SugarElement.fromTag('colgroup');
      range(columns, function () {
        return append(columnGroup, tableColumn());
      });
      return columnGroup;
    };
    var createRows = function (rows, columns, rowHeaders, columnHeaders) {
      return range(rows, function (r) {
        return createRow(columns, rowHeaders, columnHeaders, r);
      });
    };
    var render$1 = function (rows, columns, rowHeaders, columnHeaders, headerType, renderOpts) {
      if (renderOpts === void 0) {
        renderOpts = DefaultRenderOptions;
      }
      var table = SugarElement.fromTag('table');
      var rowHeadersGoInThead = headerType !== 'cells';
      setAll$1(table, renderOpts.styles);
      setAll(table, renderOpts.attributes);
      if (renderOpts.colGroups) {
        append(table, createGroupRow(columns));
      }
      var actualRowHeaders = Math.min(rows, rowHeaders);
      if (rowHeadersGoInThead && rowHeaders > 0) {
        var thead = SugarElement.fromTag('thead');
        append(table, thead);
        var theadRowHeaders = headerType === 'sectionCells' ? actualRowHeaders : 0;
        var theadRows = createRows(rowHeaders, columns, theadRowHeaders, columnHeaders);
        append$1(thead, theadRows);
      }
      var tbody = SugarElement.fromTag('tbody');
      append(table, tbody);
      var numRows = rowHeadersGoInThead ? rows - actualRowHeaders : rows;
      var numRowHeaders = rowHeadersGoInThead ? 0 : rowHeaders;
      var tbodyRows = createRows(numRows, columns, numRowHeaders, columnHeaders);
      append$1(tbody, tbodyRows);
      return table;
    };

    var get$b = function (element) {
      return element.dom.innerHTML;
    };
    var getOuter$2 = function (element) {
      var container = SugarElement.fromTag('div');
      var clone = SugarElement.fromDom(element.dom.cloneNode(true));
      append(container, clone);
      return get$b(container);
    };

    var placeCaretInCell = function (editor, cell) {
      editor.selection.select(cell.dom, true);
      editor.selection.collapse(true);
    };
    var selectFirstCellInTable = function (editor, tableElm) {
      descendant$1(tableElm, 'td,th').each(curry(placeCaretInCell, editor));
    };
    var fireEvents = function (editor, table) {
      each(descendants$1(table, 'tr'), function (row) {
        fireNewRow(editor, row.dom);
        each(descendants$1(row, 'th,td'), function (cell) {
          fireNewCell(editor, cell.dom);
        });
      });
    };
    var isPercentage$1 = function (width) {
      return isString(width) && width.indexOf('%') !== -1;
    };
    var insert$1 = function (editor, columns, rows, colHeaders, rowHeaders) {
      var defaultStyles = getDefaultStyles(editor);
      var options = {
        styles: defaultStyles,
        attributes: getDefaultAttributes(editor),
        colGroups: useColumnGroup(editor)
      };
      editor.undoManager.ignore(function () {
        var table = render$1(rows, columns, rowHeaders, colHeaders, getTableHeaderType(editor), options);
        set(table, 'data-mce-id', '__mce');
        var html = getOuter$2(table);
        editor.insertContent(html);
        editor.addVisual();
      });
      return descendant$1(getBody$1(editor), 'table[data-mce-id="__mce"]').map(function (table) {
        if (isPixelsForced(editor)) {
          enforcePixels(editor, table);
        } else if (isResponsiveForced(editor)) {
          enforceNone(table);
        } else if (isPercentagesForced(editor) || isPercentage$1(defaultStyles.width)) {
          enforcePercentage(editor, table);
        }
        removeDataStyle(table);
        remove(table, 'data-mce-id');
        fireEvents(editor, table);
        selectFirstCellInTable(editor, table);
        return table.dom;
      }).getOr(null);
    };
    var insertTableWithDataValidation = function (editor, rows, columns, options, errorMsg) {
      if (options === void 0) {
        options = {};
      }
      var checkInput = function (val) {
        return isNumber(val) && val > 0;
      };
      if (checkInput(rows) && checkInput(columns)) {
        var headerRows = options.headerRows || 0;
        var headerColumns = options.headerColumns || 0;
        return insert$1(editor, columns, rows, headerColumns, headerRows);
      } else {
        console.error(errorMsg);
        return null;
      }
    };

    var getClipboardElements = function (getClipboard) {
      return function () {
        return getClipboard().fold(function () {
          return [];
        }, function (elems) {
          return map(elems, function (e) {
            return e.dom;
          });
        });
      };
    };
    var setClipboardElements = function (setClipboard) {
      return function (elems) {
        var elmsOpt = elems.length > 0 ? Optional.some(fromDom$1(elems)) : Optional.none();
        setClipboard(elmsOpt);
      };
    };
    var insertTable = function (editor) {
      return function (columns, rows, options) {
        if (options === void 0) {
          options = {};
        }
        var table = insertTableWithDataValidation(editor, rows, columns, options, 'Invalid values for insertTable - rows and columns values are required to insert a table.');
        editor.undoManager.add();
        return table;
      };
    };
    var getApi = function (editor, clipboard, resizeHandler, selectionTargets) {
      return {
        insertTable: insertTable(editor),
        setClipboardRows: setClipboardElements(clipboard.setRows),
        getClipboardRows: getClipboardElements(clipboard.getRows),
        setClipboardCols: setClipboardElements(clipboard.setColumns),
        getClipboardCols: getClipboardElements(clipboard.getColumns),
        resizeHandler: resizeHandler,
        selectionTargets: selectionTargets
      };
    };

    var constrainSpan = function (element, property, value) {
      var currentColspan = getAttrValue(element, property, 1);
      if (value === 1 || currentColspan <= 1) {
        remove(element, property);
      } else {
        set(element, property, Math.min(value, currentColspan));
      }
    };
    var generateColGroup = function (house, minColRange, maxColRange) {
      if (Warehouse.hasColumns(house)) {
        var colsToCopy = filter(Warehouse.justColumns(house), function (col) {
          return col.column >= minColRange && col.column < maxColRange;
        });
        var copiedCols = map(colsToCopy, function (c) {
          var clonedCol = deep(c.element);
          constrainSpan(clonedCol, 'span', maxColRange - minColRange);
          return clonedCol;
        });
        var fakeColgroup = SugarElement.fromTag('colgroup');
        append$1(fakeColgroup, copiedCols);
        return [fakeColgroup];
      } else {
        return [];
      }
    };
    var generateRows = function (house, minColRange, maxColRange) {
      return map(house.all, function (row) {
        var cellsToCopy = filter(row.cells, function (cell) {
          return cell.column >= minColRange && cell.column < maxColRange;
        });
        var copiedCells = map(cellsToCopy, function (cell) {
          var clonedCell = deep(cell.element);
          constrainSpan(clonedCell, 'colspan', maxColRange - minColRange);
          return clonedCell;
        });
        var fakeTR = SugarElement.fromTag('tr');
        append$1(fakeTR, copiedCells);
        return fakeTR;
      });
    };
    var copyCols = function (table, target) {
      var house = Warehouse.fromTable(table);
      var details = onUnlockedCells(house, target);
      return details.map(function (selectedCells) {
        var lastSelectedCell = selectedCells[selectedCells.length - 1];
        var minColRange = selectedCells[0].column;
        var maxColRange = lastSelectedCell.column + lastSelectedCell.colspan;
        var fakeColGroups = generateColGroup(house, minColRange, maxColRange);
        var fakeRows = generateRows(house, minColRange, maxColRange);
        return __spreadArrays(fakeColGroups, fakeRows);
      });
    };

    var copyRows = function (table, target, generators) {
      var warehouse = Warehouse.fromTable(table);
      var details = onCells(warehouse, target);
      return details.bind(function (selectedCells) {
        var grid = toGrid(warehouse, generators, false);
        var rows = extractGridDetails(grid).rows;
        var slicedGrid = rows.slice(selectedCells[0].row, selectedCells[selectedCells.length - 1].row + selectedCells[selectedCells.length - 1].rowspan);
        var filteredGrid = bind(slicedGrid, function (row) {
          var newCells = filter(row.cells, function (cell) {
            return !cell.isLocked;
          });
          return newCells.length > 0 ? [__assign(__assign({}, row), { cells: newCells })] : [];
        });
        var slicedDetails = toDetailList(filteredGrid, generators);
        return someIf(slicedDetails.length > 0, slicedDetails);
      }).map(function (slicedDetails) {
        return copy$2(slicedDetails);
      });
    };

    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');

    var getTDTHOverallStyle = function (dom, elm, name) {
      var cells = dom.select('td,th', elm);
      var firstChildStyle;
      var checkChildren = function (firstChildStyle, elms) {
        for (var i = 0; i < elms.length; i++) {
          var currentStyle = dom.getStyle(elms[i], name);
          if (typeof firstChildStyle === 'undefined') {
            firstChildStyle = currentStyle;
          }
          if (firstChildStyle !== currentStyle) {
            return '';
          }
        }
        return firstChildStyle;
      };
      return checkChildren(firstChildStyle, cells);
    };
    var applyAlign = function (editor, elm, name) {
      if (name) {
        editor.formatter.apply('align' + name, {}, elm);
      }
    };
    var applyVAlign = function (editor, elm, name) {
      if (name) {
        editor.formatter.apply('valign' + name, {}, elm);
      }
    };
    var unApplyAlign = function (editor, elm) {
      global$1.each('left center right'.split(' '), function (name) {
        editor.formatter.remove('align' + name, {}, elm);
      });
    };
    var unApplyVAlign = function (editor, elm) {
      global$1.each('top middle bottom'.split(' '), function (name) {
        editor.formatter.remove('valign' + name, {}, elm);
      });
    };

    var isListGroup = function (item) {
      return hasNonNullableKey(item, 'menu');
    };
    var buildListItems = function (inputList, startItems) {
      var appendItems = function (values, acc) {
        return acc.concat(map(values, function (item) {
          var text = item.text || item.title;
          if (isListGroup(item)) {
            return {
              text: text,
              items: buildListItems(item.menu)
            };
          } else {
            return {
              text: text,
              value: item.value
            };
          }
        }));
      };
      return appendItems(inputList, startItems || []);
    };
    var rgbToHex = function (dom) {
      return function (value) {
        return startsWith(value, 'rgb') ? dom.toHex(value) : value;
      };
    };
    var extractAdvancedStyles = function (dom, elm) {
      var element = SugarElement.fromDom(elm);
      return {
        borderwidth: getRaw(element, 'border-width').getOr(''),
        borderstyle: getRaw(element, 'border-style').getOr(''),
        bordercolor: getRaw(element, 'border-color').map(rgbToHex(dom)).getOr(''),
        backgroundcolor: getRaw(element, 'background-color').map(rgbToHex(dom)).getOr('')
      };
    };
    var getSharedValues = function (data) {
      var baseData = data[0];
      var comparisonData = data.slice(1);
      each(comparisonData, function (items) {
        each(keys(baseData), function (key) {
          each$1(items, function (itemValue, itemKey) {
            var comparisonValue = baseData[key];
            if (comparisonValue !== '' && key === itemKey) {
              if (comparisonValue !== itemValue) {
                baseData[key] = '';
              }
            }
          });
        });
      });
      return baseData;
    };
    var getAdvancedTab = function (dialogName) {
      var advTabItems = [
        {
          name: 'borderstyle',
          type: 'listbox',
          label: 'Border style',
          items: [
            {
              text: 'Select...',
              value: ''
            },
            {
              text: 'Solid',
              value: 'solid'
            },
            {
              text: 'Dotted',
              value: 'dotted'
            },
            {
              text: 'Dashed',
              value: 'dashed'
            },
            {
              text: 'Double',
              value: 'double'
            },
            {
              text: 'Groove',
              value: 'groove'
            },
            {
              text: 'Ridge',
              value: 'ridge'
            },
            {
              text: 'Inset',
              value: 'inset'
            },
            {
              text: 'Outset',
              value: 'outset'
            },
            {
              text: 'None',
              value: 'none'
            },
            {
              text: 'Hidden',
              value: 'hidden'
            }
          ]
        },
        {
          name: 'bordercolor',
          type: 'colorinput',
          label: 'Border color'
        },
        {
          name: 'backgroundcolor',
          type: 'colorinput',
          label: 'Background color'
        }
      ];
      var borderWidth = {
        name: 'borderwidth',
        type: 'input',
        label: 'Border width'
      };
      var items = dialogName === 'cell' ? [borderWidth].concat(advTabItems) : advTabItems;
      return {
        title: 'Advanced',
        name: 'advanced',
        items: items
      };
    };
    var getAlignment = function (formats, formatName, editor, elm) {
      return find(formats, function (name) {
        return editor.formatter.matchNode(elm, formatName + name);
      }).getOr('');
    };
    var getHAlignment = curry(getAlignment, [
      'left',
      'center',
      'right'
    ], 'align');
    var getVAlignment = curry(getAlignment, [
      'top',
      'middle',
      'bottom'
    ], 'valign');
    var extractDataFromSettings = function (editor, hasAdvTableTab) {
      var style = getDefaultStyles(editor);
      var attrs = getDefaultAttributes(editor);
      var extractAdvancedStyleData = function (dom) {
        return {
          borderstyle: get$1(style, 'border-style').getOr(''),
          bordercolor: rgbToHex(dom)(get$1(style, 'border-color').getOr('')),
          backgroundcolor: rgbToHex(dom)(get$1(style, 'background-color').getOr(''))
        };
      };
      var defaultData = {
        height: '',
        width: '100%',
        cellspacing: '',
        cellpadding: '',
        caption: false,
        class: '',
        align: '',
        border: ''
      };
      var getBorder = function () {
        var borderWidth = style['border-width'];
        if (shouldStyleWithCss(editor) && borderWidth) {
          return { border: borderWidth };
        }
        return get$1(attrs, 'border').fold(function () {
          return {};
        }, function (border) {
          return { border: border };
        });
      };
      var advStyle = hasAdvTableTab ? extractAdvancedStyleData(editor.dom) : {};
      var getCellPaddingCellSpacing = function () {
        var spacing = get$1(style, 'border-spacing').or(get$1(attrs, 'cellspacing')).fold(function () {
          return {};
        }, function (cellspacing) {
          return { cellspacing: cellspacing };
        });
        var padding = get$1(style, 'border-padding').or(get$1(attrs, 'cellpadding')).fold(function () {
          return {};
        }, function (cellpadding) {
          return { cellpadding: cellpadding };
        });
        return __assign(__assign({}, spacing), padding);
      };
      var data = __assign(__assign(__assign(__assign(__assign(__assign({}, defaultData), style), attrs), advStyle), getBorder()), getCellPaddingCellSpacing());
      return data;
    };
    var extractDataFromTableElement = function (editor, elm, hasAdvTableTab) {
      var getBorder = function (dom, elm) {
        var optBorderWidth = getRaw(SugarElement.fromDom(elm), 'border-width');
        if (shouldStyleWithCss(editor) && optBorderWidth.isSome()) {
          return optBorderWidth.getOr('');
        }
        return dom.getAttrib(elm, 'border') || getTDTHOverallStyle(editor.dom, elm, 'border-width') || getTDTHOverallStyle(editor.dom, elm, 'border');
      };
      var dom = editor.dom;
      return __assign({
        width: dom.getStyle(elm, 'width') || dom.getAttrib(elm, 'width'),
        height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),
        cellspacing: dom.getStyle(elm, 'border-spacing') || dom.getAttrib(elm, 'cellspacing'),
        cellpadding: dom.getAttrib(elm, 'cellpadding') || getTDTHOverallStyle(editor.dom, elm, 'padding'),
        border: getBorder(dom, elm),
        caption: !!dom.select('caption', elm)[0],
        class: dom.getAttrib(elm, 'class', ''),
        align: getHAlignment(editor, elm)
      }, hasAdvTableTab ? extractAdvancedStyles(dom, elm) : {});
    };
    var extractDataFromRowElement = function (editor, elm, hasAdvancedRowTab) {
      var dom = editor.dom;
      return __assign({
        height: dom.getStyle(elm, 'height') || dom.getAttrib(elm, 'height'),
        class: dom.getAttrib(elm, 'class', ''),
        type: getRowType(editor, elm),
        align: getHAlignment(editor, elm)
      }, hasAdvancedRowTab ? extractAdvancedStyles(dom, elm) : {});
    };
    var extractDataFromCellElement = function (editor, cell, hasAdvancedCellTab, column) {
      var dom = editor.dom;
      var colElm = column.getOr(cell);
      var getStyle = function (element, style) {
        return dom.getStyle(element, style) || dom.getAttrib(element, style);
      };
      return __assign({
        width: getStyle(colElm, 'width'),
        height: getStyle(cell, 'height'),
        scope: dom.getAttrib(cell, 'scope'),
        celltype: getNodeName(cell),
        class: dom.getAttrib(cell, 'class', ''),
        halign: getHAlignment(editor, cell),
        valign: getVAlignment(editor, cell)
      }, hasAdvancedCellTab ? extractAdvancedStyles(dom, cell) : {});
    };

    var getClassList = function (editor) {
      var classes = buildListItems(getCellClassList(editor));
      if (classes.length > 0) {
        return Optional.some({
          name: 'class',
          type: 'listbox',
          label: 'Class',
          items: classes
        });
      }
      return Optional.none();
    };
    var children$3 = [
      {
        name: 'width',
        type: 'input',
        label: 'Width'
      },
      {
        name: 'height',
        type: 'input',
        label: 'Height'
      },
      {
        name: 'celltype',
        type: 'listbox',
        label: 'Cell type',
        items: [
          {
            text: 'Cell',
            value: 'td'
          },
          {
            text: 'Header cell',
            value: 'th'
          }
        ]
      },
      {
        name: 'scope',
        type: 'listbox',
        label: 'Scope',
        items: [
          {
            text: 'None',
            value: ''
          },
          {
            text: 'Row',
            value: 'row'
          },
          {
            text: 'Column',
            value: 'col'
          },
          {
            text: 'Row group',
            value: 'rowgroup'
          },
          {
            text: 'Column group',
            value: 'colgroup'
          }
        ]
      },
      {
        name: 'halign',
        type: 'listbox',
        label: 'Horizontal align',
        items: [
          {
            text: 'None',
            value: ''
          },
          {
            text: 'Left',
            value: 'left'
          },
          {
            text: 'Center',
            value: 'center'
          },
          {
            text: 'Right',
            value: 'right'
          }
        ]
      },
      {
        name: 'valign',
        type: 'listbox',
        label: 'Vertical align',
        items: [
          {
            text: 'None',
            value: ''
          },
          {
            text: 'Top',
            value: 'top'
          },
          {
            text: 'Middle',
            value: 'middle'
          },
          {
            text: 'Bottom',
            value: 'bottom'
          }
        ]
      }
    ];
    var getItems = function (editor) {
      return children$3.concat(getClassList(editor).toArray());
    };

    var modifiers = function (testTruthy) {
      return function (editor, node) {
        var dom = editor.dom;
        var setAttrib = function (attr, value) {
          if (!testTruthy || value) {
            dom.setAttrib(node, attr, value);
          }
        };
        var setStyle = function (prop, value) {
          if (!testTruthy || value) {
            dom.setStyle(node, prop, value);
          }
        };
        var setFormat = function (formatName, value) {
          if (!testTruthy || value) {
            if (value === '') {
              editor.formatter.remove(formatName, { value: null }, node, true);
            } else {
              editor.formatter.apply(formatName, { value: value }, node);
            }
          }
        };
        return {
          setAttrib: setAttrib,
          setStyle: setStyle,
          setFormat: setFormat
        };
      };
    };
    var DomModifier = {
      normal: modifiers(false),
      ifTruthy: modifiers(true)
    };

    var getSelectedCells = function (cells) {
      return table(cells[0]).map(function (table) {
        var warehouse = Warehouse.fromTable(table);
        var allCells = Warehouse.justCells(warehouse);
        var filtered = filter(allCells, function (cellA) {
          return exists(cells, function (cellB) {
            return eq$1(cellA.element, cellB);
          });
        });
        return map(filtered, function (cell) {
          return {
            element: cell.element.dom,
            column: Warehouse.getColumnAt(warehouse, cell.column).map(function (col) {
              return col.element.dom;
            })
          };
        });
      });
    };
    var updateSimpleProps = function (modifier, colModifier, data) {
      modifier.setAttrib('scope', data.scope);
      modifier.setAttrib('class', data.class);
      modifier.setStyle('height', addPxSuffix(data.height));
      colModifier.setStyle('width', addPxSuffix(data.width));
    };
    var updateAdvancedProps = function (modifier, data) {
      modifier.setFormat('tablecellbackgroundcolor', data.backgroundcolor);
      modifier.setFormat('tablecellbordercolor', data.bordercolor);
      modifier.setFormat('tablecellborderstyle', data.borderstyle);
      modifier.setFormat('tablecellborderwidth', addPxSuffix(data.borderwidth));
    };
    var applyCellData = function (editor, cells, oldData, data) {
      var isSingleCell = cells.length === 1;
      var modifiedData = filter$1(data, function (value, key) {
        return oldData[key] !== value;
      });
      if (size(modifiedData) > 0 && cells.length >= 1) {
        var tableOpt = table(cells[0]);
        getSelectedCells(cells).each(function (selectedCells) {
          each(selectedCells, function (item) {
            var cellElm = switchCellType(editor, item.element, data.celltype);
            var modifier = isSingleCell ? DomModifier.normal(editor, cellElm) : DomModifier.ifTruthy(editor, cellElm);
            var colModifier = item.column.map(function (col) {
              return isSingleCell ? DomModifier.normal(editor, col) : DomModifier.ifTruthy(editor, col);
            }).getOr(modifier);
            updateSimpleProps(modifier, colModifier, data);
            if (hasAdvancedCellTab(editor)) {
              updateAdvancedProps(modifier, data);
            }
            if (isSingleCell) {
              unApplyAlign(editor, cellElm);
              unApplyVAlign(editor, cellElm);
            }
            if (data.halign) {
              applyAlign(editor, cellElm, data.halign);
            }
            if (data.valign) {
              applyVAlign(editor, cellElm, data.valign);
            }
          });
        });
        var styleModified_1 = size(filter$1(modifiedData, function (_value, key) {
          return key !== 'scope' && key !== 'celltype';
        })) > 0;
        tableOpt.each(function (table) {
          return fireTableModified(editor, table.dom, {
            structure: has(modifiedData, 'celltype'),
            style: styleModified_1
          });
        });
      }
    };
    var onSubmitCellForm = function (editor, cells, oldData, api) {
      var data = api.getData();
      api.close();
      editor.undoManager.transact(function () {
        applyCellData(editor, cells, oldData, data);
        editor.focus();
      });
    };
    var getData = function (editor, cells) {
      var cellsData = getSelectedCells(cells).map(function (selectedCells) {
        return map(selectedCells, function (item) {
          return extractDataFromCellElement(editor, item.element, hasAdvancedCellTab(editor), item.column);
        });
      });
      return getSharedValues(cellsData.getOrDie());
    };
    var open = function (editor, selections) {
      var cells = getCellsFromSelection(getSelectionStart(editor), selections);
      if (cells.length === 0) {
        return;
      }
      var data = getData(editor, cells);
      var dialogTabPanel = {
        type: 'tabpanel',
        tabs: [
          {
            title: 'General',
            name: 'general',
            items: getItems(editor)
          },
          getAdvancedTab('cell')
        ]
      };
      var dialogPanel = {
        type: 'panel',
        items: [{
            type: 'grid',
            columns: 2,
            items: getItems(editor)
          }]
      };
      editor.windowManager.open({
        title: 'Cell Properties',
        size: 'normal',
        body: hasAdvancedCellTab(editor) ? dialogTabPanel : dialogPanel,
        buttons: [
          {
            type: 'cancel',
            name: 'cancel',
            text: 'Cancel'
          },
          {
            type: 'submit',
            name: 'save',
            text: 'Save',
            primary: true
          }
        ],
        initialData: data,
        onSubmit: curry(onSubmitCellForm, editor, cells, data)
      });
    };

    var getClassList$1 = function (editor) {
      var classes = buildListItems(getRowClassList(editor));
      if (classes.length > 0) {
        return Optional.some({
          name: 'class',
          type: 'listbox',
          label: 'Class',
          items: classes
        });
      }
      return Optional.none();
    };
    var formChildren = [
      {
        type: 'listbox',
        name: 'type',
        label: 'Row type',
        items: [
          {
            text: 'Header',
            value: 'header'
          },
          {
            text: 'Body',
            value: 'body'
          },
          {
            text: 'Footer',
            value: 'footer'
          }
        ]
      },
      {
        type: 'listbox',
        name: 'align',
        label: 'Alignment',
        items: [
          {
            text: 'None',
            value: ''
          },
          {
            text: 'Left',
            value: 'left'
          },
          {
            text: 'Center',
            value: 'center'
          },
          {
            text: 'Right',
            value: 'right'
          }
        ]
      },
      {
        label: 'Height',
        name: 'height',
        type: 'input'
      }
    ];
    var getItems$1 = function (editor) {
      return formChildren.concat(getClassList$1(editor).toArray());
    };

    var updateSimpleProps$1 = function (modifier, data) {
      modifier.setAttrib('class', data.class);
      modifier.setStyle('height', addPxSuffix(data.height));
    };
    var updateAdvancedProps$1 = function (modifier, data) {
      modifier.setStyle('background-color', data.backgroundcolor);
      modifier.setStyle('border-color', data.bordercolor);
      modifier.setStyle('border-style', data.borderstyle);
    };
    var applyRowData = function (editor, rows, oldData, data) {
      var isSingleRow = rows.length === 1;
      var modifiedData = filter$1(data, function (value, key) {
        return oldData[key] !== value;
      });
      if (size(modifiedData) > 0) {
        each(rows, function (rowElm) {
          if (data.type !== getNodeName(rowElm.parentNode)) {
            switchSectionType(editor, rowElm, data.type);
          }
          var modifier = isSingleRow ? DomModifier.normal(editor, rowElm) : DomModifier.ifTruthy(editor, rowElm);
          updateSimpleProps$1(modifier, data);
          if (hasAdvancedRowTab(editor)) {
            updateAdvancedProps$1(modifier, data);
          }
          if (data.align !== oldData.align) {
            unApplyAlign(editor, rowElm);
            applyAlign(editor, rowElm, data.align);
          }
        });
        var typeModified_1 = has(modifiedData, 'type');
        var styleModified_1 = typeModified_1 ? size(modifiedData) > 1 : true;
        table(SugarElement.fromDom(rows[0])).each(function (table) {
          return fireTableModified(editor, table.dom, {
            structure: typeModified_1,
            style: styleModified_1
          });
        });
      }
    };
    var onSubmitRowForm = function (editor, rows, oldData, api) {
      var data = api.getData();
      api.close();
      editor.undoManager.transact(function () {
        applyRowData(editor, rows, oldData, data);
        editor.focus();
      });
    };
    var open$1 = function (editor) {
      var rows = getRowsFromSelection(getSelectionStart(editor), ephemera.selected);
      if (rows.length === 0) {
        return;
      }
      var rowsData = map(rows, function (rowElm) {
        return extractDataFromRowElement(editor, rowElm.dom, hasAdvancedRowTab(editor));
      });
      var data = getSharedValues(rowsData);
      var dialogTabPanel = {
        type: 'tabpanel',
        tabs: [
          {
            title: 'General',
            name: 'general',
            items: getItems$1(editor)
          },
          getAdvancedTab('row')
        ]
      };
      var dialogPanel = {
        type: 'panel',
        items: [{
            type: 'grid',
            columns: 2,
            items: getItems$1(editor)
          }]
      };
      editor.windowManager.open({
        title: 'Row Properties',
        size: 'normal',
        body: hasAdvancedRowTab(editor) ? dialogTabPanel : dialogPanel,
        buttons: [
          {
            type: 'cancel',
            name: 'cancel',
            text: 'Cancel'
          },
          {
            type: 'submit',
            name: 'save',
            text: 'Save',
            primary: true
          }
        ],
        initialData: data,
        onSubmit: curry(onSubmitRowForm, editor, map(rows, function (r) {
          return r.dom;
        }), data)
      });
    };

    var global$2 = tinymce.util.Tools.resolve('tinymce.Env');

    var getItems$2 = function (editor, classes, insertNewTable) {
      var rowColCountItems = !insertNewTable ? [] : [
        {
          type: 'input',
          name: 'cols',
          label: 'Cols',
          inputMode: 'numeric'
        },
        {
          type: 'input',
          name: 'rows',
          label: 'Rows',
          inputMode: 'numeric'
        }
      ];
      var alwaysItems = [
        {
          type: 'input',
          name: 'width',
          label: 'Width'
        },
        {
          type: 'input',
          name: 'height',
          label: 'Height'
        }
      ];
      var appearanceItems = hasAppearanceOptions(editor) ? [
        {
          type: 'input',
          name: 'cellspacing',
          label: 'Cell spacing',
          inputMode: 'numeric'
        },
        {
          type: 'input',
          name: 'cellpadding',
          label: 'Cell padding',
          inputMode: 'numeric'
        },
        {
          type: 'input',
          name: 'border',
          label: 'Border width'
        },
        {
          type: 'label',
          label: 'Caption',
          items: [{
              type: 'checkbox',
              name: 'caption',
              label: 'Show caption'
            }]
        }
      ] : [];
      var alignmentItem = [{
          type: 'listbox',
          name: 'align',
          label: 'Alignment',
          items: [
            {
              text: 'None',
              value: ''
            },
            {
              text: 'Left',
              value: 'left'
            },
            {
              text: 'Center',
              value: 'center'
            },
            {
              text: 'Right',
              value: 'right'
            }
          ]
        }];
      var classListItem = classes.length > 0 ? [{
          type: 'listbox',
          name: 'class',
          label: 'Class',
          items: classes
        }] : [];
      return rowColCountItems.concat(alwaysItems).concat(appearanceItems).concat(alignmentItem).concat(classListItem);
    };

    var styleTDTH = function (dom, elm, name, value) {
      if (elm.tagName === 'TD' || elm.tagName === 'TH') {
        if (isString(name)) {
          dom.setStyle(elm, name, value);
        } else {
          dom.setStyle(elm, name);
        }
      } else {
        if (elm.children) {
          for (var i = 0; i < elm.children.length; i++) {
            styleTDTH(dom, elm.children[i], name, value);
          }
        }
      }
    };
    var applyDataToElement = function (editor, tableElm, data) {
      var dom = editor.dom;
      var attrs = {};
      var styles = {};
      attrs.class = data.class;
      styles.height = addPxSuffix(data.height);
      if (dom.getAttrib(tableElm, 'width') && !shouldStyleWithCss(editor)) {
        attrs.width = removePxSuffix(data.width);
      } else {
        styles.width = addPxSuffix(data.width);
      }
      if (shouldStyleWithCss(editor)) {
        styles['border-width'] = addPxSuffix(data.border);
        styles['border-spacing'] = addPxSuffix(data.cellspacing);
      } else {
        attrs.border = data.border;
        attrs.cellpadding = data.cellpadding;
        attrs.cellspacing = data.cellspacing;
      }
      if (shouldStyleWithCss(editor) && tableElm.children) {
        for (var i = 0; i < tableElm.children.length; i++) {
          styleTDTH(dom, tableElm.children[i], {
            'border-width': addPxSuffix(data.border),
            'padding': addPxSuffix(data.cellpadding)
          });
          if (hasAdvancedTableTab(editor)) {
            styleTDTH(dom, tableElm.children[i], { 'border-color': data.bordercolor });
          }
        }
      }
      if (hasAdvancedTableTab(editor)) {
        styles['background-color'] = data.backgroundcolor;
        styles['border-color'] = data.bordercolor;
        styles['border-style'] = data.borderstyle;
      }
      attrs.style = dom.serializeStyle(__assign(__assign({}, getDefaultStyles(editor)), styles));
      dom.setAttribs(tableElm, __assign(__assign({}, getDefaultAttributes(editor)), attrs));
    };
    var onSubmitTableForm = function (editor, tableElm, oldData, api) {
      var dom = editor.dom;
      var captionElm;
      var data = api.getData();
      var modifiedData = filter$1(data, function (value, key) {
        return oldData[key] !== value;
      });
      api.close();
      if (data.class === '') {
        delete data.class;
      }
      editor.undoManager.transact(function () {
        if (!tableElm) {
          var cols = parseInt(data.cols, 10) || 1;
          var rows = parseInt(data.rows, 10) || 1;
          tableElm = insert$1(editor, cols, rows, 0, 0);
        }
        if (size(modifiedData) > 0) {
          applyDataToElement(editor, tableElm, data);
          captionElm = dom.select('caption', tableElm)[0];
          if (captionElm && !data.caption) {
            dom.remove(captionElm);
          }
          if (!captionElm && data.caption) {
            captionElm = dom.create('caption');
            captionElm.innerHTML = !global$2.ie ? '<br data-mce-bogus="1"/>' : nbsp;
            tableElm.insertBefore(captionElm, tableElm.firstChild);
          }
          if (data.align === '') {
            unApplyAlign(editor, tableElm);
          } else {
            applyAlign(editor, tableElm, data.align);
          }
        }
        editor.focus();
        editor.addVisual();
        if (size(modifiedData) > 0) {
          var captionModified = has(modifiedData, 'caption');
          var styleModified = captionModified ? size(modifiedData) > 1 : true;
          fireTableModified(editor, tableElm, {
            structure: captionModified,
            style: styleModified
          });
        }
      });
    };
    var open$2 = function (editor, insertNewTable) {
      var dom = editor.dom;
      var tableElm;
      var data = extractDataFromSettings(editor, hasAdvancedTableTab(editor));
      if (insertNewTable === false) {
        tableElm = dom.getParent(editor.selection.getStart(), 'table', editor.getBody());
        if (tableElm) {
          data = extractDataFromTableElement(editor, tableElm, hasAdvancedTableTab(editor));
        } else {
          if (hasAdvancedTableTab(editor)) {
            data.borderstyle = '';
            data.bordercolor = '';
            data.backgroundcolor = '';
          }
        }
      } else {
        data.cols = '1';
        data.rows = '1';
        if (hasAdvancedTableTab(editor)) {
          data.borderstyle = '';
          data.bordercolor = '';
          data.backgroundcolor = '';
        }
      }
      var classes = buildListItems(getTableClassList(editor));
      if (classes.length > 0) {
        if (data.class) {
          data.class = data.class.replace(/\s*mce\-item\-table\s*/g, '');
        }
      }
      var generalPanel = {
        type: 'grid',
        columns: 2,
        items: getItems$2(editor, classes, insertNewTable)
      };
      var nonAdvancedForm = function () {
        return {
          type: 'panel',
          items: [generalPanel]
        };
      };
      var advancedForm = function () {
        return {
          type: 'tabpanel',
          tabs: [
            {
              title: 'General',
              name: 'general',
              items: [generalPanel]
            },
            getAdvancedTab('table')
          ]
        };
      };
      var dialogBody = hasAdvancedTableTab(editor) ? advancedForm() : nonAdvancedForm();
      editor.windowManager.open({
        title: 'Table Properties',
        size: 'normal',
        body: dialogBody,
        onSubmit: curry(onSubmitTableForm, editor, tableElm, data),
        buttons: [
          {
            type: 'cancel',
            name: 'cancel',
            text: 'Cancel'
          },
          {
            type: 'submit',
            name: 'save',
            text: 'Save',
            primary: true
          }
        ],
        initialData: data
      });
    };

    var getSelectionStartCellOrCaption$1 = function (editor) {
      return getSelectionStartCellOrCaption(getSelectionStart(editor), getIsRoot(editor));
    };
    var getSelectionStartCell$1 = function (editor) {
      return getSelectionStartCell(getSelectionStart(editor), getIsRoot(editor));
    };
    var registerCommands = function (editor, actions, cellSelection, selections, clipboard) {
      var isRoot = getIsRoot(editor);
      var eraseTable = function () {
        return getSelectionStartCellOrCaption$1(editor).each(function (cellOrCaption) {
          table(cellOrCaption, isRoot).filter(not(isRoot)).each(function (table) {
            var cursor = SugarElement.fromText('');
            after(table, cursor);
            remove$2(table);
            if (editor.dom.isEmpty(editor.getBody())) {
              editor.setContent('');
              editor.selection.setCursorLocation();
            } else {
              var rng = editor.dom.createRng();
              rng.setStart(cursor.dom, 0);
              rng.setEnd(cursor.dom, 0);
              editor.selection.setRng(rng);
              editor.nodeChanged();
            }
          });
        });
      };
      var setSizingMode = function (sizing) {
        return getSelectionStartCellOrCaption$1(editor).each(function (cellOrCaption) {
          var isForcedSizing = isResponsiveForced(editor) || isPixelsForced(editor) || isPercentagesForced(editor);
          if (!isForcedSizing) {
            table(cellOrCaption, isRoot).each(function (table) {
              if (sizing === 'relative' && !isPercentSizing$1(table)) {
                enforcePercentage(editor, table);
              } else if (sizing === 'fixed' && !isPixelSizing$1(table)) {
                enforcePixels(editor, table);
              } else if (sizing === 'responsive' && !isNoneSizing$1(table)) {
                enforceNone(table);
              }
              removeDataStyle(table);
              fireTableModified(editor, table.dom, structureModified);
            });
          }
        });
      };
      var getTableFromCell = function (cell) {
        return table(cell, isRoot);
      };
      var postExecute = function (table) {
        return function (data) {
          editor.selection.setRng(data.rng);
          editor.focus();
          cellSelection.clear(table);
          removeDataStyle(table);
          fireTableModified(editor, table.dom, data.effect);
        };
      };
      var actOnSelection = function (execute) {
        return getSelectionStartCell$1(editor).each(function (cell) {
          getTableFromCell(cell).each(function (table) {
            var targets = forMenu(selections, table, cell);
            execute(table, targets).each(postExecute(table));
          });
        });
      };
      var copyRowSelection = function () {
        return getSelectionStartCell$1(editor).map(function (cell) {
          return getTableFromCell(cell).bind(function (table) {
            var targets = forMenu(selections, table, cell);
            var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), Optional.none());
            return copyRows(table, targets, generators);
          });
        });
      };
      var copyColSelection = function () {
        return getSelectionStartCell$1(editor).map(function (cell) {
          return getTableFromCell(cell).bind(function (table) {
            var targets = forMenu(selections, table, cell);
            return copyCols(table, targets);
          });
        });
      };
      var pasteOnSelection = function (execute, getRows) {
        return getRows().each(function (rows) {
          var clonedRows = map(rows, function (row) {
            return deep(row);
          });
          getSelectionStartCell$1(editor).each(function (cell) {
            return getTableFromCell(cell).each(function (table) {
              var generators = paste(SugarElement.fromDom(editor.getDoc()));
              var targets = pasteRows(selections, cell, clonedRows, generators);
              execute(table, targets).each(postExecute(table));
            });
          });
        });
      };
      each$1({
        mceTableSplitCells: function () {
          return actOnSelection(actions.unmergeCells);
        },
        mceTableMergeCells: function () {
          return actOnSelection(actions.mergeCells);
        },
        mceTableInsertRowBefore: function () {
          return actOnSelection(actions.insertRowsBefore);
        },
        mceTableInsertRowAfter: function () {
          return actOnSelection(actions.insertRowsAfter);
        },
        mceTableInsertColBefore: function () {
          return actOnSelection(actions.insertColumnsBefore);
        },
        mceTableInsertColAfter: function () {
          return actOnSelection(actions.insertColumnsAfter);
        },
        mceTableDeleteCol: function () {
          return actOnSelection(actions.deleteColumn);
        },
        mceTableDeleteRow: function () {
          return actOnSelection(actions.deleteRow);
        },
        mceTableCutCol: function (_grid) {
          return copyColSelection().each(function (selection) {
            clipboard.setColumns(selection);
            actOnSelection(actions.deleteColumn);
          });
        },
        mceTableCutRow: function (_grid) {
          return copyRowSelection().each(function (selection) {
            clipboard.setRows(selection);
            actOnSelection(actions.deleteRow);
          });
        },
        mceTableCopyCol: function (_grid) {
          return copyColSelection().each(function (selection) {
            return clipboard.setColumns(selection);
          });
        },
        mceTableCopyRow: function (_grid) {
          return copyRowSelection().each(function (selection) {
            return clipboard.setRows(selection);
          });
        },
        mceTablePasteColBefore: function (_grid) {
          return pasteOnSelection(actions.pasteColsBefore, clipboard.getColumns);
        },
        mceTablePasteColAfter: function (_grid) {
          return pasteOnSelection(actions.pasteColsAfter, clipboard.getColumns);
        },
        mceTablePasteRowBefore: function (_grid) {
          return pasteOnSelection(actions.pasteRowsBefore, clipboard.getRows);
        },
        mceTablePasteRowAfter: function (_grid) {
          return pasteOnSelection(actions.pasteRowsAfter, clipboard.getRows);
        },
        mceTableDelete: eraseTable,
        mceTableSizingMode: function (ui, sizing) {
          return setSizingMode(sizing);
        }
      }, function (func, name) {
        return editor.addCommand(name, func);
      });
      var fireTableModifiedForSelection = function (editor, tableOpt) {
        tableOpt.each(function (table) {
          fireTableModified(editor, table.dom, structureModified);
        });
      };
      each$1({
        mceTableCellType: function (_ui, args) {
          var tableOpt = table(getSelectionStart(editor), isRoot);
          actions.setTableCellType(editor, args);
          fireTableModifiedForSelection(editor, tableOpt);
        },
        mceTableRowType: function (_ui, args) {
          var tableOpt = table(getSelectionStart(editor), isRoot);
          actions.setTableRowType(editor, args);
          fireTableModifiedForSelection(editor, tableOpt);
        }
      }, function (func, name) {
        return editor.addCommand(name, func);
      });
      editor.addCommand('mceTableColType', function (_ui, args) {
        return get$1(args, 'type').each(function (type) {
          return actOnSelection(type === 'th' ? actions.makeColumnsHeader : actions.unmakeColumnsHeader);
        });
      });
      each$1({
        mceTableProps: curry(open$2, editor, false),
        mceTableRowProps: curry(open$1, editor),
        mceTableCellProps: curry(open, editor, selections)
      }, function (func, name) {
        return editor.addCommand(name, function () {
          return func();
        });
      });
      editor.addCommand('mceInsertTable', function (_ui, args) {
        if (isObject(args) && keys(args).length > 0) {
          insertTableWithDataValidation(editor, args.rows, args.columns, args.options, 'Invalid values for mceInsertTable - rows and columns values are required to insert a table.');
        } else {
          open$2(editor, true);
        }
      });
      editor.addCommand('mceTableApplyCellStyle', function (_ui, args) {
        var getFormatName = function (style) {
          return 'tablecell' + style.toLowerCase().replace('-', '');
        };
        if (!isObject(args)) {
          return;
        }
        var cells = getCellsFromSelection(getSelectionStart(editor), selections, isRoot);
        if (cells.length === 0) {
          return;
        }
        var validArgs = filter$1(args, function (value, style) {
          return editor.formatter.has(getFormatName(style)) && isString(value);
        });
        if (isEmpty(validArgs)) {
          return;
        }
        each$1(validArgs, function (value, style) {
          each(cells, function (cell) {
            DomModifier.normal(editor, cell.dom).setFormat(getFormatName(style), value);
          });
        });
        getTableFromCell(cells[0]).each(function (table) {
          return fireTableModified(editor, table.dom, styleModified);
        });
      });
    };

    var registerQueryCommands = function (editor, actions, selections) {
      var isRoot = getIsRoot(editor);
      var getTableFromCell = function (cell) {
        return table(cell, isRoot);
      };
      each$1({
        mceTableRowType: function () {
          return actions.getTableRowType(editor);
        },
        mceTableCellType: function () {
          return actions.getTableCellType(editor);
        },
        mceTableColType: function () {
          return getSelectionStartCell(getSelectionStart(editor)).bind(function (cell) {
            return getTableFromCell(cell).map(function (table) {
              var targets = forMenu(selections, table, cell);
              return actions.getTableColType(table, targets);
            });
          }).getOr('');
        }
      }, function (func, name) {
        return editor.addQueryValueHandler(name, func);
      });
    };

    var Clipboard = function () {
      var rows = Cell(Optional.none());
      var cols = Cell(Optional.none());
      var clearClipboard = function (clipboard) {
        clipboard.set(Optional.none());
      };
      return {
        getRows: rows.get,
        setRows: function (r) {
          rows.set(r);
          clearClipboard(cols);
        },
        clearRows: function () {
          return clearClipboard(rows);
        },
        getColumns: cols.get,
        setColumns: function (c) {
          cols.set(c);
          clearClipboard(rows);
        },
        clearColumns: function () {
          return clearClipboard(cols);
        }
      };
    };

    var cellFormats = {
      tablecellbackgroundcolor: {
        selector: 'td,th',
        styles: { backgroundColor: '%value' },
        remove_similar: true
      },
      tablecellbordercolor: {
        selector: 'td,th',
        styles: { borderColor: '%value' },
        remove_similar: true
      },
      tablecellborderstyle: {
        selector: 'td,th',
        styles: { borderStyle: '%value' },
        remove_similar: true
      },
      tablecellborderwidth: {
        selector: 'td,th',
        styles: { borderWidth: '%value' },
        remove_similar: true
      }
    };
    var registerFormats = function (editor) {
      editor.formatter.register(cellFormats);
    };

    var adt$2 = Adt.generate([
      { none: ['current'] },
      { first: ['current'] },
      {
        middle: [
          'current',
          'target'
        ]
      },
      { last: ['current'] }
    ]);
    var none$2 = function (current) {
      if (current === void 0) {
        current = undefined;
      }
      return adt$2.none(current);
    };
    var CellLocation = __assign(__assign({}, adt$2), { none: none$2 });

    var detect$5 = function (current, isRoot) {
      return table(current, isRoot).bind(function (table) {
        var all = cells(table);
        var index = findIndex(all, function (x) {
          return eq$1(current, x);
        });
        return index.map(function (index) {
          return {
            index: index,
            all: all
          };
        });
      });
    };
    var next = function (current, isRoot) {
      var detection = detect$5(current, isRoot);
      return detection.fold(function () {
        return CellLocation.none(current);
      }, function (info) {
        return info.index + 1 < info.all.length ? CellLocation.middle(current, info.all[info.index + 1]) : CellLocation.last(current);
      });
    };
    var prev = function (current, isRoot) {
      var detection = detect$5(current, isRoot);
      return detection.fold(function () {
        return CellLocation.none();
      }, function (info) {
        return info.index - 1 >= 0 ? CellLocation.middle(current, info.all[info.index - 1]) : CellLocation.first(current);
      });
    };

    var create$2 = function (start, soffset, finish, foffset) {
      return {
        start: start,
        soffset: soffset,
        finish: finish,
        foffset: foffset
      };
    };
    var SimRange = { create: create$2 };

    var adt$3 = Adt.generate([
      { before: ['element'] },
      {
        on: [
          'element',
          'offset'
        ]
      },
      { after: ['element'] }
    ]);
    var cata$1 = function (subject, onBefore, onOn, onAfter) {
      return subject.fold(onBefore, onOn, onAfter);
    };
    var getStart = function (situ) {
      return situ.fold(identity, identity, identity);
    };
    var before$2 = adt$3.before;
    var on = adt$3.on;
    var after$2 = adt$3.after;
    var Situ = {
      before: before$2,
      on: on,
      after: after$2,
      cata: cata$1,
      getStart: getStart
    };

    var adt$4 = Adt.generate([
      { domRange: ['rng'] },
      {
        relative: [
          'startSitu',
          'finishSitu'
        ]
      },
      {
        exact: [
          'start',
          'soffset',
          'finish',
          'foffset'
        ]
      }
    ]);
    var exactFromRange = function (simRange) {
      return adt$4.exact(simRange.start, simRange.soffset, simRange.finish, simRange.foffset);
    };
    var getStart$1 = function (selection) {
      return selection.match({
        domRange: function (rng) {
          return SugarElement.fromDom(rng.startContainer);
        },
        relative: function (startSitu, _finishSitu) {
          return Situ.getStart(startSitu);
        },
        exact: function (start, _soffset, _finish, _foffset) {
          return start;
        }
      });
    };
    var domRange = adt$4.domRange;
    var relative = adt$4.relative;
    var exact = adt$4.exact;
    var getWin = function (selection) {
      var start = getStart$1(selection);
      return defaultView(start);
    };
    var range$1 = SimRange.create;
    var SimSelection = {
      domRange: domRange,
      relative: relative,
      exact: exact,
      exactFromRange: exactFromRange,
      getWin: getWin,
      range: range$1
    };

    var selectNodeContents = function (win, element) {
      var rng = win.document.createRange();
      selectNodeContentsUsing(rng, element);
      return rng;
    };
    var selectNodeContentsUsing = function (rng, element) {
      return rng.selectNodeContents(element.dom);
    };
    var setStart = function (rng, situ) {
      situ.fold(function (e) {
        rng.setStartBefore(e.dom);
      }, function (e, o) {
        rng.setStart(e.dom, o);
      }, function (e) {
        rng.setStartAfter(e.dom);
      });
    };
    var setFinish = function (rng, situ) {
      situ.fold(function (e) {
        rng.setEndBefore(e.dom);
      }, function (e, o) {
        rng.setEnd(e.dom, o);
      }, function (e) {
        rng.setEndAfter(e.dom);
      });
    };
    var relativeToNative = function (win, startSitu, finishSitu) {
      var range = win.document.createRange();
      setStart(range, startSitu);
      setFinish(range, finishSitu);
      return range;
    };
    var exactToNative = function (win, start, soffset, finish, foffset) {
      var rng = win.document.createRange();
      rng.setStart(start.dom, soffset);
      rng.setEnd(finish.dom, foffset);
      return rng;
    };
    var toRect = function (rect) {
      return {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height
      };
    };
    var getFirstRect = function (rng) {
      var rects = rng.getClientRects();
      var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();
      return rect.width > 0 || rect.height > 0 ? Optional.some(rect).map(toRect) : Optional.none();
    };

    var adt$5 = Adt.generate([
      {
        ltr: [
          'start',
          'soffset',
          'finish',
          'foffset'
        ]
      },
      {
        rtl: [
          'start',
          'soffset',
          'finish',
          'foffset'
        ]
      }
    ]);
    var fromRange = function (win, type, range) {
      return type(SugarElement.fromDom(range.startContainer), range.startOffset, SugarElement.fromDom(range.endContainer), range.endOffset);
    };
    var getRanges = function (win, selection) {
      return selection.match({
        domRange: function (rng) {
          return {
            ltr: constant(rng),
            rtl: Optional.none
          };
        },
        relative: function (startSitu, finishSitu) {
          return {
            ltr: cached(function () {
              return relativeToNative(win, startSitu, finishSitu);
            }),
            rtl: cached(function () {
              return Optional.some(relativeToNative(win, finishSitu, startSitu));
            })
          };
        },
        exact: function (start, soffset, finish, foffset) {
          return {
            ltr: cached(function () {
              return exactToNative(win, start, soffset, finish, foffset);
            }),
            rtl: cached(function () {
              return Optional.some(exactToNative(win, finish, foffset, start, soffset));
            })
          };
        }
      });
    };
    var doDiagnose = function (win, ranges) {
      var rng = ranges.ltr();
      if (rng.collapsed) {
        var reversed = ranges.rtl().filter(function (rev) {
          return rev.collapsed === false;
        });
        return reversed.map(function (rev) {
          return adt$5.rtl(SugarElement.fromDom(rev.endContainer), rev.endOffset, SugarElement.fromDom(rev.startContainer), rev.startOffset);
        }).getOrThunk(function () {
          return fromRange(win, adt$5.ltr, rng);
        });
      } else {
        return fromRange(win, adt$5.ltr, rng);
      }
    };
    var diagnose = function (win, selection) {
      var ranges = getRanges(win, selection);
      return doDiagnose(win, ranges);
    };
    var asLtrRange = function (win, selection) {
      var diagnosis = diagnose(win, selection);
      return diagnosis.match({
        ltr: function (start, soffset, finish, foffset) {
          var rng = win.document.createRange();
          rng.setStart(start.dom, soffset);
          rng.setEnd(finish.dom, foffset);
          return rng;
        },
        rtl: function (start, soffset, finish, foffset) {
          var rng = win.document.createRange();
          rng.setStart(finish.dom, foffset);
          rng.setEnd(start.dom, soffset);
          return rng;
        }
      });
    };
    var ltr$1 = adt$5.ltr;
    var rtl$1 = adt$5.rtl;

    var searchForPoint = function (rectForOffset, x, y, maxX, length) {
      if (length === 0) {
        return 0;
      } else if (x === maxX) {
        return length - 1;
      }
      var xDelta = maxX;
      for (var i = 1; i < length; i++) {
        var rect = rectForOffset(i);
        var curDeltaX = Math.abs(x - rect.left);
        if (y <= rect.bottom) {
          if (y < rect.top || curDeltaX > xDelta) {
            return i - 1;
          } else {
            xDelta = curDeltaX;
          }
        }
      }
      return 0;
    };
    var inRect = function (rect, x, y) {
      return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;
    };

    var locateOffset = function (doc, textnode, x, y, rect) {
      var rangeForOffset = function (o) {
        var r = doc.dom.createRange();
        r.setStart(textnode.dom, o);
        r.collapse(true);
        return r;
      };
      var rectForOffset = function (o) {
        var r = rangeForOffset(o);
        return r.getBoundingClientRect();
      };
      var length = get$4(textnode).length;
      var offset = searchForPoint(rectForOffset, x, y, rect.right, length);
      return rangeForOffset(offset);
    };
    var locate = function (doc, node, x, y) {
      var r = doc.dom.createRange();
      r.selectNode(node.dom);
      var rects = r.getClientRects();
      var foundRect = findMap(rects, function (rect) {
        return inRect(rect, x, y) ? Optional.some(rect) : Optional.none();
      });
      return foundRect.map(function (rect) {
        return locateOffset(doc, node, x, y, rect);
      });
    };

    var searchInChildren = function (doc, node, x, y) {
      var r = doc.dom.createRange();
      var nodes = children(node);
      return findMap(nodes, function (n) {
        r.selectNode(n.dom);
        return inRect(r.getBoundingClientRect(), x, y) ? locateNode(doc, n, x, y) : Optional.none();
      });
    };
    var locateNode = function (doc, node, x, y) {
      return isText(node) ? locate(doc, node, x, y) : searchInChildren(doc, node, x, y);
    };
    var locate$1 = function (doc, node, x, y) {
      var r = doc.dom.createRange();
      r.selectNode(node.dom);
      var rect = r.getBoundingClientRect();
      var boundedX = Math.max(rect.left, Math.min(rect.right, x));
      var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));
      return locateNode(doc, node, boundedX, boundedY);
    };

    var COLLAPSE_TO_LEFT = true;
    var COLLAPSE_TO_RIGHT = false;
    var getCollapseDirection = function (rect, x) {
      return x - rect.left < rect.right - x ? COLLAPSE_TO_LEFT : COLLAPSE_TO_RIGHT;
    };
    var createCollapsedNode = function (doc, target, collapseDirection) {
      var r = doc.dom.createRange();
      r.selectNode(target.dom);
      r.collapse(collapseDirection);
      return r;
    };
    var locateInElement = function (doc, node, x) {
      var cursorRange = doc.dom.createRange();
      cursorRange.selectNode(node.dom);
      var rect = cursorRange.getBoundingClientRect();
      var collapseDirection = getCollapseDirection(rect, x);
      var f = collapseDirection === COLLAPSE_TO_LEFT ? first : last$1;
      return f(node).map(function (target) {
        return createCollapsedNode(doc, target, collapseDirection);
      });
    };
    var locateInEmpty = function (doc, node, x) {
      var rect = node.dom.getBoundingClientRect();
      var collapseDirection = getCollapseDirection(rect, x);
      return Optional.some(createCollapsedNode(doc, node, collapseDirection));
    };
    var search = function (doc, node, x) {
      var f = children(node).length === 0 ? locateInEmpty : locateInElement;
      return f(doc, node, x);
    };

    var caretPositionFromPoint = function (doc, x, y) {
      return Optional.from(doc.dom.caretPositionFromPoint(x, y)).bind(function (pos) {
        if (pos.offsetNode === null) {
          return Optional.none();
        }
        var r = doc.dom.createRange();
        r.setStart(pos.offsetNode, pos.offset);
        r.collapse();
        return Optional.some(r);
      });
    };
    var caretRangeFromPoint = function (doc, x, y) {
      return Optional.from(doc.dom.caretRangeFromPoint(x, y));
    };
    var searchTextNodes = function (doc, node, x, y) {
      var r = doc.dom.createRange();
      r.selectNode(node.dom);
      var rect = r.getBoundingClientRect();
      var boundedX = Math.max(rect.left, Math.min(rect.right, x));
      var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));
      return locate$1(doc, node, boundedX, boundedY);
    };
    var searchFromPoint = function (doc, x, y) {
      return SugarElement.fromPoint(doc, x, y).bind(function (elem) {
        var fallback = function () {
          return search(doc, elem, x);
        };
        return children(elem).length === 0 ? fallback() : searchTextNodes(doc, elem, x, y).orThunk(fallback);
      });
    };
    var availableSearch = function () {
      if (document.caretPositionFromPoint) {
        return caretPositionFromPoint;
      } else if (document.caretRangeFromPoint) {
        return caretRangeFromPoint;
      } else {
        return searchFromPoint;
      }
    }();
    var fromPoint$1 = function (win, x, y) {
      var doc = SugarElement.fromDom(win.document);
      return availableSearch(doc, x, y).map(function (rng) {
        return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);
      });
    };

    var beforeSpecial = function (element, offset) {
      var name$1 = name(element);
      if ('input' === name$1) {
        return Situ.after(element);
      } else if (!contains([
          'br',
          'img'
        ], name$1)) {
        return Situ.on(element, offset);
      } else {
        return offset === 0 ? Situ.before(element) : Situ.after(element);
      }
    };
    var preprocessRelative = function (startSitu, finishSitu) {
      var start = startSitu.fold(Situ.before, beforeSpecial, Situ.after);
      var finish = finishSitu.fold(Situ.before, beforeSpecial, Situ.after);
      return SimSelection.relative(start, finish);
    };
    var preprocessExact = function (start, soffset, finish, foffset) {
      var startSitu = beforeSpecial(start, soffset);
      var finishSitu = beforeSpecial(finish, foffset);
      return SimSelection.relative(startSitu, finishSitu);
    };
    var preprocess = function (selection) {
      return selection.match({
        domRange: function (rng) {
          var start = SugarElement.fromDom(rng.startContainer);
          var finish = SugarElement.fromDom(rng.endContainer);
          return preprocessExact(start, rng.startOffset, finish, rng.endOffset);
        },
        relative: preprocessRelative,
        exact: preprocessExact
      });
    };

    var makeRange = function (start, soffset, finish, foffset) {
      var doc = owner(start);
      var rng = doc.dom.createRange();
      rng.setStart(start.dom, soffset);
      rng.setEnd(finish.dom, foffset);
      return rng;
    };
    var after$3 = function (start, soffset, finish, foffset) {
      var r = makeRange(start, soffset, finish, foffset);
      var same = eq$1(start, finish) && soffset === foffset;
      return r.collapsed && !same;
    };

    var getNativeSelection = function (win) {
      return Optional.from(win.getSelection());
    };
    var doSetNativeRange = function (win, rng) {
      getNativeSelection(win).each(function (selection) {
        selection.removeAllRanges();
        selection.addRange(rng);
      });
    };
    var doSetRange = function (win, start, soffset, finish, foffset) {
      var rng = exactToNative(win, start, soffset, finish, foffset);
      doSetNativeRange(win, rng);
    };
    var setLegacyRtlRange = function (win, selection, start, soffset, finish, foffset) {
      selection.collapse(start.dom, soffset);
      selection.extend(finish.dom, foffset);
    };
    var setRangeFromRelative = function (win, relative) {
      return diagnose(win, relative).match({
        ltr: function (start, soffset, finish, foffset) {
          doSetRange(win, start, soffset, finish, foffset);
        },
        rtl: function (start, soffset, finish, foffset) {
          getNativeSelection(win).each(function (selection) {
            if (selection.setBaseAndExtent) {
              selection.setBaseAndExtent(start.dom, soffset, finish.dom, foffset);
            } else if (selection.extend) {
              try {
                setLegacyRtlRange(win, selection, start, soffset, finish, foffset);
              } catch (e) {
                doSetRange(win, finish, foffset, start, soffset);
              }
            } else {
              doSetRange(win, finish, foffset, start, soffset);
            }
          });
        }
      });
    };
    var setExact = function (win, start, soffset, finish, foffset) {
      var relative = preprocessExact(start, soffset, finish, foffset);
      setRangeFromRelative(win, relative);
    };
    var setRelative = function (win, startSitu, finishSitu) {
      var relative = preprocessRelative(startSitu, finishSitu);
      setRangeFromRelative(win, relative);
    };
    var toNative = function (selection) {
      var win = SimSelection.getWin(selection).dom;
      var getDomRange = function (start, soffset, finish, foffset) {
        return exactToNative(win, start, soffset, finish, foffset);
      };
      var filtered = preprocess(selection);
      return diagnose(win, filtered).match({
        ltr: getDomRange,
        rtl: getDomRange
      });
    };
    var readRange = function (selection) {
      if (selection.rangeCount > 0) {
        var firstRng = selection.getRangeAt(0);
        var lastRng = selection.getRangeAt(selection.rangeCount - 1);
        return Optional.some(SimRange.create(SugarElement.fromDom(firstRng.startContainer), firstRng.startOffset, SugarElement.fromDom(lastRng.endContainer), lastRng.endOffset));
      } else {
        return Optional.none();
      }
    };
    var doGetExact = function (selection) {
      if (selection.anchorNode === null || selection.focusNode === null) {
        return readRange(selection);
      } else {
        var anchor = SugarElement.fromDom(selection.anchorNode);
        var focus_1 = SugarElement.fromDom(selection.focusNode);
        return after$3(anchor, selection.anchorOffset, focus_1, selection.focusOffset) ? Optional.some(SimRange.create(anchor, selection.anchorOffset, focus_1, selection.focusOffset)) : readRange(selection);
      }
    };
    var setToElement = function (win, element) {
      var rng = selectNodeContents(win, element);
      doSetNativeRange(win, rng);
    };
    var getExact = function (win) {
      return getNativeSelection(win).filter(function (sel) {
        return sel.rangeCount > 0;
      }).bind(doGetExact);
    };
    var get$c = function (win) {
      return getExact(win).map(function (range) {
        return SimSelection.exact(range.start, range.soffset, range.finish, range.foffset);
      });
    };
    var getFirstRect$1 = function (win, selection) {
      var rng = asLtrRange(win, selection);
      return getFirstRect(rng);
    };
    var getAtPoint = function (win, x, y) {
      return fromPoint$1(win, x, y);
    };
    var clear = function (win) {
      getNativeSelection(win).each(function (selection) {
        return selection.removeAllRanges();
      });
    };

    var global$3 = tinymce.util.Tools.resolve('tinymce.util.VK');

    var forward = function (editor, isRoot, cell) {
      return go(editor, isRoot, next(cell));
    };
    var backward = function (editor, isRoot, cell) {
      return go(editor, isRoot, prev(cell));
    };
    var getCellFirstCursorPosition = function (editor, cell) {
      var selection = SimSelection.exact(cell, 0, cell, 0);
      return toNative(selection);
    };
    var getNewRowCursorPosition = function (editor, table) {
      var rows = descendants$1(table, 'tr');
      return last(rows).bind(function (last) {
        return descendant$1(last, 'td,th').map(function (first) {
          return getCellFirstCursorPosition(editor, first);
        });
      });
    };
    var go = function (editor, isRoot, cell) {
      return cell.fold(Optional.none, Optional.none, function (current, next) {
        return first(next).map(function (cell) {
          return getCellFirstCursorPosition(editor, cell);
        });
      }, function (current) {
        return table(current, isRoot).bind(function (table) {
          editor.execCommand('mceTableInsertRowAfter');
          return getNewRowCursorPosition(editor, table);
        });
      });
    };
    var rootElements = [
      'table',
      'li',
      'dl'
    ];
    var handle$1 = function (event, editor, cellSelection) {
      if (event.keyCode === global$3.TAB) {
        var body_1 = getBody$1(editor);
        var isRoot_1 = function (element) {
          var name$1 = name(element);
          return eq$1(element, body_1) || contains(rootElements, name$1);
        };
        var rng = editor.selection.getRng();
        var container = SugarElement.fromDom(event.shiftKey ? rng.startContainer : rng.endContainer);
        cell(container, isRoot_1).each(function (cell) {
          event.preventDefault();
          table(cell, isRoot_1).each(cellSelection.clear);
          editor.selection.collapse(event.shiftKey);
          var navigation = event.shiftKey ? backward : forward;
          var rng = navigation(editor, isRoot_1, cell);
          rng.each(function (range) {
            editor.selection.setRng(range);
          });
        });
      }
    };

    var create$3 = function (selection, kill) {
      return {
        selection: selection,
        kill: kill
      };
    };
    var Response = { create: create$3 };

    var create$4 = function (start, soffset, finish, foffset) {
      return {
        start: Situ.on(start, soffset),
        finish: Situ.on(finish, foffset)
      };
    };
    var Situs = { create: create$4 };

    var convertToRange = function (win, selection) {
      var rng = asLtrRange(win, selection);
      return SimRange.create(SugarElement.fromDom(rng.startContainer), rng.startOffset, SugarElement.fromDom(rng.endContainer), rng.endOffset);
    };
    var makeSitus = Situs.create;

    var sync = function (container, isRoot, start, soffset, finish, foffset, selectRange) {
      if (!(eq$1(start, finish) && soffset === foffset)) {
        return closest$1(start, 'td,th', isRoot).bind(function (s) {
          return closest$1(finish, 'td,th', isRoot).bind(function (f) {
            return detect$6(container, isRoot, s, f, selectRange);
          });
        });
      } else {
        return Optional.none();
      }
    };
    var detect$6 = function (container, isRoot, start, finish, selectRange) {
      if (!eq$1(start, finish)) {
        return identify(start, finish, isRoot).bind(function (cellSel) {
          var boxes = cellSel.boxes.getOr([]);
          if (boxes.length > 0) {
            selectRange(container, boxes, cellSel.start, cellSel.finish);
            return Optional.some(Response.create(Optional.some(makeSitus(start, 0, start, getEnd(start))), true));
          } else {
            return Optional.none();
          }
        });
      } else {
        return Optional.none();
      }
    };
    var update = function (rows, columns, container, selected, annotations) {
      var updateSelection = function (newSels) {
        annotations.clearBeforeUpdate(container);
        annotations.selectRange(container, newSels.boxes, newSels.start, newSels.finish);
        return newSels.boxes;
      };
      return shiftSelection(selected, rows, columns, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(updateSelection);
    };

    var traverse = function (item, mode) {
      return {
        item: item,
        mode: mode
      };
    };
    var backtrack = function (universe, item, _direction, transition) {
      if (transition === void 0) {
        transition = sidestep;
      }
      return universe.property().parent(item).map(function (p) {
        return traverse(p, transition);
      });
    };
    var sidestep = function (universe, item, direction, transition) {
      if (transition === void 0) {
        transition = advance;
      }
      return direction.sibling(universe, item).map(function (p) {
        return traverse(p, transition);
      });
    };
    var advance = function (universe, item, direction, transition) {
      if (transition === void 0) {
        transition = advance;
      }
      var children = universe.property().children(item);
      var result = direction.first(children);
      return result.map(function (r) {
        return traverse(r, transition);
      });
    };
    var successors = [
      {
        current: backtrack,
        next: sidestep,
        fallback: Optional.none()
      },
      {
        current: sidestep,
        next: advance,
        fallback: Optional.some(backtrack)
      },
      {
        current: advance,
        next: advance,
        fallback: Optional.some(sidestep)
      }
    ];
    var go$1 = function (universe, item, mode, direction, rules) {
      if (rules === void 0) {
        rules = successors;
      }
      var ruleOpt = find(rules, function (succ) {
        return succ.current === mode;
      });
      return ruleOpt.bind(function (rule) {
        return rule.current(universe, item, direction, rule.next).orThunk(function () {
          return rule.fallback.bind(function (fb) {
            return go$1(universe, item, fb, direction);
          });
        });
      });
    };

    var left = function () {
      var sibling = function (universe, item) {
        return universe.query().prevSibling(item);
      };
      var first = function (children) {
        return children.length > 0 ? Optional.some(children[children.length - 1]) : Optional.none();
      };
      return {
        sibling: sibling,
        first: first
      };
    };
    var right = function () {
      var sibling = function (universe, item) {
        return universe.query().nextSibling(item);
      };
      var first = function (children) {
        return children.length > 0 ? Optional.some(children[0]) : Optional.none();
      };
      return {
        sibling: sibling,
        first: first
      };
    };
    var Walkers = {
      left: left,
      right: right
    };

    var hone = function (universe, item, predicate, mode, direction, isRoot) {
      var next = go$1(universe, item, mode, direction);
      return next.bind(function (n) {
        if (isRoot(n.item)) {
          return Optional.none();
        } else {
          return predicate(n.item) ? Optional.some(n.item) : hone(universe, n.item, predicate, n.mode, direction, isRoot);
        }
      });
    };
    var left$1 = function (universe, item, predicate, isRoot) {
      return hone(universe, item, predicate, sidestep, Walkers.left(), isRoot);
    };
    var right$1 = function (universe, item, predicate, isRoot) {
      return hone(universe, item, predicate, sidestep, Walkers.right(), isRoot);
    };

    var isLeaf = function (universe) {
      return function (element) {
        return universe.property().children(element).length === 0;
      };
    };
    var before$3 = function (universe, item, isRoot) {
      return seekLeft(universe, item, isLeaf(universe), isRoot);
    };
    var after$4 = function (universe, item, isRoot) {
      return seekRight(universe, item, isLeaf(universe), isRoot);
    };
    var seekLeft = left$1;
    var seekRight = right$1;

    var universe$3 = DomUniverse();
    var before$4 = function (element, isRoot) {
      return before$3(universe$3, element, isRoot);
    };
    var after$5 = function (element, isRoot) {
      return after$4(universe$3, element, isRoot);
    };
    var seekLeft$1 = function (element, predicate, isRoot) {
      return seekLeft(universe$3, element, predicate, isRoot);
    };
    var seekRight$1 = function (element, predicate, isRoot) {
      return seekRight(universe$3, element, predicate, isRoot);
    };

    var ancestor$2 = function (scope, predicate, isRoot) {
      return ancestor(scope, predicate, isRoot).isSome();
    };

    var adt$6 = Adt.generate([
      { none: ['message'] },
      { success: [] },
      { failedUp: ['cell'] },
      { failedDown: ['cell'] }
    ]);
    var isOverlapping = function (bridge, before, after) {
      var beforeBounds = bridge.getRect(before);
      var afterBounds = bridge.getRect(after);
      return afterBounds.right > beforeBounds.left && afterBounds.left < beforeBounds.right;
    };
    var isRow = function (elem) {
      return closest$1(elem, 'tr');
    };
    var verify = function (bridge, before, beforeOffset, after, afterOffset, failure, isRoot) {
      return closest$1(after, 'td,th', isRoot).bind(function (afterCell) {
        return closest$1(before, 'td,th', isRoot).map(function (beforeCell) {
          if (!eq$1(afterCell, beforeCell)) {
            return sharedOne$1(isRow, [
              afterCell,
              beforeCell
            ]).fold(function () {
              return isOverlapping(bridge, beforeCell, afterCell) ? adt$6.success() : failure(beforeCell);
            }, function (_sharedRow) {
              return failure(beforeCell);
            });
          } else {
            return eq$1(after, afterCell) && getEnd(afterCell) === afterOffset ? failure(beforeCell) : adt$6.none('in same cell');
          }
        });
      }).getOr(adt$6.none('default'));
    };
    var cata$2 = function (subject, onNone, onSuccess, onFailedUp, onFailedDown) {
      return subject.fold(onNone, onSuccess, onFailedUp, onFailedDown);
    };
    var BeforeAfter = __assign(__assign({}, adt$6), {
      verify: verify,
      cata: cata$2
    });

    var inParent = function (parent, children, element, index) {
      return {
        parent: parent,
        children: children,
        element: element,
        index: index
      };
    };
    var indexInParent = function (element) {
      return parent(element).bind(function (parent) {
        var children$1 = children(parent);
        return indexOf(children$1, element).map(function (index) {
          return inParent(parent, children$1, element, index);
        });
      });
    };
    var indexOf = function (elements, element) {
      return findIndex(elements, curry(eq$1, element));
    };

    var isBr = function (elem) {
      return name(elem) === 'br';
    };
    var gatherer = function (cand, gather, isRoot) {
      return gather(cand, isRoot).bind(function (target) {
        return isText(target) && get$4(target).trim().length === 0 ? gatherer(target, gather, isRoot) : Optional.some(target);
      });
    };
    var handleBr = function (isRoot, element, direction) {
      return direction.traverse(element).orThunk(function () {
        return gatherer(element, direction.gather, isRoot);
      }).map(direction.relative);
    };
    var findBr = function (element, offset) {
      return child(element, offset).filter(isBr).orThunk(function () {
        return child(element, offset - 1).filter(isBr);
      });
    };
    var handleParent = function (isRoot, element, offset, direction) {
      return findBr(element, offset).bind(function (br) {
        return direction.traverse(br).fold(function () {
          return gatherer(br, direction.gather, isRoot).map(direction.relative);
        }, function (adjacent) {
          return indexInParent(adjacent).map(function (info) {
            return Situ.on(info.parent, info.index);
          });
        });
      });
    };
    var tryBr = function (isRoot, element, offset, direction) {
      var target = isBr(element) ? handleBr(isRoot, element, direction) : handleParent(isRoot, element, offset, direction);
      return target.map(function (tgt) {
        return {
          start: tgt,
          finish: tgt
        };
      });
    };
    var process = function (analysis) {
      return BeforeAfter.cata(analysis, function (_message) {
        return Optional.none();
      }, function () {
        return Optional.none();
      }, function (cell) {
        return Optional.some(point(cell, 0));
      }, function (cell) {
        return Optional.some(point(cell, getEnd(cell)));
      });
    };

    var moveDown = function (caret, amount) {
      return {
        left: caret.left,
        top: caret.top + amount,
        right: caret.right,
        bottom: caret.bottom + amount
      };
    };
    var moveUp = function (caret, amount) {
      return {
        left: caret.left,
        top: caret.top - amount,
        right: caret.right,
        bottom: caret.bottom - amount
      };
    };
    var translate = function (caret, xDelta, yDelta) {
      return {
        left: caret.left + xDelta,
        top: caret.top + yDelta,
        right: caret.right + xDelta,
        bottom: caret.bottom + yDelta
      };
    };
    var getTop$1 = function (caret) {
      return caret.top;
    };
    var getBottom = function (caret) {
      return caret.bottom;
    };

    var getPartialBox = function (bridge, element, offset) {
      if (offset >= 0 && offset < getEnd(element)) {
        return bridge.getRangedRect(element, offset, element, offset + 1);
      } else if (offset > 0) {
        return bridge.getRangedRect(element, offset - 1, element, offset);
      }
      return Optional.none();
    };
    var toCaret = function (rect) {
      return {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom
      };
    };
    var getElemBox = function (bridge, element) {
      return Optional.some(bridge.getRect(element));
    };
    var getBoxAt = function (bridge, element, offset) {
      if (isElement(element)) {
        return getElemBox(bridge, element).map(toCaret);
      } else if (isText(element)) {
        return getPartialBox(bridge, element, offset).map(toCaret);
      } else {
        return Optional.none();
      }
    };
    var getEntireBox = function (bridge, element) {
      if (isElement(element)) {
        return getElemBox(bridge, element).map(toCaret);
      } else if (isText(element)) {
        return bridge.getRangedRect(element, 0, element, getEnd(element)).map(toCaret);
      } else {
        return Optional.none();
      }
    };

    var JUMP_SIZE = 5;
    var NUM_RETRIES = 100;
    var adt$7 = Adt.generate([
      { none: [] },
      { retry: ['caret'] }
    ]);
    var isOutside = function (caret, box) {
      return caret.left < box.left || Math.abs(box.right - caret.left) < 1 || caret.left > box.right;
    };
    var inOutsideBlock = function (bridge, element, caret) {
      return closest(element, isBlock$1).fold(never, function (cell) {
        return getEntireBox(bridge, cell).exists(function (box) {
          return isOutside(caret, box);
        });
      });
    };
    var adjustDown = function (bridge, element, guessBox, original, caret) {
      var lowerCaret = moveDown(caret, JUMP_SIZE);
      if (Math.abs(guessBox.bottom - original.bottom) < 1) {
        return adt$7.retry(lowerCaret);
      } else if (guessBox.top > caret.bottom) {
        return adt$7.retry(lowerCaret);
      } else if (guessBox.top === caret.bottom) {
        return adt$7.retry(moveDown(caret, 1));
      } else {
        return inOutsideBlock(bridge, element, caret) ? adt$7.retry(translate(lowerCaret, JUMP_SIZE, 0)) : adt$7.none();
      }
    };
    var adjustUp = function (bridge, element, guessBox, original, caret) {
      var higherCaret = moveUp(caret, JUMP_SIZE);
      if (Math.abs(guessBox.top - original.top) < 1) {
        return adt$7.retry(higherCaret);
      } else if (guessBox.bottom < caret.top) {
        return adt$7.retry(higherCaret);
      } else if (guessBox.bottom === caret.top) {
        return adt$7.retry(moveUp(caret, 1));
      } else {
        return inOutsideBlock(bridge, element, caret) ? adt$7.retry(translate(higherCaret, JUMP_SIZE, 0)) : adt$7.none();
      }
    };
    var upMovement = {
      point: getTop$1,
      adjuster: adjustUp,
      move: moveUp,
      gather: before$4
    };
    var downMovement = {
      point: getBottom,
      adjuster: adjustDown,
      move: moveDown,
      gather: after$5
    };
    var isAtTable = function (bridge, x, y) {
      return bridge.elementFromPoint(x, y).filter(function (elm) {
        return name(elm) === 'table';
      }).isSome();
    };
    var adjustForTable = function (bridge, movement, original, caret, numRetries) {
      return adjustTil(bridge, movement, original, movement.move(caret, JUMP_SIZE), numRetries);
    };
    var adjustTil = function (bridge, movement, original, caret, numRetries) {
      if (numRetries === 0) {
        return Optional.some(caret);
      }
      if (isAtTable(bridge, caret.left, movement.point(caret))) {
        return adjustForTable(bridge, movement, original, caret, numRetries - 1);
      }
      return bridge.situsFromPoint(caret.left, movement.point(caret)).bind(function (guess) {
        return guess.start.fold(Optional.none, function (element) {
          return getEntireBox(bridge, element).bind(function (guessBox) {
            return movement.adjuster(bridge, element, guessBox, original, caret).fold(Optional.none, function (newCaret) {
              return adjustTil(bridge, movement, original, newCaret, numRetries - 1);
            });
          }).orThunk(function () {
            return Optional.some(caret);
          });
        }, Optional.none);
      });
    };
    var ieTryDown = function (bridge, caret) {
      return bridge.situsFromPoint(caret.left, caret.bottom + JUMP_SIZE);
    };
    var ieTryUp = function (bridge, caret) {
      return bridge.situsFromPoint(caret.left, caret.top - JUMP_SIZE);
    };
    var checkScroll = function (movement, adjusted, bridge) {
      if (movement.point(adjusted) > bridge.getInnerHeight()) {
        return Optional.some(movement.point(adjusted) - bridge.getInnerHeight());
      } else if (movement.point(adjusted) < 0) {
        return Optional.some(-movement.point(adjusted));
      } else {
        return Optional.none();
      }
    };
    var retry = function (movement, bridge, caret) {
      var moved = movement.move(caret, JUMP_SIZE);
      var adjusted = adjustTil(bridge, movement, caret, moved, NUM_RETRIES).getOr(moved);
      return checkScroll(movement, adjusted, bridge).fold(function () {
        return bridge.situsFromPoint(adjusted.left, movement.point(adjusted));
      }, function (delta) {
        bridge.scrollBy(0, delta);
        return bridge.situsFromPoint(adjusted.left, movement.point(adjusted) - delta);
      });
    };
    var Retries = {
      tryUp: curry(retry, upMovement),
      tryDown: curry(retry, downMovement),
      ieTryUp: ieTryUp,
      ieTryDown: ieTryDown,
      getJumpSize: constant(JUMP_SIZE)
    };

    var MAX_RETRIES = 20;
    var findSpot = function (bridge, isRoot, direction) {
      return bridge.getSelection().bind(function (sel) {
        return tryBr(isRoot, sel.finish, sel.foffset, direction).fold(function () {
          return Optional.some(point(sel.finish, sel.foffset));
        }, function (brNeighbour) {
          var range = bridge.fromSitus(brNeighbour);
          var analysis = BeforeAfter.verify(bridge, sel.finish, sel.foffset, range.finish, range.foffset, direction.failure, isRoot);
          return process(analysis);
        });
      });
    };
    var scan$1 = function (bridge, isRoot, element, offset, direction, numRetries) {
      if (numRetries === 0) {
        return Optional.none();
      }
      return tryCursor(bridge, isRoot, element, offset, direction).bind(function (situs) {
        var range = bridge.fromSitus(situs);
        var analysis = BeforeAfter.verify(bridge, element, offset, range.finish, range.foffset, direction.failure, isRoot);
        return BeforeAfter.cata(analysis, function () {
          return Optional.none();
        }, function () {
          return Optional.some(situs);
        }, function (cell) {
          if (eq$1(element, cell) && offset === 0) {
            return tryAgain(bridge, element, offset, moveUp, direction);
          } else {
            return scan$1(bridge, isRoot, cell, 0, direction, numRetries - 1);
          }
        }, function (cell) {
          if (eq$1(element, cell) && offset === getEnd(cell)) {
            return tryAgain(bridge, element, offset, moveDown, direction);
          } else {
            return scan$1(bridge, isRoot, cell, getEnd(cell), direction, numRetries - 1);
          }
        });
      });
    };
    var tryAgain = function (bridge, element, offset, move, direction) {
      return getBoxAt(bridge, element, offset).bind(function (box) {
        return tryAt(bridge, direction, move(box, Retries.getJumpSize()));
      });
    };
    var tryAt = function (bridge, direction, box) {
      var browser = detect$3().browser;
      if (browser.isChrome() || browser.isSafari() || browser.isFirefox() || browser.isEdge()) {
        return direction.otherRetry(bridge, box);
      } else if (browser.isIE()) {
        return direction.ieRetry(bridge, box);
      } else {
        return Optional.none();
      }
    };
    var tryCursor = function (bridge, isRoot, element, offset, direction) {
      return getBoxAt(bridge, element, offset).bind(function (box) {
        return tryAt(bridge, direction, box);
      });
    };
    var handle$2 = function (bridge, isRoot, direction) {
      return findSpot(bridge, isRoot, direction).bind(function (spot) {
        return scan$1(bridge, isRoot, spot.element, spot.offset, direction, MAX_RETRIES).map(bridge.fromSitus);
      });
    };

    var inSameTable = function (elem, table) {
      return ancestor$2(elem, function (e) {
        return parent(e).exists(function (p) {
          return eq$1(p, table);
        });
      });
    };
    var simulate = function (bridge, isRoot, direction, initial, anchor) {
      return closest$1(initial, 'td,th', isRoot).bind(function (start) {
        return closest$1(start, 'table', isRoot).bind(function (table) {
          if (!inSameTable(anchor, table)) {
            return Optional.none();
          }
          return handle$2(bridge, isRoot, direction).bind(function (range) {
            return closest$1(range.finish, 'td,th', isRoot).map(function (finish) {
              return {
                start: start,
                finish: finish,
                range: range
              };
            });
          });
        });
      });
    };
    var navigate = function (bridge, isRoot, direction, initial, anchor, precheck) {
      if (detect$3().browser.isIE()) {
        return Optional.none();
      } else {
        return precheck(initial, isRoot).orThunk(function () {
          return simulate(bridge, isRoot, direction, initial, anchor).map(function (info) {
            var range = info.range;
            return Response.create(Optional.some(makeSitus(range.start, range.soffset, range.finish, range.foffset)), true);
          });
        });
      }
    };
    var firstUpCheck = function (initial, isRoot) {
      return closest$1(initial, 'tr', isRoot).bind(function (startRow) {
        return closest$1(startRow, 'table', isRoot).bind(function (table) {
          var rows = descendants$1(table, 'tr');
          if (eq$1(startRow, rows[0])) {
            return seekLeft$1(table, function (element) {
              return last$1(element).isSome();
            }, isRoot).map(function (last) {
              var lastOffset = getEnd(last);
              return Response.create(Optional.some(makeSitus(last, lastOffset, last, lastOffset)), true);
            });
          } else {
            return Optional.none();
          }
        });
      });
    };
    var lastDownCheck = function (initial, isRoot) {
      return closest$1(initial, 'tr', isRoot).bind(function (startRow) {
        return closest$1(startRow, 'table', isRoot).bind(function (table) {
          var rows = descendants$1(table, 'tr');
          if (eq$1(startRow, rows[rows.length - 1])) {
            return seekRight$1(table, function (element) {
              return first(element).isSome();
            }, isRoot).map(function (first) {
              return Response.create(Optional.some(makeSitus(first, 0, first, 0)), true);
            });
          } else {
            return Optional.none();
          }
        });
      });
    };
    var select = function (bridge, container, isRoot, direction, initial, anchor, selectRange) {
      return simulate(bridge, isRoot, direction, initial, anchor).bind(function (info) {
        return detect$6(container, isRoot, info.start, info.finish, selectRange);
      });
    };

    var value$1 = function () {
      var subject = Cell(Optional.none());
      var clear = function () {
        return subject.set(Optional.none());
      };
      var set = function (s) {
        return subject.set(Optional.some(s));
      };
      var isSet = function () {
        return subject.get().isSome();
      };
      var on = function (f) {
        return subject.get().each(f);
      };
      return {
        clear: clear,
        set: set,
        isSet: isSet,
        on: on
      };
    };

    var findCell = function (target, isRoot) {
      return closest$1(target, 'td,th', isRoot);
    };
    var MouseSelection = function (bridge, container, isRoot, annotations) {
      var cursor = value$1();
      var clearstate = cursor.clear;
      var applySelection = function (event) {
        cursor.on(function (start) {
          annotations.clearBeforeUpdate(container);
          findCell(event.target, isRoot).each(function (finish) {
            identify(start, finish, isRoot).each(function (cellSel) {
              var boxes = cellSel.boxes.getOr([]);
              if (boxes.length > 1 || boxes.length === 1 && !eq$1(start, finish)) {
                annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);
                bridge.selectContents(finish);
              }
            });
          });
        });
      };
      var mousedown = function (event) {
        annotations.clear(container);
        findCell(event.target, isRoot).each(cursor.set);
      };
      var mouseover = function (event) {
        applySelection(event);
      };
      var mouseup = function (event) {
        applySelection(event);
        clearstate();
      };
      return {
        clearstate: clearstate,
        mousedown: mousedown,
        mouseover: mouseover,
        mouseup: mouseup
      };
    };

    var down = {
      traverse: nextSibling,
      gather: after$5,
      relative: Situ.before,
      otherRetry: Retries.tryDown,
      ieRetry: Retries.ieTryDown,
      failure: BeforeAfter.failedDown
    };
    var up = {
      traverse: prevSibling,
      gather: before$4,
      relative: Situ.before,
      otherRetry: Retries.tryUp,
      ieRetry: Retries.ieTryUp,
      failure: BeforeAfter.failedUp
    };

    var isKey = function (key) {
      return function (keycode) {
        return keycode === key;
      };
    };
    var isUp = isKey(38);
    var isDown = isKey(40);
    var isNavigation = function (keycode) {
      return keycode >= 37 && keycode <= 40;
    };
    var ltr$2 = {
      isBackward: isKey(37),
      isForward: isKey(39)
    };
    var rtl$2 = {
      isBackward: isKey(39),
      isForward: isKey(37)
    };

    var get$d = function (_DOC) {
      var doc = _DOC !== undefined ? _DOC.dom : document;
      var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;
      var y = doc.body.scrollTop || doc.documentElement.scrollTop;
      return SugarPosition(x, y);
    };
    var by = function (x, y, _DOC) {
      var doc = _DOC !== undefined ? _DOC.dom : document;
      var win = doc.defaultView;
      if (win) {
        win.scrollBy(x, y);
      }
    };

    var WindowBridge = function (win) {
      var elementFromPoint = function (x, y) {
        return SugarElement.fromPoint(SugarElement.fromDom(win.document), x, y);
      };
      var getRect = function (element) {
        return element.dom.getBoundingClientRect();
      };
      var getRangedRect = function (start, soffset, finish, foffset) {
        var sel = SimSelection.exact(start, soffset, finish, foffset);
        return getFirstRect$1(win, sel);
      };
      var getSelection = function () {
        return get$c(win).map(function (exactAdt) {
          return convertToRange(win, exactAdt);
        });
      };
      var fromSitus = function (situs) {
        var relative = SimSelection.relative(situs.start, situs.finish);
        return convertToRange(win, relative);
      };
      var situsFromPoint = function (x, y) {
        return getAtPoint(win, x, y).map(function (exact) {
          return Situs.create(exact.start, exact.soffset, exact.finish, exact.foffset);
        });
      };
      var clearSelection = function () {
        clear(win);
      };
      var collapseSelection = function (toStart) {
        if (toStart === void 0) {
          toStart = false;
        }
        get$c(win).each(function (sel) {
          return sel.fold(function (rng) {
            return rng.collapse(toStart);
          }, function (startSitu, finishSitu) {
            var situ = toStart ? startSitu : finishSitu;
            setRelative(win, situ, situ);
          }, function (start, soffset, finish, foffset) {
            var node = toStart ? start : finish;
            var offset = toStart ? soffset : foffset;
            setExact(win, node, offset, node, offset);
          });
        });
      };
      var selectContents = function (element) {
        setToElement(win, element);
      };
      var setSelection = function (sel) {
        setExact(win, sel.start, sel.soffset, sel.finish, sel.foffset);
      };
      var setRelativeSelection = function (start, finish) {
        setRelative(win, start, finish);
      };
      var getInnerHeight = function () {
        return win.innerHeight;
      };
      var getScrollY = function () {
        var pos = get$d(SugarElement.fromDom(win.document));
        return pos.top;
      };
      var scrollBy = function (x, y) {
        by(x, y, SugarElement.fromDom(win.document));
      };
      return {
        elementFromPoint: elementFromPoint,
        getRect: getRect,
        getRangedRect: getRangedRect,
        getSelection: getSelection,
        fromSitus: fromSitus,
        situsFromPoint: situsFromPoint,
        clearSelection: clearSelection,
        collapseSelection: collapseSelection,
        setSelection: setSelection,
        setRelativeSelection: setRelativeSelection,
        selectContents: selectContents,
        getInnerHeight: getInnerHeight,
        getScrollY: getScrollY,
        scrollBy: scrollBy
      };
    };

    var rc = function (rows, cols) {
      return {
        rows: rows,
        cols: cols
      };
    };
    var mouse = function (win, container, isRoot, annotations) {
      var bridge = WindowBridge(win);
      var handlers = MouseSelection(bridge, container, isRoot, annotations);
      return {
        clearstate: handlers.clearstate,
        mousedown: handlers.mousedown,
        mouseover: handlers.mouseover,
        mouseup: handlers.mouseup
      };
    };
    var keyboard = function (win, container, isRoot, annotations) {
      var bridge = WindowBridge(win);
      var clearToNavigate = function () {
        annotations.clear(container);
        return Optional.none();
      };
      var keydown = function (event, start, soffset, finish, foffset, direction) {
        var realEvent = event.raw;
        var keycode = realEvent.which;
        var shiftKey = realEvent.shiftKey === true;
        var handler = retrieve(container, annotations.selectedSelector).fold(function () {
          if (isDown(keycode) && shiftKey) {
            return curry(select, bridge, container, isRoot, down, finish, start, annotations.selectRange);
          } else if (isUp(keycode) && shiftKey) {
            return curry(select, bridge, container, isRoot, up, finish, start, annotations.selectRange);
          } else if (isDown(keycode)) {
            return curry(navigate, bridge, isRoot, down, finish, start, lastDownCheck);
          } else if (isUp(keycode)) {
            return curry(navigate, bridge, isRoot, up, finish, start, firstUpCheck);
          } else {
            return Optional.none;
          }
        }, function (selected) {
          var update$1 = function (attempts) {
            return function () {
              var navigation = findMap(attempts, function (delta) {
                return update(delta.rows, delta.cols, container, selected, annotations);
              });
              return navigation.fold(function () {
                return getEdges(container, annotations.firstSelectedSelector, annotations.lastSelectedSelector).map(function (edges) {
                  var relative = isDown(keycode) || direction.isForward(keycode) ? Situ.after : Situ.before;
                  bridge.setRelativeSelection(Situ.on(edges.first, 0), relative(edges.table));
                  annotations.clear(container);
                  return Response.create(Optional.none(), true);
                });
              }, function (_) {
                return Optional.some(Response.create(Optional.none(), true));
              });
            };
          };
          if (isDown(keycode) && shiftKey) {
            return update$1([rc(+1, 0)]);
          } else if (isUp(keycode) && shiftKey) {
            return update$1([rc(-1, 0)]);
          } else if (direction.isBackward(keycode) && shiftKey) {
            return update$1([
              rc(0, -1),
              rc(-1, 0)
            ]);
          } else if (direction.isForward(keycode) && shiftKey) {
            return update$1([
              rc(0, +1),
              rc(+1, 0)
            ]);
          } else if (isNavigation(keycode) && shiftKey === false) {
            return clearToNavigate;
          } else {
            return Optional.none;
          }
        });
        return handler();
      };
      var keyup = function (event, start, soffset, finish, foffset) {
        return retrieve(container, annotations.selectedSelector).fold(function () {
          var realEvent = event.raw;
          var keycode = realEvent.which;
          var shiftKey = realEvent.shiftKey === true;
          if (shiftKey === false) {
            return Optional.none();
          }
          if (isNavigation(keycode)) {
            return sync(container, isRoot, start, soffset, finish, foffset, annotations.selectRange);
          } else {
            return Optional.none();
          }
        }, Optional.none);
      };
      return {
        keydown: keydown,
        keyup: keyup
      };
    };
    var external = function (win, container, isRoot, annotations) {
      var bridge = WindowBridge(win);
      return function (start, finish) {
        annotations.clearBeforeUpdate(container);
        identify(start, finish, isRoot).each(function (cellSel) {
          var boxes = cellSel.boxes.getOr([]);
          annotations.selectRange(container, boxes, cellSel.start, cellSel.finish);
          bridge.selectContents(finish);
          bridge.collapseSelection();
        });
      };
    };

    var remove$7 = function (element, classes) {
      each(classes, function (x) {
        remove$5(element, x);
      });
    };

    var addClass = function (clazz) {
      return function (element) {
        add$3(element, clazz);
      };
    };
    var removeClasses = function (classes) {
      return function (element) {
        remove$7(element, classes);
      };
    };

    var byClass = function (ephemera) {
      var addSelectionClass = addClass(ephemera.selected);
      var removeSelectionClasses = removeClasses([
        ephemera.selected,
        ephemera.lastSelected,
        ephemera.firstSelected
      ]);
      var clear = function (container) {
        var sels = descendants$1(container, ephemera.selectedSelector);
        each(sels, removeSelectionClasses);
      };
      var selectRange = function (container, cells, start, finish) {
        clear(container);
        each(cells, addSelectionClass);
        add$3(start, ephemera.firstSelected);
        add$3(finish, ephemera.lastSelected);
      };
      return {
        clearBeforeUpdate: clear,
        clear: clear,
        selectRange: selectRange,
        selectedSelector: ephemera.selectedSelector,
        firstSelectedSelector: ephemera.firstSelectedSelector,
        lastSelectedSelector: ephemera.lastSelectedSelector
      };
    };
    var byAttr = function (ephemera, onSelection, onClear) {
      var removeSelectionAttributes = function (element) {
        remove(element, ephemera.selected);
        remove(element, ephemera.firstSelected);
        remove(element, ephemera.lastSelected);
      };
      var addSelectionAttribute = function (element) {
        set(element, ephemera.selected, '1');
      };
      var clear = function (container) {
        clearBeforeUpdate(container);
        onClear();
      };
      var clearBeforeUpdate = function (container) {
        var sels = descendants$1(container, ephemera.selectedSelector);
        each(sels, removeSelectionAttributes);
      };
      var selectRange = function (container, cells, start, finish) {
        clear(container);
        each(cells, addSelectionAttribute);
        set(start, ephemera.firstSelected, '1');
        set(finish, ephemera.lastSelected, '1');
        onSelection(cells, start, finish);
      };
      return {
        clearBeforeUpdate: clearBeforeUpdate,
        clear: clear,
        selectRange: selectRange,
        selectedSelector: ephemera.selectedSelector,
        firstSelectedSelector: ephemera.firstSelectedSelector,
        lastSelectedSelector: ephemera.lastSelectedSelector
      };
    };
    var SelectionAnnotation = {
      byClass: byClass,
      byAttr: byAttr
    };

    var getUpOrLeftCells = function (grid, selectedCells, generators) {
      var upGrid = grid.slice(0, selectedCells[selectedCells.length - 1].row + 1);
      var upDetails = toDetailList(upGrid, generators);
      return bind(upDetails, function (detail) {
        var slicedCells = detail.cells.slice(0, selectedCells[selectedCells.length - 1].column + 1);
        return map(slicedCells, function (cell) {
          return cell.element;
        });
      });
    };
    var getDownOrRightCells = function (grid, selectedCells, generators) {
      var downGrid = grid.slice(selectedCells[0].row + selectedCells[0].rowspan - 1, grid.length);
      var downDetails = toDetailList(downGrid, generators);
      return bind(downDetails, function (detail) {
        var slicedCells = detail.cells.slice(selectedCells[0].column + selectedCells[0].colspan - 1, detail.cells.length);
        return map(slicedCells, function (cell) {
          return cell.element;
        });
      });
    };
    var getOtherCells = function (table, target, generators) {
      var warehouse = Warehouse.fromTable(table);
      var details = onCells(warehouse, target);
      return details.map(function (selectedCells) {
        var grid = toGrid(warehouse, generators, false);
        var upOrLeftCells = getUpOrLeftCells(grid, selectedCells, generators);
        var downOrRightCells = getDownOrRightCells(grid, selectedCells, generators);
        return {
          upOrLeftCells: upOrLeftCells,
          downOrRightCells: downOrRightCells
        };
      });
    };

    var hasInternalTarget = function (e) {
      return has$1(SugarElement.fromDom(e.target), 'ephox-snooker-resizer-bar') === false;
    };
    function CellSelection (editor, lazyResize, selectionTargets) {
      var onSelection = function (cells, start, finish) {
        selectionTargets.targets().each(function (targets) {
          var tableOpt = table(start);
          tableOpt.each(function (table) {
            var cloneFormats = getCloneElements(editor);
            var generators = cellOperations(noop, SugarElement.fromDom(editor.getDoc()), cloneFormats);
            var otherCells = getOtherCells(table, targets, generators);
            fireTableSelectionChange(editor, cells, start, finish, otherCells);
          });
        });
      };
      var onClear = function () {
        return fireTableSelectionClear(editor);
      };
      var annotations = SelectionAnnotation.byAttr(ephemera, onSelection, onClear);
      editor.on('init', function (_e) {
        var win = editor.getWin();
        var body = getBody$1(editor);
        var isRoot = getIsRoot(editor);
        var syncSelection = function () {
          var sel = editor.selection;
          var start = SugarElement.fromDom(sel.getStart());
          var end = SugarElement.fromDom(sel.getEnd());
          var shared = sharedOne$1(table, [
            start,
            end
          ]);
          shared.fold(function () {
            return annotations.clear(body);
          }, noop);
        };
        var mouseHandlers = mouse(win, body, isRoot, annotations);
        var keyHandlers = keyboard(win, body, isRoot, annotations);
        var external$1 = external(win, body, isRoot, annotations);
        var hasShiftKey = function (event) {
          return event.raw.shiftKey === true;
        };
        editor.on('TableSelectorChange', function (e) {
          return external$1(e.start, e.finish);
        });
        var handleResponse = function (event, response) {
          if (!hasShiftKey(event)) {
            return;
          }
          if (response.kill) {
            event.kill();
          }
          response.selection.each(function (ns) {
            var relative = SimSelection.relative(ns.start, ns.finish);
            var rng = asLtrRange(win, relative);
            editor.selection.setRng(rng);
          });
        };
        var keyup = function (event) {
          var wrappedEvent = fromRawEvent$1(event);
          if (wrappedEvent.raw.shiftKey && isNavigation(wrappedEvent.raw.which)) {
            var rng = editor.selection.getRng();
            var start = SugarElement.fromDom(rng.startContainer);
            var end = SugarElement.fromDom(rng.endContainer);
            keyHandlers.keyup(wrappedEvent, start, rng.startOffset, end, rng.endOffset).each(function (response) {
              handleResponse(wrappedEvent, response);
            });
          }
        };
        var keydown = function (event) {
          var wrappedEvent = fromRawEvent$1(event);
          lazyResize().each(function (resize) {
            return resize.hideBars();
          });
          var rng = editor.selection.getRng();
          var start = SugarElement.fromDom(rng.startContainer);
          var end = SugarElement.fromDom(rng.endContainer);
          var direction = onDirection(ltr$2, rtl$2)(SugarElement.fromDom(editor.selection.getStart()));
          keyHandlers.keydown(wrappedEvent, start, rng.startOffset, end, rng.endOffset, direction).each(function (response) {
            handleResponse(wrappedEvent, response);
          });
          lazyResize().each(function (resize) {
            return resize.showBars();
          });
        };
        var isLeftMouse = function (raw) {
          return raw.button === 0;
        };
        var isLeftButtonPressed = function (raw) {
          if (raw.buttons === undefined) {
            return true;
          }
          if (global$2.browser.isEdge() && raw.buttons === 0) {
            return true;
          }
          return (raw.buttons & 1) !== 0;
        };
        var dragStart = function (_e) {
          mouseHandlers.clearstate();
        };
        var mouseDown = function (e) {
          if (isLeftMouse(e) && hasInternalTarget(e)) {
            mouseHandlers.mousedown(fromRawEvent$1(e));
          }
        };
        var mouseOver = function (e) {
          if (isLeftButtonPressed(e) && hasInternalTarget(e)) {
            mouseHandlers.mouseover(fromRawEvent$1(e));
          }
        };
        var mouseUp = function (e) {
          if (isLeftMouse(e) && hasInternalTarget(e)) {
            mouseHandlers.mouseup(fromRawEvent$1(e));
          }
        };
        var getDoubleTap = function () {
          var lastTarget = Cell(SugarElement.fromDom(body));
          var lastTimeStamp = Cell(0);
          var touchEnd = function (t) {
            var target = SugarElement.fromDom(t.target);
            if (name(target) === 'td' || name(target) === 'th') {
              var lT = lastTarget.get();
              var lTS = lastTimeStamp.get();
              if (eq$1(lT, target) && t.timeStamp - lTS < 300) {
                t.preventDefault();
                external$1(target, target);
              }
            }
            lastTarget.set(target);
            lastTimeStamp.set(t.timeStamp);
          };
          return { touchEnd: touchEnd };
        };
        var doubleTap = getDoubleTap();
        editor.on('dragstart', dragStart);
        editor.on('mousedown', mouseDown);
        editor.on('mouseover', mouseOver);
        editor.on('mouseup', mouseUp);
        editor.on('touchend', doubleTap.touchEnd);
        editor.on('keyup', keyup);
        editor.on('keydown', keydown);
        editor.on('NodeChange', syncSelection);
      });
      return { clear: annotations.clear };
    }

    var getSelectionTargets = function (editor, selections) {
      var targets = Cell(Optional.none());
      var changeHandlers = Cell([]);
      var selectionDetails = Optional.none();
      var isCaption = isTag('caption');
      var isDisabledForSelection = function (key) {
        return selectionDetails.forall(function (details) {
          return !details[key];
        });
      };
      var findTargets = function () {
        return getSelectionStartCellOrCaption(getSelectionStart(editor), getIsRoot(editor)).bind(function (cellOrCaption) {
          var table$1 = table(cellOrCaption);
          return table$1.map(function (table) {
            if (isCaption(cellOrCaption)) {
              return noMenu(cellOrCaption);
            } else {
              return forMenu(selections, table, cellOrCaption);
            }
          });
        });
      };
      var getExtractedDetails = function (targets) {
        var tableOpt = table(targets.element);
        return tableOpt.map(function (table) {
          var warehouse = Warehouse.fromTable(table);
          var selectedCells = onCells(warehouse, targets).getOr([]);
          var locked = foldl(selectedCells, function (acc, cell) {
            if (cell.isLocked) {
              acc.onAny = true;
              if (cell.column === 0) {
                acc.onFirst = true;
              } else if (cell.column + cell.colspan >= warehouse.grid.columns) {
                acc.onLast = true;
              }
            }
            return acc;
          }, {
            onAny: false,
            onFirst: false,
            onLast: false
          });
          return {
            mergeable: onUnlockedMergable(warehouse, targets).isSome(),
            unmergeable: onUnlockedUnmergable(warehouse, targets).isSome(),
            locked: locked
          };
        });
      };
      var resetTargets = function () {
        targets.set(cached(findTargets)());
        selectionDetails = targets.get().bind(getExtractedDetails);
        each(changeHandlers.get(), function (handler) {
          return handler();
        });
      };
      var onSetup = function (api, isDisabled) {
        var handler = function () {
          return targets.get().fold(function () {
            api.setDisabled(true);
          }, function (targets) {
            api.setDisabled(isDisabled(targets));
          });
        };
        handler();
        changeHandlers.set(changeHandlers.get().concat([handler]));
        return function () {
          changeHandlers.set(filter(changeHandlers.get(), function (h) {
            return h !== handler;
          }));
        };
      };
      var isDisabledFromLocked = function (lockedDisable) {
        return selectionDetails.exists(function (details) {
          return details.locked[lockedDisable];
        });
      };
      var onSetupTable = function (api) {
        return onSetup(api, function (_) {
          return false;
        });
      };
      var onSetupCellOrRow = function (api) {
        return onSetup(api, function (targets) {
          return isCaption(targets.element);
        });
      };
      var onSetupColumn = function (lockedDisable) {
        return function (api) {
          return onSetup(api, function (targets) {
            return isCaption(targets.element) || isDisabledFromLocked(lockedDisable);
          });
        };
      };
      var onSetupPasteable = function (getClipboardData) {
        return function (api) {
          return onSetup(api, function (targets) {
            return isCaption(targets.element) || getClipboardData().isNone();
          });
        };
      };
      var onSetupPasteableColumn = function (getClipboardData, lockedDisable) {
        return function (api) {
          return onSetup(api, function (targets) {
            return isCaption(targets.element) || getClipboardData().isNone() || isDisabledFromLocked(lockedDisable);
          });
        };
      };
      var onSetupMergeable = function (api) {
        return onSetup(api, function (_targets) {
          return isDisabledForSelection('mergeable');
        });
      };
      var onSetupUnmergeable = function (api) {
        return onSetup(api, function (_targets) {
          return isDisabledForSelection('unmergeable');
        });
      };
      editor.on('NodeChange ExecCommand TableSelectorChange', resetTargets);
      return {
        onSetupTable: onSetupTable,
        onSetupCellOrRow: onSetupCellOrRow,
        onSetupColumn: onSetupColumn,
        onSetupPasteable: onSetupPasteable,
        onSetupPasteableColumn: onSetupPasteableColumn,
        onSetupMergeable: onSetupMergeable,
        onSetupUnmergeable: onSetupUnmergeable,
        resetTargets: resetTargets,
        targets: function () {
          return targets.get();
        }
      };
    };

    var addButtons = function (editor, selectionTargets, clipboard) {
      editor.ui.registry.addMenuButton('table', {
        tooltip: 'Table',
        icon: 'table',
        fetch: function (callback) {
          return callback('inserttable | cell row column | advtablesort | tableprops deletetable');
        }
      });
      var cmd = function (command) {
        return function () {
          return editor.execCommand(command);
        };
      };
      editor.ui.registry.addButton('tableprops', {
        tooltip: 'Table properties',
        onAction: cmd('mceTableProps'),
        icon: 'table',
        onSetup: selectionTargets.onSetupTable
      });
      editor.ui.registry.addButton('tabledelete', {
        tooltip: 'Delete table',
        onAction: cmd('mceTableDelete'),
        icon: 'table-delete-table',
        onSetup: selectionTargets.onSetupTable
      });
      editor.ui.registry.addButton('tablecellprops', {
        tooltip: 'Cell properties',
        onAction: cmd('mceTableCellProps'),
        icon: 'table-cell-properties',
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tablemergecells', {
        tooltip: 'Merge cells',
        onAction: cmd('mceTableMergeCells'),
        icon: 'table-merge-cells',
        onSetup: selectionTargets.onSetupMergeable
      });
      editor.ui.registry.addButton('tablesplitcells', {
        tooltip: 'Split cell',
        onAction: cmd('mceTableSplitCells'),
        icon: 'table-split-cells',
        onSetup: selectionTargets.onSetupUnmergeable
      });
      editor.ui.registry.addButton('tableinsertrowbefore', {
        tooltip: 'Insert row before',
        onAction: cmd('mceTableInsertRowBefore'),
        icon: 'table-insert-row-above',
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tableinsertrowafter', {
        tooltip: 'Insert row after',
        onAction: cmd('mceTableInsertRowAfter'),
        icon: 'table-insert-row-after',
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tabledeleterow', {
        tooltip: 'Delete row',
        onAction: cmd('mceTableDeleteRow'),
        icon: 'table-delete-row',
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tablerowprops', {
        tooltip: 'Row properties',
        onAction: cmd('mceTableRowProps'),
        icon: 'table-row-properties',
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tableinsertcolbefore', {
        tooltip: 'Insert column before',
        onAction: cmd('mceTableInsertColBefore'),
        icon: 'table-insert-column-before',
        onSetup: selectionTargets.onSetupColumn('onFirst')
      });
      editor.ui.registry.addButton('tableinsertcolafter', {
        tooltip: 'Insert column after',
        onAction: cmd('mceTableInsertColAfter'),
        icon: 'table-insert-column-after',
        onSetup: selectionTargets.onSetupColumn('onLast')
      });
      editor.ui.registry.addButton('tabledeletecol', {
        tooltip: 'Delete column',
        onAction: cmd('mceTableDeleteCol'),
        icon: 'table-delete-column',
        onSetup: selectionTargets.onSetupColumn('onAny')
      });
      editor.ui.registry.addButton('tablecutrow', {
        tooltip: 'Cut row',
        icon: 'cut-row',
        onAction: cmd('mceTableCutRow'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tablecopyrow', {
        tooltip: 'Copy row',
        icon: 'duplicate-row',
        onAction: cmd('mceTableCopyRow'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addButton('tablepasterowbefore', {
        tooltip: 'Paste row before',
        icon: 'paste-row-before',
        onAction: cmd('mceTablePasteRowBefore'),
        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)
      });
      editor.ui.registry.addButton('tablepasterowafter', {
        tooltip: 'Paste row after',
        icon: 'paste-row-after',
        onAction: cmd('mceTablePasteRowAfter'),
        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)
      });
      editor.ui.registry.addButton('tablecutcol', {
        tooltip: 'Cut column',
        icon: 'cut-column',
        onAction: cmd('mceTableCutCol'),
        onSetup: selectionTargets.onSetupColumn('onAny')
      });
      editor.ui.registry.addButton('tablecopycol', {
        tooltip: 'Copy column',
        icon: 'duplicate-column',
        onAction: cmd('mceTableCopyCol'),
        onSetup: selectionTargets.onSetupColumn('onAny')
      });
      editor.ui.registry.addButton('tablepastecolbefore', {
        tooltip: 'Paste column before',
        icon: 'paste-column-before',
        onAction: cmd('mceTablePasteColBefore'),
        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')
      });
      editor.ui.registry.addButton('tablepastecolafter', {
        tooltip: 'Paste column after',
        icon: 'paste-column-after',
        onAction: cmd('mceTablePasteColAfter'),
        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')
      });
      editor.ui.registry.addButton('tableinsertdialog', {
        tooltip: 'Insert table',
        onAction: cmd('mceInsertTable'),
        icon: 'table'
      });
    };
    var addToolbars = function (editor) {
      var isTable = function (table) {
        return editor.dom.is(table, 'table') && editor.getBody().contains(table);
      };
      var toolbar = getToolbar(editor);
      if (toolbar.length > 0) {
        editor.ui.registry.addContextToolbar('table', {
          predicate: isTable,
          items: toolbar,
          scope: 'node',
          position: 'node'
        });
      }
    };

    var addMenuItems = function (editor, selectionTargets, clipboard) {
      var cmd = function (command) {
        return function () {
          return editor.execCommand(command);
        };
      };
      var insertTableAction = function (data) {
        editor.execCommand('mceInsertTable', false, {
          rows: data.numRows,
          columns: data.numColumns
        });
      };
      var tableProperties = {
        text: 'Table properties',
        onSetup: selectionTargets.onSetupTable,
        onAction: cmd('mceTableProps')
      };
      var deleteTable = {
        text: 'Delete table',
        icon: 'table-delete-table',
        onSetup: selectionTargets.onSetupTable,
        onAction: cmd('mceTableDelete')
      };
      editor.ui.registry.addMenuItem('tableinsertrowbefore', {
        text: 'Insert row before',
        icon: 'table-insert-row-above',
        onAction: cmd('mceTableInsertRowBefore'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tableinsertrowafter', {
        text: 'Insert row after',
        icon: 'table-insert-row-after',
        onAction: cmd('mceTableInsertRowAfter'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tabledeleterow', {
        text: 'Delete row',
        icon: 'table-delete-row',
        onAction: cmd('mceTableDeleteRow'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tablerowprops', {
        text: 'Row properties',
        icon: 'table-row-properties',
        onAction: cmd('mceTableRowProps'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tablecutrow', {
        text: 'Cut row',
        icon: 'cut-row',
        onAction: cmd('mceTableCutRow'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tablecopyrow', {
        text: 'Copy row',
        icon: 'duplicate-row',
        onAction: cmd('mceTableCopyRow'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tablepasterowbefore', {
        text: 'Paste row before',
        icon: 'paste-row-before',
        onAction: cmd('mceTablePasteRowBefore'),
        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)
      });
      editor.ui.registry.addMenuItem('tablepasterowafter', {
        text: 'Paste row after',
        icon: 'paste-row-after',
        onAction: cmd('mceTablePasteRowAfter'),
        onSetup: selectionTargets.onSetupPasteable(clipboard.getRows)
      });
      var row = {
        type: 'nestedmenuitem',
        text: 'Row',
        getSubmenuItems: function () {
          return 'tableinsertrowbefore tableinsertrowafter tabledeleterow tablerowprops | tablecutrow tablecopyrow tablepasterowbefore tablepasterowafter';
        }
      };
      editor.ui.registry.addMenuItem('tableinsertcolumnbefore', {
        text: 'Insert column before',
        icon: 'table-insert-column-before',
        onAction: cmd('mceTableInsertColBefore'),
        onSetup: selectionTargets.onSetupColumn('onFirst')
      });
      editor.ui.registry.addMenuItem('tableinsertcolumnafter', {
        text: 'Insert column after',
        icon: 'table-insert-column-after',
        onAction: cmd('mceTableInsertColAfter'),
        onSetup: selectionTargets.onSetupColumn('onLast')
      });
      editor.ui.registry.addMenuItem('tabledeletecolumn', {
        text: 'Delete column',
        icon: 'table-delete-column',
        onAction: cmd('mceTableDeleteCol'),
        onSetup: selectionTargets.onSetupColumn('onAny')
      });
      editor.ui.registry.addMenuItem('tablecutcolumn', {
        text: 'Cut column',
        icon: 'cut-column',
        onAction: cmd('mceTableCutCol'),
        onSetup: selectionTargets.onSetupColumn('onAny')
      });
      editor.ui.registry.addMenuItem('tablecopycolumn', {
        text: 'Copy column',
        icon: 'duplicate-column',
        onAction: cmd('mceTableCopyCol'),
        onSetup: selectionTargets.onSetupColumn('onAny')
      });
      editor.ui.registry.addMenuItem('tablepastecolumnbefore', {
        text: 'Paste column before',
        icon: 'paste-column-before',
        onAction: cmd('mceTablePasteColBefore'),
        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onFirst')
      });
      editor.ui.registry.addMenuItem('tablepastecolumnafter', {
        text: 'Paste column after',
        icon: 'paste-column-after',
        onAction: cmd('mceTablePasteColAfter'),
        onSetup: selectionTargets.onSetupPasteableColumn(clipboard.getColumns, 'onLast')
      });
      var column = {
        type: 'nestedmenuitem',
        text: 'Column',
        getSubmenuItems: function () {
          return 'tableinsertcolumnbefore tableinsertcolumnafter tabledeletecolumn | tablecutcolumn tablecopycolumn tablepastecolumnbefore tablepastecolumnafter';
        }
      };
      editor.ui.registry.addMenuItem('tablecellprops', {
        text: 'Cell properties',
        icon: 'table-cell-properties',
        onAction: cmd('mceTableCellProps'),
        onSetup: selectionTargets.onSetupCellOrRow
      });
      editor.ui.registry.addMenuItem('tablemergecells', {
        text: 'Merge cells',
        icon: 'table-merge-cells',
        onAction: cmd('mceTableMergeCells'),
        onSetup: selectionTargets.onSetupMergeable
      });
      editor.ui.registry.addMenuItem('tablesplitcells', {
        text: 'Split cell',
        icon: 'table-split-cells',
        onAction: cmd('mceTableSplitCells'),
        onSetup: selectionTargets.onSetupUnmergeable
      });
      var cell = {
        type: 'nestedmenuitem',
        text: 'Cell',
        getSubmenuItems: function () {
          return 'tablecellprops tablemergecells tablesplitcells';
        }
      };
      if (hasTableGrid(editor) === false) {
        editor.ui.registry.addMenuItem('inserttable', {
          text: 'Table',
          icon: 'table',
          onAction: cmd('mceInsertTable')
        });
      } else {
        editor.ui.registry.addNestedMenuItem('inserttable', {
          text: 'Table',
          icon: 'table',
          getSubmenuItems: function () {
            return [{
                type: 'fancymenuitem',
                fancytype: 'inserttable',
                onAction: insertTableAction
              }];
          }
        });
      }
      editor.ui.registry.addMenuItem('inserttabledialog', {
        text: 'Insert table',
        icon: 'table',
        onAction: cmd('mceInsertTable')
      });
      editor.ui.registry.addMenuItem('tableprops', tableProperties);
      editor.ui.registry.addMenuItem('deletetable', deleteTable);
      editor.ui.registry.addNestedMenuItem('row', row);
      editor.ui.registry.addNestedMenuItem('column', column);
      editor.ui.registry.addNestedMenuItem('cell', cell);
      editor.ui.registry.addContextMenu('table', {
        update: function () {
          selectionTargets.resetTargets();
          return selectionTargets.targets().fold(function () {
            return '';
          }, function (targets) {
            if (name(targets.element) === 'caption') {
              return 'tableprops deletetable';
            } else {
              return 'cell row column | advtablesort | tableprops deletetable';
            }
          });
        }
      });
    };

    var Plugin = function (editor) {
      var selections = Selections(function () {
        return getBody$1(editor);
      }, function () {
        return getSelectionStartCellOrCaption(getSelectionStart(editor));
      }, ephemera.selectedSelector);
      var selectionTargets = getSelectionTargets(editor, selections);
      var resizeHandler = getResizeHandler(editor);
      var cellSelection = CellSelection(editor, resizeHandler.lazyResize, selectionTargets);
      var actions = TableActions(editor, resizeHandler.lazyWire, selections);
      var clipboard = Clipboard();
      registerCommands(editor, actions, cellSelection, selections, clipboard);
      registerQueryCommands(editor, actions, selections);
      registerEvents(editor, selections, actions, cellSelection);
      addMenuItems(editor, selectionTargets, clipboard);
      addButtons(editor, selectionTargets, clipboard);
      addToolbars(editor);
      editor.on('PreInit', function () {
        editor.serializer.addTempAttr(ephemera.firstSelected);
        editor.serializer.addTempAttr(ephemera.lastSelected);
        registerFormats(editor);
      });
      if (hasTabNavigation(editor)) {
        editor.on('keydown', function (e) {
          handle$1(e, editor, cellSelection);
        });
      }
      editor.on('remove', function () {
        resizeHandler.destroy();
      });
      return getApi(editor, clipboard, resizeHandler, selectionTargets);
    };
    function Plugin$1 () {
      global.add('table', Plugin);
    }

    Plugin$1();

}());


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfdGlueW1jZV9wbHVnaW5zX3RhYmxlX2luZGV4X2pzLmNodW5rLmpzIiwic291cmNlcyI6WyIvVXNlcnMvbGl1eWFuZy9wcm9qZWN0cy9yaW5ndG9uZV9uZXcvbm9kZV9tb2R1bGVzL3RpbnltY2UvcGx1Z2lucy90YWJsZS9pbmRleC5qcyIsIi9Vc2Vycy9saXV5YW5nL3Byb2plY3RzL3Jpbmd0b25lX25ldy9ub2RlX21vZHVsZXMvdGlueW1jZS9wbHVnaW5zL3RhYmxlL3BsdWdpbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFeHBvcnRzIHRoZSBcInRhYmxlXCIgcGx1Z2luIGZvciB1c2FnZSB3aXRoIG1vZHVsZSBsb2FkZXJzXG4vLyBVc2FnZTpcbi8vICAgQ29tbW9uSlM6XG4vLyAgICAgcmVxdWlyZSgndGlueW1jZS9wbHVnaW5zL3RhYmxlJylcbi8vICAgRVMyMDE1OlxuLy8gICAgIGltcG9ydCAndGlueW1jZS9wbHVnaW5zL3RhYmxlJ1xucmVxdWlyZSgnLi9wbHVnaW4uanMnKTsiLCIvKipcbiAqIENvcHlyaWdodCAoYykgVGlueSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLlxuICogRm9yIExHUEwgc2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKiBGb3IgY29tbWVyY2lhbCBsaWNlbnNlcyBzZWUgaHR0cHM6Ly93d3cudGlueS5jbG91ZC9cbiAqXG4gKiBWZXJzaW9uOiA1LjguMSAoMjAyMS0wNS0yMClcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgdHlwZU9mID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIHZhciB0ID0gdHlwZW9mIHg7XG4gICAgICBpZiAoeCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gJ251bGwnO1xuICAgICAgfSBlbHNlIGlmICh0ID09PSAnb2JqZWN0JyAmJiAoQXJyYXkucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoeCkgfHwgeC5jb25zdHJ1Y3RvciAmJiB4LmNvbnN0cnVjdG9yLm5hbWUgPT09ICdBcnJheScpKSB7XG4gICAgICAgIHJldHVybiAnYXJyYXknO1xuICAgICAgfSBlbHNlIGlmICh0ID09PSAnb2JqZWN0JyAmJiAoU3RyaW5nLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKHgpIHx8IHguY29uc3RydWN0b3IgJiYgeC5jb25zdHJ1Y3Rvci5uYW1lID09PSAnU3RyaW5nJykpIHtcbiAgICAgICAgcmV0dXJuICdzdHJpbmcnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaXNUeXBlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVPZih2YWx1ZSkgPT09IHR5cGU7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzU2ltcGxlVHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09IHR5cGU7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGVxID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkge1xuICAgICAgICByZXR1cm4gdCA9PT0gYTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaXNTdHJpbmcgPSBpc1R5cGUoJ3N0cmluZycpO1xuICAgIHZhciBpc09iamVjdCA9IGlzVHlwZSgnb2JqZWN0Jyk7XG4gICAgdmFyIGlzQXJyYXkgPSBpc1R5cGUoJ2FycmF5Jyk7XG4gICAgdmFyIGlzQm9vbGVhbiA9IGlzU2ltcGxlVHlwZSgnYm9vbGVhbicpO1xuICAgIHZhciBpc1VuZGVmaW5lZCA9IGVxKHVuZGVmaW5lZCk7XG4gICAgdmFyIGlzTnVsbGFibGUgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGEgPT09IG51bGwgfHwgYSA9PT0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdmFyIGlzTm9uTnVsbGFibGUgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuICFpc051bGxhYmxlKGEpO1xuICAgIH07XG4gICAgdmFyIGlzRnVuY3Rpb24gPSBpc1NpbXBsZVR5cGUoJ2Z1bmN0aW9uJyk7XG4gICAgdmFyIGlzTnVtYmVyID0gaXNTaW1wbGVUeXBlKCdudW1iZXInKTtcblxuICAgIHZhciBub29wID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgdmFyIGNvbXBvc2UgPSBmdW5jdGlvbiAoZmEsIGZiKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmEoZmIuYXBwbHkobnVsbCwgYXJncykpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjb21wb3NlMSA9IGZ1bmN0aW9uIChmYmMsIGZhYikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHJldHVybiBmYmMoZmFiKGEpKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29uc3RhbnQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgaWRlbnRpdHkgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIHg7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBjdXJyeShmbikge1xuICAgICAgdmFyIGluaXRpYWxBcmdzID0gW107XG4gICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBpbml0aWFsQXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXN0QXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIHJlc3RBcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFsbCA9IGluaXRpYWxBcmdzLmNvbmNhdChyZXN0QXJncyk7XG4gICAgICAgIHJldHVybiBmbi5hcHBseShudWxsLCBhbGwpO1xuICAgICAgfTtcbiAgICB9XG4gICAgdmFyIG5vdCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuICFmKHQpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkaWUgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgbmV2ZXIgPSBjb25zdGFudChmYWxzZSk7XG4gICAgdmFyIGFsd2F5cyA9IGNvbnN0YW50KHRydWUpO1xuXG4gICAgdmFyIG5vbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gTk9ORTtcbiAgICB9O1xuICAgIHZhciBOT05FID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVxID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIG8uaXNOb25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGwgPSBmdW5jdGlvbiAodGh1bmspIHtcbiAgICAgICAgcmV0dXJuIHRodW5rKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGlkID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9O1xuICAgICAgdmFyIG1lID0ge1xuICAgICAgICBmb2xkOiBmdW5jdGlvbiAobiwgX3MpIHtcbiAgICAgICAgICByZXR1cm4gbigpO1xuICAgICAgICB9LFxuICAgICAgICBpczogbmV2ZXIsXG4gICAgICAgIGlzU29tZTogbmV2ZXIsXG4gICAgICAgIGlzTm9uZTogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWQsXG4gICAgICAgIGdldE9yVGh1bms6IGNhbGwsXG4gICAgICAgIGdldE9yRGllOiBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyB8fCAnZXJyb3I6IGdldE9yRGllIGNhbGxlZCBvbiBub25lLicpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPck51bGw6IGNvbnN0YW50KG51bGwpLFxuICAgICAgICBnZXRPclVuZGVmaW5lZDogY29uc3RhbnQodW5kZWZpbmVkKSxcbiAgICAgICAgb3I6IGlkLFxuICAgICAgICBvclRodW5rOiBjYWxsLFxuICAgICAgICBtYXA6IG5vbmUsXG4gICAgICAgIGVhY2g6IG5vb3AsXG4gICAgICAgIGJpbmQ6IG5vbmUsXG4gICAgICAgIGV4aXN0czogbmV2ZXIsXG4gICAgICAgIGZvcmFsbDogYWx3YXlzLFxuICAgICAgICBmaWx0ZXI6IG5vbmUsXG4gICAgICAgIGVxdWFsczogZXEsXG4gICAgICAgIGVxdWFsc186IGVxLFxuICAgICAgICB0b0FycmF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9LFxuICAgICAgICB0b1N0cmluZzogY29uc3RhbnQoJ25vbmUoKScpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lO1xuICAgIH0oKTtcbiAgICB2YXIgc29tZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICB2YXIgY29uc3RhbnRfYSA9IGNvbnN0YW50KGEpO1xuICAgICAgdmFyIHNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtZTtcbiAgICAgIH07XG4gICAgICB2YXIgYmluZCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBtZSA9IHtcbiAgICAgICAgZm9sZDogZnVuY3Rpb24gKG4sIHMpIHtcbiAgICAgICAgICByZXR1cm4gcyhhKTtcbiAgICAgICAgfSxcbiAgICAgICAgaXM6IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IHY7XG4gICAgICAgIH0sXG4gICAgICAgIGlzU29tZTogYWx3YXlzLFxuICAgICAgICBpc05vbmU6IG5ldmVyLFxuICAgICAgICBnZXRPcjogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JEaWU6IGNvbnN0YW50X2EsXG4gICAgICAgIGdldE9yTnVsbDogY29uc3RhbnRfYSxcbiAgICAgICAgZ2V0T3JVbmRlZmluZWQ6IGNvbnN0YW50X2EsXG4gICAgICAgIG9yOiBzZWxmLFxuICAgICAgICBvclRodW5rOiBzZWxmLFxuICAgICAgICBtYXA6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgcmV0dXJuIHNvbWUoZihhKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVhY2g6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgZihhKTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZDogYmluZCxcbiAgICAgICAgZXhpc3RzOiBiaW5kLFxuICAgICAgICBmb3JhbGw6IGJpbmQsXG4gICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICByZXR1cm4gZihhKSA/IG1lIDogTk9ORTtcbiAgICAgICAgfSxcbiAgICAgICAgdG9BcnJheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbYV07XG4gICAgICAgIH0sXG4gICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICdzb21lKCcgKyBhICsgJyknO1xuICAgICAgICB9LFxuICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgcmV0dXJuIG8uaXMoYSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVxdWFsc186IGZ1bmN0aW9uIChvLCBlbGVtZW50RXEpIHtcbiAgICAgICAgICByZXR1cm4gby5mb2xkKG5ldmVyLCBmdW5jdGlvbiAoYikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRFcShhLCBiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZTtcbiAgICB9O1xuICAgIHZhciBmcm9tID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCA/IE5PTkUgOiBzb21lKHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBPcHRpb25hbCA9IHtcbiAgICAgIHNvbWU6IHNvbWUsXG4gICAgICBub25lOiBub25lLFxuICAgICAgZnJvbTogZnJvbVxuICAgIH07XG5cbiAgICB2YXIgbmF0aXZlU2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG4gICAgdmFyIG5hdGl2ZUluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZjtcbiAgICB2YXIgbmF0aXZlUHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICAgIHZhciByYXdJbmRleE9mID0gZnVuY3Rpb24gKHRzLCB0KSB7XG4gICAgICByZXR1cm4gbmF0aXZlSW5kZXhPZi5jYWxsKHRzLCB0KTtcbiAgICB9O1xuICAgIHZhciBjb250YWlucyA9IGZ1bmN0aW9uICh4cywgeCkge1xuICAgICAgcmV0dXJuIHJhd0luZGV4T2YoeHMsIHgpID4gLTE7XG4gICAgfTtcbiAgICB2YXIgZXhpc3RzID0gZnVuY3Rpb24gKHhzLCBwcmVkKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgaWYgKHByZWQoeCwgaSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgdmFyIHJhbmdlID0gZnVuY3Rpb24gKG51bSwgZikge1xuICAgICAgdmFyIHIgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtOyBpKyspIHtcbiAgICAgICAgci5wdXNoKGYoaSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgbWFwID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICB2YXIgbGVuID0geHMubGVuZ3RoO1xuICAgICAgdmFyIHIgPSBuZXcgQXJyYXkobGVuKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgcltpXSA9IGYoeCwgaSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBlYWNoID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgZih4LCBpKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBlYWNociA9IGZ1bmN0aW9uICh4cywgZikge1xuICAgICAgZm9yICh2YXIgaSA9IHhzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIGYoeCwgaSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcGFydGl0aW9uID0gZnVuY3Rpb24gKHhzLCBwcmVkKSB7XG4gICAgICB2YXIgcGFzcyA9IFtdO1xuICAgICAgdmFyIGZhaWwgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICB2YXIgYXJyID0gcHJlZCh4LCBpKSA/IHBhc3MgOiBmYWlsO1xuICAgICAgICBhcnIucHVzaCh4KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhc3M6IHBhc3MsXG4gICAgICAgIGZhaWw6IGZhaWxcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZmlsdGVyID0gZnVuY3Rpb24gKHhzLCBwcmVkKSB7XG4gICAgICB2YXIgciA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHhzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0geHNbaV07XG4gICAgICAgIGlmIChwcmVkKHgsIGkpKSB7XG4gICAgICAgICAgci5wdXNoKHgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBmb2xkciA9IGZ1bmN0aW9uICh4cywgZiwgYWNjKSB7XG4gICAgICBlYWNocih4cywgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgYWNjID0gZihhY2MsIHgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH07XG4gICAgdmFyIGZvbGRsID0gZnVuY3Rpb24gKHhzLCBmLCBhY2MpIHtcbiAgICAgIGVhY2goeHMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGFjYyA9IGYoYWNjLCB4KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9O1xuICAgIHZhciBmaW5kVW50aWwgPSBmdW5jdGlvbiAoeHMsIHByZWQsIHVudGlsKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgaWYgKHByZWQoeCwgaSkpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh4KTtcbiAgICAgICAgfSBlbHNlIGlmICh1bnRpbCh4LCBpKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGZpbmQgPSBmdW5jdGlvbiAoeHMsIHByZWQpIHtcbiAgICAgIHJldHVybiBmaW5kVW50aWwoeHMsIHByZWQsIG5ldmVyKTtcbiAgICB9O1xuICAgIHZhciBmaW5kSW5kZXggPSBmdW5jdGlvbiAoeHMsIHByZWQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBpZiAocHJlZCh4LCBpKSkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGZsYXR0ZW4gPSBmdW5jdGlvbiAoeHMpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgaWYgKCFpc0FycmF5KHhzW2ldKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQXJyLmZsYXR0ZW4gaXRlbSAnICsgaSArICcgd2FzIG5vdCBhbiBhcnJheSwgaW5wdXQ6ICcgKyB4cyk7XG4gICAgICAgIH1cbiAgICAgICAgbmF0aXZlUHVzaC5hcHBseShyLCB4c1tpXSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIHZhciBiaW5kID0gZnVuY3Rpb24gKHhzLCBmKSB7XG4gICAgICByZXR1cm4gZmxhdHRlbihtYXAoeHMsIGYpKTtcbiAgICB9O1xuICAgIHZhciBmb3JhbGwgPSBmdW5jdGlvbiAoeHMsIHByZWQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB4cy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICB2YXIgeCA9IHhzW2ldO1xuICAgICAgICBpZiAocHJlZCh4LCBpKSAhPT0gdHJ1ZSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICB2YXIgcmV2ZXJzZSA9IGZ1bmN0aW9uICh4cykge1xuICAgICAgdmFyIHIgPSBuYXRpdmVTbGljZS5jYWxsKHhzLCAwKTtcbiAgICAgIHIucmV2ZXJzZSgpO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgbWFwVG9PYmplY3QgPSBmdW5jdGlvbiAoeHMsIGYpIHtcbiAgICAgIHZhciByID0ge307XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0geHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdmFyIHggPSB4c1tpXTtcbiAgICAgICAgcltTdHJpbmcoeCldID0gZih4LCBpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIHB1cmUgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgcmV0dXJuIFt4XTtcbiAgICB9O1xuICAgIHZhciBzb3J0ID0gZnVuY3Rpb24gKHhzLCBjb21wYXJhdG9yKSB7XG4gICAgICB2YXIgY29weSA9IG5hdGl2ZVNsaWNlLmNhbGwoeHMsIDApO1xuICAgICAgY29weS5zb3J0KGNvbXBhcmF0b3IpO1xuICAgICAgcmV0dXJuIGNvcHk7XG4gICAgfTtcbiAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKHhzLCBpKSB7XG4gICAgICByZXR1cm4gaSA+PSAwICYmIGkgPCB4cy5sZW5ndGggPyBPcHRpb25hbC5zb21lKHhzW2ldKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBoZWFkID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICByZXR1cm4gZ2V0KHhzLCAwKTtcbiAgICB9O1xuICAgIHZhciBsYXN0ID0gZnVuY3Rpb24gKHhzKSB7XG4gICAgICByZXR1cm4gZ2V0KHhzLCB4cy5sZW5ndGggLSAxKTtcbiAgICB9O1xuICAgIHZhciBmaW5kTWFwID0gZnVuY3Rpb24gKGFyciwgZikge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHIgPSBmKGFycltpXSwgaSk7XG4gICAgICAgIGlmIChyLmlzU29tZSgpKSB7XG4gICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcblxuICAgIHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XG4gICAgICAgICAgZm9yICh2YXIgcCBpbiBzKVxuICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcbiAgICAgICAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcbiAgICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKylcbiAgICAgICAgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICAgIHJldHVybiByO1xuICAgIH1cblxuICAgIHZhciBjYWNoZWQgPSBmdW5jdGlvbiAoZikge1xuICAgICAgdmFyIGNhbGxlZCA9IGZhbHNlO1xuICAgICAgdmFyIHI7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNhbGxlZCkge1xuICAgICAgICAgIGNhbGxlZCA9IHRydWU7XG4gICAgICAgICAgciA9IGYuYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgRGV2aWNlVHlwZSA9IGZ1bmN0aW9uIChvcywgYnJvd3NlciwgdXNlckFnZW50LCBtZWRpYU1hdGNoKSB7XG4gICAgICB2YXIgaXNpUGFkID0gb3MuaXNpT1MoKSAmJiAvaXBhZC9pLnRlc3QodXNlckFnZW50KSA9PT0gdHJ1ZTtcbiAgICAgIHZhciBpc2lQaG9uZSA9IG9zLmlzaU9TKCkgJiYgIWlzaVBhZDtcbiAgICAgIHZhciBpc01vYmlsZSA9IG9zLmlzaU9TKCkgfHwgb3MuaXNBbmRyb2lkKCk7XG4gICAgICB2YXIgaXNUb3VjaCA9IGlzTW9iaWxlIHx8IG1lZGlhTWF0Y2goJyhwb2ludGVyOmNvYXJzZSknKTtcbiAgICAgIHZhciBpc1RhYmxldCA9IGlzaVBhZCB8fCAhaXNpUGhvbmUgJiYgaXNNb2JpbGUgJiYgbWVkaWFNYXRjaCgnKG1pbi1kZXZpY2Utd2lkdGg6NzY4cHgpJyk7XG4gICAgICB2YXIgaXNQaG9uZSA9IGlzaVBob25lIHx8IGlzTW9iaWxlICYmICFpc1RhYmxldDtcbiAgICAgIHZhciBpT1N3ZWJ2aWV3ID0gYnJvd3Nlci5pc1NhZmFyaSgpICYmIG9zLmlzaU9TKCkgJiYgL3NhZmFyaS9pLnRlc3QodXNlckFnZW50KSA9PT0gZmFsc2U7XG4gICAgICB2YXIgaXNEZXNrdG9wID0gIWlzUGhvbmUgJiYgIWlzVGFibGV0ICYmICFpT1N3ZWJ2aWV3O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNpUGFkOiBjb25zdGFudChpc2lQYWQpLFxuICAgICAgICBpc2lQaG9uZTogY29uc3RhbnQoaXNpUGhvbmUpLFxuICAgICAgICBpc1RhYmxldDogY29uc3RhbnQoaXNUYWJsZXQpLFxuICAgICAgICBpc1Bob25lOiBjb25zdGFudChpc1Bob25lKSxcbiAgICAgICAgaXNUb3VjaDogY29uc3RhbnQoaXNUb3VjaCksXG4gICAgICAgIGlzQW5kcm9pZDogb3MuaXNBbmRyb2lkLFxuICAgICAgICBpc2lPUzogb3MuaXNpT1MsXG4gICAgICAgIGlzV2ViVmlldzogY29uc3RhbnQoaU9Td2VidmlldyksXG4gICAgICAgIGlzRGVza3RvcDogY29uc3RhbnQoaXNEZXNrdG9wKVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGZpcnN0TWF0Y2ggPSBmdW5jdGlvbiAocmVnZXhlcywgcykge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWdleGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciB4ID0gcmVnZXhlc1tpXTtcbiAgICAgICAgaWYgKHgudGVzdChzKSkge1xuICAgICAgICAgIHJldHVybiB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdmFyIGZpbmQkMSA9IGZ1bmN0aW9uIChyZWdleGVzLCBhZ2VudCkge1xuICAgICAgdmFyIHIgPSBmaXJzdE1hdGNoKHJlZ2V4ZXMsIGFnZW50KTtcbiAgICAgIGlmICghcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1ham9yOiAwLFxuICAgICAgICAgIG1pbm9yOiAwXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB2YXIgZ3JvdXAgPSBmdW5jdGlvbiAoaSkge1xuICAgICAgICByZXR1cm4gTnVtYmVyKGFnZW50LnJlcGxhY2UociwgJyQnICsgaSkpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBudShncm91cCgxKSwgZ3JvdXAoMikpO1xuICAgIH07XG4gICAgdmFyIGRldGVjdCA9IGZ1bmN0aW9uICh2ZXJzaW9uUmVnZXhlcywgYWdlbnQpIHtcbiAgICAgIHZhciBjbGVhbmVkQWdlbnQgPSBTdHJpbmcoYWdlbnQpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAodmVyc2lvblJlZ2V4ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1bmtub3duKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmluZCQxKHZlcnNpb25SZWdleGVzLCBjbGVhbmVkQWdlbnQpO1xuICAgIH07XG4gICAgdmFyIHVua25vd24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbnUoMCwgMCk7XG4gICAgfTtcbiAgICB2YXIgbnUgPSBmdW5jdGlvbiAobWFqb3IsIG1pbm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYWpvcjogbWFqb3IsXG4gICAgICAgIG1pbm9yOiBtaW5vclxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBWZXJzaW9uID0ge1xuICAgICAgbnU6IG51LFxuICAgICAgZGV0ZWN0OiBkZXRlY3QsXG4gICAgICB1bmtub3duOiB1bmtub3duXG4gICAgfTtcblxuICAgIHZhciBkZXRlY3QkMSA9IGZ1bmN0aW9uIChjYW5kaWRhdGVzLCB1c2VyQWdlbnQpIHtcbiAgICAgIHZhciBhZ2VudCA9IFN0cmluZyh1c2VyQWdlbnQpLnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4gZmluZChjYW5kaWRhdGVzLCBmdW5jdGlvbiAoY2FuZGlkYXRlKSB7XG4gICAgICAgIHJldHVybiBjYW5kaWRhdGUuc2VhcmNoKGFnZW50KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRldGVjdEJyb3dzZXIgPSBmdW5jdGlvbiAoYnJvd3NlcnMsIHVzZXJBZ2VudCkge1xuICAgICAgcmV0dXJuIGRldGVjdCQxKGJyb3dzZXJzLCB1c2VyQWdlbnQpLm1hcChmdW5jdGlvbiAoYnJvd3Nlcikge1xuICAgICAgICB2YXIgdmVyc2lvbiA9IFZlcnNpb24uZGV0ZWN0KGJyb3dzZXIudmVyc2lvblJlZ2V4ZXMsIHVzZXJBZ2VudCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY3VycmVudDogYnJvd3Nlci5uYW1lLFxuICAgICAgICAgIHZlcnNpb246IHZlcnNpb25cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRldGVjdE9zID0gZnVuY3Rpb24gKG9zZXMsIHVzZXJBZ2VudCkge1xuICAgICAgcmV0dXJuIGRldGVjdCQxKG9zZXMsIHVzZXJBZ2VudCkubWFwKGZ1bmN0aW9uIChvcykge1xuICAgICAgICB2YXIgdmVyc2lvbiA9IFZlcnNpb24uZGV0ZWN0KG9zLnZlcnNpb25SZWdleGVzLCB1c2VyQWdlbnQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGN1cnJlbnQ6IG9zLm5hbWUsXG4gICAgICAgICAgdmVyc2lvbjogdmVyc2lvblxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgVWFTdHJpbmcgPSB7XG4gICAgICBkZXRlY3RCcm93c2VyOiBkZXRlY3RCcm93c2VyLFxuICAgICAgZGV0ZWN0T3M6IGRldGVjdE9zXG4gICAgfTtcblxuICAgIHZhciBjaGVja1JhbmdlID0gZnVuY3Rpb24gKHN0ciwgc3Vic3RyLCBzdGFydCkge1xuICAgICAgcmV0dXJuIHN1YnN0ciA9PT0gJycgfHwgc3RyLmxlbmd0aCA+PSBzdWJzdHIubGVuZ3RoICYmIHN0ci5zdWJzdHIoc3RhcnQsIHN0YXJ0ICsgc3Vic3RyLmxlbmd0aCkgPT09IHN1YnN0cjtcbiAgICB9O1xuICAgIHZhciBjb250YWlucyQxID0gZnVuY3Rpb24gKHN0ciwgc3Vic3RyKSB7XG4gICAgICByZXR1cm4gc3RyLmluZGV4T2Yoc3Vic3RyKSAhPT0gLTE7XG4gICAgfTtcbiAgICB2YXIgc3RhcnRzV2l0aCA9IGZ1bmN0aW9uIChzdHIsIHByZWZpeCkge1xuICAgICAgcmV0dXJuIGNoZWNrUmFuZ2Uoc3RyLCBwcmVmaXgsIDApO1xuICAgIH07XG4gICAgdmFyIGVuZHNXaXRoID0gZnVuY3Rpb24gKHN0ciwgc3VmZml4KSB7XG4gICAgICByZXR1cm4gY2hlY2tSYW5nZShzdHIsIHN1ZmZpeCwgc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgpO1xuICAgIH07XG4gICAgdmFyIGJsYW5rID0gZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gcy5yZXBsYWNlKHIsICcnKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgdHJpbSA9IGJsYW5rKC9eXFxzK3xcXHMrJC9nKTtcbiAgICB2YXIgaXNOb3RFbXB0eSA9IGZ1bmN0aW9uIChzKSB7XG4gICAgICByZXR1cm4gcy5sZW5ndGggPiAwO1xuICAgIH07XG5cbiAgICB2YXIgbm9ybWFsVmVyc2lvblJlZ2V4ID0gLy4qP3ZlcnNpb25cXC9cXCA/KFswLTldKylcXC4oWzAtOV0rKS4qLztcbiAgICB2YXIgY2hlY2tDb250YWlucyA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zJDEodWFzdHJpbmcsIHRhcmdldCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGJyb3dzZXJzID0gW1xuICAgICAge1xuICAgICAgICBuYW1lOiAnRWRnZScsXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2VkZ2VcXC8gPyhbMC05XSspXFwuKFswLTldKykkL10sXG4gICAgICAgIHNlYXJjaDogZnVuY3Rpb24gKHVhc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5zJDEodWFzdHJpbmcsICdlZGdlLycpICYmIGNvbnRhaW5zJDEodWFzdHJpbmcsICdjaHJvbWUnKSAmJiBjb250YWlucyQxKHVhc3RyaW5nLCAnc2FmYXJpJykgJiYgY29udGFpbnMkMSh1YXN0cmluZywgJ2FwcGxld2Via2l0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdDaHJvbWUnLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIC8uKj9jaHJvbWVcXC8oWzAtOV0rKVxcLihbMC05XSspLiovLFxuICAgICAgICAgIG5vcm1hbFZlcnNpb25SZWdleFxuICAgICAgICBdLFxuICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uICh1YXN0cmluZykge1xuICAgICAgICAgIHJldHVybiBjb250YWlucyQxKHVhc3RyaW5nLCAnY2hyb21lJykgJiYgIWNvbnRhaW5zJDEodWFzdHJpbmcsICdjaHJvbWVmcmFtZScpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnSUUnLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIC8uKj9tc2llXFwgPyhbMC05XSspXFwuKFswLTldKykuKi8sXG4gICAgICAgICAgLy4qP3J2OihbMC05XSspXFwuKFswLTldKykuKi9cbiAgICAgICAgXSxcbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbnMkMSh1YXN0cmluZywgJ21zaWUnKSB8fCBjb250YWlucyQxKHVhc3RyaW5nLCAndHJpZGVudCcpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnT3BlcmEnLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogW1xuICAgICAgICAgIG5vcm1hbFZlcnNpb25SZWdleCxcbiAgICAgICAgICAvLio/b3BlcmFcXC8oWzAtOV0rKVxcLihbMC05XSspLiovXG4gICAgICAgIF0sXG4gICAgICAgIHNlYXJjaDogY2hlY2tDb250YWlucygnb3BlcmEnKVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0ZpcmVmb3gnLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj9maXJlZm94XFwvXFwgPyhbMC05XSspXFwuKFswLTldKykuKi9dLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ2ZpcmVmb3gnKVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1NhZmFyaScsXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXG4gICAgICAgICAgbm9ybWFsVmVyc2lvblJlZ2V4LFxuICAgICAgICAgIC8uKj9jcHUgb3MgKFswLTldKylfKFswLTldKykuKi9cbiAgICAgICAgXSxcbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gKGNvbnRhaW5zJDEodWFzdHJpbmcsICdzYWZhcmknKSB8fCBjb250YWlucyQxKHVhc3RyaW5nLCAnbW9iaWxlLycpKSAmJiBjb250YWlucyQxKHVhc3RyaW5nLCAnYXBwbGV3ZWJraXQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIF07XG4gICAgdmFyIG9zZXMgPSBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdXaW5kb3dzJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCd3aW4nKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/d2luZG93c1xcIG50XFwgPyhbMC05XSspXFwuKFswLTldKykuKi9dXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnaU9TJyxcbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbiAodWFzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbnMkMSh1YXN0cmluZywgJ2lwaG9uZScpIHx8IGNvbnRhaW5zJDEodWFzdHJpbmcsICdpcGFkJyk7XG4gICAgICAgIH0sXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXG4gICAgICAgICAgLy4qP3ZlcnNpb25cXC9cXCA/KFswLTldKylcXC4oWzAtOV0rKS4qLyxcbiAgICAgICAgICAvLipjcHUgb3MgKFswLTldKylfKFswLTldKykuKi8sXG4gICAgICAgICAgLy4qY3B1IGlwaG9uZSBvcyAoWzAtOV0rKV8oWzAtOV0rKS4qL1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnQW5kcm9pZCcsXG4gICAgICAgIHNlYXJjaDogY2hlY2tDb250YWlucygnYW5kcm9pZCcpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj9hbmRyb2lkXFwgPyhbMC05XSspXFwuKFswLTldKykuKi9dXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnT1NYJyxcbiAgICAgICAgc2VhcmNoOiBjaGVja0NvbnRhaW5zKCdtYWMgb3MgeCcpLFxuICAgICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj9tYWNcXCBvc1xcIHhcXCA/KFswLTldKylfKFswLTldKykuKi9dXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnTGludXgnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ2xpbnV4JyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ1NvbGFyaXMnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ3N1bm9zJyksXG4gICAgICAgIHZlcnNpb25SZWdleGVzOiBbXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0ZyZWVCU0QnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ2ZyZWVic2QnKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnQ2hyb21lT1MnLFxuICAgICAgICBzZWFyY2g6IGNoZWNrQ29udGFpbnMoJ2Nyb3MnKSxcbiAgICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/Y2hyb21lXFwvKFswLTldKylcXC4oWzAtOV0rKS4qL11cbiAgICAgIH1cbiAgICBdO1xuICAgIHZhciBQbGF0Zm9ybUluZm8gPSB7XG4gICAgICBicm93c2VyczogY29uc3RhbnQoYnJvd3NlcnMpLFxuICAgICAgb3NlczogY29uc3RhbnQob3NlcylcbiAgICB9O1xuXG4gICAgdmFyIGVkZ2UgPSAnRWRnZSc7XG4gICAgdmFyIGNocm9tZSA9ICdDaHJvbWUnO1xuICAgIHZhciBpZSA9ICdJRSc7XG4gICAgdmFyIG9wZXJhID0gJ09wZXJhJztcbiAgICB2YXIgZmlyZWZveCA9ICdGaXJlZm94JztcbiAgICB2YXIgc2FmYXJpID0gJ1NhZmFyaSc7XG4gICAgdmFyIHVua25vd24kMSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBudSQxKHtcbiAgICAgICAgY3VycmVudDogdW5kZWZpbmVkLFxuICAgICAgICB2ZXJzaW9uOiBWZXJzaW9uLnVua25vd24oKVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbnUkMSA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICB2YXIgY3VycmVudCA9IGluZm8uY3VycmVudDtcbiAgICAgIHZhciB2ZXJzaW9uID0gaW5mby52ZXJzaW9uO1xuICAgICAgdmFyIGlzQnJvd3NlciA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGN1cnJlbnQgPT09IG5hbWU7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY3VycmVudDogY3VycmVudCxcbiAgICAgICAgdmVyc2lvbjogdmVyc2lvbixcbiAgICAgICAgaXNFZGdlOiBpc0Jyb3dzZXIoZWRnZSksXG4gICAgICAgIGlzQ2hyb21lOiBpc0Jyb3dzZXIoY2hyb21lKSxcbiAgICAgICAgaXNJRTogaXNCcm93c2VyKGllKSxcbiAgICAgICAgaXNPcGVyYTogaXNCcm93c2VyKG9wZXJhKSxcbiAgICAgICAgaXNGaXJlZm94OiBpc0Jyb3dzZXIoZmlyZWZveCksXG4gICAgICAgIGlzU2FmYXJpOiBpc0Jyb3dzZXIoc2FmYXJpKVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBCcm93c2VyID0ge1xuICAgICAgdW5rbm93bjogdW5rbm93biQxLFxuICAgICAgbnU6IG51JDEsXG4gICAgICBlZGdlOiBjb25zdGFudChlZGdlKSxcbiAgICAgIGNocm9tZTogY29uc3RhbnQoY2hyb21lKSxcbiAgICAgIGllOiBjb25zdGFudChpZSksXG4gICAgICBvcGVyYTogY29uc3RhbnQob3BlcmEpLFxuICAgICAgZmlyZWZveDogY29uc3RhbnQoZmlyZWZveCksXG4gICAgICBzYWZhcmk6IGNvbnN0YW50KHNhZmFyaSlcbiAgICB9O1xuXG4gICAgdmFyIHdpbmRvd3MgPSAnV2luZG93cyc7XG4gICAgdmFyIGlvcyA9ICdpT1MnO1xuICAgIHZhciBhbmRyb2lkID0gJ0FuZHJvaWQnO1xuICAgIHZhciBsaW51eCA9ICdMaW51eCc7XG4gICAgdmFyIG9zeCA9ICdPU1gnO1xuICAgIHZhciBzb2xhcmlzID0gJ1NvbGFyaXMnO1xuICAgIHZhciBmcmVlYnNkID0gJ0ZyZWVCU0QnO1xuICAgIHZhciBjaHJvbWVvcyA9ICdDaHJvbWVPUyc7XG4gICAgdmFyIHVua25vd24kMiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBudSQyKHtcbiAgICAgICAgY3VycmVudDogdW5kZWZpbmVkLFxuICAgICAgICB2ZXJzaW9uOiBWZXJzaW9uLnVua25vd24oKVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbnUkMiA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICB2YXIgY3VycmVudCA9IGluZm8uY3VycmVudDtcbiAgICAgIHZhciB2ZXJzaW9uID0gaW5mby52ZXJzaW9uO1xuICAgICAgdmFyIGlzT1MgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50ID09PSBuYW1lO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnQ6IGN1cnJlbnQsXG4gICAgICAgIHZlcnNpb246IHZlcnNpb24sXG4gICAgICAgIGlzV2luZG93czogaXNPUyh3aW5kb3dzKSxcbiAgICAgICAgaXNpT1M6IGlzT1MoaW9zKSxcbiAgICAgICAgaXNBbmRyb2lkOiBpc09TKGFuZHJvaWQpLFxuICAgICAgICBpc09TWDogaXNPUyhvc3gpLFxuICAgICAgICBpc0xpbnV4OiBpc09TKGxpbnV4KSxcbiAgICAgICAgaXNTb2xhcmlzOiBpc09TKHNvbGFyaXMpLFxuICAgICAgICBpc0ZyZWVCU0Q6IGlzT1MoZnJlZWJzZCksXG4gICAgICAgIGlzQ2hyb21lT1M6IGlzT1MoY2hyb21lb3MpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIE9wZXJhdGluZ1N5c3RlbSA9IHtcbiAgICAgIHVua25vd246IHVua25vd24kMixcbiAgICAgIG51OiBudSQyLFxuICAgICAgd2luZG93czogY29uc3RhbnQod2luZG93cyksXG4gICAgICBpb3M6IGNvbnN0YW50KGlvcyksXG4gICAgICBhbmRyb2lkOiBjb25zdGFudChhbmRyb2lkKSxcbiAgICAgIGxpbnV4OiBjb25zdGFudChsaW51eCksXG4gICAgICBvc3g6IGNvbnN0YW50KG9zeCksXG4gICAgICBzb2xhcmlzOiBjb25zdGFudChzb2xhcmlzKSxcbiAgICAgIGZyZWVic2Q6IGNvbnN0YW50KGZyZWVic2QpLFxuICAgICAgY2hyb21lb3M6IGNvbnN0YW50KGNocm9tZW9zKVxuICAgIH07XG5cbiAgICB2YXIgZGV0ZWN0JDIgPSBmdW5jdGlvbiAodXNlckFnZW50LCBtZWRpYU1hdGNoKSB7XG4gICAgICB2YXIgYnJvd3NlcnMgPSBQbGF0Zm9ybUluZm8uYnJvd3NlcnMoKTtcbiAgICAgIHZhciBvc2VzID0gUGxhdGZvcm1JbmZvLm9zZXMoKTtcbiAgICAgIHZhciBicm93c2VyID0gVWFTdHJpbmcuZGV0ZWN0QnJvd3Nlcihicm93c2VycywgdXNlckFnZW50KS5mb2xkKEJyb3dzZXIudW5rbm93biwgQnJvd3Nlci5udSk7XG4gICAgICB2YXIgb3MgPSBVYVN0cmluZy5kZXRlY3RPcyhvc2VzLCB1c2VyQWdlbnQpLmZvbGQoT3BlcmF0aW5nU3lzdGVtLnVua25vd24sIE9wZXJhdGluZ1N5c3RlbS5udSk7XG4gICAgICB2YXIgZGV2aWNlVHlwZSA9IERldmljZVR5cGUob3MsIGJyb3dzZXIsIHVzZXJBZ2VudCwgbWVkaWFNYXRjaCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBicm93c2VyOiBicm93c2VyLFxuICAgICAgICBvczogb3MsXG4gICAgICAgIGRldmljZVR5cGU6IGRldmljZVR5cGVcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgUGxhdGZvcm1EZXRlY3Rpb24gPSB7IGRldGVjdDogZGV0ZWN0JDIgfTtcblxuICAgIHZhciBtZWRpYU1hdGNoID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XG4gICAgICByZXR1cm4gd2luZG93Lm1hdGNoTWVkaWEocXVlcnkpLm1hdGNoZXM7XG4gICAgfTtcbiAgICB2YXIgcGxhdGZvcm0gPSBjYWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFBsYXRmb3JtRGV0ZWN0aW9uLmRldGVjdChuYXZpZ2F0b3IudXNlckFnZW50LCBtZWRpYU1hdGNoKTtcbiAgICB9KTtcbiAgICB2YXIgZGV0ZWN0JDMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcGxhdGZvcm0oKTtcbiAgICB9O1xuXG4gICAgdmFyIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID0gZnVuY3Rpb24gKGEsIGIsIG1hdGNoKSB7XG4gICAgICByZXR1cm4gKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikgJiBtYXRjaCkgIT09IDA7XG4gICAgfTtcbiAgICB2YXIgZG9jdW1lbnRQb3NpdGlvbkNvbnRhaW5lZEJ5ID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBjb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhLCBiLCBOb2RlLkRPQ1VNRU5UX1BPU0lUSU9OX0NPTlRBSU5FRF9CWSk7XG4gICAgfTtcblxuICAgIHZhciBDT01NRU5UID0gODtcbiAgICB2YXIgRE9DVU1FTlQgPSA5O1xuICAgIHZhciBET0NVTUVOVF9GUkFHTUVOVCA9IDExO1xuICAgIHZhciBFTEVNRU5UID0gMTtcbiAgICB2YXIgVEVYVCA9IDM7XG5cbiAgICB2YXIgZnJvbUh0bWwgPSBmdW5jdGlvbiAoaHRtbCwgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBkaXYgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBkaXYuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgIGlmICghZGl2Lmhhc0NoaWxkTm9kZXMoKSB8fCBkaXYuY2hpbGROb2Rlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0hUTUwgZG9lcyBub3QgaGF2ZSBhIHNpbmdsZSByb290IG5vZGUnLCBodG1sKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIVE1MIG11c3QgaGF2ZSBhIHNpbmdsZSByb290IG5vZGUnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmcm9tRG9tKGRpdi5jaGlsZE5vZGVzWzBdKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGFnID0gZnVuY3Rpb24gKHRhZywgc2NvcGUpIHtcbiAgICAgIHZhciBkb2MgPSBzY29wZSB8fCBkb2N1bWVudDtcbiAgICAgIHZhciBub2RlID0gZG9jLmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgIHJldHVybiBmcm9tRG9tKG5vZGUpO1xuICAgIH07XG4gICAgdmFyIGZyb21UZXh0ID0gZnVuY3Rpb24gKHRleHQsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgbm9kZSA9IGRvYy5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTtcbiAgICAgIHJldHVybiBmcm9tRG9tKG5vZGUpO1xuICAgIH07XG4gICAgdmFyIGZyb21Eb20gPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgaWYgKG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm9kZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IGRvbTogbm9kZSB9O1xuICAgIH07XG4gICAgdmFyIGZyb21Qb2ludCA9IGZ1bmN0aW9uIChkb2NFbG0sIHgsIHkpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGRvY0VsbS5kb20uZWxlbWVudEZyb21Qb2ludCh4LCB5KSkubWFwKGZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIFN1Z2FyRWxlbWVudCA9IHtcbiAgICAgIGZyb21IdG1sOiBmcm9tSHRtbCxcbiAgICAgIGZyb21UYWc6IGZyb21UYWcsXG4gICAgICBmcm9tVGV4dDogZnJvbVRleHQsXG4gICAgICBmcm9tRG9tOiBmcm9tRG9tLFxuICAgICAgZnJvbVBvaW50OiBmcm9tUG9pbnRcbiAgICB9O1xuXG4gICAgdmFyIGlzID0gZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBpZiAoZG9tLm5vZGVUeXBlICE9PSBFTEVNRU5UKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBlbGVtID0gZG9tO1xuICAgICAgICBpZiAoZWxlbS5tYXRjaGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbS5tYXRjaGVzKHNlbGVjdG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtLm1zTWF0Y2hlc1NlbGVjdG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbS5tc01hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLndlYmtpdE1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbS5tb3pNYXRjaGVzU2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtLm1vek1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCcm93c2VyIGxhY2tzIG5hdGl2ZSBzZWxlY3RvcnMnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGJ5cGFzc1NlbGVjdG9yID0gZnVuY3Rpb24gKGRvbSkge1xuICAgICAgcmV0dXJuIGRvbS5ub2RlVHlwZSAhPT0gRUxFTUVOVCAmJiBkb20ubm9kZVR5cGUgIT09IERPQ1VNRU5UICYmIGRvbS5ub2RlVHlwZSAhPT0gRE9DVU1FTlRfRlJBR01FTlQgfHwgZG9tLmNoaWxkRWxlbWVudENvdW50ID09PSAwO1xuICAgIH07XG4gICAgdmFyIGFsbCA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgc2NvcGUpIHtcbiAgICAgIHZhciBiYXNlID0gc2NvcGUgPT09IHVuZGVmaW5lZCA/IGRvY3VtZW50IDogc2NvcGUuZG9tO1xuICAgICAgcmV0dXJuIGJ5cGFzc1NlbGVjdG9yKGJhc2UpID8gW10gOiBtYXAoYmFzZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSwgU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIG9uZSA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgc2NvcGUpIHtcbiAgICAgIHZhciBiYXNlID0gc2NvcGUgPT09IHVuZGVmaW5lZCA/IGRvY3VtZW50IDogc2NvcGUuZG9tO1xuICAgICAgcmV0dXJuIGJ5cGFzc1NlbGVjdG9yKGJhc2UpID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuZnJvbShiYXNlLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpKS5tYXAoU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG5cbiAgICB2YXIgZXEkMSA9IGZ1bmN0aW9uIChlMSwgZTIpIHtcbiAgICAgIHJldHVybiBlMS5kb20gPT09IGUyLmRvbTtcbiAgICB9O1xuICAgIHZhciByZWd1bGFyQ29udGFpbnMgPSBmdW5jdGlvbiAoZTEsIGUyKSB7XG4gICAgICB2YXIgZDEgPSBlMS5kb207XG4gICAgICB2YXIgZDIgPSBlMi5kb207XG4gICAgICByZXR1cm4gZDEgPT09IGQyID8gZmFsc2UgOiBkMS5jb250YWlucyhkMik7XG4gICAgfTtcbiAgICB2YXIgaWVDb250YWlucyA9IGZ1bmN0aW9uIChlMSwgZTIpIHtcbiAgICAgIHJldHVybiBkb2N1bWVudFBvc2l0aW9uQ29udGFpbmVkQnkoZTEuZG9tLCBlMi5kb20pO1xuICAgIH07XG4gICAgdmFyIGNvbnRhaW5zJDIgPSBmdW5jdGlvbiAoZTEsIGUyKSB7XG4gICAgICByZXR1cm4gZGV0ZWN0JDMoKS5icm93c2VyLmlzSUUoKSA/IGllQ29udGFpbnMoZTEsIGUyKSA6IHJlZ3VsYXJDb250YWlucyhlMSwgZTIpO1xuICAgIH07XG4gICAgdmFyIGlzJDEgPSBpcztcblxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXM7XG4gICAgdmFyIGhhc093blByb3BlcnR5ID0gT2JqZWN0Lmhhc093blByb3BlcnR5O1xuICAgIHZhciBlYWNoJDEgPSBmdW5jdGlvbiAob2JqLCBmKSB7XG4gICAgICB2YXIgcHJvcHMgPSBrZXlzKG9iaik7XG4gICAgICBmb3IgKHZhciBrID0gMCwgbGVuID0gcHJvcHMubGVuZ3RoOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgdmFyIGkgPSBwcm9wc1trXTtcbiAgICAgICAgdmFyIHggPSBvYmpbaV07XG4gICAgICAgIGYoeCwgaSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgbWFwJDEgPSBmdW5jdGlvbiAob2JqLCBmKSB7XG4gICAgICByZXR1cm4gdHVwbGVNYXAob2JqLCBmdW5jdGlvbiAoeCwgaSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGs6IGksXG4gICAgICAgICAgdjogZih4LCBpKVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdHVwbGVNYXAgPSBmdW5jdGlvbiAob2JqLCBmKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgZWFjaCQxKG9iaiwgZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgdmFyIHR1cGxlID0gZih4LCBpKTtcbiAgICAgICAgclt0dXBsZS5rXSA9IHR1cGxlLnY7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIG9iakFjYyA9IGZ1bmN0aW9uIChyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgcltpXSA9IHg7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGludGVybmFsRmlsdGVyID0gZnVuY3Rpb24gKG9iaiwgcHJlZCwgb25UcnVlLCBvbkZhbHNlKSB7XG4gICAgICB2YXIgciA9IHt9O1xuICAgICAgZWFjaCQxKG9iaiwgZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgKHByZWQoeCwgaSkgPyBvblRydWUgOiBvbkZhbHNlKSh4LCBpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgZmlsdGVyJDEgPSBmdW5jdGlvbiAob2JqLCBwcmVkKSB7XG4gICAgICB2YXIgdCA9IHt9O1xuICAgICAgaW50ZXJuYWxGaWx0ZXIob2JqLCBwcmVkLCBvYmpBY2ModCksIG5vb3ApO1xuICAgICAgcmV0dXJuIHQ7XG4gICAgfTtcbiAgICB2YXIgbWFwVG9BcnJheSA9IGZ1bmN0aW9uIChvYmosIGYpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICBlYWNoJDEob2JqLCBmdW5jdGlvbiAodmFsdWUsIG5hbWUpIHtcbiAgICAgICAgci5wdXNoKGYodmFsdWUsIG5hbWUpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHI7XG4gICAgfTtcbiAgICB2YXIgdmFsdWVzID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgcmV0dXJuIG1hcFRvQXJyYXkob2JqLCBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdjtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHNpemUgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4ga2V5cyhvYmopLmxlbmd0aDtcbiAgICB9O1xuICAgIHZhciBnZXQkMSA9IGZ1bmN0aW9uIChvYmosIGtleSkge1xuICAgICAgcmV0dXJuIGhhcyhvYmosIGtleSkgPyBPcHRpb25hbC5mcm9tKG9ialtrZXldKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBoYXMgPSBmdW5jdGlvbiAob2JqLCBrZXkpIHtcbiAgICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTtcbiAgICB9O1xuICAgIHZhciBoYXNOb25OdWxsYWJsZUtleSA9IGZ1bmN0aW9uIChvYmosIGtleSkge1xuICAgICAgcmV0dXJuIGhhcyhvYmosIGtleSkgJiYgb2JqW2tleV0gIT09IHVuZGVmaW5lZCAmJiBvYmpba2V5XSAhPT0gbnVsbDtcbiAgICB9O1xuICAgIHZhciBpc0VtcHR5ID0gZnVuY3Rpb24gKHIpIHtcbiAgICAgIGZvciAodmFyIHggaW4gcikge1xuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChyLCB4KSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuICAgIHZhciB2YWxpZFNlY3Rpb25MaXN0ID0gW1xuICAgICAgJ3Rmb290JyxcbiAgICAgICd0aGVhZCcsXG4gICAgICAndGJvZHknLFxuICAgICAgJ2NvbGdyb3VwJ1xuICAgIF07XG4gICAgdmFyIGlzVmFsaWRTZWN0aW9uID0gZnVuY3Rpb24gKHBhcmVudE5hbWUpIHtcbiAgICAgIHJldHVybiBjb250YWlucyh2YWxpZFNlY3Rpb25MaXN0LCBwYXJlbnROYW1lKTtcbiAgICB9O1xuICAgIHZhciBncmlkID0gZnVuY3Rpb24gKHJvd3MsIGNvbHVtbnMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IHJvd3MsXG4gICAgICAgIGNvbHVtbnM6IGNvbHVtbnNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYWRkcmVzcyA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcm93OiByb3csXG4gICAgICAgIGNvbHVtbjogY29sdW1uXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGRldGFpbCA9IGZ1bmN0aW9uIChlbGVtZW50LCByb3dzcGFuLCBjb2xzcGFuKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICByb3dzcGFuOiByb3dzcGFuLFxuICAgICAgICBjb2xzcGFuOiBjb2xzcGFuXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGRldGFpbG5ldyA9IGZ1bmN0aW9uIChlbGVtZW50LCByb3dzcGFuLCBjb2xzcGFuLCBpc05ldykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgcm93c3Bhbjogcm93c3BhbixcbiAgICAgICAgY29sc3BhbjogY29sc3BhbixcbiAgICAgICAgaXNOZXc6IGlzTmV3XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGV4dGVuZGVkID0gZnVuY3Rpb24gKGVsZW1lbnQsIHJvd3NwYW4sIGNvbHNwYW4sIHJvdywgY29sdW1uLCBpc0xvY2tlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgcm93c3Bhbjogcm93c3BhbixcbiAgICAgICAgY29sc3BhbjogY29sc3BhbixcbiAgICAgICAgcm93OiByb3csXG4gICAgICAgIGNvbHVtbjogY29sdW1uLFxuICAgICAgICBpc0xvY2tlZDogaXNMb2NrZWRcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcm93ZGF0YSA9IGZ1bmN0aW9uIChlbGVtZW50LCBjZWxscywgc2VjdGlvbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgY2VsbHM6IGNlbGxzLFxuICAgICAgICBzZWN0aW9uOiBzZWN0aW9uXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGVsZW1lbnRuZXcgPSBmdW5jdGlvbiAoZWxlbWVudCwgaXNOZXcsIGlzTG9ja2VkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICBpc05ldzogaXNOZXcsXG4gICAgICAgIGlzTG9ja2VkOiBpc0xvY2tlZFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByb3dkYXRhbmV3ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNlbGxzLCBzZWN0aW9uLCBpc05ldykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgY2VsbHM6IGNlbGxzLFxuICAgICAgICBzZWN0aW9uOiBzZWN0aW9uLFxuICAgICAgICBpc05ldzogaXNOZXdcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcm93Y2VsbHMgPSBmdW5jdGlvbiAoY2VsbHMsIHNlY3Rpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNlbGxzOiBjZWxscyxcbiAgICAgICAgc2VjdGlvbjogc2VjdGlvblxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciByb3dkZXRhaWxzID0gZnVuY3Rpb24gKGRldGFpbHMsIHNlY3Rpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRldGFpbHM6IGRldGFpbHMsXG4gICAgICAgIHNlY3Rpb246IHNlY3Rpb25cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYm91bmRzID0gZnVuY3Rpb24gKHN0YXJ0Um93LCBzdGFydENvbCwgZmluaXNoUm93LCBmaW5pc2hDb2wpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0Um93OiBzdGFydFJvdyxcbiAgICAgICAgc3RhcnRDb2w6IHN0YXJ0Q29sLFxuICAgICAgICBmaW5pc2hSb3c6IGZpbmlzaFJvdyxcbiAgICAgICAgZmluaXNoQ29sOiBmaW5pc2hDb2xcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29sdW1uZXh0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNvbHNwYW4sIGNvbHVtbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgY29sc3BhbjogY29sc3BhbixcbiAgICAgICAgY29sdW1uOiBjb2x1bW5cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBHbG9iYWwgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpczsnKSgpO1xuXG4gICAgdmFyIG5hbWUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIHIgPSBlbGVtZW50LmRvbS5ub2RlTmFtZTtcbiAgICAgIHJldHVybiByLnRvTG93ZXJDYXNlKCk7XG4gICAgfTtcbiAgICB2YXIgdHlwZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5kb20ubm9kZVR5cGU7XG4gICAgfTtcbiAgICB2YXIgaXNUeXBlJDEgPSBmdW5jdGlvbiAodCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0eXBlKGVsZW1lbnQpID09PSB0O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpc0NvbW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIHR5cGUoZWxlbWVudCkgPT09IENPTU1FTlQgfHwgbmFtZShlbGVtZW50KSA9PT0gJyNjb21tZW50JztcbiAgICB9O1xuICAgIHZhciBpc0VsZW1lbnQgPSBpc1R5cGUkMShFTEVNRU5UKTtcbiAgICB2YXIgaXNUZXh0ID0gaXNUeXBlJDEoVEVYVCk7XG4gICAgdmFyIGlzRG9jdW1lbnQgPSBpc1R5cGUkMShET0NVTUVOVCk7XG4gICAgdmFyIGlzRG9jdW1lbnRGcmFnbWVudCA9IGlzVHlwZSQxKERPQ1VNRU5UX0ZSQUdNRU5UKTtcbiAgICB2YXIgaXNUYWcgPSBmdW5jdGlvbiAodGFnKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGlzRWxlbWVudChlKSAmJiBuYW1lKGUpID09PSB0YWc7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgb3duZXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsZW1lbnQuZG9tLm93bmVyRG9jdW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGRvY3VtZW50T3JPd25lciA9IGZ1bmN0aW9uIChkb3MpIHtcbiAgICAgIHJldHVybiBpc0RvY3VtZW50KGRvcykgPyBkb3MgOiBvd25lcihkb3MpO1xuICAgIH07XG4gICAgdmFyIGRlZmF1bHRWaWV3ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudE9yT3duZXIoZWxlbWVudCkuZG9tLmRlZmF1bHRWaWV3KTtcbiAgICB9O1xuICAgIHZhciBwYXJlbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZWxlbWVudC5kb20ucGFyZW50Tm9kZSkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBwYXJlbnRzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGlzUm9vdCkge1xuICAgICAgdmFyIHN0b3AgPSBpc0Z1bmN0aW9uKGlzUm9vdCkgPyBpc1Jvb3QgOiBuZXZlcjtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgIHdoaWxlIChkb20ucGFyZW50Tm9kZSAhPT0gbnVsbCAmJiBkb20ucGFyZW50Tm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhciByYXdQYXJlbnQgPSBkb20ucGFyZW50Tm9kZTtcbiAgICAgICAgdmFyIHAgPSBTdWdhckVsZW1lbnQuZnJvbURvbShyYXdQYXJlbnQpO1xuICAgICAgICByZXQucHVzaChwKTtcbiAgICAgICAgaWYgKHN0b3AocCkgPT09IHRydWUpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkb20gPSByYXdQYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfTtcbiAgICB2YXIgb2Zmc2V0UGFyZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGVsZW1lbnQuZG9tLm9mZnNldFBhcmVudCkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKTtcbiAgICB9O1xuICAgIHZhciBwcmV2U2libGluZyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShlbGVtZW50LmRvbS5wcmV2aW91c1NpYmxpbmcpLm1hcChTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcbiAgICB2YXIgbmV4dFNpYmxpbmcgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZWxlbWVudC5kb20ubmV4dFNpYmxpbmcpLm1hcChTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcbiAgICB2YXIgY2hpbGRyZW4gPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIG1hcChlbGVtZW50LmRvbS5jaGlsZE5vZGVzLCBTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcbiAgICB2YXIgY2hpbGQgPSBmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgIHZhciBjcyA9IGVsZW1lbnQuZG9tLmNoaWxkTm9kZXM7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShjc1tpbmRleF0pLm1hcChTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcbiAgICB2YXIgZmlyc3RDaGlsZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gY2hpbGQoZWxlbWVudCwgMCk7XG4gICAgfTtcblxuICAgIHZhciBpc1NoYWRvd1Jvb3QgPSBmdW5jdGlvbiAoZG9zKSB7XG4gICAgICByZXR1cm4gaXNEb2N1bWVudEZyYWdtZW50KGRvcykgJiYgaXNOb25OdWxsYWJsZShkb3MuZG9tLmhvc3QpO1xuICAgIH07XG4gICAgdmFyIHN1cHBvcnRlZCA9IGlzRnVuY3Rpb24oRWxlbWVudC5wcm90b3R5cGUuYXR0YWNoU2hhZG93KSAmJiBpc0Z1bmN0aW9uKE5vZGUucHJvdG90eXBlLmdldFJvb3ROb2RlKTtcbiAgICB2YXIgaXNTdXBwb3J0ZWQgPSBjb25zdGFudChzdXBwb3J0ZWQpO1xuICAgIHZhciBnZXRSb290Tm9kZSA9IHN1cHBvcnRlZCA/IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21Eb20oZS5kb20uZ2V0Um9vdE5vZGUoKSk7XG4gICAgfSA6IGRvY3VtZW50T3JPd25lcjtcbiAgICB2YXIgZ2V0U2hhZG93Um9vdCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgciA9IGdldFJvb3ROb2RlKGUpO1xuICAgICAgcmV0dXJuIGlzU2hhZG93Um9vdChyKSA/IE9wdGlvbmFsLnNvbWUocikgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U2hhZG93SG9zdCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21Eb20oZS5kb20uaG9zdCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3JpZ2luYWxFdmVudFRhcmdldCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKGlzU3VwcG9ydGVkKCkgJiYgaXNOb25OdWxsYWJsZShldmVudC50YXJnZXQpKSB7XG4gICAgICAgIHZhciBlbCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmIChpc0VsZW1lbnQoZWwpICYmIGlzT3BlblNoYWRvd0hvc3QoZWwpKSB7XG4gICAgICAgICAgaWYgKGV2ZW50LmNvbXBvc2VkICYmIGV2ZW50LmNvbXBvc2VkUGF0aCkge1xuICAgICAgICAgICAgdmFyIGNvbXBvc2VkUGF0aCA9IGV2ZW50LmNvbXBvc2VkUGF0aCgpO1xuICAgICAgICAgICAgaWYgKGNvbXBvc2VkUGF0aCkge1xuICAgICAgICAgICAgICByZXR1cm4gaGVhZChjb21wb3NlZFBhdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZXZlbnQudGFyZ2V0KTtcbiAgICB9O1xuICAgIHZhciBpc09wZW5TaGFkb3dIb3N0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBpc05vbk51bGxhYmxlKGVsZW1lbnQuZG9tLnNoYWRvd1Jvb3QpO1xuICAgIH07XG5cbiAgICB2YXIgaW5Cb2R5ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBpc1RleHQoZWxlbWVudCkgPyBlbGVtZW50LmRvbS5wYXJlbnROb2RlIDogZWxlbWVudC5kb207XG4gICAgICBpZiAoZG9tID09PSB1bmRlZmluZWQgfHwgZG9tID09PSBudWxsIHx8IGRvbS5vd25lckRvY3VtZW50ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBkb2MgPSBkb20ub3duZXJEb2N1bWVudDtcbiAgICAgIHJldHVybiBnZXRTaGFkb3dSb290KFN1Z2FyRWxlbWVudC5mcm9tRG9tKGRvbSkpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZG9jLmJvZHkuY29udGFpbnMoZG9tKTtcbiAgICAgIH0sIGNvbXBvc2UxKGluQm9keSwgZ2V0U2hhZG93SG9zdCkpO1xuICAgIH07XG4gICAgdmFyIGJvZHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZ2V0Qm9keShTdWdhckVsZW1lbnQuZnJvbURvbShkb2N1bWVudCkpO1xuICAgIH07XG4gICAgdmFyIGdldEJvZHkgPSBmdW5jdGlvbiAoZG9jKSB7XG4gICAgICB2YXIgYiA9IGRvYy5kb20uYm9keTtcbiAgICAgIGlmIChiID09PSBudWxsIHx8IGIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JvZHkgaXMgbm90IGF2YWlsYWJsZSB5ZXQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShiKTtcbiAgICB9O1xuXG4gICAgdmFyIGFuY2VzdG9ycyA9IGZ1bmN0aW9uIChzY29wZSwgcHJlZGljYXRlLCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBmaWx0ZXIocGFyZW50cyhzY29wZSwgaXNSb290KSwgcHJlZGljYXRlKTtcbiAgICB9O1xuICAgIHZhciBjaGlsZHJlbiQxID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiBmaWx0ZXIoY2hpbGRyZW4oc2NvcGUpLCBwcmVkaWNhdGUpO1xuICAgIH07XG4gICAgdmFyIGRlc2NlbmRhbnRzID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgIGVhY2goY2hpbGRyZW4oc2NvcGUpLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBpZiAocHJlZGljYXRlKHgpKSB7XG4gICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdChbeF0pO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQoZGVzY2VuZGFudHMoeCwgcHJlZGljYXRlKSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIHZhciBhbmNlc3RvcnMkMSA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGFuY2VzdG9ycyhzY29wZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGlzKGUsIHNlbGVjdG9yKTtcbiAgICAgIH0sIGlzUm9vdCk7XG4gICAgfTtcbiAgICB2YXIgY2hpbGRyZW4kMiA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBjaGlsZHJlbiQxKHNjb3BlLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICByZXR1cm4gaXMoZSwgc2VsZWN0b3IpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZGVzY2VuZGFudHMkMSA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBhbGwoc2VsZWN0b3IsIHNjb3BlKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gQ2xvc2VzdE9yQW5jZXN0b3IgKGlzLCBhbmNlc3Rvciwgc2NvcGUsIGEsIGlzUm9vdCkge1xuICAgICAgaWYgKGlzKHNjb3BlLCBhKSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShzY29wZSk7XG4gICAgICB9IGVsc2UgaWYgKGlzRnVuY3Rpb24oaXNSb290KSAmJiBpc1Jvb3Qoc2NvcGUpKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYW5jZXN0b3Ioc2NvcGUsIGEsIGlzUm9vdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGFuY2VzdG9yID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBzY29wZS5kb207XG4gICAgICB2YXIgc3RvcCA9IGlzRnVuY3Rpb24oaXNSb290KSA/IGlzUm9vdCA6IG5ldmVyO1xuICAgICAgd2hpbGUgKGVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgICB2YXIgZWwgPSBTdWdhckVsZW1lbnQuZnJvbURvbShlbGVtZW50KTtcbiAgICAgICAgaWYgKHByZWRpY2F0ZShlbCkpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShlbCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RvcChlbCkpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBjbG9zZXN0ID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgdmFyIGlzID0gZnVuY3Rpb24gKHMsIHRlc3QpIHtcbiAgICAgICAgcmV0dXJuIHRlc3Qocyk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIENsb3Nlc3RPckFuY2VzdG9yKGlzLCBhbmNlc3Rvciwgc2NvcGUsIHByZWRpY2F0ZSwgaXNSb290KTtcbiAgICB9O1xuICAgIHZhciBjaGlsZCQxID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUpIHtcbiAgICAgIHZhciBwcmVkID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHByZWRpY2F0ZShTdWdhckVsZW1lbnQuZnJvbURvbShub2RlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlc3VsdCA9IGZpbmQoc2NvcGUuZG9tLmNoaWxkTm9kZXMsIHByZWQpO1xuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoU3VnYXJFbGVtZW50LmZyb21Eb20pO1xuICAgIH07XG4gICAgdmFyIGRlc2NlbmRhbnQgPSBmdW5jdGlvbiAoc2NvcGUsIHByZWRpY2F0ZSkge1xuICAgICAgdmFyIGRlc2NlbmQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBjaGlsZF8xID0gU3VnYXJFbGVtZW50LmZyb21Eb20obm9kZS5jaGlsZE5vZGVzW2ldKTtcbiAgICAgICAgICBpZiAocHJlZGljYXRlKGNoaWxkXzEpKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShjaGlsZF8xKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJlcyA9IGRlc2NlbmQobm9kZS5jaGlsZE5vZGVzW2ldKTtcbiAgICAgICAgICBpZiAocmVzLmlzU29tZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBkZXNjZW5kKHNjb3BlLmRvbSk7XG4gICAgfTtcblxuICAgIHZhciBhbmNlc3RvciQxID0gZnVuY3Rpb24gKHNjb3BlLCBzZWxlY3RvciwgaXNSb290KSB7XG4gICAgICByZXR1cm4gYW5jZXN0b3Ioc2NvcGUsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBpcyhlLCBzZWxlY3Rvcik7XG4gICAgICB9LCBpc1Jvb3QpO1xuICAgIH07XG4gICAgdmFyIGNoaWxkJDIgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdG9yKSB7XG4gICAgICByZXR1cm4gY2hpbGQkMShzY29wZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGlzKGUsIHNlbGVjdG9yKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRlc2NlbmRhbnQkMSA9IGZ1bmN0aW9uIChzY29wZSwgc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBvbmUoc2VsZWN0b3IsIHNjb3BlKTtcbiAgICB9O1xuICAgIHZhciBjbG9zZXN0JDEgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdG9yLCBpc1Jvb3QpIHtcbiAgICAgIHZhciBpcyQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIHNlbGVjdG9yKSB7XG4gICAgICAgIHJldHVybiBpcyhlbGVtZW50LCBzZWxlY3Rvcik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIENsb3Nlc3RPckFuY2VzdG9yKGlzJDEsIGFuY2VzdG9yJDEsIHNjb3BlLCBzZWxlY3RvciwgaXNSb290KTtcbiAgICB9O1xuXG4gICAgdmFyIHJhd1NldCA9IGZ1bmN0aW9uIChkb20sIGtleSwgdmFsdWUpIHtcbiAgICAgIGlmIChpc1N0cmluZyh2YWx1ZSkgfHwgaXNCb29sZWFuKHZhbHVlKSB8fCBpc051bWJlcih2YWx1ZSkpIHtcbiAgICAgICAgZG9tLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlICsgJycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBjYWxsIHRvIEF0dHJpYnV0ZS5zZXQuIEtleSAnLCBrZXksICc6OiBWYWx1ZSAnLCB2YWx1ZSwgJzo6IEVsZW1lbnQgJywgZG9tKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRyaWJ1dGUgdmFsdWUgd2FzIG5vdCBzaW1wbGUnKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoZWxlbWVudCwga2V5LCB2YWx1ZSkge1xuICAgICAgcmF3U2V0KGVsZW1lbnQuZG9tLCBrZXksIHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBzZXRBbGwgPSBmdW5jdGlvbiAoZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIGVhY2gkMShhdHRycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgcmF3U2V0KGRvbSwgaywgdik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXQkMiA9IGZ1bmN0aW9uIChlbGVtZW50LCBrZXkpIHtcbiAgICAgIHZhciB2ID0gZWxlbWVudC5kb20uZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgICByZXR1cm4gdiA9PT0gbnVsbCA/IHVuZGVmaW5lZCA6IHY7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3B0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSkge1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oZ2V0JDIoZWxlbWVudCwga2V5KSk7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGtleSkge1xuICAgICAgZWxlbWVudC5kb20ucmVtb3ZlQXR0cmlidXRlKGtleSk7XG4gICAgfTtcbiAgICB2YXIgY2xvbmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGZvbGRsKGVsZW1lbnQuZG9tLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uIChhY2MsIGF0dHIpIHtcbiAgICAgICAgYWNjW2F0dHIubmFtZV0gPSBhdHRyLnZhbHVlO1xuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSwge30pO1xuICAgIH07XG5cbiAgICB2YXIgaXNTdXBwb3J0ZWQkMSA9IGZ1bmN0aW9uIChkb20pIHtcbiAgICAgIHJldHVybiBkb20uc3R5bGUgIT09IHVuZGVmaW5lZCAmJiBpc0Z1bmN0aW9uKGRvbS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKTtcbiAgICB9O1xuXG4gICAgdmFyIGludGVybmFsU2V0ID0gZnVuY3Rpb24gKGRvbSwgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgICBpZiAoIWlzU3RyaW5nKHZhbHVlKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGNhbGwgdG8gQ1NTLnNldC4gUHJvcGVydHkgJywgcHJvcGVydHksICc6OiBWYWx1ZSAnLCB2YWx1ZSwgJzo6IEVsZW1lbnQgJywgZG9tKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDU1MgdmFsdWUgbXVzdCBiZSBhIHN0cmluZzogJyArIHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1N1cHBvcnRlZCQxKGRvbSkpIHtcbiAgICAgICAgZG9tLnN0eWxlLnNldFByb3BlcnR5KHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgaW50ZXJuYWxSZW1vdmUgPSBmdW5jdGlvbiAoZG9tLCBwcm9wZXJ0eSkge1xuICAgICAgaWYgKGlzU3VwcG9ydGVkJDEoZG9tKSkge1xuICAgICAgICBkb20uc3R5bGUucmVtb3ZlUHJvcGVydHkocHJvcGVydHkpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHNldCQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgaW50ZXJuYWxTZXQoZG9tLCBwcm9wZXJ0eSwgdmFsdWUpO1xuICAgIH07XG4gICAgdmFyIHNldEFsbCQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNzcykge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgZWFjaCQxKGNzcywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgaW50ZXJuYWxTZXQoZG9tLCBrLCB2KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldCQzID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5KSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICB2YXIgc3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9tKTtcbiAgICAgIHZhciByID0gc3R5bGVzLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHkpO1xuICAgICAgcmV0dXJuIHIgPT09ICcnICYmICFpbkJvZHkoZWxlbWVudCkgPyBnZXRVbnNhZmVQcm9wZXJ0eShkb20sIHByb3BlcnR5KSA6IHI7XG4gICAgfTtcbiAgICB2YXIgZ2V0VW5zYWZlUHJvcGVydHkgPSBmdW5jdGlvbiAoZG9tLCBwcm9wZXJ0eSkge1xuICAgICAgcmV0dXJuIGlzU3VwcG9ydGVkJDEoZG9tKSA/IGRvbS5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5KSA6ICcnO1xuICAgIH07XG4gICAgdmFyIGdldFJhdyA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0eSkge1xuICAgICAgdmFyIGRvbSA9IGVsZW1lbnQuZG9tO1xuICAgICAgdmFyIHJhdyA9IGdldFVuc2FmZVByb3BlcnR5KGRvbSwgcHJvcGVydHkpO1xuICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20ocmF3KS5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuIHIubGVuZ3RoID4gMDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZSQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5KSB7XG4gICAgICB2YXIgZG9tID0gZWxlbWVudC5kb207XG4gICAgICBpbnRlcm5hbFJlbW92ZShkb20sIHByb3BlcnR5KTtcbiAgICAgIGlmIChnZXRPcHQoZWxlbWVudCwgJ3N0eWxlJykubWFwKHRyaW0pLmlzKCcnKSkge1xuICAgICAgICByZW1vdmUoZWxlbWVudCwgJ3N0eWxlJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgY29weSA9IGZ1bmN0aW9uIChzb3VyY2UsIHRhcmdldCkge1xuICAgICAgdmFyIHNvdXJjZURvbSA9IHNvdXJjZS5kb207XG4gICAgICB2YXIgdGFyZ2V0RG9tID0gdGFyZ2V0LmRvbTtcbiAgICAgIGlmIChpc1N1cHBvcnRlZCQxKHNvdXJjZURvbSkgJiYgaXNTdXBwb3J0ZWQkMSh0YXJnZXREb20pKSB7XG4gICAgICAgIHRhcmdldERvbS5zdHlsZS5jc3NUZXh0ID0gc291cmNlRG9tLnN0eWxlLmNzc1RleHQ7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBnZXRBdHRyVmFsdWUgPSBmdW5jdGlvbiAoY2VsbCwgbmFtZSwgZmFsbGJhY2spIHtcbiAgICAgIGlmIChmYWxsYmFjayA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGZhbGxiYWNrID0gMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBnZXRPcHQoY2VsbCwgbmFtZSkubWFwKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUsIDEwKTtcbiAgICAgIH0pLmdldE9yKGZhbGxiYWNrKTtcbiAgICB9O1xuICAgIHZhciBnZXRTcGFuID0gZnVuY3Rpb24gKGNlbGwsIHR5cGUpIHtcbiAgICAgIHJldHVybiBnZXRBdHRyVmFsdWUoY2VsbCwgdHlwZSwgMSk7XG4gICAgfTtcbiAgICB2YXIgaGFzQ29sc3BhbiA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICByZXR1cm4gZ2V0U3BhbihjZWxsLCAnY29sc3BhbicpID4gMTtcbiAgICB9O1xuICAgIHZhciBoYXNSb3dzcGFuID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiBnZXRTcGFuKGNlbGwsICdyb3dzcGFuJykgPiAxO1xuICAgIH07XG4gICAgdmFyIGdldENzc1ZhbHVlID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5KSB7XG4gICAgICByZXR1cm4gcGFyc2VJbnQoZ2V0JDMoZWxlbWVudCwgcHJvcGVydHkpLCAxMCk7XG4gICAgfTtcbiAgICB2YXIgbWluV2lkdGggPSBjb25zdGFudCgxMCk7XG4gICAgdmFyIG1pbkhlaWdodCA9IGNvbnN0YW50KDEwKTtcblxuICAgIHZhciBmaXJzdExheWVyID0gZnVuY3Rpb24gKHNjb3BlLCBzZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGZpbHRlckZpcnN0TGF5ZXIoc2NvcGUsIHNlbGVjdG9yLCBhbHdheXMpO1xuICAgIH07XG4gICAgdmFyIGZpbHRlckZpcnN0TGF5ZXIgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdG9yLCBwcmVkaWNhdGUpIHtcbiAgICAgIHJldHVybiBiaW5kKGNoaWxkcmVuKHNjb3BlKSwgZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgaWYgKGlzKHgsIHNlbGVjdG9yKSkge1xuICAgICAgICAgIHJldHVybiBwcmVkaWNhdGUoeCkgPyBbeF0gOiBbXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmlsdGVyRmlyc3RMYXllcih4LCBzZWxlY3RvciwgcHJlZGljYXRlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBsb29rdXAgPSBmdW5jdGlvbiAodGFncywgZWxlbWVudCwgaXNSb290KSB7XG4gICAgICBpZiAoaXNSb290ID09PSB2b2lkIDApIHtcbiAgICAgICAgaXNSb290ID0gbmV2ZXI7XG4gICAgICB9XG4gICAgICBpZiAoaXNSb290KGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgICBpZiAoY29udGFpbnModGFncywgbmFtZShlbGVtZW50KSkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZWxlbWVudCk7XG4gICAgICB9XG4gICAgICB2YXIgaXNSb290T3JVcHBlclRhYmxlID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICByZXR1cm4gaXMoZWxtLCAndGFibGUnKSB8fCBpc1Jvb3QoZWxtKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gYW5jZXN0b3IkMShlbGVtZW50LCB0YWdzLmpvaW4oJywnKSwgaXNSb290T3JVcHBlclRhYmxlKTtcbiAgICB9O1xuICAgIHZhciBjZWxsID0gZnVuY3Rpb24gKGVsZW1lbnQsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGxvb2t1cChbXG4gICAgICAgICd0ZCcsXG4gICAgICAgICd0aCdcbiAgICAgIF0sIGVsZW1lbnQsIGlzUm9vdCk7XG4gICAgfTtcbiAgICB2YXIgY2VsbHMgPSBmdW5jdGlvbiAoYW5jZXN0b3IpIHtcbiAgICAgIHJldHVybiBmaXJzdExheWVyKGFuY2VzdG9yLCAndGgsdGQnKTtcbiAgICB9O1xuICAgIHZhciBjb2x1bW5zID0gZnVuY3Rpb24gKGFuY2VzdG9yKSB7XG4gICAgICBpZiAoaXMoYW5jZXN0b3IsICdjb2xncm91cCcpKSB7XG4gICAgICAgIHJldHVybiBjaGlsZHJlbiQyKGFuY2VzdG9yLCAnY29sJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYmluZChjb2x1bW5Hcm91cHMoYW5jZXN0b3IpLCBmdW5jdGlvbiAoY29sdW1uR3JvdXApIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGRyZW4kMihjb2x1bW5Hcm91cCwgJ2NvbCcpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB0YWJsZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBjbG9zZXN0JDEoZWxlbWVudCwgJ3RhYmxlJywgaXNSb290KTtcbiAgICB9O1xuICAgIHZhciByb3dzID0gZnVuY3Rpb24gKGFuY2VzdG9yKSB7XG4gICAgICByZXR1cm4gZmlyc3RMYXllcihhbmNlc3RvciwgJ3RyJyk7XG4gICAgfTtcbiAgICB2YXIgY29sdW1uR3JvdXBzID0gZnVuY3Rpb24gKGFuY2VzdG9yKSB7XG4gICAgICByZXR1cm4gdGFibGUoYW5jZXN0b3IpLmZvbGQoY29uc3RhbnQoW10pLCBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGNoaWxkcmVuJDIodGFibGUsICdjb2xncm91cCcpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBmcm9tUm93c09yQ29sR3JvdXBzID0gZnVuY3Rpb24gKGVsZW1zLCBnZXRTZWN0aW9uKSB7XG4gICAgICByZXR1cm4gbWFwKGVsZW1zLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIGlmIChuYW1lKHJvdykgPT09ICdjb2xncm91cCcpIHtcbiAgICAgICAgICB2YXIgY2VsbHMkMSA9IG1hcChjb2x1bW5zKHJvdyksIGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgICAgIHZhciBjb2xzcGFuID0gZ2V0QXR0clZhbHVlKGNvbHVtbiwgJ3NwYW4nLCAxKTtcbiAgICAgICAgICAgIHJldHVybiBkZXRhaWwoY29sdW1uLCAxLCBjb2xzcGFuKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gcm93ZGF0YShyb3csIGNlbGxzJDEsICdjb2xncm91cCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBjZWxscyQxID0gbWFwKGNlbGxzKHJvdyksIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgICB2YXIgcm93c3BhbiA9IGdldEF0dHJWYWx1ZShjZWxsLCAncm93c3BhbicsIDEpO1xuICAgICAgICAgICAgdmFyIGNvbHNwYW4gPSBnZXRBdHRyVmFsdWUoY2VsbCwgJ2NvbHNwYW4nLCAxKTtcbiAgICAgICAgICAgIHJldHVybiBkZXRhaWwoY2VsbCwgcm93c3BhbiwgY29sc3Bhbik7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHJvd2RhdGEocm93LCBjZWxscyQxLCBnZXRTZWN0aW9uKHJvdykpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRQYXJlbnRTZWN0aW9uID0gZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICByZXR1cm4gcGFyZW50KGdyb3VwKS5tYXAoZnVuY3Rpb24gKHBhcmVudCkge1xuICAgICAgICB2YXIgcGFyZW50TmFtZSA9IG5hbWUocGFyZW50KTtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWRTZWN0aW9uKHBhcmVudE5hbWUpID8gcGFyZW50TmFtZSA6ICd0Ym9keSc7XG4gICAgICB9KS5nZXRPcigndGJvZHknKTtcbiAgICB9O1xuICAgIHZhciBmcm9tVGFibGUgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgIHZhciByb3dzJDEgPSByb3dzKHRhYmxlKTtcbiAgICAgIHZhciBjb2x1bW5Hcm91cHMkMSA9IGNvbHVtbkdyb3Vwcyh0YWJsZSk7XG4gICAgICB2YXIgZWxlbXMgPSBfX3NwcmVhZEFycmF5cyhjb2x1bW5Hcm91cHMkMSwgcm93cyQxKTtcbiAgICAgIHJldHVybiBmcm9tUm93c09yQ29sR3JvdXBzKGVsZW1zLCBnZXRQYXJlbnRTZWN0aW9uKTtcbiAgICB9O1xuICAgIHZhciBmcm9tUGFzdGVkUm93cyA9IGZ1bmN0aW9uIChlbGVtcywgc2VjdGlvbikge1xuICAgICAgcmV0dXJuIGZyb21Sb3dzT3JDb2xHcm91cHMoZWxlbXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlY3Rpb247XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGFkZENlbGxzID0gZnVuY3Rpb24gKGdyaWRSb3csIGluZGV4LCBjZWxscykge1xuICAgICAgdmFyIGV4aXN0aW5nQ2VsbHMgPSBncmlkUm93LmNlbGxzO1xuICAgICAgdmFyIGJlZm9yZSA9IGV4aXN0aW5nQ2VsbHMuc2xpY2UoMCwgaW5kZXgpO1xuICAgICAgdmFyIGFmdGVyID0gZXhpc3RpbmdDZWxscy5zbGljZShpbmRleCk7XG4gICAgICB2YXIgbmV3Q2VsbHMgPSBiZWZvcmUuY29uY2F0KGNlbGxzKS5jb25jYXQoYWZ0ZXIpO1xuICAgICAgcmV0dXJuIHNldENlbGxzKGdyaWRSb3csIG5ld0NlbGxzKTtcbiAgICB9O1xuICAgIHZhciBhZGRDZWxsID0gZnVuY3Rpb24gKGdyaWRSb3csIGluZGV4LCBjZWxsKSB7XG4gICAgICByZXR1cm4gYWRkQ2VsbHMoZ3JpZFJvdywgaW5kZXgsIFtjZWxsXSk7XG4gICAgfTtcbiAgICB2YXIgbXV0YXRlQ2VsbCA9IGZ1bmN0aW9uIChncmlkUm93LCBpbmRleCwgY2VsbCkge1xuICAgICAgdmFyIGNlbGxzID0gZ3JpZFJvdy5jZWxscztcbiAgICAgIGNlbGxzW2luZGV4XSA9IGNlbGw7XG4gICAgfTtcbiAgICB2YXIgc2V0Q2VsbHMgPSBmdW5jdGlvbiAoZ3JpZFJvdywgY2VsbHMpIHtcbiAgICAgIHJldHVybiByb3djZWxscyhjZWxscywgZ3JpZFJvdy5zZWN0aW9uKTtcbiAgICB9O1xuICAgIHZhciBtYXBDZWxscyA9IGZ1bmN0aW9uIChncmlkUm93LCBmKSB7XG4gICAgICB2YXIgY2VsbHMgPSBncmlkUm93LmNlbGxzO1xuICAgICAgdmFyIHIgPSBtYXAoY2VsbHMsIGYpO1xuICAgICAgcmV0dXJuIHJvd2NlbGxzKHIsIGdyaWRSb3cuc2VjdGlvbik7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2VsbCA9IGZ1bmN0aW9uIChncmlkUm93LCBpbmRleCkge1xuICAgICAgcmV0dXJuIGdyaWRSb3cuY2VsbHNbaW5kZXhdO1xuICAgIH07XG4gICAgdmFyIGdldENlbGxFbGVtZW50ID0gZnVuY3Rpb24gKGdyaWRSb3csIGluZGV4KSB7XG4gICAgICByZXR1cm4gZ2V0Q2VsbChncmlkUm93LCBpbmRleCkuZWxlbWVudDtcbiAgICB9O1xuICAgIHZhciBjZWxsTGVuZ3RoID0gZnVuY3Rpb24gKGdyaWRSb3cpIHtcbiAgICAgIHJldHVybiBncmlkUm93LmNlbGxzLmxlbmd0aDtcbiAgICB9O1xuICAgIHZhciBleHRyYWN0R3JpZERldGFpbHMgPSBmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHBhcnRpdGlvbihncmlkLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIHJldHVybiByb3cuc2VjdGlvbiA9PT0gJ2NvbGdyb3VwJztcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcm93czogcmVzdWx0LmZhaWwsXG4gICAgICAgIGNvbHM6IHJlc3VsdC5wYXNzXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgTE9DS0VEX0NPTF9BVFRSID0gJ2RhdGEtc25vb2tlci1sb2NrZWQtY29scyc7XG4gICAgdmFyIGdldExvY2tlZENvbHVtbnNGcm9tVGFibGUgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgIHJldHVybiBnZXRPcHQodGFibGUsIExPQ0tFRF9DT0xfQVRUUikuYmluZChmdW5jdGlvbiAobG9ja2VkQ29sU3RyKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGxvY2tlZENvbFN0ci5tYXRjaCgvXFxkKy9nKSk7XG4gICAgICB9KS5tYXAoZnVuY3Rpb24gKGxvY2tlZENvbHMpIHtcbiAgICAgICAgcmV0dXJuIG1hcFRvT2JqZWN0KGxvY2tlZENvbHMsIGFsd2F5cyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRMb2NrZWRDb2x1bW5zRnJvbUdyaWQgPSBmdW5jdGlvbiAoZ3JpZCkge1xuICAgICAgdmFyIGxvY2tlZCA9IGZvbGRsKGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzLCBmdW5jdGlvbiAoYWNjLCByb3cpIHtcbiAgICAgICAgZWFjaChyb3cuY2VsbHMsIGZ1bmN0aW9uIChjZWxsLCBpZHgpIHtcbiAgICAgICAgICBpZiAoY2VsbC5pc0xvY2tlZCkge1xuICAgICAgICAgICAgYWNjW2lkeF0gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCB7fSk7XG4gICAgICB2YXIgbG9ja2VkQXJyID0gbWFwVG9BcnJheShsb2NrZWQsIGZ1bmN0aW9uIChfdmFsLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGtleSwgMTApO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gc29ydChsb2NrZWRBcnIpO1xuICAgIH07XG5cbiAgICB2YXIga2V5ID0gZnVuY3Rpb24gKHJvdywgY29sdW1uKSB7XG4gICAgICByZXR1cm4gcm93ICsgJywnICsgY29sdW1uO1xuICAgIH07XG4gICAgdmFyIGdldEF0ID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgcm93LCBjb2x1bW4pIHtcbiAgICAgIHZhciByYXcgPSB3YXJlaG91c2UuYWNjZXNzW2tleShyb3csIGNvbHVtbildO1xuICAgICAgcmV0dXJuIHJhdyAhPT0gdW5kZWZpbmVkID8gT3B0aW9uYWwuc29tZShyYXcpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIGZpbmRJdGVtID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgaXRlbSwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGZpbHRlcmVkID0gZmlsdGVySXRlbXMod2FyZWhvdXNlLCBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKGl0ZW0sIGRldGFpbC5lbGVtZW50KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZpbHRlcmVkLmxlbmd0aCA+IDAgPyBPcHRpb25hbC5zb21lKGZpbHRlcmVkWzBdKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBmaWx0ZXJJdGVtcyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHByZWRpY2F0ZSkge1xuICAgICAgdmFyIGFsbCA9IGJpbmQod2FyZWhvdXNlLmFsbCwgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuIHIuY2VsbHM7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmaWx0ZXIoYWxsLCBwcmVkaWNhdGUpO1xuICAgIH07XG4gICAgdmFyIGdlbmVyYXRlQ29sdW1ucyA9IGZ1bmN0aW9uIChyb3dEYXRhKSB7XG4gICAgICB2YXIgY29sdW1uc0dyb3VwID0ge307XG4gICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgZWFjaChyb3dEYXRhLmNlbGxzLCBmdW5jdGlvbiAoY29sdW1uKSB7XG4gICAgICAgIHZhciBjb2xzcGFuID0gY29sdW1uLmNvbHNwYW47XG4gICAgICAgIHJhbmdlKGNvbHNwYW4sIGZ1bmN0aW9uIChjb2x1bW5JbmRleCkge1xuICAgICAgICAgIHZhciBjb2xJbmRleCA9IGluZGV4ICsgY29sdW1uSW5kZXg7XG4gICAgICAgICAgY29sdW1uc0dyb3VwW2NvbEluZGV4XSA9IGNvbHVtbmV4dChjb2x1bW4uZWxlbWVudCwgY29sc3BhbiwgY29sSW5kZXgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaW5kZXggKz0gY29sc3BhbjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbHVtbnNHcm91cDtcbiAgICB9O1xuICAgIHZhciBnZW5lcmF0ZSA9IGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgICB2YXIgYWNjZXNzID0ge307XG4gICAgICB2YXIgY2VsbHMgPSBbXTtcbiAgICAgIHZhciBjb2x1bW5zID0ge307XG4gICAgICB2YXIgdGFibGVPcHQgPSBoZWFkKGxpc3QpLm1hcChmdW5jdGlvbiAocm93RGF0YSkge1xuICAgICAgICByZXR1cm4gcm93RGF0YS5lbGVtZW50O1xuICAgICAgfSkuYmluZCh0YWJsZSk7XG4gICAgICB2YXIgbG9ja2VkQ29sdW1ucyA9IHRhYmxlT3B0LmJpbmQoZ2V0TG9ja2VkQ29sdW1uc0Zyb21UYWJsZSkuZ2V0T3Ioe30pO1xuICAgICAgdmFyIG1heFJvd3MgPSAwO1xuICAgICAgdmFyIG1heENvbHVtbnMgPSAwO1xuICAgICAgdmFyIHJvd0NvdW50ID0gMDtcbiAgICAgIGVhY2gobGlzdCwgZnVuY3Rpb24gKHJvd0RhdGEpIHtcbiAgICAgICAgaWYgKHJvd0RhdGEuc2VjdGlvbiA9PT0gJ2NvbGdyb3VwJykge1xuICAgICAgICAgIGNvbHVtbnMgPSBnZW5lcmF0ZUNvbHVtbnMocm93RGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnRSb3dfMSA9IFtdO1xuICAgICAgICAgIGVhY2gocm93RGF0YS5jZWxscywgZnVuY3Rpb24gKHJvd0NlbGwpIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IDA7XG4gICAgICAgICAgICB3aGlsZSAoYWNjZXNzW2tleShyb3dDb3VudCwgc3RhcnQpXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIHN0YXJ0Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaXNMb2NrZWQgPSBoYXNOb25OdWxsYWJsZUtleShsb2NrZWRDb2x1bW5zLCBzdGFydC50b1N0cmluZygpKTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gZXh0ZW5kZWQocm93Q2VsbC5lbGVtZW50LCByb3dDZWxsLnJvd3NwYW4sIHJvd0NlbGwuY29sc3Bhbiwgcm93Q291bnQsIHN0YXJ0LCBpc0xvY2tlZCk7XG4gICAgICAgICAgICBmb3IgKHZhciBvY2N1cGllZENvbHVtblBvc2l0aW9uID0gMDsgb2NjdXBpZWRDb2x1bW5Qb3NpdGlvbiA8IHJvd0NlbGwuY29sc3Bhbjsgb2NjdXBpZWRDb2x1bW5Qb3NpdGlvbisrKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIG9jY3VwaWVkUm93UG9zaXRpb24gPSAwOyBvY2N1cGllZFJvd1Bvc2l0aW9uIDwgcm93Q2VsbC5yb3dzcGFuOyBvY2N1cGllZFJvd1Bvc2l0aW9uKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcm93UG9zaXRpb24gPSByb3dDb3VudCArIG9jY3VwaWVkUm93UG9zaXRpb247XG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtblBvc2l0aW9uID0gc3RhcnQgKyBvY2N1cGllZENvbHVtblBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIHZhciBuZXdwb3MgPSBrZXkocm93UG9zaXRpb24sIGNvbHVtblBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBhY2Nlc3NbbmV3cG9zXSA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgbWF4Q29sdW1ucyA9IE1hdGgubWF4KG1heENvbHVtbnMsIGNvbHVtblBvc2l0aW9uICsgMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRSb3dfMS5wdXNoKGN1cnJlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIG1heFJvd3MrKztcbiAgICAgICAgICBjZWxscy5wdXNoKHJvd2RhdGEocm93RGF0YS5lbGVtZW50LCBjdXJyZW50Um93XzEsIHJvd0RhdGEuc2VjdGlvbikpO1xuICAgICAgICAgIHJvd0NvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIGdyaWQkMSA9IGdyaWQobWF4Um93cywgbWF4Q29sdW1ucyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBncmlkOiBncmlkJDEsXG4gICAgICAgIGFjY2VzczogYWNjZXNzLFxuICAgICAgICBhbGw6IGNlbGxzLFxuICAgICAgICBjb2x1bW5zOiBjb2x1bW5zXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGZyb21UYWJsZSQxID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICB2YXIgbGlzdCA9IGZyb21UYWJsZSh0YWJsZSk7XG4gICAgICByZXR1cm4gZ2VuZXJhdGUobGlzdCk7XG4gICAgfTtcbiAgICB2YXIganVzdENlbGxzID0gZnVuY3Rpb24gKHdhcmVob3VzZSkge1xuICAgICAgcmV0dXJuIGJpbmQod2FyZWhvdXNlLmFsbCwgZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgcmV0dXJuIHcuY2VsbHM7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBqdXN0Q29sdW1ucyA9IGZ1bmN0aW9uICh3YXJlaG91c2UpIHtcbiAgICAgIHJldHVybiB2YWx1ZXMod2FyZWhvdXNlLmNvbHVtbnMpO1xuICAgIH07XG4gICAgdmFyIGhhc0NvbHVtbnMgPSBmdW5jdGlvbiAod2FyZWhvdXNlKSB7XG4gICAgICByZXR1cm4ga2V5cyh3YXJlaG91c2UuY29sdW1ucykubGVuZ3RoID4gMDtcbiAgICB9O1xuICAgIHZhciBnZXRDb2x1bW5BdCA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIGNvbHVtbkluZGV4KSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbSh3YXJlaG91c2UuY29sdW1uc1tjb2x1bW5JbmRleF0pO1xuICAgIH07XG4gICAgdmFyIFdhcmVob3VzZSA9IHtcbiAgICAgIGZyb21UYWJsZTogZnJvbVRhYmxlJDEsXG4gICAgICBnZW5lcmF0ZTogZ2VuZXJhdGUsXG4gICAgICBnZXRBdDogZ2V0QXQsXG4gICAgICBmaW5kSXRlbTogZmluZEl0ZW0sXG4gICAgICBmaWx0ZXJJdGVtczogZmlsdGVySXRlbXMsXG4gICAgICBqdXN0Q2VsbHM6IGp1c3RDZWxscyxcbiAgICAgIGp1c3RDb2x1bW5zOiBqdXN0Q29sdW1ucyxcbiAgICAgIGhhc0NvbHVtbnM6IGhhc0NvbHVtbnMsXG4gICAgICBnZXRDb2x1bW5BdDogZ2V0Q29sdW1uQXRcbiAgICB9O1xuXG4gICAgdmFyIGluU2VsZWN0aW9uID0gZnVuY3Rpb24gKGJvdW5kcywgZGV0YWlsKSB7XG4gICAgICB2YXIgbGVmdEVkZ2UgPSBkZXRhaWwuY29sdW1uO1xuICAgICAgdmFyIHJpZ2h0RWRnZSA9IGRldGFpbC5jb2x1bW4gKyBkZXRhaWwuY29sc3BhbiAtIDE7XG4gICAgICB2YXIgdG9wRWRnZSA9IGRldGFpbC5yb3c7XG4gICAgICB2YXIgYm90dG9tRWRnZSA9IGRldGFpbC5yb3cgKyBkZXRhaWwucm93c3BhbiAtIDE7XG4gICAgICByZXR1cm4gbGVmdEVkZ2UgPD0gYm91bmRzLmZpbmlzaENvbCAmJiByaWdodEVkZ2UgPj0gYm91bmRzLnN0YXJ0Q29sICYmICh0b3BFZGdlIDw9IGJvdW5kcy5maW5pc2hSb3cgJiYgYm90dG9tRWRnZSA+PSBib3VuZHMuc3RhcnRSb3cpO1xuICAgIH07XG4gICAgdmFyIGlzV2l0aGluID0gZnVuY3Rpb24gKGJvdW5kcywgZGV0YWlsKSB7XG4gICAgICByZXR1cm4gZGV0YWlsLmNvbHVtbiA+PSBib3VuZHMuc3RhcnRDb2wgJiYgZGV0YWlsLmNvbHVtbiArIGRldGFpbC5jb2xzcGFuIC0gMSA8PSBib3VuZHMuZmluaXNoQ29sICYmIGRldGFpbC5yb3cgPj0gYm91bmRzLnN0YXJ0Um93ICYmIGRldGFpbC5yb3cgKyBkZXRhaWwucm93c3BhbiAtIDEgPD0gYm91bmRzLmZpbmlzaFJvdztcbiAgICB9O1xuICAgIHZhciBpc1JlY3Rhbmd1bGFyID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgYm91bmRzKSB7XG4gICAgICB2YXIgaXNSZWN0ID0gdHJ1ZTtcbiAgICAgIHZhciBkZXRhaWxJc1dpdGhpbiA9IGN1cnJ5KGlzV2l0aGluLCBib3VuZHMpO1xuICAgICAgZm9yICh2YXIgaSA9IGJvdW5kcy5zdGFydFJvdzsgaSA8PSBib3VuZHMuZmluaXNoUm93OyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IGJvdW5kcy5zdGFydENvbDsgaiA8PSBib3VuZHMuZmluaXNoQ29sOyBqKyspIHtcbiAgICAgICAgICBpc1JlY3QgPSBpc1JlY3QgJiYgV2FyZWhvdXNlLmdldEF0KHdhcmVob3VzZSwgaSwgaikuZXhpc3RzKGRldGFpbElzV2l0aGluKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGlzUmVjdCA/IE9wdGlvbmFsLnNvbWUoYm91bmRzKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuXG4gICAgdmFyIGdldEJvdW5kcyA9IGZ1bmN0aW9uIChkZXRhaWxBLCBkZXRhaWxCKSB7XG4gICAgICByZXR1cm4gYm91bmRzKE1hdGgubWluKGRldGFpbEEucm93LCBkZXRhaWxCLnJvdyksIE1hdGgubWluKGRldGFpbEEuY29sdW1uLCBkZXRhaWxCLmNvbHVtbiksIE1hdGgubWF4KGRldGFpbEEucm93ICsgZGV0YWlsQS5yb3dzcGFuIC0gMSwgZGV0YWlsQi5yb3cgKyBkZXRhaWxCLnJvd3NwYW4gLSAxKSwgTWF0aC5tYXgoZGV0YWlsQS5jb2x1bW4gKyBkZXRhaWxBLmNvbHNwYW4gLSAxLCBkZXRhaWxCLmNvbHVtbiArIGRldGFpbEIuY29sc3BhbiAtIDEpKTtcbiAgICB9O1xuICAgIHZhciBnZXRBbnlCb3ggPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBzdGFydENlbGwsIGZpbmlzaENlbGwpIHtcbiAgICAgIHZhciBzdGFydENvb3JkcyA9IFdhcmVob3VzZS5maW5kSXRlbSh3YXJlaG91c2UsIHN0YXJ0Q2VsbCwgZXEkMSk7XG4gICAgICB2YXIgZmluaXNoQ29vcmRzID0gV2FyZWhvdXNlLmZpbmRJdGVtKHdhcmVob3VzZSwgZmluaXNoQ2VsbCwgZXEkMSk7XG4gICAgICByZXR1cm4gc3RhcnRDb29yZHMuYmluZChmdW5jdGlvbiAoc2MpIHtcbiAgICAgICAgcmV0dXJuIGZpbmlzaENvb3Jkcy5tYXAoZnVuY3Rpb24gKGZjKSB7XG4gICAgICAgICAgcmV0dXJuIGdldEJvdW5kcyhzYywgZmMpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldEJveCA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHN0YXJ0Q2VsbCwgZmluaXNoQ2VsbCkge1xuICAgICAgcmV0dXJuIGdldEFueUJveCh3YXJlaG91c2UsIHN0YXJ0Q2VsbCwgZmluaXNoQ2VsbCkuYmluZChmdW5jdGlvbiAoYm91bmRzKSB7XG4gICAgICAgIHJldHVybiBpc1JlY3Rhbmd1bGFyKHdhcmVob3VzZSwgYm91bmRzKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgbW92ZUJ5ID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgY2VsbCwgcm93LCBjb2x1bW4pIHtcbiAgICAgIHJldHVybiBXYXJlaG91c2UuZmluZEl0ZW0od2FyZWhvdXNlLCBjZWxsLCBlcSQxKS5iaW5kKGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgdmFyIHN0YXJ0Um93ID0gcm93ID4gMCA/IGRldGFpbC5yb3cgKyBkZXRhaWwucm93c3BhbiAtIDEgOiBkZXRhaWwucm93O1xuICAgICAgICB2YXIgc3RhcnRDb2wgPSBjb2x1bW4gPiAwID8gZGV0YWlsLmNvbHVtbiArIGRldGFpbC5jb2xzcGFuIC0gMSA6IGRldGFpbC5jb2x1bW47XG4gICAgICAgIHZhciBkZXN0ID0gV2FyZWhvdXNlLmdldEF0KHdhcmVob3VzZSwgc3RhcnRSb3cgKyByb3csIHN0YXJ0Q29sICsgY29sdW1uKTtcbiAgICAgICAgcmV0dXJuIGRlc3QubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGQuZWxlbWVudDtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpbnRlcmNlcHRzID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgc3RhcnQsIGZpbmlzaCkge1xuICAgICAgcmV0dXJuIGdldEFueUJveCh3YXJlaG91c2UsIHN0YXJ0LCBmaW5pc2gpLm1hcChmdW5jdGlvbiAoYm91bmRzKSB7XG4gICAgICAgIHZhciBpbnNpZGUgPSBXYXJlaG91c2UuZmlsdGVySXRlbXMod2FyZWhvdXNlLCBjdXJyeShpblNlbGVjdGlvbiwgYm91bmRzKSk7XG4gICAgICAgIHJldHVybiBtYXAoaW5zaWRlLCBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgcmV0dXJuIGRldGFpbC5lbGVtZW50O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHBhcmVudENlbGwgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBpbm5lckNlbGwpIHtcbiAgICAgIHZhciBpc0NvbnRhaW5lZEJ5ID0gZnVuY3Rpb24gKGMxLCBjMikge1xuICAgICAgICByZXR1cm4gY29udGFpbnMkMihjMiwgYzEpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBXYXJlaG91c2UuZmluZEl0ZW0od2FyZWhvdXNlLCBpbm5lckNlbGwsIGlzQ29udGFpbmVkQnkpLm1hcChmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgIHJldHVybiBkZXRhaWwuZWxlbWVudDtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgbW92ZUJ5JDEgPSBmdW5jdGlvbiAoY2VsbCwgZGVsdGFSb3csIGRlbHRhQ29sdW1uKSB7XG4gICAgICByZXR1cm4gdGFibGUoY2VsbCkuYmluZChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgdmFyIHdhcmVob3VzZSA9IGdldFdhcmVob3VzZSh0YWJsZSk7XG4gICAgICAgIHJldHVybiBtb3ZlQnkod2FyZWhvdXNlLCBjZWxsLCBkZWx0YVJvdywgZGVsdGFDb2x1bW4pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW50ZXJjZXB0cyQxID0gZnVuY3Rpb24gKHRhYmxlLCBmaXJzdCwgbGFzdCkge1xuICAgICAgdmFyIHdhcmVob3VzZSA9IGdldFdhcmVob3VzZSh0YWJsZSk7XG4gICAgICByZXR1cm4gaW50ZXJjZXB0cyh3YXJlaG91c2UsIGZpcnN0LCBsYXN0KTtcbiAgICB9O1xuICAgIHZhciBuZXN0ZWRJbnRlcmNlcHRzID0gZnVuY3Rpb24gKHRhYmxlLCBmaXJzdCwgZmlyc3RUYWJsZSwgbGFzdCwgbGFzdFRhYmxlKSB7XG4gICAgICB2YXIgd2FyZWhvdXNlID0gZ2V0V2FyZWhvdXNlKHRhYmxlKTtcbiAgICAgIHZhciBvcHRTdGFydENlbGwgPSBlcSQxKHRhYmxlLCBmaXJzdFRhYmxlKSA/IE9wdGlvbmFsLnNvbWUoZmlyc3QpIDogcGFyZW50Q2VsbCh3YXJlaG91c2UsIGZpcnN0KTtcbiAgICAgIHZhciBvcHRMYXN0Q2VsbCA9IGVxJDEodGFibGUsIGxhc3RUYWJsZSkgPyBPcHRpb25hbC5zb21lKGxhc3QpIDogcGFyZW50Q2VsbCh3YXJlaG91c2UsIGxhc3QpO1xuICAgICAgcmV0dXJuIG9wdFN0YXJ0Q2VsbC5iaW5kKGZ1bmN0aW9uIChzdGFydENlbGwpIHtcbiAgICAgICAgcmV0dXJuIG9wdExhc3RDZWxsLmJpbmQoZnVuY3Rpb24gKGxhc3RDZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGludGVyY2VwdHMod2FyZWhvdXNlLCBzdGFydENlbGwsIGxhc3RDZWxsKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRCb3gkMSA9IGZ1bmN0aW9uICh0YWJsZSwgZmlyc3QsIGxhc3QpIHtcbiAgICAgIHZhciB3YXJlaG91c2UgPSBnZXRXYXJlaG91c2UodGFibGUpO1xuICAgICAgcmV0dXJuIGdldEJveCh3YXJlaG91c2UsIGZpcnN0LCBsYXN0KTtcbiAgICB9O1xuICAgIHZhciBnZXRXYXJlaG91c2UgPSBXYXJlaG91c2UuZnJvbVRhYmxlO1xuXG4gICAgdmFyIGJlZm9yZSA9IGZ1bmN0aW9uIChtYXJrZXIsIGVsZW1lbnQpIHtcbiAgICAgIHZhciBwYXJlbnQkMSA9IHBhcmVudChtYXJrZXIpO1xuICAgICAgcGFyZW50JDEuZWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICB2LmRvbS5pbnNlcnRCZWZvcmUoZWxlbWVudC5kb20sIG1hcmtlci5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYWZ0ZXIgPSBmdW5jdGlvbiAobWFya2VyLCBlbGVtZW50KSB7XG4gICAgICB2YXIgc2libGluZyA9IG5leHRTaWJsaW5nKG1hcmtlcik7XG4gICAgICBzaWJsaW5nLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGFyZW50JDEgPSBwYXJlbnQobWFya2VyKTtcbiAgICAgICAgcGFyZW50JDEuZWFjaChmdW5jdGlvbiAodikge1xuICAgICAgICAgIGFwcGVuZCh2LCBlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAodikge1xuICAgICAgICBiZWZvcmUodiwgZWxlbWVudCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwcmVwZW5kID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudCkge1xuICAgICAgdmFyIGZpcnN0Q2hpbGQkMSA9IGZpcnN0Q2hpbGQocGFyZW50KTtcbiAgICAgIGZpcnN0Q2hpbGQkMS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXBwZW5kKHBhcmVudCwgZWxlbWVudCk7XG4gICAgICB9LCBmdW5jdGlvbiAodikge1xuICAgICAgICBwYXJlbnQuZG9tLmluc2VydEJlZm9yZShlbGVtZW50LmRvbSwgdi5kb20pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYXBwZW5kID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudCkge1xuICAgICAgcGFyZW50LmRvbS5hcHBlbmRDaGlsZChlbGVtZW50LmRvbSk7XG4gICAgfTtcbiAgICB2YXIgd3JhcCA9IGZ1bmN0aW9uIChlbGVtZW50LCB3cmFwcGVyKSB7XG4gICAgICBiZWZvcmUoZWxlbWVudCwgd3JhcHBlcik7XG4gICAgICBhcHBlbmQod3JhcHBlciwgZWxlbWVudCk7XG4gICAgfTtcblxuICAgIHZhciBiZWZvcmUkMSA9IGZ1bmN0aW9uIChtYXJrZXIsIGVsZW1lbnRzKSB7XG4gICAgICBlYWNoKGVsZW1lbnRzLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICBiZWZvcmUobWFya2VyLCB4KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFmdGVyJDEgPSBmdW5jdGlvbiAobWFya2VyLCBlbGVtZW50cykge1xuICAgICAgZWFjaChlbGVtZW50cywgZnVuY3Rpb24gKHgsIGkpIHtcbiAgICAgICAgdmFyIGUgPSBpID09PSAwID8gbWFya2VyIDogZWxlbWVudHNbaSAtIDFdO1xuICAgICAgICBhZnRlcihlLCB4KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFwcGVuZCQxID0gZnVuY3Rpb24gKHBhcmVudCwgZWxlbWVudHMpIHtcbiAgICAgIGVhY2goZWxlbWVudHMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGFwcGVuZChwYXJlbnQsIHgpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBlbXB0eSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICBlbGVtZW50LmRvbS50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgZWFjaChjaGlsZHJlbihlbGVtZW50KSwgZnVuY3Rpb24gKHJvZ3VlKSB7XG4gICAgICAgIHJlbW92ZSQyKHJvZ3VlKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZSQyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIGlmIChkb20ucGFyZW50Tm9kZSAhPT0gbnVsbCkge1xuICAgICAgICBkb20ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkb20pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHVud3JhcCA9IGZ1bmN0aW9uICh3cmFwcGVyKSB7XG4gICAgICB2YXIgY2hpbGRyZW4kMSA9IGNoaWxkcmVuKHdyYXBwZXIpO1xuICAgICAgaWYgKGNoaWxkcmVuJDEubGVuZ3RoID4gMCkge1xuICAgICAgICBiZWZvcmUkMSh3cmFwcGVyLCBjaGlsZHJlbiQxKTtcbiAgICAgIH1cbiAgICAgIHJlbW92ZSQyKHdyYXBwZXIpO1xuICAgIH07XG5cbiAgICB2YXIgTm9kZVZhbHVlID0gZnVuY3Rpb24gKGlzLCBuYW1lKSB7XG4gICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFpcyhlbGVtZW50KSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuIG9ubHkgZ2V0ICcgKyBuYW1lICsgJyB2YWx1ZSBvZiBhICcgKyBuYW1lICsgJyBub2RlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldE9wdGlvbihlbGVtZW50KS5nZXRPcignJyk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldE9wdGlvbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBpcyhlbGVtZW50KSA/IE9wdGlvbmFsLmZyb20oZWxlbWVudC5kb20ubm9kZVZhbHVlKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgICAgIGlmICghaXMoZWxlbWVudCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBvbmx5IHNldCByYXcgJyArIG5hbWUgKyAnIHZhbHVlIG9mIGEgJyArIG5hbWUgKyAnIG5vZGUnKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmRvbS5ub2RlVmFsdWUgPSB2YWx1ZTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgZ2V0T3B0aW9uOiBnZXRPcHRpb24sXG4gICAgICAgIHNldDogc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgYXBpID0gTm9kZVZhbHVlKGlzVGV4dCwgJ3RleHQnKTtcbiAgICB2YXIgZ2V0JDQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFwaS5nZXQoZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3B0aW9uID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBhcGkuZ2V0T3B0aW9uKGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIHNldCQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIHZhbHVlKSB7XG4gICAgICByZXR1cm4gYXBpLnNldChlbGVtZW50LCB2YWx1ZSk7XG4gICAgfTtcblxuICAgIHZhciBUYWdCb3VuZGFyaWVzID0gW1xuICAgICAgJ2JvZHknLFxuICAgICAgJ3AnLFxuICAgICAgJ2RpdicsXG4gICAgICAnYXJ0aWNsZScsXG4gICAgICAnYXNpZGUnLFxuICAgICAgJ2ZpZ2NhcHRpb24nLFxuICAgICAgJ2ZpZ3VyZScsXG4gICAgICAnZm9vdGVyJyxcbiAgICAgICdoZWFkZXInLFxuICAgICAgJ25hdicsXG4gICAgICAnc2VjdGlvbicsXG4gICAgICAnb2wnLFxuICAgICAgJ3VsJyxcbiAgICAgICdsaScsXG4gICAgICAndGFibGUnLFxuICAgICAgJ3RoZWFkJyxcbiAgICAgICd0Ym9keScsXG4gICAgICAndGZvb3QnLFxuICAgICAgJ2NhcHRpb24nLFxuICAgICAgJ3RyJyxcbiAgICAgICd0ZCcsXG4gICAgICAndGgnLFxuICAgICAgJ2gxJyxcbiAgICAgICdoMicsXG4gICAgICAnaDMnLFxuICAgICAgJ2g0JyxcbiAgICAgICdoNScsXG4gICAgICAnaDYnLFxuICAgICAgJ2Jsb2NrcXVvdGUnLFxuICAgICAgJ3ByZScsXG4gICAgICAnYWRkcmVzcydcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gRG9tVW5pdmVyc2UgKCkge1xuICAgICAgdmFyIGNsb25lJDEgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21Eb20oZWxlbWVudC5kb20uY2xvbmVOb2RlKGZhbHNlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGRvY3VtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50T3JPd25lcihlbGVtZW50KS5kb207XG4gICAgICB9O1xuICAgICAgdmFyIGlzQm91bmRhcnkgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBpZiAoIWlzRWxlbWVudChlbGVtZW50KSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmFtZShlbGVtZW50KSA9PT0gJ2JvZHknKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zKFRhZ0JvdW5kYXJpZXMsIG5hbWUoZWxlbWVudCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBpc0VtcHR5VGFnID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFpc0VsZW1lbnQoZWxlbWVudCkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zKFtcbiAgICAgICAgICAnYnInLFxuICAgICAgICAgICdpbWcnLFxuICAgICAgICAgICdocicsXG4gICAgICAgICAgJ2lucHV0J1xuICAgICAgICBdLCBuYW1lKGVsZW1lbnQpKTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNOb25FZGl0YWJsZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBpc0VsZW1lbnQoZWxlbWVudCkgJiYgZ2V0JDIoZWxlbWVudCwgJ2NvbnRlbnRlZGl0YWJsZScpID09PSAnZmFsc2UnO1xuICAgICAgfTtcbiAgICAgIHZhciBjb21wYXJlUG9zaXRpb24gPSBmdW5jdGlvbiAoZWxlbWVudCwgb3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKG90aGVyLmRvbSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNvcHlBdHRyaWJ1dGVzVG8gPSBmdW5jdGlvbiAoc291cmNlLCBkZXN0aW5hdGlvbikge1xuICAgICAgICB2YXIgYXMgPSBjbG9uZShzb3VyY2UpO1xuICAgICAgICBzZXRBbGwoZGVzdGluYXRpb24sIGFzKTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNTcGVjaWFsID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHRhZyA9IG5hbWUoZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBjb250YWlucyhbXG4gICAgICAgICAgJ3NjcmlwdCcsXG4gICAgICAgICAgJ25vc2NyaXB0JyxcbiAgICAgICAgICAnaWZyYW1lJyxcbiAgICAgICAgICAnbm9mcmFtZXMnLFxuICAgICAgICAgICdub2VtYmVkJyxcbiAgICAgICAgICAndGl0bGUnLFxuICAgICAgICAgICdzdHlsZScsXG4gICAgICAgICAgJ3RleHRhcmVhJyxcbiAgICAgICAgICAneG1wJ1xuICAgICAgICBdLCB0YWcpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHVwOiBjb25zdGFudCh7XG4gICAgICAgICAgc2VsZWN0b3I6IGFuY2VzdG9yJDEsXG4gICAgICAgICAgY2xvc2VzdDogY2xvc2VzdCQxLFxuICAgICAgICAgIHByZWRpY2F0ZTogYW5jZXN0b3IsXG4gICAgICAgICAgYWxsOiBwYXJlbnRzXG4gICAgICAgIH0pLFxuICAgICAgICBkb3duOiBjb25zdGFudCh7XG4gICAgICAgICAgc2VsZWN0b3I6IGRlc2NlbmRhbnRzJDEsXG4gICAgICAgICAgcHJlZGljYXRlOiBkZXNjZW5kYW50c1xuICAgICAgICB9KSxcbiAgICAgICAgc3R5bGVzOiBjb25zdGFudCh7XG4gICAgICAgICAgZ2V0OiBnZXQkMyxcbiAgICAgICAgICBnZXRSYXc6IGdldFJhdyxcbiAgICAgICAgICBzZXQ6IHNldCQxLFxuICAgICAgICAgIHJlbW92ZTogcmVtb3ZlJDFcbiAgICAgICAgfSksXG4gICAgICAgIGF0dHJzOiBjb25zdGFudCh7XG4gICAgICAgICAgZ2V0OiBnZXQkMixcbiAgICAgICAgICBzZXQ6IHNldCxcbiAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcbiAgICAgICAgICBjb3B5VG86IGNvcHlBdHRyaWJ1dGVzVG9cbiAgICAgICAgfSksXG4gICAgICAgIGluc2VydDogY29uc3RhbnQoe1xuICAgICAgICAgIGJlZm9yZTogYmVmb3JlLFxuICAgICAgICAgIGFmdGVyOiBhZnRlcixcbiAgICAgICAgICBhZnRlckFsbDogYWZ0ZXIkMSxcbiAgICAgICAgICBhcHBlbmQ6IGFwcGVuZCxcbiAgICAgICAgICBhcHBlbmRBbGw6IGFwcGVuZCQxLFxuICAgICAgICAgIHByZXBlbmQ6IHByZXBlbmQsXG4gICAgICAgICAgd3JhcDogd3JhcFxuICAgICAgICB9KSxcbiAgICAgICAgcmVtb3ZlOiBjb25zdGFudCh7XG4gICAgICAgICAgdW53cmFwOiB1bndyYXAsXG4gICAgICAgICAgcmVtb3ZlOiByZW1vdmUkMlxuICAgICAgICB9KSxcbiAgICAgICAgY3JlYXRlOiBjb25zdGFudCh7XG4gICAgICAgICAgbnU6IFN1Z2FyRWxlbWVudC5mcm9tVGFnLFxuICAgICAgICAgIGNsb25lOiBjbG9uZSQxLFxuICAgICAgICAgIHRleHQ6IFN1Z2FyRWxlbWVudC5mcm9tVGV4dFxuICAgICAgICB9KSxcbiAgICAgICAgcXVlcnk6IGNvbnN0YW50KHtcbiAgICAgICAgICBjb21wYXJlUG9zaXRpb246IGNvbXBhcmVQb3NpdGlvbixcbiAgICAgICAgICBwcmV2U2libGluZzogcHJldlNpYmxpbmcsXG4gICAgICAgICAgbmV4dFNpYmxpbmc6IG5leHRTaWJsaW5nXG4gICAgICAgIH0pLFxuICAgICAgICBwcm9wZXJ0eTogY29uc3RhbnQoe1xuICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbixcbiAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgIHBhcmVudDogcGFyZW50LFxuICAgICAgICAgIGRvY3VtZW50OiBkb2N1bWVudCxcbiAgICAgICAgICBpc1RleHQ6IGlzVGV4dCxcbiAgICAgICAgICBpc0NvbW1lbnQ6IGlzQ29tbWVudCxcbiAgICAgICAgICBpc0VsZW1lbnQ6IGlzRWxlbWVudCxcbiAgICAgICAgICBpc1NwZWNpYWw6IGlzU3BlY2lhbCxcbiAgICAgICAgICBnZXRUZXh0OiBnZXQkNCxcbiAgICAgICAgICBzZXRUZXh0OiBzZXQkMixcbiAgICAgICAgICBpc0JvdW5kYXJ5OiBpc0JvdW5kYXJ5LFxuICAgICAgICAgIGlzRW1wdHlUYWc6IGlzRW1wdHlUYWcsXG4gICAgICAgICAgaXNOb25FZGl0YWJsZTogaXNOb25FZGl0YWJsZVxuICAgICAgICB9KSxcbiAgICAgICAgZXE6IGVxJDEsXG4gICAgICAgIGlzOiBpcyQxXG4gICAgICB9O1xuICAgIH1cblxuICAgIHZhciBhbGwkMSA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgbG9vaywgZWxlbWVudHMsIGYpIHtcbiAgICAgIHZhciBoZWFkID0gZWxlbWVudHNbMF07XG4gICAgICB2YXIgdGFpbCA9IGVsZW1lbnRzLnNsaWNlKDEpO1xuICAgICAgcmV0dXJuIGYodW5pdmVyc2UsIGxvb2ssIGhlYWQsIHRhaWwpO1xuICAgIH07XG4gICAgdmFyIG9uZUFsbCA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgbG9vaywgZWxlbWVudHMpIHtcbiAgICAgIHJldHVybiBlbGVtZW50cy5sZW5ndGggPiAwID8gYWxsJDEodW5pdmVyc2UsIGxvb2ssIGVsZW1lbnRzLCB1bnNhZmVPbmUpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIHVuc2FmZU9uZSA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgbG9vaywgaGVhZCwgdGFpbCkge1xuICAgICAgdmFyIHN0YXJ0ID0gbG9vayh1bml2ZXJzZSwgaGVhZCk7XG4gICAgICByZXR1cm4gZm9sZHIodGFpbCwgZnVuY3Rpb24gKGIsIGEpIHtcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBsb29rKHVuaXZlcnNlLCBhKTtcbiAgICAgICAgcmV0dXJuIGNvbW1vbkVsZW1lbnQodW5pdmVyc2UsIGIsIGN1cnJlbnQpO1xuICAgICAgfSwgc3RhcnQpO1xuICAgIH07XG4gICAgdmFyIGNvbW1vbkVsZW1lbnQgPSBmdW5jdGlvbiAodW5pdmVyc2UsIHN0YXJ0LCBlbmQpIHtcbiAgICAgIHJldHVybiBzdGFydC5iaW5kKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBlbmQuZmlsdGVyKGN1cnJ5KHVuaXZlcnNlLmVxLCBzKSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGVxJDIgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0pIHtcbiAgICAgIHJldHVybiBjdXJyeSh1bml2ZXJzZS5lcSwgaXRlbSk7XG4gICAgfTtcbiAgICB2YXIgYW5jZXN0b3JzJDIgPSBmdW5jdGlvbiAodW5pdmVyc2UsIHN0YXJ0LCBlbmQsIGlzUm9vdCkge1xuICAgICAgaWYgKGlzUm9vdCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGlzUm9vdCA9IG5ldmVyO1xuICAgICAgfVxuICAgICAgdmFyIHBzMSA9IFtzdGFydF0uY29uY2F0KHVuaXZlcnNlLnVwKCkuYWxsKHN0YXJ0KSk7XG4gICAgICB2YXIgcHMyID0gW2VuZF0uY29uY2F0KHVuaXZlcnNlLnVwKCkuYWxsKGVuZCkpO1xuICAgICAgdmFyIHBydW5lID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gZmluZEluZGV4KHBhdGgsIGlzUm9vdCk7XG4gICAgICAgIHJldHVybiBpbmRleC5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcGF0aDtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGluZCkge1xuICAgICAgICAgIHJldHVybiBwYXRoLnNsaWNlKDAsIGluZCArIDEpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgcHJ1bmVkMSA9IHBydW5lKHBzMSk7XG4gICAgICB2YXIgcHJ1bmVkMiA9IHBydW5lKHBzMik7XG4gICAgICB2YXIgc2hhcmVkID0gZmluZChwcnVuZWQxLCBmdW5jdGlvbiAoeCkge1xuICAgICAgICByZXR1cm4gZXhpc3RzKHBydW5lZDIsIGVxJDIodW5pdmVyc2UsIHgpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZmlyc3RwYXRoOiBwcnVuZWQxLFxuICAgICAgICBzZWNvbmRwYXRoOiBwcnVuZWQyLFxuICAgICAgICBzaGFyZWQ6IHNoYXJlZFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNoYXJlZE9uZSA9IG9uZUFsbDtcbiAgICB2YXIgYW5jZXN0b3JzJDMgPSBhbmNlc3RvcnMkMjtcblxuICAgIHZhciB1bml2ZXJzZSA9IERvbVVuaXZlcnNlKCk7XG4gICAgdmFyIHNoYXJlZE9uZSQxID0gZnVuY3Rpb24gKGxvb2ssIGVsZW1lbnRzKSB7XG4gICAgICByZXR1cm4gc2hhcmVkT25lKHVuaXZlcnNlLCBmdW5jdGlvbiAoX3VuaXZlcnNlLCBlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBsb29rKGVsZW1lbnQpO1xuICAgICAgfSwgZWxlbWVudHMpO1xuICAgIH07XG4gICAgdmFyIGFuY2VzdG9ycyQ0ID0gZnVuY3Rpb24gKHN0YXJ0LCBmaW5pc2gsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGFuY2VzdG9ycyQzKHVuaXZlcnNlLCBzdGFydCwgZmluaXNoLCBpc1Jvb3QpO1xuICAgIH07XG5cbiAgICB2YXIgbG9va3VwVGFibGUgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICByZXR1cm4gYW5jZXN0b3IkMShjb250YWluZXIsICd0YWJsZScpO1xuICAgIH07XG4gICAgdmFyIGlkZW50aWZ5ID0gZnVuY3Rpb24gKHN0YXJ0LCBmaW5pc2gsIGlzUm9vdCkge1xuICAgICAgdmFyIGdldElzUm9vdCA9IGZ1bmN0aW9uIChyb290VGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGlzUm9vdCAhPT0gdW5kZWZpbmVkICYmIGlzUm9vdChlbGVtZW50KSB8fCBlcSQxKGVsZW1lbnQsIHJvb3RUYWJsZSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgaWYgKGVxJDEoc3RhcnQsIGZpbmlzaCkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgIGJveGVzOiBPcHRpb25hbC5zb21lKFtzdGFydF0pLFxuICAgICAgICAgIHN0YXJ0OiBzdGFydCxcbiAgICAgICAgICBmaW5pc2g6IGZpbmlzaFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBsb29rdXBUYWJsZShzdGFydCkuYmluZChmdW5jdGlvbiAoc3RhcnRUYWJsZSkge1xuICAgICAgICAgIHJldHVybiBsb29rdXBUYWJsZShmaW5pc2gpLmJpbmQoZnVuY3Rpb24gKGZpbmlzaFRhYmxlKSB7XG4gICAgICAgICAgICBpZiAoZXEkMShzdGFydFRhYmxlLCBmaW5pc2hUYWJsZSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgICAgIGJveGVzOiBpbnRlcmNlcHRzJDEoc3RhcnRUYWJsZSwgc3RhcnQsIGZpbmlzaCksXG4gICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgICAgIGZpbmlzaDogZmluaXNoXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb250YWlucyQyKHN0YXJ0VGFibGUsIGZpbmlzaFRhYmxlKSkge1xuICAgICAgICAgICAgICB2YXIgYW5jZXN0b3JDZWxscyA9IGFuY2VzdG9ycyQxKGZpbmlzaCwgJ3RkLHRoJywgZ2V0SXNSb290KHN0YXJ0VGFibGUpKTtcbiAgICAgICAgICAgICAgdmFyIGZpbmlzaENlbGwgPSBhbmNlc3RvckNlbGxzLmxlbmd0aCA+IDAgPyBhbmNlc3RvckNlbGxzW2FuY2VzdG9yQ2VsbHMubGVuZ3RoIC0gMV0gOiBmaW5pc2g7XG4gICAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgICAgICBib3hlczogbmVzdGVkSW50ZXJjZXB0cyhzdGFydFRhYmxlLCBzdGFydCwgc3RhcnRUYWJsZSwgZmluaXNoLCBmaW5pc2hUYWJsZSksXG4gICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgICAgIGZpbmlzaDogZmluaXNoQ2VsbFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGFpbnMkMihmaW5pc2hUYWJsZSwgc3RhcnRUYWJsZSkpIHtcbiAgICAgICAgICAgICAgdmFyIGFuY2VzdG9yQ2VsbHMgPSBhbmNlc3RvcnMkMShzdGFydCwgJ3RkLHRoJywgZ2V0SXNSb290KGZpbmlzaFRhYmxlKSk7XG4gICAgICAgICAgICAgIHZhciBzdGFydENlbGwgPSBhbmNlc3RvckNlbGxzLmxlbmd0aCA+IDAgPyBhbmNlc3RvckNlbGxzW2FuY2VzdG9yQ2VsbHMubGVuZ3RoIC0gMV0gOiBzdGFydDtcbiAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgICAgIGJveGVzOiBuZXN0ZWRJbnRlcmNlcHRzKGZpbmlzaFRhYmxlLCBzdGFydCwgc3RhcnRUYWJsZSwgZmluaXNoLCBmaW5pc2hUYWJsZSksXG4gICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgICAgIGZpbmlzaDogc3RhcnRDZWxsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGFuY2VzdG9ycyQ0KHN0YXJ0LCBmaW5pc2gpLnNoYXJlZC5iaW5kKGZ1bmN0aW9uIChsY2EpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdCQxKGxjYSwgJ3RhYmxlJywgaXNSb290KS5iaW5kKGZ1bmN0aW9uIChsY2FUYWJsZSkge1xuICAgICAgICAgICAgICAgICAgdmFyIGZpbmlzaEFuY2VzdG9yQ2VsbHMgPSBhbmNlc3RvcnMkMShmaW5pc2gsICd0ZCx0aCcsIGdldElzUm9vdChsY2FUYWJsZSkpO1xuICAgICAgICAgICAgICAgICAgdmFyIGZpbmlzaENlbGwgPSBmaW5pc2hBbmNlc3RvckNlbGxzLmxlbmd0aCA+IDAgPyBmaW5pc2hBbmNlc3RvckNlbGxzW2ZpbmlzaEFuY2VzdG9yQ2VsbHMubGVuZ3RoIC0gMV0gOiBmaW5pc2g7XG4gICAgICAgICAgICAgICAgICB2YXIgc3RhcnRBbmNlc3RvckNlbGxzID0gYW5jZXN0b3JzJDEoc3RhcnQsICd0ZCx0aCcsIGdldElzUm9vdChsY2FUYWJsZSkpO1xuICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0Q2VsbCA9IHN0YXJ0QW5jZXN0b3JDZWxscy5sZW5ndGggPiAwID8gc3RhcnRBbmNlc3RvckNlbGxzW3N0YXJ0QW5jZXN0b3JDZWxscy5sZW5ndGggLSAxXSA6IHN0YXJ0O1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgICAgICAgICBib3hlczogbmVzdGVkSW50ZXJjZXB0cyhsY2FUYWJsZSwgc3RhcnQsIHN0YXJ0VGFibGUsIGZpbmlzaCwgZmluaXNoVGFibGUpLFxuICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRDZWxsLFxuICAgICAgICAgICAgICAgICAgICBmaW5pc2g6IGZpbmlzaENlbGxcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmV0cmlldmUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBzZWxlY3Rvcikge1xuICAgICAgdmFyIHNlbHMgPSBkZXNjZW5kYW50cyQxKGNvbnRhaW5lciwgc2VsZWN0b3IpO1xuICAgICAgcmV0dXJuIHNlbHMubGVuZ3RoID4gMCA/IE9wdGlvbmFsLnNvbWUoc2VscykgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0TGFzdCA9IGZ1bmN0aW9uIChib3hlcywgbGFzdFNlbGVjdGVkU2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBmaW5kKGJveGVzLCBmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgIHJldHVybiBpcyhib3gsIGxhc3RTZWxlY3RlZFNlbGVjdG9yKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldEVkZ2VzID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgZmlyc3RTZWxlY3RlZFNlbGVjdG9yLCBsYXN0U2VsZWN0ZWRTZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGRlc2NlbmRhbnQkMShjb250YWluZXIsIGZpcnN0U2VsZWN0ZWRTZWxlY3RvcikuYmluZChmdW5jdGlvbiAoZmlyc3QpIHtcbiAgICAgICAgcmV0dXJuIGRlc2NlbmRhbnQkMShjb250YWluZXIsIGxhc3RTZWxlY3RlZFNlbGVjdG9yKS5iaW5kKGZ1bmN0aW9uIChsYXN0KSB7XG4gICAgICAgICAgcmV0dXJuIHNoYXJlZE9uZSQxKGxvb2t1cFRhYmxlLCBbXG4gICAgICAgICAgICBmaXJzdCxcbiAgICAgICAgICAgIGxhc3RcbiAgICAgICAgICBdKS5tYXAoZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBmaXJzdDogZmlyc3QsXG4gICAgICAgICAgICAgIGxhc3Q6IGxhc3QsXG4gICAgICAgICAgICAgIHRhYmxlOiB0YWJsZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBleHBhbmRUbyA9IGZ1bmN0aW9uIChmaW5pc2gsIGZpcnN0U2VsZWN0ZWRTZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGFuY2VzdG9yJDEoZmluaXNoLCAndGFibGUnKS5iaW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICByZXR1cm4gZGVzY2VuZGFudCQxKHRhYmxlLCBmaXJzdFNlbGVjdGVkU2VsZWN0b3IpLmJpbmQoZnVuY3Rpb24gKHN0YXJ0KSB7XG4gICAgICAgICAgcmV0dXJuIGlkZW50aWZ5KHN0YXJ0LCBmaW5pc2gpLmJpbmQoZnVuY3Rpb24gKGlkZW50aWZpZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVkLmJveGVzLm1hcChmdW5jdGlvbiAoYm94ZXMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBib3hlczogYm94ZXMsXG4gICAgICAgICAgICAgICAgc3RhcnQ6IGlkZW50aWZpZWQuc3RhcnQsXG4gICAgICAgICAgICAgICAgZmluaXNoOiBpZGVudGlmaWVkLmZpbmlzaFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2hpZnRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoYm94ZXMsIGRlbHRhUm93LCBkZWx0YUNvbHVtbiwgZmlyc3RTZWxlY3RlZFNlbGVjdG9yLCBsYXN0U2VsZWN0ZWRTZWxlY3Rvcikge1xuICAgICAgcmV0dXJuIGdldExhc3QoYm94ZXMsIGxhc3RTZWxlY3RlZFNlbGVjdG9yKS5iaW5kKGZ1bmN0aW9uIChsYXN0KSB7XG4gICAgICAgIHJldHVybiBtb3ZlQnkkMShsYXN0LCBkZWx0YVJvdywgZGVsdGFDb2x1bW4pLmJpbmQoZnVuY3Rpb24gKGZpbmlzaCkge1xuICAgICAgICAgIHJldHVybiBleHBhbmRUbyhmaW5pc2gsIGZpcnN0U2VsZWN0ZWRTZWxlY3Rvcik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZXRyaWV2ZSQxID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiByZXRyaWV2ZShjb250YWluZXIsIHNlbGVjdG9yKTtcbiAgICB9O1xuICAgIHZhciByZXRyaWV2ZUJveCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGZpcnN0U2VsZWN0ZWRTZWxlY3RvciwgbGFzdFNlbGVjdGVkU2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBnZXRFZGdlcyhjb250YWluZXIsIGZpcnN0U2VsZWN0ZWRTZWxlY3RvciwgbGFzdFNlbGVjdGVkU2VsZWN0b3IpLmJpbmQoZnVuY3Rpb24gKGVkZ2VzKSB7XG4gICAgICAgIHZhciBpc1Jvb3QgPSBmdW5jdGlvbiAoYW5jZXN0b3IpIHtcbiAgICAgICAgICByZXR1cm4gZXEkMShjb250YWluZXIsIGFuY2VzdG9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHNlY3Rpb25TZWxlY3RvciA9ICd0aGVhZCx0Zm9vdCx0Ym9keSx0YWJsZSc7XG4gICAgICAgIHZhciBmaXJzdEFuY2VzdG9yID0gYW5jZXN0b3IkMShlZGdlcy5maXJzdCwgc2VjdGlvblNlbGVjdG9yLCBpc1Jvb3QpO1xuICAgICAgICB2YXIgbGFzdEFuY2VzdG9yID0gYW5jZXN0b3IkMShlZGdlcy5sYXN0LCBzZWN0aW9uU2VsZWN0b3IsIGlzUm9vdCk7XG4gICAgICAgIHJldHVybiBmaXJzdEFuY2VzdG9yLmJpbmQoZnVuY3Rpb24gKGZBKSB7XG4gICAgICAgICAgcmV0dXJuIGxhc3RBbmNlc3Rvci5iaW5kKGZ1bmN0aW9uIChsQSkge1xuICAgICAgICAgICAgcmV0dXJuIGVxJDEoZkEsIGxBKSA/IGdldEJveCQxKGVkZ2VzLnRhYmxlLCBlZGdlcy5maXJzdCwgZWRnZXMubGFzdCkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnZW5lcmF0ZSQxID0gZnVuY3Rpb24gKGNhc2VzKSB7XG4gICAgICBpZiAoIWlzQXJyYXkoY2FzZXMpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2FzZXMgbXVzdCBiZSBhbiBhcnJheScpO1xuICAgICAgfVxuICAgICAgaWYgKGNhc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3RoZXJlIG11c3QgYmUgYXQgbGVhc3Qgb25lIGNhc2UnKTtcbiAgICAgIH1cbiAgICAgIHZhciBjb25zdHJ1Y3RvcnMgPSBbXTtcbiAgICAgIHZhciBhZHQgPSB7fTtcbiAgICAgIGVhY2goY2FzZXMsIGZ1bmN0aW9uIChhY2FzZSwgY291bnQpIHtcbiAgICAgICAgdmFyIGtleXMkMSA9IGtleXMoYWNhc2UpO1xuICAgICAgICBpZiAoa2V5cyQxLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignb25lIGFuZCBvbmx5IG9uZSBuYW1lIHBlciBjYXNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGtleSA9IGtleXMkMVswXTtcbiAgICAgICAgdmFyIHZhbHVlID0gYWNhc2Vba2V5XTtcbiAgICAgICAgaWYgKGFkdFtrZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2R1cGxpY2F0ZSBrZXkgZGV0ZWN0ZWQ6JyArIGtleSk7XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnY2F0YScpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Nhbm5vdCBoYXZlIGEgY2FzZSBuYW1lZCBjYXRhIChzb3JyeSknKTtcbiAgICAgICAgfSBlbHNlIGlmICghaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Nhc2UgYXJndW1lbnRzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdHJ1Y3RvcnMucHVzaChrZXkpO1xuICAgICAgICBhZHRba2V5XSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBhcmdMZW5ndGggPSBhcmdzLmxlbmd0aDtcbiAgICAgICAgICBpZiAoYXJnTGVuZ3RoICE9PSB2YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignV3JvbmcgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBjYXNlICcgKyBrZXkgKyAnLiBFeHBlY3RlZCAnICsgdmFsdWUubGVuZ3RoICsgJyAoJyArIHZhbHVlICsgJyksIGdvdCAnICsgYXJnTGVuZ3RoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIG1hdGNoID0gZnVuY3Rpb24gKGJyYW5jaGVzKSB7XG4gICAgICAgICAgICB2YXIgYnJhbmNoS2V5cyA9IGtleXMoYnJhbmNoZXMpO1xuICAgICAgICAgICAgaWYgKGNvbnN0cnVjdG9ycy5sZW5ndGggIT09IGJyYW5jaEtleXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignV3JvbmcgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBtYXRjaC4gRXhwZWN0ZWQ6ICcgKyBjb25zdHJ1Y3RvcnMuam9pbignLCcpICsgJ1xcbkFjdHVhbDogJyArIGJyYW5jaEtleXMuam9pbignLCcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhbGxSZXFkID0gZm9yYWxsKGNvbnN0cnVjdG9ycywgZnVuY3Rpb24gKHJlcUtleSkge1xuICAgICAgICAgICAgICByZXR1cm4gY29udGFpbnMoYnJhbmNoS2V5cywgcmVxS2V5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFhbGxSZXFkKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm90IGFsbCBicmFuY2hlcyB3ZXJlIHNwZWNpZmllZCB3aGVuIHVzaW5nIG1hdGNoLiBTcGVjaWZpZWQ6ICcgKyBicmFuY2hLZXlzLmpvaW4oJywgJykgKyAnXFxuUmVxdWlyZWQ6ICcgKyBjb25zdHJ1Y3RvcnMuam9pbignLCAnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYnJhbmNoZXNba2V5XS5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmb2xkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHZhciBmb2xkQXJncyA9IFtdO1xuICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIGZvbGRBcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGZvbGRBcmdzLmxlbmd0aCAhPT0gY2FzZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXcm9uZyBudW1iZXIgb2YgYXJndW1lbnRzIHRvIGZvbGQuIEV4cGVjdGVkICcgKyBjYXNlcy5sZW5ndGggKyAnLCBnb3QgJyArIGZvbGRBcmdzLmxlbmd0aCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGZvbGRBcmdzW2NvdW50XTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXRjaDogbWF0Y2gsXG4gICAgICAgICAgICBsb2c6IGZ1bmN0aW9uIChsYWJlbCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsYWJlbCwge1xuICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yczogY29uc3RydWN0b3JzLFxuICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBrZXksXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBhcmdzXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhZHQ7XG4gICAgfTtcbiAgICB2YXIgQWR0ID0geyBnZW5lcmF0ZTogZ2VuZXJhdGUkMSB9O1xuXG4gICAgdmFyIHR5cGUkMSA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7IG5vbmU6IFtdIH0sXG4gICAgICB7IG11bHRpcGxlOiBbJ2VsZW1lbnRzJ10gfSxcbiAgICAgIHsgc2luZ2xlOiBbJ2VsZW1lbnQnXSB9XG4gICAgXSk7XG4gICAgdmFyIGNhdGEgPSBmdW5jdGlvbiAoc3ViamVjdCwgb25Ob25lLCBvbk11bHRpcGxlLCBvblNpbmdsZSkge1xuICAgICAgcmV0dXJuIHN1YmplY3QuZm9sZChvbk5vbmUsIG9uTXVsdGlwbGUsIG9uU2luZ2xlKTtcbiAgICB9O1xuICAgIHZhciBub25lJDEgPSB0eXBlJDEubm9uZTtcbiAgICB2YXIgbXVsdGlwbGUgPSB0eXBlJDEubXVsdGlwbGU7XG4gICAgdmFyIHNpbmdsZSA9IHR5cGUkMS5zaW5nbGU7XG5cbiAgICB2YXIgU2VsZWN0aW9ucyA9IGZ1bmN0aW9uIChsYXp5Um9vdCwgZ2V0U3RhcnQsIHNlbGVjdGVkU2VsZWN0b3IpIHtcbiAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZXRyaWV2ZSQxKGxhenlSb290KCksIHNlbGVjdGVkU2VsZWN0b3IpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXRTdGFydCgpLm1hcChzaW5nbGUpLmdldE9yVGh1bmsobm9uZSQxKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGNlbGxzKSB7XG4gICAgICAgICAgcmV0dXJuIG11bHRpcGxlKGNlbGxzKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHsgZ2V0OiBnZXQgfTtcbiAgICB9O1xuXG4gICAgdmFyIGdsb2JhbCA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLlBsdWdpbk1hbmFnZXInKTtcblxuICAgIHZhciBjbG9uZSQxID0gZnVuY3Rpb24gKG9yaWdpbmFsLCBpc0RlZXApIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShvcmlnaW5hbC5kb20uY2xvbmVOb2RlKGlzRGVlcCkpO1xuICAgIH07XG4gICAgdmFyIHNoYWxsb3cgPSBmdW5jdGlvbiAob3JpZ2luYWwpIHtcbiAgICAgIHJldHVybiBjbG9uZSQxKG9yaWdpbmFsLCBmYWxzZSk7XG4gICAgfTtcbiAgICB2YXIgZGVlcCA9IGZ1bmN0aW9uIChvcmlnaW5hbCkge1xuICAgICAgcmV0dXJuIGNsb25lJDEob3JpZ2luYWwsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIHNoYWxsb3dBcyA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgdGFnKSB7XG4gICAgICB2YXIgbnUgPSBTdWdhckVsZW1lbnQuZnJvbVRhZyh0YWcpO1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBjbG9uZShvcmlnaW5hbCk7XG4gICAgICBzZXRBbGwobnUsIGF0dHJpYnV0ZXMpO1xuICAgICAgcmV0dXJuIG51O1xuICAgIH07XG4gICAgdmFyIGNvcHkkMSA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgdGFnKSB7XG4gICAgICB2YXIgbnUgPSBzaGFsbG93QXMob3JpZ2luYWwsIHRhZyk7XG4gICAgICB2YXIgY2xvbmVDaGlsZHJlbiA9IGNoaWxkcmVuKGRlZXAob3JpZ2luYWwpKTtcbiAgICAgIGFwcGVuZCQxKG51LCBjbG9uZUNoaWxkcmVuKTtcbiAgICAgIHJldHVybiBudTtcbiAgICB9O1xuXG4gICAgdmFyIGNhdCA9IGZ1bmN0aW9uIChhcnIpIHtcbiAgICAgIHZhciByID0gW107XG4gICAgICB2YXIgcHVzaCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHIucHVzaCh4KTtcbiAgICAgIH07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBhcnJbaV0uZWFjaChwdXNoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGxpZnQyID0gZnVuY3Rpb24gKG9hLCBvYiwgZikge1xuICAgICAgcmV0dXJuIG9hLmlzU29tZSgpICYmIG9iLmlzU29tZSgpID8gT3B0aW9uYWwuc29tZShmKG9hLmdldE9yRGllKCksIG9iLmdldE9yRGllKCkpKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBiaW5kRnJvbSA9IGZ1bmN0aW9uIChhLCBmKSB7XG4gICAgICByZXR1cm4gYSAhPT0gdW5kZWZpbmVkICYmIGEgIT09IG51bGwgPyBmKGEpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgIH07XG4gICAgdmFyIHNvbWVJZiA9IGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICByZXR1cm4gYiA/IE9wdGlvbmFsLnNvbWUoYSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcblxuICAgIHZhciBEaW1lbnNpb24gPSBmdW5jdGlvbiAobmFtZSwgZ2V0T2Zmc2V0KSB7XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGgpIHtcbiAgICAgICAgaWYgKCFpc051bWJlcihoKSAmJiAhaC5tYXRjaCgvXlswLTldKyQvKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lICsgJy5zZXQgYWNjZXB0cyBvbmx5IHBvc2l0aXZlIGludGVnZXIgdmFsdWVzLiBWYWx1ZSB3YXMgJyArIGgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgICAgaWYgKGlzU3VwcG9ydGVkJDEoZG9tKSkge1xuICAgICAgICAgIGRvbS5zdHlsZVtuYW1lXSA9IGggKyAncHgnO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGdldCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHZhciByID0gZ2V0T2Zmc2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAociA8PSAwIHx8IHIgPT09IG51bGwpIHtcbiAgICAgICAgICB2YXIgY3NzID0gZ2V0JDMoZWxlbWVudCwgbmFtZSk7XG4gICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoY3NzKSB8fCAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRPdXRlciA9IGdldDtcbiAgICAgIHZhciBhZ2dyZWdhdGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgcHJvcGVydGllcykge1xuICAgICAgICByZXR1cm4gZm9sZGwocHJvcGVydGllcywgZnVuY3Rpb24gKGFjYywgcHJvcGVydHkpIHtcbiAgICAgICAgICB2YXIgdmFsID0gZ2V0JDMoZWxlbWVudCwgcHJvcGVydHkpO1xuICAgICAgICAgIHZhciB2YWx1ZSA9IHZhbCA9PT0gdW5kZWZpbmVkID8gMCA6IHBhcnNlSW50KHZhbCwgMTApO1xuICAgICAgICAgIHJldHVybiBpc05hTih2YWx1ZSkgPyBhY2MgOiBhY2MgKyB2YWx1ZTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9O1xuICAgICAgdmFyIG1heCA9IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZSwgcHJvcGVydGllcykge1xuICAgICAgICB2YXIgY3VtdWxhdGl2ZUluY2x1c2lvbnMgPSBhZ2dyZWdhdGUoZWxlbWVudCwgcHJvcGVydGllcyk7XG4gICAgICAgIHZhciBhYnNvbHV0ZU1heCA9IHZhbHVlID4gY3VtdWxhdGl2ZUluY2x1c2lvbnMgPyB2YWx1ZSAtIGN1bXVsYXRpdmVJbmNsdXNpb25zIDogMDtcbiAgICAgICAgcmV0dXJuIGFic29sdXRlTWF4O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNldDogc2V0LFxuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgZ2V0T3V0ZXI6IGdldE91dGVyLFxuICAgICAgICBhZ2dyZWdhdGU6IGFnZ3JlZ2F0ZSxcbiAgICAgICAgbWF4OiBtYXhcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhcGkkMSA9IERpbWVuc2lvbignd2lkdGgnLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLm9mZnNldFdpZHRoO1xuICAgIH0pO1xuICAgIHZhciBnZXQkNSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gYXBpJDEuZ2V0KGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGdldE91dGVyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBhcGkkMS5nZXRPdXRlcihlbGVtZW50KTtcbiAgICB9O1xuXG4gICAgdmFyIGNvbHVtbnMkMSA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIGlzVmFsaWRDZWxsKSB7XG4gICAgICBpZiAoaXNWYWxpZENlbGwgPT09IHZvaWQgMCkge1xuICAgICAgICBpc1ZhbGlkQ2VsbCA9IGFsd2F5cztcbiAgICAgIH1cbiAgICAgIHZhciBncmlkID0gd2FyZWhvdXNlLmdyaWQ7XG4gICAgICB2YXIgY29scyA9IHJhbmdlKGdyaWQuY29sdW1ucywgaWRlbnRpdHkpO1xuICAgICAgdmFyIHJvd3NBcnIgPSByYW5nZShncmlkLnJvd3MsIGlkZW50aXR5KTtcbiAgICAgIHJldHVybiBtYXAoY29scywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICB2YXIgZ2V0QmxvY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGJpbmQocm93c0FyciwgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHJldHVybiBXYXJlaG91c2UuZ2V0QXQod2FyZWhvdXNlLCByLCBjb2wpLmZpbHRlcihmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkZXRhaWwuY29sdW1uID09PSBjb2w7XG4gICAgICAgICAgICB9KS50b0FycmF5KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBpc1ZhbGlkID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgIHJldHVybiBkZXRhaWwuY29sc3BhbiA9PT0gMSAmJiBpc1ZhbGlkQ2VsbChkZXRhaWwuZWxlbWVudCk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBnZXRGYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gV2FyZWhvdXNlLmdldEF0KHdhcmVob3VzZSwgMCwgY29sKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRlY2lkZShnZXRCbG9jaywgaXNWYWxpZCwgZ2V0RmFsbGJhY2spO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZGVjaWRlID0gZnVuY3Rpb24gKGdldEJsb2NrLCBpc1ZhbGlkLCBnZXRGYWxsYmFjaykge1xuICAgICAgdmFyIGluQmxvY2sgPSBnZXRCbG9jaygpO1xuICAgICAgdmFyIHZhbGlkSW5CbG9jayA9IGZpbmQoaW5CbG9jaywgaXNWYWxpZCk7XG4gICAgICB2YXIgZGV0YWlsT3B0aW9uID0gdmFsaWRJbkJsb2NrLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShpbkJsb2NrWzBdKS5vclRodW5rKGdldEZhbGxiYWNrKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRldGFpbE9wdGlvbi5tYXAoZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICByZXR1cm4gZGV0YWlsLmVsZW1lbnQ7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByb3dzJDEgPSBmdW5jdGlvbiAod2FyZWhvdXNlKSB7XG4gICAgICB2YXIgZ3JpZCA9IHdhcmVob3VzZS5ncmlkO1xuICAgICAgdmFyIHJvd3NBcnIgPSByYW5nZShncmlkLnJvd3MsIGlkZW50aXR5KTtcbiAgICAgIHZhciBjb2xzID0gcmFuZ2UoZ3JpZC5jb2x1bW5zLCBpZGVudGl0eSk7XG4gICAgICByZXR1cm4gbWFwKHJvd3NBcnIsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgdmFyIGdldEJsb2NrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBiaW5kKGNvbHMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gV2FyZWhvdXNlLmdldEF0KHdhcmVob3VzZSwgcm93LCBjKS5maWx0ZXIoZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICAgICAgICByZXR1cm4gZGV0YWlsLnJvdyA9PT0gcm93O1xuICAgICAgICAgICAgfSkuZm9sZChjb25zdGFudChbXSksIGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtkZXRhaWxdO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBpc1NpbmdsZSA9IGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICByZXR1cm4gZGV0YWlsLnJvd3NwYW4gPT09IDE7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBnZXRGYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gV2FyZWhvdXNlLmdldEF0KHdhcmVob3VzZSwgcm93LCAwKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRlY2lkZShnZXRCbG9jaywgaXNTaW5nbGUsIGdldEZhbGxiYWNrKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZGVkdWNlID0gZnVuY3Rpb24gKHhzLCBpbmRleCkge1xuICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSB4cy5sZW5ndGggLSAxKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgICB2YXIgY3VycmVudCA9IHhzW2luZGV4XS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJlc3QgPSByZXZlcnNlKHhzLnNsaWNlKDAsIGluZGV4KSk7XG4gICAgICAgIHJldHVybiBmaW5kTWFwKHJlc3QsIGZ1bmN0aW9uIChhLCBpKSB7XG4gICAgICAgICAgcmV0dXJuIGEubWFwKGZ1bmN0aW9uIChhYSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsdWU6IGFhLFxuICAgICAgICAgICAgICBkZWx0YTogaSArIDFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgIHZhbHVlOiBjLFxuICAgICAgICAgIGRlbHRhOiAwXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgbmV4dCA9IHhzW2luZGV4ICsgMV0uZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZXN0ID0geHMuc2xpY2UoaW5kZXggKyAxKTtcbiAgICAgICAgcmV0dXJuIGZpbmRNYXAocmVzdCwgZnVuY3Rpb24gKGEsIGkpIHtcbiAgICAgICAgICByZXR1cm4gYS5tYXAoZnVuY3Rpb24gKGFhKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB2YWx1ZTogYWEsXG4gICAgICAgICAgICAgIGRlbHRhOiBpICsgMVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAobikge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgdmFsdWU6IG4sXG4gICAgICAgICAgZGVsdGE6IDFcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjdXJyZW50LmJpbmQoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgcmV0dXJuIG5leHQubWFwKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgdmFyIGV4dHJhcyA9IG4uZGVsdGEgKyBjLmRlbHRhO1xuICAgICAgICAgIHJldHVybiBNYXRoLmFicyhuLnZhbHVlIC0gYy52YWx1ZSkgLyBleHRyYXM7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBvbkRpcmVjdGlvbiA9IGZ1bmN0aW9uIChpc0x0ciwgaXNSdGwpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZ2V0RGlyZWN0aW9uKGVsZW1lbnQpID09PSAncnRsJyA/IGlzUnRsIDogaXNMdHI7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldERpcmVjdGlvbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZ2V0JDMoZWxlbWVudCwgJ2RpcmVjdGlvbicpID09PSAncnRsJyA/ICdydGwnIDogJ2x0cic7XG4gICAgfTtcblxuICAgIHZhciBhcGkkMiA9IERpbWVuc2lvbignaGVpZ2h0JywgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIHJldHVybiBpbkJvZHkoZWxlbWVudCkgPyBkb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0IDogZG9tLm9mZnNldEhlaWdodDtcbiAgICB9KTtcbiAgICB2YXIgZ2V0JDYgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGFwaSQyLmdldChlbGVtZW50KTtcbiAgICB9O1xuICAgIHZhciBnZXRPdXRlciQxID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBhcGkkMi5nZXRPdXRlcihlbGVtZW50KTtcbiAgICB9O1xuXG4gICAgdmFyIHIgPSBmdW5jdGlvbiAobGVmdCwgdG9wKSB7XG4gICAgICB2YXIgdHJhbnNsYXRlID0gZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIHIobGVmdCArIHgsIHRvcCArIHkpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgIHRvcDogdG9wLFxuICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTdWdhclBvc2l0aW9uID0gcjtcblxuICAgIHZhciBib3hQb3NpdGlvbiA9IGZ1bmN0aW9uIChkb20pIHtcbiAgICAgIHZhciBib3ggPSBkb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICByZXR1cm4gU3VnYXJQb3NpdGlvbihib3gubGVmdCwgYm94LnRvcCk7XG4gICAgfTtcbiAgICB2YXIgZmlyc3REZWZpbmVkT3JaZXJvID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIGlmIChhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYiAhPT0gdW5kZWZpbmVkID8gYiA6IDA7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgYWJzb2x1dGUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGRvYyA9IGVsZW1lbnQuZG9tLm93bmVyRG9jdW1lbnQ7XG4gICAgICB2YXIgYm9keSA9IGRvYy5ib2R5O1xuICAgICAgdmFyIHdpbiA9IGRvYy5kZWZhdWx0VmlldztcbiAgICAgIHZhciBodG1sID0gZG9jLmRvY3VtZW50RWxlbWVudDtcbiAgICAgIGlmIChib2R5ID09PSBlbGVtZW50LmRvbSkge1xuICAgICAgICByZXR1cm4gU3VnYXJQb3NpdGlvbihib2R5Lm9mZnNldExlZnQsIGJvZHkub2Zmc2V0VG9wKTtcbiAgICAgIH1cbiAgICAgIHZhciBzY3JvbGxUb3AgPSBmaXJzdERlZmluZWRPclplcm8od2luID09PSBudWxsIHx8IHdpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2luLnBhZ2VZT2Zmc2V0LCBodG1sLnNjcm9sbFRvcCk7XG4gICAgICB2YXIgc2Nyb2xsTGVmdCA9IGZpcnN0RGVmaW5lZE9yWmVybyh3aW4gPT09IG51bGwgfHwgd2luID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aW4ucGFnZVhPZmZzZXQsIGh0bWwuc2Nyb2xsTGVmdCk7XG4gICAgICB2YXIgY2xpZW50VG9wID0gZmlyc3REZWZpbmVkT3JaZXJvKGh0bWwuY2xpZW50VG9wLCBib2R5LmNsaWVudFRvcCk7XG4gICAgICB2YXIgY2xpZW50TGVmdCA9IGZpcnN0RGVmaW5lZE9yWmVybyhodG1sLmNsaWVudExlZnQsIGJvZHkuY2xpZW50TGVmdCk7XG4gICAgICByZXR1cm4gdmlld3BvcnQoZWxlbWVudCkudHJhbnNsYXRlKHNjcm9sbExlZnQgLSBjbGllbnRMZWZ0LCBzY3JvbGxUb3AgLSBjbGllbnRUb3ApO1xuICAgIH07XG4gICAgdmFyIHZpZXdwb3J0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBkb20gPSBlbGVtZW50LmRvbTtcbiAgICAgIHZhciBkb2MgPSBkb20ub3duZXJEb2N1bWVudDtcbiAgICAgIHZhciBib2R5ID0gZG9jLmJvZHk7XG4gICAgICBpZiAoYm9keSA9PT0gZG9tKSB7XG4gICAgICAgIHJldHVybiBTdWdhclBvc2l0aW9uKGJvZHkub2Zmc2V0TGVmdCwgYm9keS5vZmZzZXRUb3ApO1xuICAgICAgfVxuICAgICAgaWYgKCFpbkJvZHkoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24oMCwgMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYm94UG9zaXRpb24oZG9tKTtcbiAgICB9O1xuXG4gICAgdmFyIHJvd0luZm8gPSBmdW5jdGlvbiAocm93LCB5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByb3c6IHJvdyxcbiAgICAgICAgeTogeVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjb2xJbmZvID0gZnVuY3Rpb24gKGNvbCwgeCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29sOiBjb2wsXG4gICAgICAgIHg6IHhcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcnRsRWRnZSA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICB2YXIgcG9zID0gYWJzb2x1dGUoY2VsbCk7XG4gICAgICByZXR1cm4gcG9zLmxlZnQgKyBnZXRPdXRlcihjZWxsKTtcbiAgICB9O1xuICAgIHZhciBsdHJFZGdlID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiBhYnNvbHV0ZShjZWxsKS5sZWZ0O1xuICAgIH07XG4gICAgdmFyIGdldExlZnRFZGdlID0gZnVuY3Rpb24gKGluZGV4LCBjZWxsKSB7XG4gICAgICByZXR1cm4gY29sSW5mbyhpbmRleCwgbHRyRWRnZShjZWxsKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UmlnaHRFZGdlID0gZnVuY3Rpb24gKGluZGV4LCBjZWxsKSB7XG4gICAgICByZXR1cm4gY29sSW5mbyhpbmRleCwgcnRsRWRnZShjZWxsKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VG9wID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiBhYnNvbHV0ZShjZWxsKS50b3A7XG4gICAgfTtcbiAgICB2YXIgZ2V0VG9wRWRnZSA9IGZ1bmN0aW9uIChpbmRleCwgY2VsbCkge1xuICAgICAgcmV0dXJuIHJvd0luZm8oaW5kZXgsIGdldFRvcChjZWxsKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Qm90dG9tRWRnZSA9IGZ1bmN0aW9uIChpbmRleCwgY2VsbCkge1xuICAgICAgcmV0dXJuIHJvd0luZm8oaW5kZXgsIGdldFRvcChjZWxsKSArIGdldE91dGVyJDEoY2VsbCkpO1xuICAgIH07XG4gICAgdmFyIGZpbmRQb3NpdGlvbnMgPSBmdW5jdGlvbiAoZ2V0SW5uZXJFZGdlLCBnZXRPdXRlckVkZ2UsIGFycmF5KSB7XG4gICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHZhciBsaW5lcyA9IG1hcChhcnJheS5zbGljZSgxKSwgZnVuY3Rpb24gKGNlbGxPcHRpb24sIGluZGV4KSB7XG4gICAgICAgIHJldHVybiBjZWxsT3B0aW9uLm1hcChmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIHJldHVybiBnZXRJbm5lckVkZ2UoaW5kZXgsIGNlbGwpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGxhc3RMaW5lID0gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV0ubWFwKGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgIHJldHVybiBnZXRPdXRlckVkZ2UoYXJyYXkubGVuZ3RoIC0gMSwgY2VsbCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBsaW5lcy5jb25jYXQoW2xhc3RMaW5lXSk7XG4gICAgfTtcbiAgICB2YXIgbmVnYXRlID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHJldHVybiAtc3RlcDtcbiAgICB9O1xuICAgIHZhciBoZWlnaHQgPSB7XG4gICAgICBkZWx0YTogaWRlbnRpdHksXG4gICAgICBwb3NpdGlvbnM6IGZ1bmN0aW9uIChvcHRFbGVtZW50cykge1xuICAgICAgICByZXR1cm4gZmluZFBvc2l0aW9ucyhnZXRUb3BFZGdlLCBnZXRCb3R0b21FZGdlLCBvcHRFbGVtZW50cyk7XG4gICAgICB9LFxuICAgICAgZWRnZTogZ2V0VG9wXG4gICAgfTtcbiAgICB2YXIgbHRyID0ge1xuICAgICAgZGVsdGE6IGlkZW50aXR5LFxuICAgICAgZWRnZTogbHRyRWRnZSxcbiAgICAgIHBvc2l0aW9uczogZnVuY3Rpb24gKG9wdEVsZW1lbnRzKSB7XG4gICAgICAgIHJldHVybiBmaW5kUG9zaXRpb25zKGdldExlZnRFZGdlLCBnZXRSaWdodEVkZ2UsIG9wdEVsZW1lbnRzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBydGwgPSB7XG4gICAgICBkZWx0YTogbmVnYXRlLFxuICAgICAgZWRnZTogcnRsRWRnZSxcbiAgICAgIHBvc2l0aW9uczogZnVuY3Rpb24gKG9wdEVsZW1lbnRzKSB7XG4gICAgICAgIHJldHVybiBmaW5kUG9zaXRpb25zKGdldFJpZ2h0RWRnZSwgZ2V0TGVmdEVkZ2UsIG9wdEVsZW1lbnRzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBkZXRlY3QkNCA9IG9uRGlyZWN0aW9uKGx0ciwgcnRsKTtcbiAgICB2YXIgd2lkdGggPSB7XG4gICAgICBkZWx0YTogZnVuY3Rpb24gKGFtb3VudCwgdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGRldGVjdCQ0KHRhYmxlKS5kZWx0YShhbW91bnQsIHRhYmxlKTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbnM6IGZ1bmN0aW9uIChjb2xzLCB0YWJsZSkge1xuICAgICAgICByZXR1cm4gZGV0ZWN0JDQodGFibGUpLnBvc2l0aW9ucyhjb2xzLCB0YWJsZSk7XG4gICAgICB9LFxuICAgICAgZWRnZTogZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGRldGVjdCQ0KGNlbGwpLmVkZ2UoY2VsbCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciB1bml0cyA9IHtcbiAgICAgIHVuc3VwcG9ydGVkTGVuZ3RoOiBbXG4gICAgICAgICdlbScsXG4gICAgICAgICdleCcsXG4gICAgICAgICdjYXAnLFxuICAgICAgICAnY2gnLFxuICAgICAgICAnaWMnLFxuICAgICAgICAncmVtJyxcbiAgICAgICAgJ2xoJyxcbiAgICAgICAgJ3JsaCcsXG4gICAgICAgICd2dycsXG4gICAgICAgICd2aCcsXG4gICAgICAgICd2aScsXG4gICAgICAgICd2YicsXG4gICAgICAgICd2bWluJyxcbiAgICAgICAgJ3ZtYXgnLFxuICAgICAgICAnY20nLFxuICAgICAgICAnbW0nLFxuICAgICAgICAnUScsXG4gICAgICAgICdpbicsXG4gICAgICAgICdwYycsXG4gICAgICAgICdwdCcsXG4gICAgICAgICdweCdcbiAgICAgIF0sXG4gICAgICBmaXhlZDogW1xuICAgICAgICAncHgnLFxuICAgICAgICAncHQnXG4gICAgICBdLFxuICAgICAgcmVsYXRpdmU6IFsnJSddLFxuICAgICAgZW1wdHk6IFsnJ11cbiAgICB9O1xuICAgIHZhciBwYXR0ZXJuID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRlY2ltYWxEaWdpdHMgPSAnWzAtOV0rJztcbiAgICAgIHZhciBzaWduZWRJbnRlZ2VyID0gJ1srLV0/JyArIGRlY2ltYWxEaWdpdHM7XG4gICAgICB2YXIgZXhwb25lbnRQYXJ0ID0gJ1tlRV0nICsgc2lnbmVkSW50ZWdlcjtcbiAgICAgIHZhciBkb3QgPSAnXFxcXC4nO1xuICAgICAgdmFyIG9wdCA9IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICByZXR1cm4gJyg/OicgKyBpbnB1dCArICcpPyc7XG4gICAgICB9O1xuICAgICAgdmFyIHVuc2lnbmVkRGVjaW1hbExpdGVyYWwgPSBbXG4gICAgICAgICdJbmZpbml0eScsXG4gICAgICAgIGRlY2ltYWxEaWdpdHMgKyBkb3QgKyBvcHQoZGVjaW1hbERpZ2l0cykgKyBvcHQoZXhwb25lbnRQYXJ0KSxcbiAgICAgICAgZG90ICsgZGVjaW1hbERpZ2l0cyArIG9wdChleHBvbmVudFBhcnQpLFxuICAgICAgICBkZWNpbWFsRGlnaXRzICsgb3B0KGV4cG9uZW50UGFydClcbiAgICAgIF0uam9pbignfCcpO1xuICAgICAgdmFyIGZsb2F0ID0gJ1srLV0/KD86JyArIHVuc2lnbmVkRGVjaW1hbExpdGVyYWwgKyAnKSc7XG4gICAgICByZXR1cm4gbmV3IFJlZ0V4cCgnXignICsgZmxvYXQgKyAnKSguKikkJyk7XG4gICAgfSgpO1xuICAgIHZhciBpc1VuaXQgPSBmdW5jdGlvbiAodW5pdCwgYWNjZXB0ZWQpIHtcbiAgICAgIHJldHVybiBleGlzdHMoYWNjZXB0ZWQsIGZ1bmN0aW9uIChhY2MpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0cyh1bml0c1thY2NdLCBmdW5jdGlvbiAoY2hlY2spIHtcbiAgICAgICAgICByZXR1cm4gdW5pdCA9PT0gY2hlY2s7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcGFyc2UgPSBmdW5jdGlvbiAoaW5wdXQsIGFjY2VwdGVkKSB7XG4gICAgICB2YXIgbWF0Y2ggPSBPcHRpb25hbC5mcm9tKHBhdHRlcm4uZXhlYyhpbnB1dCkpO1xuICAgICAgcmV0dXJuIG1hdGNoLmJpbmQoZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IE51bWJlcihhcnJheVsxXSk7XG4gICAgICAgIHZhciB1bml0UmF3ID0gYXJyYXlbMl07XG4gICAgICAgIGlmIChpc1VuaXQodW5pdFJhdywgYWNjZXB0ZWQpKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgdW5pdDogdW5pdFJhd1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgbmVlZE1hbnVhbENhbGMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYnJvd3NlciA9IGRldGVjdCQzKCkuYnJvd3NlcjtcbiAgICAgIHJldHVybiBicm93c2VyLmlzSUUoKSB8fCBicm93c2VyLmlzRWRnZSgpO1xuICAgIH07XG4gICAgdmFyIHRvTnVtYmVyID0gZnVuY3Rpb24gKHB4LCBmYWxsYmFjaykge1xuICAgICAgdmFyIG51bSA9IHBhcnNlRmxvYXQocHgpO1xuICAgICAgcmV0dXJuIGlzTmFOKG51bSkgPyBmYWxsYmFjayA6IG51bTtcbiAgICB9O1xuICAgIHZhciBnZXRQcm9wID0gZnVuY3Rpb24gKGVsbSwgbmFtZSwgZmFsbGJhY2spIHtcbiAgICAgIHJldHVybiB0b051bWJlcihnZXQkMyhlbG0sIG5hbWUpLCBmYWxsYmFjayk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2FsY3VsYXRlZEhlaWdodCA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICB2YXIgaGVpZ2h0ID0gY2VsbC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgdmFyIGJveFNpemluZyA9IGdldCQzKGNlbGwsICdib3gtc2l6aW5nJyk7XG4gICAgICBpZiAoYm94U2l6aW5nID09PSAnYm9yZGVyLWJveCcpIHtcbiAgICAgICAgcmV0dXJuIGhlaWdodDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBwYWRkaW5nVG9wID0gZ2V0UHJvcChjZWxsLCAncGFkZGluZy10b3AnLCAwKTtcbiAgICAgICAgdmFyIHBhZGRpbmdCb3R0b20gPSBnZXRQcm9wKGNlbGwsICdwYWRkaW5nLWJvdHRvbScsIDApO1xuICAgICAgICB2YXIgYm9yZGVyVG9wID0gZ2V0UHJvcChjZWxsLCAnYm9yZGVyLXRvcC13aWR0aCcsIDApO1xuICAgICAgICB2YXIgYm9yZGVyQm90dG9tID0gZ2V0UHJvcChjZWxsLCAnYm9yZGVyLWJvdHRvbS13aWR0aCcsIDApO1xuICAgICAgICB2YXIgYm9yZGVycyA9IGJvcmRlclRvcCArIGJvcmRlckJvdHRvbTtcbiAgICAgICAgcmV0dXJuIGhlaWdodCAtIHBhZGRpbmdUb3AgLSBwYWRkaW5nQm90dG9tIC0gYm9yZGVycztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRDYWxjdWxhdGVkV2lkdGggPSBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgdmFyIHdpZHRoID0gY2VsbC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICB2YXIgYm94U2l6aW5nID0gZ2V0JDMoY2VsbCwgJ2JveC1zaXppbmcnKTtcbiAgICAgIGlmIChib3hTaXppbmcgPT09ICdib3JkZXItYm94Jykge1xuICAgICAgICByZXR1cm4gd2lkdGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcGFkZGluZ0xlZnQgPSBnZXRQcm9wKGNlbGwsICdwYWRkaW5nLWxlZnQnLCAwKTtcbiAgICAgICAgdmFyIHBhZGRpbmdSaWdodCA9IGdldFByb3AoY2VsbCwgJ3BhZGRpbmctcmlnaHQnLCAwKTtcbiAgICAgICAgdmFyIGJvcmRlckxlZnQgPSBnZXRQcm9wKGNlbGwsICdib3JkZXItbGVmdC13aWR0aCcsIDApO1xuICAgICAgICB2YXIgYm9yZGVyUmlnaHQgPSBnZXRQcm9wKGNlbGwsICdib3JkZXItcmlnaHQtd2lkdGgnLCAwKTtcbiAgICAgICAgdmFyIGJvcmRlcnMgPSBib3JkZXJMZWZ0ICsgYm9yZGVyUmlnaHQ7XG4gICAgICAgIHJldHVybiB3aWR0aCAtIHBhZGRpbmdMZWZ0IC0gcGFkZGluZ1JpZ2h0IC0gYm9yZGVycztcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZXRIZWlnaHQgPSBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgcmV0dXJuIG5lZWRNYW51YWxDYWxjKCkgPyBnZXRDYWxjdWxhdGVkSGVpZ2h0KGNlbGwpIDogZ2V0UHJvcChjZWxsLCAnaGVpZ2h0JywgZ2V0JDYoY2VsbCkpO1xuICAgIH07XG4gICAgdmFyIGdldFdpZHRoID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiBuZWVkTWFudWFsQ2FsYygpID8gZ2V0Q2FsY3VsYXRlZFdpZHRoKGNlbGwpIDogZ2V0UHJvcChjZWxsLCAnd2lkdGgnLCBnZXQkNShjZWxsKSk7XG4gICAgfTtcblxuICAgIHZhciByUGVyY2VudGFnZUJhc2VkU2l6ZVJlZ2V4ID0gLyhcXGQrKFxcLlxcZCspPyklLztcbiAgICB2YXIgclBpeGVsQmFzZWRTaXplUmVnZXggPSAvKFxcZCsoXFwuXFxkKyk/KXB4fGVtLztcbiAgICB2YXIgZ2V0UGVyY2VudFNpemUgPSBmdW5jdGlvbiAoZWxtLCBnZXR0ZXIpIHtcbiAgICAgIHZhciByZWxhdGl2ZVBhcmVudCA9IG9mZnNldFBhcmVudChlbG0pLmdldE9yKGdldEJvZHkob3duZXIoZWxtKSkpO1xuICAgICAgcmV0dXJuIGdldHRlcihlbG0pIC8gZ2V0dGVyKHJlbGF0aXZlUGFyZW50KSAqIDEwMDtcbiAgICB9O1xuICAgIHZhciBzZXRQaXhlbFdpZHRoID0gZnVuY3Rpb24gKGNlbGwsIGFtb3VudCkge1xuICAgICAgc2V0JDEoY2VsbCwgJ3dpZHRoJywgYW1vdW50ICsgJ3B4Jyk7XG4gICAgfTtcbiAgICB2YXIgc2V0UGVyY2VudGFnZVdpZHRoID0gZnVuY3Rpb24gKGNlbGwsIGFtb3VudCkge1xuICAgICAgc2V0JDEoY2VsbCwgJ3dpZHRoJywgYW1vdW50ICsgJyUnKTtcbiAgICB9O1xuICAgIHZhciBzZXRIZWlnaHQgPSBmdW5jdGlvbiAoY2VsbCwgYW1vdW50KSB7XG4gICAgICBzZXQkMShjZWxsLCAnaGVpZ2h0JywgYW1vdW50ICsgJ3B4Jyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SGVpZ2h0VmFsdWUgPSBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgcmV0dXJuIGdldFJhdyhjZWxsLCAnaGVpZ2h0JykuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnZXRIZWlnaHQoY2VsbCkgKyAncHgnO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY29udmVydCA9IGZ1bmN0aW9uIChjZWxsLCBudW1iZXIsIGdldHRlciwgc2V0dGVyKSB7XG4gICAgICB2YXIgbmV3U2l6ZSA9IHRhYmxlKGNlbGwpLm1hcChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgdmFyIHRvdGFsID0gZ2V0dGVyKHRhYmxlKTtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobnVtYmVyIC8gMTAwICogdG90YWwpO1xuICAgICAgfSkuZ2V0T3IobnVtYmVyKTtcbiAgICAgIHNldHRlcihjZWxsLCBuZXdTaXplKTtcbiAgICAgIHJldHVybiBuZXdTaXplO1xuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZVBpeGVsU2l6ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgY2VsbCwgZ2V0dGVyLCBzZXR0ZXIpIHtcbiAgICAgIHZhciBudW1iZXIgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuICAgICAgcmV0dXJuIGVuZHNXaXRoKHZhbHVlLCAnJScpICYmIG5hbWUoY2VsbCkgIT09ICd0YWJsZScgPyBjb252ZXJ0KGNlbGwsIG51bWJlciwgZ2V0dGVyLCBzZXR0ZXIpIDogbnVtYmVyO1xuICAgIH07XG4gICAgdmFyIGdldFRvdGFsSGVpZ2h0ID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHZhciB2YWx1ZSA9IGdldEhlaWdodFZhbHVlKGNlbGwpO1xuICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICByZXR1cm4gZ2V0JDYoY2VsbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9ybWFsaXplUGl4ZWxTaXplKHZhbHVlLCBjZWxsLCBnZXQkNiwgc2V0SGVpZ2h0KTtcbiAgICB9O1xuICAgIHZhciBnZXQkNyA9IGZ1bmN0aW9uIChjZWxsLCB0eXBlLCBmKSB7XG4gICAgICB2YXIgdiA9IGYoY2VsbCk7XG4gICAgICB2YXIgc3BhbiA9IGdldFNwYW4oY2VsbCwgdHlwZSk7XG4gICAgICByZXR1cm4gdiAvIHNwYW47XG4gICAgfTtcbiAgICB2YXIgZ2V0UmF3V2lkdGggPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGNzc1dpZHRoID0gZ2V0UmF3KGVsZW1lbnQsICd3aWR0aCcpO1xuICAgICAgcmV0dXJuIGNzc1dpZHRoLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShnZXQkMihlbGVtZW50LCAnd2lkdGgnKSk7XG4gICAgICB9LCBmdW5jdGlvbiAod2lkdGgpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUod2lkdGgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbm9ybWFsaXplUGVyY2VudGFnZVdpZHRoID0gZnVuY3Rpb24gKGNlbGxXaWR0aCwgdGFibGVTaXplKSB7XG4gICAgICByZXR1cm4gY2VsbFdpZHRoIC8gdGFibGVTaXplLnBpeGVsV2lkdGgoKSAqIDEwMDtcbiAgICB9O1xuICAgIHZhciBjaG9vc2VQZXJjZW50YWdlU2l6ZSA9IGZ1bmN0aW9uIChlbGVtZW50LCB3aWR0aCwgdGFibGVTaXplKSB7XG4gICAgICB2YXIgcGVyY2VudE1hdGNoID0gclBlcmNlbnRhZ2VCYXNlZFNpemVSZWdleC5leGVjKHdpZHRoKTtcbiAgICAgIGlmIChwZXJjZW50TWF0Y2ggIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQocGVyY2VudE1hdGNoWzFdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBpbnRXaWR0aCA9IGdldFdpZHRoKGVsZW1lbnQpO1xuICAgICAgICByZXR1cm4gbm9ybWFsaXplUGVyY2VudGFnZVdpZHRoKGludFdpZHRoLCB0YWJsZVNpemUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGdldFBlcmNlbnRhZ2VXaWR0aCA9IGZ1bmN0aW9uIChjZWxsLCB0YWJsZVNpemUpIHtcbiAgICAgIHZhciB3aWR0aCA9IGdldFJhd1dpZHRoKGNlbGwpO1xuICAgICAgcmV0dXJuIHdpZHRoLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaW50V2lkdGggPSBnZXQkNShjZWxsKTtcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVBlcmNlbnRhZ2VXaWR0aChpbnRXaWR0aCwgdGFibGVTaXplKTtcbiAgICAgIH0sIGZ1bmN0aW9uICh3KSB7XG4gICAgICAgIHJldHVybiBjaG9vc2VQZXJjZW50YWdlU2l6ZShjZWxsLCB3LCB0YWJsZVNpemUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbm9ybWFsaXplUGl4ZWxXaWR0aCA9IGZ1bmN0aW9uIChjZWxsV2lkdGgsIHRhYmxlU2l6ZSkge1xuICAgICAgcmV0dXJuIGNlbGxXaWR0aCAvIDEwMCAqIHRhYmxlU2l6ZS5waXhlbFdpZHRoKCk7XG4gICAgfTtcbiAgICB2YXIgY2hvb3NlUGl4ZWxTaXplID0gZnVuY3Rpb24gKGVsZW1lbnQsIHdpZHRoLCB0YWJsZVNpemUpIHtcbiAgICAgIHZhciBwaXhlbE1hdGNoID0gclBpeGVsQmFzZWRTaXplUmVnZXguZXhlYyh3aWR0aCk7XG4gICAgICBpZiAocGl4ZWxNYXRjaCAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQocGl4ZWxNYXRjaFsxXSwgMTApO1xuICAgICAgfVxuICAgICAgdmFyIHBlcmNlbnRNYXRjaCA9IHJQZXJjZW50YWdlQmFzZWRTaXplUmVnZXguZXhlYyh3aWR0aCk7XG4gICAgICBpZiAocGVyY2VudE1hdGNoICE9PSBudWxsKSB7XG4gICAgICAgIHZhciBmbG9hdFdpZHRoID0gcGFyc2VGbG9hdChwZXJjZW50TWF0Y2hbMV0pO1xuICAgICAgICByZXR1cm4gbm9ybWFsaXplUGl4ZWxXaWR0aChmbG9hdFdpZHRoLCB0YWJsZVNpemUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdldFdpZHRoKGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGdldFBpeGVsV2lkdGggPSBmdW5jdGlvbiAoY2VsbCwgdGFibGVTaXplKSB7XG4gICAgICB2YXIgd2lkdGggPSBnZXRSYXdXaWR0aChjZWxsKTtcbiAgICAgIHJldHVybiB3aWR0aC5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldFdpZHRoKGNlbGwpO1xuICAgICAgfSwgZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgcmV0dXJuIGNob29zZVBpeGVsU2l6ZShjZWxsLCB3LCB0YWJsZVNpemUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SGVpZ2h0JDEgPSBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgcmV0dXJuIGdldCQ3KGNlbGwsICdyb3dzcGFuJywgZ2V0VG90YWxIZWlnaHQpO1xuICAgIH07XG4gICAgdmFyIGdldEdlbmVyaWNXaWR0aCA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICB2YXIgd2lkdGggPSBnZXRSYXdXaWR0aChjZWxsKTtcbiAgICAgIHJldHVybiB3aWR0aC5iaW5kKGZ1bmN0aW9uICh3KSB7XG4gICAgICAgIHJldHVybiBwYXJzZSh3LCBbXG4gICAgICAgICAgJ2ZpeGVkJyxcbiAgICAgICAgICAncmVsYXRpdmUnLFxuICAgICAgICAgICdlbXB0eSdcbiAgICAgICAgXSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzZXRHZW5lcmljV2lkdGggPSBmdW5jdGlvbiAoY2VsbCwgYW1vdW50LCB1bml0KSB7XG4gICAgICBzZXQkMShjZWxsLCAnd2lkdGgnLCBhbW91bnQgKyB1bml0KTtcbiAgICB9O1xuICAgIHZhciBnZXRQaXhlbFRhYmxlV2lkdGggPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgIHJldHVybiBnZXQkNSh0YWJsZSkgKyAncHgnO1xuICAgIH07XG4gICAgdmFyIGdldFBlcmNlbnRUYWJsZVdpZHRoID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICByZXR1cm4gZ2V0UGVyY2VudFNpemUodGFibGUsIGdldCQ1KSArICclJztcbiAgICB9O1xuICAgIHZhciBpc1BlcmNlbnRTaXppbmcgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgIHJldHVybiBnZXRSYXdXaWR0aCh0YWJsZSkuZXhpc3RzKGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgIHJldHVybiByUGVyY2VudGFnZUJhc2VkU2l6ZVJlZ2V4LnRlc3Qoc2l6ZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpc1BpeGVsU2l6aW5nID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICByZXR1cm4gZ2V0UmF3V2lkdGgodGFibGUpLmV4aXN0cyhmdW5jdGlvbiAoc2l6ZSkge1xuICAgICAgICByZXR1cm4gclBpeGVsQmFzZWRTaXplUmVnZXgudGVzdChzaXplKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzTm9uZVNpemluZyA9IGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgcmV0dXJuIGdldFJhd1dpZHRoKHRhYmxlKS5pc05vbmUoKTtcbiAgICB9O1xuICAgIHZhciBwZXJjZW50YWdlQmFzZWRTaXplUmVnZXggPSBjb25zdGFudChyUGVyY2VudGFnZUJhc2VkU2l6ZVJlZ2V4KTtcbiAgICB2YXIgcGl4ZWxCYXNlZFNpemVSZWdleCA9IGNvbnN0YW50KHJQaXhlbEJhc2VkU2l6ZVJlZ2V4KTtcblxuICAgIHZhciBpc0NvbCA9IGlzVGFnKCdjb2wnKTtcbiAgICB2YXIgZ2V0UmF3JDEgPSBmdW5jdGlvbiAoY2VsbCwgcHJvcGVydHksIGdldHRlcikge1xuICAgICAgcmV0dXJuIGdldFJhdyhjZWxsLCBwcm9wZXJ0eSkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnZXR0ZXIoY2VsbCkgKyAncHgnO1xuICAgICAgfSwgZnVuY3Rpb24gKHJhdykge1xuICAgICAgICByZXR1cm4gcmF3O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UmF3VyA9IGZ1bmN0aW9uIChjZWxsLCB0YWJsZVNpemUpIHtcbiAgICAgIHZhciBmYWxsYmFjayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBpc0NvbChlKSA/IGdldCQ1KGUpIDogZ2V0UGl4ZWxXaWR0aChlLCB0YWJsZVNpemUpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBnZXRSYXckMShjZWxsLCAnd2lkdGgnLCBmYWxsYmFjayk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UmF3SCA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICByZXR1cm4gZ2V0UmF3JDEoY2VsbCwgJ2hlaWdodCcsIGdldEhlaWdodCQxKTtcbiAgICB9O1xuICAgIHZhciBqdXN0Q29scyA9IGZ1bmN0aW9uICh3YXJlaG91c2UpIHtcbiAgICAgIHJldHVybiBtYXAoV2FyZWhvdXNlLmp1c3RDb2x1bW5zKHdhcmVob3VzZSksIGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oY29sdW1uLmVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaGFzUmF3U3R5bGUgPSBmdW5jdGlvbiAoY2VsbCwgcHJvcCkge1xuICAgICAgcmV0dXJuIGdldFJhdyhjZWxsLCBwcm9wKS5pc1NvbWUoKTtcbiAgICB9O1xuICAgIHZhciBpc1ZhbGlkQ29sdW1uID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiAhaXNDb2woY2VsbCkgfHwgaGFzUmF3U3R5bGUoY2VsbCwgJ3dpZHRoJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGltZW5zaW9uID0gZnVuY3Rpb24gKGNlbGxPcHQsIGluZGV4LCBiYWNrdXBzLCBmaWx0ZXIsIGdldHRlciwgZmFsbGJhY2spIHtcbiAgICAgIHJldHVybiBjZWxsT3B0LmZpbHRlcihmaWx0ZXIpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsbGJhY2soZGVkdWNlKGJhY2t1cHMsIGluZGV4KSk7XG4gICAgICB9LCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICByZXR1cm4gZ2V0dGVyKGNlbGwpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0V2lkdGhGcm9tID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgdGFibGUsIGdldFdpZHRoLCBmYWxsYmFjaywgdGFibGVTaXplKSB7XG4gICAgICB2YXIgY29sdW1uQ2VsbHMgPSBjb2x1bW5zJDEod2FyZWhvdXNlLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICByZXR1cm4gaGFzUmF3U3R5bGUoY2VsbCwgJ3dpZHRoJyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBjb2x1bW5zID0gV2FyZWhvdXNlLmhhc0NvbHVtbnMod2FyZWhvdXNlKSA/IGp1c3RDb2xzKHdhcmVob3VzZSkgOiBjb2x1bW5DZWxscztcbiAgICAgIHZhciBiYWNrdXBzID0gW09wdGlvbmFsLnNvbWUod2lkdGguZWRnZSh0YWJsZSkpXS5jb25jYXQobWFwKHdpZHRoLnBvc2l0aW9ucyhjb2x1bW5DZWxscywgdGFibGUpLCBmdW5jdGlvbiAocG9zKSB7XG4gICAgICAgIHJldHVybiBwb3MubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgcmV0dXJuIHAueDtcbiAgICAgICAgfSk7XG4gICAgICB9KSk7XG4gICAgICB2YXIgY29sRmlsdGVyID0gbm90KGhhc0NvbHNwYW4pO1xuICAgICAgcmV0dXJuIG1hcChjb2x1bW5zLCBmdW5jdGlvbiAoY2VsbE9wdGlvbiwgYykge1xuICAgICAgICByZXR1cm4gZ2V0RGltZW5zaW9uKGNlbGxPcHRpb24sIGMsIGJhY2t1cHMsIGNvbEZpbHRlciwgZnVuY3Rpb24gKGNvbHVtbikge1xuICAgICAgICAgIGlmIChpc1ZhbGlkQ29sdW1uKGNvbHVtbikpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRXaWR0aChjb2x1bW4sIHRhYmxlU2l6ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjZWxsID0gYmluZEZyb20oY29sdW1uQ2VsbHNbY10sIGlkZW50aXR5KTtcbiAgICAgICAgICAgIHJldHVybiBnZXREaW1lbnNpb24oY2VsbCwgYywgYmFja3VwcywgY29sRmlsdGVyLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2soT3B0aW9uYWwuc29tZShnZXQkNShjZWxsKSkpO1xuICAgICAgICAgICAgfSwgZmFsbGJhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZmFsbGJhY2spO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGVkdWNlZCA9IGZ1bmN0aW9uIChkZWR1Y2VkKSB7XG4gICAgICByZXR1cm4gZGVkdWNlZC5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQgKyAncHgnO1xuICAgICAgfSkuZ2V0T3IoJycpO1xuICAgIH07XG4gICAgdmFyIGdldFJhd1dpZHRocyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhYmxlLCB0YWJsZVNpemUpIHtcbiAgICAgIHJldHVybiBnZXRXaWR0aEZyb20od2FyZWhvdXNlLCB0YWJsZSwgZ2V0UmF3VywgZ2V0RGVkdWNlZCwgdGFibGVTaXplKTtcbiAgICB9O1xuICAgIHZhciBnZXRQZXJjZW50YWdlV2lkdGhzID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgdGFibGUsIHRhYmxlU2l6ZSkge1xuICAgICAgcmV0dXJuIGdldFdpZHRoRnJvbSh3YXJlaG91c2UsIHRhYmxlLCBnZXRQZXJjZW50YWdlV2lkdGgsIGZ1bmN0aW9uIChkZWR1Y2VkKSB7XG4gICAgICAgIHJldHVybiBkZWR1Y2VkLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0YWJsZVNpemUubWluQ2VsbFdpZHRoKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChjZWxsV2lkdGgpIHtcbiAgICAgICAgICByZXR1cm4gY2VsbFdpZHRoIC8gdGFibGVTaXplLnBpeGVsV2lkdGgoKSAqIDEwMDtcbiAgICAgICAgfSk7XG4gICAgICB9LCB0YWJsZVNpemUpO1xuICAgIH07XG4gICAgdmFyIGdldFBpeGVsV2lkdGhzID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgdGFibGUsIHRhYmxlU2l6ZSkge1xuICAgICAgcmV0dXJuIGdldFdpZHRoRnJvbSh3YXJlaG91c2UsIHRhYmxlLCBnZXRQaXhlbFdpZHRoLCBmdW5jdGlvbiAoZGVkdWNlZCkge1xuICAgICAgICByZXR1cm4gZGVkdWNlZC5nZXRPclRodW5rKHRhYmxlU2l6ZS5taW5DZWxsV2lkdGgpO1xuICAgICAgfSwgdGFibGVTaXplKTtcbiAgICB9O1xuICAgIHZhciBnZXRIZWlnaHRGcm9tID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgdGFibGUsIGRpcmVjdGlvbiwgZ2V0SGVpZ2h0LCBmYWxsYmFjaykge1xuICAgICAgdmFyIHJvd3MgPSByb3dzJDEod2FyZWhvdXNlKTtcbiAgICAgIHZhciBiYWNrdXBzID0gW09wdGlvbmFsLnNvbWUoZGlyZWN0aW9uLmVkZ2UodGFibGUpKV0uY29uY2F0KG1hcChkaXJlY3Rpb24ucG9zaXRpb25zKHJvd3MsIHRhYmxlKSwgZnVuY3Rpb24gKHBvcykge1xuICAgICAgICByZXR1cm4gcG9zLm1hcChmdW5jdGlvbiAocCkge1xuICAgICAgICAgIHJldHVybiBwLnk7XG4gICAgICAgIH0pO1xuICAgICAgfSkpO1xuICAgICAgcmV0dXJuIG1hcChyb3dzLCBmdW5jdGlvbiAoY2VsbE9wdGlvbiwgYykge1xuICAgICAgICByZXR1cm4gZ2V0RGltZW5zaW9uKGNlbGxPcHRpb24sIGMsIGJhY2t1cHMsIG5vdChoYXNSb3dzcGFuKSwgZ2V0SGVpZ2h0LCBmYWxsYmFjayk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRQaXhlbEhlaWdodHMgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCB0YWJsZSwgZGlyZWN0aW9uKSB7XG4gICAgICByZXR1cm4gZ2V0SGVpZ2h0RnJvbSh3YXJlaG91c2UsIHRhYmxlLCBkaXJlY3Rpb24sIGdldEhlaWdodCQxLCBmdW5jdGlvbiAoZGVkdWNlZCkge1xuICAgICAgICByZXR1cm4gZGVkdWNlZC5nZXRPclRodW5rKG1pbkhlaWdodCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRSYXdIZWlnaHRzID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgdGFibGUsIGRpcmVjdGlvbikge1xuICAgICAgcmV0dXJuIGdldEhlaWdodEZyb20od2FyZWhvdXNlLCB0YWJsZSwgZGlyZWN0aW9uLCBnZXRSYXdILCBnZXREZWR1Y2VkKTtcbiAgICB9O1xuXG4gICAgdmFyIENlbGwgPSBmdW5jdGlvbiAoaW5pdGlhbCkge1xuICAgICAgdmFyIHZhbHVlID0gaW5pdGlhbDtcbiAgICAgIHZhciBnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdmFsdWUgPSB2O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGdldDogZ2V0LFxuICAgICAgICBzZXQ6IHNldFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIG5vbmVTaXplID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICB2YXIgZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBnZXQkNSh0YWJsZSk7XG4gICAgICB9O1xuICAgICAgdmFyIHplcm8gPSBjb25zdGFudCgwKTtcbiAgICAgIHZhciBnZXRXaWR0aHMgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCB0YWJsZVNpemUpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsV2lkdGhzKHdhcmVob3VzZSwgdGFibGUsIHRhYmxlU2l6ZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IGdldFdpZHRoLFxuICAgICAgICBwaXhlbFdpZHRoOiBnZXRXaWR0aCxcbiAgICAgICAgZ2V0V2lkdGhzOiBnZXRXaWR0aHMsXG4gICAgICAgIGdldENlbGxEZWx0YTogemVybyxcbiAgICAgICAgc2luZ2xlQ29sdW1uV2lkdGg6IGNvbnN0YW50KFswXSksXG4gICAgICAgIG1pbkNlbGxXaWR0aDogemVybyxcbiAgICAgICAgc2V0RWxlbWVudFdpZHRoOiBub29wLFxuICAgICAgICBhZGp1c3RUYWJsZVdpZHRoOiBub29wLFxuICAgICAgICBpc1JlbGF0aXZlOiB0cnVlLFxuICAgICAgICBsYWJlbDogJ25vbmUnXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHBlcmNlbnRhZ2VTaXplID0gZnVuY3Rpb24gKGluaXRpYWxXaWR0aCwgdGFibGUpIHtcbiAgICAgIHZhciBmbG9hdFdpZHRoID0gQ2VsbChwYXJzZUZsb2F0KGluaXRpYWxXaWR0aCkpO1xuICAgICAgdmFyIHBpeGVsV2lkdGggPSBDZWxsKGdldCQ1KHRhYmxlKSk7XG4gICAgICB2YXIgZ2V0Q2VsbERlbHRhID0gZnVuY3Rpb24gKGRlbHRhKSB7XG4gICAgICAgIHJldHVybiBkZWx0YSAvIHBpeGVsV2lkdGguZ2V0KCkgKiAxMDA7XG4gICAgICB9O1xuICAgICAgdmFyIHNpbmdsZUNvbHVtbldpZHRoID0gZnVuY3Rpb24gKHcsIF9kZWx0YSkge1xuICAgICAgICByZXR1cm4gWzEwMCAtIHddO1xuICAgICAgfTtcbiAgICAgIHZhciBtaW5DZWxsV2lkdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBtaW5XaWR0aCgpIC8gcGl4ZWxXaWR0aC5nZXQoKSAqIDEwMDtcbiAgICAgIH07XG4gICAgICB2YXIgYWRqdXN0VGFibGVXaWR0aCA9IGZ1bmN0aW9uIChkZWx0YSkge1xuICAgICAgICB2YXIgY3VycmVudFdpZHRoID0gZmxvYXRXaWR0aC5nZXQoKTtcbiAgICAgICAgdmFyIGNoYW5nZSA9IGRlbHRhIC8gMTAwICogY3VycmVudFdpZHRoO1xuICAgICAgICB2YXIgbmV3V2lkdGggPSBjdXJyZW50V2lkdGggKyBjaGFuZ2U7XG4gICAgICAgIHNldFBlcmNlbnRhZ2VXaWR0aCh0YWJsZSwgbmV3V2lkdGgpO1xuICAgICAgICBmbG9hdFdpZHRoLnNldChuZXdXaWR0aCk7XG4gICAgICAgIHBpeGVsV2lkdGguc2V0KGdldCQ1KHRhYmxlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGdldFdpZHRocyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhYmxlU2l6ZSkge1xuICAgICAgICByZXR1cm4gZ2V0UGVyY2VudGFnZVdpZHRocyh3YXJlaG91c2UsIHRhYmxlLCB0YWJsZVNpemUpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdpZHRoOiBmbG9hdFdpZHRoLmdldCxcbiAgICAgICAgcGl4ZWxXaWR0aDogcGl4ZWxXaWR0aC5nZXQsXG4gICAgICAgIGdldFdpZHRoczogZ2V0V2lkdGhzLFxuICAgICAgICBnZXRDZWxsRGVsdGE6IGdldENlbGxEZWx0YSxcbiAgICAgICAgc2luZ2xlQ29sdW1uV2lkdGg6IHNpbmdsZUNvbHVtbldpZHRoLFxuICAgICAgICBtaW5DZWxsV2lkdGg6IG1pbkNlbGxXaWR0aCxcbiAgICAgICAgc2V0RWxlbWVudFdpZHRoOiBzZXRQZXJjZW50YWdlV2lkdGgsXG4gICAgICAgIGFkanVzdFRhYmxlV2lkdGg6IGFkanVzdFRhYmxlV2lkdGgsXG4gICAgICAgIGlzUmVsYXRpdmU6IHRydWUsXG4gICAgICAgIGxhYmVsOiAncGVyY2VudCdcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcGl4ZWxTaXplID0gZnVuY3Rpb24gKGluaXRpYWxXaWR0aCwgdGFibGUpIHtcbiAgICAgIHZhciB3aWR0aCA9IENlbGwoaW5pdGlhbFdpZHRoKTtcbiAgICAgIHZhciBnZXRXaWR0aCA9IHdpZHRoLmdldDtcbiAgICAgIHZhciBnZXRDZWxsRGVsdGEgPSBpZGVudGl0eTtcbiAgICAgIHZhciBzaW5nbGVDb2x1bW5XaWR0aCA9IGZ1bmN0aW9uICh3LCBkZWx0YSkge1xuICAgICAgICB2YXIgbmV3TmV4dCA9IE1hdGgubWF4KG1pbldpZHRoKCksIHcgKyBkZWx0YSk7XG4gICAgICAgIHJldHVybiBbbmV3TmV4dCAtIHddO1xuICAgICAgfTtcbiAgICAgIHZhciBhZGp1c3RUYWJsZVdpZHRoID0gZnVuY3Rpb24gKGRlbHRhKSB7XG4gICAgICAgIHZhciBuZXdXaWR0aCA9IGdldFdpZHRoKCkgKyBkZWx0YTtcbiAgICAgICAgc2V0UGl4ZWxXaWR0aCh0YWJsZSwgbmV3V2lkdGgpO1xuICAgICAgICB3aWR0aC5zZXQobmV3V2lkdGgpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRXaWR0aHMgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCB0YWJsZVNpemUpIHtcbiAgICAgICAgcmV0dXJuIGdldFBpeGVsV2lkdGhzKHdhcmVob3VzZSwgdGFibGUsIHRhYmxlU2l6ZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IGdldFdpZHRoLFxuICAgICAgICBwaXhlbFdpZHRoOiBnZXRXaWR0aCxcbiAgICAgICAgZ2V0V2lkdGhzOiBnZXRXaWR0aHMsXG4gICAgICAgIGdldENlbGxEZWx0YTogZ2V0Q2VsbERlbHRhLFxuICAgICAgICBzaW5nbGVDb2x1bW5XaWR0aDogc2luZ2xlQ29sdW1uV2lkdGgsXG4gICAgICAgIG1pbkNlbGxXaWR0aDogbWluV2lkdGgsXG4gICAgICAgIHNldEVsZW1lbnRXaWR0aDogc2V0UGl4ZWxXaWR0aCxcbiAgICAgICAgYWRqdXN0VGFibGVXaWR0aDogYWRqdXN0VGFibGVXaWR0aCxcbiAgICAgICAgaXNSZWxhdGl2ZTogZmFsc2UsXG4gICAgICAgIGxhYmVsOiAncGl4ZWwnXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGNob29zZVNpemUgPSBmdW5jdGlvbiAoZWxlbWVudCwgd2lkdGgpIHtcbiAgICAgIHZhciBwZXJjZW50TWF0Y2ggPSBwZXJjZW50YWdlQmFzZWRTaXplUmVnZXgoKS5leGVjKHdpZHRoKTtcbiAgICAgIGlmIChwZXJjZW50TWF0Y2ggIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHBlcmNlbnRhZ2VTaXplKHBlcmNlbnRNYXRjaFsxXSwgZWxlbWVudCk7XG4gICAgICB9XG4gICAgICB2YXIgcGl4ZWxNYXRjaCA9IHBpeGVsQmFzZWRTaXplUmVnZXgoKS5leGVjKHdpZHRoKTtcbiAgICAgIGlmIChwaXhlbE1hdGNoICE9PSBudWxsKSB7XG4gICAgICAgIHZhciBpbnRXaWR0aCA9IHBhcnNlSW50KHBpeGVsTWF0Y2hbMV0sIDEwKTtcbiAgICAgICAgcmV0dXJuIHBpeGVsU2l6ZShpbnRXaWR0aCwgZWxlbWVudCk7XG4gICAgICB9XG4gICAgICB2YXIgZmFsbGJhY2tXaWR0aCA9IGdldCQ1KGVsZW1lbnQpO1xuICAgICAgcmV0dXJuIHBpeGVsU2l6ZShmYWxsYmFja1dpZHRoLCBlbGVtZW50KTtcbiAgICB9O1xuICAgIHZhciBnZXRUYWJsZVNpemUgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgIHZhciB3aWR0aCA9IGdldFJhd1dpZHRoKHRhYmxlKTtcbiAgICAgIHJldHVybiB3aWR0aC5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5vbmVTaXplKHRhYmxlKTtcbiAgICAgIH0sIGZ1bmN0aW9uICh3KSB7XG4gICAgICAgIHJldHVybiBjaG9vc2VTaXplKHRhYmxlLCB3KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIFRhYmxlU2l6ZSA9IHtcbiAgICAgIGdldFRhYmxlU2l6ZTogZ2V0VGFibGVTaXplLFxuICAgICAgcGl4ZWxTaXplOiBwaXhlbFNpemUsXG4gICAgICBwZXJjZW50YWdlU2l6ZTogcGVyY2VudGFnZVNpemUsXG4gICAgICBub25lU2l6ZTogbm9uZVNpemVcbiAgICB9O1xuXG4gICAgdmFyIHN0YXRzU3RydWN0ID0gZnVuY3Rpb24gKG1pblJvdywgbWluQ29sLCBtYXhSb3csIG1heENvbCwgYWxsQ2VsbHMsIHNlbGVjdGVkQ2VsbHMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1pblJvdzogbWluUm93LFxuICAgICAgICBtaW5Db2w6IG1pbkNvbCxcbiAgICAgICAgbWF4Um93OiBtYXhSb3csXG4gICAgICAgIG1heENvbDogbWF4Q29sLFxuICAgICAgICBhbGxDZWxsczogYWxsQ2VsbHMsXG4gICAgICAgIHNlbGVjdGVkQ2VsbHM6IHNlbGVjdGVkQ2VsbHNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZmluZFNlbGVjdGVkU3RhdHMgPSBmdW5jdGlvbiAoaG91c2UsIGlzU2VsZWN0ZWQpIHtcbiAgICAgIHZhciB0b3RhbENvbHVtbnMgPSBob3VzZS5ncmlkLmNvbHVtbnM7XG4gICAgICB2YXIgdG90YWxSb3dzID0gaG91c2UuZ3JpZC5yb3dzO1xuICAgICAgdmFyIG1pblJvdyA9IHRvdGFsUm93cztcbiAgICAgIHZhciBtaW5Db2wgPSB0b3RhbENvbHVtbnM7XG4gICAgICB2YXIgbWF4Um93ID0gMDtcbiAgICAgIHZhciBtYXhDb2wgPSAwO1xuICAgICAgdmFyIGFsbENlbGxzID0gW107XG4gICAgICB2YXIgc2VsZWN0ZWRDZWxscyA9IFtdO1xuICAgICAgZWFjaCQxKGhvdXNlLmFjY2VzcywgZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICBhbGxDZWxscy5wdXNoKGRldGFpbCk7XG4gICAgICAgIGlmIChpc1NlbGVjdGVkKGRldGFpbCkpIHtcbiAgICAgICAgICBzZWxlY3RlZENlbGxzLnB1c2goZGV0YWlsKTtcbiAgICAgICAgICB2YXIgc3RhcnRSb3cgPSBkZXRhaWwucm93O1xuICAgICAgICAgIHZhciBlbmRSb3cgPSBzdGFydFJvdyArIGRldGFpbC5yb3dzcGFuIC0gMTtcbiAgICAgICAgICB2YXIgc3RhcnRDb2wgPSBkZXRhaWwuY29sdW1uO1xuICAgICAgICAgIHZhciBlbmRDb2wgPSBzdGFydENvbCArIGRldGFpbC5jb2xzcGFuIC0gMTtcbiAgICAgICAgICBpZiAoc3RhcnRSb3cgPCBtaW5Sb3cpIHtcbiAgICAgICAgICAgIG1pblJvdyA9IHN0YXJ0Um93O1xuICAgICAgICAgIH0gZWxzZSBpZiAoZW5kUm93ID4gbWF4Um93KSB7XG4gICAgICAgICAgICBtYXhSb3cgPSBlbmRSb3c7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzdGFydENvbCA8IG1pbkNvbCkge1xuICAgICAgICAgICAgbWluQ29sID0gc3RhcnRDb2w7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbmRDb2wgPiBtYXhDb2wpIHtcbiAgICAgICAgICAgIG1heENvbCA9IGVuZENvbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHN0YXRzU3RydWN0KG1pblJvdywgbWluQ29sLCBtYXhSb3csIG1heENvbCwgYWxsQ2VsbHMsIHNlbGVjdGVkQ2VsbHMpO1xuICAgIH07XG4gICAgdmFyIG1ha2VDZWxsID0gZnVuY3Rpb24gKGxpc3QsIHNlZW5TZWxlY3RlZCwgcm93SW5kZXgpIHtcbiAgICAgIHZhciByb3cgPSBsaXN0W3Jvd0luZGV4XS5lbGVtZW50O1xuICAgICAgdmFyIHRkID0gU3VnYXJFbGVtZW50LmZyb21UYWcoJ3RkJyk7XG4gICAgICBhcHBlbmQodGQsIFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdicicpKTtcbiAgICAgIHZhciBmID0gc2VlblNlbGVjdGVkID8gYXBwZW5kIDogcHJlcGVuZDtcbiAgICAgIGYocm93LCB0ZCk7XG4gICAgfTtcbiAgICB2YXIgZmlsbEluR2FwcyA9IGZ1bmN0aW9uIChsaXN0LCBob3VzZSwgc3RhdHMsIGlzU2VsZWN0ZWQpIHtcbiAgICAgIHZhciB0b3RhbENvbHVtbnMgPSBob3VzZS5ncmlkLmNvbHVtbnM7XG4gICAgICB2YXIgdG90YWxSb3dzID0gaG91c2UuZ3JpZC5yb3dzO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3RhbFJvd3M7IGkrKykge1xuICAgICAgICB2YXIgc2VlblNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG90YWxDb2x1bW5zOyBqKyspIHtcbiAgICAgICAgICBpZiAoIShpIDwgc3RhdHMubWluUm93IHx8IGkgPiBzdGF0cy5tYXhSb3cgfHwgaiA8IHN0YXRzLm1pbkNvbCB8fCBqID4gc3RhdHMubWF4Q29sKSkge1xuICAgICAgICAgICAgdmFyIG5lZWRDZWxsID0gV2FyZWhvdXNlLmdldEF0KGhvdXNlLCBpLCBqKS5maWx0ZXIoaXNTZWxlY3RlZCkuaXNOb25lKCk7XG4gICAgICAgICAgICBpZiAobmVlZENlbGwpIHtcbiAgICAgICAgICAgICAgbWFrZUNlbGwobGlzdCwgc2VlblNlbGVjdGVkLCBpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNlZW5TZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgY2xlYW4gPSBmdW5jdGlvbiAocmVwbGljYSwgc3RhdHMsIGhvdXNlLCB3aWR0aERlbHRhKSB7XG4gICAgICBlYWNoJDEoaG91c2UuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICBpZiAoY29sLmNvbHVtbiA8IHN0YXRzLm1pbkNvbCB8fCBjb2wuY29sdW1uID4gc3RhdHMubWF4Q29sKSB7XG4gICAgICAgICAgcmVtb3ZlJDIoY29sLmVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHZhciBlbXB0eVJvd3MgPSBmaWx0ZXIoZmlyc3RMYXllcihyZXBsaWNhLCAndHInKSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICByZXR1cm4gcm93LmRvbS5jaGlsZEVsZW1lbnRDb3VudCA9PT0gMDtcbiAgICAgIH0pO1xuICAgICAgZWFjaChlbXB0eVJvd3MsIHJlbW92ZSQyKTtcbiAgICAgIGlmIChzdGF0cy5taW5Db2wgPT09IHN0YXRzLm1heENvbCB8fCBzdGF0cy5taW5Sb3cgPT09IHN0YXRzLm1heFJvdykge1xuICAgICAgICBlYWNoKGZpcnN0TGF5ZXIocmVwbGljYSwgJ3RoLHRkJyksIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmVtb3ZlKGNlbGwsICdyb3dzcGFuJyk7XG4gICAgICAgICAgcmVtb3ZlKGNlbGwsICdjb2xzcGFuJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmVtb3ZlKHJlcGxpY2EsIExPQ0tFRF9DT0xfQVRUUik7XG4gICAgICByZW1vdmUocmVwbGljYSwgJ2RhdGEtc25vb2tlci1jb2wtc2VyaWVzJyk7XG4gICAgICB2YXIgdGFibGVTaXplID0gVGFibGVTaXplLmdldFRhYmxlU2l6ZShyZXBsaWNhKTtcbiAgICAgIHRhYmxlU2l6ZS5hZGp1c3RUYWJsZVdpZHRoKHdpZHRoRGVsdGEpO1xuICAgIH07XG4gICAgdmFyIGdldFRhYmxlV2lkdGhEZWx0YSA9IGZ1bmN0aW9uICh0YWJsZSwgd2FyZWhvdXNlLCB0YWJsZVNpemUsIHN0YXRzKSB7XG4gICAgICBpZiAoc3RhdHMubWluQ29sID09PSAwICYmIHdhcmVob3VzZS5ncmlkLmNvbHVtbnMgPT09IHN0YXRzLm1heENvbCArIDEpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICB2YXIgY29sV2lkdGhzID0gZ2V0UGl4ZWxXaWR0aHMod2FyZWhvdXNlLCB0YWJsZSwgdGFibGVTaXplKTtcbiAgICAgIHZhciBhbGxDb2xzV2lkdGggPSBmb2xkbChjb2xXaWR0aHMsIGZ1bmN0aW9uIChhY2MsIHdpZHRoKSB7XG4gICAgICAgIHJldHVybiBhY2MgKyB3aWR0aDtcbiAgICAgIH0sIDApO1xuICAgICAgdmFyIHNlbGVjdGVkQ29sc1dpZHRoID0gZm9sZGwoY29sV2lkdGhzLnNsaWNlKHN0YXRzLm1pbkNvbCwgc3RhdHMubWF4Q29sICsgMSksIGZ1bmN0aW9uIChhY2MsIHdpZHRoKSB7XG4gICAgICAgIHJldHVybiBhY2MgKyB3aWR0aDtcbiAgICAgIH0sIDApO1xuICAgICAgdmFyIG5ld1dpZHRoID0gc2VsZWN0ZWRDb2xzV2lkdGggLyBhbGxDb2xzV2lkdGggKiB0YWJsZVNpemUucGl4ZWxXaWR0aCgpO1xuICAgICAgdmFyIGRlbHRhID0gbmV3V2lkdGggLSB0YWJsZVNpemUucGl4ZWxXaWR0aCgpO1xuICAgICAgcmV0dXJuIHRhYmxlU2l6ZS5nZXRDZWxsRGVsdGEoZGVsdGEpO1xuICAgIH07XG4gICAgdmFyIGV4dHJhY3QgPSBmdW5jdGlvbiAodGFibGUsIHNlbGVjdGVkU2VsZWN0b3IpIHtcbiAgICAgIHZhciBpc1NlbGVjdGVkID0gZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICByZXR1cm4gaXMoZGV0YWlsLmVsZW1lbnQsIHNlbGVjdGVkU2VsZWN0b3IpO1xuICAgICAgfTtcbiAgICAgIHZhciByZXBsaWNhID0gZGVlcCh0YWJsZSk7XG4gICAgICB2YXIgbGlzdCA9IGZyb21UYWJsZShyZXBsaWNhKTtcbiAgICAgIHZhciB0YWJsZVNpemUgPSBUYWJsZVNpemUuZ2V0VGFibGVTaXplKHRhYmxlKTtcbiAgICAgIHZhciByZXBsaWNhSG91c2UgPSBXYXJlaG91c2UuZ2VuZXJhdGUobGlzdCk7XG4gICAgICB2YXIgcmVwbGljYVN0YXRzID0gZmluZFNlbGVjdGVkU3RhdHMocmVwbGljYUhvdXNlLCBpc1NlbGVjdGVkKTtcbiAgICAgIHZhciBzZWxlY3RvciA9ICd0aDpub3QoJyArIHNlbGVjdGVkU2VsZWN0b3IgKyAnKScgKyAnLHRkOm5vdCgnICsgc2VsZWN0ZWRTZWxlY3RvciArICcpJztcbiAgICAgIHZhciB1bnNlbGVjdGVkQ2VsbHMgPSBmaWx0ZXJGaXJzdExheWVyKHJlcGxpY2EsICd0aCx0ZCcsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgIHJldHVybiBpcyhjZWxsLCBzZWxlY3Rvcik7XG4gICAgICB9KTtcbiAgICAgIGVhY2godW5zZWxlY3RlZENlbGxzLCByZW1vdmUkMik7XG4gICAgICBmaWxsSW5HYXBzKGxpc3QsIHJlcGxpY2FIb3VzZSwgcmVwbGljYVN0YXRzLCBpc1NlbGVjdGVkKTtcbiAgICAgIHZhciBob3VzZSA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgdmFyIHdpZHRoRGVsdGEgPSBnZXRUYWJsZVdpZHRoRGVsdGEodGFibGUsIGhvdXNlLCB0YWJsZVNpemUsIHJlcGxpY2FTdGF0cyk7XG4gICAgICBjbGVhbihyZXBsaWNhLCByZXBsaWNhU3RhdHMsIHJlcGxpY2FIb3VzZSwgd2lkdGhEZWx0YSk7XG4gICAgICByZXR1cm4gcmVwbGljYTtcbiAgICB9O1xuXG4gICAgdmFyIG5ic3AgPSAnXFx4QTAnO1xuXG4gICAgdmFyIGdldEVuZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gbmFtZShlbGVtZW50KSA9PT0gJ2ltZycgPyAxIDogZ2V0T3B0aW9uKGVsZW1lbnQpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY2hpbGRyZW4oZWxlbWVudCkubGVuZ3RoO1xuICAgICAgfSwgZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgcmV0dXJuIHYubGVuZ3RoO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaXNUZXh0Tm9kZVdpdGhDdXJzb3JQb3NpdGlvbiA9IGZ1bmN0aW9uIChlbCkge1xuICAgICAgcmV0dXJuIGdldE9wdGlvbihlbCkuZmlsdGVyKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgIHJldHVybiB0ZXh0LnRyaW0oKS5sZW5ndGggIT09IDAgfHwgdGV4dC5pbmRleE9mKG5ic3ApID4gLTE7XG4gICAgICB9KS5pc1NvbWUoKTtcbiAgICB9O1xuICAgIHZhciBlbGVtZW50c1dpdGhDdXJzb3JQb3NpdGlvbiA9IFtcbiAgICAgICdpbWcnLFxuICAgICAgJ2JyJ1xuICAgIF07XG4gICAgdmFyIGlzQ3Vyc29yUG9zaXRpb24gPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgdmFyIGhhc0N1cnNvclBvc2l0aW9uID0gaXNUZXh0Tm9kZVdpdGhDdXJzb3JQb3NpdGlvbihlbGVtKTtcbiAgICAgIHJldHVybiBoYXNDdXJzb3JQb3NpdGlvbiB8fCBjb250YWlucyhlbGVtZW50c1dpdGhDdXJzb3JQb3NpdGlvbiwgbmFtZShlbGVtKSk7XG4gICAgfTtcblxuICAgIHZhciBmaXJzdCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZGVzY2VuZGFudChlbGVtZW50LCBpc0N1cnNvclBvc2l0aW9uKTtcbiAgICB9O1xuICAgIHZhciBsYXN0JDEgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGRlc2NlbmRhbnRSdGwoZWxlbWVudCwgaXNDdXJzb3JQb3NpdGlvbik7XG4gICAgfTtcbiAgICB2YXIgZGVzY2VuZGFudFJ0bCA9IGZ1bmN0aW9uIChzY29wZSwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgZGVzY2VuZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4oZWxlbWVudCk7XG4gICAgICAgIGZvciAodmFyIGkgPSBjaGlsZHJlbiQxLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW4kMVtpXTtcbiAgICAgICAgICBpZiAocHJlZGljYXRlKGNoaWxkKSkge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoY2hpbGQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgcmVzID0gZGVzY2VuZChjaGlsZCk7XG4gICAgICAgICAgaWYgKHJlcy5pc1NvbWUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVzY2VuZChzY29wZSk7XG4gICAgfTtcblxuICAgIHZhciB0cmFuc2ZlcmFibGVBdHRyaWJ1dGVzID0ge1xuICAgICAgc2NvcGU6IFtcbiAgICAgICAgJ3JvdycsXG4gICAgICAgICdjb2wnXG4gICAgICBdXG4gICAgfTtcbiAgICB2YXIgY3JlYXRlQ2VsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ZCA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCd0ZCcpO1xuICAgICAgYXBwZW5kKHRkLCBTdWdhckVsZW1lbnQuZnJvbVRhZygnYnInKSk7XG4gICAgICByZXR1cm4gdGQ7XG4gICAgfTtcbiAgICB2YXIgY3JlYXRlQ29sID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdjb2wnKTtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVDb2xncm91cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbVRhZygnY29sZ3JvdXAnKTtcbiAgICB9O1xuICAgIHZhciByZXBsYWNlID0gZnVuY3Rpb24gKGNlbGwsIHRhZywgYXR0cnMpIHtcbiAgICAgIHZhciByZXBsaWNhID0gY29weSQxKGNlbGwsIHRhZyk7XG4gICAgICBlYWNoJDEoYXR0cnMsIGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgICAgIGlmICh2ID09PSBudWxsKSB7XG4gICAgICAgICAgcmVtb3ZlKHJlcGxpY2EsIGspO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldChyZXBsaWNhLCBrLCB2KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVwbGljYTtcbiAgICB9O1xuICAgIHZhciBwYXN0ZVJlcGxhY2UgPSBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgcmV0dXJuIGNlbGw7XG4gICAgfTtcbiAgICB2YXIgbmV3Um93ID0gZnVuY3Rpb24gKGRvYykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tVGFnKCd0cicsIGRvYy5kb20pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBjbG9uZUZvcm1hdHMgPSBmdW5jdGlvbiAob2xkQ2VsbCwgbmV3Q2VsbCwgZm9ybWF0cykge1xuICAgICAgdmFyIGZpcnN0JDEgPSBmaXJzdChvbGRDZWxsKTtcbiAgICAgIHJldHVybiBmaXJzdCQxLm1hcChmdW5jdGlvbiAoZmlyc3RUZXh0KSB7XG4gICAgICAgIHZhciBmb3JtYXRTZWxlY3RvciA9IGZvcm1hdHMuam9pbignLCcpO1xuICAgICAgICB2YXIgcGFyZW50cyA9IGFuY2VzdG9ycyQxKGZpcnN0VGV4dCwgZm9ybWF0U2VsZWN0b3IsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGVxJDEoZWxlbWVudCwgb2xkQ2VsbCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZm9sZHIocGFyZW50cywgZnVuY3Rpb24gKGxhc3QsIHBhcmVudCkge1xuICAgICAgICAgIHZhciBjbG9uZWRGb3JtYXQgPSBzaGFsbG93KHBhcmVudCk7XG4gICAgICAgICAgcmVtb3ZlKGNsb25lZEZvcm1hdCwgJ2NvbnRlbnRlZGl0YWJsZScpO1xuICAgICAgICAgIGFwcGVuZChsYXN0LCBjbG9uZWRGb3JtYXQpO1xuICAgICAgICAgIHJldHVybiBjbG9uZWRGb3JtYXQ7XG4gICAgICAgIH0sIG5ld0NlbGwpO1xuICAgICAgfSkuZ2V0T3IobmV3Q2VsbCk7XG4gICAgfTtcbiAgICB2YXIgY2xvbmVBcHByb3ByaWF0ZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGNsb25lKSB7XG4gICAgICBlYWNoJDEodHJhbnNmZXJhYmxlQXR0cmlidXRlcywgZnVuY3Rpb24gKHZhbGlkQXR0cmlidXRlcywgYXR0cmlidXRlTmFtZSkge1xuICAgICAgICByZXR1cm4gZ2V0T3B0KG9yaWdpbmFsLCBhdHRyaWJ1dGVOYW1lKS5maWx0ZXIoZnVuY3Rpb24gKGF0dHJpYnV0ZSkge1xuICAgICAgICAgIHJldHVybiBjb250YWlucyh2YWxpZEF0dHJpYnV0ZXMsIGF0dHJpYnV0ZSk7XG4gICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKGF0dHJpYnV0ZSkge1xuICAgICAgICAgIHJldHVybiBzZXQoY2xvbmUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY2VsbE9wZXJhdGlvbnMgPSBmdW5jdGlvbiAobXV0YXRlLCBkb2MsIGZvcm1hdHNUb0Nsb25lKSB7XG4gICAgICB2YXIgY2xvbmVDc3MgPSBmdW5jdGlvbiAocHJldiwgY2xvbmUpIHtcbiAgICAgICAgY29weShwcmV2LmVsZW1lbnQsIGNsb25lKTtcbiAgICAgICAgcmVtb3ZlJDEoY2xvbmUsICdoZWlnaHQnKTtcbiAgICAgICAgaWYgKHByZXYuY29sc3BhbiAhPT0gMSkge1xuICAgICAgICAgIHJlbW92ZSQxKGNsb25lLCAnd2lkdGgnKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBuZXdDZWxsID0gZnVuY3Rpb24gKHByZXYpIHtcbiAgICAgICAgdmFyIGRvY3UgPSBvd25lcihwcmV2LmVsZW1lbnQpO1xuICAgICAgICB2YXIgdGQgPSBTdWdhckVsZW1lbnQuZnJvbVRhZyhuYW1lKHByZXYuZWxlbWVudCksIGRvY3UuZG9tKTtcbiAgICAgICAgdmFyIGZvcm1hdHMgPSBmb3JtYXRzVG9DbG9uZS5nZXRPcihbXG4gICAgICAgICAgJ3N0cm9uZycsXG4gICAgICAgICAgJ2VtJyxcbiAgICAgICAgICAnYicsXG4gICAgICAgICAgJ2knLFxuICAgICAgICAgICdzcGFuJyxcbiAgICAgICAgICAnZm9udCcsXG4gICAgICAgICAgJ2gxJyxcbiAgICAgICAgICAnaDInLFxuICAgICAgICAgICdoMycsXG4gICAgICAgICAgJ2g0JyxcbiAgICAgICAgICAnaDUnLFxuICAgICAgICAgICdoNicsXG4gICAgICAgICAgJ3AnLFxuICAgICAgICAgICdkaXYnXG4gICAgICAgIF0pO1xuICAgICAgICB2YXIgbGFzdE5vZGUgPSBmb3JtYXRzLmxlbmd0aCA+IDAgPyBjbG9uZUZvcm1hdHMocHJldi5lbGVtZW50LCB0ZCwgZm9ybWF0cykgOiB0ZDtcbiAgICAgICAgYXBwZW5kKGxhc3ROb2RlLCBTdWdhckVsZW1lbnQuZnJvbVRhZygnYnInKSk7XG4gICAgICAgIGNsb25lQ3NzKHByZXYsIHRkKTtcbiAgICAgICAgY2xvbmVBcHByb3ByaWF0ZUF0dHJpYnV0ZXMocHJldi5lbGVtZW50LCB0ZCk7XG4gICAgICAgIG11dGF0ZShwcmV2LmVsZW1lbnQsIHRkKTtcbiAgICAgICAgcmV0dXJuIHRkO1xuICAgICAgfTtcbiAgICAgIHZhciBuZXdDb2wgPSBmdW5jdGlvbiAocHJldikge1xuICAgICAgICB2YXIgZG9jID0gb3duZXIocHJldi5lbGVtZW50KTtcbiAgICAgICAgdmFyIGNvbCA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKG5hbWUocHJldi5lbGVtZW50KSwgZG9jLmRvbSk7XG4gICAgICAgIGNsb25lQ3NzKHByZXYsIGNvbCk7XG4gICAgICAgIG11dGF0ZShwcmV2LmVsZW1lbnQsIGNvbCk7XG4gICAgICAgIHJldHVybiBjb2w7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29sOiBuZXdDb2wsXG4gICAgICAgIGNvbGdyb3VwOiBjcmVhdGVDb2xncm91cCxcbiAgICAgICAgcm93OiBuZXdSb3coZG9jKSxcbiAgICAgICAgY2VsbDogbmV3Q2VsbCxcbiAgICAgICAgcmVwbGFjZTogcmVwbGFjZSxcbiAgICAgICAgZ2FwOiBjcmVhdGVDZWxsXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHBhc3RlID0gZnVuY3Rpb24gKGRvYykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29sOiBjcmVhdGVDb2wsXG4gICAgICAgIGNvbGdyb3VwOiBjcmVhdGVDb2xncm91cCxcbiAgICAgICAgcm93OiBuZXdSb3coZG9jKSxcbiAgICAgICAgY2VsbDogY3JlYXRlQ2VsbCxcbiAgICAgICAgcmVwbGFjZTogcGFzdGVSZXBsYWNlLFxuICAgICAgICBnYXA6IGNyZWF0ZUNlbGxcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBmcm9tSHRtbCQxID0gZnVuY3Rpb24gKGh0bWwsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9jID0gc2NvcGUgfHwgZG9jdW1lbnQ7XG4gICAgICB2YXIgZGl2ID0gZG9jLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZGl2LmlubmVySFRNTCA9IGh0bWw7XG4gICAgICByZXR1cm4gY2hpbGRyZW4oU3VnYXJFbGVtZW50LmZyb21Eb20oZGl2KSk7XG4gICAgfTtcbiAgICB2YXIgZnJvbURvbSQxID0gZnVuY3Rpb24gKG5vZGVzKSB7XG4gICAgICByZXR1cm4gbWFwKG5vZGVzLCBTdWdhckVsZW1lbnQuZnJvbURvbSk7XG4gICAgfTtcblxuICAgIHZhciBnZXROb2RlTmFtZSA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBlbG0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICB9O1xuICAgIHZhciBnZXRCb2R5JDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldEJvZHkoKSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0UGl4ZWxXaWR0aCQxID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgcmV0dXJuIGVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICB9O1xuICAgIHZhciBnZXRQaXhlbEhlaWdodCA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBlbG0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgIH07XG4gICAgdmFyIGdldElzUm9vdCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZXEkMShlbGVtZW50LCBnZXRCb2R5JDEoZWRpdG9yKSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJlbW92ZVB4U3VmZml4ID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgICAgIHJldHVybiBzaXplID8gc2l6ZS5yZXBsYWNlKC9weCQvLCAnJykgOiAnJztcbiAgICB9O1xuICAgIHZhciBhZGRQeFN1ZmZpeCA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICByZXR1cm4gL15cXGQrKFxcLlxcZCspPyQvLnRlc3Qoc2l6ZSkgPyBzaXplICsgJ3B4JyA6IHNpemU7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlRGF0YVN0eWxlID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICByZW1vdmUodGFibGUsICdkYXRhLW1jZS1zdHlsZScpO1xuICAgICAgdmFyIHJlbW92ZVN0eWxlQXR0cmlidXRlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlbW92ZShlbGVtZW50LCAnZGF0YS1tY2Utc3R5bGUnKTtcbiAgICAgIH07XG4gICAgICBlYWNoKGNlbGxzKHRhYmxlKSwgcmVtb3ZlU3R5bGVBdHRyaWJ1dGUpO1xuICAgICAgZWFjaChjb2x1bW5zKHRhYmxlKSwgcmVtb3ZlU3R5bGVBdHRyaWJ1dGUpO1xuICAgIH07XG4gICAgdmFyIGdldFJhd1dpZHRoJDEgPSBmdW5jdGlvbiAoZWRpdG9yLCBlbG0pIHtcbiAgICAgIHZhciByYXcgPSBlZGl0b3IuZG9tLmdldFN0eWxlKGVsbSwgJ3dpZHRoJykgfHwgZWRpdG9yLmRvbS5nZXRBdHRyaWIoZWxtLCAnd2lkdGgnKTtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKHJhdykuZmlsdGVyKGlzTm90RW1wdHkpO1xuICAgIH07XG4gICAgdmFyIGlzUGVyY2VudGFnZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIC9eKFxcZCsoXFwuXFxkKyk/KSUkLy50ZXN0KHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBpc1BpeGVsID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICByZXR1cm4gL14oXFxkKyhcXC5cXGQrKT8pcHgkLy50ZXN0KHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBnZXRTZWxlY3Rpb25TdGFydCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3Iuc2VsZWN0aW9uLmdldFN0YXJ0KCkpO1xuICAgIH07XG5cbiAgICB2YXIgc2VsZWN0aW9uID0gZnVuY3Rpb24gKHNlbGVjdGlvbnMpIHtcbiAgICAgIHJldHVybiBjYXRhKHNlbGVjdGlvbnMuZ2V0KCksIGNvbnN0YW50KFtdKSwgaWRlbnRpdHksIHB1cmUpO1xuICAgIH07XG4gICAgdmFyIHVubWVyZ2FibGUgPSBmdW5jdGlvbiAoc2VsZWN0aW9ucykge1xuICAgICAgdmFyIGhhc1NwYW4gPSBmdW5jdGlvbiAoZWxlbSwgdHlwZSkge1xuICAgICAgICByZXR1cm4gZ2V0T3B0KGVsZW0sIHR5cGUpLmV4aXN0cyhmdW5jdGlvbiAoc3Bhbikge1xuICAgICAgICAgIHJldHVybiBwYXJzZUludChzcGFuLCAxMCkgPiAxO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgaGFzUm93T3JDb2xTcGFuID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgcmV0dXJuIGhhc1NwYW4oZWxlbSwgJ3Jvd3NwYW4nKSB8fCBoYXNTcGFuKGVsZW0sICdjb2xzcGFuJyk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbmRpZGF0ZXMgPSBzZWxlY3Rpb24oc2VsZWN0aW9ucyk7XG4gICAgICByZXR1cm4gY2FuZGlkYXRlcy5sZW5ndGggPiAwICYmIGZvcmFsbChjYW5kaWRhdGVzLCBoYXNSb3dPckNvbFNwYW4pID8gT3B0aW9uYWwuc29tZShjYW5kaWRhdGVzKSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBtZXJnYWJsZSA9IGZ1bmN0aW9uICh0YWJsZSwgc2VsZWN0aW9ucywgZXBoZW1lcmEpIHtcbiAgICAgIHJldHVybiBjYXRhKHNlbGVjdGlvbnMuZ2V0KCksIE9wdGlvbmFsLm5vbmUsIGZ1bmN0aW9uIChjZWxscykge1xuICAgICAgICBpZiAoY2VsbHMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiByZXRyaWV2ZUJveCh0YWJsZSwgZXBoZW1lcmEuZmlyc3RTZWxlY3RlZFNlbGVjdG9yLCBlcGhlbWVyYS5sYXN0U2VsZWN0ZWRTZWxlY3RvcikubWFwKGZ1bmN0aW9uIChib3VuZHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGJvdW5kczogYm91bmRzLFxuICAgICAgICAgICAgICBjZWxsczogY2VsbHNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sIE9wdGlvbmFsLm5vbmUpO1xuICAgIH07XG5cbiAgICB2YXIgc3RyU2VsZWN0ZWQgPSAnZGF0YS1tY2Utc2VsZWN0ZWQnO1xuICAgIHZhciBzdHJTZWxlY3RlZFNlbGVjdG9yID0gJ3RkWycgKyBzdHJTZWxlY3RlZCArICddLHRoWycgKyBzdHJTZWxlY3RlZCArICddJztcbiAgICB2YXIgc3RyQXR0cmlidXRlU2VsZWN0b3IgPSAnWycgKyBzdHJTZWxlY3RlZCArICddJztcbiAgICB2YXIgc3RyRmlyc3RTZWxlY3RlZCA9ICdkYXRhLW1jZS1maXJzdC1zZWxlY3RlZCc7XG4gICAgdmFyIHN0ckZpcnN0U2VsZWN0ZWRTZWxlY3RvciA9ICd0ZFsnICsgc3RyRmlyc3RTZWxlY3RlZCArICddLHRoWycgKyBzdHJGaXJzdFNlbGVjdGVkICsgJ10nO1xuICAgIHZhciBzdHJMYXN0U2VsZWN0ZWQgPSAnZGF0YS1tY2UtbGFzdC1zZWxlY3RlZCc7XG4gICAgdmFyIHN0ckxhc3RTZWxlY3RlZFNlbGVjdG9yID0gJ3RkWycgKyBzdHJMYXN0U2VsZWN0ZWQgKyAnXSx0aFsnICsgc3RyTGFzdFNlbGVjdGVkICsgJ10nO1xuICAgIHZhciBhdHRyaWJ1dGVTZWxlY3RvciA9IHN0ckF0dHJpYnV0ZVNlbGVjdG9yO1xuICAgIHZhciBlcGhlbWVyYSA9IHtcbiAgICAgIHNlbGVjdGVkOiBzdHJTZWxlY3RlZCxcbiAgICAgIHNlbGVjdGVkU2VsZWN0b3I6IHN0clNlbGVjdGVkU2VsZWN0b3IsXG4gICAgICBmaXJzdFNlbGVjdGVkOiBzdHJGaXJzdFNlbGVjdGVkLFxuICAgICAgZmlyc3RTZWxlY3RlZFNlbGVjdG9yOiBzdHJGaXJzdFNlbGVjdGVkU2VsZWN0b3IsXG4gICAgICBsYXN0U2VsZWN0ZWQ6IHN0ckxhc3RTZWxlY3RlZCxcbiAgICAgIGxhc3RTZWxlY3RlZFNlbGVjdG9yOiBzdHJMYXN0U2VsZWN0ZWRTZWxlY3RvclxuICAgIH07XG5cbiAgICB2YXIgbm9NZW51ID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQ6IGNlbGwsXG4gICAgICAgIG1lcmdhYmxlOiBPcHRpb25hbC5ub25lKCksXG4gICAgICAgIHVubWVyZ2FibGU6IE9wdGlvbmFsLm5vbmUoKSxcbiAgICAgICAgc2VsZWN0aW9uOiBbY2VsbF1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZm9yTWVudSA9IGZ1bmN0aW9uIChzZWxlY3Rpb25zLCB0YWJsZSwgY2VsbCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogY2VsbCxcbiAgICAgICAgbWVyZ2FibGU6IG1lcmdhYmxlKHRhYmxlLCBzZWxlY3Rpb25zLCBlcGhlbWVyYSksXG4gICAgICAgIHVubWVyZ2FibGU6IHVubWVyZ2FibGUoc2VsZWN0aW9ucyksXG4gICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uKHNlbGVjdGlvbnMpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHBhc3RlJDEgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xpcGJvYXJkLCBnZW5lcmF0b3JzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICBjbGlwYm9hcmQ6IGNsaXBib2FyZCxcbiAgICAgICAgZ2VuZXJhdG9yczogZ2VuZXJhdG9yc1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBwYXN0ZVJvd3MgPSBmdW5jdGlvbiAoc2VsZWN0aW9ucywgY2VsbCwgY2xpcGJvYXJkLCBnZW5lcmF0b3JzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGlvbihzZWxlY3Rpb25zKSxcbiAgICAgICAgY2xpcGJvYXJkOiBjbGlwYm9hcmQsXG4gICAgICAgIGdlbmVyYXRvcnM6IGdlbmVyYXRvcnNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBleHRyYWN0U2VsZWN0ZWQgPSBmdW5jdGlvbiAoY2VsbHMpIHtcbiAgICAgIHJldHVybiB0YWJsZShjZWxsc1swXSkubWFwKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICB2YXIgcmVwbGljYSA9IGV4dHJhY3QodGFibGUsIGF0dHJpYnV0ZVNlbGVjdG9yKTtcbiAgICAgICAgcmVtb3ZlRGF0YVN0eWxlKHJlcGxpY2EpO1xuICAgICAgICByZXR1cm4gW3JlcGxpY2FdO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2VyaWFsaXplRWxlbWVudHMgPSBmdW5jdGlvbiAoZWRpdG9yLCBlbGVtZW50cykge1xuICAgICAgcmV0dXJuIG1hcChlbGVtZW50cywgZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLnNlbGVjdGlvbi5zZXJpYWxpemVyLnNlcmlhbGl6ZShlbG0uZG9tLCB7fSk7XG4gICAgICB9KS5qb2luKCcnKTtcbiAgICB9O1xuICAgIHZhciBnZXRUZXh0Q29udGVudCA9IGZ1bmN0aW9uIChlbGVtZW50cykge1xuICAgICAgcmV0dXJuIG1hcChlbGVtZW50cywgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLmlubmVyVGV4dDtcbiAgICAgIH0pLmpvaW4oJycpO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyRXZlbnRzID0gZnVuY3Rpb24gKGVkaXRvciwgc2VsZWN0aW9ucywgYWN0aW9ucywgY2VsbFNlbGVjdGlvbikge1xuICAgICAgZWRpdG9yLm9uKCdCZWZvcmVHZXRDb250ZW50JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIG11bHRpQ2VsbENvbnRleHQgPSBmdW5jdGlvbiAoY2VsbHMpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZXh0cmFjdFNlbGVjdGVkKGNlbGxzKS5lYWNoKGZ1bmN0aW9uIChlbGVtZW50cykge1xuICAgICAgICAgICAgZS5jb250ZW50ID0gZS5mb3JtYXQgPT09ICd0ZXh0JyA/IGdldFRleHRDb250ZW50KGVsZW1lbnRzKSA6IHNlcmlhbGl6ZUVsZW1lbnRzKGVkaXRvciwgZWxlbWVudHMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoZS5zZWxlY3Rpb24gPT09IHRydWUpIHtcbiAgICAgICAgICBjYXRhKHNlbGVjdGlvbnMuZ2V0KCksIG5vb3AsIG11bHRpQ2VsbENvbnRleHQsIG5vb3ApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5vbignQmVmb3JlU2V0Q29udGVudCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlLnNlbGVjdGlvbiA9PT0gdHJ1ZSAmJiBlLnBhc3RlID09PSB0cnVlKSB7XG4gICAgICAgICAgdmFyIGNlbGxPcHQgPSBPcHRpb25hbC5mcm9tKGVkaXRvci5kb20uZ2V0UGFyZW50KGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKSwgJ3RoLHRkJykpO1xuICAgICAgICAgIGNlbGxPcHQuZWFjaChmdW5jdGlvbiAoZG9tQ2VsbCkge1xuICAgICAgICAgICAgdmFyIGNlbGwgPSBTdWdhckVsZW1lbnQuZnJvbURvbShkb21DZWxsKTtcbiAgICAgICAgICAgIHRhYmxlKGNlbGwpLmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IGZpbHRlcihmcm9tSHRtbCQxKGUuY29udGVudCksIGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hbWUoY29udGVudCkgIT09ICdtZXRhJztcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHZhciBpc1RhYmxlID0gZnVuY3Rpb24gKGVsbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuYW1lKGVsbSkgPT09ICd0YWJsZSc7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGlmIChlbGVtZW50cy5sZW5ndGggPT09IDEgJiYgaXNUYWJsZShlbGVtZW50c1swXSkpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgdmFyIGRvYyA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXREb2MoKSk7XG4gICAgICAgICAgICAgICAgdmFyIGdlbmVyYXRvcnMgPSBwYXN0ZShkb2MpO1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRzID0gcGFzdGUkMShjZWxsLCBlbGVtZW50c1swXSwgZ2VuZXJhdG9ycyk7XG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wYXN0ZUNlbGxzKHRhYmxlLCB0YXJnZXRzKS5lYWNoKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhkYXRhLnJuZyk7XG4gICAgICAgICAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgIGNlbGxTZWxlY3Rpb24uY2xlYXIodGFibGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBhZHQgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAgeyBub25lOiBbXSB9LFxuICAgICAgeyBvbmx5OiBbJ2luZGV4J10gfSxcbiAgICAgIHtcbiAgICAgICAgbGVmdDogW1xuICAgICAgICAgICdpbmRleCcsXG4gICAgICAgICAgJ25leHQnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG1pZGRsZTogW1xuICAgICAgICAgICdwcmV2JyxcbiAgICAgICAgICAnaW5kZXgnLFxuICAgICAgICAgICduZXh0J1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByaWdodDogW1xuICAgICAgICAgICdwcmV2JyxcbiAgICAgICAgICAnaW5kZXgnXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdKTtcbiAgICB2YXIgQ29sdW1uQ29udGV4dCA9IF9fYXNzaWduKHt9LCBhZHQpO1xuXG4gICAgdmFyIG5laWdoYm91cnMgPSBmdW5jdGlvbiAoaW5wdXQsIGluZGV4KSB7XG4gICAgICBpZiAoaW5wdXQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBDb2x1bW5Db250ZXh0Lm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIENvbHVtbkNvbnRleHQub25seSgwKTtcbiAgICAgIH1cbiAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gQ29sdW1uQ29udGV4dC5sZWZ0KDAsIDEpO1xuICAgICAgfVxuICAgICAgaWYgKGluZGV4ID09PSBpbnB1dC5sZW5ndGggLSAxKSB7XG4gICAgICAgIHJldHVybiBDb2x1bW5Db250ZXh0LnJpZ2h0KGluZGV4IC0gMSwgaW5kZXgpO1xuICAgICAgfVxuICAgICAgaWYgKGluZGV4ID4gMCAmJiBpbmRleCA8IGlucHV0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIENvbHVtbkNvbnRleHQubWlkZGxlKGluZGV4IC0gMSwgaW5kZXgsIGluZGV4ICsgMSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gQ29sdW1uQ29udGV4dC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgZGV0ZXJtaW5lID0gZnVuY3Rpb24gKGlucHV0LCBjb2x1bW4sIHN0ZXAsIHRhYmxlU2l6ZSwgcmVzaXplKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gaW5wdXQuc2xpY2UoMCk7XG4gICAgICB2YXIgY29udGV4dCA9IG5laWdoYm91cnMoaW5wdXQsIGNvbHVtbik7XG4gICAgICB2YXIgb25Ob25lID0gY29uc3RhbnQobWFwKHJlc3VsdCwgY29uc3RhbnQoMCkpKTtcbiAgICAgIHZhciBvbk9ubHkgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRhYmxlU2l6ZS5zaW5nbGVDb2x1bW5XaWR0aChyZXN1bHRbaW5kZXhdLCBzdGVwKTtcbiAgICAgIH07XG4gICAgICB2YXIgb25MZWZ0ID0gZnVuY3Rpb24gKGluZGV4LCBuZXh0KSB7XG4gICAgICAgIHJldHVybiByZXNpemUuY2FsY0xlZnRFZGdlRGVsdGFzKHJlc3VsdCwgaW5kZXgsIG5leHQsIHN0ZXAsIHRhYmxlU2l6ZS5taW5DZWxsV2lkdGgoKSwgdGFibGVTaXplLmlzUmVsYXRpdmUpO1xuICAgICAgfTtcbiAgICAgIHZhciBvbk1pZGRsZSA9IGZ1bmN0aW9uIChwcmV2LCBpbmRleCwgbmV4dCkge1xuICAgICAgICByZXR1cm4gcmVzaXplLmNhbGNNaWRkbGVEZWx0YXMocmVzdWx0LCBwcmV2LCBpbmRleCwgbmV4dCwgc3RlcCwgdGFibGVTaXplLm1pbkNlbGxXaWR0aCgpLCB0YWJsZVNpemUuaXNSZWxhdGl2ZSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uUmlnaHQgPSBmdW5jdGlvbiAocHJldiwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHJlc2l6ZS5jYWxjUmlnaHRFZGdlRGVsdGFzKHJlc3VsdCwgcHJldiwgaW5kZXgsIHN0ZXAsIHRhYmxlU2l6ZS5taW5DZWxsV2lkdGgoKSwgdGFibGVTaXplLmlzUmVsYXRpdmUpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBjb250ZXh0LmZvbGQob25Ob25lLCBvbk9ubHksIG9uTGVmdCwgb25NaWRkbGUsIG9uUmlnaHQpO1xuICAgIH07XG5cbiAgICB2YXIgdG90YWwgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgbWVhc3VyZXMpIHtcbiAgICAgIHZhciByID0gMDtcbiAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgIHIgKz0gbWVhc3VyZXNbaV0gIT09IHVuZGVmaW5lZCA/IG1lYXN1cmVzW2ldIDogMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIHJlY2FsY3VsYXRlV2lkdGhGb3JDZWxscyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHdpZHRocykge1xuICAgICAgdmFyIGFsbCA9IFdhcmVob3VzZS5qdXN0Q2VsbHMod2FyZWhvdXNlKTtcbiAgICAgIHJldHVybiBtYXAoYWxsLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICB2YXIgd2lkdGggPSB0b3RhbChjZWxsLmNvbHVtbiwgY2VsbC5jb2x1bW4gKyBjZWxsLmNvbHNwYW4sIHdpZHRocyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZWxlbWVudDogY2VsbC5lbGVtZW50LFxuICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICBjb2xzcGFuOiBjZWxsLmNvbHNwYW5cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlY2FsY3VsYXRlV2lkdGhGb3JDb2x1bW5zID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgd2lkdGhzKSB7XG4gICAgICB2YXIgZ3JvdXBzID0gV2FyZWhvdXNlLmp1c3RDb2x1bW5zKHdhcmVob3VzZSk7XG4gICAgICByZXR1cm4gbWFwKGdyb3VwcywgZnVuY3Rpb24gKGNvbHVtbiwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlbGVtZW50OiBjb2x1bW4uZWxlbWVudCxcbiAgICAgICAgICB3aWR0aDogd2lkdGhzW2luZGV4XSxcbiAgICAgICAgICBjb2xzcGFuOiBjb2x1bW4uY29sc3BhblxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVjYWxjdWxhdGVIZWlnaHRGb3JDZWxscyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIGhlaWdodHMpIHtcbiAgICAgIHZhciBhbGwgPSBXYXJlaG91c2UuanVzdENlbGxzKHdhcmVob3VzZSk7XG4gICAgICByZXR1cm4gbWFwKGFsbCwgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgdmFyIGhlaWdodCA9IHRvdGFsKGNlbGwucm93LCBjZWxsLnJvdyArIGNlbGwucm93c3BhbiwgaGVpZ2h0cyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZWxlbWVudDogY2VsbC5lbGVtZW50LFxuICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgIHJvd3NwYW46IGNlbGwucm93c3BhblxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWF0Y2hSb3dIZWlnaHQgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBoZWlnaHRzKSB7XG4gICAgICByZXR1cm4gbWFwKHdhcmVob3VzZS5hbGwsIGZ1bmN0aW9uIChyb3csIGkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlbGVtZW50OiByb3cuZWxlbWVudCxcbiAgICAgICAgICBoZWlnaHQ6IGhlaWdodHNbaV1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgc3VtVXAgPSBmdW5jdGlvbiAobmV3U2l6ZSkge1xuICAgICAgcmV0dXJuIGZvbGRyKG5ld1NpemUsIGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgICAgIHJldHVybiBiICsgYTtcbiAgICAgIH0sIDApO1xuICAgIH07XG4gICAgdmFyIHJlY2FsY3VsYXRlID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgd2lkdGhzKSB7XG4gICAgICBpZiAoV2FyZWhvdXNlLmhhc0NvbHVtbnMod2FyZWhvdXNlKSkge1xuICAgICAgICByZXR1cm4gcmVjYWxjdWxhdGVXaWR0aEZvckNvbHVtbnMod2FyZWhvdXNlLCB3aWR0aHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlY2FsY3VsYXRlV2lkdGhGb3JDZWxscyh3YXJlaG91c2UsIHdpZHRocyk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVjYWxjdWxhdGVBbmRBcHBseSA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHdpZHRocywgdGFibGVTaXplKSB7XG4gICAgICB2YXIgbmV3U2l6ZXMgPSByZWNhbGN1bGF0ZSh3YXJlaG91c2UsIHdpZHRocyk7XG4gICAgICBlYWNoKG5ld1NpemVzLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICB0YWJsZVNpemUuc2V0RWxlbWVudFdpZHRoKGNlbGwuZWxlbWVudCwgY2VsbC53aWR0aCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBhZGp1c3RXaWR0aCA9IGZ1bmN0aW9uICh0YWJsZSwgZGVsdGEsIGluZGV4LCByZXNpemluZywgdGFibGVTaXplKSB7XG4gICAgICB2YXIgd2FyZWhvdXNlID0gV2FyZWhvdXNlLmZyb21UYWJsZSh0YWJsZSk7XG4gICAgICB2YXIgc3RlcCA9IHRhYmxlU2l6ZS5nZXRDZWxsRGVsdGEoZGVsdGEpO1xuICAgICAgdmFyIHdpZHRocyA9IHRhYmxlU2l6ZS5nZXRXaWR0aHMod2FyZWhvdXNlLCB0YWJsZVNpemUpO1xuICAgICAgdmFyIGlzTGFzdENvbHVtbiA9IGluZGV4ID09PSB3YXJlaG91c2UuZ3JpZC5jb2x1bW5zIC0gMTtcbiAgICAgIHZhciBjbGFtcGVkU3RlcCA9IHJlc2l6aW5nLmNsYW1wVGFibGVEZWx0YSh3aWR0aHMsIGluZGV4LCBzdGVwLCB0YWJsZVNpemUubWluQ2VsbFdpZHRoKCksIGlzTGFzdENvbHVtbik7XG4gICAgICB2YXIgZGVsdGFzID0gZGV0ZXJtaW5lKHdpZHRocywgaW5kZXgsIGNsYW1wZWRTdGVwLCB0YWJsZVNpemUsIHJlc2l6aW5nKTtcbiAgICAgIHZhciBuZXdXaWR0aHMgPSBtYXAoZGVsdGFzLCBmdW5jdGlvbiAoZHgsIGkpIHtcbiAgICAgICAgcmV0dXJuIGR4ICsgd2lkdGhzW2ldO1xuICAgICAgfSk7XG4gICAgICByZWNhbGN1bGF0ZUFuZEFwcGx5KHdhcmVob3VzZSwgbmV3V2lkdGhzLCB0YWJsZVNpemUpO1xuICAgICAgcmVzaXppbmcucmVzaXplVGFibGUodGFibGVTaXplLmFkanVzdFRhYmxlV2lkdGgsIGNsYW1wZWRTdGVwLCBpc0xhc3RDb2x1bW4pO1xuICAgIH07XG4gICAgdmFyIGFkanVzdEhlaWdodCA9IGZ1bmN0aW9uICh0YWJsZSwgZGVsdGEsIGluZGV4LCBkaXJlY3Rpb24pIHtcbiAgICAgIHZhciB3YXJlaG91c2UgPSBXYXJlaG91c2UuZnJvbVRhYmxlKHRhYmxlKTtcbiAgICAgIHZhciBoZWlnaHRzID0gZ2V0UGl4ZWxIZWlnaHRzKHdhcmVob3VzZSwgdGFibGUsIGRpcmVjdGlvbik7XG4gICAgICB2YXIgbmV3SGVpZ2h0cyA9IG1hcChoZWlnaHRzLCBmdW5jdGlvbiAoZHksIGkpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4ID09PSBpID8gTWF0aC5tYXgoZGVsdGEgKyBkeSwgbWluSGVpZ2h0KCkpIDogZHk7XG4gICAgICB9KTtcbiAgICAgIHZhciBuZXdDZWxsU2l6ZXMgPSByZWNhbGN1bGF0ZUhlaWdodEZvckNlbGxzKHdhcmVob3VzZSwgbmV3SGVpZ2h0cyk7XG4gICAgICB2YXIgbmV3Um93U2l6ZXMgPSBtYXRjaFJvd0hlaWdodCh3YXJlaG91c2UsIG5ld0hlaWdodHMpO1xuICAgICAgZWFjaChuZXdSb3dTaXplcywgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICBzZXRIZWlnaHQocm93LmVsZW1lbnQsIHJvdy5oZWlnaHQpO1xuICAgICAgfSk7XG4gICAgICBlYWNoKG5ld0NlbGxTaXplcywgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgc2V0SGVpZ2h0KGNlbGwuZWxlbWVudCwgY2VsbC5oZWlnaHQpO1xuICAgICAgfSk7XG4gICAgICB2YXIgdG90YWwgPSBzdW1VcChuZXdIZWlnaHRzKTtcbiAgICAgIHNldEhlaWdodCh0YWJsZSwgdG90YWwpO1xuICAgIH07XG4gICAgdmFyIGFkanVzdEFuZFJlZGlzdHJpYnV0ZVdpZHRocyA9IGZ1bmN0aW9uIChfdGFibGUsIGxpc3QsIGRldGFpbHMsIHRhYmxlU2l6ZSwgcmVzaXplQmVoYXZpb3VyKSB7XG4gICAgICB2YXIgd2FyZWhvdXNlID0gV2FyZWhvdXNlLmdlbmVyYXRlKGxpc3QpO1xuICAgICAgdmFyIHNpemVzID0gdGFibGVTaXplLmdldFdpZHRocyh3YXJlaG91c2UsIHRhYmxlU2l6ZSk7XG4gICAgICB2YXIgdGFibGVQaXhlbFdpZHRoID0gdGFibGVTaXplLnBpeGVsV2lkdGgoKTtcbiAgICAgIHZhciBfYSA9IHJlc2l6ZUJlaGF2aW91ci5jYWxjUmVkZXN0cmlidXRlZFdpZHRocyhzaXplcywgdGFibGVQaXhlbFdpZHRoLCBkZXRhaWxzLnBpeGVsRGVsdGEsIHRhYmxlU2l6ZS5pc1JlbGF0aXZlKSwgbmV3U2l6ZXMgPSBfYS5uZXdTaXplcywgZGVsdGEgPSBfYS5kZWx0YTtcbiAgICAgIHJlY2FsY3VsYXRlQW5kQXBwbHkod2FyZWhvdXNlLCBuZXdTaXplcywgdGFibGVTaXplKTtcbiAgICAgIHRhYmxlU2l6ZS5hZGp1c3RUYWJsZVdpZHRoKGRlbHRhKTtcbiAgICB9O1xuICAgIHZhciBhZGp1c3RXaWR0aFRvID0gZnVuY3Rpb24gKF90YWJsZSwgbGlzdCwgX2luZm8sIHRhYmxlU2l6ZSkge1xuICAgICAgdmFyIHdhcmVob3VzZSA9IFdhcmVob3VzZS5nZW5lcmF0ZShsaXN0KTtcbiAgICAgIHZhciB3aWR0aHMgPSB0YWJsZVNpemUuZ2V0V2lkdGhzKHdhcmVob3VzZSwgdGFibGVTaXplKTtcbiAgICAgIHJlY2FsY3VsYXRlQW5kQXBwbHkod2FyZWhvdXNlLCB3aWR0aHMsIHRhYmxlU2l6ZSk7XG4gICAgfTtcblxuICAgIHZhciB6ZXJvID0gZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICByZXR1cm4gbWFwKGFycmF5LCBjb25zdGFudCgwKSk7XG4gICAgfTtcbiAgICB2YXIgc3Vycm91bmQgPSBmdW5jdGlvbiAoc2l6ZXMsIHN0YXJ0SW5kZXgsIGVuZEluZGV4LCByZXN1bHRzLCBmKSB7XG4gICAgICByZXR1cm4gZihzaXplcy5zbGljZSgwLCBzdGFydEluZGV4KSkuY29uY2F0KHJlc3VsdHMpLmNvbmNhdChmKHNpemVzLnNsaWNlKGVuZEluZGV4KSkpO1xuICAgIH07XG4gICAgdmFyIGNsYW1wRGVsdGFIZWxwZXIgPSBmdW5jdGlvbiAocHJlZGljYXRlKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNpemVzLCBpbmRleCwgZGVsdGEsIG1pbkNlbGxTaXplKSB7XG4gICAgICAgIGlmICghcHJlZGljYXRlKGRlbHRhKSkge1xuICAgICAgICAgIHJldHVybiBkZWx0YTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgbmV3U2l6ZSA9IE1hdGgubWF4KG1pbkNlbGxTaXplLCBzaXplc1tpbmRleF0gLSBNYXRoLmFicyhkZWx0YSkpO1xuICAgICAgICAgIHZhciBkaWZmID0gTWF0aC5hYnMobmV3U2l6ZSAtIHNpemVzW2luZGV4XSk7XG4gICAgICAgICAgcmV0dXJuIGRlbHRhID49IDAgPyBkaWZmIDogLWRpZmY7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY2xhbXBOZWdhdGl2ZURlbHRhID0gY2xhbXBEZWx0YUhlbHBlcihmdW5jdGlvbiAoZGVsdGEpIHtcbiAgICAgIHJldHVybiBkZWx0YSA8IDA7XG4gICAgfSk7XG4gICAgdmFyIGNsYW1wRGVsdGEgPSBjbGFtcERlbHRhSGVscGVyKGFsd2F5cyk7XG4gICAgdmFyIHJlc2l6ZVRhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGNhbGNGaXhlZERlbHRhcyA9IGZ1bmN0aW9uIChzaXplcywgaW5kZXgsIG5leHQsIGRlbHRhLCBtaW5DZWxsU2l6ZSkge1xuICAgICAgICB2YXIgY2xhbXBlZERlbHRhID0gY2xhbXBOZWdhdGl2ZURlbHRhKHNpemVzLCBpbmRleCwgZGVsdGEsIG1pbkNlbGxTaXplKTtcbiAgICAgICAgcmV0dXJuIHN1cnJvdW5kKHNpemVzLCBpbmRleCwgbmV4dCArIDEsIFtcbiAgICAgICAgICBjbGFtcGVkRGVsdGEsXG4gICAgICAgICAgMFxuICAgICAgICBdLCB6ZXJvKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2FsY1JlbGF0aXZlRGVsdGFzID0gZnVuY3Rpb24gKHNpemVzLCBpbmRleCwgZGVsdGEsIG1pbkNlbGxTaXplKSB7XG4gICAgICAgIHZhciByYXRpbyA9ICgxMDAgKyBkZWx0YSkgLyAxMDA7XG4gICAgICAgIHZhciBuZXdUaGlzID0gTWF0aC5tYXgobWluQ2VsbFNpemUsIChzaXplc1tpbmRleF0gKyBkZWx0YSkgLyByYXRpbyk7XG4gICAgICAgIHJldHVybiBtYXAoc2l6ZXMsIGZ1bmN0aW9uIChzaXplLCBpZHgpIHtcbiAgICAgICAgICB2YXIgbmV3U2l6ZSA9IGlkeCA9PT0gaW5kZXggPyBuZXdUaGlzIDogc2l6ZSAvIHJhdGlvO1xuICAgICAgICAgIHJldHVybiBuZXdTaXplIC0gc2l6ZTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGNMZWZ0RWRnZURlbHRhcyA9IGZ1bmN0aW9uIChzaXplcywgaW5kZXgsIG5leHQsIGRlbHRhLCBtaW5DZWxsU2l6ZSwgaXNSZWxhdGl2ZSkge1xuICAgICAgICBpZiAoaXNSZWxhdGl2ZSkge1xuICAgICAgICAgIHJldHVybiBjYWxjUmVsYXRpdmVEZWx0YXMoc2l6ZXMsIGluZGV4LCBkZWx0YSwgbWluQ2VsbFNpemUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBjYWxjRml4ZWREZWx0YXMoc2l6ZXMsIGluZGV4LCBuZXh0LCBkZWx0YSwgbWluQ2VsbFNpemUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGNNaWRkbGVEZWx0YXMgPSBmdW5jdGlvbiAoc2l6ZXMsIF9wcmV2LCBpbmRleCwgbmV4dCwgZGVsdGEsIG1pbkNlbGxTaXplLCBpc1JlbGF0aXZlKSB7XG4gICAgICAgIHJldHVybiBjYWxjTGVmdEVkZ2VEZWx0YXMoc2l6ZXMsIGluZGV4LCBuZXh0LCBkZWx0YSwgbWluQ2VsbFNpemUsIGlzUmVsYXRpdmUpO1xuICAgICAgfTtcbiAgICAgIHZhciByZXNpemVUYWJsZSA9IGZ1bmN0aW9uIChyZXNpemVyLCBkZWx0YSkge1xuICAgICAgICByZXR1cm4gcmVzaXplcihkZWx0YSk7XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGNSaWdodEVkZ2VEZWx0YXMgPSBmdW5jdGlvbiAoc2l6ZXMsIF9wcmV2LCBpbmRleCwgZGVsdGEsIG1pbkNlbGxTaXplLCBpc1JlbGF0aXZlKSB7XG4gICAgICAgIGlmIChpc1JlbGF0aXZlKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGNSZWxhdGl2ZURlbHRhcyhzaXplcywgaW5kZXgsIGRlbHRhLCBtaW5DZWxsU2l6ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIGNsYW1wZWREZWx0YSA9IGNsYW1wTmVnYXRpdmVEZWx0YShzaXplcywgaW5kZXgsIGRlbHRhLCBtaW5DZWxsU2l6ZSk7XG4gICAgICAgICAgcmV0dXJuIHplcm8oc2l6ZXMuc2xpY2UoMCwgaW5kZXgpKS5jb25jYXQoW2NsYW1wZWREZWx0YV0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGNSZWRlc3RyaWJ1dGVkV2lkdGhzID0gZnVuY3Rpb24gKHNpemVzLCB0b3RhbFdpZHRoLCBwaXhlbERlbHRhLCBpc1JlbGF0aXZlKSB7XG4gICAgICAgIGlmIChpc1JlbGF0aXZlKSB7XG4gICAgICAgICAgdmFyIHRhYmxlV2lkdGggPSB0b3RhbFdpZHRoICsgcGl4ZWxEZWx0YTtcbiAgICAgICAgICB2YXIgcmF0aW9fMSA9IHRhYmxlV2lkdGggLyB0b3RhbFdpZHRoO1xuICAgICAgICAgIHZhciBuZXdTaXplcyA9IG1hcChzaXplcywgZnVuY3Rpb24gKHNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiBzaXplIC8gcmF0aW9fMTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGVsdGE6IHJhdGlvXzEgKiAxMDAgLSAxMDAsXG4gICAgICAgICAgICBuZXdTaXplczogbmV3U2l6ZXNcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWx0YTogcGl4ZWxEZWx0YSxcbiAgICAgICAgICAgIG5ld1NpemVzOiBzaXplc1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXNpemVUYWJsZTogcmVzaXplVGFibGUsXG4gICAgICAgIGNsYW1wVGFibGVEZWx0YTogY2xhbXBOZWdhdGl2ZURlbHRhLFxuICAgICAgICBjYWxjTGVmdEVkZ2VEZWx0YXM6IGNhbGNMZWZ0RWRnZURlbHRhcyxcbiAgICAgICAgY2FsY01pZGRsZURlbHRhczogY2FsY01pZGRsZURlbHRhcyxcbiAgICAgICAgY2FsY1JpZ2h0RWRnZURlbHRhczogY2FsY1JpZ2h0RWRnZURlbHRhcyxcbiAgICAgICAgY2FsY1JlZGVzdHJpYnV0ZWRXaWR0aHM6IGNhbGNSZWRlc3RyaWJ1dGVkV2lkdGhzXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHByZXNlcnZlVGFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY2FsY0xlZnRFZGdlRGVsdGFzID0gZnVuY3Rpb24gKHNpemVzLCBpbmRleCwgbmV4dCwgZGVsdGEsIG1pbkNlbGxTaXplKSB7XG4gICAgICAgIHZhciBpZHggPSBkZWx0YSA+PSAwID8gbmV4dCA6IGluZGV4O1xuICAgICAgICB2YXIgY2xhbXBlZERlbHRhID0gY2xhbXBEZWx0YShzaXplcywgaWR4LCBkZWx0YSwgbWluQ2VsbFNpemUpO1xuICAgICAgICByZXR1cm4gc3Vycm91bmQoc2l6ZXMsIGluZGV4LCBuZXh0ICsgMSwgW1xuICAgICAgICAgIGNsYW1wZWREZWx0YSxcbiAgICAgICAgICAtY2xhbXBlZERlbHRhXG4gICAgICAgIF0sIHplcm8pO1xuICAgICAgfTtcbiAgICAgIHZhciBjYWxjTWlkZGxlRGVsdGFzID0gZnVuY3Rpb24gKHNpemVzLCBfcHJldiwgaW5kZXgsIG5leHQsIGRlbHRhLCBtaW5DZWxsU2l6ZSkge1xuICAgICAgICByZXR1cm4gY2FsY0xlZnRFZGdlRGVsdGFzKHNpemVzLCBpbmRleCwgbmV4dCwgZGVsdGEsIG1pbkNlbGxTaXplKTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVzaXplVGFibGUgPSBmdW5jdGlvbiAocmVzaXplciwgZGVsdGEsIGlzTGFzdENvbHVtbikge1xuICAgICAgICBpZiAoaXNMYXN0Q29sdW1uKSB7XG4gICAgICAgICAgcmVzaXplcihkZWx0YSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgY2FsY1JpZ2h0RWRnZURlbHRhcyA9IGZ1bmN0aW9uIChzaXplcywgX3ByZXYsIF9pbmRleCwgZGVsdGEsIF9taW5DZWxsU2l6ZSwgaXNSZWxhdGl2ZSkge1xuICAgICAgICBpZiAoaXNSZWxhdGl2ZSkge1xuICAgICAgICAgIHJldHVybiB6ZXJvKHNpemVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgZGlmZiA9IGRlbHRhIC8gc2l6ZXMubGVuZ3RoO1xuICAgICAgICAgIHJldHVybiBtYXAoc2l6ZXMsIGNvbnN0YW50KGRpZmYpKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBjbGFtcFRhYmxlRGVsdGEgPSBmdW5jdGlvbiAoc2l6ZXMsIGluZGV4LCBkZWx0YSwgbWluQ2VsbFNpemUsIGlzTGFzdENvbHVtbikge1xuICAgICAgICBpZiAoaXNMYXN0Q29sdW1uKSB7XG4gICAgICAgICAgaWYgKGRlbHRhID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBkZWx0YTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIG1heERlbHRhID0gZm9sZGwoc2l6ZXMsIGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBhICsgYiAtIG1pbkNlbGxTaXplO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoLW1heERlbHRhLCBkZWx0YSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBjbGFtcE5lZ2F0aXZlRGVsdGEoc2l6ZXMsIGluZGV4LCBkZWx0YSwgbWluQ2VsbFNpemUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGNhbGNSZWRlc3RyaWJ1dGVkV2lkdGhzID0gZnVuY3Rpb24gKHNpemVzLCBfdG90YWxXaWR0aCwgX3BpeGVsRGVsdGEsIF9pc1JlbGF0aXZlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGVsdGE6IDAsXG4gICAgICAgICAgbmV3U2l6ZXM6IHNpemVzXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzaXplVGFibGU6IHJlc2l6ZVRhYmxlLFxuICAgICAgICBjbGFtcFRhYmxlRGVsdGE6IGNsYW1wVGFibGVEZWx0YSxcbiAgICAgICAgY2FsY0xlZnRFZGdlRGVsdGFzOiBjYWxjTGVmdEVkZ2VEZWx0YXMsXG4gICAgICAgIGNhbGNNaWRkbGVEZWx0YXM6IGNhbGNNaWRkbGVEZWx0YXMsXG4gICAgICAgIGNhbGNSaWdodEVkZ2VEZWx0YXM6IGNhbGNSaWdodEVkZ2VEZWx0YXMsXG4gICAgICAgIGNhbGNSZWRlc3RyaWJ1dGVkV2lkdGhzOiBjYWxjUmVkZXN0cmlidXRlZFdpZHRoc1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIG9ubHkgPSBmdW5jdGlvbiAoZWxlbWVudCwgaXNSZXNpemFibGUpIHtcbiAgICAgIHZhciBwYXJlbnQgPSBPcHRpb25hbC5mcm9tKGVsZW1lbnQuZG9tLmRvY3VtZW50RWxlbWVudCkubWFwKFN1Z2FyRWxlbWVudC5mcm9tRG9tKS5nZXRPcihlbGVtZW50KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhcmVudDogY29uc3RhbnQocGFyZW50KSxcbiAgICAgICAgdmlldzogY29uc3RhbnQoZWxlbWVudCksXG4gICAgICAgIG9yaWdpbjogY29uc3RhbnQoU3VnYXJQb3NpdGlvbigwLCAwKSksXG4gICAgICAgIGlzUmVzaXphYmxlOiBpc1Jlc2l6YWJsZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBkZXRhY2hlZCA9IGZ1bmN0aW9uIChlZGl0YWJsZSwgY2hyb21lLCBpc1Jlc2l6YWJsZSkge1xuICAgICAgdmFyIG9yaWdpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGFic29sdXRlKGNocm9tZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGFyZW50OiBjb25zdGFudChjaHJvbWUpLFxuICAgICAgICB2aWV3OiBjb25zdGFudChlZGl0YWJsZSksXG4gICAgICAgIG9yaWdpbjogb3JpZ2luLFxuICAgICAgICBpc1Jlc2l6YWJsZTogaXNSZXNpemFibGVcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYm9keSQxID0gZnVuY3Rpb24gKGVkaXRhYmxlLCBjaHJvbWUsIGlzUmVzaXphYmxlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwYXJlbnQ6IGNvbnN0YW50KGNocm9tZSksXG4gICAgICAgIHZpZXc6IGNvbnN0YW50KGVkaXRhYmxlKSxcbiAgICAgICAgb3JpZ2luOiBjb25zdGFudChTdWdhclBvc2l0aW9uKDAsIDApKSxcbiAgICAgICAgaXNSZXNpemFibGU6IGlzUmVzaXphYmxlXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFJlc2l6ZVdpcmUgPSB7XG4gICAgICBvbmx5OiBvbmx5LFxuICAgICAgZGV0YWNoZWQ6IGRldGFjaGVkLFxuICAgICAgYm9keTogYm9keSQxXG4gICAgfTtcblxuICAgIHZhciBhZHQkMSA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7IGludmFsaWQ6IFsncmF3J10gfSxcbiAgICAgIHsgcGl4ZWxzOiBbJ3ZhbHVlJ10gfSxcbiAgICAgIHsgcGVyY2VudDogWyd2YWx1ZSddIH1cbiAgICBdKTtcbiAgICB2YXIgdmFsaWRhdGVGb3IgPSBmdW5jdGlvbiAoc3VmZml4LCB0eXBlLCB2YWx1ZSkge1xuICAgICAgdmFyIHJhd0Ftb3VudCA9IHZhbHVlLnN1YnN0cmluZygwLCB2YWx1ZS5sZW5ndGggLSBzdWZmaXgubGVuZ3RoKTtcbiAgICAgIHZhciBhbW91bnQgPSBwYXJzZUZsb2F0KHJhd0Ftb3VudCk7XG4gICAgICByZXR1cm4gcmF3QW1vdW50ID09PSBhbW91bnQudG9TdHJpbmcoKSA/IHR5cGUoYW1vdW50KSA6IGFkdCQxLmludmFsaWQodmFsdWUpO1xuICAgIH07XG4gICAgdmFyIGZyb20kMSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKGVuZHNXaXRoKHZhbHVlLCAnJScpKSB7XG4gICAgICAgIHJldHVybiB2YWxpZGF0ZUZvcignJScsIGFkdCQxLnBlcmNlbnQsIHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmIChlbmRzV2l0aCh2YWx1ZSwgJ3B4JykpIHtcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRlRm9yKCdweCcsIGFkdCQxLnBpeGVscywgdmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGFkdCQxLmludmFsaWQodmFsdWUpO1xuICAgIH07XG4gICAgdmFyIFNpemUgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYWR0JDEpLCB7IGZyb206IGZyb20kMSB9KTtcblxuICAgIHZhciByZWRpc3RyaWJ1dGVUb1BlcmNlbnQgPSBmdW5jdGlvbiAod2lkdGhzLCB0b3RhbFdpZHRoKSB7XG4gICAgICByZXR1cm4gbWFwKHdpZHRocywgZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgdmFyIGNvbFR5cGUgPSBTaXplLmZyb20odyk7XG4gICAgICAgIHJldHVybiBjb2xUeXBlLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB3O1xuICAgICAgICB9LCBmdW5jdGlvbiAocHgpIHtcbiAgICAgICAgICB2YXIgcmF0aW8gPSBweCAvIHRvdGFsV2lkdGggKiAxMDA7XG4gICAgICAgICAgcmV0dXJuIHJhdGlvICsgJyUnO1xuICAgICAgICB9LCBmdW5jdGlvbiAocGMpIHtcbiAgICAgICAgICByZXR1cm4gcGMgKyAnJSc7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcmVkaXN0cmlidXRlVG9QeCA9IGZ1bmN0aW9uICh3aWR0aHMsIHRvdGFsV2lkdGgsIG5ld1RvdGFsV2lkdGgpIHtcbiAgICAgIHZhciBzY2FsZSA9IG5ld1RvdGFsV2lkdGggLyB0b3RhbFdpZHRoO1xuICAgICAgcmV0dXJuIG1hcCh3aWR0aHMsIGZ1bmN0aW9uICh3KSB7XG4gICAgICAgIHZhciBjb2xUeXBlID0gU2l6ZS5mcm9tKHcpO1xuICAgICAgICByZXR1cm4gY29sVHlwZS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdztcbiAgICAgICAgfSwgZnVuY3Rpb24gKHB4KSB7XG4gICAgICAgICAgcmV0dXJuIHB4ICogc2NhbGUgKyAncHgnO1xuICAgICAgICB9LCBmdW5jdGlvbiAocGMpIHtcbiAgICAgICAgICByZXR1cm4gcGMgLyAxMDAgKiBuZXdUb3RhbFdpZHRoICsgJ3B4JztcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWRpc3RyaWJ1dGVFbXB0eSA9IGZ1bmN0aW9uIChuZXdXaWR0aFR5cGUsIGNvbHVtbnMpIHtcbiAgICAgIHZhciBmID0gbmV3V2lkdGhUeXBlLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gY29uc3RhbnQoJycpO1xuICAgICAgfSwgZnVuY3Rpb24gKHBpeGVscykge1xuICAgICAgICB2YXIgbnVtID0gcGl4ZWxzIC8gY29sdW1ucztcbiAgICAgICAgcmV0dXJuIGNvbnN0YW50KG51bSArICdweCcpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbnVtID0gMTAwIC8gY29sdW1ucztcbiAgICAgICAgcmV0dXJuIGNvbnN0YW50KG51bSArICclJyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByYW5nZShjb2x1bW5zLCBmKTtcbiAgICB9O1xuICAgIHZhciByZWRpc3RyaWJ1dGVWYWx1ZXMgPSBmdW5jdGlvbiAobmV3V2lkdGhUeXBlLCB3aWR0aHMsIHRvdGFsV2lkdGgpIHtcbiAgICAgIHJldHVybiBuZXdXaWR0aFR5cGUuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB3aWR0aHM7XG4gICAgICB9LCBmdW5jdGlvbiAocHgpIHtcbiAgICAgICAgcmV0dXJuIHJlZGlzdHJpYnV0ZVRvUHgod2lkdGhzLCB0b3RhbFdpZHRoLCBweCk7XG4gICAgICB9LCBmdW5jdGlvbiAoX3BjKSB7XG4gICAgICAgIHJldHVybiByZWRpc3RyaWJ1dGVUb1BlcmNlbnQod2lkdGhzLCB0b3RhbFdpZHRoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZGlzdHJpYnV0ZSA9IGZ1bmN0aW9uICh3aWR0aHMsIHRvdGFsV2lkdGgsIG5ld1dpZHRoKSB7XG4gICAgICB2YXIgbmV3VHlwZSA9IFNpemUuZnJvbShuZXdXaWR0aCk7XG4gICAgICB2YXIgZmxvYXRzID0gZm9yYWxsKHdpZHRocywgZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMgPT09ICcwcHgnO1xuICAgICAgfSkgPyByZWRpc3RyaWJ1dGVFbXB0eShuZXdUeXBlLCB3aWR0aHMubGVuZ3RoKSA6IHJlZGlzdHJpYnV0ZVZhbHVlcyhuZXdUeXBlLCB3aWR0aHMsIHRvdGFsV2lkdGgpO1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZShmbG9hdHMpO1xuICAgIH07XG4gICAgdmFyIHN1bSA9IGZ1bmN0aW9uICh2YWx1ZXMsIGZhbGxiYWNrKSB7XG4gICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZmFsbGJhY2s7XG4gICAgICB9XG4gICAgICByZXR1cm4gZm9sZHIodmFsdWVzLCBmdW5jdGlvbiAocmVzdCwgdikge1xuICAgICAgICByZXR1cm4gU2l6ZS5mcm9tKHYpLmZvbGQoY29uc3RhbnQoMCksIGlkZW50aXR5LCBpZGVudGl0eSkgKyByZXN0O1xuICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICB2YXIgcm91bmREb3duID0gZnVuY3Rpb24gKG51bSwgdW5pdCkge1xuICAgICAgdmFyIGZsb29yZWQgPSBNYXRoLmZsb29yKG51bSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogZmxvb3JlZCArIHVuaXQsXG4gICAgICAgIHJlbWFpbmRlcjogbnVtIC0gZmxvb3JlZFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBhZGQgPSBmdW5jdGlvbiAodmFsdWUsIGFtb3VudCkge1xuICAgICAgcmV0dXJuIFNpemUuZnJvbSh2YWx1ZSkuZm9sZChjb25zdGFudCh2YWx1ZSksIGZ1bmN0aW9uIChweCkge1xuICAgICAgICByZXR1cm4gcHggKyBhbW91bnQgKyAncHgnO1xuICAgICAgfSwgZnVuY3Rpb24gKHBjKSB7XG4gICAgICAgIHJldHVybiBwYyArIGFtb3VudCArICclJztcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG5vcm1hbGl6ZSA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgICB9XG4gICAgICB2YXIgc2NhbiA9IGZvbGRyKHZhbHVlcywgZnVuY3Rpb24gKHJlc3QsIHZhbHVlKSB7XG4gICAgICAgIHZhciBpbmZvID0gU2l6ZS5mcm9tKHZhbHVlKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgcmVtYWluZGVyOiAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKG51bSkge1xuICAgICAgICAgIHJldHVybiByb3VuZERvd24obnVtLCAncHgnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKG51bSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogbnVtICsgJyUnLFxuICAgICAgICAgICAgcmVtYWluZGVyOiAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb3V0cHV0OiBbaW5mby52YWx1ZV0uY29uY2F0KHJlc3Qub3V0cHV0KSxcbiAgICAgICAgICByZW1haW5kZXI6IHJlc3QucmVtYWluZGVyICsgaW5mby5yZW1haW5kZXJcbiAgICAgICAgfTtcbiAgICAgIH0sIHtcbiAgICAgICAgb3V0cHV0OiBbXSxcbiAgICAgICAgcmVtYWluZGVyOiAwXG4gICAgICB9KTtcbiAgICAgIHZhciByID0gc2Nhbi5vdXRwdXQ7XG4gICAgICByZXR1cm4gci5zbGljZSgwLCByLmxlbmd0aCAtIDEpLmNvbmNhdChbYWRkKHJbci5sZW5ndGggLSAxXSwgTWF0aC5yb3VuZChzY2FuLnJlbWFpbmRlcikpXSk7XG4gICAgfTtcbiAgICB2YXIgdmFsaWRhdGUgPSBTaXplLmZyb207XG5cbiAgICB2YXIgcmVkaXN0cmlidXRlVG9XID0gZnVuY3Rpb24gKG5ld1dpZHRocywgY2VsbHMsIHVuaXQpIHtcbiAgICAgIGVhY2goY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgIHZhciB3aWR0aHMgPSBuZXdXaWR0aHMuc2xpY2UoY2VsbC5jb2x1bW4sIGNlbGwuY29sc3BhbiArIGNlbGwuY29sdW1uKTtcbiAgICAgICAgdmFyIHcgPSBzdW0od2lkdGhzLCBtaW5XaWR0aCgpKTtcbiAgICAgICAgc2V0JDEoY2VsbC5lbGVtZW50LCAnd2lkdGgnLCB3ICsgdW5pdCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWRpc3RyaWJ1dGVUb0NvbHVtbnMgPSBmdW5jdGlvbiAobmV3V2lkdGhzLCBjb2x1bW5zLCB1bml0KSB7XG4gICAgICBlYWNoKGNvbHVtbnMsIGZ1bmN0aW9uIChjb2x1bW4sIGluZGV4KSB7XG4gICAgICAgIHZhciB3aWR0aCA9IHN1bShbbmV3V2lkdGhzW2luZGV4XV0sIG1pbldpZHRoKCkpO1xuICAgICAgICBzZXQkMShjb2x1bW4uZWxlbWVudCwgJ3dpZHRoJywgd2lkdGggKyB1bml0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZGlzdHJpYnV0ZVRvSCA9IGZ1bmN0aW9uIChuZXdIZWlnaHRzLCByb3dzLCBjZWxscywgdW5pdCkge1xuICAgICAgZWFjaChjZWxscywgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgdmFyIGhlaWdodHMgPSBuZXdIZWlnaHRzLnNsaWNlKGNlbGwucm93LCBjZWxsLnJvd3NwYW4gKyBjZWxsLnJvdyk7XG4gICAgICAgIHZhciBoID0gc3VtKGhlaWdodHMsIG1pbkhlaWdodCgpKTtcbiAgICAgICAgc2V0JDEoY2VsbC5lbGVtZW50LCAnaGVpZ2h0JywgaCArIHVuaXQpO1xuICAgICAgfSk7XG4gICAgICBlYWNoKHJvd3MsIGZ1bmN0aW9uIChyb3csIGkpIHtcbiAgICAgICAgc2V0JDEocm93LmVsZW1lbnQsICdoZWlnaHQnLCBuZXdIZWlnaHRzW2ldKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFVuaXQgPSBmdW5jdGlvbiAobmV3U2l6ZSkge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlKG5ld1NpemUpLmZvbGQoY29uc3RhbnQoJ3B4JyksIGNvbnN0YW50KCdweCcpLCBjb25zdGFudCgnJScpKTtcbiAgICB9O1xuICAgIHZhciByZWRpc3RyaWJ1dGUkMSA9IGZ1bmN0aW9uICh0YWJsZSwgb3B0V2lkdGgsIG9wdEhlaWdodCwgdGFibGVTaXplKSB7XG4gICAgICB2YXIgd2FyZWhvdXNlID0gV2FyZWhvdXNlLmZyb21UYWJsZSh0YWJsZSk7XG4gICAgICB2YXIgcm93cyA9IHdhcmVob3VzZS5hbGw7XG4gICAgICB2YXIgY2VsbHMgPSBXYXJlaG91c2UuanVzdENlbGxzKHdhcmVob3VzZSk7XG4gICAgICB2YXIgY29sdW1ucyA9IFdhcmVob3VzZS5qdXN0Q29sdW1ucyh3YXJlaG91c2UpO1xuICAgICAgb3B0V2lkdGguZWFjaChmdW5jdGlvbiAobmV3V2lkdGgpIHtcbiAgICAgICAgdmFyIHdpZHRoVW5pdCA9IGdldFVuaXQobmV3V2lkdGgpO1xuICAgICAgICB2YXIgdG90YWxXaWR0aCA9IGdldCQ1KHRhYmxlKTtcbiAgICAgICAgdmFyIG9sZFdpZHRocyA9IGdldFJhd1dpZHRocyh3YXJlaG91c2UsIHRhYmxlLCB0YWJsZVNpemUpO1xuICAgICAgICB2YXIgbnVXaWR0aHMgPSByZWRpc3RyaWJ1dGUob2xkV2lkdGhzLCB0b3RhbFdpZHRoLCBuZXdXaWR0aCk7XG4gICAgICAgIGlmIChXYXJlaG91c2UuaGFzQ29sdW1ucyh3YXJlaG91c2UpKSB7XG4gICAgICAgICAgcmVkaXN0cmlidXRlVG9Db2x1bW5zKG51V2lkdGhzLCBjb2x1bW5zLCB3aWR0aFVuaXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlZGlzdHJpYnV0ZVRvVyhudVdpZHRocywgY2VsbHMsIHdpZHRoVW5pdCk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0JDEodGFibGUsICd3aWR0aCcsIG5ld1dpZHRoKTtcbiAgICAgIH0pO1xuICAgICAgb3B0SGVpZ2h0LmVhY2goZnVuY3Rpb24gKG5ld0hlaWdodCkge1xuICAgICAgICB2YXIgaFVuaXQgPSBnZXRVbml0KG5ld0hlaWdodCk7XG4gICAgICAgIHZhciB0b3RhbEhlaWdodCA9IGdldCQ2KHRhYmxlKTtcbiAgICAgICAgdmFyIG9sZEhlaWdodHMgPSBnZXRSYXdIZWlnaHRzKHdhcmVob3VzZSwgdGFibGUsIGhlaWdodCk7XG4gICAgICAgIHZhciBudUhlaWdodHMgPSByZWRpc3RyaWJ1dGUob2xkSGVpZ2h0cywgdG90YWxIZWlnaHQsIG5ld0hlaWdodCk7XG4gICAgICAgIHJlZGlzdHJpYnV0ZVRvSChudUhlaWdodHMsIHJvd3MsIGNlbGxzLCBoVW5pdCk7XG4gICAgICAgIHNldCQxKHRhYmxlLCAnaGVpZ2h0JywgbmV3SGVpZ2h0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzUGVyY2VudFNpemluZyQxID0gaXNQZXJjZW50U2l6aW5nO1xuICAgIHZhciBpc1BpeGVsU2l6aW5nJDEgPSBpc1BpeGVsU2l6aW5nO1xuICAgIHZhciBpc05vbmVTaXppbmckMSA9IGlzTm9uZVNpemluZztcbiAgICB2YXIgZ2V0UGVyY2VudFRhYmxlV2lkdGgkMSA9IGdldFBlcmNlbnRUYWJsZVdpZHRoO1xuXG4gICAgdmFyIGdldEdyaWRTaXplID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICB2YXIgd2FyZWhvdXNlID0gV2FyZWhvdXNlLmZyb21UYWJsZSh0YWJsZSk7XG4gICAgICByZXR1cm4gd2FyZWhvdXNlLmdyaWQ7XG4gICAgfTtcblxuICAgIHZhciBFdmVudCA9IGZ1bmN0aW9uIChmaWVsZHMpIHtcbiAgICAgIHZhciBoYW5kbGVycyA9IFtdO1xuICAgICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICBpZiAoaGFuZGxlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFdmVudCBiaW5kIGVycm9yOiB1bmRlZmluZWQgaGFuZGxlcicpO1xuICAgICAgICB9XG4gICAgICAgIGhhbmRsZXJzLnB1c2goaGFuZGxlcik7XG4gICAgICB9O1xuICAgICAgdmFyIHVuYmluZCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIGhhbmRsZXJzID0gZmlsdGVyKGhhbmRsZXJzLCBmdW5jdGlvbiAoaCkge1xuICAgICAgICAgIHJldHVybiBoICE9PSBoYW5kbGVyO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdHJpZ2dlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV2ZW50ID0ge307XG4gICAgICAgIGVhY2goZmllbGRzLCBmdW5jdGlvbiAobmFtZSwgaSkge1xuICAgICAgICAgIGV2ZW50W25hbWVdID0gYXJnc1tpXTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVhY2goaGFuZGxlcnMsIGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgICAgaGFuZGxlcihldmVudCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJpbmQ6IGJpbmQsXG4gICAgICAgIHVuYmluZDogdW5iaW5kLFxuICAgICAgICB0cmlnZ2VyOiB0cmlnZ2VyXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgY3JlYXRlID0gZnVuY3Rpb24gKHR5cGVEZWZzKSB7XG4gICAgICB2YXIgcmVnaXN0cnkgPSBtYXAkMSh0eXBlRGVmcywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYmluZDogZXZlbnQuYmluZCxcbiAgICAgICAgICB1bmJpbmQ6IGV2ZW50LnVuYmluZFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICB2YXIgdHJpZ2dlciA9IG1hcCQxKHR5cGVEZWZzLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50LnRyaWdnZXI7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlZ2lzdHJ5OiByZWdpc3RyeSxcbiAgICAgICAgdHJpZ2dlcjogdHJpZ2dlclxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGxhc3QkMiA9IGZ1bmN0aW9uIChmbiwgcmF0ZSkge1xuICAgICAgdmFyIHRpbWVyID0gbnVsbDtcbiAgICAgIHZhciBjYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgICAgdGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIHRocm90dGxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZm4uYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgICAgdGltZXIgPSBudWxsO1xuICAgICAgICB9LCByYXRlKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW5jZWw6IGNhbmNlbCxcbiAgICAgICAgdGhyb3R0bGU6IHRocm90dGxlXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgc29ydCQxID0gZnVuY3Rpb24gKGFycikge1xuICAgICAgcmV0dXJuIGFyci5zbGljZSgwKS5zb3J0KCk7XG4gICAgfTtcbiAgICB2YXIgcmVxTWVzc2FnZSA9IGZ1bmN0aW9uIChyZXF1aXJlZCwga2V5cykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbGwgcmVxdWlyZWQga2V5cyAoJyArIHNvcnQkMShyZXF1aXJlZCkuam9pbignLCAnKSArICcpIHdlcmUgbm90IHNwZWNpZmllZC4gU3BlY2lmaWVkIGtleXMgd2VyZTogJyArIHNvcnQkMShrZXlzKS5qb2luKCcsICcpICsgJy4nKTtcbiAgICB9O1xuICAgIHZhciB1bnN1cHBNZXNzYWdlID0gZnVuY3Rpb24gKHVuc3VwcG9ydGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGtleXMgZm9yIG9iamVjdDogJyArIHNvcnQkMSh1bnN1cHBvcnRlZCkuam9pbignLCAnKSk7XG4gICAgfTtcbiAgICB2YXIgdmFsaWRhdGVTdHJBcnIgPSBmdW5jdGlvbiAobGFiZWwsIGFycmF5KSB7XG4gICAgICBpZiAoIWlzQXJyYXkoYXJyYXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlICcgKyBsYWJlbCArICcgZmllbGRzIG11c3QgYmUgYW4gYXJyYXkuIFdhczogJyArIGFycmF5ICsgJy4nKTtcbiAgICAgIH1cbiAgICAgIGVhY2goYXJyYXksIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGlmICghaXNTdHJpbmcoYSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB2YWx1ZSAnICsgYSArICcgaW4gdGhlICcgKyBsYWJlbCArICcgZmllbGRzIHdhcyBub3QgYSBzdHJpbmcuJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGludmFsaWRUeXBlTWVzc2FnZSA9IGZ1bmN0aW9uIChpbmNvcnJlY3QsIHR5cGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWxsIHZhbHVlcyBuZWVkIHRvIGJlIG9mIHR5cGU6ICcgKyB0eXBlICsgJy4gS2V5cyAoJyArIHNvcnQkMShpbmNvcnJlY3QpLmpvaW4oJywgJykgKyAnKSB3ZXJlIG5vdC4nKTtcbiAgICB9O1xuICAgIHZhciBjaGVja0R1cGVzID0gZnVuY3Rpb24gKGV2ZXJ5dGhpbmcpIHtcbiAgICAgIHZhciBzb3J0ZWQgPSBzb3J0JDEoZXZlcnl0aGluZyk7XG4gICAgICB2YXIgZHVwZSA9IGZpbmQoc29ydGVkLCBmdW5jdGlvbiAocywgaSkge1xuICAgICAgICByZXR1cm4gaSA8IHNvcnRlZC5sZW5ndGggLSAxICYmIHMgPT09IHNvcnRlZFtpICsgMV07XG4gICAgICB9KTtcbiAgICAgIGR1cGUuZWFjaChmdW5jdGlvbiAoZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBmaWVsZDogJyArIGQgKyAnIG9jY3VycyBtb3JlIHRoYW4gb25jZSBpbiB0aGUgY29tYmluZWQgZmllbGRzOiBbJyArIHNvcnRlZC5qb2luKCcsICcpICsgJ10uJyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGJhc2UgPSBmdW5jdGlvbiAoaGFuZGxlVW5zdXBwb3J0ZWQsIHJlcXVpcmVkKSB7XG4gICAgICByZXR1cm4gYmFzZVdpdGgoaGFuZGxlVW5zdXBwb3J0ZWQsIHJlcXVpcmVkLCB7XG4gICAgICAgIHZhbGlkYXRlOiBpc0Z1bmN0aW9uLFxuICAgICAgICBsYWJlbDogJ2Z1bmN0aW9uJ1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYmFzZVdpdGggPSBmdW5jdGlvbiAoaGFuZGxlVW5zdXBwb3J0ZWQsIHJlcXVpcmVkLCBwcmVkKSB7XG4gICAgICBpZiAocmVxdWlyZWQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgcmVxdWlyZWQgZmllbGQuJyk7XG4gICAgICB9XG4gICAgICB2YWxpZGF0ZVN0ckFycigncmVxdWlyZWQnLCByZXF1aXJlZCk7XG4gICAgICBjaGVja0R1cGVzKHJlcXVpcmVkKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHZhciBrZXlzJDEgPSBrZXlzKG9iaik7XG4gICAgICAgIHZhciBhbGxSZXFkID0gZm9yYWxsKHJlcXVpcmVkLCBmdW5jdGlvbiAocmVxKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5zKGtleXMkMSwgcmVxKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghYWxsUmVxZCkge1xuICAgICAgICAgIHJlcU1lc3NhZ2UocmVxdWlyZWQsIGtleXMkMSk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlVW5zdXBwb3J0ZWQocmVxdWlyZWQsIGtleXMkMSk7XG4gICAgICAgIHZhciBpbnZhbGlkS2V5cyA9IGZpbHRlcihyZXF1aXJlZCwgZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIHJldHVybiAhcHJlZC52YWxpZGF0ZShvYmpba2V5XSwga2V5KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpbnZhbGlkS2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgaW52YWxpZFR5cGVNZXNzYWdlKGludmFsaWRLZXlzLCBwcmVkLmxhYmVsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGVFeGFjdCA9IGZ1bmN0aW9uIChyZXF1aXJlZCwga2V5cykge1xuICAgICAgdmFyIHVuc3VwcG9ydGVkID0gZmlsdGVyKGtleXMsIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuICFjb250YWlucyhyZXF1aXJlZCwga2V5KTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHVuc3VwcG9ydGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdW5zdXBwTWVzc2FnZSh1bnN1cHBvcnRlZCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZXhhY3RseSA9IGZ1bmN0aW9uIChyZXF1aXJlZCkge1xuICAgICAgcmV0dXJuIGJhc2UoaGFuZGxlRXhhY3QsIHJlcXVpcmVkKTtcbiAgICB9O1xuXG4gICAgdmFyIERyYWdNb2RlID0gZXhhY3RseShbXG4gICAgICAnY29tcGFyZScsXG4gICAgICAnZXh0cmFjdCcsXG4gICAgICAnbXV0YXRlJyxcbiAgICAgICdzaW5rJ1xuICAgIF0pO1xuICAgIHZhciBEcmFnU2luayA9IGV4YWN0bHkoW1xuICAgICAgJ2VsZW1lbnQnLFxuICAgICAgJ3N0YXJ0JyxcbiAgICAgICdzdG9wJyxcbiAgICAgICdkZXN0cm95J1xuICAgIF0pO1xuICAgIHZhciBEcmFnQXBpID0gZXhhY3RseShbXG4gICAgICAnZm9yY2VEcm9wJyxcbiAgICAgICdkcm9wJyxcbiAgICAgICdtb3ZlJyxcbiAgICAgICdkZWxheURyb3AnXG4gICAgXSk7XG5cbiAgICB2YXIgSW5EcmFnID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHByZXZpb3VzID0gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIHJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBwcmV2aW91cyA9IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgdXBkYXRlID0gZnVuY3Rpb24gKG1vZGUsIG51KSB7XG4gICAgICAgIHZhciByZXN1bHQgPSBwcmV2aW91cy5tYXAoZnVuY3Rpb24gKG9sZCkge1xuICAgICAgICAgIHJldHVybiBtb2RlLmNvbXBhcmUob2xkLCBudSk7XG4gICAgICAgIH0pO1xuICAgICAgICBwcmV2aW91cyA9IE9wdGlvbmFsLnNvbWUobnUpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTtcbiAgICAgIHZhciBvbkV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50LCBtb2RlKSB7XG4gICAgICAgIHZhciBkYXRhT3B0aW9uID0gbW9kZS5leHRyYWN0KGV2ZW50KTtcbiAgICAgICAgZGF0YU9wdGlvbi5lYWNoKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgdmFyIG9mZnNldCA9IHVwZGF0ZShtb2RlLCBkYXRhKTtcbiAgICAgICAgICBvZmZzZXQuZWFjaChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgZXZlbnRzLnRyaWdnZXIubW92ZShkKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIGV2ZW50cyA9IGNyZWF0ZSh7IG1vdmU6IEV2ZW50KFsnaW5mbyddKSB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG9uRXZlbnQ6IG9uRXZlbnQsXG4gICAgICAgIHJlc2V0OiByZXNldCxcbiAgICAgICAgZXZlbnRzOiBldmVudHMucmVnaXN0cnlcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBOb0RyYWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZXZlbnRzID0gY3JlYXRlKHsgbW92ZTogRXZlbnQoWydpbmZvJ10pIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb25FdmVudDogbm9vcCxcbiAgICAgICAgcmVzZXQ6IG5vb3AsXG4gICAgICAgIGV2ZW50czogZXZlbnRzLnJlZ2lzdHJ5XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgTW92ZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbm9EcmFnU3RhdGUgPSBOb0RyYWcoKTtcbiAgICAgIHZhciBpbkRyYWdTdGF0ZSA9IEluRHJhZygpO1xuICAgICAgdmFyIGRyYWdTdGF0ZSA9IG5vRHJhZ1N0YXRlO1xuICAgICAgdmFyIG9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBkcmFnU3RhdGUucmVzZXQoKTtcbiAgICAgICAgZHJhZ1N0YXRlID0gaW5EcmFnU3RhdGU7XG4gICAgICB9O1xuICAgICAgdmFyIG9mZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZHJhZ1N0YXRlLnJlc2V0KCk7XG4gICAgICAgIGRyYWdTdGF0ZSA9IG5vRHJhZ1N0YXRlO1xuICAgICAgfTtcbiAgICAgIHZhciBvbkV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50LCBtb2RlKSB7XG4gICAgICAgIGRyYWdTdGF0ZS5vbkV2ZW50KGV2ZW50LCBtb2RlKTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNPbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRyYWdTdGF0ZSA9PT0gaW5EcmFnU3RhdGU7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb246IG9uLFxuICAgICAgICBvZmY6IG9mZixcbiAgICAgICAgaXNPbjogaXNPbixcbiAgICAgICAgb25FdmVudDogb25FdmVudCxcbiAgICAgICAgZXZlbnRzOiBpbkRyYWdTdGF0ZS5ldmVudHNcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBzZXR1cCA9IGZ1bmN0aW9uIChtdXRhdGlvbiwgbW9kZSwgc2V0dGluZ3MpIHtcbiAgICAgIHZhciBhY3RpdmUgPSBmYWxzZTtcbiAgICAgIHZhciBldmVudHMgPSBjcmVhdGUoe1xuICAgICAgICBzdGFydDogRXZlbnQoW10pLFxuICAgICAgICBzdG9wOiBFdmVudChbXSlcbiAgICAgIH0pO1xuICAgICAgdmFyIG1vdmVtZW50ID0gTW92ZW1lbnQoKTtcbiAgICAgIHZhciBkcm9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzaW5rLnN0b3AoKTtcbiAgICAgICAgaWYgKG1vdmVtZW50LmlzT24oKSkge1xuICAgICAgICAgIG1vdmVtZW50Lm9mZigpO1xuICAgICAgICAgIGV2ZW50cy50cmlnZ2VyLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciB0aHJvdHRsZWREcm9wID0gbGFzdCQyKGRyb3AsIDIwMCk7XG4gICAgICB2YXIgZ28gPSBmdW5jdGlvbiAocGFyZW50KSB7XG4gICAgICAgIHNpbmsuc3RhcnQocGFyZW50KTtcbiAgICAgICAgbW92ZW1lbnQub24oKTtcbiAgICAgICAgZXZlbnRzLnRyaWdnZXIuc3RhcnQoKTtcbiAgICAgIH07XG4gICAgICB2YXIgbW91c2Vtb3ZlID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRocm90dGxlZERyb3AuY2FuY2VsKCk7XG4gICAgICAgIG1vdmVtZW50Lm9uRXZlbnQoZXZlbnQsIG1vZGUpO1xuICAgICAgfTtcbiAgICAgIG1vdmVtZW50LmV2ZW50cy5tb3ZlLmJpbmQoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIG1vZGUubXV0YXRlKG11dGF0aW9uLCBldmVudC5pbmZvKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIG9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBhY3RpdmUgPSB0cnVlO1xuICAgICAgfTtcbiAgICAgIHZhciBvZmYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xuICAgICAgfTtcbiAgICAgIHZhciBydW5JZkFjdGl2ZSA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYWN0aXZlKSB7XG4gICAgICAgICAgICBmLmFwcGx5KG51bGwsIGFyZ3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgc2luayA9IG1vZGUuc2luayhEcmFnQXBpKHtcbiAgICAgICAgZm9yY2VEcm9wOiBkcm9wLFxuICAgICAgICBkcm9wOiBydW5JZkFjdGl2ZShkcm9wKSxcbiAgICAgICAgbW92ZTogcnVuSWZBY3RpdmUobW91c2Vtb3ZlKSxcbiAgICAgICAgZGVsYXlEcm9wOiBydW5JZkFjdGl2ZSh0aHJvdHRsZWREcm9wLnRocm90dGxlKVxuICAgICAgfSksIHNldHRpbmdzKTtcbiAgICAgIHZhciBkZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzaW5rLmRlc3Ryb3koKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBzaW5rLmVsZW1lbnQsXG4gICAgICAgIGdvOiBnbyxcbiAgICAgICAgb246IG9uLFxuICAgICAgICBvZmY6IG9mZixcbiAgICAgICAgZGVzdHJveTogZGVzdHJveSxcbiAgICAgICAgZXZlbnRzOiBldmVudHMucmVnaXN0cnlcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBta0V2ZW50ID0gZnVuY3Rpb24gKHRhcmdldCwgeCwgeSwgc3RvcCwgcHJldmVudCwga2lsbCwgcmF3KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICAgICAgc3RvcDogc3RvcCxcbiAgICAgICAgcHJldmVudDogcHJldmVudCxcbiAgICAgICAga2lsbDoga2lsbCxcbiAgICAgICAgcmF3OiByYXdcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZnJvbVJhd0V2ZW50ID0gZnVuY3Rpb24gKHJhd0V2ZW50KSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gU3VnYXJFbGVtZW50LmZyb21Eb20oZ2V0T3JpZ2luYWxFdmVudFRhcmdldChyYXdFdmVudCkuZ2V0T3IocmF3RXZlbnQudGFyZ2V0KSk7XG4gICAgICB2YXIgc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJhd0V2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfTtcbiAgICAgIHZhciBwcmV2ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcmF3RXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH07XG4gICAgICB2YXIga2lsbCA9IGNvbXBvc2UocHJldmVudCwgc3RvcCk7XG4gICAgICByZXR1cm4gbWtFdmVudCh0YXJnZXQsIHJhd0V2ZW50LmNsaWVudFgsIHJhd0V2ZW50LmNsaWVudFksIHN0b3AsIHByZXZlbnQsIGtpbGwsIHJhd0V2ZW50KTtcbiAgICB9O1xuICAgIHZhciBoYW5kbGUgPSBmdW5jdGlvbiAoZmlsdGVyLCBoYW5kbGVyKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHJhd0V2ZW50KSB7XG4gICAgICAgIGlmIChmaWx0ZXIocmF3RXZlbnQpKSB7XG4gICAgICAgICAgaGFuZGxlcihmcm9tUmF3RXZlbnQocmF3RXZlbnQpKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBiaW5kZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGZpbHRlciwgaGFuZGxlciwgdXNlQ2FwdHVyZSkge1xuICAgICAgdmFyIHdyYXBwZWQgPSBoYW5kbGUoZmlsdGVyLCBoYW5kbGVyKTtcbiAgICAgIGVsZW1lbnQuZG9tLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHdyYXBwZWQsIHVzZUNhcHR1cmUpO1xuICAgICAgcmV0dXJuIHsgdW5iaW5kOiBjdXJyeSh1bmJpbmQsIGVsZW1lbnQsIGV2ZW50LCB3cmFwcGVkLCB1c2VDYXB0dXJlKSB9O1xuICAgIH07XG4gICAgdmFyIGJpbmQkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBldmVudCwgZmlsdGVyLCBoYW5kbGVyKSB7XG4gICAgICByZXR1cm4gYmluZGVyKGVsZW1lbnQsIGV2ZW50LCBmaWx0ZXIsIGhhbmRsZXIsIGZhbHNlKTtcbiAgICB9O1xuICAgIHZhciB1bmJpbmQgPSBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIsIHVzZUNhcHR1cmUpIHtcbiAgICAgIGVsZW1lbnQuZG9tLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIHVzZUNhcHR1cmUpO1xuICAgIH07XG5cbiAgICB2YXIgZmlsdGVyJDIgPSBhbHdheXM7XG4gICAgdmFyIGJpbmQkMiA9IGZ1bmN0aW9uIChlbGVtZW50LCBldmVudCwgaGFuZGxlcikge1xuICAgICAgcmV0dXJuIGJpbmQkMShlbGVtZW50LCBldmVudCwgZmlsdGVyJDIsIGhhbmRsZXIpO1xuICAgIH07XG4gICAgdmFyIGZyb21SYXdFdmVudCQxID0gZnJvbVJhd0V2ZW50O1xuXG4gICAgdmFyIHJlYWQgPSBmdW5jdGlvbiAoZWxlbWVudCwgYXR0cikge1xuICAgICAgdmFyIHZhbHVlID0gZ2V0JDIoZWxlbWVudCwgYXR0cik7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gJycgPyBbXSA6IHZhbHVlLnNwbGl0KCcgJyk7XG4gICAgfTtcbiAgICB2YXIgYWRkJDEgPSBmdW5jdGlvbiAoZWxlbWVudCwgYXR0ciwgaWQpIHtcbiAgICAgIHZhciBvbGQgPSByZWFkKGVsZW1lbnQsIGF0dHIpO1xuICAgICAgdmFyIG51ID0gb2xkLmNvbmNhdChbaWRdKTtcbiAgICAgIHNldChlbGVtZW50LCBhdHRyLCBudS5qb2luKCcgJykpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlJDMgPSBmdW5jdGlvbiAoZWxlbWVudCwgYXR0ciwgaWQpIHtcbiAgICAgIHZhciBudSA9IGZpbHRlcihyZWFkKGVsZW1lbnQsIGF0dHIpLCBmdW5jdGlvbiAodikge1xuICAgICAgICByZXR1cm4gdiAhPT0gaWQ7XG4gICAgICB9KTtcbiAgICAgIGlmIChudS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNldChlbGVtZW50LCBhdHRyLCBudS5qb2luKCcgJykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVtb3ZlKGVsZW1lbnQsIGF0dHIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICB2YXIgc3VwcG9ydHMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLmNsYXNzTGlzdCAhPT0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdmFyIGdldCQ4ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiByZWFkKGVsZW1lbnQsICdjbGFzcycpO1xuICAgIH07XG4gICAgdmFyIGFkZCQyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICByZXR1cm4gYWRkJDEoZWxlbWVudCwgJ2NsYXNzJywgY2xhenopO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZSQ0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICByZXR1cm4gcmVtb3ZlJDMoZWxlbWVudCwgJ2NsYXNzJywgY2xhenopO1xuICAgIH07XG5cbiAgICB2YXIgYWRkJDMgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhenopIHtcbiAgICAgIGlmIChzdXBwb3J0cyhlbGVtZW50KSkge1xuICAgICAgICBlbGVtZW50LmRvbS5jbGFzc0xpc3QuYWRkKGNsYXp6KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFkZCQyKGVsZW1lbnQsIGNsYXp6KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBjbGVhbkNsYXNzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHZhciBjbGFzc0xpc3QgPSBzdXBwb3J0cyhlbGVtZW50KSA/IGVsZW1lbnQuZG9tLmNsYXNzTGlzdCA6IGdldCQ4KGVsZW1lbnQpO1xuICAgICAgaWYgKGNsYXNzTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVtb3ZlKGVsZW1lbnQsICdjbGFzcycpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlbW92ZSQ1ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICBpZiAoc3VwcG9ydHMoZWxlbWVudCkpIHtcbiAgICAgICAgdmFyIGNsYXNzTGlzdCA9IGVsZW1lbnQuZG9tLmNsYXNzTGlzdDtcbiAgICAgICAgY2xhc3NMaXN0LnJlbW92ZShjbGF6eik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZW1vdmUkNChlbGVtZW50LCBjbGF6eik7XG4gICAgICB9XG4gICAgICBjbGVhbkNsYXNzKGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGhhcyQxID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXp6KSB7XG4gICAgICByZXR1cm4gc3VwcG9ydHMoZWxlbWVudCkgJiYgZWxlbWVudC5kb20uY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXp6KTtcbiAgICB9O1xuXG4gICAgdmFyIGNzcyA9IGZ1bmN0aW9uIChuYW1lc3BhY2UpIHtcbiAgICAgIHZhciBkYXNoTmFtZXNwYWNlID0gbmFtZXNwYWNlLnJlcGxhY2UoL1xcLi9nLCAnLScpO1xuICAgICAgdmFyIHJlc29sdmUgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgICAgIHJldHVybiBkYXNoTmFtZXNwYWNlICsgJy0nICsgc3RyO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7IHJlc29sdmU6IHJlc29sdmUgfTtcbiAgICB9O1xuXG4gICAgdmFyIHN0eWxlcyA9IGNzcygnZXBob3gtZHJhZ3N0ZXInKTtcbiAgICB2YXIgcmVzb2x2ZSA9IHN0eWxlcy5yZXNvbHZlO1xuXG4gICAgdmFyIEJsb2NrZXIgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgdmFyIHNldHRpbmdzID0gX19hc3NpZ24oeyBsYXllckNsYXNzOiByZXNvbHZlKCdibG9ja2VyJykgfSwgb3B0aW9ucyk7XG4gICAgICB2YXIgZGl2ID0gU3VnYXJFbGVtZW50LmZyb21UYWcoJ2RpdicpO1xuICAgICAgc2V0KGRpdiwgJ3JvbGUnLCAncHJlc2VudGF0aW9uJyk7XG4gICAgICBzZXRBbGwkMShkaXYsIHtcbiAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAgIGxlZnQ6ICcwcHgnLFxuICAgICAgICB0b3A6ICcwcHgnLFxuICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICBoZWlnaHQ6ICcxMDAlJ1xuICAgICAgfSk7XG4gICAgICBhZGQkMyhkaXYsIHJlc29sdmUoJ2Jsb2NrZXInKSk7XG4gICAgICBhZGQkMyhkaXYsIHNldHRpbmdzLmxheWVyQ2xhc3MpO1xuICAgICAgdmFyIGVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkaXY7XG4gICAgICB9O1xuICAgICAgdmFyIGRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlbW92ZSQyKGRpdik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgZGVzdHJveTogZGVzdHJveVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGNvbXBhcmUgPSBmdW5jdGlvbiAob2xkLCBudSkge1xuICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24obnUubGVmdCAtIG9sZC5sZWZ0LCBudS50b3AgLSBvbGQudG9wKTtcbiAgICB9O1xuICAgIHZhciBleHRyYWN0JDEgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKFN1Z2FyUG9zaXRpb24oZXZlbnQueCwgZXZlbnQueSkpO1xuICAgIH07XG4gICAgdmFyIG11dGF0ZSA9IGZ1bmN0aW9uIChtdXRhdGlvbiwgaW5mbykge1xuICAgICAgbXV0YXRpb24ubXV0YXRlKGluZm8ubGVmdCwgaW5mby50b3ApO1xuICAgIH07XG4gICAgdmFyIHNpbmsgPSBmdW5jdGlvbiAoZHJhZ0FwaSwgc2V0dGluZ3MpIHtcbiAgICAgIHZhciBibG9ja2VyID0gQmxvY2tlcihzZXR0aW5ncyk7XG4gICAgICB2YXIgbWRvd24gPSBiaW5kJDIoYmxvY2tlci5lbGVtZW50KCksICdtb3VzZWRvd24nLCBkcmFnQXBpLmZvcmNlRHJvcCk7XG4gICAgICB2YXIgbXVwID0gYmluZCQyKGJsb2NrZXIuZWxlbWVudCgpLCAnbW91c2V1cCcsIGRyYWdBcGkuZHJvcCk7XG4gICAgICB2YXIgbW1vdmUgPSBiaW5kJDIoYmxvY2tlci5lbGVtZW50KCksICdtb3VzZW1vdmUnLCBkcmFnQXBpLm1vdmUpO1xuICAgICAgdmFyIG1vdXQgPSBiaW5kJDIoYmxvY2tlci5lbGVtZW50KCksICdtb3VzZW91dCcsIGRyYWdBcGkuZGVsYXlEcm9wKTtcbiAgICAgIHZhciBkZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBibG9ja2VyLmRlc3Ryb3koKTtcbiAgICAgICAgbXVwLnVuYmluZCgpO1xuICAgICAgICBtbW92ZS51bmJpbmQoKTtcbiAgICAgICAgbW91dC51bmJpbmQoKTtcbiAgICAgICAgbWRvd24udW5iaW5kKCk7XG4gICAgICB9O1xuICAgICAgdmFyIHN0YXJ0ID0gZnVuY3Rpb24gKHBhcmVudCkge1xuICAgICAgICBhcHBlbmQocGFyZW50LCBibG9ja2VyLmVsZW1lbnQoKSk7XG4gICAgICB9O1xuICAgICAgdmFyIHN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlbW92ZSQyKGJsb2NrZXIuZWxlbWVudCgpKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gRHJhZ1Npbmsoe1xuICAgICAgICBlbGVtZW50OiBibG9ja2VyLmVsZW1lbnQsXG4gICAgICAgIHN0YXJ0OiBzdGFydCxcbiAgICAgICAgc3RvcDogc3RvcCxcbiAgICAgICAgZGVzdHJveTogZGVzdHJveVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgTW91c2VEcmFnID0gRHJhZ01vZGUoe1xuICAgICAgY29tcGFyZTogY29tcGFyZSxcbiAgICAgIGV4dHJhY3Q6IGV4dHJhY3QkMSxcbiAgICAgIHNpbms6IHNpbmssXG4gICAgICBtdXRhdGU6IG11dGF0ZVxuICAgIH0pO1xuXG4gICAgdmFyIHRyYW5zZm9ybSA9IGZ1bmN0aW9uIChtdXRhdGlvbiwgc2V0dGluZ3MpIHtcbiAgICAgIGlmIChzZXR0aW5ncyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHNldHRpbmdzID0ge307XG4gICAgICB9XG4gICAgICB2YXIgbW9kZSA9IHNldHRpbmdzLm1vZGUgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLm1vZGUgOiBNb3VzZURyYWc7XG4gICAgICByZXR1cm4gc2V0dXAobXV0YXRpb24sIG1vZGUsIHNldHRpbmdzKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzQ29udGVudEVkaXRhYmxlVHJ1ZSA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBnZXQkMihlbG0sICdjb250ZW50ZWRpdGFibGUnKSA9PT0gJ3RydWUnO1xuICAgIH07XG4gICAgdmFyIGZpbmRDbG9zZXN0Q29udGVudEVkaXRhYmxlID0gZnVuY3Rpb24gKHRhcmdldCwgaXNSb290KSB7XG4gICAgICByZXR1cm4gY2xvc2VzdCQxKHRhcmdldCwgJ1tjb250ZW50ZWRpdGFibGVdJywgaXNSb290KTtcbiAgICB9O1xuXG4gICAgdmFyIHN0eWxlcyQxID0gY3NzKCdlcGhveC1zbm9va2VyJyk7XG4gICAgdmFyIHJlc29sdmUkMSA9IHN0eWxlcyQxLnJlc29sdmU7XG5cbiAgICB2YXIgTXV0YXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZXZlbnRzID0gY3JlYXRlKHtcbiAgICAgICAgZHJhZzogRXZlbnQoW1xuICAgICAgICAgICd4RGVsdGEnLFxuICAgICAgICAgICd5RGVsdGEnXG4gICAgICAgIF0pXG4gICAgICB9KTtcbiAgICAgIHZhciBtdXRhdGUgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICBldmVudHMudHJpZ2dlci5kcmFnKHgsIHkpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG11dGF0ZTogbXV0YXRlLFxuICAgICAgICBldmVudHM6IGV2ZW50cy5yZWdpc3RyeVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIEJhck11dGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGV2ZW50cyA9IGNyZWF0ZSh7XG4gICAgICAgIGRyYWc6IEV2ZW50KFtcbiAgICAgICAgICAneERlbHRhJyxcbiAgICAgICAgICAneURlbHRhJyxcbiAgICAgICAgICAndGFyZ2V0J1xuICAgICAgICBdKVxuICAgICAgfSk7XG4gICAgICB2YXIgdGFyZ2V0ID0gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIGRlbGVnYXRlID0gTXV0YXRpb24oKTtcbiAgICAgIGRlbGVnYXRlLmV2ZW50cy5kcmFnLmJpbmQoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRhcmdldC5lYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgZXZlbnRzLnRyaWdnZXIuZHJhZyhldmVudC54RGVsdGEsIGV2ZW50LnlEZWx0YSwgdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgYXNzaWduID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdGFyZ2V0ID0gT3B0aW9uYWwuc29tZSh0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFzc2lnbjogYXNzaWduLFxuICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgbXV0YXRlOiBkZWxlZ2F0ZS5tdXRhdGUsXG4gICAgICAgIGV2ZW50czogZXZlbnRzLnJlZ2lzdHJ5XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgY29sID0gZnVuY3Rpb24gKGNvbHVtbiwgeCwgeSwgdywgaCkge1xuICAgICAgdmFyIGJhciA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdkaXYnKTtcbiAgICAgIHNldEFsbCQxKGJhciwge1xuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgbGVmdDogeCAtIHcgLyAyICsgJ3B4JyxcbiAgICAgICAgdG9wOiB5ICsgJ3B4JyxcbiAgICAgICAgaGVpZ2h0OiBoICsgJ3B4JyxcbiAgICAgICAgd2lkdGg6IHcgKyAncHgnXG4gICAgICB9KTtcbiAgICAgIHNldEFsbChiYXIsIHtcbiAgICAgICAgJ2RhdGEtY29sdW1uJzogY29sdW1uLFxuICAgICAgICAncm9sZSc6ICdwcmVzZW50YXRpb24nXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBiYXI7XG4gICAgfTtcbiAgICB2YXIgcm93ID0gZnVuY3Rpb24gKHIsIHgsIHksIHcsIGgpIHtcbiAgICAgIHZhciBiYXIgPSBTdWdhckVsZW1lbnQuZnJvbVRhZygnZGl2Jyk7XG4gICAgICBzZXRBbGwkMShiYXIsIHtcbiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgIGxlZnQ6IHggKyAncHgnLFxuICAgICAgICB0b3A6IHkgLSBoIC8gMiArICdweCcsXG4gICAgICAgIGhlaWdodDogaCArICdweCcsXG4gICAgICAgIHdpZHRoOiB3ICsgJ3B4J1xuICAgICAgfSk7XG4gICAgICBzZXRBbGwoYmFyLCB7XG4gICAgICAgICdkYXRhLXJvdyc6IHIsXG4gICAgICAgICdyb2xlJzogJ3ByZXNlbnRhdGlvbidcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGJhcjtcbiAgICB9O1xuXG4gICAgdmFyIHJlc2l6ZUJhciA9IHJlc29sdmUkMSgncmVzaXplci1iYXInKTtcbiAgICB2YXIgcmVzaXplUm93QmFyID0gcmVzb2x2ZSQxKCdyZXNpemVyLXJvd3MnKTtcbiAgICB2YXIgcmVzaXplQ29sQmFyID0gcmVzb2x2ZSQxKCdyZXNpemVyLWNvbHMnKTtcbiAgICB2YXIgQkFSX1RISUNLTkVTUyA9IDc7XG4gICAgdmFyIHJlc2l6YWJsZVJvd3MgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBpc1Jlc2l6YWJsZSkge1xuICAgICAgcmV0dXJuIGJpbmQod2FyZWhvdXNlLmFsbCwgZnVuY3Rpb24gKHJvdywgaSkge1xuICAgICAgICByZXR1cm4gaXNSZXNpemFibGUocm93LmVsZW1lbnQpID8gW2ldIDogW107XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZXNpemFibGVDb2x1bW5zID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgaXNSZXNpemFibGUpIHtcbiAgICAgIHZhciByZXNpemFibGVDb2xzID0gW107XG4gICAgICByYW5nZSh3YXJlaG91c2UuZ3JpZC5jb2x1bW5zLCBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgdmFyIGNvbEVsbU9wdCA9IFdhcmVob3VzZS5nZXRDb2x1bW5BdCh3YXJlaG91c2UsIGluZGV4KS5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgIHJldHVybiBjb2wuZWxlbWVudDtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChjb2xFbG1PcHQuZm9yYWxsKGlzUmVzaXphYmxlKSkge1xuICAgICAgICAgIHJlc2l6YWJsZUNvbHMucHVzaChpbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZpbHRlcihyZXNpemFibGVDb2xzLCBmdW5jdGlvbiAoY29sSW5kZXgpIHtcbiAgICAgICAgdmFyIGNvbHVtbkNlbGxzID0gV2FyZWhvdXNlLmZpbHRlckl0ZW1zKHdhcmVob3VzZSwgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICByZXR1cm4gY2VsbC5jb2x1bW4gPT09IGNvbEluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZvcmFsbChjb2x1bW5DZWxscywgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICByZXR1cm4gaXNSZXNpemFibGUoY2VsbC5lbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkZXN0cm95ID0gZnVuY3Rpb24gKHdpcmUpIHtcbiAgICAgIHZhciBwcmV2aW91cyA9IGRlc2NlbmRhbnRzJDEod2lyZS5wYXJlbnQoKSwgJy4nICsgcmVzaXplQmFyKTtcbiAgICAgIGVhY2gocHJldmlvdXMsIHJlbW92ZSQyKTtcbiAgICB9O1xuICAgIHZhciBkcmF3QmFyID0gZnVuY3Rpb24gKHdpcmUsIHBvc2l0aW9ucywgY3JlYXRlKSB7XG4gICAgICB2YXIgb3JpZ2luID0gd2lyZS5vcmlnaW4oKTtcbiAgICAgIGVhY2gocG9zaXRpb25zLCBmdW5jdGlvbiAoY3BPcHRpb24pIHtcbiAgICAgICAgY3BPcHRpb24uZWFjaChmdW5jdGlvbiAoY3ApIHtcbiAgICAgICAgICB2YXIgYmFyID0gY3JlYXRlKG9yaWdpbiwgY3ApO1xuICAgICAgICAgIGFkZCQzKGJhciwgcmVzaXplQmFyKTtcbiAgICAgICAgICBhcHBlbmQod2lyZS5wYXJlbnQoKSwgYmFyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWZyZXNoQ29sID0gZnVuY3Rpb24gKHdpcmUsIGNvbFBvc2l0aW9ucywgcG9zaXRpb24sIHRhYmxlSGVpZ2h0KSB7XG4gICAgICBkcmF3QmFyKHdpcmUsIGNvbFBvc2l0aW9ucywgZnVuY3Rpb24gKG9yaWdpbiwgY3ApIHtcbiAgICAgICAgdmFyIGNvbEJhciA9IGNvbChjcC5jb2wsIGNwLnggLSBvcmlnaW4ubGVmdCwgcG9zaXRpb24udG9wIC0gb3JpZ2luLnRvcCwgQkFSX1RISUNLTkVTUywgdGFibGVIZWlnaHQpO1xuICAgICAgICBhZGQkMyhjb2xCYXIsIHJlc2l6ZUNvbEJhcik7XG4gICAgICAgIHJldHVybiBjb2xCYXI7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWZyZXNoUm93ID0gZnVuY3Rpb24gKHdpcmUsIHJvd1Bvc2l0aW9ucywgcG9zaXRpb24sIHRhYmxlV2lkdGgpIHtcbiAgICAgIGRyYXdCYXIod2lyZSwgcm93UG9zaXRpb25zLCBmdW5jdGlvbiAob3JpZ2luLCBjcCkge1xuICAgICAgICB2YXIgcm93QmFyID0gcm93KGNwLnJvdywgcG9zaXRpb24ubGVmdCAtIG9yaWdpbi5sZWZ0LCBjcC55IC0gb3JpZ2luLnRvcCwgdGFibGVXaWR0aCwgQkFSX1RISUNLTkVTUyk7XG4gICAgICAgIGFkZCQzKHJvd0JhciwgcmVzaXplUm93QmFyKTtcbiAgICAgICAgcmV0dXJuIHJvd0JhcjtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlZnJlc2hHcmlkID0gZnVuY3Rpb24gKHdhcmhvdXNlLCB3aXJlLCB0YWJsZSwgcm93cywgY29scykge1xuICAgICAgdmFyIHBvc2l0aW9uID0gYWJzb2x1dGUodGFibGUpO1xuICAgICAgdmFyIGlzUmVzaXphYmxlID0gd2lyZS5pc1Jlc2l6YWJsZTtcbiAgICAgIHZhciByb3dQb3NpdGlvbnMgPSByb3dzLmxlbmd0aCA+IDAgPyBoZWlnaHQucG9zaXRpb25zKHJvd3MsIHRhYmxlKSA6IFtdO1xuICAgICAgdmFyIHJlc2l6YWJsZVJvd0JhcnMgPSByb3dQb3NpdGlvbnMubGVuZ3RoID4gMCA/IHJlc2l6YWJsZVJvd3Mod2FyaG91c2UsIGlzUmVzaXphYmxlKSA6IFtdO1xuICAgICAgdmFyIHJlc2l6YWJsZVJvd1Bvc2l0aW9ucyA9IGZpbHRlcihyb3dQb3NpdGlvbnMsIGZ1bmN0aW9uIChfcG9zLCBpKSB7XG4gICAgICAgIHJldHVybiBleGlzdHMocmVzaXphYmxlUm93QmFycywgZnVuY3Rpb24gKGJhckluZGV4KSB7XG4gICAgICAgICAgcmV0dXJuIGkgPT09IGJhckluZGV4O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmVmcmVzaFJvdyh3aXJlLCByZXNpemFibGVSb3dQb3NpdGlvbnMsIHBvc2l0aW9uLCBnZXRPdXRlcih0YWJsZSkpO1xuICAgICAgdmFyIGNvbFBvc2l0aW9ucyA9IGNvbHMubGVuZ3RoID4gMCA/IHdpZHRoLnBvc2l0aW9ucyhjb2xzLCB0YWJsZSkgOiBbXTtcbiAgICAgIHZhciByZXNpemFibGVDb2xCYXJzID0gY29sUG9zaXRpb25zLmxlbmd0aCA+IDAgPyByZXNpemFibGVDb2x1bW5zKHdhcmhvdXNlLCBpc1Jlc2l6YWJsZSkgOiBbXTtcbiAgICAgIHZhciByZXNpemFibGVDb2xQb3NpdGlvbnMgPSBmaWx0ZXIoY29sUG9zaXRpb25zLCBmdW5jdGlvbiAoX3BvcywgaSkge1xuICAgICAgICByZXR1cm4gZXhpc3RzKHJlc2l6YWJsZUNvbEJhcnMsIGZ1bmN0aW9uIChiYXJJbmRleCkge1xuICAgICAgICAgIHJldHVybiBpID09PSBiYXJJbmRleDtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJlZnJlc2hDb2wod2lyZSwgcmVzaXphYmxlQ29sUG9zaXRpb25zLCBwb3NpdGlvbiwgZ2V0T3V0ZXIkMSh0YWJsZSkpO1xuICAgIH07XG4gICAgdmFyIHJlZnJlc2ggPSBmdW5jdGlvbiAod2lyZSwgdGFibGUpIHtcbiAgICAgIGRlc3Ryb3kod2lyZSk7XG4gICAgICBpZiAod2lyZS5pc1Jlc2l6YWJsZSh0YWJsZSkpIHtcbiAgICAgICAgdmFyIHdhcmVob3VzZSA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgICB2YXIgcm93cyA9IHJvd3MkMSh3YXJlaG91c2UpO1xuICAgICAgICB2YXIgY29scyA9IGNvbHVtbnMkMSh3YXJlaG91c2UpO1xuICAgICAgICByZWZyZXNoR3JpZCh3YXJlaG91c2UsIHdpcmUsIHRhYmxlLCByb3dzLCBjb2xzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBlYWNoJDIgPSBmdW5jdGlvbiAod2lyZSwgZikge1xuICAgICAgdmFyIGJhcnMgPSBkZXNjZW5kYW50cyQxKHdpcmUucGFyZW50KCksICcuJyArIHJlc2l6ZUJhcik7XG4gICAgICBlYWNoKGJhcnMsIGYpO1xuICAgIH07XG4gICAgdmFyIGhpZGUgPSBmdW5jdGlvbiAod2lyZSkge1xuICAgICAgZWFjaCQyKHdpcmUsIGZ1bmN0aW9uIChiYXIpIHtcbiAgICAgICAgc2V0JDEoYmFyLCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzaG93ID0gZnVuY3Rpb24gKHdpcmUpIHtcbiAgICAgIGVhY2gkMih3aXJlLCBmdW5jdGlvbiAoYmFyKSB7XG4gICAgICAgIHNldCQxKGJhciwgJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzUm93QmFyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBoYXMkMShlbGVtZW50LCByZXNpemVSb3dCYXIpO1xuICAgIH07XG4gICAgdmFyIGlzQ29sQmFyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBoYXMkMShlbGVtZW50LCByZXNpemVDb2xCYXIpO1xuICAgIH07XG5cbiAgICB2YXIgcmVzaXplQmFyRHJhZ2dpbmcgPSByZXNvbHZlJDEoJ3Jlc2l6ZXItYmFyLWRyYWdnaW5nJyk7XG4gICAgdmFyIEJhck1hbmFnZXIgPSBmdW5jdGlvbiAod2lyZSkge1xuICAgICAgdmFyIG11dGF0aW9uID0gQmFyTXV0YXRpb24oKTtcbiAgICAgIHZhciByZXNpemluZyA9IHRyYW5zZm9ybShtdXRhdGlvbiwge30pO1xuICAgICAgdmFyIGhvdmVyVGFibGUgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICB2YXIgZ2V0UmVzaXplciA9IGZ1bmN0aW9uIChlbGVtZW50LCB0eXBlKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGdldCQyKGVsZW1lbnQsIHR5cGUpKTtcbiAgICAgIH07XG4gICAgICBtdXRhdGlvbi5ldmVudHMuZHJhZy5iaW5kKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBnZXRSZXNpemVyKGV2ZW50LnRhcmdldCwgJ2RhdGEtcm93JykuZWFjaChmdW5jdGlvbiAoX2RhdGFSb3cpIHtcbiAgICAgICAgICB2YXIgY3VycmVudFJvdyA9IGdldENzc1ZhbHVlKGV2ZW50LnRhcmdldCwgJ3RvcCcpO1xuICAgICAgICAgIHNldCQxKGV2ZW50LnRhcmdldCwgJ3RvcCcsIGN1cnJlbnRSb3cgKyBldmVudC55RGVsdGEgKyAncHgnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGdldFJlc2l6ZXIoZXZlbnQudGFyZ2V0LCAnZGF0YS1jb2x1bW4nKS5lYWNoKGZ1bmN0aW9uIChfZGF0YUNvbCkge1xuICAgICAgICAgIHZhciBjdXJyZW50Q29sID0gZ2V0Q3NzVmFsdWUoZXZlbnQudGFyZ2V0LCAnbGVmdCcpO1xuICAgICAgICAgIHNldCQxKGV2ZW50LnRhcmdldCwgJ2xlZnQnLCBjdXJyZW50Q29sICsgZXZlbnQueERlbHRhICsgJ3B4Jyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2YXIgZ2V0RGVsdGEgPSBmdW5jdGlvbiAodGFyZ2V0LCBkaXIpIHtcbiAgICAgICAgdmFyIG5ld1ggPSBnZXRDc3NWYWx1ZSh0YXJnZXQsIGRpcik7XG4gICAgICAgIHZhciBvbGRYID0gZ2V0QXR0clZhbHVlKHRhcmdldCwgJ2RhdGEtaW5pdGlhbC0nICsgZGlyLCAwKTtcbiAgICAgICAgcmV0dXJuIG5ld1ggLSBvbGRYO1xuICAgICAgfTtcbiAgICAgIHJlc2l6aW5nLmV2ZW50cy5zdG9wLmJpbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICBtdXRhdGlvbi5nZXQoKS5lYWNoKGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICBob3ZlclRhYmxlLmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgICBnZXRSZXNpemVyKHRhcmdldCwgJ2RhdGEtcm93JykuZWFjaChmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgIHZhciBkZWx0YSA9IGdldERlbHRhKHRhcmdldCwgJ3RvcCcpO1xuICAgICAgICAgICAgICByZW1vdmUodGFyZ2V0LCAnZGF0YS1pbml0aWFsLXRvcCcpO1xuICAgICAgICAgICAgICBldmVudHMudHJpZ2dlci5hZGp1c3RIZWlnaHQodGFibGUsIGRlbHRhLCBwYXJzZUludChyb3csIDEwKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGdldFJlc2l6ZXIodGFyZ2V0LCAnZGF0YS1jb2x1bW4nKS5lYWNoKGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgICAgICAgdmFyIGRlbHRhID0gZ2V0RGVsdGEodGFyZ2V0LCAnbGVmdCcpO1xuICAgICAgICAgICAgICByZW1vdmUodGFyZ2V0LCAnZGF0YS1pbml0aWFsLWxlZnQnKTtcbiAgICAgICAgICAgICAgZXZlbnRzLnRyaWdnZXIuYWRqdXN0V2lkdGgodGFibGUsIGRlbHRhLCBwYXJzZUludChjb2x1bW4sIDEwKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlZnJlc2god2lyZSwgdGFibGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAodGFyZ2V0LCBkaXIpIHtcbiAgICAgICAgZXZlbnRzLnRyaWdnZXIuc3RhcnRBZGp1c3QoKTtcbiAgICAgICAgbXV0YXRpb24uYXNzaWduKHRhcmdldCk7XG4gICAgICAgIHNldCh0YXJnZXQsICdkYXRhLWluaXRpYWwtJyArIGRpciwgZ2V0Q3NzVmFsdWUodGFyZ2V0LCBkaXIpKTtcbiAgICAgICAgYWRkJDModGFyZ2V0LCByZXNpemVCYXJEcmFnZ2luZyk7XG4gICAgICAgIHNldCQxKHRhcmdldCwgJ29wYWNpdHknLCAnMC4yJyk7XG4gICAgICAgIHJlc2l6aW5nLmdvKHdpcmUucGFyZW50KCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBtb3VzZWRvd24gPSBiaW5kJDIod2lyZS5wYXJlbnQoKSwgJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAoaXNSb3dCYXIoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIGhhbmRsZXIoZXZlbnQudGFyZ2V0LCAndG9wJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQ29sQmFyKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICBoYW5kbGVyKGV2ZW50LnRhcmdldCwgJ2xlZnQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgaXNSb290ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGVxJDEoZSwgd2lyZS52aWV3KCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBmaW5kQ2xvc2VzdEVkaXRhYmxlVGFibGUgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDEodGFyZ2V0LCAndGFibGUnLCBpc1Jvb3QpLmZpbHRlcihmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICByZXR1cm4gZmluZENsb3Nlc3RDb250ZW50RWRpdGFibGUodGFibGUsIGlzUm9vdCkuZXhpc3RzKGlzQ29udGVudEVkaXRhYmxlVHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBtb3VzZW92ZXIgPSBiaW5kJDIod2lyZS52aWV3KCksICdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZmluZENsb3Nlc3RFZGl0YWJsZVRhYmxlKGV2ZW50LnRhcmdldCkuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKGluQm9keShldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgICBkZXN0cm95KHdpcmUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgaG92ZXJUYWJsZSA9IE9wdGlvbmFsLnNvbWUodGFibGUpO1xuICAgICAgICAgIHJlZnJlc2god2lyZSwgdGFibGUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGRlc3Ryb3kkMSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbW91c2Vkb3duLnVuYmluZCgpO1xuICAgICAgICBtb3VzZW92ZXIudW5iaW5kKCk7XG4gICAgICAgIHJlc2l6aW5nLmRlc3Ryb3koKTtcbiAgICAgICAgZGVzdHJveSh3aXJlKTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVmcmVzaCQxID0gZnVuY3Rpb24gKHRibCkge1xuICAgICAgICByZWZyZXNoKHdpcmUsIHRibCk7XG4gICAgICB9O1xuICAgICAgdmFyIGV2ZW50cyA9IGNyZWF0ZSh7XG4gICAgICAgIGFkanVzdEhlaWdodDogRXZlbnQoW1xuICAgICAgICAgICd0YWJsZScsXG4gICAgICAgICAgJ2RlbHRhJyxcbiAgICAgICAgICAncm93J1xuICAgICAgICBdKSxcbiAgICAgICAgYWRqdXN0V2lkdGg6IEV2ZW50KFtcbiAgICAgICAgICAndGFibGUnLFxuICAgICAgICAgICdkZWx0YScsXG4gICAgICAgICAgJ2NvbHVtbidcbiAgICAgICAgXSksXG4gICAgICAgIHN0YXJ0QWRqdXN0OiBFdmVudChbXSlcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGVzdHJveTogZGVzdHJveSQxLFxuICAgICAgICByZWZyZXNoOiByZWZyZXNoJDEsXG4gICAgICAgIG9uOiByZXNpemluZy5vbixcbiAgICAgICAgb2ZmOiByZXNpemluZy5vZmYsXG4gICAgICAgIGhpZGVCYXJzOiBjdXJyeShoaWRlLCB3aXJlKSxcbiAgICAgICAgc2hvd0JhcnM6IGN1cnJ5KHNob3csIHdpcmUpLFxuICAgICAgICBldmVudHM6IGV2ZW50cy5yZWdpc3RyeVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZSQxID0gZnVuY3Rpb24gKHdpcmUsIHJlc2l6aW5nLCBsYXp5U2l6aW5nKSB7XG4gICAgICB2YXIgaGRpcmVjdGlvbiA9IGhlaWdodDtcbiAgICAgIHZhciB2ZGlyZWN0aW9uID0gd2lkdGg7XG4gICAgICB2YXIgbWFuYWdlciA9IEJhck1hbmFnZXIod2lyZSk7XG4gICAgICB2YXIgZXZlbnRzID0gY3JlYXRlKHtcbiAgICAgICAgYmVmb3JlUmVzaXplOiBFdmVudChbXG4gICAgICAgICAgJ3RhYmxlJyxcbiAgICAgICAgICAndHlwZSdcbiAgICAgICAgXSksXG4gICAgICAgIGFmdGVyUmVzaXplOiBFdmVudChbXG4gICAgICAgICAgJ3RhYmxlJyxcbiAgICAgICAgICAndHlwZSdcbiAgICAgICAgXSksXG4gICAgICAgIHN0YXJ0RHJhZzogRXZlbnQoW10pXG4gICAgICB9KTtcbiAgICAgIG1hbmFnZXIuZXZlbnRzLmFkanVzdEhlaWdodC5iaW5kKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgdGFibGUgPSBldmVudC50YWJsZTtcbiAgICAgICAgZXZlbnRzLnRyaWdnZXIuYmVmb3JlUmVzaXplKHRhYmxlLCAncm93Jyk7XG4gICAgICAgIHZhciBkZWx0YSA9IGhkaXJlY3Rpb24uZGVsdGEoZXZlbnQuZGVsdGEsIHRhYmxlKTtcbiAgICAgICAgYWRqdXN0SGVpZ2h0KHRhYmxlLCBkZWx0YSwgZXZlbnQucm93LCBoZGlyZWN0aW9uKTtcbiAgICAgICAgZXZlbnRzLnRyaWdnZXIuYWZ0ZXJSZXNpemUodGFibGUsICdyb3cnKTtcbiAgICAgIH0pO1xuICAgICAgbWFuYWdlci5ldmVudHMuc3RhcnRBZGp1c3QuYmluZChmdW5jdGlvbiAoX2V2ZW50KSB7XG4gICAgICAgIGV2ZW50cy50cmlnZ2VyLnN0YXJ0RHJhZygpO1xuICAgICAgfSk7XG4gICAgICBtYW5hZ2VyLmV2ZW50cy5hZGp1c3RXaWR0aC5iaW5kKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgdGFibGUgPSBldmVudC50YWJsZTtcbiAgICAgICAgZXZlbnRzLnRyaWdnZXIuYmVmb3JlUmVzaXplKHRhYmxlLCAnY29sJyk7XG4gICAgICAgIHZhciBkZWx0YSA9IHZkaXJlY3Rpb24uZGVsdGEoZXZlbnQuZGVsdGEsIHRhYmxlKTtcbiAgICAgICAgdmFyIHRhYmxlU2l6ZSA9IGxhenlTaXppbmcodGFibGUpO1xuICAgICAgICBhZGp1c3RXaWR0aCh0YWJsZSwgZGVsdGEsIGV2ZW50LmNvbHVtbiwgcmVzaXppbmcsIHRhYmxlU2l6ZSk7XG4gICAgICAgIGV2ZW50cy50cmlnZ2VyLmFmdGVyUmVzaXplKHRhYmxlLCAnY29sJyk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG9uOiBtYW5hZ2VyLm9uLFxuICAgICAgICBvZmY6IG1hbmFnZXIub2ZmLFxuICAgICAgICBoaWRlQmFyczogbWFuYWdlci5oaWRlQmFycyxcbiAgICAgICAgc2hvd0JhcnM6IG1hbmFnZXIuc2hvd0JhcnMsXG4gICAgICAgIGRlc3Ryb3k6IG1hbmFnZXIuZGVzdHJveSxcbiAgICAgICAgZXZlbnRzOiBldmVudHMucmVnaXN0cnlcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgVGFibGVSZXNpemUgPSB7IGNyZWF0ZTogY3JlYXRlJDEgfTtcblxuICAgIHZhciBmaXJlTmV3Um93ID0gZnVuY3Rpb24gKGVkaXRvciwgcm93KSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmZpcmUoJ25ld3JvdycsIHsgbm9kZTogcm93IH0pO1xuICAgIH07XG4gICAgdmFyIGZpcmVOZXdDZWxsID0gZnVuY3Rpb24gKGVkaXRvciwgY2VsbCkge1xuICAgICAgcmV0dXJuIGVkaXRvci5maXJlKCduZXdjZWxsJywgeyBub2RlOiBjZWxsIH0pO1xuICAgIH07XG4gICAgdmFyIGZpcmVPYmplY3RSZXNpemVTdGFydCA9IGZ1bmN0aW9uIChlZGl0b3IsIHRhcmdldCwgd2lkdGgsIGhlaWdodCwgb3JpZ2luKSB7XG4gICAgICBlZGl0b3IuZmlyZSgnT2JqZWN0UmVzaXplU3RhcnQnLCB7XG4gICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICBvcmlnaW46IG9yaWdpblxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmlyZU9iamVjdFJlc2l6ZWQgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YXJnZXQsIHdpZHRoLCBoZWlnaHQsIG9yaWdpbikge1xuICAgICAgZWRpdG9yLmZpcmUoJ09iamVjdFJlc2l6ZWQnLCB7XG4gICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICBvcmlnaW46IG9yaWdpblxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmlyZVRhYmxlU2VsZWN0aW9uQ2hhbmdlID0gZnVuY3Rpb24gKGVkaXRvciwgY2VsbHMsIHN0YXJ0LCBmaW5pc2gsIG90aGVyQ2VsbHMpIHtcbiAgICAgIGVkaXRvci5maXJlKCdUYWJsZVNlbGVjdGlvbkNoYW5nZScsIHtcbiAgICAgICAgY2VsbHM6IGNlbGxzLFxuICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgIGZpbmlzaDogZmluaXNoLFxuICAgICAgICBvdGhlckNlbGxzOiBvdGhlckNlbGxzXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBmaXJlVGFibGVTZWxlY3Rpb25DbGVhciA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGVkaXRvci5maXJlKCdUYWJsZVNlbGVjdGlvbkNsZWFyJyk7XG4gICAgfTtcbiAgICB2YXIgZmlyZVRhYmxlTW9kaWZpZWQgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YWJsZSwgZGF0YSkge1xuICAgICAgZWRpdG9yLmZpcmUoJ1RhYmxlTW9kaWZpZWQnLCBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZGF0YSksIHsgdGFibGU6IHRhYmxlIH0pKTtcbiAgICB9O1xuICAgIHZhciBzdHlsZU1vZGlmaWVkID0ge1xuICAgICAgc3RydWN0dXJlOiBmYWxzZSxcbiAgICAgIHN0eWxlOiB0cnVlXG4gICAgfTtcbiAgICB2YXIgc3RydWN0dXJlTW9kaWZpZWQgPSB7XG4gICAgICBzdHJ1Y3R1cmU6IHRydWUsXG4gICAgICBzdHlsZTogZmFsc2VcbiAgICB9O1xuXG4gICAgdmFyIGRlZmF1bHRUYWJsZVRvb2xiYXIgPSAndGFibGVwcm9wcyB0YWJsZWRlbGV0ZSB8IHRhYmxlaW5zZXJ0cm93YmVmb3JlIHRhYmxlaW5zZXJ0cm93YWZ0ZXIgdGFibGVkZWxldGVyb3cgfCB0YWJsZWluc2VydGNvbGJlZm9yZSB0YWJsZWluc2VydGNvbGFmdGVyIHRhYmxlZGVsZXRlY29sJztcbiAgICB2YXIgZGVmYXVsdFN0eWxlcyA9IHtcbiAgICAgICdib3JkZXItY29sbGFwc2UnOiAnY29sbGFwc2UnLFxuICAgICAgJ3dpZHRoJzogJzEwMCUnXG4gICAgfTtcbiAgICB2YXIgZGV0ZXJtaW5lRGVmYXVsdFN0eWxlcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIGlmIChpc1BpeGVsc0ZvcmNlZChlZGl0b3IpKSB7XG4gICAgICAgIHZhciBlZGl0b3JXaWR0aCA9IGVkaXRvci5nZXRCb2R5KCkub2Zmc2V0V2lkdGg7XG4gICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZGVmYXVsdFN0eWxlcyksIHsgd2lkdGg6IGVkaXRvcldpZHRoICsgJ3B4JyB9KTtcbiAgICAgIH0gZWxzZSBpZiAoaXNSZXNwb25zaXZlRm9yY2VkKGVkaXRvcikpIHtcbiAgICAgICAgcmV0dXJuIGZpbHRlciQxKGRlZmF1bHRTdHlsZXMsIGZ1bmN0aW9uIChfdmFsdWUsIGtleSkge1xuICAgICAgICAgIHJldHVybiBrZXkgIT09ICd3aWR0aCc7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRTdHlsZXM7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZGVmYXVsdEF0dHJpYnV0ZXMgPSB7IGJvcmRlcjogJzEnIH07XG4gICAgdmFyIGRlZmF1bHRDb2x1bW5SZXNpemluZ0JlaGF2aW91ciA9ICdwcmVzZXJ2ZXRhYmxlJztcbiAgICB2YXIgZ2V0VGFibGVTaXppbmdNb2RlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndGFibGVfc2l6aW5nX21vZGUnLCAnYXV0bycpO1xuICAgIH07XG4gICAgdmFyIGdldFRhYmxlUmVzcG9uc2VXaWR0aCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3RhYmxlX3Jlc3BvbnNpdmVfd2lkdGgnKTtcbiAgICB9O1xuICAgIHZhciBnZXREZWZhdWx0QXR0cmlidXRlcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3RhYmxlX2RlZmF1bHRfYXR0cmlidXRlcycsIGRlZmF1bHRBdHRyaWJ1dGVzLCAnb2JqZWN0Jyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RGVmYXVsdFN0eWxlcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3RhYmxlX2RlZmF1bHRfc3R5bGVzJywgZGV0ZXJtaW5lRGVmYXVsdFN0eWxlcyhlZGl0b3IpLCAnb2JqZWN0Jyk7XG4gICAgfTtcbiAgICB2YXIgaGFzVGFibGVSZXNpemVCYXJzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndGFibGVfcmVzaXplX2JhcnMnLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGhhc1RhYk5hdmlnYXRpb24gPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV90YWJfbmF2aWdhdGlvbicsIHRydWUsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgaGFzQWR2YW5jZWRDZWxsVGFiID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndGFibGVfY2VsbF9hZHZ0YWInLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGhhc0FkdmFuY2VkUm93VGFiID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndGFibGVfcm93X2FkdnRhYicsIHRydWUsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgaGFzQWR2YW5jZWRUYWJsZVRhYiA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3RhYmxlX2FkdnRhYicsIHRydWUsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgaGFzQXBwZWFyYW5jZU9wdGlvbnMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV9hcHBlYXJhbmNlX29wdGlvbnMnLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGhhc1RhYmxlR3JpZCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3RhYmxlX2dyaWQnLCB0cnVlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIHNob3VsZFN0eWxlV2l0aENzcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBlZGl0b3IuZ2V0UGFyYW0oJ3RhYmxlX3N0eWxlX2J5X2NzcycsIGZhbHNlLCAnYm9vbGVhbicpO1xuICAgIH07XG4gICAgdmFyIGdldENlbGxDbGFzc0xpc3QgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV9jZWxsX2NsYXNzX2xpc3QnLCBbXSwgJ2FycmF5Jyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Um93Q2xhc3NMaXN0ID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGVkaXRvci5nZXRQYXJhbSgndGFibGVfcm93X2NsYXNzX2xpc3QnLCBbXSwgJ2FycmF5Jyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VGFibGVDbGFzc0xpc3QgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV9jbGFzc19saXN0JywgW10sICdhcnJheScpO1xuICAgIH07XG4gICAgdmFyIGlzUGVyY2VudGFnZXNGb3JjZWQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2V0VGFibGVTaXppbmdNb2RlKGVkaXRvcikgPT09ICdyZWxhdGl2ZScgfHwgZ2V0VGFibGVSZXNwb25zZVdpZHRoKGVkaXRvcikgPT09IHRydWU7XG4gICAgfTtcbiAgICB2YXIgaXNQaXhlbHNGb3JjZWQgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2V0VGFibGVTaXppbmdNb2RlKGVkaXRvcikgPT09ICdmaXhlZCcgfHwgZ2V0VGFibGVSZXNwb25zZVdpZHRoKGVkaXRvcikgPT09IGZhbHNlO1xuICAgIH07XG4gICAgdmFyIGlzUmVzcG9uc2l2ZUZvcmNlZCA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnZXRUYWJsZVNpemluZ01vZGUoZWRpdG9yKSA9PT0gJ3Jlc3BvbnNpdmUnO1xuICAgIH07XG4gICAgdmFyIGdldFRvb2xiYXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV90b29sYmFyJywgZGVmYXVsdFRhYmxlVG9vbGJhcik7XG4gICAgfTtcbiAgICB2YXIgdXNlQ29sdW1uR3JvdXAgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV91c2VfY29sZ3JvdXBzJywgZmFsc2UsICdib29sZWFuJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0VGFibGVIZWFkZXJUeXBlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGRlZmF1bHRWYWx1ZSA9ICdzZWN0aW9uJztcbiAgICAgIHZhciB2YWx1ZSA9IGVkaXRvci5nZXRQYXJhbSgndGFibGVfaGVhZGVyX3R5cGUnLCBkZWZhdWx0VmFsdWUsICdzdHJpbmcnKTtcbiAgICAgIHZhciB2YWxpZFZhbHVlcyA9IFtcbiAgICAgICAgJ3NlY3Rpb24nLFxuICAgICAgICAnY2VsbHMnLFxuICAgICAgICAnc2VjdGlvbkNlbGxzJyxcbiAgICAgICAgJ2F1dG8nXG4gICAgICBdO1xuICAgICAgaWYgKCFjb250YWlucyh2YWxpZFZhbHVlcywgdmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2V0Q29sdW1uUmVzaXppbmdCZWhhdmlvdXIgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgdmFsaWRNb2RlcyA9IFtcbiAgICAgICAgJ3ByZXNlcnZldGFibGUnLFxuICAgICAgICAncmVzaXpldGFibGUnXG4gICAgICBdO1xuICAgICAgdmFyIGdpdmVuTW9kZSA9IGVkaXRvci5nZXRQYXJhbSgndGFibGVfY29sdW1uX3Jlc2l6aW5nJywgZGVmYXVsdENvbHVtblJlc2l6aW5nQmVoYXZpb3VyLCAnc3RyaW5nJyk7XG4gICAgICByZXR1cm4gZmluZCh2YWxpZE1vZGVzLCBmdW5jdGlvbiAobW9kZSkge1xuICAgICAgICByZXR1cm4gbW9kZSA9PT0gZ2l2ZW5Nb2RlO1xuICAgICAgfSkuZ2V0T3IoZGVmYXVsdENvbHVtblJlc2l6aW5nQmVoYXZpb3VyKTtcbiAgICB9O1xuICAgIHZhciBpc1ByZXNlcnZlVGFibGVDb2x1bW5SZXNpemluZyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnZXRDb2x1bW5SZXNpemluZ0JlaGF2aW91cihlZGl0b3IpID09PSAncHJlc2VydmV0YWJsZSc7XG4gICAgfTtcbiAgICB2YXIgaXNSZXNpemVUYWJsZUNvbHVtblJlc2l6aW5nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGdldENvbHVtblJlc2l6aW5nQmVoYXZpb3VyKGVkaXRvcikgPT09ICdyZXNpemV0YWJsZSc7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2xvbmVFbGVtZW50cyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciBjbG9uZUVsZW1lbnRzID0gZWRpdG9yLmdldFBhcmFtKCd0YWJsZV9jbG9uZV9lbGVtZW50cycpO1xuICAgICAgaWYgKGlzU3RyaW5nKGNsb25lRWxlbWVudHMpKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGNsb25lRWxlbWVudHMuc3BsaXQoL1sgLF0vKSk7XG4gICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY2xvbmVFbGVtZW50cykpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoY2xvbmVFbGVtZW50cyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGhhc09iamVjdFJlc2l6aW5nID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIG9iamVjdFJlc2l6aW5nID0gZWRpdG9yLmdldFBhcmFtKCdvYmplY3RfcmVzaXppbmcnLCB0cnVlKTtcbiAgICAgIHJldHVybiBpc1N0cmluZyhvYmplY3RSZXNpemluZykgPyBvYmplY3RSZXNpemluZyA9PT0gJ3RhYmxlJyA6IG9iamVjdFJlc2l6aW5nO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0JDkgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YWJsZSkge1xuICAgICAgaWYgKGlzUGVyY2VudGFnZXNGb3JjZWQoZWRpdG9yKSkge1xuICAgICAgICB2YXIgd2lkdGggPSBnZXRSYXdXaWR0aCQxKGVkaXRvciwgdGFibGUuZG9tKS5maWx0ZXIoaXNQZXJjZW50YWdlKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0UGVyY2VudFRhYmxlV2lkdGgkMSh0YWJsZSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gVGFibGVTaXplLnBlcmNlbnRhZ2VTaXplKHdpZHRoLCB0YWJsZSk7XG4gICAgICB9IGVsc2UgaWYgKGlzUGl4ZWxzRm9yY2VkKGVkaXRvcikpIHtcbiAgICAgICAgcmV0dXJuIFRhYmxlU2l6ZS5waXhlbFNpemUoZ2V0JDUodGFibGUpLCB0YWJsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gVGFibGVTaXplLmdldFRhYmxlU2l6ZSh0YWJsZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBjbGVhbnVwTGVnYWN5QXR0cmlidXRlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZW1vdmUoZWxlbWVudCwgJ3dpZHRoJyk7XG4gICAgfTtcbiAgICB2YXIgY29udmVydFRvUGVyY2VudFNpemUgPSBmdW5jdGlvbiAodGFibGUsIHRhYmxlU2l6ZSkge1xuICAgICAgdmFyIG5ld1dpZHRoID0gZ2V0UGVyY2VudFRhYmxlV2lkdGgodGFibGUpO1xuICAgICAgcmVkaXN0cmlidXRlJDEodGFibGUsIE9wdGlvbmFsLnNvbWUobmV3V2lkdGgpLCBPcHRpb25hbC5ub25lKCksIHRhYmxlU2l6ZSk7XG4gICAgICBjbGVhbnVwTGVnYWN5QXR0cmlidXRlcyh0YWJsZSk7XG4gICAgfTtcbiAgICB2YXIgY29udmVydFRvUGl4ZWxTaXplID0gZnVuY3Rpb24gKHRhYmxlLCB0YWJsZVNpemUpIHtcbiAgICAgIHZhciBuZXdXaWR0aCA9IGdldFBpeGVsVGFibGVXaWR0aCh0YWJsZSk7XG4gICAgICByZWRpc3RyaWJ1dGUkMSh0YWJsZSwgT3B0aW9uYWwuc29tZShuZXdXaWR0aCksIE9wdGlvbmFsLm5vbmUoKSwgdGFibGVTaXplKTtcbiAgICAgIGNsZWFudXBMZWdhY3lBdHRyaWJ1dGVzKHRhYmxlKTtcbiAgICB9O1xuICAgIHZhciBjb252ZXJ0VG9Ob25lU2l6ZSA9IGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgcmVtb3ZlJDEodGFibGUsICd3aWR0aCcpO1xuICAgICAgdmFyIGNvbHVtbnMkMSA9IGNvbHVtbnModGFibGUpO1xuICAgICAgdmFyIHJvd0VsZW1lbnRzID0gY29sdW1ucyQxLmxlbmd0aCA+IDAgPyBjb2x1bW5zJDEgOiBjZWxscyh0YWJsZSk7XG4gICAgICBlYWNoKHJvd0VsZW1lbnRzLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICByZW1vdmUkMShjZWxsLCAnd2lkdGgnKTtcbiAgICAgICAgY2xlYW51cExlZ2FjeUF0dHJpYnV0ZXMoY2VsbCk7XG4gICAgICB9KTtcbiAgICAgIGNsZWFudXBMZWdhY3lBdHRyaWJ1dGVzKHRhYmxlKTtcbiAgICB9O1xuXG4gICAgdmFyIGVuZm9yY2VQZXJjZW50YWdlID0gZnVuY3Rpb24gKGVkaXRvciwgdGFibGUpIHtcbiAgICAgIHZhciB0YWJsZVNpemluZyA9IGdldCQ5KGVkaXRvciwgdGFibGUpO1xuICAgICAgY29udmVydFRvUGVyY2VudFNpemUodGFibGUsIHRhYmxlU2l6aW5nKTtcbiAgICB9O1xuICAgIHZhciBlbmZvcmNlUGl4ZWxzID0gZnVuY3Rpb24gKGVkaXRvciwgdGFibGUpIHtcbiAgICAgIHZhciB0YWJsZVNpemluZyA9IGdldCQ5KGVkaXRvciwgdGFibGUpO1xuICAgICAgY29udmVydFRvUGl4ZWxTaXplKHRhYmxlLCB0YWJsZVNpemluZyk7XG4gICAgfTtcbiAgICB2YXIgZW5mb3JjZU5vbmUgPSBjb252ZXJ0VG9Ob25lU2l6ZTtcbiAgICB2YXIgc3luY1BpeGVscyA9IGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgdmFyIHdhcmVob3VzZSA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgaWYgKCFXYXJlaG91c2UuaGFzQ29sdW1ucyh3YXJlaG91c2UpKSB7XG4gICAgICAgIGVhY2goY2VsbHModGFibGUpLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIHZhciBjb21wdXRlZFdpZHRoID0gZ2V0JDMoY2VsbCwgJ3dpZHRoJyk7XG4gICAgICAgICAgc2V0JDEoY2VsbCwgJ3dpZHRoJywgY29tcHV0ZWRXaWR0aCk7XG4gICAgICAgICAgcmVtb3ZlKGNlbGwsICd3aWR0aCcpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZUNvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjb250YWluZXIgPSBTdWdhckVsZW1lbnQuZnJvbVRhZygnZGl2Jyk7XG4gICAgICBzZXRBbGwkMShjb250YWluZXIsIHtcbiAgICAgICAgcG9zaXRpb246ICdzdGF0aWMnLFxuICAgICAgICBoZWlnaHQ6ICcwJyxcbiAgICAgICAgd2lkdGg6ICcwJyxcbiAgICAgICAgcGFkZGluZzogJzAnLFxuICAgICAgICBtYXJnaW46ICcwJyxcbiAgICAgICAgYm9yZGVyOiAnMCdcbiAgICAgIH0pO1xuICAgICAgYXBwZW5kKGJvZHkoKSwgY29udGFpbmVyKTtcbiAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfTtcbiAgICB2YXIgZ2V0JGEgPSBmdW5jdGlvbiAoZWRpdG9yLCBpc1Jlc2l6YWJsZSkge1xuICAgICAgcmV0dXJuIGVkaXRvci5pbmxpbmUgPyBSZXNpemVXaXJlLmJvZHkoZ2V0Qm9keSQxKGVkaXRvciksIGNyZWF0ZUNvbnRhaW5lcigpLCBpc1Jlc2l6YWJsZSkgOiBSZXNpemVXaXJlLm9ubHkoU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldERvYygpKSwgaXNSZXNpemFibGUpO1xuICAgIH07XG4gICAgdmFyIHJlbW92ZSQ2ID0gZnVuY3Rpb24gKGVkaXRvciwgd2lyZSkge1xuICAgICAgaWYgKGVkaXRvci5pbmxpbmUpIHtcbiAgICAgICAgcmVtb3ZlJDIod2lyZS5wYXJlbnQoKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBiYXJSZXNpemVyUHJlZml4ID0gJ2Jhci0nO1xuICAgIHZhciBpc1Jlc2l6YWJsZSA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBnZXQkMihlbG0sICdkYXRhLW1jZS1yZXNpemUnKSAhPT0gJ2ZhbHNlJztcbiAgICB9O1xuICAgIHZhciBnZXRSZXNpemVIYW5kbGVyID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHNlbGVjdGlvblJuZyA9IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIHZhciByZXNpemUgPSBPcHRpb25hbC5ub25lKCk7XG4gICAgICB2YXIgd2lyZSA9IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIHZhciBzdGFydFc7XG4gICAgICB2YXIgc3RhcnRSYXdXO1xuICAgICAgdmFyIGlzVGFibGUgPSBmdW5jdGlvbiAoZWxtKSB7XG4gICAgICAgIHJldHVybiBlbG0ubm9kZU5hbWUgPT09ICdUQUJMRSc7XG4gICAgICB9O1xuICAgICAgdmFyIGxhenlSZXNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByZXNpemU7XG4gICAgICB9O1xuICAgICAgdmFyIGxhenlXaXJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gd2lyZS5nZXRPcihSZXNpemVXaXJlLm9ubHkoU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldEJvZHkoKSksIGlzUmVzaXphYmxlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGxhenlTaXppbmcgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGdldCQ5KGVkaXRvciwgdGFibGUpO1xuICAgICAgfTtcbiAgICAgIHZhciBsYXp5UmVzaXppbmdCZWhhdmlvdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBpc1ByZXNlcnZlVGFibGVDb2x1bW5SZXNpemluZyhlZGl0b3IpID8gcHJlc2VydmVUYWJsZSgpIDogcmVzaXplVGFibGUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0TnVtQ29sdW1ucyA9IGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICByZXR1cm4gZ2V0R3JpZFNpemUodGFibGUpLmNvbHVtbnM7XG4gICAgICB9O1xuICAgICAgdmFyIGFmdGVyQ29ybmVyUmVzaXplID0gZnVuY3Rpb24gKHRhYmxlLCBvcmlnaW4sIHdpZHRoKSB7XG4gICAgICAgIHZhciBpc1JpZ2h0RWRnZVJlc2l6ZSA9IGVuZHNXaXRoKG9yaWdpbiwgJ2UnKTtcbiAgICAgICAgaWYgKHN0YXJ0UmF3VyA9PT0gJycpIHtcbiAgICAgICAgICBlbmZvcmNlUGVyY2VudGFnZShlZGl0b3IsIHRhYmxlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2lkdGggIT09IHN0YXJ0VyAmJiBzdGFydFJhd1cgIT09ICcnKSB7XG4gICAgICAgICAgc2V0JDEodGFibGUsICd3aWR0aCcsIHN0YXJ0UmF3Vyk7XG4gICAgICAgICAgdmFyIHJlc2l6aW5nID0gbGF6eVJlc2l6aW5nQmVoYXZpb3VyKCk7XG4gICAgICAgICAgdmFyIHRhYmxlU2l6ZSA9IGxhenlTaXppbmcodGFibGUpO1xuICAgICAgICAgIHZhciBjb2wgPSBpc1ByZXNlcnZlVGFibGVDb2x1bW5SZXNpemluZyhlZGl0b3IpIHx8IGlzUmlnaHRFZGdlUmVzaXplID8gZ2V0TnVtQ29sdW1ucyh0YWJsZSkgLSAxIDogMDtcbiAgICAgICAgICBhZGp1c3RXaWR0aCh0YWJsZSwgd2lkdGggLSBzdGFydFcsIGNvbCwgcmVzaXppbmcsIHRhYmxlU2l6ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNQZXJjZW50YWdlKHN0YXJ0UmF3VykpIHtcbiAgICAgICAgICB2YXIgcGVyY2VudFcgPSBwYXJzZUZsb2F0KHN0YXJ0UmF3Vy5yZXBsYWNlKCclJywgJycpKTtcbiAgICAgICAgICB2YXIgdGFyZ2V0UGVyY2VudFcgPSB3aWR0aCAqIHBlcmNlbnRXIC8gc3RhcnRXO1xuICAgICAgICAgIHNldCQxKHRhYmxlLCAnd2lkdGgnLCB0YXJnZXRQZXJjZW50VyArICclJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUGl4ZWwoc3RhcnRSYXdXKSkge1xuICAgICAgICAgIHN5bmNQaXhlbHModGFibGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc2l6ZS5lYWNoKGZ1bmN0aW9uIChzeikge1xuICAgICAgICAgIHN6LmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHdpcmUuZWFjaChmdW5jdGlvbiAodykge1xuICAgICAgICAgIHJlbW92ZSQ2KGVkaXRvciwgdyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIGVkaXRvci5vbignaW5pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJhd1dpcmUgPSBnZXQkYShlZGl0b3IsIGlzUmVzaXphYmxlKTtcbiAgICAgICAgd2lyZSA9IE9wdGlvbmFsLnNvbWUocmF3V2lyZSk7XG4gICAgICAgIGlmIChoYXNPYmplY3RSZXNpemluZyhlZGl0b3IpICYmIGhhc1RhYmxlUmVzaXplQmFycyhlZGl0b3IpKSB7XG4gICAgICAgICAgdmFyIHJlc2l6aW5nID0gbGF6eVJlc2l6aW5nQmVoYXZpb3VyKCk7XG4gICAgICAgICAgdmFyIHN6ID0gVGFibGVSZXNpemUuY3JlYXRlKHJhd1dpcmUsIHJlc2l6aW5nLCBsYXp5U2l6aW5nKTtcbiAgICAgICAgICBzei5vbigpO1xuICAgICAgICAgIHN6LmV2ZW50cy5zdGFydERyYWcuYmluZChmdW5jdGlvbiAoX2V2ZW50KSB7XG4gICAgICAgICAgICBzZWxlY3Rpb25SbmcgPSBPcHRpb25hbC5zb21lKGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHN6LmV2ZW50cy5iZWZvcmVSZXNpemUuYmluZChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciByYXdUYWJsZSA9IGV2ZW50LnRhYmxlLmRvbTtcbiAgICAgICAgICAgIGZpcmVPYmplY3RSZXNpemVTdGFydChlZGl0b3IsIHJhd1RhYmxlLCBnZXRQaXhlbFdpZHRoJDEocmF3VGFibGUpLCBnZXRQaXhlbEhlaWdodChyYXdUYWJsZSksIGJhclJlc2l6ZXJQcmVmaXggKyBldmVudC50eXBlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzei5ldmVudHMuYWZ0ZXJSZXNpemUuYmluZChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YWJsZSA9IGV2ZW50LnRhYmxlO1xuICAgICAgICAgICAgdmFyIHJhd1RhYmxlID0gdGFibGUuZG9tO1xuICAgICAgICAgICAgcmVtb3ZlRGF0YVN0eWxlKHRhYmxlKTtcbiAgICAgICAgICAgIHNlbGVjdGlvblJuZy5lYWNoKGZ1bmN0aW9uIChybmcpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocm5nKTtcbiAgICAgICAgICAgICAgZWRpdG9yLmZvY3VzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZpcmVPYmplY3RSZXNpemVkKGVkaXRvciwgcmF3VGFibGUsIGdldFBpeGVsV2lkdGgkMShyYXdUYWJsZSksIGdldFBpeGVsSGVpZ2h0KHJhd1RhYmxlKSwgYmFyUmVzaXplclByZWZpeCArIGV2ZW50LnR5cGUpO1xuICAgICAgICAgICAgZWRpdG9yLnVuZG9NYW5hZ2VyLmFkZCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJlc2l6ZSA9IE9wdGlvbmFsLnNvbWUoc3opO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5vbignT2JqZWN0UmVzaXplU3RhcnQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdGFyZ2V0RWxtID0gZS50YXJnZXQ7XG4gICAgICAgIGlmIChpc1RhYmxlKHRhcmdldEVsbSkpIHtcbiAgICAgICAgICB2YXIgdGFibGUgPSBTdWdhckVsZW1lbnQuZnJvbURvbSh0YXJnZXRFbG0pO1xuICAgICAgICAgIGVhY2goZWRpdG9yLmRvbS5zZWxlY3QoJy5tY2UtY2xvbmVkcmVzaXphYmxlJyksIGZ1bmN0aW9uIChjbG9uZSkge1xuICAgICAgICAgICAgZWRpdG9yLmRvbS5hZGRDbGFzcyhjbG9uZSwgJ21jZS0nICsgZ2V0Q29sdW1uUmVzaXppbmdCZWhhdmlvdXIoZWRpdG9yKSArICctY29sdW1ucycpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICghaXNQaXhlbFNpemluZyQxKHRhYmxlKSAmJiBpc1BpeGVsc0ZvcmNlZChlZGl0b3IpKSB7XG4gICAgICAgICAgICBlbmZvcmNlUGl4ZWxzKGVkaXRvciwgdGFibGUpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoIWlzUGVyY2VudFNpemluZyQxKHRhYmxlKSAmJiBpc1BlcmNlbnRhZ2VzRm9yY2VkKGVkaXRvcikpIHtcbiAgICAgICAgICAgIGVuZm9yY2VQZXJjZW50YWdlKGVkaXRvciwgdGFibGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNOb25lU2l6aW5nJDEodGFibGUpICYmIHN0YXJ0c1dpdGgoZS5vcmlnaW4sIGJhclJlc2l6ZXJQcmVmaXgpKSB7XG4gICAgICAgICAgICBlbmZvcmNlUGVyY2VudGFnZShlZGl0b3IsIHRhYmxlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc3RhcnRXID0gZS53aWR0aDtcbiAgICAgICAgICBzdGFydFJhd1cgPSBpc1Jlc3BvbnNpdmVGb3JjZWQoZWRpdG9yKSA/ICcnIDogZ2V0UmF3V2lkdGgkMShlZGl0b3IsIHRhcmdldEVsbSkuZ2V0T3IoJycpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5vbignT2JqZWN0UmVzaXplZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0YXJnZXRFbG0gPSBlLnRhcmdldDtcbiAgICAgICAgaWYgKGlzVGFibGUodGFyZ2V0RWxtKSkge1xuICAgICAgICAgIHZhciB0YWJsZSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHRhcmdldEVsbSk7XG4gICAgICAgICAgdmFyIG9yaWdpbl8xID0gZS5vcmlnaW47XG4gICAgICAgICAgaWYgKHN0YXJ0c1dpdGgob3JpZ2luXzEsICdjb3JuZXItJykpIHtcbiAgICAgICAgICAgIGFmdGVyQ29ybmVyUmVzaXplKHRhYmxlLCBvcmlnaW5fMSwgZS53aWR0aCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlbW92ZURhdGFTdHlsZSh0YWJsZSk7XG4gICAgICAgICAgZmlyZVRhYmxlTW9kaWZpZWQoZWRpdG9yLCB0YWJsZS5kb20sIHN0eWxlTW9kaWZpZWQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5vbignU3dpdGNoTW9kZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGF6eVJlc2l6ZSgpLmVhY2goZnVuY3Rpb24gKHJlc2l6ZSkge1xuICAgICAgICAgIGlmIChlZGl0b3IubW9kZS5pc1JlYWRPbmx5KCkpIHtcbiAgICAgICAgICAgIHJlc2l6ZS5oaWRlQmFycygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNpemUuc2hvd0JhcnMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsYXp5UmVzaXplOiBsYXp5UmVzaXplLFxuICAgICAgICBsYXp5V2lyZTogbGF6eVdpcmUsXG4gICAgICAgIGRlc3Ryb3k6IGRlc3Ryb3lcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBwb2ludCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvZmZzZXQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgIG9mZnNldDogb2Zmc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgc2NhbiA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgZWxlbWVudCwgZGlyZWN0aW9uKSB7XG4gICAgICBpZiAodW5pdmVyc2UucHJvcGVydHkoKS5pc1RleHQoZWxlbWVudCkgJiYgdW5pdmVyc2UucHJvcGVydHkoKS5nZXRUZXh0KGVsZW1lbnQpLnRyaW0oKS5sZW5ndGggPT09IDAgfHwgdW5pdmVyc2UucHJvcGVydHkoKS5pc0NvbW1lbnQoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGlvbihlbGVtZW50KS5iaW5kKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgcmV0dXJuIHNjYW4odW5pdmVyc2UsIGVsZW0sIGRpcmVjdGlvbikub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShlbGVtKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHRvRW5kID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBlbGVtZW50KSB7XG4gICAgICBpZiAodW5pdmVyc2UucHJvcGVydHkoKS5pc1RleHQoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIHVuaXZlcnNlLnByb3BlcnR5KCkuZ2V0VGV4dChlbGVtZW50KS5sZW5ndGg7XG4gICAgICB9XG4gICAgICB2YXIgY2hpbGRyZW4gPSB1bml2ZXJzZS5wcm9wZXJ0eSgpLmNoaWxkcmVuKGVsZW1lbnQpO1xuICAgICAgcmV0dXJuIGNoaWxkcmVuLmxlbmd0aDtcbiAgICB9O1xuICAgIHZhciBmcmVlZmFsbFJ0bCA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgZWxlbWVudCkge1xuICAgICAgdmFyIGNhbmRpZGF0ZSA9IHNjYW4odW5pdmVyc2UsIGVsZW1lbnQsIHVuaXZlcnNlLnF1ZXJ5KCkucHJldlNpYmxpbmcpLmdldE9yKGVsZW1lbnQpO1xuICAgICAgaWYgKHVuaXZlcnNlLnByb3BlcnR5KCkuaXNUZXh0KGNhbmRpZGF0ZSkpIHtcbiAgICAgICAgcmV0dXJuIHBvaW50KGNhbmRpZGF0ZSwgdG9FbmQodW5pdmVyc2UsIGNhbmRpZGF0ZSkpO1xuICAgICAgfVxuICAgICAgdmFyIGNoaWxkcmVuID0gdW5pdmVyc2UucHJvcGVydHkoKS5jaGlsZHJlbihjYW5kaWRhdGUpO1xuICAgICAgcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA+IDAgPyBmcmVlZmFsbFJ0bCh1bml2ZXJzZSwgY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoIC0gMV0pIDogcG9pbnQoY2FuZGlkYXRlLCB0b0VuZCh1bml2ZXJzZSwgY2FuZGlkYXRlKSk7XG4gICAgfTtcblxuICAgIHZhciBmcmVlZmFsbFJ0bCQxID0gZnJlZWZhbGxSdGw7XG5cbiAgICB2YXIgdW5pdmVyc2UkMSA9IERvbVVuaXZlcnNlKCk7XG4gICAgdmFyIGZyZWVmYWxsUnRsJDIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGZyZWVmYWxsUnRsJDEodW5pdmVyc2UkMSwgZWxlbWVudCk7XG4gICAgfTtcblxuICAgIHZhciBoYWx2ZSA9IGZ1bmN0aW9uIChtYWluLCBvdGhlcikge1xuICAgICAgdmFyIGNvbHNwYW4gPSBnZXRTcGFuKG1haW4sICdjb2xzcGFuJyk7XG4gICAgICBpZiAoY29sc3BhbiA9PT0gMSkge1xuICAgICAgICB2YXIgd2lkdGggPSBnZXRHZW5lcmljV2lkdGgobWFpbik7XG4gICAgICAgIHdpZHRoLmVhY2goZnVuY3Rpb24gKHcpIHtcbiAgICAgICAgICB2YXIgbmV3V2lkdGggPSB3LnZhbHVlIC8gMjtcbiAgICAgICAgICBzZXRHZW5lcmljV2lkdGgobWFpbiwgbmV3V2lkdGgsIHcudW5pdCk7XG4gICAgICAgICAgc2V0R2VuZXJpY1dpZHRoKG90aGVyLCBuZXdXaWR0aCwgdy51bml0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBzZXRJZk5vdCA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0eSwgdmFsdWUsIGlnbm9yZSkge1xuICAgICAgaWYgKHZhbHVlID09PSBpZ25vcmUpIHtcbiAgICAgICAgcmVtb3ZlKGVsZW1lbnQsIHByb3BlcnR5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldChlbGVtZW50LCBwcm9wZXJ0eSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGluc2VydCA9IGZ1bmN0aW9uICh0YWJsZSwgc2VsZWN0b3IsIGVsZW1lbnQpIHtcbiAgICAgIGxhc3QoY2hpbGRyZW4kMih0YWJsZSwgc2VsZWN0b3IpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHByZXBlbmQodGFibGUsIGVsZW1lbnQpO1xuICAgICAgfSwgZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgIHJldHVybiBhZnRlcihjaGlsZCwgZWxlbWVudCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZW5lcmF0ZVNlY3Rpb24gPSBmdW5jdGlvbiAodGFibGUsIHNlY3Rpb25OYW1lKSB7XG4gICAgICB2YXIgc2VjdGlvbiA9IGNoaWxkJDIodGFibGUsIHNlY3Rpb25OYW1lKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5ld1NlY3Rpb24gPSBTdWdhckVsZW1lbnQuZnJvbVRhZyhzZWN0aW9uTmFtZSwgb3duZXIodGFibGUpLmRvbSk7XG4gICAgICAgIGlmIChzZWN0aW9uTmFtZSA9PT0gJ3RoZWFkJykge1xuICAgICAgICAgIGluc2VydCh0YWJsZSwgJ2NhcHRpb24sY29sZ3JvdXAnLCBuZXdTZWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWN0aW9uTmFtZSA9PT0gJ2NvbGdyb3VwJykge1xuICAgICAgICAgIGluc2VydCh0YWJsZSwgJ2NhcHRpb24nLCBuZXdTZWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhcHBlbmQodGFibGUsIG5ld1NlY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTZWN0aW9uO1xuICAgICAgfSk7XG4gICAgICBlbXB0eShzZWN0aW9uKTtcbiAgICAgIHJldHVybiBzZWN0aW9uO1xuICAgIH07XG4gICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uICh0YWJsZSwgZ3JpZCkge1xuICAgICAgdmFyIG5ld1Jvd3MgPSBbXTtcbiAgICAgIHZhciBuZXdDZWxscyA9IFtdO1xuICAgICAgdmFyIHN5bmNSb3dzID0gZnVuY3Rpb24gKGdyaWRTZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBtYXAoZ3JpZFNlY3Rpb24sIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICBpZiAocm93LmlzTmV3KSB7XG4gICAgICAgICAgICBuZXdSb3dzLnB1c2gocm93LmVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgdHIgPSByb3cuZWxlbWVudDtcbiAgICAgICAgICBlbXB0eSh0cik7XG4gICAgICAgICAgZWFjaChyb3cuY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgICBpZiAoY2VsbC5pc05ldykge1xuICAgICAgICAgICAgICBuZXdDZWxscy5wdXNoKGNlbGwuZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRJZk5vdChjZWxsLmVsZW1lbnQsICdjb2xzcGFuJywgY2VsbC5jb2xzcGFuLCAxKTtcbiAgICAgICAgICAgIHNldElmTm90KGNlbGwuZWxlbWVudCwgJ3Jvd3NwYW4nLCBjZWxsLnJvd3NwYW4sIDEpO1xuICAgICAgICAgICAgYXBwZW5kKHRyLCBjZWxsLmVsZW1lbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB0cjtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIHN5bmNDb2xHcm91cCA9IGZ1bmN0aW9uIChncmlkU2VjdGlvbikge1xuICAgICAgICByZXR1cm4gYmluZChncmlkU2VjdGlvbiwgZnVuY3Rpb24gKGNvbEdyb3VwKSB7XG4gICAgICAgICAgcmV0dXJuIG1hcChjb2xHcm91cC5jZWxscywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgc2V0SWZOb3QoY29sLmVsZW1lbnQsICdzcGFuJywgY29sLmNvbHNwYW4sIDEpO1xuICAgICAgICAgICAgcmV0dXJuIGNvbC5lbGVtZW50O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVuZGVyU2VjdGlvbiA9IGZ1bmN0aW9uIChncmlkU2VjdGlvbiwgc2VjdGlvbk5hbWUpIHtcbiAgICAgICAgdmFyIHNlY3Rpb24gPSBnZW5lcmF0ZVNlY3Rpb24odGFibGUsIHNlY3Rpb25OYW1lKTtcbiAgICAgICAgdmFyIHN5bmMgPSBzZWN0aW9uTmFtZSA9PT0gJ2NvbGdyb3VwJyA/IHN5bmNDb2xHcm91cCA6IHN5bmNSb3dzO1xuICAgICAgICB2YXIgc2VjdGlvbkVsZW1zID0gc3luYyhncmlkU2VjdGlvbik7XG4gICAgICAgIGFwcGVuZCQxKHNlY3Rpb24sIHNlY3Rpb25FbGVtcyk7XG4gICAgICB9O1xuICAgICAgdmFyIHJlbW92ZVNlY3Rpb24gPSBmdW5jdGlvbiAoc2VjdGlvbk5hbWUpIHtcbiAgICAgICAgY2hpbGQkMih0YWJsZSwgc2VjdGlvbk5hbWUpLmVhY2gocmVtb3ZlJDIpO1xuICAgICAgfTtcbiAgICAgIHZhciByZW5kZXJPclJlbW92ZVNlY3Rpb24gPSBmdW5jdGlvbiAoZ3JpZFNlY3Rpb24sIHNlY3Rpb25OYW1lKSB7XG4gICAgICAgIGlmIChncmlkU2VjdGlvbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmVuZGVyU2VjdGlvbihncmlkU2VjdGlvbiwgc2VjdGlvbk5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlbW92ZVNlY3Rpb24oc2VjdGlvbk5hbWUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGhlYWRTZWN0aW9uID0gW107XG4gICAgICB2YXIgYm9keVNlY3Rpb24gPSBbXTtcbiAgICAgIHZhciBmb290U2VjdGlvbiA9IFtdO1xuICAgICAgdmFyIGNvbHVtbkdyb3Vwc1NlY3Rpb24gPSBbXTtcbiAgICAgIGVhY2goZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICBzd2l0Y2ggKHJvdy5zZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgJ3RoZWFkJzpcbiAgICAgICAgICBoZWFkU2VjdGlvbi5wdXNoKHJvdyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3Rib2R5JzpcbiAgICAgICAgICBib2R5U2VjdGlvbi5wdXNoKHJvdyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3Rmb290JzpcbiAgICAgICAgICBmb290U2VjdGlvbi5wdXNoKHJvdyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2NvbGdyb3VwJzpcbiAgICAgICAgICBjb2x1bW5Hcm91cHNTZWN0aW9uLnB1c2gocm93KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZW5kZXJPclJlbW92ZVNlY3Rpb24oY29sdW1uR3JvdXBzU2VjdGlvbiwgJ2NvbGdyb3VwJyk7XG4gICAgICByZW5kZXJPclJlbW92ZVNlY3Rpb24oaGVhZFNlY3Rpb24sICd0aGVhZCcpO1xuICAgICAgcmVuZGVyT3JSZW1vdmVTZWN0aW9uKGJvZHlTZWN0aW9uLCAndGJvZHknKTtcbiAgICAgIHJlbmRlck9yUmVtb3ZlU2VjdGlvbihmb290U2VjdGlvbiwgJ3Rmb290Jyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuZXdSb3dzOiBuZXdSb3dzLFxuICAgICAgICBuZXdDZWxsczogbmV3Q2VsbHNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgY29weSQyID0gZnVuY3Rpb24gKGdyaWQpIHtcbiAgICAgIHJldHVybiBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICB2YXIgdHIgPSBzaGFsbG93KHJvdy5lbGVtZW50KTtcbiAgICAgICAgZWFjaChyb3cuY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgdmFyIGNsb25lZENlbGwgPSBkZWVwKGNlbGwuZWxlbWVudCk7XG4gICAgICAgICAgc2V0SWZOb3QoY2xvbmVkQ2VsbCwgJ2NvbHNwYW4nLCBjZWxsLmNvbHNwYW4sIDEpO1xuICAgICAgICAgIHNldElmTm90KGNsb25lZENlbGwsICdyb3dzcGFuJywgY2VsbC5yb3dzcGFuLCAxKTtcbiAgICAgICAgICBhcHBlbmQodHIsIGNsb25lZENlbGwpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRyO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnZXRDb2x1bW4gPSBmdW5jdGlvbiAoZ3JpZCwgaW5kZXgpIHtcbiAgICAgIHJldHVybiBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICByZXR1cm4gZ2V0Q2VsbChyb3csIGluZGV4KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldFJvdyA9IGZ1bmN0aW9uIChncmlkLCBpbmRleCkge1xuICAgICAgcmV0dXJuIGdyaWRbaW5kZXhdO1xuICAgIH07XG4gICAgdmFyIGZpbmREaWZmID0gZnVuY3Rpb24gKHhzLCBjb21wKSB7XG4gICAgICBpZiAoeHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgdmFyIGZpcnN0ID0geHNbMF07XG4gICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgoeHMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiAhY29tcChmaXJzdC5lbGVtZW50LCB4LmVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gaW5kZXguZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB4cy5sZW5ndGg7XG4gICAgICB9LCBmdW5jdGlvbiAoaW5kKSB7XG4gICAgICAgIHJldHVybiBpbmQ7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzdWJncmlkID0gZnVuY3Rpb24gKGdyaWQsIHJvdywgY29sdW1uLCBjb21wYXJhdG9yKSB7XG4gICAgICB2YXIgcmVzdE9mUm93ID0gZ2V0Um93KGdyaWQsIHJvdykuY2VsbHMuc2xpY2UoY29sdW1uKTtcbiAgICAgIHZhciBlbmRDb2xJbmRleCA9IGZpbmREaWZmKHJlc3RPZlJvdywgY29tcGFyYXRvcik7XG4gICAgICB2YXIgcmVzdE9mQ29sdW1uID0gZ2V0Q29sdW1uKGdyaWQsIGNvbHVtbikuc2xpY2Uocm93KTtcbiAgICAgIHZhciBlbmRSb3dJbmRleCA9IGZpbmREaWZmKHJlc3RPZkNvbHVtbiwgY29tcGFyYXRvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb2xzcGFuOiBlbmRDb2xJbmRleCxcbiAgICAgICAgcm93c3BhbjogZW5kUm93SW5kZXhcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciB0b0RldGFpbHMgPSBmdW5jdGlvbiAoZ3JpZCwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIHNlZW4gPSBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICByZXR1cm4gbWFwKHJvdy5jZWxscywgbmV2ZXIpO1xuICAgICAgfSk7XG4gICAgICB2YXIgdXBkYXRlU2VlbiA9IGZ1bmN0aW9uIChyb3dJbmRleCwgY29sdW1uSW5kZXgsIHJvd3NwYW4sIGNvbHNwYW4pIHtcbiAgICAgICAgZm9yICh2YXIgcm93ID0gcm93SW5kZXg7IHJvdyA8IHJvd0luZGV4ICsgcm93c3Bhbjsgcm93KyspIHtcbiAgICAgICAgICBmb3IgKHZhciBjb2x1bW4gPSBjb2x1bW5JbmRleDsgY29sdW1uIDwgY29sdW1uSW5kZXggKyBjb2xzcGFuOyBjb2x1bW4rKykge1xuICAgICAgICAgICAgc2Vlbltyb3ddW2NvbHVtbl0gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdywgcm93SW5kZXgpIHtcbiAgICAgICAgdmFyIGRldGFpbHMgPSBiaW5kKHJvdy5jZWxscywgZnVuY3Rpb24gKGNlbGwsIGNvbHVtbkluZGV4KSB7XG4gICAgICAgICAgaWYgKHNlZW5bcm93SW5kZXhdW2NvbHVtbkluZGV4XSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBzdWJncmlkKGdyaWQsIHJvd0luZGV4LCBjb2x1bW5JbmRleCwgY29tcGFyYXRvcik7XG4gICAgICAgICAgICB1cGRhdGVTZWVuKHJvd0luZGV4LCBjb2x1bW5JbmRleCwgcmVzdWx0LnJvd3NwYW4sIHJlc3VsdC5jb2xzcGFuKTtcbiAgICAgICAgICAgIHJldHVybiBbZGV0YWlsbmV3KGNlbGwuZWxlbWVudCwgcmVzdWx0LnJvd3NwYW4sIHJlc3VsdC5jb2xzcGFuLCBjZWxsLmlzTmV3KV07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcm93ZGV0YWlscyhkZXRhaWxzLCByb3cuc2VjdGlvbik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB0b0dyaWQgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBnZW5lcmF0b3JzLCBpc05ldykge1xuICAgICAgdmFyIGdyaWQgPSBbXTtcbiAgICAgIGlmIChXYXJlaG91c2UuaGFzQ29sdW1ucyh3YXJlaG91c2UpKSB7XG4gICAgICAgIHZhciBncm91cEVsZW1lbnROZXcgPSBtYXAoV2FyZWhvdXNlLmp1c3RDb2x1bW5zKHdhcmVob3VzZSksIGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgICByZXR1cm4gZWxlbWVudG5ldyhjb2x1bW4uZWxlbWVudCwgaXNOZXcsIGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGdyaWQucHVzaChyb3djZWxscyhncm91cEVsZW1lbnROZXcsICdjb2xncm91cCcpKTtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIHJvd0luZGV4ID0gMDsgcm93SW5kZXggPCB3YXJlaG91c2UuZ3JpZC5yb3dzOyByb3dJbmRleCsrKSB7XG4gICAgICAgIHZhciByb3dDZWxscyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBjb2x1bW5JbmRleCA9IDA7IGNvbHVtbkluZGV4IDwgd2FyZWhvdXNlLmdyaWQuY29sdW1uczsgY29sdW1uSW5kZXgrKykge1xuICAgICAgICAgIHZhciBlbGVtZW50ID0gV2FyZWhvdXNlLmdldEF0KHdhcmVob3VzZSwgcm93SW5kZXgsIGNvbHVtbkluZGV4KS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50bmV3KGl0ZW0uZWxlbWVudCwgaXNOZXcsIGl0ZW0uaXNMb2NrZWQpO1xuICAgICAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRuZXcoZ2VuZXJhdG9ycy5nYXAoKSwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJvd0NlbGxzLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJvdyA9IHJvd2NlbGxzKHJvd0NlbGxzLCB3YXJlaG91c2UuYWxsW3Jvd0luZGV4XS5zZWN0aW9uKTtcbiAgICAgICAgZ3JpZC5wdXNoKHJvdyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ3JpZDtcbiAgICB9O1xuXG4gICAgdmFyIGZyb21XYXJlaG91c2UgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBnZW5lcmF0b3JzKSB7XG4gICAgICByZXR1cm4gdG9HcmlkKHdhcmVob3VzZSwgZ2VuZXJhdG9ycywgZmFsc2UpO1xuICAgIH07XG4gICAgdmFyIGRlcml2ZVJvd3MgPSBmdW5jdGlvbiAocmVuZGVyZWQsIGdlbmVyYXRvcnMpIHtcbiAgICAgIHZhciBmaW5kUm93ID0gZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgICAgdmFyIHJvd09mQ2VsbHMgPSBmaW5kTWFwKGRldGFpbHMsIGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgICByZXR1cm4gcGFyZW50KGRldGFpbC5lbGVtZW50KS5tYXAoZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgdmFyIGlzTmV3ID0gcGFyZW50KHJvdykuaXNOb25lKCk7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudG5ldyhyb3csIGlzTmV3LCBmYWxzZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcm93T2ZDZWxscy5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbWVudG5ldyhnZW5lcmF0b3JzLnJvdygpLCB0cnVlLCBmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtYXAocmVuZGVyZWQsIGZ1bmN0aW9uIChkZXRhaWxzKSB7XG4gICAgICAgIHZhciByb3cgPSBmaW5kUm93KGRldGFpbHMuZGV0YWlscyk7XG4gICAgICAgIHJldHVybiByb3dkYXRhbmV3KHJvdy5lbGVtZW50LCBkZXRhaWxzLmRldGFpbHMsIGRldGFpbHMuc2VjdGlvbiwgcm93LmlzTmV3KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRvRGV0YWlsTGlzdCA9IGZ1bmN0aW9uIChncmlkLCBnZW5lcmF0b3JzKSB7XG4gICAgICB2YXIgcmVuZGVyZWQgPSB0b0RldGFpbHMoZ3JpZCwgZXEkMSk7XG4gICAgICByZXR1cm4gZGVyaXZlUm93cyhyZW5kZXJlZCwgZ2VuZXJhdG9ycyk7XG4gICAgfTtcbiAgICB2YXIgZmluZEluV2FyZWhvdXNlID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgZWxlbWVudCkge1xuICAgICAgcmV0dXJuIGZpbmRNYXAod2FyZWhvdXNlLmFsbCwgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuIGZpbmQoci5jZWxscywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICByZXR1cm4gZXEkMShlbGVtZW50LCBlLmVsZW1lbnQpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGV4dHJhY3RDZWxscyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCwgcHJlZGljYXRlKSB7XG4gICAgICB2YXIgZGV0YWlscyA9IG1hcCh0YXJnZXQuc2VsZWN0aW9uLCBmdW5jdGlvbiAoY2VsbCQxKSB7XG4gICAgICAgIHJldHVybiBjZWxsKGNlbGwkMSkuYmluZChmdW5jdGlvbiAobGMpIHtcbiAgICAgICAgICByZXR1cm4gZmluZEluV2FyZWhvdXNlKHdhcmVob3VzZSwgbGMpO1xuICAgICAgICB9KS5maWx0ZXIocHJlZGljYXRlKTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGNlbGxzID0gY2F0KGRldGFpbHMpO1xuICAgICAgcmV0dXJuIHNvbWVJZihjZWxscy5sZW5ndGggPiAwLCBjZWxscyk7XG4gICAgfTtcbiAgICB2YXIgcnVuID0gZnVuY3Rpb24gKG9wZXJhdGlvbiwgZXh0cmFjdCwgYWRqdXN0bWVudCwgcG9zdEFjdGlvbiwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAod2lyZSwgdGFibGUsIHRhcmdldCwgZ2VuZXJhdG9ycywgc2l6aW5nLCByZXNpemVCZWhhdmlvdXIpIHtcbiAgICAgICAgdmFyIHdhcmVob3VzZSA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgICB2YXIgb3V0cHV0ID0gZXh0cmFjdCh3YXJlaG91c2UsIHRhcmdldCkubWFwKGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgICAgdmFyIG1vZGVsID0gZnJvbVdhcmVob3VzZSh3YXJlaG91c2UsIGdlbmVyYXRvcnMpO1xuICAgICAgICAgIHZhciByZXN1bHQgPSBvcGVyYXRpb24obW9kZWwsIGluZm8sIGVxJDEsIGdlbldyYXBwZXJzKGdlbmVyYXRvcnMpKTtcbiAgICAgICAgICB2YXIgbG9ja2VkQ29sdW1ucyA9IGdldExvY2tlZENvbHVtbnNGcm9tR3JpZChyZXN1bHQuZ3JpZCk7XG4gICAgICAgICAgdmFyIGdyaWQgPSB0b0RldGFpbExpc3QocmVzdWx0LmdyaWQsIGdlbmVyYXRvcnMpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxuICAgICAgICAgICAgZ3JpZDogZ3JpZCxcbiAgICAgICAgICAgIGN1cnNvcjogcmVzdWx0LmN1cnNvcixcbiAgICAgICAgICAgIGxvY2tlZENvbHVtbnM6IGxvY2tlZENvbHVtbnNcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG91dHB1dC5iaW5kKGZ1bmN0aW9uIChvdXQpIHtcbiAgICAgICAgICB2YXIgbmV3RWxlbWVudHMgPSByZW5kZXIodGFibGUsIG91dC5ncmlkKTtcbiAgICAgICAgICB2YXIgdGFibGVTaXppbmcgPSBPcHRpb25hbC5mcm9tKHNpemluZykuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gVGFibGVTaXplLmdldFRhYmxlU2l6ZSh0YWJsZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHJlc2l6aW5nID0gT3B0aW9uYWwuZnJvbShyZXNpemVCZWhhdmlvdXIpLmdldE9yVGh1bmsocHJlc2VydmVUYWJsZSk7XG4gICAgICAgICAgYWRqdXN0bWVudCh0YWJsZSwgb3V0LmdyaWQsIG91dC5pbmZvLCB0YWJsZVNpemluZywgcmVzaXppbmcpO1xuICAgICAgICAgIHBvc3RBY3Rpb24odGFibGUpO1xuICAgICAgICAgIHJlZnJlc2god2lyZSwgdGFibGUpO1xuICAgICAgICAgIHJlbW92ZSh0YWJsZSwgTE9DS0VEX0NPTF9BVFRSKTtcbiAgICAgICAgICBpZiAob3V0LmxvY2tlZENvbHVtbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc2V0KHRhYmxlLCBMT0NLRURfQ09MX0FUVFIsIG91dC5sb2NrZWRDb2x1bW5zLmpvaW4oJywnKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICAgIGN1cnNvcjogb3V0LmN1cnNvcixcbiAgICAgICAgICAgIG5ld1Jvd3M6IG5ld0VsZW1lbnRzLm5ld1Jvd3MsXG4gICAgICAgICAgICBuZXdDZWxsczogbmV3RWxlbWVudHMubmV3Q2VsbHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG9uQ2VsbCA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIGNlbGwodGFyZ2V0LmVsZW1lbnQpLmJpbmQoZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRJbldhcmVob3VzZSh3YXJlaG91c2UsIGNlbGwpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgb25QYXN0ZSA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIGNlbGwodGFyZ2V0LmVsZW1lbnQpLmJpbmQoZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGZpbmRJbldhcmVob3VzZSh3YXJlaG91c2UsIGNlbGwpLm1hcChmdW5jdGlvbiAoZGV0YWlscykge1xuICAgICAgICAgIHZhciB2YWx1ZSA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZXRhaWxzKSwge1xuICAgICAgICAgICAgZ2VuZXJhdG9yczogdGFyZ2V0LmdlbmVyYXRvcnMsXG4gICAgICAgICAgICBjbGlwYm9hcmQ6IHRhcmdldC5jbGlwYm9hcmRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgb25QYXN0ZUJ5RWRpdG9yID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgdGFyZ2V0KSB7XG4gICAgICByZXR1cm4gZXh0cmFjdENlbGxzKHdhcmVob3VzZSwgdGFyZ2V0LCBhbHdheXMpLm1hcChmdW5jdGlvbiAoY2VsbHMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjZWxsczogY2VsbHMsXG4gICAgICAgICAgZ2VuZXJhdG9yczogdGFyZ2V0LmdlbmVyYXRvcnMsXG4gICAgICAgICAgY2xpcGJvYXJkOiB0YXJnZXQuY2xpcGJvYXJkXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvbk1lcmdhYmxlID0gZnVuY3Rpb24gKF93YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIHRhcmdldC5tZXJnYWJsZTtcbiAgICB9O1xuICAgIHZhciBvblVubWVyZ2FibGUgPSBmdW5jdGlvbiAoX3dhcmVob3VzZSwgdGFyZ2V0KSB7XG4gICAgICByZXR1cm4gdGFyZ2V0LnVubWVyZ2FibGU7XG4gICAgfTtcbiAgICB2YXIgb25DZWxscyA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIGV4dHJhY3RDZWxscyh3YXJlaG91c2UsIHRhcmdldCwgYWx3YXlzKTtcbiAgICB9O1xuICAgIHZhciBvblVubG9ja2VkQ2VsbCA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIG9uQ2VsbCh3YXJlaG91c2UsIHRhcmdldCkuZmlsdGVyKGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgcmV0dXJuICFkZXRhaWwuaXNMb2NrZWQ7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvblVubG9ja2VkQ2VsbHMgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCB0YXJnZXQpIHtcbiAgICAgIHJldHVybiBleHRyYWN0Q2VsbHMod2FyZWhvdXNlLCB0YXJnZXQsIGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgcmV0dXJuICFkZXRhaWwuaXNMb2NrZWQ7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpc1VubG9ja2VkVGFibGVDZWxsID0gZnVuY3Rpb24gKHdhcmVob3VzZSwgY2VsbCkge1xuICAgICAgcmV0dXJuIGZpbmRJbldhcmVob3VzZSh3YXJlaG91c2UsIGNlbGwpLmV4aXN0cyhmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgIHJldHVybiAhZGV0YWlsLmlzTG9ja2VkO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgYWxsVW5sb2NrZWQgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBjZWxscykge1xuICAgICAgcmV0dXJuIGZvcmFsbChjZWxscywgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGlzVW5sb2NrZWRUYWJsZUNlbGwod2FyZWhvdXNlLCBjZWxsKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG9uVW5sb2NrZWRNZXJnYWJsZSA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIG9uTWVyZ2FibGUod2FyZWhvdXNlLCB0YXJnZXQpLmZpbHRlcihmdW5jdGlvbiAobWVyZ2VhYmxlKSB7XG4gICAgICAgIHJldHVybiBhbGxVbmxvY2tlZCh3YXJlaG91c2UsIG1lcmdlYWJsZS5jZWxscyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvblVubG9ja2VkVW5tZXJnYWJsZSA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIG9uVW5tZXJnYWJsZSh3YXJlaG91c2UsIHRhcmdldCkuZmlsdGVyKGZ1bmN0aW9uIChjZWxscykge1xuICAgICAgICByZXR1cm4gYWxsVW5sb2NrZWQod2FyZWhvdXNlLCBjZWxscyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG1lcmdlID0gZnVuY3Rpb24gKGdyaWQsIGJvdW5kcywgY29tcGFyYXRvciwgc3Vic3RpdHV0aW9uKSB7XG4gICAgICB2YXIgcm93cyA9IGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzO1xuICAgICAgaWYgKHJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBncmlkO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaSA9IGJvdW5kcy5zdGFydFJvdzsgaSA8PSBib3VuZHMuZmluaXNoUm93OyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IGJvdW5kcy5zdGFydENvbDsgaiA8PSBib3VuZHMuZmluaXNoQ29sOyBqKyspIHtcbiAgICAgICAgICB2YXIgcm93ID0gcm93c1tpXTtcbiAgICAgICAgICB2YXIgaXNMb2NrZWQgPSBnZXRDZWxsKHJvdywgaikuaXNMb2NrZWQ7XG4gICAgICAgICAgbXV0YXRlQ2VsbChyb3csIGosIGVsZW1lbnRuZXcoc3Vic3RpdHV0aW9uKCksIGZhbHNlLCBpc0xvY2tlZCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ3JpZDtcbiAgICB9O1xuICAgIHZhciB1bm1lcmdlID0gZnVuY3Rpb24gKGdyaWQsIHRhcmdldCwgY29tcGFyYXRvciwgc3Vic3RpdHV0aW9uKSB7XG4gICAgICB2YXIgcm93cyA9IGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzO1xuICAgICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNlbGxMZW5ndGgocm93c1swXSk7IGorKykge1xuICAgICAgICAgIHZhciByb3cgPSByb3dzW2ldO1xuICAgICAgICAgIHZhciBjdXJyZW50Q2VsbCA9IGdldENlbGwocm93LCBqKTtcbiAgICAgICAgICB2YXIgY3VycmVudENlbGxFbG0gPSBjdXJyZW50Q2VsbC5lbGVtZW50O1xuICAgICAgICAgIHZhciBpc1RvUmVwbGFjZSA9IGNvbXBhcmF0b3IoY3VycmVudENlbGxFbG0sIHRhcmdldCk7XG4gICAgICAgICAgaWYgKGlzVG9SZXBsYWNlID09PSB0cnVlICYmIGZpcnN0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbXV0YXRlQ2VsbChyb3csIGosIGVsZW1lbnRuZXcoc3Vic3RpdHV0aW9uKCksIHRydWUsIGN1cnJlbnRDZWxsLmlzTG9ja2VkKSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc1RvUmVwbGFjZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBncmlkO1xuICAgIH07XG4gICAgdmFyIHVuaXF1ZUNlbGxzID0gZnVuY3Rpb24gKHJvdywgY29tcGFyYXRvcikge1xuICAgICAgcmV0dXJuIGZvbGRsKHJvdywgZnVuY3Rpb24gKHJlc3QsIGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0cyhyZXN0LCBmdW5jdGlvbiAoY3VycmVudENlbGwpIHtcbiAgICAgICAgICByZXR1cm4gY29tcGFyYXRvcihjdXJyZW50Q2VsbC5lbGVtZW50LCBjZWxsLmVsZW1lbnQpO1xuICAgICAgICB9KSA/IHJlc3QgOiByZXN0LmNvbmNhdChbY2VsbF0pO1xuICAgICAgfSwgW10pO1xuICAgIH07XG4gICAgdmFyIHNwbGl0Q29scyA9IGZ1bmN0aW9uIChncmlkLCBpbmRleCwgY29tcGFyYXRvciwgc3Vic3RpdHV0aW9uKSB7XG4gICAgICBpZiAoaW5kZXggPiAwICYmIGluZGV4IDwgZ3JpZFswXS5jZWxscy5sZW5ndGgpIHtcbiAgICAgICAgZWFjaChncmlkLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgdmFyIHByZXZDZWxsID0gcm93LmNlbGxzW2luZGV4IC0gMV07XG4gICAgICAgICAgdmFyIGN1cnJlbnQgPSByb3cuY2VsbHNbaW5kZXhdO1xuICAgICAgICAgIHZhciBpc1RvUmVwbGFjZSA9IGNvbXBhcmF0b3IoY3VycmVudC5lbGVtZW50LCBwcmV2Q2VsbC5lbGVtZW50KTtcbiAgICAgICAgICBpZiAoaXNUb1JlcGxhY2UpIHtcbiAgICAgICAgICAgIG11dGF0ZUNlbGwocm93LCBpbmRleCwgZWxlbWVudG5ldyhzdWJzdGl0dXRpb24oKSwgdHJ1ZSwgY3VycmVudC5pc0xvY2tlZCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ3JpZDtcbiAgICB9O1xuICAgIHZhciBzcGxpdFJvd3MgPSBmdW5jdGlvbiAoZ3JpZCwgaW5kZXgsIGNvbXBhcmF0b3IsIHN1YnN0aXR1dGlvbikge1xuICAgICAgdmFyIHJvd3MgPSBleHRyYWN0R3JpZERldGFpbHMoZ3JpZCkucm93cztcbiAgICAgIGlmIChpbmRleCA+IDAgJiYgaW5kZXggPCByb3dzLmxlbmd0aCkge1xuICAgICAgICB2YXIgcm93UHJldkNlbGxzID0gcm93c1tpbmRleCAtIDFdLmNlbGxzO1xuICAgICAgICB2YXIgY2VsbHMgPSB1bmlxdWVDZWxscyhyb3dQcmV2Q2VsbHMsIGNvbXBhcmF0b3IpO1xuICAgICAgICBlYWNoKGNlbGxzLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIHZhciByZXBsYWNlbWVudCA9IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gaW5kZXg7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIChqKSB7XG4gICAgICAgICAgICAgIHZhciByb3cgPSByb3dzW2ldO1xuICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IGdldENlbGwocm93LCBqKTtcbiAgICAgICAgICAgICAgdmFyIGlzVG9SZXBsYWNlID0gY29tcGFyYXRvcihjdXJyZW50LmVsZW1lbnQsIGNlbGwuZWxlbWVudCk7XG4gICAgICAgICAgICAgIGlmIChpc1RvUmVwbGFjZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlbWVudC5pc05vbmUoKSkge1xuICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQgPSBPcHRpb25hbC5zb21lKHN1YnN0aXR1dGlvbigpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVwbGFjZW1lbnQuZWFjaChmdW5jdGlvbiAoc3ViKSB7XG4gICAgICAgICAgICAgICAgICBtdXRhdGVDZWxsKHJvdywgaiwgZWxlbWVudG5ldyhzdWIsIHRydWUsIGN1cnJlbnQuaXNMb2NrZWQpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY2VsbExlbmd0aChyb3dzWzBdKTsgaisrKSB7XG4gICAgICAgICAgICAgIF9sb29wXzEoaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBncmlkO1xuICAgIH07XG5cbiAgICB2YXIgdmFsdWUgPSBmdW5jdGlvbiAobykge1xuICAgICAgdmFyIGlzID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgcmV0dXJuIG8gPT09IHY7XG4gICAgICB9O1xuICAgICAgdmFyIG9yID0gZnVuY3Rpb24gKF9vcHQpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlKG8pO1xuICAgICAgfTtcbiAgICAgIHZhciBvclRodW5rID0gZnVuY3Rpb24gKF9mKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZShvKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlKGYobykpO1xuICAgICAgfTtcbiAgICAgIHZhciBtYXBFcnJvciA9IGZ1bmN0aW9uIChfZikge1xuICAgICAgICByZXR1cm4gdmFsdWUobyk7XG4gICAgICB9O1xuICAgICAgdmFyIGVhY2ggPSBmdW5jdGlvbiAoZikge1xuICAgICAgICBmKG8pO1xuICAgICAgfTtcbiAgICAgIHZhciBiaW5kID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYobyk7XG4gICAgICB9O1xuICAgICAgdmFyIGZvbGQgPSBmdW5jdGlvbiAoXywgb25WYWx1ZSkge1xuICAgICAgICByZXR1cm4gb25WYWx1ZShvKTtcbiAgICAgIH07XG4gICAgICB2YXIgZXhpc3RzID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYobyk7XG4gICAgICB9O1xuICAgICAgdmFyIGZvcmFsbCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKG8pO1xuICAgICAgfTtcbiAgICAgIHZhciB0b09wdGlvbmFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShvKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpczogaXMsXG4gICAgICAgIGlzVmFsdWU6IGFsd2F5cyxcbiAgICAgICAgaXNFcnJvcjogbmV2ZXIsXG4gICAgICAgIGdldE9yOiBjb25zdGFudChvKSxcbiAgICAgICAgZ2V0T3JUaHVuazogY29uc3RhbnQobyksXG4gICAgICAgIGdldE9yRGllOiBjb25zdGFudChvKSxcbiAgICAgICAgb3I6IG9yLFxuICAgICAgICBvclRodW5rOiBvclRodW5rLFxuICAgICAgICBmb2xkOiBmb2xkLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgbWFwRXJyb3I6IG1hcEVycm9yLFxuICAgICAgICBlYWNoOiBlYWNoLFxuICAgICAgICBiaW5kOiBiaW5kLFxuICAgICAgICBleGlzdHM6IGV4aXN0cyxcbiAgICAgICAgZm9yYWxsOiBmb3JhbGwsXG4gICAgICAgIHRvT3B0aW9uYWw6IHRvT3B0aW9uYWxcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgdmFyIGdldE9yVGh1bmsgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZigpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRPckRpZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRpZShTdHJpbmcobWVzc2FnZSkpKCk7XG4gICAgICB9O1xuICAgICAgdmFyIG9yID0gZnVuY3Rpb24gKG9wdCkge1xuICAgICAgICByZXR1cm4gb3B0O1xuICAgICAgfTtcbiAgICAgIHZhciBvclRodW5rID0gZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgcmV0dXJuIGYoKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwID0gZnVuY3Rpb24gKF9mKSB7XG4gICAgICAgIHJldHVybiBlcnJvcihtZXNzYWdlKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFwRXJyb3IgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gZXJyb3IoZihtZXNzYWdlKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGJpbmQgPSBmdW5jdGlvbiAoX2YpIHtcbiAgICAgICAgcmV0dXJuIGVycm9yKG1lc3NhZ2UpO1xuICAgICAgfTtcbiAgICAgIHZhciBmb2xkID0gZnVuY3Rpb24gKG9uRXJyb3IsIF8pIHtcbiAgICAgICAgcmV0dXJuIG9uRXJyb3IobWVzc2FnZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXM6IG5ldmVyLFxuICAgICAgICBpc1ZhbHVlOiBuZXZlcixcbiAgICAgICAgaXNFcnJvcjogYWx3YXlzLFxuICAgICAgICBnZXRPcjogaWRlbnRpdHksXG4gICAgICAgIGdldE9yVGh1bms6IGdldE9yVGh1bmssXG4gICAgICAgIGdldE9yRGllOiBnZXRPckRpZSxcbiAgICAgICAgb3I6IG9yLFxuICAgICAgICBvclRodW5rOiBvclRodW5rLFxuICAgICAgICBmb2xkOiBmb2xkLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgbWFwRXJyb3I6IG1hcEVycm9yLFxuICAgICAgICBlYWNoOiBub29wLFxuICAgICAgICBiaW5kOiBiaW5kLFxuICAgICAgICBleGlzdHM6IG5ldmVyLFxuICAgICAgICBmb3JhbGw6IGFsd2F5cyxcbiAgICAgICAgdG9PcHRpb25hbDogT3B0aW9uYWwubm9uZVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBmcm9tT3B0aW9uID0gZnVuY3Rpb24gKG9wdCwgZXJyKSB7XG4gICAgICByZXR1cm4gb3B0LmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZXJyb3IoZXJyKTtcbiAgICAgIH0sIHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciBSZXN1bHQgPSB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlcnJvcjogZXJyb3IsXG4gICAgICBmcm9tT3B0aW9uOiBmcm9tT3B0aW9uXG4gICAgfTtcblxuICAgIHZhciBtZWFzdXJlID0gZnVuY3Rpb24gKHN0YXJ0QWRkcmVzcywgZ3JpZEEsIGdyaWRCKSB7XG4gICAgICBpZiAoc3RhcnRBZGRyZXNzLnJvdyA+PSBncmlkQS5sZW5ndGggfHwgc3RhcnRBZGRyZXNzLmNvbHVtbiA+IGNlbGxMZW5ndGgoZ3JpZEFbMF0pKSB7XG4gICAgICAgIHJldHVybiBSZXN1bHQuZXJyb3IoJ2ludmFsaWQgc3RhcnQgYWRkcmVzcyBvdXQgb2YgdGFibGUgYm91bmRzLCByb3c6ICcgKyBzdGFydEFkZHJlc3Mucm93ICsgJywgY29sdW1uOiAnICsgc3RhcnRBZGRyZXNzLmNvbHVtbik7XG4gICAgICB9XG4gICAgICB2YXIgcm93UmVtYWluZGVyID0gZ3JpZEEuc2xpY2Uoc3RhcnRBZGRyZXNzLnJvdyk7XG4gICAgICB2YXIgY29sUmVtYWluZGVyID0gcm93UmVtYWluZGVyWzBdLmNlbGxzLnNsaWNlKHN0YXJ0QWRkcmVzcy5jb2x1bW4pO1xuICAgICAgdmFyIGNvbFJlcXVpcmVkID0gY2VsbExlbmd0aChncmlkQlswXSk7XG4gICAgICB2YXIgcm93UmVxdWlyZWQgPSBncmlkQi5sZW5ndGg7XG4gICAgICByZXR1cm4gUmVzdWx0LnZhbHVlKHtcbiAgICAgICAgcm93RGVsdGE6IHJvd1JlbWFpbmRlci5sZW5ndGggLSByb3dSZXF1aXJlZCxcbiAgICAgICAgY29sRGVsdGE6IGNvbFJlbWFpbmRlci5sZW5ndGggLSBjb2xSZXF1aXJlZFxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbWVhc3VyZVdpZHRoID0gZnVuY3Rpb24gKGdyaWRBLCBncmlkQikge1xuICAgICAgdmFyIGNvbExlbmd0aEEgPSBjZWxsTGVuZ3RoKGdyaWRBWzBdKTtcbiAgICAgIHZhciBjb2xMZW5ndGhCID0gY2VsbExlbmd0aChncmlkQlswXSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByb3dEZWx0YTogMCxcbiAgICAgICAgY29sRGVsdGE6IGNvbExlbmd0aEEgLSBjb2xMZW5ndGhCXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1lYXN1cmVIZWlnaHQgPSBmdW5jdGlvbiAoZ3JpZEEsIGdyaWRCKSB7XG4gICAgICB2YXIgcm93TGVuZ3RoQSA9IGdyaWRBLmxlbmd0aDtcbiAgICAgIHZhciByb3dMZW5ndGhCID0gZ3JpZEIubGVuZ3RoO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcm93RGVsdGE6IHJvd0xlbmd0aEEgLSByb3dMZW5ndGhCLFxuICAgICAgICBjb2xEZWx0YTogMFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZW5lcmF0ZUVsZW1lbnRzID0gZnVuY3Rpb24gKGFtb3VudCwgcm93LCBnZW5lcmF0b3JzLCBpc0xvY2tlZCkge1xuICAgICAgdmFyIGdlbmVyYXRvciA9IHJvdy5zZWN0aW9uID09PSAnY29sZ3JvdXAnID8gZ2VuZXJhdG9ycy5jb2wgOiBnZW5lcmF0b3JzLmNlbGw7XG4gICAgICByZXR1cm4gcmFuZ2UoYW1vdW50LCBmdW5jdGlvbiAoaWR4KSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50bmV3KGdlbmVyYXRvcigpLCB0cnVlLCBpc0xvY2tlZChpZHgpKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJvd0ZpbGwgPSBmdW5jdGlvbiAoZ3JpZCwgYW1vdW50LCBnZW5lcmF0b3JzLCBsb2NrZWRDb2x1bW5zKSB7XG4gICAgICByZXR1cm4gZ3JpZC5jb25jYXQocmFuZ2UoYW1vdW50LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByb3cgPSBncmlkW2dyaWQubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBlbGVtZW50cyA9IGdlbmVyYXRlRWxlbWVudHMocm93LmNlbGxzLmxlbmd0aCwgcm93LCBnZW5lcmF0b3JzLCBmdW5jdGlvbiAoaWR4KSB7XG4gICAgICAgICAgcmV0dXJuIGhhcyhsb2NrZWRDb2x1bW5zLCBpZHgudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc2V0Q2VsbHMocm93LCBlbGVtZW50cyk7XG4gICAgICB9KSk7XG4gICAgfTtcbiAgICB2YXIgY29sRmlsbCA9IGZ1bmN0aW9uIChncmlkLCBhbW91bnQsIGdlbmVyYXRvcnMsIHN0YXJ0SW5kZXgpIHtcbiAgICAgIHJldHVybiBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICB2YXIgbmV3Q2hpbGRyZW4gPSBnZW5lcmF0ZUVsZW1lbnRzKGFtb3VudCwgcm93LCBnZW5lcmF0b3JzLCBuZXZlcik7XG4gICAgICAgIHJldHVybiBhZGRDZWxscyhyb3csIHN0YXJ0SW5kZXgsIG5ld0NoaWxkcmVuKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGxvY2tlZENvbEZpbGwgPSBmdW5jdGlvbiAoZ3JpZCwgZ2VuZXJhdG9ycywgbG9ja2VkQ29sdW1ucykge1xuICAgICAgcmV0dXJuIG1hcChncmlkLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIHJldHVybiBmb2xkbChsb2NrZWRDb2x1bW5zLCBmdW5jdGlvbiAoYWNjLCBjb2xOdW0pIHtcbiAgICAgICAgICB2YXIgbmV3Q2hpbGQgPSBnZW5lcmF0ZUVsZW1lbnRzKDEsIHJvdywgZ2VuZXJhdG9ycywgYWx3YXlzKVswXTtcbiAgICAgICAgICByZXR1cm4gYWRkQ2VsbChhY2MsIGNvbE51bSwgbmV3Q2hpbGQpO1xuICAgICAgICB9LCByb3cpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdGFpbG9yID0gZnVuY3Rpb24gKGdyaWRBLCBkZWx0YSwgZ2VuZXJhdG9ycykge1xuICAgICAgdmFyIGZpbGxDb2xzID0gZGVsdGEuY29sRGVsdGEgPCAwID8gY29sRmlsbCA6IGlkZW50aXR5O1xuICAgICAgdmFyIGZpbGxSb3dzID0gZGVsdGEucm93RGVsdGEgPCAwID8gcm93RmlsbCA6IGlkZW50aXR5O1xuICAgICAgdmFyIGxvY2tlZENvbHVtbnMgPSBnZXRMb2NrZWRDb2x1bW5zRnJvbUdyaWQoZ3JpZEEpO1xuICAgICAgdmFyIGdyaWRXaWR0aCA9IGNlbGxMZW5ndGgoZ3JpZEFbMF0pO1xuICAgICAgdmFyIGlzTGFzdENvbExvY2tlZCA9IGV4aXN0cyhsb2NrZWRDb2x1bW5zLCBmdW5jdGlvbiAobG9ja2VkKSB7XG4gICAgICAgIHJldHVybiBsb2NrZWQgPT09IGdyaWRXaWR0aCAtIDE7XG4gICAgICB9KTtcbiAgICAgIHZhciBtb2RpZmllZENvbHMgPSBmaWxsQ29scyhncmlkQSwgTWF0aC5hYnMoZGVsdGEuY29sRGVsdGEpLCBnZW5lcmF0b3JzLCBpc0xhc3RDb2xMb2NrZWQgPyBncmlkV2lkdGggLSAxIDogZ3JpZFdpZHRoKTtcbiAgICAgIHZhciBuZXdMb2NrZWRDb2x1bW5zID0gZ2V0TG9ja2VkQ29sdW1uc0Zyb21HcmlkKG1vZGlmaWVkQ29scyk7XG4gICAgICByZXR1cm4gZmlsbFJvd3MobW9kaWZpZWRDb2xzLCBNYXRoLmFicyhkZWx0YS5yb3dEZWx0YSksIGdlbmVyYXRvcnMsIG1hcFRvT2JqZWN0KG5ld0xvY2tlZENvbHVtbnMsIGFsd2F5cykpO1xuICAgIH07XG5cbiAgICB2YXIgaXNTcGFubmluZyA9IGZ1bmN0aW9uIChncmlkLCByb3csIGNvbCwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGNhbmRpZGF0ZSA9IGdldENlbGwoZ3JpZFtyb3ddLCBjb2wpO1xuICAgICAgdmFyIG1hdGNoaW5nID0gY3VycnkoY29tcGFyYXRvciwgY2FuZGlkYXRlLmVsZW1lbnQpO1xuICAgICAgdmFyIGN1cnJlbnRSb3cgPSBncmlkW3Jvd107XG4gICAgICByZXR1cm4gZ3JpZC5sZW5ndGggPiAxICYmIGNlbGxMZW5ndGgoY3VycmVudFJvdykgPiAxICYmIChjb2wgPiAwICYmIG1hdGNoaW5nKGdldENlbGxFbGVtZW50KGN1cnJlbnRSb3csIGNvbCAtIDEpKSB8fCBjb2wgPCBjdXJyZW50Um93LmNlbGxzLmxlbmd0aCAtIDEgJiYgbWF0Y2hpbmcoZ2V0Q2VsbEVsZW1lbnQoY3VycmVudFJvdywgY29sICsgMSkpIHx8IHJvdyA+IDAgJiYgbWF0Y2hpbmcoZ2V0Q2VsbEVsZW1lbnQoZ3JpZFtyb3cgLSAxXSwgY29sKSkgfHwgcm93IDwgZ3JpZC5sZW5ndGggLSAxICYmIG1hdGNoaW5nKGdldENlbGxFbGVtZW50KGdyaWRbcm93ICsgMV0sIGNvbCkpKTtcbiAgICB9O1xuICAgIHZhciBtZXJnZVRhYmxlcyA9IGZ1bmN0aW9uIChzdGFydEFkZHJlc3MsIGdyaWRBLCBncmlkQiwgZ2VuZXJhdG9yLCBjb21wYXJhdG9yLCBsb2NrZWRDb2x1bW5zKSB7XG4gICAgICB2YXIgc3RhcnRSb3cgPSBzdGFydEFkZHJlc3Mucm93O1xuICAgICAgdmFyIHN0YXJ0Q29sID0gc3RhcnRBZGRyZXNzLmNvbHVtbjtcbiAgICAgIHZhciBtZXJnZUhlaWdodCA9IGdyaWRCLmxlbmd0aDtcbiAgICAgIHZhciBtZXJnZVdpZHRoID0gY2VsbExlbmd0aChncmlkQlswXSk7XG4gICAgICB2YXIgZW5kUm93ID0gc3RhcnRSb3cgKyBtZXJnZUhlaWdodDtcbiAgICAgIHZhciBlbmRDb2wgPSBzdGFydENvbCArIG1lcmdlV2lkdGggKyBsb2NrZWRDb2x1bW5zLmxlbmd0aDtcbiAgICAgIHZhciBsb2NrZWRDb2x1bW5PYmogPSBtYXBUb09iamVjdChsb2NrZWRDb2x1bW5zLCBhbHdheXMpO1xuICAgICAgZm9yICh2YXIgciA9IHN0YXJ0Um93OyByIDwgZW5kUm93OyByKyspIHtcbiAgICAgICAgdmFyIHNraXBwZWRDb2wgPSAwO1xuICAgICAgICBmb3IgKHZhciBjID0gc3RhcnRDb2w7IGMgPCBlbmRDb2w7IGMrKykge1xuICAgICAgICAgIGlmIChsb2NrZWRDb2x1bW5PYmpbY10pIHtcbiAgICAgICAgICAgIHNraXBwZWRDb2wrKztcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNTcGFubmluZyhncmlkQSwgciwgYywgY29tcGFyYXRvcikpIHtcbiAgICAgICAgICAgIHVubWVyZ2UoZ3JpZEEsIGdldENlbGxFbGVtZW50KGdyaWRBW3JdLCBjKSwgY29tcGFyYXRvciwgZ2VuZXJhdG9yLmNlbGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgZ3JpZEJDb2xJbmRleCA9IGMgLSBzdGFydENvbCAtIHNraXBwZWRDb2w7XG4gICAgICAgICAgdmFyIG5ld0NlbGwgPSBnZXRDZWxsKGdyaWRCW3IgLSBzdGFydFJvd10sIGdyaWRCQ29sSW5kZXgpO1xuICAgICAgICAgIHZhciBuZXdDZWxsRWxtID0gbmV3Q2VsbC5lbGVtZW50O1xuICAgICAgICAgIHZhciByZXBsYWNlbWVudCA9IGdlbmVyYXRvci5yZXBsYWNlKG5ld0NlbGxFbG0pO1xuICAgICAgICAgIG11dGF0ZUNlbGwoZ3JpZEFbcl0sIGMsIGVsZW1lbnRuZXcocmVwbGFjZW1lbnQsIHRydWUsIG5ld0NlbGwuaXNMb2NrZWQpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdyaWRBO1xuICAgIH07XG4gICAgdmFyIGdldFZhbGlkU3RhcnRBZGRyZXNzID0gZnVuY3Rpb24gKGN1cnJlbnRTdGFydEFkZHJlc3MsIGdyaWQsIGxvY2tlZENvbHVtbnMpIHtcbiAgICAgIHZhciBncmlkQ29sTGVuZ3RoID0gY2VsbExlbmd0aChncmlkWzBdKTtcbiAgICAgIHZhciBwb3NzaWJsZUNvbEFkZHJlc3NlcyA9IHJhbmdlKGdyaWRDb2xMZW5ndGggLSBjdXJyZW50U3RhcnRBZGRyZXNzLmNvbHVtbiwgZnVuY3Rpb24gKG51bSkge1xuICAgICAgICByZXR1cm4gbnVtICsgY3VycmVudFN0YXJ0QWRkcmVzcy5jb2x1bW47XG4gICAgICB9KTtcbiAgICAgIHZhciB2YWxpZENvbEFkZHJlc3MgPSBmaW5kKHBvc3NpYmxlQ29sQWRkcmVzc2VzLCBmdW5jdGlvbiAobnVtKSB7XG4gICAgICAgIHJldHVybiBmb3JhbGwobG9ja2VkQ29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgIHJldHVybiBjb2wgIT09IG51bTtcbiAgICAgICAgfSk7XG4gICAgICB9KS5nZXRPcihncmlkQ29sTGVuZ3RoIC0gMSk7XG4gICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIGN1cnJlbnRTdGFydEFkZHJlc3MpLCB7IGNvbHVtbjogdmFsaWRDb2xBZGRyZXNzIH0pO1xuICAgIH07XG4gICAgdmFyIGdldExvY2tlZENvbHVtbnNXaXRoaW5Cb3VuZHMgPSBmdW5jdGlvbiAoc3RhcnRBZGRyZXNzLCBncmlkLCBsb2NrZWRDb2x1bW5zKSB7XG4gICAgICByZXR1cm4gZmlsdGVyKGxvY2tlZENvbHVtbnMsIGZ1bmN0aW9uIChjb2xOdW0pIHtcbiAgICAgICAgcmV0dXJuIGNvbE51bSA+PSBzdGFydEFkZHJlc3MuY29sdW1uICYmIGNvbE51bSA8PSBjZWxsTGVuZ3RoKGdyaWRbMF0pICsgc3RhcnRBZGRyZXNzLmNvbHVtbjtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG1lcmdlJDEgPSBmdW5jdGlvbiAoc3RhcnRBZGRyZXNzLCBncmlkQSwgZ3JpZEIsIGdlbmVyYXRvciwgY29tcGFyYXRvcikge1xuICAgICAgdmFyIGxvY2tlZENvbHVtbnMgPSBnZXRMb2NrZWRDb2x1bW5zRnJvbUdyaWQoZ3JpZEEpO1xuICAgICAgdmFyIHZhbGlkU3RhcnRBZGRyZXNzID0gZ2V0VmFsaWRTdGFydEFkZHJlc3Moc3RhcnRBZGRyZXNzLCBncmlkQSwgbG9ja2VkQ29sdW1ucyk7XG4gICAgICB2YXIgbG9ja2VkQ29sdW1uc1dpdGhpbkJvdW5kcyA9IGdldExvY2tlZENvbHVtbnNXaXRoaW5Cb3VuZHModmFsaWRTdGFydEFkZHJlc3MsIGdyaWRCLCBsb2NrZWRDb2x1bW5zKTtcbiAgICAgIHZhciByZXN1bHQgPSBtZWFzdXJlKHZhbGlkU3RhcnRBZGRyZXNzLCBncmlkQSwgZ3JpZEIpO1xuICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoZnVuY3Rpb24gKGRpZmYpIHtcbiAgICAgICAgdmFyIGRlbHRhID0gX19hc3NpZ24oX19hc3NpZ24oe30sIGRpZmYpLCB7IGNvbERlbHRhOiBkaWZmLmNvbERlbHRhIC0gbG9ja2VkQ29sdW1uc1dpdGhpbkJvdW5kcy5sZW5ndGggfSk7XG4gICAgICAgIHZhciBmaXR0ZWRHcmlkID0gdGFpbG9yKGdyaWRBLCBkZWx0YSwgZ2VuZXJhdG9yKTtcbiAgICAgICAgdmFyIG5ld0xvY2tlZENvbHVtbnMgPSBnZXRMb2NrZWRDb2x1bW5zRnJvbUdyaWQoZml0dGVkR3JpZCk7XG4gICAgICAgIHZhciBuZXdMb2NrZWRDb2x1bW5zV2l0aGluQm91bmRzID0gZ2V0TG9ja2VkQ29sdW1uc1dpdGhpbkJvdW5kcyh2YWxpZFN0YXJ0QWRkcmVzcywgZ3JpZEIsIG5ld0xvY2tlZENvbHVtbnMpO1xuICAgICAgICByZXR1cm4gbWVyZ2VUYWJsZXModmFsaWRTdGFydEFkZHJlc3MsIGZpdHRlZEdyaWQsIGdyaWRCLCBnZW5lcmF0b3IsIGNvbXBhcmF0b3IsIG5ld0xvY2tlZENvbHVtbnNXaXRoaW5Cb3VuZHMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0Q29scyA9IGZ1bmN0aW9uIChpbmRleCwgZ3JpZEEsIGdyaWRCLCBnZW5lcmF0b3IsIGNvbXBhcmF0b3IpIHtcbiAgICAgIHNwbGl0Q29scyhncmlkQSwgaW5kZXgsIGNvbXBhcmF0b3IsIGdlbmVyYXRvci5jZWxsKTtcbiAgICAgIHZhciBkZWx0YSA9IG1lYXN1cmVIZWlnaHQoZ3JpZEIsIGdyaWRBKTtcbiAgICAgIHZhciBmaXR0ZWROZXdHcmlkID0gdGFpbG9yKGdyaWRCLCBkZWx0YSwgZ2VuZXJhdG9yKTtcbiAgICAgIHZhciBzZWNvbmREZWx0YSA9IG1lYXN1cmVIZWlnaHQoZ3JpZEEsIGZpdHRlZE5ld0dyaWQpO1xuICAgICAgdmFyIGZpdHRlZE9sZEdyaWQgPSB0YWlsb3IoZ3JpZEEsIHNlY29uZERlbHRhLCBnZW5lcmF0b3IpO1xuICAgICAgcmV0dXJuIG1hcChmaXR0ZWRPbGRHcmlkLCBmdW5jdGlvbiAoZ3JpZFJvdywgaSkge1xuICAgICAgICByZXR1cm4gYWRkQ2VsbHMoZ3JpZFJvdywgaW5kZXgsIGZpdHRlZE5ld0dyaWRbaV0uY2VsbHMpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0Um93cyA9IGZ1bmN0aW9uIChpbmRleCwgZ3JpZEEsIGdyaWRCLCBnZW5lcmF0b3IsIGNvbXBhcmF0b3IpIHtcbiAgICAgIHNwbGl0Um93cyhncmlkQSwgaW5kZXgsIGNvbXBhcmF0b3IsIGdlbmVyYXRvci5jZWxsKTtcbiAgICAgIHZhciBsb2NrZWQgPSBnZXRMb2NrZWRDb2x1bW5zRnJvbUdyaWQoZ3JpZEEpO1xuICAgICAgdmFyIGRpZmYgPSBtZWFzdXJlV2lkdGgoZ3JpZEEsIGdyaWRCKTtcbiAgICAgIHZhciBkZWx0YSA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBkaWZmKSwgeyBjb2xEZWx0YTogZGlmZi5jb2xEZWx0YSAtIGxvY2tlZC5sZW5ndGggfSk7XG4gICAgICB2YXIgZml0dGVkT2xkR3JpZCA9IHRhaWxvcihncmlkQSwgZGVsdGEsIGdlbmVyYXRvcik7XG4gICAgICB2YXIgX2EgPSBleHRyYWN0R3JpZERldGFpbHMoZml0dGVkT2xkR3JpZCksIG9sZENvbHMgPSBfYS5jb2xzLCBvbGRSb3dzID0gX2Eucm93cztcbiAgICAgIHZhciBuZXdMb2NrZWQgPSBnZXRMb2NrZWRDb2x1bW5zRnJvbUdyaWQoZml0dGVkT2xkR3JpZCk7XG4gICAgICB2YXIgc2Vjb25kRGlmZiA9IG1lYXN1cmVXaWR0aChncmlkQiwgZ3JpZEEpO1xuICAgICAgdmFyIHNlY29uZERlbHRhID0gX19hc3NpZ24oX19hc3NpZ24oe30sIHNlY29uZERpZmYpLCB7IGNvbERlbHRhOiBzZWNvbmREaWZmLmNvbERlbHRhICsgbmV3TG9ja2VkLmxlbmd0aCB9KTtcbiAgICAgIHZhciBmaXR0ZWRHcmlkQiA9IGxvY2tlZENvbEZpbGwoZ3JpZEIsIGdlbmVyYXRvciwgbmV3TG9ja2VkKTtcbiAgICAgIHZhciBmaXR0ZWROZXdHcmlkID0gdGFpbG9yKGZpdHRlZEdyaWRCLCBzZWNvbmREZWx0YSwgZ2VuZXJhdG9yKTtcbiAgICAgIHJldHVybiBvbGRDb2xzLmNvbmNhdChvbGRSb3dzLnNsaWNlKDAsIGluZGV4KSkuY29uY2F0KGZpdHRlZE5ld0dyaWQpLmNvbmNhdChvbGRSb3dzLnNsaWNlKGluZGV4LCBvbGRSb3dzLmxlbmd0aCkpO1xuICAgIH07XG5cbiAgICB2YXIgaW5zZXJ0Um93QXQgPSBmdW5jdGlvbiAoZ3JpZCwgaW5kZXgsIGV4YW1wbGUsIGNvbXBhcmF0b3IsIHN1YnN0aXR1dGlvbikge1xuICAgICAgdmFyIF9hID0gZXh0cmFjdEdyaWREZXRhaWxzKGdyaWQpLCByb3dzID0gX2Eucm93cywgY29scyA9IF9hLmNvbHM7XG4gICAgICB2YXIgYmVmb3JlID0gcm93cy5zbGljZSgwLCBpbmRleCk7XG4gICAgICB2YXIgYWZ0ZXIgPSByb3dzLnNsaWNlKGluZGV4KTtcbiAgICAgIHZhciBiZXR3ZWVuID0gbWFwQ2VsbHMocm93c1tleGFtcGxlXSwgZnVuY3Rpb24gKGV4LCBjKSB7XG4gICAgICAgIHZhciB3aXRoaW5TcGFuID0gaW5kZXggPiAwICYmIGluZGV4IDwgcm93cy5sZW5ndGggJiYgY29tcGFyYXRvcihnZXRDZWxsRWxlbWVudChyb3dzW2luZGV4IC0gMV0sIGMpLCBnZXRDZWxsRWxlbWVudChyb3dzW2luZGV4XSwgYykpO1xuICAgICAgICB2YXIgcmV0ID0gd2l0aGluU3BhbiA/IGdldENlbGwocm93c1tpbmRleF0sIGMpIDogZWxlbWVudG5ldyhzdWJzdGl0dXRpb24oZXguZWxlbWVudCwgY29tcGFyYXRvciksIHRydWUsIGV4LmlzTG9ja2VkKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbHMuY29uY2F0KGJlZm9yZSkuY29uY2F0KFtiZXR3ZWVuXSkuY29uY2F0KGFmdGVyKTtcbiAgICB9O1xuICAgIHZhciBnZXRFbGVtZW50Rm9yID0gZnVuY3Rpb24gKHJvdywgY29sdW1uLCBzZWN0aW9uLCB3aXRoaW5TcGFuLCBleGFtcGxlLCBjb21wYXJhdG9yLCBzdWJzdGl0dXRpb24pIHtcbiAgICAgIGlmIChzZWN0aW9uID09PSAnY29sZ3JvdXAnIHx8ICF3aXRoaW5TcGFuKSB7XG4gICAgICAgIHZhciBjZWxsID0gZ2V0Q2VsbChyb3csIGV4YW1wbGUpO1xuICAgICAgICByZXR1cm4gZWxlbWVudG5ldyhzdWJzdGl0dXRpb24oY2VsbC5lbGVtZW50LCBjb21wYXJhdG9yKSwgdHJ1ZSwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGdldENlbGwocm93LCBjb2x1bW4pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGluc2VydENvbHVtbkF0ID0gZnVuY3Rpb24gKGdyaWQsIGluZGV4LCBleGFtcGxlLCBjb21wYXJhdG9yLCBzdWJzdGl0dXRpb24pIHtcbiAgICAgIHJldHVybiBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICB2YXIgd2l0aGluU3BhbiA9IGluZGV4ID4gMCAmJiBpbmRleCA8IGNlbGxMZW5ndGgocm93KSAmJiBjb21wYXJhdG9yKGdldENlbGxFbGVtZW50KHJvdywgaW5kZXggLSAxKSwgZ2V0Q2VsbEVsZW1lbnQocm93LCBpbmRleCkpO1xuICAgICAgICB2YXIgc3ViID0gZ2V0RWxlbWVudEZvcihyb3csIGluZGV4LCByb3cuc2VjdGlvbiwgd2l0aGluU3BhbiwgZXhhbXBsZSwgY29tcGFyYXRvciwgc3Vic3RpdHV0aW9uKTtcbiAgICAgICAgcmV0dXJuIGFkZENlbGwocm93LCBpbmRleCwgc3ViKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRlbGV0ZUNvbHVtbnNBdCA9IGZ1bmN0aW9uIChncmlkLCBjb2x1bW5zKSB7XG4gICAgICByZXR1cm4gYmluZChncmlkLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIHZhciBleGlzdGluZ0NlbGxzID0gcm93LmNlbGxzO1xuICAgICAgICB2YXIgY2VsbHMgPSBmb2xkcihjb2x1bW5zLCBmdW5jdGlvbiAoYWNjLCBjb2x1bW4pIHtcbiAgICAgICAgICByZXR1cm4gY29sdW1uID49IDAgJiYgY29sdW1uIDwgYWNjLmxlbmd0aCA/IGFjYy5zbGljZSgwLCBjb2x1bW4pLmNvbmNhdChhY2Muc2xpY2UoY29sdW1uICsgMSkpIDogYWNjO1xuICAgICAgICB9LCBleGlzdGluZ0NlbGxzKTtcbiAgICAgICAgcmV0dXJuIGNlbGxzLmxlbmd0aCA+IDAgPyBbcm93Y2VsbHMoY2VsbHMsIHJvdy5zZWN0aW9uKV0gOiBbXTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGRlbGV0ZVJvd3NBdCA9IGZ1bmN0aW9uIChncmlkLCBzdGFydCwgZmluaXNoKSB7XG4gICAgICB2YXIgX2EgPSBleHRyYWN0R3JpZERldGFpbHMoZ3JpZCksIHJvd3MgPSBfYS5yb3dzLCBjb2xzID0gX2EuY29scztcbiAgICAgIHJldHVybiBjb2xzLmNvbmNhdChyb3dzLnNsaWNlKDAsIHN0YXJ0KSkuY29uY2F0KHJvd3Muc2xpY2UoZmluaXNoICsgMSkpO1xuICAgIH07XG5cbiAgICB2YXIgcmVwbGFjZUluID0gZnVuY3Rpb24gKGdyaWQsIHRhcmdldHMsIGNvbXBhcmF0b3IsIHN1YnN0aXR1dGlvbikge1xuICAgICAgdmFyIGlzVGFyZ2V0ID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0cyh0YXJnZXRzLCBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IoY2VsbC5lbGVtZW50LCB0YXJnZXQuZWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtYXAoZ3JpZCwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICByZXR1cm4gbWFwQ2VsbHMocm93LCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIHJldHVybiBpc1RhcmdldChjZWxsKSA/IGVsZW1lbnRuZXcoc3Vic3RpdHV0aW9uKGNlbGwuZWxlbWVudCwgY29tcGFyYXRvciksIHRydWUsIGNlbGwuaXNMb2NrZWQpIDogY2VsbDtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBub3RTdGFydFJvdyA9IGZ1bmN0aW9uIChncmlkLCByb3dJbmRleCwgY29sSW5kZXgsIGNvbXBhcmF0b3IpIHtcbiAgICAgIHJldHVybiBnZXRDZWxsRWxlbWVudChncmlkW3Jvd0luZGV4XSwgY29sSW5kZXgpICE9PSB1bmRlZmluZWQgJiYgKHJvd0luZGV4ID4gMCAmJiBjb21wYXJhdG9yKGdldENlbGxFbGVtZW50KGdyaWRbcm93SW5kZXggLSAxXSwgY29sSW5kZXgpLCBnZXRDZWxsRWxlbWVudChncmlkW3Jvd0luZGV4XSwgY29sSW5kZXgpKSk7XG4gICAgfTtcbiAgICB2YXIgbm90U3RhcnRDb2x1bW4gPSBmdW5jdGlvbiAocm93LCBpbmRleCwgY29tcGFyYXRvcikge1xuICAgICAgcmV0dXJuIGluZGV4ID4gMCAmJiBjb21wYXJhdG9yKGdldENlbGxFbGVtZW50KHJvdywgaW5kZXggLSAxKSwgZ2V0Q2VsbEVsZW1lbnQocm93LCBpbmRleCkpO1xuICAgIH07XG4gICAgdmFyIHJlcGxhY2VDb2x1bW4gPSBmdW5jdGlvbiAoZ3JpZCwgaW5kZXgsIGNvbXBhcmF0b3IsIHN1YnN0aXR1dGlvbikge1xuICAgICAgdmFyIHJvd3MgPSBleHRyYWN0R3JpZERldGFpbHMoZ3JpZCkucm93cztcbiAgICAgIHZhciB0YXJnZXRzID0gYmluZChyb3dzLCBmdW5jdGlvbiAocm93LCBpKSB7XG4gICAgICAgIHZhciBhbHJlYWR5QWRkZWQgPSBub3RTdGFydFJvdyhncmlkLCBpLCBpbmRleCwgY29tcGFyYXRvcikgfHwgbm90U3RhcnRDb2x1bW4ocm93LCBpbmRleCwgY29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiBhbHJlYWR5QWRkZWQgPyBbXSA6IFtnZXRDZWxsKHJvdywgaW5kZXgpXTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlcGxhY2VJbihncmlkLCB0YXJnZXRzLCBjb21wYXJhdG9yLCBzdWJzdGl0dXRpb24pO1xuICAgIH07XG4gICAgdmFyIHJlcGxhY2VSb3cgPSBmdW5jdGlvbiAoZ3JpZCwgaW5kZXgsIGNvbXBhcmF0b3IsIHN1YnN0aXR1dGlvbikge1xuICAgICAgdmFyIHJvd3MgPSBleHRyYWN0R3JpZERldGFpbHMoZ3JpZCkucm93cztcbiAgICAgIHZhciB0YXJnZXRSb3cgPSByb3dzW2luZGV4XTtcbiAgICAgIHZhciB0YXJnZXRzID0gYmluZCh0YXJnZXRSb3cuY2VsbHMsIGZ1bmN0aW9uIChpdGVtLCBpKSB7XG4gICAgICAgIHZhciBhbHJlYWR5QWRkZWQgPSBub3RTdGFydFJvdyhyb3dzLCBpbmRleCwgaSwgY29tcGFyYXRvcikgfHwgbm90U3RhcnRDb2x1bW4odGFyZ2V0Um93LCBpLCBjb21wYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIGFscmVhZHlBZGRlZCA/IFtdIDogW2l0ZW1dO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVwbGFjZUluKGdyaWQsIHRhcmdldHMsIGNvbXBhcmF0b3IsIHN1YnN0aXR1dGlvbik7XG4gICAgfTtcblxuICAgIHZhciB1bmlxdWVDb2x1bW5zID0gZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgIHZhciB1bmlxdWVDaGVjayA9IGZ1bmN0aW9uIChyZXN0LCBkZXRhaWwpIHtcbiAgICAgICAgdmFyIGNvbHVtbkV4aXN0cyA9IGV4aXN0cyhyZXN0LCBmdW5jdGlvbiAoY3VycmVudERldGFpbCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50RGV0YWlsLmNvbHVtbiA9PT0gZGV0YWlsLmNvbHVtbjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjb2x1bW5FeGlzdHMgPyByZXN0IDogcmVzdC5jb25jYXQoW2RldGFpbF0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmb2xkbChkZXRhaWxzLCB1bmlxdWVDaGVjaywgW10pLnNvcnQoZnVuY3Rpb24gKGRldGFpbEEsIGRldGFpbEIpIHtcbiAgICAgICAgcmV0dXJuIGRldGFpbEEuY29sdW1uIC0gZGV0YWlsQi5jb2x1bW47XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGVsZW1lbnRUb0RhdGEgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGNvbHNwYW4gPSBnZXRBdHRyVmFsdWUoZWxlbWVudCwgJ2NvbHNwYW4nLCAxKTtcbiAgICAgIHZhciByb3dzcGFuID0gZ2V0QXR0clZhbHVlKGVsZW1lbnQsICdyb3dzcGFuJywgMSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgICBjb2xzcGFuOiBjb2xzcGFuLFxuICAgICAgICByb3dzcGFuOiByb3dzcGFuXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1vZGlmaWNhdGlvbiA9IGZ1bmN0aW9uIChnZW5lcmF0b3JzLCB0b0RhdGEpIHtcbiAgICAgIGlmICh0b0RhdGEgPT09IHZvaWQgMCkge1xuICAgICAgICB0b0RhdGEgPSBlbGVtZW50VG9EYXRhO1xuICAgICAgfVxuICAgICAgdmFyIHBvc2l0aW9uID0gQ2VsbChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgdmFyIG51ID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgc3dpdGNoIChuYW1lKGRhdGEuZWxlbWVudCkpIHtcbiAgICAgICAgY2FzZSAnY29sJzpcbiAgICAgICAgICByZXR1cm4gZ2VuZXJhdG9ycy5jb2woZGF0YSk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGdlbmVyYXRvcnMuY2VsbChkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHZhciBudUZyb20gPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICB2YXIgZGF0YSA9IHRvRGF0YShlbGVtZW50KTtcbiAgICAgICAgcmV0dXJuIG51KGRhdGEpO1xuICAgICAgfTtcbiAgICAgIHZhciBhZGQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICB2YXIgcmVwbGFjZW1lbnQgPSBudUZyb20oZWxlbWVudCk7XG4gICAgICAgIGlmIChwb3NpdGlvbi5nZXQoKS5pc05vbmUoKSkge1xuICAgICAgICAgIHBvc2l0aW9uLnNldChPcHRpb25hbC5zb21lKHJlcGxhY2VtZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVjZW50ID0gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgICAgaXRlbTogZWxlbWVudCxcbiAgICAgICAgICByZXBsYWNlbWVudDogcmVwbGFjZW1lbnRcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXBsYWNlbWVudDtcbiAgICAgIH07XG4gICAgICB2YXIgcmVjZW50ID0gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIGdldE9ySW5pdCA9IGZ1bmN0aW9uIChlbGVtZW50LCBjb21wYXJhdG9yKSB7XG4gICAgICAgIHJldHVybiByZWNlbnQuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFkZChlbGVtZW50KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICByZXR1cm4gY29tcGFyYXRvcihlbGVtZW50LCBwLml0ZW0pID8gcC5yZXBsYWNlbWVudCA6IGFkZChlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0T3JJbml0OiBnZXRPckluaXQsXG4gICAgICAgIGN1cnNvcjogcG9zaXRpb24uZ2V0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHRyYW5zZm9ybSQxID0gZnVuY3Rpb24gKHNjb3BlLCB0YWcpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZ2VuZXJhdG9ycykge1xuICAgICAgICB2YXIgcG9zaXRpb24gPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICAgIHZhciBsaXN0ID0gW107XG4gICAgICAgIHZhciBmaW5kJDEgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29tcGFyYXRvcikge1xuICAgICAgICAgIHJldHVybiBmaW5kKGxpc3QsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcGFyYXRvcih4Lml0ZW0sIGVsZW1lbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgbWFrZU5ldyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgdmFyIGF0dHJzID0geyBzY29wZTogc2NvcGUgfTtcbiAgICAgICAgICB2YXIgY2VsbCA9IGdlbmVyYXRvcnMucmVwbGFjZShlbGVtZW50LCB0YWcsIGF0dHJzKTtcbiAgICAgICAgICBsaXN0LnB1c2goe1xuICAgICAgICAgICAgaXRlbTogZWxlbWVudCxcbiAgICAgICAgICAgIHN1YjogY2VsbFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmIChwb3NpdGlvbi5nZXQoKS5pc05vbmUoKSkge1xuICAgICAgICAgICAgcG9zaXRpb24uc2V0KE9wdGlvbmFsLnNvbWUoY2VsbCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY2VsbDtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHJlcGxhY2VPckluaXQgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29tcGFyYXRvcikge1xuICAgICAgICAgIGlmIChuYW1lKGVsZW1lbnQpID09PSAnY29sJykge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmaW5kJDEoZWxlbWVudCwgY29tcGFyYXRvcikuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYWtlTmV3KGVsZW1lbnQpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IoZWxlbWVudCwgcC5pdGVtKSA/IHAuc3ViIDogbWFrZU5ldyhlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByZXBsYWNlT3JJbml0OiByZXBsYWNlT3JJbml0LFxuICAgICAgICAgIGN1cnNvcjogcG9zaXRpb24uZ2V0XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldFNjb3BlQXR0cmlidXRlID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgIHJldHVybiBnZXRPcHQoY2VsbCwgJ3Njb3BlJykubWFwKGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHtcbiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5zdWJzdHIoMCwgMyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBtZXJnaW5nID0gZnVuY3Rpb24gKGdlbmVyYXRvcnMpIHtcbiAgICAgIHZhciBwb3NpdGlvbiA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciB1bm1lcmdlID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgaWYgKHBvc2l0aW9uLmdldCgpLmlzTm9uZSgpKSB7XG4gICAgICAgICAgcG9zaXRpb24uc2V0KE9wdGlvbmFsLnNvbWUoY2VsbCkpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzY29wZSA9IGdldFNjb3BlQXR0cmlidXRlKGNlbGwpO1xuICAgICAgICBzY29wZS5lYWNoKGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHtcbiAgICAgICAgICByZXR1cm4gc2V0KGNlbGwsICdzY29wZScsIGF0dHJpYnV0ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciByYXcgPSBnZW5lcmF0b3JzLmNlbGwoe1xuICAgICAgICAgICAgZWxlbWVudDogY2VsbCxcbiAgICAgICAgICAgIGNvbHNwYW46IDEsXG4gICAgICAgICAgICByb3dzcGFuOiAxXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmVtb3ZlJDEocmF3LCAnd2lkdGgnKTtcbiAgICAgICAgICByZW1vdmUkMShjZWxsLCAnd2lkdGgnKTtcbiAgICAgICAgICBzY29wZS5lYWNoKGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXQocmF3LCAnc2NvcGUnLCBhdHRyaWJ1dGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiByYXc7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIG1lcmdlID0gZnVuY3Rpb24gKGNlbGxzKSB7XG4gICAgICAgIHZhciBnZXRTY29wZVByb3BlcnR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBzdHJpbmdBdHRyaWJ1dGVzID0gY2F0KG1hcChjZWxscywgZ2V0U2NvcGVBdHRyaWJ1dGUpKTtcbiAgICAgICAgICBpZiAoc3RyaW5nQXR0cmlidXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBiYXNlU2NvcGVfMSA9IHN0cmluZ0F0dHJpYnV0ZXNbMF07XG4gICAgICAgICAgICB2YXIgc2NvcGVzXzEgPSBbXG4gICAgICAgICAgICAgICdyb3cnLFxuICAgICAgICAgICAgICAnY29sJ1xuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZhciBpc01peGVkID0gZXhpc3RzKHN0cmluZ0F0dHJpYnV0ZXMsIGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZSAhPT0gYmFzZVNjb3BlXzEgJiYgY29udGFpbnMoc2NvcGVzXzEsIGF0dHJpYnV0ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBpc01peGVkID8gT3B0aW9uYWwubm9uZSgpIDogT3B0aW9uYWwuZnJvbShiYXNlU2NvcGVfMSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZW1vdmUkMShjZWxsc1swXSwgJ3dpZHRoJyk7XG4gICAgICAgIGdldFNjb3BlUHJvcGVydHkoKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gcmVtb3ZlKGNlbGxzWzBdLCAnc2NvcGUnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGF0dHJpYnV0ZSkge1xuICAgICAgICAgIHJldHVybiBzZXQoY2VsbHNbMF0sICdzY29wZScsIGF0dHJpYnV0ZSArICdncm91cCcpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvbnN0YW50KGNlbGxzWzBdKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1bm1lcmdlOiB1bm1lcmdlLFxuICAgICAgICBtZXJnZTogbWVyZ2UsXG4gICAgICAgIGN1cnNvcjogcG9zaXRpb24uZ2V0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIEdlbmVyYXRvcnMgPSB7XG4gICAgICBtb2RpZmljYXRpb246IG1vZGlmaWNhdGlvbixcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtJDEsXG4gICAgICBtZXJnaW5nOiBtZXJnaW5nXG4gICAgfTtcblxuICAgIHZhciBibG9ja0xpc3QgPSBbXG4gICAgICAnYm9keScsXG4gICAgICAncCcsXG4gICAgICAnZGl2JyxcbiAgICAgICdhcnRpY2xlJyxcbiAgICAgICdhc2lkZScsXG4gICAgICAnZmlnY2FwdGlvbicsXG4gICAgICAnZmlndXJlJyxcbiAgICAgICdmb290ZXInLFxuICAgICAgJ2hlYWRlcicsXG4gICAgICAnbmF2JyxcbiAgICAgICdzZWN0aW9uJyxcbiAgICAgICdvbCcsXG4gICAgICAndWwnLFxuICAgICAgJ3RhYmxlJyxcbiAgICAgICd0aGVhZCcsXG4gICAgICAndGZvb3QnLFxuICAgICAgJ3Rib2R5JyxcbiAgICAgICdjYXB0aW9uJyxcbiAgICAgICd0cicsXG4gICAgICAndGQnLFxuICAgICAgJ3RoJyxcbiAgICAgICdoMScsXG4gICAgICAnaDInLFxuICAgICAgJ2gzJyxcbiAgICAgICdoNCcsXG4gICAgICAnaDUnLFxuICAgICAgJ2g2JyxcbiAgICAgICdibG9ja3F1b3RlJyxcbiAgICAgICdwcmUnLFxuICAgICAgJ2FkZHJlc3MnXG4gICAgXTtcbiAgICB2YXIgaXNMaXN0ID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBpdGVtKSB7XG4gICAgICB2YXIgdGFnTmFtZSA9IHVuaXZlcnNlLnByb3BlcnR5KCkubmFtZShpdGVtKTtcbiAgICAgIHJldHVybiBjb250YWlucyhbXG4gICAgICAgICdvbCcsXG4gICAgICAgICd1bCdcbiAgICAgIF0sIHRhZ05hbWUpO1xuICAgIH07XG4gICAgdmFyIGlzQmxvY2sgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0pIHtcbiAgICAgIHZhciB0YWdOYW1lID0gdW5pdmVyc2UucHJvcGVydHkoKS5uYW1lKGl0ZW0pO1xuICAgICAgcmV0dXJuIGNvbnRhaW5zKGJsb2NrTGlzdCwgdGFnTmFtZSk7XG4gICAgfTtcbiAgICB2YXIgaXNFbXB0eVRhZyA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgaXRlbSkge1xuICAgICAgcmV0dXJuIGNvbnRhaW5zKFtcbiAgICAgICAgJ2JyJyxcbiAgICAgICAgJ2ltZycsXG4gICAgICAgICdocicsXG4gICAgICAgICdpbnB1dCdcbiAgICAgIF0sIHVuaXZlcnNlLnByb3BlcnR5KCkubmFtZShpdGVtKSk7XG4gICAgfTtcblxuICAgIHZhciB1bml2ZXJzZSQyID0gRG9tVW5pdmVyc2UoKTtcbiAgICB2YXIgaXNCbG9jayQxID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBpc0Jsb2NrKHVuaXZlcnNlJDIsIGVsZW1lbnQpO1xuICAgIH07XG4gICAgdmFyIGlzTGlzdCQxID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBpc0xpc3QodW5pdmVyc2UkMiwgZWxlbWVudCk7XG4gICAgfTtcbiAgICB2YXIgaXNFbXB0eVRhZyQxID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBpc0VtcHR5VGFnKHVuaXZlcnNlJDIsIGVsZW1lbnQpO1xuICAgIH07XG5cbiAgICB2YXIgbWVyZ2UkMiA9IGZ1bmN0aW9uIChjZWxscykge1xuICAgICAgdmFyIGlzQnIgPSBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgcmV0dXJuIG5hbWUoZWwpID09PSAnYnInO1xuICAgICAgfTtcbiAgICAgIHZhciBhZHZhbmNlZEJyID0gZnVuY3Rpb24gKGNoaWxkcmVuKSB7XG4gICAgICAgIHJldHVybiBmb3JhbGwoY2hpbGRyZW4sIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgcmV0dXJuIGlzQnIoYykgfHwgaXNUZXh0KGMpICYmIGdldCQ0KGMpLnRyaW0oKS5sZW5ndGggPT09IDA7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBpc0xpc3RJdGVtID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBuYW1lKGVsKSA9PT0gJ2xpJyB8fCBhbmNlc3RvcihlbCwgaXNMaXN0JDEpLmlzU29tZSgpO1xuICAgICAgfTtcbiAgICAgIHZhciBzaWJsaW5nSXNCbG9jayA9IGZ1bmN0aW9uIChlbCkge1xuICAgICAgICByZXR1cm4gbmV4dFNpYmxpbmcoZWwpLm1hcChmdW5jdGlvbiAocmlnaHRTaWJsaW5nKSB7XG4gICAgICAgICAgaWYgKGlzQmxvY2skMShyaWdodFNpYmxpbmcpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGlzRW1wdHlUYWckMShyaWdodFNpYmxpbmcpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmFtZShyaWdodFNpYmxpbmcpID09PSAnaW1nJyA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KS5nZXRPcihmYWxzZSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1hcmtDZWxsID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGxhc3QkMShjZWxsKS5iaW5kKGZ1bmN0aW9uIChyaWdodEVkZ2UpIHtcbiAgICAgICAgICB2YXIgcmlnaHRTaWJsaW5nSXNCbG9jayA9IHNpYmxpbmdJc0Jsb2NrKHJpZ2h0RWRnZSk7XG4gICAgICAgICAgcmV0dXJuIHBhcmVudChyaWdodEVkZ2UpLm1hcChmdW5jdGlvbiAocGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gcmlnaHRTaWJsaW5nSXNCbG9jayA9PT0gdHJ1ZSB8fCBpc0xpc3RJdGVtKHBhcmVudCkgfHwgaXNCcihyaWdodEVkZ2UpIHx8IGlzQmxvY2skMShwYXJlbnQpICYmICFlcSQxKGNlbGwsIHBhcmVudCkgPyBbXSA6IFtTdWdhckVsZW1lbnQuZnJvbVRhZygnYnInKV07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLmdldE9yKFtdKTtcbiAgICAgIH07XG4gICAgICB2YXIgbWFya0NvbnRlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb250ZW50ID0gYmluZChjZWxscywgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICB2YXIgY2hpbGRyZW4kMSA9IGNoaWxkcmVuKGNlbGwpO1xuICAgICAgICAgIHJldHVybiBhZHZhbmNlZEJyKGNoaWxkcmVuJDEpID8gW10gOiBjaGlsZHJlbiQxLmNvbmNhdChtYXJrQ2VsbChjZWxsKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY29udGVudC5sZW5ndGggPT09IDAgPyBbU3VnYXJFbGVtZW50LmZyb21UYWcoJ2JyJyldIDogY29udGVudDtcbiAgICAgIH07XG4gICAgICB2YXIgY29udGVudHMgPSBtYXJrQ29udGVudCgpO1xuICAgICAgZW1wdHkoY2VsbHNbMF0pO1xuICAgICAgYXBwZW5kJDEoY2VsbHNbMF0sIGNvbnRlbnRzKTtcbiAgICB9O1xuXG4gICAgdmFyIHBydW5lID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICB2YXIgY2VsbHMkMSA9IGNlbGxzKHRhYmxlKTtcbiAgICAgIGlmIChjZWxscyQxLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZW1vdmUkMih0YWJsZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgb3V0Y29tZSA9IGZ1bmN0aW9uIChncmlkLCBjdXJzb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGdyaWQ6IGdyaWQsXG4gICAgICAgIGN1cnNvcjogY3Vyc29yXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGVsZW1lbnRGcm9tR3JpZCA9IGZ1bmN0aW9uIChncmlkLCByb3csIGNvbHVtbikge1xuICAgICAgdmFyIHJvd3MgPSBleHRyYWN0R3JpZERldGFpbHMoZ3JpZCkucm93cztcbiAgICAgIHJldHVybiBmaW5kSW4ocm93cywgcm93LCBjb2x1bW4pLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmluZEluKHJvd3MsIDAsIDApO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZmluZEluID0gZnVuY3Rpb24gKGdyaWQsIHJvdywgY29sdW1uKSB7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuZnJvbShncmlkW3Jvd10pLmJpbmQoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oci5jZWxsc1tjb2x1bW5dKS5iaW5kKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLmZyb20oYy5lbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBidW5kbGUgPSBmdW5jdGlvbiAoZ3JpZCwgcm93LCBjb2x1bW4pIHtcbiAgICAgIHZhciByb3dzID0gZXh0cmFjdEdyaWREZXRhaWxzKGdyaWQpLnJvd3M7XG4gICAgICByZXR1cm4gb3V0Y29tZShncmlkLCBmaW5kSW4ocm93cywgcm93LCBjb2x1bW4pKTtcbiAgICB9O1xuICAgIHZhciB1bmlxdWVSb3dzID0gZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgIHZhciByb3dDb21waWxhdGlvbiA9IGZ1bmN0aW9uIChyZXN0LCBkZXRhaWwpIHtcbiAgICAgICAgdmFyIHJvd0V4aXN0cyA9IGV4aXN0cyhyZXN0LCBmdW5jdGlvbiAoY3VycmVudERldGFpbCkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50RGV0YWlsLnJvdyA9PT0gZGV0YWlsLnJvdztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByb3dFeGlzdHMgPyByZXN0IDogcmVzdC5jb25jYXQoW2RldGFpbF0pO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmb2xkbChkZXRhaWxzLCByb3dDb21waWxhdGlvbiwgW10pLnNvcnQoZnVuY3Rpb24gKGRldGFpbEEsIGRldGFpbEIpIHtcbiAgICAgICAgcmV0dXJuIGRldGFpbEEucm93IC0gZGV0YWlsQi5yb3c7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBvcEluc2VydFJvd3NCZWZvcmUgPSBmdW5jdGlvbiAoZ3JpZCwgZGV0YWlscywgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciB0YXJnZXRJbmRleCA9IGRldGFpbHNbMF0ucm93O1xuICAgICAgdmFyIHJvd3MgPSB1bmlxdWVSb3dzKGRldGFpbHMpO1xuICAgICAgdmFyIG5ld0dyaWQgPSBmb2xkcihyb3dzLCBmdW5jdGlvbiAoYWNjLCByb3cpIHtcbiAgICAgICAgdmFyIG5ld0cgPSBpbnNlcnRSb3dBdChhY2MuZ3JpZCwgdGFyZ2V0SW5kZXgsIHJvdy5yb3cgKyBhY2MuZGVsdGEsIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzLmdldE9ySW5pdCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ3JpZDogbmV3RyxcbiAgICAgICAgICBkZWx0YTogYWNjLmRlbHRhICsgMVxuICAgICAgICB9O1xuICAgICAgfSwge1xuICAgICAgICBncmlkOiBncmlkLFxuICAgICAgICBkZWx0YTogMFxuICAgICAgfSkuZ3JpZDtcbiAgICAgIHJldHVybiBidW5kbGUobmV3R3JpZCwgdGFyZ2V0SW5kZXgsIGRldGFpbHNbMF0uY29sdW1uKTtcbiAgICB9O1xuICAgIHZhciBvcEluc2VydFJvd3NBZnRlciA9IGZ1bmN0aW9uIChncmlkLCBkZXRhaWxzLCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycykge1xuICAgICAgdmFyIHJvd3MgPSB1bmlxdWVSb3dzKGRldGFpbHMpO1xuICAgICAgdmFyIHRhcmdldCA9IHJvd3Nbcm93cy5sZW5ndGggLSAxXTtcbiAgICAgIHZhciB0YXJnZXRJbmRleCA9IHRhcmdldC5yb3cgKyB0YXJnZXQucm93c3BhbjtcbiAgICAgIHZhciBuZXdHcmlkID0gZm9sZHIocm93cywgZnVuY3Rpb24gKG5ld0csIHJvdykge1xuICAgICAgICByZXR1cm4gaW5zZXJ0Um93QXQobmV3RywgdGFyZ2V0SW5kZXgsIHJvdy5yb3csIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzLmdldE9ySW5pdCk7XG4gICAgICB9LCBncmlkKTtcbiAgICAgIHJldHVybiBidW5kbGUobmV3R3JpZCwgdGFyZ2V0SW5kZXgsIGRldGFpbHNbMF0uY29sdW1uKTtcbiAgICB9O1xuICAgIHZhciBvcEluc2VydENvbHVtbnNCZWZvcmUgPSBmdW5jdGlvbiAoZ3JpZCwgZXh0cmFjdERldGFpbCwgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciBkZXRhaWxzID0gZXh0cmFjdERldGFpbC5kZXRhaWxzO1xuICAgICAgdmFyIGNvbHVtbnMgPSB1bmlxdWVDb2x1bW5zKGRldGFpbHMpO1xuICAgICAgdmFyIHRhcmdldEluZGV4ID0gY29sdW1uc1swXS5jb2x1bW47XG4gICAgICB2YXIgbmV3R3JpZCA9IGZvbGRyKGNvbHVtbnMsIGZ1bmN0aW9uIChhY2MsIGNvbCkge1xuICAgICAgICB2YXIgbmV3RyA9IGluc2VydENvbHVtbkF0KGFjYy5ncmlkLCB0YXJnZXRJbmRleCwgY29sLmNvbHVtbiArIGFjYy5kZWx0YSwgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMuZ2V0T3JJbml0KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBncmlkOiBuZXdHLFxuICAgICAgICAgIGRlbHRhOiBhY2MuZGVsdGEgKyAxXG4gICAgICAgIH07XG4gICAgICB9LCB7XG4gICAgICAgIGdyaWQ6IGdyaWQsXG4gICAgICAgIGRlbHRhOiAwXG4gICAgICB9KS5ncmlkO1xuICAgICAgcmV0dXJuIGJ1bmRsZShuZXdHcmlkLCBkZXRhaWxzWzBdLnJvdywgdGFyZ2V0SW5kZXgpO1xuICAgIH07XG4gICAgdmFyIG9wSW5zZXJ0Q29sdW1uc0FmdGVyID0gZnVuY3Rpb24gKGdyaWQsIGV4dHJhY3REZXRhaWwsIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgZGV0YWlscyA9IGV4dHJhY3REZXRhaWwuZGV0YWlscztcbiAgICAgIHZhciB0YXJnZXQgPSBkZXRhaWxzW2RldGFpbHMubGVuZ3RoIC0gMV07XG4gICAgICB2YXIgdGFyZ2V0SW5kZXggPSB0YXJnZXQuY29sdW1uICsgdGFyZ2V0LmNvbHNwYW47XG4gICAgICB2YXIgY29sdW1ucyA9IHVuaXF1ZUNvbHVtbnMoZGV0YWlscyk7XG4gICAgICB2YXIgbmV3R3JpZCA9IGZvbGRyKGNvbHVtbnMsIGZ1bmN0aW9uIChuZXdHLCBjb2wpIHtcbiAgICAgICAgcmV0dXJuIGluc2VydENvbHVtbkF0KG5ld0csIHRhcmdldEluZGV4LCBjb2wuY29sdW1uLCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycy5nZXRPckluaXQpO1xuICAgICAgfSwgZ3JpZCk7XG4gICAgICByZXR1cm4gYnVuZGxlKG5ld0dyaWQsIGRldGFpbHNbMF0ucm93LCB0YXJnZXRJbmRleCk7XG4gICAgfTtcbiAgICB2YXIgb3BNYWtlUm93SGVhZGVyID0gZnVuY3Rpb24gKGdyaWQsIGRldGFpbCwgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciBuZXdHcmlkID0gcmVwbGFjZVJvdyhncmlkLCBkZXRhaWwucm93LCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycy5yZXBsYWNlT3JJbml0KTtcbiAgICAgIHJldHVybiBidW5kbGUobmV3R3JpZCwgZGV0YWlsLnJvdywgZGV0YWlsLmNvbHVtbik7XG4gICAgfTtcbiAgICB2YXIgb3BNYWtlUm93c0hlYWRlciA9IGZ1bmN0aW9uIChpbml0aWFsR3JpZCwgZGV0YWlscywgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciByb3dzID0gdW5pcXVlUm93cyhkZXRhaWxzKTtcbiAgICAgIHZhciByZXBsYWNlciA9IGZ1bmN0aW9uIChjdXJyZW50R3JpZCwgcm93KSB7XG4gICAgICAgIHJldHVybiByZXBsYWNlUm93KGN1cnJlbnRHcmlkLCByb3cucm93LCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycy5yZXBsYWNlT3JJbml0KTtcbiAgICAgIH07XG4gICAgICB2YXIgbmV3R3JpZCA9IGZvbGRsKHJvd3MsIHJlcGxhY2VyLCBpbml0aWFsR3JpZCk7XG4gICAgICByZXR1cm4gYnVuZGxlKG5ld0dyaWQsIGRldGFpbHNbMF0ucm93LCBkZXRhaWxzWzBdLmNvbHVtbik7XG4gICAgfTtcbiAgICB2YXIgb3BNYWtlQ29sdW1uSGVhZGVyID0gZnVuY3Rpb24gKGluaXRpYWxHcmlkLCBkZXRhaWwsIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgbmV3R3JpZCA9IHJlcGxhY2VDb2x1bW4oaW5pdGlhbEdyaWQsIGRldGFpbC5jb2x1bW4sIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzLnJlcGxhY2VPckluaXQpO1xuICAgICAgcmV0dXJuIGJ1bmRsZShuZXdHcmlkLCBkZXRhaWwucm93LCBkZXRhaWwuY29sdW1uKTtcbiAgICB9O1xuICAgIHZhciBvcE1ha2VDb2x1bW5zSGVhZGVyID0gZnVuY3Rpb24gKGluaXRpYWxHcmlkLCBkZXRhaWxzLCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycykge1xuICAgICAgdmFyIGNvbHVtbnMgPSB1bmlxdWVDb2x1bW5zKGRldGFpbHMpO1xuICAgICAgdmFyIHJlcGxhY2VyID0gZnVuY3Rpb24gKGN1cnJlbnRHcmlkLCBjb2x1bW4pIHtcbiAgICAgICAgcmV0dXJuIHJlcGxhY2VDb2x1bW4oY3VycmVudEdyaWQsIGNvbHVtbi5jb2x1bW4sIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzLnJlcGxhY2VPckluaXQpO1xuICAgICAgfTtcbiAgICAgIHZhciBuZXdHcmlkID0gZm9sZGwoY29sdW1ucywgcmVwbGFjZXIsIGluaXRpYWxHcmlkKTtcbiAgICAgIHJldHVybiBidW5kbGUobmV3R3JpZCwgZGV0YWlsc1swXS5yb3csIGRldGFpbHNbMF0uY29sdW1uKTtcbiAgICB9O1xuICAgIHZhciBvcFVubWFrZVJvd0hlYWRlciA9IGZ1bmN0aW9uIChncmlkLCBkZXRhaWwsIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgbmV3R3JpZCA9IHJlcGxhY2VSb3coZ3JpZCwgZGV0YWlsLnJvdywgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMucmVwbGFjZU9ySW5pdCk7XG4gICAgICByZXR1cm4gYnVuZGxlKG5ld0dyaWQsIGRldGFpbC5yb3csIGRldGFpbC5jb2x1bW4pO1xuICAgIH07XG4gICAgdmFyIG9wVW5tYWtlUm93c0hlYWRlciA9IGZ1bmN0aW9uIChpbml0aWFsR3JpZCwgZGV0YWlscywgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciByb3dzID0gdW5pcXVlUm93cyhkZXRhaWxzKTtcbiAgICAgIHZhciByZXBsYWNlciA9IGZ1bmN0aW9uIChjdXJyZW50R3JpZCwgcm93KSB7XG4gICAgICAgIHJldHVybiByZXBsYWNlUm93KGN1cnJlbnRHcmlkLCByb3cucm93LCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycy5yZXBsYWNlT3JJbml0KTtcbiAgICAgIH07XG4gICAgICB2YXIgbmV3R3JpZCA9IGZvbGRsKHJvd3MsIHJlcGxhY2VyLCBpbml0aWFsR3JpZCk7XG4gICAgICByZXR1cm4gYnVuZGxlKG5ld0dyaWQsIGRldGFpbHNbMF0ucm93LCBkZXRhaWxzWzBdLmNvbHVtbik7XG4gICAgfTtcbiAgICB2YXIgb3BVbm1ha2VDb2x1bW5IZWFkZXIgPSBmdW5jdGlvbiAoaW5pdGlhbEdyaWQsIGRldGFpbCwgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciBuZXdHcmlkID0gcmVwbGFjZUNvbHVtbihpbml0aWFsR3JpZCwgZGV0YWlsLmNvbHVtbiwgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMucmVwbGFjZU9ySW5pdCk7XG4gICAgICByZXR1cm4gYnVuZGxlKG5ld0dyaWQsIGRldGFpbC5yb3csIGRldGFpbC5jb2x1bW4pO1xuICAgIH07XG4gICAgdmFyIG9wVW5tYWtlQ29sdW1uc0hlYWRlciA9IGZ1bmN0aW9uIChpbml0aWFsR3JpZCwgZGV0YWlscywgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciBjb2x1bW5zID0gdW5pcXVlQ29sdW1ucyhkZXRhaWxzKTtcbiAgICAgIHZhciByZXBsYWNlciA9IGZ1bmN0aW9uIChjdXJyZW50R3JpZCwgY29sdW1uKSB7XG4gICAgICAgIHJldHVybiByZXBsYWNlQ29sdW1uKGN1cnJlbnRHcmlkLCBjb2x1bW4uY29sdW1uLCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycy5yZXBsYWNlT3JJbml0KTtcbiAgICAgIH07XG4gICAgICB2YXIgbmV3R3JpZCA9IGZvbGRsKGNvbHVtbnMsIHJlcGxhY2VyLCBpbml0aWFsR3JpZCk7XG4gICAgICByZXR1cm4gYnVuZGxlKG5ld0dyaWQsIGRldGFpbHNbMF0ucm93LCBkZXRhaWxzWzBdLmNvbHVtbik7XG4gICAgfTtcbiAgICB2YXIgb3BFcmFzZUNvbHVtbnMgPSBmdW5jdGlvbiAoZ3JpZCwgZXh0cmFjdERldGFpbCwgX2NvbXBhcmF0b3IsIF9nZW5XcmFwcGVycykge1xuICAgICAgdmFyIGNvbHVtbnMgPSB1bmlxdWVDb2x1bW5zKGV4dHJhY3REZXRhaWwuZGV0YWlscyk7XG4gICAgICB2YXIgbmV3R3JpZCA9IGRlbGV0ZUNvbHVtbnNBdChncmlkLCBtYXAoY29sdW1ucywgZnVuY3Rpb24gKGNvbHVtbikge1xuICAgICAgICByZXR1cm4gY29sdW1uLmNvbHVtbjtcbiAgICAgIH0pKTtcbiAgICAgIHZhciBjdXJzb3IgPSBlbGVtZW50RnJvbUdyaWQobmV3R3JpZCwgY29sdW1uc1swXS5yb3csIGNvbHVtbnNbMF0uY29sdW1uKTtcbiAgICAgIHJldHVybiBvdXRjb21lKG5ld0dyaWQsIGN1cnNvcik7XG4gICAgfTtcbiAgICB2YXIgb3BFcmFzZVJvd3MgPSBmdW5jdGlvbiAoZ3JpZCwgZGV0YWlscywgX2NvbXBhcmF0b3IsIF9nZW5XcmFwcGVycykge1xuICAgICAgdmFyIHJvd3MgPSB1bmlxdWVSb3dzKGRldGFpbHMpO1xuICAgICAgdmFyIG5ld0dyaWQgPSBkZWxldGVSb3dzQXQoZ3JpZCwgcm93c1swXS5yb3csIHJvd3Nbcm93cy5sZW5ndGggLSAxXS5yb3cpO1xuICAgICAgdmFyIGN1cnNvciA9IGVsZW1lbnRGcm9tR3JpZChuZXdHcmlkLCBkZXRhaWxzWzBdLnJvdywgZGV0YWlsc1swXS5jb2x1bW4pO1xuICAgICAgcmV0dXJuIG91dGNvbWUobmV3R3JpZCwgY3Vyc29yKTtcbiAgICB9O1xuICAgIHZhciBvcE1lcmdlQ2VsbHMgPSBmdW5jdGlvbiAoZ3JpZCwgbWVyZ2FibGUsIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgY2VsbHMgPSBtZXJnYWJsZS5jZWxscztcbiAgICAgIG1lcmdlJDIoY2VsbHMpO1xuICAgICAgdmFyIG5ld0dyaWQgPSBtZXJnZShncmlkLCBtZXJnYWJsZS5ib3VuZHMsIGNvbXBhcmF0b3IsIGdlbldyYXBwZXJzLm1lcmdlKGNlbGxzKSk7XG4gICAgICByZXR1cm4gb3V0Y29tZShuZXdHcmlkLCBPcHRpb25hbC5mcm9tKGNlbGxzWzBdKSk7XG4gICAgfTtcbiAgICB2YXIgb3BVbm1lcmdlQ2VsbHMgPSBmdW5jdGlvbiAoZ3JpZCwgdW5tZXJnYWJsZSwgY29tcGFyYXRvciwgZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciB1bm1lcmdlJDEgPSBmdW5jdGlvbiAoYiwgY2VsbCkge1xuICAgICAgICByZXR1cm4gdW5tZXJnZShiLCBjZWxsLCBjb21wYXJhdG9yLCBnZW5XcmFwcGVycy51bm1lcmdlKGNlbGwpKTtcbiAgICAgIH07XG4gICAgICB2YXIgbmV3R3JpZCA9IGZvbGRyKHVubWVyZ2FibGUsIHVubWVyZ2UkMSwgZ3JpZCk7XG4gICAgICByZXR1cm4gb3V0Y29tZShuZXdHcmlkLCBPcHRpb25hbC5mcm9tKHVubWVyZ2FibGVbMF0pKTtcbiAgICB9O1xuICAgIHZhciBvcFBhc3RlQ2VsbHMgPSBmdW5jdGlvbiAoZ3JpZCwgcGFzdGVEZXRhaWxzLCBjb21wYXJhdG9yLCBfZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciBncmlkaWZ5ID0gZnVuY3Rpb24gKHRhYmxlLCBnZW5lcmF0b3JzKSB7XG4gICAgICAgIHZhciB3aCA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgICByZXR1cm4gdG9HcmlkKHdoLCBnZW5lcmF0b3JzLCB0cnVlKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ3JpZEIgPSBncmlkaWZ5KHBhc3RlRGV0YWlscy5jbGlwYm9hcmQsIHBhc3RlRGV0YWlscy5nZW5lcmF0b3JzKTtcbiAgICAgIHZhciBzdGFydEFkZHJlc3MgPSBhZGRyZXNzKHBhc3RlRGV0YWlscy5yb3csIHBhc3RlRGV0YWlscy5jb2x1bW4pO1xuICAgICAgdmFyIG1lcmdlZEdyaWQgPSBtZXJnZSQxKHN0YXJ0QWRkcmVzcywgZ3JpZCwgZ3JpZEIsIHBhc3RlRGV0YWlscy5nZW5lcmF0b3JzLCBjb21wYXJhdG9yKTtcbiAgICAgIHJldHVybiBtZXJnZWRHcmlkLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gb3V0Y29tZShncmlkLCBPcHRpb25hbC5zb21lKHBhc3RlRGV0YWlscy5lbGVtZW50KSk7XG4gICAgICB9LCBmdW5jdGlvbiAobmV3R3JpZCkge1xuICAgICAgICB2YXIgY3Vyc29yID0gZWxlbWVudEZyb21HcmlkKG5ld0dyaWQsIHBhc3RlRGV0YWlscy5yb3csIHBhc3RlRGV0YWlscy5jb2x1bW4pO1xuICAgICAgICByZXR1cm4gb3V0Y29tZShuZXdHcmlkLCBjdXJzb3IpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ3JpZGlmeVJvd3MgPSBmdW5jdGlvbiAocm93cywgZ2VuZXJhdG9ycywgY29udGV4dCkge1xuICAgICAgdmFyIHBhc3RlRGV0YWlscyA9IGZyb21QYXN0ZWRSb3dzKHJvd3MsIGNvbnRleHQuc2VjdGlvbik7XG4gICAgICB2YXIgd2ggPSBXYXJlaG91c2UuZ2VuZXJhdGUocGFzdGVEZXRhaWxzKTtcbiAgICAgIHJldHVybiB0b0dyaWQod2gsIGdlbmVyYXRvcnMsIHRydWUpO1xuICAgIH07XG4gICAgdmFyIG9wUGFzdGVDb2xzQmVmb3JlID0gZnVuY3Rpb24gKGdyaWQsIHBhc3RlRGV0YWlscywgY29tcGFyYXRvciwgX2dlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgcm93cyA9IGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzO1xuICAgICAgdmFyIGluZGV4ID0gcGFzdGVEZXRhaWxzLmNlbGxzWzBdLmNvbHVtbjtcbiAgICAgIHZhciBjb250ZXh0ID0gcm93c1twYXN0ZURldGFpbHMuY2VsbHNbMF0ucm93XTtcbiAgICAgIHZhciBncmlkQiA9IGdyaWRpZnlSb3dzKHBhc3RlRGV0YWlscy5jbGlwYm9hcmQsIHBhc3RlRGV0YWlscy5nZW5lcmF0b3JzLCBjb250ZXh0KTtcbiAgICAgIHZhciBtZXJnZWRHcmlkID0gaW5zZXJ0Q29scyhpbmRleCwgZ3JpZCwgZ3JpZEIsIHBhc3RlRGV0YWlscy5nZW5lcmF0b3JzLCBjb21wYXJhdG9yKTtcbiAgICAgIHZhciBjdXJzb3IgPSBlbGVtZW50RnJvbUdyaWQobWVyZ2VkR3JpZCwgcGFzdGVEZXRhaWxzLmNlbGxzWzBdLnJvdywgcGFzdGVEZXRhaWxzLmNlbGxzWzBdLmNvbHVtbik7XG4gICAgICByZXR1cm4gb3V0Y29tZShtZXJnZWRHcmlkLCBjdXJzb3IpO1xuICAgIH07XG4gICAgdmFyIG9wUGFzdGVDb2xzQWZ0ZXIgPSBmdW5jdGlvbiAoZ3JpZCwgcGFzdGVEZXRhaWxzLCBjb21wYXJhdG9yLCBfZ2VuV3JhcHBlcnMpIHtcbiAgICAgIHZhciByb3dzID0gZXh0cmFjdEdyaWREZXRhaWxzKGdyaWQpLnJvd3M7XG4gICAgICB2YXIgaW5kZXggPSBwYXN0ZURldGFpbHMuY2VsbHNbcGFzdGVEZXRhaWxzLmNlbGxzLmxlbmd0aCAtIDFdLmNvbHVtbiArIHBhc3RlRGV0YWlscy5jZWxsc1twYXN0ZURldGFpbHMuY2VsbHMubGVuZ3RoIC0gMV0uY29sc3BhbjtcbiAgICAgIHZhciBjb250ZXh0ID0gcm93c1twYXN0ZURldGFpbHMuY2VsbHNbMF0ucm93XTtcbiAgICAgIHZhciBncmlkQiA9IGdyaWRpZnlSb3dzKHBhc3RlRGV0YWlscy5jbGlwYm9hcmQsIHBhc3RlRGV0YWlscy5nZW5lcmF0b3JzLCBjb250ZXh0KTtcbiAgICAgIHZhciBtZXJnZWRHcmlkID0gaW5zZXJ0Q29scyhpbmRleCwgZ3JpZCwgZ3JpZEIsIHBhc3RlRGV0YWlscy5nZW5lcmF0b3JzLCBjb21wYXJhdG9yKTtcbiAgICAgIHZhciBjdXJzb3IgPSBlbGVtZW50RnJvbUdyaWQobWVyZ2VkR3JpZCwgcGFzdGVEZXRhaWxzLmNlbGxzWzBdLnJvdywgcGFzdGVEZXRhaWxzLmNlbGxzWzBdLmNvbHVtbik7XG4gICAgICByZXR1cm4gb3V0Y29tZShtZXJnZWRHcmlkLCBjdXJzb3IpO1xuICAgIH07XG4gICAgdmFyIG9wUGFzdGVSb3dzQmVmb3JlID0gZnVuY3Rpb24gKGdyaWQsIHBhc3RlRGV0YWlscywgY29tcGFyYXRvciwgX2dlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgcm93cyA9IGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzO1xuICAgICAgdmFyIGluZGV4ID0gcGFzdGVEZXRhaWxzLmNlbGxzWzBdLnJvdztcbiAgICAgIHZhciBjb250ZXh0ID0gcm93c1tpbmRleF07XG4gICAgICB2YXIgZ3JpZEIgPSBncmlkaWZ5Um93cyhwYXN0ZURldGFpbHMuY2xpcGJvYXJkLCBwYXN0ZURldGFpbHMuZ2VuZXJhdG9ycywgY29udGV4dCk7XG4gICAgICB2YXIgbWVyZ2VkR3JpZCA9IGluc2VydFJvd3MoaW5kZXgsIGdyaWQsIGdyaWRCLCBwYXN0ZURldGFpbHMuZ2VuZXJhdG9ycywgY29tcGFyYXRvcik7XG4gICAgICB2YXIgY3Vyc29yID0gZWxlbWVudEZyb21HcmlkKG1lcmdlZEdyaWQsIHBhc3RlRGV0YWlscy5jZWxsc1swXS5yb3csIHBhc3RlRGV0YWlscy5jZWxsc1swXS5jb2x1bW4pO1xuICAgICAgcmV0dXJuIG91dGNvbWUobWVyZ2VkR3JpZCwgY3Vyc29yKTtcbiAgICB9O1xuICAgIHZhciBvcFBhc3RlUm93c0FmdGVyID0gZnVuY3Rpb24gKGdyaWQsIHBhc3RlRGV0YWlscywgY29tcGFyYXRvciwgX2dlbldyYXBwZXJzKSB7XG4gICAgICB2YXIgcm93cyA9IGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzO1xuICAgICAgdmFyIGluZGV4ID0gcGFzdGVEZXRhaWxzLmNlbGxzW3Bhc3RlRGV0YWlscy5jZWxscy5sZW5ndGggLSAxXS5yb3cgKyBwYXN0ZURldGFpbHMuY2VsbHNbcGFzdGVEZXRhaWxzLmNlbGxzLmxlbmd0aCAtIDFdLnJvd3NwYW47XG4gICAgICB2YXIgY29udGV4dCA9IHJvd3NbcGFzdGVEZXRhaWxzLmNlbGxzWzBdLnJvd107XG4gICAgICB2YXIgZ3JpZEIgPSBncmlkaWZ5Um93cyhwYXN0ZURldGFpbHMuY2xpcGJvYXJkLCBwYXN0ZURldGFpbHMuZ2VuZXJhdG9ycywgY29udGV4dCk7XG4gICAgICB2YXIgbWVyZ2VkR3JpZCA9IGluc2VydFJvd3MoaW5kZXgsIGdyaWQsIGdyaWRCLCBwYXN0ZURldGFpbHMuZ2VuZXJhdG9ycywgY29tcGFyYXRvcik7XG4gICAgICB2YXIgY3Vyc29yID0gZWxlbWVudEZyb21HcmlkKG1lcmdlZEdyaWQsIHBhc3RlRGV0YWlscy5jZWxsc1swXS5yb3csIHBhc3RlRGV0YWlscy5jZWxsc1swXS5jb2x1bW4pO1xuICAgICAgcmV0dXJuIG91dGNvbWUobWVyZ2VkR3JpZCwgY3Vyc29yKTtcbiAgICB9O1xuICAgIHZhciBvcEdldENvbHVtblR5cGUgPSBmdW5jdGlvbiAodGFibGUsIHRhcmdldCkge1xuICAgICAgdmFyIGhvdXNlID0gV2FyZWhvdXNlLmZyb21UYWJsZSh0YWJsZSk7XG4gICAgICB2YXIgZGV0YWlscyA9IG9uQ2VsbHMoaG91c2UsIHRhcmdldCk7XG4gICAgICByZXR1cm4gZGV0YWlscy5iaW5kKGZ1bmN0aW9uIChzZWxlY3RlZENlbGxzKSB7XG4gICAgICAgIHZhciBsYXN0U2VsZWN0ZWRDZWxsID0gc2VsZWN0ZWRDZWxsc1tzZWxlY3RlZENlbGxzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbWluQ29sUmFuZ2UgPSBzZWxlY3RlZENlbGxzWzBdLmNvbHVtbjtcbiAgICAgICAgdmFyIG1heENvbFJhbmdlID0gbGFzdFNlbGVjdGVkQ2VsbC5jb2x1bW4gKyBsYXN0U2VsZWN0ZWRDZWxsLmNvbHNwYW47XG4gICAgICAgIHZhciBzZWxlY3RlZENvbHVtbkNlbGxzID0gZmxhdHRlbihtYXAoaG91c2UuYWxsLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgcmV0dXJuIGZpbHRlcihyb3cuY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5jb2x1bW4gPj0gbWluQ29sUmFuZ2UgJiYgY2VsbC5jb2x1bW4gPCBtYXhDb2xSYW5nZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gZ2V0Q2VsbHNUeXBlKHNlbGVjdGVkQ29sdW1uQ2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIG5hbWUoY2VsbC5lbGVtZW50KSA9PT0gJ3RoJztcbiAgICAgICAgfSk7XG4gICAgICB9KS5nZXRPcignJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Q2VsbHNUeXBlID0gZnVuY3Rpb24gKGNlbGxzLCBoZWFkZXJQcmVkKSB7XG4gICAgICB2YXIgaGVhZGVyQ2VsbHMgPSBmaWx0ZXIoY2VsbHMsIGhlYWRlclByZWQpO1xuICAgICAgaWYgKGhlYWRlckNlbGxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSgndGQnKTtcbiAgICAgIH0gZWxzZSBpZiAoaGVhZGVyQ2VsbHMubGVuZ3RoID09PSBjZWxscy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoJ3RoJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHJlc2l6ZSA9IGFkanVzdFdpZHRoVG87XG4gICAgdmFyIGFkanVzdEFuZFJlZGlzdHJpYnV0ZVdpZHRocyQxID0gYWRqdXN0QW5kUmVkaXN0cmlidXRlV2lkdGhzO1xuICAgIHZhciBmaXJzdENvbHVtbklzTG9ja2VkID0gZnVuY3Rpb24gKF93YXJlaG91c2UsIGRldGFpbHMpIHtcbiAgICAgIHJldHVybiBleGlzdHMoZGV0YWlscywgZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICByZXR1cm4gZGV0YWlsLmNvbHVtbiA9PT0gMCAmJiBkZXRhaWwuaXNMb2NrZWQ7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBsYXN0Q29sdW1uSXNMb2NrZWQgPSBmdW5jdGlvbiAod2FyZWhvdXNlLCBkZXRhaWxzKSB7XG4gICAgICByZXR1cm4gZXhpc3RzKGRldGFpbHMsIGZ1bmN0aW9uIChkZXRhaWwpIHtcbiAgICAgICAgcmV0dXJuIGRldGFpbC5jb2x1bW4gKyBkZXRhaWwuY29sc3BhbiA+PSB3YXJlaG91c2UuZ3JpZC5jb2x1bW5zICYmIGRldGFpbC5pc0xvY2tlZDtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldENvbHVtbnNXaWR0aCA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIGRldGFpbHMpIHtcbiAgICAgIHZhciBjb2x1bW5zID0gY29sdW1ucyQxKHdhcmVob3VzZSk7XG4gICAgICB2YXIgdW5pcXVlQ29scyA9IHVuaXF1ZUNvbHVtbnMoZGV0YWlscyk7XG4gICAgICByZXR1cm4gZm9sZGwodW5pcXVlQ29scywgZnVuY3Rpb24gKGFjYywgZGV0YWlsKSB7XG4gICAgICAgIHZhciBjb2x1bW4gPSBjb2x1bW5zW2RldGFpbC5jb2x1bW5dO1xuICAgICAgICB2YXIgY29sV2lkdGggPSBjb2x1bW4ubWFwKGdldE91dGVyKS5nZXRPcigwKTtcbiAgICAgICAgcmV0dXJuIGFjYyArIGNvbFdpZHRoO1xuICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0Q29sdW1uc0V4dHJhY3RvciA9IGZ1bmN0aW9uIChiZWZvcmUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAod2FyZWhvdXNlLCB0YXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIG9uQ2VsbHMod2FyZWhvdXNlLCB0YXJnZXQpLmZpbHRlcihmdW5jdGlvbiAoZGV0YWlscykge1xuICAgICAgICAgIHZhciBjaGVja0xvY2tlZCA9IGJlZm9yZSA/IGZpcnN0Q29sdW1uSXNMb2NrZWQgOiBsYXN0Q29sdW1uSXNMb2NrZWQ7XG4gICAgICAgICAgcmV0dXJuICFjaGVja0xvY2tlZCh3YXJlaG91c2UsIGRldGFpbHMpO1xuICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGV0YWlsczogZGV0YWlscyxcbiAgICAgICAgICAgIHBpeGVsRGVsdGE6IGdldENvbHVtbnNXaWR0aCh3YXJlaG91c2UsIGRldGFpbHMpXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGVyYXNlQ29sdW1uc0V4dHJhY3RvciA9IGZ1bmN0aW9uICh3YXJlaG91c2UsIHRhcmdldCkge1xuICAgICAgcmV0dXJuIG9uVW5sb2NrZWRDZWxscyh3YXJlaG91c2UsIHRhcmdldCkubWFwKGZ1bmN0aW9uIChkZXRhaWxzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGV0YWlsczogZGV0YWlscyxcbiAgICAgICAgICBwaXhlbERlbHRhOiAtZ2V0Q29sdW1uc1dpZHRoKHdhcmVob3VzZSwgZGV0YWlscylcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHBhc3RlQ29sdW1uc0V4dHJhY3RvciA9IGZ1bmN0aW9uIChiZWZvcmUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAod2FyZWhvdXNlLCB0YXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIG9uUGFzdGVCeUVkaXRvcih3YXJlaG91c2UsIHRhcmdldCkuZmlsdGVyKGZ1bmN0aW9uIChkZXRhaWxzKSB7XG4gICAgICAgICAgdmFyIGNoZWNrTG9ja2VkID0gYmVmb3JlID8gZmlyc3RDb2x1bW5Jc0xvY2tlZCA6IGxhc3RDb2x1bW5Jc0xvY2tlZDtcbiAgICAgICAgICByZXR1cm4gIWNoZWNrTG9ja2VkKHdhcmVob3VzZSwgZGV0YWlscy5jZWxscyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpbnNlcnRSb3dzQmVmb3JlID0gcnVuKG9wSW5zZXJ0Um93c0JlZm9yZSwgb25DZWxscywgbm9vcCwgbm9vcCwgR2VuZXJhdG9ycy5tb2RpZmljYXRpb24pO1xuICAgIHZhciBpbnNlcnRSb3dzQWZ0ZXIgPSBydW4ob3BJbnNlcnRSb3dzQWZ0ZXIsIG9uQ2VsbHMsIG5vb3AsIG5vb3AsIEdlbmVyYXRvcnMubW9kaWZpY2F0aW9uKTtcbiAgICB2YXIgaW5zZXJ0Q29sdW1uc0JlZm9yZSA9IHJ1bihvcEluc2VydENvbHVtbnNCZWZvcmUsIGluc2VydENvbHVtbnNFeHRyYWN0b3IodHJ1ZSksIGFkanVzdEFuZFJlZGlzdHJpYnV0ZVdpZHRocyQxLCBub29wLCBHZW5lcmF0b3JzLm1vZGlmaWNhdGlvbik7XG4gICAgdmFyIGluc2VydENvbHVtbnNBZnRlciA9IHJ1bihvcEluc2VydENvbHVtbnNBZnRlciwgaW5zZXJ0Q29sdW1uc0V4dHJhY3RvcihmYWxzZSksIGFkanVzdEFuZFJlZGlzdHJpYnV0ZVdpZHRocyQxLCBub29wLCBHZW5lcmF0b3JzLm1vZGlmaWNhdGlvbik7XG4gICAgdmFyIGVyYXNlQ29sdW1ucyA9IHJ1bihvcEVyYXNlQ29sdW1ucywgZXJhc2VDb2x1bW5zRXh0cmFjdG9yLCBhZGp1c3RBbmRSZWRpc3RyaWJ1dGVXaWR0aHMkMSwgcHJ1bmUsIEdlbmVyYXRvcnMubW9kaWZpY2F0aW9uKTtcbiAgICB2YXIgZXJhc2VSb3dzID0gcnVuKG9wRXJhc2VSb3dzLCBvbkNlbGxzLCBub29wLCBwcnVuZSwgR2VuZXJhdG9ycy5tb2RpZmljYXRpb24pO1xuICAgIHZhciBtYWtlQ29sdW1uSGVhZGVyID0gcnVuKG9wTWFrZUNvbHVtbkhlYWRlciwgb25VbmxvY2tlZENlbGwsIG5vb3AsIG5vb3AsIEdlbmVyYXRvcnMudHJhbnNmb3JtKCdyb3cnLCAndGgnKSk7XG4gICAgdmFyIG1ha2VDb2x1bW5zSGVhZGVyID0gcnVuKG9wTWFrZUNvbHVtbnNIZWFkZXIsIG9uVW5sb2NrZWRDZWxscywgbm9vcCwgbm9vcCwgR2VuZXJhdG9ycy50cmFuc2Zvcm0oJ3JvdycsICd0aCcpKTtcbiAgICB2YXIgdW5tYWtlQ29sdW1uSGVhZGVyID0gcnVuKG9wVW5tYWtlQ29sdW1uSGVhZGVyLCBvblVubG9ja2VkQ2VsbCwgbm9vcCwgbm9vcCwgR2VuZXJhdG9ycy50cmFuc2Zvcm0obnVsbCwgJ3RkJykpO1xuICAgIHZhciB1bm1ha2VDb2x1bW5zSGVhZGVyID0gcnVuKG9wVW5tYWtlQ29sdW1uc0hlYWRlciwgb25VbmxvY2tlZENlbGxzLCBub29wLCBub29wLCBHZW5lcmF0b3JzLnRyYW5zZm9ybShudWxsLCAndGQnKSk7XG4gICAgdmFyIG1ha2VSb3dIZWFkZXIgPSBydW4ob3BNYWtlUm93SGVhZGVyLCBvbkNlbGwsIG5vb3AsIG5vb3AsIEdlbmVyYXRvcnMudHJhbnNmb3JtKCdjb2wnLCAndGgnKSk7XG4gICAgdmFyIG1ha2VSb3dzSGVhZGVyID0gcnVuKG9wTWFrZVJvd3NIZWFkZXIsIG9uQ2VsbHMsIG5vb3AsIG5vb3AsIEdlbmVyYXRvcnMudHJhbnNmb3JtKCdjb2wnLCAndGgnKSk7XG4gICAgdmFyIHVubWFrZVJvd0hlYWRlciA9IHJ1bihvcFVubWFrZVJvd0hlYWRlciwgb25DZWxsLCBub29wLCBub29wLCBHZW5lcmF0b3JzLnRyYW5zZm9ybShudWxsLCAndGQnKSk7XG4gICAgdmFyIHVubWFrZVJvd3NIZWFkZXIgPSBydW4ob3BVbm1ha2VSb3dzSGVhZGVyLCBvbkNlbGxzLCBub29wLCBub29wLCBHZW5lcmF0b3JzLnRyYW5zZm9ybShudWxsLCAndGQnKSk7XG4gICAgdmFyIG1lcmdlQ2VsbHMgPSBydW4ob3BNZXJnZUNlbGxzLCBvblVubG9ja2VkTWVyZ2FibGUsIHJlc2l6ZSwgbm9vcCwgR2VuZXJhdG9ycy5tZXJnaW5nKTtcbiAgICB2YXIgdW5tZXJnZUNlbGxzID0gcnVuKG9wVW5tZXJnZUNlbGxzLCBvblVubG9ja2VkVW5tZXJnYWJsZSwgcmVzaXplLCBub29wLCBHZW5lcmF0b3JzLm1lcmdpbmcpO1xuICAgIHZhciBwYXN0ZUNlbGxzID0gcnVuKG9wUGFzdGVDZWxscywgb25QYXN0ZSwgcmVzaXplLCBub29wLCBHZW5lcmF0b3JzLm1vZGlmaWNhdGlvbik7XG4gICAgdmFyIHBhc3RlQ29sc0JlZm9yZSA9IHJ1bihvcFBhc3RlQ29sc0JlZm9yZSwgcGFzdGVDb2x1bW5zRXh0cmFjdG9yKHRydWUpLCBub29wLCBub29wLCBHZW5lcmF0b3JzLm1vZGlmaWNhdGlvbik7XG4gICAgdmFyIHBhc3RlQ29sc0FmdGVyID0gcnVuKG9wUGFzdGVDb2xzQWZ0ZXIsIHBhc3RlQ29sdW1uc0V4dHJhY3RvcihmYWxzZSksIG5vb3AsIG5vb3AsIEdlbmVyYXRvcnMubW9kaWZpY2F0aW9uKTtcbiAgICB2YXIgcGFzdGVSb3dzQmVmb3JlID0gcnVuKG9wUGFzdGVSb3dzQmVmb3JlLCBvblBhc3RlQnlFZGl0b3IsIG5vb3AsIG5vb3AsIEdlbmVyYXRvcnMubW9kaWZpY2F0aW9uKTtcbiAgICB2YXIgcGFzdGVSb3dzQWZ0ZXIgPSBydW4ob3BQYXN0ZVJvd3NBZnRlciwgb25QYXN0ZUJ5RWRpdG9yLCBub29wLCBub29wLCBHZW5lcmF0b3JzLm1vZGlmaWNhdGlvbik7XG4gICAgdmFyIGdldENvbHVtblR5cGUgPSBvcEdldENvbHVtblR5cGU7XG5cbiAgICB2YXIgZ2V0U2VjdGlvbiA9IGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgIHJldHVybiBnZXROb2RlTmFtZShlbG0ucGFyZW50Tm9kZSk7XG4gICAgfTtcbiAgICB2YXIgbWFwU2VjdGlvbk5hbWVUb1R5cGUgPSBmdW5jdGlvbiAoc2VjdGlvbikge1xuICAgICAgaWYgKHNlY3Rpb24gPT09ICd0aGVhZCcpIHtcbiAgICAgICAgcmV0dXJuICdoZWFkZXInO1xuICAgICAgfSBlbHNlIGlmIChzZWN0aW9uID09PSAndGZvb3QnKSB7XG4gICAgICAgIHJldHVybiAnZm9vdGVyJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnYm9keSc7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZGV0ZWN0SGVhZGVyUm93ID0gZnVuY3Rpb24gKGVkaXRvciwgZWxtKSB7XG4gICAgICB2YXIgaXNUaGVhZCA9IGdldFNlY3Rpb24oZWxtKSA9PT0gJ3RoZWFkJztcbiAgICAgIHZhciBhcmVBbGxDZWxsc1RocyA9ICFleGlzdHMoZWxtLmNlbGxzLCBmdW5jdGlvbiAoYykge1xuICAgICAgICByZXR1cm4gZ2V0Tm9kZU5hbWUoYykgIT09ICd0aCc7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBpc1RoZWFkIHx8IGFyZUFsbENlbGxzVGhzID8gT3B0aW9uYWwuc29tZSh7XG4gICAgICAgIHRoZWFkOiBpc1RoZWFkLFxuICAgICAgICB0aHM6IGFyZUFsbENlbGxzVGhzXG4gICAgICB9KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBnZXRSb3dUeXBlID0gZnVuY3Rpb24gKGVkaXRvciwgZWxtKSB7XG4gICAgICByZXR1cm4gbWFwU2VjdGlvbk5hbWVUb1R5cGUoZGV0ZWN0SGVhZGVyUm93KGVkaXRvciwgZWxtKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldFNlY3Rpb24oZWxtKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChfcm93Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiAndGhlYWQnO1xuICAgICAgfSkpO1xuICAgIH07XG4gICAgdmFyIHN3aXRjaFJvd1NlY3Rpb24gPSBmdW5jdGlvbiAoZG9tLCByb3dFbG0sIG5ld1NlY3Rpb25OYW1lKSB7XG4gICAgICB2YXIgdGFibGVFbG0gPSBkb20uZ2V0UGFyZW50KHJvd0VsbSwgJ3RhYmxlJyk7XG4gICAgICB2YXIgb2xkU2VjdGlvbkVsbSA9IHJvd0VsbS5wYXJlbnROb2RlO1xuICAgICAgdmFyIG9sZFNlY3Rpb25OYW1lID0gZ2V0Tm9kZU5hbWUob2xkU2VjdGlvbkVsbSk7XG4gICAgICBpZiAobmV3U2VjdGlvbk5hbWUgIT09IG9sZFNlY3Rpb25OYW1lKSB7XG4gICAgICAgIHZhciBzZWN0aW9uRWxtXzEgPSBkb20uc2VsZWN0KG5ld1NlY3Rpb25OYW1lLCB0YWJsZUVsbSlbMF07XG4gICAgICAgIGlmICghc2VjdGlvbkVsbV8xKSB7XG4gICAgICAgICAgc2VjdGlvbkVsbV8xID0gZG9tLmNyZWF0ZShuZXdTZWN0aW9uTmFtZSk7XG4gICAgICAgICAgdmFyIGZpcnN0VGFibGVDaGlsZF8xID0gdGFibGVFbG0uZmlyc3RDaGlsZDtcbiAgICAgICAgICBpZiAobmV3U2VjdGlvbk5hbWUgPT09ICd0aGVhZCcpIHtcbiAgICAgICAgICAgIGxhc3QoY2hpbGRyZW4kMihTdWdhckVsZW1lbnQuZnJvbURvbSh0YWJsZUVsbSksICdjYXB0aW9uLGNvbGdyb3VwJykpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGFibGVFbG0uaW5zZXJ0QmVmb3JlKHNlY3Rpb25FbG1fMSwgZmlyc3RUYWJsZUNoaWxkXzEpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGRvbS5pbnNlcnRBZnRlcihzZWN0aW9uRWxtXzEsIGMuZG9tKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YWJsZUVsbS5hcHBlbmRDaGlsZChzZWN0aW9uRWxtXzEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3U2VjdGlvbk5hbWUgPT09ICd0Ym9keScgJiYgb2xkU2VjdGlvbk5hbWUgPT09ICd0aGVhZCcgJiYgc2VjdGlvbkVsbV8xLmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgICBzZWN0aW9uRWxtXzEuaW5zZXJ0QmVmb3JlKHJvd0VsbSwgc2VjdGlvbkVsbV8xLmZpcnN0Q2hpbGQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlY3Rpb25FbG1fMS5hcHBlbmRDaGlsZChyb3dFbG0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkU2VjdGlvbkVsbS5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgICBkb20ucmVtb3ZlKG9sZFNlY3Rpb25FbG0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmVuYW1lQ2VsbCA9IGZ1bmN0aW9uIChlZGl0b3IsIGNlbGwsIG5ld0NlbGxUeXBlKSB7XG4gICAgICBpZiAoaXNOb25OdWxsYWJsZShuZXdDZWxsVHlwZSkgJiYgZ2V0Tm9kZU5hbWUoY2VsbCkgIT09IG5ld0NlbGxUeXBlKSB7XG4gICAgICAgIHZhciBuZXdDZWxsRWxtID0gZWRpdG9yLmRvbS5yZW5hbWUoY2VsbCwgbmV3Q2VsbFR5cGUpO1xuICAgICAgICBmaXJlTmV3Q2VsbChlZGl0b3IsIG5ld0NlbGxFbG0pO1xuICAgICAgICByZXR1cm4gbmV3Q2VsbEVsbTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjZWxsO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHN3aXRjaENlbGxUeXBlID0gZnVuY3Rpb24gKGVkaXRvciwgY2VsbCwgbmV3Q2VsbFR5cGUsIHNjb3BlKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBuZXdDZWxsID0gcmVuYW1lQ2VsbChlZGl0b3IsIGNlbGwsIG5ld0NlbGxUeXBlKTtcbiAgICAgIGlmICghaXNVbmRlZmluZWQoc2NvcGUpKSB7XG4gICAgICAgIGRvbS5zZXRBdHRyaWIobmV3Q2VsbCwgJ3Njb3BlJywgc2NvcGUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ld0NlbGw7XG4gICAgfTtcbiAgICB2YXIgc3dpdGNoQ2VsbHNUeXBlID0gZnVuY3Rpb24gKGVkaXRvciwgY2VsbHMsIG5ld0NlbGxUeXBlLCBzY29wZSkge1xuICAgICAgcmV0dXJuIGVhY2goY2VsbHMsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHJldHVybiBzd2l0Y2hDZWxsVHlwZShlZGl0b3IsIGMsIG5ld0NlbGxUeXBlLCBzY29wZSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBzd2l0Y2hTZWN0aW9uVHlwZSA9IGZ1bmN0aW9uIChlZGl0b3IsIHJvd0VsbSwgbmV3VHlwZSkge1xuICAgICAgdmFyIGRldGVybWluZUhlYWRlclJvd1R5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhbGxUYWJsZVJvd3MgPSB0YWJsZShTdWdhckVsZW1lbnQuZnJvbURvbShyb3dFbG0uY2VsbHNbMF0pKS5tYXAoZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgcmV0dXJuIHJvd3ModGFibGUpO1xuICAgICAgICB9KS5nZXRPcihbXSk7XG4gICAgICAgIHJldHVybiBmaW5kTWFwKGFsbFRhYmxlUm93cywgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgIHJldHVybiBkZXRlY3RIZWFkZXJSb3coZWRpdG9yLCByb3cuZG9tKTtcbiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChkZXRlY3RlZFR5cGUpIHtcbiAgICAgICAgICBpZiAoZGV0ZWN0ZWRUeXBlLnRoZWFkICYmIGRldGVjdGVkVHlwZS50aHMpIHtcbiAgICAgICAgICAgIHJldHVybiAnc2VjdGlvbkNlbGxzJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGRldGVjdGVkVHlwZS50aGVhZCA/ICdzZWN0aW9uJyA6ICdjZWxscyc7XG4gICAgICAgICAgfVxuICAgICAgICB9KS5nZXRPcignc2VjdGlvbicpO1xuICAgICAgfTtcbiAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tO1xuICAgICAgaWYgKG5ld1R5cGUgPT09ICdoZWFkZXInKSB7XG4gICAgICAgIHZhciBoZWFkZXJSb3dUeXBlU2V0dGluZyA9IGdldFRhYmxlSGVhZGVyVHlwZShlZGl0b3IpO1xuICAgICAgICB2YXIgaGVhZGVyUm93VHlwZSA9IGhlYWRlclJvd1R5cGVTZXR0aW5nID09PSAnYXV0bycgPyBkZXRlcm1pbmVIZWFkZXJSb3dUeXBlKCkgOiBoZWFkZXJSb3dUeXBlU2V0dGluZztcbiAgICAgICAgc3dpdGNoQ2VsbHNUeXBlKGVkaXRvciwgcm93RWxtLmNlbGxzLCBoZWFkZXJSb3dUeXBlID09PSAnc2VjdGlvbicgPyAndGQnIDogJ3RoJywgJ2NvbCcpO1xuICAgICAgICBzd2l0Y2hSb3dTZWN0aW9uKGRvbSwgcm93RWxtLCBoZWFkZXJSb3dUeXBlID09PSAnY2VsbHMnID8gJ3Rib2R5JyA6ICd0aGVhZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3dpdGNoQ2VsbHNUeXBlKGVkaXRvciwgcm93RWxtLmNlbGxzLCAndGQnLCBudWxsKTtcbiAgICAgICAgc3dpdGNoUm93U2VjdGlvbihkb20sIHJvd0VsbSwgbmV3VHlwZSA9PT0gJ2Zvb3RlcicgPyAndGZvb3QnIDogJ3Rib2R5Jyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBnZXRTZWxlY3Rpb25TdGFydENlbGxGYWxsYmFjayA9IGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgcmV0dXJuIHRhYmxlKHN0YXJ0KS5iaW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICByZXR1cm4gcmV0cmlldmUkMSh0YWJsZSwgZXBoZW1lcmEuZmlyc3RTZWxlY3RlZFNlbGVjdG9yKTtcbiAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3RhcnQ7XG4gICAgICB9LCBmdW5jdGlvbiAoY2VsbHMpIHtcbiAgICAgICAgcmV0dXJuIGNlbGxzWzBdO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0U2VsZWN0aW9uU3RhcnRGcm9tU2VsZWN0b3IgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RhcnQsIGlzUm9vdCkge1xuICAgICAgICB2YXIgc3RhcnRDZWxsTmFtZSA9IG5hbWUoc3RhcnQpO1xuICAgICAgICB2YXIgc3RhcnRDZWxsID0gc3RhcnRDZWxsTmFtZSA9PT0gJ2NvbCcgfHwgc3RhcnRDZWxsTmFtZSA9PT0gJ2NvbGdyb3VwJyA/IGdldFNlbGVjdGlvblN0YXJ0Q2VsbEZhbGxiYWNrKHN0YXJ0KSA6IHN0YXJ0O1xuICAgICAgICByZXR1cm4gY2xvc2VzdCQxKHN0YXJ0Q2VsbCwgc2VsZWN0b3IsIGlzUm9vdCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldFNlbGVjdGlvblN0YXJ0Q2VsbCA9IGdldFNlbGVjdGlvblN0YXJ0RnJvbVNlbGVjdG9yKCd0aCx0ZCcpO1xuICAgIHZhciBnZXRTZWxlY3Rpb25TdGFydENlbGxPckNhcHRpb24gPSBnZXRTZWxlY3Rpb25TdGFydEZyb21TZWxlY3RvcigndGgsdGQsY2FwdGlvbicpO1xuICAgIHZhciBnZXRDZWxsc0Zyb21TZWxlY3Rpb24gPSBmdW5jdGlvbiAoc3RhcnQsIHNlbGVjdGlvbnMsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGdldFNlbGVjdGlvblN0YXJ0Q2VsbChzdGFydCwgaXNSb290KS5tYXAoZnVuY3Rpb24gKF9jZWxsKSB7XG4gICAgICAgIHJldHVybiBzZWxlY3Rpb24oc2VsZWN0aW9ucyk7XG4gICAgICB9KS5nZXRPcihbXSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0Um93c0Zyb21TZWxlY3Rpb24gPSBmdW5jdGlvbiAoc3RhcnQsIHNlbGVjdG9yKSB7XG4gICAgICB2YXIgY2VsbE9wdCA9IGdldFNlbGVjdGlvblN0YXJ0Q2VsbChzdGFydCk7XG4gICAgICB2YXIgcm93c09wdCA9IGNlbGxPcHQuYmluZChmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICByZXR1cm4gdGFibGUoY2VsbCk7XG4gICAgICB9KS5tYXAoZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiByb3dzKHRhYmxlKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGxpZnQyKGNlbGxPcHQsIHJvd3NPcHQsIGZ1bmN0aW9uIChjZWxsLCByb3dzKSB7XG4gICAgICAgIHJldHVybiBmaWx0ZXIocm93cywgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgIHJldHVybiBleGlzdHMoZnJvbURvbSQxKHJvdy5kb20uY2VsbHMpLCBmdW5jdGlvbiAocm93Q2VsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldCQyKHJvd0NlbGwsIHNlbGVjdG9yKSA9PT0gJzEnIHx8IGVxJDEocm93Q2VsbCwgY2VsbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSkuZ2V0T3IoW10pO1xuICAgIH07XG5cbiAgICB2YXIgVGFibGVBY3Rpb25zID0gZnVuY3Rpb24gKGVkaXRvciwgbGF6eVdpcmUsIHNlbGVjdGlvbnMpIHtcbiAgICAgIHZhciBpc1RhYmxlQm9keSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5hbWUoZ2V0Qm9keSQxKGVkaXRvcikpID09PSAndGFibGUnO1xuICAgICAgfTtcbiAgICAgIHZhciBsYXN0Um93R3VhcmQgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGlzVGFibGVCb2R5KGVkaXRvcikgPT09IGZhbHNlIHx8IGdldEdyaWRTaXplKHRhYmxlKS5yb3dzID4gMTtcbiAgICAgIH07XG4gICAgICB2YXIgbGFzdENvbHVtbkd1YXJkID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBpc1RhYmxlQm9keShlZGl0b3IpID09PSBmYWxzZSB8fCBnZXRHcmlkU2l6ZSh0YWJsZSkuY29sdW1ucyA+IDE7XG4gICAgICB9O1xuICAgICAgdmFyIGNsb25lRm9ybWF0cyA9IGdldENsb25lRWxlbWVudHMoZWRpdG9yKTtcbiAgICAgIHZhciBjb2xNdXRhdGlvbk9wID0gaXNSZXNpemVUYWJsZUNvbHVtblJlc2l6aW5nKGVkaXRvcikgPyBub29wIDogaGFsdmU7XG4gICAgICB2YXIgZXhlY3V0ZSA9IGZ1bmN0aW9uIChvcGVyYXRpb24sIGd1YXJkLCBtdXRhdGUsIGxhenlXaXJlLCBlZmZlY3QpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0YWJsZSwgdGFyZ2V0KSB7XG4gICAgICAgICAgcmVtb3ZlRGF0YVN0eWxlKHRhYmxlKTtcbiAgICAgICAgICB2YXIgd2lyZSA9IGxhenlXaXJlKCk7XG4gICAgICAgICAgdmFyIGRvYyA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5nZXREb2MoKSk7XG4gICAgICAgICAgdmFyIGdlbmVyYXRvcnMgPSBjZWxsT3BlcmF0aW9ucyhtdXRhdGUsIGRvYywgY2xvbmVGb3JtYXRzKTtcbiAgICAgICAgICB2YXIgc2l6aW5nID0gZ2V0JDkoZWRpdG9yLCB0YWJsZSk7XG4gICAgICAgICAgdmFyIHJlc2l6ZUJlaGF2aW91ciA9IGlzUmVzaXplVGFibGVDb2x1bW5SZXNpemluZyhlZGl0b3IpID8gcmVzaXplVGFibGUoKSA6IHByZXNlcnZlVGFibGUoKTtcbiAgICAgICAgICByZXR1cm4gZ3VhcmQodGFibGUpID8gb3BlcmF0aW9uKHdpcmUsIHRhYmxlLCB0YXJnZXQsIGdlbmVyYXRvcnMsIHNpemluZywgcmVzaXplQmVoYXZpb3VyKS5iaW5kKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGVhY2gocmVzdWx0Lm5ld1Jvd3MsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgZmlyZU5ld1JvdyhlZGl0b3IsIHJvdy5kb20pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlYWNoKHJlc3VsdC5uZXdDZWxscywgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICAgICAgZmlyZU5ld0NlbGwoZWRpdG9yLCBjZWxsLmRvbSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQuY3Vyc29yLm1hcChmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgICAgICB2YXIgZGVzID0gZnJlZWZhbGxSdGwkMihjZWxsKTtcbiAgICAgICAgICAgICAgdmFyIHJuZyA9IGVkaXRvci5kb20uY3JlYXRlUm5nKCk7XG4gICAgICAgICAgICAgIHJuZy5zZXRTdGFydChkZXMuZWxlbWVudC5kb20sIGRlcy5vZmZzZXQpO1xuICAgICAgICAgICAgICBybmcuc2V0RW5kKGRlcy5lbGVtZW50LmRvbSwgZGVzLm9mZnNldCk7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcm5nOiBybmcsXG4gICAgICAgICAgICAgICAgZWZmZWN0OiBlZmZlY3RcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBkZWxldGVSb3cgPSBleGVjdXRlKGVyYXNlUm93cywgbGFzdFJvd0d1YXJkLCBub29wLCBsYXp5V2lyZSwgc3RydWN0dXJlTW9kaWZpZWQpO1xuICAgICAgdmFyIGRlbGV0ZUNvbHVtbiA9IGV4ZWN1dGUoZXJhc2VDb2x1bW5zLCBsYXN0Q29sdW1uR3VhcmQsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgaW5zZXJ0Um93c0JlZm9yZSQxID0gZXhlY3V0ZShpbnNlcnRSb3dzQmVmb3JlLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgaW5zZXJ0Um93c0FmdGVyJDEgPSBleGVjdXRlKGluc2VydFJvd3NBZnRlciwgYWx3YXlzLCBub29wLCBsYXp5V2lyZSwgc3RydWN0dXJlTW9kaWZpZWQpO1xuICAgICAgdmFyIGluc2VydENvbHVtbnNCZWZvcmUkMSA9IGV4ZWN1dGUoaW5zZXJ0Q29sdW1uc0JlZm9yZSwgYWx3YXlzLCBjb2xNdXRhdGlvbk9wLCBsYXp5V2lyZSwgc3RydWN0dXJlTW9kaWZpZWQpO1xuICAgICAgdmFyIGluc2VydENvbHVtbnNBZnRlciQxID0gZXhlY3V0ZShpbnNlcnRDb2x1bW5zQWZ0ZXIsIGFsd2F5cywgY29sTXV0YXRpb25PcCwgbGF6eVdpcmUsIHN0cnVjdHVyZU1vZGlmaWVkKTtcbiAgICAgIHZhciBtZXJnZUNlbGxzJDEgPSBleGVjdXRlKG1lcmdlQ2VsbHMsIGFsd2F5cywgbm9vcCwgbGF6eVdpcmUsIHN0cnVjdHVyZU1vZGlmaWVkKTtcbiAgICAgIHZhciB1bm1lcmdlQ2VsbHMkMSA9IGV4ZWN1dGUodW5tZXJnZUNlbGxzLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgcGFzdGVDb2xzQmVmb3JlJDEgPSBleGVjdXRlKHBhc3RlQ29sc0JlZm9yZSwgYWx3YXlzLCBub29wLCBsYXp5V2lyZSwgc3RydWN0dXJlTW9kaWZpZWQpO1xuICAgICAgdmFyIHBhc3RlQ29sc0FmdGVyJDEgPSBleGVjdXRlKHBhc3RlQ29sc0FmdGVyLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgcGFzdGVSb3dzQmVmb3JlJDEgPSBleGVjdXRlKHBhc3RlUm93c0JlZm9yZSwgYWx3YXlzLCBub29wLCBsYXp5V2lyZSwgc3RydWN0dXJlTW9kaWZpZWQpO1xuICAgICAgdmFyIHBhc3RlUm93c0FmdGVyJDEgPSBleGVjdXRlKHBhc3RlUm93c0FmdGVyLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgcGFzdGVDZWxscyQxID0gZXhlY3V0ZShwYXN0ZUNlbGxzLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgZXh0cmFjdFR5cGUgPSBmdW5jdGlvbiAoYXJncywgdmFsaWRUeXBlcykge1xuICAgICAgICByZXR1cm4gZ2V0JDEoYXJncywgJ3R5cGUnKS5maWx0ZXIoZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICByZXR1cm4gY29udGFpbnModmFsaWRUeXBlcywgdHlwZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXRUYWJsZUNlbGxUeXBlID0gZnVuY3Rpb24gKGVkaXRvciwgYXJncykge1xuICAgICAgICByZXR1cm4gZXh0cmFjdFR5cGUoYXJncywgW1xuICAgICAgICAgICd0ZCcsXG4gICAgICAgICAgJ3RoJ1xuICAgICAgICBdKS5lYWNoKGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgdmFyIGNlbGxzID0gbWFwKGdldENlbGxzRnJvbVNlbGVjdGlvbihnZXRTZWxlY3Rpb25TdGFydChlZGl0b3IpLCBzZWxlY3Rpb25zKSwgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJldHVybiBjLmRvbTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzd2l0Y2hDZWxsc1R5cGUoZWRpdG9yLCBjZWxscywgdHlwZSwgbnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXRUYWJsZVJvd1R5cGUgPSBmdW5jdGlvbiAoZWRpdG9yLCBhcmdzKSB7XG4gICAgICAgIHJldHVybiBleHRyYWN0VHlwZShhcmdzLCBbXG4gICAgICAgICAgJ2hlYWRlcicsXG4gICAgICAgICAgJ2JvZHknLFxuICAgICAgICAgICdmb290ZXInXG4gICAgICAgIF0pLmVhY2goZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICBtYXAoZ2V0Um93c0Zyb21TZWxlY3Rpb24oZ2V0U2VsZWN0aW9uU3RhcnQoZWRpdG9yKSwgZXBoZW1lcmEuc2VsZWN0ZWQpLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICByZXR1cm4gc3dpdGNoU2VjdGlvblR5cGUoZWRpdG9yLCByb3cuZG9tLCB0eXBlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG1ha2VDb2x1bW5zSGVhZGVyJDEgPSBleGVjdXRlKG1ha2VDb2x1bW5zSGVhZGVyLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgdW5tYWtlQ29sdW1uc0hlYWRlciQxID0gZXhlY3V0ZSh1bm1ha2VDb2x1bW5zSGVhZGVyLCBhbHdheXMsIG5vb3AsIGxhenlXaXJlLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICB2YXIgZ2V0VGFibGVSb3dUeXBlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgICB2YXIgcm93cyA9IGdldFJvd3NGcm9tU2VsZWN0aW9uKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvciksIGVwaGVtZXJhLnNlbGVjdGVkKTtcbiAgICAgICAgaWYgKHJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciByb3dUeXBlcyA9IG1hcChyb3dzLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIGdldFJvd1R5cGUoZWRpdG9yLCByLmRvbSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIGhhc0hlYWRlciA9IGNvbnRhaW5zKHJvd1R5cGVzLCAnaGVhZGVyJyk7XG4gICAgICAgICAgdmFyIGhhc0Zvb3RlciA9IGNvbnRhaW5zKHJvd1R5cGVzLCAnZm9vdGVyJyk7XG4gICAgICAgICAgaWYgKCFoYXNIZWFkZXIgJiYgIWhhc0Zvb3Rlcikge1xuICAgICAgICAgICAgcmV0dXJuICdib2R5JztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGhhc0JvZHkgPSBjb250YWlucyhyb3dUeXBlcywgJ2JvZHknKTtcbiAgICAgICAgICAgIGlmIChoYXNIZWFkZXIgJiYgIWhhc0JvZHkgJiYgIWhhc0Zvb3Rlcikge1xuICAgICAgICAgICAgICByZXR1cm4gJ2hlYWRlcic7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFoYXNIZWFkZXIgJiYgIWhhc0JvZHkgJiYgaGFzRm9vdGVyKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnZm9vdGVyJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VGFibGVDZWxsVHlwZSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgICAgcmV0dXJuIGdldENlbGxzVHlwZShnZXRDZWxsc0Zyb21TZWxlY3Rpb24oZ2V0U2VsZWN0aW9uU3RhcnQoZWRpdG9yKSwgc2VsZWN0aW9ucyksIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIG5hbWUoY2VsbCkgPT09ICd0aCc7XG4gICAgICAgIH0pLmdldE9yKCcnKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0VGFibGVDb2xUeXBlID0gZ2V0Q29sdW1uVHlwZTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlbGV0ZVJvdzogZGVsZXRlUm93LFxuICAgICAgICBkZWxldGVDb2x1bW46IGRlbGV0ZUNvbHVtbixcbiAgICAgICAgaW5zZXJ0Um93c0JlZm9yZTogaW5zZXJ0Um93c0JlZm9yZSQxLFxuICAgICAgICBpbnNlcnRSb3dzQWZ0ZXI6IGluc2VydFJvd3NBZnRlciQxLFxuICAgICAgICBpbnNlcnRDb2x1bW5zQmVmb3JlOiBpbnNlcnRDb2x1bW5zQmVmb3JlJDEsXG4gICAgICAgIGluc2VydENvbHVtbnNBZnRlcjogaW5zZXJ0Q29sdW1uc0FmdGVyJDEsXG4gICAgICAgIG1lcmdlQ2VsbHM6IG1lcmdlQ2VsbHMkMSxcbiAgICAgICAgdW5tZXJnZUNlbGxzOiB1bm1lcmdlQ2VsbHMkMSxcbiAgICAgICAgcGFzdGVDb2xzQmVmb3JlOiBwYXN0ZUNvbHNCZWZvcmUkMSxcbiAgICAgICAgcGFzdGVDb2xzQWZ0ZXI6IHBhc3RlQ29sc0FmdGVyJDEsXG4gICAgICAgIHBhc3RlUm93c0JlZm9yZTogcGFzdGVSb3dzQmVmb3JlJDEsXG4gICAgICAgIHBhc3RlUm93c0FmdGVyOiBwYXN0ZVJvd3NBZnRlciQxLFxuICAgICAgICBwYXN0ZUNlbGxzOiBwYXN0ZUNlbGxzJDEsXG4gICAgICAgIHNldFRhYmxlQ2VsbFR5cGU6IHNldFRhYmxlQ2VsbFR5cGUsXG4gICAgICAgIHNldFRhYmxlUm93VHlwZTogc2V0VGFibGVSb3dUeXBlLFxuICAgICAgICBtYWtlQ29sdW1uc0hlYWRlcjogbWFrZUNvbHVtbnNIZWFkZXIkMSxcbiAgICAgICAgdW5tYWtlQ29sdW1uc0hlYWRlcjogdW5tYWtlQ29sdW1uc0hlYWRlciQxLFxuICAgICAgICBnZXRUYWJsZVJvd1R5cGU6IGdldFRhYmxlUm93VHlwZSxcbiAgICAgICAgZ2V0VGFibGVDZWxsVHlwZTogZ2V0VGFibGVDZWxsVHlwZSxcbiAgICAgICAgZ2V0VGFibGVDb2xUeXBlOiBnZXRUYWJsZUNvbFR5cGVcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBEZWZhdWx0UmVuZGVyT3B0aW9ucyA9IHtcbiAgICAgIHN0eWxlczoge1xuICAgICAgICAnYm9yZGVyLWNvbGxhcHNlJzogJ2NvbGxhcHNlJyxcbiAgICAgICAgJ3dpZHRoJzogJzEwMCUnXG4gICAgICB9LFxuICAgICAgYXR0cmlidXRlczogeyBib3JkZXI6ICcxJyB9LFxuICAgICAgY29sR3JvdXBzOiBmYWxzZVxuICAgIH07XG4gICAgdmFyIHRhYmxlSGVhZGVyQ2VsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbVRhZygndGgnKTtcbiAgICB9O1xuICAgIHZhciB0YWJsZUNlbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21UYWcoJ3RkJyk7XG4gICAgfTtcbiAgICB2YXIgdGFibGVDb2x1bW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gU3VnYXJFbGVtZW50LmZyb21UYWcoJ2NvbCcpO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVJvdyA9IGZ1bmN0aW9uIChjb2x1bW5zLCByb3dIZWFkZXJzLCBjb2x1bW5IZWFkZXJzLCByb3dJbmRleCkge1xuICAgICAgdmFyIHRyID0gU3VnYXJFbGVtZW50LmZyb21UYWcoJ3RyJyk7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvbHVtbnM7IGorKykge1xuICAgICAgICB2YXIgdGQgPSByb3dJbmRleCA8IHJvd0hlYWRlcnMgfHwgaiA8IGNvbHVtbkhlYWRlcnMgPyB0YWJsZUhlYWRlckNlbGwoKSA6IHRhYmxlQ2VsbCgpO1xuICAgICAgICBpZiAoaiA8IGNvbHVtbkhlYWRlcnMpIHtcbiAgICAgICAgICBzZXQodGQsICdzY29wZScsICdyb3cnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocm93SW5kZXggPCByb3dIZWFkZXJzKSB7XG4gICAgICAgICAgc2V0KHRkLCAnc2NvcGUnLCAnY29sJyk7XG4gICAgICAgIH1cbiAgICAgICAgYXBwZW5kKHRkLCBTdWdhckVsZW1lbnQuZnJvbVRhZygnYnInKSk7XG4gICAgICAgIGFwcGVuZCh0ciwgdGQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRyO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZUdyb3VwUm93ID0gZnVuY3Rpb24gKGNvbHVtbnMpIHtcbiAgICAgIHZhciBjb2x1bW5Hcm91cCA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdjb2xncm91cCcpO1xuICAgICAgcmFuZ2UoY29sdW1ucywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gYXBwZW5kKGNvbHVtbkdyb3VwLCB0YWJsZUNvbHVtbigpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNvbHVtbkdyb3VwO1xuICAgIH07XG4gICAgdmFyIGNyZWF0ZVJvd3MgPSBmdW5jdGlvbiAocm93cywgY29sdW1ucywgcm93SGVhZGVycywgY29sdW1uSGVhZGVycykge1xuICAgICAgcmV0dXJuIHJhbmdlKHJvd3MsIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVSb3coY29sdW1ucywgcm93SGVhZGVycywgY29sdW1uSGVhZGVycywgcik7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZW5kZXIkMSA9IGZ1bmN0aW9uIChyb3dzLCBjb2x1bW5zLCByb3dIZWFkZXJzLCBjb2x1bW5IZWFkZXJzLCBoZWFkZXJUeXBlLCByZW5kZXJPcHRzKSB7XG4gICAgICBpZiAocmVuZGVyT3B0cyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlbmRlck9wdHMgPSBEZWZhdWx0UmVuZGVyT3B0aW9ucztcbiAgICAgIH1cbiAgICAgIHZhciB0YWJsZSA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCd0YWJsZScpO1xuICAgICAgdmFyIHJvd0hlYWRlcnNHb0luVGhlYWQgPSBoZWFkZXJUeXBlICE9PSAnY2VsbHMnO1xuICAgICAgc2V0QWxsJDEodGFibGUsIHJlbmRlck9wdHMuc3R5bGVzKTtcbiAgICAgIHNldEFsbCh0YWJsZSwgcmVuZGVyT3B0cy5hdHRyaWJ1dGVzKTtcbiAgICAgIGlmIChyZW5kZXJPcHRzLmNvbEdyb3Vwcykge1xuICAgICAgICBhcHBlbmQodGFibGUsIGNyZWF0ZUdyb3VwUm93KGNvbHVtbnMpKTtcbiAgICAgIH1cbiAgICAgIHZhciBhY3R1YWxSb3dIZWFkZXJzID0gTWF0aC5taW4ocm93cywgcm93SGVhZGVycyk7XG4gICAgICBpZiAocm93SGVhZGVyc0dvSW5UaGVhZCAmJiByb3dIZWFkZXJzID4gMCkge1xuICAgICAgICB2YXIgdGhlYWQgPSBTdWdhckVsZW1lbnQuZnJvbVRhZygndGhlYWQnKTtcbiAgICAgICAgYXBwZW5kKHRhYmxlLCB0aGVhZCk7XG4gICAgICAgIHZhciB0aGVhZFJvd0hlYWRlcnMgPSBoZWFkZXJUeXBlID09PSAnc2VjdGlvbkNlbGxzJyA/IGFjdHVhbFJvd0hlYWRlcnMgOiAwO1xuICAgICAgICB2YXIgdGhlYWRSb3dzID0gY3JlYXRlUm93cyhyb3dIZWFkZXJzLCBjb2x1bW5zLCB0aGVhZFJvd0hlYWRlcnMsIGNvbHVtbkhlYWRlcnMpO1xuICAgICAgICBhcHBlbmQkMSh0aGVhZCwgdGhlYWRSb3dzKTtcbiAgICAgIH1cbiAgICAgIHZhciB0Ym9keSA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCd0Ym9keScpO1xuICAgICAgYXBwZW5kKHRhYmxlLCB0Ym9keSk7XG4gICAgICB2YXIgbnVtUm93cyA9IHJvd0hlYWRlcnNHb0luVGhlYWQgPyByb3dzIC0gYWN0dWFsUm93SGVhZGVycyA6IHJvd3M7XG4gICAgICB2YXIgbnVtUm93SGVhZGVycyA9IHJvd0hlYWRlcnNHb0luVGhlYWQgPyAwIDogcm93SGVhZGVycztcbiAgICAgIHZhciB0Ym9keVJvd3MgPSBjcmVhdGVSb3dzKG51bVJvd3MsIGNvbHVtbnMsIG51bVJvd0hlYWRlcnMsIGNvbHVtbkhlYWRlcnMpO1xuICAgICAgYXBwZW5kJDEodGJvZHksIHRib2R5Um93cyk7XG4gICAgICByZXR1cm4gdGFibGU7XG4gICAgfTtcblxuICAgIHZhciBnZXQkYiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5kb20uaW5uZXJIVE1MO1xuICAgIH07XG4gICAgdmFyIGdldE91dGVyJDIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIGNvbnRhaW5lciA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdkaXYnKTtcbiAgICAgIHZhciBjbG9uZSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsZW1lbnQuZG9tLmNsb25lTm9kZSh0cnVlKSk7XG4gICAgICBhcHBlbmQoY29udGFpbmVyLCBjbG9uZSk7XG4gICAgICByZXR1cm4gZ2V0JGIoY29udGFpbmVyKTtcbiAgICB9O1xuXG4gICAgdmFyIHBsYWNlQ2FyZXRJbkNlbGwgPSBmdW5jdGlvbiAoZWRpdG9yLCBjZWxsKSB7XG4gICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNlbGVjdChjZWxsLmRvbSwgdHJ1ZSk7XG4gICAgICBlZGl0b3Iuc2VsZWN0aW9uLmNvbGxhcHNlKHRydWUpO1xuICAgIH07XG4gICAgdmFyIHNlbGVjdEZpcnN0Q2VsbEluVGFibGUgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YWJsZUVsbSkge1xuICAgICAgZGVzY2VuZGFudCQxKHRhYmxlRWxtLCAndGQsdGgnKS5lYWNoKGN1cnJ5KHBsYWNlQ2FyZXRJbkNlbGwsIGVkaXRvcikpO1xuICAgIH07XG4gICAgdmFyIGZpcmVFdmVudHMgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YWJsZSkge1xuICAgICAgZWFjaChkZXNjZW5kYW50cyQxKHRhYmxlLCAndHInKSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICBmaXJlTmV3Um93KGVkaXRvciwgcm93LmRvbSk7XG4gICAgICAgIGVhY2goZGVzY2VuZGFudHMkMShyb3csICd0aCx0ZCcpLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIGZpcmVOZXdDZWxsKGVkaXRvciwgY2VsbC5kb20pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGlzUGVyY2VudGFnZSQxID0gZnVuY3Rpb24gKHdpZHRoKSB7XG4gICAgICByZXR1cm4gaXNTdHJpbmcod2lkdGgpICYmIHdpZHRoLmluZGV4T2YoJyUnKSAhPT0gLTE7XG4gICAgfTtcbiAgICB2YXIgaW5zZXJ0JDEgPSBmdW5jdGlvbiAoZWRpdG9yLCBjb2x1bW5zLCByb3dzLCBjb2xIZWFkZXJzLCByb3dIZWFkZXJzKSB7XG4gICAgICB2YXIgZGVmYXVsdFN0eWxlcyA9IGdldERlZmF1bHRTdHlsZXMoZWRpdG9yKTtcbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBzdHlsZXM6IGRlZmF1bHRTdHlsZXMsXG4gICAgICAgIGF0dHJpYnV0ZXM6IGdldERlZmF1bHRBdHRyaWJ1dGVzKGVkaXRvciksXG4gICAgICAgIGNvbEdyb3VwczogdXNlQ29sdW1uR3JvdXAoZWRpdG9yKVxuICAgICAgfTtcbiAgICAgIGVkaXRvci51bmRvTWFuYWdlci5pZ25vcmUoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdGFibGUgPSByZW5kZXIkMShyb3dzLCBjb2x1bW5zLCByb3dIZWFkZXJzLCBjb2xIZWFkZXJzLCBnZXRUYWJsZUhlYWRlclR5cGUoZWRpdG9yKSwgb3B0aW9ucyk7XG4gICAgICAgIHNldCh0YWJsZSwgJ2RhdGEtbWNlLWlkJywgJ19fbWNlJyk7XG4gICAgICAgIHZhciBodG1sID0gZ2V0T3V0ZXIkMih0YWJsZSk7XG4gICAgICAgIGVkaXRvci5pbnNlcnRDb250ZW50KGh0bWwpO1xuICAgICAgICBlZGl0b3IuYWRkVmlzdWFsKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZXNjZW5kYW50JDEoZ2V0Qm9keSQxKGVkaXRvciksICd0YWJsZVtkYXRhLW1jZS1pZD1cIl9fbWNlXCJdJykubWFwKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICBpZiAoaXNQaXhlbHNGb3JjZWQoZWRpdG9yKSkge1xuICAgICAgICAgIGVuZm9yY2VQaXhlbHMoZWRpdG9yLCB0YWJsZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNSZXNwb25zaXZlRm9yY2VkKGVkaXRvcikpIHtcbiAgICAgICAgICBlbmZvcmNlTm9uZSh0YWJsZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNQZXJjZW50YWdlc0ZvcmNlZChlZGl0b3IpIHx8IGlzUGVyY2VudGFnZSQxKGRlZmF1bHRTdHlsZXMud2lkdGgpKSB7XG4gICAgICAgICAgZW5mb3JjZVBlcmNlbnRhZ2UoZWRpdG9yLCB0YWJsZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVtb3ZlRGF0YVN0eWxlKHRhYmxlKTtcbiAgICAgICAgcmVtb3ZlKHRhYmxlLCAnZGF0YS1tY2UtaWQnKTtcbiAgICAgICAgZmlyZUV2ZW50cyhlZGl0b3IsIHRhYmxlKTtcbiAgICAgICAgc2VsZWN0Rmlyc3RDZWxsSW5UYWJsZShlZGl0b3IsIHRhYmxlKTtcbiAgICAgICAgcmV0dXJuIHRhYmxlLmRvbTtcbiAgICAgIH0pLmdldE9yKG51bGwpO1xuICAgIH07XG4gICAgdmFyIGluc2VydFRhYmxlV2l0aERhdGFWYWxpZGF0aW9uID0gZnVuY3Rpb24gKGVkaXRvciwgcm93cywgY29sdW1ucywgb3B0aW9ucywgZXJyb3JNc2cpIHtcbiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgICAgfVxuICAgICAgdmFyIGNoZWNrSW5wdXQgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgIHJldHVybiBpc051bWJlcih2YWwpICYmIHZhbCA+IDA7XG4gICAgICB9O1xuICAgICAgaWYgKGNoZWNrSW5wdXQocm93cykgJiYgY2hlY2tJbnB1dChjb2x1bW5zKSkge1xuICAgICAgICB2YXIgaGVhZGVyUm93cyA9IG9wdGlvbnMuaGVhZGVyUm93cyB8fCAwO1xuICAgICAgICB2YXIgaGVhZGVyQ29sdW1ucyA9IG9wdGlvbnMuaGVhZGVyQ29sdW1ucyB8fCAwO1xuICAgICAgICByZXR1cm4gaW5zZXJ0JDEoZWRpdG9yLCBjb2x1bW5zLCByb3dzLCBoZWFkZXJDb2x1bW5zLCBoZWFkZXJSb3dzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNc2cpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGdldENsaXBib2FyZEVsZW1lbnRzID0gZnVuY3Rpb24gKGdldENsaXBib2FyZCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldENsaXBib2FyZCgpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVsZW1zKSB7XG4gICAgICAgICAgcmV0dXJuIG1hcChlbGVtcywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBlLmRvbTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHNldENsaXBib2FyZEVsZW1lbnRzID0gZnVuY3Rpb24gKHNldENsaXBib2FyZCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtcykge1xuICAgICAgICB2YXIgZWxtc09wdCA9IGVsZW1zLmxlbmd0aCA+IDAgPyBPcHRpb25hbC5zb21lKGZyb21Eb20kMShlbGVtcykpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICBzZXRDbGlwYm9hcmQoZWxtc09wdCk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGluc2VydFRhYmxlID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjb2x1bW5zLCByb3dzLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHtcbiAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRhYmxlID0gaW5zZXJ0VGFibGVXaXRoRGF0YVZhbGlkYXRpb24oZWRpdG9yLCByb3dzLCBjb2x1bW5zLCBvcHRpb25zLCAnSW52YWxpZCB2YWx1ZXMgZm9yIGluc2VydFRhYmxlIC0gcm93cyBhbmQgY29sdW1ucyB2YWx1ZXMgYXJlIHJlcXVpcmVkIHRvIGluc2VydCBhIHRhYmxlLicpO1xuICAgICAgICBlZGl0b3IudW5kb01hbmFnZXIuYWRkKCk7XG4gICAgICAgIHJldHVybiB0YWJsZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0QXBpID0gZnVuY3Rpb24gKGVkaXRvciwgY2xpcGJvYXJkLCByZXNpemVIYW5kbGVyLCBzZWxlY3Rpb25UYXJnZXRzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbnNlcnRUYWJsZTogaW5zZXJ0VGFibGUoZWRpdG9yKSxcbiAgICAgICAgc2V0Q2xpcGJvYXJkUm93czogc2V0Q2xpcGJvYXJkRWxlbWVudHMoY2xpcGJvYXJkLnNldFJvd3MpLFxuICAgICAgICBnZXRDbGlwYm9hcmRSb3dzOiBnZXRDbGlwYm9hcmRFbGVtZW50cyhjbGlwYm9hcmQuZ2V0Um93cyksXG4gICAgICAgIHNldENsaXBib2FyZENvbHM6IHNldENsaXBib2FyZEVsZW1lbnRzKGNsaXBib2FyZC5zZXRDb2x1bW5zKSxcbiAgICAgICAgZ2V0Q2xpcGJvYXJkQ29sczogZ2V0Q2xpcGJvYXJkRWxlbWVudHMoY2xpcGJvYXJkLmdldENvbHVtbnMpLFxuICAgICAgICByZXNpemVIYW5kbGVyOiByZXNpemVIYW5kbGVyLFxuICAgICAgICBzZWxlY3Rpb25UYXJnZXRzOiBzZWxlY3Rpb25UYXJnZXRzXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgY29uc3RyYWluU3BhbiA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICAgIHZhciBjdXJyZW50Q29sc3BhbiA9IGdldEF0dHJWYWx1ZShlbGVtZW50LCBwcm9wZXJ0eSwgMSk7XG4gICAgICBpZiAodmFsdWUgPT09IDEgfHwgY3VycmVudENvbHNwYW4gPD0gMSkge1xuICAgICAgICByZW1vdmUoZWxlbWVudCwgcHJvcGVydHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0KGVsZW1lbnQsIHByb3BlcnR5LCBNYXRoLm1pbih2YWx1ZSwgY3VycmVudENvbHNwYW4pKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBnZW5lcmF0ZUNvbEdyb3VwID0gZnVuY3Rpb24gKGhvdXNlLCBtaW5Db2xSYW5nZSwgbWF4Q29sUmFuZ2UpIHtcbiAgICAgIGlmIChXYXJlaG91c2UuaGFzQ29sdW1ucyhob3VzZSkpIHtcbiAgICAgICAgdmFyIGNvbHNUb0NvcHkgPSBmaWx0ZXIoV2FyZWhvdXNlLmp1c3RDb2x1bW5zKGhvdXNlKSwgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgIHJldHVybiBjb2wuY29sdW1uID49IG1pbkNvbFJhbmdlICYmIGNvbC5jb2x1bW4gPCBtYXhDb2xSYW5nZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBjb3BpZWRDb2xzID0gbWFwKGNvbHNUb0NvcHksIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgdmFyIGNsb25lZENvbCA9IGRlZXAoYy5lbGVtZW50KTtcbiAgICAgICAgICBjb25zdHJhaW5TcGFuKGNsb25lZENvbCwgJ3NwYW4nLCBtYXhDb2xSYW5nZSAtIG1pbkNvbFJhbmdlKTtcbiAgICAgICAgICByZXR1cm4gY2xvbmVkQ29sO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGZha2VDb2xncm91cCA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCdjb2xncm91cCcpO1xuICAgICAgICBhcHBlbmQkMShmYWtlQ29sZ3JvdXAsIGNvcGllZENvbHMpO1xuICAgICAgICByZXR1cm4gW2Zha2VDb2xncm91cF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZ2VuZXJhdGVSb3dzID0gZnVuY3Rpb24gKGhvdXNlLCBtaW5Db2xSYW5nZSwgbWF4Q29sUmFuZ2UpIHtcbiAgICAgIHJldHVybiBtYXAoaG91c2UuYWxsLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIHZhciBjZWxsc1RvQ29weSA9IGZpbHRlcihyb3cuY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGNlbGwuY29sdW1uID49IG1pbkNvbFJhbmdlICYmIGNlbGwuY29sdW1uIDwgbWF4Q29sUmFuZ2U7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgY29waWVkQ2VsbHMgPSBtYXAoY2VsbHNUb0NvcHksIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgdmFyIGNsb25lZENlbGwgPSBkZWVwKGNlbGwuZWxlbWVudCk7XG4gICAgICAgICAgY29uc3RyYWluU3BhbihjbG9uZWRDZWxsLCAnY29sc3BhbicsIG1heENvbFJhbmdlIC0gbWluQ29sUmFuZ2UpO1xuICAgICAgICAgIHJldHVybiBjbG9uZWRDZWxsO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGZha2VUUiA9IFN1Z2FyRWxlbWVudC5mcm9tVGFnKCd0cicpO1xuICAgICAgICBhcHBlbmQkMShmYWtlVFIsIGNvcGllZENlbGxzKTtcbiAgICAgICAgcmV0dXJuIGZha2VUUjtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGNvcHlDb2xzID0gZnVuY3Rpb24gKHRhYmxlLCB0YXJnZXQpIHtcbiAgICAgIHZhciBob3VzZSA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgdmFyIGRldGFpbHMgPSBvblVubG9ja2VkQ2VsbHMoaG91c2UsIHRhcmdldCk7XG4gICAgICByZXR1cm4gZGV0YWlscy5tYXAoZnVuY3Rpb24gKHNlbGVjdGVkQ2VsbHMpIHtcbiAgICAgICAgdmFyIGxhc3RTZWxlY3RlZENlbGwgPSBzZWxlY3RlZENlbGxzW3NlbGVjdGVkQ2VsbHMubGVuZ3RoIC0gMV07XG4gICAgICAgIHZhciBtaW5Db2xSYW5nZSA9IHNlbGVjdGVkQ2VsbHNbMF0uY29sdW1uO1xuICAgICAgICB2YXIgbWF4Q29sUmFuZ2UgPSBsYXN0U2VsZWN0ZWRDZWxsLmNvbHVtbiArIGxhc3RTZWxlY3RlZENlbGwuY29sc3BhbjtcbiAgICAgICAgdmFyIGZha2VDb2xHcm91cHMgPSBnZW5lcmF0ZUNvbEdyb3VwKGhvdXNlLCBtaW5Db2xSYW5nZSwgbWF4Q29sUmFuZ2UpO1xuICAgICAgICB2YXIgZmFrZVJvd3MgPSBnZW5lcmF0ZVJvd3MoaG91c2UsIG1pbkNvbFJhbmdlLCBtYXhDb2xSYW5nZSk7XG4gICAgICAgIHJldHVybiBfX3NwcmVhZEFycmF5cyhmYWtlQ29sR3JvdXBzLCBmYWtlUm93cyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGNvcHlSb3dzID0gZnVuY3Rpb24gKHRhYmxlLCB0YXJnZXQsIGdlbmVyYXRvcnMpIHtcbiAgICAgIHZhciB3YXJlaG91c2UgPSBXYXJlaG91c2UuZnJvbVRhYmxlKHRhYmxlKTtcbiAgICAgIHZhciBkZXRhaWxzID0gb25DZWxscyh3YXJlaG91c2UsIHRhcmdldCk7XG4gICAgICByZXR1cm4gZGV0YWlscy5iaW5kKGZ1bmN0aW9uIChzZWxlY3RlZENlbGxzKSB7XG4gICAgICAgIHZhciBncmlkID0gdG9HcmlkKHdhcmVob3VzZSwgZ2VuZXJhdG9ycywgZmFsc2UpO1xuICAgICAgICB2YXIgcm93cyA9IGV4dHJhY3RHcmlkRGV0YWlscyhncmlkKS5yb3dzO1xuICAgICAgICB2YXIgc2xpY2VkR3JpZCA9IHJvd3Muc2xpY2Uoc2VsZWN0ZWRDZWxsc1swXS5yb3csIHNlbGVjdGVkQ2VsbHNbc2VsZWN0ZWRDZWxscy5sZW5ndGggLSAxXS5yb3cgKyBzZWxlY3RlZENlbGxzW3NlbGVjdGVkQ2VsbHMubGVuZ3RoIC0gMV0ucm93c3Bhbik7XG4gICAgICAgIHZhciBmaWx0ZXJlZEdyaWQgPSBiaW5kKHNsaWNlZEdyaWQsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICB2YXIgbmV3Q2VsbHMgPSBmaWx0ZXIocm93LmNlbGxzLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgICAgcmV0dXJuICFjZWxsLmlzTG9ja2VkO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBuZXdDZWxscy5sZW5ndGggPiAwID8gW19fYXNzaWduKF9fYXNzaWduKHt9LCByb3cpLCB7IGNlbGxzOiBuZXdDZWxscyB9KV0gOiBbXTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBzbGljZWREZXRhaWxzID0gdG9EZXRhaWxMaXN0KGZpbHRlcmVkR3JpZCwgZ2VuZXJhdG9ycyk7XG4gICAgICAgIHJldHVybiBzb21lSWYoc2xpY2VkRGV0YWlscy5sZW5ndGggPiAwLCBzbGljZWREZXRhaWxzKTtcbiAgICAgIH0pLm1hcChmdW5jdGlvbiAoc2xpY2VkRGV0YWlscykge1xuICAgICAgICByZXR1cm4gY29weSQyKHNsaWNlZERldGFpbHMpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkMSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVG9vbHMnKTtcblxuICAgIHZhciBnZXRURFRIT3ZlcmFsbFN0eWxlID0gZnVuY3Rpb24gKGRvbSwgZWxtLCBuYW1lKSB7XG4gICAgICB2YXIgY2VsbHMgPSBkb20uc2VsZWN0KCd0ZCx0aCcsIGVsbSk7XG4gICAgICB2YXIgZmlyc3RDaGlsZFN0eWxlO1xuICAgICAgdmFyIGNoZWNrQ2hpbGRyZW4gPSBmdW5jdGlvbiAoZmlyc3RDaGlsZFN0eWxlLCBlbG1zKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBjdXJyZW50U3R5bGUgPSBkb20uZ2V0U3R5bGUoZWxtc1tpXSwgbmFtZSk7XG4gICAgICAgICAgaWYgKHR5cGVvZiBmaXJzdENoaWxkU3R5bGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBmaXJzdENoaWxkU3R5bGUgPSBjdXJyZW50U3R5bGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmaXJzdENoaWxkU3R5bGUgIT09IGN1cnJlbnRTdHlsZSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlyc3RDaGlsZFN0eWxlO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBjaGVja0NoaWxkcmVuKGZpcnN0Q2hpbGRTdHlsZSwgY2VsbHMpO1xuICAgIH07XG4gICAgdmFyIGFwcGx5QWxpZ24gPSBmdW5jdGlvbiAoZWRpdG9yLCBlbG0sIG5hbWUpIHtcbiAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgIGVkaXRvci5mb3JtYXR0ZXIuYXBwbHkoJ2FsaWduJyArIG5hbWUsIHt9LCBlbG0pO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGFwcGx5VkFsaWduID0gZnVuY3Rpb24gKGVkaXRvciwgZWxtLCBuYW1lKSB7XG4gICAgICBpZiAobmFtZSkge1xuICAgICAgICBlZGl0b3IuZm9ybWF0dGVyLmFwcGx5KCd2YWxpZ24nICsgbmFtZSwge30sIGVsbSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgdW5BcHBseUFsaWduID0gZnVuY3Rpb24gKGVkaXRvciwgZWxtKSB7XG4gICAgICBnbG9iYWwkMS5lYWNoKCdsZWZ0IGNlbnRlciByaWdodCcuc3BsaXQoJyAnKSwgZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgZWRpdG9yLmZvcm1hdHRlci5yZW1vdmUoJ2FsaWduJyArIG5hbWUsIHt9LCBlbG0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdW5BcHBseVZBbGlnbiA9IGZ1bmN0aW9uIChlZGl0b3IsIGVsbSkge1xuICAgICAgZ2xvYmFsJDEuZWFjaCgndG9wIG1pZGRsZSBib3R0b20nLnNwbGl0KCcgJyksIGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIGVkaXRvci5mb3JtYXR0ZXIucmVtb3ZlKCd2YWxpZ24nICsgbmFtZSwge30sIGVsbSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGlzTGlzdEdyb3VwID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHJldHVybiBoYXNOb25OdWxsYWJsZUtleShpdGVtLCAnbWVudScpO1xuICAgIH07XG4gICAgdmFyIGJ1aWxkTGlzdEl0ZW1zID0gZnVuY3Rpb24gKGlucHV0TGlzdCwgc3RhcnRJdGVtcykge1xuICAgICAgdmFyIGFwcGVuZEl0ZW1zID0gZnVuY3Rpb24gKHZhbHVlcywgYWNjKSB7XG4gICAgICAgIHJldHVybiBhY2MuY29uY2F0KG1hcCh2YWx1ZXMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgdmFyIHRleHQgPSBpdGVtLnRleHQgfHwgaXRlbS50aXRsZTtcbiAgICAgICAgICBpZiAoaXNMaXN0R3JvdXAoaXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICAgIGl0ZW1zOiBidWlsZExpc3RJdGVtcyhpdGVtLm1lbnUpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gYXBwZW5kSXRlbXMoaW5wdXRMaXN0LCBzdGFydEl0ZW1zIHx8IFtdKTtcbiAgICB9O1xuICAgIHZhciByZ2JUb0hleCA9IGZ1bmN0aW9uIChkb20pIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHN0YXJ0c1dpdGgodmFsdWUsICdyZ2InKSA/IGRvbS50b0hleCh2YWx1ZSkgOiB2YWx1ZTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZXh0cmFjdEFkdmFuY2VkU3R5bGVzID0gZnVuY3Rpb24gKGRvbSwgZWxtKSB7XG4gICAgICB2YXIgZWxlbWVudCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVsbSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBib3JkZXJ3aWR0aDogZ2V0UmF3KGVsZW1lbnQsICdib3JkZXItd2lkdGgnKS5nZXRPcignJyksXG4gICAgICAgIGJvcmRlcnN0eWxlOiBnZXRSYXcoZWxlbWVudCwgJ2JvcmRlci1zdHlsZScpLmdldE9yKCcnKSxcbiAgICAgICAgYm9yZGVyY29sb3I6IGdldFJhdyhlbGVtZW50LCAnYm9yZGVyLWNvbG9yJykubWFwKHJnYlRvSGV4KGRvbSkpLmdldE9yKCcnKSxcbiAgICAgICAgYmFja2dyb3VuZGNvbG9yOiBnZXRSYXcoZWxlbWVudCwgJ2JhY2tncm91bmQtY29sb3InKS5tYXAocmdiVG9IZXgoZG9tKSkuZ2V0T3IoJycpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGdldFNoYXJlZFZhbHVlcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgYmFzZURhdGEgPSBkYXRhWzBdO1xuICAgICAgdmFyIGNvbXBhcmlzb25EYXRhID0gZGF0YS5zbGljZSgxKTtcbiAgICAgIGVhY2goY29tcGFyaXNvbkRhdGEsIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICBlYWNoKGtleXMoYmFzZURhdGEpLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgZWFjaCQxKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbVZhbHVlLCBpdGVtS2V5KSB7XG4gICAgICAgICAgICB2YXIgY29tcGFyaXNvblZhbHVlID0gYmFzZURhdGFba2V5XTtcbiAgICAgICAgICAgIGlmIChjb21wYXJpc29uVmFsdWUgIT09ICcnICYmIGtleSA9PT0gaXRlbUtleSkge1xuICAgICAgICAgICAgICBpZiAoY29tcGFyaXNvblZhbHVlICE9PSBpdGVtVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBiYXNlRGF0YVtrZXldID0gJyc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBiYXNlRGF0YTtcbiAgICB9O1xuICAgIHZhciBnZXRBZHZhbmNlZFRhYiA9IGZ1bmN0aW9uIChkaWFsb2dOYW1lKSB7XG4gICAgICB2YXIgYWR2VGFiSXRlbXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYm9yZGVyc3R5bGUnLFxuICAgICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgICBsYWJlbDogJ0JvcmRlciBzdHlsZScsXG4gICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGV4dDogJ1NlbGVjdC4uLicsXG4gICAgICAgICAgICAgIHZhbHVlOiAnJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGV4dDogJ1NvbGlkJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICdzb2xpZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdEb3R0ZWQnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2RvdHRlZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdEYXNoZWQnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2Rhc2hlZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdEb3VibGUnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2RvdWJsZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdHcm9vdmUnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2dyb292ZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdSaWRnZScsXG4gICAgICAgICAgICAgIHZhbHVlOiAncmlkZ2UnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0ZXh0OiAnSW5zZXQnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2luc2V0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGV4dDogJ091dHNldCcsXG4gICAgICAgICAgICAgIHZhbHVlOiAnb3V0c2V0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGV4dDogJ05vbmUnLFxuICAgICAgICAgICAgICB2YWx1ZTogJ25vbmUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0ZXh0OiAnSGlkZGVuJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICdoaWRkZW4nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2JvcmRlcmNvbG9yJyxcbiAgICAgICAgICB0eXBlOiAnY29sb3JpbnB1dCcsXG4gICAgICAgICAgbGFiZWw6ICdCb3JkZXIgY29sb3InXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnYmFja2dyb3VuZGNvbG9yJyxcbiAgICAgICAgICB0eXBlOiAnY29sb3JpbnB1dCcsXG4gICAgICAgICAgbGFiZWw6ICdCYWNrZ3JvdW5kIGNvbG9yJ1xuICAgICAgICB9XG4gICAgICBdO1xuICAgICAgdmFyIGJvcmRlcldpZHRoID0ge1xuICAgICAgICBuYW1lOiAnYm9yZGVyd2lkdGgnLFxuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBsYWJlbDogJ0JvcmRlciB3aWR0aCdcbiAgICAgIH07XG4gICAgICB2YXIgaXRlbXMgPSBkaWFsb2dOYW1lID09PSAnY2VsbCcgPyBbYm9yZGVyV2lkdGhdLmNvbmNhdChhZHZUYWJJdGVtcykgOiBhZHZUYWJJdGVtcztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpdGxlOiAnQWR2YW5jZWQnLFxuICAgICAgICBuYW1lOiAnYWR2YW5jZWQnLFxuICAgICAgICBpdGVtczogaXRlbXNcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0QWxpZ25tZW50ID0gZnVuY3Rpb24gKGZvcm1hdHMsIGZvcm1hdE5hbWUsIGVkaXRvciwgZWxtKSB7XG4gICAgICByZXR1cm4gZmluZChmb3JtYXRzLCBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmZvcm1hdHRlci5tYXRjaE5vZGUoZWxtLCBmb3JtYXROYW1lICsgbmFtZSk7XG4gICAgICB9KS5nZXRPcignJyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SEFsaWdubWVudCA9IGN1cnJ5KGdldEFsaWdubWVudCwgW1xuICAgICAgJ2xlZnQnLFxuICAgICAgJ2NlbnRlcicsXG4gICAgICAncmlnaHQnXG4gICAgXSwgJ2FsaWduJyk7XG4gICAgdmFyIGdldFZBbGlnbm1lbnQgPSBjdXJyeShnZXRBbGlnbm1lbnQsIFtcbiAgICAgICd0b3AnLFxuICAgICAgJ21pZGRsZScsXG4gICAgICAnYm90dG9tJ1xuICAgIF0sICd2YWxpZ24nKTtcbiAgICB2YXIgZXh0cmFjdERhdGFGcm9tU2V0dGluZ3MgPSBmdW5jdGlvbiAoZWRpdG9yLCBoYXNBZHZUYWJsZVRhYikge1xuICAgICAgdmFyIHN0eWxlID0gZ2V0RGVmYXVsdFN0eWxlcyhlZGl0b3IpO1xuICAgICAgdmFyIGF0dHJzID0gZ2V0RGVmYXVsdEF0dHJpYnV0ZXMoZWRpdG9yKTtcbiAgICAgIHZhciBleHRyYWN0QWR2YW5jZWRTdHlsZURhdGEgPSBmdW5jdGlvbiAoZG9tKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYm9yZGVyc3R5bGU6IGdldCQxKHN0eWxlLCAnYm9yZGVyLXN0eWxlJykuZ2V0T3IoJycpLFxuICAgICAgICAgIGJvcmRlcmNvbG9yOiByZ2JUb0hleChkb20pKGdldCQxKHN0eWxlLCAnYm9yZGVyLWNvbG9yJykuZ2V0T3IoJycpKSxcbiAgICAgICAgICBiYWNrZ3JvdW5kY29sb3I6IHJnYlRvSGV4KGRvbSkoZ2V0JDEoc3R5bGUsICdiYWNrZ3JvdW5kLWNvbG9yJykuZ2V0T3IoJycpKVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBkZWZhdWx0RGF0YSA9IHtcbiAgICAgICAgaGVpZ2h0OiAnJyxcbiAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgY2VsbHNwYWNpbmc6ICcnLFxuICAgICAgICBjZWxscGFkZGluZzogJycsXG4gICAgICAgIGNhcHRpb246IGZhbHNlLFxuICAgICAgICBjbGFzczogJycsXG4gICAgICAgIGFsaWduOiAnJyxcbiAgICAgICAgYm9yZGVyOiAnJ1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRCb3JkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBib3JkZXJXaWR0aCA9IHN0eWxlWydib3JkZXItd2lkdGgnXTtcbiAgICAgICAgaWYgKHNob3VsZFN0eWxlV2l0aENzcyhlZGl0b3IpICYmIGJvcmRlcldpZHRoKSB7XG4gICAgICAgICAgcmV0dXJuIHsgYm9yZGVyOiBib3JkZXJXaWR0aCB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBnZXQkMShhdHRycywgJ2JvcmRlcicpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGJvcmRlcikge1xuICAgICAgICAgIHJldHVybiB7IGJvcmRlcjogYm9yZGVyIH07XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBhZHZTdHlsZSA9IGhhc0FkdlRhYmxlVGFiID8gZXh0cmFjdEFkdmFuY2VkU3R5bGVEYXRhKGVkaXRvci5kb20pIDoge307XG4gICAgICB2YXIgZ2V0Q2VsbFBhZGRpbmdDZWxsU3BhY2luZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNwYWNpbmcgPSBnZXQkMShzdHlsZSwgJ2JvcmRlci1zcGFjaW5nJykub3IoZ2V0JDEoYXR0cnMsICdjZWxsc3BhY2luZycpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH0sIGZ1bmN0aW9uIChjZWxsc3BhY2luZykge1xuICAgICAgICAgIHJldHVybiB7IGNlbGxzcGFjaW5nOiBjZWxsc3BhY2luZyB9O1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHBhZGRpbmcgPSBnZXQkMShzdHlsZSwgJ2JvcmRlci1wYWRkaW5nJykub3IoZ2V0JDEoYXR0cnMsICdjZWxscGFkZGluZycpKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH0sIGZ1bmN0aW9uIChjZWxscGFkZGluZykge1xuICAgICAgICAgIHJldHVybiB7IGNlbGxwYWRkaW5nOiBjZWxscGFkZGluZyB9O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBzcGFjaW5nKSwgcGFkZGluZyk7XG4gICAgICB9O1xuICAgICAgdmFyIGRhdGEgPSBfX2Fzc2lnbihfX2Fzc2lnbihfX2Fzc2lnbihfX2Fzc2lnbihfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZGVmYXVsdERhdGEpLCBzdHlsZSksIGF0dHJzKSwgYWR2U3R5bGUpLCBnZXRCb3JkZXIoKSksIGdldENlbGxQYWRkaW5nQ2VsbFNwYWNpbmcoKSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9O1xuICAgIHZhciBleHRyYWN0RGF0YUZyb21UYWJsZUVsZW1lbnQgPSBmdW5jdGlvbiAoZWRpdG9yLCBlbG0sIGhhc0FkdlRhYmxlVGFiKSB7XG4gICAgICB2YXIgZ2V0Qm9yZGVyID0gZnVuY3Rpb24gKGRvbSwgZWxtKSB7XG4gICAgICAgIHZhciBvcHRCb3JkZXJXaWR0aCA9IGdldFJhdyhTdWdhckVsZW1lbnQuZnJvbURvbShlbG0pLCAnYm9yZGVyLXdpZHRoJyk7XG4gICAgICAgIGlmIChzaG91bGRTdHlsZVdpdGhDc3MoZWRpdG9yKSAmJiBvcHRCb3JkZXJXaWR0aC5pc1NvbWUoKSkge1xuICAgICAgICAgIHJldHVybiBvcHRCb3JkZXJXaWR0aC5nZXRPcignJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRvbS5nZXRBdHRyaWIoZWxtLCAnYm9yZGVyJykgfHwgZ2V0VERUSE92ZXJhbGxTdHlsZShlZGl0b3IuZG9tLCBlbG0sICdib3JkZXItd2lkdGgnKSB8fCBnZXRURFRIT3ZlcmFsbFN0eWxlKGVkaXRvci5kb20sIGVsbSwgJ2JvcmRlcicpO1xuICAgICAgfTtcbiAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tO1xuICAgICAgcmV0dXJuIF9fYXNzaWduKHtcbiAgICAgICAgd2lkdGg6IGRvbS5nZXRTdHlsZShlbG0sICd3aWR0aCcpIHx8IGRvbS5nZXRBdHRyaWIoZWxtLCAnd2lkdGgnKSxcbiAgICAgICAgaGVpZ2h0OiBkb20uZ2V0U3R5bGUoZWxtLCAnaGVpZ2h0JykgfHwgZG9tLmdldEF0dHJpYihlbG0sICdoZWlnaHQnKSxcbiAgICAgICAgY2VsbHNwYWNpbmc6IGRvbS5nZXRTdHlsZShlbG0sICdib3JkZXItc3BhY2luZycpIHx8IGRvbS5nZXRBdHRyaWIoZWxtLCAnY2VsbHNwYWNpbmcnKSxcbiAgICAgICAgY2VsbHBhZGRpbmc6IGRvbS5nZXRBdHRyaWIoZWxtLCAnY2VsbHBhZGRpbmcnKSB8fCBnZXRURFRIT3ZlcmFsbFN0eWxlKGVkaXRvci5kb20sIGVsbSwgJ3BhZGRpbmcnKSxcbiAgICAgICAgYm9yZGVyOiBnZXRCb3JkZXIoZG9tLCBlbG0pLFxuICAgICAgICBjYXB0aW9uOiAhIWRvbS5zZWxlY3QoJ2NhcHRpb24nLCBlbG0pWzBdLFxuICAgICAgICBjbGFzczogZG9tLmdldEF0dHJpYihlbG0sICdjbGFzcycsICcnKSxcbiAgICAgICAgYWxpZ246IGdldEhBbGlnbm1lbnQoZWRpdG9yLCBlbG0pXG4gICAgICB9LCBoYXNBZHZUYWJsZVRhYiA/IGV4dHJhY3RBZHZhbmNlZFN0eWxlcyhkb20sIGVsbSkgOiB7fSk7XG4gICAgfTtcbiAgICB2YXIgZXh0cmFjdERhdGFGcm9tUm93RWxlbWVudCA9IGZ1bmN0aW9uIChlZGl0b3IsIGVsbSwgaGFzQWR2YW5jZWRSb3dUYWIpIHtcbiAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tO1xuICAgICAgcmV0dXJuIF9fYXNzaWduKHtcbiAgICAgICAgaGVpZ2h0OiBkb20uZ2V0U3R5bGUoZWxtLCAnaGVpZ2h0JykgfHwgZG9tLmdldEF0dHJpYihlbG0sICdoZWlnaHQnKSxcbiAgICAgICAgY2xhc3M6IGRvbS5nZXRBdHRyaWIoZWxtLCAnY2xhc3MnLCAnJyksXG4gICAgICAgIHR5cGU6IGdldFJvd1R5cGUoZWRpdG9yLCBlbG0pLFxuICAgICAgICBhbGlnbjogZ2V0SEFsaWdubWVudChlZGl0b3IsIGVsbSlcbiAgICAgIH0sIGhhc0FkdmFuY2VkUm93VGFiID8gZXh0cmFjdEFkdmFuY2VkU3R5bGVzKGRvbSwgZWxtKSA6IHt9KTtcbiAgICB9O1xuICAgIHZhciBleHRyYWN0RGF0YUZyb21DZWxsRWxlbWVudCA9IGZ1bmN0aW9uIChlZGl0b3IsIGNlbGwsIGhhc0FkdmFuY2VkQ2VsbFRhYiwgY29sdW1uKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBjb2xFbG0gPSBjb2x1bW4uZ2V0T3IoY2VsbCk7XG4gICAgICB2YXIgZ2V0U3R5bGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgc3R5bGUpIHtcbiAgICAgICAgcmV0dXJuIGRvbS5nZXRTdHlsZShlbGVtZW50LCBzdHlsZSkgfHwgZG9tLmdldEF0dHJpYihlbGVtZW50LCBzdHlsZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIF9fYXNzaWduKHtcbiAgICAgICAgd2lkdGg6IGdldFN0eWxlKGNvbEVsbSwgJ3dpZHRoJyksXG4gICAgICAgIGhlaWdodDogZ2V0U3R5bGUoY2VsbCwgJ2hlaWdodCcpLFxuICAgICAgICBzY29wZTogZG9tLmdldEF0dHJpYihjZWxsLCAnc2NvcGUnKSxcbiAgICAgICAgY2VsbHR5cGU6IGdldE5vZGVOYW1lKGNlbGwpLFxuICAgICAgICBjbGFzczogZG9tLmdldEF0dHJpYihjZWxsLCAnY2xhc3MnLCAnJyksXG4gICAgICAgIGhhbGlnbjogZ2V0SEFsaWdubWVudChlZGl0b3IsIGNlbGwpLFxuICAgICAgICB2YWxpZ246IGdldFZBbGlnbm1lbnQoZWRpdG9yLCBjZWxsKVxuICAgICAgfSwgaGFzQWR2YW5jZWRDZWxsVGFiID8gZXh0cmFjdEFkdmFuY2VkU3R5bGVzKGRvbSwgY2VsbCkgOiB7fSk7XG4gICAgfTtcblxuICAgIHZhciBnZXRDbGFzc0xpc3QgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgY2xhc3NlcyA9IGJ1aWxkTGlzdEl0ZW1zKGdldENlbGxDbGFzc0xpc3QoZWRpdG9yKSk7XG4gICAgICBpZiAoY2xhc3Nlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHtcbiAgICAgICAgICBuYW1lOiAnY2xhc3MnLFxuICAgICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgICBsYWJlbDogJ0NsYXNzJyxcbiAgICAgICAgICBpdGVtczogY2xhc3Nlc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcbiAgICB2YXIgY2hpbGRyZW4kMyA9IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3dpZHRoJyxcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbGFiZWw6ICdXaWR0aCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdoZWlnaHQnLFxuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBsYWJlbDogJ0hlaWdodCdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdjZWxsdHlwZScsXG4gICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgbGFiZWw6ICdDZWxsIHR5cGUnLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6ICdDZWxsJyxcbiAgICAgICAgICAgIHZhbHVlOiAndGQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnSGVhZGVyIGNlbGwnLFxuICAgICAgICAgICAgdmFsdWU6ICd0aCdcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdzY29wZScsXG4gICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgbGFiZWw6ICdTY29wZScsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ05vbmUnLFxuICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnUm93JyxcbiAgICAgICAgICAgIHZhbHVlOiAncm93J1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ0NvbHVtbicsXG4gICAgICAgICAgICB2YWx1ZTogJ2NvbCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6ICdSb3cgZ3JvdXAnLFxuICAgICAgICAgICAgdmFsdWU6ICdyb3dncm91cCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6ICdDb2x1bW4gZ3JvdXAnLFxuICAgICAgICAgICAgdmFsdWU6ICdjb2xncm91cCdcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdoYWxpZ24nLFxuICAgICAgICB0eXBlOiAnbGlzdGJveCcsXG4gICAgICAgIGxhYmVsOiAnSG9yaXpvbnRhbCBhbGlnbicsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ05vbmUnLFxuICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnTGVmdCcsXG4gICAgICAgICAgICB2YWx1ZTogJ2xlZnQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnQ2VudGVyJyxcbiAgICAgICAgICAgIHZhbHVlOiAnY2VudGVyJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ1JpZ2h0JyxcbiAgICAgICAgICAgIHZhbHVlOiAncmlnaHQnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAndmFsaWduJyxcbiAgICAgICAgdHlwZTogJ2xpc3Rib3gnLFxuICAgICAgICBsYWJlbDogJ1ZlcnRpY2FsIGFsaWduJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnTm9uZScsXG4gICAgICAgICAgICB2YWx1ZTogJydcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6ICdUb3AnLFxuICAgICAgICAgICAgdmFsdWU6ICd0b3AnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnTWlkZGxlJyxcbiAgICAgICAgICAgIHZhbHVlOiAnbWlkZGxlJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ0JvdHRvbScsXG4gICAgICAgICAgICB2YWx1ZTogJ2JvdHRvbSdcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdO1xuICAgIHZhciBnZXRJdGVtcyA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBjaGlsZHJlbiQzLmNvbmNhdChnZXRDbGFzc0xpc3QoZWRpdG9yKS50b0FycmF5KCkpO1xuICAgIH07XG5cbiAgICB2YXIgbW9kaWZpZXJzID0gZnVuY3Rpb24gKHRlc3RUcnV0aHkpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWRpdG9yLCBub2RlKSB7XG4gICAgICAgIHZhciBkb20gPSBlZGl0b3IuZG9tO1xuICAgICAgICB2YXIgc2V0QXR0cmliID0gZnVuY3Rpb24gKGF0dHIsIHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF0ZXN0VHJ1dGh5IHx8IHZhbHVlKSB7XG4gICAgICAgICAgICBkb20uc2V0QXR0cmliKG5vZGUsIGF0dHIsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZXRTdHlsZSA9IGZ1bmN0aW9uIChwcm9wLCB2YWx1ZSkge1xuICAgICAgICAgIGlmICghdGVzdFRydXRoeSB8fCB2YWx1ZSkge1xuICAgICAgICAgICAgZG9tLnNldFN0eWxlKG5vZGUsIHByb3AsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBzZXRGb3JtYXQgPSBmdW5jdGlvbiAoZm9ybWF0TmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXRlc3RUcnV0aHkgfHwgdmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLmZvcm1hdHRlci5yZW1vdmUoZm9ybWF0TmFtZSwgeyB2YWx1ZTogbnVsbCB9LCBub2RlLCB0cnVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVkaXRvci5mb3JtYXR0ZXIuYXBwbHkoZm9ybWF0TmFtZSwgeyB2YWx1ZTogdmFsdWUgfSwgbm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHNldEF0dHJpYjogc2V0QXR0cmliLFxuICAgICAgICAgIHNldFN0eWxlOiBzZXRTdHlsZSxcbiAgICAgICAgICBzZXRGb3JtYXQ6IHNldEZvcm1hdFxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBEb21Nb2RpZmllciA9IHtcbiAgICAgIG5vcm1hbDogbW9kaWZpZXJzKGZhbHNlKSxcbiAgICAgIGlmVHJ1dGh5OiBtb2RpZmllcnModHJ1ZSlcbiAgICB9O1xuXG4gICAgdmFyIGdldFNlbGVjdGVkQ2VsbHMgPSBmdW5jdGlvbiAoY2VsbHMpIHtcbiAgICAgIHJldHVybiB0YWJsZShjZWxsc1swXSkubWFwKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICB2YXIgd2FyZWhvdXNlID0gV2FyZWhvdXNlLmZyb21UYWJsZSh0YWJsZSk7XG4gICAgICAgIHZhciBhbGxDZWxscyA9IFdhcmVob3VzZS5qdXN0Q2VsbHMod2FyZWhvdXNlKTtcbiAgICAgICAgdmFyIGZpbHRlcmVkID0gZmlsdGVyKGFsbENlbGxzLCBmdW5jdGlvbiAoY2VsbEEpIHtcbiAgICAgICAgICByZXR1cm4gZXhpc3RzKGNlbGxzLCBmdW5jdGlvbiAoY2VsbEIpIHtcbiAgICAgICAgICAgIHJldHVybiBlcSQxKGNlbGxBLmVsZW1lbnQsIGNlbGxCKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBtYXAoZmlsdGVyZWQsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGVsZW1lbnQ6IGNlbGwuZWxlbWVudC5kb20sXG4gICAgICAgICAgICBjb2x1bW46IFdhcmVob3VzZS5nZXRDb2x1bW5BdCh3YXJlaG91c2UsIGNlbGwuY29sdW1uKS5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICByZXR1cm4gY29sLmVsZW1lbnQuZG9tO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHVwZGF0ZVNpbXBsZVByb3BzID0gZnVuY3Rpb24gKG1vZGlmaWVyLCBjb2xNb2RpZmllciwgZGF0YSkge1xuICAgICAgbW9kaWZpZXIuc2V0QXR0cmliKCdzY29wZScsIGRhdGEuc2NvcGUpO1xuICAgICAgbW9kaWZpZXIuc2V0QXR0cmliKCdjbGFzcycsIGRhdGEuY2xhc3MpO1xuICAgICAgbW9kaWZpZXIuc2V0U3R5bGUoJ2hlaWdodCcsIGFkZFB4U3VmZml4KGRhdGEuaGVpZ2h0KSk7XG4gICAgICBjb2xNb2RpZmllci5zZXRTdHlsZSgnd2lkdGgnLCBhZGRQeFN1ZmZpeChkYXRhLndpZHRoKSk7XG4gICAgfTtcbiAgICB2YXIgdXBkYXRlQWR2YW5jZWRQcm9wcyA9IGZ1bmN0aW9uIChtb2RpZmllciwgZGF0YSkge1xuICAgICAgbW9kaWZpZXIuc2V0Rm9ybWF0KCd0YWJsZWNlbGxiYWNrZ3JvdW5kY29sb3InLCBkYXRhLmJhY2tncm91bmRjb2xvcik7XG4gICAgICBtb2RpZmllci5zZXRGb3JtYXQoJ3RhYmxlY2VsbGJvcmRlcmNvbG9yJywgZGF0YS5ib3JkZXJjb2xvcik7XG4gICAgICBtb2RpZmllci5zZXRGb3JtYXQoJ3RhYmxlY2VsbGJvcmRlcnN0eWxlJywgZGF0YS5ib3JkZXJzdHlsZSk7XG4gICAgICBtb2RpZmllci5zZXRGb3JtYXQoJ3RhYmxlY2VsbGJvcmRlcndpZHRoJywgYWRkUHhTdWZmaXgoZGF0YS5ib3JkZXJ3aWR0aCkpO1xuICAgIH07XG4gICAgdmFyIGFwcGx5Q2VsbERhdGEgPSBmdW5jdGlvbiAoZWRpdG9yLCBjZWxscywgb2xkRGF0YSwgZGF0YSkge1xuICAgICAgdmFyIGlzU2luZ2xlQ2VsbCA9IGNlbGxzLmxlbmd0aCA9PT0gMTtcbiAgICAgIHZhciBtb2RpZmllZERhdGEgPSBmaWx0ZXIkMShkYXRhLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgICByZXR1cm4gb2xkRGF0YVtrZXldICE9PSB2YWx1ZTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHNpemUobW9kaWZpZWREYXRhKSA+IDAgJiYgY2VsbHMubGVuZ3RoID49IDEpIHtcbiAgICAgICAgdmFyIHRhYmxlT3B0ID0gdGFibGUoY2VsbHNbMF0pO1xuICAgICAgICBnZXRTZWxlY3RlZENlbGxzKGNlbGxzKS5lYWNoKGZ1bmN0aW9uIChzZWxlY3RlZENlbGxzKSB7XG4gICAgICAgICAgZWFjaChzZWxlY3RlZENlbGxzLCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgdmFyIGNlbGxFbG0gPSBzd2l0Y2hDZWxsVHlwZShlZGl0b3IsIGl0ZW0uZWxlbWVudCwgZGF0YS5jZWxsdHlwZSk7XG4gICAgICAgICAgICB2YXIgbW9kaWZpZXIgPSBpc1NpbmdsZUNlbGwgPyBEb21Nb2RpZmllci5ub3JtYWwoZWRpdG9yLCBjZWxsRWxtKSA6IERvbU1vZGlmaWVyLmlmVHJ1dGh5KGVkaXRvciwgY2VsbEVsbSk7XG4gICAgICAgICAgICB2YXIgY29sTW9kaWZpZXIgPSBpdGVtLmNvbHVtbi5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICByZXR1cm4gaXNTaW5nbGVDZWxsID8gRG9tTW9kaWZpZXIubm9ybWFsKGVkaXRvciwgY29sKSA6IERvbU1vZGlmaWVyLmlmVHJ1dGh5KGVkaXRvciwgY29sKTtcbiAgICAgICAgICAgIH0pLmdldE9yKG1vZGlmaWVyKTtcbiAgICAgICAgICAgIHVwZGF0ZVNpbXBsZVByb3BzKG1vZGlmaWVyLCBjb2xNb2RpZmllciwgZGF0YSk7XG4gICAgICAgICAgICBpZiAoaGFzQWR2YW5jZWRDZWxsVGFiKGVkaXRvcikpIHtcbiAgICAgICAgICAgICAgdXBkYXRlQWR2YW5jZWRQcm9wcyhtb2RpZmllciwgZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNTaW5nbGVDZWxsKSB7XG4gICAgICAgICAgICAgIHVuQXBwbHlBbGlnbihlZGl0b3IsIGNlbGxFbG0pO1xuICAgICAgICAgICAgICB1bkFwcGx5VkFsaWduKGVkaXRvciwgY2VsbEVsbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YS5oYWxpZ24pIHtcbiAgICAgICAgICAgICAgYXBwbHlBbGlnbihlZGl0b3IsIGNlbGxFbG0sIGRhdGEuaGFsaWduKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLnZhbGlnbikge1xuICAgICAgICAgICAgICBhcHBseVZBbGlnbihlZGl0b3IsIGNlbGxFbG0sIGRhdGEudmFsaWduKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBzdHlsZU1vZGlmaWVkXzEgPSBzaXplKGZpbHRlciQxKG1vZGlmaWVkRGF0YSwgZnVuY3Rpb24gKF92YWx1ZSwga2V5KSB7XG4gICAgICAgICAgcmV0dXJuIGtleSAhPT0gJ3Njb3BlJyAmJiBrZXkgIT09ICdjZWxsdHlwZSc7XG4gICAgICAgIH0pKSA+IDA7XG4gICAgICAgIHRhYmxlT3B0LmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgcmV0dXJuIGZpcmVUYWJsZU1vZGlmaWVkKGVkaXRvciwgdGFibGUuZG9tLCB7XG4gICAgICAgICAgICBzdHJ1Y3R1cmU6IGhhcyhtb2RpZmllZERhdGEsICdjZWxsdHlwZScpLFxuICAgICAgICAgICAgc3R5bGU6IHN0eWxlTW9kaWZpZWRfMVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBvblN1Ym1pdENlbGxGb3JtID0gZnVuY3Rpb24gKGVkaXRvciwgY2VsbHMsIG9sZERhdGEsIGFwaSkge1xuICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgYXBpLmNsb3NlKCk7XG4gICAgICBlZGl0b3IudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkge1xuICAgICAgICBhcHBseUNlbGxEYXRhKGVkaXRvciwgY2VsbHMsIG9sZERhdGEsIGRhdGEpO1xuICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGdldERhdGEgPSBmdW5jdGlvbiAoZWRpdG9yLCBjZWxscykge1xuICAgICAgdmFyIGNlbGxzRGF0YSA9IGdldFNlbGVjdGVkQ2VsbHMoY2VsbHMpLm1hcChmdW5jdGlvbiAoc2VsZWN0ZWRDZWxscykge1xuICAgICAgICByZXR1cm4gbWFwKHNlbGVjdGVkQ2VsbHMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIGV4dHJhY3REYXRhRnJvbUNlbGxFbGVtZW50KGVkaXRvciwgaXRlbS5lbGVtZW50LCBoYXNBZHZhbmNlZENlbGxUYWIoZWRpdG9yKSwgaXRlbS5jb2x1bW4pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGdldFNoYXJlZFZhbHVlcyhjZWxsc0RhdGEuZ2V0T3JEaWUoKSk7XG4gICAgfTtcbiAgICB2YXIgb3BlbiA9IGZ1bmN0aW9uIChlZGl0b3IsIHNlbGVjdGlvbnMpIHtcbiAgICAgIHZhciBjZWxscyA9IGdldENlbGxzRnJvbVNlbGVjdGlvbihnZXRTZWxlY3Rpb25TdGFydChlZGl0b3IpLCBzZWxlY3Rpb25zKTtcbiAgICAgIGlmIChjZWxscy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGRhdGEgPSBnZXREYXRhKGVkaXRvciwgY2VsbHMpO1xuICAgICAgdmFyIGRpYWxvZ1RhYlBhbmVsID0ge1xuICAgICAgICB0eXBlOiAndGFicGFuZWwnLFxuICAgICAgICB0YWJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdHZW5lcmFsJyxcbiAgICAgICAgICAgIG5hbWU6ICdnZW5lcmFsJyxcbiAgICAgICAgICAgIGl0ZW1zOiBnZXRJdGVtcyhlZGl0b3IpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRBZHZhbmNlZFRhYignY2VsbCcpXG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgICB2YXIgZGlhbG9nUGFuZWwgPSB7XG4gICAgICAgIHR5cGU6ICdwYW5lbCcsXG4gICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgdHlwZTogJ2dyaWQnLFxuICAgICAgICAgICAgY29sdW1uczogMixcbiAgICAgICAgICAgIGl0ZW1zOiBnZXRJdGVtcyhlZGl0b3IpXG4gICAgICAgICAgfV1cbiAgICAgIH07XG4gICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHtcbiAgICAgICAgdGl0bGU6ICdDZWxsIFByb3BlcnRpZXMnLFxuICAgICAgICBzaXplOiAnbm9ybWFsJyxcbiAgICAgICAgYm9keTogaGFzQWR2YW5jZWRDZWxsVGFiKGVkaXRvcikgPyBkaWFsb2dUYWJQYW5lbCA6IGRpYWxvZ1BhbmVsLFxuICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHlwZTogJ2NhbmNlbCcsXG4gICAgICAgICAgICBuYW1lOiAnY2FuY2VsJyxcbiAgICAgICAgICAgIHRleHQ6ICdDYW5jZWwnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnc3VibWl0JyxcbiAgICAgICAgICAgIG5hbWU6ICdzYXZlJyxcbiAgICAgICAgICAgIHRleHQ6ICdTYXZlJyxcbiAgICAgICAgICAgIHByaW1hcnk6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIGluaXRpYWxEYXRhOiBkYXRhLFxuICAgICAgICBvblN1Ym1pdDogY3Vycnkob25TdWJtaXRDZWxsRm9ybSwgZWRpdG9yLCBjZWxscywgZGF0YSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0Q2xhc3NMaXN0JDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICB2YXIgY2xhc3NlcyA9IGJ1aWxkTGlzdEl0ZW1zKGdldFJvd0NsYXNzTGlzdChlZGl0b3IpKTtcbiAgICAgIGlmIChjbGFzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoe1xuICAgICAgICAgIG5hbWU6ICdjbGFzcycsXG4gICAgICAgICAgdHlwZTogJ2xpc3Rib3gnLFxuICAgICAgICAgIGxhYmVsOiAnQ2xhc3MnLFxuICAgICAgICAgIGl0ZW1zOiBjbGFzc2VzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciBmb3JtQ2hpbGRyZW4gPSBbXG4gICAgICB7XG4gICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgbmFtZTogJ3R5cGUnLFxuICAgICAgICBsYWJlbDogJ1JvdyB0eXBlJyxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0ZXh0OiAnSGVhZGVyJyxcbiAgICAgICAgICAgIHZhbHVlOiAnaGVhZGVyJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ0JvZHknLFxuICAgICAgICAgICAgdmFsdWU6ICdib2R5J1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ0Zvb3RlcicsXG4gICAgICAgICAgICB2YWx1ZTogJ2Zvb3RlcidcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6ICdsaXN0Ym94JyxcbiAgICAgICAgbmFtZTogJ2FsaWduJyxcbiAgICAgICAgbGFiZWw6ICdBbGlnbm1lbnQnLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6ICdOb25lJyxcbiAgICAgICAgICAgIHZhbHVlOiAnJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ0xlZnQnLFxuICAgICAgICAgICAgdmFsdWU6ICdsZWZ0J1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ0NlbnRlcicsXG4gICAgICAgICAgICB2YWx1ZTogJ2NlbnRlcidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRleHQ6ICdSaWdodCcsXG4gICAgICAgICAgICB2YWx1ZTogJ3JpZ2h0J1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbGFiZWw6ICdIZWlnaHQnLFxuICAgICAgICBuYW1lOiAnaGVpZ2h0JyxcbiAgICAgICAgdHlwZTogJ2lucHV0J1xuICAgICAgfVxuICAgIF07XG4gICAgdmFyIGdldEl0ZW1zJDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZm9ybUNoaWxkcmVuLmNvbmNhdChnZXRDbGFzc0xpc3QkMShlZGl0b3IpLnRvQXJyYXkoKSk7XG4gICAgfTtcblxuICAgIHZhciB1cGRhdGVTaW1wbGVQcm9wcyQxID0gZnVuY3Rpb24gKG1vZGlmaWVyLCBkYXRhKSB7XG4gICAgICBtb2RpZmllci5zZXRBdHRyaWIoJ2NsYXNzJywgZGF0YS5jbGFzcyk7XG4gICAgICBtb2RpZmllci5zZXRTdHlsZSgnaGVpZ2h0JywgYWRkUHhTdWZmaXgoZGF0YS5oZWlnaHQpKTtcbiAgICB9O1xuICAgIHZhciB1cGRhdGVBZHZhbmNlZFByb3BzJDEgPSBmdW5jdGlvbiAobW9kaWZpZXIsIGRhdGEpIHtcbiAgICAgIG1vZGlmaWVyLnNldFN0eWxlKCdiYWNrZ3JvdW5kLWNvbG9yJywgZGF0YS5iYWNrZ3JvdW5kY29sb3IpO1xuICAgICAgbW9kaWZpZXIuc2V0U3R5bGUoJ2JvcmRlci1jb2xvcicsIGRhdGEuYm9yZGVyY29sb3IpO1xuICAgICAgbW9kaWZpZXIuc2V0U3R5bGUoJ2JvcmRlci1zdHlsZScsIGRhdGEuYm9yZGVyc3R5bGUpO1xuICAgIH07XG4gICAgdmFyIGFwcGx5Um93RGF0YSA9IGZ1bmN0aW9uIChlZGl0b3IsIHJvd3MsIG9sZERhdGEsIGRhdGEpIHtcbiAgICAgIHZhciBpc1NpbmdsZVJvdyA9IHJvd3MubGVuZ3RoID09PSAxO1xuICAgICAgdmFyIG1vZGlmaWVkRGF0YSA9IGZpbHRlciQxKGRhdGEsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgIHJldHVybiBvbGREYXRhW2tleV0gIT09IHZhbHVlO1xuICAgICAgfSk7XG4gICAgICBpZiAoc2l6ZShtb2RpZmllZERhdGEpID4gMCkge1xuICAgICAgICBlYWNoKHJvd3MsIGZ1bmN0aW9uIChyb3dFbG0pIHtcbiAgICAgICAgICBpZiAoZGF0YS50eXBlICE9PSBnZXROb2RlTmFtZShyb3dFbG0ucGFyZW50Tm9kZSkpIHtcbiAgICAgICAgICAgIHN3aXRjaFNlY3Rpb25UeXBlKGVkaXRvciwgcm93RWxtLCBkYXRhLnR5cGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgbW9kaWZpZXIgPSBpc1NpbmdsZVJvdyA/IERvbU1vZGlmaWVyLm5vcm1hbChlZGl0b3IsIHJvd0VsbSkgOiBEb21Nb2RpZmllci5pZlRydXRoeShlZGl0b3IsIHJvd0VsbSk7XG4gICAgICAgICAgdXBkYXRlU2ltcGxlUHJvcHMkMShtb2RpZmllciwgZGF0YSk7XG4gICAgICAgICAgaWYgKGhhc0FkdmFuY2VkUm93VGFiKGVkaXRvcikpIHtcbiAgICAgICAgICAgIHVwZGF0ZUFkdmFuY2VkUHJvcHMkMShtb2RpZmllciwgZGF0YSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkYXRhLmFsaWduICE9PSBvbGREYXRhLmFsaWduKSB7XG4gICAgICAgICAgICB1bkFwcGx5QWxpZ24oZWRpdG9yLCByb3dFbG0pO1xuICAgICAgICAgICAgYXBwbHlBbGlnbihlZGl0b3IsIHJvd0VsbSwgZGF0YS5hbGlnbik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHR5cGVNb2RpZmllZF8xID0gaGFzKG1vZGlmaWVkRGF0YSwgJ3R5cGUnKTtcbiAgICAgICAgdmFyIHN0eWxlTW9kaWZpZWRfMSA9IHR5cGVNb2RpZmllZF8xID8gc2l6ZShtb2RpZmllZERhdGEpID4gMSA6IHRydWU7XG4gICAgICAgIHRhYmxlKFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJvd3NbMF0pKS5lYWNoKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICAgIHJldHVybiBmaXJlVGFibGVNb2RpZmllZChlZGl0b3IsIHRhYmxlLmRvbSwge1xuICAgICAgICAgICAgc3RydWN0dXJlOiB0eXBlTW9kaWZpZWRfMSxcbiAgICAgICAgICAgIHN0eWxlOiBzdHlsZU1vZGlmaWVkXzFcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgb25TdWJtaXRSb3dGb3JtID0gZnVuY3Rpb24gKGVkaXRvciwgcm93cywgb2xkRGF0YSwgYXBpKSB7XG4gICAgICB2YXIgZGF0YSA9IGFwaS5nZXREYXRhKCk7XG4gICAgICBhcGkuY2xvc2UoKTtcbiAgICAgIGVkaXRvci51bmRvTWFuYWdlci50cmFuc2FjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFwcGx5Um93RGF0YShlZGl0b3IsIHJvd3MsIG9sZERhdGEsIGRhdGEpO1xuICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG9wZW4kMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHZhciByb3dzID0gZ2V0Um93c0Zyb21TZWxlY3Rpb24oZ2V0U2VsZWN0aW9uU3RhcnQoZWRpdG9yKSwgZXBoZW1lcmEuc2VsZWN0ZWQpO1xuICAgICAgaWYgKHJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciByb3dzRGF0YSA9IG1hcChyb3dzLCBmdW5jdGlvbiAocm93RWxtKSB7XG4gICAgICAgIHJldHVybiBleHRyYWN0RGF0YUZyb21Sb3dFbGVtZW50KGVkaXRvciwgcm93RWxtLmRvbSwgaGFzQWR2YW5jZWRSb3dUYWIoZWRpdG9yKSk7XG4gICAgICB9KTtcbiAgICAgIHZhciBkYXRhID0gZ2V0U2hhcmVkVmFsdWVzKHJvd3NEYXRhKTtcbiAgICAgIHZhciBkaWFsb2dUYWJQYW5lbCA9IHtcbiAgICAgICAgdHlwZTogJ3RhYnBhbmVsJyxcbiAgICAgICAgdGFiczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiAnR2VuZXJhbCcsXG4gICAgICAgICAgICBuYW1lOiAnZ2VuZXJhbCcsXG4gICAgICAgICAgICBpdGVtczogZ2V0SXRlbXMkMShlZGl0b3IpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRBZHZhbmNlZFRhYigncm93JylcbiAgICAgICAgXVxuICAgICAgfTtcbiAgICAgIHZhciBkaWFsb2dQYW5lbCA9IHtcbiAgICAgICAgdHlwZTogJ3BhbmVsJyxcbiAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICB0eXBlOiAnZ3JpZCcsXG4gICAgICAgICAgICBjb2x1bW5zOiAyLFxuICAgICAgICAgICAgaXRlbXM6IGdldEl0ZW1zJDEoZWRpdG9yKVxuICAgICAgICAgIH1dXG4gICAgICB9O1xuICAgICAgZWRpdG9yLndpbmRvd01hbmFnZXIub3Blbih7XG4gICAgICAgIHRpdGxlOiAnUm93IFByb3BlcnRpZXMnLFxuICAgICAgICBzaXplOiAnbm9ybWFsJyxcbiAgICAgICAgYm9keTogaGFzQWR2YW5jZWRSb3dUYWIoZWRpdG9yKSA/IGRpYWxvZ1RhYlBhbmVsIDogZGlhbG9nUGFuZWwsXG4gICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY2FuY2VsJyxcbiAgICAgICAgICAgIG5hbWU6ICdjYW5jZWwnLFxuICAgICAgICAgICAgdGV4dDogJ0NhbmNlbCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdzdWJtaXQnLFxuICAgICAgICAgICAgbmFtZTogJ3NhdmUnLFxuICAgICAgICAgICAgdGV4dDogJ1NhdmUnLFxuICAgICAgICAgICAgcHJpbWFyeTogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgaW5pdGlhbERhdGE6IGRhdGEsXG4gICAgICAgIG9uU3VibWl0OiBjdXJyeShvblN1Ym1pdFJvd0Zvcm0sIGVkaXRvciwgbWFwKHJvd3MsIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgcmV0dXJuIHIuZG9tO1xuICAgICAgICB9KSwgZGF0YSlcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2xvYmFsJDIgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgndGlueW1jZS5FbnYnKTtcblxuICAgIHZhciBnZXRJdGVtcyQyID0gZnVuY3Rpb24gKGVkaXRvciwgY2xhc3NlcywgaW5zZXJ0TmV3VGFibGUpIHtcbiAgICAgIHZhciByb3dDb2xDb3VudEl0ZW1zID0gIWluc2VydE5ld1RhYmxlID8gW10gOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICAgIG5hbWU6ICdjb2xzJyxcbiAgICAgICAgICBsYWJlbDogJ0NvbHMnLFxuICAgICAgICAgIGlucHV0TW9kZTogJ251bWVyaWMnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICAgIG5hbWU6ICdyb3dzJyxcbiAgICAgICAgICBsYWJlbDogJ1Jvd3MnLFxuICAgICAgICAgIGlucHV0TW9kZTogJ251bWVyaWMnXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICB2YXIgYWx3YXlzSXRlbXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICAgIG5hbWU6ICd3aWR0aCcsXG4gICAgICAgICAgbGFiZWw6ICdXaWR0aCdcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgbmFtZTogJ2hlaWdodCcsXG4gICAgICAgICAgbGFiZWw6ICdIZWlnaHQnXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICB2YXIgYXBwZWFyYW5jZUl0ZW1zID0gaGFzQXBwZWFyYW5jZU9wdGlvbnMoZWRpdG9yKSA/IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgbmFtZTogJ2NlbGxzcGFjaW5nJyxcbiAgICAgICAgICBsYWJlbDogJ0NlbGwgc3BhY2luZycsXG4gICAgICAgICAgaW5wdXRNb2RlOiAnbnVtZXJpYydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgbmFtZTogJ2NlbGxwYWRkaW5nJyxcbiAgICAgICAgICBsYWJlbDogJ0NlbGwgcGFkZGluZycsXG4gICAgICAgICAgaW5wdXRNb2RlOiAnbnVtZXJpYydcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgbmFtZTogJ2JvcmRlcicsXG4gICAgICAgICAgbGFiZWw6ICdCb3JkZXIgd2lkdGgnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnbGFiZWwnLFxuICAgICAgICAgIGxhYmVsOiAnQ2FwdGlvbicsXG4gICAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgICAgICAgICAgIG5hbWU6ICdjYXB0aW9uJyxcbiAgICAgICAgICAgICAgbGFiZWw6ICdTaG93IGNhcHRpb24nXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XG4gICAgICBdIDogW107XG4gICAgICB2YXIgYWxpZ25tZW50SXRlbSA9IFt7XG4gICAgICAgICAgdHlwZTogJ2xpc3Rib3gnLFxuICAgICAgICAgIG5hbWU6ICdhbGlnbicsXG4gICAgICAgICAgbGFiZWw6ICdBbGlnbm1lbnQnLFxuICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdOb25lJyxcbiAgICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0ZXh0OiAnTGVmdCcsXG4gICAgICAgICAgICAgIHZhbHVlOiAnbGVmdCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdDZW50ZXInLFxuICAgICAgICAgICAgICB2YWx1ZTogJ2NlbnRlcidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRleHQ6ICdSaWdodCcsXG4gICAgICAgICAgICAgIHZhbHVlOiAncmlnaHQnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XTtcbiAgICAgIHZhciBjbGFzc0xpc3RJdGVtID0gY2xhc3Nlcy5sZW5ndGggPiAwID8gW3tcbiAgICAgICAgICB0eXBlOiAnbGlzdGJveCcsXG4gICAgICAgICAgbmFtZTogJ2NsYXNzJyxcbiAgICAgICAgICBsYWJlbDogJ0NsYXNzJyxcbiAgICAgICAgICBpdGVtczogY2xhc3Nlc1xuICAgICAgICB9XSA6IFtdO1xuICAgICAgcmV0dXJuIHJvd0NvbENvdW50SXRlbXMuY29uY2F0KGFsd2F5c0l0ZW1zKS5jb25jYXQoYXBwZWFyYW5jZUl0ZW1zKS5jb25jYXQoYWxpZ25tZW50SXRlbSkuY29uY2F0KGNsYXNzTGlzdEl0ZW0pO1xuICAgIH07XG5cbiAgICB2YXIgc3R5bGVURFRIID0gZnVuY3Rpb24gKGRvbSwgZWxtLCBuYW1lLCB2YWx1ZSkge1xuICAgICAgaWYgKGVsbS50YWdOYW1lID09PSAnVEQnIHx8IGVsbS50YWdOYW1lID09PSAnVEgnKSB7XG4gICAgICAgIGlmIChpc1N0cmluZyhuYW1lKSkge1xuICAgICAgICAgIGRvbS5zZXRTdHlsZShlbG0sIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkb20uc2V0U3R5bGUoZWxtLCBuYW1lKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGVsbS5jaGlsZHJlbikge1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxtLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBzdHlsZVREVEgoZG9tLCBlbG0uY2hpbGRyZW5baV0sIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBhcHBseURhdGFUb0VsZW1lbnQgPSBmdW5jdGlvbiAoZWRpdG9yLCB0YWJsZUVsbSwgZGF0YSkge1xuICAgICAgdmFyIGRvbSA9IGVkaXRvci5kb207XG4gICAgICB2YXIgYXR0cnMgPSB7fTtcbiAgICAgIHZhciBzdHlsZXMgPSB7fTtcbiAgICAgIGF0dHJzLmNsYXNzID0gZGF0YS5jbGFzcztcbiAgICAgIHN0eWxlcy5oZWlnaHQgPSBhZGRQeFN1ZmZpeChkYXRhLmhlaWdodCk7XG4gICAgICBpZiAoZG9tLmdldEF0dHJpYih0YWJsZUVsbSwgJ3dpZHRoJykgJiYgIXNob3VsZFN0eWxlV2l0aENzcyhlZGl0b3IpKSB7XG4gICAgICAgIGF0dHJzLndpZHRoID0gcmVtb3ZlUHhTdWZmaXgoZGF0YS53aWR0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdHlsZXMud2lkdGggPSBhZGRQeFN1ZmZpeChkYXRhLndpZHRoKTtcbiAgICAgIH1cbiAgICAgIGlmIChzaG91bGRTdHlsZVdpdGhDc3MoZWRpdG9yKSkge1xuICAgICAgICBzdHlsZXNbJ2JvcmRlci13aWR0aCddID0gYWRkUHhTdWZmaXgoZGF0YS5ib3JkZXIpO1xuICAgICAgICBzdHlsZXNbJ2JvcmRlci1zcGFjaW5nJ10gPSBhZGRQeFN1ZmZpeChkYXRhLmNlbGxzcGFjaW5nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF0dHJzLmJvcmRlciA9IGRhdGEuYm9yZGVyO1xuICAgICAgICBhdHRycy5jZWxscGFkZGluZyA9IGRhdGEuY2VsbHBhZGRpbmc7XG4gICAgICAgIGF0dHJzLmNlbGxzcGFjaW5nID0gZGF0YS5jZWxsc3BhY2luZztcbiAgICAgIH1cbiAgICAgIGlmIChzaG91bGRTdHlsZVdpdGhDc3MoZWRpdG9yKSAmJiB0YWJsZUVsbS5jaGlsZHJlbikge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYmxlRWxtLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgc3R5bGVURFRIKGRvbSwgdGFibGVFbG0uY2hpbGRyZW5baV0sIHtcbiAgICAgICAgICAgICdib3JkZXItd2lkdGgnOiBhZGRQeFN1ZmZpeChkYXRhLmJvcmRlciksXG4gICAgICAgICAgICAncGFkZGluZyc6IGFkZFB4U3VmZml4KGRhdGEuY2VsbHBhZGRpbmcpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKGhhc0FkdmFuY2VkVGFibGVUYWIoZWRpdG9yKSkge1xuICAgICAgICAgICAgc3R5bGVURFRIKGRvbSwgdGFibGVFbG0uY2hpbGRyZW5baV0sIHsgJ2JvcmRlci1jb2xvcic6IGRhdGEuYm9yZGVyY29sb3IgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoaGFzQWR2YW5jZWRUYWJsZVRhYihlZGl0b3IpKSB7XG4gICAgICAgIHN0eWxlc1snYmFja2dyb3VuZC1jb2xvciddID0gZGF0YS5iYWNrZ3JvdW5kY29sb3I7XG4gICAgICAgIHN0eWxlc1snYm9yZGVyLWNvbG9yJ10gPSBkYXRhLmJvcmRlcmNvbG9yO1xuICAgICAgICBzdHlsZXNbJ2JvcmRlci1zdHlsZSddID0gZGF0YS5ib3JkZXJzdHlsZTtcbiAgICAgIH1cbiAgICAgIGF0dHJzLnN0eWxlID0gZG9tLnNlcmlhbGl6ZVN0eWxlKF9fYXNzaWduKF9fYXNzaWduKHt9LCBnZXREZWZhdWx0U3R5bGVzKGVkaXRvcikpLCBzdHlsZXMpKTtcbiAgICAgIGRvbS5zZXRBdHRyaWJzKHRhYmxlRWxtLCBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZ2V0RGVmYXVsdEF0dHJpYnV0ZXMoZWRpdG9yKSksIGF0dHJzKSk7XG4gICAgfTtcbiAgICB2YXIgb25TdWJtaXRUYWJsZUZvcm0gPSBmdW5jdGlvbiAoZWRpdG9yLCB0YWJsZUVsbSwgb2xkRGF0YSwgYXBpKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciBjYXB0aW9uRWxtO1xuICAgICAgdmFyIGRhdGEgPSBhcGkuZ2V0RGF0YSgpO1xuICAgICAgdmFyIG1vZGlmaWVkRGF0YSA9IGZpbHRlciQxKGRhdGEsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgIHJldHVybiBvbGREYXRhW2tleV0gIT09IHZhbHVlO1xuICAgICAgfSk7XG4gICAgICBhcGkuY2xvc2UoKTtcbiAgICAgIGlmIChkYXRhLmNsYXNzID09PSAnJykge1xuICAgICAgICBkZWxldGUgZGF0YS5jbGFzcztcbiAgICAgIH1cbiAgICAgIGVkaXRvci51bmRvTWFuYWdlci50cmFuc2FjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGFibGVFbG0pIHtcbiAgICAgICAgICB2YXIgY29scyA9IHBhcnNlSW50KGRhdGEuY29scywgMTApIHx8IDE7XG4gICAgICAgICAgdmFyIHJvd3MgPSBwYXJzZUludChkYXRhLnJvd3MsIDEwKSB8fCAxO1xuICAgICAgICAgIHRhYmxlRWxtID0gaW5zZXJ0JDEoZWRpdG9yLCBjb2xzLCByb3dzLCAwLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2l6ZShtb2RpZmllZERhdGEpID4gMCkge1xuICAgICAgICAgIGFwcGx5RGF0YVRvRWxlbWVudChlZGl0b3IsIHRhYmxlRWxtLCBkYXRhKTtcbiAgICAgICAgICBjYXB0aW9uRWxtID0gZG9tLnNlbGVjdCgnY2FwdGlvbicsIHRhYmxlRWxtKVswXTtcbiAgICAgICAgICBpZiAoY2FwdGlvbkVsbSAmJiAhZGF0YS5jYXB0aW9uKSB7XG4gICAgICAgICAgICBkb20ucmVtb3ZlKGNhcHRpb25FbG0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNhcHRpb25FbG0gJiYgZGF0YS5jYXB0aW9uKSB7XG4gICAgICAgICAgICBjYXB0aW9uRWxtID0gZG9tLmNyZWF0ZSgnY2FwdGlvbicpO1xuICAgICAgICAgICAgY2FwdGlvbkVsbS5pbm5lckhUTUwgPSAhZ2xvYmFsJDIuaWUgPyAnPGJyIGRhdGEtbWNlLWJvZ3VzPVwiMVwiLz4nIDogbmJzcDtcbiAgICAgICAgICAgIHRhYmxlRWxtLmluc2VydEJlZm9yZShjYXB0aW9uRWxtLCB0YWJsZUVsbS5maXJzdENoaWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGRhdGEuYWxpZ24gPT09ICcnKSB7XG4gICAgICAgICAgICB1bkFwcGx5QWxpZ24oZWRpdG9yLCB0YWJsZUVsbSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFwcGx5QWxpZ24oZWRpdG9yLCB0YWJsZUVsbSwgZGF0YS5hbGlnbik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICBlZGl0b3IuYWRkVmlzdWFsKCk7XG4gICAgICAgIGlmIChzaXplKG1vZGlmaWVkRGF0YSkgPiAwKSB7XG4gICAgICAgICAgdmFyIGNhcHRpb25Nb2RpZmllZCA9IGhhcyhtb2RpZmllZERhdGEsICdjYXB0aW9uJyk7XG4gICAgICAgICAgdmFyIHN0eWxlTW9kaWZpZWQgPSBjYXB0aW9uTW9kaWZpZWQgPyBzaXplKG1vZGlmaWVkRGF0YSkgPiAxIDogdHJ1ZTtcbiAgICAgICAgICBmaXJlVGFibGVNb2RpZmllZChlZGl0b3IsIHRhYmxlRWxtLCB7XG4gICAgICAgICAgICBzdHJ1Y3R1cmU6IGNhcHRpb25Nb2RpZmllZCxcbiAgICAgICAgICAgIHN0eWxlOiBzdHlsZU1vZGlmaWVkXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIG9wZW4kMiA9IGZ1bmN0aW9uIChlZGl0b3IsIGluc2VydE5ld1RhYmxlKSB7XG4gICAgICB2YXIgZG9tID0gZWRpdG9yLmRvbTtcbiAgICAgIHZhciB0YWJsZUVsbTtcbiAgICAgIHZhciBkYXRhID0gZXh0cmFjdERhdGFGcm9tU2V0dGluZ3MoZWRpdG9yLCBoYXNBZHZhbmNlZFRhYmxlVGFiKGVkaXRvcikpO1xuICAgICAgaWYgKGluc2VydE5ld1RhYmxlID09PSBmYWxzZSkge1xuICAgICAgICB0YWJsZUVsbSA9IGRvbS5nZXRQYXJlbnQoZWRpdG9yLnNlbGVjdGlvbi5nZXRTdGFydCgpLCAndGFibGUnLCBlZGl0b3IuZ2V0Qm9keSgpKTtcbiAgICAgICAgaWYgKHRhYmxlRWxtKSB7XG4gICAgICAgICAgZGF0YSA9IGV4dHJhY3REYXRhRnJvbVRhYmxlRWxlbWVudChlZGl0b3IsIHRhYmxlRWxtLCBoYXNBZHZhbmNlZFRhYmxlVGFiKGVkaXRvcikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChoYXNBZHZhbmNlZFRhYmxlVGFiKGVkaXRvcikpIHtcbiAgICAgICAgICAgIGRhdGEuYm9yZGVyc3R5bGUgPSAnJztcbiAgICAgICAgICAgIGRhdGEuYm9yZGVyY29sb3IgPSAnJztcbiAgICAgICAgICAgIGRhdGEuYmFja2dyb3VuZGNvbG9yID0gJyc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXRhLmNvbHMgPSAnMSc7XG4gICAgICAgIGRhdGEucm93cyA9ICcxJztcbiAgICAgICAgaWYgKGhhc0FkdmFuY2VkVGFibGVUYWIoZWRpdG9yKSkge1xuICAgICAgICAgIGRhdGEuYm9yZGVyc3R5bGUgPSAnJztcbiAgICAgICAgICBkYXRhLmJvcmRlcmNvbG9yID0gJyc7XG4gICAgICAgICAgZGF0YS5iYWNrZ3JvdW5kY29sb3IgPSAnJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIGNsYXNzZXMgPSBidWlsZExpc3RJdGVtcyhnZXRUYWJsZUNsYXNzTGlzdChlZGl0b3IpKTtcbiAgICAgIGlmIChjbGFzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKGRhdGEuY2xhc3MpIHtcbiAgICAgICAgICBkYXRhLmNsYXNzID0gZGF0YS5jbGFzcy5yZXBsYWNlKC9cXHMqbWNlXFwtaXRlbVxcLXRhYmxlXFxzKi9nLCAnJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHZhciBnZW5lcmFsUGFuZWwgPSB7XG4gICAgICAgIHR5cGU6ICdncmlkJyxcbiAgICAgICAgY29sdW1uczogMixcbiAgICAgICAgaXRlbXM6IGdldEl0ZW1zJDIoZWRpdG9yLCBjbGFzc2VzLCBpbnNlcnROZXdUYWJsZSlcbiAgICAgIH07XG4gICAgICB2YXIgbm9uQWR2YW5jZWRGb3JtID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHR5cGU6ICdwYW5lbCcsXG4gICAgICAgICAgaXRlbXM6IFtnZW5lcmFsUGFuZWxdXG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGFkdmFuY2VkRm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiAndGFicGFuZWwnLFxuICAgICAgICAgIHRhYnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGl0bGU6ICdHZW5lcmFsJyxcbiAgICAgICAgICAgICAgbmFtZTogJ2dlbmVyYWwnLFxuICAgICAgICAgICAgICBpdGVtczogW2dlbmVyYWxQYW5lbF1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRBZHZhbmNlZFRhYigndGFibGUnKVxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgZGlhbG9nQm9keSA9IGhhc0FkdmFuY2VkVGFibGVUYWIoZWRpdG9yKSA/IGFkdmFuY2VkRm9ybSgpIDogbm9uQWR2YW5jZWRGb3JtKCk7XG4gICAgICBlZGl0b3Iud2luZG93TWFuYWdlci5vcGVuKHtcbiAgICAgICAgdGl0bGU6ICdUYWJsZSBQcm9wZXJ0aWVzJyxcbiAgICAgICAgc2l6ZTogJ25vcm1hbCcsXG4gICAgICAgIGJvZHk6IGRpYWxvZ0JvZHksXG4gICAgICAgIG9uU3VibWl0OiBjdXJyeShvblN1Ym1pdFRhYmxlRm9ybSwgZWRpdG9yLCB0YWJsZUVsbSwgZGF0YSksXG4gICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0eXBlOiAnY2FuY2VsJyxcbiAgICAgICAgICAgIG5hbWU6ICdjYW5jZWwnLFxuICAgICAgICAgICAgdGV4dDogJ0NhbmNlbCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdzdWJtaXQnLFxuICAgICAgICAgICAgbmFtZTogJ3NhdmUnLFxuICAgICAgICAgICAgdGV4dDogJ1NhdmUnLFxuICAgICAgICAgICAgcHJpbWFyeTogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgaW5pdGlhbERhdGE6IGRhdGFcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0U2VsZWN0aW9uU3RhcnRDZWxsT3JDYXB0aW9uJDEgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uU3RhcnRDZWxsT3JDYXB0aW9uKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvciksIGdldElzUm9vdChlZGl0b3IpKTtcbiAgICB9O1xuICAgIHZhciBnZXRTZWxlY3Rpb25TdGFydENlbGwkMSA9IGZ1bmN0aW9uIChlZGl0b3IpIHtcbiAgICAgIHJldHVybiBnZXRTZWxlY3Rpb25TdGFydENlbGwoZ2V0U2VsZWN0aW9uU3RhcnQoZWRpdG9yKSwgZ2V0SXNSb290KGVkaXRvcikpO1xuICAgIH07XG4gICAgdmFyIHJlZ2lzdGVyQ29tbWFuZHMgPSBmdW5jdGlvbiAoZWRpdG9yLCBhY3Rpb25zLCBjZWxsU2VsZWN0aW9uLCBzZWxlY3Rpb25zLCBjbGlwYm9hcmQpIHtcbiAgICAgIHZhciBpc1Jvb3QgPSBnZXRJc1Jvb3QoZWRpdG9yKTtcbiAgICAgIHZhciBlcmFzZVRhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uU3RhcnRDZWxsT3JDYXB0aW9uJDEoZWRpdG9yKS5lYWNoKGZ1bmN0aW9uIChjZWxsT3JDYXB0aW9uKSB7XG4gICAgICAgICAgdGFibGUoY2VsbE9yQ2FwdGlvbiwgaXNSb290KS5maWx0ZXIobm90KGlzUm9vdCkpLmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgICB2YXIgY3Vyc29yID0gU3VnYXJFbGVtZW50LmZyb21UZXh0KCcnKTtcbiAgICAgICAgICAgIGFmdGVyKHRhYmxlLCBjdXJzb3IpO1xuICAgICAgICAgICAgcmVtb3ZlJDIodGFibGUpO1xuICAgICAgICAgICAgaWYgKGVkaXRvci5kb20uaXNFbXB0eShlZGl0b3IuZ2V0Qm9keSgpKSkge1xuICAgICAgICAgICAgICBlZGl0b3Iuc2V0Q29udGVudCgnJyk7XG4gICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhciBybmcgPSBlZGl0b3IuZG9tLmNyZWF0ZVJuZygpO1xuICAgICAgICAgICAgICBybmcuc2V0U3RhcnQoY3Vyc29yLmRvbSwgMCk7XG4gICAgICAgICAgICAgIHJuZy5zZXRFbmQoY3Vyc29yLmRvbSwgMCk7XG4gICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKHJuZyk7XG4gICAgICAgICAgICAgIGVkaXRvci5ub2RlQ2hhbmdlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0U2l6aW5nTW9kZSA9IGZ1bmN0aW9uIChzaXppbmcpIHtcbiAgICAgICAgcmV0dXJuIGdldFNlbGVjdGlvblN0YXJ0Q2VsbE9yQ2FwdGlvbiQxKGVkaXRvcikuZWFjaChmdW5jdGlvbiAoY2VsbE9yQ2FwdGlvbikge1xuICAgICAgICAgIHZhciBpc0ZvcmNlZFNpemluZyA9IGlzUmVzcG9uc2l2ZUZvcmNlZChlZGl0b3IpIHx8IGlzUGl4ZWxzRm9yY2VkKGVkaXRvcikgfHwgaXNQZXJjZW50YWdlc0ZvcmNlZChlZGl0b3IpO1xuICAgICAgICAgIGlmICghaXNGb3JjZWRTaXppbmcpIHtcbiAgICAgICAgICAgIHRhYmxlKGNlbGxPckNhcHRpb24sIGlzUm9vdCkuZWFjaChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICAgICAgaWYgKHNpemluZyA9PT0gJ3JlbGF0aXZlJyAmJiAhaXNQZXJjZW50U2l6aW5nJDEodGFibGUpKSB7XG4gICAgICAgICAgICAgICAgZW5mb3JjZVBlcmNlbnRhZ2UoZWRpdG9yLCB0YWJsZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2l6aW5nID09PSAnZml4ZWQnICYmICFpc1BpeGVsU2l6aW5nJDEodGFibGUpKSB7XG4gICAgICAgICAgICAgICAgZW5mb3JjZVBpeGVscyhlZGl0b3IsIHRhYmxlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzaXppbmcgPT09ICdyZXNwb25zaXZlJyAmJiAhaXNOb25lU2l6aW5nJDEodGFibGUpKSB7XG4gICAgICAgICAgICAgICAgZW5mb3JjZU5vbmUodGFibGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJlbW92ZURhdGFTdHlsZSh0YWJsZSk7XG4gICAgICAgICAgICAgIGZpcmVUYWJsZU1vZGlmaWVkKGVkaXRvciwgdGFibGUuZG9tLCBzdHJ1Y3R1cmVNb2RpZmllZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRUYWJsZUZyb21DZWxsID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIHRhYmxlKGNlbGwsIGlzUm9vdCk7XG4gICAgICB9O1xuICAgICAgdmFyIHBvc3RFeGVjdXRlID0gZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uc2V0Um5nKGRhdGEucm5nKTtcbiAgICAgICAgICBlZGl0b3IuZm9jdXMoKTtcbiAgICAgICAgICBjZWxsU2VsZWN0aW9uLmNsZWFyKHRhYmxlKTtcbiAgICAgICAgICByZW1vdmVEYXRhU3R5bGUodGFibGUpO1xuICAgICAgICAgIGZpcmVUYWJsZU1vZGlmaWVkKGVkaXRvciwgdGFibGUuZG9tLCBkYXRhLmVmZmVjdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGFjdE9uU2VsZWN0aW9uID0gZnVuY3Rpb24gKGV4ZWN1dGUpIHtcbiAgICAgICAgcmV0dXJuIGdldFNlbGVjdGlvblN0YXJ0Q2VsbCQxKGVkaXRvcikuZWFjaChmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIGdldFRhYmxlRnJvbUNlbGwoY2VsbCkuZWFjaChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICAgIHZhciB0YXJnZXRzID0gZm9yTWVudShzZWxlY3Rpb25zLCB0YWJsZSwgY2VsbCk7XG4gICAgICAgICAgICBleGVjdXRlKHRhYmxlLCB0YXJnZXRzKS5lYWNoKHBvc3RFeGVjdXRlKHRhYmxlKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjb3B5Um93U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uU3RhcnRDZWxsJDEoZWRpdG9yKS5tYXAoZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0VGFibGVGcm9tQ2VsbChjZWxsKS5iaW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICAgICAgdmFyIHRhcmdldHMgPSBmb3JNZW51KHNlbGVjdGlvbnMsIHRhYmxlLCBjZWxsKTtcbiAgICAgICAgICAgIHZhciBnZW5lcmF0b3JzID0gY2VsbE9wZXJhdGlvbnMobm9vcCwgU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldERvYygpKSwgT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgICAgICAgIHJldHVybiBjb3B5Um93cyh0YWJsZSwgdGFyZ2V0cywgZ2VuZXJhdG9ycyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjb3B5Q29sU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uU3RhcnRDZWxsJDEoZWRpdG9yKS5tYXAoZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0VGFibGVGcm9tQ2VsbChjZWxsKS5iaW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICAgICAgdmFyIHRhcmdldHMgPSBmb3JNZW51KHNlbGVjdGlvbnMsIHRhYmxlLCBjZWxsKTtcbiAgICAgICAgICAgIHJldHVybiBjb3B5Q29scyh0YWJsZSwgdGFyZ2V0cyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBwYXN0ZU9uU2VsZWN0aW9uID0gZnVuY3Rpb24gKGV4ZWN1dGUsIGdldFJvd3MpIHtcbiAgICAgICAgcmV0dXJuIGdldFJvd3MoKS5lYWNoKGZ1bmN0aW9uIChyb3dzKSB7XG4gICAgICAgICAgdmFyIGNsb25lZFJvd3MgPSBtYXAocm93cywgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgcmV0dXJuIGRlZXAocm93KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBnZXRTZWxlY3Rpb25TdGFydENlbGwkMShlZGl0b3IpLmVhY2goZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUYWJsZUZyb21DZWxsKGNlbGwpLmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgICAgIHZhciBnZW5lcmF0b3JzID0gcGFzdGUoU3VnYXJFbGVtZW50LmZyb21Eb20oZWRpdG9yLmdldERvYygpKSk7XG4gICAgICAgICAgICAgIHZhciB0YXJnZXRzID0gcGFzdGVSb3dzKHNlbGVjdGlvbnMsIGNlbGwsIGNsb25lZFJvd3MsIGdlbmVyYXRvcnMpO1xuICAgICAgICAgICAgICBleGVjdXRlKHRhYmxlLCB0YXJnZXRzKS5lYWNoKHBvc3RFeGVjdXRlKHRhYmxlKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgZWFjaCQxKHtcbiAgICAgICAgbWNlVGFibGVTcGxpdENlbGxzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdE9uU2VsZWN0aW9uKGFjdGlvbnMudW5tZXJnZUNlbGxzKTtcbiAgICAgICAgfSxcbiAgICAgICAgbWNlVGFibGVNZXJnZUNlbGxzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdE9uU2VsZWN0aW9uKGFjdGlvbnMubWVyZ2VDZWxscyk7XG4gICAgICAgIH0sXG4gICAgICAgIG1jZVRhYmxlSW5zZXJ0Um93QmVmb3JlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdE9uU2VsZWN0aW9uKGFjdGlvbnMuaW5zZXJ0Um93c0JlZm9yZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG1jZVRhYmxlSW5zZXJ0Um93QWZ0ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gYWN0T25TZWxlY3Rpb24oYWN0aW9ucy5pbnNlcnRSb3dzQWZ0ZXIpO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZUluc2VydENvbEJlZm9yZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBhY3RPblNlbGVjdGlvbihhY3Rpb25zLmluc2VydENvbHVtbnNCZWZvcmUpO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZUluc2VydENvbEFmdGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdE9uU2VsZWN0aW9uKGFjdGlvbnMuaW5zZXJ0Q29sdW1uc0FmdGVyKTtcbiAgICAgICAgfSxcbiAgICAgICAgbWNlVGFibGVEZWxldGVDb2w6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gYWN0T25TZWxlY3Rpb24oYWN0aW9ucy5kZWxldGVDb2x1bW4pO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZURlbGV0ZVJvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBhY3RPblNlbGVjdGlvbihhY3Rpb25zLmRlbGV0ZVJvdyk7XG4gICAgICAgIH0sXG4gICAgICAgIG1jZVRhYmxlQ3V0Q29sOiBmdW5jdGlvbiAoX2dyaWQpIHtcbiAgICAgICAgICByZXR1cm4gY29weUNvbFNlbGVjdGlvbigpLmVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICAgICAgY2xpcGJvYXJkLnNldENvbHVtbnMoc2VsZWN0aW9uKTtcbiAgICAgICAgICAgIGFjdE9uU2VsZWN0aW9uKGFjdGlvbnMuZGVsZXRlQ29sdW1uKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgbWNlVGFibGVDdXRSb3c6IGZ1bmN0aW9uIChfZ3JpZCkge1xuICAgICAgICAgIHJldHVybiBjb3B5Um93U2VsZWN0aW9uKCkuZWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICAgICAgICBjbGlwYm9hcmQuc2V0Um93cyhzZWxlY3Rpb24pO1xuICAgICAgICAgICAgYWN0T25TZWxlY3Rpb24oYWN0aW9ucy5kZWxldGVSb3cpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZUNvcHlDb2w6IGZ1bmN0aW9uIChfZ3JpZCkge1xuICAgICAgICAgIHJldHVybiBjb3B5Q29sU2VsZWN0aW9uKCkuZWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xpcGJvYXJkLnNldENvbHVtbnMoc2VsZWN0aW9uKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgbWNlVGFibGVDb3B5Um93OiBmdW5jdGlvbiAoX2dyaWQpIHtcbiAgICAgICAgICByZXR1cm4gY29weVJvd1NlbGVjdGlvbigpLmVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGNsaXBib2FyZC5zZXRSb3dzKHNlbGVjdGlvbik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG1jZVRhYmxlUGFzdGVDb2xCZWZvcmU6IGZ1bmN0aW9uIChfZ3JpZCkge1xuICAgICAgICAgIHJldHVybiBwYXN0ZU9uU2VsZWN0aW9uKGFjdGlvbnMucGFzdGVDb2xzQmVmb3JlLCBjbGlwYm9hcmQuZ2V0Q29sdW1ucyk7XG4gICAgICAgIH0sXG4gICAgICAgIG1jZVRhYmxlUGFzdGVDb2xBZnRlcjogZnVuY3Rpb24gKF9ncmlkKSB7XG4gICAgICAgICAgcmV0dXJuIHBhc3RlT25TZWxlY3Rpb24oYWN0aW9ucy5wYXN0ZUNvbHNBZnRlciwgY2xpcGJvYXJkLmdldENvbHVtbnMpO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZVBhc3RlUm93QmVmb3JlOiBmdW5jdGlvbiAoX2dyaWQpIHtcbiAgICAgICAgICByZXR1cm4gcGFzdGVPblNlbGVjdGlvbihhY3Rpb25zLnBhc3RlUm93c0JlZm9yZSwgY2xpcGJvYXJkLmdldFJvd3MpO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZVBhc3RlUm93QWZ0ZXI6IGZ1bmN0aW9uIChfZ3JpZCkge1xuICAgICAgICAgIHJldHVybiBwYXN0ZU9uU2VsZWN0aW9uKGFjdGlvbnMucGFzdGVSb3dzQWZ0ZXIsIGNsaXBib2FyZC5nZXRSb3dzKTtcbiAgICAgICAgfSxcbiAgICAgICAgbWNlVGFibGVEZWxldGU6IGVyYXNlVGFibGUsXG4gICAgICAgIG1jZVRhYmxlU2l6aW5nTW9kZTogZnVuY3Rpb24gKHVpLCBzaXppbmcpIHtcbiAgICAgICAgICByZXR1cm4gc2V0U2l6aW5nTW9kZShzaXppbmcpO1xuICAgICAgICB9XG4gICAgICB9LCBmdW5jdGlvbiAoZnVuYywgbmFtZSkge1xuICAgICAgICByZXR1cm4gZWRpdG9yLmFkZENvbW1hbmQobmFtZSwgZnVuYyk7XG4gICAgICB9KTtcbiAgICAgIHZhciBmaXJlVGFibGVNb2RpZmllZEZvclNlbGVjdGlvbiA9IGZ1bmN0aW9uIChlZGl0b3IsIHRhYmxlT3B0KSB7XG4gICAgICAgIHRhYmxlT3B0LmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgZmlyZVRhYmxlTW9kaWZpZWQoZWRpdG9yLCB0YWJsZS5kb20sIHN0cnVjdHVyZU1vZGlmaWVkKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgZWFjaCQxKHtcbiAgICAgICAgbWNlVGFibGVDZWxsVHlwZTogZnVuY3Rpb24gKF91aSwgYXJncykge1xuICAgICAgICAgIHZhciB0YWJsZU9wdCA9IHRhYmxlKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvciksIGlzUm9vdCk7XG4gICAgICAgICAgYWN0aW9ucy5zZXRUYWJsZUNlbGxUeXBlKGVkaXRvciwgYXJncyk7XG4gICAgICAgICAgZmlyZVRhYmxlTW9kaWZpZWRGb3JTZWxlY3Rpb24oZWRpdG9yLCB0YWJsZU9wdCk7XG4gICAgICAgIH0sXG4gICAgICAgIG1jZVRhYmxlUm93VHlwZTogZnVuY3Rpb24gKF91aSwgYXJncykge1xuICAgICAgICAgIHZhciB0YWJsZU9wdCA9IHRhYmxlKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvciksIGlzUm9vdCk7XG4gICAgICAgICAgYWN0aW9ucy5zZXRUYWJsZVJvd1R5cGUoZWRpdG9yLCBhcmdzKTtcbiAgICAgICAgICBmaXJlVGFibGVNb2RpZmllZEZvclNlbGVjdGlvbihlZGl0b3IsIHRhYmxlT3B0KTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGZ1bmMsIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGVkaXRvci5hZGRDb21tYW5kKG5hbWUsIGZ1bmMpO1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IuYWRkQ29tbWFuZCgnbWNlVGFibGVDb2xUeXBlJywgZnVuY3Rpb24gKF91aSwgYXJncykge1xuICAgICAgICByZXR1cm4gZ2V0JDEoYXJncywgJ3R5cGUnKS5lYWNoKGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdE9uU2VsZWN0aW9uKHR5cGUgPT09ICd0aCcgPyBhY3Rpb25zLm1ha2VDb2x1bW5zSGVhZGVyIDogYWN0aW9ucy51bm1ha2VDb2x1bW5zSGVhZGVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGVhY2gkMSh7XG4gICAgICAgIG1jZVRhYmxlUHJvcHM6IGN1cnJ5KG9wZW4kMiwgZWRpdG9yLCBmYWxzZSksXG4gICAgICAgIG1jZVRhYmxlUm93UHJvcHM6IGN1cnJ5KG9wZW4kMSwgZWRpdG9yKSxcbiAgICAgICAgbWNlVGFibGVDZWxsUHJvcHM6IGN1cnJ5KG9wZW4sIGVkaXRvciwgc2VsZWN0aW9ucylcbiAgICAgIH0sIGZ1bmN0aW9uIChmdW5jLCBuYW1lKSB7XG4gICAgICAgIHJldHVybiBlZGl0b3IuYWRkQ29tbWFuZChuYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmMoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci5hZGRDb21tYW5kKCdtY2VJbnNlcnRUYWJsZScsIGZ1bmN0aW9uIChfdWksIGFyZ3MpIHtcbiAgICAgICAgaWYgKGlzT2JqZWN0KGFyZ3MpICYmIGtleXMoYXJncykubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGluc2VydFRhYmxlV2l0aERhdGFWYWxpZGF0aW9uKGVkaXRvciwgYXJncy5yb3dzLCBhcmdzLmNvbHVtbnMsIGFyZ3Mub3B0aW9ucywgJ0ludmFsaWQgdmFsdWVzIGZvciBtY2VJbnNlcnRUYWJsZSAtIHJvd3MgYW5kIGNvbHVtbnMgdmFsdWVzIGFyZSByZXF1aXJlZCB0byBpbnNlcnQgYSB0YWJsZS4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvcGVuJDIoZWRpdG9yLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IuYWRkQ29tbWFuZCgnbWNlVGFibGVBcHBseUNlbGxTdHlsZScsIGZ1bmN0aW9uIChfdWksIGFyZ3MpIHtcbiAgICAgICAgdmFyIGdldEZvcm1hdE5hbWUgPSBmdW5jdGlvbiAoc3R5bGUpIHtcbiAgICAgICAgICByZXR1cm4gJ3RhYmxlY2VsbCcgKyBzdHlsZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJy0nLCAnJyk7XG4gICAgICAgIH07XG4gICAgICAgIGlmICghaXNPYmplY3QoYXJncykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNlbGxzID0gZ2V0Q2VsbHNGcm9tU2VsZWN0aW9uKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvciksIHNlbGVjdGlvbnMsIGlzUm9vdCk7XG4gICAgICAgIGlmIChjZWxscy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHZhbGlkQXJncyA9IGZpbHRlciQxKGFyZ3MsIGZ1bmN0aW9uICh2YWx1ZSwgc3R5bGUpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmZvcm1hdHRlci5oYXMoZ2V0Rm9ybWF0TmFtZShzdHlsZSkpICYmIGlzU3RyaW5nKHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc0VtcHR5KHZhbGlkQXJncykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZWFjaCQxKHZhbGlkQXJncywgZnVuY3Rpb24gKHZhbHVlLCBzdHlsZSkge1xuICAgICAgICAgIGVhY2goY2VsbHMsIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgICBEb21Nb2RpZmllci5ub3JtYWwoZWRpdG9yLCBjZWxsLmRvbSkuc2V0Rm9ybWF0KGdldEZvcm1hdE5hbWUoc3R5bGUpLCB2YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBnZXRUYWJsZUZyb21DZWxsKGNlbGxzWzBdKS5lYWNoKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICAgIHJldHVybiBmaXJlVGFibGVNb2RpZmllZChlZGl0b3IsIHRhYmxlLmRvbSwgc3R5bGVNb2RpZmllZCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciByZWdpc3RlclF1ZXJ5Q29tbWFuZHMgPSBmdW5jdGlvbiAoZWRpdG9yLCBhY3Rpb25zLCBzZWxlY3Rpb25zKSB7XG4gICAgICB2YXIgaXNSb290ID0gZ2V0SXNSb290KGVkaXRvcik7XG4gICAgICB2YXIgZ2V0VGFibGVGcm9tQ2VsbCA9IGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgIHJldHVybiB0YWJsZShjZWxsLCBpc1Jvb3QpO1xuICAgICAgfTtcbiAgICAgIGVhY2gkMSh7XG4gICAgICAgIG1jZVRhYmxlUm93VHlwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBhY3Rpb25zLmdldFRhYmxlUm93VHlwZShlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZUNlbGxUeXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdGlvbnMuZ2V0VGFibGVDZWxsVHlwZShlZGl0b3IpO1xuICAgICAgICB9LFxuICAgICAgICBtY2VUYWJsZUNvbFR5cGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uU3RhcnRDZWxsKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvcikpLmJpbmQoZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRUYWJsZUZyb21DZWxsKGNlbGwpLm1hcChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICAgICAgdmFyIHRhcmdldHMgPSBmb3JNZW51KHNlbGVjdGlvbnMsIHRhYmxlLCBjZWxsKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnMuZ2V0VGFibGVDb2xUeXBlKHRhYmxlLCB0YXJnZXRzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLmdldE9yKCcnKTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGZ1bmMsIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGVkaXRvci5hZGRRdWVyeVZhbHVlSGFuZGxlcihuYW1lLCBmdW5jKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgQ2xpcGJvYXJkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJvd3MgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgY29scyA9IENlbGwoT3B0aW9uYWwubm9uZSgpKTtcbiAgICAgIHZhciBjbGVhckNsaXBib2FyZCA9IGZ1bmN0aW9uIChjbGlwYm9hcmQpIHtcbiAgICAgICAgY2xpcGJvYXJkLnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGdldFJvd3M6IHJvd3MuZ2V0LFxuICAgICAgICBzZXRSb3dzOiBmdW5jdGlvbiAocikge1xuICAgICAgICAgIHJvd3Muc2V0KHIpO1xuICAgICAgICAgIGNsZWFyQ2xpcGJvYXJkKGNvbHMpO1xuICAgICAgICB9LFxuICAgICAgICBjbGVhclJvd3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY2xlYXJDbGlwYm9hcmQocm93cyk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldENvbHVtbnM6IGNvbHMuZ2V0LFxuICAgICAgICBzZXRDb2x1bW5zOiBmdW5jdGlvbiAoYykge1xuICAgICAgICAgIGNvbHMuc2V0KGMpO1xuICAgICAgICAgIGNsZWFyQ2xpcGJvYXJkKHJvd3MpO1xuICAgICAgICB9LFxuICAgICAgICBjbGVhckNvbHVtbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gY2xlYXJDbGlwYm9hcmQoY29scyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBjZWxsRm9ybWF0cyA9IHtcbiAgICAgIHRhYmxlY2VsbGJhY2tncm91bmRjb2xvcjoge1xuICAgICAgICBzZWxlY3RvcjogJ3RkLHRoJyxcbiAgICAgICAgc3R5bGVzOiB7IGJhY2tncm91bmRDb2xvcjogJyV2YWx1ZScgfSxcbiAgICAgICAgcmVtb3ZlX3NpbWlsYXI6IHRydWVcbiAgICAgIH0sXG4gICAgICB0YWJsZWNlbGxib3JkZXJjb2xvcjoge1xuICAgICAgICBzZWxlY3RvcjogJ3RkLHRoJyxcbiAgICAgICAgc3R5bGVzOiB7IGJvcmRlckNvbG9yOiAnJXZhbHVlJyB9LFxuICAgICAgICByZW1vdmVfc2ltaWxhcjogdHJ1ZVxuICAgICAgfSxcbiAgICAgIHRhYmxlY2VsbGJvcmRlcnN0eWxlOiB7XG4gICAgICAgIHNlbGVjdG9yOiAndGQsdGgnLFxuICAgICAgICBzdHlsZXM6IHsgYm9yZGVyU3R5bGU6ICcldmFsdWUnIH0sXG4gICAgICAgIHJlbW92ZV9zaW1pbGFyOiB0cnVlXG4gICAgICB9LFxuICAgICAgdGFibGVjZWxsYm9yZGVyd2lkdGg6IHtcbiAgICAgICAgc2VsZWN0b3I6ICd0ZCx0aCcsXG4gICAgICAgIHN0eWxlczogeyBib3JkZXJXaWR0aDogJyV2YWx1ZScgfSxcbiAgICAgICAgcmVtb3ZlX3NpbWlsYXI6IHRydWVcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciByZWdpc3RlckZvcm1hdHMgPSBmdW5jdGlvbiAoZWRpdG9yKSB7XG4gICAgICBlZGl0b3IuZm9ybWF0dGVyLnJlZ2lzdGVyKGNlbGxGb3JtYXRzKTtcbiAgICB9O1xuXG4gICAgdmFyIGFkdCQyID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHsgbm9uZTogWydjdXJyZW50J10gfSxcbiAgICAgIHsgZmlyc3Q6IFsnY3VycmVudCddIH0sXG4gICAgICB7XG4gICAgICAgIG1pZGRsZTogW1xuICAgICAgICAgICdjdXJyZW50JyxcbiAgICAgICAgICAndGFyZ2V0J1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgeyBsYXN0OiBbJ2N1cnJlbnQnXSB9XG4gICAgXSk7XG4gICAgdmFyIG5vbmUkMiA9IGZ1bmN0aW9uIChjdXJyZW50KSB7XG4gICAgICBpZiAoY3VycmVudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGN1cnJlbnQgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWR0JDIubm9uZShjdXJyZW50KTtcbiAgICB9O1xuICAgIHZhciBDZWxsTG9jYXRpb24gPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYWR0JDIpLCB7IG5vbmU6IG5vbmUkMiB9KTtcblxuICAgIHZhciBkZXRlY3QkNSA9IGZ1bmN0aW9uIChjdXJyZW50LCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiB0YWJsZShjdXJyZW50LCBpc1Jvb3QpLmJpbmQoZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgIHZhciBhbGwgPSBjZWxscyh0YWJsZSk7XG4gICAgICAgIHZhciBpbmRleCA9IGZpbmRJbmRleChhbGwsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgcmV0dXJuIGVxJDEoY3VycmVudCwgeCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaW5kZXgubWFwKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbmRleDogaW5kZXgsXG4gICAgICAgICAgICBhbGw6IGFsbFxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIChjdXJyZW50LCBpc1Jvb3QpIHtcbiAgICAgIHZhciBkZXRlY3Rpb24gPSBkZXRlY3QkNShjdXJyZW50LCBpc1Jvb3QpO1xuICAgICAgcmV0dXJuIGRldGVjdGlvbi5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIENlbGxMb2NhdGlvbi5ub25lKGN1cnJlbnQpO1xuICAgICAgfSwgZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgcmV0dXJuIGluZm8uaW5kZXggKyAxIDwgaW5mby5hbGwubGVuZ3RoID8gQ2VsbExvY2F0aW9uLm1pZGRsZShjdXJyZW50LCBpbmZvLmFsbFtpbmZvLmluZGV4ICsgMV0pIDogQ2VsbExvY2F0aW9uLmxhc3QoY3VycmVudCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBwcmV2ID0gZnVuY3Rpb24gKGN1cnJlbnQsIGlzUm9vdCkge1xuICAgICAgdmFyIGRldGVjdGlvbiA9IGRldGVjdCQ1KGN1cnJlbnQsIGlzUm9vdCk7XG4gICAgICByZXR1cm4gZGV0ZWN0aW9uLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gQ2VsbExvY2F0aW9uLm5vbmUoKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgIHJldHVybiBpbmZvLmluZGV4IC0gMSA+PSAwID8gQ2VsbExvY2F0aW9uLm1pZGRsZShjdXJyZW50LCBpbmZvLmFsbFtpbmZvLmluZGV4IC0gMV0pIDogQ2VsbExvY2F0aW9uLmZpcnN0KGN1cnJlbnQpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGUkMiA9IGZ1bmN0aW9uIChzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgIHNvZmZzZXQ6IHNvZmZzZXQsXG4gICAgICAgIGZpbmlzaDogZmluaXNoLFxuICAgICAgICBmb2Zmc2V0OiBmb2Zmc2V0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFNpbVJhbmdlID0geyBjcmVhdGU6IGNyZWF0ZSQyIH07XG5cbiAgICB2YXIgYWR0JDMgPSBBZHQuZ2VuZXJhdGUoW1xuICAgICAgeyBiZWZvcmU6IFsnZWxlbWVudCddIH0sXG4gICAgICB7XG4gICAgICAgIG9uOiBbXG4gICAgICAgICAgJ2VsZW1lbnQnLFxuICAgICAgICAgICdvZmZzZXQnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7IGFmdGVyOiBbJ2VsZW1lbnQnXSB9XG4gICAgXSk7XG4gICAgdmFyIGNhdGEkMSA9IGZ1bmN0aW9uIChzdWJqZWN0LCBvbkJlZm9yZSwgb25Pbiwgb25BZnRlcikge1xuICAgICAgcmV0dXJuIHN1YmplY3QuZm9sZChvbkJlZm9yZSwgb25Pbiwgb25BZnRlcik7XG4gICAgfTtcbiAgICB2YXIgZ2V0U3RhcnQgPSBmdW5jdGlvbiAoc2l0dSkge1xuICAgICAgcmV0dXJuIHNpdHUuZm9sZChpZGVudGl0eSwgaWRlbnRpdHksIGlkZW50aXR5KTtcbiAgICB9O1xuICAgIHZhciBiZWZvcmUkMiA9IGFkdCQzLmJlZm9yZTtcbiAgICB2YXIgb24gPSBhZHQkMy5vbjtcbiAgICB2YXIgYWZ0ZXIkMiA9IGFkdCQzLmFmdGVyO1xuICAgIHZhciBTaXR1ID0ge1xuICAgICAgYmVmb3JlOiBiZWZvcmUkMixcbiAgICAgIG9uOiBvbixcbiAgICAgIGFmdGVyOiBhZnRlciQyLFxuICAgICAgY2F0YTogY2F0YSQxLFxuICAgICAgZ2V0U3RhcnQ6IGdldFN0YXJ0XG4gICAgfTtcblxuICAgIHZhciBhZHQkNCA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7IGRvbVJhbmdlOiBbJ3JuZyddIH0sXG4gICAgICB7XG4gICAgICAgIHJlbGF0aXZlOiBbXG4gICAgICAgICAgJ3N0YXJ0U2l0dScsXG4gICAgICAgICAgJ2ZpbmlzaFNpdHUnXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGV4YWN0OiBbXG4gICAgICAgICAgJ3N0YXJ0JyxcbiAgICAgICAgICAnc29mZnNldCcsXG4gICAgICAgICAgJ2ZpbmlzaCcsXG4gICAgICAgICAgJ2ZvZmZzZXQnXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdKTtcbiAgICB2YXIgZXhhY3RGcm9tUmFuZ2UgPSBmdW5jdGlvbiAoc2ltUmFuZ2UpIHtcbiAgICAgIHJldHVybiBhZHQkNC5leGFjdChzaW1SYW5nZS5zdGFydCwgc2ltUmFuZ2Uuc29mZnNldCwgc2ltUmFuZ2UuZmluaXNoLCBzaW1SYW5nZS5mb2Zmc2V0KTtcbiAgICB9O1xuICAgIHZhciBnZXRTdGFydCQxID0gZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgcmV0dXJuIHNlbGVjdGlvbi5tYXRjaCh7XG4gICAgICAgIGRvbVJhbmdlOiBmdW5jdGlvbiAocm5nKSB7XG4gICAgICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJuZy5zdGFydENvbnRhaW5lcik7XG4gICAgICAgIH0sXG4gICAgICAgIHJlbGF0aXZlOiBmdW5jdGlvbiAoc3RhcnRTaXR1LCBfZmluaXNoU2l0dSkge1xuICAgICAgICAgIHJldHVybiBTaXR1LmdldFN0YXJ0KHN0YXJ0U2l0dSk7XG4gICAgICAgIH0sXG4gICAgICAgIGV4YWN0OiBmdW5jdGlvbiAoc3RhcnQsIF9zb2Zmc2V0LCBfZmluaXNoLCBfZm9mZnNldCkge1xuICAgICAgICAgIHJldHVybiBzdGFydDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZG9tUmFuZ2UgPSBhZHQkNC5kb21SYW5nZTtcbiAgICB2YXIgcmVsYXRpdmUgPSBhZHQkNC5yZWxhdGl2ZTtcbiAgICB2YXIgZXhhY3QgPSBhZHQkNC5leGFjdDtcbiAgICB2YXIgZ2V0V2luID0gZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgdmFyIHN0YXJ0ID0gZ2V0U3RhcnQkMShzZWxlY3Rpb24pO1xuICAgICAgcmV0dXJuIGRlZmF1bHRWaWV3KHN0YXJ0KTtcbiAgICB9O1xuICAgIHZhciByYW5nZSQxID0gU2ltUmFuZ2UuY3JlYXRlO1xuICAgIHZhciBTaW1TZWxlY3Rpb24gPSB7XG4gICAgICBkb21SYW5nZTogZG9tUmFuZ2UsXG4gICAgICByZWxhdGl2ZTogcmVsYXRpdmUsXG4gICAgICBleGFjdDogZXhhY3QsXG4gICAgICBleGFjdEZyb21SYW5nZTogZXhhY3RGcm9tUmFuZ2UsXG4gICAgICBnZXRXaW46IGdldFdpbixcbiAgICAgIHJhbmdlOiByYW5nZSQxXG4gICAgfTtcblxuICAgIHZhciBzZWxlY3ROb2RlQ29udGVudHMgPSBmdW5jdGlvbiAod2luLCBlbGVtZW50KSB7XG4gICAgICB2YXIgcm5nID0gd2luLmRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICBzZWxlY3ROb2RlQ29udGVudHNVc2luZyhybmcsIGVsZW1lbnQpO1xuICAgICAgcmV0dXJuIHJuZztcbiAgICB9O1xuICAgIHZhciBzZWxlY3ROb2RlQ29udGVudHNVc2luZyA9IGZ1bmN0aW9uIChybmcsIGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBybmcuc2VsZWN0Tm9kZUNvbnRlbnRzKGVsZW1lbnQuZG9tKTtcbiAgICB9O1xuICAgIHZhciBzZXRTdGFydCA9IGZ1bmN0aW9uIChybmcsIHNpdHUpIHtcbiAgICAgIHNpdHUuZm9sZChmdW5jdGlvbiAoZSkge1xuICAgICAgICBybmcuc2V0U3RhcnRCZWZvcmUoZS5kb20pO1xuICAgICAgfSwgZnVuY3Rpb24gKGUsIG8pIHtcbiAgICAgICAgcm5nLnNldFN0YXJ0KGUuZG9tLCBvKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJuZy5zZXRTdGFydEFmdGVyKGUuZG9tKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHNldEZpbmlzaCA9IGZ1bmN0aW9uIChybmcsIHNpdHUpIHtcbiAgICAgIHNpdHUuZm9sZChmdW5jdGlvbiAoZSkge1xuICAgICAgICBybmcuc2V0RW5kQmVmb3JlKGUuZG9tKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlLCBvKSB7XG4gICAgICAgIHJuZy5zZXRFbmQoZS5kb20sIG8pO1xuICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcm5nLnNldEVuZEFmdGVyKGUuZG9tKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHJlbGF0aXZlVG9OYXRpdmUgPSBmdW5jdGlvbiAod2luLCBzdGFydFNpdHUsIGZpbmlzaFNpdHUpIHtcbiAgICAgIHZhciByYW5nZSA9IHdpbi5kb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgc2V0U3RhcnQocmFuZ2UsIHN0YXJ0U2l0dSk7XG4gICAgICBzZXRGaW5pc2gocmFuZ2UsIGZpbmlzaFNpdHUpO1xuICAgICAgcmV0dXJuIHJhbmdlO1xuICAgIH07XG4gICAgdmFyIGV4YWN0VG9OYXRpdmUgPSBmdW5jdGlvbiAod2luLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICB2YXIgcm5nID0gd2luLmRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICBybmcuc2V0U3RhcnQoc3RhcnQuZG9tLCBzb2Zmc2V0KTtcbiAgICAgIHJuZy5zZXRFbmQoZmluaXNoLmRvbSwgZm9mZnNldCk7XG4gICAgICByZXR1cm4gcm5nO1xuICAgIH07XG4gICAgdmFyIHRvUmVjdCA9IGZ1bmN0aW9uIChyZWN0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZWZ0OiByZWN0LmxlZnQsXG4gICAgICAgIHRvcDogcmVjdC50b3AsXG4gICAgICAgIHJpZ2h0OiByZWN0LnJpZ2h0LFxuICAgICAgICBib3R0b206IHJlY3QuYm90dG9tLFxuICAgICAgICB3aWR0aDogcmVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiByZWN0LmhlaWdodFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZXRGaXJzdFJlY3QgPSBmdW5jdGlvbiAocm5nKSB7XG4gICAgICB2YXIgcmVjdHMgPSBybmcuZ2V0Q2xpZW50UmVjdHMoKTtcbiAgICAgIHZhciByZWN0ID0gcmVjdHMubGVuZ3RoID4gMCA/IHJlY3RzWzBdIDogcm5nLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgcmV0dXJuIHJlY3Qud2lkdGggPiAwIHx8IHJlY3QuaGVpZ2h0ID4gMCA/IE9wdGlvbmFsLnNvbWUocmVjdCkubWFwKHRvUmVjdCkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgfTtcblxuICAgIHZhciBhZHQkNSA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7XG4gICAgICAgIGx0cjogW1xuICAgICAgICAgICdzdGFydCcsXG4gICAgICAgICAgJ3NvZmZzZXQnLFxuICAgICAgICAgICdmaW5pc2gnLFxuICAgICAgICAgICdmb2Zmc2V0J1xuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBydGw6IFtcbiAgICAgICAgICAnc3RhcnQnLFxuICAgICAgICAgICdzb2Zmc2V0JyxcbiAgICAgICAgICAnZmluaXNoJyxcbiAgICAgICAgICAnZm9mZnNldCdcbiAgICAgICAgXVxuICAgICAgfVxuICAgIF0pO1xuICAgIHZhciBmcm9tUmFuZ2UgPSBmdW5jdGlvbiAod2luLCB0eXBlLCByYW5nZSkge1xuICAgICAgcmV0dXJuIHR5cGUoU3VnYXJFbGVtZW50LmZyb21Eb20ocmFuZ2Uuc3RhcnRDb250YWluZXIpLCByYW5nZS5zdGFydE9mZnNldCwgU3VnYXJFbGVtZW50LmZyb21Eb20ocmFuZ2UuZW5kQ29udGFpbmVyKSwgcmFuZ2UuZW5kT2Zmc2V0KTtcbiAgICB9O1xuICAgIHZhciBnZXRSYW5nZXMgPSBmdW5jdGlvbiAod2luLCBzZWxlY3Rpb24pIHtcbiAgICAgIHJldHVybiBzZWxlY3Rpb24ubWF0Y2goe1xuICAgICAgICBkb21SYW5nZTogZnVuY3Rpb24gKHJuZykge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsdHI6IGNvbnN0YW50KHJuZyksXG4gICAgICAgICAgICBydGw6IE9wdGlvbmFsLm5vbmVcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICByZWxhdGl2ZTogZnVuY3Rpb24gKHN0YXJ0U2l0dSwgZmluaXNoU2l0dSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsdHI6IGNhY2hlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZWxhdGl2ZVRvTmF0aXZlKHdpbiwgc3RhcnRTaXR1LCBmaW5pc2hTaXR1KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgcnRsOiBjYWNoZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShyZWxhdGl2ZVRvTmF0aXZlKHdpbiwgZmluaXNoU2l0dSwgc3RhcnRTaXR1KSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGV4YWN0OiBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsdHI6IGNhY2hlZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBleGFjdFRvTmF0aXZlKHdpbiwgc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJ0bDogY2FjaGVkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoZXhhY3RUb05hdGl2ZSh3aW4sIGZpbmlzaCwgZm9mZnNldCwgc3RhcnQsIHNvZmZzZXQpKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZG9EaWFnbm9zZSA9IGZ1bmN0aW9uICh3aW4sIHJhbmdlcykge1xuICAgICAgdmFyIHJuZyA9IHJhbmdlcy5sdHIoKTtcbiAgICAgIGlmIChybmcuY29sbGFwc2VkKSB7XG4gICAgICAgIHZhciByZXZlcnNlZCA9IHJhbmdlcy5ydGwoKS5maWx0ZXIoZnVuY3Rpb24gKHJldikge1xuICAgICAgICAgIHJldHVybiByZXYuY29sbGFwc2VkID09PSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXZlcnNlZC5tYXAoZnVuY3Rpb24gKHJldikge1xuICAgICAgICAgIHJldHVybiBhZHQkNS5ydGwoU3VnYXJFbGVtZW50LmZyb21Eb20ocmV2LmVuZENvbnRhaW5lciksIHJldi5lbmRPZmZzZXQsIFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJldi5zdGFydENvbnRhaW5lciksIHJldi5zdGFydE9mZnNldCk7XG4gICAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBmcm9tUmFuZ2Uod2luLCBhZHQkNS5sdHIsIHJuZyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZyb21SYW5nZSh3aW4sIGFkdCQ1Lmx0ciwgcm5nKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciBkaWFnbm9zZSA9IGZ1bmN0aW9uICh3aW4sIHNlbGVjdGlvbikge1xuICAgICAgdmFyIHJhbmdlcyA9IGdldFJhbmdlcyh3aW4sIHNlbGVjdGlvbik7XG4gICAgICByZXR1cm4gZG9EaWFnbm9zZSh3aW4sIHJhbmdlcyk7XG4gICAgfTtcbiAgICB2YXIgYXNMdHJSYW5nZSA9IGZ1bmN0aW9uICh3aW4sIHNlbGVjdGlvbikge1xuICAgICAgdmFyIGRpYWdub3NpcyA9IGRpYWdub3NlKHdpbiwgc2VsZWN0aW9uKTtcbiAgICAgIHJldHVybiBkaWFnbm9zaXMubWF0Y2goe1xuICAgICAgICBsdHI6IGZ1bmN0aW9uIChzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICAgICAgdmFyIHJuZyA9IHdpbi5kb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgIHJuZy5zZXRTdGFydChzdGFydC5kb20sIHNvZmZzZXQpO1xuICAgICAgICAgIHJuZy5zZXRFbmQoZmluaXNoLmRvbSwgZm9mZnNldCk7XG4gICAgICAgICAgcmV0dXJuIHJuZztcbiAgICAgICAgfSxcbiAgICAgICAgcnRsOiBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgICAgIHZhciBybmcgPSB3aW4uZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgICBybmcuc2V0U3RhcnQoZmluaXNoLmRvbSwgZm9mZnNldCk7XG4gICAgICAgICAgcm5nLnNldEVuZChzdGFydC5kb20sIHNvZmZzZXQpO1xuICAgICAgICAgIHJldHVybiBybmc7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGx0ciQxID0gYWR0JDUubHRyO1xuICAgIHZhciBydGwkMSA9IGFkdCQ1LnJ0bDtcblxuICAgIHZhciBzZWFyY2hGb3JQb2ludCA9IGZ1bmN0aW9uIChyZWN0Rm9yT2Zmc2V0LCB4LCB5LCBtYXhYLCBsZW5ndGgpIHtcbiAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9IGVsc2UgaWYgKHggPT09IG1heFgpIHtcbiAgICAgICAgcmV0dXJuIGxlbmd0aCAtIDE7XG4gICAgICB9XG4gICAgICB2YXIgeERlbHRhID0gbWF4WDtcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHJlY3QgPSByZWN0Rm9yT2Zmc2V0KGkpO1xuICAgICAgICB2YXIgY3VyRGVsdGFYID0gTWF0aC5hYnMoeCAtIHJlY3QubGVmdCk7XG4gICAgICAgIGlmICh5IDw9IHJlY3QuYm90dG9tKSB7XG4gICAgICAgICAgaWYgKHkgPCByZWN0LnRvcCB8fCBjdXJEZWx0YVggPiB4RGVsdGEpIHtcbiAgICAgICAgICAgIHJldHVybiBpIC0gMTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeERlbHRhID0gY3VyRGVsdGFYO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIDA7XG4gICAgfTtcbiAgICB2YXIgaW5SZWN0ID0gZnVuY3Rpb24gKHJlY3QsIHgsIHkpIHtcbiAgICAgIHJldHVybiB4ID49IHJlY3QubGVmdCAmJiB4IDw9IHJlY3QucmlnaHQgJiYgeSA+PSByZWN0LnRvcCAmJiB5IDw9IHJlY3QuYm90dG9tO1xuICAgIH07XG5cbiAgICB2YXIgbG9jYXRlT2Zmc2V0ID0gZnVuY3Rpb24gKGRvYywgdGV4dG5vZGUsIHgsIHksIHJlY3QpIHtcbiAgICAgIHZhciByYW5nZUZvck9mZnNldCA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHZhciByID0gZG9jLmRvbS5jcmVhdGVSYW5nZSgpO1xuICAgICAgICByLnNldFN0YXJ0KHRleHRub2RlLmRvbSwgbyk7XG4gICAgICAgIHIuY29sbGFwc2UodHJ1ZSk7XG4gICAgICAgIHJldHVybiByO1xuICAgICAgfTtcbiAgICAgIHZhciByZWN0Rm9yT2Zmc2V0ID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgdmFyIHIgPSByYW5nZUZvck9mZnNldChvKTtcbiAgICAgICAgcmV0dXJuIHIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICB9O1xuICAgICAgdmFyIGxlbmd0aCA9IGdldCQ0KHRleHRub2RlKS5sZW5ndGg7XG4gICAgICB2YXIgb2Zmc2V0ID0gc2VhcmNoRm9yUG9pbnQocmVjdEZvck9mZnNldCwgeCwgeSwgcmVjdC5yaWdodCwgbGVuZ3RoKTtcbiAgICAgIHJldHVybiByYW5nZUZvck9mZnNldChvZmZzZXQpO1xuICAgIH07XG4gICAgdmFyIGxvY2F0ZSA9IGZ1bmN0aW9uIChkb2MsIG5vZGUsIHgsIHkpIHtcbiAgICAgIHZhciByID0gZG9jLmRvbS5jcmVhdGVSYW5nZSgpO1xuICAgICAgci5zZWxlY3ROb2RlKG5vZGUuZG9tKTtcbiAgICAgIHZhciByZWN0cyA9IHIuZ2V0Q2xpZW50UmVjdHMoKTtcbiAgICAgIHZhciBmb3VuZFJlY3QgPSBmaW5kTWFwKHJlY3RzLCBmdW5jdGlvbiAocmVjdCkge1xuICAgICAgICByZXR1cm4gaW5SZWN0KHJlY3QsIHgsIHkpID8gT3B0aW9uYWwuc29tZShyZWN0KSA6IE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZvdW5kUmVjdC5tYXAoZnVuY3Rpb24gKHJlY3QpIHtcbiAgICAgICAgcmV0dXJuIGxvY2F0ZU9mZnNldChkb2MsIG5vZGUsIHgsIHksIHJlY3QpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBzZWFyY2hJbkNoaWxkcmVuID0gZnVuY3Rpb24gKGRvYywgbm9kZSwgeCwgeSkge1xuICAgICAgdmFyIHIgPSBkb2MuZG9tLmNyZWF0ZVJhbmdlKCk7XG4gICAgICB2YXIgbm9kZXMgPSBjaGlsZHJlbihub2RlKTtcbiAgICAgIHJldHVybiBmaW5kTWFwKG5vZGVzLCBmdW5jdGlvbiAobikge1xuICAgICAgICByLnNlbGVjdE5vZGUobi5kb20pO1xuICAgICAgICByZXR1cm4gaW5SZWN0KHIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIHgsIHkpID8gbG9jYXRlTm9kZShkb2MsIG4sIHgsIHkpIDogT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbG9jYXRlTm9kZSA9IGZ1bmN0aW9uIChkb2MsIG5vZGUsIHgsIHkpIHtcbiAgICAgIHJldHVybiBpc1RleHQobm9kZSkgPyBsb2NhdGUoZG9jLCBub2RlLCB4LCB5KSA6IHNlYXJjaEluQ2hpbGRyZW4oZG9jLCBub2RlLCB4LCB5KTtcbiAgICB9O1xuICAgIHZhciBsb2NhdGUkMSA9IGZ1bmN0aW9uIChkb2MsIG5vZGUsIHgsIHkpIHtcbiAgICAgIHZhciByID0gZG9jLmRvbS5jcmVhdGVSYW5nZSgpO1xuICAgICAgci5zZWxlY3ROb2RlKG5vZGUuZG9tKTtcbiAgICAgIHZhciByZWN0ID0gci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHZhciBib3VuZGVkWCA9IE1hdGgubWF4KHJlY3QubGVmdCwgTWF0aC5taW4ocmVjdC5yaWdodCwgeCkpO1xuICAgICAgdmFyIGJvdW5kZWRZID0gTWF0aC5tYXgocmVjdC50b3AsIE1hdGgubWluKHJlY3QuYm90dG9tLCB5KSk7XG4gICAgICByZXR1cm4gbG9jYXRlTm9kZShkb2MsIG5vZGUsIGJvdW5kZWRYLCBib3VuZGVkWSk7XG4gICAgfTtcblxuICAgIHZhciBDT0xMQVBTRV9UT19MRUZUID0gdHJ1ZTtcbiAgICB2YXIgQ09MTEFQU0VfVE9fUklHSFQgPSBmYWxzZTtcbiAgICB2YXIgZ2V0Q29sbGFwc2VEaXJlY3Rpb24gPSBmdW5jdGlvbiAocmVjdCwgeCkge1xuICAgICAgcmV0dXJuIHggLSByZWN0LmxlZnQgPCByZWN0LnJpZ2h0IC0geCA/IENPTExBUFNFX1RPX0xFRlQgOiBDT0xMQVBTRV9UT19SSUdIVDtcbiAgICB9O1xuICAgIHZhciBjcmVhdGVDb2xsYXBzZWROb2RlID0gZnVuY3Rpb24gKGRvYywgdGFyZ2V0LCBjb2xsYXBzZURpcmVjdGlvbikge1xuICAgICAgdmFyIHIgPSBkb2MuZG9tLmNyZWF0ZVJhbmdlKCk7XG4gICAgICByLnNlbGVjdE5vZGUodGFyZ2V0LmRvbSk7XG4gICAgICByLmNvbGxhcHNlKGNvbGxhcHNlRGlyZWN0aW9uKTtcbiAgICAgIHJldHVybiByO1xuICAgIH07XG4gICAgdmFyIGxvY2F0ZUluRWxlbWVudCA9IGZ1bmN0aW9uIChkb2MsIG5vZGUsIHgpIHtcbiAgICAgIHZhciBjdXJzb3JSYW5nZSA9IGRvYy5kb20uY3JlYXRlUmFuZ2UoKTtcbiAgICAgIGN1cnNvclJhbmdlLnNlbGVjdE5vZGUobm9kZS5kb20pO1xuICAgICAgdmFyIHJlY3QgPSBjdXJzb3JSYW5nZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHZhciBjb2xsYXBzZURpcmVjdGlvbiA9IGdldENvbGxhcHNlRGlyZWN0aW9uKHJlY3QsIHgpO1xuICAgICAgdmFyIGYgPSBjb2xsYXBzZURpcmVjdGlvbiA9PT0gQ09MTEFQU0VfVE9fTEVGVCA/IGZpcnN0IDogbGFzdCQxO1xuICAgICAgcmV0dXJuIGYobm9kZSkubWFwKGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUNvbGxhcHNlZE5vZGUoZG9jLCB0YXJnZXQsIGNvbGxhcHNlRGlyZWN0aW9uKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGxvY2F0ZUluRW1wdHkgPSBmdW5jdGlvbiAoZG9jLCBub2RlLCB4KSB7XG4gICAgICB2YXIgcmVjdCA9IG5vZGUuZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgdmFyIGNvbGxhcHNlRGlyZWN0aW9uID0gZ2V0Q29sbGFwc2VEaXJlY3Rpb24ocmVjdCwgeCk7XG4gICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShjcmVhdGVDb2xsYXBzZWROb2RlKGRvYywgbm9kZSwgY29sbGFwc2VEaXJlY3Rpb24pKTtcbiAgICB9O1xuICAgIHZhciBzZWFyY2ggPSBmdW5jdGlvbiAoZG9jLCBub2RlLCB4KSB7XG4gICAgICB2YXIgZiA9IGNoaWxkcmVuKG5vZGUpLmxlbmd0aCA9PT0gMCA/IGxvY2F0ZUluRW1wdHkgOiBsb2NhdGVJbkVsZW1lbnQ7XG4gICAgICByZXR1cm4gZihkb2MsIG5vZGUsIHgpO1xuICAgIH07XG5cbiAgICB2YXIgY2FyZXRQb3NpdGlvbkZyb21Qb2ludCA9IGZ1bmN0aW9uIChkb2MsIHgsIHkpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGRvYy5kb20uY2FyZXRQb3NpdGlvbkZyb21Qb2ludCh4LCB5KSkuYmluZChmdW5jdGlvbiAocG9zKSB7XG4gICAgICAgIGlmIChwb3Mub2Zmc2V0Tm9kZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHIgPSBkb2MuZG9tLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIHIuc2V0U3RhcnQocG9zLm9mZnNldE5vZGUsIHBvcy5vZmZzZXQpO1xuICAgICAgICByLmNvbGxhcHNlKCk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKHIpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgY2FyZXRSYW5nZUZyb21Qb2ludCA9IGZ1bmN0aW9uIChkb2MsIHgsIHkpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKGRvYy5kb20uY2FyZXRSYW5nZUZyb21Qb2ludCh4LCB5KSk7XG4gICAgfTtcbiAgICB2YXIgc2VhcmNoVGV4dE5vZGVzID0gZnVuY3Rpb24gKGRvYywgbm9kZSwgeCwgeSkge1xuICAgICAgdmFyIHIgPSBkb2MuZG9tLmNyZWF0ZVJhbmdlKCk7XG4gICAgICByLnNlbGVjdE5vZGUobm9kZS5kb20pO1xuICAgICAgdmFyIHJlY3QgPSByLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgdmFyIGJvdW5kZWRYID0gTWF0aC5tYXgocmVjdC5sZWZ0LCBNYXRoLm1pbihyZWN0LnJpZ2h0LCB4KSk7XG4gICAgICB2YXIgYm91bmRlZFkgPSBNYXRoLm1heChyZWN0LnRvcCwgTWF0aC5taW4ocmVjdC5ib3R0b20sIHkpKTtcbiAgICAgIHJldHVybiBsb2NhdGUkMShkb2MsIG5vZGUsIGJvdW5kZWRYLCBib3VuZGVkWSk7XG4gICAgfTtcbiAgICB2YXIgc2VhcmNoRnJvbVBvaW50ID0gZnVuY3Rpb24gKGRvYywgeCwgeSkge1xuICAgICAgcmV0dXJuIFN1Z2FyRWxlbWVudC5mcm9tUG9pbnQoZG9jLCB4LCB5KS5iaW5kKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHZhciBmYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gc2VhcmNoKGRvYywgZWxlbSwgeCk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjaGlsZHJlbihlbGVtKS5sZW5ndGggPT09IDAgPyBmYWxsYmFjaygpIDogc2VhcmNoVGV4dE5vZGVzKGRvYywgZWxlbSwgeCwgeSkub3JUaHVuayhmYWxsYmFjayk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBhdmFpbGFibGVTZWFyY2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoZG9jdW1lbnQuY2FyZXRQb3NpdGlvbkZyb21Qb2ludCkge1xuICAgICAgICByZXR1cm4gY2FyZXRQb3NpdGlvbkZyb21Qb2ludDtcbiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuY2FyZXRSYW5nZUZyb21Qb2ludCkge1xuICAgICAgICByZXR1cm4gY2FyZXRSYW5nZUZyb21Qb2ludDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBzZWFyY2hGcm9tUG9pbnQ7XG4gICAgICB9XG4gICAgfSgpO1xuICAgIHZhciBmcm9tUG9pbnQkMSA9IGZ1bmN0aW9uICh3aW4sIHgsIHkpIHtcbiAgICAgIHZhciBkb2MgPSBTdWdhckVsZW1lbnQuZnJvbURvbSh3aW4uZG9jdW1lbnQpO1xuICAgICAgcmV0dXJuIGF2YWlsYWJsZVNlYXJjaChkb2MsIHgsIHkpLm1hcChmdW5jdGlvbiAocm5nKSB7XG4gICAgICAgIHJldHVybiBTaW1SYW5nZS5jcmVhdGUoU3VnYXJFbGVtZW50LmZyb21Eb20ocm5nLnN0YXJ0Q29udGFpbmVyKSwgcm5nLnN0YXJ0T2Zmc2V0LCBTdWdhckVsZW1lbnQuZnJvbURvbShybmcuZW5kQ29udGFpbmVyKSwgcm5nLmVuZE9mZnNldCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGJlZm9yZVNwZWNpYWwgPSBmdW5jdGlvbiAoZWxlbWVudCwgb2Zmc2V0KSB7XG4gICAgICB2YXIgbmFtZSQxID0gbmFtZShlbGVtZW50KTtcbiAgICAgIGlmICgnaW5wdXQnID09PSBuYW1lJDEpIHtcbiAgICAgICAgcmV0dXJuIFNpdHUuYWZ0ZXIoZWxlbWVudCk7XG4gICAgICB9IGVsc2UgaWYgKCFjb250YWlucyhbXG4gICAgICAgICAgJ2JyJyxcbiAgICAgICAgICAnaW1nJ1xuICAgICAgICBdLCBuYW1lJDEpKSB7XG4gICAgICAgIHJldHVybiBTaXR1Lm9uKGVsZW1lbnQsIG9mZnNldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gb2Zmc2V0ID09PSAwID8gU2l0dS5iZWZvcmUoZWxlbWVudCkgOiBTaXR1LmFmdGVyKGVsZW1lbnQpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHByZXByb2Nlc3NSZWxhdGl2ZSA9IGZ1bmN0aW9uIChzdGFydFNpdHUsIGZpbmlzaFNpdHUpIHtcbiAgICAgIHZhciBzdGFydCA9IHN0YXJ0U2l0dS5mb2xkKFNpdHUuYmVmb3JlLCBiZWZvcmVTcGVjaWFsLCBTaXR1LmFmdGVyKTtcbiAgICAgIHZhciBmaW5pc2ggPSBmaW5pc2hTaXR1LmZvbGQoU2l0dS5iZWZvcmUsIGJlZm9yZVNwZWNpYWwsIFNpdHUuYWZ0ZXIpO1xuICAgICAgcmV0dXJuIFNpbVNlbGVjdGlvbi5yZWxhdGl2ZShzdGFydCwgZmluaXNoKTtcbiAgICB9O1xuICAgIHZhciBwcmVwcm9jZXNzRXhhY3QgPSBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgdmFyIHN0YXJ0U2l0dSA9IGJlZm9yZVNwZWNpYWwoc3RhcnQsIHNvZmZzZXQpO1xuICAgICAgdmFyIGZpbmlzaFNpdHUgPSBiZWZvcmVTcGVjaWFsKGZpbmlzaCwgZm9mZnNldCk7XG4gICAgICByZXR1cm4gU2ltU2VsZWN0aW9uLnJlbGF0aXZlKHN0YXJ0U2l0dSwgZmluaXNoU2l0dSk7XG4gICAgfTtcbiAgICB2YXIgcHJlcHJvY2VzcyA9IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgIHJldHVybiBzZWxlY3Rpb24ubWF0Y2goe1xuICAgICAgICBkb21SYW5nZTogZnVuY3Rpb24gKHJuZykge1xuICAgICAgICAgIHZhciBzdGFydCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJuZy5zdGFydENvbnRhaW5lcik7XG4gICAgICAgICAgdmFyIGZpbmlzaCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJuZy5lbmRDb250YWluZXIpO1xuICAgICAgICAgIHJldHVybiBwcmVwcm9jZXNzRXhhY3Qoc3RhcnQsIHJuZy5zdGFydE9mZnNldCwgZmluaXNoLCBybmcuZW5kT2Zmc2V0KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVsYXRpdmU6IHByZXByb2Nlc3NSZWxhdGl2ZSxcbiAgICAgICAgZXhhY3Q6IHByZXByb2Nlc3NFeGFjdFxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBtYWtlUmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgdmFyIGRvYyA9IG93bmVyKHN0YXJ0KTtcbiAgICAgIHZhciBybmcgPSBkb2MuZG9tLmNyZWF0ZVJhbmdlKCk7XG4gICAgICBybmcuc2V0U3RhcnQoc3RhcnQuZG9tLCBzb2Zmc2V0KTtcbiAgICAgIHJuZy5zZXRFbmQoZmluaXNoLmRvbSwgZm9mZnNldCk7XG4gICAgICByZXR1cm4gcm5nO1xuICAgIH07XG4gICAgdmFyIGFmdGVyJDMgPSBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgdmFyIHIgPSBtYWtlUmFuZ2Uoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCk7XG4gICAgICB2YXIgc2FtZSA9IGVxJDEoc3RhcnQsIGZpbmlzaCkgJiYgc29mZnNldCA9PT0gZm9mZnNldDtcbiAgICAgIHJldHVybiByLmNvbGxhcHNlZCAmJiAhc2FtZTtcbiAgICB9O1xuXG4gICAgdmFyIGdldE5hdGl2ZVNlbGVjdGlvbiA9IGZ1bmN0aW9uICh3aW4pIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5mcm9tKHdpbi5nZXRTZWxlY3Rpb24oKSk7XG4gICAgfTtcbiAgICB2YXIgZG9TZXROYXRpdmVSYW5nZSA9IGZ1bmN0aW9uICh3aW4sIHJuZykge1xuICAgICAgZ2V0TmF0aXZlU2VsZWN0aW9uKHdpbikuZWFjaChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICAgIHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgc2VsZWN0aW9uLmFkZFJhbmdlKHJuZyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBkb1NldFJhbmdlID0gZnVuY3Rpb24gKHdpbiwgc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgdmFyIHJuZyA9IGV4YWN0VG9OYXRpdmUod2luLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KTtcbiAgICAgIGRvU2V0TmF0aXZlUmFuZ2Uod2luLCBybmcpO1xuICAgIH07XG4gICAgdmFyIHNldExlZ2FjeVJ0bFJhbmdlID0gZnVuY3Rpb24gKHdpbiwgc2VsZWN0aW9uLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICBzZWxlY3Rpb24uY29sbGFwc2Uoc3RhcnQuZG9tLCBzb2Zmc2V0KTtcbiAgICAgIHNlbGVjdGlvbi5leHRlbmQoZmluaXNoLmRvbSwgZm9mZnNldCk7XG4gICAgfTtcbiAgICB2YXIgc2V0UmFuZ2VGcm9tUmVsYXRpdmUgPSBmdW5jdGlvbiAod2luLCByZWxhdGl2ZSkge1xuICAgICAgcmV0dXJuIGRpYWdub3NlKHdpbiwgcmVsYXRpdmUpLm1hdGNoKHtcbiAgICAgICAgbHRyOiBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgICAgIGRvU2V0UmFuZ2Uod2luLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KTtcbiAgICAgICAgfSxcbiAgICAgICAgcnRsOiBmdW5jdGlvbiAoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgICAgIGdldE5hdGl2ZVNlbGVjdGlvbih3aW4pLmVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5zZXRCYXNlQW5kRXh0ZW50KSB7XG4gICAgICAgICAgICAgIHNlbGVjdGlvbi5zZXRCYXNlQW5kRXh0ZW50KHN0YXJ0LmRvbSwgc29mZnNldCwgZmluaXNoLmRvbSwgZm9mZnNldCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi5leHRlbmQpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBzZXRMZWdhY3lSdGxSYW5nZSh3aW4sIHNlbGVjdGlvbiwgc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBkb1NldFJhbmdlKHdpbiwgZmluaXNoLCBmb2Zmc2V0LCBzdGFydCwgc29mZnNldCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRvU2V0UmFuZ2Uod2luLCBmaW5pc2gsIGZvZmZzZXQsIHN0YXJ0LCBzb2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0RXhhY3QgPSBmdW5jdGlvbiAod2luLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICB2YXIgcmVsYXRpdmUgPSBwcmVwcm9jZXNzRXhhY3Qoc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCk7XG4gICAgICBzZXRSYW5nZUZyb21SZWxhdGl2ZSh3aW4sIHJlbGF0aXZlKTtcbiAgICB9O1xuICAgIHZhciBzZXRSZWxhdGl2ZSA9IGZ1bmN0aW9uICh3aW4sIHN0YXJ0U2l0dSwgZmluaXNoU2l0dSkge1xuICAgICAgdmFyIHJlbGF0aXZlID0gcHJlcHJvY2Vzc1JlbGF0aXZlKHN0YXJ0U2l0dSwgZmluaXNoU2l0dSk7XG4gICAgICBzZXRSYW5nZUZyb21SZWxhdGl2ZSh3aW4sIHJlbGF0aXZlKTtcbiAgICB9O1xuICAgIHZhciB0b05hdGl2ZSA9IGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgIHZhciB3aW4gPSBTaW1TZWxlY3Rpb24uZ2V0V2luKHNlbGVjdGlvbikuZG9tO1xuICAgICAgdmFyIGdldERvbVJhbmdlID0gZnVuY3Rpb24gKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIGV4YWN0VG9OYXRpdmUod2luLCBzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KTtcbiAgICAgIH07XG4gICAgICB2YXIgZmlsdGVyZWQgPSBwcmVwcm9jZXNzKHNlbGVjdGlvbik7XG4gICAgICByZXR1cm4gZGlhZ25vc2Uod2luLCBmaWx0ZXJlZCkubWF0Y2goe1xuICAgICAgICBsdHI6IGdldERvbVJhbmdlLFxuICAgICAgICBydGw6IGdldERvbVJhbmdlXG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciByZWFkUmFuZ2UgPSBmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICBpZiAoc2VsZWN0aW9uLnJhbmdlQ291bnQgPiAwKSB7XG4gICAgICAgIHZhciBmaXJzdFJuZyA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApO1xuICAgICAgICB2YXIgbGFzdFJuZyA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KHNlbGVjdGlvbi5yYW5nZUNvdW50IC0gMSk7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKFNpbVJhbmdlLmNyZWF0ZShTdWdhckVsZW1lbnQuZnJvbURvbShmaXJzdFJuZy5zdGFydENvbnRhaW5lciksIGZpcnN0Um5nLnN0YXJ0T2Zmc2V0LCBTdWdhckVsZW1lbnQuZnJvbURvbShsYXN0Um5nLmVuZENvbnRhaW5lciksIGxhc3RSbmcuZW5kT2Zmc2V0KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGRvR2V0RXhhY3QgPSBmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICBpZiAoc2VsZWN0aW9uLmFuY2hvck5vZGUgPT09IG51bGwgfHwgc2VsZWN0aW9uLmZvY3VzTm9kZSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gcmVhZFJhbmdlKHNlbGVjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgYW5jaG9yID0gU3VnYXJFbGVtZW50LmZyb21Eb20oc2VsZWN0aW9uLmFuY2hvck5vZGUpO1xuICAgICAgICB2YXIgZm9jdXNfMSA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHNlbGVjdGlvbi5mb2N1c05vZGUpO1xuICAgICAgICByZXR1cm4gYWZ0ZXIkMyhhbmNob3IsIHNlbGVjdGlvbi5hbmNob3JPZmZzZXQsIGZvY3VzXzEsIHNlbGVjdGlvbi5mb2N1c09mZnNldCkgPyBPcHRpb25hbC5zb21lKFNpbVJhbmdlLmNyZWF0ZShhbmNob3IsIHNlbGVjdGlvbi5hbmNob3JPZmZzZXQsIGZvY3VzXzEsIHNlbGVjdGlvbi5mb2N1c09mZnNldCkpIDogcmVhZFJhbmdlKHNlbGVjdGlvbik7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgc2V0VG9FbGVtZW50ID0gZnVuY3Rpb24gKHdpbiwgZWxlbWVudCkge1xuICAgICAgdmFyIHJuZyA9IHNlbGVjdE5vZGVDb250ZW50cyh3aW4sIGVsZW1lbnQpO1xuICAgICAgZG9TZXROYXRpdmVSYW5nZSh3aW4sIHJuZyk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RXhhY3QgPSBmdW5jdGlvbiAod2luKSB7XG4gICAgICByZXR1cm4gZ2V0TmF0aXZlU2VsZWN0aW9uKHdpbikuZmlsdGVyKGZ1bmN0aW9uIChzZWwpIHtcbiAgICAgICAgcmV0dXJuIHNlbC5yYW5nZUNvdW50ID4gMDtcbiAgICAgIH0pLmJpbmQoZG9HZXRFeGFjdCk7XG4gICAgfTtcbiAgICB2YXIgZ2V0JGMgPSBmdW5jdGlvbiAod2luKSB7XG4gICAgICByZXR1cm4gZ2V0RXhhY3Qod2luKS5tYXAoZnVuY3Rpb24gKHJhbmdlKSB7XG4gICAgICAgIHJldHVybiBTaW1TZWxlY3Rpb24uZXhhY3QocmFuZ2Uuc3RhcnQsIHJhbmdlLnNvZmZzZXQsIHJhbmdlLmZpbmlzaCwgcmFuZ2UuZm9mZnNldCk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnZXRGaXJzdFJlY3QkMSA9IGZ1bmN0aW9uICh3aW4sIHNlbGVjdGlvbikge1xuICAgICAgdmFyIHJuZyA9IGFzTHRyUmFuZ2Uod2luLCBzZWxlY3Rpb24pO1xuICAgICAgcmV0dXJuIGdldEZpcnN0UmVjdChybmcpO1xuICAgIH07XG4gICAgdmFyIGdldEF0UG9pbnQgPSBmdW5jdGlvbiAod2luLCB4LCB5KSB7XG4gICAgICByZXR1cm4gZnJvbVBvaW50JDEod2luLCB4LCB5KTtcbiAgICB9O1xuICAgIHZhciBjbGVhciA9IGZ1bmN0aW9uICh3aW4pIHtcbiAgICAgIGdldE5hdGl2ZVNlbGVjdGlvbih3aW4pLmVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikge1xuICAgICAgICByZXR1cm4gc2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBnbG9iYWwkMyA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCd0aW55bWNlLnV0aWwuVksnKTtcblxuICAgIHZhciBmb3J3YXJkID0gZnVuY3Rpb24gKGVkaXRvciwgaXNSb290LCBjZWxsKSB7XG4gICAgICByZXR1cm4gZ28oZWRpdG9yLCBpc1Jvb3QsIG5leHQoY2VsbCkpO1xuICAgIH07XG4gICAgdmFyIGJhY2t3YXJkID0gZnVuY3Rpb24gKGVkaXRvciwgaXNSb290LCBjZWxsKSB7XG4gICAgICByZXR1cm4gZ28oZWRpdG9yLCBpc1Jvb3QsIHByZXYoY2VsbCkpO1xuICAgIH07XG4gICAgdmFyIGdldENlbGxGaXJzdEN1cnNvclBvc2l0aW9uID0gZnVuY3Rpb24gKGVkaXRvciwgY2VsbCkge1xuICAgICAgdmFyIHNlbGVjdGlvbiA9IFNpbVNlbGVjdGlvbi5leGFjdChjZWxsLCAwLCBjZWxsLCAwKTtcbiAgICAgIHJldHVybiB0b05hdGl2ZShzZWxlY3Rpb24pO1xuICAgIH07XG4gICAgdmFyIGdldE5ld1Jvd0N1cnNvclBvc2l0aW9uID0gZnVuY3Rpb24gKGVkaXRvciwgdGFibGUpIHtcbiAgICAgIHZhciByb3dzID0gZGVzY2VuZGFudHMkMSh0YWJsZSwgJ3RyJyk7XG4gICAgICByZXR1cm4gbGFzdChyb3dzKS5iaW5kKGZ1bmN0aW9uIChsYXN0KSB7XG4gICAgICAgIHJldHVybiBkZXNjZW5kYW50JDEobGFzdCwgJ3RkLHRoJykubWFwKGZ1bmN0aW9uIChmaXJzdCkge1xuICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlyc3RDdXJzb3JQb3NpdGlvbihlZGl0b3IsIGZpcnN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBnbyA9IGZ1bmN0aW9uIChlZGl0b3IsIGlzUm9vdCwgY2VsbCkge1xuICAgICAgcmV0dXJuIGNlbGwuZm9sZChPcHRpb25hbC5ub25lLCBPcHRpb25hbC5ub25lLCBmdW5jdGlvbiAoY3VycmVudCwgbmV4dCkge1xuICAgICAgICByZXR1cm4gZmlyc3QobmV4dCkubWFwKGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGdldENlbGxGaXJzdEN1cnNvclBvc2l0aW9uKGVkaXRvciwgY2VsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSwgZnVuY3Rpb24gKGN1cnJlbnQpIHtcbiAgICAgICAgcmV0dXJuIHRhYmxlKGN1cnJlbnQsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICBlZGl0b3IuZXhlY0NvbW1hbmQoJ21jZVRhYmxlSW5zZXJ0Um93QWZ0ZXInKTtcbiAgICAgICAgICByZXR1cm4gZ2V0TmV3Um93Q3Vyc29yUG9zaXRpb24oZWRpdG9yLCB0YWJsZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcm9vdEVsZW1lbnRzID0gW1xuICAgICAgJ3RhYmxlJyxcbiAgICAgICdsaScsXG4gICAgICAnZGwnXG4gICAgXTtcbiAgICB2YXIgaGFuZGxlJDEgPSBmdW5jdGlvbiAoZXZlbnQsIGVkaXRvciwgY2VsbFNlbGVjdGlvbikge1xuICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGdsb2JhbCQzLlRBQikge1xuICAgICAgICB2YXIgYm9keV8xID0gZ2V0Qm9keSQxKGVkaXRvcik7XG4gICAgICAgIHZhciBpc1Jvb3RfMSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgdmFyIG5hbWUkMSA9IG5hbWUoZWxlbWVudCk7XG4gICAgICAgICAgcmV0dXJuIGVxJDEoZWxlbWVudCwgYm9keV8xKSB8fCBjb250YWlucyhyb290RWxlbWVudHMsIG5hbWUkMSk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBybmcgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuICAgICAgICB2YXIgY29udGFpbmVyID0gU3VnYXJFbGVtZW50LmZyb21Eb20oZXZlbnQuc2hpZnRLZXkgPyBybmcuc3RhcnRDb250YWluZXIgOiBybmcuZW5kQ29udGFpbmVyKTtcbiAgICAgICAgY2VsbChjb250YWluZXIsIGlzUm9vdF8xKS5lYWNoKGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB0YWJsZShjZWxsLCBpc1Jvb3RfMSkuZWFjaChjZWxsU2VsZWN0aW9uLmNsZWFyKTtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLmNvbGxhcHNlKGV2ZW50LnNoaWZ0S2V5KTtcbiAgICAgICAgICB2YXIgbmF2aWdhdGlvbiA9IGV2ZW50LnNoaWZ0S2V5ID8gYmFja3dhcmQgOiBmb3J3YXJkO1xuICAgICAgICAgIHZhciBybmcgPSBuYXZpZ2F0aW9uKGVkaXRvciwgaXNSb290XzEsIGNlbGwpO1xuICAgICAgICAgIHJuZy5lYWNoKGZ1bmN0aW9uIChyYW5nZSkge1xuICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSbmcocmFuZ2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZSQzID0gZnVuY3Rpb24gKHNlbGVjdGlvbiwga2lsbCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb24sXG4gICAgICAgIGtpbGw6IGtpbGxcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgUmVzcG9uc2UgPSB7IGNyZWF0ZTogY3JlYXRlJDMgfTtcblxuICAgIHZhciBjcmVhdGUkNCA9IGZ1bmN0aW9uIChzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGFydDogU2l0dS5vbihzdGFydCwgc29mZnNldCksXG4gICAgICAgIGZpbmlzaDogU2l0dS5vbihmaW5pc2gsIGZvZmZzZXQpXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFNpdHVzID0geyBjcmVhdGU6IGNyZWF0ZSQ0IH07XG5cbiAgICB2YXIgY29udmVydFRvUmFuZ2UgPSBmdW5jdGlvbiAod2luLCBzZWxlY3Rpb24pIHtcbiAgICAgIHZhciBybmcgPSBhc0x0clJhbmdlKHdpbiwgc2VsZWN0aW9uKTtcbiAgICAgIHJldHVybiBTaW1SYW5nZS5jcmVhdGUoU3VnYXJFbGVtZW50LmZyb21Eb20ocm5nLnN0YXJ0Q29udGFpbmVyKSwgcm5nLnN0YXJ0T2Zmc2V0LCBTdWdhckVsZW1lbnQuZnJvbURvbShybmcuZW5kQ29udGFpbmVyKSwgcm5nLmVuZE9mZnNldCk7XG4gICAgfTtcbiAgICB2YXIgbWFrZVNpdHVzID0gU2l0dXMuY3JlYXRlO1xuXG4gICAgdmFyIHN5bmMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBpc1Jvb3QsIHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQsIHNlbGVjdFJhbmdlKSB7XG4gICAgICBpZiAoIShlcSQxKHN0YXJ0LCBmaW5pc2gpICYmIHNvZmZzZXQgPT09IGZvZmZzZXQpKSB7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDEoc3RhcnQsICd0ZCx0aCcsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAocykge1xuICAgICAgICAgIHJldHVybiBjbG9zZXN0JDEoZmluaXNoLCAndGQsdGgnLCBpc1Jvb3QpLmJpbmQoZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgIHJldHVybiBkZXRlY3QkNihjb250YWluZXIsIGlzUm9vdCwgcywgZiwgc2VsZWN0UmFuZ2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZGV0ZWN0JDYgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBpc1Jvb3QsIHN0YXJ0LCBmaW5pc2gsIHNlbGVjdFJhbmdlKSB7XG4gICAgICBpZiAoIWVxJDEoc3RhcnQsIGZpbmlzaCkpIHtcbiAgICAgICAgcmV0dXJuIGlkZW50aWZ5KHN0YXJ0LCBmaW5pc2gsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAoY2VsbFNlbCkge1xuICAgICAgICAgIHZhciBib3hlcyA9IGNlbGxTZWwuYm94ZXMuZ2V0T3IoW10pO1xuICAgICAgICAgIGlmIChib3hlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZWxlY3RSYW5nZShjb250YWluZXIsIGJveGVzLCBjZWxsU2VsLnN0YXJ0LCBjZWxsU2VsLmZpbmlzaCk7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShSZXNwb25zZS5jcmVhdGUoT3B0aW9uYWwuc29tZShtYWtlU2l0dXMoc3RhcnQsIDAsIHN0YXJ0LCBnZXRFbmQoc3RhcnQpKSksIHRydWUpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAocm93cywgY29sdW1ucywgY29udGFpbmVyLCBzZWxlY3RlZCwgYW5ub3RhdGlvbnMpIHtcbiAgICAgIHZhciB1cGRhdGVTZWxlY3Rpb24gPSBmdW5jdGlvbiAobmV3U2Vscykge1xuICAgICAgICBhbm5vdGF0aW9ucy5jbGVhckJlZm9yZVVwZGF0ZShjb250YWluZXIpO1xuICAgICAgICBhbm5vdGF0aW9ucy5zZWxlY3RSYW5nZShjb250YWluZXIsIG5ld1NlbHMuYm94ZXMsIG5ld1NlbHMuc3RhcnQsIG5ld1NlbHMuZmluaXNoKTtcbiAgICAgICAgcmV0dXJuIG5ld1NlbHMuYm94ZXM7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHNoaWZ0U2VsZWN0aW9uKHNlbGVjdGVkLCByb3dzLCBjb2x1bW5zLCBhbm5vdGF0aW9ucy5maXJzdFNlbGVjdGVkU2VsZWN0b3IsIGFubm90YXRpb25zLmxhc3RTZWxlY3RlZFNlbGVjdG9yKS5tYXAodXBkYXRlU2VsZWN0aW9uKTtcbiAgICB9O1xuXG4gICAgdmFyIHRyYXZlcnNlID0gZnVuY3Rpb24gKGl0ZW0sIG1vZGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgIG1vZGU6IG1vZGVcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgYmFja3RyYWNrID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBpdGVtLCBfZGlyZWN0aW9uLCB0cmFuc2l0aW9uKSB7XG4gICAgICBpZiAodHJhbnNpdGlvbiA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHRyYW5zaXRpb24gPSBzaWRlc3RlcDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bml2ZXJzZS5wcm9wZXJ0eSgpLnBhcmVudChpdGVtKS5tYXAoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgcmV0dXJuIHRyYXZlcnNlKHAsIHRyYW5zaXRpb24pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2lkZXN0ZXAgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0sIGRpcmVjdGlvbiwgdHJhbnNpdGlvbikge1xuICAgICAgaWYgKHRyYW5zaXRpb24gPT09IHZvaWQgMCkge1xuICAgICAgICB0cmFuc2l0aW9uID0gYWR2YW5jZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkaXJlY3Rpb24uc2libGluZyh1bml2ZXJzZSwgaXRlbSkubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiB0cmF2ZXJzZShwLCB0cmFuc2l0aW9uKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFkdmFuY2UgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0sIGRpcmVjdGlvbiwgdHJhbnNpdGlvbikge1xuICAgICAgaWYgKHRyYW5zaXRpb24gPT09IHZvaWQgMCkge1xuICAgICAgICB0cmFuc2l0aW9uID0gYWR2YW5jZTtcbiAgICAgIH1cbiAgICAgIHZhciBjaGlsZHJlbiA9IHVuaXZlcnNlLnByb3BlcnR5KCkuY2hpbGRyZW4oaXRlbSk7XG4gICAgICB2YXIgcmVzdWx0ID0gZGlyZWN0aW9uLmZpcnN0KGNoaWxkcmVuKTtcbiAgICAgIHJldHVybiByZXN1bHQubWFwKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgIHJldHVybiB0cmF2ZXJzZShyLCB0cmFuc2l0aW9uKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHN1Y2Nlc3NvcnMgPSBbXG4gICAgICB7XG4gICAgICAgIGN1cnJlbnQ6IGJhY2t0cmFjayxcbiAgICAgICAgbmV4dDogc2lkZXN0ZXAsXG4gICAgICAgIGZhbGxiYWNrOiBPcHRpb25hbC5ub25lKClcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGN1cnJlbnQ6IHNpZGVzdGVwLFxuICAgICAgICBuZXh0OiBhZHZhbmNlLFxuICAgICAgICBmYWxsYmFjazogT3B0aW9uYWwuc29tZShiYWNrdHJhY2spXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBjdXJyZW50OiBhZHZhbmNlLFxuICAgICAgICBuZXh0OiBhZHZhbmNlLFxuICAgICAgICBmYWxsYmFjazogT3B0aW9uYWwuc29tZShzaWRlc3RlcClcbiAgICAgIH1cbiAgICBdO1xuICAgIHZhciBnbyQxID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBpdGVtLCBtb2RlLCBkaXJlY3Rpb24sIHJ1bGVzKSB7XG4gICAgICBpZiAocnVsZXMgPT09IHZvaWQgMCkge1xuICAgICAgICBydWxlcyA9IHN1Y2Nlc3NvcnM7XG4gICAgICB9XG4gICAgICB2YXIgcnVsZU9wdCA9IGZpbmQocnVsZXMsIGZ1bmN0aW9uIChzdWNjKSB7XG4gICAgICAgIHJldHVybiBzdWNjLmN1cnJlbnQgPT09IG1vZGU7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBydWxlT3B0LmJpbmQoZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgICAgcmV0dXJuIHJ1bGUuY3VycmVudCh1bml2ZXJzZSwgaXRlbSwgZGlyZWN0aW9uLCBydWxlLm5leHQpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBydWxlLmZhbGxiYWNrLmJpbmQoZnVuY3Rpb24gKGZiKSB7XG4gICAgICAgICAgICByZXR1cm4gZ28kMSh1bml2ZXJzZSwgaXRlbSwgZmIsIGRpcmVjdGlvbik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBsZWZ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNpYmxpbmcgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIHVuaXZlcnNlLnF1ZXJ5KCkucHJldlNpYmxpbmcoaXRlbSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZpcnN0ID0gZnVuY3Rpb24gKGNoaWxkcmVuKSB7XG4gICAgICAgIHJldHVybiBjaGlsZHJlbi5sZW5ndGggPiAwID8gT3B0aW9uYWwuc29tZShjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2libGluZzogc2libGluZyxcbiAgICAgICAgZmlyc3Q6IGZpcnN0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIHJpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNpYmxpbmcgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIHVuaXZlcnNlLnF1ZXJ5KCkubmV4dFNpYmxpbmcoaXRlbSk7XG4gICAgICB9O1xuICAgICAgdmFyIGZpcnN0ID0gZnVuY3Rpb24gKGNoaWxkcmVuKSB7XG4gICAgICAgIHJldHVybiBjaGlsZHJlbi5sZW5ndGggPiAwID8gT3B0aW9uYWwuc29tZShjaGlsZHJlblswXSkgOiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2libGluZzogc2libGluZyxcbiAgICAgICAgZmlyc3Q6IGZpcnN0XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIFdhbGtlcnMgPSB7XG4gICAgICBsZWZ0OiBsZWZ0LFxuICAgICAgcmlnaHQ6IHJpZ2h0XG4gICAgfTtcblxuICAgIHZhciBob25lID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBpdGVtLCBwcmVkaWNhdGUsIG1vZGUsIGRpcmVjdGlvbiwgaXNSb290KSB7XG4gICAgICB2YXIgbmV4dCA9IGdvJDEodW5pdmVyc2UsIGl0ZW0sIG1vZGUsIGRpcmVjdGlvbik7XG4gICAgICByZXR1cm4gbmV4dC5iaW5kKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIGlmIChpc1Jvb3Qobi5pdGVtKSkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHByZWRpY2F0ZShuLml0ZW0pID8gT3B0aW9uYWwuc29tZShuLml0ZW0pIDogaG9uZSh1bml2ZXJzZSwgbi5pdGVtLCBwcmVkaWNhdGUsIG4ubW9kZSwgZGlyZWN0aW9uLCBpc1Jvb3QpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBsZWZ0JDEgPSBmdW5jdGlvbiAodW5pdmVyc2UsIGl0ZW0sIHByZWRpY2F0ZSwgaXNSb290KSB7XG4gICAgICByZXR1cm4gaG9uZSh1bml2ZXJzZSwgaXRlbSwgcHJlZGljYXRlLCBzaWRlc3RlcCwgV2Fsa2Vycy5sZWZ0KCksIGlzUm9vdCk7XG4gICAgfTtcbiAgICB2YXIgcmlnaHQkMSA9IGZ1bmN0aW9uICh1bml2ZXJzZSwgaXRlbSwgcHJlZGljYXRlLCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBob25lKHVuaXZlcnNlLCBpdGVtLCBwcmVkaWNhdGUsIHNpZGVzdGVwLCBXYWxrZXJzLnJpZ2h0KCksIGlzUm9vdCk7XG4gICAgfTtcblxuICAgIHZhciBpc0xlYWYgPSBmdW5jdGlvbiAodW5pdmVyc2UpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdW5pdmVyc2UucHJvcGVydHkoKS5jaGlsZHJlbihlbGVtZW50KS5sZW5ndGggPT09IDA7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGJlZm9yZSQzID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBpdGVtLCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBzZWVrTGVmdCh1bml2ZXJzZSwgaXRlbSwgaXNMZWFmKHVuaXZlcnNlKSwgaXNSb290KTtcbiAgICB9O1xuICAgIHZhciBhZnRlciQ0ID0gZnVuY3Rpb24gKHVuaXZlcnNlLCBpdGVtLCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBzZWVrUmlnaHQodW5pdmVyc2UsIGl0ZW0sIGlzTGVhZih1bml2ZXJzZSksIGlzUm9vdCk7XG4gICAgfTtcbiAgICB2YXIgc2Vla0xlZnQgPSBsZWZ0JDE7XG4gICAgdmFyIHNlZWtSaWdodCA9IHJpZ2h0JDE7XG5cbiAgICB2YXIgdW5pdmVyc2UkMyA9IERvbVVuaXZlcnNlKCk7XG4gICAgdmFyIGJlZm9yZSQ0ID0gZnVuY3Rpb24gKGVsZW1lbnQsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGJlZm9yZSQzKHVuaXZlcnNlJDMsIGVsZW1lbnQsIGlzUm9vdCk7XG4gICAgfTtcbiAgICB2YXIgYWZ0ZXIkNSA9IGZ1bmN0aW9uIChlbGVtZW50LCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBhZnRlciQ0KHVuaXZlcnNlJDMsIGVsZW1lbnQsIGlzUm9vdCk7XG4gICAgfTtcbiAgICB2YXIgc2Vla0xlZnQkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIHNlZWtMZWZ0KHVuaXZlcnNlJDMsIGVsZW1lbnQsIHByZWRpY2F0ZSwgaXNSb290KTtcbiAgICB9O1xuICAgIHZhciBzZWVrUmlnaHQkMSA9IGZ1bmN0aW9uIChlbGVtZW50LCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIHNlZWtSaWdodCh1bml2ZXJzZSQzLCBlbGVtZW50LCBwcmVkaWNhdGUsIGlzUm9vdCk7XG4gICAgfTtcblxuICAgIHZhciBhbmNlc3RvciQyID0gZnVuY3Rpb24gKHNjb3BlLCBwcmVkaWNhdGUsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGFuY2VzdG9yKHNjb3BlLCBwcmVkaWNhdGUsIGlzUm9vdCkuaXNTb21lKCk7XG4gICAgfTtcblxuICAgIHZhciBhZHQkNiA9IEFkdC5nZW5lcmF0ZShbXG4gICAgICB7IG5vbmU6IFsnbWVzc2FnZSddIH0sXG4gICAgICB7IHN1Y2Nlc3M6IFtdIH0sXG4gICAgICB7IGZhaWxlZFVwOiBbJ2NlbGwnXSB9LFxuICAgICAgeyBmYWlsZWREb3duOiBbJ2NlbGwnXSB9XG4gICAgXSk7XG4gICAgdmFyIGlzT3ZlcmxhcHBpbmcgPSBmdW5jdGlvbiAoYnJpZGdlLCBiZWZvcmUsIGFmdGVyKSB7XG4gICAgICB2YXIgYmVmb3JlQm91bmRzID0gYnJpZGdlLmdldFJlY3QoYmVmb3JlKTtcbiAgICAgIHZhciBhZnRlckJvdW5kcyA9IGJyaWRnZS5nZXRSZWN0KGFmdGVyKTtcbiAgICAgIHJldHVybiBhZnRlckJvdW5kcy5yaWdodCA+IGJlZm9yZUJvdW5kcy5sZWZ0ICYmIGFmdGVyQm91bmRzLmxlZnQgPCBiZWZvcmVCb3VuZHMucmlnaHQ7XG4gICAgfTtcbiAgICB2YXIgaXNSb3cgPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgcmV0dXJuIGNsb3Nlc3QkMShlbGVtLCAndHInKTtcbiAgICB9O1xuICAgIHZhciB2ZXJpZnkgPSBmdW5jdGlvbiAoYnJpZGdlLCBiZWZvcmUsIGJlZm9yZU9mZnNldCwgYWZ0ZXIsIGFmdGVyT2Zmc2V0LCBmYWlsdXJlLCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBjbG9zZXN0JDEoYWZ0ZXIsICd0ZCx0aCcsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAoYWZ0ZXJDZWxsKSB7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDEoYmVmb3JlLCAndGQsdGgnLCBpc1Jvb3QpLm1hcChmdW5jdGlvbiAoYmVmb3JlQ2VsbCkge1xuICAgICAgICAgIGlmICghZXEkMShhZnRlckNlbGwsIGJlZm9yZUNlbGwpKSB7XG4gICAgICAgICAgICByZXR1cm4gc2hhcmVkT25lJDEoaXNSb3csIFtcbiAgICAgICAgICAgICAgYWZ0ZXJDZWxsLFxuICAgICAgICAgICAgICBiZWZvcmVDZWxsXG4gICAgICAgICAgICBdKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGlzT3ZlcmxhcHBpbmcoYnJpZGdlLCBiZWZvcmVDZWxsLCBhZnRlckNlbGwpID8gYWR0JDYuc3VjY2VzcygpIDogZmFpbHVyZShiZWZvcmVDZWxsKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChfc2hhcmVkUm93KSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlKGJlZm9yZUNlbGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlcSQxKGFmdGVyLCBhZnRlckNlbGwpICYmIGdldEVuZChhZnRlckNlbGwpID09PSBhZnRlck9mZnNldCA/IGZhaWx1cmUoYmVmb3JlQ2VsbCkgOiBhZHQkNi5ub25lKCdpbiBzYW1lIGNlbGwnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSkuZ2V0T3IoYWR0JDYubm9uZSgnZGVmYXVsdCcpKTtcbiAgICB9O1xuICAgIHZhciBjYXRhJDIgPSBmdW5jdGlvbiAoc3ViamVjdCwgb25Ob25lLCBvblN1Y2Nlc3MsIG9uRmFpbGVkVXAsIG9uRmFpbGVkRG93bikge1xuICAgICAgcmV0dXJuIHN1YmplY3QuZm9sZChvbk5vbmUsIG9uU3VjY2Vzcywgb25GYWlsZWRVcCwgb25GYWlsZWREb3duKTtcbiAgICB9O1xuICAgIHZhciBCZWZvcmVBZnRlciA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBhZHQkNiksIHtcbiAgICAgIHZlcmlmeTogdmVyaWZ5LFxuICAgICAgY2F0YTogY2F0YSQyXG4gICAgfSk7XG5cbiAgICB2YXIgaW5QYXJlbnQgPSBmdW5jdGlvbiAocGFyZW50LCBjaGlsZHJlbiwgZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBhcmVudDogcGFyZW50LFxuICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sXG4gICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICAgIGluZGV4OiBpbmRleFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBpbmRleEluUGFyZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBwYXJlbnQoZWxlbWVudCkuYmluZChmdW5jdGlvbiAocGFyZW50KSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiQxID0gY2hpbGRyZW4ocGFyZW50KTtcbiAgICAgICAgcmV0dXJuIGluZGV4T2YoY2hpbGRyZW4kMSwgZWxlbWVudCkubWFwKGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICAgIHJldHVybiBpblBhcmVudChwYXJlbnQsIGNoaWxkcmVuJDEsIGVsZW1lbnQsIGluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBpbmRleE9mID0gZnVuY3Rpb24gKGVsZW1lbnRzLCBlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZmluZEluZGV4KGVsZW1lbnRzLCBjdXJyeShlcSQxLCBlbGVtZW50KSk7XG4gICAgfTtcblxuICAgIHZhciBpc0JyID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgIHJldHVybiBuYW1lKGVsZW0pID09PSAnYnInO1xuICAgIH07XG4gICAgdmFyIGdhdGhlcmVyID0gZnVuY3Rpb24gKGNhbmQsIGdhdGhlciwgaXNSb290KSB7XG4gICAgICByZXR1cm4gZ2F0aGVyKGNhbmQsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgIHJldHVybiBpc1RleHQodGFyZ2V0KSAmJiBnZXQkNCh0YXJnZXQpLnRyaW0oKS5sZW5ndGggPT09IDAgPyBnYXRoZXJlcih0YXJnZXQsIGdhdGhlciwgaXNSb290KSA6IE9wdGlvbmFsLnNvbWUodGFyZ2V0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZUJyID0gZnVuY3Rpb24gKGlzUm9vdCwgZWxlbWVudCwgZGlyZWN0aW9uKSB7XG4gICAgICByZXR1cm4gZGlyZWN0aW9uLnRyYXZlcnNlKGVsZW1lbnQpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2F0aGVyZXIoZWxlbWVudCwgZGlyZWN0aW9uLmdhdGhlciwgaXNSb290KTtcbiAgICAgIH0pLm1hcChkaXJlY3Rpb24ucmVsYXRpdmUpO1xuICAgIH07XG4gICAgdmFyIGZpbmRCciA9IGZ1bmN0aW9uIChlbGVtZW50LCBvZmZzZXQpIHtcbiAgICAgIHJldHVybiBjaGlsZChlbGVtZW50LCBvZmZzZXQpLmZpbHRlcihpc0JyKS5vclRodW5rKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNoaWxkKGVsZW1lbnQsIG9mZnNldCAtIDEpLmZpbHRlcihpc0JyKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZVBhcmVudCA9IGZ1bmN0aW9uIChpc1Jvb3QsIGVsZW1lbnQsIG9mZnNldCwgZGlyZWN0aW9uKSB7XG4gICAgICByZXR1cm4gZmluZEJyKGVsZW1lbnQsIG9mZnNldCkuYmluZChmdW5jdGlvbiAoYnIpIHtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGlvbi50cmF2ZXJzZShicikuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGdhdGhlcmVyKGJyLCBkaXJlY3Rpb24uZ2F0aGVyLCBpc1Jvb3QpLm1hcChkaXJlY3Rpb24ucmVsYXRpdmUpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoYWRqYWNlbnQpIHtcbiAgICAgICAgICByZXR1cm4gaW5kZXhJblBhcmVudChhZGphY2VudCkubWFwKGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgICAgICByZXR1cm4gU2l0dS5vbihpbmZvLnBhcmVudCwgaW5mby5pbmRleCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgdHJ5QnIgPSBmdW5jdGlvbiAoaXNSb290LCBlbGVtZW50LCBvZmZzZXQsIGRpcmVjdGlvbikge1xuICAgICAgdmFyIHRhcmdldCA9IGlzQnIoZWxlbWVudCkgPyBoYW5kbGVCcihpc1Jvb3QsIGVsZW1lbnQsIGRpcmVjdGlvbikgOiBoYW5kbGVQYXJlbnQoaXNSb290LCBlbGVtZW50LCBvZmZzZXQsIGRpcmVjdGlvbik7XG4gICAgICByZXR1cm4gdGFyZ2V0Lm1hcChmdW5jdGlvbiAodGd0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhcnQ6IHRndCxcbiAgICAgICAgICBmaW5pc2g6IHRndFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgcHJvY2VzcyA9IGZ1bmN0aW9uIChhbmFseXNpcykge1xuICAgICAgcmV0dXJuIEJlZm9yZUFmdGVyLmNhdGEoYW5hbHlzaXMsIGZ1bmN0aW9uIChfbWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfSwgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUocG9pbnQoY2VsbCwgMCkpO1xuICAgICAgfSwgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUocG9pbnQoY2VsbCwgZ2V0RW5kKGNlbGwpKSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG1vdmVEb3duID0gZnVuY3Rpb24gKGNhcmV0LCBhbW91bnQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IGNhcmV0LmxlZnQsXG4gICAgICAgIHRvcDogY2FyZXQudG9wICsgYW1vdW50LFxuICAgICAgICByaWdodDogY2FyZXQucmlnaHQsXG4gICAgICAgIGJvdHRvbTogY2FyZXQuYm90dG9tICsgYW1vdW50XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1vdmVVcCA9IGZ1bmN0aW9uIChjYXJldCwgYW1vdW50KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZWZ0OiBjYXJldC5sZWZ0LFxuICAgICAgICB0b3A6IGNhcmV0LnRvcCAtIGFtb3VudCxcbiAgICAgICAgcmlnaHQ6IGNhcmV0LnJpZ2h0LFxuICAgICAgICBib3R0b206IGNhcmV0LmJvdHRvbSAtIGFtb3VudFxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciB0cmFuc2xhdGUgPSBmdW5jdGlvbiAoY2FyZXQsIHhEZWx0YSwgeURlbHRhKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZWZ0OiBjYXJldC5sZWZ0ICsgeERlbHRhLFxuICAgICAgICB0b3A6IGNhcmV0LnRvcCArIHlEZWx0YSxcbiAgICAgICAgcmlnaHQ6IGNhcmV0LnJpZ2h0ICsgeERlbHRhLFxuICAgICAgICBib3R0b206IGNhcmV0LmJvdHRvbSArIHlEZWx0YVxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBnZXRUb3AkMSA9IGZ1bmN0aW9uIChjYXJldCkge1xuICAgICAgcmV0dXJuIGNhcmV0LnRvcDtcbiAgICB9O1xuICAgIHZhciBnZXRCb3R0b20gPSBmdW5jdGlvbiAoY2FyZXQpIHtcbiAgICAgIHJldHVybiBjYXJldC5ib3R0b207XG4gICAgfTtcblxuICAgIHZhciBnZXRQYXJ0aWFsQm94ID0gZnVuY3Rpb24gKGJyaWRnZSwgZWxlbWVudCwgb2Zmc2V0KSB7XG4gICAgICBpZiAob2Zmc2V0ID49IDAgJiYgb2Zmc2V0IDwgZ2V0RW5kKGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBicmlkZ2UuZ2V0UmFuZ2VkUmVjdChlbGVtZW50LCBvZmZzZXQsIGVsZW1lbnQsIG9mZnNldCArIDEpO1xuICAgICAgfSBlbHNlIGlmIChvZmZzZXQgPiAwKSB7XG4gICAgICAgIHJldHVybiBicmlkZ2UuZ2V0UmFuZ2VkUmVjdChlbGVtZW50LCBvZmZzZXQgLSAxLCBlbGVtZW50LCBvZmZzZXQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICB9O1xuICAgIHZhciB0b0NhcmV0ID0gZnVuY3Rpb24gKHJlY3QpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IHJlY3QubGVmdCxcbiAgICAgICAgdG9wOiByZWN0LnRvcCxcbiAgICAgICAgcmlnaHQ6IHJlY3QucmlnaHQsXG4gICAgICAgIGJvdHRvbTogcmVjdC5ib3R0b21cbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgZ2V0RWxlbUJveCA9IGZ1bmN0aW9uIChicmlkZ2UsIGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKGJyaWRnZS5nZXRSZWN0KGVsZW1lbnQpKTtcbiAgICB9O1xuICAgIHZhciBnZXRCb3hBdCA9IGZ1bmN0aW9uIChicmlkZ2UsIGVsZW1lbnQsIG9mZnNldCkge1xuICAgICAgaWYgKGlzRWxlbWVudChlbGVtZW50KSkge1xuICAgICAgICByZXR1cm4gZ2V0RWxlbUJveChicmlkZ2UsIGVsZW1lbnQpLm1hcCh0b0NhcmV0KTtcbiAgICAgIH0gZWxzZSBpZiAoaXNUZXh0KGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBnZXRQYXJ0aWFsQm94KGJyaWRnZSwgZWxlbWVudCwgb2Zmc2V0KS5tYXAodG9DYXJldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGdldEVudGlyZUJveCA9IGZ1bmN0aW9uIChicmlkZ2UsIGVsZW1lbnQpIHtcbiAgICAgIGlmIChpc0VsZW1lbnQoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIGdldEVsZW1Cb3goYnJpZGdlLCBlbGVtZW50KS5tYXAodG9DYXJldCk7XG4gICAgICB9IGVsc2UgaWYgKGlzVGV4dChlbGVtZW50KSkge1xuICAgICAgICByZXR1cm4gYnJpZGdlLmdldFJhbmdlZFJlY3QoZWxlbWVudCwgMCwgZWxlbWVudCwgZ2V0RW5kKGVsZW1lbnQpKS5tYXAodG9DYXJldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgSlVNUF9TSVpFID0gNTtcbiAgICB2YXIgTlVNX1JFVFJJRVMgPSAxMDA7XG4gICAgdmFyIGFkdCQ3ID0gQWR0LmdlbmVyYXRlKFtcbiAgICAgIHsgbm9uZTogW10gfSxcbiAgICAgIHsgcmV0cnk6IFsnY2FyZXQnXSB9XG4gICAgXSk7XG4gICAgdmFyIGlzT3V0c2lkZSA9IGZ1bmN0aW9uIChjYXJldCwgYm94KSB7XG4gICAgICByZXR1cm4gY2FyZXQubGVmdCA8IGJveC5sZWZ0IHx8IE1hdGguYWJzKGJveC5yaWdodCAtIGNhcmV0LmxlZnQpIDwgMSB8fCBjYXJldC5sZWZ0ID4gYm94LnJpZ2h0O1xuICAgIH07XG4gICAgdmFyIGluT3V0c2lkZUJsb2NrID0gZnVuY3Rpb24gKGJyaWRnZSwgZWxlbWVudCwgY2FyZXQpIHtcbiAgICAgIHJldHVybiBjbG9zZXN0KGVsZW1lbnQsIGlzQmxvY2skMSkuZm9sZChuZXZlciwgZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgcmV0dXJuIGdldEVudGlyZUJveChicmlkZ2UsIGNlbGwpLmV4aXN0cyhmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgICAgcmV0dXJuIGlzT3V0c2lkZShjYXJldCwgYm94KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciBhZGp1c3REb3duID0gZnVuY3Rpb24gKGJyaWRnZSwgZWxlbWVudCwgZ3Vlc3NCb3gsIG9yaWdpbmFsLCBjYXJldCkge1xuICAgICAgdmFyIGxvd2VyQ2FyZXQgPSBtb3ZlRG93bihjYXJldCwgSlVNUF9TSVpFKTtcbiAgICAgIGlmIChNYXRoLmFicyhndWVzc0JveC5ib3R0b20gLSBvcmlnaW5hbC5ib3R0b20pIDwgMSkge1xuICAgICAgICByZXR1cm4gYWR0JDcucmV0cnkobG93ZXJDYXJldCk7XG4gICAgICB9IGVsc2UgaWYgKGd1ZXNzQm94LnRvcCA+IGNhcmV0LmJvdHRvbSkge1xuICAgICAgICByZXR1cm4gYWR0JDcucmV0cnkobG93ZXJDYXJldCk7XG4gICAgICB9IGVsc2UgaWYgKGd1ZXNzQm94LnRvcCA9PT0gY2FyZXQuYm90dG9tKSB7XG4gICAgICAgIHJldHVybiBhZHQkNy5yZXRyeShtb3ZlRG93bihjYXJldCwgMSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGluT3V0c2lkZUJsb2NrKGJyaWRnZSwgZWxlbWVudCwgY2FyZXQpID8gYWR0JDcucmV0cnkodHJhbnNsYXRlKGxvd2VyQ2FyZXQsIEpVTVBfU0laRSwgMCkpIDogYWR0JDcubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIGFkanVzdFVwID0gZnVuY3Rpb24gKGJyaWRnZSwgZWxlbWVudCwgZ3Vlc3NCb3gsIG9yaWdpbmFsLCBjYXJldCkge1xuICAgICAgdmFyIGhpZ2hlckNhcmV0ID0gbW92ZVVwKGNhcmV0LCBKVU1QX1NJWkUpO1xuICAgICAgaWYgKE1hdGguYWJzKGd1ZXNzQm94LnRvcCAtIG9yaWdpbmFsLnRvcCkgPCAxKSB7XG4gICAgICAgIHJldHVybiBhZHQkNy5yZXRyeShoaWdoZXJDYXJldCk7XG4gICAgICB9IGVsc2UgaWYgKGd1ZXNzQm94LmJvdHRvbSA8IGNhcmV0LnRvcCkge1xuICAgICAgICByZXR1cm4gYWR0JDcucmV0cnkoaGlnaGVyQ2FyZXQpO1xuICAgICAgfSBlbHNlIGlmIChndWVzc0JveC5ib3R0b20gPT09IGNhcmV0LnRvcCkge1xuICAgICAgICByZXR1cm4gYWR0JDcucmV0cnkobW92ZVVwKGNhcmV0LCAxKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gaW5PdXRzaWRlQmxvY2soYnJpZGdlLCBlbGVtZW50LCBjYXJldCkgPyBhZHQkNy5yZXRyeSh0cmFuc2xhdGUoaGlnaGVyQ2FyZXQsIEpVTVBfU0laRSwgMCkpIDogYWR0JDcubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHVwTW92ZW1lbnQgPSB7XG4gICAgICBwb2ludDogZ2V0VG9wJDEsXG4gICAgICBhZGp1c3RlcjogYWRqdXN0VXAsXG4gICAgICBtb3ZlOiBtb3ZlVXAsXG4gICAgICBnYXRoZXI6IGJlZm9yZSQ0XG4gICAgfTtcbiAgICB2YXIgZG93bk1vdmVtZW50ID0ge1xuICAgICAgcG9pbnQ6IGdldEJvdHRvbSxcbiAgICAgIGFkanVzdGVyOiBhZGp1c3REb3duLFxuICAgICAgbW92ZTogbW92ZURvd24sXG4gICAgICBnYXRoZXI6IGFmdGVyJDVcbiAgICB9O1xuICAgIHZhciBpc0F0VGFibGUgPSBmdW5jdGlvbiAoYnJpZGdlLCB4LCB5KSB7XG4gICAgICByZXR1cm4gYnJpZGdlLmVsZW1lbnRGcm9tUG9pbnQoeCwgeSkuZmlsdGVyKGZ1bmN0aW9uIChlbG0pIHtcbiAgICAgICAgcmV0dXJuIG5hbWUoZWxtKSA9PT0gJ3RhYmxlJztcbiAgICAgIH0pLmlzU29tZSgpO1xuICAgIH07XG4gICAgdmFyIGFkanVzdEZvclRhYmxlID0gZnVuY3Rpb24gKGJyaWRnZSwgbW92ZW1lbnQsIG9yaWdpbmFsLCBjYXJldCwgbnVtUmV0cmllcykge1xuICAgICAgcmV0dXJuIGFkanVzdFRpbChicmlkZ2UsIG1vdmVtZW50LCBvcmlnaW5hbCwgbW92ZW1lbnQubW92ZShjYXJldCwgSlVNUF9TSVpFKSwgbnVtUmV0cmllcyk7XG4gICAgfTtcbiAgICB2YXIgYWRqdXN0VGlsID0gZnVuY3Rpb24gKGJyaWRnZSwgbW92ZW1lbnQsIG9yaWdpbmFsLCBjYXJldCwgbnVtUmV0cmllcykge1xuICAgICAgaWYgKG51bVJldHJpZXMgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoY2FyZXQpO1xuICAgICAgfVxuICAgICAgaWYgKGlzQXRUYWJsZShicmlkZ2UsIGNhcmV0LmxlZnQsIG1vdmVtZW50LnBvaW50KGNhcmV0KSkpIHtcbiAgICAgICAgcmV0dXJuIGFkanVzdEZvclRhYmxlKGJyaWRnZSwgbW92ZW1lbnQsIG9yaWdpbmFsLCBjYXJldCwgbnVtUmV0cmllcyAtIDEpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJyaWRnZS5zaXR1c0Zyb21Qb2ludChjYXJldC5sZWZ0LCBtb3ZlbWVudC5wb2ludChjYXJldCkpLmJpbmQoZnVuY3Rpb24gKGd1ZXNzKSB7XG4gICAgICAgIHJldHVybiBndWVzcy5zdGFydC5mb2xkKE9wdGlvbmFsLm5vbmUsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGdldEVudGlyZUJveChicmlkZ2UsIGVsZW1lbnQpLmJpbmQoZnVuY3Rpb24gKGd1ZXNzQm94KSB7XG4gICAgICAgICAgICByZXR1cm4gbW92ZW1lbnQuYWRqdXN0ZXIoYnJpZGdlLCBlbGVtZW50LCBndWVzc0JveCwgb3JpZ2luYWwsIGNhcmV0KS5mb2xkKE9wdGlvbmFsLm5vbmUsIGZ1bmN0aW9uIChuZXdDYXJldCkge1xuICAgICAgICAgICAgICByZXR1cm4gYWRqdXN0VGlsKGJyaWRnZSwgbW92ZW1lbnQsIG9yaWdpbmFsLCBuZXdDYXJldCwgbnVtUmV0cmllcyAtIDEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSkub3JUaHVuayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShjYXJldCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIE9wdGlvbmFsLm5vbmUpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgaWVUcnlEb3duID0gZnVuY3Rpb24gKGJyaWRnZSwgY2FyZXQpIHtcbiAgICAgIHJldHVybiBicmlkZ2Uuc2l0dXNGcm9tUG9pbnQoY2FyZXQubGVmdCwgY2FyZXQuYm90dG9tICsgSlVNUF9TSVpFKTtcbiAgICB9O1xuICAgIHZhciBpZVRyeVVwID0gZnVuY3Rpb24gKGJyaWRnZSwgY2FyZXQpIHtcbiAgICAgIHJldHVybiBicmlkZ2Uuc2l0dXNGcm9tUG9pbnQoY2FyZXQubGVmdCwgY2FyZXQudG9wIC0gSlVNUF9TSVpFKTtcbiAgICB9O1xuICAgIHZhciBjaGVja1Njcm9sbCA9IGZ1bmN0aW9uIChtb3ZlbWVudCwgYWRqdXN0ZWQsIGJyaWRnZSkge1xuICAgICAgaWYgKG1vdmVtZW50LnBvaW50KGFkanVzdGVkKSA+IGJyaWRnZS5nZXRJbm5lckhlaWdodCgpKSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5zb21lKG1vdmVtZW50LnBvaW50KGFkanVzdGVkKSAtIGJyaWRnZS5nZXRJbm5lckhlaWdodCgpKTtcbiAgICAgIH0gZWxzZSBpZiAobW92ZW1lbnQucG9pbnQoYWRqdXN0ZWQpIDwgMCkge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZSgtbW92ZW1lbnQucG9pbnQoYWRqdXN0ZWQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgcmV0cnkgPSBmdW5jdGlvbiAobW92ZW1lbnQsIGJyaWRnZSwgY2FyZXQpIHtcbiAgICAgIHZhciBtb3ZlZCA9IG1vdmVtZW50Lm1vdmUoY2FyZXQsIEpVTVBfU0laRSk7XG4gICAgICB2YXIgYWRqdXN0ZWQgPSBhZGp1c3RUaWwoYnJpZGdlLCBtb3ZlbWVudCwgY2FyZXQsIG1vdmVkLCBOVU1fUkVUUklFUykuZ2V0T3IobW92ZWQpO1xuICAgICAgcmV0dXJuIGNoZWNrU2Nyb2xsKG1vdmVtZW50LCBhZGp1c3RlZCwgYnJpZGdlKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGJyaWRnZS5zaXR1c0Zyb21Qb2ludChhZGp1c3RlZC5sZWZ0LCBtb3ZlbWVudC5wb2ludChhZGp1c3RlZCkpO1xuICAgICAgfSwgZnVuY3Rpb24gKGRlbHRhKSB7XG4gICAgICAgIGJyaWRnZS5zY3JvbGxCeSgwLCBkZWx0YSk7XG4gICAgICAgIHJldHVybiBicmlkZ2Uuc2l0dXNGcm9tUG9pbnQoYWRqdXN0ZWQubGVmdCwgbW92ZW1lbnQucG9pbnQoYWRqdXN0ZWQpIC0gZGVsdGEpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgUmV0cmllcyA9IHtcbiAgICAgIHRyeVVwOiBjdXJyeShyZXRyeSwgdXBNb3ZlbWVudCksXG4gICAgICB0cnlEb3duOiBjdXJyeShyZXRyeSwgZG93bk1vdmVtZW50KSxcbiAgICAgIGllVHJ5VXA6IGllVHJ5VXAsXG4gICAgICBpZVRyeURvd246IGllVHJ5RG93bixcbiAgICAgIGdldEp1bXBTaXplOiBjb25zdGFudChKVU1QX1NJWkUpXG4gICAgfTtcblxuICAgIHZhciBNQVhfUkVUUklFUyA9IDIwO1xuICAgIHZhciBmaW5kU3BvdCA9IGZ1bmN0aW9uIChicmlkZ2UsIGlzUm9vdCwgZGlyZWN0aW9uKSB7XG4gICAgICByZXR1cm4gYnJpZGdlLmdldFNlbGVjdGlvbigpLmJpbmQoZnVuY3Rpb24gKHNlbCkge1xuICAgICAgICByZXR1cm4gdHJ5QnIoaXNSb290LCBzZWwuZmluaXNoLCBzZWwuZm9mZnNldCwgZGlyZWN0aW9uKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShwb2ludChzZWwuZmluaXNoLCBzZWwuZm9mZnNldCkpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoYnJOZWlnaGJvdXIpIHtcbiAgICAgICAgICB2YXIgcmFuZ2UgPSBicmlkZ2UuZnJvbVNpdHVzKGJyTmVpZ2hib3VyKTtcbiAgICAgICAgICB2YXIgYW5hbHlzaXMgPSBCZWZvcmVBZnRlci52ZXJpZnkoYnJpZGdlLCBzZWwuZmluaXNoLCBzZWwuZm9mZnNldCwgcmFuZ2UuZmluaXNoLCByYW5nZS5mb2Zmc2V0LCBkaXJlY3Rpb24uZmFpbHVyZSwgaXNSb290KTtcbiAgICAgICAgICByZXR1cm4gcHJvY2VzcyhhbmFseXNpcyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgc2NhbiQxID0gZnVuY3Rpb24gKGJyaWRnZSwgaXNSb290LCBlbGVtZW50LCBvZmZzZXQsIGRpcmVjdGlvbiwgbnVtUmV0cmllcykge1xuICAgICAgaWYgKG51bVJldHJpZXMgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnlDdXJzb3IoYnJpZGdlLCBpc1Jvb3QsIGVsZW1lbnQsIG9mZnNldCwgZGlyZWN0aW9uKS5iaW5kKGZ1bmN0aW9uIChzaXR1cykge1xuICAgICAgICB2YXIgcmFuZ2UgPSBicmlkZ2UuZnJvbVNpdHVzKHNpdHVzKTtcbiAgICAgICAgdmFyIGFuYWx5c2lzID0gQmVmb3JlQWZ0ZXIudmVyaWZ5KGJyaWRnZSwgZWxlbWVudCwgb2Zmc2V0LCByYW5nZS5maW5pc2gsIHJhbmdlLmZvZmZzZXQsIGRpcmVjdGlvbi5mYWlsdXJlLCBpc1Jvb3QpO1xuICAgICAgICByZXR1cm4gQmVmb3JlQWZ0ZXIuY2F0YShhbmFseXNpcywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuc29tZShzaXR1cyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChjZWxsKSB7XG4gICAgICAgICAgaWYgKGVxJDEoZWxlbWVudCwgY2VsbCkgJiYgb2Zmc2V0ID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ5QWdhaW4oYnJpZGdlLCBlbGVtZW50LCBvZmZzZXQsIG1vdmVVcCwgZGlyZWN0aW9uKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNjYW4kMShicmlkZ2UsIGlzUm9vdCwgY2VsbCwgMCwgZGlyZWN0aW9uLCBudW1SZXRyaWVzIC0gMSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIGlmIChlcSQxKGVsZW1lbnQsIGNlbGwpICYmIG9mZnNldCA9PT0gZ2V0RW5kKGNlbGwpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ5QWdhaW4oYnJpZGdlLCBlbGVtZW50LCBvZmZzZXQsIG1vdmVEb3duLCBkaXJlY3Rpb24pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbiQxKGJyaWRnZSwgaXNSb290LCBjZWxsLCBnZXRFbmQoY2VsbCksIGRpcmVjdGlvbiwgbnVtUmV0cmllcyAtIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHZhciB0cnlBZ2FpbiA9IGZ1bmN0aW9uIChicmlkZ2UsIGVsZW1lbnQsIG9mZnNldCwgbW92ZSwgZGlyZWN0aW9uKSB7XG4gICAgICByZXR1cm4gZ2V0Qm94QXQoYnJpZGdlLCBlbGVtZW50LCBvZmZzZXQpLmJpbmQoZnVuY3Rpb24gKGJveCkge1xuICAgICAgICByZXR1cm4gdHJ5QXQoYnJpZGdlLCBkaXJlY3Rpb24sIG1vdmUoYm94LCBSZXRyaWVzLmdldEp1bXBTaXplKCkpKTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHRyeUF0ID0gZnVuY3Rpb24gKGJyaWRnZSwgZGlyZWN0aW9uLCBib3gpIHtcbiAgICAgIHZhciBicm93c2VyID0gZGV0ZWN0JDMoKS5icm93c2VyO1xuICAgICAgaWYgKGJyb3dzZXIuaXNDaHJvbWUoKSB8fCBicm93c2VyLmlzU2FmYXJpKCkgfHwgYnJvd3Nlci5pc0ZpcmVmb3goKSB8fCBicm93c2VyLmlzRWRnZSgpKSB7XG4gICAgICAgIHJldHVybiBkaXJlY3Rpb24ub3RoZXJSZXRyeShicmlkZ2UsIGJveCk7XG4gICAgICB9IGVsc2UgaWYgKGJyb3dzZXIuaXNJRSgpKSB7XG4gICAgICAgIHJldHVybiBkaXJlY3Rpb24uaWVSZXRyeShicmlkZ2UsIGJveCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgdmFyIHRyeUN1cnNvciA9IGZ1bmN0aW9uIChicmlkZ2UsIGlzUm9vdCwgZWxlbWVudCwgb2Zmc2V0LCBkaXJlY3Rpb24pIHtcbiAgICAgIHJldHVybiBnZXRCb3hBdChicmlkZ2UsIGVsZW1lbnQsIG9mZnNldCkuYmluZChmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgIHJldHVybiB0cnlBdChicmlkZ2UsIGRpcmVjdGlvbiwgYm94KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGhhbmRsZSQyID0gZnVuY3Rpb24gKGJyaWRnZSwgaXNSb290LCBkaXJlY3Rpb24pIHtcbiAgICAgIHJldHVybiBmaW5kU3BvdChicmlkZ2UsIGlzUm9vdCwgZGlyZWN0aW9uKS5iaW5kKGZ1bmN0aW9uIChzcG90KSB7XG4gICAgICAgIHJldHVybiBzY2FuJDEoYnJpZGdlLCBpc1Jvb3QsIHNwb3QuZWxlbWVudCwgc3BvdC5vZmZzZXQsIGRpcmVjdGlvbiwgTUFYX1JFVFJJRVMpLm1hcChicmlkZ2UuZnJvbVNpdHVzKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgaW5TYW1lVGFibGUgPSBmdW5jdGlvbiAoZWxlbSwgdGFibGUpIHtcbiAgICAgIHJldHVybiBhbmNlc3RvciQyKGVsZW0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBwYXJlbnQoZSkuZXhpc3RzKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgcmV0dXJuIGVxJDEocCwgdGFibGUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHNpbXVsYXRlID0gZnVuY3Rpb24gKGJyaWRnZSwgaXNSb290LCBkaXJlY3Rpb24sIGluaXRpYWwsIGFuY2hvcikge1xuICAgICAgcmV0dXJuIGNsb3Nlc3QkMShpbml0aWFsLCAndGQsdGgnLCBpc1Jvb3QpLmJpbmQoZnVuY3Rpb24gKHN0YXJ0KSB7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDEoc3RhcnQsICd0YWJsZScsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICBpZiAoIWluU2FtZVRhYmxlKGFuY2hvciwgdGFibGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaGFuZGxlJDIoYnJpZGdlLCBpc1Jvb3QsIGRpcmVjdGlvbikuYmluZChmdW5jdGlvbiAocmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBjbG9zZXN0JDEocmFuZ2UuZmluaXNoLCAndGQsdGgnLCBpc1Jvb3QpLm1hcChmdW5jdGlvbiAoZmluaXNoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgICAgIGZpbmlzaDogZmluaXNoLFxuICAgICAgICAgICAgICAgIHJhbmdlOiByYW5nZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgbmF2aWdhdGUgPSBmdW5jdGlvbiAoYnJpZGdlLCBpc1Jvb3QsIGRpcmVjdGlvbiwgaW5pdGlhbCwgYW5jaG9yLCBwcmVjaGVjaykge1xuICAgICAgaWYgKGRldGVjdCQzKCkuYnJvd3Nlci5pc0lFKCkpIHtcbiAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwcmVjaGVjayhpbml0aWFsLCBpc1Jvb3QpLm9yVGh1bmsoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzaW11bGF0ZShicmlkZ2UsIGlzUm9vdCwgZGlyZWN0aW9uLCBpbml0aWFsLCBhbmNob3IpLm1hcChmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgICAgdmFyIHJhbmdlID0gaW5mby5yYW5nZTtcbiAgICAgICAgICAgIHJldHVybiBSZXNwb25zZS5jcmVhdGUoT3B0aW9uYWwuc29tZShtYWtlU2l0dXMocmFuZ2Uuc3RhcnQsIHJhbmdlLnNvZmZzZXQsIHJhbmdlLmZpbmlzaCwgcmFuZ2UuZm9mZnNldCkpLCB0cnVlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICB2YXIgZmlyc3RVcENoZWNrID0gZnVuY3Rpb24gKGluaXRpYWwsIGlzUm9vdCkge1xuICAgICAgcmV0dXJuIGNsb3Nlc3QkMShpbml0aWFsLCAndHInLCBpc1Jvb3QpLmJpbmQoZnVuY3Rpb24gKHN0YXJ0Um93KSB7XG4gICAgICAgIHJldHVybiBjbG9zZXN0JDEoc3RhcnRSb3csICd0YWJsZScsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICB2YXIgcm93cyA9IGRlc2NlbmRhbnRzJDEodGFibGUsICd0cicpO1xuICAgICAgICAgIGlmIChlcSQxKHN0YXJ0Um93LCByb3dzWzBdKSkge1xuICAgICAgICAgICAgcmV0dXJuIHNlZWtMZWZ0JDEodGFibGUsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiBsYXN0JDEoZWxlbWVudCkuaXNTb21lKCk7XG4gICAgICAgICAgICB9LCBpc1Jvb3QpLm1hcChmdW5jdGlvbiAobGFzdCkge1xuICAgICAgICAgICAgICB2YXIgbGFzdE9mZnNldCA9IGdldEVuZChsYXN0KTtcbiAgICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlLmNyZWF0ZShPcHRpb25hbC5zb21lKG1ha2VTaXR1cyhsYXN0LCBsYXN0T2Zmc2V0LCBsYXN0LCBsYXN0T2Zmc2V0KSksIHRydWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGxhc3REb3duQ2hlY2sgPSBmdW5jdGlvbiAoaW5pdGlhbCwgaXNSb290KSB7XG4gICAgICByZXR1cm4gY2xvc2VzdCQxKGluaXRpYWwsICd0cicsIGlzUm9vdCkuYmluZChmdW5jdGlvbiAoc3RhcnRSb3cpIHtcbiAgICAgICAgcmV0dXJuIGNsb3Nlc3QkMShzdGFydFJvdywgJ3RhYmxlJywgaXNSb290KS5iaW5kKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICAgIHZhciByb3dzID0gZGVzY2VuZGFudHMkMSh0YWJsZSwgJ3RyJyk7XG4gICAgICAgICAgaWYgKGVxJDEoc3RhcnRSb3csIHJvd3Nbcm93cy5sZW5ndGggLSAxXSkpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWVrUmlnaHQkMSh0YWJsZSwgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0KGVsZW1lbnQpLmlzU29tZSgpO1xuICAgICAgICAgICAgfSwgaXNSb290KS5tYXAoZnVuY3Rpb24gKGZpcnN0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBSZXNwb25zZS5jcmVhdGUoT3B0aW9uYWwuc29tZShtYWtlU2l0dXMoZmlyc3QsIDAsIGZpcnN0LCAwKSksIHRydWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIHNlbGVjdCA9IGZ1bmN0aW9uIChicmlkZ2UsIGNvbnRhaW5lciwgaXNSb290LCBkaXJlY3Rpb24sIGluaXRpYWwsIGFuY2hvciwgc2VsZWN0UmFuZ2UpIHtcbiAgICAgIHJldHVybiBzaW11bGF0ZShicmlkZ2UsIGlzUm9vdCwgZGlyZWN0aW9uLCBpbml0aWFsLCBhbmNob3IpLmJpbmQoZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgcmV0dXJuIGRldGVjdCQ2KGNvbnRhaW5lciwgaXNSb290LCBpbmZvLnN0YXJ0LCBpbmZvLmZpbmlzaCwgc2VsZWN0UmFuZ2UpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciB2YWx1ZSQxID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN1YmplY3QgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdWJqZWN0LnNldChPcHRpb25hbC5ub25lKCkpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5zZXQoT3B0aW9uYWwuc29tZShzKSk7XG4gICAgICB9O1xuICAgICAgdmFyIGlzU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5pc1NvbWUoKTtcbiAgICAgIH07XG4gICAgICB2YXIgb24gPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gc3ViamVjdC5nZXQoKS5lYWNoKGYpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyOiBjbGVhcixcbiAgICAgICAgc2V0OiBzZXQsXG4gICAgICAgIGlzU2V0OiBpc1NldCxcbiAgICAgICAgb246IG9uXG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZmluZENlbGwgPSBmdW5jdGlvbiAodGFyZ2V0LCBpc1Jvb3QpIHtcbiAgICAgIHJldHVybiBjbG9zZXN0JDEodGFyZ2V0LCAndGQsdGgnLCBpc1Jvb3QpO1xuICAgIH07XG4gICAgdmFyIE1vdXNlU2VsZWN0aW9uID0gZnVuY3Rpb24gKGJyaWRnZSwgY29udGFpbmVyLCBpc1Jvb3QsIGFubm90YXRpb25zKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdmFsdWUkMSgpO1xuICAgICAgdmFyIGNsZWFyc3RhdGUgPSBjdXJzb3IuY2xlYXI7XG4gICAgICB2YXIgYXBwbHlTZWxlY3Rpb24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgY3Vyc29yLm9uKGZ1bmN0aW9uIChzdGFydCkge1xuICAgICAgICAgIGFubm90YXRpb25zLmNsZWFyQmVmb3JlVXBkYXRlKGNvbnRhaW5lcik7XG4gICAgICAgICAgZmluZENlbGwoZXZlbnQudGFyZ2V0LCBpc1Jvb3QpLmVhY2goZnVuY3Rpb24gKGZpbmlzaCkge1xuICAgICAgICAgICAgaWRlbnRpZnkoc3RhcnQsIGZpbmlzaCwgaXNSb290KS5lYWNoKGZ1bmN0aW9uIChjZWxsU2VsKSB7XG4gICAgICAgICAgICAgIHZhciBib3hlcyA9IGNlbGxTZWwuYm94ZXMuZ2V0T3IoW10pO1xuICAgICAgICAgICAgICBpZiAoYm94ZXMubGVuZ3RoID4gMSB8fCBib3hlcy5sZW5ndGggPT09IDEgJiYgIWVxJDEoc3RhcnQsIGZpbmlzaCkpIHtcbiAgICAgICAgICAgICAgICBhbm5vdGF0aW9ucy5zZWxlY3RSYW5nZShjb250YWluZXIsIGJveGVzLCBjZWxsU2VsLnN0YXJ0LCBjZWxsU2VsLmZpbmlzaCk7XG4gICAgICAgICAgICAgICAgYnJpZGdlLnNlbGVjdENvbnRlbnRzKGZpbmlzaCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgbW91c2Vkb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGFubm90YXRpb25zLmNsZWFyKGNvbnRhaW5lcik7XG4gICAgICAgIGZpbmRDZWxsKGV2ZW50LnRhcmdldCwgaXNSb290KS5lYWNoKGN1cnNvci5zZXQpO1xuICAgICAgfTtcbiAgICAgIHZhciBtb3VzZW92ZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgYXBwbHlTZWxlY3Rpb24oZXZlbnQpO1xuICAgICAgfTtcbiAgICAgIHZhciBtb3VzZXVwID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGFwcGx5U2VsZWN0aW9uKGV2ZW50KTtcbiAgICAgICAgY2xlYXJzdGF0ZSgpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsZWFyc3RhdGU6IGNsZWFyc3RhdGUsXG4gICAgICAgIG1vdXNlZG93bjogbW91c2Vkb3duLFxuICAgICAgICBtb3VzZW92ZXI6IG1vdXNlb3ZlcixcbiAgICAgICAgbW91c2V1cDogbW91c2V1cFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGRvd24gPSB7XG4gICAgICB0cmF2ZXJzZTogbmV4dFNpYmxpbmcsXG4gICAgICBnYXRoZXI6IGFmdGVyJDUsXG4gICAgICByZWxhdGl2ZTogU2l0dS5iZWZvcmUsXG4gICAgICBvdGhlclJldHJ5OiBSZXRyaWVzLnRyeURvd24sXG4gICAgICBpZVJldHJ5OiBSZXRyaWVzLmllVHJ5RG93bixcbiAgICAgIGZhaWx1cmU6IEJlZm9yZUFmdGVyLmZhaWxlZERvd25cbiAgICB9O1xuICAgIHZhciB1cCA9IHtcbiAgICAgIHRyYXZlcnNlOiBwcmV2U2libGluZyxcbiAgICAgIGdhdGhlcjogYmVmb3JlJDQsXG4gICAgICByZWxhdGl2ZTogU2l0dS5iZWZvcmUsXG4gICAgICBvdGhlclJldHJ5OiBSZXRyaWVzLnRyeVVwLFxuICAgICAgaWVSZXRyeTogUmV0cmllcy5pZVRyeVVwLFxuICAgICAgZmFpbHVyZTogQmVmb3JlQWZ0ZXIuZmFpbGVkVXBcbiAgICB9O1xuXG4gICAgdmFyIGlzS2V5ID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChrZXljb2RlKSB7XG4gICAgICAgIHJldHVybiBrZXljb2RlID09PSBrZXk7XG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGlzVXAgPSBpc0tleSgzOCk7XG4gICAgdmFyIGlzRG93biA9IGlzS2V5KDQwKTtcbiAgICB2YXIgaXNOYXZpZ2F0aW9uID0gZnVuY3Rpb24gKGtleWNvZGUpIHtcbiAgICAgIHJldHVybiBrZXljb2RlID49IDM3ICYmIGtleWNvZGUgPD0gNDA7XG4gICAgfTtcbiAgICB2YXIgbHRyJDIgPSB7XG4gICAgICBpc0JhY2t3YXJkOiBpc0tleSgzNyksXG4gICAgICBpc0ZvcndhcmQ6IGlzS2V5KDM5KVxuICAgIH07XG4gICAgdmFyIHJ0bCQyID0ge1xuICAgICAgaXNCYWNrd2FyZDogaXNLZXkoMzkpLFxuICAgICAgaXNGb3J3YXJkOiBpc0tleSgzNylcbiAgICB9O1xuXG4gICAgdmFyIGdldCRkID0gZnVuY3Rpb24gKF9ET0MpIHtcbiAgICAgIHZhciBkb2MgPSBfRE9DICE9PSB1bmRlZmluZWQgPyBfRE9DLmRvbSA6IGRvY3VtZW50O1xuICAgICAgdmFyIHggPSBkb2MuYm9keS5zY3JvbGxMZWZ0IHx8IGRvYy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdDtcbiAgICAgIHZhciB5ID0gZG9jLmJvZHkuc2Nyb2xsVG9wIHx8IGRvYy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgcmV0dXJuIFN1Z2FyUG9zaXRpb24oeCwgeSk7XG4gICAgfTtcbiAgICB2YXIgYnkgPSBmdW5jdGlvbiAoeCwgeSwgX0RPQykge1xuICAgICAgdmFyIGRvYyA9IF9ET0MgIT09IHVuZGVmaW5lZCA/IF9ET0MuZG9tIDogZG9jdW1lbnQ7XG4gICAgICB2YXIgd2luID0gZG9jLmRlZmF1bHRWaWV3O1xuICAgICAgaWYgKHdpbikge1xuICAgICAgICB3aW4uc2Nyb2xsQnkoeCwgeSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBXaW5kb3dCcmlkZ2UgPSBmdW5jdGlvbiAod2luKSB7XG4gICAgICB2YXIgZWxlbWVudEZyb21Qb2ludCA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiBTdWdhckVsZW1lbnQuZnJvbVBvaW50KFN1Z2FyRWxlbWVudC5mcm9tRG9tKHdpbi5kb2N1bWVudCksIHgsIHkpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRSZWN0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuZG9tLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRSYW5nZWRSZWN0ID0gZnVuY3Rpb24gKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgICAgdmFyIHNlbCA9IFNpbVNlbGVjdGlvbi5leGFjdChzdGFydCwgc29mZnNldCwgZmluaXNoLCBmb2Zmc2V0KTtcbiAgICAgICAgcmV0dXJuIGdldEZpcnN0UmVjdCQxKHdpbiwgc2VsKTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0JGMod2luKS5tYXAoZnVuY3Rpb24gKGV4YWN0QWR0KSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnZlcnRUb1JhbmdlKHdpbiwgZXhhY3RBZHQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZnJvbVNpdHVzID0gZnVuY3Rpb24gKHNpdHVzKSB7XG4gICAgICAgIHZhciByZWxhdGl2ZSA9IFNpbVNlbGVjdGlvbi5yZWxhdGl2ZShzaXR1cy5zdGFydCwgc2l0dXMuZmluaXNoKTtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRUb1JhbmdlKHdpbiwgcmVsYXRpdmUpO1xuICAgICAgfTtcbiAgICAgIHZhciBzaXR1c0Zyb21Qb2ludCA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIHJldHVybiBnZXRBdFBvaW50KHdpbiwgeCwgeSkubWFwKGZ1bmN0aW9uIChleGFjdCkge1xuICAgICAgICAgIHJldHVybiBTaXR1cy5jcmVhdGUoZXhhY3Quc3RhcnQsIGV4YWN0LnNvZmZzZXQsIGV4YWN0LmZpbmlzaCwgZXhhY3QuZm9mZnNldCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBjbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2xlYXIod2luKTtcbiAgICAgIH07XG4gICAgICB2YXIgY29sbGFwc2VTZWxlY3Rpb24gPSBmdW5jdGlvbiAodG9TdGFydCkge1xuICAgICAgICBpZiAodG9TdGFydCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgdG9TdGFydCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGdldCRjKHdpbikuZWFjaChmdW5jdGlvbiAoc2VsKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbC5mb2xkKGZ1bmN0aW9uIChybmcpIHtcbiAgICAgICAgICAgIHJldHVybiBybmcuY29sbGFwc2UodG9TdGFydCk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKHN0YXJ0U2l0dSwgZmluaXNoU2l0dSkge1xuICAgICAgICAgICAgdmFyIHNpdHUgPSB0b1N0YXJ0ID8gc3RhcnRTaXR1IDogZmluaXNoU2l0dTtcbiAgICAgICAgICAgIHNldFJlbGF0aXZlKHdpbiwgc2l0dSwgc2l0dSk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQpIHtcbiAgICAgICAgICAgIHZhciBub2RlID0gdG9TdGFydCA/IHN0YXJ0IDogZmluaXNoO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRvU3RhcnQgPyBzb2Zmc2V0IDogZm9mZnNldDtcbiAgICAgICAgICAgIHNldEV4YWN0KHdpbiwgbm9kZSwgb2Zmc2V0LCBub2RlLCBvZmZzZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2VsZWN0Q29udGVudHMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBzZXRUb0VsZW1lbnQod2luLCBlbGVtZW50KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKHNlbCkge1xuICAgICAgICBzZXRFeGFjdCh3aW4sIHNlbC5zdGFydCwgc2VsLnNvZmZzZXQsIHNlbC5maW5pc2gsIHNlbC5mb2Zmc2V0KTtcbiAgICAgIH07XG4gICAgICB2YXIgc2V0UmVsYXRpdmVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoc3RhcnQsIGZpbmlzaCkge1xuICAgICAgICBzZXRSZWxhdGl2ZSh3aW4sIHN0YXJ0LCBmaW5pc2gpO1xuICAgICAgfTtcbiAgICAgIHZhciBnZXRJbm5lckhlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHdpbi5pbm5lckhlaWdodDtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0U2Nyb2xsWSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBvcyA9IGdldCRkKFN1Z2FyRWxlbWVudC5mcm9tRG9tKHdpbi5kb2N1bWVudCkpO1xuICAgICAgICByZXR1cm4gcG9zLnRvcDtcbiAgICAgIH07XG4gICAgICB2YXIgc2Nyb2xsQnkgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICBieSh4LCB5LCBTdWdhckVsZW1lbnQuZnJvbURvbSh3aW4uZG9jdW1lbnQpKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlbGVtZW50RnJvbVBvaW50OiBlbGVtZW50RnJvbVBvaW50LFxuICAgICAgICBnZXRSZWN0OiBnZXRSZWN0LFxuICAgICAgICBnZXRSYW5nZWRSZWN0OiBnZXRSYW5nZWRSZWN0LFxuICAgICAgICBnZXRTZWxlY3Rpb246IGdldFNlbGVjdGlvbixcbiAgICAgICAgZnJvbVNpdHVzOiBmcm9tU2l0dXMsXG4gICAgICAgIHNpdHVzRnJvbVBvaW50OiBzaXR1c0Zyb21Qb2ludCxcbiAgICAgICAgY2xlYXJTZWxlY3Rpb246IGNsZWFyU2VsZWN0aW9uLFxuICAgICAgICBjb2xsYXBzZVNlbGVjdGlvbjogY29sbGFwc2VTZWxlY3Rpb24sXG4gICAgICAgIHNldFNlbGVjdGlvbjogc2V0U2VsZWN0aW9uLFxuICAgICAgICBzZXRSZWxhdGl2ZVNlbGVjdGlvbjogc2V0UmVsYXRpdmVTZWxlY3Rpb24sXG4gICAgICAgIHNlbGVjdENvbnRlbnRzOiBzZWxlY3RDb250ZW50cyxcbiAgICAgICAgZ2V0SW5uZXJIZWlnaHQ6IGdldElubmVySGVpZ2h0LFxuICAgICAgICBnZXRTY3JvbGxZOiBnZXRTY3JvbGxZLFxuICAgICAgICBzY3JvbGxCeTogc2Nyb2xsQnlcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciByYyA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByb3dzOiByb3dzLFxuICAgICAgICBjb2xzOiBjb2xzXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIG1vdXNlID0gZnVuY3Rpb24gKHdpbiwgY29udGFpbmVyLCBpc1Jvb3QsIGFubm90YXRpb25zKSB7XG4gICAgICB2YXIgYnJpZGdlID0gV2luZG93QnJpZGdlKHdpbik7XG4gICAgICB2YXIgaGFuZGxlcnMgPSBNb3VzZVNlbGVjdGlvbihicmlkZ2UsIGNvbnRhaW5lciwgaXNSb290LCBhbm5vdGF0aW9ucyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbGVhcnN0YXRlOiBoYW5kbGVycy5jbGVhcnN0YXRlLFxuICAgICAgICBtb3VzZWRvd246IGhhbmRsZXJzLm1vdXNlZG93bixcbiAgICAgICAgbW91c2VvdmVyOiBoYW5kbGVycy5tb3VzZW92ZXIsXG4gICAgICAgIG1vdXNldXA6IGhhbmRsZXJzLm1vdXNldXBcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIga2V5Ym9hcmQgPSBmdW5jdGlvbiAod2luLCBjb250YWluZXIsIGlzUm9vdCwgYW5ub3RhdGlvbnMpIHtcbiAgICAgIHZhciBicmlkZ2UgPSBXaW5kb3dCcmlkZ2Uod2luKTtcbiAgICAgIHZhciBjbGVhclRvTmF2aWdhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFubm90YXRpb25zLmNsZWFyKGNvbnRhaW5lcik7XG4gICAgICAgIHJldHVybiBPcHRpb25hbC5ub25lKCk7XG4gICAgICB9O1xuICAgICAgdmFyIGtleWRvd24gPSBmdW5jdGlvbiAoZXZlbnQsIHN0YXJ0LCBzb2Zmc2V0LCBmaW5pc2gsIGZvZmZzZXQsIGRpcmVjdGlvbikge1xuICAgICAgICB2YXIgcmVhbEV2ZW50ID0gZXZlbnQucmF3O1xuICAgICAgICB2YXIga2V5Y29kZSA9IHJlYWxFdmVudC53aGljaDtcbiAgICAgICAgdmFyIHNoaWZ0S2V5ID0gcmVhbEV2ZW50LnNoaWZ0S2V5ID09PSB0cnVlO1xuICAgICAgICB2YXIgaGFuZGxlciA9IHJldHJpZXZlKGNvbnRhaW5lciwgYW5ub3RhdGlvbnMuc2VsZWN0ZWRTZWxlY3RvcikuZm9sZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKGlzRG93bihrZXljb2RlKSAmJiBzaGlmdEtleSkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJ5KHNlbGVjdCwgYnJpZGdlLCBjb250YWluZXIsIGlzUm9vdCwgZG93biwgZmluaXNoLCBzdGFydCwgYW5ub3RhdGlvbnMuc2VsZWN0UmFuZ2UpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNVcChrZXljb2RlKSAmJiBzaGlmdEtleSkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJ5KHNlbGVjdCwgYnJpZGdlLCBjb250YWluZXIsIGlzUm9vdCwgdXAsIGZpbmlzaCwgc3RhcnQsIGFubm90YXRpb25zLnNlbGVjdFJhbmdlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGlzRG93bihrZXljb2RlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJ5KG5hdmlnYXRlLCBicmlkZ2UsIGlzUm9vdCwgZG93biwgZmluaXNoLCBzdGFydCwgbGFzdERvd25DaGVjayk7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc1VwKGtleWNvZGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycnkobmF2aWdhdGUsIGJyaWRnZSwgaXNSb290LCB1cCwgZmluaXNoLCBzdGFydCwgZmlyc3RVcENoZWNrKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLm5vbmU7XG4gICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICB2YXIgdXBkYXRlJDEgPSBmdW5jdGlvbiAoYXR0ZW1wdHMpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uID0gZmluZE1hcChhdHRlbXB0cywgZnVuY3Rpb24gKGRlbHRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZShkZWx0YS5yb3dzLCBkZWx0YS5jb2xzLCBjb250YWluZXIsIHNlbGVjdGVkLCBhbm5vdGF0aW9ucyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdGlvbi5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RWRnZXMoY29udGFpbmVyLCBhbm5vdGF0aW9ucy5maXJzdFNlbGVjdGVkU2VsZWN0b3IsIGFubm90YXRpb25zLmxhc3RTZWxlY3RlZFNlbGVjdG9yKS5tYXAoZnVuY3Rpb24gKGVkZ2VzKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgcmVsYXRpdmUgPSBpc0Rvd24oa2V5Y29kZSkgfHwgZGlyZWN0aW9uLmlzRm9yd2FyZChrZXljb2RlKSA/IFNpdHUuYWZ0ZXIgOiBTaXR1LmJlZm9yZTtcbiAgICAgICAgICAgICAgICAgIGJyaWRnZS5zZXRSZWxhdGl2ZVNlbGVjdGlvbihTaXR1Lm9uKGVkZ2VzLmZpcnN0LCAwKSwgcmVsYXRpdmUoZWRnZXMudGFibGUpKTtcbiAgICAgICAgICAgICAgICAgIGFubm90YXRpb25zLmNsZWFyKGNvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gUmVzcG9uc2UuY3JlYXRlKE9wdGlvbmFsLm5vbmUoKSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChfKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE9wdGlvbmFsLnNvbWUoUmVzcG9uc2UuY3JlYXRlKE9wdGlvbmFsLm5vbmUoKSwgdHJ1ZSkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAoaXNEb3duKGtleWNvZGUpICYmIHNoaWZ0S2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlJDEoW3JjKCsxLCAwKV0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNVcChrZXljb2RlKSAmJiBzaGlmdEtleSkge1xuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZSQxKFtyYygtMSwgMCldKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbi5pc0JhY2t3YXJkKGtleWNvZGUpICYmIHNoaWZ0S2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlJDEoW1xuICAgICAgICAgICAgICByYygwLCAtMSksXG4gICAgICAgICAgICAgIHJjKC0xLCAwKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24uaXNGb3J3YXJkKGtleWNvZGUpICYmIHNoaWZ0S2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlJDEoW1xuICAgICAgICAgICAgICByYygwLCArMSksXG4gICAgICAgICAgICAgIHJjKCsxLCAwKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChpc05hdmlnYXRpb24oa2V5Y29kZSkgJiYgc2hpZnRLZXkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gY2xlYXJUb05hdmlnYXRlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaGFuZGxlcigpO1xuICAgICAgfTtcbiAgICAgIHZhciBrZXl1cCA9IGZ1bmN0aW9uIChldmVudCwgc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCkge1xuICAgICAgICByZXR1cm4gcmV0cmlldmUoY29udGFpbmVyLCBhbm5vdGF0aW9ucy5zZWxlY3RlZFNlbGVjdG9yKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgcmVhbEV2ZW50ID0gZXZlbnQucmF3O1xuICAgICAgICAgIHZhciBrZXljb2RlID0gcmVhbEV2ZW50LndoaWNoO1xuICAgICAgICAgIHZhciBzaGlmdEtleSA9IHJlYWxFdmVudC5zaGlmdEtleSA9PT0gdHJ1ZTtcbiAgICAgICAgICBpZiAoc2hpZnRLZXkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNOYXZpZ2F0aW9uKGtleWNvZGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gc3luYyhjb250YWluZXIsIGlzUm9vdCwgc3RhcnQsIHNvZmZzZXQsIGZpbmlzaCwgZm9mZnNldCwgYW5ub3RhdGlvbnMuc2VsZWN0UmFuZ2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgT3B0aW9uYWwubm9uZSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5ZG93bjoga2V5ZG93bixcbiAgICAgICAga2V5dXA6IGtleXVwXG4gICAgICB9O1xuICAgIH07XG4gICAgdmFyIGV4dGVybmFsID0gZnVuY3Rpb24gKHdpbiwgY29udGFpbmVyLCBpc1Jvb3QsIGFubm90YXRpb25zKSB7XG4gICAgICB2YXIgYnJpZGdlID0gV2luZG93QnJpZGdlKHdpbik7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHN0YXJ0LCBmaW5pc2gpIHtcbiAgICAgICAgYW5ub3RhdGlvbnMuY2xlYXJCZWZvcmVVcGRhdGUoY29udGFpbmVyKTtcbiAgICAgICAgaWRlbnRpZnkoc3RhcnQsIGZpbmlzaCwgaXNSb290KS5lYWNoKGZ1bmN0aW9uIChjZWxsU2VsKSB7XG4gICAgICAgICAgdmFyIGJveGVzID0gY2VsbFNlbC5ib3hlcy5nZXRPcihbXSk7XG4gICAgICAgICAgYW5ub3RhdGlvbnMuc2VsZWN0UmFuZ2UoY29udGFpbmVyLCBib3hlcywgY2VsbFNlbC5zdGFydCwgY2VsbFNlbC5maW5pc2gpO1xuICAgICAgICAgIGJyaWRnZS5zZWxlY3RDb250ZW50cyhmaW5pc2gpO1xuICAgICAgICAgIGJyaWRnZS5jb2xsYXBzZVNlbGVjdGlvbigpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciByZW1vdmUkNyA9IGZ1bmN0aW9uIChlbGVtZW50LCBjbGFzc2VzKSB7XG4gICAgICBlYWNoKGNsYXNzZXMsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJlbW92ZSQ1KGVsZW1lbnQsIHgpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHZhciBhZGRDbGFzcyA9IGZ1bmN0aW9uIChjbGF6eikge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIGFkZCQzKGVsZW1lbnQsIGNsYXp6KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICB2YXIgcmVtb3ZlQ2xhc3NlcyA9IGZ1bmN0aW9uIChjbGFzc2VzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmVtb3ZlJDcoZWxlbWVudCwgY2xhc3Nlcyk7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgYnlDbGFzcyA9IGZ1bmN0aW9uIChlcGhlbWVyYSkge1xuICAgICAgdmFyIGFkZFNlbGVjdGlvbkNsYXNzID0gYWRkQ2xhc3MoZXBoZW1lcmEuc2VsZWN0ZWQpO1xuICAgICAgdmFyIHJlbW92ZVNlbGVjdGlvbkNsYXNzZXMgPSByZW1vdmVDbGFzc2VzKFtcbiAgICAgICAgZXBoZW1lcmEuc2VsZWN0ZWQsXG4gICAgICAgIGVwaGVtZXJhLmxhc3RTZWxlY3RlZCxcbiAgICAgICAgZXBoZW1lcmEuZmlyc3RTZWxlY3RlZFxuICAgICAgXSk7XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgIHZhciBzZWxzID0gZGVzY2VuZGFudHMkMShjb250YWluZXIsIGVwaGVtZXJhLnNlbGVjdGVkU2VsZWN0b3IpO1xuICAgICAgICBlYWNoKHNlbHMsIHJlbW92ZVNlbGVjdGlvbkNsYXNzZXMpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZWxlY3RSYW5nZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGNlbGxzLCBzdGFydCwgZmluaXNoKSB7XG4gICAgICAgIGNsZWFyKGNvbnRhaW5lcik7XG4gICAgICAgIGVhY2goY2VsbHMsIGFkZFNlbGVjdGlvbkNsYXNzKTtcbiAgICAgICAgYWRkJDMoc3RhcnQsIGVwaGVtZXJhLmZpcnN0U2VsZWN0ZWQpO1xuICAgICAgICBhZGQkMyhmaW5pc2gsIGVwaGVtZXJhLmxhc3RTZWxlY3RlZCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2xlYXJCZWZvcmVVcGRhdGU6IGNsZWFyLFxuICAgICAgICBjbGVhcjogY2xlYXIsXG4gICAgICAgIHNlbGVjdFJhbmdlOiBzZWxlY3RSYW5nZSxcbiAgICAgICAgc2VsZWN0ZWRTZWxlY3RvcjogZXBoZW1lcmEuc2VsZWN0ZWRTZWxlY3RvcixcbiAgICAgICAgZmlyc3RTZWxlY3RlZFNlbGVjdG9yOiBlcGhlbWVyYS5maXJzdFNlbGVjdGVkU2VsZWN0b3IsXG4gICAgICAgIGxhc3RTZWxlY3RlZFNlbGVjdG9yOiBlcGhlbWVyYS5sYXN0U2VsZWN0ZWRTZWxlY3RvclxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBieUF0dHIgPSBmdW5jdGlvbiAoZXBoZW1lcmEsIG9uU2VsZWN0aW9uLCBvbkNsZWFyKSB7XG4gICAgICB2YXIgcmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJlbW92ZShlbGVtZW50LCBlcGhlbWVyYS5zZWxlY3RlZCk7XG4gICAgICAgIHJlbW92ZShlbGVtZW50LCBlcGhlbWVyYS5maXJzdFNlbGVjdGVkKTtcbiAgICAgICAgcmVtb3ZlKGVsZW1lbnQsIGVwaGVtZXJhLmxhc3RTZWxlY3RlZCk7XG4gICAgICB9O1xuICAgICAgdmFyIGFkZFNlbGVjdGlvbkF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHNldChlbGVtZW50LCBlcGhlbWVyYS5zZWxlY3RlZCwgJzEnKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xlYXIgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgIGNsZWFyQmVmb3JlVXBkYXRlKGNvbnRhaW5lcik7XG4gICAgICAgIG9uQ2xlYXIoKTtcbiAgICAgIH07XG4gICAgICB2YXIgY2xlYXJCZWZvcmVVcGRhdGUgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgICAgIHZhciBzZWxzID0gZGVzY2VuZGFudHMkMShjb250YWluZXIsIGVwaGVtZXJhLnNlbGVjdGVkU2VsZWN0b3IpO1xuICAgICAgICBlYWNoKHNlbHMsIHJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZXMpO1xuICAgICAgfTtcbiAgICAgIHZhciBzZWxlY3RSYW5nZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGNlbGxzLCBzdGFydCwgZmluaXNoKSB7XG4gICAgICAgIGNsZWFyKGNvbnRhaW5lcik7XG4gICAgICAgIGVhY2goY2VsbHMsIGFkZFNlbGVjdGlvbkF0dHJpYnV0ZSk7XG4gICAgICAgIHNldChzdGFydCwgZXBoZW1lcmEuZmlyc3RTZWxlY3RlZCwgJzEnKTtcbiAgICAgICAgc2V0KGZpbmlzaCwgZXBoZW1lcmEubGFzdFNlbGVjdGVkLCAnMScpO1xuICAgICAgICBvblNlbGVjdGlvbihjZWxscywgc3RhcnQsIGZpbmlzaCk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2xlYXJCZWZvcmVVcGRhdGU6IGNsZWFyQmVmb3JlVXBkYXRlLFxuICAgICAgICBjbGVhcjogY2xlYXIsXG4gICAgICAgIHNlbGVjdFJhbmdlOiBzZWxlY3RSYW5nZSxcbiAgICAgICAgc2VsZWN0ZWRTZWxlY3RvcjogZXBoZW1lcmEuc2VsZWN0ZWRTZWxlY3RvcixcbiAgICAgICAgZmlyc3RTZWxlY3RlZFNlbGVjdG9yOiBlcGhlbWVyYS5maXJzdFNlbGVjdGVkU2VsZWN0b3IsXG4gICAgICAgIGxhc3RTZWxlY3RlZFNlbGVjdG9yOiBlcGhlbWVyYS5sYXN0U2VsZWN0ZWRTZWxlY3RvclxuICAgICAgfTtcbiAgICB9O1xuICAgIHZhciBTZWxlY3Rpb25Bbm5vdGF0aW9uID0ge1xuICAgICAgYnlDbGFzczogYnlDbGFzcyxcbiAgICAgIGJ5QXR0cjogYnlBdHRyXG4gICAgfTtcblxuICAgIHZhciBnZXRVcE9yTGVmdENlbGxzID0gZnVuY3Rpb24gKGdyaWQsIHNlbGVjdGVkQ2VsbHMsIGdlbmVyYXRvcnMpIHtcbiAgICAgIHZhciB1cEdyaWQgPSBncmlkLnNsaWNlKDAsIHNlbGVjdGVkQ2VsbHNbc2VsZWN0ZWRDZWxscy5sZW5ndGggLSAxXS5yb3cgKyAxKTtcbiAgICAgIHZhciB1cERldGFpbHMgPSB0b0RldGFpbExpc3QodXBHcmlkLCBnZW5lcmF0b3JzKTtcbiAgICAgIHJldHVybiBiaW5kKHVwRGV0YWlscywgZnVuY3Rpb24gKGRldGFpbCkge1xuICAgICAgICB2YXIgc2xpY2VkQ2VsbHMgPSBkZXRhaWwuY2VsbHMuc2xpY2UoMCwgc2VsZWN0ZWRDZWxsc1tzZWxlY3RlZENlbGxzLmxlbmd0aCAtIDFdLmNvbHVtbiArIDEpO1xuICAgICAgICByZXR1cm4gbWFwKHNsaWNlZENlbGxzLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIHJldHVybiBjZWxsLmVsZW1lbnQ7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0RG93bk9yUmlnaHRDZWxscyA9IGZ1bmN0aW9uIChncmlkLCBzZWxlY3RlZENlbGxzLCBnZW5lcmF0b3JzKSB7XG4gICAgICB2YXIgZG93bkdyaWQgPSBncmlkLnNsaWNlKHNlbGVjdGVkQ2VsbHNbMF0ucm93ICsgc2VsZWN0ZWRDZWxsc1swXS5yb3dzcGFuIC0gMSwgZ3JpZC5sZW5ndGgpO1xuICAgICAgdmFyIGRvd25EZXRhaWxzID0gdG9EZXRhaWxMaXN0KGRvd25HcmlkLCBnZW5lcmF0b3JzKTtcbiAgICAgIHJldHVybiBiaW5kKGRvd25EZXRhaWxzLCBmdW5jdGlvbiAoZGV0YWlsKSB7XG4gICAgICAgIHZhciBzbGljZWRDZWxscyA9IGRldGFpbC5jZWxscy5zbGljZShzZWxlY3RlZENlbGxzWzBdLmNvbHVtbiArIHNlbGVjdGVkQ2VsbHNbMF0uY29sc3BhbiAtIDEsIGRldGFpbC5jZWxscy5sZW5ndGgpO1xuICAgICAgICByZXR1cm4gbWFwKHNsaWNlZENlbGxzLCBmdW5jdGlvbiAoY2VsbCkge1xuICAgICAgICAgIHJldHVybiBjZWxsLmVsZW1lbnQ7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0T3RoZXJDZWxscyA9IGZ1bmN0aW9uICh0YWJsZSwgdGFyZ2V0LCBnZW5lcmF0b3JzKSB7XG4gICAgICB2YXIgd2FyZWhvdXNlID0gV2FyZWhvdXNlLmZyb21UYWJsZSh0YWJsZSk7XG4gICAgICB2YXIgZGV0YWlscyA9IG9uQ2VsbHMod2FyZWhvdXNlLCB0YXJnZXQpO1xuICAgICAgcmV0dXJuIGRldGFpbHMubWFwKGZ1bmN0aW9uIChzZWxlY3RlZENlbGxzKSB7XG4gICAgICAgIHZhciBncmlkID0gdG9HcmlkKHdhcmVob3VzZSwgZ2VuZXJhdG9ycywgZmFsc2UpO1xuICAgICAgICB2YXIgdXBPckxlZnRDZWxscyA9IGdldFVwT3JMZWZ0Q2VsbHMoZ3JpZCwgc2VsZWN0ZWRDZWxscywgZ2VuZXJhdG9ycyk7XG4gICAgICAgIHZhciBkb3duT3JSaWdodENlbGxzID0gZ2V0RG93bk9yUmlnaHRDZWxscyhncmlkLCBzZWxlY3RlZENlbGxzLCBnZW5lcmF0b3JzKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1cE9yTGVmdENlbGxzOiB1cE9yTGVmdENlbGxzLFxuICAgICAgICAgIGRvd25PclJpZ2h0Q2VsbHM6IGRvd25PclJpZ2h0Q2VsbHNcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgaGFzSW50ZXJuYWxUYXJnZXQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIGhhcyQxKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGUudGFyZ2V0KSwgJ2VwaG94LXNub29rZXItcmVzaXplci1iYXInKSA9PT0gZmFsc2U7XG4gICAgfTtcbiAgICBmdW5jdGlvbiBDZWxsU2VsZWN0aW9uIChlZGl0b3IsIGxhenlSZXNpemUsIHNlbGVjdGlvblRhcmdldHMpIHtcbiAgICAgIHZhciBvblNlbGVjdGlvbiA9IGZ1bmN0aW9uIChjZWxscywgc3RhcnQsIGZpbmlzaCkge1xuICAgICAgICBzZWxlY3Rpb25UYXJnZXRzLnRhcmdldHMoKS5lYWNoKGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgICAgdmFyIHRhYmxlT3B0ID0gdGFibGUoc3RhcnQpO1xuICAgICAgICAgIHRhYmxlT3B0LmVhY2goZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgICB2YXIgY2xvbmVGb3JtYXRzID0gZ2V0Q2xvbmVFbGVtZW50cyhlZGl0b3IpO1xuICAgICAgICAgICAgdmFyIGdlbmVyYXRvcnMgPSBjZWxsT3BlcmF0aW9ucyhub29wLCBTdWdhckVsZW1lbnQuZnJvbURvbShlZGl0b3IuZ2V0RG9jKCkpLCBjbG9uZUZvcm1hdHMpO1xuICAgICAgICAgICAgdmFyIG90aGVyQ2VsbHMgPSBnZXRPdGhlckNlbGxzKHRhYmxlLCB0YXJnZXRzLCBnZW5lcmF0b3JzKTtcbiAgICAgICAgICAgIGZpcmVUYWJsZVNlbGVjdGlvbkNoYW5nZShlZGl0b3IsIGNlbGxzLCBzdGFydCwgZmluaXNoLCBvdGhlckNlbGxzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uQ2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmaXJlVGFibGVTZWxlY3Rpb25DbGVhcihlZGl0b3IpO1xuICAgICAgfTtcbiAgICAgIHZhciBhbm5vdGF0aW9ucyA9IFNlbGVjdGlvbkFubm90YXRpb24uYnlBdHRyKGVwaGVtZXJhLCBvblNlbGVjdGlvbiwgb25DbGVhcik7XG4gICAgICBlZGl0b3Iub24oJ2luaXQnLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgdmFyIHdpbiA9IGVkaXRvci5nZXRXaW4oKTtcbiAgICAgICAgdmFyIGJvZHkgPSBnZXRCb2R5JDEoZWRpdG9yKTtcbiAgICAgICAgdmFyIGlzUm9vdCA9IGdldElzUm9vdChlZGl0b3IpO1xuICAgICAgICB2YXIgc3luY1NlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgc2VsID0gZWRpdG9yLnNlbGVjdGlvbjtcbiAgICAgICAgICB2YXIgc3RhcnQgPSBTdWdhckVsZW1lbnQuZnJvbURvbShzZWwuZ2V0U3RhcnQoKSk7XG4gICAgICAgICAgdmFyIGVuZCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHNlbC5nZXRFbmQoKSk7XG4gICAgICAgICAgdmFyIHNoYXJlZCA9IHNoYXJlZE9uZSQxKHRhYmxlLCBbXG4gICAgICAgICAgICBzdGFydCxcbiAgICAgICAgICAgIGVuZFxuICAgICAgICAgIF0pO1xuICAgICAgICAgIHNoYXJlZC5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBhbm5vdGF0aW9ucy5jbGVhcihib2R5KTtcbiAgICAgICAgICB9LCBub29wKTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG1vdXNlSGFuZGxlcnMgPSBtb3VzZSh3aW4sIGJvZHksIGlzUm9vdCwgYW5ub3RhdGlvbnMpO1xuICAgICAgICB2YXIga2V5SGFuZGxlcnMgPSBrZXlib2FyZCh3aW4sIGJvZHksIGlzUm9vdCwgYW5ub3RhdGlvbnMpO1xuICAgICAgICB2YXIgZXh0ZXJuYWwkMSA9IGV4dGVybmFsKHdpbiwgYm9keSwgaXNSb290LCBhbm5vdGF0aW9ucyk7XG4gICAgICAgIHZhciBoYXNTaGlmdEtleSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHJldHVybiBldmVudC5yYXcuc2hpZnRLZXkgPT09IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIGVkaXRvci5vbignVGFibGVTZWxlY3RvckNoYW5nZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGV4dGVybmFsJDEoZS5zdGFydCwgZS5maW5pc2gpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGhhbmRsZVJlc3BvbnNlID0gZnVuY3Rpb24gKGV2ZW50LCByZXNwb25zZSkge1xuICAgICAgICAgIGlmICghaGFzU2hpZnRLZXkoZXZlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZXNwb25zZS5raWxsKSB7XG4gICAgICAgICAgICBldmVudC5raWxsKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3BvbnNlLnNlbGVjdGlvbi5lYWNoKGZ1bmN0aW9uIChucykge1xuICAgICAgICAgICAgdmFyIHJlbGF0aXZlID0gU2ltU2VsZWN0aW9uLnJlbGF0aXZlKG5zLnN0YXJ0LCBucy5maW5pc2gpO1xuICAgICAgICAgICAgdmFyIHJuZyA9IGFzTHRyUmFuZ2Uod2luLCByZWxhdGl2ZSk7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJuZyhybmcpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIga2V5dXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgd3JhcHBlZEV2ZW50ID0gZnJvbVJhd0V2ZW50JDEoZXZlbnQpO1xuICAgICAgICAgIGlmICh3cmFwcGVkRXZlbnQucmF3LnNoaWZ0S2V5ICYmIGlzTmF2aWdhdGlvbih3cmFwcGVkRXZlbnQucmF3LndoaWNoKSkge1xuICAgICAgICAgICAgdmFyIHJuZyA9IGVkaXRvci5zZWxlY3Rpb24uZ2V0Um5nKCk7XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSBTdWdhckVsZW1lbnQuZnJvbURvbShybmcuc3RhcnRDb250YWluZXIpO1xuICAgICAgICAgICAgdmFyIGVuZCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJuZy5lbmRDb250YWluZXIpO1xuICAgICAgICAgICAga2V5SGFuZGxlcnMua2V5dXAod3JhcHBlZEV2ZW50LCBzdGFydCwgcm5nLnN0YXJ0T2Zmc2V0LCBlbmQsIHJuZy5lbmRPZmZzZXQpLmVhY2goZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgIGhhbmRsZVJlc3BvbnNlKHdyYXBwZWRFdmVudCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIga2V5ZG93biA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHZhciB3cmFwcGVkRXZlbnQgPSBmcm9tUmF3RXZlbnQkMShldmVudCk7XG4gICAgICAgICAgbGF6eVJlc2l6ZSgpLmVhY2goZnVuY3Rpb24gKHJlc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc2l6ZS5oaWRlQmFycygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZhciBybmcgPSBlZGl0b3Iuc2VsZWN0aW9uLmdldFJuZygpO1xuICAgICAgICAgIHZhciBzdGFydCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJuZy5zdGFydENvbnRhaW5lcik7XG4gICAgICAgICAgdmFyIGVuZCA9IFN1Z2FyRWxlbWVudC5mcm9tRG9tKHJuZy5lbmRDb250YWluZXIpO1xuICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBvbkRpcmVjdGlvbihsdHIkMiwgcnRsJDIpKFN1Z2FyRWxlbWVudC5mcm9tRG9tKGVkaXRvci5zZWxlY3Rpb24uZ2V0U3RhcnQoKSkpO1xuICAgICAgICAgIGtleUhhbmRsZXJzLmtleWRvd24od3JhcHBlZEV2ZW50LCBzdGFydCwgcm5nLnN0YXJ0T2Zmc2V0LCBlbmQsIHJuZy5lbmRPZmZzZXQsIGRpcmVjdGlvbikuZWFjaChmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGhhbmRsZVJlc3BvbnNlKHdyYXBwZWRFdmVudCwgcmVzcG9uc2UpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGxhenlSZXNpemUoKS5lYWNoKGZ1bmN0aW9uIChyZXNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNpemUuc2hvd0JhcnMoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGlzTGVmdE1vdXNlID0gZnVuY3Rpb24gKHJhdykge1xuICAgICAgICAgIHJldHVybiByYXcuYnV0dG9uID09PSAwO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgaXNMZWZ0QnV0dG9uUHJlc3NlZCA9IGZ1bmN0aW9uIChyYXcpIHtcbiAgICAgICAgICBpZiAocmF3LmJ1dHRvbnMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChnbG9iYWwkMi5icm93c2VyLmlzRWRnZSgpICYmIHJhdy5idXR0b25zID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIChyYXcuYnV0dG9ucyAmIDEpICE9PSAwO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgZHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKF9lKSB7XG4gICAgICAgICAgbW91c2VIYW5kbGVycy5jbGVhcnN0YXRlKCk7XG4gICAgICAgIH07XG4gICAgICAgIHZhciBtb3VzZURvd24gPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGlmIChpc0xlZnRNb3VzZShlKSAmJiBoYXNJbnRlcm5hbFRhcmdldChlKSkge1xuICAgICAgICAgICAgbW91c2VIYW5kbGVycy5tb3VzZWRvd24oZnJvbVJhd0V2ZW50JDEoZSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG1vdXNlT3ZlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgaWYgKGlzTGVmdEJ1dHRvblByZXNzZWQoZSkgJiYgaGFzSW50ZXJuYWxUYXJnZXQoZSkpIHtcbiAgICAgICAgICAgIG1vdXNlSGFuZGxlcnMubW91c2VvdmVyKGZyb21SYXdFdmVudCQxKGUpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBtb3VzZVVwID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBpZiAoaXNMZWZ0TW91c2UoZSkgJiYgaGFzSW50ZXJuYWxUYXJnZXQoZSkpIHtcbiAgICAgICAgICAgIG1vdXNlSGFuZGxlcnMubW91c2V1cChmcm9tUmF3RXZlbnQkMShlKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgZ2V0RG91YmxlVGFwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBsYXN0VGFyZ2V0ID0gQ2VsbChTdWdhckVsZW1lbnQuZnJvbURvbShib2R5KSk7XG4gICAgICAgICAgdmFyIGxhc3RUaW1lU3RhbXAgPSBDZWxsKDApO1xuICAgICAgICAgIHZhciB0b3VjaEVuZCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gU3VnYXJFbGVtZW50LmZyb21Eb20odC50YXJnZXQpO1xuICAgICAgICAgICAgaWYgKG5hbWUodGFyZ2V0KSA9PT0gJ3RkJyB8fCBuYW1lKHRhcmdldCkgPT09ICd0aCcpIHtcbiAgICAgICAgICAgICAgdmFyIGxUID0gbGFzdFRhcmdldC5nZXQoKTtcbiAgICAgICAgICAgICAgdmFyIGxUUyA9IGxhc3RUaW1lU3RhbXAuZ2V0KCk7XG4gICAgICAgICAgICAgIGlmIChlcSQxKGxULCB0YXJnZXQpICYmIHQudGltZVN0YW1wIC0gbFRTIDwgMzAwKSB7XG4gICAgICAgICAgICAgICAgdC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV4dGVybmFsJDEodGFyZ2V0LCB0YXJnZXQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXN0VGFyZ2V0LnNldCh0YXJnZXQpO1xuICAgICAgICAgICAgbGFzdFRpbWVTdGFtcC5zZXQodC50aW1lU3RhbXApO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHsgdG91Y2hFbmQ6IHRvdWNoRW5kIH07XG4gICAgICAgIH07XG4gICAgICAgIHZhciBkb3VibGVUYXAgPSBnZXREb3VibGVUYXAoKTtcbiAgICAgICAgZWRpdG9yLm9uKCdkcmFnc3RhcnQnLCBkcmFnU3RhcnQpO1xuICAgICAgICBlZGl0b3Iub24oJ21vdXNlZG93bicsIG1vdXNlRG93bik7XG4gICAgICAgIGVkaXRvci5vbignbW91c2VvdmVyJywgbW91c2VPdmVyKTtcbiAgICAgICAgZWRpdG9yLm9uKCdtb3VzZXVwJywgbW91c2VVcCk7XG4gICAgICAgIGVkaXRvci5vbigndG91Y2hlbmQnLCBkb3VibGVUYXAudG91Y2hFbmQpO1xuICAgICAgICBlZGl0b3Iub24oJ2tleXVwJywga2V5dXApO1xuICAgICAgICBlZGl0b3Iub24oJ2tleWRvd24nLCBrZXlkb3duKTtcbiAgICAgICAgZWRpdG9yLm9uKCdOb2RlQ2hhbmdlJywgc3luY1NlbGVjdGlvbik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7IGNsZWFyOiBhbm5vdGF0aW9ucy5jbGVhciB9O1xuICAgIH1cblxuICAgIHZhciBnZXRTZWxlY3Rpb25UYXJnZXRzID0gZnVuY3Rpb24gKGVkaXRvciwgc2VsZWN0aW9ucykge1xuICAgICAgdmFyIHRhcmdldHMgPSBDZWxsKE9wdGlvbmFsLm5vbmUoKSk7XG4gICAgICB2YXIgY2hhbmdlSGFuZGxlcnMgPSBDZWxsKFtdKTtcbiAgICAgIHZhciBzZWxlY3Rpb25EZXRhaWxzID0gT3B0aW9uYWwubm9uZSgpO1xuICAgICAgdmFyIGlzQ2FwdGlvbiA9IGlzVGFnKCdjYXB0aW9uJyk7XG4gICAgICB2YXIgaXNEaXNhYmxlZEZvclNlbGVjdGlvbiA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuIHNlbGVjdGlvbkRldGFpbHMuZm9yYWxsKGZ1bmN0aW9uIChkZXRhaWxzKSB7XG4gICAgICAgICAgcmV0dXJuICFkZXRhaWxzW2tleV07XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBmaW5kVGFyZ2V0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldFNlbGVjdGlvblN0YXJ0Q2VsbE9yQ2FwdGlvbihnZXRTZWxlY3Rpb25TdGFydChlZGl0b3IpLCBnZXRJc1Jvb3QoZWRpdG9yKSkuYmluZChmdW5jdGlvbiAoY2VsbE9yQ2FwdGlvbikge1xuICAgICAgICAgIHZhciB0YWJsZSQxID0gdGFibGUoY2VsbE9yQ2FwdGlvbik7XG4gICAgICAgICAgcmV0dXJuIHRhYmxlJDEubWFwKGZ1bmN0aW9uICh0YWJsZSkge1xuICAgICAgICAgICAgaWYgKGlzQ2FwdGlvbihjZWxsT3JDYXB0aW9uKSkge1xuICAgICAgICAgICAgICByZXR1cm4gbm9NZW51KGNlbGxPckNhcHRpb24pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZvck1lbnUoc2VsZWN0aW9ucywgdGFibGUsIGNlbGxPckNhcHRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgZ2V0RXh0cmFjdGVkRGV0YWlscyA9IGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgIHZhciB0YWJsZU9wdCA9IHRhYmxlKHRhcmdldHMuZWxlbWVudCk7XG4gICAgICAgIHJldHVybiB0YWJsZU9wdC5tYXAoZnVuY3Rpb24gKHRhYmxlKSB7XG4gICAgICAgICAgdmFyIHdhcmVob3VzZSA9IFdhcmVob3VzZS5mcm9tVGFibGUodGFibGUpO1xuICAgICAgICAgIHZhciBzZWxlY3RlZENlbGxzID0gb25DZWxscyh3YXJlaG91c2UsIHRhcmdldHMpLmdldE9yKFtdKTtcbiAgICAgICAgICB2YXIgbG9ja2VkID0gZm9sZGwoc2VsZWN0ZWRDZWxscywgZnVuY3Rpb24gKGFjYywgY2VsbCkge1xuICAgICAgICAgICAgaWYgKGNlbGwuaXNMb2NrZWQpIHtcbiAgICAgICAgICAgICAgYWNjLm9uQW55ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgaWYgKGNlbGwuY29sdW1uID09PSAwKSB7XG4gICAgICAgICAgICAgICAgYWNjLm9uRmlyc3QgPSB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNlbGwuY29sdW1uICsgY2VsbC5jb2xzcGFuID49IHdhcmVob3VzZS5ncmlkLmNvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBhY2Mub25MYXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICBvbkFueTogZmFsc2UsXG4gICAgICAgICAgICBvbkZpcnN0OiBmYWxzZSxcbiAgICAgICAgICAgIG9uTGFzdDogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWVyZ2VhYmxlOiBvblVubG9ja2VkTWVyZ2FibGUod2FyZWhvdXNlLCB0YXJnZXRzKS5pc1NvbWUoKSxcbiAgICAgICAgICAgIHVubWVyZ2VhYmxlOiBvblVubG9ja2VkVW5tZXJnYWJsZSh3YXJlaG91c2UsIHRhcmdldHMpLmlzU29tZSgpLFxuICAgICAgICAgICAgbG9ja2VkOiBsb2NrZWRcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgcmVzZXRUYXJnZXRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0YXJnZXRzLnNldChjYWNoZWQoZmluZFRhcmdldHMpKCkpO1xuICAgICAgICBzZWxlY3Rpb25EZXRhaWxzID0gdGFyZ2V0cy5nZXQoKS5iaW5kKGdldEV4dHJhY3RlZERldGFpbHMpO1xuICAgICAgICBlYWNoKGNoYW5nZUhhbmRsZXJzLmdldCgpLCBmdW5jdGlvbiAoaGFuZGxlcikge1xuICAgICAgICAgIHJldHVybiBoYW5kbGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBvblNldHVwID0gZnVuY3Rpb24gKGFwaSwgaXNEaXNhYmxlZCkge1xuICAgICAgICB2YXIgaGFuZGxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGFyZ2V0cy5nZXQoKS5mb2xkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGFwaS5zZXREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICAgICAgYXBpLnNldERpc2FibGVkKGlzRGlzYWJsZWQodGFyZ2V0cykpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBoYW5kbGVyKCk7XG4gICAgICAgIGNoYW5nZUhhbmRsZXJzLnNldChjaGFuZ2VIYW5kbGVycy5nZXQoKS5jb25jYXQoW2hhbmRsZXJdKSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2hhbmdlSGFuZGxlcnMuc2V0KGZpbHRlcihjaGFuZ2VIYW5kbGVycy5nZXQoKSwgZnVuY3Rpb24gKGgpIHtcbiAgICAgICAgICAgIHJldHVybiBoICE9PSBoYW5kbGVyO1xuICAgICAgICAgIH0pKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgICB2YXIgaXNEaXNhYmxlZEZyb21Mb2NrZWQgPSBmdW5jdGlvbiAobG9ja2VkRGlzYWJsZSkge1xuICAgICAgICByZXR1cm4gc2VsZWN0aW9uRGV0YWlscy5leGlzdHMoZnVuY3Rpb24gKGRldGFpbHMpIHtcbiAgICAgICAgICByZXR1cm4gZGV0YWlscy5sb2NrZWRbbG9ja2VkRGlzYWJsZV07XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBvblNldHVwVGFibGUgPSBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgIHJldHVybiBvblNldHVwKGFwaSwgZnVuY3Rpb24gKF8pIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBvblNldHVwQ2VsbE9yUm93ID0gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICByZXR1cm4gb25TZXR1cChhcGksIGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgICAgcmV0dXJuIGlzQ2FwdGlvbih0YXJnZXRzLmVsZW1lbnQpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgb25TZXR1cENvbHVtbiA9IGZ1bmN0aW9uIChsb2NrZWREaXNhYmxlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoYXBpKSB7XG4gICAgICAgICAgcmV0dXJuIG9uU2V0dXAoYXBpLCBmdW5jdGlvbiAodGFyZ2V0cykge1xuICAgICAgICAgICAgcmV0dXJuIGlzQ2FwdGlvbih0YXJnZXRzLmVsZW1lbnQpIHx8IGlzRGlzYWJsZWRGcm9tTG9ja2VkKGxvY2tlZERpc2FibGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBvblNldHVwUGFzdGVhYmxlID0gZnVuY3Rpb24gKGdldENsaXBib2FyZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICByZXR1cm4gb25TZXR1cChhcGksIGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNDYXB0aW9uKHRhcmdldHMuZWxlbWVudCkgfHwgZ2V0Q2xpcGJvYXJkRGF0YSgpLmlzTm9uZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBvblNldHVwUGFzdGVhYmxlQ29sdW1uID0gZnVuY3Rpb24gKGdldENsaXBib2FyZERhdGEsIGxvY2tlZERpc2FibGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgICByZXR1cm4gb25TZXR1cChhcGksIGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNDYXB0aW9uKHRhcmdldHMuZWxlbWVudCkgfHwgZ2V0Q2xpcGJvYXJkRGF0YSgpLmlzTm9uZSgpIHx8IGlzRGlzYWJsZWRGcm9tTG9ja2VkKGxvY2tlZERpc2FibGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIHZhciBvblNldHVwTWVyZ2VhYmxlID0gZnVuY3Rpb24gKGFwaSkge1xuICAgICAgICByZXR1cm4gb25TZXR1cChhcGksIGZ1bmN0aW9uIChfdGFyZ2V0cykge1xuICAgICAgICAgIHJldHVybiBpc0Rpc2FibGVkRm9yU2VsZWN0aW9uKCdtZXJnZWFibGUnKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgdmFyIG9uU2V0dXBVbm1lcmdlYWJsZSA9IGZ1bmN0aW9uIChhcGkpIHtcbiAgICAgICAgcmV0dXJuIG9uU2V0dXAoYXBpLCBmdW5jdGlvbiAoX3RhcmdldHMpIHtcbiAgICAgICAgICByZXR1cm4gaXNEaXNhYmxlZEZvclNlbGVjdGlvbigndW5tZXJnZWFibGUnKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgZWRpdG9yLm9uKCdOb2RlQ2hhbmdlIEV4ZWNDb21tYW5kIFRhYmxlU2VsZWN0b3JDaGFuZ2UnLCByZXNldFRhcmdldHMpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb25TZXR1cFRhYmxlOiBvblNldHVwVGFibGUsXG4gICAgICAgIG9uU2V0dXBDZWxsT3JSb3c6IG9uU2V0dXBDZWxsT3JSb3csXG4gICAgICAgIG9uU2V0dXBDb2x1bW46IG9uU2V0dXBDb2x1bW4sXG4gICAgICAgIG9uU2V0dXBQYXN0ZWFibGU6IG9uU2V0dXBQYXN0ZWFibGUsXG4gICAgICAgIG9uU2V0dXBQYXN0ZWFibGVDb2x1bW46IG9uU2V0dXBQYXN0ZWFibGVDb2x1bW4sXG4gICAgICAgIG9uU2V0dXBNZXJnZWFibGU6IG9uU2V0dXBNZXJnZWFibGUsXG4gICAgICAgIG9uU2V0dXBVbm1lcmdlYWJsZTogb25TZXR1cFVubWVyZ2VhYmxlLFxuICAgICAgICByZXNldFRhcmdldHM6IHJlc2V0VGFyZ2V0cyxcbiAgICAgICAgdGFyZ2V0czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0YXJnZXRzLmdldCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgYWRkQnV0dG9ucyA9IGZ1bmN0aW9uIChlZGl0b3IsIHNlbGVjdGlvblRhcmdldHMsIGNsaXBib2FyZCkge1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVCdXR0b24oJ3RhYmxlJywge1xuICAgICAgICB0b29sdGlwOiAnVGFibGUnLFxuICAgICAgICBpY29uOiAndGFibGUnLFxuICAgICAgICBmZXRjaDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCdpbnNlcnR0YWJsZSB8IGNlbGwgcm93IGNvbHVtbiB8IGFkdnRhYmxlc29ydCB8IHRhYmxlcHJvcHMgZGVsZXRldGFibGUnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgY21kID0gZnVuY3Rpb24gKGNvbW1hbmQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZWRpdG9yLmV4ZWNDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRCdXR0b24oJ3RhYmxlcHJvcHMnLCB7XG4gICAgICAgIHRvb2x0aXA6ICdUYWJsZSBwcm9wZXJ0aWVzJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVQcm9wcycpLFxuICAgICAgICBpY29uOiAndGFibGUnLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBUYWJsZVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWRlbGV0ZScsIHtcbiAgICAgICAgdG9vbHRpcDogJ0RlbGV0ZSB0YWJsZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlRGVsZXRlJyksXG4gICAgICAgIGljb246ICd0YWJsZS1kZWxldGUtdGFibGUnLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBUYWJsZVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWNlbGxwcm9wcycsIHtcbiAgICAgICAgdG9vbHRpcDogJ0NlbGwgcHJvcGVydGllcycsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlQ2VsbFByb3BzJyksXG4gICAgICAgIGljb246ICd0YWJsZS1jZWxsLXByb3BlcnRpZXMnLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBDZWxsT3JSb3dcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigndGFibGVtZXJnZWNlbGxzJywge1xuICAgICAgICB0b29sdGlwOiAnTWVyZ2UgY2VsbHMnLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZU1lcmdlQ2VsbHMnKSxcbiAgICAgICAgaWNvbjogJ3RhYmxlLW1lcmdlLWNlbGxzJyxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwTWVyZ2VhYmxlXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRCdXR0b24oJ3RhYmxlc3BsaXRjZWxscycsIHtcbiAgICAgICAgdG9vbHRpcDogJ1NwbGl0IGNlbGwnLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZVNwbGl0Q2VsbHMnKSxcbiAgICAgICAgaWNvbjogJ3RhYmxlLXNwbGl0LWNlbGxzJyxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwVW5tZXJnZWFibGVcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigndGFibGVpbnNlcnRyb3diZWZvcmUnLCB7XG4gICAgICAgIHRvb2x0aXA6ICdJbnNlcnQgcm93IGJlZm9yZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlSW5zZXJ0Um93QmVmb3JlJyksXG4gICAgICAgIGljb246ICd0YWJsZS1pbnNlcnQtcm93LWFib3ZlJyxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ2VsbE9yUm93XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRCdXR0b24oJ3RhYmxlaW5zZXJ0cm93YWZ0ZXInLCB7XG4gICAgICAgIHRvb2x0aXA6ICdJbnNlcnQgcm93IGFmdGVyJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVJbnNlcnRSb3dBZnRlcicpLFxuICAgICAgICBpY29uOiAndGFibGUtaW5zZXJ0LXJvdy1hZnRlcicsXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWRlbGV0ZXJvdycsIHtcbiAgICAgICAgdG9vbHRpcDogJ0RlbGV0ZSByb3cnLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZURlbGV0ZVJvdycpLFxuICAgICAgICBpY29uOiAndGFibGUtZGVsZXRlLXJvdycsXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZXJvd3Byb3BzJywge1xuICAgICAgICB0b29sdGlwOiAnUm93IHByb3BlcnRpZXMnLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZVJvd1Byb3BzJyksXG4gICAgICAgIGljb246ICd0YWJsZS1yb3ctcHJvcGVydGllcycsXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWluc2VydGNvbGJlZm9yZScsIHtcbiAgICAgICAgdG9vbHRpcDogJ0luc2VydCBjb2x1bW4gYmVmb3JlJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVJbnNlcnRDb2xCZWZvcmUnKSxcbiAgICAgICAgaWNvbjogJ3RhYmxlLWluc2VydC1jb2x1bW4tYmVmb3JlJyxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ29sdW1uKCdvbkZpcnN0JylcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigndGFibGVpbnNlcnRjb2xhZnRlcicsIHtcbiAgICAgICAgdG9vbHRpcDogJ0luc2VydCBjb2x1bW4gYWZ0ZXInLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZUluc2VydENvbEFmdGVyJyksXG4gICAgICAgIGljb246ICd0YWJsZS1pbnNlcnQtY29sdW1uLWFmdGVyJyxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ29sdW1uKCdvbkxhc3QnKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWRlbGV0ZWNvbCcsIHtcbiAgICAgICAgdG9vbHRpcDogJ0RlbGV0ZSBjb2x1bW4nLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZURlbGV0ZUNvbCcpLFxuICAgICAgICBpY29uOiAndGFibGUtZGVsZXRlLWNvbHVtbicsXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENvbHVtbignb25BbnknKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWN1dHJvdycsIHtcbiAgICAgICAgdG9vbHRpcDogJ0N1dCByb3cnLFxuICAgICAgICBpY29uOiAnY3V0LXJvdycsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlQ3V0Um93JyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWNvcHlyb3cnLCB7XG4gICAgICAgIHRvb2x0aXA6ICdDb3B5IHJvdycsXG4gICAgICAgIGljb246ICdkdXBsaWNhdGUtcm93JyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVDb3B5Um93JyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZXBhc3Rlcm93YmVmb3JlJywge1xuICAgICAgICB0b29sdGlwOiAnUGFzdGUgcm93IGJlZm9yZScsXG4gICAgICAgIGljb246ICdwYXN0ZS1yb3ctYmVmb3JlJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVQYXN0ZVJvd0JlZm9yZScpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBQYXN0ZWFibGUoY2xpcGJvYXJkLmdldFJvd3MpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRCdXR0b24oJ3RhYmxlcGFzdGVyb3dhZnRlcicsIHtcbiAgICAgICAgdG9vbHRpcDogJ1Bhc3RlIHJvdyBhZnRlcicsXG4gICAgICAgIGljb246ICdwYXN0ZS1yb3ctYWZ0ZXInLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZVBhc3RlUm93QWZ0ZXInKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwUGFzdGVhYmxlKGNsaXBib2FyZC5nZXRSb3dzKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWN1dGNvbCcsIHtcbiAgICAgICAgdG9vbHRpcDogJ0N1dCBjb2x1bW4nLFxuICAgICAgICBpY29uOiAnY3V0LWNvbHVtbicsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlQ3V0Q29sJyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENvbHVtbignb25BbnknKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWNvcHljb2wnLCB7XG4gICAgICAgIHRvb2x0aXA6ICdDb3B5IGNvbHVtbicsXG4gICAgICAgIGljb246ICdkdXBsaWNhdGUtY29sdW1uJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVDb3B5Q29sJyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENvbHVtbignb25BbnknKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZXBhc3RlY29sYmVmb3JlJywge1xuICAgICAgICB0b29sdGlwOiAnUGFzdGUgY29sdW1uIGJlZm9yZScsXG4gICAgICAgIGljb246ICdwYXN0ZS1jb2x1bW4tYmVmb3JlJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVQYXN0ZUNvbEJlZm9yZScpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBQYXN0ZWFibGVDb2x1bW4oY2xpcGJvYXJkLmdldENvbHVtbnMsICdvbkZpcnN0JylcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigndGFibGVwYXN0ZWNvbGFmdGVyJywge1xuICAgICAgICB0b29sdGlwOiAnUGFzdGUgY29sdW1uIGFmdGVyJyxcbiAgICAgICAgaWNvbjogJ3Bhc3RlLWNvbHVtbi1hZnRlcicsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlUGFzdGVDb2xBZnRlcicpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBQYXN0ZWFibGVDb2x1bW4oY2xpcGJvYXJkLmdldENvbHVtbnMsICdvbkxhc3QnKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQnV0dG9uKCd0YWJsZWluc2VydGRpYWxvZycsIHtcbiAgICAgICAgdG9vbHRpcDogJ0luc2VydCB0YWJsZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZUluc2VydFRhYmxlJyksXG4gICAgICAgIGljb246ICd0YWJsZSdcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdmFyIGFkZFRvb2xiYXJzID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIGlzVGFibGUgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIGVkaXRvci5kb20uaXModGFibGUsICd0YWJsZScpICYmIGVkaXRvci5nZXRCb2R5KCkuY29udGFpbnModGFibGUpO1xuICAgICAgfTtcbiAgICAgIHZhciB0b29sYmFyID0gZ2V0VG9vbGJhcihlZGl0b3IpO1xuICAgICAgaWYgKHRvb2xiYXIubGVuZ3RoID4gMCkge1xuICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkQ29udGV4dFRvb2xiYXIoJ3RhYmxlJywge1xuICAgICAgICAgIHByZWRpY2F0ZTogaXNUYWJsZSxcbiAgICAgICAgICBpdGVtczogdG9vbGJhcixcbiAgICAgICAgICBzY29wZTogJ25vZGUnLFxuICAgICAgICAgIHBvc2l0aW9uOiAnbm9kZSdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBhZGRNZW51SXRlbXMgPSBmdW5jdGlvbiAoZWRpdG9yLCBzZWxlY3Rpb25UYXJnZXRzLCBjbGlwYm9hcmQpIHtcbiAgICAgIHZhciBjbWQgPSBmdW5jdGlvbiAoY29tbWFuZCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlZGl0b3IuZXhlY0NvbW1hbmQoY29tbWFuZCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgdmFyIGluc2VydFRhYmxlQWN0aW9uID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgZWRpdG9yLmV4ZWNDb21tYW5kKCdtY2VJbnNlcnRUYWJsZScsIGZhbHNlLCB7XG4gICAgICAgICAgcm93czogZGF0YS5udW1Sb3dzLFxuICAgICAgICAgIGNvbHVtbnM6IGRhdGEubnVtQ29sdW1uc1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICB2YXIgdGFibGVQcm9wZXJ0aWVzID0ge1xuICAgICAgICB0ZXh0OiAnVGFibGUgcHJvcGVydGllcycsXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cFRhYmxlLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZVByb3BzJylcbiAgICAgIH07XG4gICAgICB2YXIgZGVsZXRlVGFibGUgPSB7XG4gICAgICAgIHRleHQ6ICdEZWxldGUgdGFibGUnLFxuICAgICAgICBpY29uOiAndGFibGUtZGVsZXRlLXRhYmxlJyxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwVGFibGUsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlRGVsZXRlJylcbiAgICAgIH07XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3RhYmxlaW5zZXJ0cm93YmVmb3JlJywge1xuICAgICAgICB0ZXh0OiAnSW5zZXJ0IHJvdyBiZWZvcmUnLFxuICAgICAgICBpY29uOiAndGFibGUtaW5zZXJ0LXJvdy1hYm92ZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlSW5zZXJ0Um93QmVmb3JlJyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3RhYmxlaW5zZXJ0cm93YWZ0ZXInLCB7XG4gICAgICAgIHRleHQ6ICdJbnNlcnQgcm93IGFmdGVyJyxcbiAgICAgICAgaWNvbjogJ3RhYmxlLWluc2VydC1yb3ctYWZ0ZXInLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZUluc2VydFJvd0FmdGVyJyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3RhYmxlZGVsZXRlcm93Jywge1xuICAgICAgICB0ZXh0OiAnRGVsZXRlIHJvdycsXG4gICAgICAgIGljb246ICd0YWJsZS1kZWxldGUtcm93JyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVEZWxldGVSb3cnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ2VsbE9yUm93XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVyb3dwcm9wcycsIHtcbiAgICAgICAgdGV4dDogJ1JvdyBwcm9wZXJ0aWVzJyxcbiAgICAgICAgaWNvbjogJ3RhYmxlLXJvdy1wcm9wZXJ0aWVzJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVSb3dQcm9wcycpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBDZWxsT3JSb3dcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCd0YWJsZWN1dHJvdycsIHtcbiAgICAgICAgdGV4dDogJ0N1dCByb3cnLFxuICAgICAgICBpY29uOiAnY3V0LXJvdycsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlQ3V0Um93JyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENlbGxPclJvd1xuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3RhYmxlY29weXJvdycsIHtcbiAgICAgICAgdGV4dDogJ0NvcHkgcm93JyxcbiAgICAgICAgaWNvbjogJ2R1cGxpY2F0ZS1yb3cnLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZUNvcHlSb3cnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ2VsbE9yUm93XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVwYXN0ZXJvd2JlZm9yZScsIHtcbiAgICAgICAgdGV4dDogJ1Bhc3RlIHJvdyBiZWZvcmUnLFxuICAgICAgICBpY29uOiAncGFzdGUtcm93LWJlZm9yZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlUGFzdGVSb3dCZWZvcmUnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwUGFzdGVhYmxlKGNsaXBib2FyZC5nZXRSb3dzKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3RhYmxlcGFzdGVyb3dhZnRlcicsIHtcbiAgICAgICAgdGV4dDogJ1Bhc3RlIHJvdyBhZnRlcicsXG4gICAgICAgIGljb246ICdwYXN0ZS1yb3ctYWZ0ZXInLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZVBhc3RlUm93QWZ0ZXInKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwUGFzdGVhYmxlKGNsaXBib2FyZC5nZXRSb3dzKVxuICAgICAgfSk7XG4gICAgICB2YXIgcm93ID0ge1xuICAgICAgICB0eXBlOiAnbmVzdGVkbWVudWl0ZW0nLFxuICAgICAgICB0ZXh0OiAnUm93JyxcbiAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICd0YWJsZWluc2VydHJvd2JlZm9yZSB0YWJsZWluc2VydHJvd2FmdGVyIHRhYmxlZGVsZXRlcm93IHRhYmxlcm93cHJvcHMgfCB0YWJsZWN1dHJvdyB0YWJsZWNvcHlyb3cgdGFibGVwYXN0ZXJvd2JlZm9yZSB0YWJsZXBhc3Rlcm93YWZ0ZXInO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCd0YWJsZWluc2VydGNvbHVtbmJlZm9yZScsIHtcbiAgICAgICAgdGV4dDogJ0luc2VydCBjb2x1bW4gYmVmb3JlJyxcbiAgICAgICAgaWNvbjogJ3RhYmxlLWluc2VydC1jb2x1bW4tYmVmb3JlJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVJbnNlcnRDb2xCZWZvcmUnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ29sdW1uKCdvbkZpcnN0JylcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCd0YWJsZWluc2VydGNvbHVtbmFmdGVyJywge1xuICAgICAgICB0ZXh0OiAnSW5zZXJ0IGNvbHVtbiBhZnRlcicsXG4gICAgICAgIGljb246ICd0YWJsZS1pbnNlcnQtY29sdW1uLWFmdGVyJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVJbnNlcnRDb2xBZnRlcicpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBDb2x1bW4oJ29uTGFzdCcpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVkZWxldGVjb2x1bW4nLCB7XG4gICAgICAgIHRleHQ6ICdEZWxldGUgY29sdW1uJyxcbiAgICAgICAgaWNvbjogJ3RhYmxlLWRlbGV0ZS1jb2x1bW4nLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZURlbGV0ZUNvbCcpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBDb2x1bW4oJ29uQW55JylcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCd0YWJsZWN1dGNvbHVtbicsIHtcbiAgICAgICAgdGV4dDogJ0N1dCBjb2x1bW4nLFxuICAgICAgICBpY29uOiAnY3V0LWNvbHVtbicsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlQ3V0Q29sJyksXG4gICAgICAgIG9uU2V0dXA6IHNlbGVjdGlvblRhcmdldHMub25TZXR1cENvbHVtbignb25BbnknKVxuICAgICAgfSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ3RhYmxlY29weWNvbHVtbicsIHtcbiAgICAgICAgdGV4dDogJ0NvcHkgY29sdW1uJyxcbiAgICAgICAgaWNvbjogJ2R1cGxpY2F0ZS1jb2x1bW4nLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZUNvcHlDb2wnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ29sdW1uKCdvbkFueScpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVwYXN0ZWNvbHVtbmJlZm9yZScsIHtcbiAgICAgICAgdGV4dDogJ1Bhc3RlIGNvbHVtbiBiZWZvcmUnLFxuICAgICAgICBpY29uOiAncGFzdGUtY29sdW1uLWJlZm9yZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlUGFzdGVDb2xCZWZvcmUnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwUGFzdGVhYmxlQ29sdW1uKGNsaXBib2FyZC5nZXRDb2x1bW5zLCAnb25GaXJzdCcpXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVwYXN0ZWNvbHVtbmFmdGVyJywge1xuICAgICAgICB0ZXh0OiAnUGFzdGUgY29sdW1uIGFmdGVyJyxcbiAgICAgICAgaWNvbjogJ3Bhc3RlLWNvbHVtbi1hZnRlcicsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlUGFzdGVDb2xBZnRlcicpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBQYXN0ZWFibGVDb2x1bW4oY2xpcGJvYXJkLmdldENvbHVtbnMsICdvbkxhc3QnKVxuICAgICAgfSk7XG4gICAgICB2YXIgY29sdW1uID0ge1xuICAgICAgICB0eXBlOiAnbmVzdGVkbWVudWl0ZW0nLFxuICAgICAgICB0ZXh0OiAnQ29sdW1uJyxcbiAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuICd0YWJsZWluc2VydGNvbHVtbmJlZm9yZSB0YWJsZWluc2VydGNvbHVtbmFmdGVyIHRhYmxlZGVsZXRlY29sdW1uIHwgdGFibGVjdXRjb2x1bW4gdGFibGVjb3B5Y29sdW1uIHRhYmxlcGFzdGVjb2x1bW5iZWZvcmUgdGFibGVwYXN0ZWNvbHVtbmFmdGVyJztcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVjZWxscHJvcHMnLCB7XG4gICAgICAgIHRleHQ6ICdDZWxsIHByb3BlcnRpZXMnLFxuICAgICAgICBpY29uOiAndGFibGUtY2VsbC1wcm9wZXJ0aWVzJyxcbiAgICAgICAgb25BY3Rpb246IGNtZCgnbWNlVGFibGVDZWxsUHJvcHMnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwQ2VsbE9yUm93XG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVtZXJnZWNlbGxzJywge1xuICAgICAgICB0ZXh0OiAnTWVyZ2UgY2VsbHMnLFxuICAgICAgICBpY29uOiAndGFibGUtbWVyZ2UtY2VsbHMnLFxuICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VUYWJsZU1lcmdlQ2VsbHMnKSxcbiAgICAgICAgb25TZXR1cDogc2VsZWN0aW9uVGFyZ2V0cy5vblNldHVwTWVyZ2VhYmxlXG4gICAgICB9KTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgndGFibGVzcGxpdGNlbGxzJywge1xuICAgICAgICB0ZXh0OiAnU3BsaXQgY2VsbCcsXG4gICAgICAgIGljb246ICd0YWJsZS1zcGxpdC1jZWxscycsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZVRhYmxlU3BsaXRDZWxscycpLFxuICAgICAgICBvblNldHVwOiBzZWxlY3Rpb25UYXJnZXRzLm9uU2V0dXBVbm1lcmdlYWJsZVxuICAgICAgfSk7XG4gICAgICB2YXIgY2VsbCA9IHtcbiAgICAgICAgdHlwZTogJ25lc3RlZG1lbnVpdGVtJyxcbiAgICAgICAgdGV4dDogJ0NlbGwnLFxuICAgICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gJ3RhYmxlY2VsbHByb3BzIHRhYmxlbWVyZ2VjZWxscyB0YWJsZXNwbGl0Y2VsbHMnO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaWYgKGhhc1RhYmxlR3JpZChlZGl0b3IpID09PSBmYWxzZSkge1xuICAgICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTWVudUl0ZW0oJ2luc2VydHRhYmxlJywge1xuICAgICAgICAgIHRleHQ6ICdUYWJsZScsXG4gICAgICAgICAgaWNvbjogJ3RhYmxlJyxcbiAgICAgICAgICBvbkFjdGlvbjogY21kKCdtY2VJbnNlcnRUYWJsZScpXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE5lc3RlZE1lbnVJdGVtKCdpbnNlcnR0YWJsZScsIHtcbiAgICAgICAgICB0ZXh0OiAnVGFibGUnLFxuICAgICAgICAgIGljb246ICd0YWJsZScsXG4gICAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgICAgICB0eXBlOiAnZmFuY3ltZW51aXRlbScsXG4gICAgICAgICAgICAgICAgZmFuY3l0eXBlOiAnaW5zZXJ0dGFibGUnLFxuICAgICAgICAgICAgICAgIG9uQWN0aW9uOiBpbnNlcnRUYWJsZUFjdGlvblxuICAgICAgICAgICAgICB9XTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCdpbnNlcnR0YWJsZWRpYWxvZycsIHtcbiAgICAgICAgdGV4dDogJ0luc2VydCB0YWJsZScsXG4gICAgICAgIGljb246ICd0YWJsZScsXG4gICAgICAgIG9uQWN0aW9uOiBjbWQoJ21jZUluc2VydFRhYmxlJylcbiAgICAgIH0pO1xuICAgICAgZWRpdG9yLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCd0YWJsZXByb3BzJywgdGFibGVQcm9wZXJ0aWVzKTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgnZGVsZXRldGFibGUnLCBkZWxldGVUYWJsZSk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTmVzdGVkTWVudUl0ZW0oJ3JvdycsIHJvdyk7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTmVzdGVkTWVudUl0ZW0oJ2NvbHVtbicsIGNvbHVtbik7XG4gICAgICBlZGl0b3IudWkucmVnaXN0cnkuYWRkTmVzdGVkTWVudUl0ZW0oJ2NlbGwnLCBjZWxsKTtcbiAgICAgIGVkaXRvci51aS5yZWdpc3RyeS5hZGRDb250ZXh0TWVudSgndGFibGUnLCB7XG4gICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNlbGVjdGlvblRhcmdldHMucmVzZXRUYXJnZXRzKCk7XG4gICAgICAgICAgcmV0dXJuIHNlbGVjdGlvblRhcmdldHMudGFyZ2V0cygpLmZvbGQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uICh0YXJnZXRzKSB7XG4gICAgICAgICAgICBpZiAobmFtZSh0YXJnZXRzLmVsZW1lbnQpID09PSAnY2FwdGlvbicpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICd0YWJsZXByb3BzIGRlbGV0ZXRhYmxlJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiAnY2VsbCByb3cgY29sdW1uIHwgYWR2dGFibGVzb3J0IHwgdGFibGVwcm9wcyBkZWxldGV0YWJsZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgUGx1Z2luID0gZnVuY3Rpb24gKGVkaXRvcikge1xuICAgICAgdmFyIHNlbGVjdGlvbnMgPSBTZWxlY3Rpb25zKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGdldEJvZHkkMShlZGl0b3IpO1xuICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZ2V0U2VsZWN0aW9uU3RhcnRDZWxsT3JDYXB0aW9uKGdldFNlbGVjdGlvblN0YXJ0KGVkaXRvcikpO1xuICAgICAgfSwgZXBoZW1lcmEuc2VsZWN0ZWRTZWxlY3Rvcik7XG4gICAgICB2YXIgc2VsZWN0aW9uVGFyZ2V0cyA9IGdldFNlbGVjdGlvblRhcmdldHMoZWRpdG9yLCBzZWxlY3Rpb25zKTtcbiAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZ2V0UmVzaXplSGFuZGxlcihlZGl0b3IpO1xuICAgICAgdmFyIGNlbGxTZWxlY3Rpb24gPSBDZWxsU2VsZWN0aW9uKGVkaXRvciwgcmVzaXplSGFuZGxlci5sYXp5UmVzaXplLCBzZWxlY3Rpb25UYXJnZXRzKTtcbiAgICAgIHZhciBhY3Rpb25zID0gVGFibGVBY3Rpb25zKGVkaXRvciwgcmVzaXplSGFuZGxlci5sYXp5V2lyZSwgc2VsZWN0aW9ucyk7XG4gICAgICB2YXIgY2xpcGJvYXJkID0gQ2xpcGJvYXJkKCk7XG4gICAgICByZWdpc3RlckNvbW1hbmRzKGVkaXRvciwgYWN0aW9ucywgY2VsbFNlbGVjdGlvbiwgc2VsZWN0aW9ucywgY2xpcGJvYXJkKTtcbiAgICAgIHJlZ2lzdGVyUXVlcnlDb21tYW5kcyhlZGl0b3IsIGFjdGlvbnMsIHNlbGVjdGlvbnMpO1xuICAgICAgcmVnaXN0ZXJFdmVudHMoZWRpdG9yLCBzZWxlY3Rpb25zLCBhY3Rpb25zLCBjZWxsU2VsZWN0aW9uKTtcbiAgICAgIGFkZE1lbnVJdGVtcyhlZGl0b3IsIHNlbGVjdGlvblRhcmdldHMsIGNsaXBib2FyZCk7XG4gICAgICBhZGRCdXR0b25zKGVkaXRvciwgc2VsZWN0aW9uVGFyZ2V0cywgY2xpcGJvYXJkKTtcbiAgICAgIGFkZFRvb2xiYXJzKGVkaXRvcik7XG4gICAgICBlZGl0b3Iub24oJ1ByZUluaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVkaXRvci5zZXJpYWxpemVyLmFkZFRlbXBBdHRyKGVwaGVtZXJhLmZpcnN0U2VsZWN0ZWQpO1xuICAgICAgICBlZGl0b3Iuc2VyaWFsaXplci5hZGRUZW1wQXR0cihlcGhlbWVyYS5sYXN0U2VsZWN0ZWQpO1xuICAgICAgICByZWdpc3RlckZvcm1hdHMoZWRpdG9yKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKGhhc1RhYk5hdmlnYXRpb24oZWRpdG9yKSkge1xuICAgICAgICBlZGl0b3Iub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGhhbmRsZSQxKGUsIGVkaXRvciwgY2VsbFNlbGVjdGlvbik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZWRpdG9yLm9uKCdyZW1vdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc2l6ZUhhbmRsZXIuZGVzdHJveSgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZ2V0QXBpKGVkaXRvciwgY2xpcGJvYXJkLCByZXNpemVIYW5kbGVyLCBzZWxlY3Rpb25UYXJnZXRzKTtcbiAgICB9O1xuICAgIGZ1bmN0aW9uIFBsdWdpbiQxICgpIHtcbiAgICAgIGdsb2JhbC5hZGQoJ3RhYmxlJywgUGx1Z2luKTtcbiAgICB9XG5cbiAgICBQbHVnaW4kMSgpO1xuXG59KCkpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QTs7Ozs7Ozs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0E7O0EiLCJzb3VyY2VSb290IjoiIn0=